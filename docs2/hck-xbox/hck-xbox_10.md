# 第十章：-

更多硬件项目

由于 Xbox 与 PC 架构的相似性，黑客在构建硬件项目时可以借用 PC 世界的科技和专业知识。因此，PC 硬件、显示器、电缆和外设都已被适配以与 Xbox 一起工作。本章介绍了由世界各地黑客发现、记录和实现的这些硬件项目。

## **LPC 接口**

LPC（低引脚数）接口的 1.0 版本由英特尔在 1997 年定义。LPC 接口是一个无需支付版税的总线，旨在使没有明确 ISA 或 X-bus（用于内存或通用 I/O 设备的类似 ISA 扩展总线）能力的系统得以实现。LPC 接口的需求源于标准 PC 中存在的大量低比特率、高引脚数、接口不兼容的设备和总线，例如软盘、键盘、鼠标、串行、IrDA、并行、ISA 和引导 ROM 接口。所有这些设备消耗的总带宽很小，但支持所有这些设备所需的信号数量很容易超过 PCI 或 AGP 总线等高带宽总线所需的信号数量。更糟糕的是，并非所有计算机配置都需要所有这些传统 I/O 设备，而浪费的引脚和功能只是吞噬着利润。芯片封装上引脚的成本相对于支持这些简单接口所需的硅成本是高昂的。（一个经验法则是，一个封装引脚的成本是一分，而在 0.13µ 硅中，大约有十万个门——足以实现一个小型处理器——在硅面积上的成本是一分，假设设计不是受焊盘限制的¹。）

LPC 接口通过一个单一、低引脚数的总线（七根必需引脚，而 ISA 总线需要 36 根引脚）来解决这个问题，该总线以高速运行。所有传统的 I/O 和扩展功能都被映射到这个高带宽总线上，使得系统设计者能够创建所谓的“超级 I/O”芯片，这些芯片反过来又使得南桥芯片具有更低的引脚数。此外，将功能在超级 I/O 芯片和南桥芯片之间分离，使得设计者可以选择提供给定应用最佳功能集的超级 I/O 和南桥芯片组合。

LPC 物理接口相当简单。该接口是一个 4 位双向总线，以 33 MHz 的时钟速率运行。接口还有两个“边带”信号：一个帧信号，指示 LPC 总线周期的开始和结束，以及一个复位信号，强制所有 LPC 外围设备进入已知状态以进行初始化。此外，还有一些可选信号为 LPC 接口提供 DMA 和中断功能，以及更复杂 I/O 设备的电源管理。（有关 LPC 总线和其协议的更多信息，请参阅英特尔低引脚数（LPC）接口规范，版本 1.1。规范可以在英特尔公司网站上找到：http://www.intel.com/design/chipsets/industry/lpc.htm。）

### **Xbox 上的 LPC 接口**

Xbox 主板集成了 LPC 接口。在这种情况下，LPC 接口用于实现一个调试和测试总线。可以通过这个 LPC 接口连接键盘和鼠标，以及用于诊断目的的备用引导 ROM。当 Xbox 上的 FLASH ROM 不可用时，会激活 LPC 接口来加载备用引导代码。可以通过强制将 FLASH ROM 数据总线上的最低数据位（D0）设置为零伏特来模拟缺少 FLASH ROM 设备。

许多人推测，由于 LPC 接口提供的备用引导 ROM 功能，它是 Xbox 生产线的一个关键部分。可以通过 LPC 接口对完全组装好的 Xbox 进行配置，以运行一个全面的自我测试程序。将 CPU 作为快速测试控制器使用，可以在工厂地板上快速有效地隔离有缺陷的单元，而无需昂贵的测试设备。

对于黑客来说，LPC 接口提供的备用引导 ROM 功能是一个将代码引入 Xbox 的理想机制。任何人都可以创建适用于 Xbox 的有效 LPC 引导 ROM 映像，因为 Xbox 的加密安全引导程序现在已经被完全理解。实际上，一些 Xbox 备用引导 ROM 设备的供应商利用了 Xbox 主板 LPC 接口引脚排列几何形状的规律性，创建了无需焊接即可安装的 ROM 设备。这些设备使用一套弹簧加载的“跳针”，类似于在生产过程中用于 Xbox 测试的跳针，只需施加压力即可接触 LPC 接口。（Xbox 上实现的 LPC 总线的引脚排列可以在附录 F，“Xbox 硬件参考”中找到。）

### **使用 LPC 接口**

LPC 接口是行业标准的事实对 Xbox 硬件黑客来说非常方便。首先，有大量的 LPC 兼容接口设备，从 Super-I/O 芯片到内置 LPC 接口的固件 ROM。其次，LPC 接口作为通用 PC 的诊断和便利总线被广泛接受，有助于减轻使用 LPC 接口和销售 LPC 接口设备的法律风险。LPC 接口的固件 ROM 可以销售，无需包含任何 Xbox 特定的内容，因为最终用户可以使用简单的、便宜的适配器轻松重新编程他们的 PC 上的 LPC 总线设备。对 LPC 固件设备合法性的进一步帮助是，Xbox 的 LPC 接口引脚排列几乎与 Intel 为通用 PC 推荐的一致。因此，为 Xbox 销售的 LPC 固件设备与为标准 PC 销售的 LPC 固件设备非常相似。

第一款 LPC 引导 ROM 设备是由 Andy Green 开发的。该项目被称为“Cheapmod”，它是一个 SST 49LF020 设备（256 kByte FLASH ROM，带有集成 LPC 接口），通过插座连接到 LPC 兼容的接口。根据 Andy 的 Cheapmod 网页，“http://warmcat.com/milksop/cheapmod.html”，“如果你能以 2.50 美元的价格买到 SST 49LF020，你就可以用 4 美元的价格构建一个替代 BIOS。”这个设备可以使用他的“CheapLPC”编程器（http://warmcat.com/milksop/cheapLPC.html）进行编程，这是一个令人愉快的简单 PC 并行端口设备，可以（缓慢地）与 LPC 设备通信并重新编程。许多商业可用的替代固件设备都是基于或受其设计启发的，包括 Xodus/Matrix 设计。Xodus/Matrix 是 Andy 原始设计的特别有趣的变体，因为它是最先实现完全无焊点安装程序的 Xbox 替代固件设备。这为那些不愿意在 Xbox 中焊接线缆的软件黑客打开了 Xbox 破解的世界。（Xodus/Matrix 的照片见图 10-1。）Xodus/Matrix 设备没有预先编程任何代码；用户必须提供替代固件映像。

在选择用于 Xbox 的具有 LPC 接口的 FLASH ROM 芯片时，有一些重要的功能考虑因素。其中最显著的是，原生 Xbox 架构为引导 ROM 分配了 16 MB 的空间。如果物理引导 ROM 的大小小于 16 MB，则引导 ROM 的内容会被别名化以填充整个 16 MB 空间。这为 Xbox 设计者提供了更多的灵活性，在选择 ROM 芯片大小时不会对使用底部和顶部相对寻址的例程造成问题。

![图片](img/index-172_1.png)

**图 10-1**：无焊点 Xodus/Matrix 替代固件设备，展示了弹簧加载的“跳针”触点，这些触点允许无焊点连接到 Xbox 主板上 LPC 接口。

让我们通过一个例子使底地址和顶地址相对寻址的概念更加具体。Xbox 中 16 MB 引导 ROM 区域的地址范围从 0xFF00.0000 到 0xFFFF.FFFF。在 Xbox 上使用底地址相对寻址的程序将使用 0xFF00.0000 + offset（底地址加偏移量）来计算地址，而使用顶地址相对寻址的程序将使用 0xFFFF.FFFF – offset（顶地址减去偏移量）。假设在 Xbox 中安装了一个 1 MB 的引导 ROM。这意味着处理器将看到 16 个相同的 1 MB ROM 副本，均匀分布在 16 MB ROM 地址空间中。换句话说，引导内存的内容对于每个地址 A + 0xFF00.0000 + n * 0x0010.0000 都是相同的，其中 n = 0 到 15，A = 0 到 0x000F.FFFF。因此，程序员可以在较小的 1 MB 引导 ROM 中使用顶地址和底地址相对寻址来打包数据，而无需更改任何代码：有效的 ROM 映像在顶地址和底地址相对基址附近都出现。现在，假设微软决定节省成本并将 1 MB 的引导 ROM 缩小到 256 kB 的引导 ROM。现在，处理器将看到 64 个相同的 256 kB 引导 ROM 副本分布在 16 MB ROM 地址空间中，并且所有使用底地址和顶地址相对寻址的旧代码仍然有效。值得注意的是，Xbox 中的 CPU 在电源开启时从内存顶部 16 字节处的地址（其“复位向量”）开始执行代码，而硬件初始化例程被集成到 Xbox 芯片组中，这些例程使用位于 16 MB FLASH ROM 空间底部的 ROM 位置。因此，Xbox 硬件*需要*一个 16 MB 大小的 LPC ROM 实现，或者在整个 FLASH ROM 地址空间中别名一个较小的 ROM 的内容。（SST 49LF020 是少数几个在整个地址空间中别名 ROM 内容的 LPC FLASH ROM 之一。可以说，这个特性实际上是一个错误：通过忽略高地址位并在整个地址空间中别名 ROM 的内容，这个芯片占用了本可以分配给其他功能的空间。因此，SST 已经发布了该部件的更新“A-step”版本，称为 49LF020A，它不会在内存中别名 ROM 的内容。同样，A-step 硅片不能作为 Xbox 的备用固件设备使用。）

## **备用固件设备与** **Modchips**

一个替代固件设备是一个硬件模块，它提供了一种在 Xbox 硬件上运行用户指定固件的方法。替代固件设备与所谓的“modchip”不同，因为替代固件设备是一个空白设备，没有固有的绕过版权控制机制的能力。例如，一个空白 LPC 接口 ROM 设备就是一个替代固件设备：如果你想的话，可以在上面烧录一份美国权利法案。任何用户安装的空白 FLASH ROM 也是替代固件设备。另一方面，俗语中的 modchip 暗示的是一个专门为播放游戏备份和修改或删除 DRM（数字版权管理）策略限制而设计的设备。因此，术语 modchip 包括某些已经编程了允许修改 DRM 策略的代码的引导 ROM 设备，以及像“修补器”这样的设备，这些设备没有 ROM，通过在固件加载执行时动态修补几个关键的 Xbox 固件位置来运行。

## **其他 64 MB 的 SDRAM**

一个敏锐的观察者会注意到，Xbox 主板上顶部缺失了两块芯片，而且这些缺失的芯片位置看起来可疑地像目前被内存芯片占据的位置。翻转主板，会发现还有两个未被占用的芯片焊盘。这些空焊盘实际上是为内存芯片准备的。这些空白位置的位置在图 10-2 中显示。

![图片](img/index-174_1.png)

**图 10-2**：Xbox 主板上的未填充内存焊盘。

## **基准点**

观察 Xbox 主板上的一个未填充的内存位置。这些未填充的芯片焊盘内环绕着一个银色圆点的深色圆环被称为基准点。基准点图案被电路板组装机用作对准大量多针芯片的参考点。它们被设计成易于被板组装机中使用的机器视觉系统识别。特殊形状的基准点也可以用来实现电路板方向和类型的自动识别。

下一个合乎逻辑的问题当然是，“你能通过将合适的内存芯片焊接在 Xbox 主板上的空槽中，将 Xbox 的内存大小加倍到 128 MB 吗？”实际上答案是肯定的，但为了使芯片组能够识别和使用额外的内存，需要修改 Xbox 的初始化代码。此外，额外的内存对图形或游戏性能没有帮助。Xbox 游戏没有设计为利用额外的内存，因此额外的内存通常会被闲置。额外的内存位置主要是为了制造专为游戏开发者制造的专用游戏机。游戏开发者可以使用额外的内存来简化游戏过渡到 Xbox 相对紧凑的内存占用，以及保持调试、性能监控和测试工具在内存中，这些工具不是游戏图像的一部分。请注意，额外的内存可以被自制软件利用，但获取和安装内存芯片的难度使得 Xbox 内存扩展更像是一个有趣的焊接实践练习，而不是一个实用的修改。

## **Xbox VGA**

对于 Xbox VGA 适配器的作用有一些混淆。许多 Xbox VGA 适配器实际上是电视到 VGA 转换器。换句话说，它们将 Xbox 的低分辨率电视输出通过行倍增器运行，以产生低质量的 VGA 显示。真正的 Xbox VGA 适配器实际上配置 Xbox 以输出更高分辨率的视频输出，在 VGA 显示器上产生优于电视的显示质量。

VGA 适配器通过 AVIP（音频视频 I/O 端口）连接器中的指定引脚配置 Xbox 图形模式。这种方法的主要问题是游戏必须特别编写以支持这种更高分辨率的模式。因此，一些游戏可能无法与真正的 Xbox VGA 适配器一起工作，但幸运的是，回到电视分辨率就像插入标准电视适配器电缆一样简单。

原始的 Xbox-VGA 适配器是由 Ken Gasper 开发的。他在自己的网站上出售该适配器版本，网址为 http://xboxvga.xemulation.com。目前，他提供的是“裸板”形式的 Xbox-VGA 适配器以及完全组装的形式。如果你在寻找一个既实用又能提高你的电路组装技能的有趣硬件破解项目，那么购买他的裸板并尝试自己组装适配器可能值得。

附录 F 包含 Xbox AVIP 的引脚图。

## **存储替换**

Xbox 包含 DVD-ROM 驱动器和硬盘驱动器，它们都使用 PC 标准的 IDE 接口与 Xbox 主板通信。DVD-ROM 驱动器还有一个专有的电源和 DVD 托盘状态连接器。对于 Xbox 来说，一种流行且有时必要的破解活动是替换这些驱动器。

用户会替换或调整 DVD-ROM，因为原生的 Xbox DVD-ROM 驱动器无法读取 CD-R 和许多类型的 CD-RW 媒体。这对那些第一次尝试安装 Xbox-Linux 或试图将 CD-R 收藏中的音乐复制到 Xbox 硬盘的用户来说尤其令人烦恼。

替换和调整 Xbox DVD-ROM 驱动器的方法有很多。一些 Xbox DVD-ROM 驱动器型号可以通过调整激光强度来提高读取 CD-R 和 CD-RW 媒体的能力。这是一个可能存在风险的操作，因为不正确地调整激光的功率输出可能会永久损坏您的 DVD-ROM 驱动器，但许多黑客报告说，正确执行程序可以带来更好的媒体兼容性。我建议进行网络搜索以获取最新的新闻和技术，因为 Xbox 中使用的 DVD-ROM 驱动器的型号和风格经常变化。此外，Xbox DVD-ROM 驱动器可以直接用标准的 PC DVD-ROM 替换。这种方法的问题有两个。首先，由于 Xbox 游戏盘内置了物理安全措施，普通的 PC DVD-ROM 驱动器无法读取原始 Xbox 游戏盘。其次，PC DVD-ROM 驱动器需要适配 Xbox 主板上定制的 DVD 电源和托盘状态连接器。

最简单但最丑陋的方法是安装一个标准的 PC DVD-ROM 驱动器，但通过专有电缆将 Xbox DVD-ROM 驱动器连接起来。在这种方法中，灰色 IDE 电缆连接到标准的 PC DVD-ROM 驱动器（通过驱动器上的跳线配置设置为从模式），并使用标准的电源分配电缆从硬盘的电源连接器获取电源。Xbox DVD-ROM 驱动器保持原位，但其 IDE 连接器为空，并安装了专有的黄色电源和托盘状态电缆。Xbox DVD-ROM 驱动器的作用是作为备用驱动器，用于在媒体更换事件中手动将 DVD 驱动器托盘的状态传递给 Xbox。换句话说，用户需要在媒体更换事件期间手动使用 Xbox DVD-ROM 的托盘复制标准 PC DVD-ROM 托盘的状态。

在这种配置下操作 Xbox 的确切步骤取决于特定的 PC DVD-ROM 驱动器型号和 Xbox 硬件配置的细微差别，因此，我再次建议进行网络搜索以获取最新信息。还有一些网站描述了如何将选定的 PC DVD-ROM 驱动器型号适配到 Xbox 专有的托盘状态和电源连接器。这样的项目对于基本熟悉焊接和螺丝刀的黑客来说是一个很好的中级项目。对标准 DVD-ROM 驱动器进行的修改允许准确地将标准驱动器的 DVD 托盘状态传输到 Xbox。然而，除非 Xbox 已经通过额外的硬件修改绕过了 DVD ROM 驱动器的安全检查，否则这些修改不允许您播放原始游戏。即使没有玩游戏的能力，这仍然是一种有用的技术，可以用于排查 Xbox-Linux 安装问题，并增强 Xbox 复制您的 CD 收藏或观看 DVD 的能力。（注意，将 IDE 连接器恢复到 Xbox DVD-ROM 驱动器将恢复 Xbox 的原有游戏功能。） 

Xbox 硬盘有时也需要更换。对于 Xbox 的严肃软件开发者来说，在 Xbox 中安装一个容量更大的硬盘是有利的，而且硬盘损坏的用户也希望更换他们的硬盘。不幸的是，OEM Xbox 硬盘包含了受版权保护的微软程序。Xbox 硬盘还受到固件锁定的保护，这使得安装具有原始游戏功能的全新硬盘变得相当具有挑战性，尤其是在法律问题上。固件锁定对每个硬盘都是独特的，这阻止了您使用二手 Xbox 硬盘来更换硬盘。然而，如果您只想运行 Xbox-Linux 或其他自制程序，而不关心玩游戏，那么在 Xbox 中安装新硬盘就像在任意 PC 中安装硬盘一样简单且合法。

¹芯片上的电路通常被金属方框（“焊盘”）包围，这些焊盘连接到芯片封装上的引脚。当焊盘环所需的面积超过芯片内部电路所需的面积时，芯片被认为是焊盘限制的。如果芯片是焊盘限制的，那么多余引脚的成本会更高。
