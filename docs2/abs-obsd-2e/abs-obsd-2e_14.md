## 第十四章。一切关于 /etc

*你处于一个迷宫中*

*错综复杂的配置；*

*没有两个是相同的。*

![](img/httpatomoreillycomsourcenostarchimages1616079.png) 当我被分配到一个不熟悉的服务器时，我首先做的事情是寻找前系统管理员的文档。当我发现没有时，我就研究 */etc* 目录，因为它包含类 Unix 系统的基本配置。从初级系统管理员到中级系统管理员的最快方式是阅读 */etc* 和相关的 man 页面——所有文档。是的，这是一大堆阅读。

一旦你理解了 */etc*，你就理解了系统是如何组合在一起的。你必须学习所有这些，但你不妨走一条更简单的路线，提前学习而不是在一系列无计划的绝望故障排除会议中进行学习。（我已经在前面的章节中讨论了许多相关的 */etc* 文件，例如 第八章 中的 */etc/fstab* 和 第十一章 中的 */etc/services*。）

你会发现 */etc* 中的一些文件只有历史意义，或者正在逐渐消失。我将简要讨论它们的功能，但不会花太多时间在过时的文件上。我也不会花太多时间在只有边缘情况（与不常用或只在非常特殊情况下使用的软件相关）中才有用的文件上。另一方面，我将深入探讨那些尚未在其他地方找到位置的 重要 */etc* 文件。

## /etc 在 Unix 变体中的使用

不同的类 Unix 系统使用不同的 */etc* 文件。在许多商业变体中，这些文件只是原始 BSD 的重命名或重构文件。

例如，我第一次管理 IBM AIX 系统时，需要知道哪些磁盘应该挂载在哪里，但那里没有 */etc/fstab*。一点搜索后，我找到了 */etc/filesystems*，这是 IBM 的 */etc/fstab*。显然，IBM 的人认为名为“文件系统表”的文件很令人困惑，所以给了它一个不同的名字。知道这些信息存在于 */etc* 中，并且知道哪些文件具有无关的目的，大大缩短了我的搜索时间。

对 */etc* 的更改可以显著改变系统的性能。虽然手动恢复混乱的文件系统可能会将一个合格的系统管理员推向成为一个相当不错的系统管理员，但这并不是到达那里的最愉快的方式。

## /etc 文件

现在我们将按字母顺序查看每个 */etc* 文件。我们将从 */etc/adduser.conf* 开始，以 */etc/ypldap.conf* 结束。

### /etc/adduser.conf

*/etc/adduser.conf* 文件包含 `adduser(8)` 的持久配置，第六章 详细介绍了它。要更改 `adduser` 的设置，请编辑此文件。此文件是自文档化的，如果你已经阅读了 第六章，你应该不会遇到任何问题。

### /etc/amd

自动挂载守护进程在请求时自动加载 NFS 文件系统。如果您对此功能感兴趣，请阅读 `amd(8)` 手册页。

自动挂载守护进程并不像您想象的那么有用。正如文档所说，“丰富的想象力对于充分利用所有功能最有用。”

### /etc/authpf

The */etc/authpf* 目录包含认证数据包过滤器配置。如果您对为防火墙访问进行用户认证感兴趣，我推荐 Peter Hansteen（No Starch Press，2010 年）所著的《PF 权威指南》（第 2 版）。

### /etc/bgpd.conf

OpenBSD 包含一个 BGP 守护进程，`bgpd(8)`。大多数系统管理员永远不会接近 BGP，但如果你需要它，请参阅 `bgpd.conf(5)` 手册页。

### /etc/boot.conf

The */etc/boot.conf* 文件控制系统的引导过程，如第五章引导过程所述。

### /etc/changelist

*/etc/changelist* 是一个文本文件，其中包含由每日安全检查脚本 */etc/security* 检查的文件列表。我们将在第十五章系统维护中详细讨论这些任务。

### /etc/chio.conf

`chio(1)` 中间介质更换器允许您管理类似 jukebox 的媒体数组，例如 CD 和磁带更换器。如果您有一个可以独立在多个磁带之间切换的磁带备份单元，`chio` 就是您的朋友。在 */etc/chio.conf* 中配置 `chio`。大多数 OpenBSD 用户没有介质更换器，但如果您感兴趣，请参阅 `chio(1)` 的手册页。

### /etc/csh.*

The */etc/csh.** 文件包含 `csh(1)` 和 `tcsh(1)` 的系统默认设置。当用户使用这两个 shell 之一登录时，shell 会执行 */etc/csh.login* 中列出的任何命令。同样，当用户注销时，shell 会执行 */etc/csh.logout* 中的任何命令。将一般 shell 配置放在 */etc/csh.cshrc* 中。

### /etc/daily 和 /etc/daily.local

The */etc/daily.local* 脚本每天运行以维护系统。有关详细信息，请参阅第十五章系统维护。

### /etc/dhclient.conf

您可以通过使用 `dhclient(8)` 来配置 OpenBSD 的 DHCP 客户端，如第十二章连接到网络所述。

### /etc/dhcpd.conf

OpenBSD 包含一个安全的 DHCP 服务器。它最初是 Internet Systems Consortium (ISC) DHCP 服务器，但已被 OpenBSD 团队反复重写和简化。有关详细信息，请参阅第十六章网络服务器。

### /etc/disklabels/

The */etc/disklabels/* 目录传统上包含磁盘标签的备份副本，如第八章磁盘和文件系统所述。实际上很少系统管理员使用它，因为很少的系统管理员知道它的存在。OpenBSD 将所有系统磁盘的磁盘标签作为关键文件的每日备份的一部分进行复制（请参阅第十五章系统维护）。

### /etc/disktab

几十年前，硬盘是昂贵且珍贵的设备，种类只有寥寥几种。而现代硬盘可以告诉计算机它们的几何形状，但老式硬盘需要手动配置，同样，老式的可移动媒体，如 1.44MB 软盘和 Zip 盘也是如此。如果你想要访问这些古老的硬盘，你需要查看 */etc/disktab* 中的信息。（但如果你需要使用这些老硬盘，你几乎肯定是在解决错误的问题。）

### /etc/dumpdates

*/etc/dumpdates* 文件记录了最后一次成功的 `dump(8)` 备份的日期。`dump` 工具备份文件系统，而不是像 `tar(1)` 那样只备份文件系统上的文件。dump 包括文件标志和文件系统的其他特殊特性。

### /etc/dvmrpd.conf

OpenBSD 使用 `dvmrpd(8)` 实现 Distance Vector Multicast Routing Protocol (DVMRP)，配置在 *dvmrpd.conf* 中。这是 OpenBSD 表现良好的另一个边缘情况，但对只有少数用户感兴趣。如果你对 DVMRP 感兴趣，请参阅 `dvmrpd(8)` 的手册页面。

### /etc/exports

NFS 服务器在 */etc/exports* 中列出它们导出的文件系统以及谁可以访问它们。有关将 NFS 用作客户端和服务器的信息，请参阅 第九章。

### /etc/fbtab

OpenBSD 可以根据用户登录的方式更改系统文件和设备的所有权。当用户通过文本控制台登录时，`login(1)` 会更改控制台的所有权，以及键盘和鼠标的所有权，变为该用户。这样，用户就可以根据他们的偏好配置键盘或鼠标。通过 X 会话登录的用户也需要类似的变化。

你可以使用 */etc/fbtab* 来更改其他设备或文件的特殊需求下的权限，但这确实很棘手，通常意味着你正在使事情变得比实际需要复杂得多。如果你正在考虑这种方法，重新思考你的问题。

### /etc/firmware

一些硬件需要软件来运行。在过去，这种软件会被加载到设备本身的可编程只读存储器（PROM）芯片上。网络卡通常有引导 PROM，允许它们从网络获取配置信息。如今，PROM 并不昂贵，但制作数百万件东西会迅速累积成本。硬件供应商现在通常要求操作系统为他们将这种称为 *firmware* 的软件加载到硬件上。

固件通常是一个封闭源代码的二进制对象，或称为 *blob*。虽然 OpenBSD 团队成员永远不会接受将 blob 加载到内核中，但他们愿意将文件交给硬件。无论硬件是从操作系统还是从连接到硬件的 PROM 芯片中获取 blob，它仍然是仅在设备上运行的软件，而不是在操作系统中运行的。

为了方便用户，OpenBSD 分发了它合法允许提供的固件。如果 OpenBSD 无法在安装介质上分发固件，`fw_update` 脚本将使用包系统从互联网上获取它。无论固件来自何处，它都存储在 */etc/firmware* 中。

默认情况下，`fw_update` 在 OpenBSD 安装或升级后的第一次启动时运行，但你可以随时运行它（它存储在 */usr/sbin* 中）。

### /etc/fonts/

*/etc/fonts/* 目录包含 Xenocara X11 字体。我们将在 第十七章 中讨论 Xenocara 和 X11。

### /etc/fstab

文件系统表列出了系统所知的所有文件系统，无论它们是在启动时自动挂载还是保留在备用中。有关详细信息，请参阅 第八章。

### /etc/ftpchroot

在通过 FTP 登录时，列出在 */etc/ftpchroot* 中的用户会自动被 `chroot` 到他们的家目录中。有关完整详细信息，请参阅 `ftpd(8)`。

尽量避免使用 FTP，因为它以明文形式传输用户名和密码。请使用 `scp(1)` 或 `sftp(1)` 代替。

### /etc/ftpusers

*/etc/ftpusers* 文件所做的正好与文件名所暗示的相反，但这种情况已经持续了几十年，所以不必担心。

在 */etc/ftpusers* 中列出的任何用户都无法通过 FTP 登录。有关详细信息，请参阅 `ftpd(8)`，但再次强调，请使用 `scp(1)` 或 `sftp(1)` 而不是 FTP，尤其是在执行管理任务时！

### /etc/gettytab

*/etc/gettytab* 文件包含登录终端的配置信息。Unix 类系统传统上可以通过任何东西访问，从无数的略有不同的串行控制台到网络上的安全外壳 (SSH) 会话。如果你需要使用非标准终端类型，请探索 */etc/gettytab*。

没有必要删除此文件。毕竟，可能有人还在使用 1200 波特率的插孔式终端。但也不再有任何理由修改它。无论如何，阅读手册页是值得的，尤其是如果你读到最后一页。

### /etc/group

*/etc/group* 文件控制每个用户账户属于哪个组。用户组在 第六章 和 第七章 中有介绍。

### /etc/hostapd.conf

OpenBSD 可以充当无线接入点。主机接入点守护进程 (`hostapd(8)`) 允许 OpenBSD 执行一些在大型环境中有用的复杂接入点任务。如果你使用无线网络，OpenBSD 的无线服务很有趣；请阅读 `hostapd(8)` 和 `ifconfig(8)` 以获取完整详细信息。

### /etc/hostname.*

*/etc/hostname.* 文件配置网络接口，如 第四章 简要讨论和 第十二章 详细讨论。

### /etc/hosts

*/etc/hosts* 文件包含 IP 地址和主机名的手动维护映射。有关详细信息，请参阅 第十二章。

### /etc/hosts.equiv

*/etc/hosts.equiv* 文件被各种 r 工具使用，例如 `rcp(1)`、`rlogin(1)` 和 `rsh(1)`。这些工具和底层协议是早期时代的遗物，当时互联网的安全性并不是一个如此大的担忧。OpenBSD 已不再包含 `rlogin(1)` 客户端。r 工具在很大程度上被 SSH 取代。今天，在任何合理的情况下，您都不应使用 r 协议。

*/etc/hosts.equiv* 文件不应包含任何未注释的条目，除非您明确地将它们放入其中。这是我唯一可以合理地说每个系统管理员都应该验证为空且标记为不可变的系统文件（请参阅 第十章）。

“合理情况下”和“使用 r 协议”是什么意思？几年前，我在一个网络上工作，该网络有古老的但至关重要的 VMS 服务器，只能通过 r 协议进行管理，但那些情况并不合理。如果您发现自己处于类似的困境中，请查看 `hosts.equiv(5)`、`rshd(8)` 和 `rsh(1)`。并且做些关于您情况的事情。

### /etc/hosts.lpd

您可以将 OpenBSD 系统配置为接受来自其他机器的打印请求并将它们发送到本地连接的打印机。这在打印机体积大、价格昂贵的时候非常重要，但如今已不那么重要。此文件列出了可能使用本地系统行打印机守护进程 `lpd(8)` 的主机名或 IP 地址。

如果您真的想使您的 OpenBSD 系统能够打印，请查看 `lpd(8)` 和 */etc/printcap*。

### /etc/hotplug/

OpenBSD 可以通过 `hotplugd(8)` 在将设备插入系统时自动采取行动。例如，如果您将数码相机连接到 USB 端口，`hotplugd` 可以运行一个脚本，将设备节点附加到目录并使其对您的用户账户可读。

当设备连接时，`hotplugd` 运行 */etc/hotplug/attach* 脚本，当设备被移除时运行 */etc/hotplug/detach* 脚本。这些脚本必须仔细编写，以匹配要连接和断开的设备。有关此工作方式的详细信息，请参阅 `hotplugd(8)`。

### /etc/ifstated.conf

接口状态守护进程 `ifstated(8)` 监控网络条件，并在指定事件发生时采取行动。例如，您可以配置 `ifstated` 以监视另一台服务器崩溃，当该服务器失败时，启动本地 Web 服务器。有关使用 `ifstated` 的更多信息，请参阅 Hansteen 的 *PF 之书*。

### /etc/iked/、/etc/iked.conf、/etc/ipsec.conf 和 /etc/isakmpd

*/etc/iked/*、*/etc/iked.conf*、*/etc/ipsec.conf* 和 */etc/isakmpd* 文件管理 OpenBSD 对 VPN 的 IPsec 标准的实现。OpenBSD 具有非常健壮的 IPsec 实现，并且实际上被各种互操作性小组用于测试。

您可以用 VPN 技术使用的缩写填满整本书，更不用说实际配置它们的说明。有关详细信息，请参阅手册页。

### /etc/inetd.conf

互联网小服务监听器`inetd(8)`连接到多个网络端口，用于不需要持续运行的程序。当其中一个端口的请求到来时，`inetd`激活正确的程序来处理请求。第十六章更详细地讨论了`inetd(8)`。

### /etc/kbdtype

*/etc/kbdtype*文件包含一行，其中包含您首选的终端键盘映射。使用`kdb(1)`测试您的键盘映射，然后将该键盘映射放入*/etc/kbdtype*。

### /etc/kerberosV/

*/etc/kerberosV/*目录包含 Kerberos 集中认证系统的配置。我建议每个网络都采用某种形式的集中登录。正确配置 Kerberos 是一个大主题。如果您感兴趣，请查阅`kerberos(1)`。

### /etc/ksh.kshrc

*/etc/ksh.kshrc*是 OpenBSD 附带公共领域 Korn shell 的全局配置文件。用户必须将其包含在他们的个人*.kshrc*文件中，以便这里的设置生效。有关详细信息，请参阅`ksh(1)`手册页。

### /etc/ldap/ 和 /etc/ldapd.conf

OpenBSD 包括一个轻量级目录访问协议（LDAP）守护进程。LDAP 通常用于集中认证、地址簿和其他读多写少的数据库操作。截至本文撰写时，`ldapd(8)`的功能尚不完整，但它足以提供一个集中的认证点。

### /etc/localtime

*/etc/localtime*文件是实际时区文件的符号链接。要更改时区，请更改符号链接。第四章涵盖了时区。

### /etc/locate.rc

*/etc/locate.rc*文件控制`locate(1)`数据库的创建。OpenBSD 每周更新 locate 数据库，如第十五章所述。

### /etc/login.conf

通过*/etc/login.conf*，您可以控制用户账户登录行为，如第六章所述。

### /etc/lynx.cfg

OpenBSD 包括`lynx(1)`文本模式网页浏览器。Lynx 可以无限配置，*/etc/lynx.cfg*中的设置会影响系统上的所有 Lynx 用户。您可以通过在这里配置代理服务器设置来节省很多麻烦。

### /etc/magic

许多文件包含特定于其类型的“魔数”和其他特征。`file(1)`使用这些魔数来识别文件类型，其中*/etc/magic*是魔数的索引。请不要手动编辑*/etc/magic*，因为它是由编译`file(1)`自动生成的。

### /etc/mail/

*/etc/mail/* 目录包含 OpenBSD 邮件软件的配置文件。OpenBSD 包含两个邮件包：老式的动力马车 Sendmail 和 OpenBSD 创建的 `smptd(8)`。`smptd` 并不完全适合生产使用，但到这本书上架时可能就准备好了。

此目录还包含 */etc/mail/aliases*，这是一个邮件重定向列表。确保你将 root 账户的电子邮件别名设置为你实际会阅读邮件的地方，如 第四章 中所述。

### /etc/mail.rc

*/etc/mail.rc* 文件与作为邮件服务器的发送或接收邮件无关。它是 `mail(1)` 邮件客户端的全局配置文件。虽然更高级的邮件客户端几乎完全取代了 `mail`，但仍有必要对其进行探索，因为几乎任何类 Unix 系统都会安装它。

### /etc/mailer.conf

传统上，任何类 Unix 操作系统可用的唯一邮件服务器程序是 Sendmail。因此，大量附加软件都期望找到 */usr/sbin/sendmail* 并期望它以某种方式运行。尽管按照现代标准，Sendmail 和整个简单邮件传输协议 (SMTP) 都显得复杂而奇特；软件仍然期望找到它。

更糟糕的是，`sendmail(8)` 的行为取决于它被调用的名称。像 `send-mail`、`mailq` 和 `newaliases` 这样的程序都是戴不同帽子的 Sendmail。如果你通过运行 `mailq` 命令来调用 Sendmail 程序，它的运行方式与通过运行 `newaliases` 命令来调用它的方式不同。然而，它们都指向磁盘上的同一二进制文件。第三方软件也期望找到所有这些名称，并且这些命令按要求运行。

Sendmail 是如此的标准，以至于新邮件服务器程序的编写者被迫将它们命名为 `sendmail` 并使它们的行为与 Sendmail 完全一致，以保持与庞大的已安装基础的兼容性。这使得使用替代邮件客户端变得混乱。此外，OpenBSD 将 Sendmail 作为基础系统的一部分。你不能简单地删除 Sendmail 并继续使用。升级会重新安装品牌名称的 Sendmail。

OpenBSD 通过消除 */usr/sbin/sendmail* 作为实际邮件程序来绕过所有这些混乱。相反，`sendmail` 程序只是一个调用实际邮件处理软件的包装器。*/etc/mailer.conf* 中的条目只是经典 Sendmail 程序名称的列表，以及要运行的实际程序的路径。邮件处理程序 `sendmail` 实际上安装为 */usr/libexec/sendmail/sendmail*，例如。

要运行替代邮件服务器，给 */etc/mailer.conf* 提供预期的命令名称和所有适当程序的完整路径。当你从软件包安装新的邮件传输代理时，这会自动发生。

### /etc/man.conf

*etc/man.conf* 文件告诉 `man(1)` 如何查找和显示手册页。如果你在非标准位置安装软件，请将软件的手册页信息添加到 *man.conf* 中，以便你可以透明地调用这些手册页。此文件有几种类型的条目，每种条目都由关键字或部分名称分隔。

你为什么要这样做？如果你必须从除 ports 或 packages 之外的其他来源安装软件，你可以将其放置在 OpenBSD 管理之外的目录树中，以减少升级或添加软件时的混淆。

例如，我偶尔会在 OpenBSD 桌面上安装 Wireshark。OpenBSD 团队决定移除 OpenBSD 的 Wireshark 软件包，因为它有一个如此不稳定的网络安全历史。如果我将 Wireshark 安装为 */usr/local/bin*，它就会与我的软件包混合在一起。然而，如果我将 Wireshark 安装为 */usr/local/wireshark/bin*，它就与软件包明显区分开来。但是，我无法访问手册页，因为 `man(1)` 不认识 */usr/local/wireshark/man*。^([39]) 让我们来看看如何为 Wireshark 添加手册页访问。

#### 添加到搜索索引

`_whatdb` 关键字给出 `whatis(1)` 数据库的完整路径，由 `apropos(1)` 和 `whatis(1)` 使用，允许你轻松搜索和交叉索引手册页。*man.conf* 文件包含 */usr/local/man*、*/usr/share/man* 和 */usr/X11R6/man* 中的数据库条目。以下是添加 */usr/local/wireshark/man* 的条目方法：

```
_whatdb /usr/local/wireshark/man/whatis.db
```

现在我们使用 `makewhatis(8)` 创建一个新的数据库。当你安装软件和每周维护期间，这个任务会自动运行。

#### 添加到手册页目录

手册页散布在系统中的各个目录中。`_default` 关键字告诉 `man(1)` 哪些目录要自动搜索。只使用一个 `_default` 关键字，但如果需要，可以列出多个目录，并使用方括号分组目录。

这里是标准的目录列表：

```
_default /usr/{share, X11R6,local,ports/infrastructure}/man/
```

这是一个相当庞大的目录组，方括号组合了多个关联目录。例如，此条目表示我们将检查 */usr/share/man/*、*/usr/X11R6/man/*、*/usr/local/man/* 和 */usr/local/ports/infrastructure/man/*。（条目以斜杠结尾，这意味着最终目录包含子目录。）

要将 */usr/local/wireshark/man/* 添加到默认位置，请将 `local/wireshark` 添加到关联数组中，如下所示：

```
_default /usr/{share, X11R6,local,ports/infrastructure,local/wireshark}/man/
```

`_subdir` 关键字按顺序列出要搜索的主目录下的子目录，第一个匹配项首先返回。

```
_subdir  man1 man8 man6 man2 man3 man5 man7 man4 man9 man3p man3f mann
```

你可以使用 `_subdir` 来改变手册页返回的顺序。例如，如果你的工作是在 OpenBSD 上编程 Perl，你可能希望默认看到 Perl 的手册页。在这种情况下，你可以将 *man3p* 子目录移到列表的前面。

#### 显示手册页

软件供应商以他们认为最好的格式分发他们的手册。作为系统管理员，这意味着你可能会收到各种格式的手册，因为每种格式都需要不同的命令来显示。幸运的是，每种格式都有不同的文件名后缀，这告诉 `man(1)` 如何显示该文件。`_build` 关键字定义了文件名后缀和用于显示文件的命令。（你不太可能有一个需要新 `_build` 语句的 man 页面。）

#### 定义 Man 部分

最终的 *man.conf* 功能是将手册分为几个部分。我们在 第一章 中看到，你可以通过特定部分搜索手册以获取特定的 man 页面。这些部分不过是 */etc/man.conf* 中标识的目录。这里定义了包含在 1 部分的 man 页面。

```
1 /usr/{share,X11R6,local}/man/man1
```

没有尾部斜杠，因为我们没有添加任何子目录。这些是包含手册第一部分的实际目录。

你可以在 */etc/man.conf* 中定义任意的部分名称。虽然你应该避免以下划线开头以防止与关键字混淆，但你几乎可以做任何事情。

### /etc/master.passwd、/etc/passwd、/etc/spwd.db 和 /etc/pwd.db

*/etc/master.passwd*、*/etc/passwd*、*/etc/spwd.db* 和 */etc/pwd.db* 文件包含用户名和密码，以及一些关于本地定义用户的关键信息。当你登录时，你输入的密码将与该文件中密码的加密和加盐散列进行比较。因此，*/etc/master.passwd* 对系统安全至关重要。

#### 编辑 /etc/master.passwd

如果你正在考虑直接编辑 */etc/master.passwd*，请停止。回到 第六章。重新阅读它。看看是否有其他方法可以实现你想要的变化。破坏 */etc/master.passwd* 可能会阻止人们登录，并可能导致你的系统无法使用。要编辑 */etc/master.passwd* 中的单个用户账户，以 root 身份运行 `chpass(1)`。

如果你必须直接编辑 */etc/master.passwd*——比如说，将每个人的家目录指向新的文件系统——有一个程序正是为此而设计的。程序 `vipw(8)` 会调用 `$EDITOR` 中的文本编辑器，加载密码文件，让你进行更改，并在保存之前检查文件语法。`vipw` 还会更新 */etc/passwd* 以及密码数据库 */etc/pwd.db* 和 */etc/spwd.db*。

请务必确保此文件与密码数据库同步。使用 `vipw` 可以防止许多基本错误并帮助确保数据一致性，但如果你真的想破坏 */etc/master.passwd*，`vipw(8)` 将使你的任务更加困难，但不会阻止你。

话虽如此，只有高级系统管理员应该使用 `vipw`。你如何知道你是否符合条件？如果你已经用 `vipw` 做过足够的糟糕错误，以至于你知道在骨子里不应该使用它，如果你的胃在仅仅想到输入这四个字母时就会翻腾，那么你可以使用 `vipw`。

#### 控制账户信息访问

许多程序需要访问存储在 */etc/master.passwd* 中的部分信息。例如，一个程序必须能够查找用户的 shell 和家目录，以便正确地找到用户的文件。而不是允许任何人读取这个文件及其中的散列密码，OpenBSD（以及大多数其他类 Unix 系统）提供了在 */etc/passwd* 中每个人都需要查看的账户信息。

访问和解析文本文件可能会很慢，尤其是如果计算机有一个慢速处理器和许多用户账户。文本文件并不适合搜索。如果一个程序必须搜索文本文件以查找用户账户编号 10631，搜索可能会阻碍程序的活动，甚至阻止其他程序。检查数据库中的条目要快得多，因为程序可以说“给我账户 10631”，然后从为搜索设计的文件存储中获取响应。

所有类 Unix 系统在账户信息更改时都会从密码文件中创建数据库。由 */etc/passwd* 构建的公共账户信息数据库是 */etc/pwd.db*。包含从 */etc/master.passwd* 构建的私有账户信息的数据库文件是 */etc/spwd.db*。

实际上，很少有软件直接使用密码文件。大多数程序访问 *pwd.db*。我知道有些人删除 */etc/passwd* 而没有不良影响，但你确实需要保留密码数据库。

#### /etc/master.passwd 字段

每个账户都是 */etc/master.passwd* 和 */etc/passwd* 中的一个行。每一行都有以下九个字段，由冒号分隔。

> 用户名
> 
> 此字段包含由系统管理员创建并由人类使用的账户，或者为程序或服务创建的非特权用户。第六章涵盖了用户名。
> 
> 散列和加盐的密码
> 
> 此字段包含用户的密码，经过散列和加盐处理。（它通常被称为散列，但你应该知道它不仅仅是那样。）你不能从散列中推导出密码，但如果你有散列，你可以尝试密码直到找到一个与散列匹配的密码。这就是为什么你必须保护你的 */etc/master.passwd* 文件。在 */etc/passwd* 中，密码字段是空的。

### 注意

一种临时禁用用户账户的简单方法是通过使用 `chpass(1)` 编辑密码文件，并在散列前放置一个星号 (`*`)。虽然账户仍然处于活动状态，但没有人能够登录到它。当客户账单逾期时，我经常使用这种方法。虽然客户可以忽略逾期付款通知，但他们无法访问账户时会很快打电话。我可以轻松地将电话转接到账单部门。一旦问题解决，我可以通过移除星号来重新启用他们的账户。

> 用户 ID 号
> 
> 第三个字段是用户 ID 号，或 UID。每个用户都必须有一个唯一的 UID。
> 
> 组 ID 号
> 
> 此字段是组 ID 号，或 GID。这是用户的主要组，如第六章中所述。通常，这与 UID 相同，并且用户的主要组与用户名同名。一些站点更喜欢为所有非特权用户使用单个组。
> 
> 用户类别
> 
> 我们在第六章中讨论了用户类别。更改类别可以增加或减少用户可以访问的系统资源量。
> 
> 密码过期日期
> 
> 过期日期以自 1970 年 1 月 1 日午夜以来的秒数表示，这是 UNIX 纪元。您可以使用 `date(1)` 将日期转换为秒。如果您必须手动设置密码的过期日期，请使用 `chpass(1)` 并指定一个可读的日期。
> 
> Gecos
> 
> 此字段包含用户的真实姓名、办公室号码、工作电话号码和住宅电话号码，所有这些信息都由逗号分隔。当计算机是大系统且有数百或数千个用户时，这些信息非常重要，并且当他们的进程完全失控时，您可能需要联系他们。今天，这些信息基本上被忽略。（在此处不要使用冒号；冒号专门用于在 */etc/master.passwd* 中分隔字段。）
> 
> 用户家目录
> 
> 此字段是用户的家目录。虽然默认情况下它是一个与用户名相同的目录，但在 */home* 之下，您可以将其移动到任何您喜欢的地方。在密码文件中编辑家目录不会移动实际的目录；您需要自己进行操作。
> 
> 用户 shell
> 
> 最后一个字段给出了用户的 shell。如果此字段为空，则用户将获得无聊的旧 */bin/sh*。

### /etc/mixerctl.conf

OpenBSD 包含强大的音频功能。您可以播放 MP3，混音音乐，或几乎您想做的任何事情。

使用 `mixectl(8)` 控制音频设置，并在 */etc/mixerctl.conf* 中设置引导时的 `mixerctl` 设置。

### /etc/mk.conf

使用 */etc/mk.conf* 配置 `make(1)`。特殊 `make` 设置最常见的使用情况是在构建端口时（在第十三章中介绍）或构建您自己的自定义 OpenBSD 版本时（在第二十章中介绍）。

### /etc/moduli

*/etc/moduli* 文件包含用于 Diffie-Hellman 密码学的质数。永远不要编辑此文件。有些人可能对密码学足够了解，可以编辑 */etc/moduli*，但如果你在读这本书，你很可能不是其中之一.^([40])

### /etc/monthly 和 /etc/monthly.local

如 第十五章 中所述，*/etc/monthly.local* shell 脚本每月运行一次，作为常规系统维护的一部分。讨论了计划内的维护任务。

### /etc/motd

MOTD，或每日消息，在用户登录时显示给用户。在此文件中，您可以放置希望用户注意的系统通知或公告。许多组织在 */etc/motd* 中放置法律通知或可接受使用政策。

注意，*/etc/motd* 的第一行在每次启动时都会被覆盖。请在第 2 行或以下开始您的法律警告。

### /etc/mrouted.conf

除了 `dvmrpd(8)` 之外，OpenBSD 还支持使用 `mrouted(8)` 进行多播路由。`dvmrpd` 实现是首选的，但对于特定的边缘情况，您可能需要 `mrouted`。

在 */etc/mrouted.conf* 中配置 `mrouted`。最终，`mrouted` 将从 OpenBSD 中移除。

### /etc/mtree/

*/etc/mtree/* 目录包含大多数目录的列表，包括它们在标准 OpenBSD 系统中的所有权和权限。系统升级过程使用这些文件。虽然你实际上不需要编辑这些文件，但了解它们的作用是很好的。

### /etc/mygate

如 第十二章 中所述，*/etc/mygate* 脚本提供了 IPv4 和 IPv6 的默认网关地址。

### /etc/myname

如 第四章 中所述，*/etc/myname* 文件包含系统的主机名。

### /etc/netstart

如 第十二章 中所述，*/etc/netstart* 脚本启动网络。

### /etc/networks

*/etc/networks* 是子网及其名称的列表。由于它并不特别有用，因此使用网络数据库已不再流行。

### /etc/newsyslog.conf

如 第十五章 中所述，`newsyslog(8)` 程序会轮换日志文件。

### /etc/nginx/

OpenBSD 已将 `nginx` 网络服务器 (*[`www.nginx.org/`](http://www.nginx.org/)*）作为旧版 Apache 1.3 服务器的替代品导入，但截至本文撰写时，它尚未与系统其他部分完全集成。您可以在该目录中找到 `nginx` 配置文件，服务器相当可用，但还不是官方的 OpenBSD 网络服务器——尚不是。

### /etc/nsd.conf

OpenBSD 已导入名称服务器守护进程 `nsd(8)`，最终将部分替代旧的 DNS 工作马服务器 `named(8)`。它是可用的，但截至本文撰写时，它尚未与系统集成。

### /etc/ntpd.conf

NTP 守护进程将系统时间与网络上的其他机器以及互联网上的机器同步。我们在第十五章中讨论了`ntpd(8)`。

### /etc/ospf6d.conf 和 /etc/ospfd.conf

OSPF 是一种在自治系统内部使用的路由协议。OpenBSD 有两个 OSPF 实现：一个用于 IPv4，一个用于 IPv6。如果您想了解更多关于 OSPF 的信息，请阅读`ospfd(8)`和`ospf6d(8)`。

### /etc/pf.conf 和 /etc/pf.os

在`/etc/pf.conf*`中配置 OpenBSD 的`pf(4)`数据包过滤器。数据包过滤使用`/etc/pf.os*`来识别其他操作系统。第二十一章和第二十二章涵盖了数据包过滤。

### /etc/ppp/

您可以通过拨号调制解调器将 OpenBSD 连接到互联网，这在当今很少见。如果您需要在 OpenBSD 系统上配置调制解调器，请阅读`ppp(8)`手册页。

### /etc/printcap

打印机能力文件描述了本系统可以访问的所有打印机。在 Unix-like 系统中，与随机打印机协同工作长期以来被认为需要某种牺牲，比如月亮处于正确的相位，以及一群穿着长袍的念经僧侣。虽然已经编写了复杂的软件如 CUPS 来简化打印，但配置 OpenBSD 机器以打印到打印服务器或网络 PostScript 打印机相当简单。有关打印的详细信息，请参阅第十六章。

### /etc/protocols

`*/etc/protocols*`文件包含 TCP/IP 网络协议的协议号。第十一章详细介绍了 TCP/IP 版本 4 和 6。

### /etc/rbootd.conf

`rbootd(8)`为 HP 工作站提供引导服务——这是一个非常狭窄的已废弃的无盘客户端子集。OpenBSD 仍然支持需要此服务的 HP300 机器。如果您对现代硬件上的无盘操作感兴趣，请阅读`diskless(8)`手册页，或者查看第二十三章。

### /etc/rc.*

`*/etc/rc.**`文件用于系统引导，这在第五章中详细讨论。

### /etc/relayd.conf

负载均衡器守护进程`relayd(8)`与 OpenBSD 数据包过滤器(PF)系统协同工作，充当网络负载均衡器。然而，`relayd`守护进程需要很好地理解 PF 以及一个非常特定的网络。如果您对负载均衡感兴趣，请阅读 Hansteen 的《PF 之书》。

### /etc/remote

Unix-like 系统广泛支持通过串行线连接到系统，通常用于串行控制台。许多网络设备具有管理串行端口，您可以使用 OpenBSD 作为客户端来配置这些设备。`/etc/remote`文件包含大多数常见现代串行连接的配置（在第五章中介绍）。

### /etc/resolv.conf 和 /etc/resolv.conf.tail

*/etc/resolv.conf*和*/etc/resolv.conf.tail*文件配置了解析器（在第十二章连接到网络中介绍），允许主机将名称映射到 IP 地址，反之亦然。

### /etc/ripd.conf

RIP 是在网络中广播路由指令的旧方法。OpenBSD 有一个 RIP 守护进程`ripd(8)`，配置在*/etc/ripd.conf*中。

RIP 通常被认为是不受欢迎的，就像 r 服务一样。除了其他缺点外，它甚至不支持子网掩码，因此仅限于旧式的 A 类、B 类和 C 类网络。并且与 r 服务一样，有时您可能会陷入使用 RIP，因为您的网络中某些过时的设备无法处理其他任何东西。使用`ripd`来勉强维持，直到您可以安排该设备的悲剧性事故。

### /etc/rmt

远程磁带命令(`rmt`)允许主机访问另一台机器上的磁带驱动器。它最常用于从备份中恢复系统。

### /etc/rpc

RPC 是在远程服务器上执行命令的方法。与 TCP/IP 类似，RPC 也有服务和端口号。文件*/etc/rpc*包含这些服务的列表和端口号。OpenBSD 中最常见的 RPC 消费者是 NFS，如第九章所述。

### /etc/sasyncd.conf

OpenBSD 支持在 IPsec 网关之间进行故障转移，使用安全关联同步守护进程`sasyncd(8)`。这不是操作系统中的常见功能，其存在是 OpenBSD 的一个亮点。要了解 IPsec 故障转移，请阅读`sasyncd(8)`。

### /etc/sensorsd.conf

现代硬件具有检测风扇速度、电路电压、温度等项目传感器的功能。OpenBSD 的`sensord(8)`读取这些传感器并将信息呈现给用户。在*/etc/sensorsd.conf*中配置您想关注的传感器，以及当传感器检测到某些内容时您想执行的操作。有关`sensorsd`的详细信息，请参阅第十五章。

### /etc/services

*/etc/services*文件包含网络服务和它们相关的 TCP/IP 端口的列表。有关详细信息，请参阅第十一章。

### /etc/shells

*/etc/shells*文件包含合法用户 shell 的列表，如第六章所述。

### /etc/skel/

*/etc/skel/*目录包含标准用户环境配置文件。当您创建用户帐户时，`adduser(8)`会将此目录中的文件复制到新用户的主目录。在您升级系统时，此目录可以被覆盖。

如果您需要为您的用户自定义这些文件，请创建一个自定义点文件目录，并告诉`adduser(8)`使用它。

### /etc/sliphome/

串行线路互联网协议（SLIP）在通常用于拨号线的点对点协议（PPP）之前出现。OpenBSD 仍然支持它，因为可能有人需要它，而且没有真正的原因要丢弃它。

### /etc/snmpd.conf

简单网络管理协议 (SNMP) 是一种通过网络访问设备信息的方法。不幸的是，它不是一个非常安全的协议（SNMP 的一个常见缩写是“安全？不是我的问题！”）OpenBSD 团队编写了一个更安全的 SNMP 守护进程 `snmpd(8)`。在 */etc/snmpd.conf* 中配置它，如 第十六章 中所述。

虽然 OpenBSD 的 SNMP 守护进程可能抵制入侵和滥用，但它无法改变 SNMP 本身（通常部署的 SNMP）并不十分安全的事实。

### /etc/ssh/

SSH 守护进程 `sshd(8)` 提供了 `telnet(1)` 和 r-协议的安全替代方案。第十六章 包含了关于 SSH 的简要讨论。

### /etc/ssl/

*/etc/ssl/* 目录用于安全套接字层 (SSL) 证书，以及 OpenSSL 配置文件 *openssl.cnf*。在这里存储系统 SSL 证书。

### /etc/sudoers

*/etc/sudoers* 文件控制 `sudo(1)` 配置。有关 `sudo` 的详细信息，请参阅 第七章。

### /etc/sysctl.conf

在 */etc/sysctl.conf* 中设置内核运行时可调整选项。Sysctls 在 第十八章 中介绍。

### /etc/syslog.conf

记录守护进程 `syslogd(8)` 从程序和主机读取消息，然后根据 */etc/syslog.conf* 中的配置将这些消息分离成记录。有关 `syslogd` 的详细信息，请参阅 第十五章。

### /etc/systrace/

`systrace(4)` 系统调用包装器提供了对系统调用的访问控制。您可以在 `systrace(1)` 之下运行二进制文件，如果程序尝试访问应用程序 `systrace` 策略中未允许的任何系统调用，`systrace` 将阻止访问。

然而，在 `systrace` 中发现了缺陷，使其效果不佳，现在它被认为只是一种部分解决方案。它仍然与 OpenBSD 一起提供，但使用它被劝阻。今天，`systrace` 主要用于打包构建集群，以确保构建的软件不会联系远程服务器或写入虚假安装根目录之外。

如果您需要使用 `systrace`，请将策略存储在 */etc/systrace* 中。

### /etc/termcap

*/etc/termcap* 文件描述了 OpenBSD 支持的所有不同终端。现在几乎每个控制台设备都支持标准的 VT220 终端。

### /etc/ttys

在 */etc/ttys* 中配置系统终端。您可以在其中启用、禁用和更改终端。一个“终端”可以是连接到计算机的键盘和显示器，也可以是通过串行线登录，如串行控制台，或者是一个虚拟终端，如 telnet 或 SSH 所使用的终端。

经典的 UNIX 终端设备类似于电传打字机；这就是 *tty* 标签的由来。所有各种 UNIX 架构细节都源自这一历史事件，Unix-like 系统继承了它们。

#### 终端类型

*/etc/ttys* 列出了三种不同的终端类型：控制台、串行端口和伪终端。

控制台是显示引导消息的地方，也是可以执行单用户模式维护的地方，以及错误消息显示的地方。虽然控制台通常是连接到计算机的键盘、显示器和鼠标，但它不必总是这样。这里的“控制台”是一个抽象概念，通常指向你的物理显示器和键盘。例如，你也可以将控制台指向一个串行端口。控制台使用设备 */dev/console*。

在某些平台（包括 i386 和 amd64）上，OpenBSD 支持多个虚拟控制台连接到你的物理控制台。如果你在物理键盘上按下 CTRL-ALT-F2，你会看到一个全新的登录屏幕。按下 CTRL-ALT-F1 将返回主控制台。你可以拥有与功能键一样多的虚拟控制台，但 OpenBSD 默认有五个。这些虚拟控制台的设备名称以 */dev/ttyC* 开头，以十六进制数字结尾。

串行端口可以用作登录设备，一旦你连接了一个老式的串行终端或 null-modem 电缆以及另一个带有串行端口的设备。它们也可以用于出站串行连接。用作入站设备的串行端口以 */dev/tty* 开头，而出站连接的端口以 */dev/cua* 开头，两者都以十六进制数字结尾。每个串行端口可以连接一个终端。

伪终端支持网络连接。尽管你的远程 SSH 窗口在服务器上没有相应的物理硬件，但 OpenBSD 以某种方式将其视为 `tty` 设备。伪终端的设备名称以 */dev/tty* 开头，一个字母 `p` 到 `z`（小写或大写），以单个字母或数字结尾。当用户通过网络连接（如通过 SSH）时，登录会话被分配一个这些虚拟终端设备之一。

无论终端类型是什么，都使用以下程序在 */etc/ttys* 中进行配置。

#### 配置终端

每个终端都有一个 */etc/ttys* 条目，包含至少三个条目，可能最多五个。

```
ttyC0 /usr/libexec/getty std.9600 vt220 on secure
```

第一个条目是设备名称，不带前缀 */dev*。

第二个条目是启动终端登录请求的程序名称。物理终端和虚拟控制台使用 `getty(8)`，而伪终端通过用户登录的任何守护进程处理登录请求。

第三个条目是终端类型。OpenBSD 在显示器和虚拟控制台上使用 `vt220` 终端。串行控制台使用 `unknown` 终端类型，因为没有方法预先知道终端另一端是什么类型的硬件。（如果你使用的是一个相对现代的串行客户端，你可以将其切换为 `vt220` 而不会出现问题。）伪终端使用 `network` 终端类型；服务器守护进程和客户端软件确定终端的功能。

第四字段确定终端是否可用于登录。将其设置为 `on` 以接受登录请求，或设置为 `off` 以拒绝它们。伪终端按需激活，因此你不需要在 */etc/ttys* 中配置它们。

根账户只能登录到安全的控制台。物理终端和控制台是默认定义为安全的唯一设备。你可以以普通用户身份登录并使用 `su(1)` 或 `sudo(1)` 在不安全的终端上；你只能不能直接以 `root` 身份登录。这意味着任何拥有根密码并且对机器有物理访问权限的人都可以直接走到键盘前以 root 身份登录。要禁止直接登录到 root，请从 */etc/ttys* 中的虚拟控制台条目中删除 `secure` 关键字。此外，在安全终端上，当你以单用户模式启动时，不会要求你输入根密码。

如果你使用串行控制台，你可能想通过串行电缆登录到正在运行的多用户系统。默认情况下，你无法在串行线上登录。将串行控制台上的串行线设置为 `on`，你就可以登录了。这使得串行线的行为与在物理控制台上的行为非常相似，在那里你可以以多用户模式工作，同时机器正常运行。

虽然所有默认设置都使用 `getty(8)`，但也有一些替代方案。例如，HylaFAX 软件包允许你将传真机连接到串行线，但你需要重新配置终端以支持它。

```
tty0e   "/usr/local/sbin/faxgetty"      dialup  on
```

重点是，一旦你为这项工作找到了合适的软件工具，你就可以按你喜欢的方式使用串行端口。

#### 使 */etc/ttys* 的更改生效

提供终端是一个由 `init(8)` 直接处理的低级系统任务。对 */etc/ttys* 的更改不会生效，直到你告诉 `init` 重新读取其配置。（`init` 总是进程 ID 1。）

```
# kill -HUP 1
```

如果你没有告诉 `init` 重新读取其配置，更改将不会生效，直到你重新启动。

### /etc/weekly 和 /etc/weekly.local

*/etc/weekly.local* 脚本每周运行一次，以执行每周维护，如 第十五章 中所述。

### /etc/wsconsctl.conf

OpenBSD 通过 `wscons(4)` 驱动程序提供了对物理控制台的硬件无关访问。通过 `wsconsctl(8)` 配置此控制台。启动时的 `wsconsctl` 设置是从 */etc/wsconsctl.conf* 中读取的。有关控制台配置的详细信息，请参阅 第十七章。

### /etc/X11

*/etc/X11* 目录包含 X Window 系统的配置。OpenBSD 的 Xenocara 将 X 与基本系统集成。第十七章 讨论了桌面 OpenBSD，包括一些 X 功能。

### /etc/ypldap.conf

除了 LDAP 守护进程 `ldapd(8)`，OpenBSD 还支持 YP 数据库以集中管理密码、组和主机文件系统。YP 与 Sun 的原始网络信息系统 (NIS) 兼容。OpenBSD 使用 YP 作为 LDAP 认证的网关。如果你对这个功能感兴趣，请参阅 `yp(8)` 和 `ypldap(8)`。

这将带你了解 */etc* 中其他地方未涵盖的所有内容。在下一章中，我们将讨论 OpenBSD 如何维护自身，以及你如何可以干预维护过程。

* * *

^([39]) 如果 Wireshark 有一个不稳定的网络安全历史，我为什么还要安装它？因为，遗憾的是，它仍然是调试真正复杂的网络问题最简单的方法，尤其是在你处理不熟悉的协议时。

^([40]) Henning Brauer，OpenBSD 开发者和数据包过滤的负责人评论说，“我对加密算法有一定的了解。…但我也不乱动模数。”请自行注意。
