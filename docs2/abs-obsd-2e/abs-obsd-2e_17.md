## 第十七章. OpenBSD 桌面

*与夏日的阳光相伴*

*将 Blowfish 放在指尖上：*

*没有密码被盗！*

![图片](img/httpatomoreillycomsourcenostarchimages1616079.png) OpenBSD 最著名的作为服务器操作系统，但它可以是一个非常有效且强大的桌面系统。X Window 系统是类 Unix 操作系统的标准图形桌面软件，OpenBSD 包括使用它的工具。由于本书假设你有一些 Unix 经验，所以不会涵盖所有使 X Windows 舒适的应用程序。你需要进行实验以找到你偏好的邮件客户端、网络浏览器和文本编辑器——其中大多数都不是 OpenBSD 特定的。相反，本章涵盖了 OpenBSD 特有的、起源于 OpenBSD 或需要特定配置的项目。

OpenBSD 包括 Xenocara 框架，用于修改和构建与 OpenBSD 紧密集成的 X.Org。我们将讨论使用 `cwm` 桌面环境将 OpenBSD 引导到图形桌面，以及使用 `tmux` 终端多路复用器的文本控制台。但我们将从自定义控制台开始。

## 使用 wscons 配置你的控制台

`wscons(4)` 硬件无关的控制台驱动程序让你以许多方式配置你无聊的、黑白、非图形化的控制台。

首先，使用 `wsconsctl(8)` 查看当前的控制台设置。在文本控制台而不是 X 会话中运行以下命令（在 `wscons` 中所做的更改可以应用到 X 会话中，但一旦启动 X，你基本上就只能够使用 X 的配置系统）。

```
$ **wsconsctl**
keyboard.type=pc-xt
keyboard.bell.pitch=400
keyboard.bell.period=100
keyboard.bell.volume=50
…
```

每行包含一个系统变量和一个设置，其中许多你可以更改。`keyboard.type` 变量代表系统上的键盘类型。由于这是一个 amd64 系统，它使用与消费级电脑通用的 `pc-xt` 键盘，但你将看到不同硬件有不同的键盘类型。

你也可以使用 `wsconsctl` 来更改这些设置。例如，在上一个列表中，变量 `keyboard.bell.volume` 设置了电脑蜂鸣声的音量。现在，我是一个 `tcsh` 用户，我经常使用 Tab 补全（输入一个或两个字符，按 TAB 键，shell 会填充你即将输入的命令或文件名）。不幸的是，当 Tab 补全遇到模糊的地方时，它会停止。当我通过 SSH 登录时，这并不是问题，因为我可以只输入一个或两个字符然后再次按 TAB 键。但当我使用本地控制台时，每个模糊的地方都会伴随着电脑的蜂鸣声（或铃声）。当我试图解决问题，而铃声响起，大声喊叫“*哔* 错误！ *哔* 错误！ *哔* 错误！”时，我只有一个想法：

蜂鸣声必须消失。

```
$ **wsconsctl keyboard.bell.volume=0**
keyboard.bell.volume=0
```

现在，寂静无声，我可以不用电脑的打扰来解决问题。（如果你是受虐狂，可以选择提高音量。我不会评判你——至少不会在公共场合。）

在这里，我们将探讨一些你可以用 `wscons` 做的其他事情。

### 屏幕清除

如果您让系统闲置几分钟，屏幕应该变黑以减少功耗。现代显示器通常会自动执行此操作，但您也可以在操作系统中配置此行为，尤其是在较旧的平台上。OpenBSD 仅在知道如何重新激活显示器后才会关闭显示。

您有三个选择：

+   ****`display.kbdact`****. 通过键盘活动唤醒

+   ****`display.msact`****. 通过鼠标活动唤醒

+   ****`display.outact`****. 通过显示器输出唤醒

将这些 `wscons` 变量之一设置为 `on`，OpenBSD 将意识到它应该在闲置超时后开始关闭显示器。变量 `display.screen_off` 给出了闲置超时的时间（以毫秒为单位）；默认值 `600000` 是 10 分钟。

您还可以选择将屏幕变黑或将显示器置于“省电”模式，也称为 *睡眠*。显示黑色屏幕的显示器在触发时会立即重新激活，但会消耗更多电力。睡眠状态的显示器实际上是关闭的，需要几秒钟才能重新激活。要设置省电模式，将变量 `display.vblank` 更改为 `on`。（一些旧显示器不相信省电，因此在这些显示器上此功能可能不起作用。）

### 在启动时设置 wscons 变量

用户可以调整控制台设置，但这些设置将在下一次重启时消失。要在启动时设置 `wscons` 变量，请将它们添加到 */etc/wsconsctl.conf*。启动过程会读取此文件，并将找到的任何变量应用到控制台。

## 使用 tmux 运行虚拟终端

终端复用器 `tmux(1)` 允许您在一个 OpenBSD 终端窗口内运行多个虚拟终端。当您从系统中断开连接时，标准虚拟终端会消失，但 `tmux` 虚拟终端即使在断开连接后也会继续运行。`tmux` 软件小巧、快速、易于使用，并且与 OpenBSD 的其他部分一样经过精心编写。

为什么你需要 `tmux`？一个例子是构建程序。在我离开办公室之前，我使用我的笔记本电脑通过 SSH 连接到一个 OpenBSD 服务器，创建一个虚拟终端，开始构建一个大型程序（例如 OpenOffice.org），然后关闭我的笔记本电脑。通常情况下，当我的会话被中断时，服务器上的构建会终止，但 `tmux` 虚拟终端即使在注销后也会继续运行。在断开连接的虚拟终端中，构建会在我开车回家的过程中继续，当我稍后重新连接时，我可以看到构建的进度。虚拟终端会话甚至可以存活于由网络或客户端故障引起的意外断开。

本节提供了对 `tmux` 的介绍。有关此处讨论的功能的完整详细信息，以及数十个其他功能，请阅读 `tmux(1)`。

### tmux 状态栏和窗口名称

要启动虚拟终端会话，请运行 `tmux`。您的终端窗口将显示命令提示符和底部的绿色 `tmux` 状态栏，其中包含如下信息：

```
[0] 0:ksh*        "caddis.blackhelicop" 11:55  26-Jun-13
```

这是一个虚拟终端会话。状态栏的左侧显示 `tmux` 会话编号（括号内 `[0]`）和 `tmux` 窗口的列表 `0:ksh*`（从窗口编号 0 开始）。右侧显示你的机器名称的前部分 (`caddis.blackhelicopters.org`)，后面跟着时间和日期。你将在设置 tmux 选项和配置 tmux 中学习如何自定义这些设置。

窗口名称默认为在该 `tmux(1)` 窗口中运行的程序的名称。例如，如果你启动一个持续到中断的命令，例如 `iostat -w 5`，会话名称将更改为匹配该命令。中断该命令，返回到 shell 提示符，状态栏应该更改其名称以匹配你的 shell。

状态栏通常是绿色的，但如果它变成黄色，`tmux` 正在等待输入。当它是黄色时，任何输入都被解释为 `tmux` 命令。如果你意外进入此模式，请按 ENTER 返回到绿色状态栏和正常操作。

### tmux 命令和窗口管理

按下 CTRL-B 告诉 `tmux` 下一个命令是为 `tmux` 而非虚拟终端中运行的程序。 (如果按下 CTRL-B 会干扰你经常使用的另一个程序，你可以更改这个键组合，如你在取消映射和重新映射键中看到的。)

最常用的 `tmux` 命令是单个字符。例如，要在本 `tmux` 会话中创建第二个终端窗口，请按 CTRL-B-C。你的屏幕将只显示一个命令提示符和一个新的状态栏。

```
[0] 0:iostat-  1:ksh*          "caddis.blackhelicopte" 11:58 26-Jun-13
```

你有两个窗口：窗口 0 显示 `iostat` 输出，窗口 1 显示 `ksh` 提示符。窗口 1 旁边的星号表示你当前正在查看它。在你的新窗口中运行一个持续命令，例如 `top`，窗口名称应该会自动更改为该命令的名称。

#### 更改当前窗口

要查看另一个窗口，使用以下任一键组合：

+   要查看下一个窗口，请按 CTRL-B-N。

+   要切换到上一个窗口，请按 CTRL-B-P。

### 注意

请记住，窗口顺序是循环的。例如，如果你在最后一个窗口上，按下 CTRL-B-N，你应该看到第一个窗口。

+   要通过编号直接跳转到窗口，请按 CTRL-B 然后按窗口编号。

+   要打开所有窗口的菜单，请按 CTRL-B-W，然后使用箭头键选择一个窗口。

我发现前后顺序足够了，但如果你在一个终端中打开了一打窗口，你可能会有不同的看法。

#### 重命名窗口

终端窗口的名称与当前运行的程序名称相同，但这并不总是有用的。例如，如果我用 `make build` 编译最新源代码，窗口名称将不断更改以反映当时构建中运行的命令。唯一的问题是，我状态栏中不断闪烁的更改让我头疼。

如果您不想在每次命令执行时看到窗口名称更改，请使用 CTRL-B 为窗口分配一个静态名称。状态栏中会出现一个黄色的 `[rename-window]` 提示。输入您首选的窗口名称，例如 `upgrade`，然后按 ENTER。

#### 终止窗口

要关闭一个窗口并结束其中运行的任何进程，切换到该窗口并按 CTRL-B-&。您将收到一个确认提示。

### 获取在线帮助

按 CTRL-B-? 以查看所有 `tmux` 命令的完整列表。

```
  C-b: send-prefix
  C-o: rotate-window
  C-z: suspend-client
 Space: next-layout
   !: break-pane
   ": split-window
   #: list-buffers
…
```

现在，您可以在不阅读手册页的情况下轻松探索 `tmux`。您将使用此列表在取消映射和重新映射键中重新映射键。

### 断开连接、重新连接和管理会话

一组 `tmux` 窗口称为 *会话*。方便的是，`tmux` 可以在不中断其窗口的情况下断开与运行会话的连接。按 CTRL-B-D 断开您的终端与当前 `tmux` 会话的连接。您的终端现在应显示在启动 `tmux` 之前所持有的内容。要重新连接到您的 `tmux` 会话，运行 `tmux attach`。

您可以同时拥有多个 `tmux` 会话。会话编号显示在状态栏的最左侧。（在我们的示例状态栏中，`tmux` 会话是 0。）

要在不连接到您之前的会话的情况下启动一个新的 `tmux` 会话，请不带任何参数运行 `tmux`。例如，当我想从上次离开的地方继续时，我输入 `tmux` 而不是 `tmux attach` 以创建一个新的 `tmux` 会话。您可以在 `tmux` 内部更改您的 `tmux` 会话，使用 `tmux` 命令，但通常我只是结束会话并输入正确的命令。

如果您拥有所有这些 `tmux` 会话，您如何确保您没有留下旧的、无用的会话，其中运行着被遗弃的命令？使用 `tmux list-sessions`。

```
$ **tmux list-sessions**
0: 4 windows (created Sun Feb 13 12:17:14 2011) [80x23]
2: 1 windows (created Mon Feb 21 21:57:59 2011) [131x36] (attached)
```

我可以从输出中的最后一行看到，我在我的另一个工作站上留下了会话 2 运行，并且我仍然连接到它。

要连接到会话 2，使用 `attach-session` 并使用选项 `-t` 选择目标会话。在这里，我连接到 `tmux` 会话 2：

```
$ **tmux attach-session -t 2**
```

我现在从两个不同的 SSH 会话连接到同一个会话——在这种情况下，从两个不同的客户端工作站。我在一个屏幕上的输入会在另一个屏幕上回显。

要销毁一个会话，使用 `kill-session` 命令，并使用 `-t` 指定会话编号。在这里，我销毁 `tmux` 会话 2：

```
$ **tmux kill-session -t 2**
```

在 `tmux` 会话 2 中的窗口中运行的任何程序也将被终止。

### 使用 `tmux` 命令

`tmux` 的命令模式提供了一个提示，用于输入更复杂的命令。要进入命令模式，请按 CTRL-B-:. 状态栏将变为黄色，所有窗口名称将被单个冒号替换。例如，要创建一个专门运行 `systat(1)` 的新窗口，请按 CTRL-B-: 并输入 **`neww systat`**。将出现一个名为 `systat` 的窗口。切换到该窗口，然后按 CTRL-C 停止 `systat`。该窗口将消失。

您可以使用 `tmux` 命令执行各种操作，包括将窗口分割成多个面板、复制粘贴文本等。（阅读 `tmux(1)` 获取完整列表。）如果您想从一个窗口复制粘贴到另一个窗口，使用多个终端窗口是最简单的，但如果您在一个仅文本的控制台或其他受限环境中工作，您可能会发现这些 `tmux` 功能很有用。

`tmux` 命令模式最常用于设置选项。

### 设置 `tmux` 选项

选项会改变 `tmux` 窗口、会话以及 `tmux` 服务器本身的行为。最常见的更改涉及窗口的外观、颜色或状态栏中显示的项目。一些选项影响整个 `tmux` 会话；其他选项仅影响特定窗口。您可以使用 `tmux` 命令 `set-option` 在线更改选项。

继续打开一个 `tmux` 会话以跟随。按 CTRL-B-: 进入命令模式。当出现冒号时，输入 **`set-option status-fg green`**，然后按 ENTER。您的状态栏现在应该是一个实心的绿色条。恭喜！您已将状态栏文本颜色设置为与背景颜色相同，使其难以阅读。返回命令模式，并将颜色更改为黑色以使其可读。（如果您觉得这很烦人，您可以终止此 `tmux` 会话并启动一个新的会话以重置所有选项。）

在进行更改时，使用 **`set-option`**（或仅 `set`）来设置影响 `tmux` 服务器和整个会话的选项。使用 **`set-window-option`**（缩写为 `setw`）来设置仅影响单个窗口的选项。

大多数人可能不需要很多（如果有的话）`tmux` 选项，但它们可能很有用。例如，假设您想状态栏时钟以 24 小时格式显示时间，或者您想使用视觉铃声而不是蜂鸣声。选项让您控制这些行为，以及在状态栏中运行命令。要更改基本的 `tmux` 外观和行为，请参阅 `tmux(1)` 中的选项。

一定要交互式地尝试任何有趣的选项。一旦您有一个按您喜欢的样子运行的 `tmux` 会话，输入 **`show-options`** 以获取当前选项的准确列表。复制该列表，因为我们将会使用它来构建配置文件。

### 配置 `tmux`

在您的家目录中修改 *$HOME/.tmux.conf* 以配置您的 `tmux` 会话，或者使用 */etc/tmux.conf* 将您的 `tmux` 偏好应用于每个系统用户。个人 `tmux` 配置覆盖全局设置。

作为简单的例子，我已经将我的状态栏的左侧（包含会话编号）设置为蓝色，右侧（主机名、时间和日期）设置为红色。如果我喜欢这个设置，我可以通过在 *tmux.conf* 中输入以下内容来使此更改永久化：

```
set -g status-left-bg blue
set -g status-right-bg red
```

`-g` 标志设置全局选项，因此它对所有会话和窗口都生效。

这应该会使您熟悉使用 `tmux`。如果您需要同时使用多个终端窗口，请使用图形桌面。请继续关注。

## 设置 X

OpenBSD 开发者修改了由 X.Org 提供的行业标准 X 图形界面，以更好地适应 OpenBSD。X.Org 和 OpenBSD 特定补丁的组合称为 Xenocara。

在大多数情况下，Xenocara 与 X.Org 完全一样，X.Org 文档适用于 OpenBSD。Xenocara 的大部分是为了安全和方便开发人员构建 X，但也有一些新增功能。在我看来，OpenBSD 对 X.Org 的最佳改进是 `cwm(1)` 窗口管理器。在这里，我们将介绍配置和启动 X。下一节将提供有关使用窗口管理器的详细信息。

### 配置 X

配置 X 可能很简单或很痛苦，这取决于您的硬件。

大多数显卡需要特殊访问系统内存，尽管一些新的英特尔显卡可以在不进行此访问的情况下工作。对于其他显卡，您必须在 */etc/sysctl.conf* 中调整 `machdep.allowaperture=2` sysctl，并重新启动。

大多数 amd64 和 i386 系统需要将 `machdep.allowaperture` 设置为 `2`，但其他平台可能需要 `1` 或 `2`。如果没有此 sysctl 设置，内核将不允许 X 与显卡通信。如果您不确定，尝试在不更改 sysctl 的情况下使用 X，当您发现您的硬件太旧或型号不正确而无法以这种方式工作，将其设置为 `2`。

重新启动后，通过运行 `startx` 查看是否可以自动设置您的图形界面。如果它工作正常，您应该看到 `fvwm(1)` 桌面和非常单调的灰色背景以及几个终端窗口。

### 注意

如果 X 无法启动，请参阅 OpenBSD FAQ、X.Org 文档和 */var/log/Xorg.0.log*。X 的自动配置可能会出现许多问题。阅读您的错误日志并在互联网上搜索解决方案。

一旦您知道 X 可以正常工作，您就需要决定您是否希望在每次需要时手动启动 X，或者您是否希望 OpenBSD 自动启动到 X。

### 手动启动 X

在登录到文本控制台后，运行 `startx(1)`。此命令将启动 *$HOME/.xinitrc* 中的命令并启动 X。

### 启动到 X

OpenBSD 包含一个 */etc/rc.conf* 钩子，在启动时使用登录提示启动 X 显示管理器 `xdm(1)`，但默认情况下不使用 `xdm`。以下是您要添加到 *rc.conf.local* 中的行，以便在启动时无任何标志启动 X：

```
xdm_flags=""
```

启动后，控制台将显示图形登录提示。一旦用户登录，`xdm` 将运行 *$HOME/.xsession* 中的任何命令。

### 注意

因为这是一本关于使用 OpenBSD 作为桌面的章节，所以我假设你正在使用 `xdm(1)`。示例参考 *$HOME/.xsession*。如果你使用 `startx(1)` 代替，请替换为 *.xinitrc*。

### 模拟三按钮鼠标

许多 X 软件都期望你有一个带有三个或更多按钮的鼠标，但许多只有两个按钮。Xenocara 允许你假装你有第三个鼠标按钮，当你同时按下两个鼠标按钮时，它将解释为按下不存在的第三个按钮。

当然，最好的解决方案是购买一个带有三个或更多按钮的真正鼠标。它们比以前更容易获得。

现在你已经准备好了 X，让我们探索我之前提到的 `cwm` 窗口管理器。

## 使用 cwm 窗口管理器

虽然 X 为图形界面提供了操作系统支持，但该界面的管理则由窗口管理器负责。OpenBSD 为按钮密集型、点按式的窗口管理器提供了软件包，如 KDE、Gnome 和 Xfce。这些窗口管理器可能为消费者友好的操作系统和 OpenBSD 之间提供一个舒适的桥梁，但它们并不是为更核心的 Unix 用户设计的。

Xenocara 包含三个窗口管理器：自上个千年以来与 X 一起发货的经典 `fvwm(1)` 和 `twm(1)` 窗口管理器，以及 OpenBSD 特有的 `cwm(1)`。OpenBSD 开发者专门编写 `cwm` 以作为现代、快速、键盘友好的界面。

要在登录时启动 `cwm`，在 *$HOME/.xsession* 中调用它：

```
/usr/X11R6/bin/cwm
```

当你的 `cwm` 会话结束时，`xdm` 会将你返回到登录屏幕。

### 配置 cwm

与使用鼠标驱动的配置菜单不同，`cwm` 使用单个配置文件，*$HOME/.cwmrc*。你可以在 `cwmrc(5)` 中阅读完整的文档。在这里，当我讨论各种 `cwm` 功能时，我会提到如何在 *.cwmrc* 中配置或更改每个功能。

#### 修饰键

大多数 `cwm` 操作都需要你按下可配置的键组合。例如，CTRL-ALT-DEL 锁定屏幕。`cwm` 文档列出了 表 17-1 中显示的修饰键。

表 17-1. 表 17-1: cwm 修饰键

| 符号 | 键 |
| --- | --- |
| C | CTRL |
| S | SHIFT |
| M | META/ALT |

例如，*.cwmrc* 中的 `CS-r` 表示 CTRL-SHIFT-R。`CM-W` 代表 CTRL-ALT-W。

#### 选择新的窗口管理器

默认的 `cwm` 配置允许你在系统上的任何命令中使用 CTRL-ALT-W 选择新的窗口管理器。输入 **`cwm`**，`cwm` 应该重新启动而不会丢失任何窗口。

### 注意

你也可以输入一个不是窗口管理器的命令，例如 `grep`。如果你这样做，OpenBSD 会静默地注销你。它不会说，“在我伤害你之前，请远离键盘。”不威胁你被认为是 OpenBSD 的用户友好。

#### 将键序列绑定到命令

你还可以将一个键序列绑定到 `cwmrc(5)` 中列出的任何 `cwm` 命令。例如，假设你想要使用键序列 CTRL-ALT-R 来删除你的当前窗口。将以下内容添加到 `*.cwmrc*`：

```
bind CM-r		delete
```

只有当你使用 CTRL-ALT-W 重新启动 `cwm` 或注销并重新登录时，更改才会生效。在你做了其中之一之后，使用 CTRL-ALT-R 删除当前窗口。

### 警告

如果你在一个 `*.cwmrc*` 文件中添加了 `cwm` 无法解析的条目，`cwm` 将不会处理配置文件，并且当你加载配置文件时，你将丢失所有的自定义 `cwm` 设置。如果你的自定义设置消失了，那么你在 `*.cwmrc*` 中的最新更改是错误的。如果你犯了一个 `cwm` 能够解析的错误，`cwm` 将会接受它。在这种情况下，除了用户之外没有人会遇到麻烦。

### 创建 cwm 窗口

当你在运行图形桌面时，屏幕上的所有内容都是一个 *窗口*。终端、网页浏览器和游戏都在窗口中运行。管理窗口——提升、隐藏、调整大小、命名等——是窗口管理器的核心任务。

默认的 `cwm` 会话从一个朴素的灰色屏幕和一个小型的 `xconsole(1)` 窗口开始。使用 CTRL-SHIFT-ENTER 创建一个新的终端窗口。窗口管理器应该聚焦于鼠标所在的任何窗口。（按 SHIFT-+ 增加终端窗口的字体大小。）

如果你反复按 CTRL-SHIFT-ENTER，你将看不到额外的终端窗口。哦，新窗口将会被创建，但会堆叠在一起。按 ALT 和左鼠标按钮移动当前活动窗口，你应该会露出下面的另一个终端窗口。

我觉得默认的终端大小太小了；我想要更宽的终端和更多的行数。要调整终端窗口的大小，按 ALT 和鼠标中键（或同时按两个按钮）。鼠标将会移动到窗口的右下角并变成一个右角符号。只要你按住鼠标按钮，窗口就会继续调整大小。

要垂直最大化窗口，按 CTRL-ALT-等号（=）。要水平最大化窗口，按 CTRL-ALT-SHIFT-等号（=）。要销毁一个窗口，将其聚焦并按 CTRL-ALT-X。你不会收到确认你的决定的提示；`cwm` 将会立即遵守并销毁窗口。

要退出 `cwm` 并返回登录屏幕，按 CTRL-ALT-Q。

### 管理窗口

现在你已经可以创建窗口了，让我们看看如何管理它们。

首先，使用 ALT-TAB 在可见窗口之间切换。新激活的窗口应该上升到前台。

要给一个窗口命名，按 CTRL-ALT-N 以访问标签提示，然后输入窗口期望的名称。当选择隐藏窗口而不销毁它时，名称很有用。

要隐藏一个窗口，先将其聚焦，然后按 ALT-ENTER 使其消失。按 ALT-TAB 不会将其恢复，因为它已被隐藏。按鼠标左键以获取所有隐藏窗口的列表，按名称排列。你没有命名的窗口将显示为程序名称。所有终端都显示为`xterm`。点击名称以取消隐藏窗口。

### 注意

给具有特定目的的窗口命名是个好主意，例如一个长时间运行的软件构建。这样，当它不再有趣时，你可以最小化窗口，并在需要时快速找到它。我根据连接的服务器命名由 SSH 会话创建的窗口。

你可以通过名称搜索窗口。按 CTRL-ALT-/以获取`window>>`提示，然后开始输入窗口的名称。`cwm`将列出所有匹配的窗口。隐藏窗口在其名称前有一个`&`符号。感叹号表示具有焦点的窗口。

### 锁定屏幕

不要在没有锁定的情况下离开一个正在运行的工作站，尤其是如果你登录到敏感系统或作为 root 用户。按 CTRL-ALT-DEL 锁定你的桌面，屏幕将变黑。按另一个键，`cwm`将请求你的密码以解锁工作站。

默认的屏幕保护程序是一个空屏幕，由`xlock(1)`提供。要使用不同的屏幕保护程序，在*.cwmrc*中设置其路径，如下所示：

```
command lock *path-to-command*
```

例如，要将`xlock`的流模式用作屏幕保护程序，请将以下内容添加到*.cwmrc*中：

```
command lock '/usr/X11R6/bin/xlock -mode flow'
```

如果你不喜欢 Xenocara 的`xlock(1)`中的任何屏幕保护程序，可以尝试`xscreensaver`包。

### 注意

`xlock`很容易被任何具有控制台访问权限的人绕过。你不能指望它提供安全性，但它确实可以作为你同事的一个不错的提醒。

### 使用 SSH 连接到其他机器

一个常见的任务是用 SSH 连接到远程机器。要做到这一点，按 ALT-.以显示`ssh>>`提示，然后输入你想要连接的机器的名称。方便的是，`cwm`支持基于*known_hosts*条目的自动完成。当你输入主机名到`ssh`提示时，`cwm`会在系统用户和*known_hosts*中查找匹配的名称。按向下箭头键查找你想要的主机，或者继续输入主机名以连接到新主机。（如果*known_hosts*条目被哈希，则自动完成将不起作用。）

顺便说一下，如果你打开多个 SSH 会话，请给它们命名，因为整理多个标记为`ssh`的会话很烦人。

### 创建应用程序菜单

在背景上单击鼠标右键以弹出应用程序菜单。`cwm`开发者不知道哪些程序对你来说很重要，所以他们甚至不尝试提供默认的应用程序菜单。你需要自己使用*.cwmrc*条目来构建它。每个命令都有以下格式：

```
*command name path-to-command*
```

是的，这与设置屏幕保护程序的格式完全相同。`lock`命令实际上是两个特殊命令关键字之一。在这里，我创建了一个包含两个选项的应用程序菜单，这两个选项是我的网络浏览器和我的 PDF 阅读器：

```
command firefox /usr/local/bin/firefox
command xpdf /usr/local/bin/xpdf
```

当我右击桌面背景时，我会看到一个带有这两个选项的菜单。

### 使用键盘导航

几乎每个人现在都有鼠标，但有时你处于最好忽略鼠标的情况。也许你的桌子太小，鼠标坏了，反复从键盘上移开你的手会减慢你的速度（就像你没有合适的鼠标键盘一样），或者你今天就是讨厌你的鼠标（这既合理又值得尊重）。

要使用键盘控制鼠标光标，使用 CTRL 和箭头键移动指针一小段距离，或者按 CTRL-SHIFT 和箭头键进行更大的指针移动。在我的系统中，CTRL-SHIFT 向上箭头将鼠标指针向上移动大约一个终端行，但这会随着字体大小而变化。

你还可以使用键盘命令来调整窗口的位置和大小，如 表 17-2 所示。

表 17-2. 表 17-2：cwm 窗口移动方向键

| 键组合 | 方向 |
| --- | --- |
| alt-shift–H | 向左 |
| alt-shift–J | 向下 |
| alt-shift–K | 向上 |
| alt-shift–l | 向右 |

使用 ALT 和方向键可以移动窗口一小段距离，或者使用 ALT-SHIFT 移动窗口一大段距离。要小幅度调整窗口大小，使用 CTRL-ALT 和方向键。CTRL-ALT-SHIFT 和方向键可以大幅度调整窗口大小。就像使用鼠标调整大小一样，大小变化发生在窗口的右下角。将窗口的左上角放置到你想要的位置，然后调整窗口大小。

### 装饰 cwm

默认的 `cwm` 桌面相当单调，但一些调整可以使它更容易看。我首先设置的一件事是背景颜色：黑色。使用 `xsetroot(1)` 来设置你的背景颜色。

```
$ **xsetroot -solid black**
```

你可以将此命令包含在 *.xsession* 中或在终端中运行它。文件 */usr/X11R6/share/X11/rgb.txt* 列出了 X 识别的颜色。如果颜色名称由两个单词组成，要么在名称中删除空格，要么将名称放在单引号中，如下所示：

```
$ **xsetroot -solid 'hot pink'**
```

如果你想在背景中使用图片，使用 `feh`（*/usr/ports/graphics/feh*）。

```
$ **feh --bg-scale /home/mwlucas/galaxies.jpg**
```

要使窗口边缘更容易识别，围绕它们放置边框。默认边框宽度为 1 像素，颜色由你选择。我更喜欢 3 像素的边框，活动窗口为蓝色，非活动窗口为深蓝色。这需要在 *.cwmrc* 中添加以下条目：

```
borderwidth 3
color activeborder blue
color inactiveborder darkblue
```

随着你对 `cwm` 的熟悉程度越来越高，你可能会发现你想要特定的应用程序始终可见——也许是一个 MP3 播放器、一个时钟，或者一个花哨的图形系统负载指示器。最大化窗口可能会隐藏这些应用程序。为了解决这个问题，在 *.cwmrc* 中定义一个间隙，这设置了即使最大化窗口也要保持清晰像素数。

```
gap *top bottom left right*
```

例如，当我必须跟踪时间时，我在屏幕的右侧运行 `xclock(1)`。实验表明，我的时钟大约有 175 像素宽。我留出 180 像素的间隙，这样即使我最大化窗口，它也不会覆盖时钟。这是我的 *.cwmrc* 中的 `gap` 条目：

```
gap 0 0 0 180
```

现在我不能再以我丢失了桌面上的时钟为借口说错过了工作。幸运的是，我有许多其他方便的借口。

### 解除和重新映射按键

虽然 `cwm` 的作者们尽力选择不会与其他程序冲突的快捷键，但他们无法避免所有可能的冲突。如果你遇到这样的冲突，你可以通过修改 *.cwmrc* 中的条目来替换冲突的 `cwm` 键绑定来解决该问题。

例如，`cwm` 使用 CTRL 和 CTRL-SHIFT 与箭头键一起移动指针，但 OpenOffice 也使用这些键组合在文本文档中移动指针和突出显示。我已经使用 OpenOffice 超过 10 年，并在其中写下了数百万字。我的手指已经得到了很好的训练，我不打算尝试重新训练它们。`cwm` 的按键分配必须改变。

使用 `bind` 命令来重新映射按键。首先，使用 `unmap` 选项将 CTRL 和 CTRL-SHIFT 与箭头键组合从 `cwm` 中断开连接。记住，*.cwmrc* 使用 `C` 来表示 CTRL，使用 `S` 来表示 SHIFT（如前所述在 表 17-1 中所示）。

```
bind CS-Left unmap
bind CS-Right unmap
bind CS-Up unmap
bind CS-Down unmap
bind C-Left unmap
bind C-Right unmap
bind C-Up unmap
bind C-Down unmap
```

这些按键现在将传递到应用程序中，例如 OpenOffice。

为了确定如何使用键盘移动指针，我检查 `cwmrc(5)` 以获取可以绑定到键的命令列表。手册使用简短的名字和功能描述来定义命令。指针移动命令以 `ptrmove` 和 `bigptrmove` 开头，加上一个方向。我找到了它们，并使用 Windows 键（也称为修改器 4）来替换我从 CTRL 键中移除的功能。

```
bind 4-Left ptrmoveleft
bind 4-Right ptrmoveright
bind 4-Up ptrmoveup
bind 4-Down ptrmovedown
bind 4S-Left bigptrmoveleft
bind 4S-Right bigptrmoveright
bind 4S-Up bigptrmoveup
bind 4S-Down bigptrmovedown
```

我现在可以使用 OpenOffice 和 `cwm` 的键盘功能。

到目前为止，我已经涵盖了自 OpenBSD 引入 `cwm` 以来我所使用的所有内容，这应该能让你开始。有关更多信息，请阅读 `cwm(1)` 和 `cwmrc(5)`。你会发现 `cwm` 支持许多更多功能。

现在我们已经了解了 OpenBSD 的外观，让我们深入探讨操作系统的核心。
