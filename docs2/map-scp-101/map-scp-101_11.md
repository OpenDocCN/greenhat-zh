# 附录 A. JAVASCRIPT 快速入门

![无标题图片](img/httpatomoreillycomsourcenostarchimages671943.png.jpg)

本书涵盖的所有映射 API 都基于 JavaScript。要使用它们，您需要从您的网页中编写 JavaScript 代码以与地图交互。然而，正如您在本附录中将会看到的，它是一种易于学习的编程语言。

我将介绍一种非常基础的 JavaScript 方法——足以不被书中其他示例所困惑。如果您想学习完整的细节，请拿起 *JavaScript 权威指南*（thau!, No Starch Press, 2000）。

# JavaScript 的去向

JavaScript 通过 `<script>` 标签添加到 HTML 页面中。有时代码会放置在这个标签及其结束标签之间。其他时候，这个标签会通过属性调用外部文件。在这个部分，我将展示这两种版本。

从技术上讲，您可以将 `<script>` 标签放置在 HTML 文档的任何位置。对于分析服务，页面底部可能是最佳位置。对于小部件的 JavaScript，可能需要放置在您希望小部件出现的确切位置。然而，从标准合规性和最佳实践的角度来看，尽可能在文档的 `<head>` 中包含您编写的 JavaScript 是有意义的。

这里是一个在更基础的网页上一些非常基础的 JavaScript 的例子：

```
<html>
<head>
  <title>My Simple JavaScript Example</title>
  <script type="text/javascript">
    alert('Testing JavaScript');
  </script>
</head>
<body>
  <h1>Hello World</h1>
  <p>Did you see the JavaScript alert?</p>
</body>
</html>
```

JavaScript 代码位于 `<script>` 标签之间。这里我使用了 `alert`，这是一个 JavaScript 函数，它将在您的网络浏览器中使用括号内的文本创建一个消息窗口。使用 alert 是展示简单示例和调试的好方法，但对于更复杂的脚本和面向公众的网页来说，超越它才是最佳选择。

### 提示

想要向没有 JavaScript 的浏览器发送特殊消息吗？包含 `<noscript>` 标签，浏览器将显示其中的任何内容。

`<script>` 标签可以包含任意多的 JavaScript 代码行，尽管过多的代码可能会开始拖累您的 HTML 文件，所以大多数超过几行的脚本都存储在外部文件中。考虑以下略微修改的例子：

```
<html>
<head>
  <title>My External JavaScript Example</title>
  <script type="text/javascript" src="js/test.js"></script>
</head>
<body>
  <h1>Hello World</h1>
  <p>My JavaScript is stored in a file.</p>
</body>
</html>
```

在这里，我通过 `<script>` 标签的 `src` 属性加载了 JavaScript，这与在 HTML 中引用图像的方式类似。按照惯例，文件具有 *.js* 扩展名。此外，为了保持组织有序，大多数开发者将 JavaScript 文件存储在离网站根目录的目录中。在这个例子中，我使用了名为 `js` 的目录。

文件的内容与您直接在页面上包含 JavaScript 时相同。但您不需要 `<script>` 标签。继续上一个例子，*test.js* 将只包含一行：

```
alert('Testing JavaScript');
```

使用这种方法具有明显的优势，即脚本文件由用户的浏览器单独缓存。如果您在许多页面上使用相同的脚本，当用户在您的网站上导航时，脚本只会下载一次。

如第一个例子所示，此代码在加载时立即运行。要在不同时间运行代码，你需要使用函数，这些函数将在本附录的后面描述。但首先，让我们感受一下 JavaScript 语法的其他部分，如变量、条件语句和循环。

# 变量

变量存储可以更改或稍后访问的值。你可以在变量中保存数字、文本等。在本节中，我将展示一些简单的值，以及更复杂的结构，如数组和对象。

首先，你需要能够识别变量。它们看起来像普通单词。有时变量可能由多个单词组成，但它们不能包含空格。通常，变量第一次使用时将被设置为值，例如：

```
var age = 21;
```

在这里，我使用 JavaScript 的`var`关键字创建了一个新变量。这个变量被称为`age`，但你几乎可以使用任何你想要的名称，只要它不是语言保留的单词之一。像大多数 JavaScript 代码行一样，这一行以分号结束。

等号声明左侧的变量现在将被设置为右侧的值。在这种情况下，我使用了一个字面量数字。你也可以使用文本、另一个变量，甚至其他变量和字面量的组合。

这里有一个使用多个变量的例子，其中一个变量依赖于其他变量：

```
var cost_per_person = 3;
var num_people = 7;
var total_cost = cost_per_person * num_people;
```

`var`关键字应该只在你第一次引用变量时使用。实际上，你甚至不需要使用它，尽管如此，如果没有使用，变量将被假定为*全局的*。变量作用域在变量作用域中将解释这意味着什么以及为什么明确声明变量是一个好主意。你甚至可以在不创建值的情况下这样做：

```
var tbd;
```

当设置包含文本的变量时，需要在值的每端使用引号，例如：

```
var name = 'Adam';
```

你可以使用单引号(`'`)或双引号(`"`)来定义文本字面量，但不能混合使用。如果你想在你字符串中包含引号，你需要用反斜杠转义它。

```
var name = 'Adam\'s apple';
```

关于文本变量的另一个特性将在下一节中介绍。

## 算术

在上一节中，我展示了使用乘号(`*`)字符将一个变量乘以另一个变量来计算`total_cost`的例子。

`+`、`−`、`*`、`/`和`=`符号是改变变量值时的工具。我们已经看到`=`将变量设置为与值*相等*。加法使用加号`+`。减法使用减号`-`。乘法和除法分别通过星号`*`和斜杠`/`完成。

这里有一个更复杂的例子：

```
var num = 10 * 2 / 4 + 8; // num is 13
```

遵循**数学运算顺序**，这意味着先执行乘法和除法，然后从左到右进行计算。你可以通过将某些操作放在括号内来强制排序：

```
var num = 10 * (2 / 4 + 8); // num is 85
```

为了节省您的时间，表 A-1 中展示了几个简写算术约定。当您需要通过相对于当前值的某个量来更改变量的值时，请使用这些约定。

表 A-1. 算术简写

| 简写 | 长版本 |
| --- | --- |
| `num += 3;` | `num = num + 3;` |
| `num++;` | `num = num + 1;` |
| `num -= anothernum;` | `num = num − anothernum;` |
| `num--;` | `num = num − 1;` |
| `num *= 2;` | `num = num * 2;` |
| `num /= 4;` | `num = num / 4;` |

加号`+`也可以用来*连接*——合并——文本字符串，例如：

```
var her = 'Eve';
var him = 'Adam';
var together = him + ' and ' + her;
```

这里将三个单独的字符串全部合并在一起。第一个和最后一个分别是`him`和`her`变量。中间的一个是字面字符串，它以空格开始和结束。如果您要`alert`（弹窗显示）`together`变量，它将显示为*亚当和夏娃*。

### 注意

您还可以使用`+=`简写来连接字符串。例如：`name += ' Smith'`将字符串添加到`name`变量中的文本末尾。

## 数组

到目前为止，我已经介绍了两种类型的变量——数字和文本。在这里，我将介绍一种特殊的变量，它可以存储多个值。或者，换句话说，它可以包含一个*数组*的值。

值可以是数字、文本或它们的组合。您还可以在数组中包含其他数组，甚至对象（下一节将介绍）。以下是一个数组声明的示例：

```
var herbs = ['Parsley', 'Sage', 'Rosemary', 'Thyme'];
```

值之间用逗号分隔。列表被方括号`[`和`]`包围。相同的括号用于根据它们在列表中的位置访问单个值。例如，要从`herbs`变量中提取`Rosemary`，您可以使用以下代码：

```
herbs[2]
```

在 JavaScript 中，就像在大多数编程语言中一样，数组索引从零开始。因此，尽管`Rosemary`是列表中的第三个项目，但您使用数字`2`来访问它。

要确定列表中有多少项，您使用`length`属性：

```
herbs.length
```

在循环中，我将展示如何访问数组中的每个项目。

## 对象

与数组一样，对象可以存储多个值。区别在于，您可以表达比简单列表更结构化的数据。为此，对象包含键和值对。键是类似单词的标签，但值可以是数字、文本、数组或其他对象。

这里有一个表示汽车的简单示例：

```
var car = {
  make: 'Ford', model: 'Mustang', year: 1965, color: 'red'
}
```

要访问对象内的值，您使用点符号：

```
car.model
```

现在您已经看到了在 JavaScript 中表示数据的不同方式，让我们来做些实际操作。

# 条件语句

条件语句帮助您比较变量与其他值（包括其他变量）。这种比较发生在*条件语句*中。使用条件语句是许多编程的基础，因为它们包含帮助计算机“做出决定”的逻辑。

最常见的条件语句是`if`语句。您使用它来提供仅在条件为真时才使用的代码，例如：

```
if (num == 5) {
  // code to run if true
}
```

在`{`和`}`大括号内的代码只有在`num`变量正好是`5`时才会运行。`==`操作符用于提供*等于*比较——与用于*赋值*的单个等号相反。

你可以使用其他比较操作符，如表 A-2 所示，在你不希望值完全相等的情况下使用。

表 A-2. 条件操作符

| 操作符 | 描述 |
| --- | --- |
| `==` | 等于 |
| `!=` | 不等于 |
| `>` | 大于 |
| `<` | 小于 |
| `>=` | 大于或等于 |
| `<=` | 小于或等于 |

如果条件为假时你想做其他事情，你可以在`if`语句之后立即包含一个`else`语句：

```
if (num > 0) {
  // code to run if true
}
else {
  // code to run if condition is false
}
```

在`else`语句之后的`{`和`}`大括号内的代码只有在`if`语句中的条件不成立时才会运行。在这个例子中，当`num`为零或更少时，`else`代码会运行。在其他情况下（`num`大于零），会运行`if`代码。你不会遇到同时运行`if`和`else`代码的情况。

### 注意

一个`else`语句不能没有伴随的`if`语句。然而，你可以有没有`else`语句的`if`语句。

你也可以有一个没有任何操作符的`if`语句。在这些情况下，语句中的变量被称为*布尔值*，它可以是`true`或`false`。以下是一个示例：

```
var is_cool = true;
if (is_cool) {
  // code to run if true
}
```

`if (is_cool)`代码是较长的`if (is_cool == true)`的简写。你还可以使用感叹号表示“不是”来简写比较变量为假，如下例所示：

```
if (!is_cool) {
  // code to run if is_cool is false
}
```

有时，一个非布尔变量也可以作为条件。在这种情况下，*空值*被认为是假的。空值对于数字是`0`，对于文本是`""`（空字符串），对于对象是`null`。此外，任何未定义的变量也是假的。

# 循环

循环就像特殊的条件语句，它会反复运行代码，直到条件不再为真。在本节中，我将介绍两种类型的循环：`for`循环和`while`循环。

在大多数情况下，循环有一个数字来计数你使用了多少次循环。以下是一个运行 10 次的示例：

```
for (❶var i=0; ❷i < 10; ❸i++) {
  // Code to run each time
}
```

`for`语句的括号内包含三个部分。初始值❶、循环继续的条件❷和增量部分❸。第一次通过循环时，`i`是 0。然后是 1，以此类推，只要`i`小于 10。当`i`等于 10 时，循环停止。但由于我们从 0 开始，循环将运行 10 次。

可以使用以下代码使用`while`循环实现相同的效果：

```
`var i=0`;
while (`i < 10`) {
  // Code to run each time
  `i++`;
}
```

事实上，如果你查看粗体代码段，你会注意到它们与`for`语句的三个部分相匹配。这个`while`循环在逻辑上是等价的。

### 注意

当你知道循环将运行多少次时，使用`for`可能最简单。当你事先不知道所需的迭代次数（例如，当你正在搜索一个值时），使用`while`。

记得数组部分中的 `herbs` 变量吗？为了刷新你的记忆，我们这样声明它：

```
var herbs = ['Parsley', 'Sage', 'Rosemary', 'Thyme'];
```

现在我们用一个循环来对数组中的每个值进行一些操作。因为我们知道迭代的总次数（数组的长度），所以我们将使用 `for` 循环。以下是代码：

```
var allherbs = '';
for (var i=0; i < herbs.length; i++) {
  allherbs += herbs[i] + ' ';
}
```

在循环的每次迭代中，我们将当前草药（由数字 `i` 确定的索引处的那个）附加到 `allherbs` 字符串的末尾。循环结束时，这就是该变量中存储的内容：

```
Parsley Sage Rosemary Thyme
```

我们已经使用循环来连接数组中持有的四个值。这个概念在整本书中都有使用，只是通常不是用于添加字符串；相反，我们用它来在几行代码中创建数百个地图标记或输出搜索的所有结果。

循环是限制你需要编写的代码的重要工具。但函数可能是实现简单、可重用代码的最好工具。继续阅读以了解我的意思。

# 函数

如果你准备好提升你的 JavaScript 编程能力，编写函数是一个好的开始。函数是一段打包的代码，用于执行特定的操作。它们可以接受一个或多个变量，并在必要时返回一个值。使用函数，你可以使你的代码更具可重用性，并将应用程序分解成更小的部分。

为了一个基本的例子，我们将创建一个输出两个数中较大数的函数。这个函数已经以 `Math.max` 的形式存在（可以接受多个值进行比较），但它仍然是一个很好的例子。以下是该函数的完整代码：

```
function biggest(num, another) {
  if (num > another) {
    return num;
  }
  else {
    return another;
  }
}
```

每个函数都以 `function` 声明开始，后跟函数名。然后，在括号内，你声明函数将接受的参数——变量。在这种情况下，我们有两个，我分别命名为 `num` 和 `another`。

函数的其余部分，位于 `{` 和 `}` 大括号内，应该看起来很熟悉；它只是普通的 JavaScript 代码。当函数被调用时，你传递两个变量，代码根据输入运行。当你准备好发送一个值返回时，你使用 `return` 语句立即退出函数，并使其输出等于 `return` 后面的变量（或字面量值）。

我可能最好用一个例子来解释它。这是调用新的 `biggest` 函数的方法：

```
var somenum = 7;
var bigone = biggest(somenum, 11); // After the biggest function, bigone is 11
```

我传递了一个变量（`somenum`）和一个字面量数字到函数中。我可以使用任何字面量或变量值的组合。我的变量名不需要与函数内部使用的变量名匹配。它们有不同的 *作用域*，我将在下一节中解释。

对于普通的布尔型、数字型和文本型变量，JavaScript 会复制其值并将其发送到函数中。这意味着如果你在函数内部对值进行任何修改，原始变量外部将不受影响。对于对象和数组来说，情况并非如此；在这些情况下，你将修改原始变量的值——即使变量不在返回值中。

在本节的开始，我提到一个函数不需要接受参数。在这些情况下，函数需要空括号。以下是一个与映射相关的示例：

```
function recenter_map() {
  mapstraction.setCenter(stored_center);
}
```

此函数将用于将地图设置为存储的中心点，只要你将变量保存在内存中。我在 #34: 当消息框关闭时返回中心 中使用了类似的方法。要使其按所示工作，唯一的方法是 `stored_center` 是一个全局变量，可以从页面上的任何 JavaScript 中访问。

## 变量作用域

在前面的章节中，我演示了如何创建变量。我还解释了 `var` 关键字虽然不是必需的，但建议使用。这些建议背后的原因与变量的可见性——或者说其作用域有关。

如果你使用一个没有包含 `var` 语句的变量，该变量将自动被认为是 *全局的*，而不是 *局部的*。全局变量可以从页面上的任何 JavaScript 中看到，包括其他函数。你还可以通过在函数外部声明变量来显式地将变量设置为全局，通常在 JavaScript 部分的开头。

考虑以下示例：

```
<html>
  <head>
    <title>JavaScript Variable Scope Example</title>
    <script type="text/javascript">
❶     var firstvar = 1; // explicit global variable
      function call_first() {
❷       secondvar = 2; // implicit global variable
❸       var thirdvar = 3; // local variable
        then_me();
        alert('First: ' + firstvar + '\nSecond: ' + secondvar
             + '\nThird: ' + thirdvar);
      }
      function then_me() {
❹       firstvar = 10;
❺       var secondvar = 20;
❻       thirdvar = 30; // implicit global variable
      }
    </script>
  </head>
  <body onLoad="call_first()">
    ...
  </body>
  </html>
```

当 JavaScript 的 `alert` 弹出时，三个变量的值将会是什么？让我们逐步分析代码。当页面加载时，我们创建一个全局变量❶，然后调用 `call_first` 函数。

在第一个函数内部，我们设置了一个变量的值而没有使用 `var` 关键字❷，这使得该变量隐式地成为全局变量。我们创建的第三个变量❸是一个局部变量，因为我们在函数内部使用了 `var` 关键字。

使用这三种不同方式创建的三个变量后，我们然后在第一个函数内部调用我们的第二个函数。在这个新的函数中，我们重置一个全局变量❹，创建一个新的局部变量❺，并创建一个新的全局变量❻。

当我们返回到第一个函数中的位置时，在这个作用域中唯一改变的变量是 `firstvar`。`then_me` 函数中的 `secondvar` 变量是局部的，因此它不会改变全局的 `secondvar`。尽管 `then_me` 的 `thirdvar` 是全局的，但这不会改变 `call_first` 函数内部具有相同名称的局部变量。

### 提示

为了让自己更容易理解，要明确并始终使用 `var` 关键字显式声明变量。

虽然可能看起来有些复杂，但好消息是这个过程是逻辑的，只要你能够理解它。

## 匿名函数

在现代 JavaScript 中，经常使用一种特殊类型的函数，尤其是在读取数据时（就像你经常使用地图那样）。这个函数被称为匿名函数，因为它没有名字。这些函数通常作为参数传递给其他函数。

这里有一个非常基础的示例：

```
function start_here() {
    call_another(`function() {`
      `alert('Anonymous function message!');`
    `}`);
  }
  function call_another(❶fn) {
❷   fn();
  }
```

粗体部分是匿名函数。它看起来就像任何其他函数一样，只是缺少一个名字。另一件奇怪的事情是，这里函数被放在了另一个函数调用 `call_another` 的括号内。在那个第二个函数中，我们有一个变量 ❶，它持有匿名函数的 *引用*。然后我们可以通过引用变量的名字 ❷ 来调用它。

确实如此，如果你加载它并调用 `start_here` 函数，你会看到来自你的匿名函数的警告消息——通过第二个函数。

这是一个匿名函数更常见用途的例子，使用 jQuery 从网络服务中读取 JSON：

```
jQuery.getJSON(url, function(obj) {
  // Code to access the obj variable
});
```

我们向 jQuery 的 `getJSON` 函数传递了两个值。第一个是我们想要检索的 JSON 的 URL。第二个是我们匿名函数——这次传递了一个变量给它。当评估 JSON 数据时（参见第五十三部分：使用 JSON），jQuery 会将其放入一个 JavaScript 对象中，然后将其传递给我们的匿名函数。

使用匿名函数在某种程度上是一种简写。这是这个 jQuery 示例的更长版本：

```
jQuery.getJSON(url, get_results);
function get_results(obj) {
  // Code to access the obj variables
}
```

当然，你打字的时间并没有节省多少，但你的代码通常更易于阅读。在 JavaScript 中使用单用途函数会使代码变得杂乱无章。但了解匿名函数的最好理由可能是你可能会在其他人的代码中看到很多匿名函数——包括在这本书中。

然而，匿名函数只应该在它们最有用的场合下使用。如果你发现自己正在匿名函数中编写大量代码，你可能应该将其改为命名函数。此外，注意在长循环中创建匿名函数。你实际上在每次循环中创建新的函数，这是低效的。而且这样做也与函数的目的相悖：编写一次代码，多次运行。

# 使用 jQuery

在这本书的几个地方，我使用了 JavaScript 框架 jQuery。jQuery 简化了常见任务，并为在不同浏览器中实现不一致的操作提供了一个统一的接口。jQuery 在这本书中最常见的用途，尤其是本节，是从网络服务中读取文件或其他数据。本节旨在快速介绍使用 jQuery。

在你能够使用 jQuery 之前，你需要将其包含在你的网页中。你可以通过在 [`jquery.com/`](http://jquery.com/) 下载最新版本，或者通过在你的 HTML 文件的 `<head>` 部分添加以下内容来获取 Google 托管的版本：

```
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script>
```

使用 Google 托管的版本的一个优点是，许多其他网站也是如此。这意味着当人们访问你的网站时，他们可能已经在浏览器缓存中存储了 jQuery。即使他们没有，他们也可以快速下载它——目前文件大小不到 20KB。

一旦你在文档中包含了 jQuery，你就可以通过两个全局变量来使用它的函数：`jQuery`及其缩写`$`。

## 查询文档对象

在其众多用途中，jQuery 非常擅长快速轻松地从你的 HTML 页面中提取元素到 JavaScript 代码中。你可以通过`id`、标签名、CSS 类或这些因素的组合来进行查询。jQuery 使这项任务变得更容易，这样你就可以专注于你想对这些元素做什么。

要获取页面上的单个元素，例如地图`<div>`，你可以通过它的`id`来调用它。jQuery 的大部分语法都借鉴了 CSS，这可能会让你感到熟悉。以下是如何调用一个`id`为`mymap`的对象：

```
var mapdiv = $('#mymap');
```

注意我正在使用美元符号缩写。然后我添加括号，因为`$`是一个变量和一个函数（jQuery 在 JavaScript 的边界上进行了扩展，你和我可能都不会这样做）。在函数内部，我们传递一个字符串，其中包含我们用来样式化地图`div`的 CSS，`#mymap`。

你现在已经使用了第一个 jQuery 函数来查询特定元素。你可以用 JavaScript 的标准`document.getElementById`函数达到相同的效果，但 jQuery 的方法输入更快。此外，使用`$`的结果允许你链式调用其他 jQuery 函数，例如视觉效果。

jQuery 不仅可以查询单个元素，还可以在一次调用中收集多个元素。以下是一些示例：

```
var imgs = $('img'); // all the images on a page
var allmaps = $('.map'); // every element with class="map"
var mapimgs = $('#mymap img'); // all images that are within #mymap element
var firstp = $('p:first'); // first paragraph on a page
```

这些示例展示了不同类型的查询——还有更多可能。你可以在[`api.jquery.com/category/selectors/`](http://api.jquery.com/category/selectors/)了解 jQuery 所称为的*选择器*。

## 插入和隐藏内容

一旦你使用 jQuery 从页面上获取了一个或多个元素，你将想要对它们做些什么。在本节中，我将向你展示如何在页面元素内部添加或替换内容的方法。我还会演示一个效果，这样你就可以稍后使其重新出现。

假设你想要在页面上添加一个元素，你可以显示一些计算的结果。你可以使用类似以下方式使用 HTML 添加该元素：

```
<div id="results">Results:</div>
```

当你准备好添加结果时，你可以使用 jQuery 找到元素并显示结果。如果你想显示一个名为`total`的变量的内容，你可以使用以下单行 jQuery：

```
$('#results').html(total);
```

这行代码将找到页面上`id`为`results`的元素，并将其内部 HTML 替换为`total`变量的值。如果你只想向元素添加附加内容，请使用此行代码代替：

```
$('#results').append(total);
```

现在结果部分看起来可能像这样（如果`total`变量是`42`）：

```
Results: 42
```

你已经看到了如何插入内容，但关于使相同内容消失呢？例如，在添加结果之前，一个只有`Results:`而没有其他内容的页面看起来有点奇怪。所以当页面加载时（你将在下一节中学习如何做到这一点），运行以下代码来隐藏结果元素：

```
$('#results').hide();
```

当你准备好向用户显示结果时，包括以下代码：

```
$('#results').show();
```

这两个函数是 jQuery 效果的简单（且非常有用）示例。更多效果可以在 jQuery 网站上找到，地址为 [`api.jquery.com/category/effects/`](http://api.jquery.com/category/effects/)。

## 使用浏览器事件

在本书的早期，我花了一整章来介绍在地图上发生的事件，例如点击或拖动。你还可以在浏览器中的任何位置响应事件，jQuery 使响应过程变得简单。

要响应事件，你首先需要监听它。当你的页面首次加载时，你注册你的意图来响应事件。你可以通过将 JavaScript 函数添加到 `<body>` 标签的 `onload` 属性来实现，或者你可以使用特殊的 jQuery 事件来完成。

虽然创建一个事件来注册其他事件可能看起来有些反直觉，但它确实有效。以下是一个等待页面准备好的示例：

```
$(document).ready(register_events);
```

注意，我们要查询的元素与过去略有不同。我们不再在括号内插入字符串，而是插入了一个标准的 JavaScript 对象，`document`。当页面加载足够多，浏览器知道它包含的所有对象时，我们调用 `register_events` 函数。然而，该函数不存在，因此我们需要编写它。或者，我们可以用匿名函数来响应相同的事件：

```
$(document).ready(function() {
  // Code to register events
});
```

与大多数匿名函数一样，你通常希望将其保持为只有几行。如果你有很多事件需要注册，使用一个命名函数可能更适合你。

### 注意

使用浏览器 `onload` 属性和 jQuery 的 `ready` 事件之间存在很大差异。使用 `onload`，你等待整个页面加载完成，包括图像和其他外部文件。使用 `$(document).ready`，你可以在浏览器准备好时立即运行代码，例如注册事件和隐藏对象。在这里使用 jQuery 通常意味着更好的用户体验。

现在你已经等待浏览器准备好注册其他事件，让我们来注册它们。以下是 jQuery 事件的基模式：

```
$(*`element`*).*`event`*(*`function`*);
```

*`element`* 部分通常是选择器，例如元素的 `id`（尽管它也可以是任何浏览器对象，如 `ready` 示例所示）。*`event`* 部分是函数的名称，由 jQuery 声明。最后，*`function`* 是函数引用，可以是匿名函数或要调用的函数名称。

这是如何监听特定元素被点击的示例：

```
$('#myid').click(function() {
  alert('Clicked on myid');
});
```

如果你熟悉 HTML 中包含的 JavaScript 事件，你可能想知道 `on`，如 `onClick` 去哪里了。在 jQuery 中，事件仅通过动作来引用。

你还可以获取有关事件的额外信息。可用的信息可能因事件而异。以下是如何找出用户在页面上双击的位置：

```
$(document).dblclick(function(❶e) {
  alert('Double-clicked at ' + ❷e.pageX + ', ' + ❸e.pageY);
});
```

我没有使用`click`事件，而是使用了`dblclick`事件。因为我们想要更多关于事件的详细信息，我在匿名函数中包含了一个可选参数❶。在函数内部，我可以使用这个变量来获取信息，例如用户点击的位置。这些数据分为两部分：从页面左侧的像素数❷和从页面顶部的像素数❸。

你可以在表 A-3 中看到可用事件的样本，以及每个事件可选参数中传递的附加信息。

表 A-3. 一些有用的 jQuery 事件

| 事件名称 | 可用对象 | 其他信息 |
| --- | --- | --- |
| `click` | 任意 | 页面位置：`pageX`，`pageY` |
| `dblclick` | 任意 | 页面位置：`pageX`，`pageY` |
| `mousemove` | 任意 | 页面位置：`pageX`，`pageY` |
| `keydown` | `document`，`window` | 键码：`which` |
| `focus` | 表单元素 |  |

事件会使你的网页更加互动，无论它们是否包含地图。有关事件的全列表（以及可用的附加事件信息），请参阅 jQuery 的文档[`api.jquery.com/category/events/`](http://api.jquery.com/category/events/)。

## 加载文件和数据

如果你想要与当前 HTML 文件外的数据进行交互，jQuery 提供了一些出色的工具来进行这类 Ajax 调用。尽管 Ajax 代表的是*异步 JavaScript 和 XML*，但你可以使用 Ajax 访问任何类型的数据。

要使用 jQuery 加载文件，你使用`get`函数。`get`至少需要两个参数：你想要加载的 URL 以及 jQuery 想要发送结果的函数。以下是一个加载文本文件的简单示例：

```
$.get(❶"test.txt", function(txt) {
  alert(txt);
});
```

我提供的 URL 只是一个文件的名称。在这种情况下，文件是文本，但它也可能是 HTML 代码或其他类型的内容。在第五十二部分：使用 XML 中，我展示了如何使用`get`函数解析 XML 结果。

你不仅限于只加载简单的文件。你可以包括目录名，甚至完整的 URL。无论你加载什么，都需要在同一个域名上。出于安全原因，浏览器不会让你从其他网站检索数据，即使这些数据是公开的。你可以通过在服务器端加载文件（如第六十一部分：检索网页中所示）然后访问本地副本来解决这个问题。

存在一个特殊情况，允许你从另一个网站加载数据。如果该网站提供 JSON 数据，并且它允许你在 URL 中指定回调函数，那么你可以使用 jQuery 的`getJSON`函数远程加载数据。以下是基本结构：

```
jQuery.getJSON(❷url, function(obj) {
  // Code to access the obj variable
});
```

你发送给 `getJSON` 函数的 URL ❷ 需要包含一个问号来代替函数名称。然后 jQuery 将创建一个函数，并从其新函数中调用你的匿名函数（或者如果你选择，命名函数）。

`getJSON` 与 `get` 另一个不同之处在于传递给回调函数的参数类型。而不是返回给 URL 的纯文本，jQuery 会以 JavaScript 对象的形式将解析后的 JSON 传递给你。

你可以在 第五十三部分：使用 JSON 中找到 `getJSON` 的一个更完整的示例。此外，你还可以在 第十章 中几个 mashup 示例中看到该函数在实际项目中的应用。
