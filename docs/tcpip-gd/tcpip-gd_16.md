# 第三部分-5. TCP/IP 应用层寻址和应用类别

第七十章

第七十一章

TCP/IP 协议套件是现代互联网的基础，因此，它被用作网络应用开发和实施的主要平台。在过去几十年里，随着全球 TCP/IP 互联网的增长，已经创建了数百个新的应用。这些程序支持各种不同的任务和功能，从执行基本业务任务到提供纯娱乐。用户可能身处同一房间或不同的大陆。

在众多 TCP/IP 应用中，少数被认为是 TCP/IP 的关键应用。大多数已经存在很长时间——在某些情况下，甚至比现代互联网协议（IP）本身还要长。许多这些协议专门处理将信息安排成离散单元（称为“文件”或“消息”）的发送。因此，最重要的 TCP/IP 应用组之一是描述在互联网设备之间移动这些文件的基本机制的应用：*文件和消息传输应用*。

本书剩余部分将讨论最常见且确定的 TCP/IP 应用和应用层协议。然而，在描述这些应用本身之前，我需要先阐述一些与应用协议整体相关的基础知识。为此，本部分包含两章。在第一章中，我解释了为 TCP/IP 应用设置的通用系统，用于寻址互联网资源：统一资源标识符（URIs），包括统一资源定位符（URLs）和统一资源名称（URNs）。在第二章中，我概述了文件和消息传输应用，包括它们之间的区别描述。

# 第七十章. TCP/IP 应用层寻址：统一资源标识符、定位符和名称（URIs、URLs 和 URNs）

![无标题图片](img/httpatomoreillycomsourcenostarchimages287681.png.jpg)

互联网由数百万个相互连接的服务器组成，每个服务器都能向请求信息的互联网用户提供有用的信息。网络拥有的信息越多，它就越丰富，但定位信息就越困难。为了使用信息，我们需要能够找到它，这至少要求我们为每个文件或对象采用某种标记方式。

为了这个目的，TCP/IP 定义了一套统一资源标识符（URIs）系统，它可以在互联网和私有 TCP/IP 网络上使用。每个 URI 唯一指定了客户端如何定位特定资源并访问它，以便可以使用。URIs 被细分为统一资源定位符（URLs）和统一资源名称（URNs），它们具有类似的作用，但工作方式不同。

在本章中，我描述了互联网上用于标识文件、对象和资源的寻址系统。我首先概述了 URI 的概念，并解释了 URI、URL 和 URN 之间的区别。然后，我详细解释了 URL 及其使用方式。这包括对 URL 的一般语法的概述，对最常见应用中使用的 URL 方案的描述，对相对 URL 及其工作方式的讨论，以及与 URL 相关的现实世界问题的全面分析，包括一些不诚实的人玩的有意混淆的游戏。最后，我讨论了 URNs，包括它们如何解决 URL 的一个主要问题以及它们使用的障碍。

# URI 概述和标准

如果你在这本书中按照 OSI 参考模型层逐层阅读，你可能会期望到这一点就已经完成了寻址。毕竟，我们已经在第 2 层讨论了 MAC 地址，在第 3 层讨论了 IP 地址，以及它们之间的转换机制（参见第十三章地址解析和 TCP/IP 地址解析协议（ARP）和第十四章反向地址解析和 TCP/IP 反向地址解析协议（RARP））。我们甚至有端口和套接字，它们提供了传输层寻址能力，使得每个设备可以运行多个软件应用（参见第四十三章 TCP 和 UDP 寻址：端口和套接字）。考虑到所有这些，应用层寻址的想法可能看起来有点奇怪，我意识到用这个术语来指代本章的主题可能有点不寻常。

然而，这个概念实际上并没有看起来那么奇怪。确实，有了 IP 地址和端口号，我们理论上可以访问 TCP/IP 互联网上的任何资源；问题在于如何找到它。

应用层寻址不是计算机软件所必需的。它是使人类更容易识别和定位资源的一种方式。这与用来证明创建名称系统（如域名系统（DNS；参见第 III-1 部分名称系统和 TCP/IP 名称注册和名称解析）合理性的论据非常相似。DNS 是一种高级寻址形式，允许使用名称而不是 IP 地址。这对人们来说很有帮助，因为他们发现理解 www.intel.com 比理解 198.175.96.33 更容易。

综合应用层寻址方案的核心理念是将 DNS 已经取得的成就扩展到下一个层次。DNS 名称提供了必要的高级抽象寻址，但仅限于整个设备（无论是真实还是虚拟的）。这些名称可以用作更完整标签方案的基础，不仅指向一个站点或设备，还可以指向特定的文件、对象或其他资源。在 TCP/IP 中，这些标签被称为统一资源标识符（URIs）。

URIs 是作为万维网（WWW）开发的关键技术之一而开发的，并且它们通常与 Web 及其实现的超文本传输协议（HTTP；见第三部分-8"))联系在一起。你过去可能已经使用了成千上万的 URI；每次你将类似`http://www.myfavoritewebsite.com`的内容输入到网页浏览器中时，你就是在使用 URI。

URI 之所以对 Web 如此重要，是因为它们将所有必要的引用资源信息组合成一个字符串。这种表达的紧凑性对于整个超文本资源链接概念至关重要。如果我们想要使一个文档中的对象指向另一个对象，我们需要有一种简单的方式来描述该对象，而无需一整套指令。URI 允许我们做到这一点。

实际上，URI 与 Web 的联系如此紧密，以至于它们通常被描述为是特定于 Web 技术的组成部分。然而，它们并不特属于 Web，这就是为什么本章与 WWW 和 HTTP 的讨论是分开的。

## URI 类别：URLs 和 URNs

URI 是引用许多种 TCP/IP 资源的一般性方法。根据它们描述资源的方式，它们目前被分为两大类：

**统一资源定位符（URLs）** URL 是一种 URI，通过组合协议或访问机制和特定资源位置来引用资源。URL 以要用于访问资源的协议名称开头，然后包含足够的信息来指示如何获取该资源。

**统一资源名称（URNs）** URN 是一种 URI，提供了一种在不指定访问协议或机制以及不指定特定位置的情况下唯一命名资源的方法。

URL 和 URN 之间的区别在于，前者更加具体，围绕如何访问资源进行定位，而后者更加抽象，设计上更多地是为了识别资源是什么，而不是描述如何获取它。

给某人一个 URL 就像给他们指路找一本书，如下所示：“乘坐火车去阿尔伯克基，然后乘坐 11 路公交车到 41 号阿尔伯特街，这是一座由乔安妮·约翰逊拥有的红砖房子。你想要的书在二楼书架最右边第三本书。”

URN 更像是用国际标准书号（ISBN）来指代一本书；它唯一地标识了这本书，无论这本书可能位于何处，都不会告诉你如何访问它。（实际上，ISBN 是用于 URN 的识别系统之一，你将在本章末尾关于 URN 的部分中看到。）

虽然 URLs 和 URNs 在理论上是对等的，但在实践中，URLs 的使用频率远高于 URNs。事实上，URLs 的地位如此之高，以至于大多数人甚至从未听说过 URIs 或 URNs。原因是，尽管寻找书籍的例子表明 URNs 比 URLs 更自然，但在实际操作中，URLs 更容易使用。URLs 提供了访问资源所需的信息，而如果不能访问资源，仅仅知道如何识别它就具有有限的价值。

URN 是一个吸引人的概念，因为它们在不需要将其与特定的访问机制或位置绑定的情况下标识资源。然而，URN 的实现需要某种方式将资源的永久标识符与其在任何给定时刻的位置联系起来，这并不是一个简单的任务。因此，URN 及其使用方法已经开发多年，而 URL 则一直处于活跃使用中。

### 小贴士

**关键概念**在任何互联网上都需要某种机制来允许资源（如文件、目录和程序）被标识和访问。在 TCP/IP 中，统一资源标识符（URIs）用于这种“应用层寻址”。URI 有两种类型：统一资源定位符（URLs），它通过结合访问方法和位置来指定如何访问一个对象，以及统一资源名称（URNs），它通过名称来标识一个对象，但并不指示如何访问它。

虽然 URL 始于 Web，并且大多数 URL 仍然与 HTTP 一起使用，但它们可以并且确实可以引用使用许多其他协议访问的资源，例如文件传输协议（FTP）和 Telnet。URI 的紧凑性使它们在这样使用时非常强大。使用 URL，我们可以使用一个字符串告诉程序使用 FTP 检索文件。这取代了启动 FTP 客户端、建立会话、登录和发出命令的完整 FTP 过程。

## URI 标准

20 世纪 90 年代发布的一些互联网标准描述了 URI、URL 和 URN 的语法和基本用法。第一个是 RFC 1630，“WWW 中的通用资源标识符”，于 1994 年发布，仍然是这个主题的良好概述。1994 年 12 月，两份文件，RFC 1737 和 RFC 1738，分别提供了关于 URN 和 URL 的更具体信息。RFC 1808 描述了如何定义和使用相对 URL。RFC 2141 提供了更多关于 URN 语法的详细信息。

RFC 2396，“统一资源标识符（URI）：通用语法”，于 1998 年 8 月发布，旨在修订和取代许多先前 RFC 中的一些信息。它可能是目前 URI 的权威标准，尽管仍然有 RFC 发布讨论与 URI 相关的问题。特别是 URNs，正如我之前提到的，它们仍在积极开发中。

基础文档，如 RFC 2396，描述了如何为许多常见的协议（在 URL 术语中称为 *schemes*，当我们更仔细地研究 URL 时将会看到）指定 URL。为了提供灵活性，还定义了一种机制，允许注册新的 URL 方案。这在本节 RFC 2717，“URL 方案名称注册程序”和 RFC 2718，“新 URL 方案指南”中有所描述。还有一些 RFC 描述了不同协议的特定 URL 方案，包括 RFC 2192（IMAP）、2224（NFS）、2368（电子邮件）和 2384（POP）。

# URL 通用语法

URL 是文本字符串，允许根据资源在互联网上的位置以及访问它的主要方法或协议对其进行标记。由于它们的简单性，URL 已经成为 TCP/IP 应用层地址中使用的最常见类型的 URI。 

URL 由两个组件组成，用于标识如何访问 TCP/IP 互联网上的资源：资源的位置以及访问它所使用的方法。这两个信息片段结合起来，允许具有适当软件的用户获取、读取或以其他方式处理许多不同类型的资源，如文件、对象、程序等等。

URL 的最通用语法形式只包含两个元素，这两个元素对应于前面描述的两条信息：`<scheme>:<scheme-specific-part>`。术语 *scheme* 指的是一种访问方法，它描述了资源的使用方式。它通常指的是一种应用协议，如 `http` 或 `ftp`，或者是一种资源类型，如 `file`。方案名称必须只包含字母、加号（+）、点（.）和连字符（-）。在实践中，方案名称通常只包含字母。方案名称不区分大小写，但通常用小写表示。

方案之后（以及必需的冒号分隔符）的 URL 其余部分是方案特定的。这是必要的，因为各种协议和访问方法需要不同类型和数量的信息来标识特定的资源。当读取 URL 时，方案名称告诉解析该 URL 的程序如何解释 URL 其余部分的语法。

## 常见互联网方案语法

理论上，每个方案都可以为 URL 的`<scheme-specific-part>`使用完全不同的语法。然而，许多这些方案由于在引用互联网设备及其设备上的资源方面的相似性，因此在这个部分共享一个共同的语法。例如，HTTP 和 FTP 都用于通过 DNS 名称或 IP 地址指向特定的 TCP/IP 设备，然后访问存储在分层目录结构中的资源。它们的 URL 至少在某种程度上相似是有意义的。

### 小贴士

**关键概念** URLs 是最广泛使用的 URI 类型。在其最基本的形式中，一个 URL 由两个元素组成：定义访问资源协议或其他机制的方案，以及包含标识特定资源并指示如何使用该资源的信息的方案特定部分。一些方案为它们的方案特定部分使用共同的语法；其他方案使用方案特有的语法。

这种常见互联网方案语法的最一般形式如下：

```
<scheme>://<user>:<password>@<host>:<port>/<url-path>;<params>?<query>#<fragment>
```

语法元素如下：

**`<scheme>`** URL 方案，指的是一种访问方法。

**`<user>`** 和 **`<password>`** 需要登录的方案的认证信息，形式为用户名和密码。

**`<host>`** 互联网主机，通常指定为完全限定的 DNS 域名或点分十进制表示法的 IP 地址。

**`<port>`** 在调用与方案相关的协议时使用的传输控制协议（TCP）或用户数据报协议（UDP）端口号。

**`<url-path>`** 资源位置路径。这通常是一个从根目录到资源所在位置的完整目录路径，表示要遍历的目录序列，然后是资源的名称。例如，如果在一个设备上有一个名为 project1 的目录，其中包含一个名为 memos 的子目录，子目录中有一个名为 June11th-minutes.txt 的文本文件，那么 URL 路径`project1/memos/June11th-minutes.txt`就指向该资源。请注意，在`<url-path>`之前需要斜杠，虽然从技术上讲它不被认为是路径的一部分，但它起到了在许多文件系统中表示根目录的斜杠的作用。此外，`<url-path>`可能以斜杠结尾，这意味着路径专门指向一个目录。然而，这通常不是必需的，因为当需要时，服务器会根据上下文将 URL 视为目录引用。路径也可以指向虚拟文件、程序或其他类型的资源。

**`<params>`** 包含在方案中以控制如何使用方案访问资源的方案特定参数。每个参数通常为`<parameter>=<value>`的形式，每个参数规范之间使用分号分隔。

**`<query>`** 当访问资源时传递给服务器的可选查询或其他信息。

**`<fragment>`** 用于标识用户对资源中特定位置感兴趣的地方。

图 70-1 使用 HTTP URL 的示例说明了这种常用语法及其元素。

![统一资源定位符（URL）示例 此图显示了包含一般方案语法的几乎所有可能元素的示例 URL，每个元素都使用阴影框突出显示。此 URL 标识了一个必须通过特定密码在 www.mysite.org 网站使用端口 8080 访问的 Web（HTTP）资源。在这种情况下，资源是位于站点 cgi-bin 目录中的 PHP 程序，它会导致显示特定的照片页面。`<fragment>`指定器将导致在检索到的婚礼照片页面上显示图片 Reception07。](img/httpatomoreillycomsourcenostarchimages288259.png.jpg)

图 70-1. 统一资源定位符（URL）示例 此图显示了包含一般方案语法的几乎所有可能元素的示例 URL，每个元素都使用阴影框突出显示。此 URL 标识了一个必须通过特定密码在 www.mysite.org 网站使用端口 8080 访问的 Web（HTTP）资源。在这种情况下，资源是位于站点 cgi-bin 目录中的 PHP 程序，它会导致显示特定的照片页面。`<fragment>`指定器将导致在检索到的婚礼照片页面上显示图片 Reception07。

## URL 语法元素的省略

完整的 URL 语法可能看起来非常复杂，但请记住，这是一个正式的定义，它一次性显示了 URL 中所有可能元素。大多数方案并不使用这些元素中的每一个，而且其中许多元素是可选的，即使它们在特定方案中是有效的。例如，`<login>`和`<password>`元素在 HTTP URL 中官方支持，但它们很少使用。同样，端口号通常被省略，告诉客户端软件只需使用该方案默认的端口号。本章的“URL 方案和方案特定语法”部分描述了一些最常见的 URL 方案及其特定语法，包括这些元素如何以及何时被使用。

尽管 URL 语法的丰富性并不经常需要，但在某些特殊情况下，它可以提供各种信息。URL 在表达方式上也非常灵活。例如，虽然`<host>`元素通常是 DNS 名称，但它也可以是多种形式的 IP 地址，包括点分十进制、常规十进制、十六进制、八进制，甚至这些的组合。不幸的是，由于大多数人对于这些细节的不熟悉，导致 URL 被故意模糊化，以引导人们访问他们通常想要避免的“资源”。我们将在本章的“URL 模糊化、混淆和一般诡计”部分中对此进行探讨。

## URL 片段

值得注意的是，从描述资源命名的标准来看，`<fragment>`元素在技术上不被认为是 URL 的正式部分。原因是它只标识资源的一部分，而不是标识资源本身所需的信息的一部分。它不会被发送到服务器，而是由客户端软件保留，以指导它如何显示或使用资源。然而，有些人会提出一个合理的论点，即这种区别是有些任意的。例如，方案本身也仅由客户端使用，主机本身也是如此。

URL 片段的最常见例子是在显示网页时指定一个特定的书签以滚动到。在实践中，片段标识符通常被当作 URL 的一部分来处理，因为它指定 URL 的字符串的一部分。

## 不安全字符和特殊编码

URLs 通常以标准的 US ASCII 字符集表示，这是大多数 TCP/IP 应用协议的默认使用。该集合中的某些字符被称为不安全字符，因为它们在不同的上下文中具有特殊含义，将它们包含在 URL 中会导致歧义或解释上的问题。空格字符是经典的不安全字符，因为空格通常用于分隔 URL，所以在 URL 中包含一个空格会将 URL 分割成几部分。其他字符不安全，因为它们在 URL 中具有特殊意义，例如冒号（:）。

URL 中的安全字符是字母数字（*A* 到 *Z*，*a* 到 *z* 和 0 到 9）以及以下特殊字符：美元符号（$）、连字符（-）、下划线（_）、点（.）、加号（+）、感叹号（!）、星号（*）、撇号（'）、左括号（() 和右括号（））。所有其他不安全字符都可以使用一个编码方案表示，该方案由一个百分号（%）后跟字符的十六进制 ASCII 值组成。最常见的例子在表 70-1 中给出。

表 70-1. URL 特殊字符编码

| 字符 | 编码 | 字符 | 编码 | 字符 | 编码 |
| --- | --- | --- | --- | --- | --- |
| **<space>** | %20 | < | %3C | > | %3E |
| **#** | %23 | % | %25 | { | %7B |
| **}** | %7D | &#124; | %7C | \ | %5C |
| **^** | %5E | ~ | %7E | [ | %5B |
| **]** | %5D |  | `%60 | ; | %3B |
| **/** | %2F | ? | %3F | : | %3A |
| **@** | %40 | = | %3D | % | %26 |

当遇到这些序列时，它们被解释为它们所代表的字面字符，没有任何意义。因此，URL `http://www.myfavesite.com/are%20you%20there%3F` 指向名为 "are you there?" 的文件，位于 [www.myfavesite.com](http://www.myfavesite.com)。`%20` 代码防止空格打断 URL，而 `3F` 防止文件名中的问号被解释为特殊的 URL 字符。

### 备注

*由于百分号用于这种编码机制，它本身是特殊的。当遇到它时，下一个值被解释为字符编码。因此，要嵌入一个字面百分号，它必须编码为 `%25`*。

再次强调，这些编码有时被滥用于恶意目的，遗憾的是，例如使用它们来表示常规 ASCII 字符以隐藏 URL。

# URL 方案和方案特定语法

如前几节所述，URL 使用一种通用语法，该语法描述了访问 TCP/IP 资源的位置和方法：

```
<scheme>://<user>:<password>@<host>:<port>/<urlpath>;<params>?<query>#<fragment>
```

每个访问方法，称为 *方案*，都有自己的特定 URL 语法，包括该方法识别资源所需的各种信息。RFC 1738 包含了几个流行 URL 方案使用的特定语法的描述。其他方案已在后续的 RFC 中定义，这些 RFC 使用了为 URL 方案注册建立的程序。

几个 URL 方案使用本章前面 图 70-1 的示例。此图显示了一个包含一般方案语法的几乎所有可能元素的示例 URL，每个元素都使用阴影框突出显示。此 URL 识别一个必须使用特定密码通过 www.mysite.org 站点访问的端口 8080 的 Web (HTTP) 资源。在这种情况下，资源是位于站点 cgi-bin 目录中的 PHP 程序，它会导致显示特定的照片页面。<fragment> 指定器将导致在检索到的婚礼照片页面中显示图片 Reception07。") 中所示的共同互联网模式。其他方案使用完全不同的（通常更简单）结构，这些结构基于它们的需求。

以下各节描述了最常见的 URL 方案以及它们使用的方案特定语法。

## 万维网/超文本传输协议语法 (http)

Web 可能使用共同互联网方案语法的几乎所有元素，如下所示：

```
http://<`user`>:<password>@<host>:<port>/<url-path>?<query>#<bookmark>
```

如资源标识符概述中所述，Web 是目前使用 URL 的主要应用程序。理论上，URL 可以包含大多数常见的 URL 语法元素，但在实践中，大多数都被省略。大多数 URL 只包含一个主机和资源的路径。端口号通常省略，意味着应该使用默认值 80。`<query>` 构造通常用于从客户端传递参数或信息到 Web 服务器。

我已在第七十九章中提供了关于如何使用 Web URL 的详细说明。

## 文件传输协议语法（ftp）

FTP URL 的语法是：

```
ftp://<user>:<password>@<host>:<port>/<url-path>;type=<typecode>
```

FTP（见第七十二章"))是一个基于命令的交互式协议，因此使用 URL 来访问 FTP 可能看起来有些奇怪。然而，FTP 最常见的用途之一是访问和读取单个文件，这正是 FTP URL 允许客户端快速且轻松地完成的。`<user>` 和 `<password>` 元素用于登录，对于匿名 FTP 访问可以省略。端口号通常省略，默认为标准的 FTP 控制通道端口，21。

`<url-path>` 被解释为一个目录结构和文件名。发出适当的 CWD（更改工作目录）命令进入指定的目录，然后对命名的文件发出 RETR（检索）命令。可选的 `type` 参数可以用来指示文件类型：`a` 表示 ASCII 文件检索或 `i` 表示图像（二进制）文件。`type` 参数通常从 URL 中省略，客户端会根据文件名自动设置正确的模式。

例如，考虑以下 URL：

```
ftp://ftp.hardwarecompanyx.com/drivers/widgetdriver.zip
```

这相当于启动一个 FTP 客户端，匿名连接到 [ftp.hardwarecompanyx.com](http://ftp.hardwarecompanyx.com)，然后切换到驱动器目录并检索文件 widgetdriver.zip。客户端将以二进制模式检索文件，因为它是一个压缩的 ZIP 文件。

还可以使用 FTP URL 获取特定目录内文件的列表。这允许用户通过 URL 链接导航 FTP 服务器的目录结构，找到他们想要的文件，然后检索它。这是通过为 `<url-path>` 指定目录名称并使用带有 `<typecode>` 为 `d` 的 `type` 参数来请求目录列表来完成的。同样，`type` 参数通常省略，当在 URL 中给出目录名称时，软件会自动确定发送 LIST 命令到服务器。

## 电子邮件语法（mailto）

定义了一种特殊的语法，允许 URL 表示向用户发送邮件的命令：

```
mailto:<email-address>
```

电子邮件地址（见第七十五章)采用标准互联网格式：*<用户名>@<域名>*。这实际上是一种非常不寻常的 URL 类型，因为它根本不表示任何对象，尽管一个人可以被看作是一种资源。请注意，可选参数，如电子邮件的主题，也可以包含在 `mailto` URL 中。然而，这种功能并不常用。

## Gopher 协议语法（gopher）

Gopher 协议的语法类似于 HTTP 和 FTP：

```
gopher://<host>:<port>/<gopher-path>
```

有关 Gopher 协议的更多信息，请参阅第八十六章）。

## 网络新闻/Usenet 语法（news）

为 Usenet 新闻组访问定义了两种语法：

```
news://<newsgroup-name>
news://<message-id>
```

这两种 URL 都用于访问 Usenet 新闻组（见第八十五章"))或特定消息，通过消息 ID 进行引用。像 `mailto` 方案一样，这是一种特殊的 URL 类型，因为它定义了访问方法，但并不提供描述如何定位新闻组或消息的详细信息。

根据定义，这种 URL 的第一种形式被解释为本地。例如，`news://alt.food.sushi` 的意思是，“在本地新闻服务器上访问新闻组 alt.food.sushi，使用默认的新闻协议。”默认新闻协议通常是网络新闻传输协议（NNTP）。第二种 URL 形式是全局的，因为消息 ID 在 Usenet 上是唯一的（或者至少，它们应该是这样的！）。

## 网络新闻传输协议语法（nttp）

`nntp` 形式是新闻访问的不同 URL 类型：

```
nntp://<host>:<port>/<newsgroup-name>/<article-number>
```

与 `news` 不同，这种 URL 形式明确请求使用 NNTP（见第八十五章"))并标识一个特定的 NNTP 服务器。然后它告诉服务器要访问哪个新闻组以及该新闻组中的哪个文章编号。请注意，每个服务器使用不同的序列来编号文章，因此这仍然是一种本地新闻寻址形式。端口号默认为 119。

虽然 `nntp` 形式似乎提供了更完整的资源规范，但 `news` URL 更常被使用，因为它更简单。一旦在客户端软件中设置适当的 NNTP 服务器，就更容易一次设置好，而不是每次都指定它，因为客户端通常只使用一个 NNTP 服务器。

## Telnet 语法（telnet）

这种语法用于打开到服务器的 Telnet 连接（见第八十七章)：

```
telnet://<*`user`*>:<*`password`*>@<*`host`*>:<*`port`*>
```

实际上，用户名和密码通常被省略，这会导致 Telnet 服务器提示此信息。或者，可以提供`<user>`并省略密码（以防止其被看到），服务器将只提示密码。端口号默认为 Telnet 的标准端口 23，也经常被省略。

这种类型的 URL 很有趣，因为它标识的资源不是对象，而是一种服务。

## 本地文件语法（file）

对于引用特定主机计算机上的文件，使用一种特殊的 URL 类型。标准语法是：

```
file://<*`host`*>:<*`url-path`*>
```

这种类型的 URL 也有些有趣，因为它描述了对象的位置，但没有描述访问方法。它并不足够通用，无法允许在互联网上的任何地方访问文件，但通常用于引用局域网（LAN）上已分配给不同设备的计算机上的文件。

还定义了一种特殊的语法来专门引用本地计算机上的文件：

```
file:///<*`url-path`*>
```

在这里，整个`//<host>:`元素已被替换为一组三个斜杠，意味着在本地主机上查找。

## 特殊语法规则

浏览器通常使用一些额外的语法规则来支持微软操作系统的怪癖，尤其是对于文件方案。首先，微软 Windows 使用的反斜杠在 TCP/IP 要求下被表示为正斜杠。其次，由于在微软操作系统中，冒号用于驱动器字母的指定，因此这些被替换为垂直管道字符（|）。

因此，要引用文件 C:\WINDOWS\SYSTEM32\DRIVERS\ETC\HOSTS，可以使用以下 URL：

```
file:///C|/WINDOWS/SYSTEM32/DRIVERS/ETC/HOSTS
```

然而，请注意，一些浏览器实际上确实允许在驱动器指定中使用冒号。

# URL 相对语法和基本 URL

到目前为止所描述的 URL 语法有时被称为指定*绝对 URL*。这是因为 URL 中的信息足以完全识别资源。因此，绝对 URL 具有上下文无关的特性，这意味着用户可以使用 URL 访问和检索资源，而无需任何额外信息。

整个 URL 的目的在于提供定位和访问资源所需的信息，因此我们希望它们在大多数情况下具有绝对的定义是合理的。绝对 URL 的问题在于它们可能很长且繁琐。有些情况下，需要识别许多彼此相关的不同资源；这些资源的 URL 通常有许多共同元素。在这种情况下使用绝对 URL 会导致大量多余的冗余文字。

在本章开头对 URI 的概述中，我给出了一个关于 URL 的现实世界类比，即描述一个人获取一本书的访问方法和位置：“乘坐火车去阿尔伯克基，然后乘坐 11 路公交车到 41 号阿尔伯特街，这是一座由乔安妮·约翰逊拥有的红砖房。你想要的书在二楼书架最右边第三本。”

如果我还想让同一个人在拿到第一本书后，在同一个房子的底层再拿第二本书，我应该先再说一遍，“乘坐火车去阿尔伯克基，然后乘坐 11 路公交车到 41 号阿尔伯特街，这是一座由乔安妮·约翰逊拥有的红砖房”吗？为什么麻烦，因为他们已经在那个房子里了？不，我会用相对术语给出第二个指令：“下楼，并在木桌上拿那本蓝色的书。”这个指令只有在原始上下文中才有意义。

在 URL 中也存在同样的需求。考虑一个位于 `http://www.longdomainnamesareirritating.com/index.htm` 的网页，其中包含 37 个嵌入的图形图像。负责维护这个网站的可怜家伙不想在每个图像的 URL 前面都加上 `http://www.longdomainnamesareirritating.com/`。

同样，如果我们刚刚在 `ftp://ftp.somesitesomewhere.org/very/deep/directory/structures/also/stink/` 上获取了一个目录列表，我们想要探索父目录，我们只想说“向上一级”，而不必说 `ftp://ftp.somesitesomewhere.org/very/deep/directory/structures/also/`。

正是因为这些原因，URL 语法被扩展以包括相对形式。用最简单的话说，相对 URL 与绝对 URL 相同，但省略了由上下文暗示的信息部分。就像我们的“下楼”指令一样，相对 URL 本身并不包含足够的信息来指定资源。相对 URL 必须在提供缺失信息的上下文中进行解释。

## 相对 URL 的解释规则

从相对 URL 中查找资源所需的上下文以基本 URL 的形式提供，该基本 URL 提供了缺失的信息。基本 URL 必须是特定的绝对 URL，或者本身是另一个相对 URL，该相对 URL 指向某个其他绝对基本 URL。基本 URL 可以明确声明，也可以从使用中推断出来。处理 URL 的 RFC 定义了以下三种确定基本 URL 的方法，按列出的优先级顺序：

**文档内的基本 URL** 一些文档允许显式地声明基本 URL。如果存在，则此规范用于文档中的任何相对 URL。

**从封装实体获取基 URL** 在没有在文档中指定显式基 URL，但该文档是包含它的更高级别实体的部分的情况下，基 URL 是父文档的 URL。例如，MIME 多部分消息的正文部分中的文档（见第七十六章 展示了一些相对 URL 的示例以及它们的解释。

表 70-2. 相对 URL 规范和绝对等效

| 相对 URL | 等效绝对 URL | 说明 |
| --- | --- | --- |
| #bookmark2 | http://site.net/dir1/subdir1/file1?query1#bookmark2 | URL 与基本 URL 相同，除了书签不同。这可以在 HTML 中引用同一文档中的不同位置。技术上，这里的 URL 没有改变，因为片段（书签）不是实际 URL 的一部分。当浏览器接收到一个新的书签名称时，通常不会尝试重新访问资源。 |
| ?query2 | http://site.net/dir1/subdir1/file1?query2 | 与基本 URL 提供的相同文件，但带有不同的查询字符串。请注意，从基本 URL 中移除了书签引用。 |
| file2 | http://site.net/dir1/subdir1/file2 | 这指的是使用名称 file2 的文件，它替换了基本 URL 中的 file1。在这里，查询和书签都被移除了。 |
| /file2 | http://site.net/file2 | 由于包含了一个单斜杠，这意味着 file2 在根目录中。这个相对 URL 替换了基本 URL 中的整个`<url-path>`。 |
| .. | http://site.net/dir1/ | 这对点表示基本 URL 中的父目录。由于基本 URL 中的目录是 dir1/subdir1，这指的是 dir1/。 |
| ../file2 | http://site.net/dir1/file2 | 这指定了我们应该向上移动到父目录以在 dir1 中找到文件 file2。 |
| ../subdir2/file2 | http://site.net/dir1/subdir2/file2 | 这表示通过..向上移动一个目录，然后进入子目录 subdir2 以找到 file2。 |
| ../../dir2/subdir2/file2 | http://site.net/dir2/subdir2/file2 | 这与上一个例子相同，但向上移动两个目录层级，然后通过 dir2 和 subdir2 找到 file2。 |
| //file2 | http://file2 | 两个斜杠意味着 file2 替换了主机名，导致主机名右侧的所有内容都被删除。这可能不是预期的结果，这也显示了监视那些斜杠的重要性。 |
| //www.newsite.net/otherfile.htm | http://www.newsite.net/otherfile.htm | 在这个例子中，除了方案之外的所有内容都被替换了。在实践中，这种相对 URL 的形式并不常见——如果指定了站点名称，通常包括方案，以保持完整性。 |
| file2?query2#bookmark2 | http://site.net/dir1/subdir1/file2?query2#bookmark2 | 这替换了文件名、查询名和书签名。 |
| ftp://differentsite.net/whatever | ftp://differentsite.net/whatever | 使用新的方案迫使 URL 被解释为绝对 URL。 |

相对 URL 只对某些 URL 方案有意义。对于其他方案，它们没有意义，也无法使用。特别是，相对 URL 永远不会用于`telnet`、`mailto`和`news`方案。它们在 HTTP 文档中非常常见，也可能用于 FTP 和文件 URL。

顺便提一下，使用相对 URL 的另一个非常重要的好处是：在文档中避免使用绝对 URL 可以使它更具可移植性，通过消除可能更改的名称的硬编码引用。回到我们之前的例子，如果维护`http://www.longdomainnamesareirritating.com`站点的人只使用相对链接来引用图形和其他嵌入对象，那么如果该站点迁移到[www.muchshortername.com](http://www.muchshortername.com)，他就不需要编辑所有指向新名称的链接。在详细讨论 HTTP URL 的第七十九章中进一步探讨了这一点在 Web URL 中的重要性。

### 小贴士

**关键概念** 除了比绝对 URL 更高效之外，相对 URL 的优势还在于它们允许资源设计者避免具体提及名称。这增加了文档在站点内或站点之间的可移植性。

# URL 长度和复杂性问题

由于一些非常好的原因，URL 是某些资源寻址的最普遍形式：它们代表了一种简单、方便且易于理解的查找文档的方式。由于在 Web 上的广泛应用，URL 现在可以在从电子文档列表到电视广告的任何地方看到——这是它们普遍性和易用性的证明。

至少，这在大多数情况下是正确的。

当 URL 工作良好时，它们工作得非常好。不幸的是，关于 URL 的使用方式也存在一些担忧。URL 的误用，无论是偶然的还是故意的，都时有发生。我之所以投入大量精力来描述 URL，部分原因是因为大多数人并不真正理解它们是如何工作的，这也是问题发生的一部分原因。

许多与 URL 相关的问题直接源于长度和复杂性的相关事项。当 URL 简短且简单时，它们工作得最好，这样就可以清楚地知道它们的内容，并且易于操作。例如，`http://www.ibm.com`几乎每个人都能认出这是国际商业机器公司（IBM）的网站。同样，你可能不需要任何解释就能猜出这个 URL 的功能：`ftp://www.somecomputercompany.com/drivers/videodrivers.zip`。

然而，正如你在本章前面看到的，URL 可以更加复杂。特别是，HTTP 和 FTP 等协议使用的常见互联网语法非常灵活，包含大量可选元素，当需要提供特定资源访问所需的信息时可以使用。

URL 语法中许多元素是可选的这一点很重要。大多数时候，这些可选部分都被省略了，这使得 URL 在实际使用中比在描述中简单得多。例如，尽管 HTTP URL 理论上包含用户名、密码、主机、端口、路径、查询和书签，但大多数 URL 只使用主机名和路径。这正是帮助保持 URL 简短和易于使用的原因。

尽管如此，你仍然会在互联网上找到一些相当长的 URL，原因多种多样：

**长 DNS 域名和主机名** 有些人没有意识到长主机名很难记住。如果你经营着超级汽车车身修理店和比萨店，拥有一个名为 www.superauto.com 的网站将比尝试注册 www.superautobodyshopandpizza.com 更容易让顾客找到你。然而，15 个、20 个甚至更多字符的 DNS 名称却很常见。

**长文档或目录名称** 同样，短文件名比长文件名好，而且很多人在将文件上传到互联网之前并没有考虑这一点，这给必须访问它们的人带来了更多困难。

**使用不安全字符** 如本章前面所述，URL 有一个处理不安全字符的机制，但这会使它们更长且更难解读。如果你有一个名为"{ABC Corp} budget; draft #3; third quarter 2004.htm"的文件，它的 URL 将不得不是`%7BABC%20Corp%7D%20budget%3B%20draft%20%233%3B%20third%20quarter%202004.htm`。原始的长文件名是可读的，但 URL 却是一团糟。将文件命名为"ABC budget draft 3, 3Q2004.htm"会是一个更好的选择，并且仍然包含足够的信息以便理解。甚至更好，你可以用下划线替换空格，从而完全避免需要`%20`编码："ABC_budget_draft 3,_3Q2004.htm"。

**参数字符串** 在 HTTP URL 中，指定查询（跟随问号字符）的语法通常用于允许网络浏览器向网络服务器发送各种类型的信息，特别是交互式查询的参数。这些参数字符串可能相当长。例如，我输入了一个查询到伟大的网络搜索引擎 Google，以找到土豆沙拉的食谱。这是其中一个食谱文件的 URL 看起来像这样：

```
http://groups.google.com/groups?q=%22potato+salad%22&hl=en&lr=&ie=
UTF-8&safe=off&selm=B826FB57.89C0%25sbrooks%40ev1.net&rnum=2
```

几乎所有的内容都是由参数组成的，这些参数告诉 Google 服务器根据我的查询我想要的确切文档。这是必要的，但仍然很繁琐。

## URL 换行和界定

对于人类来说，长而复杂的 URL 很难记住和使用。除了记住所有这些字符的纯粹难度外，还有 URL 换行的问题，这发生在它们以某些形式呈现时。大多数程序只能在单行中显示 78 个或 80 个字符。如果一个 URL 比这个长，URL 的字符将换行到多行；当你阅读那个 Google 参数字符串的例子时，你可能注意到了这一点。

URL 的换行可能导致在从一个表单复制到另一个表单时出错，例如如果你从这份文档中复制到你的网络浏览器中。如果一个 URL 有 81 个字符长，其中 80 个在第一行，最后一个字符在第二行，许多用户可能没有意识到 URL 已经换行了。我见过数百个字符长的 URL，需要多次手动复制粘贴才能使 URL 生效。

比起意料之外，一些软件可能也无法正确处理这种换行。虽然当在 HTML 文档等中使用超链接时这不是问题，但当链接包含在电子邮件消息或 Usenet 文章中时，可能会很麻烦。

另一个问题是在文本中出现时如何界定 URL 的开始和结束。理论上，URL 以方案名称开头，可能被用于不是 URL 的其他上下文中。如果没有明确的方法来标记一个 URL 为 URL，那么一个软件程序可能无法识别它。考虑在类似这份文档中讨论一个 URL 的情况。如果我这么说，“请访问[`www.thissite.com`](http://www.thissite.com)；你将在那里看到你需要的信息，”我们都知道分号是句子的一部分，而不是 URL 的一部分，但一个计算机程序可能并不这么确定。而且，当 URL 很长且复杂，并且跨越到多行文本时，这个问题会更严重。程序如何识别 URL 的结束？

## 明确的 URL 界定和重定向器

为了解决换行和界定问题，有时会采用特殊的 URL 超级语法，尤其是在 URL 用于其他文本时。这是通过在 URL 周围放置尖括号来完成的，可能包括在方案名称之前包含标签`URL:`。例如，以下所有内容都是等效的：

```
http://www.networkingistoodarnedcomplicated.com
<http://www.networkingistoodarnedcomplicated.com>
<URL:http://www.networkingistoodarnedcomplicated.com>
```

角标清楚地指出了 URL 的开始和结束位置，这使得程序和人类处理长 URL 都变得更加容易。

对于长 URL，有时会使用由许多网站提供的重定向服务作为另一种解决方案。例如，[`www.tinyurl.com`](http://www.tinyurl.com) 是一项免费服务，允许某人创建一个简短的 URL，该 URL 会自动加载一个更长的 URL 中的资源。

## URL 缩写

我想要讨论的最后一个问题与长或复杂的 URL 没有直接关系，但与长度问题间接相关：URL 缩写。许多人经常使用 URL，以至于在指定 URL 时变得懒惰。他们倾向于省略完整的 URL 语法的一部分以节省时间和精力。我并不是说他们指定了相对 URL，而是他们指定了缺少部分的绝对 URL。

例如，人们可能不会输入 `http://www.sitename.com`，而是输入 `http:www.sitename.com`，省略了两个斜杠。更常见的是，人们完全省略方案名称，仅输入 `www.sitename.com`。从技术上讲，这并不是一个 URL——它只是一个域名。然而，大多数网络浏览器都可以处理这种情况，默认情况下假设如果没有提供方案，则方案是 `http://`。

# URL 隐藏、混淆和一般诡计

大多数时候，资源的所有者希望指向资源的 URL 简短、简单且易于理解。因此，长而复杂的 URL 通常是必需、意外或无知的结果。有些资源需要具有长名称的特定原因，例如前面提到的 Google 示例中的长查询字符串；有时，URL 之所以变长，是因为资源所有者没有意识到使用长的 DNS 主机名或文件名将导致长而难以管理的 URL。

无论这些情况的原因是什么，它们都不是故意的。然而，近年来，故意使用长、复杂、令人困惑且具有欺骗性的 URL 的使用急剧增加。这些 URL 要么结构得让人无法判断它们是什么，或者更糟糕的是，它们被设计成指向一个资源，而实际上却指向另一个资源。

为什么人们会这样做呢？因为他们不想公开诚实地关于他们的“资源”。这些人会是谁呢？哦，他们就是那些用各种可能的提议塞满我们的互联网邮箱的垃圾邮件发送者和骗子，从让你梦想成真地变得富有到将某些身体部位膨胀到不自然的大小。

他们担心，如果 URL 清楚地表明了“资源”是什么，你可能不会点击链接，或者如果你将它们识别为垃圾邮件发送者，你可能会过滤掉他们的电子邮件。他们还认为，如果他们能让 URL 看起来很有趣，你就会加载它。即使结果是你没有预料到的，也许你仍然会注意它。

你可能认为你太聪明了，不会因为一个欺骗性的 URL 而被骗购买产品。而且你无论如何也不会支持垃圾邮件发送者。多么巧合——对我来说也是一样！然而，垃圾邮件还在源源不断地来。它一定有效，否则他们不会继续这样做……是吗？

这种复杂的语法被嵌入到 URL 中，以使其具有如此灵活性，这本身就是一个残酷的讽刺。骗子知道大多数人习惯于看到简单的 URL，如`http://www.myfavoritesite.com`，并且没有意识到完整的 URL 语法实际上允许以文字上数百万种不同的方式指定相同的资源。因此，为了不惜一切代价增加网站的点击量，他们不断想出新的 URL 操纵技巧。这些技巧主要集中在 HTTP 方案 URL 上，尽管在理论上，这些技巧也可以应用于其他几种类型（尽管它们不会与某些方案一起工作）。

这里有一些更常见的花招，人们曾经使用过（注意，如果你在阅读时尝试这些，某些示例在某些浏览器上可能无法工作）：

**过长的 URL** 在某些情况下，URL 会因为添加大量无意义的查询字符串而变得非常长，以至于用户仅仅看一眼就会感到眼花缭乱。然而，这种技术相对简单，因为你可以通过查看 URL 的开头很容易地判断出真正的域名。然而，大多数更好的骗子现在已经超越了这种简单的伎俩。

**常规 IP 地址主机** 互联网用户已经习惯了使用 DNS 名称，以至于他们没有意识到可以使用 IP 地址访问 URL。所以，大多数人没有意识到《PC 指南》可以通过`<http://209.68.14.80>`和`<http://www.PCGuide.com>`一样容易访问。（注意，这并不是所有互联网主机的通用情况；使用虚拟名称的主机不能仅通过 IP 地址访问。）这实际上并不是什么诡计。这是完全合法的，而且在某些方面，甚至可以说是必要的；例如，访问有 DNS 问题的网站。这里的问题是，通常你无法仅从 IP 地址判断出网站是什么，许多人会直接点击 IP 地址链接，而不费心去了解它是什么。

**数字域名** 可以注册只包含单个数字的 DNS 域名。例如，可以注册 114.com。然后你可以在其中创建子域名，如 42.12.205.114.com。乍一看，这似乎是一个 IP 地址规范，所以有人可能会认为它会解析到地址 42.12.205.114，但实际上是另一个地址。我相信 DNS 名称注册商已经开始打击这种诡计，所以它可能不像以前那样普遍了。

**虚假认证信息** HTTP URL 理论上支持在 URL 中包含认证信息，通过在主机之前包含`<user>:<password>@`。然而，绝大多数网站都是开放的，既不需要也不使用这类信息。如果你指定了一个不需要的认证字符串，它将被忽略。一种滥用这种方法的方式是包含看起来无害的主机“认证信息”，以使用户认为 URL 是针对该主机的。例如，如果我想骗你访问 PC 指南，我可能会使用这个 URL 来让它看起来像点击它就会去 CNN：《http://www.cnn.com@www.PCGuide.com》。然而，这种方法仍然太明显了，所以通常还会结合以下一些技术。

**欺骗性字符编码** 使用百分号来编码特殊字符，如空格和标点符号，也可以被滥用以隐藏域名名称。例如，以下是以另一种方式表示 PC 指南 DNS 名称的方法：《http://%57%57%57.%50%43%47%55%49%44%45.%43%4F%4D》。试试看！

**IP 地址数学技巧** 好吧，这里事情变得真的很奇怪。大多数时候，我们用点分十进制数来表示 IP 地址。然而，记住，对于计算机来说，IP 地址只是一个 32 位的二进制数。大多数浏览器支持相当多的方法来表示这些数字。这是不幸的，因为这种灵活性实际上并不需要，而且几乎从未用于合法目的。它可能导致一些非常奇怪的 URL，这些 URL 无法识别，或者看起来像常规的 IP 地址但实际上不是。以下是一些例子，它们都与 PC 指南的 IP 地址形式相同（《http://209.68.14.80》）：

+   点分八进制的 IP 地址使用一个前导零来表示每个字节在八进制中的位置，例如 `<http://0321.0104.016.0120>`。

+   点分十六进制的 IP 地址使用一个前导零后跟一个*x*来表示每个字节在十六进制中的位置，例如 `<http://0xD1.0x44.0x0E.0x50>`。

+   我们甚至可以将整个 32 位数字作为一个单独的数字来表示，这同样也是可行的。在十进制中，这看起来就像 `<http://3510898256/>`；在八进制中，`<http://032121007120/>`；在十六进制中，`<http://0xd1440e50/>`。

就算这些技巧单独使用已经足够糟糕了，我们还可以通过组合它们来玩得更开心！例如，从一个普通的 PC 指南 URL 开始：

```
<http://www.PCGuide.com>
```

然后将其转换为 IP 地址：

```
<http://209.68.14.80>
```

然后添加一些虚假的认证信息：

```
<http://www.cnn.com@209.68.14.80>
```

然后将真实的 URL 转换成一个单独的数字，使其看起来像 CNN 网站上的文档：

```
<http://www.cnn.com@3510898256>
```

或者，我们可以使用八进制形式，甚至为了好玩而包含很多额外的额外前导零：

```
<http://www.cnn.com@0000000000000321.00000000104.00000000000016.00000120>
```

信不信由你，这仅仅是冰山一角。在某些浏览器中，甚至可以使用百分号 ASCII 编码来表示 IP 地址数字！

虽然相当令人烦恼，但我必须至少给这些人一些创意分——其中一些技巧相当巧妙。同时，他们的创新性可能具有潜在的危险性。虽然这些虚假的 URL 通常更多的是浪费时间而不是有害，但有时人们有充分的理由不遗余力地隐藏资源的身份。欺骗性的 URL 只是网络管理员今天必须应对的又一危险。

### 小贴士

**关键概念** 互联网 URL 的语法包括许多元素，这些元素为 URL 的构建提供了极大的灵活性。不幸的是，这些表达能力现在经常被那些故意创建模糊不清的 URL 以欺骗用户访问他们的网站和其他资源的人滥用。其中一些可能具有潜在的危险性，这意味着在点击未知链接或访问奇怪的 URL 之前需要谨慎。

# URNs

"HTTP 404 - NOT FOUND"

你是否曾经尝试访问一个网站或其他互联网资源，结果却看到了那些令人恐惧的字眼？你可能有过，而且在你看到它们的时候，你亲自体验到了 URL 最常见的问题之一。

URL 通过使用两关键信息来指定资源：资源的位置以及访问或检索资源的方法。这种对资源访问手段的关注使得 URL 非常实用，因为 URL 通常包含我们使用资源所需的所有数据。这就是为什么 URL 今天被广泛使用的原因。然而，这种访问导向也意味着 URL 存在许多严重的局限性。

## URL 的问题

URL 的主要困难在于，由于它们基于资源的位置来描述资源，它们将资源和其位置不可分割地联系在一起。虽然这看起来可能不是什么大问题，但实际上在许多方面都是一个相当严重的问题，因为资源和其位置并不是同一件事。正是因为大多数互联网资源很少改变位置，所以我们没有在 URL 上更频繁地注意到这个问题。

假设你的名字是 Joe Xavier Zachariah，你住在澳大利亚悉尼的 44 Glendale Crescent。如果有人问你你是谁，你会说，“Joe Xavier Zachariah”，还是“住在澳大利亚悉尼 44 Glendale Crescent 的人”？几乎可以肯定，你会提供前者答案。但 URL 就像用后者描述来描述自己作为一个“资源”一样。

由于我们意识到扎卡里亚先生显然不会总是住在 44 Glendale Crescent，我们知道仅用地点来描述他是不够的。当互联网资源仅使用位置来标识时，也会发生同样的事情。

然而，互联网资源和 URL 的问题不仅仅在于移动性。考虑这样一种情况，一个特定的资源非常受欢迎，我们想在多个位置复制相同的资源。使用 URL，我们需要为资源的每个副本提供一个不同的标识符，尽管每个副本都是相同的。再次强调，问题在于我们并没有识别资源本身，而是在识别资源所在的位置。

为了解决 URL 的这个问题，开发了一种用于互联网资源的替代识别机制，称为*统一资源名称（URNs）*。

## URN 概述

描述 URN 的基本标准是 RFC 1737，“统一资源名称的功能要求”，该标准于 1994 年发布。1997 年，发布了 RFC 2141，它指定了 URN 的语法。

如您可能从该术语中看出，URN（统一资源名称）旨在根据其实际身份来标记资源，而不是根据其所在位置。因此，一个 URL 就像乔·扎卡里亚的地址一样，而一个 URN 则是他的名字。或者，正如我在本章开头关于 URI 概述中给出的例子，一个 URN 会根据 ISBN 号码来识别一本书，而不是指定它在建筑物中的哪个书架上。

要在识别特定资源时有用，URN 必须是全局唯一的，这并不像最初看起来那么简单。例如，考虑人名。尽管可能整个世界上只有一个查尔斯·马尔林·科齐罗克，但如果你的名字是约翰·保罗·史密斯或何塞·加西亚，你很可能与成千上万的人共享这个名字。这意味着使用通用名称可能不足以识别人类“资源”，可能需要设计其他方法。

## URN 命名空间和语法

URNs 旨在在互联网上识别许多类型的资源，每种资源可能需要不同的命名形式。为了使 URN 能够表示多种类型的资源，定义了大量的*URN 命名空间*。

命名空间通过一个独特的字符串来引用，这个字符串告诉解释 URN 的人或计算机该 URN 标识的是哪种类型的资源。命名空间还确保了 URN 的唯一性，当特定的标识符可能在多个上下文中存在时。例如，北美电话号码和 ISBN 号码都由十个数字组成，所以像 4167819249 这样的特定数字可能代表一个电话号码和一个书号。命名空间标识符告诉我们当在 URN 中遇到这个数字时它代表什么。

URN 的一般语法如下：

```
URN:<namespace-ID>:<resource-identifier>
```

例如，ISBN 号码为 0-679-73669-7 的书籍可以表示为`URN:isbn:0-679-73669-7`。这个字符串唯一地标识了这本书，无论它可能在世界上的哪个地方。还定义了许多其他命名空间来指定其他类型资源的 URN，例如互联网上的文档。

### 小贴士

**关键概念** 与 URL 通过访问方法和位置指定资源不同，统一资源名称（URNs）通过名称来标识资源。一个 URN 由一个命名空间标识符组成，它指示该名称包含的类型，以及一个资源标识符，它指定了在该命名空间上下文中的单个资源。

## URN 解析和实施困难

URNs 是识别资源的一种更自然的方式，这使得它们具有直观的吸引力。尽管如此，URN 仍然没有被广泛使用，尽管它们已经开发超过十年。主要原因多少有些讽刺：这是因为 URN 与位置无关！正是提供 URN 相对于 URL 识别优势的这种特性，也使得 URN 在实际使用中更加困难，这导致了可行的 URN 系统工作上的长期延迟。

要理解这个问题，可以考虑例子 `URN:isbn:0-679-73669-7`。这个例子唯一地标识了一本特定的书，并且无论这本书在哪里，它都会指向这本书，这与 URL 不同。问题是，虽然 URL 等价物告诉我们如何实际找到这本书，但 URN 并不提供这样的信息。对于我们之前的例子：通过名字识别乔·泽卡利亚·泽赫里亚斯比通过他在澳大利亚悉尼格林代尔克里森特 44 号居住的人更合理，但至少后者我们知道乔在哪里！

为了使 URN 在互联网上变得有用，它们需要一个额外的机制来将简单的 URN 标识字符串转换为特定的位置和/或访问方法。换句话说，我们需要能够将 URN 转换为等效的 URL，以便找到资源。这一需求与将互联网 DNS 域名解析为 IP 地址的问题类似，并且使用相同的术语来描述它：*URN 解析*。

理想情况下，我们希望能够使用某种技术，当我们指定名字乔·泽卡利亚·泽赫里亚斯时，我们被告知乔在哪里，这样我们就可以找到他。或者，我们提供字符串 `URN:isbn:0-679-73669-7`，我们得到一份可以找到这本书的图书馆或其他地点的列表。URN 的力量也可以在这种系统中得到利用，通过让解析系统指定资源副本的位置，该位置对于发起请求的实体来说是最接近的（从网络距离、成本或其他测量标准来看）。

然而，设置 URN 解析机制是一个非平凡的任务。过去十年中关于 URN 的大部分工作都集中在 URN 解析问题上。1999 年发布的 RFC 2483，“为 URN 解析必要的 URI 解析服务”讨论了 URN 解析的一些重要问题。2002 年 10 月，一系列 RFC，3401 到 3405，定义了一个新的系统，称为*动态委派发现系统（DDDS）*，它不仅旨在解析 URN，还旨在处理整个类别的解析问题，即给定一个标识符，输出是关于如何获取该标识符更多信息的信息。同时发布的 RFC 3406 提供了更多关于 URN 命名空间的信息。

### 小贴士

**关键概念** 由于 URN 通过名称而不是位置来标识资源，因此它们比使用 URL 更自然地标识资源。不幸的是，这个优势也是劣势，因为 URN 本身并不提供用户找到资源并使用所需的信息。必须执行 URN 解析过程，将 URN 转换为允许访问资源的一组信息。

尽管 URN 的进展缓慢，但却是稳定的。虽然可能还需要几年时间才能广泛使用 URN，但我相信它们在未来很可能在互联网资源标识中扮演越来越突出的角色。

# 第七十一章. 文件和消息传输概述及应用类别

![无标题图片](img/httpatomoreillycomsourcenostarchimages287681.png.jpg)

网络应用的目的允许不同类型的信息在网络设备之间发送。在计算机的世界里，信息通常被组织成称为*文件*的离散单元。当这些文件专门为通信目的创建时，它们通常被称为*消息*。

在网络计算机之间传输文件和消息是最基本的网络通信类型。因此，说*文件和消息传输应用*可能是最重要的互联网互连应用类别并不过分。这个群体的一些成员非常普遍，以至于许多人每天都在使用它们，甚至没有意识到。

在本章简短的介绍中，我概述了文件和消息传输背后的概念，以及不同的应用如何处理它们。我首先讨论了文件背后的通用概念，然后讨论了使用它们的应用程序类别，对比了消息传输与文件传输。

# 文件概念

要理解文件和消息传输应用，让我们首先快速回顾一下文件的基本概念。简单来说，文件就是由计算机系统视为单一单元的信息集合。

文件存储在文件系统中的目录或文件夹中。在现代计算机中，文件通常表示为一系列字节或字符的序列，每个文件作为一个独立对象被读取、写入、复制或以其他方式操作。除了包含的数据外，每个文件还关联着描述它的文件*属性*。

对于我们的目的来说，文件的关键特性是它是一个包含任意信息的自包含对象。由于文件是计算机系统中信息的构建块，因此网络中信息传输最初是以文件移动来定义的也就不足为奇了。描述如何传输文件的某些协议甚至早于 TCP/IP 低层所有现代协议，包括互联网协议版本 4（IPv4）、传输控制协议（TCP）和用户数据报协议（UDP）。文件传输并不是早期互联网应用的例子，而是互联网的发明在很大程度上是为了允许文件传输！

# 应用类别

现代计算机系统中的文件本质上被设计为通用；它们可以包含任何类型的信息。文件内容的重要性完全取决于检查它的用户或软件程序。TCP/IP 文件和消息传输协议在将文件从一个计算机移动到另一个计算机的概念上是共同的。它们的不同之处在于文件的处理和加工方式。有两种基本方法：文件传输和消息传输。

## 通用文件传输应用

通用传输应用通常将文件视为一个“黑盒”，将它们从一个地方移动到另一个地方，很少或根本不关注文件的内容。TCP/IP 文件传输协议（FTP）和简单文件传输协议（TFTP）属于这一类别。FTP 以一种或另一种形式存在了 30 多年，现在仍然被广泛使用。

## 消息传输应用

其他 TCP/IP 应用与特定类型的文件一起工作，以各种方式处理和解释它们。这些文件通常是为了特定的通信目的而设计的，因此被称为*消息*；这些应用允许用户构建、发送和接收符合特定消息格式的消息。本书将探讨几个突出的 TCP/IP 消息应用。

### 电子邮件（Email）

电子邮件是一个允许用户以类似于传统邮政系统的方式交换“信件”（实际上，任何类型的文档）的系统，但具有速度和简单性的优势。电子邮件并没有完全取代常规邮件，但现在许多人用它来处理他们的大部分通信。

### 网络新闻（Usenet）

Usenet 是一个类似于电子邮件的应用，它允许用户发送消息。然而，尽管电子邮件通常用于允许将消息发送给一个用户或少数几个收件人，网络新闻是一种让成千上万的用户在各个主题上共享消息的方式。

任何用户都可以贡献一个可以被他人看到的消息，任何看到的人都可以回应。与电子邮件不同，收件人不需要被明确标识，这使得网络新闻非常适合于大型群体之间的通信，这些群体可能甚至互不相识。这是第一个创建类似电子公告板的东西的 TCP/IP 应用：一个在线社区。

### 超文本（万维网）

你可能甚至不需要我解释什么是万维网，它在现代互联网中的重要性是如此之大。超文本将信息传递的概念从简单的文本消息或普通文件的交换扩展到包含各种类型信息的丰富消息。这包括文本、图形、多媒体和嵌入文件。

最重要的是，超文本允许一个文档链接到另一个文档，形成相关文档的网络，这就是万维网名称的由来。网络几乎可以肯定是 TCP/IP 应用中最重要的单一应用，每天有数百万人在使用。

## 文件和消息传输方法的融合

近年来，许多发展使得文件传输应用和消息传输应用之间的界限变得非常模糊。电子邮件不再仅限于简单的文本消息；现在可以通过特殊方法将文件编码成文本形式来传输一般文件，甚至可以传输超文本文档。万维网客户端（浏览器）继续得到增强，以便它们可以访问其他类型的服务器和文件，也可以用于一般文件传输。

这些发展意味着 TCP/IP 用户将获得更多的功能和灵活性——而对于你，TCP/IP 学习者来说，则需要更加小心。

### 小贴士

**关键概念** 最重要的 TCP/IP 应用组之一是允许在互联网上的设备之间移动文件的应用：文件和消息传输应用。这个组包含了许多 TCP/IP 用户每天用来通信的常见应用。它可以分为两大类：用于在设备之间移动任何类型文件的通用文件传输应用，以及允许使用特殊文件类型进行不同类型通信的消息传输应用，例如电子邮件消息或超文本文件。
