# 第十八章. 常见网络漏洞

到目前为止，我们很少关注常见网络漏洞的分类。深入了解网络应用的基本机制远比记住几千个随机且往往不必要的术语重要；例如，像*内存缓冲区操作不当限制*（常见弱点枚举）或*不安全的直接对象引用*（开放式网络应用安全项目）这样的术语在合理的对话中找不到位置——这是正确的。

尽管如此，行业已经提出了一些相当精确的短语，安全研究人员每天都在使用。在详细讨论了浏览器的内部工作原理之后，回顾和强调普通读者可能会看到的术语似乎是有用的。

# 专门针对 Web 应用的漏洞

本节中概述的术语仅适用于 Web 上使用的某些技术，并且在“传统”应用安全领域通常没有直接对应物。

**跨站请求伪造（XSRF，CSRF**）

由于未能验证服务器端 Web 应用接收到的特定状态改变 HTTP 请求是否由预期的客户端源发起，从而导致的漏洞。这个缺陷允许任何在浏览器中加载的第三方网站代表受害者执行操作。

+   *参见* 第四章 *以获取关于 XSRF 的更详细讨论*。

**跨站脚本包含（XSSI**）

由于未能确保敏感的类似 JSON 的响应不会被第三方网站通过*<script src=...>*加载，从而导致的缺陷。响应中的用户特定信息可能会泄露给攻击者。

+   *参见* 第六章 *以了解该问题（以及潜在解决方案）的概述*。

**跨站脚本（XSS**）

输入验证不足或输出转义不当可能会允许攻击者在易受攻击的网站上植入自己的 HTML 标记或脚本。注入的脚本将能够访问目标 Web 应用的所有内容，在许多情况下，还能访问客户端存储的 HTTP cookies。

限定词*反射的*指的是注入的字符串仅仅是请求错误回显部分的结果，而*存储的*或*持久的*则指的是有效载荷采取更复杂的路径的情况。*基于 DOM 的*可以用来表示漏洞是由 Web 应用的客户端部分（即 JavaScript）的行为触发的。

+   *参见* 第四章 *以了解 HTML 文档中的常见跨站脚本攻击向量*。

+   *参见* 第六章 *以了解基于 DOM 的 XSS 风险概述*。

+   *参见* 第十三章 *以了解与内容嗅探相关的跨站脚本攻击向量*。

+   *查看* 第九章 了解 JS 代码的正常安全模型的讨论。

**头部注入（响应分割**）

在网络应用服务器端生成的 HTTP 响应中，新行（或等效字符）的转义不足。这种行为通常会导致 XSS、浏览器或代理缓存中毒，以及更多问题。

+   *查看* 第三章 了解缺陷的详细讨论。

**混合内容**

一个总称，用于指在 HTTPS 页面上加载非 HTTPS 子资源。在脚本和小程序的情况下，这种行为使得应用程序对主动攻击者极其脆弱，尤其是在开放的无线网络（如咖啡馆、机场等）上，并且几乎抵消了 HTTPS 的所有好处。与样式表、字体、图像或框架相关的混合内容漏洞的后果通常也相当严重，但更为受限。

+   *查看* 第四章 和 第八章 了解 HTTPS 站点上的内容特定预防措施。

+   *查看* 第十一章 以了解混合内容处理规则的概述。

**开放重定向**

一个术语，用于指那些执行基于 HTTP 或脚本请求到用户提供的 URL 的应用程序，而不以任何有意义的方式限制可能的目的地。开放重定向不建议使用，在某些情况下可能可利用，但本身通常并不特别危险。

+   *查看* 第十章 了解不受限制的重定向可能导致 XSS 的案例。

**Referer** **泄露**

通过嵌入外部子资源或提供外部链接意外泄露敏感 URL。父文档 URL 中编码的任何与安全或隐私相关的数据都将泄露在*Referer*头中，除了片段标识符。

+   *查看* 第三章 了解* Referer *逻辑的详细讨论。

# 网络应用设计时需要注意的问题

本节中概述的问题是在互联网上开展业务不可避免的情况，在设计或实施新的网络应用时必须妥善考虑。

**缓存中毒**

长期污染浏览器缓存（或任何中间代理）中目标网络应用的虚构、恶意版本的可能性。由于响应分割漏洞，加密网络应用可能成为目标。对于非加密流量，主动的网络攻击者也可能能够修改请求者收到的响应。

+   *查看* 第三章 了解 HTTP 缓存行为的概述。

**点击劫持**

框架或以其他方式装饰或掩盖另一个 Web 应用程序的一部分，使得受害者在与攻击者的网站交互时，不会意识到单个点击或按键操作被发送到另一个网站，从而导致对用户不利的操作。

+   *参见第十一章以讨论点击劫持和相关 UI 问题。

**内容和字符集嗅探**

描述了浏览器可能会忽略服务器提供的任何权威内容类型或字符集信息，并错误地解释返回的文档的可能性。

+   *参见第十三章以讨论内容嗅探逻辑。

+   *参见第四章和第八章以了解*Content-Type*数据被忽略的场景。

**Cookie 强制（或 Cookie 注入）**

由于现代浏览器中机制的设计和实现存在问题，可能导致盲目地将 HTTP Cookie 注入到其他方面坚不可摧的 Web 应用程序的上下文中。Cookie 注入对 HTTPS 应用程序尤其关注。（*Cookie 填充*是一个较少使用的术语，指的是通过溢出 cookie 容器恶意删除属于另一个应用程序的 cookie。）

+   *参见第九章以获取有关 cookie 作用域的更多信息。

+   *参见第三章以了解 HTTP Cookie 的一般操作。

**拒绝服务（DoS）攻击**

一个广泛的术语，表示攻击者有机会使浏览器或服务器崩溃，或者以其他方式使特定目标应用程序的使用变得显著困难。

+   *参见第十四章以了解 JavaScript 的 DoS 考虑因素概述。

**框架破坏**

框架页面无需满足同源检查即可导航到顶级文档的新 URL 的可能性。这种行为可能被用于钓鱼攻击或仅仅是小小的恶作剧。

+   *参见第十一章以了解此及其他框架导航怪癖。

**HTTP 降级**

激活攻击者阻止用户访问特定网站的 HTTPS 版本或将现有的 HTTPS 会话降级为 HTTP 的能力。

+   *参见第三章以了解 HTTPS 的概述。

+   *参见第十六章以了解严格传输安全，这是针对该问题的提议解决方案。

**网络边界**

网站利用浏览器与攻击者无法直接访问的目的地进行交互的可能性，例如，与受害者内部网络上的系统。这种攻击可以是盲目的，或者（借助如 DNS 重绑定等攻击）攻击者可能能够看到所有请求的响应。

+   *参见第十二章，了解浏览器中的非 SOP 边界概述*。

+   *参见第十五章，其中介绍了针对此风险的潜在方法，即 Internet Explorer 区域模型*。

### 注意

警惕非流行词的漏洞！并非所有漏洞都有吸引人的名称。网络开发者应警惕许多其他实现和设计问题，这些问题超出了本书的范围，但仍然可能造成严重后果。例如，弱伪随机数生成器（特别是用于会话管理目的的）；认证和授权检查不足（特别是过度信任浏览器来源的数据）；密码学使用不当（发明自己的算法通常是不可取的）；等等。关于这些和其他许多失败模式的详细讨论，请参阅 Dowd、McDonald 和 Schuh 合著的《软件安全评估的艺术》（Addison-Wesley，2006 年）。

# 服务器端代码特有的常见问题

以下问题通常出现在任何 Web 应用程序的服务器托管部分，由于与特定的编程语言或软件组件相关联，因此不太可能出现在客户端。

**缓冲区溢出**

一种情况，程序允许在特定内存区域存储比容纳传入数据所需空间更多的信息，导致其他重要数据结构的意外覆盖。缓冲区溢出主要发生在底层编程语言中，如 C 或 C++，在这些语言中，它们可以频繁地被利用来执行攻击者提供的代码。

**命令注入（SQL、shell、PHP 等）**

由于输入过滤不足或输出转义不当，攻击者控制的字符串可能无意中被处理为应用程序使用的解释语言中的语句。（在某种程度上，这与跨站脚本攻击相似。）后果取决于语言的能力，但在大多数情况下，代码执行是最终的结果。

**目录遍历**

由于输入过滤不足（最常见的是未能正确识别和处理文件名中的“../”段），应用程序可能被欺骗在磁盘上的任意位置读取或写入文件。任何后果都取决于额外的约束，但未受约束的文件写入漏洞通常很容易被利用来运行攻击者提供的代码。

**文件包含**

如果没有限定词或以 *local (LFI)* 为前缀使用，该术语在很大程度上等同于与读取相关的目录遍历。另一方面，*远程文件包含 (RFI)* 是一种通过指定 URL 而不是有效文件路径来利用文件包含漏洞的替代方法。在某些脚本语言中，一个单一的、通用的 API 可以打开本地文件并获取远程 URL。在这些情况下，从攻击者控制的服务器检索文件的能力可能提供实质性的好处，具体取决于数据随后的处理方式。

**格式化字符串漏洞**

一些常用的库函数接受模板（“格式字符串”），后跟一组函数预期将插入到模板中预定义位置的参数。这种做法在 C 语言中特别常见（如 *printf(...)*、*syslog(...)* 等），但并不仅限于该语言。格式化字符串漏洞是由于无意中允许攻击者向这些函数之一提供模板而引起的。根据模板系统的功能和语言的特定情况，此错误可能导致从轻微的数据泄露到代码执行等各种后果。

**整数溢出**

一种特定于具有有限或无范围检查的语言的漏洞。缺陷是由于开发者未能检测到整数超过了最大可能值并回滚到零、一个非常大的负整数或某些其他硬件特定的意外结果。根据值的用途，这可能会使程序处于不一致的状态，或者更糟，导致在错误的内存位置读取或写入数据（这反过来又可能导致代码执行）。整数 *下溢* 是相反的效果：超过最小允许值并回滚到一个非常大的正整数。

**指针管理漏洞**

在鼓励或要求使用原始内存指针的语言（主要是 C 和 C++）中，可以使用未初始化或不再有效的指针（“悬空”），导致诸如 *使用后释放*、*双重释放* 以及更多漏洞。这些漏洞将破坏程序的内部状态，通常允许攻击者执行攻击者提供的代码。
