- en: Chapter 8. AD HOC FLOW VISUALIZATION
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 8 章。即兴流量可视化
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages651574.png.jpg)'
  id: totrans-1
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages651574.png.jpg)'
- en: Although viewing the content of flows and running reports helps track down problems,
    some issues can be properly assessed through visualization only. The average human
    brain simply cannot assemble 6,000 lines of plain-text data into a coherent understanding
    of the situation. Transforming large quantities of data into visual form eases
    comprehension.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然查看流量内容和运行报告有助于追踪问题，但某些问题只能通过可视化来正确评估。普通的人类大脑根本无法将 6,000 行纯文本数据组合成一个对情况的连贯理解。将大量数据转换为视觉形式可以简化理解。
- en: Perhaps the most common way to convert data to graphical form is through an
    office suite, such as Microsoft Office or OpenOffice.org. Office suites are not
    suited to automation, however. Once you have designed your graphs, regenerating
    them with new data should be trivial or even instantaneous. Tools such as CUFlow
    ([Chapter 6](ch06.html "Chapter 6. PERL, FLOWSCAN, AND CFLOW.PM")) and FlowGrapher
    ([Chapter 7](ch07.html "Chapter 7. FLOWVIEWER")) provide basic graphing, but they
    lack true ad hoc flexibility, such as the ability to choose the style of graph
    or whether to overlay one graph atop another. To provide truly unlimited flexibility
    in a manner that you can automate or quickly reproduce, you need `gnuplot`.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 将数据转换为图形形式最常见的方式可能是通过办公套件，例如 Microsoft Office 或 OpenOffice.org。然而，办公套件并不适合自动化。一旦你设计好了你的图表，用新数据重新生成它们应该是简单或甚至是瞬间的。CUFlow
    ([第 6 章](ch06.html "第 6 章。PERL, FLOWSCAN, AND CFLOW.PM")) 和 FlowGrapher ([第 7
    章](ch07.html "第 7 章。FLOWVIEWER")) 这样的工具提供了基本的绘图功能，但它们缺乏真正的即兴灵活性，例如选择图表样式或是否将一个图表叠加在另一个图表之上。要提供真正无限的灵活性，并且能够自动化或快速重现，你需要
    `gnuplot`。
- en: gnuplot 101
  id: totrans-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: gnuplot 101
- en: '`gnuplot` ([http://www.gnuplot.info/](http://www.gnuplot.info/)) has a notoriously
    steep learning curve and a reputation for complexity. The notoriety and reputation
    are not completely unwarranted. `gnuplot`''s power and efficiency more than make
    up for its challenges, however. Although mastering `gnuplot` can take years, you
    can quickly learn enough to create impressive graphs of your network data. Almost
    every Unix-like operating system includes current `gnuplot` packages, and you
    can also find packages for Windows, DOS, VMS, and almost every other operating
    system used in the past 20 years.'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '`gnuplot` ([http://www.gnuplot.info/](http://www.gnuplot.info/)) 以其陡峭的学习曲线和复杂性著称。这种恶名和声誉并非完全无根据。然而，`gnuplot`
    的强大和效率足以弥补其挑战。虽然掌握 `gnuplot` 可能需要数年，但你可以快速学习到足够多的知识来创建你网络数据的令人印象深刻的图表。几乎每个类 Unix
    的操作系统都包括当前的 `gnuplot` 软件包，你还可以找到适用于 Windows、DOS、VMS 以及过去 20 年中使用的几乎所有其他操作系统的软件包。'
- en: Using `gnuplot` on the reporting server simplifies reporting and the development
    of graphs. To use `gnuplot` on your reporting server, you'll need an X server
    on your workstation. If you use a Unix workstation, you're all set. If not, you
    can find any number of X Windows servers for Microsoft Windows. Be sure to choose
    one that can forward X over SSH, rather than speaking raw X over the network.
    (On Windows, I use the PuTTY SSH client and Xming X server.)
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 在报告服务器上使用 `gnuplot` 可以简化报告和图表的开发。要在你的报告服务器上使用 `gnuplot`，你需要在你的工作站上有一个 X 服务器。如果你使用的是
    Unix 工作站，那么你已经准备好了。如果不是，你可以找到许多适用于 Microsoft Windows 的 X Windows 服务器。务必选择一个可以转发
    X 通过 SSH 的服务器，而不是在网络中直接传输原始 X。（在 Windows 上，我使用 PuTTY SSH 客户端和 Xming X 服务器。）
- en: If you don't want to use an X terminal on your desktop, install `gnuplot` on
    your workstation, and then run reports on the server and transfer them to your
    workstation. Develop your graphs on your workstation, save their configurations,
    and copy those configurations to your server to automatically create more graphs.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你不想在桌面上的 X 终端上使用 `gnuplot`，请在你的工作站上安装 `gnuplot`，然后在服务器上运行报告并将它们传输到你的工作站。在你的工作站上开发图表，保存它们的配置，并将这些配置复制到你的服务器上以自动创建更多图表。
- en: OTHER GRAPHING PROGRAMS
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 其他绘图程序
- en: gnuplot's main advantage is that it's easily automated. To create graphs on
    the fly without worrying about reproducing them later, consider Grace ([http://plasma-gate.weizmann.ac.il/Grace/](http://plasma-gate.weizmann.ac.il/Grace/)).
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: gnuplot 的主要优势是它易于自动化。为了即时创建图表而不用担心以后的重现，请考虑 Grace ([http://plasma-gate.weizmann.ac.il/Grace/](http://plasma-gate.weizmann.ac.il/Grace/))。
- en: Starting gnuplot
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启动 gnuplot
- en: The best way to learn `gnuplot` is to use it. When `gnuplot` starts, it displays
    a message and offers its own command prompt.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 学习 `gnuplot` 的最好方法是使用它。当 `gnuplot` 启动时，它会显示一条消息并提供一个自己的命令提示符。
- en: '[PRE0]'
  id: totrans-12
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: To leave `gnuplot`, enter either **`exit`** or **`quit`**.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 要退出 `gnuplot`，请输入 **`exit`** 或 **`quit`**。
- en: 'Most `gnuplot` commands either alter a drawing''s appearance or create a new
    drawing. For a taste for how `gnuplot` works, graph a sine wave. (For some reason,
    the sine plot is traditional in `gnuplot` tutorials.) On the `gnuplot` command
    line, enter the following:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数 `gnuplot` 命令要么改变图表的外观，要么创建一个新的图表。为了体验 `gnuplot` 的工作方式，绘制一个正弦波。 (出于某种原因，正弦图在
    `gnuplot` 教程中是传统的。) 在 `gnuplot` 命令行中，输入以下内容：
- en: '[PRE1]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: You should see another window appear, displaying the classic sine wave, as shown
    in [Figure 8-1](ch08.html#sine_wave "Figure 8-1. Sine wave").
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该会看到一个新窗口出现，显示经典的正弦波，如图 [图8-1](ch08.html#sine_wave "图8-1. 正弦波") 所示。
- en: '![Sine wave](httpatomoreillycomsourcenostarchimages651604.png.jpg)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![正弦波](httpatomoreillycomsourcenostarchimages651604.png.jpg)'
- en: Figure 8-1. Sine wave
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 图8-1. 正弦波
- en: 'To modify your graphs, use the `set` command. You can set countless values,
    from the title of a graph to the labels on the x- and y-axes, colors used, and
    so on. Here I''m giving the graph the title of *test graph*:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 要修改您的图表，请使用 `set` 命令。您可以设置无数个值，从图表的标题到x轴和y轴的标签，使用的颜色等等。在这里，我正在给图表添加标题 *test
    graph*：
- en: '[PRE2]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'The displayed graph doesn''t change until you tell `gnuplot` to replot the
    data, like so:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 显示的图表在你告诉 `gnuplot` 重新绘制数据之前不会改变，就像这样：
- en: '[PRE3]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Now your graph should have a title.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您的图表应该有一个标题。
- en: gnuplot Configuration Files
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: gnuplot 配置文件
- en: The test graph you created here took very little effort. You didn't read in
    any data or enter complicated formulas. Flow data is much more complicated than
    a sine wave, however, and in this chapter you'll work through several iterations
    of your graph to make it look "just right." You can save all the settings from
    a `gnuplot` session so that you can call up those same settings and use them to
    plot new data. Just tell `gnuplot` the name of the file you want to save your
    configuration in.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 您在这里创建的测试图表几乎不需要任何努力。您没有读取任何数据或输入复杂的公式。然而，流量数据比正弦波复杂得多，在本章中，您将通过多次迭代您的图表来使其看起来“恰到好处”。您可以从
    `gnuplot` 会话中保存所有设置，以便您可以调用相同的设置并使用它们来绘制新的数据。只需告诉 `gnuplot` 您想保存配置的文件名即可。
- en: '[PRE4]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'You''ll find a `gnuplot` configuration file named *test.plt* in your current
    directory. This file contains all the `gnuplot` commands you entered, including
    the title and the `plot sin(x)` instruction. Exit `gnuplot`, and restart it. Then
    load this configuration file:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 您将在当前目录中找到一个名为 *test.plt* 的 `gnuplot` 配置文件。此文件包含您输入的所有 `gnuplot` 命令，包括标题和 `plot
    sin(x)` 指令。退出 `gnuplot`，然后重新启动它。然后加载此配置文件：
- en: '[PRE5]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Your graph will reappear, with all the changes you specified.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 您指定的所有更改都会在图表中重新出现。
- en: Retyping two commands to re-create your graph wouldn't be difficult, but graphs
    based on flow reports might include dozens of instructions, some of them long
    and tedious. Being able to save your `gnuplot` configuration and reuse it to graph
    new data will save time and effort and reduce errors.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 重新输入两个命令来重新创建您的图表并不困难，但基于流量报告的图表可能包含数十条指令，其中一些可能很长且繁琐。能够保存您的 `gnuplot` 配置并重新使用它来绘制新的数据将节省时间和精力，并减少错误。
- en: Now let's get some real data to graph.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们获取一些实际的数据来绘制图表。
- en: 'Time-Series Example: Bandwidth'
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 时间序列示例：带宽
- en: One common question network engineers get is "How much bandwidth does this application
    use?" I've worked in more than one global operation where management was concerned
    about how much internal bandwidth email consumed or where the Active Directory
    team needed to know how much bandwidth the interdomain controller communications
    used.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 网络工程师经常遇到的一个常见问题是“这个应用程序使用了多少带宽？” 我在多个全球运营中工作过，管理层关心电子邮件消耗了多少内部带宽，或者Active Directory团队需要知道域间控制器通信使用了多少带宽。
- en: Flow reports can answer this question in many different ways. An average of
    bandwidth use through the day is useful but won't reveal intermittent performance
    bottlenecks. A connection that's completely idle most of the time but that has
    a massive throughput spike during each day's peak hours might have an average
    throughput of about 50Kbps. The one-day average is simultaneously accurate and
    useless. The best way to answer this question is with a graph.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 流量报告可以通过许多不同的方式回答这个问题。一天中带宽使用的平均值很有用，但不会揭示间歇性的性能瓶颈。一个大部分时间都处于空闲状态，但在每天高峰时段有大量吞吐量波峰的连接，其平均吞吐量可能约为50Kbps。一天的平均值既准确又无意义。回答这个问题的最佳方式是使用图表。
- en: You'll start by investigating how much bandwidth you use between your desktop
    DHCP range and the Active Directory domain controllers at remote sites on your
    internal network during a particular 24-hour period. This is a very specific example
    of a question network engineers get all the time, and you can use this technique
    to answer any bandwidth-related question. You'll begin with a look at the total
    inbound and outbound traffic in a total bandwidth report.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 你将从调查在特定24小时期间，你的桌面DHCP范围与内部网络上远程站点的Active Directory域控制器之间使用了多少带宽开始。这是一个网络工程师经常遇到的具体问题示例，你可以使用这种技术来回答任何与带宽相关的问题。你将从查看总带宽报告中的总入站和出站流量开始。
- en: Total Bandwidth Report
  id: totrans-36
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 总带宽报告
- en: 'Any time you want to create a graph of bandwidth, packets, or flows over time,
    the best way to get the data is with the `linear-interpolated-flows-octets-packets`
    report (discussed in [Chapter 5](ch05.html "Chapter 5. REPORTING AND FOLLOW-UP
    ANALYSIS")). This report produces a good estimate of the number of octets, flows,
    and packets per second in a selection of flow data. You''re specifically interested
    in bandwidth (octets) per second, so you can produce this information with this
    *stat.cfg* configuration:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 每次你想创建一个随时间变化的带宽、数据包或流量的图表时，获取数据的最佳方式是使用`linear-interpolated-flows-octets-packets`报告（在第5章中讨论）。此报告产生了一个关于所选流量数据中每秒八位字节、流和数据包数量的良好估计。你特别感兴趣的是每秒带宽（八位字节），因此你可以使用以下*stat.cfg*配置来生成此信息：
- en: '[PRE6]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Because you're interested in the number of bytes transmitted, you remove at
    ❶ the packet and flow counts from this report. The other settings are `flow-report`'s
    defaults. Next, you need to decide what data to feed into the report.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 由于你感兴趣的是传输的字节数，你从❶报告中删除了数据包和流计数。其他设置是`flow-report`的默认设置。接下来，你需要决定将什么数据输入到报告中。
- en: Filtering Flows for Total Traffic
  id: totrans-40
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 过滤总流量中的流量
- en: Say you want to graph the bandwidth usage between your desktop DHCP range and
    several remote hosts. To filter these hosts out of your flow data, you'll use
    primitives for these hosts.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 假设你想要绘制你的桌面DHCP范围与几个远程主机之间的带宽使用情况图。为了从你的流量数据中过滤出这些主机，你将使用这些主机的原语。
- en: '[PRE7]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: You need one filter for the remote domain controllers and one for the desktops.
    (You could write a single filter that captured traffic from the desktops to the
    domain controllers and back, but two separate filters are generally more reusable.)
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要一个用于远程域控制器的过滤器和一个用于桌面的过滤器。（你可以编写一个捕获从桌面到域控制器并返回的流量的单个过滤器，但通常两个独立的过滤器更易于重用。）
- en: '[PRE8]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Now run the flows for the day you've chosen through these filters and through
    your interpolated octets `flow-report`. You're reporting on all the flows for
    January 14, 2011.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 现在将你选择的日期的流量通过这些过滤器以及你的插值八位字节`flow-report`运行。你正在报告2011年1月14日的所有流量。
- en: '[PRE9]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'The top of the file should look something like this:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 文件顶部应类似于以下内容：
- en: '[PRE10]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: The numbers on the left side are Unix epochal seconds. To double-check the report
    times, convert the first and last ones one with the `date` program.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 左侧的数字是Unix纪元秒。为了验证报告时间，使用`date`程序将第一个和最后一个数字转换一下。
- en: '[PRE11]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: The first matching flow began at four minutes after midnight, and the last one
    ended at almost 11:46 **pm**, both on January 14\. The report covers the time
    you're interested in.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个匹配的流量在午夜后四分钟开始，最后一个流量在几乎11:46 **pm**结束，都是在1月14日。报告涵盖了您感兴趣的时间段。
- en: '`gnuplot` will have problems with the column names of this file because `unix-secs`
    and `octets` are not graphable numbers. The simplest way to deal with this is
    to delete the first two lines either by hand or with `sed`. (Although editing
    the file by hand might be easier when creating graphs by hand, `sed` can be automated.)'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '`gnuplot`将无法处理此文件的列名，因为`unix-secs`和`octets`不是可绘制的数字。处理这个问题最简单的方法是手动或使用`sed`删除前两行。（尽管手动编辑文件在手动创建图表时可能更容易，但`sed`可以自动化。）'
- en: '[PRE12]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The Target Graph
  id: totrans-54
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 目标图表
- en: What do you want a graph to look like? It should clearly show how much bandwidth
    is used. The axes should be labeled with times and the unit of bandwidth measurement,
    and the graph itself should have a label. If you want real human beings to care
    about your graphs, times should be local clock time, not in epochal seconds or
    Greenwich mean time (GMT). If the graph has different lines for different types
    of traffic, it should have an interpretation key. And this should all be automatically
    generated. Oh, and while you're at it, you'll make the data accurate and meaningful.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 你希望图表看起来是什么样子？它应该清楚地显示使用了多少带宽。坐标轴应该标注时间以及带宽测量的单位，图表本身也应该有一个标签。如果你想让人真正关心你的图表，时间应该是本地时钟时间，而不是纪元秒或格林威治平均时间（GMT）。如果图表对不同类型的流量有不同的线条，应该有一个解释键。所有这些都应该自动生成。哦，顺便说一下，你还会使数据准确且有意义。
- en: 'The First Graph: Missing the Target'
  id: totrans-56
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 第一张图：未达到目标
- en: Begin by creating a default `gnuplot` graph of your data and comparing this
    to your desired result.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 首先创建一个默认的 `gnuplot` 图表来展示你的数据，并将其与你的期望结果进行比较。
- en: '[PRE13]'
  id: totrans-58
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The bandwidth at any given time is represented by a point, as shown in [Figure 8-2](ch08s02.html#raw_throughput_graph
    "Figure 8-2. Raw throughput graph"). Bandwidth utilization on a second-by-second
    basis is too irregular for nice curving lines, but you'll learn how to make graphs
    using markers other than points later.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 在任何给定时间，带宽由一个点表示，如图 [图8-2](ch08s02.html#raw_throughput_graph "图8-2. 原始吞吐量图")
    所示。基于每秒的带宽利用率太不规则，不适合绘制平滑的曲线，但稍后你将学习如何使用除点以外的标记来绘制图表。
- en: '![Raw throughput graph](httpatomoreillycomsourcenostarchimages651606.png.jpg)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![原始吞吐量图](httpatomoreillycomsourcenostarchimages651606.png.jpg)'
- en: Figure 8-2. Raw throughput graph
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 图8-2. 原始吞吐量图
- en: Neither axis has a label; the default graph could represent apples vs. pomegranates
    for all you can tell. In addition, the times along the bottom appear as epochal
    seconds, such as 1.2319E+08, rather than useful times. Epochal seconds are accurate,
    strictly speaking, but not exactly what you want to hand to your co-workers. You'll
    iteratively improve the graph, first by setting labels on the two axes and then
    by telling `gnuplot` how to format the time.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 两个坐标轴都没有标签；从你所能看到的，默认图表可能代表苹果与石榴。此外，底部的沿时间看起来像纪元秒，例如 1.2319E+08，而不是有用的时间。从严格意义上讲，纪元秒是准确的，但并不是你想要给你的同事看的东西。你将迭代地改进图表，首先在两个坐标轴上设置标签，然后告诉
    `gnuplot` 如何格式化时间。
- en: '[PRE14]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: You first tell `gnuplot` at ❶ that the data along the x-axis represents time.
    Then at ❷ you tell `gnuplot` the format of the time data along the x-axis. The
    `%s` character is a `gnuplot` time format that represents epoch seconds, and it
    gives `gnuplot` the information it needs to convert epoch seconds to human-friendly
    times. `gnuplot` can print measures of time in the same `strftime` format used
    by `flow-rptfmt` (see [Chapter 5](ch05.html "Chapter 5. REPORTING AND FOLLOW-UP
    ANALYSIS")). For a graph that covers 24 hours, printing the hour is a sensible
    choice, and you set that format at ❸. You then label the x- and y-axes at ❹ and
    ❺.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 你首先告诉 `gnuplot` ❶ 横轴上的数据代表时间。然后，在 ❷ 你告诉 `gnuplot` 横轴上时间数据的格式。字符 `%s` 是 `gnuplot`
    的时间格式，代表纪元秒，它为 `gnuplot` 提供了将纪元秒转换为人类友好时间所需的信息。`gnuplot` 可以以 `flow-rptfmt`（见 [第5章](ch05.html
    "第5章. 报告和后续分析")）使用的相同 `strftime` 格式打印时间度量。对于覆盖24小时的图表，打印小时是一个合理的选择，你在 ❸ 设置了该格式。然后你在
    ❹ 和 ❺ 标注了x轴和y轴。
- en: Now that you've started getting fancy, you tell `gnuplot` at ❻ exactly how to
    plot the data in your file. The dollar sign followed by a number indicates a column
    of data. `($1)` means "column 1," and `($2)` means "column 2." The statement `plot
    "octets.txt" using ($1):($2)` tells `gnuplot` to read `octets.txt` and plot the
    first column against the second column. The result looks like [Figure 8-3](ch08s02.html#flow_diagram_with_basic_labels
    "Figure 8-3. Flow diagram with basic labels").
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经开始了复杂化的操作，你需要告诉 `gnuplot` ❻ 如何在你的文件中绘制数据。跟随数字的美元符号表示数据列。`($1)` 表示“第1列”，而
    `($2)` 表示“第2列”。语句 `plot "octets.txt" using ($1):($2)` 告诉 `gnuplot` 读取 `octets.txt`
    并将第一列与第二列进行绘图。结果看起来像 [图8-3](ch08s02.html#flow_diagram_with_basic_labels "图8-3.
    带有基本标签的流程图")。
- en: '![Flow diagram with basic labels](httpatomoreillycomsourcenostarchimages651608.png.jpg)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![带有基本标签的流程图](httpatomoreillycomsourcenostarchimages651608.png.jpg)'
- en: Figure 8-3. Flow diagram with basic labels
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 图8-3. 带有基本标签的流程图
- en: This graph is closer to the target graph described earlier. The x-axis is labeled
    in bytes, and the y-axis is labeled in human-readable times. Notice that the times
    along the bottom don't match the data in the report, however. The flow data started
    just after midnight and ended just before midnight, but this graph starts at about
    5 **am** and ends 24 hours later. This is a time zone problem. I'm in Eastern
    standard time (EST), and `gnuplot` produced a graph in Coordinated Universal Time
    (UTC). This graph needs to display the local time. Also, I buy bandwidth in kilobits
    rather than kilobytes. Although the kilobytes label is accurate, I want the graph
    to show kilobits.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 此图表更接近之前描述的目标图表。x轴以字节为单位标注，y轴以可读时间标注。请注意，底部的时间与报告中的数据不匹配。流量数据在午夜后不久开始，在午夜前结束，但此图表从大约早上5点开始，并在24小时后结束。这是一个时区问题。我在东部标准时间（EST），而`gnuplot`生成的图表是协调世界时（UTC）。此图表需要显示本地时间。此外，我购买的是千比特而不是千字节。尽管千字节标签是准确的，但我希望图表显示千比特。
- en: 'To convert UTC to EST, you subtract five hours, shifting each value by (5 ×
    60 × 60 =) 18,000 seconds. You need to reduce all times listed in the data by
    18,000 seconds to have the graph display an accurate clock time. To convert bytes
    to kilobits, you divide by 125\. (One byte has 8 bits, and one kilobit has 1,000
    bits: 1000 / 8 = 125.) You can set both of these conversions as constants in `gnuplot`
    in order to transform the data as you graph it. (Don''t forget to change the label
    on the y-axis when you change the measurement.)'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 要将协调世界时（UTC）转换为东部标准时间（EST），您需要减去5小时，即每个值减去（5 × 60 × 60 =）18,000秒。您需要将数据中列出的所有时间减去18,000秒，以便图表显示准确的时钟时间。要将字节转换为千比特，您需要除以125。
    （一个字节有8位，一个千比特有1,000位：1,000 / 8 = 125。）您可以将这两个转换设置为`gnuplot`中的常量，以便在绘图时转换数据。（别忘了在更改测量单位时更改y轴的标签。）
- en: '[PRE15]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: First, you define a constant for the number of seconds between EST and UTC (❶)
    and another for the number of octets per kilobit (❷).
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，您定义一个从EST到UTC之间的秒数常量（❶）以及一个每千比特的八位常量（❷）。
- en: Next, because you're changing the measurement on the y-axis from bytes to kilobits,
    you also change the y-axis label, as shown at ❸.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，因为您正在将y轴的测量单位从字节更改为千比特，所以您也更改了y轴标签，如图❸所示。
- en: The tricky part is where you tell `gnuplot` to change the data as you're graphing
    it. Previously, you graphed the first column against the second. You're transforming
    the first column by adding the time zone offset to every value in that column
    (❹). You transform the second column by dividing every entry by the constant `kb`
    (❺). You don't change the numbers in the *octets.txt* file; you transform them
    on their way to the graph.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 困难的部分是告诉`gnuplot`在绘图时更改数据。之前，您将第一列与第二列绘图。您通过将时区偏移量加到该列的每个值上来转换第一列（❹）。您通过除以常量`kb`（❺）来转换第二列。您不更改`octets.txt`文件中的数字；您在它们到达图表的过程中进行转换。
- en: While you're here, you can make some other changes, such as assigning a title
    and giving the graph a grid.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 当您在这里时，您可以做一些其他更改，例如分配一个标题并给图表添加网格。
- en: '[PRE16]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: You'll get the graph shown in [Figure 8-4](ch08s02.html#network_utilization_with_better_times_co
    "Figure 8-4. Network utilization with better times, bandwidth units, grid, and
    title"), which at first glance is similar to the graph in [Figure 8-2](ch08s02.html#raw_throughput_graph
    "Figure 8-2. Raw throughput graph") but with more appropriate times and more useful
    bandwidth measurements, which make it more suitable for sharing with co-workers.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 您将得到[图8-4](ch08s02.html#network_utilization_with_better_times_co "图8-4. 使用更好的时间、带宽单位、网格和标题的网络利用率")中所示的图表，乍一看与[图8-2](ch08s02.html#raw_throughput_graph
    "图8-2. 原始吞吐量图表")中的图表相似，但具有更合适的时间和更有用的带宽测量，这使得它更适合与同事分享。
- en: '![Network utilization with better times, bandwidth units, grid, and title](httpatomoreillycomsourcenostarchimages651610.png.jpg)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![使用更好的时间、带宽单位、网格和标题的网络利用率](httpatomoreillycomsourcenostarchimages651610.png.jpg)'
- en: Figure 8-4. Network utilization with better times, bandwidth units, grid, and
    title
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 图8-4. 使用更好的时间、带宽单位、网格和标题的网络利用率
- en: Changing How the Graph Is Drawn
  id: totrans-79
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 改变图表的绘制方式
- en: 'Although I like graphs composed of individual points, many people prefer a
    different style of graph. `gnuplot` supports a nearly limitless number of graph
    styles. One popular style of bandwidth graph is one that uses a solid line, called
    an *impulse*, to represent the bandwidth used at any given time. Here, I''m creating
    exactly the same graph as before but using impulses:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然我喜欢由单独的点组成的图表，但许多人更喜欢不同的图表风格。`gnuplot` 支持几乎无限数量的图表风格。一种流行的带宽图表风格是使用实线，称为*脉冲*，来表示任何给定时间的带宽使用情况。在这里，我正在创建与之前完全相同的图表，但使用脉冲：
- en: '[PRE17]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Other than specifying impulses, this is exactly the same command.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 除了指定脉冲之外，这个命令完全相同。
- en: You'll get a graph like [Figure 8-5](ch08s02.html#network_utilization_with_impulses
    "Figure 8-5. Network utilization with impulses"). Some people will find this style
    of graph easier to understand. Just use whatever format your brain is wired to
    accept.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 你会得到一个如图[图8-5](ch08s02.html#network_utilization_with_impulses "图8-5. 使用脉冲的网络利用率")所示的图表。有些人会发现这种图表风格更容易理解。只需使用你大脑适应的任何格式即可。
- en: '![Network utilization with impulses](httpatomoreillycomsourcenostarchimages651612.png.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![使用脉冲的网络利用率](httpatomoreillycomsourcenostarchimages651612.png.jpg)'
- en: Figure 8-5. Network utilization with impulses
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 图8-5. 使用脉冲的网络利用率
- en: Clipping Levels
  id: totrans-86
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 裁剪级别
- en: You've probably noticed in [Figure 8-5](ch08s02.html#network_utilization_with_impulses
    "Figure 8-5. Network utilization with impulses") that a few data points vary greatly
    from the averages. If you examine the original data, you'll find that several
    connections are only three or four packets. Passing four octets in one millisecond
    is not the same as passing 4,000 octets in 1,000 milliseconds (or one second),
    but that's what a simple "average octets per second" calculation produces on a
    mostly idle network.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能已经注意到在[图8-5](ch08s02.html#network_utilization_with_impulses "图8-5. 使用脉冲的网络利用率")中，一些数据点与平均值差异很大。如果你检查原始数据，你会发现有几个连接只有三或四个数据包。在一毫秒内传输四个八位字节与在一秒内传输4,000个八位字节不同，但这就是在大部分空闲网络上简单的“每秒平均八位字节”计算产生的结果。
- en: To eliminate these outliers, you can establish a sensible clipping level to
    create a more realistic graph. To do this, you'll use `gnuplot`'s built-in logical
    operators, in the format shown here. (Perl and C aficionados should be familiar
    with this syntax.)
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 为了消除这些异常值，你可以设置一个合理的裁剪级别来创建一个更真实的图表。为此，你将使用 `gnuplot` 内置的逻辑运算符，格式如下。（Perl和C爱好者应该熟悉这种语法。）
- en: '[PRE18]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: This translates to "Is `a` true? If true, use `b`. If untrue, use `c`."
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 这表示“`a` 是否为真？如果是真的，则使用 `b`。如果不是真的，则使用 `c`。”
- en: 'After assessing your first graph and the data underlying those peaks, you might
    decide that you want your graph to have a maximum value of, say, 300Kbps, and
    that if a value exceeds 300Kbps, it should be treated as 300\. Translated into
    the previous syntax, you have the following:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 在评估了第一个图表及其下的数据峰值之后，你可能会决定希望你的图表最大值为，比如说，300Kbps，并且如果值超过300Kbps，则应将其视为300。用之前的语法翻译，你有以下内容：
- en: '[PRE19]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '`$2/kb` is the bandwidth in kilobits. With `>300 ?`, you check to see whether
    the bandwidth exceeds 300\. If it does, you use the value `300`. If not, you use
    the actual value of `$2/kb`.'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: '`$2/kb` 是千比特带宽。使用 `>300 ?`，你可以检查带宽是否超过300。如果超过，则使用值 `300`。如果没有超过，则使用实际的 `$2/kb`
    值。'
- en: To have `gnuplot` perform this check for you, enter it in the `plot` statement.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 要让 `gnuplot` 为你执行此检查，请在 `plot` 语句中输入它。
- en: '[PRE20]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: You'll get a result like the graph shown in [Figure 8-6](ch08s02.html#network_utilization_with_clipping_levels
    "Figure 8-6. Network utilization with clipping levels").
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 你会得到一个如图[图8-6](ch08s02.html#network_utilization_with_clipping_levels "图8-6.
    使用裁剪级别的网络利用率")所示的图表。
- en: '![Network utilization with clipping levels](httpatomoreillycomsourcenostarchimages651614.png.jpg)'
  id: totrans-97
  prefs: []
  type: TYPE_IMG
  zh: '![使用裁剪级别的网络利用率](httpatomoreillycomsourcenostarchimages651614.png.jpg)'
- en: Figure 8-6. Network utilization with clipping levels
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 图8-6. 使用裁剪级别的网络利用率
- en: By setting a clipping level, you get a graph that offers a more realistic image
    of your actual bandwidth usage.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 通过设置裁剪级别，你可以得到一个更真实反映你实际带宽使用的图表。
- en: CLIPPING LEVELS AND MULTIPLE GRAPHS
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 裁剪级别和多个图表
- en: When creating graphs for comparison, use the same clipping levels in all the
    graphs. Varying clipping levels will confuse the results.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 当创建用于比较的图表时，所有图表应使用相同的裁剪级别。不同的裁剪级别会混淆结果。
- en: Printing Graphs to Files
  id: totrans-102
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 将图表打印到文件
- en: '`gnuplot` supports a wide variety of graphics formats. To view the complete
    list your version supports, enter **`set terminal`** at the `gnuplot>` prompt.
    The three most commonly used formats for websites are GIF, JPEG, and PNG.'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '`gnuplot` 支持广泛的图形格式。要查看您版本支持的完整列表，请在 `gnuplot>` 提示符下输入 **`set terminal`**。网站最常用的三种格式是
    GIF、JPEG 和 PNG。'
- en: 'To have `gnuplot` print graphs to a file instead of to your screen, tell `gnuplot`
    the file type and name. Here, you save the graph to a JPEG file:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 要让 `gnuplot` 将图形打印到文件而不是屏幕上，告诉 `gnuplot` 文件类型和名称。在这里，您将图形保存为 JPEG 文件：
- en: '[PRE21]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: The `set output` statement at ❶ tells `gnuplot` the type of output to produce,
    and the one at ❷ says where to put any output. To actually create the file, you
    have `gnuplot` redraw the graph at ❸. Finally, at ❹ you set the terminal to display
    its output to the screen again.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: ❶ 处的 `set output` 语句告诉 `gnuplot` 要生成哪种类型的输出，❷ 处的 `set output` 语句说明将输出放在哪里。要实际创建文件，您需要让
    `gnuplot` 在❸处重新绘制图形。最后，在❹处您设置终端再次将输出显示到屏幕上。
- en: Save Your Work!
  id: totrans-107
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 保存您的作品！
- en: You can use this configuration to easily generate very similar graphs. Save
    it as a basis for future reports.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用此配置轻松生成非常相似的图形。将其保存为未来报告的基础。
- en: '[PRE22]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Unidirectional Bandwidth Reports
  id: totrans-110
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 单向带宽报告
- en: The graph in [Figure 8-6](ch08s02.html#network_utilization_with_clipping_levels
    "Figure 8-6. Network utilization with clipping levels") showed the total amount
    of bandwidth used for communication between the desktops and the domain controllers
    at remote sites. What if you want a report on the bandwidth used in one direction
    only, such as from servers to desktops or from desktops to servers?
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '[图8-6](ch08s02.html#network_utilization_with_clipping_levels "图8-6. 使用裁剪级别的网络利用率")
    中的图形显示了桌面和远程站点域控制器之间通信使用的总带宽。如果您只想查看单向使用的带宽报告，比如从服务器到桌面或从桌面到服务器，怎么办？'
- en: The report you'd generate isn't very different from the total bandwidth report
    you generated in the previous section. To create the report, you'd use the `flow-nfilter`
    configuration to extract the data of interest, feed that to your octet's `flow-report`,
    and then feed that to a very similar `gnuplot` configuration.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 您生成的报告与上一节中生成的总带宽报告没有太大区别。要创建报告，您将使用 `flow-nfilter` 配置来提取感兴趣的数据，将其输入到您的八位字节
    `flow-report`，然后将其输入到一个非常相似的 `gnuplot` 配置中。
- en: Filtering Flows for Unidirectional Traffic
  id: totrans-113
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 过滤单向流量
- en: 'The filter configuration uses the same `desktops` and `remoteDCs` primitives
    you used for the total bandwidth report. As shown here, you create two new filters,
    one for each direction:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 过滤器配置使用与总带宽报告相同的 `desktops` 和 `remoteDCs` 基本元素。如所示，您创建了两个新的过滤器，每个方向一个：
- en: '[PRE23]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: The first filter shows only the traffic the domain controllers send to the desktops;
    the second filter shows the traffic desktops send to the domain controllers. Now
    you run one of these new filters against the same flow files, beginning with the
    traffic from the domain controllers to the desktops.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个过滤器仅显示域控制器发送到桌面的流量；第二个过滤器显示桌面发送到域控制器的流量。现在您运行这些新过滤器之一对相同的流量文件进行操作，从域控制器到桌面的流量开始。
- en: '[PRE24]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'You use the same `sed` command to remove the two extra lines at the top of
    the file. Finally, verify that the contents of the data file resembles that of
    your previous report: two columns containing epoch dates and bandwidth amounts.'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用相同的 `sed` 命令来删除文件顶部额外的两行。最后，验证数据文件的内容是否与您之前报告中的内容相似：包含时间戳和带宽数量的两列。
- en: Creating a Unidirectional Graph
  id: totrans-119
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 创建单向图
- en: The unidirectional traffic graph should look a lot like the total bandwidth
    graph. In fact, to produce the final graph, you can simply modify the existing
    `gnuplot` configuration and change the title.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 单向流量图应该非常类似于总带宽图。实际上，要生成最终图形，您只需修改现有的 `gnuplot` 配置并更改标题。
- en: '[PRE25]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: You begin by loading at ❶ the configuration you used for the total bandwidth
    graph. This configuration gives you correct times, bits instead of octets, and
    so on. Next, at ❷ you change the title, and at ❸ you create a new plot with your
    new data. The result would look like [Figure 8-7](ch08s02.html#unidirectional_bandwidth_usage
    "Figure 8-7. Unidirectional bandwidth usage").
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 您首先在❶处加载用于总带宽图的配置。此配置为您提供正确的时间、比特而不是八位字节等。接下来，在❷处更改标题，在❸处使用新数据创建一个新的图形。结果将类似于
    [图8-7](ch08s02.html#unidirectional_bandwidth_usage "图8-7. 单向带宽使用")。
- en: '![Unidirectional bandwidth usage](httpatomoreillycomsourcenostarchimages651616.png.jpg)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![单向带宽使用](httpatomoreillycomsourcenostarchimages651616.png.jpg)'
- en: Figure 8-7. Unidirectional bandwidth usage
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 图8-7. 单向带宽使用图
- en: As you can see, reusing `gnuplot` configurations with different data is a very
    quick way to produce graphs with a consistent appearance but different data.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，使用不同的数据重用`gnuplot`配置是一种快速生成外观一致但数据不同的图表的方法。
- en: To create a graph for traffic going in the opposite direction, you would do
    almost the same thing; simply change the graph title and the flow filter.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建一个显示相反方向流量的图表，你几乎会做同样的事情；只需更改图表标题和流量过滤器。
- en: Combined Inbound/Outbound Traffic
  id: totrans-127
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 结合入站/出站流量
- en: A graph showing both inbound and outbound traffic simultaneously is likely to
    be more useful than a graph showing traffic in one direction only. You already
    have the data; to produce a graph showing traffic in both directions, you just
    need a slightly different `gnuplot` configuration.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 同时显示入站和出站流量的图表可能比只显示单向流量的图表更有用。你已经有数据了；要生成显示双向流量的图表，你只需要一个稍微不同的`gnuplot`配置。
- en: Preparing the Data Files
  id: totrans-129
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 准备数据文件
- en: If you were to create two unidirectional graphs, you would already have the
    data files you need, and that's essentially what you'll do. You can't call both
    data files *octets.txt*; however, you need to give each a distinct name. Since
    you're measuring traffic between local and remote hosts, let's call one of them
    *inbound.txt* and the other *outbound.txt*. Trim the headers off the raw data
    files with `sed`, but otherwise leave the data unchanged.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你创建两个单向图表，你将已经有你需要的数据文件，你本质上会这样做。你不能将两个数据文件都命名为`octets.txt`；然而，你需要给每个文件一个独特的名称。由于你在测量本地和远程主机之间的流量，让我们将其中一个命名为`inbound.txt`，另一个命名为`outbound.txt`。使用`sed`从原始数据文件中删除标题，但其他数据保持不变。
- en: '[PRE26]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: Displaying Two Graphs Simultaneously
  id: totrans-132
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 同时显示两个图表
- en: To display two graphs simultaneously, begin with your unidirectional graph configuration.
    You'll change the name of the files being plotted, but all the other configuration
    information such as time zone, kilobits instead of bytes, and so on, will work
    just as well for this new graph.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 要同时显示两个图表，首先从你的单向图表配置开始。你将更改正在绘制的文件名，但所有其他配置信息，如时区、千比特而不是字节等，都将适用于这个新图表。
- en: 'To plot two different data sets drawn from two different files on one graph,
    separate each with a comma in a single `plot` statement, as shown here:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 要在一个图表上绘制来自两个不同文件的两个不同数据集，在单个`plot`语句中用逗号分隔每个数据集，如下所示：
- en: '[PRE27]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: This listing displays several new features here. The backslash (`\`) at ❶ tells
    `gnuplot` that a command continues on the next line. If you need to use a backslash
    to show a continued line, enter the backslash, and then just press **enter**.
    You'll be taken to the next line.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 此列表在此显示了几个新功能。❶处的反斜杠（`\`）告诉`gnuplot`命令将在下一行继续。如果你需要使用反斜杠来显示续行，输入反斜杠，然后按**Enter**键。你将被带到下一行。
- en: The `title` at ❷ within the `plot` statement labels the data. In this case,
    you have two types of data, labeled `inbound` and `outbound`. The comma (,) at
    ❸ separates the two data sources. The resulting graph looks something like [Figure 8-8](ch08s02.html#graph_of_inbound_and_outbound_traffic
    "Figure 8-8. Graph of inbound and outbound traffic").
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 在`plot`语句中的❷处`title`标签标识数据。在这种情况下，你有两种类型的数据，分别标记为`inbound`和`outbound`。❸处的逗号（,）分隔两个数据源。生成的图表看起来就像[图8-8](ch08s02.html#graph_of_inbound_and_outbound_traffic
    "图8-8. 入站和出站流量图")。
- en: '![Graph of inbound and outbound traffic](httpatomoreillycomsourcenostarchimages651618.png.jpg)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![入站和出站流量图](httpatomoreillycomsourcenostarchimages651618.png.jpg)'
- en: Figure 8-8. Graph of inbound and outbound traffic
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 图8-8. 入站和出站流量图
- en: According to the key, the data points of the inbound traffic are plus signs
    (`+`). The outbound traffic data points appear as `x` characters. `gnuplot` will
    also use different colors for the data points. ([Figure 8-8](ch08s02.html#graph_of_inbound_and_outbound_traffic
    "Figure 8-8. Graph of inbound and outbound traffic") is a bit easier to understand
    in color, but this book is in black and white because I want it to be affordable.)
    Having two different data point characters helps, but not much. It's better to
    show both types of traffic simultaneously, but not intermingled.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 根据键值，入站流量的数据点以加号（`+`）表示。出站流量的数据点则以`x`字符表示。`gnuplot`也会为数据点使用不同的颜色。([图8-8](ch08s02.html#graph_of_inbound_and_outbound_traffic
    "图8-8. 入站和出站流量图")在颜色上更容易理解，但本书是黑白印刷，因为我希望它更便宜。)使用两种不同的数据点字符有所帮助，但效果有限。最好同时显示两种类型的流量，但不要混合在一起。
- en: 'To make this graph easier to understand at a glance, graph outbound traffic
    as negative numbers, like so:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使这张图更容易一眼看懂，将出站流量表示为负数，如下所示：
- en: '[PRE28]'
  id: totrans-142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: You've made only two minor changes here, placing minus signs in your outbound
    graph's plot statement at ❶ and ❷. [Figure 8-9](ch08s02.html#utilization_diagram_with_outbound_traffi
    "Figure 8-9. Utilization diagram with outbound traffic as negative numbers") shows
    the resulting graph.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 你在这里只做了两项小的改动，在你的出站图表的绘图语句中放置了❶和❷的负号。[图8-9](ch08s02.html#utilization_diagram_with_outbound_traffi
    "图8-9. 以负数表示出站流量的利用率图")显示了结果图。
- en: '![Utilization diagram with outbound traffic as negative numbers](httpatomoreillycomsourcenostarchimages651620.png.jpg)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
  zh: '![以负数表示出站流量的利用率图](httpatomoreillycomsourcenostarchimages651620.png.jpg)'
- en: Figure 8-9. Utilization diagram with outbound traffic as negative numbers
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 图8-9. 以负数表示出站流量的利用率图
- en: As you can see in this graph, it's clear that you're receiving much more traffic
    than you send, and you receive it much more frequently. The inbound and outbound
    clipping levels are unchanged, but the outbound traffic never approaches the clipping
    level. You can also see that you have a big utilization spike just after 9 **am**
    EST.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 如您从这张图中可以看到，很明显，你接收到的流量比你发送的要多得多，而且接收的频率也要高得多。入站和出站的剪辑级别没有变化，但出站流量从未接近剪辑级别。您还可以看到，在东部标准时间上午9点之后，您有一个很大的利用率峰值。
- en: 'To get another look at this data, you could graph it with impulses like so:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 要以另一种方式查看这些数据，您可以像这样用脉冲来绘制图表：
- en: '[PRE29]'
  id: totrans-148
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: The result resembles [Figure 8-10](ch08s02.html#impulse_utilization_diagram_with_outboun
    "Figure 8-10. Impulse utilization diagram with outbound traffic as negative numbers").
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 结果类似于[图8-10](ch08s02.html#impulse_utilization_diagram_with_outboun "图8-10. 以负数表示出站流量的脉冲利用率图")。
- en: With proper graphs, anyone—even your manager—can understand network utilization.
    [Figure 8-10](ch08s02.html#impulse_utilization_diagram_with_outboun "Figure 8-10. Impulse
    utilization diagram with outbound traffic as negative numbers") makes it clear
    that desktops are exchanging traffic with remote domain controllers, even though
    Microsoft insisted that clients should contact their local domain controller only.
    You can now resolve the problem with documented facts rather than guesses and
    intermittent packet sniffer snapshots.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 使用适当的图表，任何人——甚至你的经理——都可以理解网络利用率。[图8-10](ch08s02.html#impulse_utilization_diagram_with_outboun
    "图8-10. 以负数表示出站流量的脉冲利用率图")清楚地表明，桌面计算机正在与远程域控制器交换流量，尽管微软坚持认为客户端应该只联系其本地域控制器。你现在可以用有据可查的事实而不是猜测和间歇性的数据包嗅探快照来解决问题。
- en: '![Impulse utilization diagram with outbound traffic as negative numbers](httpatomoreillycomsourcenostarchimages651622.png.jpg)'
  id: totrans-151
  prefs: []
  type: TYPE_IMG
  zh: '![以负数表示出站流量的脉冲利用率图](httpatomoreillycomsourcenostarchimages651622.png.jpg)'
- en: Figure 8-10. Impulse utilization diagram with outbound traffic as negative numbers
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 图8-10. 以负数表示出站流量的脉冲利用率图
- en: Automating Graph Production
  id: totrans-153
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 自动化图表生成
- en: Although you'll always need to have some ad hoc reporting ability, you'll find
    that you need certain graphs over and over again. You should make producing these
    graphs so easy that one of your flunkies can do it, or you can even schedule graph
    production with `cron`. The best way to manage this is through scripting and automation.
    `gnuplot` is very scripting-friendly, and the following script processes yesterday's
    flow files to generate a bidirectional traffic graph.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然您始终需要具备一些临时的报告能力，但您会发现您需要某些图表一次又一次。您应该使这些图表的生成变得如此简单，以至于您的助手可以完成它，或者您甚至可以用`cron`安排图表生成。管理这些图表的最佳方式是通过脚本和自动化。`gnuplot`非常适合脚本，以下脚本处理昨天的流量文件以生成双向流量图。
- en: Note
  id: totrans-155
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: This script is not optimized. In a real environment, you'd send email via Perl,
    but I don't want to waste a page on that example when you probably already have
    a standard way to send mail on your systems. Too, this script uses insecure temp
    files, and you shouldn't use such files on a shared system. In short, do not use
    this script as is; rather, use it as a guide for writing a script that fits your
    own needs in the best Perl you can maintain. Who told you to listen to me, anyway?
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: '这个脚本没有优化。在实际环境中，您会通过Perl发送电子邮件，但我不想在您可能已经在系统上有一个标准的发送邮件方式时浪费一页来介绍这个例子。此外，这个脚本使用不安全的临时文件，您不应该在共享系统上使用这样的文件。简而言之，不要直接使用此脚本；相反，将其用作编写适合您自己需求的脚本的指南，并尽可能使用您能维护的最好的Perl。谁告诉你要听我的，对吧？ '
- en: '[PRE30]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: Admittedly, some of the commands here are a little long, but there's no interface
    to run flow reports directly from within Perl. You replace `sed` with textbook
    Perl routines, but you're already using `system()` calls all over the place.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 承认，这里的一些命令有点长，但直接从Perl中运行流量报告没有接口。你用教科书中的Perl例程替换`sed`，但你已经在各个地方使用`system()`调用了。
- en: Beginning with `run gnuplot`, you configure `gnuplot` entirely within this script.
    You could also load most of your `gnuplot` configuration from a file.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 从`run gnuplot`开始，你在这个脚本中完全配置`gnuplot`。你也可以从文件中加载大部分`gnuplot`配置。
- en: And as for sending mail (at the end of the script), you probably already have
    a preferred way to send mail from your servers. If you don't, I recommend Perl's
    MIME::Lite module. Otherwise, look at programs such as `mutt` or `metamail`.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 至于发送邮件（在脚本末尾），你可能已经有一个从你的服务器发送邮件的首选方式。如果没有，我推荐使用Perl的MIME::Lite模块。否则，查看`mutt`或`metamail`等程序。
- en: Comparison Graphs
  id: totrans-161
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 比较图
- en: The easiest way to compare traffic from multiple time periods is to overlay
    one graph atop another; doing so helps you evaluate the impact of system changes
    on the network. You can use the same type of linear interpolation for this as
    well, with some needed changes to the graph techniques and the time values.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 比较多个时间段的交通最简单的方法是将一个图叠加在另一个图上；这样做有助于你评估系统变化对网络的影响。你也可以使用相同类型的线性插值，但需要对图形技术和时间值进行一些调整。
- en: 'In the following report, you''ll compare inbound and outbound Internet traffic
    from two different 24-hour periods, A and B. The data is in two files: *inboundA.txt*
    and *inboundB.txt*. I''ve already removed the column names from the top of these
    files.'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下报告中，你将比较两个不同24小时周期A和B的入站和出站互联网流量。数据在两个文件中：*inboundA.txt*和*inboundB.txt*。我已经从这些文件的顶部移除了列名。
- en: Data Normalizing
  id: totrans-164
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数据归一化
- en: To make the graphs overlay each other, you need to adjust the data times. Bandwidth
    values are largely unchanged, but the time values are problematic. The simplest
    way to do this is to subtract a value from each set of data so that each graph
    starts at time zero.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 要使图形相互叠加，你需要调整数据时间。带宽值基本没有变化，但时间值有问题。最简单的方法是从每组数据中减去一个值，使每个图从时间零开始。
- en: When you use `sort -key` in the output section of your linear-interpolated report,
    the earliest time in your file appears at the top. For example, look at the top
    of *inboundA.txt*.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 当你在线性插值报告的输出部分使用`sort -key`时，你的文件中最早的时间出现在顶部。例如，看看*inboundA.txt*的顶部。
- en: '[PRE31]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: '*InboundA.txt* begins in epochal second 1229488610 (❶). You subtract 1,229,488,610
    from every time value to turn it into an offset from zero. Similarly, *inboundB.txt*
    begins in epochal second 1230179749\. You store these values in `gnuplot`, and
    while you''re defining constants, you''ll also define the number of octets in
    a kilobyte.'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: '*InboundA.txt*从纪元秒1229488610（❶）开始。你从每个时间值中减去1,229,488,610，将其转换为从零开始的偏移量。同样，*inboundB.txt*从纪元秒1230179749开始。你将这些值存储在`gnuplot`中，在定义常量的同时，你也会定义千字节中的字节数。'
- en: '[PRE32]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Note
  id: totrans-170
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Those of you who check these dates will notice that they start about a minute
    apart. A difference of one minute in a small graph of a day's traffic is negligible.
    If you were graphing traffic within a single minute or creating a wide graph for
    a single hour you'd have to correct for this difference, but at this scale we
    don't care.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 检查这些日期的各位会注意到它们大约相差一分钟。在一天交通的小图中，一分钟的差异是可以忽略不计的。如果你是在单个分钟内绘图交通或为单个小时创建宽图，你将不得不为此差异进行校正，但在这个规模上我们并不关心。
- en: Time Scale
  id: totrans-172
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 时间尺度
- en: 'You want to label the x-axis by time using "hours into the samples," but as
    things stand, the x-axis will be numbered in seconds. You can convert seconds
    into hours by configuring `gnuplot`''s *tics*. A tic is a divider along an axis;
    major tics are labeled, and minor tics are not. The previous graphs had a labeled
    tic every two hours and one minor tic halfway between each hour. Let''s keep that
    value: Two hours is 7,200 seconds.'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 你想用“样本中的小时数”来标记x轴，但就目前情况来看，x轴将以秒为单位进行编号。你可以通过配置`gnuplot`的*tics*将秒转换为小时。tic是轴上的分隔符；主tic有标签，而副tic没有。之前的图形每两小时有一个标记的tic，每小时中间有一个副tic。让我们保持这个值：两小时是7,200秒。
- en: '[PRE33]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: With these basic labels, you can now plot your data.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 使用这些基本标签，你现在可以绘制你的数据了。
- en: '[PRE34]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: The result should look something like [Figure 8-11](ch08s04.html#comparisons_of_traffic_on_two_different
    "Figure 8-11. Comparisons of traffic on two different days"), except in color.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 结果应该看起来像[图8-11](ch08s04.html#comparisons_of_traffic_on_two_different "图8-11.
    两天不同日期的交通比较")，只是颜色不同。
- en: '![Comparisons of traffic on two different days](httpatomoreillycomsourcenostarchimages651624.png.jpg)'
  id: totrans-178
  prefs: []
  type: TYPE_IMG
  zh: '![两天不同日期的交通比较](httpatomoreillycomsourcenostarchimages651624.png.jpg)'
- en: Figure 8-11. Comparisons of traffic on two different days
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 图8-11. 两天不同日期的交通比较
- en: You can combine this sort of comparison graph with the graph that shows inbound
    and outbound traffic simultaneously and get an easy-to-understand comparison of
    traffic from two different time windows. Or you can make one day's traffic negative
    to make it easier to see. You can build graphs that show how much of your Internet
    traffic is web browsing from Monday through Friday, 9 **am** to 5 **pm**, to show
    the impact of users on the network. Or you can compare your current network usage
    to the usage when your new Internet circuit was installed last year. `gnuplot`
    lets you visualize any data you have. If you want more sophisticated examples
    of using `gnuplot` with flow data, look for the CAIDA tools or the FloCon ([http://www.cert.org/flocon/](http://www.cert.org/flocon/))
    proceedings.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以将这种比较图与同时显示进出流量的图表结合起来，从而得到两个不同时间窗口之间交通的易于理解的比较。或者，您可以将一天的交通设置为负值，以便更容易查看。您可以构建图表，展示从周一到周五，上午9点至下午5点，您的互联网流量中有多少是网页浏览，以显示用户对网络的影响。或者，您可以比较您当前的网络使用情况与去年安装新的互联网电路时的使用情况。`gnuplot`让您可视化您拥有的任何数据。如果您想了解更多使用`gnuplot`处理流量数据的复杂示例，请查找CAIDA工具或FloCon([http://www.cert.org/flocon/](http://www.cert.org/flocon/))会议记录。
