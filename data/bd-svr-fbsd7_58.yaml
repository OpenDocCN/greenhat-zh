- en: Chapter 25\. PROCMAIL 3.22
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第25章. PROCMAIL 3.22
- en: '[HTTP://WWW.PROCMAIL.ORG](HTTP://WWW.PROCMAIL.ORG)'
  id: totrans-1
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[HTTP://WWW.PROCMAIL.ORG](HTTP://WWW.PROCMAIL.ORG)'
- en: 25.1\. SUMMARY
  id: totrans-2
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 25.1. 摘要
- en: Procmail is a mail filter, or Mail Delivery Agent (MDA), that is used to process
    incoming email in accordance with a set of specified rules or actions. These actions
    can include forwarding email to a different address, routing flagged spam messages
    into a Junk folder, sending auto-reply messages, and so forth. Processing can
    be applied to all incoming messages, or limited to messages that contain certain
    tags or strings.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: Procmail是一个邮件过滤器，或邮件投递代理（MDA），用于根据一组指定的规则或操作处理传入的电子邮件。这些操作可以包括将电子邮件转发到不同的地址、将标记为垃圾邮件的消息路由到垃圾邮件文件夹、发送自动回复消息等。处理可以应用于所有传入的消息，或限制为包含某些标记或字符串的消息。
- en: Setting up Procmail rules can be challenging for new users. The "[Resources](resources.html#resources)"
    section lists sites that host numerous examples and recipes to help with configuration.
    This guide will provide details on using Procmail to divert flagged spam into
    a separate Junk folder.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 设置Procmail规则对新用户来说可能具有挑战性。"[资源](resources.html#resources)"部分列出了提供大量示例和配置食谱的网站。本指南将提供有关使用Procmail将标记为垃圾邮件的邮件重定向到单独的垃圾邮件文件夹的详细信息。
- en: Procmail was originally created by Stephen R. van den Berg in 1990\. In 1998,
    Philip Guenther became Procmail's maintainer; he continues to lead development
    efforts.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: Procmail最初由Stephen R. van den Berg于1990年创建。1998年，Philip Guenther成为Procmail的维护者；他继续领导开发工作。
- en: 25.2\. RESOURCES
  id: totrans-6
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 25.2. 资源
- en: Procmail Documentation Project
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: Procmail 文档项目
- en: '[http://pm-doc.sourceforge.net](http://pm-doc.sourceforge.net)'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://pm-doc.sourceforge.net](http://pm-doc.sourceforge.net)'
- en: Procmail FAQ (Era Eriksson)
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: Procmail FAQ（Era Eriksson）
- en: '[http://partmaps.org/era/procmail/mini-faq.html](http://partmaps.org/era/procmail/mini-faq.html)'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://partmaps.org/era/procmail/mini-faq.html](http://partmaps.org/era/procmail/mini-faq.html)'
- en: 25.3\. REQUIRED
  id: totrans-11
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 25.3. 必需的
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) FreeBSD 7.0-RELEASE
    (see "[FreeBSD 7.0](freebsd_7.0_split_000.html#freebsd_7.0)")'
  id: totrans-12
  prefs: []
  type: TYPE_IMG
  zh: '![图片](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) FreeBSD
    7.0-RELEASE（见"[FreeBSD 7.0](freebsd_7.0_split_000.html#freebsd_7.0)"）'
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) Updated ports
    collection (see "[FreeBSD Ports Collection](freebsd_ports_collection.html#freebsd_ports_collection)")'
  id: totrans-13
  prefs: []
  type: TYPE_IMG
  zh: '![图片](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) 更新的端口集合（见"[FreeBSD
    端口集合](freebsd_ports_collection.html#freebsd_ports_collection)"）'
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) Postfix SMTP
    server (see "[Postfix SMTP Server 2.5.1](postfix_smtp_server_2.5.1.html#postfix_smtp_server_2.5.1)")'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![图片](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) Postfix
    SMTP服务器（见"[Postfix SMTP服务器2.5.1](postfix_smtp_server_2.5.1.html#postfix_smtp_server_2.5.1)"）'
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) SpamAssassin
    (see "[SpamAssassin 3.2.4](spamassassin_3.2.4.html#spamassassin_3.2.4)")'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
  zh: '![图片](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) SpamAssassin（见"[SpamAssassin
    3.2.4](spamassassin_3.2.4.html#spamassassin_3.2.4)"）'
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) Internet
    connection'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '![图片](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) 互联网连接'
- en: 25.4\. PREPARATION
  id: totrans-17
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 25.4. 准备
- en: Become the superuser.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 成为超级用户。
- en: 25.5\. INSTALL
  id: totrans-19
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 25.5. 安装
- en: 'To begin the Procmail installation process, enter the following commands:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始Procmail的安装过程，请输入以下命令：
- en: '[PRE0]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The installation process will pause to allow you to add directories to the test-lock
    routines. We'll accept the default, so press [enter] to continue.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 安装过程将暂停，以便您可以向测试锁定例程添加目录。我们将接受默认设置，因此按[enter]键继续。
- en: 25.6\. CONFIGURE
  id: totrans-23
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 25.6. 配置
- en: Once the installation is complete, it is time to configure Procmail for use
    on your system.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，是时候为您的系统配置Procmail了。
- en: 'Create a global configuration file (i.e., one that affects all users) to route
    email flagged as spam by SpamAssassin to a subfolder of each user''s inbox, called
    Junk:'
  id: totrans-25
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个全局配置文件（即影响所有用户的文件），将SpamAssassin标记为垃圾邮件的电子邮件路由到每个用户收件箱的子文件夹，称为垃圾邮件：
- en: '[PRE1]'
  id: totrans-26
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Add the following lines:'
  id: totrans-27
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 添加以下行：
- en: '[PRE2]'
  id: totrans-28
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Save and exit.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存并退出。
- en: 'Add a line to Postfix''s main.cf file to specify Procmail as the Local Mail
    Delivery Agent. Open main.cf:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在Postfix的主.cf文件中添加一行，指定Procmail作为本地邮件投递代理。打开main.cf：
- en: '[PRE3]'
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Scroll to the bottom of main.cf using [ctrl-U] and add this line:'
  id: totrans-32
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用[ctrl-U]滚动到main.cf的底部并添加此行：
- en: '[PRE4]'
  id: totrans-33
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Save, exit, and reload Postfix''s configuration:'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存、退出并重新加载Postfix的配置：
- en: '[PRE5]'
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 25.7\. TESTING
  id: totrans-36
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 25.7. 测试
- en: In this section, we'll perform tests to confirm that Procmail delivers mail
    to users' mailboxes correctly.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将执行测试以确认Procmail是否正确地将邮件发送到用户的邮箱中。
- en: 'Send a test spam message into the mail system. First, open a telnet connection:'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 向邮件系统发送测试垃圾邮件消息。首先，打开telnet连接：
- en: '[PRE6]'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '* * *'
  id: totrans-40
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: '***Note:*** Your hostname should appear instead of [host.example.com](http://host.example.com).'
  id: totrans-41
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '***注意：*** 您的主机名应该代替[host.example.com](http://host.example.com)。'
- en: '* * *'
  id: totrans-42
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: 'Enter the following (substituting your domain for [example.com](http://example.com)):'
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输入以下内容（用您的域名替换[example.com](http://example.com)）：
- en: '[PRE7]'
  id: totrans-44
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '* * *'
  id: totrans-45
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: '***Note:*** You can specify a different recipient if you like. The spamd account
    will be present on your system if you used the SpamAssassin guide in this book.'
  id: totrans-46
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '***注意：*** 如果您愿意，可以指定不同的收件人。如果您在这本书中使用了SpamAssassin指南，则spamd账户将存在于您的系统上。'
- en: '* * *'
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: Next, enter the following lines as shown, pressing [enter] after each line.
  id: totrans-48
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 接下来，按照以下所示输入以下行，每行输入后按[回车]键。
- en: '* * *'
  id: totrans-49
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: '***Note:*** The long string is known as the GTUBE (Generic Test for Unsolicited
    Bulk Email). It will cause SpamAssassin to flag the message as spam.'
  id: totrans-50
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '***注意：*** 这个长字符串被称为GTUBE（通用垃圾邮件测试）。它会导致SpamAssassin将消息标记为垃圾邮件。'
- en: '* * *'
  id: totrans-51
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: '[PRE8]'
  id: totrans-52
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '* * *'
  id: totrans-53
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: '***Note:*** The italicized ID tag will be different in your output.'
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '***注意：*** 在您的输出中，斜体的ID标签可能会有所不同。'
- en: '* * *'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: 'Finally, close the connection:'
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 最后，关闭连接：
- en: '[PRE9]'
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Give the mail system a minute to process the message, then examine the Procmail
    log file in the recipient''s home directory:'
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 给邮件系统一分钟的时间来处理消息，然后检查收件人主目录中的Procmail日志文件：
- en: '[PRE10]'
  id: totrans-59
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'If Procmail processed the message successfully, you should see output similar
    to this:'
  id: totrans-60
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果Procmail成功处理了消息，您应该看到类似以下的内容：
- en: '[PRE11]'
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 25.8\. CONFIG FILES
  id: totrans-62
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 25.8\. 配置文件
- en: /usr/local/etc/procmailrc
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: /usr/local/etc/procmailrc
- en: The global Procmail configuration file. This file also contains recipes for
    processing mail messages.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 全局Procmail配置文件。此文件还包含处理邮件消息的食谱。
- en: /usr/home/username/.procmailrc
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: /usr/home/username/.procmailrc
- en: User-specific Procmail configuration file. The recipes in this file are processed
    after processing the recipes in /usr/local/etc/procmailrc. By default, environment
    variables from /usr/local/etc/procmailrc carry over to this file and should not
    be specified again. All folders are relative to the user's Maildir folder.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 用户特定的Procmail配置文件。此文件中的食谱在处理/usr/local/etc/procmailrc中的食谱之后处理。默认情况下，/usr/local/etc/procmailrc中的环境变量会传递到此文件，不应再次指定。所有文件夹都与用户的Maildir文件夹相对。
- en: 25.9\. LOG FILES
  id: totrans-67
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 25.9\. 日志文件
- en: /usr/home/username/proc.log
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: /usr/home/username/proc.log
- en: Contains a log of messages processed by Procmail for username
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 包含了为username处理的Procmail消息日志
- en: /var/log/maillog
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: /var/log/maillog
- en: General log of email activity
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 邮件活动的一般日志
- en: 25.10\. NOTES
  id: totrans-72
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 25.10\. 注意事项
- en: 'For examples of Procmail recipes, see the procmailex manual page:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 有关Procmail食谱的示例，请参阅procmailex手册页：
- en: '[PRE12]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
