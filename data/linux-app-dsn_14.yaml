- en: '![](../images/267-1.jpg)'
  id: totrans-0
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../images/267-1.jpg)'
- en: '[**DESIGNING AN SNMP MIB**](toc.html#chapter14)'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '[**设计SNMP MIB**](toc.html#chapter14)'
- en: '![](../images/as.jpg)'
  id: totrans-2
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../images/as.jpg)'
- en: If you read the previous chapter, you already have some idea of why you may
    need an SNMP interface and how it can be useful. In this chapter and the next,
    you’ll see how the information specific to an appliance can be added to this interface.
    Like the web, LCD, and CLI interfaces, the SNMP interface will also be based on
    the information available from RTA tables within the Laddie application itself.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您阅读了上一章，您已经对为什么可能需要SNMP接口以及它如何有用有一些了解。在本章和下一章中，您将看到如何将特定于设备的特定信息添加到这个接口中。像Web、LCD和CLI接口一样，SNMP接口也将基于Laddie应用程序本身内的RTA表格中可用的信息。
- en: 'This chapter is concerned primarily with the design of the MIB and creation
    of a valid MIB file. The topics covered here are:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章主要关注MIB的设计和创建一个有效的MIB文件。这里涉及的主题包括：
- en: Applying for an enterprise number
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 申请企业编号
- en: Designing the MIB
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 设计MIB
- en: Creating the MIB file
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 创建MIB文件
- en: Validating the MIB
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 验证MIB
- en: You will learn how to implement the agent in the next chapter.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 您将在下一章学习如何实现代理。
- en: '[**Our Goal**](toc.html#chapter14.1)'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: '[**我们的目标**](toc.html#chapter14.1)'
- en: 'In Chapter 5 you saw several of the Laddie application’s user interfaces to
    the ZONE structure: framebuffer, CLI, and web. Here’s the ZONE struct from the
    Laddie source:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在第5章中，您看到了Laddie应用程序对ZONE结构的几个用户界面：帧缓冲区、CLI和Web。以下是Laddie源代码中的ZONE结构：
- en: '![](../images/268-1.jpg)'
  id: totrans-12
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../images/268-1.jpg)'
- en: Figure 14-1 shows how this looked in the RTA table editor.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 图14-1展示了在RTA表格编辑器中的样子。
- en: '![](../images/268-2.jpg)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../images/268-2.jpg)'
- en: '*Figure 14-1: The ZONE struct in the RTA table editor*'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: '*图14-1：RTA表格编辑器中的ZONE结构*'
- en: Jumping ahead a bit, this is how the same information will look in our SNMP
    interface when we’re done designing and implementing our MIB.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 提前一点，这是我们完成设计和实现MIB后，相同信息在SNMP接口中的样子。
- en: '![](../images/268-3.jpg)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../images/268-3.jpg)'
- en: Our task in this chapter and the next is to show you how to go from the ZONE
    struct to the above SNMP interface, step by step. When we are done, you should
    understand how to do the same thing in your own application, doing a fair amount
    of cutting and pasting from this MIB.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 本章和下一章的任务是逐步向您展示如何从ZONE结构到上述SNMP接口，一步一步。当我们完成时，您应该了解如何在您自己的应用程序中做同样的事情，从本MIB中做大量的剪切和粘贴。
- en: You may have noticed that we did not include the *id*, *edge*, and *input* columns
    in our SNMP view of this table. This was not an oversight. It is up to the MIB
    designer (or any interface designer, for that matter) to decide what makes sense
    in light of the intended use of the interface. In our case, we decided that the
    *edge* and *input* information was too hardware specific to be necessary in this
    interface. The *id* column is not returned by our SNMP agent, but will be used
    as an index into the alarm table whenever access to a specific row is necessary.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能已经注意到，我们没有在我们的SNMP视图中将*id*、*edge*和*input*列包括在内。这并非疏忽。根据接口的预期用途，这是由MIB设计者（或任何接口设计者）来决定的。在我们的情况下，我们决定*edge*和*input*信息过于特定于硬件，在这个接口中不是必要的。*id*列不是由我们的SNMP代理返回的，但将在需要访问特定行时用作警报表的索引。
- en: '[**Your Enterprise Number**](toc.html#chapter14.2)'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '[**您的企业编号**](toc.html#chapter14.2)'
- en: Now that your interest is piqued, we’ll build suspense by taking a little detour
    for those of you actually in the process of starting a small company to sell your
    appliance. You may remember the brief discussion about enterprise numbers in the
    last chapter when we were identifying a printer using SNMP. Every MIB needs to
    be anchored to the overall namespace, and if you are designing a private MIB,
    you need an enterprise number of your own. These are assigned by IANA (Internet
    Assigned Numbers Authority). Each company or organization only needs one enterprise
    number because IANA grants you the authority to manage the tree beneath your number.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 既然您的兴趣已经被激发，我们将通过为那些正在开始一个小公司以销售您的设备的人稍微绕道来制造悬念。您可能还记得上一章中当我们使用SNMP识别打印机时关于企业编号的简要讨论。每个MIB都需要锚定到整体命名空间，如果您正在设计一个私有MIB，您需要自己的企业编号。这些由IANA（互联网数字分配机构）分配。每个公司或组织只需要一个企业编号，因为IANA授予您管理您编号下树的主权。
- en: Obtaining an enterprise number from IANA may take awhile, so you should get
    the ball rolling early. Once you apply, IANA will tell you to expect the process
    to take about a month. You can design and implement your MIB while IANA is processing
    your request.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 从IANA获取企业号码可能需要一段时间，所以您应该尽早开始。一旦申请，IANA会告诉您预计这个过程需要大约一个月。您可以在IANA处理您的请求的同时设计和实施您的MIB。
- en: The process itself is pretty easy. Just use your favorite web browser to navigate
    to the IANA website ([http://www.iana.org](http://www.iana.org/)) and click **Application
    Forms** in the menu. On the next page, select **Private Enterprise Numbers (SNMP)**.
    You’ll be presented with an online form to fill out.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 这个过程本身相当简单。只需使用您喜欢的网络浏览器导航到IANA网站([http://www.iana.org](http://www.iana.org/))，然后在菜单中点击**申请表格**。在下一页，选择**私有企业号码（SNMP）**。您将看到一个在线表格需要填写。
- en: At the bottom of the web page, there’s a link to the current list of registered
    numbers. You might want to check it out just to see who’s on the list. You’ll
    notice some pretty recognizable names near the beginning; these companies have
    been in the SNMP game since the beginning. IBM’s number is 2\. Cisco has 9\. Hewlett
    Packard has 11\. You can scroll down to the bottom to see what the current high
    number is. You might also recognize the entry at number 23528\. It is the start
    of the subtree where we will anchor the Laddie MIB we will develop in this chapter.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 在网页底部，有一个链接指向当前注册号码列表。您可能想查看一下，看看名单上都有谁。您会注意到一些相当容易辨认的名字在列表开头；这些公司从SNMP游戏一开始就参与其中。IBM的号码是2。思科有9。惠普有11。您可以向下滚动到底部，看看当前的最高号码是多少。您也可能认出编号为23528的条目。这是我们将在本章中开发的Laddie
    MIB所锚定的子树的开始。
- en: 'When you start your application, you will be asked to provide the following
    information:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 当您开始申请时，您将被要求提供以下信息：
- en: Your company or organization name
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 您的公司或组织名称
- en: The company’s address
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公司的地址
- en: The company’s phone number
  id: totrans-28
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 公司的电话号码
- en: The name of the contact person
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 联系人的姓名
- en: The contact person’s address
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 联系人的地址
- en: The contact person’s phone number
  id: totrans-31
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 联系人的电话号码
- en: The contact person’s email address
  id: totrans-32
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 联系人的电子邮件地址
- en: A fax number
  id: totrans-33
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 传真号码
- en: As you may have noticed when looking at the current list, only the enterprise
    number, company name, contact person’s name, and contact’s email address are listed
    online. It’s a good idea to use something other than your general email address
    here, since it’s likely that spambots will harvest it. It’s handy to have a separate
    address for this purpose, something generic you can forward to whomever is responsible
    for your SNMP work in the future.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 当您查看当前列表时，您可能已经注意到，只有企业号码、公司名称、联系人姓名和联系人的电子邮件地址在网上列出。在这里使用除您的一般电子邮件地址以外的其他地址是个好主意，因为很可能会被垃圾邮件机器人收集。有一个单独的地址用于此目的，一个可以转发给未来负责您的SNMP工作的任何人的通用地址。
- en: Just enter your information in the form and click the **Submit Application**
    button.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 请在表单中输入您的信息，然后点击**提交申请**按钮。
- en: '[**The MIB Files**](toc.html#chapter14.3)'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '[**MIB文件**](toc.html#chapter14.3)'
- en: IANA grants you the authority to manage your own subtree, but it’s up to you
    to do a good job of it. Plan for success and don’t think of this appliance as
    the end of the line—leave room for expansion. You might want to define your enterprise
    number in a separate file where you can put information common to all your MIBs.
    (By the way, reading other people’s MIBs is a very good idea. You’ll find out
    what is common usage and you may pick up styles you find attractive along the
    way.)
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: IANA授予您管理自己的子树的权力，但您需要做好这项工作的质量。计划成功，不要将这个设备视为终点——留出扩展的空间。您可能希望在单独的文件中定义您的企业号码，这样您就可以放置所有MIB的共同信息。（顺便说一句，阅读其他人的MIB是一个非常好的主意。您会发现什么是有共同使用的，您可能会在途中找到您觉得吸引人的风格。）
- en: 'Here are the two files we’ll be creating in this chapter:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将创建以下两个文件：
- en: '**LADDIE-GROUP-SMI.txt**'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '**LADDIE-GROUP-SMI.txt**'
- en: This is the file where we’ll define the Laddie Group enterprise number and our
    product identification OIDs.¹
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我们将定义Laddie集团企业号码和我们的产品标识OID的文件。¹
- en: '**LAD-MIB.txt**'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '**LAD-MIB.txt**'
- en: This file will hold the Laddie product MIB. This MIB will be anchored under
    an OID defined in the LADDIE-GROUP-SMI.txt file.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 此文件将包含Laddie产品MIB。此MIB将在LADDIE-GROUP-SMI.txt文件中定义的OID下锚定。
- en: We’ll run these files through a utility supplied by Net-SNMP to produce skeleton
    code for our MIB implementation. You’ll also want these files on any system that
    will be running the management applications (snmpget, snmpset, snmpwalk, and so
    on) or interpreting traps and informs.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用Net-SNMP提供的实用程序来运行这些文件，以生成我们MIB实现的骨架代码。您还希望将这些文件放在任何将运行管理应用程序（snmpget、snmpset、snmpwalk等）或解释陷阱和通知的系统上。
- en: The network management system you are using will define where you place these
    files. The Net-SNMP management applications tend to want them in the directory
    /usr/local/share/snmp/mibs, though you can modify this, and it’s subject to the
    preferences of the OS distribution you are using. For our appliance we will place
    them in /opt/snmp/share/snmp/mibs.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 您使用的网络管理系统将定义您放置这些文件的位置。Net-SNMP管理应用程序倾向于希望它们位于目录/usr/local/share/snmp/mibs中，尽管您可以修改此设置，并且它取决于您使用的操作系统分发的偏好。对于我们的设备，我们将它们放在/opt/snmp/share/snmp/mibs中。
- en: '[**LADDIE-GROUP-SMI**](toc.html#chapter14.4)'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '[**LADDIE-GROUP-SMI**](toc.html#chapter14.4)'
- en: This is the file that describes the top-level structure we will be using to
    organize our Laddie enterprise subtree. It holds our enterprise number and product
    identification OID. This file is small, so let’s look at the whole thing and then
    discuss its structure. (The address, phone number, and fax number are bogus to
    protect Bob’s privacy, but you’ll get the general idea.)
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 这是描述我们将使用以组织Laddie企业子树的顶层结构的文件。它包含我们的企业编号和产品标识OID。这个文件很小，所以让我们看看整个文件，然后讨论其结构。（地址、电话号码和传真号码是假的，以保护鲍勃的隐私，但您会得到一般的概念。）
- en: '![](../images/271-1.jpg)'
  id: totrans-47
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../images/271-1.jpg)'
- en: Now let’s go through this file again in more detail. We’ll show you a section
    of the MIB file first and then discuss it. The best way to read this is to scan
    the MIB text briefly, then read the description while referring to the MIB text.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们更详细地查看这个文件。我们首先展示MIB文件的一部分，然后讨论它。阅读的最佳方式是简要扫描MIB文本，然后参考MIB文本阅读描述。
- en: LADDIE-GROUP-SMI DEFINITIONS ::= BEGIN
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: LADDIE-GROUP-SMI DEFINITIONS ::= BEGIN
- en: This line gives the MIB a name and tells the reader (human or program) that
    this is the beginning of our definitions for this MIB. Look for a matching END
    at the bottom of the file to tell the reader when all definitions are complete.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 这行代码为MIB赋予一个名称，并告诉读者（无论是人类还是程序）这是我们对这个MIB定义的开始。在文件的底部寻找匹配的END，以告诉读者所有定义何时完成。
- en: '![](../images/272-1.jpg)'
  id: totrans-51
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../images/272-1.jpg)'
- en: 'The IMPORTS section is like the #include section in a C program—it tells where
    to find the terms used in this MIB but not defined here. We included ![](../images/1.jpg)
    the MODULE-IDENTITY macro and ![](../images/2.jpg) the enterprises for use below.'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: IMPORTS部分类似于C程序中的#include部分——它告诉在哪里可以找到在此MIB中使用的但未在此定义的术语。我们包含了![图片](../images/1.jpg)MODULE-IDENTITY宏和![图片](../images/2.jpg)enterprises以供下面使用。
- en: 'Next, we defined the laddieGroup module:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们定义了laddieGroup模块：
- en: '![](../images/272-2.jpg)'
  id: totrans-54
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../images/272-2.jpg)'
- en: 'The funny-looking string in the LAST-UPDATED and REVISION lines is a time stamp
    specifying the year, month, day, hour, and minute of the last change or revision.
    The *Z* stands for GMT (Greenwich Mean Time), sometimes called *Zulu Time.* The
    hours and minutes are generally zeros, because no one really cares what hour and
    minute a revision was made. The ![](../images/1.jpg) number “200702220000Z” means
    February 22, 2007\. With separators, it would look like this: 2007-02-22 00:00.'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: LAST-UPDATED和REVISION行中的奇怪字符串是一个时间戳，指定了最后更改或修订的年份、月份、日期、小时和分钟。"Z"代表GMT（格林尼治标准时间），有时称为"Zulu
    Time"。小时和分钟通常是零，因为没有人真的关心修订是在哪个小时和分钟进行的。数字"200702220000Z"表示2007年2月22日。如果有分隔符，它看起来像这样：2007-02-22
    00:00。
- en: '![](../images/272-3.jpg)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../images/272-3.jpg)'
- en: This is where we’ll anchor the LAD-MIB we’ll be defining in the next section.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我们将在下一节中定义的LAD-MIB的锚点位置。
- en: '-- Products are registered here:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: -- 产品在此处注册：
- en: laddieProducts OBJECT IDENTIFIER ::= { laddieGroup 2 }
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: laddieProducts OBJECT IDENTIFIER ::= { laddieGroup 2 }
- en: laddieAppliance OBJECT IDENTIFIER ::= { laddieProducts 1 }
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: laddieAppliance OBJECT IDENTIFIER ::= { laddieProducts 1 }
- en: The laddieProducts section is where we defined the OIDs that identify our products
    (or entire product lines, if you’re thinking really big). We have defined an OID
    for our Laddie appliance here, and we’ll be setting sysObjectID in MIB-2² to this
    value on our appliances. This will allow someone polling the box with an SNMP
    utility like snmpget to determine that this box is a Laddie appliance. Large corporations
    may put the OIDs that identify all their products into a single file. Cisco, for
    example, has a CISCO-PRODUCTS file where it gathers all these OIDs. For now, Laddie
    only has a single product OID, so we won’t go to this trouble.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: laddieProducts 部分是我们定义识别我们的产品（或整个产品线，如果您真的很大）的 OID。在这里，我们为 Laddie 设备定义了一个 OID，我们将在
    MIB-2² 中设置我们的设备的 sysObjectID 为此值。这将允许使用 snmpget 等 SNMP 工具轮询此盒子的某人确定这是一个 Laddie
    设备。大型公司可能会将识别所有产品的 OID 放入一个单独的文件中。例如，思科有一个 CISCO-PRODUCTS 文件，它收集了所有这些 OID。目前，Laddie
    只有一个产品 OID，所以我们不会为此麻烦。
- en: END
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: END
- en: Here’s that END we were looking for. This is the end of the LADDIE-SMI-MIB.txt
    file and wraps up our discussion of it.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我们一直在寻找的 END。这是 LADDIE-SMI-MIB.txt 文件的结尾，并结束了我们对它的讨论。
- en: '[**Creating the LAD-MIB**](toc.html#chapter14.5)'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: '[**创建 LAD-MIB**](toc.html#chapter14.5)'
- en: In this section, we’ll create our appliance MIB. Refer to the illustration of
    the LAD-MIB structure in Figure 14-2 for a better idea of how the MIB components
    interrelate. It may be helpful to refer to this picture as you follow along with
    the development of the MIB file.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将创建我们的设备 MIB。为了更好地了解 MIB 组件之间的关系，请参考图 14-2 中 LAD-MIB 结构的插图。在跟随 MIB 文件的开发过程中，参考这张图片可能会有所帮助。
- en: 'The LAD-MIB is divided into three main sections:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: LAD-MIB 分为三个主要部分：
- en: ladTraps, containing definitions of traps
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ladTraps，包含陷阱定义
- en: ladTrapInfo, containing definitions of information objects sent in traps
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ladTrapInfo，包含发送到陷阱的信息对象定义
- en: ladSystem, containing definitions of pollable objects
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ladSystem，包含可轮询对象定义
- en: Let’s start the detailed walk-through. Again, we’ll be showing one or more lines
    followed by a discussion of what we’ve shown.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们开始详细的讲解。同样，我们将展示一行或多行，然后讨论我们所展示的内容。
- en: 'We’ll start with the BEGIN statement and the definition of our MIB name:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将从 BEGIN 语句和我们的 MIB 名称定义开始：
- en: LAD-MIB DEFINITIONS ::= BEGIN
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: LAD-MIB 定义 ::= BEGIN
- en: Hopefully this looks familiar. If not, take another look at the beginning of
    the LADDIE-GROUP-SMI.txt file. The BEGIN line says we are starting the definition
    of the LAD-MIB, which is the name we gave the MIB for our appliance.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 希望这看起来很熟悉。如果不熟悉，请再次查看 LADDIE-GROUP-SMI.txt 文件的开头。BEGIN 行表示我们开始定义 LAD-MIB，这是我们为我们的设备
    MIB 命名。
- en: '![](../images/274-1.jpg)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![](../images/274-1.jpg)'
- en: '*Figure 14-2: LAD-MIB Structure*'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 14-2：LAD-MIB 结构*'
- en: 'Next, we’ll import the externally defined types and macros that we will be
    using from other files:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将导入我们将从其他文件中使用的已定义的外部类型和宏：
- en: '![](../images/274-2.jpg)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![](../images/274-2.jpg)'
- en: The first set comes from ![](../images/1.jpg) SNMPv2-SMI just like in the LADDIE-GROUP-SMI.txt
    file we covered in the previous section.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 第一组与 LADDIE-GROUP-SMI.txt 文件中我们之前讨论的相同，来自 ![](../images/1.jpg) SNMPv2-SMI。
- en: The next set comes from ![](../images/2.jpg) SNMPv2-TC. The letters *TC* stand
    for *textual conventions.* SNMPv2-TC is basically a file that defines new, commonly
    used object types.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个集合来自 ![](../images/2.jpg) SNMPv2-TC。字母 *TC* 代表 *文本约定*。SNMPv2-TC 主要是定义新、常用对象类型的文件。
- en: The ![](../images/3.jpg) laddieMgmt OID from the LADDIE-GROUP-SMI.txt file will
    be our starting point in the overall namespace for our appliance MIB. We’ll use
    laddieMgmt as our link to the overall namespace by defining the module in this
    group below laddieMgmt in the code portion of the “Module Definition” section
    next.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 来自 LADDIE-GROUP-SMI.txt 文件的 ![](../images/3.jpg) laddieMgmt OID 将成为我们设备 MIB
    的整体命名空间中的起点。我们将通过在“模块定义”部分的代码部分中定义此组下的 laddieMgmt 来使用 laddieMgmt 作为我们到整体命名空间的链接。
- en: The SNMPv2-SMI and SNMPv2-TC MIB definitions are supplied with the Net-SNMP
    package. When you installed Net-SNMP on your system in the Chapter 13, these files
    were probably put into either /usr/share/snmp/mibs or /usr/local/share/snmp/mibs.
    Look for the files SNMPv2-SMI.txt and SNMPv2-TC.txt there.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: SNMPv2-SMI 和 SNMPv2-TC MIB 定义包含在 Net-SNMP 软件包中。当您在第 13 章中在系统上安装 Net-SNMP 时，这些文件可能被放置在
    /usr/share/snmp/mibs 或 /usr/local/share/snmp/mibs 中。在那里寻找 SNMPv2-SMI.txt 和 SNMPv2-TC.txt
    文件。
- en: '[***Module Definition***](toc.html#chapter14.6)'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '[***模块定义***](toc.html#chapter14.6)'
- en: We start by defining a module, ladProject, to contain our appliance MIB. This
    is where we put the copyright, revision history, contact information, and a general
    description of what the module contains.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先定义一个模块，ladProject，以包含我们的设备 MIB。这是我们放置版权、修订历史、联系信息和模块包含的一般描述的地方。
- en: '![](../images/275-1.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../images/275-1.jpg)'
- en: 'The MODULE-IDENTITY section is like one long sentence. The first and last lines,
    taken together, say that ladProject is a module defined directly below ![](../images/3.jpg)
    laddieMgmt in the namespace and that its OID is laddieMgmt.1\. Here’s the OID
    in numeric form:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 模块-标识符部分就像一个长句。第一行和最后一行合在一起说明 ladProject 是一个模块，直接位于 ![图片](../images/3.jpg) laddieMgmt
    之下，在命名空间中，并且其 OID 是 laddieMgmt.1。以下是数字形式的 OID：
- en: .1.3.6.1.4.1.3382.1
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: .1.3.6.1.4.1.3382.1
- en: The rest of the MODULE-IDENTITY section should be fairly clear after our discussion
    of the LADDIE-SMI in the previous section. You may notice that we have two REVISION
    clauses listed at lines ![](../images/1.jpg) and ![](../images/2.jpg). If you
    make changes to your MIB in the future, you will need to add revision clauses
    to explain what you did. The convention is to keep revision clauses in reverse-chronological
    order (that is, the most recent change appears at the top). This does not mean
    you should feel free to make any changes you want to your MIB; you will just be
    creating confusion for your customers if you change anything (names, OIDs, and
    so on) that is already defined in your MIB. You may, however, find it necessary
    to enhance your MIB with new information required by customer demand or to help
    manage new features you’ll be adding to your appliance. You may add new structure,
    but do not change existing structure!
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一节中讨论了 LADDIE-SMI 之后，MODULE-IDENTITY 部分的其余部分应该相当清晰。你可能注意到我们在 ![图片](../images/1.jpg)
    和 ![图片](../images/2.jpg) 行列出了两个 REVISION 子句。如果你将来对你的 MIB 进行修改，你需要添加修订子句来解释你所做的更改。惯例是将修订子句按逆时间顺序保留（也就是说，最近的更改出现在顶部）。这并不意味着你可以随意更改你的
    MIB；如果你更改了任何已经定义在 MIB 中的内容（名称、OID 等），你只是会给你的客户造成混乱。然而，你可能发现有必要根据客户需求或帮助你管理将要添加到你的设备中的新功能来增强你的
    MIB。你可以添加新的结构，但不要更改现有的结构！
- en: Clearly your LAST-UPDATED time stamp will match that of your most recent revision
    clause, as ours does above.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，你的 LAST-UPDATED 时间戳将与你的最新修订条款相匹配，就像我们上面所做的那样。
- en: 'The next set of lines defines the sections we will be fleshing out later:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的几行定义了我们稍后将要详细说明的部分：
- en: '![](../images/276-1.jpg)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../images/276-1.jpg)'
- en: Putting all of the section heading OIDs together at the top, as we have done
    here, is a stylistic choice we feel can help communicate the structure of the
    rest of the MIB. We’re making it clear that there will be a section for defining
    traps, one for system information (where we will be putting our Alarm Table),
    and another section for the non-pollable information we will only send along with
    traps.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 将所有部分标题的 OID 一起放在顶部，就像我们在这里所做的那样，是我们认为可以帮助传达 MIB 其余部分结构的风格选择。我们明确表示将有一个用于定义陷阱的部分，一个用于系统信息（我们将在这里放置我们的警报表）的部分，以及一个用于我们只会与陷阱一起发送的非可轮询信息部分。
- en: 'Numbering in SNMP usually begins with 1, not zero, but you may have noticed
    that we gave ![](../images/1.jpg) the ladTraps section above the OID of ladProject.0\.
    Our reason for doing this dates back to the early days of SNMPv2 (SNMP version
    2), when compatibility with SNMPv1 (SNMP version 1) was being crafted. For more
    details, you may want to read *RFC 1908: Coexistence between Version 1 and Version
    2 of the Internet-Standard Network Management Framework.*'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '在 SNMP 中的编号通常从 1 开始，而不是 0，但你可能已经注意到我们在 ladProject.0 的 OID 上方给出了 ladTraps 部分
    ![图片](../images/1.jpg)。我们这样做的原因可以追溯到 SNMPv2（SNMP 版本 2）的早期，当时正在制定与 SNMPv1（SNMP
    版本 1）的兼容性。更多详情，你可能想阅读 *RFC 1908: Internet 标准网络管理框架版本 1 和版本 2 的共存*。'
- en: We’ll continue our review of our MIB with the ladSystem section and leave the
    traps for later. That will allow us to immediately follow our discussion of the
    trap with the ladTrapInfo section.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将继续审查我们的 MIB，从 ladSystem 部分开始，并将陷阱留到以后。这样我们就可以立即在 ladTrapInfo 部分讨论陷阱。
- en: -- LAD System Information
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: -- LAD 系统信息
- en: ladSystemScalars OBJECT IDENTIFIER ::= { ladSystem 1 }
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: ladSystemScalars OBJECT IDENTIFIER ::= { ladSystem 1 }
- en: ladSystemTables OBJECT IDENTIFIER ::= { ladSystem 2 }
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: ladSystemTables OBJECT IDENTIFIER ::= { ladSystem 2 }
- en: Here we further subdivide the ladSystem section into a section for scalars and
    another for tables. *Scalars* are just objects that are not columns in tables.
    Experience has taught us to keep scalars and tables separate to avoid having scalars
    sprinkled around between tables as the MIB evolves over time.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们将 ladSystem 部分进一步细分为标量部分和表格部分。*标量* 是不是表格列的对象。经验告诉我们，为了防止随着时间的推移 MIB 发展过程中标量散布在表格之间，应该将标量和表格分开。
- en: '[***Version and Number of Zones***](toc.html#chapter14.7)'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '[***版本和区域数量***](toc.html#chapter14.7)'
- en: Next, we’ll define some scalars in our ladSystemScalars section.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们将在 ladSystemScalars 部分定义一些标量。
- en: '![](../images/277-1.jpg)'
  id: totrans-100
  prefs: []
  type: TYPE_IMG
  zh: '![](../images/277-1.jpg)'
- en: 'Here we have defined two objects (note the OBJECT-TYPE keyword): ladVersion
    and ladNumberOfZones. The SYNTAX clause tells us that ladVersion is a DisplayString,
    meaning it is represented as a string of displayable (printable) characters, and
    ladNumberOfZones is a 32-bit integer with values ranging from 1 through 128\.
    If you refer back to our IMPORT section at the start of this MIB, you will see
    that both of these syntaxes were imported from SNMPv2-TC, the textual conventions
    file.'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们定义了两个对象（注意 OBJECT-TYPE 关键字）：ladVersion 和 ladNumberOfZones。SYNTAX 子句告诉我们
    ladVersion 是一个 DisplayString，这意味着它表示为可显示（可打印）字符的字符串，ladNumberOfZones 是一个 32 位整数，其值范围从
    1 到 128。如果你回顾一下本 MIB 开头部分的 IMPORT 部分，你会看到这两个语法都是从 SNMPv2-TC，即文本约定文件中导入的。
- en: The MAX-ACCESS clause tells us that each of these objects is read-only. Some
    objects we will encounter later in this MIB will have read-write, not-accessible,
    or accessible-for-notify access. *Read-write* just means you can read the object’s
    value as well as write a new value. You can’t read or write objects defined as
    *not-accessible*, but you might use one as an index into a table. *Accessible-for-notify*
    is how we define information sent with a trap but that otherwise is not pollable.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: MAX-ACCESS 子句告诉我们这些对象都是只读的。我们将在本 MIB 后面遇到的一些对象将具有读-写、不可访问或可通知访问。*读-写* 意味着你既可以读取对象的值，也可以写入新的值。你不能读取或写入定义为
    *不可访问* 的对象，但你可能将其用作表的索引。*可通知访问* 是我们定义随陷阱发送的信息，但除此之外不可轮询的方式。
- en: One point to keep in mind here is that the MAX-ACCESS clause defines *maximum*
    access, not *actual* access. You will never be able to write an object that has
    max-access read-only, but you may not be able to write to an object whose max-access
    is read-write, either. The ability to write to the object may be restricted by
    other factors. For example, in Net-SNMP, you may not write to any object that
    has a value set in the snmpd.conf file, regardless of what the MAX-ACCESS clause
    indicates in the MIB file.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 这里需要记住的一个要点是，MAX-ACCESS 子句定义的是 *最大* 访问权限，而不是 *实际* 访问权限。你永远无法编写具有最大访问权限只读的对象，但你可能也无法编写具有最大访问权限为读写的对象。对对象的写入能力可能受到其他因素的限制。例如，在
    Net-SNMP 中，你可能无法写入 snmpd.conf 文件中设置了值的任何对象，无论 MIB 文件中的 MAX-ACCESS 子句指示的是什么。
- en: The STATUS clause indicates that both objects are current, that is, they are
    are valid objects in this version of the MIB. To remove an object from a MIB,
    you would make its status deprecated. This is a brand new MIB, so nothing is deprecated.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: STATUS 子句表明这两个对象都是当前的，也就是说，它们是 MIB 版本中的有效对象。要从 MIB 中删除对象，你会将其状态标记为已弃用。这是一个全新的
    MIB，所以没有什么是已弃用的。
- en: The DESCRIPTION clause is intended specifically for the human reader of the
    MIB, rather than a computer program. It should contain a brief description of
    the object. It might also contain possible uses of the value and any caveats the
    reader may need to know.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: DESCRIPTION 子句专门用于 MIB 的人类读者，而不是计算机程序。它应包含对象的简要描述。它还可能包含值的可能用途以及读者可能需要了解的任何注意事项。
- en: 'The last line of each section defines the OID. The ::= means *is defined as.*
    Each OID is described as appending to a previous OID. The ladNumberOfZones object’s
    OID is the same as ladSystemScalars with a *2* appended to the end. Its whole
    numeric OID looks like this:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 每个部分的最后一行定义了OID。The ::= 表示 *定义为.* 每个 OID 都描述为附加到前一个 OID 上。ladNumberOfZones 对象的
    OID 与 ladSystemScalars 相同，只是在末尾附加了一个 *2*。它的完整数字 OID 看起来是这样的：
- en: .1.3.6.1.4.1.23528.1.1.1.1.2
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: .1.3.6.1.4.1.23528.1.1.1.1.2
- en: 'The first six numbers in this string are from standard MIBs and can be read
    like this:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 这串数字的前六个数字来自标准 MIB，可以读作：
- en: .iso(1).org(3).dod(6).internet(1).private(4).enterprises(1)
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: .iso(1).org(3).dod(6).internet(1).private(4).enterprises(1)
- en: The next number is where IANA gave us our own enterprise number, 23528\. So
    after enterprises, the rest of the OID continues
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个数字是IANA为我们分配的自己的企业号，23528。因此，在企业之后，OID的其余部分继续
- en: laddieGroup.laddieMgmt.ladProject.ladSystem.ladSystemScalars.ladNumberOfZones
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: laddieGroup.laddieMgmt.ladProject.ladSystem.ladSystemScalars.ladNumberOfZones
- en: See Figure 14-3 for the correspondence between each number in the OID and its
    descriptive name.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 见图14-3，了解OID中每个数字与其描述性名称之间的对应关系。
- en: '![](../images/278-1.jpg)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![](../images/278-1.jpg)'
- en: '*Figure 14-3: OID for ladNumberOfZones*'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '*图14-3：ladNumberOfZones的OID*'
- en: '[***The Alarm Table***](toc.html#chapter14.8)'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '[***警报表***](toc.html#chapter14.8)'
- en: 'Now for the core of our MIB: the Alarm Table. This is the table we displayed
    at the beginning of this chapter, showing the zones and alarm states. Here is
    how we define this table in our MIB:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 现在来看我们MIB的核心：警报表。这是我们在本章开头显示的表格，显示了区域和警报状态。以下是我们在MIB中定义此表的方式：
- en: '![](../images/279-1.jpg)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![](../images/279-1.jpg)'
- en: 'Notice that we have three blocks of definition above: ladAlarmTable, ladAlarmEntry,
    and LadAlarmEntry. SNMP requires that all object names begin with a lowercase
    letter (hence, ladAlarmTable, ladAlarmEntry). However, LadAlarmEntry is not an
    object, but rather a definition of the syntax of the table entry. It is common
    practice to define the *syntax* of a table with the same name as the table entry,
    but starting with an uppercase letter (*l*adAlarmEntry versus *L*adAlarmEntry).
    The syntax of ladAlarmTableEntry is a sequence (list or array) of other object
    types which are the columns in the table.'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，我们上面有三个定义块：ladAlarmTable、ladAlarmEntry和LadAlarmEntry。SNMP要求所有对象名称以小写字母开头（因此，ladAlarmTable、ladAlarmEntry）。然而，LadAlarmEntry不是一个对象，而是表格条目语法的定义。通常的做法是用与表格条目相同的名称来定义表格的*语法*，但以大写字母开头（*l*adAlarmEntry与*L*adAlarmEntry）。ladAlarmTableEntry的语法是其他对象类型的序列（列表或数组），这些类型是表中的列。
- en: 'After the definition of the table entry syntax, we’ll list the detailed definitions
    of each of the columns listed in the SEQUENCE clause:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 在定义表格条目语法之后，我们将列出SEQUENCE子句中列出的每个列的详细定义：
- en: '![](../images/279-2.jpg)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
  zh: '![](../images/279-2.jpg)'
- en: '![](../images/280-1.jpg)'
  id: totrans-121
  prefs: []
  type: TYPE_IMG
  zh: '![](../images/280-1.jpg)'
- en: The MAX-ACCESS clause in each of these objects defines how it may be used. We
    have made ladAlarmZoneId not-accessible because we will only be using it to index
    into the table to read or write the other values. Notice that ladAlarmEnable,
    ladAlarmLatching, and ladAlarmState are read-write, but ladAlarmZoneName is read-only.
    We wanted to be able to use SNMP commands to enable or disable alarms, change
    whether or not they latch, and clear alarms by setting their state to false. We
    felt, however, that changing the name of a zone is a static configuration that
    should be done through another interface, like the web interface or the CLI. The
    ladAlarmCount is a history of the number of times the alarm has triggered, so
    we have made this read-only.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 这些对象中的每个MAX-ACCESS子句定义了其可能的使用方式。我们将ladAlarmZoneId设置为不可访问，因为我们只会用它来索引表以读取或写入其他值。请注意，ladAlarmEnable、ladAlarmLatching和ladAlarmState是可读写，但ladAlarmZoneName是只读。我们希望能够使用SNMP命令启用或禁用警报，改变它们是否锁定，并通过将它们的状态设置为false来清除警报。然而，我们认为更改区域名称是静态配置，应该通过另一个接口完成，例如Web接口或CLI。ladAlarmCount是警报触发的次数历史记录，因此我们将其设置为只读。
- en: There is nothing mandatory about the MAX-ACCESS choices we have made here. You
    might well disagree with some of these choices and design your MIB differently.
    Look at the SNMP display of the Zone structure in the section “Our Goal” on page
    244\. Had we defined our ladAlarmZoneId as readable, you would see the row number
    at the start of each row right before the zone name. We also could have defined
    the count field as writable so you could reset it to zero periodically; this would
    allow you to see how many times the alarm has triggered over a period without
    having to save the old value and subtract it from the new one. These choices belong
    to the designer.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在这里做出的MAX-ACCESS选择没有强制性。你可能会不同意其中的一些选择，并设计不同的MIB。查看第244页“我们的目标”部分中区域结构的SNMP显示。如果我们把ladAlarmZoneId定义为可读的，你会在每行开始处看到行号，就在区域名称之前。我们还可以将计数字段定义为可写，这样你就可以定期将其重置为零；这将允许你在不保存旧值并从新值中减去它的情况下，看到警报在一段时间内触发的次数。这些选择属于设计者。
- en: '[***The Traps***](toc.html#chapter14.9)'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '[***陷阱***](toc.html#chapter14.9)'
- en: 'Now let’s leave the Alarm Table and move on to our traps:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们离开警报表，继续我们的陷阱：
- en: '![](../images/281-1.jpg)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
  zh: '![](../images/281-1.jpg)'
- en: 'We have included two traps: one to raise a red flag when an intrusion has been
    detected and the other to let you know when everything has returned to normal.
    These look a lot like the OBJECT-TYPE definitions above, but we use NOTIFICATION-TYPE
    for traps.'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 我们包含了两个陷阱：一个用于检测到入侵时升起红旗，另一个用于告知一切恢复正常。这些看起来与上面的 OBJECT-TYPE 定义非常相似，但我们使用 NOTIFICATION-TYPE
    来定义陷阱。
- en: The OBJECTS clause in the ladAlarm trap definition tells what other information
    will accompany the trap. This is often called the varbind list, for *var*iable
    *bind*ings. These variables, which explain why the trap was sent, are bound to
    the trap when it is sent.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: ladAlarm 陷阱定义中的 OBJECTS 子句说明了将随陷阱一起发送的其他信息。这通常被称为 varbind 列表，即 *var*iable *bind*ings。这些变量，它们解释了为什么发送陷阱，当陷阱发送时与陷阱绑定。
- en: '![](../images/282-1.jpg)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
  zh: '![](../images/282-1.jpg)'
- en: These are the definitions of the objects in our varbind list. The MAX-ACCESS
    of these is set to accessible-for-notify, meaning they cannot be polled; they
    merely define the objects for the benefit of the trap receiver. These objects
    only have meaning when attached to a trap.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 这些是我们 varbind 列表中对象的定义。这些对象的 MAX-ACCESS 设置为 accessible-for-notify，这意味着它们不能被轮询；它们仅仅是为了方便陷阱接收者而定义对象。这些对象只有在附加到陷阱时才有意义。
- en: Early SNMP documents (RFCs) were created with concern for keeping SNMP traffic
    to a minimum to prevent burdening networks with extra traffic. Traps were intended
    just to draw attention to a possible problem; you were supposed to poll the device
    for specifics about what was wrong. Today, however, some network administrators
    use trap logs as a history of what’s been happening on the device. They want all
    pertinent information sent with the trap and logged by the trap-receiving software.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 早期的 SNMP 文档（RFCs）在创建时考虑到了将 SNMP 流量保持在最低限度，以防止网络因额外流量而负担过重。陷阱的目的是仅仅引起对可能问题的注意；你应该轮询设备以获取有关错误的详细信息。然而，如今，一些网络管理员将陷阱日志用作设备上发生事件的记录。他们希望所有相关信息都随陷阱发送并由陷阱接收软件记录。
- en: You’ll also want to take care that your device doesn’t become too chatty with
    its traps. Laddie is unlikely to have this problem, but if you are building an
    appliance intended to sit on a major corporate, ISP, or carrier network, you had
    better consider this. If you check for error conditions every minute and generate
    a trap each time some measure is over an acceptable threshold, an appliance that
    notices an error on Friday night will be able to send about 3,500 traps by Monday
    morning, all reporting the same problem. Any other problem from a different device
    will be lost in the jabber. You may want to just report the problem once when
    it is first noticed, then send another trap to indicate when the problem is corrected.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 你还应注意，你的设备不要因为陷阱而变得过于健谈。Laddie 很可能不会出现这个问题，但如果你正在构建一个打算放置在主要企业、ISP 或运营商网络上的设备，你最好考虑这一点。如果你每分钟检查一次错误条件，并在某个度量值超过可接受阈值时生成一个陷阱，那么在周五晚上发现错误的设备到周一早上可能会发送大约
    3,500 个陷阱，所有这些陷阱都报告了相同的问题。来自不同设备的任何其他问题都会在嘈杂中丢失。你可能只想在首次发现问题时报告一次问题，然后发送另一个陷阱以指示问题已得到纠正。
- en: The argument in favor of sending lots of traps is that SNMP is unreliable by
    design. It uses UDP packets to report problems with the assumption that any problem
    of importance will be noticed more than once, so the loss of a single trap will
    not be a problem. If you can’t be sure your trap was received, you had better
    keep sending it until someone notices, right? Well, that’s one approach. Another
    is just to use informs instead of traps. *Informs* became available with SNMPv2
    and are essentially traps with some built-in reliability. Informs expect a confirmation
    message from the receiver and will retry some number of times if they don’t see
    the confirm. If this isn’t good enough for you, then you might want to consider
    some reduced frequency schedule for resending your trap if your device has not
    received some attention.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 支持发送大量陷阱的论点是，SNMP 是设计上不可靠的。它使用 UDP 数据包来报告问题，假设任何重要的问题都会被注意到不止一次，因此单个陷阱的丢失不会成为问题。如果你不能确定你的陷阱已被接收，你最好继续发送它，直到有人注意到，对吧？嗯，这是一个方法。另一个方法是只使用
    informs 而不是 traps。*Informs* 在 SNMPv2 中可用，本质上是一些内置可靠性的陷阱。Informs 期望从接收者那里收到确认消息，如果它们没有看到确认，它们会重试一定次数。如果你觉得这还不够好，那么如果你的设备没有得到一些关注，你可能需要考虑为重新发送陷阱制定一个较低的频率计划。
- en: END
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: END
- en: Last but not least, there’s the END marker that signals the end of the MIB.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 最后但同样重要的是，END 标记表示 MIB 的结束。
- en: '[**Validating Your MIB**](toc.html#chapter14.10)'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '[**验证您的 MIB**](toc.html#chapter14.10)'
- en: Now that the MIB has been written, we need to test it for validity. The MIB
    must be not only human-readable, but machine parse-able. The syntax of a MIB must
    be as correct as the syntax of a computer program, or the applications using the
    MIB will be unable to interpret it. Lucky for us, multiple free MIB validators
    are available online. All you need is a browser and your MIB files. There’s always
    the risk that any online resources discussed here may be unavailable by the time
    you read this book, but the one we will be using here is on the SimpleWeb website,
    shown in Figure 14-4\. You can find it at [http://wwwsnmp.cs.utwente.nl/ietf/mibs/validate](http://wwwsnmp.cs.utwente.nl/ietf/mibs/validate).
    It has been around since 1997 and is run by the Universiteit Twente in the Netherlands.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 现在 MIB 已经编写完成，我们需要对其进行有效性测试。MIB 必须不仅可读，而且可由机器解析。MIB 的语法必须与计算机程序的语法一样正确，否则使用
    MIB 的应用程序将无法解释它。幸运的是，网上有多个免费的 MIB 验证器可用。您只需要一个浏览器和您的 MIB 文件。当然，这里讨论的任何在线资源在您阅读这本书时可能已经不可用，但我们在这里使用的是
    SimpleWeb 网站上的资源，如图 14-4 所示。您可以在 [http://wwwsnmp.cs.utwente.nl/ietf/mibs/validate](http://wwwsnmp.cs.utwente.nl/ietf/mibs/validate)
    找到它。它自 1997 年以来一直存在，由荷兰的 Twente 大学运营。
- en: '![](../images/283-1.jpg)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![](../images/283-1.jpg)'
- en: '*Figure 14-4: The SimpleWeb MIB validator*'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 14-4：SimpleWeb MIB 验证器*'
- en: Another free validator we have used is the one provided by Muonics at [http://www.muonics.com/Tools/smicheck.php](http://www.muonics.com/Tools/smicheck.php).
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用过的另一个免费验证器是由 Muonics 提供的，可以在 [http://www.muonics.com/Tools/smicheck.php](http://www.muonics.com/Tools/smicheck.php)
    找到。
- en: Make sure you do not skip the validation step! If you don’t get the syntax of
    your MIB exactly right, nothing will work for you from here on.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 确保您不要跳过验证步骤！如果您没有正确地得到您的 MIB 的语法，从现在开始将没有任何东西能为您工作。
- en: '[**Summary**](toc.html#chapter14.11)'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: '[**摘要**](toc.html#chapter14.11)'
- en: 'In this chapter you have seen how to apply for an enterprise number, develop
    an MIB, and validate that MIB. The hard part is trying to design the MIB structure
    to accommodate future changes. Our task for Laddie has been fairly simple because
    our whole MIB revolves around a simple RTA table, and the MIB is unlikely to evolve
    much over time. A designer working on a MIB for a real appliance doesn’t have
    it so easy. We suggest thinking about the basic types of information you may need
    to have, regardless of what direction your product takes in the future. For example,
    you may have:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，您已经看到了如何申请企业编号，开发 MIB，并验证该 MIB。困难的部分是尝试设计 MIB 结构以适应未来的变化。对于 Laddie，我们的任务相当简单，因为我们的整个
    MIB 都围绕一个简单的 RTA 表，MIB 很可能不会随着时间的推移而有太大的变化。为真实设备开发 MIB 的设计师并不容易。我们建议考虑您可能需要的基本信息类型，无论您的产品未来朝哪个方向发展。例如，您可能需要：
- en: Configuration information
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 配置信息
- en: Statistics
  id: totrans-145
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 统计信息
- en: Historical information
  id: totrans-146
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 历史信息
- en: Miscellaneous run-time states
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 杂项运行时状态
- en: Performance measures
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 性能指标
- en: Usage levels
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用级别
- en: Service or resource saturation levels
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务或资源饱和水平
- en: This may guide you in structuring your MIB to make your life easier as future
    demands are made on you and your MIB.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 这可能有助于您构建 MIB 结构，使您在未来的需求中生活更加轻松。
- en: __________________
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: __________________
- en: ¹ OIDs used to identify products are returned as the value of sysObjectId in
    MIB-2.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: ¹ 用于识别产品的 OID 作为 MIB-2 中 sysObjectId 的值返回。
- en: ² You can find sysObjectID defined in the SNMPv2-MIB.txt file, which is included
    with the Net-SNMP package.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: ² 您可以在包含在 Net-SNMP 软件包中的 SNMPv2-MIB.txt 文件中找到定义的 sysObjectID。
