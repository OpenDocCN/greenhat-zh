- en: Part III-3. HOST CONFIGURATION AND TCP/IP HOST CONFIGURATION PROTOCOLS
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第三部分-3. 主机配置和 TCP/IP 主机配置协议
- en: '[Chapter 59](ch59.html "Chapter 59. HOST CONFIGURATION CONCEPTS, ISSUES, AND
    MOTIVATION")'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '[第59章](ch59.html "第59章. 主机配置概念、问题和动机")'
- en: '[Chapter 60](ch60.html "Chapter 60. TCP/IP BOOTSTRAP PROTOCOL (BOOTP)")'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '[第60章](ch60.html "第60章. TCP/IP 引导协议 (BOOTP)")'
- en: '[Chapter 61](ch61.html "Chapter 61. DHCP OVERVIEW AND ADDRESS ALLOCATION CONCEPTS")'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '[第61章](ch61.html "第61章. DHCP 概述和地址分配概念")'
- en: '[Chapter 62](ch62.html "Chapter 62. DHCP CONFIGURATION AND OPERATION")'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '[第62章](ch62.html "第62章. DHCP 配置和操作")'
- en: '[Chapter 63](ch63.html "Chapter 63. DHCP MESSAGING, MESSAGE TYPES, AND FORMATS")'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '[第63章](ch63.html "第63章. DHCP 消息、消息类型和格式")'
- en: '[Chapter 64](ch64.html "Chapter 64. DHCP CLIENT/SERVER IMPLEMENTATION, FEATURES,
    AND IPV6 SUPPORT")'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '[第64章](ch64.html "第64章. DHCP 客户端/服务器实现、特性和 IPv6 支持")'
- en: Each host that is placed on a network or internetwork must be set up and configured
    before it can be used. Configuration ensures that the host functions properly
    and that it is told the parameters needed for it to successfully communicate with
    other hosts and devices. In the good old days, administrators would manually set
    up each host as it was added to the network, and they would also manually make
    changes to the configuration as required.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 每个放置在网络上或互联网上的主机在使用之前都必须进行设置和配置。配置确保主机正常工作，并告知它与其他主机和设备成功通信所需的参数。在美好的旧日子里，管理员会手动设置每个主机，每当它被添加到网络时，他们也会根据需要手动更改配置。
- en: Modern networks, however, are very large, and manual configuration of hosts
    is a time-consuming chore. Furthermore, we often need features that only automated
    configuration can provide, particularly for special hosts that have no internal
    storage. It is for these reasons that *host configuration* protocols were developed.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，现代网络非常大，手动配置主机是一项耗时的工作。此外，我们经常需要只有自动化配置才能提供的功能，尤其是对于没有内部存储的特殊主机。正因为如此，才开发了
    *主机配置* 协议。
- en: This part includes six chapters that describe the concepts behind host configuration
    protocols and then illustrate the operation of two of the most important ones
    in use today. The first chapter is an overview of host configuration concepts
    and issues, which will help you understand why these protocols are so important.
    In the second chapter, I describe the TCP/IP Bootstrap Protocol (BOOTP), the first
    truly capable automated configuration tool for Internet Protocol (IP) hosts.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 本部分包括六章，描述了主机配置协议背后的概念，并说明了目前使用中最重要的两个协议的操作。第一章是主机配置概念和问题的概述，这将帮助您理解为什么这些协议如此重要。第二章，我描述了
    TCP/IP 引导协议 (BOOTP)，这是第一个真正有能力的为互联网协议 (IP) 主机提供自动化配置的工具。
- en: The remaining chapters in this part cover BOOTP's successor, the feature-filled
    Dynamic Host Configuration Protocol (DHCP). The third chapter introduces DHCP
    and talks about the different ways DHCP can assign addresses, with a focus on
    dynamic addressing. The fourth chapter discusses how DHCP operates, including
    a look at configuration parameter management and the procedures for allocating
    addresses and managing those allocations. The fifth chapter describes DHCP messaging
    and illustrates the DHCP message format. The final chapter details DHCP clients
    and servers, looks at special features and issues with DHCP, and describes DHCP
    changes to support the new IP version 6 (IPv6).
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 本部分剩余的章节涵盖了 BOOTP 的继任者，功能丰富的动态主机配置协议 (DHCP)。第三章介绍了 DHCP，并讨论了 DHCP 分配地址的不同方式，重点关注动态寻址。第四章讨论了
    DHCP 的操作，包括配置参数管理以及分配地址和管理这些分配的流程。第五章描述了 DHCP 消息，并说明了 DHCP 消息格式。最后一章详细介绍了 DHCP
    客户端和服务器，探讨了 DHCP 的特殊特性和问题，并描述了 DHCP 对支持新 IP 版本 6（IPv6）所做的更改。
- en: Technically, the very first host configuration protocol for TCP/IP was the Reverse
    Address Resolution Protocol (RARP). RARP is a simple, crude protocol that allows
    very basic host configuration to be performed, but little else. RARP is very different
    from BOOTP and DHCP, not only because of its more limited capabilities, but because
    it operates between layers 2 and 3, like the Address Resolution Protocol (ARP)
    on which it is based. It is therefore covered in [Part II-2](pt05.html "Part II-2. TCP/IP
    NETWORK INTERFACE/INTERNET LAYER CONNECTION PROTOCOLS"), which also describes
    ARP.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 从技术上讲，TCP/IP的第一个主机配置协议是反向地址解析协议（RARP）。RARP是一个简单、原始的协议，允许执行非常基本的主机配置，但除此之外很少。RARP与BOOTP和DHCP非常不同，不仅因为它的功能更有限，还因为它在2层和3层之间运行，就像它所基于的地址解析协议（ARP）一样。因此，它包含在[第二部分-2](pt05.html
    "第二部分-2. TCP/IP 网络接口/互联网层连接协议")中，该部分还描述了ARP。
- en: Chapter 59. HOST CONFIGURATION CONCEPTS, ISSUES, AND MOTIVATION
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第59章。主机配置概念、问题和动机
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages287681.png.jpg)'
  id: totrans-13
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages287681.png.jpg)'
- en: Putting a host on an internetwork requires that certain setup and configuration
    procedures be followed. Hardware must be selected and set up, and software must
    be chosen and installed on the hardware. Once the software is set up, we aren't
    finished, however. We must also perform other configuration tasks that tell the
    software how we want it to operate and give it certain parameters, so it knows
    its role on the network and how to function.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 将主机置于互联网中需要遵循某些设置和配置程序。必须选择和设置硬件，并在硬件上选择和安装软件。一旦软件设置完成，我们还没有完成。我们还需要执行其他配置任务，告诉软件我们希望它如何运行，并给它一些参数，以便它知道自己在网络中的角色以及如何运行。
- en: In this brief chapter, I discuss the purpose of host configuration, the problems
    associated with it, and host configuration protocols.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一简短的章节中，我讨论了主机配置的目的、与之相关的问题以及主机配置协议。
- en: The Purpose of Host Configuration
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 主机配置的目的
- en: 'Probably the most important configuration task that must be performed for each
    host on an internetwork is to give it an *identity*, in the form of an address
    that is unique to it alone. In TCP/IP networks, each device must be given an IP
    address. Hosts also often require other parameters to ensure that they operate
    properly. For a TCP/IP network, we might want to tell each host some of the following:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在互联网中为每个主机执行的最重要配置任务可能是为其赋予一个*身份*，形式为一个仅属于它的唯一地址。在TCP/IP网络中，每个设备都必须分配一个IP地址。主机通常还需要其他参数以确保它们正常运行。对于TCP/IP网络，我们可能希望告诉每个主机以下信息：
- en: The address of a default router on the local network
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 本地网络上默认路由器的地址
- en: The network mask the host should use
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主机应使用的网络掩码
- en: The addresses of servers providing particular services to the host, such as
    a mail server or a Domain Name System (DNS) name server
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为主机提供特定服务的服务器地址，例如邮件服务器或域名系统（DNS）名称服务器
- en: The maximum transmission unit (MTU) of the local network (see [Chapter 22](ch22.html
    "Chapter 22. IP DATAGRAM SIZE, FRAGMENTATION, AND REASSEMBLY"))
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 本地网络的最大传输单元（MTU）（见[第22章](ch22.html "第22章. IP 数据报大小、分片和重组"））
- en: What Time to Live (TTL) value to use for IP datagrams (see [Chapter 21](ch21.html
    "Chapter 21. INTERNET PROTOCOL DATAGRAM ENCAPSULATION AND FORMATTING"))
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应该为IP数据报使用什么生存时间（TTL）值（见[第21章](ch21.html "第21章. 互联网协议数据报封装和格式"））
- en: There may be a lot more information that must be relayed to the host. Dozens
    of different parameters must be set up for certain networks. Many of these may
    be common to all the machines on a network, but IP addresses must be unique. The
    administrator must therefore ensure that each IP address is assigned to only one
    computer, even as machines are added to and removed from the network.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 可能需要传达给主机的还有更多信息。某些网络可能需要设置数十个不同的参数。其中许多可能适用于网络上的所有机器，但IP地址必须是唯一的。因此，管理员必须确保每个IP地址只分配给一台计算机，即使网络中添加或移除机器时也是如此。
- en: The Problems with Manual Host Configuration
  id: totrans-24
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 手动主机配置的问题
- en: If you're an administrator in charge of a small local area network (LAN) with
    ten hosts, performing setup and configuration is simple. For each host, you set
    up the hardware, install the software, and then configure the software. Even making
    changes and keeping track of IP addresses wouldn't be a big deal; a single sheet
    of paper would suffice. However, what happens when your network has a hundred
    computers, or a thousand computers, or even ten thousand?
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你是一个负责管理拥有十个主机的小型局域网（LAN）的管理员，进行设置和配置很简单。对于每个主机，你只需设置硬件，安装软件，然后配置软件。即使更改并跟踪IP地址也不会成为大问题；一张纸就足够了。然而，当你的网络有一百台、一千台，甚至一万台计算机时，会发生什么呢？
- en: As the size of the network grows, the work needed for manual configuration grows
    with it. And while initial hardware setup may be time-consuming, at least it is
    done mainly when the host is first set up, and rarely changed thereafter. This
    is not the case with configuration parameters. If the address of the local router
    changes on a network with a thousand hosts, do you really want to go to each host
    to edit a configuration file?
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 随着网络规模的扩大，手动配置所需的工作量也随之增加。虽然初始硬件设置可能耗时，但至少它主要是在主机首次设置时完成，之后很少改变。然而，配置参数并非如此。如果网络上有千台主机，本地路由器的地址发生变化，你真的想逐个主机编辑配置文件吗？
- en: 'The drudge work associated with manual configuration is significant, but the
    problems go well beyond the inefficiency issue. There are situations where manual
    configuration is not just inconvenient, but is actually impossible:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 与手动配置相关的繁琐工作相当多，但问题远不止效率问题。有些情况下，手动配置不仅不方便，实际上是不可能的：
- en: '**Remote Configuration** An administrator cannot be everywhere; modern networks
    can span cities or nations. Unless we want to train every user on how to configure
    network hosts, we must use an automated protocol.'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: '**远程配置** 管理员不可能无处不在；现代网络可以跨越城市或国家。除非我们想要培训每个用户如何配置网络主机，否则我们必须使用自动协议。'
- en: '**Mobile Device Configuration** IP was designed when computers were large and
    attached to each other using heavy cables; today, we have computers that fit in
    a shirt pocket and communicate using radio waves. IP addresses must be assigned
    based on the network to which they are attached, and this makes reconfiguration
    required when a device is moved. This is not conducive to manual configuration
    at all.'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '**移动设备配置** 当计算机体积大且通过重型电缆相互连接时，IP被设计出来；今天，我们有了可以放入衬衫口袋的计算机，它们通过无线电波进行通信。IP地址必须根据它们连接的网络进行分配，这使得在设备移动时需要重新配置。这根本不利于手动配置。'
- en: '**Dumb Host Configuration** Most of the hosts we use today are full-fledged
    computers, with their own internal storage. We can assign such a device an address
    by entering it into a file that the device reads when it starts up. There are
    certain devices, however, that do not include any form of storage. Since they
    are mass-produced, they are all identical and cannot have individualized parameters
    stored within them. Such a device relies on a configuration protocol to learn
    what it needs to function on a network—especially including its individual identity.'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '**愚昧的主机配置** 我们今天使用的许多主机都是功能齐全的计算机，拥有自己的内部存储。我们可以通过将其输入设备启动时读取的文件来为这样的设备分配地址。然而，某些设备没有任何形式的存储。由于它们是批量生产的，它们都是相同的，无法在其中存储个性化的参数。这样的设备依赖于配置协议来学习它在网络上运行所需的信息——特别是包括其个体身份。'
- en: '**Address Sharing** The proliferation of devices attached to the global Internet
    has led to a situation where IP addresses must be carefully managed to ensure
    that they are not wasted on devices that aren''t using them. Some organizations
    even find themselves with more potential hosts than they have addresses. A host
    configuration protocol can allow an address to be automatically assigned to a
    host when needed, and then have that address returned to a common pool for reuse
    when the host leaves the network. This permits addresses to be shared and reduces
    the need for more address space.'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: '**地址共享** 全球互联网上连接的设备激增导致了一个必须仔细管理IP地址以确保它们不会被浪费在未使用它们的设备上的情况。一些组织甚至发现自己拥有的潜在主机数量超过了它们的地址数量。主机配置协议可以允许在需要时自动将地址分配给主机，然后在主机离开网络时将该地址返回到公共池以供重用。这允许地址共享并减少了更多地址空间的需求。'
- en: 'Automating the Process: Host Configuration Protocols'
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 自动化流程：主机配置协议
- en: Even though most of us don't have robots that can automate the hardware portions
    of the setup and configuration job, we can employ tools that will make the rest
    of the job easier. This includes the use of special *host configuration* protocols.
    These protocols allow hosts to be automatically configured when they are set up
    and to have additional parameters assigned when needed.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管我们大多数人没有能够自动化设置和配置硬件部分的机器人，但我们可以使用使其他工作更容易的工具。这包括使用特殊的**主机配置**协议。这些协议允许在设置时自动配置主机，并在需要时分配额外的参数。
- en: Host configuration protocols generally function by having a host send a request
    for an address and other parameters, which is satisfied by a response from a server.
    The information in the response is used by the client to set its address, identify
    a local router, and perform other necessary setup so it can communicate.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 主机配置协议通常通过主机发送一个请求地址和其他参数的请求来实现，这个请求由服务器的响应来满足。响应中的信息被客户端用来设置其地址，识别本地路由器，并执行其他必要的设置，以便它可以进行通信。
- en: The use of an automated protocol solves all of the problems associated with
    manual configuration. We can configure devices remotely, rather than needing to
    walk to each one. We can instantly assign a valid address to mobile devices. We
    can have dumb hosts boot up and obtain the information they need to operate. Finally,
    we can maintain a pool of addresses that is shared by a group of hosts.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 使用自动协议可以解决与手动配置相关联的所有问题。我们可以远程配置设备，而不是需要走到每个设备那里。我们可以立即为移动设备分配一个有效的地址。我们可以让无脑主机启动并获得它们操作所需的信息。最后，我们可以维护一个由一组主机共享的地址池。
- en: Tip
  id: totrans-36
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** *Host configuration protocols* enable administrators to set
    up hosts so that they can automatically determine their address and other key
    parameters. They are useful not only because of the effort they save over manual
    configuration, but because they enable the automatic setup of remote, storageless,
    or mobile devices.'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** *主机配置协议*使管理员能够设置主机，以便它们可以自动确定它们的地址和其他关键参数。它们不仅因为节省了手动配置的努力而有用，而且因为它们能够自动设置远程、无存储或移动设备。'
- en: The Role of Host Configuration Protocols in TCP/IP
  id: totrans-38
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 主机配置协议在TCP/IP中的作用
- en: You might find it strange that host configuration protocols would exist in the
    lofty heights of the application layer. It certainly sounds like host configuration
    is a function related more to the network layer, where internetwork addresses
    such as IP addresses function. In fact, some host configuration protocols, like
    the rudimentary Reverse Address Resolution Protocol (RARP, discussed in [Chapter 14](ch14.html
    "Chapter 14. REVERSE ADDRESS RESOLUTION AND THE TCP/IP REVERSE ADDRESS RESOLUTION
    PROTOCOL (RARP)")), do exist down at that level.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会觉得主机配置协议存在于应用层的崇高中有些奇怪。这确实听起来像主机配置是一个与网络层相关的功能，在那里互联网地址，如IP地址，发挥作用。实际上，一些主机配置协议，如基础的逆向地址解析协议（RARP，在第14章中讨论），确实存在于那个层面。
- en: However, there are advantages to having host configuration protocols reside
    at higher levels. A major one is that the operation of the protocol does not depend
    on the hardware on which it runs, making it more universal. Another is being able
    to convey host configuration messages between networks, which is not possible
    with a low-level protocol operating on the local network.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，将主机配置协议放在更高层次上也有一些优势。其中之一是协议的操作不依赖于它运行的硬件，这使得它更加通用。另一个优势是能够在网络之间传递主机配置消息，这是在本地网络中运行的低级协议所不可能做到的。
- en: Chapter 60. TCP/IP BOOTSTRAP PROTOCOL (BOOTP)
  id: totrans-41
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第60章。TCP/IP引导协议（BOOTP）
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages287681.png.jpg)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages287681.png.jpg)'
- en: Before a device on a TCP/IP network can effectively communicate, it needs to
    know its IP address. While a conventional network host can read this information
    from its internal disk, some devices have no storage, so they do not have this
    luxury. They need help from another device on the network to provide them with
    an IP address and the other information and/or software they need to become active
    Internet Protocol (IP) hosts. This problem of getting a new machine up and running
    is commonly called *bootstrapping*, and to provide this capability to IP hosts,
    the TCP/IP *Bootstrap Protocol (BOOTP)* was created.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 在TCP/IP网络上，一个设备能够有效通信之前，它需要知道自己的IP地址。虽然传统的网络主机可以从其内部磁盘读取此信息，但某些设备没有存储空间，因此没有这种奢侈。它们需要网络上的另一个设备提供IP地址以及其他它们需要成为活跃的互联网协议（IP）主机所需的信息和/或软件。将新机器启动并运行的问题通常被称为*引导启动*，为了向IP主机提供这种能力，TCP/IP的*引导协议（BOOTP）*被创建。
- en: In this chapter, I provide a detailed look at BOOTP. I begin with an overview
    and history of the protocol and a look at the standards that define it. I then
    discuss the general client/server nature of BOOTP and how addressing is done in
    communication between the client and the server. I describe the operation of BOOTP
    step by step and illustrate the format of BOOTP messages. I conclude with a description
    of BOOTP vendor extensions, which are used to allow the information sent in BOOTP
    messages to be customized, and a discussion of BOOTP relay agents, which allow
    the protocol to operate even when the BOOTP server and client are on different
    networks.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我详细介绍了BOOTP。我首先概述了该协议的历史和标准，然后讨论了BOOTP的客户端/服务器特性以及客户端和服务器之间通信中的寻址方式。我逐步描述了BOOTP的操作，并说明了BOOTP消息的格式。最后，我描述了BOOTP供应商扩展，这些扩展用于允许在BOOTP消息中发送的信息进行定制，并讨论了BOOTP中继代理，这些代理允许协议在BOOTP服务器和客户端位于不同网络时也能运行。
- en: Tip
  id: totrans-45
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**RELATED INFORMATION** *BOOTP was the predecessor of the Dynamic Host Configuration
    Protocol (DHCP). DHCP was built to be substantially compatible with BOOTP, and
    so the two protocols have a fair degree of commonality. To avoid duplication,
    certain information has been included only in the following chapters about DHCP
    (with references to this chapter where appropriate). On the other hand, some of
    the historical background information behind features like vendor information
    extensions and relay agents, which were first developed for BOOTP and adopted
    by DHCP, is in this chapter and referenced from the DHCP chapters. If you plan
    to read about DHCP as well as BOOTP, I recommend reading this section first. If
    you don''t plan to read up on DHCP, you may wish to check the discussion of DHCP/BOOTP
    interoperability in [Chapter 64](ch64.html "Chapter 64. DHCP CLIENT/SERVER IMPLEMENTATION,
    FEATURES, AND IPV6 SUPPORT")*.'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '**相关信息** *BOOTP是动态主机配置协议（DHCP）的前身。DHCP被构建为与BOOTP高度兼容，因此这两个协议有相当程度的相似性。为了避免重复，某些信息仅包含在以下关于DHCP的章节中（在适当的地方引用本章节）。另一方面，一些历史背景信息，如供应商信息扩展和中继代理，这些功能最初是为BOOTP开发的，后来被DHCP采用，包含在本章中，并从DHCP章节中引用。如果您计划阅读关于DHCP和BOOTP的内容，我建议首先阅读本节。如果您不打算了解DHCP，您可能希望查看[第64章](ch64.html
    "第64章。DHCP客户端/服务器实现、功能和IPv6支持")中关于DHCP/BOOTP互操作性的讨论*。'
- en: BOOTP Overview, History, and Standards
  id: totrans-47
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: BOOTP概述、历史和标准
- en: The TCP/IP protocol suite has been with us for over two decades, and the problem
    of how to automate the configuration of parameters on IP hosts has been around
    almost as long. Back in the early 1980s, networks were small and relatively simple,
    so manual configuration wasn't that difficult. Automated host configuration was
    primarily needed because it was the only way to configure devices like diskless
    workstations.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: TCP/IP协议套件已经陪伴我们超过二十年了，而如何在IP主机上自动配置参数的问题几乎与它一样历史悠久。在20世纪80年代初，网络规模小且相对简单，因此手动配置并不困难。自动主机配置主要需要，因为这是配置无盘工作站等设备唯一的方式。
- en: 'As I discussed in [Chapter 59](ch59.html "Chapter 59. HOST CONFIGURATION CONCEPTS,
    ISSUES, AND MOTIVATION"), without a form of internal storage, a device must rely
    on someone or something to tell it "who it is" (its address) and how to function
    each time it is powered up. When a device like this is turned on, it is in a difficult
    position: It needs to use IP to communicate with another device that will tell
    it how to communicate using IP! This process, called *bootstrapping* or *booting*,
    comes from an analogy to a person "pulling himself up using his own bootstraps."
    You''ve likely encountered this term before, if at no other time then when some
    tech support person has told you to "reboot" your computer.'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我在[第59章](ch59.html "第59章。主机配置概念、问题和动机")中讨论的那样，如果没有某种形式的内部存储，设备每次开机时都必须依赖某人或某物来告诉它“它是谁”（它的地址）以及如何操作。当这种设备开机时，它处于一个困难的境地：它需要使用IP与另一个设备通信，该设备将告诉它如何使用IP进行通信！这个过程被称为*引导*或*启动*，它来源于一个人“用自己的靴带把自己拉起来”的类比。你可能以前遇到过这个术语，如果不是在其他时候，那么可能是在某个技术支持人员告诉你“重新启动”你的计算机的时候。
- en: 'BOOTP: Correcting the Weaknesses of RARP'
  id: totrans-50
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: BOOTP：纠正RARP的弱点
- en: The Reverse Address Resolution Protocol (RARP) was the first attempt to resolve
    this bootstrap problem. Created in 1984, RARP is a direct adaptation of the low-level
    Address Resolution Protocol (ARP) that binds IP addresses to link-layer hardware
    addresses (see [Chapter 13](ch13.html "Chapter 13. ADDRESS RESOLUTION AND THE
    TCP/IP ADDRESS RESOLUTION PROTOCOL (ARP)")). RARP is capable of providing a diskless
    device with its IP address, using a simple client/server exchange of a request
    and reply between a host and an RARP server.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 反向地址解析协议（RARP）是解决这个引导问题的第一次尝试。RARP是在1984年创建的，它是将IP地址绑定到链路层硬件地址的低级地址解析协议（ARP）的直接改编（见[第13章](ch13.html
    "第13章。地址解析和TCP/IP地址解析协议（ARP）")）。RARP能够通过主机和RARP服务器之间简单的请求和回复客户端/服务器交换，为无盘设备提供其IP地址。
- en: The difficulty with RARP is that it has so many limitations. It operates at
    a fairly low level using hardware broadcasts, so it requires adjustments for different
    hardware types. An RARP server is also required on every physical network to respond
    to layer 2 broadcasts. Each RARP server must have address assignments manually
    provided by an administrator. And perhaps worst of all, RARP provides only an
    IP address to a host and none of the other information a host may need. (I describe
    these issues in detail in [Chapter 14](ch14.html "Chapter 14. REVERSE ADDRESS
    RESOLUTION AND THE TCP/IP REVERSE ADDRESS RESOLUTION PROTOCOL (RARP)").)
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: RARP的困难在于它有很多限制。它在一个相当低级的层面上使用硬件广播进行操作，因此需要针对不同硬件类型进行调整。每个物理网络都需要一个RARP服务器来响应第2层的广播。每个RARP服务器都必须由管理员手动提供地址分配。最糟糕的是，RARP只向主机提供一个IP地址，而不会提供主机可能需要的其他任何信息。（我在[第14章](ch14.html
    "第14章。反向地址解析和TCP/IP反向地址解析协议（RARP）")中详细描述了这些问题。）
- en: 'RARP clearly wasn''t sufficient for the host configuration needs of TCP/IP.
    To support both diskless hosts and other situations where the benefits of autoconfiguration
    were required, BOOTP was created. BOOTP was standardized in RFC 951, published
    in September 1985\. This relatively straightforward protocol was designed specifically
    to address the shortcomings of RARP:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: RARP显然不足以满足TCP/IP的主机配置需求。为了支持无盘主机和其他需要自动配置好处的情况，创建了BOOTP。BOOTP在1985年9月发布的RFC
    951中被标准化。这个相对简单的协议是专门设计来解决RARP的不足的：
- en: BOOTP is still based on a client/server exchange, but is implemented as a higher-layer
    software protocol, using the User Datagram Protocol (UDP) for message transport
    (see [Chapter 44](ch44.html "Chapter 44. TCP/IP USER DATAGRAM PROTOCOL (UDP)")).
    It is not dependent on the particular hardware of the network as RARP is.
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: BOOTP仍然基于客户端/服务器交换，但作为更高层的软件协议实现，使用用户数据报协议（UDP）进行消息传输（见[第44章](ch44.html "第44章。TCP/IP用户数据报协议（UDP）")）。它不依赖于网络的具体硬件，如RARP所做的那样。
- en: It supports sending additional configuration information to a client beyond
    just an IP address. This extra information can usually be sent in one message
    for efficiency.
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它支持向客户端发送除IP地址之外的其他配置信息。为了提高效率，这些额外信息通常可以包含在一个消息中。
- en: It can handle having the client and server on different networks of an internetwork.
    This allows the administration of the server providing IP addresses to be more
    centralized, saving money as well as administrative time and hassle.
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它可以处理客户端和服务器位于互联网的不同网络中。这使得提供IP地址的服务器管理更加集中化，从而节省了金钱以及管理时间和麻烦。
- en: 'It should be noted that, even though the name of BOOTP implies that it defines
    everything needed for a storageless device to boot, this isn''t really the case.
    As the BOOTP standard itself describes, bootstrapping generally requires two phases.
    In the first, the client is provided with an address and other parameters. In
    the second, the client downloads software, such as an operating system and drivers,
    that let it function on the network and perform other tasks. BOOTP really deals
    with only the first of these phases: address assignment and configuration. The
    second is assumed to take place using a simple file transfer protocol like the
    Trivial File Transfer Protocol (TFTP, discussed in [Chapter 73](ch73.html "Chapter 73. TRIVIAL
    FILE TRANSFER PROTOCOL (TFTP)")).'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 应该注意的是，尽管BOOTP的名字暗示它定义了无存储设备启动所需的一切，但这并不是真的。正如BOOTP标准本身所描述的，引导通常需要两个阶段。在第一阶段，客户端被提供地址和其他参数。在第二阶段，客户端下载软件，如操作系统和驱动程序，使其能够在网络上运行并执行其他任务。BOOTP实际上只处理这些阶段中的第一个：地址分配和配置。第二个阶段假定使用简单的文件传输协议，如简单文件传输协议（TFTP，在第73章中讨论，[Chapter 73](ch73.html
    "Chapter 73. TRIVIAL FILE TRANSFER PROTOCOL (TFTP)")）。
- en: Tip
  id: totrans-58
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** The first widely used host configuration protocol for TCP/IP
    was the *Boot Protocol (BOOTP)*. It was created specifically to enable host configuration
    while addressing many of the weaknesses of RARP. BOOTP is intended to be used
    as the first phase of a two-phase boot procedure for storageless devices. After
    obtaining an IP address and other configuration parameters using BOOTP, the device
    employs a protocol such as TFTP to download software necessary to function on
    the network.'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** TCP/IP的第一个广泛使用的主机配置协议是*引导协议（BOOTP）*。它是专门创建的，旨在在解决RARP的许多弱点的同时实现主机配置。BOOTP旨在作为无存储设备两阶段引导过程的第一阶段使用。在通过BOOTP获取IP地址和其他配置参数后，设备使用TFTP等协议下载在网络上运行所需的软件。'
- en: Vendor-Specific Parameters
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 供应商特定参数
- en: One smart decision made when BOOTP was created was the inclusion of a *vendor-specific
    area*. This was intended to provide a place where hardware vendors could define
    parameters relevant to their own products. As the complexity of TCP/IP increased,
    it was realized that this field could be used to define a method of communicating
    certain parameters that were commonly needed by IP hosts, and were in fact vendor-independent.
    This was first proposed in RFC 1048, "BOOTP Vendor Information Extensions," published
    in February 1988.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建BOOTP时做出的一个明智的决定是包含一个*供应商特定区域*。这是为了提供一个地方，让硬件供应商可以定义与其产品相关的参数。随着TCP/IP的复杂性增加，人们意识到这个字段可以用来定义一种方法，以通信IP主机通常需要的某些参数，实际上这些参数与供应商无关。这首先在1988年2月发布的RFC
    1048，“BOOTP供应商信息扩展”中提出。
- en: The fact that BOOTP can be used to provide information to a client beyond just
    an IP address makes it useful even in cases where a device already knows its address.
    BOOTP can be used to send parameters that the administrator wants all hosts to
    have, to ensure that they use the network in a consistent manner. Also, in the
    case of devices that do have local storage (and therefore do not need BOOTP to
    get an IP address), BOOTP can still be used to let these devices get the name
    of a boot file for phase two of bootstrapping, in which the client downloads software.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 事实是，BOOTP不仅可以向客户端提供IP地址之外的信息，这使得即使在设备已经知道其地址的情况下，它仍然很有用。BOOTP可以用来发送管理员希望所有主机都具有的参数，以确保它们以一致的方式使用网络。此外，对于具有本地存储（因此不需要BOOTP获取IP地址）的设备，BOOTP仍然可以用来让这些设备获取引导阶段第二阶段所需的引导文件名称，在这个阶段，客户端下载软件。
- en: Changes to BOOTP and the Development of DHCP
  id: totrans-63
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: BOOTP的变化和DHCP的发展
- en: BOOTP was the TCP/IP host configuration protocol of choice from the mid-1980s
    through the end of the 1990s. The vendor extensions introduced in RFC 1048 were
    popular, and over the years, additional vendor extensions were defined. RFC 1048
    was replaced by RFCs 1084, 1395, and 1497 in succession.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 从20世纪80年代中期到90年代末，BOOTP一直是TCP/IP主机配置协议的首选。RFC 1048中引入的供应商扩展很受欢迎，并且多年来，定义了额外的供应商扩展。RFC
    1048随后被RFC 1084、RFC 1395和RFC 1497依次取代。
- en: Some confusion also resulted over the years in how some sections of RFC 951
    should be interpreted and how certain features of BOOTP work. RFC 1542, "Clarifications
    and Extensions for the Bootstrap Protocol," was published in October 1993 to address
    this and also to make some slight changes to the protocol's operation. (RFC 1542
    is actually a correction of the nearly identical RFC 1532, which had some small
    errors.)
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 在过去几年中，关于 RFC 951 的某些部分应该如何解释以及某些 BOOTP 功能如何工作也存在一些混淆。1993 年 10 月发布的 RFC 1542，“引导协议的澄清和扩展”旨在解决这个问题，并对协议的操作进行了一些轻微的更改。（RFC
    1542 实际上是与几乎相同的 RFC 1532 的更正，后者有一些小错误。）
- en: While BOOTP was obviously quite successful, it also had certain weaknesses.
    One of the most important of these was the lack of support for *dynamic* address
    assignment. The need for dynamic assignment became much more pronounced when the
    Internet really started to take off in the late 1990s. This led directly to the
    development of the Dynamic Host Configuration Protocol (DHCP).
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然 BOOTP 显然非常成功，但它也存在某些弱点。其中最重要的一个就是缺乏对 *动态* 地址分配的支持。在 1990 年代后期互联网真正开始起飞时，对动态分配的需求变得更加明显。这直接导致了动态主机配置协议（DHCP）的发展。
- en: While DHCP replaced BOOTP as the TCP/IP host configuration protocol of choice,
    it would be inaccurate to say that BOOTP is gone. It is still used to this day
    in some networks. Furthermore, DHCP was based directly on BOOTP, and they share
    many attributes, including a common message format. BOOTP vendor extensions were
    used as the basis for DHCP *options*, which work in the same way but include extra
    capabilities. In fact, the successor to RFC 1497 is RFC 1533, which officially
    merges BOOTP vendor extensions and BOOTP options into the same standard.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然 DHCP 取代了 BOOTP 成为首选的 TCP/IP 主机配置协议，但说 BOOTP 已经消失是不准确的。它至今仍在某些网络中使用。此外，DHCP
    直接基于 BOOTP，并且它们共享许多属性，包括一个通用的消息格式。BOOTP 供应商扩展被用作 DHCP *选项* 的基础，这些选项以相同的方式工作，但包括额外的功能。实际上，RFC
    1497 的继任者是 RFC 1533，它正式将 BOOTP 供应商扩展和 BOOTP 选项合并到同一标准中。
- en: BOOTP Client/Server Messaging and Addressing
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: BOOTP 客户端/服务器消息和寻址
- en: While BOOTP can be used for a variety of devices, one of the primary motives
    behind its creation was to provide a way to automatically configure "dumb" devices
    that have no storage. Most of these devices are relatively limited in their capabilities,
    so requiring them to support a fancy boot protocol would not make sense. BOOTP
    is thus an uncomplicated protocol, which accomplishes host configuration without
    a lot of complicated concepts or implementation requirements.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然 BOOTP 可以用于各种设备，但其创建背后的一个主要动机是为没有存储的“笨拙”设备提供一种自动配置的方法。这些设备中的大多数在功能上相对有限，因此要求它们支持复杂的引导协议是没有意义的。因此，BOOTP
    是一种简单的协议，它通过不涉及太多复杂的概念或实现要求来完成主机配置。
- en: Like so many other TCP/IP protocols, BOOTP is client/server in nature. The operation
    of the protocol consists of a single exchange of messages between a *BOOTP client*
    and a *BOOTP server*. A BOOTP client can be any type of device that needs to be
    configured. A BOOTP server is a network device that has been specially set up
    to respond to BOOTP client requests, and has been programmed with addressing and
    other information it can provide to clients when required.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 与许多其他 TCP/IP 协议一样，BOOTP 在本质上是一种客户端/服务器架构。该协议的操作由一个 *BOOTP 客户端* 和一个 *BOOTP 服务器*
    之间的单一消息交换组成。任何需要配置的设备都可以是 BOOTP 客户端。BOOTP 服务器是一种特别设置以响应 BOOTP 客户端请求的网络设备，并且已经编程了它可以在需要时提供给客户端的寻址和其他信息。
- en: The BOOTP server maintains a special set of information about the clients it
    serves. One key part of this is a table that maps the hardware (layer 2, the data
    link layer) addresses of each client to an assigned IP address for that device.
    The client specifies its hardware address in its request, and the server uses
    that address to look up the client's IP address and return it to the client. (Other
    techniques can also be used, but a mapping table is most common.)
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: BOOTP 服务器维护一组关于其服务的客户端的特殊信息。其中关键的一部分是一个将每个客户端的硬件（第 2 层，数据链路层）地址映射到分配给该设备的 IP
    地址的表。客户端在其请求中指定其硬件地址，服务器使用该地址查找客户端的 IP 地址并将其返回给客户端。（也可以使用其他技术，但映射表是最常见的。）
- en: BOOTP Messaging and Transport
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: BOOTP 消息和传输
- en: 'BOOTP messaging uses UDP as its layer 4 transport protocol, for a couple of
    reasons:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 由于几个原因，BOOTP 消息使用 UDP 作为其第 4 层传输协议：
- en: UDP is a lot less complex than the other layer 4 transport protocol, the Transmission
    Control Protocol (TCP), and is ideal for simple request/reply protocols like BOOTP.
  id: totrans-74
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: UDP比其他层4传输协议（传输控制协议TCP）简单得多，非常适合像BOOTP这样的简单请求/回复协议。
- en: Since the client obviously doesn't know the address of a BOOTP server, the request
    is broadcast on its local network. UDP supports broadcasts; TCP does not.
  id: totrans-75
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 由于客户端显然不知道BOOTP服务器的地址，因此请求会在其本地网络中广播。UDP支持广播；TCP不支持。
- en: 'UDP uses a special well-known (reserved) port number for BOOTP servers: UDP
    port 67\. BOOTP servers listen on port 67 for these broadcast BOOTP requests sent
    by clients. After processing the request, the server sends a reply back to the
    client. How this is handled depends on whether or not the client knows its own
    address.'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: UDP为BOOTP服务器使用一个特殊的已知（保留）端口号：UDP端口67。BOOTP服务器在端口67上监听客户端发送的这些广播BOOTP请求。在处理请求后，服务器将回复发送回客户端。这如何处理取决于客户端是否知道自己的地址。
- en: BOOTP is often used to provide an IP address to a client that doesn't know its
    address. This is sometimes called a chicken-and-egg problem, because it represents
    a loop of sorts like the old conundrum of which came first, the chicken or the
    egg? To resolve this dilemma, the BOOTP server has two choices. If the operating
    system supports it, the server can use the client's hardware address to create
    an ARP entry for the device, and then use a layer 2 unicast to deliver the reply.
    Otherwise, it must send the reply as a broadcast as well on the local network.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: BOOTP通常用于向不知道其地址的客户端提供IP地址。这有时被称为“鸡生蛋还是蛋生鸡”的问题，因为它代表了一种循环，就像古老的谜题：是鸡先还是蛋先？为了解决这个困境，BOOTP服务器有两个选择。如果操作系统支持，服务器可以使用客户端的硬件地址为设备创建一个ARP条目，然后使用层2单播来发送回复。否则，它必须在本地网络上以广播的形式发送回复。
- en: However, in the case where the BOOTP client already knows its own address, that
    address can be used by the BOOTP server to send back its reply directly.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在BOOTP客户端已经知道自己的地址的情况下，该地址可以被BOOTP服务器用来直接发送回复。
- en: BOOTP Use of Broadcasts and Ports
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: BOOTP的广播和端口使用
- en: The fact that BOOTP servers may need to broadcast back to the client necessitates
    a bit of a change from the way most TCP/IP protocols use client ports. Recall
    that normally, the client in a client/server transaction using UDP or TCP generates
    a temporary, or ephemeral, port number that it uses as the source port in its
    request. The server sends the reply back to the client's IP address using that
    ephemeral port number.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 由于BOOTP服务器可能需要向客户端广播回复，这需要从大多数TCP/IP协议使用客户端端口的方式中做出一些改变。回想一下，通常，在UDP或TCP的客户端/服务器事务中，客户端生成一个临时或临时的端口号，并将其用作请求中的源端口。服务器使用该临时端口号将回复发送回客户端的IP地址。
- en: 'Ephemeral port numbers must be unique for a particular IP address, but may
    not necessarily be unique across all the devices on a network. For example, Device
    A may be using ephemeral port number 1248 for an HTTP request to a web server,
    while Device B may be using port number 1248 on its TCP/IP stack to send a Domain
    Name System (DNS) request. Since the server in BOOTP is broadcasting, it is not
    targeting a particular device with a unicast transmission. This means it cannot
    safely send to an ephemeral port number. This is because some other device on
    the network may have selected the same ephemeral port number for some other transaction
    and may mistake the BOOTP server''s response as being intended for itself. To
    avoid this problem, another well-known port number is used just for BOOTP clients:
    UDP port 68\. Clients listen on this port for broadcast or unicast transmissions;
    devices that have not sent a BOOTP request will ignore it. This dual-broadcast
    BOOTP communication process is illustrated in [Figure 60-1](ch60s02.html#general_operation_of_bootp
    "Figure 60-1. General operation of BOOTP").'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 临时端口号必须对于特定的IP地址是唯一的，但可能不是网络中所有设备都唯一。例如，设备A可能正在使用临时端口号1248向Web服务器发送HTTP请求，而设备B可能在其TCP/IP堆栈上使用端口号1248发送域名系统（DNS）请求。由于BOOTP中的服务器正在广播，它不是针对特定设备进行单播传输。这意味着它不能安全地向临时端口号发送。这是因为网络上的其他设备可能已经为其他事务选择了相同的临时端口号，并可能错误地将BOOTP服务器的响应误认为是针对自己的。为了避免这个问题，另一个已知的端口号仅用于BOOTP客户端：UDP端口68。客户端监听此端口以接收广播或单播传输；尚未发送BOOTP请求的设备将忽略它。这种双广播BOOTP通信过程在[图60-1](ch60s02.html#general_operation_of_bootp
    "图60-1. BOOTP的一般操作")中说明。
- en: '![General operation of BOOTP](httpatomoreillycomsourcenostarchimages288193.png.jpg)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
  zh: '![BOOTP的通用操作](httpatomoreillycomsourcenostarchimages288193.png.jpg)'
- en: Figure 60-1. General operation of BOOTP
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 图60-1. BOOTP的通用操作
- en: Tip
  id: totrans-84
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** BOOTP is a relatively simple client/server protocol that relies
    on broadcasts to permit communication with devices that do not have an assigned
    IP address. In this example, Device A is trying to determine its IP address and
    other parameters. It broadcasts a BOOTP request on the local network using UDP
    port 67 and then listens for a reply on port 68\. Device D is configured as a
    BOOTP server and listens on this port. When it receives the request, it sends
    a broadcast on port 68 telling Device A what its IP address is. A BOOTP client
    uses broadcasts to send its requests to any listening BOOTP server. In most cases,
    the BOOTP client device does not know its own IP address when it uses the protocol.
    For this reason, a BOOTP server will also typically use broadcast in sending its
    reply, to be sure it reaches the client.'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** BOOTP是一个相对简单的客户端/服务器协议，它依赖于广播来允许与没有分配IP地址的设备进行通信。在这个例子中，设备A正在尝试确定其IP地址和其他参数。它使用UDP端口67在本地网络上广播一个BOOTP请求，然后监听端口68上的回复。设备D配置为BOOTP服务器，并监听此端口。当它收到请求时，它会在端口68上发送一个广播，告诉设备A其IP地址是什么。BOOTP客户端使用广播将其请求发送到任何监听的BOOTP服务器。在大多数情况下，当BOOTP客户端设备使用该协议时，它不知道自己的IP地址。因此，BOOTP服务器通常也会使用广播发送其回复，以确保它到达客户端。'
- en: Retransmission of Lost Messages
  id: totrans-86
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 丢失消息的重传
- en: The drawback of the simplicity of using UDP for BOOTP messaging is that UDP
    is unreliable, which means a BOOTP request might be lost before it gets to the
    server, or the server's response may not get back to the client. Like many other
    protocols using UDP, BOOTP clients take care of this by using a retransmission
    timer. If after a certain period of time the client has not received a response,
    it resends its request.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 使用UDP进行BOOTP消息传递的简单性的缺点是UDP不可靠，这意味着BOOTP请求可能在到达服务器之前丢失，或者服务器的响应可能无法返回给客户端。像许多其他使用UDP的协议一样，BOOTP客户端通过使用重传计时器来处理这个问题。如果在一定时间内客户端没有收到响应，它会重新发送其请求。
- en: 'However, BOOTP clients must take care in how they implement their retransmission
    strategy. Consider a scenario where a network with 200 BOOTP clients loses power.
    These machines are all pretty much the same, so when the power comes back on,
    they all restart and try to send BOOTP requests at about the same time. Most likely,
    problems will occur due to all these requests: Some will be lost, or the server
    may drop some due to overload. If all the clients use the same amount of time
    for retransmission, then after that time elapses, a whole bunch of machines will
    again send requests and re-create the original problem.'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，BOOTP客户端必须小心实施其重传策略。考虑一个场景，一个有200个BOOTP客户端的网络断电。这些机器几乎都是相同的，所以当电力恢复时，它们都会同时启动并尝试发送BOOTP请求。很可能会因为所有这些请求而出现问题：一些会丢失，或者服务器可能会因为过载而丢弃一些。如果所有客户端使用相同的时间进行重传，那么在经过这段时间后，大量机器将再次发送请求并重新创建原始问题。
- en: To avoid retransmission problems, the BOOTP standard recommends using an exponential
    backoff scheme for retransmissions, starting with a retransmission interval of
    4 seconds and doubling it for successive tries. A randomness element is also added
    to prevent many devices from overlapping their retransmissions. The idea is very
    similar to the backoff method used by Ethernet (in fact, the standard even refers
    to the Ethernet specification). For example, the first retransmission would occur
    after a random period of time between 0 and 4 seconds (plus or minus a random
    amount); a second retransmission, if needed, after a random time interval between
    0 and 8 seconds, plus or minus, and so forth. This helps reduce the chances of
    retransmissions being lost and also helps ensure BOOTP traffic doesn't bog down
    the network.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 为了避免重传问题，BOOTP标准建议使用指数退避方案进行重传，起始重传间隔为4秒，并在后续尝试中将其加倍。还添加了一个随机元素，以防止许多设备重叠其重传。这个想法与以太网使用的退避方法非常相似（实际上，标准甚至引用了以太网规范）。例如，第一次重传将在0到4秒之间的随机时间段后发生（加上或减去一个随机量）；如果需要，第二次重传将在0到8秒之间的随机时间间隔后发生，加上或减去，依此类推。这有助于减少重传丢失的机会，并确保BOOTP流量不会使网络过载。
- en: Tip
  id: totrans-90
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** BOOTP uses UDP for transport, which provides no reliability
    features. For this reason, the BOOTP client must detect when its requests are
    lost and, if necessary, retransmit them.'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** BOOTP 使用 UDP 进行传输，它不提供可靠性功能。因此，BOOTP 客户端必须检测其请求是否丢失，并在必要时重新传输它们。'
- en: BOOTP Detailed Operation
  id: totrans-92
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: BOOTP 详细操作
- en: Now that you have seen how BOOTP messaging works in general terms, let's take
    a closer look at the detailed operation of the protocol. This will clarify how
    clients and servers create and process messages, and also help make sense of some
    of the important fields in the BOOTP message field format. Understanding the basic
    operation of BOOTP will also be of use when we examine BOOTP relay agents later
    in this chapter, and even when we discuss DHCP in the following chapters.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经了解了 BOOTP 消息在一般意义上的工作方式，让我们更详细地看看该协议的操作。这将阐明客户端和服务器如何创建和处理消息，并有助于理解 BOOTP
    消息字段格式中的重要字段。了解 BOOTP 的基本操作还将有助于我们在本章后面检查 BOOTP 中继代理，甚至在讨论下一章中的 DHCP 时。
- en: BOOTP Bootstrapping Procedure
  id: totrans-94
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: BOOTP 引导过程
- en: The following are the basic steps performed by the client and server in a regular
    BOOTP bootstrapping procedure (see [Figure 60-2](ch60s03.html#bootp_operation_bootp_uses_a_simple_two-
    "Figure 60-2. BOOTP operation BOOTP uses a simple two-step message exchange consisting
    of a broadcast request and broadcast reply. After the client receives configuration
    information from the BOOTP server, it completes the bootstrapping process using
    a protocol such as TFTP.")).
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是在常规 BOOTP 引导过程中客户端和服务器执行的基本步骤（参见[图 60-2](ch60s03.html#bootp_operation_bootp_uses_a_simple_two-
    "图 60-2. BOOTP 操作 BOOTP 使用简单的两步消息交换，包括广播请求和广播回复。在客户端从 BOOTP 服务器接收配置信息后，它使用 TFTP
    等协议完成引导过程。")）。
- en: '**Client Creates Request** The client machine begins the procedure by creating
    a BOOTP request message. In creating this message, it fills in the following information:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '**客户端创建请求** 客户端机器通过创建一个 BOOTP 请求消息来开始这个过程。在创建这个消息时，它填写以下信息：'
- en: It sets the message type (Op) to the value 1, for a BOOTREQUEST message.
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它将消息类型（Op）设置为值 1，表示 BOOTREQUEST 消息。
- en: If it knows its own IP address that it plans to keep using, it specifies it
    in the CIAddr (Client IP Address) field. Otherwise, it fills this field with zeros.
    (The CIAddr field is discussed in more detail in the next section.)
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果它知道它计划继续使用的自己的 IP 地址，它将在 CIAddr（客户端 IP 地址）字段中指定它。否则，它将此字段填充为零。（CIAddr 字段将在下一节中详细讨论。）
- en: It puts its own layer 2 hardware address in the CHAddr field. This is used by
    the server to determine the right address and other parameters for the client.
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它将自己的层 2 硬件地址放入 CHAddr 字段。服务器使用这个地址来确定客户端的正确地址和其他参数。
- en: It generates a random transaction identifier and puts this in the XID field.
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它生成一个随机的事务标识符并将其放入 XID 字段。
- en: The client may specify a particular server that it wants to send it a reply
    and put that in the SName field. It may also specify the name of a particular
    type of boot file that it wants the server to provide in the File field.
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户端可以指定它想要发送回复的特定服务器，并将其放入 SName 字段。它还可以在 File 字段中指定它想要服务器提供的特定类型的引导文件名称。
- en: The client may specify vendor-specific information, if programmed to do so.
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果程序允许，客户端可以指定供应商特定的信息。
- en: '**Client Sends Request** The client broadcasts the BOOTREQUEST message by transmitting
    it to address 255.255.255.255\. Alternatively, if it already knows the address
    of a BOOTP server, it may send the request unicast.'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '**客户端发送请求** 客户端通过向地址 255.255.255.255 发送 BOOTREQUEST 消息来进行广播。或者，如果它已经知道一个 BOOTP
    服务器的地址，它也可以发送单播请求。'
- en: '**Server Receives Request and Processes It** A BOOTP server, listening on UDP
    port 67, receives the broadcasted request and processes it. If a name of a particular
    server was specified and this name is different from the name of this server,
    the server may discard the request. This is especially true if the server knows
    that the server the client asked for is also on the local network. If no particular
    server is specified, or this particular server was the one the client wanted,
    the server will reply.'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '**服务器接收请求并处理它** 监听 UDP 端口 67 的 BOOTP 服务器接收广播请求并处理它。如果指定了特定服务器的名称，并且这个名称与该服务器的名称不同，服务器可能会丢弃请求。如果服务器知道客户端请求的服务器也在本地网络中，这种情况尤其如此。如果没有指定特定服务器，或者这个特定服务器是客户端想要的服务器，服务器将回复。'
- en: '**Server Creates Reply** The server creates a reply message by copying the
    request message and changing several fields:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: '**服务器创建回复** 服务器通过复制请求消息并更改几个字段来创建回复消息：'
- en: It changes the message type (Op) to the value 2, for a BOOTREPLY message.
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它将消息类型（Op）更改为2，表示BOOTREPLY消息。
- en: It takes the client's specified hardware address from the CHAddr field and uses
    it in a table lookup to find the matching IP address for this host. It then places
    this value into the YIAddr (Your IP Address) of the reply.
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它从CHAddr字段获取客户端指定的硬件地址，并使用它在表中查找以找到此主机的匹配IP地址。然后，它将此值放入回复的YIAddr（您的IP地址）中。
- en: It processes the File field and provides the filename type the client requested,
    or if the field was blank, the default filename.
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它处理文件字段，并提供客户端请求的文件名类型，或者如果该字段为空，则提供默认文件名。
- en: It puts its own IP address and name in the SIAddr and SName fields.
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它将其自己的IP地址和名称放入SIAddr和SName字段。
- en: It sets any vendor-specific values in the Vend field.
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它在Vend字段中设置任何厂商特定的值。
- en: '**Server Sends Reply** The server sends the reply. The method it uses depends
    on the contents of the request:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '**服务器发送回复** 服务器发送回复。它使用的方法取决于请求的内容：'
- en: If the B (Broadcast) flag is set, this indicates that the client can't have
    the reply sent unicast, so the server will broadcast it.
  id: totrans-112
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果设置了B（广播）标志，这表示客户端不能接收单播回复，因此服务器将广播它。
- en: If the CIAddr field is nonzero, the server will send the reply unicast back
    to that CIAddr.
  id: totrans-113
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果CIAddr字段不为零，服务器将单播回复发送回该CIAddr。
- en: If the B flag is zero and the CIAddr field is also zero, the server may either
    use an ARP entry or broadcast, as described earlier.
  id: totrans-114
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果B标志为零且CIAddr字段也为零，服务器可能使用前面描述的ARP条目或广播。
- en: '**Client Processes Reply** The client receives the server''s reply and processes
    it, storing the information and parameters provided. (See the next section for
    one important issue related to this processing.)'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '**客户端处理回复** 客户端接收服务器的回复并处理它，存储提供的信息和参数。（有关此处理的一个重要问题，请参阅下一节。）'
- en: '**Client Completes Boot Process** Once configured, the client proceeds to phase
    two of the bootstrapping process, by using a protocol such as TFTP to download
    its boot file containing operating system software, using the filename the server
    provided.'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '**客户端完成引导过程** 一旦配置完成，客户端将使用如TFTP之类的协议进入引导过程的第二阶段，下载包含操作系统软件的引导文件，使用服务器提供的文件名。'
- en: Interpretation of the Client IP Address (CIAddr) Field
  id: totrans-117
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 客户端IP地址（CIAddr）字段的解释
- en: A complication can arise when a client chooses to specify an IP address in the
    CIAddr field in its request. The problem is how exactly to interpret this field.
    Does it mean that the client is already using this IP address? Or is it just the
    one it used last time it was booted? Then there is the related problem of what
    to do if the server supplies an address in the YIAddr that is different from the
    one the client is using. Should the server's provided address override the client's
    address? Or should the client ignore it? Who makes the decision, the server or
    the client?
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 当客户端选择在其请求的CIAddr字段中指定IP地址时，可能会出现一个复杂情况。问题是如何确切地解释此字段。这是否意味着客户端已经在使用此IP地址？或者这只是它上次引导时使用的IP地址？然后还有相关的问题，即如果服务器在YIAddr中提供的地址与客户端正在使用的地址不同，应该怎么办。服务器的提供地址是否应该覆盖客户端的地址？或者客户端应该忽略它？谁做出决定，是服务器还是客户端？
- en: '![BOOTP operation BOOTP uses a simple two-step message exchange consisting
    of a broadcast request and broadcast reply. After the client receives configuration
    information from the BOOTP server, it completes the bootstrapping process using
    a protocol such as TFTP.](httpatomoreillycomsourcenostarchimages288195.png.jpg)'
  id: totrans-119
  prefs: []
  type: TYPE_IMG
  zh: '![BOOTP操作](httpatomoreillycomsourcenostarchimages288195.png.jpg) BOOTP使用一个简单的两步消息交换，包括广播请求和广播回复。在客户端从BOOTP服务器接收配置信息后，它使用如TFTP之类的协议完成引导过程。'
- en: Figure 60-2. BOOTP operation BOOTP uses a simple two-step message exchange consisting
    of a broadcast request and broadcast reply. After the client receives configuration
    information from the BOOTP server, it completes the bootstrapping process using
    a protocol such as TFTP.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 图60-2. BOOTP操作 BOOTP使用一个简单的两步消息交换，包括广播请求和广播回复。在客户端从BOOTP服务器接收配置信息后，它使用如TFTP之类的协议完成引导过程。
- en: Much confusion occurred due to the vagueness of the original standard in this
    regard, and this led to nonuniformity in how different implementations chose to
    handle this issue. There were even some implementations that used the CIAddr to
    mean "the client requests this IP address," which was never part of BOOTP functionality.
    This is an especially bad idea since it could lead to BOOTP replies never reaching
    the client.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 由于原始标准在这方面含糊不清，导致出现了很多混淆，这导致了不同实现选择处理此问题的非一致性。甚至有一些实现使用CIAddr表示“客户端请求此IP地址”，这从未是BOOTP功能的一部分。这是一个特别糟糕的想法，因为它可能导致BOOTP回复永远无法到达客户端。
- en: 'RFC 1542 was written in part to try to clean up this mess. It suggests that
    the following is the best way to handle the meaning of these fields:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: RFC 1542部分是为了尝试清理这种混乱而编写的。它建议以下是最有效的处理这些字段含义的方法：
- en: If a client is willing to accept whatever IP address the server provides, it
    sets CIAddr to all zeros, even if it knows a previous address.
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果客户端愿意接受服务器提供的任何IP地址，即使它知道之前的地址，它也会将CIAddr设置为全零。
- en: If the client fills in a value for the field, it is saying it will use this
    address, and it must be prepared to receive unicast messages sent to that address.
  id: totrans-124
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果客户端为该字段填写了值，它表示它将使用此地址，并且必须准备接收发送到该地址的单播消息。
- en: If the client specifies an address in CIAddr and receives a different address
    in the YIAddr field, the server-provided address is ignored.
  id: totrans-125
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果客户端在CIAddr中指定了一个地址，但在YIAddr字段中收到了不同的地址，则忽略服务器提供的地址。
- en: Note that not all hardware devices may necessarily agree with this interpretation
    as provided by RFC 1542, so there are still potential interoperability concerns
    here with older equipment. Then again, RFC 1542 was written in 1993, so this is
    probably no longer much of an issue!
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，并非所有硬件设备都一定同意RFC 1542提供的这种解释，因此这里仍然存在与旧设备之间的潜在互操作性担忧。然而，RFC 1542是在1993年编写的，所以这可能已经不再是多大的问题！
- en: BOOTP Message Format
  id: totrans-127
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: BOOTP消息格式
- en: The exchange of information in BOOTP takes the form of a request sent by a client
    and a reply sent back by the server. BOOTP, like a number of other request/reply
    protocols, uses a common message format for requests and replies. The client starts
    by setting aside memory space for the message and clearing it to all zeros. It
    then fills in the fields of the message and sends the request, as you saw in the
    previous section. The server creates its reply not from scratch, but by copying
    the request and changing certain fields.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 在BOOTP中，信息交换的形式是由客户端发送的请求和由服务器发送的回复。BOOTP，就像许多其他请求/回复协议一样，使用通用的消息格式来处理请求和回复。客户端首先为消息预留内存空间并将其清零。然后，它填写消息的字段并发送请求，正如你在上一节中看到的。服务器不是从头开始创建回复，而是通过复制请求并更改某些字段来创建回复。
- en: BOOTP messages contain a considerable number of fields, so the message format
    is rather large. It is described in Tables [Table 60-1](ch60s04.html#bootp_message_format-id001
    "Table 60-1. BOOTP Message Format") and [Table 60-2](ch60s04.html#bootp_message_htype_values
    "Table 60-2. BOOTP Message HType Values"), and illustrated in [Figure 60-3](ch60s04.html#bootp_message_format-id002
    "Figure 60-3. BOOTP message format").
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: BOOTP消息包含相当多的字段，因此消息格式相当大。它描述在[表60-1](ch60s04.html#bootp_message_format-id001
    "表60-1. BOOTP消息格式")和[表60-2](ch60s04.html#bootp_message_htype_values "表60-2. BOOTP消息HType值")中，并在[图60-3](ch60s04.html#bootp_message_format-id002
    "图60-3. BOOTP消息格式")中展示。
- en: Table 60-1. BOOTP Message Format
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 表60-1. BOOTP消息格式
- en: '| Field Name | Size (Bytes) | Description |'
  id: totrans-131
  prefs: []
  type: TYPE_TB
  zh: '| 字段名称 | 大小（字节） | 描述 |'
- en: '| --- | --- | --- |'
  id: totrans-132
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| Op | 1 | Operation Code: Specifies the type of message. A value of 1 indicates
    a request (BOOTREQUEST message). A value of 2 is a reply (BOOTREPLY message).
    |'
  id: totrans-133
  prefs: []
  type: TYPE_TB
  zh: '| Op | 1 | 操作代码：指定消息的类型。值为1表示请求（BOOTREQUEST消息）。值为2表示回复（BOOTREPLY消息）。|'
- en: '| HType | 1 | Hardware Type: This field specifies the type of hardware used
    for the local network and is used in exactly the same way as the equivalent field
    (HRD) in the ARP message format (see [Chapter 13](ch13.html "Chapter 13. ADDRESS
    RESOLUTION AND THE TCP/IP ADDRESS RESOLUTION PROTOCOL (ARP)")). Some of the most
    common values for this field are shown in [Table 60-2](ch60s04.html#bootp_message_htype_values
    "Table 60-2. BOOTP Message HType Values"). |'
  id: totrans-134
  prefs: []
  type: TYPE_TB
  zh: '| HType | 1 | 硬件类型：该字段指定用于本地网络的硬件类型，并且与ARP消息格式中的等效字段（HRD）以完全相同的方式使用（参见[第13章](ch13.html
    "第13章. 地址解析和TCP/IP地址解析协议（ARP）")）。该字段的一些最常见值显示在[表60-2](ch60s04.html#bootp_message_htype_values
    "表60-2. BOOTP消息HType值")中。|'
- en: '| HLen | 1 | Hardware Address Length: Specifies how long hardware addresses
    are in this message. For Ethernet or other networks using IEEE 802 MAC addresses,
    the value is 6\. This is the same as the field with a similar name (HLN) in the
    ARP field format. |'
  id: totrans-135
  prefs: []
  type: TYPE_TB
  zh: '| HLen | 1 | 硬件地址长度：指定此消息中硬件地址的长度。对于使用IEEE 802 MAC地址的以太网或其他网络，该值为6。这与ARP字段格式中具有类似名称的字段（HLN）的值相同。|'
- en: '| Hops | 1 | Hops: Set to 0 by a client before transmitting a request and used
    by BOOTP relay agents to control the forwarding of BOOTP messages. |'
  id: totrans-136
  prefs: []
  type: TYPE_TB
  zh: '| Hops | 1 | 跳数：客户端在发送请求之前将其设置为0，并由BOOTP中继代理用于控制BOOTP消息的转发。|'
- en: '| XID | 4 | Transaction Identifier: A 32-bit identification field generated
    by the client, to allow it to match up the request with replies received from
    BOOTP servers. |'
  id: totrans-137
  prefs: []
  type: TYPE_TB
  zh: '| XID | 4 | 事务标识符：客户端生成的一个32位标识字段，允许它与从BOOTP服务器接收到的回复进行匹配。|'
- en: '| Secs | 2 | Seconds: According to RFC 951, the client enters into this field
    the number of seconds "elapsed since [the] client started trying to boot." This
    is supposed to provide information to BOOTP servers to help them decide which
    requests to respond to first. Unfortunately, it isn''t clear if this meant the
    amount of time since the machine was powered on or since the first BOOTREQUEST
    message was sent. In addition, some devices incorrectly implemented this field.
    As a result, it is not always used. |'
  id: totrans-138
  prefs: []
  type: TYPE_TB
  zh: '| Secs | 2 | 秒数：根据RFC 951，客户端将“自客户端开始尝试引导以来经过的秒数”输入此字段。这应该为BOOTP服务器提供信息，以帮助它们决定先响应哪些请求。不幸的是，不清楚这是指自机器开机以来还是自第一个BOOTREQUEST消息发送以来的时间。此外，一些设备错误地实现了此字段。因此，它并不总是被使用。|'
- en: '| Flags | 2 | Flags: In the original BOOTP standard (RFC 951), this was an
    empty 2-byte field. RFC 1542 changed this to a Flags field, which at present contains
    only one flag. It has a B (Broadcast) flag subfield, 1 bit in size, which is set
    to 1 if the client doesn''t know its own IP address at the time it sends its BOOTP
    request. This serves as an immediate indicator to the BOOTP server or relay agent
    that receives the request that it definitely should send its reply by broadcast.
    The other subfield is Reserved, which is 15 bits, set to 0, and not used. |'
  id: totrans-139
  prefs: []
  type: TYPE_TB
  zh: '| Flags | 2 | 标志：在原始BOOTP标准（RFC 951）中，这是一个空的2字节字段。RFC 1542将其更改为标志字段，目前该字段仅包含一个标志。它有一个B（广播）标志子字段，大小为1位，如果客户端在发送BOOTP请求时不知道自己的IP地址，则将其设置为1。这作为立即指示BOOTP服务器或中继代理接收到的请求，它确实应该通过广播发送其回复。另一个子字段是保留字段，大小为15位，设置为0，未使用。|'
- en: '| CIAddr | 4 | Client IP Address: If the client has a current IP address that
    it plans to keep using, it puts it in this field. By filling in this field, the
    client is committing to responding to unicast IP datagrams sent to this address.
    Otherwise, it sets this field to all 0s to tell the server it wants an address
    assigned. (See the previous section in this chapter for important information
    about this field.) |'
  id: totrans-140
  prefs: []
  type: TYPE_TB
  zh: '| CIAddr | 4 | 客户端IP地址：如果客户端有一个当前IP地址，它计划继续使用，它将此地址放入此字段。通过填写此字段，客户端承诺对发送到此地址的单播IP数据报做出响应。否则，它将此字段设置为全0，以告知服务器它想要分配地址。（请参阅本章前面的重要信息关于此字段。）|'
- en: '| YIAddr | 4 | Your IP Address: The IP address that the server is assigning
    to the client. This may be different than the IP address currently used by the
    client. |'
  id: totrans-141
  prefs: []
  type: TYPE_TB
  zh: '| YIAddr | 4 | 你的IP地址：服务器分配给客户端的IP地址。这可能与客户端当前使用的IP地址不同。|'
- en: '| SIAddr | 4 | Server IP Address: The IP address of the BOOTP server sending
    a BOOTREPLY message. |'
  id: totrans-142
  prefs: []
  type: TYPE_TB
  zh: '| SIAddr | 4 | 服务器IP地址：发送BOOTREPLY消息的BOOTP服务器的IP地址。|'
- en: '| GIAddr | 4 | Gateway IP Address: Used to route BOOTP messages when BOOTP
    relay agents facilitate the communication of BOOTP requests and replies between
    a client and a server on different subnets or networks. To understand the name,
    remember that the old TCP/IP term for *router* is *gateway*; BOOTP relay agents
    are typically routers. Note that this field is set to 0 by the client and should
    be ignored by the client when processing a BOOTREPLY. It specifically does not
    represent the server giving the client the address of a default router address
    to be used for general IP routing purposes. |'
  id: totrans-143
  prefs: []
  type: TYPE_TB
  zh: '| GIAddr | 4 | 网关IP地址：当BOOTP中继代理在客户端和服务器在不同子网或网络之间进行BOOTP请求和回复通信时，用于路由BOOTP消息。要理解这个名称，请记住旧的TCP/IP术语中的*路由器*是*网关*；BOOTP中继代理通常是路由器。请注意，客户端将此字段设置为0，并且在处理BOOTREPLY时应该忽略此字段。它特别不表示服务器向客户端提供用于一般IP路由目的的默认网关地址。|'
- en: '| CHAddr | 16 | Client Hardware Address: The hardware (layer 2) address of
    the client sending a BOOTREPLY. It is used to look up a device''s assigned IP
    address and also possibly in delivery of a reply message. |'
  id: totrans-144
  prefs: []
  type: TYPE_TB
  zh: '| CHAddr | 16 | 客户端硬件地址：发送BOOTREPLY的客户端的硬件（第2层）地址。它用于查找设备的分配IP地址，也可能用于回复消息的投递。
    |'
- en: '| SName | 64 | Server Name: The server sending a BOOTREPLY may optionally put
    its name in this field. This can be a simple text nickname or a fully qualified
    DNS domain name (such as myserver.organization.org). Note that a client may specify
    a name in this field when it creates its request. If it does so, it is saying
    that it wants to get a reply only from the BOOTP server with this name. This may
    be done to ensure that the client is able to access a particular boot file stored
    on only one server. |'
  id: totrans-145
  prefs: []
  type: TYPE_TB
  zh: '| SName | 64 | 服务器名称：发送BOOTREPLY的服务器可以选择将其名称放入此字段。这可以是一个简单的文本昵称或一个完全限定的DNS域名（例如myserver.organization.org）。请注意，当客户端创建其请求时，它可以在该字段中指定一个名称。如果这样做，它表示它只想从具有此名称的BOOTP服务器获取回复。这可能是为了确保客户端能够访问仅存储在一个服务器上的特定启动文件。
    |'
- en: '| File | 128 | Boot Filename: Contains the full directory path and filename
    of a boot file that can be downloaded by the client to complete its bootstrapping
    process. The client may request a particular type of file by entering a text description
    here, or it may leave the field blank and the server will supply the filename
    of the default file. |'
  id: totrans-146
  prefs: []
  type: TYPE_TB
  zh: '| 文件 | 128 | 启动文件名：包含客户端可以下载以完成引导过程的启动文件的完整目录路径和文件名。客户端可以通过在此处输入文本描述来请求特定类型的文件，或者它也可以留空，服务器将提供默认文件的文件名。
    |'
- en: '| Vend | 64 | Vendor-Specific Area: Originally created to allow vendors to
    customize BOOTP to the needs of different types of hardware, this field is now
    also used to hold additional vendor-independent configuration information. The
    next section, on BOOTP vendor information extensions, contains much more detail
    on this field. It may be used by the client and/or the server. |'
  id: totrans-147
  prefs: []
  type: TYPE_TB
  zh: '| Vend | 64 | 供应商特定区域：最初创建是为了允许供应商根据不同类型硬件的需求定制BOOTP，现在此字段也用于存储额外的供应商独立配置信息。下一节关于BOOTP供应商信息扩展，包含更多关于此字段的详细信息。它可能由客户端和/或服务器使用。
    |'
- en: Table 60-2. BOOTP Message HType Values
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 表60-2. BOOTP消息HType值
- en: '| HType Value | Hardware Type |'
  id: totrans-149
  prefs: []
  type: TYPE_TB
  zh: '| HType值 | 硬件类型 |'
- en: '| --- | --- |'
  id: totrans-150
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| 1 | Ethernet (10 Mb) |'
  id: totrans-151
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 以太网 (10 Mb) |'
- en: '| 6 | IEEE 802 Networks |'
  id: totrans-152
  prefs: []
  type: TYPE_TB
  zh: '| 6 | IEEE 802网络 |'
- en: '| 7 | ARCNet |'
  id: totrans-153
  prefs: []
  type: TYPE_TB
  zh: '| 7 | ARCNet |'
- en: '| 15 | Frame Relay |'
  id: totrans-154
  prefs: []
  type: TYPE_TB
  zh: '| 15 | 帧中继 |'
- en: '| 16 | Asynchronous Transfer Mode (ATM) |'
  id: totrans-155
  prefs: []
  type: TYPE_TB
  zh: '| 16 | 异步传输模式 (ATM) |'
- en: '| 17 | High-Level Data Link Control (HDLC) |'
  id: totrans-156
  prefs: []
  type: TYPE_TB
  zh: '| 17 | 高级数据链路控制 (HDLC) |'
- en: '| 18 | Fibre Channel |'
  id: totrans-157
  prefs: []
  type: TYPE_TB
  zh: '| 18 | 光纤通道 |'
- en: '| 19 | ATM |'
  id: totrans-158
  prefs: []
  type: TYPE_TB
  zh: '| 19 | ATM |'
- en: '| 20 | Serial Line |'
  id: totrans-159
  prefs: []
  type: TYPE_TB
  zh: '| 20 | 串行线 |'
- en: As I mentioned earlier in this chapter, both requests and replies are encapsulated
    into UDP messages for transmission. The BOOTP standard specifies that the use
    of UDP checksums is optional. Using the checksum provides protection against data-integrity
    errors and is thus recommended. This may cause unacceptable processing demands
    on the part of very simple clients, so the checksum can legally be skipped.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 如我在本章前面提到的，请求和回复都被封装进UDP消息进行传输。BOOTP标准规定UDP校验和的使用是可选的。使用校验和可以提供对数据完整性错误的保护，因此是推荐的。这可能会对非常简单的客户端造成不可接受的处理需求，因此校验和可以合法地被跳过。
- en: Similarly, for simplicity, BOOTP assumes that its messages will not be fragmented.
    This is to allow BOOTP clients to avoid the complexity of reassembling fragmented
    messages. Since BOOTP messages are only 300 bytes in length, under the maximum
    transmission unit (MTU) required for all TCP/IP links, this is not normally an
    issue.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 同样地，为了简化，BOOTP假设其消息不会被分片。这是为了让BOOTP客户端避免重新组装分片消息的复杂性。由于BOOTP消息长度仅为300字节，在所有TCP/IP链路所需的最大传输单元（MTU）下，这通常不是问题。
- en: '![BOOTP message format](httpatomoreillycomsourcenostarchimages288197.png)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![BOOTP消息格式](httpatomoreillycomsourcenostarchimages288197.png)'
- en: Figure 60-3. BOOTP message format
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 图60-3. BOOTP消息格式
- en: BOOTP Vendor-Specific Area and Vendor Information Extensions
  id: totrans-164
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: BOOTP供应商特定区域和供应商信息扩展
- en: The creators of BOOTP realized that certain types of hardware might require
    additional information to be passed from the server to the client in order for
    the client to boot. For this reason, they put into the BOOTP field format the
    64-byte Vend field, also called the Vendor-Specific Area. Including this field
    makes BOOTP flexible, since it allows vendors to decide for themselves how they
    want to use the protocol and to tailor it to their needs.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: BOOTP的创造者意识到某些类型的硬件可能需要从服务器传递额外的信息到客户端，以便客户端可以启动。出于这个原因，他们将64字节的Vend字段放入BOOTP字段格式中，也称为供应商特定区域。包含这个字段使BOOTP变得灵活，因为它允许供应商自己决定他们想要如何使用该协议，并根据自己的需求定制它。
- en: A client can use the Vend field by asking for certain types of information in
    the field when composing its request. The server can then respond to these requests,
    and it may also include parameters it wants the client to have, even if they were
    not requested. The original BOOTP protocol does not define any structure for the
    Vendor-Specific Area, leaving this up to each manufacturer to decide.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端可以通过在其请求中请求字段中的某些类型的信息来使用Vend字段。然后服务器可以响应这些请求，并且它还可以包括它希望客户端拥有的参数，即使这些参数没有被请求。原始BOOTP协议没有定义任何结构用于供应商特定区域，将此留给每个制造商自行决定。
- en: Obviously, there is nothing preventing a client made by one manufacturer from
    trying to send a request to a server made by another one. If each one is expecting
    the Vend field to contain something different, the results will be less than satisfactory.
    Thus, for the Vend field to be used properly, both devices must be speaking the
    same language when it comes to the meaning of this field. This is done by setting
    the first four bytes of the field to a special value. Each manufacturer chooses
    its own *magic number*, sometimes called a *magic cookie*, for this four-byte
    subfield.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，一个制造商生产的客户端尝试向另一个制造商生产的服务器发送请求，没有任何阻止。如果每个设备都期望Vend字段包含不同的内容，结果将不会令人满意。因此，为了正确使用Vend字段，当涉及到这个字段的含义时，两个设备必须使用相同的语言。这是通过将字段的第一个四个字节设置为特殊值来实现的。每个制造商都为其自己的*魔法数字*选择一个值，有时也称为*魔法饼干*，用于这个四个字节的子字段。
- en: Note
  id: totrans-168
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*Why is it called a magic cookie? I''m not sure, to be honest. I have heard
    that its origin may be the cookie that Alice ate to grow or shrink in the story
    Alice in Wonderland*.'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: '*为什么叫魔法饼干？老实说，我不确定。我听说它的起源可能是《爱丽丝梦游仙境》中爱丽丝吃的可以让自己变大或变小的饼干*。'
- en: BOOTP Vendor Information Extensions
  id: totrans-170
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: BOOTP供应商信息扩展
- en: Including the Vend field in BOOTP gives the protocol extensibility for vendor-specific
    information. Unfortunately, the original field format didn't include any way of
    extending the information sent from a server to a client for *generic*, nonvendor-specific
    TCP/IP information. This was a significant oversight in the creation of the protocol,
    because there are many types of information that a TCP/IP host needs when it starts
    up that really have nothing to do with its vendor. For example, when a host boots,
    we probably want it to be told the address of a default router, the subnet mask
    for its local subnet, the address of a local DNS server, the MTU of the local
    network, and much more. None of these things are vendor-specific, but there is
    no place to put them in the BOOTP reply message.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 在BOOTP中包含Vend字段为供应商特定信息提供了协议的可扩展性。不幸的是，原始字段格式没有包括任何从服务器发送到客户端以扩展通用、非供应商特定TCP/IP信息的方式。这在协议创建过程中是一个重大的疏忽，因为当TCP/IP主机启动时，它需要许多类型的信息，这些信息实际上与其供应商无关。例如，当主机启动时，我们可能希望它被告知默认路由器的地址、其本地子网的子网掩码、本地DNS服务器的地址、本地网络的MTU以及更多。这些都不是供应商特定的，但在BOOTP回复消息中没有地方可以放置它们。
- en: Since there was no nonvendor-specific area field in BOOTP, the decision was
    made to define a way of using the Vendor-Specific Area (Vend field) for communicating
    this additional generic information. This was first standardized in RFC 1048 and
    then refined in later RFCs, as I explained in the BOOTP overview earlier in this
    chapter. This scheme basically represents one particular way of using the Vend
    field that most TCP/IP BOOTP implementations have chosen to adopt, regardless
    of their vendor. This enhancement is formally referred to as *BOOTP vendor information
    extensions*.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 由于BOOTP中没有非供应商特定的区域字段，因此决定定义一种使用供应商特定区域（Vend字段）的方式来传递这种额外的通用信息。这首先在RFC 1048中得到了标准化，然后在后续的RFC中得到改进，正如我在本章前面关于BOOTP概述中解释的那样。这个方案基本上代表了一种使用Vend字段的方式，大多数TCP/IP
    BOOTP实现都选择了采用，无论它们的供应商是谁。这种增强正式称为*BOOTP供应商信息扩展*。
- en: Tip
  id: totrans-173
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: '**KEY CONCEPT** The BOOTP message format includes a Vend field that was originally
    intended for vendor-specific customized fields. It was later changed to a place
    where additional generic information could be sent from a BOOTP server to a BOOTP
    client. Each such parameter is carried in a BOOTP *vendor information field*.'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** BOOTP消息格式包括一个Vend字段，最初是为了供应商特定的定制字段而设计的。后来它被改为从BOOTP服务器发送到BOOTP客户端可以发送额外通用信息的地方。每个这样的参数都携带在一个BOOTP
    *供应商信息字段*中。'
- en: To clearly mark that this particular meaning of the Vend field is being used,
    a special, universal magic cookie value of 99.130.83.99 is inserted into the first
    four bytes of the field. Then the remaining 60 bytes can contain a sequence of
    one or more *vendor information fields*. The overall structure of the Vendor-Specific
    Area when vendor information extensions are used is shown in [Figure 60-4](ch60s05.html#bootp_vendor-specific_area_format_showin
    "Figure 60-4. BOOTP Vendor-Specific Area format showing vendor information fields").
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 为了清楚地标记正在使用Vend字段的特定含义，将一个特殊的、通用的魔法cookie值99.130.83.99插入到字段的第一个四个字节中。然后剩余的60个字节可以包含一个或多个*供应商信息字段*的序列。当使用供应商信息扩展时，供应商特定区域的总体结构如[图60-4](ch60s05.html#bootp_vendor-specific_area_format_showin
    "图60-4. BOOTP供应商特定区域格式，显示供应商信息字段")所示。
- en: '![BOOTP Vendor-Specific Area format showing vendor information fields](httpatomoreillycomsourcenostarchimages288199.png.jpg)'
  id: totrans-176
  prefs: []
  type: TYPE_IMG
  zh: '![BOOTP供应商特定区域格式，显示供应商信息字段](httpatomoreillycomsourcenostarchimages288199.png.jpg)'
- en: Figure 60-4. BOOTP Vendor-Specific Area format showing vendor information fields
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 图60-4. BOOTP供应商特定区域格式，显示供应商信息字段
- en: Note
  id: totrans-178
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*The BOOTP Vendor-Specific Area begins with the four-byte magic cookie and
    then contains a number of variable-length vendor information fields, each of which
    has the format shown above and in [Table 60-3](ch60s05.html#bootp_vendor_information_field_format
    "Table 60-3. BOOTP Vendor Information Field Format"). Despite the use of IP dotted-decimal
    notation to represent the value 99.130.83.99, this is not an IP address. It''s
    just a marker—a magic number that is universally recognized*.'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: '*BOOTP供应商特定区域以四个字节的魔法cookie开始，然后包含一系列可变长度的供应商信息字段，每个字段都具有上面所示和[表60-3](ch60s05.html#bootp_vendor_information_field_format
    "表60-3. BOOTP供应商信息字段格式")中的格式。尽管使用IP点分十进制表示值99.130.83.99，但这不是一个IP地址。它只是一个标记——一个被普遍认可的魔法数字*。'
- en: BOOTP Vendor Information Fields
  id: totrans-180
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: BOOTP供应商信息字段
- en: Each vendor information field specifies a particular type of information to
    be communicated, and it is encoded using a special subfield structure that specifies
    the field's type, length, and value. This is a common method of specifying options,
    called *TLV-encoding* (for *type, length, value*). The same basic method is used
    for encoding Internet Protocol versions 4 and 6 (IPv4 and IPv6) options. [Table 60-3](ch60s05.html#bootp_vendor_information_field_format
    "Table 60-3. BOOTP Vendor Information Field Format") shows the structure and the
    common names for the subfields of each vendor information field.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 每个供应商信息字段指定要传递的特定类型的信息，并使用一个特殊的子字段结构进行编码，该结构指定了字段类型、长度和值。这是一种常见的指定选项的方法，称为*TLV编码*（代表*类型、长度、值*）。相同的基该方法用于编码互联网协议版本4和6（IPv4和IPv6）选项。[表60-3](ch60s05.html#bootp_vendor_information_field_format
    "表60-3. BOOTP供应商信息字段格式")显示了每个供应商信息字段子字段的结构和常见名称。
- en: Table 60-3. BOOTP Vendor Information Field Format
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 表60-3. BOOTP供应商信息字段格式
- en: '| Subfield Name | Size (Bytes) | Description |'
  id: totrans-183
  prefs: []
  type: TYPE_TB
  zh: '| 子字段名称 | 大小（字节） | 描述 |'
- en: '| --- | --- | --- |'
  id: totrans-184
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| Code | 1 | Vendor Information Field Code: A single octet that specifies the
    vendor information field type. |'
  id: totrans-185
  prefs: []
  type: TYPE_TB
  zh: '| Code | 1 | 供应商信息字段代码：一个指定供应商信息字段类型的单字节。|'
- en: '| Len | 1 | Vendor Information Field Length: The number of bytes in this particular
    vendor information field. This does not include the two bytes for the Code and
    Len fields. |'
  id: totrans-186
  prefs: []
  type: TYPE_TB
  zh: '| Len | 1 | 供应商信息字段长度：此特定供应商信息字段中的字节数。这不包括代码和长度字段中的两个字节。|'
- en: '| Data | Variable | Vendor Information Field Data: The data being sent, which
    has a length indicated by the Len subfield, and which is interpreted based on
    the Code subfield. |'
  id: totrans-187
  prefs: []
  type: TYPE_TB
  zh: '| Data | 可变 | 供应商信息字段数据：正在发送的数据，其长度由长度子字段指示，并根据代码子字段进行解释。|'
- en: There are two special cases that violate the field format shown in [Table 60-3](ch60s05.html#bootp_vendor_information_field_format
    "Table 60-3. BOOTP Vendor Information Field Format"). A Code value of 0 is used
    as padding when subfields need to be aligned on word boundaries; it contains no
    information. The value 255 is used to mark the end of the vendor information fields.
    Both of these codes contain no actual data. To save space, when either is used,
    just the single Code value is included, and the Len and Data fields are omitted.
    A device seeing a Code value of 0 just skips it as filler; a device seeing a Code
    value of 255 knows it has reached the end of the vendor information fields in
    this Vend field.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 有两种特殊情况违反了[表60-3](ch60s05.html#bootp_vendor_information_field_format "表60-3。BOOTP供应商信息字段格式")中显示的字段格式。当子字段需要对齐在字边界上时，使用代码值为0作为填充；它不包含任何信息。值255用于标记供应商信息字段的结束。这两个代码都不包含实际数据。为了节省空间，当使用任何一个时，只需包含单个代码值，并省略长度和数据字段。一个看到代码值为0的设备将其视为填充内容跳过；一个看到代码值为255的设备知道它已经到达了此Vend字段中的供应商信息字段末尾。
- en: The vendor information extensions of BOOTP have become so popular that the use
    of this field for sending extra generic information is pretty much standard. In
    fact, I am not sure if anyone today still uses the Vend field solely for vendor-specific
    information.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: BOOTP的供应商信息扩展变得如此流行，以至于使用此字段发送额外通用信息的做法几乎已成为标准。事实上，我不确定今天是否还有人仍然仅将Vend字段用于供应商特定信息。
- en: When the vendor information extensions were introduced, one was created that
    points to a file where vendor-specific information can be found. This lets devices
    have the best of both worlds—they can use the standard vendor-independent fields
    and can incorporate vendor-specific fields (through the referenced file) where
    needed. Later, another field type was created that lets vendor-specific fields
    be mixed with vendor-independent ones directly in a BOOTP message.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 当引入供应商信息扩展时，创建了一个指向可以找到供应商特定信息的文件的扩展。这使得设备能够兼得两者之利——它们可以使用标准的供应商独立字段，并在需要时可以包含供应商特定字段（通过引用的文件）。后来，又创建了一种新的字段类型，允许在BOOTP消息中直接将供应商特定字段与供应商独立字段混合。
- en: When DHCP was created, the same vendor extension mechanism was maintained and
    enhanced further, but instead of the field being called vendor information extensions,
    it was renamed to *Options*. (A much better name!) The BOOTP vendor information
    fields were retained in DHCP, and new DHCP-specific options were defined. To avoid
    duplication, I have listed all the BOOTP vendor information fields and DHCP options
    in a set of tables in [Chapter 63](ch63.html "Chapter 63. DHCP MESSAGING, MESSAGE
    TYPES, AND FORMATS"), which covers DHCP messaging. This includes a discussion
    of how vendor-specific and vendor-independent information can be mixed. You may
    also want to read the section in [Chapter 63](ch63.html "Chapter 63. DHCP MESSAGING,
    MESSAGE TYPES, AND FORMATS") that describes DHCP options, which discusses how
    they were created from BOOTP vendor information extensions.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 当DHCP被创建时，保持了相同的供应商扩展机制并进一步增强了它，但字段不再被称为供应商信息扩展，而是更名为*选项*。（一个更好的名字！）BOOTP的供应商信息字段在DHCP中得到了保留，并定义了新的DHCP特定选项。为了避免重复，我已经在[第63章](ch63.html
    "第63章。DHCP消息、消息类型和格式")中列出了一套表格，其中包括了BOOTP供应商信息字段和DHCP选项，该章节涵盖了DHCP消息。这包括讨论如何混合供应商特定和供应商独立的信息。您可能还想阅读[第63章](ch63.html
    "第63章。DHCP消息、消息类型和格式")中描述DHCP选项的部分，该部分讨论了它们是如何从BOOTP供应商信息扩展中创建出来的。
- en: BOOTP Relay Agents (Forwarding Agents)
  id: totrans-192
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: BOOTP中继代理（转发代理）
- en: One reason why RARP was quickly replaced by BOOTP is that RARP required the
    client being configured and the server providing it with an IP address to be on
    the same physical network. This is fine when you run a small organization with
    ten machines, which are probably all on the same physical network. Larger networks
    must be divided into multiple physical networks for efficiency, however. RARP
    would require a separate RARP server for each network, meaning needing to duplicate
    all the functions of a single server onto multiple machines. Worse yet, all the
    configuration information would also be duplicated, and any changes would need
    to be made to all the different servers each time.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: RARP 被迅速取代的原因之一是 RARP 要求客户端配置并从服务器获取 IP 地址的客户端必须在同一物理网络上。当你运行一个拥有十台机器的小型组织时，这很正常，这些机器可能都在同一物理网络上。然而，为了效率，大型网络必须分成多个物理网络。RARP
    需要为每个网络设置一个单独的 RARP 服务器，这意味着需要在多台机器上复制单个服务器的所有功能。更糟糕的是，所有配置信息也会被复制，并且每次更改都需要对所有不同的服务器进行修改。
- en: BOOTP is designed to allow the BOOTP server and the clients it serves to be
    on different networks. This centralizes the BOOTP server and greatly reduces the
    amount of work required of network administrators. However, implementing this
    feature means increasing the complexity of the protocol. In particular, we need
    to involve a third-party device in the configuration process.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: BOOTP 被设计成允许 BOOTP 服务器及其所服务的客户端位于不同的网络中。这集中了 BOOTP 服务器，并大大减少了网络管理员所需的工作量。然而，实现这一功能意味着增加协议的复杂性。特别是，我们需要在配置过程中涉及第三方设备。
- en: You might rightly wonder why this would be the case. RARP is a low-level protocol
    that works at the link layer, so that explains why it would have problems putting
    the client and server on different physical networks. But wasn't the whole point
    of making BOOTP a high-level protocol that it was able to use IP? And if BOOTP
    uses IP, can't we send from one network to another arbitrarily, just like any
    IP-based messaging protocol?
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会正确地想知道为什么会这样。RARP 是一个在链路层工作的低级协议，这就解释了为什么它会在将客户端和服务器放置在不同的物理网络上时遇到问题。但制作
    BOOTP 为一个高级协议的整个目的不正是它能使用 IP 吗？如果 BOOTP 使用 IP，我们难道不能像任何基于 IP 的消息协议一样，任意地从网络发送到另一个网络吗？
- en: 'The answer is that even though we are indeed using IP and UDP, BOOTP still
    has one of the same issues that RARP had: a reliance on *broadcasts*. The client
    usually doesn''t know the address of a server, so it must send out its request
    as a broadcast, saying in essence, "Can anyone hear this and give me the information
    I need?" For efficiency reasons, routers do not route such broadcasts, as they
    would clog the network. This means that if the server and client are not on the
    same network, the server can''t hear the client''s broadcast. Similarly, if the
    server ever did get the request and broadcast its reply back to the client, the
    client would never get it anyway. To make this all work, we need something to
    act as an intermediary between the client and the server: a *BOOTP relay agent*.'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 答案是，尽管我们确实在使用 IP 和 UDP，但 BOOTP 仍然存在 RARP 的问题之一：依赖 *广播*。客户端通常不知道服务器的地址，因此它必须发送其请求作为广播，本质上是在说，“有人能听到这个并给我需要的信息吗？”出于效率的考虑，路由器不会路由此类广播，因为这会阻塞网络。这意味着如果服务器和客户端不在同一网络中，服务器就听不到客户端的广播。同样，如果服务器曾经收到请求并广播其回复给客户端，客户端也永远无法收到。为了使这一切都能正常工作，我们需要某种东西作为客户端和服务器之间的中介：一个
    *BOOTP 中继代理*。
- en: The Function of BOOTP Relay Agents
  id: totrans-197
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: BOOTP 中继代理的功能
- en: The job of a BOOTP relay agent is to sit on a physical network where BOOTP clients
    may be located and act as a proxy for the BOOTP server. The agent gets its name
    because it relays messages between the client and server, and thus enables them
    to be on different networks.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: BOOTP 中继代理的职责是坐在一个物理网络上，其中可能存在 BOOTP 客户端，并作为 BOOTP 服务器的代理。代理之所以得名，是因为它在客户端和服务器之间中继消息，从而使得它们可以位于不同的网络中。
- en: Note
  id: totrans-199
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*BOOTP relay agents were originally called forwarding agents. RFC 1542 changed
    the name to make explicit the fact that BOOTP relaying was not the same as conventional
    IP datagram forwarding by regular routers*.'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: '*BOOTP 中继代理最初被称为转发代理。RFC 1542 将其名称更改为明确指出，BOOTP 中继与常规路由器进行的传统 IP 数据报转发不同*。'
- en: In practice, a BOOTP relay agent is not usually a separate piece of hardware.
    Rather, it's a software module that runs on an existing piece of hardware that
    performs other functions. It is common for BOOTP relay agent functionality to
    be implemented on an IP router. In that case, the router is acting both as a regular
    router and also playing the role of a BOOTP agent. The forwarding functions required
    of a BOOTP relay agent are distinct from the normal IP datagram forwarding tasks
    of a router.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 在实践中，BOOTP中继代理通常不是单独的硬件设备。相反，它是一个运行在执行其他功能的现有硬件上的软件模块。在IP路由器上实现BOOTP中继代理功能是很常见的。在这种情况下，路由器既充当常规路由器，也扮演BOOTP代理的角色。BOOTP中继代理所需的前进功能与路由器的正常IP数据报转发任务不同。
- en: Tip
  id: totrans-202
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** Since BOOTP uses broadcasts, the BOOTP client and BOOTP server
    must be on the same physical network to be able to hear each other''s broadcasted
    transmissions. For a client and server on different networks to communicate, a
    third party is required to facilitate the transaction: a *BOOTP relay agent*.
    This device, which is often a router, listens for transmissions from BOOTP clients
    and relays them to the BOOTP server. The server responds back to the agent, which
    then sends the server''s response back to the client.'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** 由于BOOTP使用广播，BOOTP客户端和BOOTP服务器必须位于同一物理网络上，才能听到彼此的广播传输。对于位于不同网络的客户端和服务器进行通信，需要一个第三方来促成交易：一个*BOOTP中继代理*。这个设备通常是路由器，它监听来自BOOTP客户端的传输并将它们中继到BOOTP服务器。服务器将回复发送回代理，然后代理将服务器的响应发送回客户端。'
- en: Naturally, the placement of the client and server on different networks and
    the presence of a relay agent change the normal request/reply process of BOOTP
    significantly. A couple of specific fields in the BOOTP message format are used
    to control the process. RFC 951 was rather vague in describing how this process
    works, so RFC 1542 described it in much more detail.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 自然地，客户端和服务器位于不同的网络以及中继代理的存在显著改变了BOOTP的正常请求/回复过程。BOOTP消息格式中的几个特定字段用于控制这个过程。RFC
    951在描述这个过程如何工作时相当模糊，因此RFC 1542对其进行了更详细的描述。
- en: Normal BOOTP Operation Using a Relay Agent
  id: totrans-205
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用中继代理的正常BOOTP操作
- en: The following shows, in simplified form, a revised set of BOOTP operation steps
    when a relay agent is involved. To keep the size of this discussion manageable,
    I have omitted the details of the basic request/reply process to focus on the
    relaying functionality, which you can also see graphically in [Figure 60-5](ch60s06.html#bootp_operation_using_a_relay_agent_in_t
    "Figure 60-5. BOOTP operation using a relay agent In this example, Device A is
    trying to access a BOOTP server, but the only one is on a different network; the
    two are connected by a workgroup router that is configured to act as a BOOTP relay
    agent. Device A broadcasts its request, which the router receives. It relays the
    request to the BOOTP server, Device D, and puts its own IP address (IPR) into
    the BOOTP GIAddr field. The BOOTP server sends the reply back to the router using
    address IPR. The router then broadcasts it on Device A's local network so that
    Device A can receive it.").
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 以下以简化的形式展示了当涉及中继代理时，BOOTP操作步骤的修订版。为了使这次讨论的规模可控，我省略了基本请求/回复过程的细节，以专注于中继功能，您也可以在[图60-5](ch60s06.html#bootp_operation_using_a_relay_agent_in_t
    "图60-5. 使用中继代理的BOOTP操作 在这个例子中，设备A试图访问BOOTP服务器，但唯一的服务器位于不同的网络；它们通过一个配置为充当BOOTP中继代理的工作组路由器连接。设备A广播其请求，路由器接收它。它将请求中继到BOOTP服务器，设备D，并将自己的IP地址（IPR）放入BOOTP
    GIAddr字段。BOOTP服务器使用IPR地址将回复发送回路由器。然后路由器在设备A的本地网络上广播它，以便设备A可以接收它。")中图形化地看到）。
- en: '**Client Creates Request** The client machine creates its request normally.
    The existence of a relay agent is totally transparent to the client.'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: '**客户端创建请求** 客户端机器正常创建其请求。中继代理的存在对客户端来说是完全透明的。'
- en: '**Client Sends Request** The client broadcasts the BOOTREQUEST message by transmitting
    it to address 255.255.255.255\. (Note that in the case where a client already
    knows both its own address and the address of a BOOTP server, we don''t need the
    relay agent at all—both the request and reply can be sent unicast over an arbitrary
    internetwork.)'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: '**客户端发送请求** 客户端通过将其发送到地址255.255.255.255来广播BOOTREQUEST消息。（注意，在客户端已经知道自己的地址和BOOTP服务器地址的情况下，我们根本不需要中继代理——请求和回复都可以通过任意互联网进行单播发送。）'
- en: '**Relay Agent Receives Request and Processes It** The BOOTP relay agent on
    the physical network where the client is located is listening on UDP port 67 on
    the server''s behalf. It processes the request as follows:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: '**中继代理接收请求并处理** 客户端所在的物理网络上的BOOTP中继代理代表服务器监听UDP端口67。它按以下方式处理请求：'
- en: It checks the value of the Hops field. If the value is less than or equal to
    16, it increments it. If the value is greater than 16, it discards the request
    and does nothing further.
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它检查Hops字段的值。如果值小于或等于16，则增加它。如果值大于16，则丢弃请求并不再执行其他操作。
- en: It examines the contents of the GIAddr field. If this field is all zeros, it
    knows it is the first relay agent to handle the request and puts its own IP address
    into this field. (If the agent is a router, it has more than one IP address, so
    it chooses the one of the interface on which it received the request.)
  id: totrans-211
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它检查GIAddr字段的内容。如果该字段全部为零，它知道自己是处理请求的第一个中继代理，并将自己的IP地址放入该字段。（如果代理是路由器，它有多个IP地址，因此它选择接收请求的接口上的一个。）
- en: '**Relay Agent Relays Request** The relay agent sends the BOOTP request to the
    BOOTP server. If the relay agent knows the server''s IP address, it will send
    it unicast directly to the server. Otherwise, if the agent is a router, it may
    choose to broadcast the request on a different interface from the one on which
    it received the request. In the latter case, it is possible that multiple relay
    agents may be required to convey the request to the server. See the next section
    for more on this.'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: '**中继代理转发请求** 中继代理将BOOTP请求发送到BOOTP服务器。如果中继代理知道服务器的IP地址，它将直接以单播方式将其发送到服务器。否则，如果代理是路由器，它可能选择从接收请求的不同接口广播请求。在后一种情况下，可能需要多个中继代理来将请求传达给服务器。有关更多信息，请参阅下一节。'
- en: '**Server Receives Request and Processes It** The BOOTP server receives the
    relayed request from the BOOTP relay agent. It processes it as normal.'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: '**服务器接收请求并处理** BOOTP服务器从BOOTP中继代理接收转发的请求。它像处理正常请求一样处理它。'
- en: '**Server Creates Reply** The server creates a reply message as normal.'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: '**服务器创建响应** 服务器像往常一样创建响应消息。'
- en: '**Server Sends Reply** Seeing that the GIAddr field in the request was nonzero,
    the server knows the request was relayed. Instead of trying to send its reply
    back to the client that sent the request, it transmits the reply unicast back
    to the relay agent specified in GIAddr.'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: '**服务器发送响应** 由于请求中的GIAddr字段值不为零，服务器知道请求已被中继。它不会尝试将其响应发送回发送请求的客户端，而是将响应单播发送回GIAddr中指定的中继代理。'
- en: '**Relay Agent Relays Reply** The BOOTP relay agent transmits the BOOTREPLY
    message back to the client. It does this either unicast or broadcast, depending
    on the value of the CIAddr field and the B (Broadcast) flag, just as a server
    does in the nonrelay case.'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: '**中继代理转发响应** BOOTP中继代理将BOOTREPLY消息发送回客户端。它根据CIAddr字段的值和B（广播）标志，以单播或广播的方式执行此操作，就像非中继情况下的服务器一样。'
- en: '![BOOTP operation using a relay agent In this example, Device A is trying to
    access a BOOTP server, but the only one is on a different network; the two are
    connected by a workgroup router that is configured to act as a BOOTP relay agent.
    Device A broadcasts its request, which the router receives. It relays the request
    to the BOOTP server, Device D, and puts its own IP address (IPR) into the BOOTP
    GIAddr field. The BOOTP server sends the reply back to the router using address
    IPR. The router then broadcasts it on Device A''s local network so that Device
    A can receive it.](httpatomoreillycomsourcenostarchimages288201.png.jpg)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
  zh: '![使用中继代理的BOOTP操作 在此示例中，设备A试图访问BOOTP服务器，但唯一的服务器位于不同的网络中；它们通过一个配置为充当BOOTP中继代理的工作组路由器连接。设备A广播其请求，路由器接收它。它将请求中继到BOOTP服务器，设备D，并将自己的IP地址（IPR）放入BOOTP
    GIAddr字段。BOOTP服务器使用IPR地址将响应发送回路由器。然后路由器在设备A的本地网络上广播它，以便设备A可以接收它。](http://atomoreilly.com/source/nostarch/images/288201.png.jpg)'
- en: Figure 60-5. BOOTP operation using a relay agent In this example, Device A is
    trying to access a BOOTP server, but the only one is on a different network; the
    two are connected by a workgroup router that is configured to act as a BOOTP relay
    agent. Device A broadcasts its request, which the router receives. It relays the
    request to the BOOTP server, Device D, and puts its own IP address (IPR) into
    the BOOTP GIAddr field. The BOOTP server sends the reply back to the router using
    address IPR. The router then broadcasts it on Device A's local network so that
    Device A can receive it.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 图 60-5. 使用转发代理的 BOOTP 操作 在这个例子中，设备 A 正在尝试访问一个 BOOTP 服务器，但只有一个在另一个网络上；它们通过一个配置为作为
    BOOTP 转发代理的工作组路由器连接。设备 A 广播其请求，路由器接收它。路由器将请求转发到 BOOTP 服务器，设备 D，并将自己的 IP 地址（IPR）放入
    BOOTP GIAddr 字段。BOOTP 服务器使用地址 IPR 将回复发送回路由器。然后路由器在设备 A 的本地网络上广播它，以便设备 A 可以接收它。
- en: Relaying BOOTP Requests Using Broadcasts
  id: totrans-219
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用广播转发 BOOTP 请求
- en: The simplest case of relaying is when each network has a relay agent that knows
    the IP address of the BOOTP server. The relay agent captures the request in step
    3 of the procedure described in the preceding section, and sends it directly to
    the BOOTP server, wherever it may be on the network. The request is relayed as
    a regular unicast UDP message and routed to the BOOTP server. The BOOTP server's
    reply is routed back to the BOOTP relay agent, just like any UDP message in an
    IP datagram, and the relay agent forwards the reply.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 转发的最简单情况是每个网络都有一个知道 BOOTP 服务器 IP 地址的转发代理。转发代理在上一节所述过程的第 3 步捕获请求，并将其直接发送到网络上的任何位置的
    BOOTP 服务器。请求作为常规的单播 UDP 消息转发，并路由到 BOOTP 服务器。BOOTP 服务器的回复就像 IP 数据报中的任何 UDP 消息一样被路由回
    BOOTP 转发代理，然后转发代理将回复转发出去。
- en: 'It is also possible to set up BOOTP relay agents to relay requests even if
    they don''t know the BOOTP server''s address. These agents take requests received
    on one network and relay them to the next, where they expect another agent to
    continue the relaying process until a BOOTP server is reached. For example, suppose
    we have a set of three networks. Network N1 is connected to Network N2 using Router
    RA, and Network N2 connects to Network N3 using Router RB. Both of these routers
    function as relay agents but don''t know the IP address of the BOOTP server. Here''s
    what would happen if a client on Network N1 sent a request and the server was
    on Network N3:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 还可以设置 BOOTP 转发代理来转发请求，即使它们不知道 BOOTP 服务器的地址。这些代理接收一个网络上的请求并将其转发到下一个网络，在那里它们期望另一个代理继续转发过程，直到到达
    BOOTP 服务器。例如，假设我们有一组三个网络。网络 N1 通过路由器 RA 连接到网络 N2，网络 N2 通过路由器 RB 连接到网络 N3。这两个路由器都作为转发代理，但不知道
    BOOTP 服务器的 IP 地址。以下是一个客户端在 N1 网络上发送请求而服务器在 N3 网络上的情况：
- en: The client would send its request.
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 客户端会发送其请求。
- en: Router RA would capture the request and put its address into GIAddr. It would
    increment the Hops field to a value of 1 and then broadcast the request out on
    Network N2.
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 路由器 RA 会捕获请求并将它的地址放入 GIAddr。它会将跳数字段增加到 1，然后将请求广播到网络 N2。
- en: Router RB would capture this request. It would see there is already an address
    in GIAddr, so it would leave that alone. It would increment the Hops field to
    2 and broadcast the request on Network N3.
  id: totrans-224
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 路由器 RB 会捕获这个请求。它会看到 GIAddr 中已经有了一个地址，所以它会保留这个地址。它会将跳数字段增加到 2，并在网络 N3 上广播请求。
- en: The BOOTP server would receive the request, process it, and return the reply
    directly back to Router RA.
  id: totrans-225
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: BOOTP 服务器会接收请求，处理它，并将回复直接发送回路由器 RA。
- en: Router RA would relay the reply back to the client.
  id: totrans-226
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 路由器 RA 会将回复转发回客户端。
- en: As you can see, the purpose of the Hops field is to ensure that errant requests
    don't circle around the network endlessly. Each relay agent increments it, and
    if the value of 16 is ever exceeded, the request is dropped. You can also see
    that any relay agents other than the first are involved only for handling the
    request; the reply is sent unicast back to the agent closest to the client.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，跳数字段的作用是确保错误的请求不会在网络中无限循环。每个转发代理都会增加它，如果值超过 16，则请求会被丢弃。您还可以看到，除了第一个以外的任何转发代理都只参与处理请求；回复会单播发送回离客户端最近的代理。
- en: Incidentally, if this multiple-step relaying process sounds like IP routing
    (only using broadcasts), and the Hops field sounds like the Time to Live (TTL)
    field in an IP datagram, then you've been paying attention. It is essentially
    the same idea (as explained in [Chapter 21](ch21.html "Chapter 21. INTERNET PROTOCOL
    DATAGRAM ENCAPSULATION AND FORMATTING")).
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 顺便提一下，如果这个多步骤中继过程听起来像IP路由（仅使用广播），并且跳数字段听起来像IP数据报中的生存时间（TTL）字段，那么你确实在注意。这本质上是一个相同的概念（如第21章[第21章. 互联网协议数据报封装和格式](ch21.html
    "第21章. 互联网协议数据报封装和格式")中所述）。
- en: Chapter 61. DHCP OVERVIEW AND ADDRESS ALLOCATION CONCEPTS
  id: totrans-229
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第61章. DHCP概述和地址分配概念
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages287681.png.jpg)'
  id: totrans-230
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages287681.png.jpg)'
- en: 'In some ways, technological advancement can be considered more a journey than
    a destination. When a particular technology is refined or replaced with a superior
    one, it''s usually only a matter of time before it, too, is replaced with something
    better. And so it was with the TCP/IP Boot Protocol (BOOTP), described in the
    previous chapter. While BOOTP was far more capable than the protocol it replaced,
    Reverse Address Resolution Protocol (RARP), after a number of years BOOTP, itself
    was replaced with a new TCP/IP configuration protocol: the *Dynamic Host Configuration
    Protocol (DHCP)*.'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些方面，技术进步可以被认为更像是一次旅行而不是一个目的地。当某种特定技术被改进或被更优越的技术所取代时，它通常只是时间问题，它也会被更好的东西所取代。TCP/IP引导协议（BOOTP）的情况也是如此，如前一章所述。虽然BOOTP比它所取代的协议——反向地址解析协议（RARP）——功能强大得多，但经过多年，BOOTP本身也被一个新的TCP/IP配置协议所取代：*动态主机配置协议（DHCP）*。
- en: Where BOOTP represented a revolutionary change from RARP, DHCP is more of an
    evolution of BOOTP. It was built using BOOTP as a foundation, with the same basic
    message format. The most significant addition in DHCP is the ability to *dynamically*
    assign addresses to clients and to centrally manage them. It is this capability
    that makes DHCP so powerful. Today, DHCP is the standard TCP/IP host configuration
    protocol and is used in everything from single-client home networks to enterprise-class
    internetworks.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 与RARP代表了从RARP到BOOTP的变革不同，DHCP更多的是BOOTP的演变。它是基于BOOTP构建的，采用了相同的基本消息格式。DHCP最显著的增加是能够*动态地*为客户分配地址并集中管理它们。正是这种能力使得DHCP如此强大。如今，DHCP已成为标准的TCP/IP主机配置协议，并被用于从单客户端家庭网络到企业级互连网络的一切。
- en: In this first chapter on DHCP, I provide an overview of the protocol and a description
    of the concepts behind DHCP address assignment and leasing. I take a high-level
    look at how DHCP address assignment works and give a description of the three
    DHCP address allocation mechanisms. I then delve into DHCP leases and the policies
    and techniques used to decide how to implement DHCP leasing. I provide an overview
    of the lease life cycle from start to finish and describe the two DHCP lease timers
    that help control the process. Finally, I describe DHCP lease address pools and
    ranges, and the general concepts behind address management.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章关于DHCP的第一章中，我提供了对协议的概述，以及DHCP地址分配和租赁背后的概念的描述。我高屋建瓴地审视了DHCP地址分配的工作方式，并描述了三种DHCP地址分配机制。然后我深入探讨了DHCP租赁以及决定如何实施DHCP租赁的政策和技术。我概述了从开始到结束的整个租赁生命周期，并描述了帮助控制过程的两个DHCP租赁计时器。最后，我描述了DHCP租赁地址池和范围，以及地址管理背后的通用概念。
- en: Tip
  id: totrans-234
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**RELATED INFORMATION** *Since DHCP builds on BOOTP, they have a number of
    things in common. For example, DHCP makes use of BOOTP relay agent functionality,
    and DHCP options are basically the same as BOOTP vendor information fields. Since
    DHCP is the more common of the two protocols, I have tried to be complete in describing
    the operation of these features here, highlighting especially any differences
    between how they work for DHCP and in BOOTP. However, I have avoided duplicating
    the history and reasoning for the existence of many of these features. Since BOOTP
    came first, I have placed more of the historical information in the previous chapter.
    In general, if you plan to read about DHCP as well as BOOTP, I recommend reading
    the chapter on BOOTP first. If you don''t plan to read up on BOOTP, you may wish
    to check the topic on DHCP/BOOTP interoperability in [Chapter 64](ch64.html "Chapter 64. DHCP
    CLIENT/SERVER IMPLEMENTATION, FEATURES, AND IPV6 SUPPORT") instead*.'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: '**相关信息** *由于DHCP建立在BOOTP之上，它们有许多共同之处。例如，DHCP利用了BOOTP中继代理功能，并且DHCP选项基本上与BOOTP供应商信息字段相同。由于DHCP是这两种协议中更常见的一种，我在这里尽量全面地描述了这些功能的操作，特别强调了它们在DHCP和BOOTP中工作方式的不同之处。然而，我避免重复许多这些功能的历史和存在理由。由于BOOTP先出现，我在上一章中放置了更多的历史信息。一般来说，如果你打算阅读关于DHCP和BOOTP的内容，我建议首先阅读关于BOOTP的章节。如果你不打算阅读关于BOOTP的内容，你可能希望查看[第64章](ch64.html
    "第64章。DHCP客户端/服务器实现、功能和IPv6支持")中的DHCP/BOOTP互操作性主题*。'
- en: DHCP Overview, History, and Standards
  id: totrans-236
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP概述、历史和标准
- en: 'As you learned in the previous chapter, BOOTP represents a significant improvement
    over RARP because it solves so many of RARP''s problems. BOOTP is a higher-layer
    protocol, not hardware-dependent like RARP. It can support sending extra information
    beyond an IP address to a client to enable customized configuration. Also, through
    the use of BOOTP relay agents, it allows a large organization to use just one
    or two BOOTP servers to handle clients spread out over many physical networks.
    In so doing, BOOTP effectively solves one of the major classes of problems that
    administrators have with manual configuration: the "I have to go configure each
    host myself" issue. It allows "dumb" (storageless) hosts to configure themselves
    automatically and saves administrators the hassles of needing to trek to each
    host individually to specify important configuration parameters.'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 如你在上一章所学，BOOTP相对于RARP来说是一个重大的改进，因为它解决了RARP的许多问题。BOOTP是一个高层协议，不像RARP那样依赖于硬件。它能够支持向客户端发送超出IP地址之外的信息，以便实现定制配置。此外，通过使用BOOTP中继代理，它允许大型组织只需使用一个或两个BOOTP服务器来处理分布在许多物理网络上的客户端。这样做，BOOTP有效地解决了管理员在手动配置中遇到的主要问题类别之一：“我必须亲自配置每个主机”的问题。它允许“愚笨”（无存储）的主机自动配置自己，从而节省了管理员需要逐个访问每个主机以指定重要配置参数的麻烦。
- en: BOOTP normally uses a static method of determining what IP address to assign
    to a device. When a client sends a request, it includes its hardware address,
    which the server looks up in a table to determine the IP address for that client.
    (It is possible for BOOTP to use other methods of determining the relationship
    between an IP and hardware address, but static mapping is usually used.) This
    means BOOTP works well in relatively static environments, where changes to the
    IP addresses assigned to different devices are infrequent. Such networks were
    basically the norm in the 1980s and early 1990s.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: BOOTP通常使用一种静态方法来确定分配给设备的IP地址。当客户端发送请求时，它会包含其硬件地址，服务器会在表中查找该地址以确定该客户端的IP地址。（BOOTP可以使用其他方法来确定IP地址和硬件地址之间的关系，但通常使用静态映射。）这意味着BOOTP在相对静态的环境中运行良好，在这些环境中，分配给不同设备的IP地址的变化不频繁。这样的网络在20世纪80年代和90年代初基本上是标准。
- en: Over time, many networks quickly started to move away from this model, for a
    number of reasons. As computers became smaller and lighter, it was more common
    for them to move from one network to another, where they would require a different
    address using the new network's network ID. Laptop and even palmtop computers
    could literally move from one network to another many times per day. Another major
    issue was the looming exhaustion of the IP address space (see [Chapter 17](ch17.html
    "Chapter 17. CLASSFUL (CONVENTIONAL) ADDRESSING")). For many organizations, permanently
    assigning a static IP address to each and every computer that might connect to
    their network was a luxury they could not afford.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 随着时间的推移，由于多种原因，许多网络迅速开始从这种模式中转变出来。随着计算机变得越来越小和轻便，它们从一个网络移动到另一个网络的频率越来越高，这就需要使用新网络的网络ID来分配不同的地址。笔记本电脑甚至掌上电脑每天可以多次从一个网络移动到另一个网络。另一个主要问题是IP地址空间的即将耗尽（参见[第17章](ch17.html
    "第17章。类地址（传统）寻址"））。对于许多组织来说，为可能连接到其网络的每一台计算机永久分配静态IP地址是一种他们负担不起的奢侈。
- en: In many organizations, trying to keep track of constant IP address changes became
    a daunting task in and of itself. BOOTP, with its static table of mappings between
    hardware addresses and IP addresses, simply wasn't up to the task. It also offered
    no way to reuse addresses; once an address had been assigned, a device could keep
    it forever, even if it were no longer needed.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多组织中，试图跟踪持续的IP地址变化本身就成了一个艰巨的任务。BOOTP，由于其静态的硬件地址与IP地址之间的映射表，根本无法胜任这项任务。它还提供不了重用地址的方法；一旦地址被分配，设备就可以永远保留它，即使它不再需要。
- en: 'DHCP: Building on BOOTP''s Strengths'
  id: totrans-241
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP：基于BOOTP的优势
- en: A new host configuration protocol was needed to serve modern networks, which
    would move away from static, permanent IP address assignment. The Internet Engineering
    Task Force (IETF) supplied this in the form of DHCP, first formalized in RFC 1541,
    published in October 1993\. (Actually, it was really originally specified in RFC
    1531 in that same month, but due to minor errors in 1531, the standard was quickly
    revised and 1541 published.)
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 需要一种新的主机配置协议来服务于现代网络，该协议将摆脱静态、永久的IP地址分配。互联网工程任务组（IETF）以DHCP的形式提供了这一协议，首次在1993年10月发布的RFC
    1541中正式化。（实际上，它最初在同一个月的RFC 1531中进行了规定，但由于1531中存在一些小错误，该标准很快被修订，并发布了1541。）
- en: Because BOOTP worked well within its limitations and was also already widely
    deployed, it would not have made sense to start over from scratch with DHCP. This
    was especially so given that such a decision would have meant dealing with the
    inevitable painful transition, as well as compatibility problems associated with
    having both BOOTP and DHCP around for many years.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 由于BOOTP在其限制内工作得很好，并且已经被广泛部署，因此从头开始使用DHCP是没有意义的。考虑到这样的决定将意味着处理不可避免的痛苦过渡，以及与BOOTP和DHCP共存多年相关的兼容性问题，这一点尤其如此。
- en: 'So, instead of tossing out BOOTP, DHCP was built on it as a foundation. In
    it simplest form, DHCP consists of two major components: an address allocation
    mechanism and a protocol that allows clients to request configuration information
    and servers to provide it. DHCP performs both functions in a manner similar to
    BOOTP, but with improvements.'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，而不是放弃BOOTP，DHCP将其作为基础构建。在其最简单的形式中，DHCP由两个主要组件组成：一个地址分配机制和一个允许客户端请求配置信息以及服务器提供配置信息的协议。DHCP以类似于BOOTP的方式执行这两个功能，但有所改进。
- en: Overview of DHCP Features
  id: totrans-245
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP功能概述
- en: The most significant differences between BOOTP and DHCP are in the area of address
    allocation, which is enhanced through the support for *dynamic* address assignment.
    Rather than using a static table that absolutely maps hardware addresses to IP
    addresses, a *pool* of IP addresses is used to dynamically allocate addresses.
    Dynamic addressing allows IP addresses to be efficiently allocated, and even shared
    among devices. At the same time, DHCP still supports static mapping of addresses
    for devices where this is needed.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: BOOTP和DHCP之间最显著的区别在于地址分配领域，这一领域通过支持*动态*地址分配得到了增强。而不是使用一个绝对将硬件地址映射到IP地址的静态表，而是使用一个*池*来动态分配地址。动态寻址允许IP地址被有效地分配，甚至可以在设备之间共享。同时，DHCP仍然支持需要时对地址进行静态映射的设备。
- en: The overall operation and communication between clients and servers are similar
    to that used by BOOTP, but with changes. The same basic request/reply protocol
    using UDP was retained for communicating configuration information, but additional
    message types were created to support DHCP's enhanced capabilities. BOOTP relay
    agents can be used by DHCP in a manner very similar to how they are used by BOOTP
    clients and server. The vendor information extensions from BOOTP were retained
    as well, but were formalized, renamed *DHCP options*, and extended to allow the
    transmission of much more information.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端与服务器之间的整体操作和通信与 BOOTP 所使用的类似，但也有变化。保留了使用 UDP 的相同基本请求/回复协议来通信配置信息，但创建了额外的消息类型以支持
    DHCP 的增强功能。DHCP 可以以与 BOOTP 客户端和服务器非常相似的方式使用 BOOTP 中继代理。同样保留了来自 BOOTP 的供应商信息扩展，但将其正式化、重命名为
    *DHCP 选项*，并扩展以允许传输更多信息。
- en: The result of all of this development effort is a widely accepted, universal
    host configuration protocol for TCP/IP that retains compatibility with BOOTP while
    significantly extending its capabilities. Today, DHCP is found on millions of
    networks worldwide. It is used for everything from assigning IP addresses to corporate
    networks with thousands of hosts, to allowing a home Internet access router to
    automatically providing the correct Internet configuration information to a single
    user's computer.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些开发工作的结果是，TCP/IP 的一种广泛接受的通用主机配置协议，它保留了与 BOOTP 的兼容性，同时显著扩展了其功能。今天，DHCP 已在全球数百万个网络中找到。它被用于从为成千上万的客户端分配
    IP 地址的企业网络到允许家庭互联网接入路由器自动为单个用户的计算机提供正确的互联网配置信息等一切事情。
- en: Tip
  id: totrans-249
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** The *Dynamic Host Configuration Protocol (DHCP)* is the host
    configuration protocol currently used on modern TCP/IP internetworks. It was based
    on BOOTP and is similar to its predecessor in many respects, including the use
    of request/reply message exchanges and a nearly identical message format. However,
    DHCP includes added functionality, the most notable of which is *dynamic address
    assignment*, which allows clients to be assigned IP addresses from a shared pool
    managed by a DHCP server.'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** *动态主机配置协议 (DHCP)* 是目前现代 TCP/IP 互联网上使用的主机配置协议。它基于 BOOTP，在许多方面与前辈相似，包括使用请求/回复消息交换和几乎相同的消息格式。然而，DHCP
    包含了额外的功能，其中最显著的是 *动态地址分配*，它允许客户端从由 DHCP 服务器管理的共享池中分配 IP 地址。'
- en: The original DHCP specification was revised in March 1997 with the publishing
    of RFC 2131, also titled "Dynamic Host Configuration Protocol." This standard
    defined another new DHCP message (DHCPINFORM) type to allow active IP hosts to
    request additional configuration information. It also made several other small
    changes to the protocol. Since that time, numerous other DHCP-related RFCs have
    been published, most of which either define new DHCP option types (other kinds
    of information DHCP servers can send to DHCP clients) or slightly refine the way
    that DHCP is used in particular applications.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 原始 DHCP 规范于 1997 年 3 月随着 RFC 2131 的发布进行了修订，该 RFC 也称为“动态主机配置协议”。该标准定义了另一种新的 DHCP
    消息类型（DHCPINFORM），允许活动 IP 主机请求额外的配置信息。它还对协议进行了其他一些小的修改。从那时起，已经发布了大量其他与 DHCP 相关的
    RFC，其中大多数要么定义了新的 DHCP 选项类型（DHCP 服务器可以向 DHCP 客户端发送的其他类型的信息），要么稍微细化了 DHCP 在特定应用中的使用方式。
- en: DHCP Address Assignment and Allocation Mechanisms
  id: totrans-252
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP 地址分配和分配机制
- en: 'The two main functions of DHCP are to provide a mechanism for assigning addresses
    to hosts and to provide a method by which clients can request addresses and other
    configuration data from servers. Both functions are based on the ones implemented
    in DHCP''s predecessor, BOOTP, but the changes are much more significant in the
    area of address assignment than they are in communication. It makes sense to start
    our look at DHCP here, since this will naturally lead us into a detailed discussion
    of defining characteristic of DHCP: *dynamic addressing*.'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP 的两个主要功能是为主机分配地址并提供一种方法，使客户端可以从服务器请求地址和其他配置数据。这两个功能都基于 DHCP 的前身 BOOTP 中实现的功能，但在地址分配方面的变化比在通信方面的变化更为显著。在这里开始探讨
    DHCP 是有意义的，因为这自然会引导我们深入讨论 DHCP 的定义特征：*动态地址分配*。
- en: DHCP Address Allocation
  id: totrans-254
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP 地址分配
- en: 'Providing an IP address to a client is the most fundamental configuration task
    performed by a host configuration protocol. To provide flexibility for configuring
    addresses on different types of clients, the DHCP standard includes three different
    address allocation mechanisms: manual, automatic, and dynamic.'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 向客户端提供IP地址是主机配置协议执行的最基本的配置任务。为了在不同类型的客户端上配置地址提供灵活性，DHCP标准包括三种不同的地址分配机制：手动、自动和动态。
- en: I don't really care for the names *automatic* and *dynamic* allocation, because
    they don't do a good job of clearly conveying the differences between these methods.
    Both methods can be considered automatic, because in each, the DHCP server assigns
    an address without requiring any administrator intervention. The real difference
    between them is only in how long the IP address is retained, and therefore, whether
    a host's address varies over time. I think better names would be *static* or *permanent*
    automatic allocation and *dynamic* or *temporary* automatic allocation.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 我并不真的喜欢“自动”和“动态”分配的名称，因为它们并不能很好地清楚地传达这些方法之间的差异。这两种方法都可以被认为是自动的，因为在每种情况下，DHCP服务器都会分配一个地址，而不需要任何管理员的干预。它们之间的真正区别只在于IP地址保留的时间长短，以及主机地址是否随时间变化。我认为更好的名称应该是“静态”或“永久”自动分配和“动态”或“临时”自动分配。
- en: Regardless of what you call them, all three of these methods exist for configuring
    IP hosts using DHCP. It is not necessary for administrators to choose one over
    the others. Instead, they will normally combine the methods, using each where
    it makes the most sense.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 无论你称它们为什么，这三种方法都是为了使用DHCP配置IP主机而存在的。管理员没有必要在这三者之间做出选择。相反，他们通常会结合使用这些方法，在每个最适合的地方使用它们。
- en: DHCP Manual Allocation
  id: totrans-258
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP手动分配
- en: With manual allocation, a particular IP address is preallocated to a single
    device by an administrator. DHCP communicates only the IP address to the device.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 在手动分配中，管理员会预先为单个设备分配一个特定的IP地址。DHCP只将IP地址传达给设备。
- en: Manual allocation is the simplest method, and it is equivalent to the method
    BOOTP uses for address assignment, described in the previous chapter. Each device
    has an address that an administrator gives it ahead of time, and all DHCP does
    is look up the address in a table and send it to the client for which it is intended.
    This technique makes the most sense for devices that are mainstays of the network,
    such as servers and routers. It is also appropriate for other devices that must
    have a stable, permanent IP address.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 手动分配是最简单的方法，它等同于上一章中描述的BOOTP用于地址分配的方法。每个设备都有一个管理员提前分配的地址，而DHCP所做的只是查找表中的地址并将其发送给预期的客户端。这种技术对于网络中的主要设备，如服务器和路由器来说最有意义。它也适用于其他必须具有稳定、永久IP地址的设备。
- en: Okay, now here's a fair question you might have. DHCP acts basically like BOOTP
    in the case of manual allocation. But BOOTP was created for devices that needed
    help with configuration. Servers and routers are complex devices with their own
    internal storage, and they obviously don't need a DHCP server to tell them their
    IP address as a diskless workstation does, so why bother using DHCP for them at
    all?
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 好吧，现在有一个公平的问题你可能会有。在手动分配的情况下，DHCP基本上就像BOOTP一样。但是BOOTP是为了需要配置帮助的设备而创建的。服务器和路由器是具有自己内部存储的复杂设备，显然它们不需要像无盘工作站那样由DHCP服务器告诉它们IP地址，那么为什么还要为它们使用DHCP呢？
- en: 'Well, in fact, you could just manually assign the address to the device directly
    and tell DHCP to ignore those addresses. However, using DHCP for manual assignments
    yields a different benefit: an administrative one. It keeps all the IP address
    information centralized in the DHCP address database, instead of requiring an
    administrator to go from machine to machine checking addresses and ensuring there
    are no duplicates. Updates can be made in a single place as well.'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 嗯，实际上，你完全可以手动直接将地址分配给设备，并告诉DHCP忽略这些地址。然而，使用DHCP进行手动分配会带来不同的好处：管理上的好处。它将所有IP地址信息集中存储在DHCP地址数据库中，而不是要求管理员从一台机器跳到另一台机器检查地址，并确保没有重复。更新也可以在单一位置进行。
- en: DHCP Dynamic Allocation
  id: totrans-263
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP动态分配
- en: While manual allocation is possible in DHCP, dynamic allocation is its real
    *raison d'etre*. With dynamic allocation, DHCP assigns an IP address from a pool
    of addresses for a limited period of time chosen by the server, or until the client
    tells the DHCP server that it no longer needs the address. An administrator sets
    up the *pool* (usually a range or set of ranges) of IP addresses that are available
    for use. Each client that is configured to use DHCP contacts the server when it
    needs an IP address. The server keeps track of which IP addresses are already
    assigned, and it *leases* one of the free addresses from the pool to the client.
    The server decides the amount of time that the lease will last. When the time
    expires, the client must either request permission to keep using the address (*renew*
    the lease) or must get a new one.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 在DHCP中虽然可以进行手动分配，但动态分配才是其真正的**宗旨**。使用动态分配，DHCP从地址池中为客户端分配一个IP地址，这个地址池由服务器根据客户端选择的时间限制进行分配，或者直到客户端通知DHCP服务器它不再需要该地址。管理员会设置一个**地址池**（通常是一个范围或一系列范围），其中包含可供使用的IP地址。每个配置为使用DHCP的客户端在需要IP地址时都会联系服务器。服务器会跟踪哪些IP地址已经被分配，并从地址池中为客户端**租赁**一个空闲地址。服务器决定租约的持续时间。当租约到期时，客户端必须要么请求继续使用该地址的权限（**续租**租约），要么必须获取一个新的地址。
- en: 'Dynamic allocation is the method used for most client machines in modern DHCP-enabled
    IP internetworks. It offers numerous benefits, such as the following:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 动态分配是现代DHCP启用IP互联网中大多数客户端机器使用的方法。它提供了许多好处，例如以下内容：
- en: '**Automation** Each client can be automatically assigned an IP address when
    it is needed, without any administrator intervention. Administrators do not need
    to manually decide which address goes with which client.'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: '**自动化** 当客户端需要IP地址时，可以自动为其分配，无需任何管理员干预。管理员无需手动决定哪个地址分配给哪个客户端。'
- en: '**Centralized Management** All the IP addresses are managed by the DHCP server.
    An administrator can easily look to see which devices are using which addresses
    and perform other network-wide maintenance tasks.'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: '**集中管理** 所有的IP地址都由DHCP服务器管理。管理员可以轻松查看哪些设备正在使用哪些地址，并执行其他网络范围内的维护任务。'
- en: '**Address Reuse and Sharing** By limiting the amount of time that each device
    holds an IP address, the DHCP server can ensure that the pool of IP addresses
    is used only by devices actively using the network. After a period of time, addresses
    no longer being used are returned to the pool, allowing other devices to use them.
    This allows an internetwork to support a total number of devices larger than the
    number of IP addresses available, as long as not all the devices connect to the
    internetwork at the same time.'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: '**地址重用和共享** 通过限制每个设备持有IP地址的时间，DHCP服务器可以确保地址池仅由正在使用网络的设备使用。经过一段时间后，不再使用的地址会返回到地址池，允许其他设备使用。这允许互联网支持比可用的IP地址更多的设备总数，只要不是所有设备同时连接到互联网即可。'
- en: '**Portability and Universality** BOOTP (and DHCP manual allocation) both require
    that the DHCP server know the identity of each client that connects to it, so
    the server can find the client''s assigned address. With dynamic allocation, there
    are no predefined allocations, so any client can request an IP address. This inherently
    makes dynamic allocation the ideal choice for supporting mobile devices that travel
    between networks.'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: '**便携性和通用性** BOOTP（以及DHCP手动分配）都要求DHCP服务器知道连接到它的每个客户端的身份，以便服务器可以找到客户端分配的地址。使用动态分配时，没有预定义的分配，因此任何客户端都可以请求IP地址。这本质上使得动态分配成为支持在网络上移动的设备的理想选择。'
- en: '**Conflict Avoidance** Since IP addresses are all assigned from a pool that
    is managed by the DHCP server, IP address conflicts are avoided. This, of course,
    assumes that all the clients use DHCP. The administrator must ensure that the
    address pool is not used by non-DHCP devices.'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: '**冲突避免** 由于IP地址都是从由DHCP服务器管理的地址池中分配的，因此避免了IP地址冲突。当然，这假设所有客户端都使用DHCP。管理员必须确保地址池不会被非DHCP设备使用。'
- en: DHCP Automatic Allocation
  id: totrans-271
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP自动分配
- en: 'With the automatic allocation method, DHCP automatically assigns an IP address
    permanently to a device, selecting it from a pool of available addresses. This
    method can be used in cases where there are enough IP addresses for each device
    that may connect to the network, but where devices don''t really care which IP
    address they use. Once an address is assigned to a client, that device will keep
    using it. Automatic allocation can be considered a special case of dynamic allocation:
    It is essentially dynamic allocation where the time limit on the use of the IP
    address by a client (the lease length) is forever.'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 使用自动分配方法，DHCP会自动将一个IP地址永久分配给一个设备，从可用的地址池中选择。这种方法适用于有足够IP地址分配给可能连接到网络的每个设备，但设备并不关心它们使用哪个IP地址的情况。一旦地址分配给客户端，该设备将一直使用它。自动分配可以被视为动态分配的特殊情况：它本质上是一种动态分配，其中客户端使用IP地址的时间限制（租约长度）是永久的。
- en: 'In practice, automatic allocation is not used nearly as much as dynamic allocation,
    for a simple reason: Automatically assigning an IP address to a device permanently
    is a risky move. Most administrators feel it is better to use manual allocation
    for the limited number of machines that really need a permanent IP address assignment
    and to use dynamic addressing for others.'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，自动分配的使用频率远低于动态分配，原因很简单：永久性地将IP地址分配给设备是一个风险行为。大多数管理员认为，对于真正需要永久IP地址分配的有限数量的机器，使用手动分配更好，而对于其他设备则使用动态地址分配。
- en: Tip
  id: totrans-274
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** DHCP defines three basic mechanisms for address assignment.
    *Dynamic allocation* is the method most often used, and it works by having each
    client *lease* an address from a DHCP server for a period of time. The server
    chooses the address dynamically from a shared address pool. *Automatic allocation*
    is like dynamic allocation, but the address is assigned permanently instead of
    being leased. *Manual allocation* preassigns an address to a specific device,
    just as BOOTP does, and is normally used only for servers and other permanent,
    important hosts.'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** DHCP定义了三种基本的地址分配机制。*动态分配*是最常用的方法，它通过让每个客户端从DHCP服务器租用一个地址一段时间来实现。服务器从共享地址池中动态选择地址。*自动分配*类似于动态分配，但地址是永久分配而不是租用。*手动分配*预先将一个地址分配给特定的设备，就像BOOTP一样，通常仅用于服务器和其他永久性、重要的主机。'
- en: DHCP Leases
  id: totrans-276
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP租约
- en: Of the three address allocation methods supported by DHCP, dynamic address allocation
    is by far the most popular and important. The significance of the change that
    dynamic addressing represents to how IP addresses are used in TCP/IP can be seen
    in the semantics of how addresses are treated in DHCP. Where conventionally a
    host was said to *own* an IP address, when dynamic address allocation is used,
    hosts are said instead to *lease* an address.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 在DHCP支持的三个地址分配方法中，动态地址分配迄今为止是最受欢迎和最重要的。动态地址分配对TCP/IP中IP地址使用方式的影响可以从DHCP中处理地址的语义中看出。在传统上，主机被认为是“拥有”一个IP地址，而当使用动态地址分配时，主机则被认为是“租用”一个地址。
- en: The notion of a lease conveys very accurately the difference between dynamic
    allocation and the other types. A host no longer is strictly entitled to a particular
    address, with a server merely telling it what the address is. In DHCP, the server
    remains the real owner of all the IP addresses in the address pool, and it merely
    gives permission for a client to use the address for a period of time. The server
    guarantees that it will not try to use the address for another client only during
    this time. The client is responsible for taking certain actions if it wants to
    continue using the address. If it does not successfully reacquire permission for
    using the address after a period of time, it must stop using it or risk creating
    an IP address conflict on the network.
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 租约的概念非常准确地传达了动态分配与其他类型之间的区别。主机不再严格拥有特定的地址，服务器只是告诉它地址是什么。在DHCP中，服务器仍然是地址池中所有IP地址的真正所有者，它只是允许客户端在一定时间内使用该地址。服务器保证在此期间不会尝试将地址分配给另一个客户端。如果客户端在一段时间后未能成功重新获得使用地址的权限，它必须停止使用该地址，否则可能会在网络中造成IP地址冲突。
- en: Tip
  id: totrans-279
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** DHCP''s most significant new feature is dynamic allocation,
    which changes the way that IP addresses are managed. Where in traditional IP each
    device owns a particular IP address, in DHCP the server owns all the addresses
    in the address pool, and each client *leases* an address from the server, usually
    for only a limited period of time.'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** DHCP最重要的新特性是动态分配，这改变了IP地址的管理方式。在传统的IP中，每个设备拥有一个特定的IP地址，而在DHCP中，服务器拥有地址池中的所有地址，每个客户端从服务器**租用**一个地址，通常只有有限的租期。'
- en: DHCP Lease Length Policy
  id: totrans-281
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP租约长度策略
- en: 'When dynamic address allocation is used, the administrator of the network must
    provide parameters to the DHCP server to control how leases are assigned and managed.
    One of the most important decisions to be made is the *lease length policy* of
    the internetwork: how long the administrator wants client leases to last. This
    choice will depend on the network, the server, and the clients. The choice of
    lease time, like so many other networking parameters, comes down to a trade-off
    between *stability* and *allocation efficiency*.'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 当使用动态地址分配时，网络管理员必须向DHCP服务器提供参数，以控制租约的分配和管理方式。需要做出的最重要的决定之一是互联网的**租约长度策略**：管理员希望客户端租约持续多长时间。这个选择将取决于网络、服务器和客户端。租期选择，就像许多其他网络参数一样，最终取决于**稳定性**和**分配效率**之间的权衡。
- en: The primary benefit of using long lease times is that the addresses of devices
    are relatively stable. A device doesn't need to worry about its IP address changing
    all the time, and neither does its user. This is a significant advantage in many
    cases, especially when it is necessary for the client to perform certain server
    functions, accept incoming connections, or use a DNS domain name (ignoring for
    the moment dynamic DNS capabilities). In those situations, having the IP address
    of a device moving all over the place can cause serious complications.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 使用长租期的主要好处是设备的地址相对稳定。设备不需要担心其IP地址会不断变化，用户也是如此。这在许多情况下是一个显著的优势，尤其是在客户端需要执行某些服务器功能、接受传入连接或使用DNS域名（暂时忽略动态DNS功能）时。在这些情况下，设备IP地址四处移动可能会导致严重的问题。
- en: The main drawback of using long leases is that they substantially increase the
    amount of time that an IP address, once it is no longer needed, is tied up before
    it can be reused. In the worst-case scenario, the amount of wasted time for an
    allocation can be almost as long as the lease itself. If we give a device a particular
    address for six months and after two weeks the device is shut down and no longer
    used, the IP address that it was using is still unavailable for another five and
    a half more months.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 使用长租期的主要缺点是它们大大增加了IP地址在不再需要时被占用的时间，直到它可以被重用。在最坏的情况下，分配浪费的时间几乎可以与租期本身一样长。如果我们给设备分配一个特定的地址六个月，而在两周后设备关闭且不再使用，它所使用的IP地址仍然在接下来的五个月半内不可用。
- en: 'For this reason, many administrators prefer to use short leases. This forces
    a client to continually renew the lease as long as it needs it. When it stops
    asking for permission, the address is quickly put back into the pool. This makes
    shorter leases a better idea in environments where the number of addresses is
    limited and must be conserved. The drawback is the opposite of the benefit of
    long leases: constantly changing IP addresses.'
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，许多管理员更喜欢使用短租期。这迫使客户端只要需要就不断续租。当它停止请求许可时，地址会迅速返回到池中。这使得在地址数量有限且必须节约的环境中，短租期成为一个更好的选择。缺点是长租期的相反：IP地址不断变化。
- en: 'Administrators do not need to pick from short and long lease durations. They
    can compromise by choosing a number that best suits the network. The following
    are some examples of lease times and the reasoning behind them:'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 管理员不需要在短租期和长租期之间选择。他们可以通过选择最适合网络的数字来妥协。以下是一些租期示例及其背后的原因：
- en: '**One Hour or Less** Ensures maximum IP address allocation efficiency in a
    very dynamic environment where there are many devices connecting and disconnecting
    from the network, and the number of IP addresses is limited.'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: '**一小时或更少**确保在非常动态的环境中实现最大的IP地址分配效率，在这种环境中，有许多设备连接和断开网络，且IP地址数量有限。'
- en: '**One Day** Suitable for situations where guest machines typically stay for
    a day, to increase IP efficiency when many employees work part time, or otherwise
    to ensure that every day each client must ask again for permission to use an address.'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: '**一天** 适用于访客机器通常只停留一天的情况，或者在许多员工兼职工作时提高IP效率，或者确保每天每个客户端都必须再次请求使用地址的权限。'
- en: '**Three Days** The default used by Microsoft, which alone makes it a popular
    choice.'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: '**三天** 微软默认使用的设置，这本身就使其成为了一个受欢迎的选择。'
- en: '**One Week** A reasonable compromise between the shorter and longer times.'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: '**一周** 在较短和较长时间之间的一种合理折衷。'
- en: '**One Month** Another compromise, closer to the longer end of the lease time
    range.'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: '**一个月** 在租期时间范围内更接近较长端点的另一种折衷。'
- en: '**Three Months** Provides reasonable IP address stability so that addresses
    don''t change very often in reasonably static environments. Also a good idea if
    there are many IP addresses available and machines are often turned off for many
    days or weeks at a time. For example, this duration may be used in a university
    setting to ensure that IP addresses of returning students are maintained over
    the summer recess.'
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: '**三个月** 提供合理的IP地址稳定性，以便在相对静态的环境中地址不会经常更改。如果有很多IP地址可用，并且机器经常连续关闭几天或几周，这也是一个好主意。例如，在大学环境中，这个持续时间可以用来确保在暑假期间返回学生的IP地址得到保留。'
- en: '**One Year** An approximation of an infinite lease.'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: '**一年** 无限租期的近似值。'
- en: Not only is the administrator not restricted to a limited number of possible
    lease durations, it is not necessary for the administrator to choose a constant
    lease length policy for all clients. Depending on the capabilities of the DHCP
    server, an administrator may select different lease lengths for certain clients.
    For example, the administrator may decide to use long leases for desktop computers
    that are permanently assigned to a particular subnet and not moved, and a pool
    of short-leased addresses for notebook computers and visitors. In some DHCP implementations,
    this can be done by assigning clients to particular classes. Of course, this requires
    more work (and may even require multiple servers).
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 不仅管理员不受限于有限的可能租期，而且管理员也不必为所有客户端选择一个恒定的租期策略。根据DHCP服务器的功能，管理员可以为某些客户端选择不同的租期。例如，管理员可能决定为永久分配给特定子网且不移动的台式机使用长租期，并为笔记本电脑和访客提供短租期地址池。在某些DHCP实现中，可以通过将客户端分配到特定类别来实现这一点。当然，这需要更多的工作（甚至可能需要多个服务器）。
- en: In selecting a lease time policy, the administrator must also bear in mind that,
    by default, after half the length of a lease, the client will begin attempting
    to renew the lease. This may make it more advisable to use a longer lease time,
    to increase the amount of time between when a client tries to renew the lease
    and when the lease expires. For example, in a network with a single DHCP server,
    an administrator may want to use leases no shorter than eight hours. This provides
    a four-hour window for maintenance on the server without leases expiring.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 在选择租期策略时，管理员还必须牢记，默认情况下，租期过半后，客户端将开始尝试续订租期。这可能会使使用较长的租期更加可取，以增加客户端尝试续订租期和租期到期之间的时间。例如，在只有一个DHCP服务器的网络中，管理员可能希望使用至少八小时的租期。这为服务器上的维护提供了四小时的窗口，而租期不会到期。
- en: When a lease is very short, such as minutes or hours, it will typically expire
    when a client machine is turned off for a period of time, such as overnight. Longer
    leases will persist across reboots. The client in this case will still contact
    the DHCP server each time it is restarted to *reallocate* the address—confirm
    that it may continue using the address it was assigned.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 当租期非常短，例如几分钟或几小时时，通常在客户端机器关闭一段时间，例如夜间，租期就会到期。较长的租期可以在重启后持续存在。在这种情况下，客户端每次重启时仍会联系DHCP服务器以*重新分配*地址——确认它可以继续使用分配给它的地址。
- en: Tip
  id: totrans-297
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** A key decision that a network administrator using DHCP must
    make is what the network''s *lease length policy* will be. Longer leases allow
    devices to avoid changing addresses too often; shorter leases are more efficient
    in terms of reallocating addresses that are no longer required. An administrator
    can choose from a variety of different lease times and may choose longer leases
    for some devices than for others.'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** 使用DHCP的网络管理员必须做出的一个关键决策是确定网络的*租约长度策略*。较长的租约允许设备避免频繁更改地址；较短的租约在重新分配不再需要的地址方面更有效率。管理员可以从多种不同的租约时间中进行选择，并且可能为某些设备选择比其他设备更长的租约。'
- en: Issues with Infinite Leases
  id: totrans-299
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 无限租约的问题
- en: In addition to choosing a particular lease length number, it is possible to
    specify an infinite lease length duration for certain clients. This effectively
    turns dynamic allocation into automatic allocation for a particular client. As
    I said earlier, however, this is generally not done. The reason is that an infinite
    lease never expires, and as the old saw goes, "Never is a long time."
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 除了选择特定的租约长度数字外，还可以为某些客户端指定无限租约长度。这实际上将动态分配转换为特定客户端的自动分配。然而，如我之前所说，这通常不会这样做。原因是无限租约永远不会过期，正如老话所说，“永远是一段很长的时间。”
- en: Permanently assigning an IP address from a pool is a somewhat risky move, because
    once assigned, if anything occurs that causes that address to be no longer used,
    it can never be recovered. A worst-case scenario would be a visitor to a company
    site who plugs a notebook computer in to the network to check email or transfer
    a file. If that machine is assigned an IP address using automatic allocation,
    the visitor will take it with him when he leaves. Obviously, this is not a great
    idea.
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 从地址池中永久分配IP地址是一种有一定风险的行为，因为一旦分配，如果发生任何导致该地址不再被使用的情况，它将永远无法恢复。最坏的情况是一个访问公司网站的访客将笔记本电脑插入网络以检查电子邮件或传输文件。如果这台机器使用自动分配分配了一个IP地址，访客离开时会带走它。显然，这不是一个好主意。
- en: For this reason, most administrators prefer to use dynamic allocation instead,
    with addresses set to a very long time frame, such as a year or two years. This
    is considered near enough to infinity that it approximates a permanent assignment,
    but allows an IP address to eventually be recovered if a device stops using it.
    In such a policy, anything that really, truly needs a permanent assignment is
    given an address using *manual* assignment, which requires a conscious decision
    to dedicate the address to a particular device.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，大多数管理员更喜欢使用动态分配，将地址设置为非常长的时间框架，例如一年或两年。这被认为几乎等同于无限，近似于永久分配，但允许在设备停止使用IP地址后最终回收该地址。在这种策略中，任何真正需要永久分配的东西都会使用*手动*分配地址，这需要做出有意识的决策将地址分配给特定的设备。
- en: Tip
  id: totrans-303
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**RELATED INFORMATION** *For a little more information related to lease length
    selection, see the section on DHCP server implementation problems and issues in
    [Chapter 64](ch64.html "Chapter 64. DHCP CLIENT/SERVER IMPLEMENTATION, FEATURES,
    AND IPV6 SUPPORT")*.'
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: '**相关信息** *有关租约长度选择的相关更多信息，请参阅[第64章](ch64.html "第64章。DHCP客户端/服务器实现、功能和IPv6支持")中关于DHCP服务器实现问题和章节*。'
- en: DHCP Lease Life Cycle and Lease Timers
  id: totrans-305
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP租约生命周期和租约计时器
- en: The use of dynamic address allocation in DHCP means a whole new way of thinking
    about addresses. A client no longer owns an address, but rather leases it. This
    means that when a client machine is set to use DHCP dynamic addressing, it can
    never assume that it has an address on a permanent basis. Each time it powers
    up, it must engage in communications with a DHCP server to begin or confirm the
    lease of an address. It also must perform other activities over time to manage
    this lease and possibly terminate it.
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 在DHCP中使用动态地址分配意味着对地址的一种全新的思考方式。客户端不再拥有地址，而是租用它。这意味着当客户端计算机设置为使用DHCP动态地址时，它永远不能假设它有一个永久性的地址。每次开机时，它都必须与DHCP服务器进行通信，以开始或确认地址的租约。它还必须在一段时间内执行其他活动来管理这个租约，并可能终止它。
- en: Calling dynamic address assignments leases is a good analogy, because a DHCP
    IP address lease is similar to a real-world lease in a number of respects. For
    example, when you rent an apartment, you sign the lease. Then you use the apartment
    for a period of time. Typically, assuming you are happy with the place, you will
    *renew* the lease before it expires, so you can keep using it. If by the time
    you get near the end of the lease the owner of the apartment has not allowed you
    to renew it, you will probably lease a different apartment to ensure you have
    somewhere to live. And if you decide, say, to move out of the country, you may
    terminate the lease and not get another.
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 将动态地址分配的租赁称为类比是很好的，因为DHCP IP地址租赁在许多方面类似于现实世界的租赁。例如，当你租一套公寓时，你会签署一份租赁合同。然后你会在一段时间内使用公寓。通常情况下，如果你对这个地方满意，你会在它到期之前*续签*租赁，以便你可以继续使用它。如果你在租赁快到期时，公寓的所有者不允许你续签，你可能需要租赁另一套公寓以确保你有住处。而且，如果你决定，比如说，搬到国外，你可能会终止租赁而不再续签。
- en: DHCP Lease Life Cycle Phases
  id: totrans-308
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP租赁生命周期阶段
- en: 'DHCP leases follow a lease life cycle that generally consists of the following
    six phases:'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP租赁遵循一个通常由以下六个阶段组成的租赁生命周期：
- en: '**Allocation** A client begins with no active lease, and hence, no DHCP-assigned
    address. It acquires a lease through a process of *allocation*.'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: '**分配** 客户端开始时没有活动租赁，因此没有DHCP分配的地址。它通过*分配*过程获得租赁。'
- en: '**Reallocation** If a client already has an address from an existing lease,
    then when it reboots or starts up after being shut down, it will contact the DHCP
    server that granted it the lease to confirm the lease and acquire operating parameters.
    This is sometimes called *reallocation*; it is similar to the full allocation
    process but shorter.'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: '**重新分配** 如果客户端已经从一个现有租赁中获得了地址，那么当它重新启动或从关闭状态启动后，它将联系授予它租赁的DHCP服务器以确认租赁并获取操作参数。这有时被称为*重新分配*；它类似于完整分配过程，但更短。'
- en: '**Normal Operation** Once a lease is active, the client functions normally,
    using its assigned IP address and other parameters during the main part of the
    lease. The client is said to be *bound* to the lease and the address.'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: '**正常操作** 一旦租赁生效，客户端将正常工作，在租赁的主要部分使用分配的IP地址和其他参数。客户端被认为与租赁和地址*绑定*。'
- en: '**Renewal** After a certain portion of the lease time has expired, the client
    will attempt to contact the server that initially granted the lease to *renew*
    the lease, so it can keep using its IP address.'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: '**续签** 在租赁时间的一定部分到期后，客户端将尝试联系最初授予租赁的服务器以*续签*租赁，以便它可以继续使用其IP地址。'
- en: '**Rebinding** If renewal with the original leasing server fails (because, for
    example, the server has been taken offline), the client will try to *rebind* to
    any active DHCP server, in an attempt to extend its current lease with any server
    that will allow it to do so.'
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: '**续租** 如果与原始租赁服务器续租失败（例如，服务器已下线），客户端将尝试与任何活动DHCP服务器*续租*，以尝试延长其当前租赁。'
- en: '**Release** The client may decide at any time that it no longer wishes to use
    the IP address it was assigned, and may terminate the lease, *releasing* the IP
    address. Like the apartment renter moving out of the country, this may be done
    if a device is moving to a different network, for example. (Of course, unlike
    DHCP servers, landlords usually don''t let you cancel a lease at your leisure,
    but hey, no analogy is perfect.)'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: '**释放** 客户端可以随时决定不再使用分配给它的IP地址，并可以终止租赁，*释放*该IP地址。就像搬出国外的公寓租客一样，这可能发生在设备移动到不同网络的情况下。（当然，与DHCP服务器不同，房东通常不会让你随意取消租赁，但嘿，没有类比是完美的。）'
- en: '[Figure 61-1](ch61s04.html#dhcp_life_cycle_example_in_this_example_ "Figure 61-1. DHCP
    life cycle example In this example, the initial lease has a duration of 8 days
    and begins at day 0\. The T1 and T2 timers are set for 4 days and 7 days, respectively.
    When the T1 timer expires, the client enters the renewal period and successfully
    renews at day 5 with a new 8-day lease. When this second lease''s T1 timer expires,
    the client is unable to renew with the original server. It enters the rebinding
    period when its T2 timer goes off, and it is granted a renewed 8-day lease with
    a different server. Three days into this lease, it is moved to a different network
    and no longer needs its leased address, so it voluntarily releases it.") illustrates
    the DHCP life cycle using an example that spans three individual leases.'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: '[图61-1](ch61s04.html#dhcp_life_cycle_example_in_this_example_ "图61-1. DHCP生命周期示例
    在本例中，初始租约的有效期为8天，从第0天开始。T1和T2计时器分别设置为4天和7天。当T1计时器到期时，客户端进入续订期，并在第5天成功续订了一个新的8天租约。当这个第二个租约的T1计时器到期时，客户端无法与原始服务器续订。当其T2计时器失效时，它进入重新绑定期，并从不同的服务器获得了一个新的8天租约。在这个租约的第3天，它被移动到不同的网络，不再需要其租用的地址，因此它自愿释放了它。")展示了使用跨越三个单独租约的示例来阐述DHCP生命周期。'
- en: '![DHCP life cycle example In this example, the initial lease has a duration
    of 8 days and begins at day 0\. The T1 and T2 timers are set for 4 days and 7
    days, respectively. When the T1 timer expires, the client enters the renewal period
    and successfully renews at day 5 with a new 8-day lease. When this second lease''s
    T1 timer expires, the client is unable to renew with the original server. It enters
    the rebinding period when its T2 timer goes off, and it is granted a renewed 8-day
    lease with a different server. Three days into this lease, it is moved to a different
    network and no longer needs its leased address, so it voluntarily releases it.](httpatomoreillycomsourcenostarchimages288203.png.jpg)'
  id: totrans-317
  prefs: []
  type: TYPE_IMG
  zh: '![DHCP生命周期示例 在本例中，初始租约的有效期为8天，从第0天开始。T1和T2计时器分别设置为4天和7天。当T1计时器到期时，客户端进入续订期，并在第5天成功续订了一个新的8天租约。当这个第二个租约的T1计时器到期时，客户端无法与原始服务器续订。当其T2计时器失效时，它进入重新绑定期，并从不同的服务器获得了一个新的8天租约。在这个租约的第3天，它被移动到不同的网络，不再需要其租用的地址，因此它自愿释放了它。](httpatomoreillycomsourcenostarchimages288203.png.jpg)'
- en: Figure 61-1. DHCP life cycle example In this example, the initial lease has
    a duration of 8 days and begins at day 0\. The T1 and T2 timers are set for 4
    days and 7 days, respectively. When the T1 timer expires, the client enters the
    renewal period and successfully renews at day 5 with a new 8-day lease. When this
    second lease's T1 timer expires, the client is unable to renew with the original
    server. It enters the rebinding period when its T2 timer goes off, and it is granted
    a renewed 8-day lease with a different server. Three days into this lease, it
    is moved to a different network and no longer needs its leased address, so it
    voluntarily releases it.
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 图61-1. DHCP生命周期示例 在本例中，初始租约的有效期为8天，从第0天开始。T1和T2计时器分别设置为4天和7天。当T1计时器到期时，客户端进入续订期，并在第5天成功续订了一个新的8天租约。当这个第二个租约的T1计时器到期时，客户端无法与原始服务器续订。当其T2计时器失效时，它进入重新绑定期，并从不同的服务器获得了一个新的8天租约。在这个租约的第3天，它被移动到不同的网络，不再需要其租用的地址，因此它自愿释放了它。
- en: Renewal and Rebinding Timers
  id: totrans-319
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 续订和重新绑定计时器
- en: 'The processes of renewal and rebinding are designed to ensure that a client''s
    lease can be extended before it is scheduled to end, so no loss of functionality
    or interruption occurs to the user of the client machine. Each time an address
    is allocated or reallocated, the client starts two timers that control the renewal
    and rebinding process:'
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 续订和重新绑定过程的设计是为了确保客户端的租约在预定结束之前可以被延长，从而确保客户端机器的用户不会出现功能丢失或中断。每次分配或重新分配地址时，客户端都会启动两个计时器，以控制续订和重新绑定过程：
- en: '**Renewal Timer (T1)** This timer is set by default to 50 percent of the lease
    period. When it expires, the client will begin the process of renewing the lease.
    It is simply called *T1* in the DHCP standards.'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: '**续订计时器（T1）** 此计时器默认设置为租约期的50%。当它到期时，客户端将开始续订租约的过程。在DHCP标准中，它简单地被称为*T1*。'
- en: '**Rebinding Timer (T2)** This timer is set by default to 87.5 percent of the
    length of the lease. When it expires, the client will try to rebind, as described
    in the previous section. It is given the snappy name *T2* in the DHCP standards.'
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: '**重新绑定计时器（T2）** 此计时器默认设置为租约长度的87.5%。当它到期时，客户端将尝试重新绑定，如前文所述。在DHCP标准中，它被赋予了简洁的名称*T2*。'
- en: Naturally, if the client successfully renews the lease when the T1 timer expires,
    this will result in a fresh lease, and both timers will be reset. T2 comes into
    play only if the renewal is not successful. It is possible to change the amount
    of time to which these timers are set, but obviously T1 must expire before T2,
    which must expire before the lease itself ends. These usually are not changed
    from the default, but may be modified in certain circumstances.
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 自然地，如果客户端在T1计时器到期时成功续订租约，这将导致一个新的租约，并且两个计时器都将重置。只有当续订不成功时，T2才会发挥作用。可以更改这些计时器设置的时间长度，但显然T1必须在T2之前到期，而T2必须在租约本身结束之前到期。通常这些值不会从默认值更改，但在某些情况下可能会进行修改。
- en: Tip
  id: totrans-324
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** DHCP leases follow a conceptual *life cycle*. The lease is
    first assigned to the client through a process of *allocation*; if the device
    later reboots, it will *reallocate* the lease. After a period of time controlled
    by the *renewal timer (T1)*, the device will attempt to *renew* its lease with
    the server that allocated it. If this fails, the *rebinding timer (T2)* will go
    off, and the device will attempt to *rebind* the lease with any available server.
    The client may also *release* its IP address if it no longer needs it.'
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** DHCP租约遵循一个概念上的*生命周期*。租约首先通过*分配*过程分配给客户端；如果设备稍后重新启动，它将*重新分配*租约。在由*续订计时器（T1）*控制的时期后，设备将尝试与分配租约的服务器*续订*租约。如果这失败，*重新绑定计时器（T2）*将启动，设备将尝试与任何可用的服务器*重新绑定*租约。如果客户端不再需要IP地址，它也可以*释放*其IP地址。'
- en: The lease life cycle is described in the DHCP standards in the form of states
    that the client moves through as it acquires a lease, uses it, and then either
    renews or ends it. The next chapter describes these states and the specific exchanges
    of messages between a client and server to accomplish different lease activities.
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 租约生命周期在DHCP标准中以客户端在获取租约、使用它以及随后续订或结束租约时经过的状态的形式描述。下一章将描述这些状态以及客户端和服务器之间为完成不同的租约活动而进行的特定消息交换。
- en: DHCP Lease Address Pools, Ranges, and Address Management
  id: totrans-327
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP租约地址池、范围和地址管理
- en: Simpler host configuration methods such as BOOTP (or DHCP manual allocation
    for that matter) associate a single IP address with each client machine. DHCP
    dynamic addressing removes this one-to-one correspondence, in favor of flexible
    address mapping to clients on an as-needed basis. The clients no longer own the
    addresses, but lease them from the true owner, the server. Thus, a primary job
    of both a DHCP server and the administrator of that server is to maintain and
    manage these client addresses.
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 更简单的主机配置方法，如BOOTP（或就DHCP而言的手动分配），将单个IP地址与每个客户端机器关联。DHCP动态地址分配取消了这种一对一的对应关系，转而根据需要灵活地将地址映射到客户端。客户端不再拥有地址，而是从真正的所有者，即服务器那里租用。因此，DHCP服务器和该服务器的管理员的主要工作之一是维护和管理这些客户端地址。
- en: Address Pool Size Selection
  id: totrans-329
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 地址池大小选择
- en: 'The set of all addresses that a DHCP server has available for assignment is
    most often called the *address pool*. The first issue related to address management
    is ensuring that the address pool is large enough to serve all the clients that
    will be using the server. The number of addresses required depends on several
    factors:'
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP服务器可用于分配的所有地址集合通常被称为*地址池*。与地址管理相关的一个首要问题是确保地址池足够大，能够为所有将使用该服务器的客户端提供服务。所需地址的数量取决于几个因素：
- en: '**Number of Clients** This is an obvious factor.'
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: '**客户端数量** 这是一个明显的因素。'
- en: '**Stability and Frequency of Use of Clients** If most clients are left on and
    connected to the network all the time, you will probably need to plan on an address
    for each one. In contrast, if you are serving part-time employees or consultants
    who frequently travel, you can get away with sharing a smaller number of addresses.'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: '**客户端的稳定性和使用频率** 如果大多数客户端始终处于开启状态并连接到网络，你可能需要为每个客户端规划一个地址。相比之下，如果你在为经常旅行的兼职员工或顾问提供服务，你可以通过共享较少的地址来解决问题。'
- en: '**Consequences of Overallocation** If having certain clients be unable to get
    a free address is a problem, you need to more carefully manage the address pool
    to ensure that you don''t run out of IP addresses. If having a client not get
    an address is *never* acceptable, make sure you have as many or more addresses
    as clients.'
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: '**过度分配的后果** 如果某些客户无法获得一个空闲地址是一个问题，你需要更仔细地管理地址池，以确保你不会耗尽IP地址。如果客户无法获得地址是*绝对不可接受*的，确保你拥有的地址数量不少于客户数量。'
- en: I'm sure you've probably noticed that these issues are similar to those that
    I raised in discussing lease lengths earlier in this chapter. In fact, the two
    matters are intimately related. Generally speaking, having more addresses gives
    the administrator the luxury of using longer leases. If you are short on addresses,
    you probably need to use shorter leases to reduce the chances of any unused addresses
    continuing to be allocated to devices not needing them.
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 我相信你肯定注意到了，这些问题与我之前在本章中讨论租约长度时提出的问题相似。事实上，这两个问题密切相关。一般来说，拥有更多地址给管理员提供了使用更长租约的便利。如果你地址短缺，你可能需要使用更短的租约来减少未使用的地址继续分配给不需要它们的设备的可能性。
- en: Lease Address Ranges (Scopes)
  id: totrans-335
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 租约地址范围（作用域）
- en: In its simplest form, the address pool takes the form of a list of all addresses
    that the DHCP server has reserved for dynamic client allocation. Along with each
    address, the server stores certain parameters, such as a default lease length
    for the address and other configuration information to be sent to the client when
    it is assigned that address (for example, a subnet mask and the address of a default
    router). All of this data is stored in a special database on the server.
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: 在其最简单的形式中，地址池是以DHCP服务器为动态客户端分配而保留的所有地址的列表。与每个地址一起，服务器存储某些参数，例如地址的默认租约长度以及其他配置信息，当客户端被分配该地址时发送给客户端（例如，子网掩码和默认路由器的地址）。所有这些数据都存储在服务器上的一个特殊数据库中。
- en: Of course, many clients will request addresses from this pool. Most of these
    clients are equals as far as the DHCP server is concerned, and it doesn't matter
    which address each individual client gets. This means most of the information
    stored with each of the addresses in a pool may be the same, except for the address
    number itself. Due to this similarity, it would be inefficient to need to specify
    each address and its parameters individually. Instead, a *range* of addresses
    is normally handled as a single group defined for a particular network or subnet.
    These are not given any particular name in the DHCP standards, but are commonly
    called *scopes*. This term has been popularized by Microsoft in its DHCP server
    implementations. Other operating systems sometimes just call these blocks of addresses
    *ranges*, but I prefer scope.
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，许多客户端会从这个池中请求地址。从DHCP服务器的角度来看，这些客户端大多数是平等的，并且每个客户端获得的地址并不重要。这意味着地址池中每个地址存储的信息可能都是相同的，除了地址编号本身。由于这种相似性，需要单独指定每个地址及其参数将是不高效的。相反，通常将地址的*范围*作为一个单一组处理，该组是为特定网络或子网定义的。在DHCP标准中，这些并没有被赋予任何特定的名称，但通常被称为*作用域*。这个术语在Microsoft的DHCP服务器实现中被普及。其他操作系统有时只是将这些地址块称为*范围*，但我更喜欢使用“作用域”。
- en: Tip
  id: totrans-338
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** Each DHCP server maintains a set of IP addresses that it uses
    to allocate leases to clients. These are usually contiguous blocks of addresses
    assigned to the server by an administrator, called DHCP *address ranges or scopes*.'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** 每个DHCP服务器维护一组IP地址，它使用这些地址向客户端分配租约。这些地址通常是由管理员分配给服务器的连续地址块，称为DHCP *地址范围或作用域*。'
- en: The exact method for setting up scopes depends on the particular operating system
    and DHCP server software. However, each scope definition typically begins by specifying
    a range of addresses using a starting and an ending IP address. For example, if
    a company was assigned the IP address block 111.14.56.0/24, the administrator
    might set up a scope encompassing addresses 111.14.56.20 through 111.14.56.254,
    as shown in [Figure 61-2](ch61s05.html#dhcp_scope_a_single_dhcp_server_scope_en
    "Figure 61-2. DHCP scope A single DHCP server scope, encompassing addresses 111.14.56.1
    through 111.14.56.254."). Then for that scope, the administrator can set up various
    parameters to be specified to each client assigned an address from the scope.
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: 设置范围的精确方法取决于特定的操作系统和DHCP服务器软件。然而，每个范围定义通常从指定一个地址范围开始，使用起始和结束IP地址。例如，如果一家公司被分配了IP地址块111.14.56.0/24，管理员可能会设置一个包括地址111.14.56.20至111.14.56.254的范围，如图61-2所示。然后，对于该范围，管理员可以设置各种参数，指定给从该范围分配地址的每个客户端。
- en: '![DHCP scope A single DHCP server scope, encompassing addresses 111.14.56.1
    through 111.14.56.254.](httpatomoreillycomsourcenostarchimages288205.png.jpg)'
  id: totrans-341
  prefs: []
  type: TYPE_IMG
  zh: '![DHCP范围 单个DHCP服务器范围，包括地址111.14.56.1至111.14.56.254.](httpatomoreillycomsourcenostarchimages288205.png.jpg)'
- en: Figure 61-2. DHCP scope A single DHCP server scope, encompassing addresses 111.14.56.1
    through 111.14.56.254.
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: 图61-2. DHCP范围 单个DHCP服务器范围，包括地址111.14.56.1至111.14.56.254。
- en: Why not start at 111.14.56.1? Usually, we will want to set aside certain IP
    addresses for manual configuration of servers, routers, and other devices requiring
    a fixed address. One easy way to do that is to simply reserve a block of addresses
    that aren't used by DHCP. Alternatively, most DHCP server software will allow
    you to specify a range but *exclude* an address or set of addresses from the range.
    So, we could specify 111.14.56.1 through 111.14.56.254 and individually mark as
    not available addresses we manually assign. Or we could specify that 111.14.56.1
    through 111.14.56.19 are reserved.
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么不从111.14.56.1开始呢？通常，我们可能想要为服务器、路由器和其他需要固定地址的设备预留某些IP地址进行手动配置。一个简单的方法是简单地预留一个DHCP未使用的地址块。或者，大多数DHCP服务器软件将允许你指定一个范围，但*排除*该范围内的地址或地址集。因此，我们可以指定111.14.56.1至111.14.56.254，并单独标记为不可用的地址，我们手动分配的地址。或者，我们可以指定111.14.56.1至111.14.56.19为预留地址。
- en: 'Instead of putting all of its addresses (except excluded ones) in a single
    scope, a server may use *multiple* scopes. One common reason for the latter approach
    is to support more than one subnet on a server. Multiple scopes are also commonly
    used when multiple DHCP servers are used to serve the same clients. There are
    two ways to do this: by having either *overlapping* or *non-overlapping* scopes.'
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器不必将其所有地址（除了排除的地址）放在单个范围内，它可以使用*多个*范围。采用后一种方法的常见原因是在服务器上支持多个子网。当使用多个DHCP服务器为同一客户端提供服务时，也经常使用多个范围。有两种方法可以实现这一点：通过使用*重叠*或*非重叠*的范围。
- en: Overlapping scopes allows each server to assign any address from the same pool.
    However, the DHCP standard doesn't specify any way for servers to communicate
    with each other when they assign an address, so if both servers were told they
    could assign addresses from the same address pool, this could result in both servers
    trying to assign a particular address to two different devices. As a result, if
    you are using two DHCP servers (as is often recommended for redundancy reasons),
    the administrator generally gives them different, non-overlapping scope assignments.
    Alternatively, the same scope is given to each server, with each server told to
    exclude from use the addresses the other server is assigning.
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 覆盖范围允许每个服务器从同一池中分配任何地址。然而，DHCP标准并没有指定服务器在分配地址时相互通信的方式，因此如果两个服务器都被告知它们可以从同一个地址池中分配地址，这可能导致两个服务器试图将特定的地址分配给两个不同的设备。因此，如果你正在使用两个DHCP服务器（通常出于冗余原因推荐这样做），管理员通常会给他们不同的、不重叠的范围分配。或者，可以将相同的范围分配给每个服务器，并告知每个服务器排除其他服务器正在分配的地址的使用。
- en: 'For example, suppose we have two DHCP servers: Server A (the main server) and
    Server B (the backup). We want to assign most of the addresses to Server A and
    a few as backup to Server B. We could give both Server A and Server B the scope
    111.14.56.1 through 111.14.56.254\. We would exclude 111.14.56.1 through 111.14.56.19
    from both. Then we would exclude from Server A the range 111.14.56.200 through
    111.14.56.254 and exclude from Server B the range 111.14.20 through 111.14.56.199\.
    [Figure 61-3](ch61s05.html#dhcp_multiple-server_non-overlapping_sco "Figure 61-3. DHCP
    multiple-server non-overlapping scopes DHCP Servers A and B have been assigned
    non-overlapping scopes to ensure that they do not conflict. This has been done
    by starting with the same scope definition for both. The common reserved range
    is excluded from each. Then Server A has Server B''s address range excluded (hatched
    area at right in the top bar), and Server B has Server A''s range excluded (hatched
    area in the middle at bottom).") shows how this would work. The main advantage
    of this method is that if one server goes down, the administrator can quickly
    remove the exclusion and let the remaining server access all addresses. Also,
    if one server runs out of addresses while the other has plenty, the allocations
    can be shifted easily.'
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，假设我们有两个DHCP服务器：服务器A（主服务器）和服务器B（备份服务器）。我们希望将大多数地址分配给服务器A，并将少量作为备份分配给服务器B。我们可以给服务器A和服务器B分配范围111.14.56.1至111.14.56.254。我们将从两者中排除111.14.56.1至111.14.56.19。然后，我们会从服务器A中排除范围111.14.56.200至111.14.56.254，并从服务器B中排除范围111.14.20至111.14.56.199。[图61-3](ch61s05.html#dhcp_multiple-server_non-overlapping_sco
    "图61-3. DHCP多服务器非重叠作用域 DHCP服务器A和B已被分配了非重叠作用域以确保它们不会冲突。这是通过为两者起始于相同的范围定义来实现的。每个都排除了公共保留范围。然后服务器A排除了服务器B的地址范围（顶部栏右侧的阴影区域），服务器B排除了服务器A的范围（底部中间的阴影区域)")展示了这将如何工作。这种方法的主要优点是，如果某个服务器出现故障，管理员可以快速移除排除，让剩余的服务器访问所有地址。此外，如果其中一个服务器地址耗尽而另一个还有大量地址，分配可以轻松调整。
- en: '![DHCP multiple-server non-overlapping scopes DHCP Servers A and B have been
    assigned non-overlapping scopes to ensure that they do not conflict. This has
    been done by starting with the same scope definition for both. The common reserved
    range is excluded from each. Then Server A has Server B''s address range excluded
    (hatched area at right in the top bar), and Server B has Server A''s range excluded
    (hatched area in the middle at bottom).](httpatomoreillycomsourcenostarchimages288207.png.jpg)'
  id: totrans-347
  prefs: []
  type: TYPE_IMG
  zh: '![DHCP多服务器非重叠作用域 DHCP服务器A和B已被分配了非重叠作用域以确保它们不会冲突。这是通过为两者起始于相同的范围定义来实现的。每个都排除了公共保留范围。然后服务器A排除了服务器B的地址范围（顶部栏右侧的阴影区域），服务器B排除了服务器A的范围（底部中间的阴影区域）](httpatomoreillycomsourcenostarchimages288207.png.jpg)'
- en: Figure 61-3. DHCP multiple-server non-overlapping scopes DHCP Servers A and
    B have been assigned non-overlapping scopes to ensure that they do not conflict.
    This has been done by starting with the same scope definition for both. The common
    reserved range is excluded from each. Then Server A has Server B's address range
    excluded (hatched area at right in the top bar), and Server B has Server A's range
    excluded (hatched area in the middle at bottom).
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 图61-3. DHCP多服务器非重叠作用域 DHCP服务器A和B已被分配了非重叠作用域以确保它们不会冲突。这是通过为两者起始于相同的范围定义来实现的。每个都排除了公共保留范围。然后服务器A排除了服务器B的地址范围（顶部栏右侧的阴影区域），服务器B排除了服务器A的范围（底部中间的阴影区域）。
- en: Other Issues with Address Management
  id: totrans-349
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 地址管理中的其他问题
- en: There are many other issues related to address management, which start to get
    into the guts of DHCP server implementation. For example, as was the case with
    BOOTP, we may need to use relay agents when the DHCP server is responsible for
    addresses on a subnet different from its own. There are also special DHCP features
    that affect how addresses are managed. For example, the DHCP conflict detection
    feature can actually allow two servers to have overlapping scopes, despite what
    I said in the previous section. [Chapter 64](ch64.html "Chapter 64. DHCP CLIENT/SERVER
    IMPLEMENTATION, FEATURES, AND IPV6 SUPPORT"), which covers DHCP implementation
    and features, describes these issues in more detail.
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 与地址管理相关的问题还有很多，这些问题开始涉及到DHCP服务器实现的本质。例如，与BOOTP的情况一样，当DHCP服务器负责与其自身不同的子网上的地址时，我们可能需要使用中继代理。还有一些特殊的DHCP功能会影响地址的管理方式。例如，DHCP冲突检测功能实际上可以允许两个服务器有重叠的作用域，尽管我在上一节中提到过。[第64章](ch64.html
    "第64章。DHCP客户端/服务器实现、功能和IPv6支持")，该章节涵盖了DHCP实现和功能，更详细地描述了这些问题。
- en: Tip
  id: totrans-351
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** If a site has multiple DHCP servers, they can be set up with
    either *overlapping* or *non-overlapping* scopes. Overlapping scopes allow each
    server to assign from the same pool, providing flexibility, but raising the possibility
    of two clients being assigned the same address unless a feature such as *server
    conflict detection* is employed. non-overlapping scopes are safer because each
    server has a dedicated set of addresses for its use, but this means one server
    could run out of addresses while the other still has plenty, and if a server goes
    down, its addresses will be temporarily unallocatable.'
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** 如果一个站点有多个DHCP服务器，它们可以配置为具有**重叠**或**非重叠**的作用域。重叠的作用域允许每个服务器从同一个池中分配地址，提供灵活性，但也增加了两个客户端被分配相同地址的可能性，除非使用了如**服务器冲突检测**这样的功能。非重叠的作用域更安全，因为每个服务器都有专门用于其使用的地址集，但这意味着一个服务器可能会用完地址，而另一个还有许多剩余，如果服务器宕机，其地址将暂时不可分配。'
- en: Chapter 62. DHCP CONFIGURATION AND OPERATION
  id: totrans-353
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第62章。DHCP配置与操作
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages287681.png.jpg)'
  id: totrans-354
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages287681.png.jpg)'
- en: The big news in DHCP is dynamic address allocation, along with the concept of
    address leasing. It is this new functionality that makes DHCP significantly more
    complex than its predecessor, the Boot Protocol (BOOTP). BOOTP is a simple request/reply
    protocol—a server only needs to look up a client's hardware address and send back
    the client's assigned IP address and other parameters. In contrast, DHCP clients
    and servers must do much more to carry out both parameter exchange and the many
    tasks needed to manage IP address leasing.
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP中的重大新闻是动态地址分配以及地址租赁的概念。正是这一新功能使得DHCP比其前身BOOT协议（BOOTP）复杂得多。BOOTP是一个简单的请求/回复协议——服务器只需要查找客户端的硬件地址，并发送客户端分配的IP地址和其他参数。相比之下，DHCP客户端和服务器必须执行更多的操作，以完成参数交换和许多管理IP地址租赁所需的任务。
- en: In this chapter, I delve into the nuts and bolts of how DHCP operates. I begin
    with two background topics. The first provides an overview of the responsibilities
    of clients and servers in DHCP, and shows in general terms how they relate to
    each other. The second discusses DHCP configuration parameters and how they are
    stored and communicated.
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我深入探讨了DHCP如何运作的细节。我首先介绍两个背景主题。第一个主题概述了DHCP中客户端和服务器所承担的责任，并以一般性的方式展示了它们之间的关系。第二个主题讨论了DHCP配置参数及其存储和通信方式。
- en: In the rest of the chapter, I illustrate the operation of DHCP in detail. I
    explain the DHCP client *finite state machine*, which will give you a high-level
    look at the entire client lease life cycle, including address allocation, reallocation,
    renewal, rebinding, and optionally, lease termination. This theoretical description
    is then used as the basis for several topics that explain the actual processes
    by which DHCP client lease activities occur. These show the specific actions taken
    by both client and server and when and how DHCP messages are created and sent.
    The last part of the chapter describes the special mechanism by which a device
    not using DHCP for address allocation can request configuration parameters.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章的剩余部分，我详细说明了DHCP的操作。我解释了DHCP客户端的**有限状态机**，这将让你从高层次了解整个客户端租约生命周期，包括地址分配、重新分配、续订、重新绑定，以及可选的租约终止。这种理论描述随后被用作解释DHCP客户端租约活动实际过程的基础。这些展示了客户端和服务器所采取的具体行动，以及何时以及如何创建和发送DHCP消息。本章的最后部分描述了不使用DHCP进行地址分配的设备请求配置参数的特殊机制。
- en: DHCP Overview of Client and Server Responsibilities
  id: totrans-358
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP客户端和服务器责任概述
- en: DHCP is the newest and most current TCP/IP host configuration protocol. However,
    as you saw in the previous chapter, it wasn't built from scratch—it was designed
    as an extension of BOOTP. In many ways, DHCP is like BOOTP with more features,
    and this can be seen in the basic setup of the protocol and how it works.
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP是最新的、最先进的TCP/IP主机配置协议。然而，正如你在上一章所看到的，它并非从头开始构建——它被设计为BOOTP的扩展。在许多方面，DHCP就像BOOTP，但功能更丰富，这可以从协议的基本设置和工作方式中看出。
- en: Both BOOTP and DHCP are designed based on the common TCP/IP model of client/server
    operation (see [Chapter 8](ch08.html "Chapter 8. TCP/IP PROTOCOL SUITE AND ARCHITECTURE")).
    In any interaction, one device plays the role of client and the other server.
    Each has specific responsibilities and must send and receive messages following
    the protocol described in the DHCP standard. The difference is that where BOOTP
    involves relatively little work for servers and clients and uses a simple single-message
    exchange for communication, DHCP requires that both servers and clients do more,
    and it uses several types of message exchanges.
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: BOOTP和DHCP都是基于常见的TCP/IP客户端/服务器操作模型设计的（参见[第8章](ch08.html "第8章。TCP/IP协议套件和架构")）。在任何交互中，一个设备扮演客户端的角色，另一个设备扮演服务器的角色。每个设备都有特定的职责，并且必须按照DHCP标准中描述的协议发送和接收消息。区别在于，BOOTP对服务器和客户端的工作量相对较小，并使用简单的单消息交换进行通信，而DHCP要求服务器和客户端都要做更多的工作，并使用多种类型的消息交换。
- en: DHCP Server Responsibilities
  id: totrans-361
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP服务器职责
- en: A *DHCP server* is a network device that has been programmed to provide DHCP
    services to clients. The server plays a central role in DHCP because DHCP's main
    function is host configuration, and the server configures hosts (clients) that
    communicate with it. Smaller networks may have only a single server to support
    many clients, while larger networks may use multiple servers. Regardless of the
    number of servers, each will usually service many clients.
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: '*DHCP服务器*是一种被编程以向客户端提供DHCP服务的网络设备。服务器在DHCP中扮演着核心角色，因为DHCP的主要功能是主机配置，服务器配置与它通信的主机（客户端）。较小的网络可能只有一个服务器来支持许多客户端，而较大的网络可能使用多个服务器。无论服务器的数量如何，每个服务器通常都会为许多客户端提供服务。'
- en: 'The following are the key responsibilities of servers in making DHCP work:'
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是在使DHCP工作过程中服务器的关键职责：
- en: '**Address Storage and Management** DHCP servers are the owners of the addresses
    used by all DHCP clients. The server stores the addresses and manages their use,
    keeping track of which addresses have been allocated and which are still available.'
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: '**地址存储和管理** DHCP服务器是所有DHCP客户端使用的地址的所有者。服务器存储地址并管理其使用，跟踪哪些地址已被分配，哪些仍然可用。'
- en: '**Configuration Parameter Storage and Management** DHCP servers also store
    and maintain other parameters that are intended to be sent to clients when requested.
    Many of these are important configuration values that specify in detail how a
    client is to operate.'
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: '**配置参数存储和管理** DHCP服务器还存储并维护其他参数，这些参数旨在在请求时发送给客户端。其中许多是重要的配置值，详细说明了客户端应该如何操作。'
- en: '**Lease Management** DHCP servers use leases to dynamically allocate addresses
    to clients for a limited time. The DHCP server maintains information about each
    of the leases it has granted to clients, as well as policy information such as
    lease lengths.'
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: '**租约管理** DHCP服务器使用租约在有限的时间内动态地为客户端分配地址。DHCP服务器维护有关它授予每个客户端的租约的信息，以及有关租约长度等策略信息。'
- en: '**Response to Client Requests** DHCP servers respond to different types of
    requests from clients to implement the DHCP communication protocol. This includes
    assigning addresses; conveying configuration parameters; and granting, renewing,
    and terminating leases.'
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: '**响应客户端请求** DHCP服务器响应来自客户端的不同类型的请求以实现DHCP通信协议。这包括分配地址；传达配置参数；以及授予、续订和终止租约。'
- en: '**Administration Services** To support all of its other responsibilities, the
    DHCP server includes functionality to allow a human administrator to enter, view,
    change, and analyze addresses, leases, parameters, and all other information needed
    to run DHCP.'
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: '**管理服务** 为了支持其所有其他职责，DHCP服务器包括允许人类管理员输入、查看、更改和分析地址、租约、参数以及运行DHCP所需的所有其他信息的功能。'
- en: DHCP Client Responsibilities
  id: totrans-369
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP客户端职责
- en: 'A *DHCP client* is any device that sends DHCP requests to a server to obtain
    an IP address or other configuration information. Due to the advantages of DHCP,
    most host computers on TCP/IP internetworks today include DHCP client software,
    making them potential DHCP clients if their administrator chooses to enable the
    function. There are several main responsibilities of a DHCP client:'
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: '*DHCP客户端*是指任何向服务器发送DHCP请求以获取IP地址或其他配置信息的设备。由于DHCP的优势，今天TCP/IP互联网上的大多数主机计算机都包括DHCP客户端软件，如果管理员选择启用该功能，它们就成为了潜在的DHCP客户端。DHCP客户端的主要职责包括：'
- en: '**Configuration Initiation** The client takes the *active* role by initiating
    the communication exchange that results in it being given an IP address and other
    parameters. The server, in contrast, is *passive* and will not really do anything
    for the client until the client makes contact.'
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: '**配置初始化** 客户端通过启动导致其获得 IP 地址和其他参数的通信交换来采取*主动*角色。相比之下，服务器是*被动*的，直到客户端建立联系之前，服务器实际上不会为客户端做任何事情。'
- en: '**Configuration Parameter Management** The client maintains parameters that
    pertain to its configuration, some or all of which may be obtained from a DHCP
    server.'
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: '**配置参数管理** 客户端维护与其配置相关的参数，其中一些或全部可能从 DHCP 服务器获得。'
- en: '**Lease Management** Assuming its address is dynamically allocated, the client
    keeps track of the status of its own lease. It is responsible for renewing the
    lease at the appropriate time, rebinding if renewal is not possible, and terminating
    the lease early if the address is no longer needed.'
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: '**租赁管理** 假设其地址是动态分配的，客户端负责跟踪其租赁的状态。它负责在适当的时间续订租赁，如果续订不可行则重新绑定，如果不再需要该地址则提前终止租赁。'
- en: '**Message Retransmission** Since DHCP uses the unreliable User Datagram Protocol
    (UDP, see [Chapter 44](ch44.html "Chapter 44. TCP/IP USER DATAGRAM PROTOCOL (UDP)"))
    for messaging, clients are responsible for detecting message loss and retransmitting
    requests if necessary.'
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: '**消息重传** 由于 DHCP 使用不可靠的用户数据报协议（UDP，见[第 44 章](ch44.html "第 44 章。TCP/IP 用户数据报协议
    (UDP)"))进行消息传递，因此客户端负责检测消息丢失并在必要时重新传输请求。'
- en: DHCP Client/Server Roles
  id: totrans-375
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP 客户端/服务器角色
- en: The DHCP server and client obviously play complementary roles. The server maintains
    configuration parameters for all clients. Each client maintains its own parameters,
    as discussed in the next section.
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，DHCP 服务器和客户端扮演着互补的角色。服务器维护所有客户端的配置参数。每个客户端维护自己的参数，如下一节所述。
- en: IP address assignment and lease creation, renewal, rebinding, and termination
    are accomplished through specific exchanges using a set of eight DHCP message
    types, as discussed in the "DHCP General Operation and Client Finite State Machine"
    and "DHCP Lease Allocation, Reallocation, and Renewal" sections later in this
    chapter. To accomplish this messaging, special rules are followed to generate,
    address, and transport messages, as explained in [Chapter 63](ch63.html "Chapter 63. DHCP
    MESSAGING, MESSAGE TYPES, AND FORMATS").
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: IP 地址分配和租赁创建、续订、重新绑定和终止是通过使用一组八种 DHCP 消息类型进行特定交换来完成的，如本章后面的“DHCP 通用操作和客户端有限状态机”和“DHCP
    租赁分配、重新分配和续订”部分所述。为了完成这些消息，遵循特殊规则来生成、寻址和传输消息，如[第 63 章](ch63.html "第 63 章。DHCP
    消息、消息类型和格式")中所述。
- en: DHCP Relay Agents
  id: totrans-378
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP 中继代理
- en: 'Like BOOTP, DHCP also supports a third type of device: the *relay agent*. Relay
    agents are neither clients nor servers, but rather intermediaries that facilitate
    cross-network communication between servers and clients. They are described in
    more detail in [Chapter 64](ch64.html "Chapter 64. DHCP CLIENT/SERVER IMPLEMENTATION,
    FEATURES, AND IPV6 SUPPORT") (where you can also find more of the implementation
    details of servers and clients).'
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: 与 BOOTP 类似，DHCP 也支持第三种设备：*中继代理*。中继代理既不是客户端也不是服务器，而是促进服务器和客户端之间跨网络通信的中间人。它们在[第
    64 章](ch64.html "第 64 章。DHCP 客户端/服务器实现、功能和 IPv6 支持")中有更详细的描述（在那里您还可以找到服务器和客户端更多实现细节）。
- en: Tip
  id: totrans-380
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** *DHCP servers* are devices programmed to provide DHCP services
    to clients. They manage address information and other parameters and respond to
    client configuration requests. *DHCP clients* are TCP/IP devices that have been
    set to use DHCP to determine their configuration. They send requests and read
    responses, and are responsible for managing their own leases, including renewing
    or rebinding a lease when necessary.'
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** *DHCP 服务器*是编程用于向客户端提供 DHCP 服务的设备。它们管理地址信息和其他参数，并响应用户配置请求。*DHCP 客户端*是设置为使用
    DHCP 确定其配置的 TCP/IP 设备。它们发送请求并读取响应，并负责管理自己的租赁，包括在必要时续订或重新绑定租赁。'
- en: DHCP Configuration Parameters, Storage, and Communication
  id: totrans-382
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP 配置参数、存储和通信
- en: 'One of the more important oversights in DHCP''s predecessor, BOOTP, was that
    it allowed a server to tell a client only three pieces of information: its IP
    address, the name of the server it could use to download a boot file, and the
    name of the boot file to use. This was a result of BOOTP''s legacy as a protocol
    created primarily to let diskless workstations be bootstrapped.'
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP的前身BOOTP中一个更为重要的疏忽是，它只允许服务器告诉客户端三条信息：它的IP地址、它可以用来下载引导文件的服务器名称以及要使用的引导文件名称。这是BOOTP作为主要为了允许无盘工作站引导而创建的协议的遗产。
- en: Obviously, the IP address is a very important parameter, but in modern networks
    it isn't the only one that a client needs to be given for it to function properly.
    A typical host needs to be given other essential information to allow it to know
    how it should operate on its local network and interact with other devices. For
    example, it needs to know the address of a default local router, the subnet mask
    for the subnet it is on, parameters for creating outgoing IP datagrams, and much
    more.
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，IP地址是一个非常重要的参数，但在现代网络中，它并不是客户端正常工作所需的唯一参数。一个典型的主机需要获得其他必要信息，以便知道如何在本地网络中操作以及如何与其他设备交互。例如，它需要知道默认本地路由器的地址、它所在子网的子网掩码、创建出站IP数据报的参数等等。
- en: Configuration Parameter Management
  id: totrans-385
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置参数管理
- en: The inability to specify additional configuration parameters in BOOTP was resolved
    by using the special BOOTP Vendor-Specific Area for vendor-independent *vendor
    information fields*, as first defined in RFC 1048\. In DHCP, this idea has been
    extended further, and more important, formalized, as part of the effort to make
    DHCP a more general-purpose configuration tool. Configuration parameter storage,
    maintenance, and communication are no longer optional features; they are an essential
    part of the host configuration process.
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: 由于BOOTP无法指定额外的配置参数，因此通过使用RFC 1048中首次定义的特殊BOOTP供应商特定区域来为供应商独立的*供应商信息字段*提供了解决方案。在DHCP中，这一想法得到了进一步扩展，并且更为重要的是，它被正式化，作为使DHCP成为一个更通用配置工具的努力的一部分。配置参数的存储、维护和通信不再是可选功能；它们是主机配置过程的基本部分。
- en: 'Just as DHCP servers are the bosses that own and manage IP addresses, they
    also act as the repository for other configuration parameters that belong to DHCP
    clients. This centralization of parameter storage provides many of the same benefits
    that centralizing IP addresses in DHCP does: Administrators can check and adjust
    parameters in a single place, rather than needing to go to each client machine.'
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: 就像DHCP服务器是拥有和管理IP地址的老板一样，它们也充当着属于DHCP客户端的其他配置参数的存储库。这种参数存储的集中化提供了与在DHCP中集中IP地址相同的许多好处：管理员可以在一个地方检查和调整参数，而不是需要访问每一台客户端机器。
- en: Each DHCP server is programmed with parameters that are to be communicated to
    clients in addition to an IP address when an address is assigned. Alternatively,
    a client that has already been assigned an address using some other mechanism
    may still query the DHCP server to get parameter information, using the DHCPINFORM
    message type. (This was actually added to the protocol in RFC 2131; it was not
    in the original DHCP standard.)
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: 每个DHCP服务器在分配地址时，除了IP地址外，还编程了要传达给客户端的参数。或者，已经通过某种其他机制分配了地址的客户端仍然可以查询DHCP服务器以获取参数信息，使用DHCPINFORM消息类型。（这实际上是在RFC
    2131中添加到协议中的；它不在最初的DHCP标准中。）
- en: Parameter Storage
  id: totrans-389
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 参数存储
- en: The exact method of storage of client parameters is to some extent implementation-dependent.
    Typically, there will be some parameters that apply to all clients. For example,
    on a small network with only one router, that router will probably be the default
    router for every DHCP client, regardless of address.
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端参数的存储方法在一定程度上取决于实现。通常，将有一些适用于所有客户端的参数。例如，在一个只有一台路由器的小型网络中，该路由器很可能是每个DHCP客户端的默认路由器，无论地址如何。
- en: The DHCP server will also have certain parameters that are client-specific.
    The IP address itself is an obvious example, but there are other parameters that
    may apply to only certain clients on a network. These parameters are stored in
    some sort of a database and indexed using a particular *client identifier*. The
    default identifier consists of the client's IP subnet number and its hardware
    address. Thus, when a server gets a request from a particular subnet, it can use
    the client's hardware address in the request to look up client-specific parameters
    and return them. The client identifier can be changed if a different identification
    scheme is desired.
  id: totrans-391
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP 服务器也将有一些特定于客户端的参数。IP 地址本身是一个明显的例子，但还有其他可能只适用于网络中某些客户端的参数。这些参数存储在某种数据库中，并使用特定的
    *客户端标识符* 进行索引。默认标识符由客户端的 IP 子网号和其硬件地址组成。因此，当服务器收到特定子网的请求时，它可以使用请求中的客户端硬件地址来查找特定于客户端的参数并将它们返回。如果需要不同的标识方案，客户端标识符可以更改。
- en: Clients are also responsible for storing their own parameters. Many of these
    will be obtained from the DHCP server, although some may be supplied in other
    ways. The specific implementation of the client determines which parameters it
    considers important and how they are discovered.
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端还负责存储它们自己的参数。其中许多将来自 DHCP 服务器，尽管一些可能以其他方式提供。客户端的具体实现决定了它认为哪些参数是重要的以及它们是如何被发现的。
- en: Configuration Parameter Communication
  id: totrans-393
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置参数通信
- en: Communication of configuration parameters between DHCP clients and servers is
    accomplished using *DHCP options*, which replace BOOTP vendor information fields.
    A number of options were defined when DHCP was first created, and additional new
    ones have been created over the years.
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP 客户端和服务器之间配置参数的通信是通过使用 *DHCP 选项* 完成的，这些选项取代了 BOOTP 供应商信息字段。当 DHCP 首次创建时，就定义了一些选项，并且多年来还创建了额外的新的选项。
- en: Today, there are several dozen DHCP options. Obviously, the ability to have
    so many different parameters automatically delivered to a client provides a great
    deal of host configuration flexibility to administrators. DHCP options are described
    further in [Chapter 63](ch63.html "Chapter 63. DHCP MESSAGING, MESSAGE TYPES,
    AND FORMATS").
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: 今天，有几十种 DHCP 选项。显然，能够将如此多的不同参数自动发送给客户端，为管理员提供了大量的主机配置灵活性。DHCP 选项在[第 63 章](ch63.html
    "第 63 章。DHCP 消息、消息类型和格式")中进行了进一步描述。
- en: DHCP General Operation and the Client Finite State Machine
  id: totrans-396
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP 通用操作和客户端有限状态机
- en: Dynamic address allocation is probably the most important new capability introduced
    by DHCP. In the previous chapter, I discussed the significance of the change from
    IP address *ownership* to IP address *leasing*. I also provided a high-level look
    of the activities involved in leasing, by providing an overview of the DHCP lease
    life cycle.
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
  zh: 动态地址分配可能是 DHCP 引入的最重要的新功能。在前一章中，我讨论了从 IP 地址 *所有权* 到 IP 地址 *租赁* 的变化的重要性。我还通过概述
    DHCP 租赁生命周期，提供了租赁活动中所涉及活动的概览。
- en: 'An overview of this sort is useful to get a general handle on how leases work,
    but to really understand the mechanics of DHCP address assignment and client/server
    communication, you need more details on how the devices behave and the messages
    they send. One tool often employed by networking engineers to describe a protocol
    is a theoretical model called a *finite state machine (FSM)*. Using this technique,
    the protocol''s specific behavior is illustrated by showing the different *states*
    a device can be in, what possible *transitions* exist from one state to another,
    what *events* cause transitions to occur, and what *actions* are performed in
    response to an event. The TCP operational overview contains more general background
    information on FSMs (see [Chapter 47](ch47.html "Chapter 47. TCP BASIC OPERATION:
    CONNECTION ESTABLISHMENT, MANAGEMENT, AND TERMINATION")).'
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: 这种类型的概述有助于了解租赁工作的一般情况，但要真正理解 DHCP 地址分配和客户端/服务器通信的机制，你需要更多关于设备行为和它们发送的消息的细节。网络工程师经常使用一种称为
    *有限状态机 (FSM)* 的理论模型来描述协议。使用这种技术，通过展示设备可能处于的不同 *状态*、从一个状态到另一个状态的可能 *转换*、导致转换发生的事件以及响应事件所执行的动作，可以说明协议的具体行为。TCP
    操作概述包含了关于 FSM 的更多一般背景信息（见[第 47 章](ch47.html "第 47 章。TCP 基本操作：连接建立、管理和终止")）。
- en: The DHCP standard uses an FSM to describe the lease life cycle from the perspective
    of a DHCP client. The client begins in an initial INIT state where it has no lease
    and then transitions through various states as it acquires, renews, rebinds, and/or
    releases its IP address. The FSM also indicates which message exchanges occurs
    between the server and client at various stages.
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP标准使用有限状态机从DHCP客户端的角度描述租约的生命周期。客户端从初始的INIT状态开始，此时它没有任何租约，然后通过获取、续订、重新绑定和/或释放其IP地址的各种状态进行转换。有限状态机还指示在各个阶段服务器和客户端之间发生的消息交换。
- en: Note
  id: totrans-400
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*The DHCP standard does not describe the DHCP server''s behavior in the form
    of a FSM; only the client''s is described this way*.'
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
  zh: '*DHCP标准并没有以有限状态机（FSM）的形式描述DHCP服务器的行为；只有客户端的行为是以这种方式描述的*。'
- en: Some people think FSMs are a little dense and hard to understand, and I can
    see why. You can skip this topic, of course, but I think the FSM provides a useful
    way of illustrating in a comprehensive way most of the behavior of a DHCP client.
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
  zh: 有些人认为有限状态机（FSM）有点密集且难以理解，我也能理解这一点。当然，你可以跳过这个主题，但我认为有限状态机提供了一种有用的方式，全面地展示DHCP客户端的大部分行为。
- en: '[Table 62-1](ch62s03.html#dhcp_client_finite_state_machine "Table 62-1. DHCP
    Client Finite State Machine") describes each of the DHCP client states, and summarizes
    the messages sent and received by the client in each, as well as showing the state
    transitions that occur in response. The FSM''s states, events, and transitions
    are easier to envision in [Figure 62-1](ch62s03.html#dhcp_client_finite_state_machine_this_di
    "Figure 62-1. DHCP client finite state machine This diagram shows the finite state
    machine (FSM) used by DHCP clients. The shaded background areas show the transitions
    taken by a DHCP client as it moves through the four primary DHCP processes: allocation,
    reallocation, renewal, and rebinding."), which also incorporates a shading scheme
    so you can see which states are associated with each of the main DHCP processes.'
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: '[表62-1](ch62s03.html#dhcp_client_finite_state_machine "表62-1. DHCP客户端有限状态机")描述了DHCP客户端的每个状态，并总结了客户端在每个状态中发送和接收的消息，以及显示响应中发生的状态转换。有限状态机的状态、事件和转换在[图62-1](ch62s03.html#dhcp_client_finite_state_machine_this_di
    "图62-1. DHCP客户端有限状态机 此图显示了DHCP客户端使用的有限状态机（FSM）。阴影背景区域显示了DHCP客户端在通过四个主要DHCP过程：分配、重新分配、续订和/或重新绑定时采取的转换")中更容易想象，该图还采用了阴影方案，以便你可以看到哪些状态与每个主要DHCP过程相关联。'
- en: Table 62-1. DHCP Client Finite State Machine
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
  zh: 表62-1. DHCP客户端有限状态机
- en: '| State | State Description | Event and Transition |'
  id: totrans-405
  prefs: []
  type: TYPE_TB
  zh: '| 状态 | 状态描述 | 事件和转换 |'
- en: '| --- | --- | --- |'
  id: totrans-406
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| INIT | This is the initialization state, where a client begins the process
    of acquiring a lease. It also returns here when a lease ends or when a lease negotiation
    fails. | Client sends DHCPDISCOVER. The client creates a DHCPDISCOVER message
    and broadcasts it to try to find a DHCP server. It transitions to the SELECTING
    state. |'
  id: totrans-407
  prefs: []
  type: TYPE_TB
  zh: '| INIT | 这是初始化状态，客户端开始获取租约的过程。当租约结束或租约协商失败时，它也会返回此状态。 | 客户端发送DHCPDISCOVER。客户端创建一个DHCPDISCOVER消息，并将其广播出去，试图找到DHCP服务器。它转换到SELECTING状态。
    |'
- en: '| SELECTING | The client is waiting to receive DHCPOFFER messages from one
    or more DHCP servers, so it can choose one. | Client receives offers, selects
    preferred offer, and sends DHCPREQUEST. The client chooses one of the offers it
    has been sent, and broadcasts a DHCPREQUEST message to tell DHCP servers what
    its choice was. It transitions to the REQUESTING state. |'
  id: totrans-408
  prefs: []
  type: TYPE_TB
  zh: '| SELECTING | 客户端正在等待从一个或多个DHCP服务器接收DHCPOFFER消息，以便选择其中一个。 | 客户端接收报价，选择首选报价，并发送DHCPREQUEST。客户端从收到的报价中选择一个，并向DHCP服务器广播一个DHCPREQUEST消息，告知其选择。它转换到REQUESTING状态。
    |'
- en: '|   |   | Client receives DHCPACK, successfully checks that IP address is free.
    The client receives a DHCPACK message from its chosen server, confirming that
    it can have the lease that was offered. It checks to ensure that address is not
    already used, and assuming it is not, records the parameters the server sent it,
    sets the lease timers T1 and T2, and transitions to the BOUND state. |'
  id: totrans-409
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 客户端接收DHCPACK，成功检查IP地址是否空闲。客户端从其选择的DHCP服务器接收DHCPACK消息，确认它可以获得提供的租约。它检查以确保地址尚未被使用，如果尚未使用，则记录服务器发送给它的参数，设置租约计时器T1和T2，并转换到BOUND状态。
    |'
- en: '| REQUESTING | The client is waiting to hear back from the server to which
    it sent its request. | Client receives DHCPACK, but IP address is in use. The
    client receives a DHCPACK message from its chosen server, confirming that it can
    have the lease that was offered. However, it checks and finds the address already
    in use. It sends a DHCPDECLINE message back to the server and returns to the INIT
    state. |'
  id: totrans-410
  prefs: []
  type: TYPE_TB
  zh: '| REQUESTING | 客户端正在等待从其发送请求的服务器收到回复。| 客户端收到 DHCPACK，但 IP 地址已被占用。客户端从其选择的服务器收到
    DHCPACK 消息，确认它可以拥有提供的租约。然而，它进行检查发现地址已被占用。它向服务器发送 DHCPDECLINE 消息，并返回到 INIT 状态。|'
- en: '|   |   | Client receives DHCPNAK. The client receives a DHCPNAK message from
    its chosen server, which means the server has withdrawn its offer. The client
    returns to the INIT state. |'
  id: totrans-411
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 客户端收到 DHCPNAK。客户端从其选择的服务器收到 DHCPNAK 消息，这意味着服务器已撤回其提供的租约。客户端返回到 INIT
    状态。|'
- en: '| INIT-REBOOT | When a client that already has a valid lease starts up after
    a power down or reboot, it starts here instead of the INIT state. | Client sends
    DHCPREQUEST. The client sends a DHCPREQUEST message to attempt to verify its lease
    and reobtain its configuration parameters. It then transitions to the REBOOTING
    state to wait for a response. |'
  id: totrans-412
  prefs: []
  type: TYPE_TB
  zh: '| INIT-REBOOT | 当一个已经拥有有效租约的客户端在断电或重启后启动时，它从这里开始，而不是从 INIT 状态开始。| 客户端发送 DHCPREQUEST。客户端发送
    DHCPREQUEST 消息以尝试验证其租约并重新获取其配置参数。然后它过渡到 REBOOTING 状态以等待响应。|'
- en: '|   |   | Client receives DHCPACK, successfully checks that IP address is free.
    The client receives a DHCPACK message from the server that has its lease information,
    confirming that the lease is still valid. To be safe, the client checks anyway
    to ensure that the address is not already in use by some other device. Assuming
    it is not, the client records the parameters the server sent it and transitions
    to the BOUND state. |'
  id: totrans-413
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 客户端收到 DHCPACK，成功检查 IP 地址是否空闲。客户端从具有其租约信息的服务器收到 DHCPACK 消息，确认租约仍然有效。为了安全起见，客户端仍然进行检查，以确保地址尚未被其他设备使用。假设它没有被使用，客户端记录服务器发送给它的参数，并过渡到
    BOUND 状态。|'
- en: '| REBOOTING | A client that has rebooted with an assigned address is waiting
    for a confirming reply from a server. | Client receives DHCPACK, but IP address
    is in use. The client receives a DHCPACK message from the server that had its
    lease, confirming that the lease is still valid. However, the client checks and
    finds that while the client was offline, some other device has grabbed its leased
    IP address. The client sends a DHCPDECLINE message back to the server and returns
    to the INIT state to obtain a new lease. |'
  id: totrans-414
  prefs: []
  type: TYPE_TB
  zh: '| REBOOTING | 一个已分配地址重新启动的客户端正在等待服务器的确认回复。| 客户端收到 DHCPACK，但 IP 地址已被占用。客户端从其租约的服务器收到
    DHCPACK 消息，确认租约仍然有效。然而，客户端进行检查发现，在客户端离线期间，某些其他设备已经抓取了它的租约 IP 地址。客户端向服务器发送 DHCPDECLINE
    消息，并返回到 INIT 状态以获取新的租约。|'
- en: '|   |   | Client receives DHCPNAK. The client receives a DHCPNAK message from
    a server. This tells it that its current lease is no longer valid; for example,
    the client may have moved to a new network where it can no longer use the address
    in its present lease. The client returns to the INIT state. |'
  id: totrans-415
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 客户端收到 DHCPNAK。客户端从一个服务器收到 DHCPNAK 消息。这告诉它其当前租约不再有效；例如，客户端可能已移动到新的网络，在那里它不能再使用其当前租约中的地址。客户端返回到
    INIT 状态。|'
- en: '|   |   | Renewal timer (T1) expires. The client transitions to the RENEWING
    state. |'
  id: totrans-416
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 更新计时器（T1）到期。客户端过渡到 RENEWING 状态。|'
- en: '| BOUND | A client has a valid lease and is in its normal operating state.
    | Client terminates lease and sends DHCPRELEASE. The client decides to terminate
    the lease (due to user command, for example). It sends a DHCPRELEASE message and
    returns to the INIT state. |'
  id: totrans-417
  prefs: []
  type: TYPE_TB
  zh: '| BOUND | 客户端拥有有效租约并处于其正常操作状态。| 客户端终止租约并发送 DHCPRELEASE。客户端决定终止租约（例如，由于用户命令）。它发送
    DHCPRELEASE 消息并返回到 INIT 状态。|'
- en: '|   |   | Client receives DHCPACK. The client receives a DHCPACK reply to its
    DHCPREQUEST. Its lease is renewed, it restarts the T1 and T2 timers, and it returns
    to the BOUND state. |'
  id: totrans-418
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 客户端收到 DHCPACK。客户端收到对 DHCPREQUEST 的 DHCPACK 回复。其租约已更新，它重新启动 T1 和 T2
    计时器，并返回到 BOUND 状态。|'
- en: '| RENEWING | A client is trying to renew its lease. It regularly sends DHCPREQUEST
    messages with the server that gave it its current lease specified, and waits for
    a reply. | Client receives DHCPNAK. The server has refused to renew the client''s
    lease. The client goes to the INIT state to get a new lease. |'
  id: totrans-419
  prefs: []
  type: TYPE_TB
  zh: '| 续订 | 客户端正在尝试续订其租约。它定期发送指定了当前租约服务器的DHCPREQUEST消息，并等待回复。 | 客户端收到DHCPNAK。服务器拒绝续订客户端的租约。客户端进入INIT状态以获取新的租约。
    |'
- en: '|   |   | Rebinding timer (T2) expires. While the client is attempting to renew
    its lease, the T2 timer expires, indicating that the renewal period has ended.
    The client transitions to the REBINDING state. |'
  id: totrans-420
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 重新绑定定时器（T2）到期。当客户端尝试续订其租约时，T2定时器到期，表示续订期已结束。客户端转换到重新绑定状态。 |'
- en: '|   |   | Client receives DHCPACK. Some server on the network has renewed the
    client''s lease. The client binds to the new server granting the lease, restarts
    the T1 and T2 timers, and returns to the BOUND state. |'
  id: totrans-421
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 客户端收到DHCPACK。网络上的某个服务器续订了客户端的租约。客户端绑定到授予租约的新服务器，重新启动T1和T2定时器，并返回到BOUND状态。
    |'
- en: '| REBINDING | The client has failed to renew its lease with the server that
    originally granted it and now seeks a lease extension with any server that can
    hear it. It periodically sends DHCPREQUEST messages with no server specified,
    until it gets a reply or the lease ends. | Client receives DHCPNAK. A server on
    the network is specifically telling the client it needs to restart the leasing
    process. This may be the case if a new server is willing to grant the client a
    lease, but only with terms different from the client''s current lease. The client
    goes to the INIT state. |'
  id: totrans-422
  prefs: []
  type: TYPE_TB
  zh: '| 重新绑定 | 客户端未能与最初授予其租约的服务器续订租约，现在正寻求与任何可以听到它的服务器续订租约。它定期发送没有指定服务器的DHCPREQUEST消息，直到收到回复或租约结束。
    | 客户端收到DHCPNAK。网络上的某个服务器明确告诉客户端它需要重新启动租赁过程。这可能是在有新服务器愿意授予客户端租约，但条款与客户端当前租约不同的情况下。客户端进入INIT状态。
    |'
- en: '|   |   | Lease expires. The client receives no reply prior to the expiration
    of the lease. It goes back to the INIT state. |'
  id: totrans-423
  prefs: []
  type: TYPE_TB
  zh: '|   |   | 租约到期。在租约到期之前，客户端没有收到任何回复。它返回到INIT状态。 |'
- en: '![DHCP client finite state machine This diagram shows the finite state machine
    (FSM) used by DHCP clients. The shaded background areas show the transitions taken
    by a DHCP client as it moves through the four primary DHCP processes: allocation,
    reallocation, renewal, and rebinding.](httpatomoreillycomsourcenostarchimages288209.png.jpg)'
  id: totrans-424
  prefs: []
  type: TYPE_IMG
  zh: '![DHCP客户端有限状态机 此图显示了DHCP客户端使用的有限状态机（FSM）。阴影背景区域显示了DHCP客户端在通过四个主要DHCP过程：分配、重新分配、续订和重新绑定时采取的转换。](httpatomoreillycomsourcenostarchimages288209.png.jpg)'
- en: 'Figure 62-1. DHCP client finite state machine This diagram shows the finite
    state machine (FSM) used by DHCP clients. The shaded background areas show the
    transitions taken by a DHCP client as it moves through the four primary DHCP processes:
    allocation, reallocation, renewal, and rebinding.'
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
  zh: 图62-1. DHCP客户端有限状态机 此图显示了DHCP客户端使用的有限状态机（FSM）。阴影背景区域显示了DHCP客户端在通过四个主要DHCP过程：分配、重新分配、续订和重新绑定时采取的转换。
- en: This is just a summary of the FSM, and it does not show every possible event
    and transition, since it is complex enough already. For example, if a client that
    received two offers in the SELECTING state receives a DHCPNAK from its chosen
    server in the REQUESTING state, it may choose to send a new DHCPREQUEST to its
    second choice, instead of starting over from scratch. Also, the client must have
    logic that lets it time out if it receives no reply to sent messages in various
    states, such as not receiving any offers in the SELECTING state. The next sections
    discuss these matters in more detail.
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: 这只是一个FSM的摘要，它并没有显示每个可能的事件和转换，因为它已经足够复杂。例如，如果一个在SELECTING状态下收到两个提供的客户端收到其选择的服务器在REQUESTING状态下的DHCPNAK，它可能会选择向其第二选择发送新的DHCPREQUEST，而不是从头开始。此外，客户端必须具有逻辑，使其在发送的消息在各个状态下没有收到回复时超时，例如在SELECTING状态下没有收到任何提供。下一节将更详细地讨论这些问题。
- en: Also note that this FSM applies to dynamically allocated clients—that is, ones
    with conventional leases. A device configured using automatic allocation will
    go through the same basic allocation process, but does not need to renew its lease.
    The process for manual allocation is somewhat different.
  id: totrans-427
  prefs: []
  type: TYPE_NORMAL
  zh: 还要注意，此FSM适用于动态分配的客户端——即具有传统租约的客户端。使用自动分配配置的设备将经历相同的基本分配过程，但不需要续订其租约。手动分配的过程略有不同。
- en: DHCP Lease Allocation, Reallocation, and Renewal
  id: totrans-428
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP 租赁分配、重新分配和续订
- en: 'To implement DHCP, an administrator must first set up a DHCP server and provide
    it with configuration parameters and policy information: IP address ranges, lease
    length specifications, and configuration data that DHCP hosts will need to be
    delivered to them. Host devices can then have their DHCP client software enabled,
    but nothing will happen until the client initiates communication with the server.
    When a DHCP client starts up for the first time, or when it has no current DHCP
    lease, it will be in an initial state where it doesn''t have an address and needs
    to acquire one. It will do so by initiating the process of *lease allocation*.'
  id: totrans-429
  prefs: []
  type: TYPE_NORMAL
  zh: 要实现 DHCP，管理员必须首先设置 DHCP 服务器，并为其提供配置参数和政策信息：IP 地址范围、租约长度规范以及 DHCP 主机需要交付给它们的配置数据。然后，主机设备可以启用它们的
    DHCP 客户端软件，但除非客户端与服务器建立通信，否则不会发生任何事情。当 DHCP 客户端首次启动或没有当前 DHCP 租约时，它将处于初始状态，没有地址并且需要获取一个。它将通过启动
    *租赁分配* 流程来实现这一点。
- en: Before we examine the steps in the lease allocation, reallocation, and renewal
    processes, I need to clarify some issues related to DHCP lease communications.
    First, DHCP assumes that clients will normally broadcast messages, since they
    don't know the address of servers when they initiate contact, but that servers
    will send replies back unicast to the client. This can be done even before the
    client has an IP address, by sending the message at the link layer. Some clients
    don't support this and require that messages to them be broadcast instead.
  id: totrans-430
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们检查租赁分配、重新分配和续订流程的步骤之前，我需要澄清一些与 DHCP 租赁通信相关的问题。首先，DHCP 假设客户端通常会广播消息，因为当它们发起联系时不知道服务器的地址，但服务器会向客户端发送单播回复。这甚至可以在客户端获得
    IP 地址之前完成，通过在链路层发送消息。一些客户端不支持这一点，并要求向它们发送的消息进行广播。
- en: DHCP uses many of the same basic fields as BOOTP, but much of the extra information
    the protocol requires is carried in DHCP *options*. Some of these options aren't
    really optional, despite the name—they are needed for the basic function of DHCP.
    An obvious example is the DHCP Message Type option, which is what specifies the
    message type itself.
  id: totrans-431
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP 使用与 BOOTP 相同的许多基本字段，但协议要求的额外信息大多包含在 DHCP *选项* 中。尽管名称表明这些选项不是必需的，但其中一些选项实际上是必需的，因为它们对于
    DHCP 的基本功能是必要的。一个明显的例子是 DHCP 消息类型选项，它指定了消息类型本身。
- en: The details of how messages are created and addressed, along with a full description
    of all DHCP fields and options, are presented in [Chapter 63](ch63.html "Chapter 63. DHCP
    MESSAGING, MESSAGE TYPES, AND FORMATS").
  id: totrans-432
  prefs: []
  type: TYPE_NORMAL
  zh: 消息的创建和寻址的详细信息，以及所有 DHCP 字段和选项的完整描述，在 [第 63 章](ch63.html "第 63 章. DHCP 消息、消息类型和格式")
    中提供。
- en: Note
  id: totrans-433
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*I have assumed that no relay agents are in use here. See the discussion of
    DHCP/BOOTP relay agents in [Chapter 60](ch60.html "Chapter 60. TCP/IP BOOTSTRAP
    PROTOCOL (BOOTP)") for more on how they change the allocation process (and other
    processes)*.'
  id: totrans-434
  prefs: []
  type: TYPE_NORMAL
  zh: '*我假设这里没有使用中继代理。有关 DHCP/BOOTP 中继代理的讨论，请参阅 [第 60 章](ch60.html "第 60 章. TCP/IP
    引导协议 (BOOTP)")，以了解更多关于它们如何改变分配过程（以及其他过程）的信息*。'
- en: Initial Lease Allocation Process
  id: totrans-435
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 初始租赁分配过程
- en: The following are the basic steps taken by a DHCP client and server in the initial
    allocation of an IP address lease, focusing on the most important tasks each device
    performs (see [Figure 62-2](ch62s04.html#dhcp_lease_allocation_process_this_diagr
    "Figure 62-2. DHCP lease allocation process This diagram shows the steps involved
    in DHCP client lease allocation. This diagram is a bit different from most of
    the other client/server exchange diagrams in this book, in that I have shown two
    servers instead of one. This shows how a client handles responses from multiple
    DHCP servers and how each server reacts differently, depending on whether its
    lease offer was chosen by the client.")).
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是一个 DHCP 客户端和服务器在初始 IP 地址租约分配过程中采取的基本步骤，重点关注每个设备执行的最重要任务（参见 [图 62-2](ch62s04.html#dhcp_lease_allocation_process_this_diagr
    "图 62-2. DHCP 租赁分配过程 此图显示了 DHCP 客户端租赁分配涉及的步骤。此图与其他客户端/服务器交换图略有不同，因为我显示了两个服务器而不是一个。这显示了客户端如何处理来自多个
    DHCP 服务器的响应，以及每个服务器如何根据其租约提议是否被客户端选择而有所不同。")）。
- en: '**Client Creates DHCPDISCOVER Message**'
  id: totrans-437
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端创建 DHCPDISCOVER 消息**'
- en: 'The client begins in the INIT (initialization) state. It has no IP address
    and doesn''t even know whether or where a DHCP server may be on the network. To
    find one, it creates a DHCPDISCOVER message, including the following information:'
  id: totrans-438
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 客户端从INIT（初始化）状态开始。它没有IP地址，甚至不知道网络上是否以及在哪里可能有DHCP服务器。为了找到它，它创建一个包含以下信息的DHCPDISCOVER消息：
- en: Its own hardware address in the CHAddr field of the message, to identify itself
  id: totrans-439
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 消息CHAddr字段中的自己的硬件地址，以识别自己
- en: A random transaction identifier, put into the XID field (used to identify later
    messages as being part of the same transaction)
  id: totrans-440
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个随机的交易标识符，放入XID字段（用于标识后续消息是否属于同一交易）
- en: Optionally, the client may request a particular IP address using a Requested
    IP Address DHCP option, a particular lease length using an IP Address Lease Time
    option, and/or specific configuration parameters by including a Parameter Request
    List option in the message
  id: totrans-441
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 可选地，客户端可以使用请求的IP地址DHCP选项请求特定的IP地址，使用IP地址租约时间选项请求特定的租约长度，以及通过在消息中包含参数请求列表选项来请求特定的配置参数
- en: '**Client Sends DHCPDISCOVER Message**'
  id: totrans-442
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端发送DHCPDISCOVER消息**'
- en: The client broadcasts the DHCPDISCOVER message on the local network. The client
    transitions to the SELECTING state, where it waits for replies to its message.
  id: totrans-443
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 客户端在本地网络上广播DHCPDISCOVER消息。客户端进入SELECTING状态，等待对其消息的回复。
- en: '**Servers Receive and Process DHCPDISCOVER Message**'
  id: totrans-444
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**服务器接收并处理DHCPDISCOVER消息**'
- en: Each DHCP server on the local network receives the client's DHCPDISCOVER message
    and examines it. The server looks up the client's hardware address in its database
    and determines if it is able to offer the client a lease and what the terms of
    the lease will be. If the client has made requests for a particular IP address,
    lease length, or other parameters, the server will attempt to satisfy these requests,
    but it is not required to do so. A server may decide not to offer a lease to a
    particular client if it has not been programmed to provide service for it, it
    has no remaining IP addresses, or for other reasons.
  id: totrans-445
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 本地网络上的每个DHCP服务器都会接收到客户端的DHCPDISCOVER消息并检查它。服务器在其数据库中查找客户端的硬件地址，并确定是否能够向客户端提供一个租约以及租约的条件。如果客户端对特定的IP地址、租约长度或其他参数有请求，服务器将尝试满足这些请求，但并非必须这样做。如果服务器没有编程为提供该客户端的服务，没有剩余的IP地址或其他原因，服务器可能决定不对特定客户端提供租约。
- en: '**Servers Create DHCPOFFER Messages**'
  id: totrans-446
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**服务器创建DHCPOFFER消息**'
- en: 'Each server that chooses to respond to the client creates a DHCPOFFER message
    including the following information:'
  id: totrans-447
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 每个选择响应客户端的服务器都会创建一个包含以下信息的DHCPOFFER消息：
- en: The IP address to be assigned to the client, in the YIAddr field (if the server
    previously had a lease for this client, it will attempt to reuse the IP address
    it used last time; failing that, it will try to use the client's requested address,
    if present; otherwise, it will select any available address)
  id: totrans-448
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要分配给客户端的IP地址，在YIAddr字段中（如果服务器之前为此客户端有一个租约，它将尝试重用上次使用的IP地址；如果不行，它将尝试使用客户端请求的地址，如果有的话；否则，它将选择任何可用的地址）
- en: The length of the lease being offered
  id: totrans-449
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提供的租约长度
- en: Any client-specific configuration parameters either requested by the client
    or programmed into the server to be returned to the client
  id: totrans-450
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 任何由客户端请求或编程到服务器以返回给客户端的特定客户端配置参数
- en: Any general configuration parameters to be returned to all clients or clients
    in this client's class
  id: totrans-451
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要返回给所有客户端或此客户端类别的客户端的任何一般配置参数
- en: The server's identifier in the DHCP Server Identifier option
  id: totrans-452
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: DHCP服务器标识选项中的服务器标识符
- en: The same transaction ID (XID) used in the DHCPDISCOVER message
  id: totrans-453
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在DHCPDISCOVER消息中使用相同的交易ID（XID）
- en: '**Servers Probe and/or Reserve Offered Address (Optional)**'
  id: totrans-454
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**服务器探测和/或保留提供的地址（可选）**'
- en: The DHCP standard specifies that before sending a DHCPOFFER to a client, the
    server should check to see that the IP address isn't already in use by sending
    an ICMP Echo message to that address. It is considered a key part of the DHCP
    server conflict detection feature (discussed in [Chapter 64](ch64.html "Chapter 64. DHCP
    CLIENT/SERVER IMPLEMENTATION, FEATURES, AND IPV6 SUPPORT")). This may be disabled
    by an administrator. Whether or not it probes the address offered, the server
    may also *reserve* the address so that if the client decides to use it, it will
    be available. This isn't mandatory, because the protocol handles the case where
    an offered lease is retracted. It is more efficient if servers do reserve addresses,
    but if IP addresses are in very short supply, such reservations may not be practical.
  id: totrans-455
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: DHCP标准规定，在向客户端发送DHCPOFFER之前，服务器应检查该IP地址是否已被使用，通过向该地址发送ICMP Echo消息来实现。这被认为是DHCP服务器冲突检测功能的关键部分（在[第64章](ch64.html
    "第64章。DHCP客户端/服务器实现、功能和IPv6支持"中讨论）。管理员可以禁用此功能。无论是否探测提供的地址，服务器也可以*保留*该地址，以便如果客户端决定使用它，它将可用。这不是强制性的，因为协议处理了提供的租约被撤回的情况。如果服务器保留地址，则更有效，但如果IP地址非常短缺，这种保留可能不切实际。
- en: '**Servers Send DHCPOFFER Messages**'
  id: totrans-456
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**服务器发送DHCPOFFER消息**'
- en: Each server sends its DHCPOFFER message. They may not all be sent at exactly
    the same time. The messages are sent either unicast or broadcast, as mentioned
    earlier.
  id: totrans-457
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 每个服务器都发送其DHCPOFFER消息。它们可能不会在完全相同的时间发送。消息可以像之前提到的那样以单播或广播方式发送。
- en: '**Client Collects and Processes DHCPOFFER Messages**'
  id: totrans-458
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端收集和处理DHCPOFFER消息**'
- en: The client waits for DHCPOFFER messages to arrive in response to its DHCPDISCOVER
    message. The exact behavior of the client here is implementation-dependent. The
    client may decide to simply take the first offer it receives, for expediency.
    Alternatively, it may choose to shop around by waiting for a period of time. It
    can then process each offer and take the one with the most favorable terms—for
    example, the one with the longest lease. If no DHCPOFFER messages are received,
    the client will enter a retransmission mode and try sending the DHCPDISCOVER again
    for a period of time.
  id: totrans-459
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 客户端等待DHCPOFFER消息作为对其DHCPDISCOVER消息的响应。客户端在此处的确切行为取决于实现。客户端可能决定简单地接受收到的第一个报价，以加快速度。或者，它可以选择等待一段时间进行比较。然后它可以处理每个报价，并选择最有利的报价——例如，租约最长的那个。如果没有收到DHCPOFFER消息，客户端将进入重传模式，并在一段时间内再次尝试发送DHCPDISCOVER。
- en: '**Client Creates DHCPREQUEST Message**'
  id: totrans-460
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端创建DHCPREQUEST消息**'
- en: 'The client creates a DHCPREQUEST message for the server offer it has selected.
    This message serves two purposes: It tells the server whose offer the client has
    accepted, "Yes, I accept your offer, assuming it is still available," and also
    tells the other servers, "Sorry, your offer was rejected." (Well, except for the
    "sorry" part; servers are pretty thick-skinned about rejection.) In this message,
    the client includes the following information:'
  id: totrans-461
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 客户端为所选的服务器创建一个DHCPREQUEST消息。此消息有两个目的：它告诉服务器客户端已接受的报价，“是的，我接受你的报价，假设它仍然可用”，同时也告诉其他服务器，“抱歉，你的报价被拒绝了。”（嗯，除了“抱歉”的部分；服务器对拒绝相当厚脸皮。）在此消息中，客户端包含以下信息：
- en: The identifier of the chosen server in the DHCP Server Identifier option, so
    everyone knows who won
  id: totrans-462
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在DHCP服务器标识符选项中选择的服务器标识符，这样每个人都知道谁赢了
- en: The IP address that the DHCP server assigned the client in the DHCPOFFER message,
    which the client puts in the Requested IP Address DHCP option as a confirmation
  id: totrans-463
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: DHCP服务器在DHCPOFFER消息中分配给客户端的IP地址，客户端将其放在请求的IP地址DHCP选项中作为确认
- en: Any additional configuration parameters it wants in a Parameter Request List
    option in the message
  id: totrans-464
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它希望在消息中的参数请求列表选项中包含的任何附加配置参数
- en: '**Client Sends DHCPREQUEST Message**'
  id: totrans-465
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端发送DHCPREQUEST消息**'
- en: The client sends the DHCPREQUEST message. Since it is intended for not just
    the selected DHCP server, but all servers, it is broadcast. After doing this,
    the client transitions to the REQUESTING state, where it waits for a reply from
    the chosen server.
  id: totrans-466
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 客户端发送DHCPREQUEST消息。由于它不仅针对所选的DHCP服务器，还针对所有服务器，因此它是广播。完成此操作后，客户端进入请求状态，等待所选服务器的回复。
- en: '**Servers Receive and Process DHCPREQUEST Message**'
  id: totrans-467
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**服务器接收和处理DHCPREQUEST消息**'
- en: Each of the servers receives and processes the client's request message. The
    servers not chosen will take the message as a rejection. However, a client may
    select one offer, attempt to request the lease, and have the transaction not complete
    successfully. The client may then come back and try its second-choice offer by
    sending a DHCPREQUEST containing a different Server Identifier. This means that
    if Server A receives a single DHCPREQUEST with a Server Identifier of Server B,
    that doesn't necessarily mean that Server A is finished with the transaction.
    For this reason, rejected servers will wait for a while before offering a previously
    offered lease to another client.
  id: totrans-468
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 每个服务器都会接收并处理客户端的请求消息。未被选中的服务器将把消息视为拒绝。然而，客户端可能选择一个出价，尝试请求租约，但交易没有成功完成。然后客户端可能返回并尝试其第二选择出价，通过发送包含不同服务器标识符的DHCPREQUEST来实现。这意味着如果服务器A收到一个包含服务器B标识符的DHCPREQUEST，这并不一定意味着服务器A已经完成了交易。因此，被拒绝的服务器将在一段时间后才会向另一个客户端提供之前提供的租约。
- en: '**Server Sends DHCPACK or DHCPNAK Message**'
  id: totrans-469
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**服务器发送DHCPACK或DHCPNAK消息**'
- en: The chosen server will see that its lease has been selected. If it did not previously
    reserve the IP address that was offered to the client, it must check to make sure
    it is still available. If it is not, the server sends back a DHCPNAK (*negative
    acknowledgment*) message, which essentially means, "Never mind, that lease is
    no longer available." Usually, however, the server will still have that lease.
    It will create a *binding* for that client, and send back a DHCPACK (*acknowledgment*)
    message that confirms the lease and contains all the pertinent configuration parameters
    for the client.
  id: totrans-470
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 被选中的服务器将看到其租约已被选中。如果它之前没有预留客户端提供的IP地址，它必须检查以确保该地址仍然可用。如果不可用，服务器将发送一个DHCPNAK（*否定确认*）消息，这本质上意味着，“没关系，那个租约不再可用。”然而，通常服务器仍然会保留那个租约。它将为该客户端创建一个*绑定*，并发送一个DHCPACK（*确认*）消息，确认租约并包含所有相关的配置参数。
- en: '**Client Receives and Processes DHCPACK or DHCPNAK Message**'
  id: totrans-471
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端接收并处理DHCPACK或DHCPNAK消息**'
- en: The client receives either a positive or negative acknowledgment for its request.
    If the message is a DHCPNAK, the client transitions back to the INIT state and
    starts over—back to square one (step 1). If it is a DHCPACK, the client reads
    the IP address from the YIAddr field, and records the lease length and other parameters
    from the various message fields and DHCP options. If the client receives neither
    message, it may retransmit the DHCPREQUEST message one or more times. If it continues
    to hear nothing, it must conclude that the server flaked out and go back to step
    1.
  id: totrans-472
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 客户端接收到对其请求的肯定或否定确认。如果消息是DHCPNAK，客户端将返回到INIT状态并重新开始——回到起点（步骤1）。如果是DHCPACK，客户端将从YIAddr字段读取IP地址，并从各种消息字段和DHCP选项中记录租约长度和其他参数。如果客户端没有收到任何消息，它可能需要重新发送DHCPREQUEST消息一次或多次。如果它继续听不到任何消息，它必须得出结论，服务器已经崩溃，并返回到步骤1。
- en: '**Client Checks That Address Is Not in Use**'
  id: totrans-473
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端检查地址是否已被使用**'
- en: The client device should perform a final check to ensure that the new address
    isn't already in use before it concludes the leasing process. This is typically
    done by generating an Address Resolution Protocol (ARP) request on the local network,
    to see if any other device thinks it already has the IP address this client was
    just leased. If another device responds, the client sends a DHCPDECLINE message
    back to the server, which basically means, "Hey server, you messed up. Someone
    is already using that address." The client then goes back to step 1 and starts
    over.
  id: totrans-474
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 客户端设备应在完成租约过程之前进行最终检查，以确保新的地址尚未被使用。这通常是通过在本地网络上生成一个地址解析协议（ARP）请求来完成的，以查看是否有其他设备认为它已经拥有了客户端刚刚租用的IP地址。如果有其他设备响应，客户端将向服务器发送一个DHCPDECLINE消息，这基本上意味着，“嘿服务器，你搞错了。有人已经在使用那个地址。”然后客户端将回到步骤1并重新开始。
- en: '**Client Finalizes Lease Allocation**'
  id: totrans-475
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端最终确定租约分配**'
- en: Assuming that the address is not already in use, the client finalizes the lease
    and transitions to the BOUND state. It also sets its two lease timers, T1 and
    T2\. It is now ready for normal operation.
  id: totrans-476
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 假设地址尚未被使用，客户端将最终确定租约并过渡到BOUND状态。它还设置了其两个租约计时器，T1和T2。现在它已准备好进行正常操作。
- en: As you can see in this description, there are a number of situations that may
    occur that require a client to retransmit messages. This is because DHCP uses
    UDP, which is unreliable and can cause messages to be lost. If retransmissions
    don't fix a problem such as not receiving a DHCPOFFER or a DHCPACK from a server,
    the client may need to start the allocation process over from scratch. The client
    must include enough intelligence to prevent it from simply trying forever to get
    a lease when there may not be a point. For example, if there are no DHCP servers
    on the network, no number of retransmissions will help.
  id: totrans-477
  prefs: []
  type: TYPE_NORMAL
  zh: 正如描述中所示，可能发生许多需要客户端重新发送消息的情况。这是因为DHCP使用UDP，它不可靠且可能导致消息丢失。如果重传无法解决诸如未从服务器收到DHCPOFFER或DHCPACK等问题，客户端可能需要从头开始重新启动分配过程。客户端必须包含足够的智能，以防止它在可能没有意义的情况下永远尝试获取租约。例如，如果网络上没有DHCP服务器，无论重传多少次都无法解决问题。
- en: Thus, after a number of retries, the client will give up and the allocation
    process will fail. If the client is configured to use the Automatic Private IP
    Addressing (APIPA) feature (see [Chapter 64](ch64.html "Chapter 64. DHCP CLIENT/SERVER
    IMPLEMENTATION, FEATURES, AND IPV6 SUPPORT")), this is where it would be used
    to give the client a default address. Otherwise, the client will be, well, dead
    in the water.
  id: totrans-478
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，经过多次尝试后，客户端将放弃，分配过程将失败。如果客户端配置为使用自动私有IP地址分配（APIPA）功能（见[第64章](ch64.html "第64章。DHCP客户端/服务器实现、功能和IPv6支持"）），那么这里将使用该功能为客户端分配一个默认地址。否则，客户端将陷入困境。
- en: '![DHCP lease allocation process This diagram shows the steps involved in DHCP
    client lease allocation. This diagram is a bit different from most of the other
    client/server exchange diagrams in this book, in that I have shown two servers
    instead of one. This shows how a client handles responses from multiple DHCP servers
    and how each server reacts differently, depending on whether its lease offer was
    chosen by the client.](httpatomoreillycomsourcenostarchimages288211.png.jpg)'
  id: totrans-479
  prefs: []
  type: TYPE_IMG
  zh: '![DHCP租约分配过程 此图显示了DHCP客户端租约分配的步骤。此图与本书中大多数其他客户端/服务器交换图略有不同，因为我展示了两个服务器而不是一个。这显示了客户端如何处理来自多个DHCP服务器的响应，以及每个服务器如何根据其租约提议是否被客户端选择而做出不同的反应。](httpatomoreillycomsourcenostarchimages288211.png.jpg)'
- en: Figure 62-2. DHCP lease allocation process This diagram shows the steps involved
    in DHCP client lease allocation. This diagram is a bit different from most of
    the other client/server exchange diagrams in this book, in that I have shown two
    servers instead of one. This shows how a client handles responses from multiple
    DHCP servers and how each server reacts differently, depending on whether its
    lease offer was chosen by the client.
  id: totrans-480
  prefs: []
  type: TYPE_NORMAL
  zh: 图62-2。DHCP租约分配过程 此图显示了DHCP客户端租约分配的步骤。此图与本书中大多数其他客户端/服务器交换图略有不同，因为我展示了两个服务器而不是一个。这显示了客户端如何处理来自多个DHCP服务器的响应，以及每个服务器如何根据其租约提议是否被客户端选择而做出不同的反应。
- en: Tip
  id: totrans-481
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** The most important configuration process in DHCP is the *lease
    allocation process*, used by clients to acquire a lease. The client broadcasts
    a request to determine if any DHCP servers can hear it. Each DHCP server that
    is willing to grant the client a lease sends it an offer. The client selects the
    lease it prefers and sends a response to all servers telling them its choice.
    The selected server then sends the client its lease information.'
  id: totrans-482
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** DHCP中最重要的配置过程是*租约分配过程*，客户端使用该过程来获取租约。客户端广播一个请求以确定是否有任何DHCP服务器能够听到它。每个愿意授予客户端租约的DHCP服务器都会向它发送一个提议。客户端选择它偏好的租约，并向所有服务器发送一个响应，告诉它们它的选择。然后，所选的服务器将向客户端发送其租约信息。'
- en: DHCP Lease Reallocation Process
  id: totrans-483
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP租约重新分配过程
- en: When a DHCP client starts up for the first time and has no lease, it begins
    in the INIT (initialize) state and goes through the allocation process described
    in the preceding section to acquire a lease. The same process is used when a lease
    ends, if a lease renewal fails, or if something happens to cause a client to need
    a new lease.
  id: totrans-484
  prefs: []
  type: TYPE_NORMAL
  zh: 当DHCP客户端首次启动且没有租约时，它从INIT（初始化）状态开始，并按照上一节中描述的分配过程来获取租约。当租约到期、租约续订失败或发生某些事件导致客户端需要新的租约时，也会使用相同的过程。
- en: There are, however, certain situations in which a client starts up while it
    still has a lease already in place. In this situation, the client does not need
    to go through the entire process of getting an IP address allocation and a new
    lease setup. Instead, it simply tries to reestablish its existing lease, through
    a *reallocation process*.
  id: totrans-485
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在某些情况下，客户端在已有租约的情况下启动。在这种情况下，客户端无需经历获取IP地址分配和新租约设置的全过程。相反，它只需尝试通过*重新分配过程*重新建立现有的租约。
- en: A client performs reallocation rather than allocation when it restarts with
    an existing lease. The length of time that a client lease lasts can range from
    minutes to years; it is entirely a matter of the lease length policy set for the
    network and client by the administrator. Many, if not most, client machines are
    not connected to the network 24 hours a day. They are turned on during the day
    and then shut down at night, and also shut down on weekends. A client with a very
    short lease that is shut down and then later started again will probably find
    that its lease has expired, and it will need to get a new one. However, if a lease
    is longer than a few days, it will still probably be in effect when the client
    starts up again. Clients are also sometimes rebooted, to install new software
    or correct a problem. In this case, even when the lease length is very short,
    the restarting client will still have a valid lease when it starts up.
  id: totrans-486
  prefs: []
  type: TYPE_NORMAL
  zh: 当客户端在具有现有租约的情况下重新启动时，它执行的是重新分配而不是分配。客户端租约的持续时间可以从几分钟到几年不等；这完全取决于管理员为网络和客户端设置的租约长度策略。许多（如果不是大多数）客户端机器并非每天24小时都连接到网络。它们在白天开启，然后在夜间关闭，周末也会关闭。如果一个租约非常短，客户端关闭后再重新启动，可能会发现其租约已过期，需要获取一个新的租约。然而，如果租约超过几天，当客户端再次启动时，租约可能仍然有效。客户端有时也会重新启动，以安装新软件或纠正问题。在这种情况下，即使租约长度非常短，重新启动的客户端在启动时仍然会拥有一个有效的租约。
- en: The reallocation process is essentially an abbreviated version of the allocation
    process described in the previous section. There is no need for the client to
    go through the whole "Yoohoo, any servers out there want to give me a lease?"
    routine. Instead, the client attempts to find the server that gave it the lease
    in the first place, seeking a confirmation that the lease is still valid and that
    it may resume using its previously allocated IP address. It also receives confirmation
    of the parameters it should use.
  id: totrans-487
  prefs: []
  type: TYPE_NORMAL
  zh: 重新分配过程本质上是对上一节中描述的分配过程的简略版。客户端无需经历整个“喂，有服务器想给我一个租约吗？”的常规程序。相反，客户端试图找到最初授予其租约的服务器，寻求确认租约仍然有效，并且它可以继续使用之前分配的IP地址。它还会收到有关应使用参数的确认。
- en: The following steps summarize the reallocation process (see [Figure 62-3](ch62s04.html#dhcp_lease_reallocation_process_the_leas
    "Figure 62-3. DHCP lease reallocation process The lease reallocation process consists
    of seven steps that correspond approximately to steps 8 through 14 of the full
    lease allocation process shown in Figure 62-2\. In this example, the server that
    originally granted the lease to the client is Server 2, so it is normally the
    only one that responds.")).
  id: totrans-488
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤总结了重新分配过程（参见[图62-3](ch62s04.html#dhcp_lease_reallocation_process_the_leas
    "图62-3. DHCP租约重新分配过程租约重新分配过程包括七个步骤，大致对应于图62-2中显示的完整租约分配过程的第8步至第14步。在本例中，最初授予客户端租约的服务器是服务器2，因此它通常是唯一响应的服务器。")）。
- en: '**Client Creates DHCPREQUEST Message**'
  id: totrans-489
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端创建DHCPREQUEST消息**'
- en: 'The client begins in the INIT-REBOOT state instead of the INIT state. It creates
    a DHCPREQUEST message to attempt to find a server with information about its current
    lease. This may or may not be the server that originally granted the lease. The
    server responsible for a lease could, theoretically, have changed in the time
    since the client obtained the lease. Thus, unlike the DHCPREQUEST message in step
    8 in the allocation process, the client does not include a DHCP Server Identifier
    option. It does includes the following information:'
  id: totrans-490
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 客户端从INIT-REBOOT状态开始，而不是从INIT状态开始。它创建一个DHCPREQUEST消息，尝试找到有关其当前租约的服务器信息。这可能不是最初授予租约的服务器。自客户端获取租约以来，负责租约的服务器理论上可能已经改变。因此，与分配过程中的第8步中的DHCPREQUEST消息不同，客户端不包括DHCP服务器标识符选项。它确实包括以下信息：
- en: Its own hardware address in the CHAddr field of the message, to identify itself
  id: totrans-491
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它在消息的CHAddr字段中的自己的硬件地址，以识别自己
- en: The IP address of its existing lease, in the Requested IP Address DHCP option
    (this address is not put into the CIAddr field)
  id: totrans-492
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它现有租约的 IP 地址，在请求的 IP 地址 DHCP 选项中（此地址不会放入 CIAddr 字段）
- en: A random transaction identifier, put into the XID field (used to identify later
    messages as being part of the same transaction)
  id: totrans-493
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个随机的事务标识符，放入 XID 字段（用于标识稍后消息是否属于同一事务）
- en: Any additional configuration parameters it wants, in a Parameter Request List
    option in the message
  id: totrans-494
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 它想要的所有附加配置参数，在消息中的参数请求列表选项中
- en: '**Client Sends DHCPREQUEST Message**'
  id: totrans-495
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端发送 DHCPREQUEST 消息**'
- en: The client broadcasts the DHCPREQUEST message. It then transitions to the REBOOTING
    state, where it waits for a reply from a server.
  id: totrans-496
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 客户端广播 DHCPREQUEST 消息。然后它过渡到 REBOOTING 状态，在那里它等待来自服务器的回复。
- en: '**Servers Receive and Process DHCPREQUEST Message and Generate Replies**'
  id: totrans-497
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**服务器接收并处理 DHCPREQUEST 消息并生成回复**'
- en: 'Each server on the network receives and processes the client''s request. The
    server looks up the client in its database, attempting to find information about
    the lease. Each server then decides how to reply to the client:'
  id: totrans-498
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 网络上的每个服务器都会接收并处理客户端的请求。服务器在其数据库中查找客户端，试图找到有关租约的信息。然后每个服务器决定如何回复客户端：
- en: If the server has valid client lease information, it sends a DHCPACK message
    to confirm the lease. It will also reiterate any parameters the client should
    be using.
  id: totrans-499
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果服务器有有效的客户端租约信息，它将发送 DHCPACK 消息以确认租约。它还将重申客户端应使用的任何参数。
- en: If the server determines the client lease is invalid, it sends a DHCPNAK message
    to negate the lease request. Common reasons for this happening are the client
    trying to confirm a lease after it has moved to a different network or after the
    lease has already expired.
  id: totrans-500
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果服务器确定客户端租约无效，它将发送 DHCPNAK 消息以否定租约请求。这种情况发生的原因通常是客户端在移动到不同的网络或租约已过期后尝试确认租约。
- en: If the server has no definitive information about the client lease, it does
    not respond. A server is also required not to respond unless its information is
    guaranteed to be accurate. So, for example, if a server has knowledge of an old
    expired lease, it cannot assume that the lease is no longer valid and send a DHCPNAK,
    unless it also has certain knowledge that no other server has a newer, valid lease
    for that client.
  id: totrans-501
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果服务器没有关于客户端租约的明确信息，它不会回复。服务器还必须确保其信息准确无误才进行回复。例如，如果服务器知道一个旧的已过期租约，它不能假设租约不再有效并发送
    DHCPNAK，除非它还拥有某些知识，即没有其他服务器为该客户端拥有更新的有效租约。
- en: '**Servers Send Replies**'
  id: totrans-502
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**服务器发送回复**'
- en: Servers that are going to respond to the client's DHCPREQUEST send their DHCPACK
    or DHCPNAK messages.
  id: totrans-503
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 准备对客户端的 DHCPREQUEST 进行响应的服务器发送它们的 DHCPACK 或 DHCPNAK 消息。
- en: '**Client Receives and Processes DHCPACK or DHCPNAK Message**'
  id: totrans-504
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端接收并处理 DHCPACK 或 DHCPNAK 消息**'
- en: 'The client waits for a period of time to get a reply to its request. Again,
    there are three possibilities that match the three in step 3:'
  id: totrans-505
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 客户端等待一段时间以获取对其请求的回复。同样，这里有三种可能性与步骤 3 中的三种相匹配：
- en: The client receives a DHCPACK message, which confirms the validity of the lease.
    The client will prepare to begin using the lease again, and continue with step
    6.
  id: totrans-506
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户端收到 DHCPACK 消息，确认租约的有效性。客户端将准备再次使用租约，并继续进行步骤 6。
- en: The client receives a DHCPNAK message, which tells the client that its lease
    is no longer valid. The client transitions back to the INIT state to get a new
    lease—step 1 in the allocation process.
  id: totrans-507
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户端收到 DHCPNAK 消息，告知客户端其租约已不再有效。客户端将返回到 INIT 状态以获取新的租约——分配过程中的步骤 1。
- en: If the client receives no reply at all, it may retransmit the DHCPREQUEST message.
    If no reply is received after a period of time, it will conclude that no server
    has information about its lease and will return to the INIT state to try to get
    a new lease.
  id: totrans-508
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果客户端完全没有收到回复，它可能会重新发送 DHCPREQUEST 消息。如果在一段时间后仍未收到回复，它将得出结论，没有服务器有关于其租约的信息，并将返回到
    INIT 状态以尝试获取新的租约。
- en: '**Client Checks That Address Is Not in Use**'
  id: totrans-509
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端检查地址是否未被使用**'
- en: 'Before resuming use of its lease, the client device should perform a final
    check to ensure that the new address isn''t already in use. Even though this should
    not be the case when a lease already exists, it''s done anyway, as a safety measure.
    The check is the same as described in step 13 of the allocation process: an ARP
    request is issued on the local network, to see if any other device thinks it already
    has the IP address this client was just leased. If another device responds, the
    client sends a DHCPDECLINE message back to the server, which tells it that the
    lease is no good because some other device is using the address. The client then
    goes back to the INIT state to get a new lease.'
  id: totrans-510
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在重新使用其租约之前，客户端设备应进行最终检查，以确保新地址尚未被使用。即使租约已经存在，这也应该不会发生，但出于安全起见，仍然会这样做。检查与分配过程中的第13步描述相同：在本地网络上发出ARP请求，以查看是否有其他设备认为它已经拥有客户端刚刚租用的IP地址。如果有其他设备响应，客户端会向服务器发送DHCPDECLINE消息，告知它租约无效，因为其他设备正在使用该地址。然后客户端返回到INIT状态以获取新的租约。
- en: '**Client Finalizes Lease Allocation**'
  id: totrans-511
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端完成租约分配**'
- en: Assuming that the address is not already in use, the client finalizes the lease
    and transitions to the BOUND state. It is now ready for normal operation.
  id: totrans-512
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 假设地址尚未被使用，客户端将完成租约并过渡到BOUND状态。现在它已准备好进行正常操作。
- en: '![DHCP lease reallocation process The lease reallocation process consists of
    seven steps that correspond approximately to steps 8 through 14 of the full lease
    allocation process shown in . In this example, the server that originally granted
    the lease to the client is Server 2, so it is normally the only one that responds.](httpatomoreillycomsourcenostarchimages288213.png.jpg)'
  id: totrans-513
  prefs: []
  type: TYPE_IMG
  zh: '![DHCP租约重新分配过程 该租约重新分配过程包括七个步骤，大致对应于图中的第8步至第14步，即完整的租约分配过程的步骤。在这个例子中，最初授予客户端租约的服务器是服务器2，因此通常是唯一响应的服务器。](httpatomoreillycomsourcenostarchimages288213.png.jpg)'
- en: Figure 62-3. DHCP lease reallocation process The lease reallocation process
    consists of seven steps that correspond approximately to steps 8 through 14 of
    the full lease allocation process shown in [Figure 62-2](ch62s04.html#dhcp_lease_allocation_process_this_diagr
    "Figure 62-2. DHCP lease allocation process This diagram shows the steps involved
    in DHCP client lease allocation. This diagram is a bit different from most of
    the other client/server exchange diagrams in this book, in that I have shown two
    servers instead of one. This shows how a client handles responses from multiple
    DHCP servers and how each server reacts differently, depending on whether its
    lease offer was chosen by the client."). In this example, the server that originally
    granted the lease to the client is Server 2, so it is normally the only one that
    responds.
  id: totrans-514
  prefs: []
  type: TYPE_NORMAL
  zh: 图62-3. DHCP租约重新分配过程 该租约重新分配过程包括七个步骤，大致对应于图中的第8步至第14步，即完整的租约分配过程的步骤。在这个例子中，最初授予客户端租约的服务器是服务器2，因此通常是唯一响应的服务器。
- en: Tip
  id: totrans-515
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** If a client starts up and already has a lease, it does not
    need to go through the full lease allocation process; instead, it can use the
    shorter *reallocation process*. The client broadcasts a request to find the server
    that has the current information on its lease. That server responds back to confirm
    that the client''s lease is still valid.'
  id: totrans-516
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** 如果客户端启动时已经有一个租约，它不需要经历完整的租约分配过程；相反，它可以使用更短的*重新分配过程*。客户端广播一个请求以找到拥有其租约当前信息的服务器。该服务器会回应以确认客户端的租约仍然有效。'
- en: DHCP Lease Renewal and Rebinding Processes
  id: totrans-517
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP租约续订和重新绑定过程
- en: Once a DHCP client completes the allocation or reallocation process, it enters
    the BOUND state. The client is now in its regular operating mode, with a valid
    IP address and other configuration parameters it received from the DHCP server,
    and it can be used like any regular TCP/IP host.
  id: totrans-518
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦DHCP客户端完成分配或重新分配过程，它将进入BOUND状态。客户端现在处于常规操作模式，拥有从DHCP服务器接收的有效IP地址和其他配置参数，它可以像任何常规TCP/IP主机一样使用。
- en: While the client is in the BOUND state, DHCP essentially lies dormant. As long
    as the client stays on and functioning normally, no real DHCP activity will occur
    while in this state. The most common occurrence that causes DHCP to wake up and
    become active again is arrival of the time when the lease is to be *renewed*.
    Renewal ensures that a lease is perpetuated so it can be used for a prolonged
    period of time, and involves its own message-exchange procedure. (The other way
    that a client can leave the BOUND state is when it terminates the lease early,
    as described in the next section.)
  id: totrans-519
  prefs: []
  type: TYPE_NORMAL
  zh: 当客户端处于BOUND状态时，DHCP基本上处于休眠状态。只要客户端保持开启并正常工作，在此状态下就不会发生真正的DHCP活动。最常见导致DHCP唤醒并再次变得活跃的情况是租约续订时间的到来。续订确保租约得以延续，以便可以长时间使用，并涉及自己的消息交换过程。（客户端离开BOUND状态的另一种方式是它提前终止租约，如下一节所述。）
- en: If DHCP's automatic allocation is used, or if dynamic allocation is used with
    an infinite lease period, the client's lease will never expire, so it never needs
    to be renewed. Short of early termination, the device will remain in the BOUND
    state forever, or at least until it is rebooted. However, most leases are finite
    in nature. A client must take action to ensure that its lease is extended and
    normal operation continues.
  id: totrans-520
  prefs: []
  type: TYPE_NORMAL
  zh: 如果使用DHCP的自动分配，或者使用无限租约期的动态分配，客户端的租约将永远不会过期，因此它永远不会需要续订。除了提前终止之外，设备将永远保持BOUND状态，或者至少直到它重新启动。然而，大多数租约都是有限制的。客户端必须采取行动以确保其租约得到延长，并且正常操作得以继续。
- en: To manage the lease extension process, two timers are set at the time that a
    lease is allocated. The *renewal timer (T1)* goes off to tell the client it is
    time to try to renew the lease with the server that initially granted it. The
    *rebinding timer (T2)* goes off if the client is not successful in renewing with
    that server, and tells it to try any server to have the lease extended. If the
    lease is renewed or rebound, the client goes back to normal operation. If it cannot
    be rebound, it will expire, and the client will need to seek a new lease.
  id: totrans-521
  prefs: []
  type: TYPE_NORMAL
  zh: 为了管理租约扩展过程，在分配租约时设置了两个计时器。*续订计时器（T1）*响起以告知客户端是时候尝试使用最初授予它的服务器续订租约了。如果客户端未能与该服务器续订，*重新绑定计时器（T2）*响起，并告知它尝试任何服务器以延长租约。如果租约被续订或重新绑定，客户端将恢复正常操作。如果不能重新绑定，它将过期，客户端将需要寻找新的租约。
- en: The following steps summarize the renewal/rebinding process (see [Figure 62-4](ch62s04.html#dhcp_lease_renewal_and_rebinding_p-id001
    "Figure 62-4. DHCP lease renewal and rebinding processes This diagram shows the
    example of a client presently holding a lease with Server 2 attempting to contact
    it to renew the lease. However, in this case, Server 2 is down for maintenance.
    The server is unable to respond, and the client remains stuck at step 2 in the
    renewal/rebinding process. It keeps sending DHCPREQUEST messages to Server 2 until
    its T2 timer expires. It then enters the rebinding state and broadcasts a DHCPREQUEST
    message, which is heard by Server 1, which agrees to extend its current lease.")).
    Obviously, the exact sequence of operations taken by a client depends on what
    happens in its attempts to contact a server. For example, if it is successful
    with renewal, it will never need to attempt rebinding.
  id: totrans-522
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤总结了续订/重新绑定过程（见[图62-4](ch62s04.html#dhcp_lease_renewal_and_rebinding_p-id001
    "图62-4. DHCP续订和重新绑定过程 此图展示了客户端当前持有与服务器2的租约，并试图联系它以续订租约的示例。然而，在这种情况下，服务器2因维护而关闭。服务器无法响应，客户端在续订/重新绑定过程的第二步卡住。它持续向服务器2发送DHCPREQUEST消息，直到其T2计时器到期。然后它进入重新绑定状态，广播一个DHCPREQUEST消息，该消息被服务器1听到，服务器1同意延长其当前的租约。"）。显然，客户端采取的精确操作序列取决于其尝试联系服务器时发生的情况。例如，如果它成功续订，它将永远不会需要尝试重新绑定。
- en: '**Renewal Timer (T1) Expires**'
  id: totrans-523
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**续订计时器（T1）到期**'
- en: The renewal timer, T1, is set by default to 50 percent of the length of the
    lease. When the timer goes off, the client transitions from the BOUND state to
    the RENEWING state. Note that a client may initiate lease renewal prior to T1
    timer expiration, if it desires.
  id: totrans-524
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 续订计时器T1默认设置为租约长度的50%。当计时器响起时，客户端从BOUND状态过渡到RENEWING状态。请注意，如果客户端希望，它可以在T1计时器到期之前启动租约续订。
- en: '**Client Sends DHCPREQUEST Renewal Message**'
  id: totrans-525
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端发送DHCPREQUEST续订消息**'
- en: The client creates a DHCPREQUEST message that identifies itself and its lease.
    It then transmits the message directly to the server that initially granted the
    lease, unicast. Note that this is different from the DHCPREQUEST messages used
    in the allocation/reallocation processes, where the DHCPREQUEST is broadcast.
    The client may request a particular new lease length, just as it may request a
    lease length in its requests during allocation, but as always, the server makes
    the final call on lease length.
  id: totrans-526
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 客户端创建一个DHCPREQUEST消息，以标识自己和其租约。然后，它将消息直接发送到最初授予租约的服务器，单播。请注意，这与在分配/重新分配过程中使用的DHCPREQUEST消息不同，那里的DHCPREQUEST是广播的。客户端可以请求特定的新的租约长度，就像它在分配过程中的请求中可以请求租约长度一样，但始终，服务器对租约长度做出最终决定。
- en: '**Server Receives and Processes DHCPREQUEST Message and Creates Reply**'
  id: totrans-527
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**服务器接收并处理DHCPREQUEST消息并创建回复**'
- en: 'Assuming the server is reachable, it will receive and process the client''s
    renewal request. There are two possible responses:'
  id: totrans-528
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 假设服务器可达，它将接收并处理客户端的续租请求。有两种可能的响应：
- en: The server decides that the client's lease can be renewed. It prepares to send
    to the client a DHCPACK message to confirm the lease's renewal, indicating the
    new lease length and any parameters that may have changed since the lease was
    created or last renewed.
  id: totrans-529
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器决定客户端的租约可以续租。它准备向客户端发送DHCPACK消息以确认租约的续租，指示新的租约长度以及自租约创建或上次续租以来可能已更改的任何参数。
- en: The server decides, for whatever reason, not to renew the client's lease. It
    will create a DHCPNAK message.
  id: totrans-530
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器决定，无论什么原因，都不续租客户端的租约。它将创建一个DHCPNAK消息。
- en: '**Server Sends Reply**'
  id: totrans-531
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**服务器发送回复**'
- en: The server sends the DHCPACK or DHCPNAK message back to the client.
  id: totrans-532
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 服务器将DHCPACK或DHCPNAK消息发送回客户端。
- en: '**Client Receives and Processes Server Reply**'
  id: totrans-533
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端接收并处理服务器回复**'
- en: 'The client takes the appropriate action in response to the server''s reply:'
  id: totrans-534
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 客户端根据服务器的回复采取适当的行动：
- en: If the client receives a DHCPACK message, renewing the lease, it notes the new
    lease expiration time and any changed parameters sent by the server, resets the
    T1 and T2 timers, and transitions back to the BOUND state. The client does not
    need to do an ARP IP address check when it is renewing.
  id: totrans-535
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果客户端收到DHCPACK消息，续租租约，它将记录新的租约到期时间以及服务器发送的任何更改的参数，重置T1和T2计时器，并过渡回BOUND状态。当客户端续租时，它不需要进行ARP
    IP地址检查。
- en: If the client receives a DHCPNAK message, which tells it its lease renewal request
    has been denied, it will immediately transition to the INIT state to get a new
    lease (step 1 in the allocation process).
  id: totrans-536
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果客户端收到DHCPNAK消息，告知其续租请求已被拒绝，它将立即过渡到INIT状态以获取新的租约（分配过程中的第1步）。
- en: '**Rebinding Timer (T2) Expires**'
  id: totrans-537
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**重新绑定计时器（T2）到期**'
- en: If the client receives no reply from the server, it will remain in the RENEWING
    state and will regularly retransmit the unicast DHCPREQUEST to the server. During
    this period, the client is still operating normally, from the perspective of its
    user. If no response from the server is received, eventually the rebinding timer
    (T2) expires. This will cause the client to transition to the REBINDING state.
    Recall that by default, the T2 timer is set to 87.5 percent (seven-eighths) of
    the length of the lease.
  id: totrans-538
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果客户端没有收到服务器的回复，它将保持在RENEWING状态，并定期重新发送单播DHCPREQUEST到服务器。在此期间，从其用户的角度来看，客户端仍在正常操作。如果没有收到服务器的响应，最终重新绑定计时器（T2）到期。这将导致客户端过渡到REBINDING状态。回想一下，默认情况下，T2计时器设置为租约长度的87.5%（七分之八）。
- en: '**Client Sends DHCPREQUEST Rebinding Message**'
  id: totrans-539
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端发送DHCPREQUEST重新绑定消息**'
- en: Having received no response from the server that initially granted the lease,
    the client gives up on that server and tries to contact any server that may be
    able to extend its existing lease. It creates a DHCPREQUEST message and puts its
    IP address in the CIAddr field, indicating clearly that it presently owns that
    address. It then broadcasts the request on the local network.
  id: totrans-540
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 由于没有收到最初授予租约的服务器的响应，客户端放弃该服务器并尝试联系任何可能能够延长其现有租约的服务器。它创建一个DHCPREQUEST消息并将其IP地址放入CIAddr字段，清楚地表明它目前拥有该地址。然后，它在本地网络上广播请求。
- en: '**Servers Receive and Process DHCPREQUEST Message and Send Reply**'
  id: totrans-541
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**服务器接收并处理DHCPREQUEST消息并发送回复**'
- en: 'Each server receives the request and responds according to the information
    it has for the client (a server that has no information about the lease or may
    have outdated information does not respond):'
  id: totrans-542
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 每个服务器都会接收到请求并根据它对客户端的信息（没有关于租约信息或可能有过时信息的服务器不会响应）进行响应：
- en: A server may agree to rebind the client's lease. This happens when the server
    has information about the client's lease and can extend it. It prepares for the
    client a DHCPACK message to confirm the lease's renewal, indicating any parameters
    that may have changed since the lease was created or last renewed.
  id: totrans-543
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器可能会同意重新绑定客户端的租约。这种情况发生在服务器有关于客户端租约的信息并能将其延长时。服务器为客户端准备一个DHCPACK消息以确认租约的续订，并指示自租约创建或上次续订以来可能发生变化的任何参数。
- en: A server may decide that the client cannot extend its current lease. This occurs
    when the server determines that, for whatever reason, this client's lease should
    not be extended. It gets ready to send back to the client a DHCPNAK message.
  id: totrans-544
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 服务器可能会决定客户端不能延长其当前的租约。这种情况发生在服务器确定，无论什么原因，这个客户端的租约不应延长。它准备向客户端发送一个DHCPNAK消息。
- en: '**Server Sends Reply**'
  id: totrans-545
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**服务器发送回复**'
- en: Each server that is responding to the client sends its DHCPACK or DHCPNAK message.
  id: totrans-546
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 每个响应客户端的服务器都会发送其DHCPACK或DHCPNAK消息。
- en: '**Client Receives Server Reply**'
  id: totrans-547
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端接收服务器回复**'
- en: 'The client takes the appropriate action in response to the two possibilities
    in the preceding step:'
  id: totrans-548
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 客户端会根据前一步中的两种可能性采取适当的行动：
- en: The client receives a DHCPACK message, rebinding the lease. The client makes
    note of the server that is now in charge of this lease, the new lease expiration
    time, and any changed parameters sent by the server. It resets the T1 and T2 timers,
    and transitions back to the BOUND state. (It may also probe the new address as
    it does during regular lease allocation.)
  id: totrans-549
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户端收到一个DHCPACK消息，重新绑定租约。客户端会记录现在负责此租约的服务器、新的租约到期时间以及服务器发送的任何更改参数。它重置T1和T2计时器，并过渡回BOUND状态。（它也可能像在常规租约分配期间那样探测新地址。）
- en: The client receives a DHCPNAK message, which tells it that some server has determined
    that the lease should not be extended. The client immediately transitions to the
    INIT state to get a new lease (step 1 in the allocation process).
  id: totrans-550
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户端收到一个DHCPNAK消息，告知它某个服务器已确定租约不应延长。客户端立即过渡到INIT状态以获取新的租约（分配过程中的第1步）。
- en: '**Lease Expires**'
  id: totrans-551
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**租约到期**'
- en: If the client receives no response to its broadcast rebinding request, it will,
    as in the RENEWING state, retransmit the request regularly. If no response is
    received by the time the lease expires, it transitions to the INIT state to get
    a new lease.
  id: totrans-552
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果客户端对其广播重新绑定请求没有收到任何响应，它将像在RENEWING状态中一样，定期重新发送请求。如果在租约到期之前没有收到任何响应，它将过渡到INIT状态以获取新的租约。
- en: 'So, why bother with a two-step process: rebinding and renewal? The reason is
    that this provides the best blend of efficiency and flexibility. We first try
    to contact the server that granted the lease using a unicast request, to avoid
    taking up the time of other DHCP servers and disrupting the network as a whole
    with broadcast traffic. Usually this will work, because DHCP servers don''t change
    that often and are usually left on continuously. If that fails, we then fall back
    on the broadcast, giving other servers a chance to take over the client''s existing
    lease.'
  id: totrans-553
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，为什么要进行两步过程：重新绑定和续订？原因是这提供了最佳效率和灵活性的结合。我们首先尝试使用单播请求联系授予租约的服务器，以避免占用其他DHCP服务器的时间，并避免广播流量破坏整个网络。通常这会成功，因为DHCP服务器不经常改变，并且通常持续开启。如果失败，我们就会回退到广播，给其他服务器一个接管客户端现有租约的机会。
- en: Tip
  id: totrans-554
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** Each client''s lease has associated with it a *renewal timer
    (T1)*, normally set to 50 percent of the length of the lease, and a *rebinding
    timer (T2)*, usually set to 87.5 percent of the lease length. When the T1 timer
    goes off, the client will try to renew its lease by contacting the server that
    originally granted it. If the client cannot renew the lease by the time the T2
    timer expires, it will broadcast a rebinding request to any available server.
    If the lease is not renewed or rebound by the time the lease expires, the client
    must start the lease allocation process over again.'
  id: totrans-555
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** 每个客户端的租约都与一个 *续租计时器（T1）* 相关联，通常设置为租约长度的50%，以及一个 *重新绑定计时器（T2）*，通常设置为租约长度的87.5%。当T1计时器到期时，客户端将尝试通过联系最初授予其租约的服务器来续租其租约。如果客户端在T2计时器到期之前无法续租租约，它将向任何可用的服务器广播一个重新绑定请求。如果在租约到期之前租约没有被续租或重新绑定，客户端必须重新开始租约分配过程。'
- en: DHCP Early Lease Termination (Release) Process
  id: totrans-556
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP早期租约终止（释放）过程
- en: A TCP/IP host can't really do much without an IP address; it's a fundamental
    component of the Internet Protocol (IP), on which all TCP/IP protocols and applications
    run. When a host has either a manual IP address assignment or an infinite lease,
    it obviously never needs to worry about losing its IP address. When a host has
    a finite DHCP lease, it will use the renewal/rebinding process to try to hang
    on to its existing IP address as long as possible.
  id: totrans-557
  prefs: []
  type: TYPE_NORMAL
  zh: 一个TCP/IP主机没有IP地址就无法真正做很多事情；它是互联网协议（IP）的基本组成部分，所有TCP/IP协议和应用程序都在其上运行。当一个主机具有手动IP地址分配或无限租约时，显然它永远不需要担心失去其IP地址。当一个主机具有有限的DHCP租约时，它将通过续租/重新绑定过程尝试尽可能长时间地保留其现有的IP地址。
- en: '![DHCP lease renewal and rebinding processes This diagram shows the example
    of a client presently holding a lease with Server 2 attempting to contact it to
    renew the lease. However, in this case, Server 2 is down for maintenance. The
    server is unable to respond, and the client remains stuck at step 2 in the renewal/rebinding
    process. It keeps sending DHCPREQUEST messages to Server 2 until its T2 timer
    expires. It then enters the rebinding state and broadcasts a DHCPREQUEST message,
    which is heard by Server 1, which agrees to extend its current lease.](httpatomoreillycomsourcenostarchimages288215.png.jpg)'
  id: totrans-558
  prefs: []
  type: TYPE_IMG
  zh: '![DHCP租约续租和重新绑定过程 此图展示了当前持有Server 2租约的客户端正在尝试联系它以续租租约的示例。然而，在这种情况下，Server 2因维护而关闭。服务器无法响应，客户端在续租/重新绑定过程的第二步卡住。它继续向Server
    2发送DHCPREQUEST消息，直到其T2计时器到期。然后它进入重新绑定状态并广播一个DHCPREQUEST消息，该消息被Server 1听到，Server
    1同意延长其当前的租约。](http://atomoreilly.com/source/nostarch/images/288215.png.jpg)'
- en: Figure 62-4. DHCP lease renewal and rebinding processes This diagram shows the
    example of a client presently holding a lease with Server 2 attempting to contact
    it to renew the lease. However, in this case, Server 2 is down for maintenance.
    The server is unable to respond, and the client remains stuck at step 2 in the
    renewal/rebinding process. It keeps sending DHCPREQUEST messages to Server 2 until
    its T2 timer expires. It then enters the rebinding state and broadcasts a DHCPREQUEST
    message, which is heard by Server 1, which agrees to extend its current lease.
  id: totrans-559
  prefs: []
  type: TYPE_NORMAL
  zh: 图62-4. DHCP租约续租和重新绑定过程 此图展示了当前持有Server 2租约的客户端正在尝试联系它以续租租约的示例。然而，在这种情况下，Server
    2因维护而关闭。服务器无法响应，客户端在续租/重新绑定过程的第二步卡住。它继续向Server 2发送DHCPREQUEST消息，直到其T2计时器到期。然后它进入重新绑定状态并广播一个DHCPREQUEST消息，该消息被Server
    1听到，Server 1同意延长其当前的租约。
- en: 'So, under normal circumstances, a client will continue trying to extend its
    existing lease indefinitely. In certain cases, however, a host may decide to terminate
    its lease. This usually will not be something the client just decides to do spontaneously.
    It will occur in response to a specific request from the user to end the lease.
    A user may terminate a lease for a number of reasons, including the following:'
  id: totrans-560
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，在正常情况下，客户端将继续无限期地尝试延长其现有的租约。然而，在某些情况下，主机可能会决定终止其租约。这通常不会是客户端自发决定的事情。它将是对用户结束租约的具体请求的响应。用户可能出于以下原因之一终止租约：
- en: The client is being moved to a different network.
  id: totrans-561
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户端正在被移动到不同的网络。
- en: The network is having its IP addresses renumbered.
  id: totrans-562
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络正在重新编号其IP地址。
- en: The user wants the host to negotiate a new lease with a different server.
  id: totrans-563
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户希望主机与不同的服务器协商一个新的租约。
- en: The user wants to reset the lease to fix some sort of a problem.
  id: totrans-564
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 用户希望重置租约以修复某种问题。
- en: In any of these cases, the user can end the lease through a process called *early
    lease termination* or *lease release*. This is a very simple, unidirectional communication.
    The client sends a special DHCPRELEASE message unicast to the server that holds
    its current lease, to tell it that the lease is no longer required. The server
    then records the lease as having been ended. It does not need to reply back to
    the client.
  id: totrans-565
  prefs: []
  type: TYPE_NORMAL
  zh: 在任何这些情况下，用户都可以通过称为*早期租约终止*或*租约释放*的过程来结束租约。这是一个非常简单、单向的通信。客户端向持有其当前租约的服务器发送一个特殊的DHCPRELEASE消息单播，告知它租约不再需要。然后服务器将租约记录为已结束。它不需要向客户端回复。
- en: The reason that the client can just assume that the lease termination has been
    successful is that this is not a mandatory part of the DHCP protocol. Having clients
    send DHCPRELEASE to end a lease is considered a courtesy, rather than a requirement.
    It is more efficient to have clients inform servers when they no longer need a
    lease, and this also allows the IP address in the terminated lease to be reused
    more quickly. However, DHCP servers are designed to handle the case where a client
    seemingly disappears without formally ending an existing lease.
  id: totrans-566
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端之所以可以假设租约终止已成功，是因为这并不是DHCP协议的强制部分。让客户端发送DHCPRELEASE来结束租约被视为一种礼貌，而不是要求。当客户端通知服务器它们不再需要租约时，这更加高效，这也使得在终止的租约中的IP地址能够更快地被重用。然而，DHCP服务器被设计来处理客户端看似消失而没有正式结束现有租约的情况。
- en: DHCP Parameter Configuration Process for Clients with Non-DHCP Addresses
  id: totrans-567
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 非DHCP地址客户端的DHCP参数配置过程
- en: The majority of DHCP clients make use of the protocol to obtain both an IP address
    and other configuration parameters. This is the reason why so much of DHCP is
    oriented around address assignment and leasing. A conventional DHCP client obtains
    all its configuration parameters at the same time it gets an IP address, using
    the message exchanges and processes described in the preceding sections of this
    chapter.
  id: totrans-568
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数DHCP客户端都使用该协议来获取IP地址和其他配置参数。这就是为什么DHCP的大部分内容都围绕地址分配和租赁的原因。传统的DHCP客户端在获取IP地址的同时，使用本章前面各节中描述的消息交换和过程获取所有配置参数。
- en: There are cases where a device with an IP address assigned using a method other
    than DHCP still wants to use DHCP servers to obtain other configuration parameters.
    The main advantage of this is administrative convenience; it allows a device with
    a static IP address to still be able to automatically get other parameters the
    same way that regular DHCP clients do.
  id: totrans-569
  prefs: []
  type: TYPE_NORMAL
  zh: 有一些情况下，使用除DHCP之外的方法分配IP地址的设备仍然希望使用DHCP服务器来获取其他配置参数。这样做的主要优势是管理方便；它允许具有静态IP地址的设备仍然能够以与常规DHCP客户端相同的方式自动获取其他参数。
- en: Ironically, one common case where this capability can be used is in configuring
    DHCP servers themselves! Administrators normally do not use DHCP to provide an
    IP address to a DHCP server, but they may want to use it to tell the server other
    parameters. In this case, the server requesting the parameters actually acts as
    a client for the purpose of the exchange with another server.
  id: totrans-570
  prefs: []
  type: TYPE_NORMAL
  zh: 具有讽刺意味的是，这种能力可以使用的常见情况之一是配置DHCP服务器本身！管理员通常不使用DHCP为DHCP服务器提供IP地址，但他们可能希望用它来告知服务器其他参数。在这种情况下，请求参数的服务器实际上在与其他服务器交换时充当客户端。
- en: The original DHCP standard did not provide any mechanism for this sort of non-IP
    configuration to take place. RFC 2131 revised the protocol, adding a new message
    type (DHCPINFORM) that allows a device to request configuration parameters without
    going through the full leasing process. This message is used as part of a simple
    bidirectional communication that is separate from the leasing communications we
    have looked at so far. Since it doesn't involve IP address assignment, it is not
    part of the lease life cycle, nor is it part of the DHCP client FSM.
  id: totrans-571
  prefs: []
  type: TYPE_NORMAL
  zh: 原始的DHCP标准没有提供任何机制来实现这种非IP配置。RFC 2131修订了协议，增加了一种新的消息类型（DHCPINFORM），允许设备在无需经过完整的租赁过程的情况下请求配置参数。此消息用作与之前我们查看的租赁通信分开的简单双向通信的一部分。由于它不涉及IP地址分配，因此它不是租赁生命周期的一部分，也不是DHCP客户端FSM的一部分。
- en: 'The following steps show how a device with an externally configured address
    uses DHCP to get other parameters (see [Figure 62-5](ch62s05.html#dhcp_parameter_configuration_process_a_d
    "Figure 62-5. DHCP parameter configuration process A device that already has an
    IP address can use the simple request/reply exchange shown in this figure to get
    other configuration parameters from a DHCP server. In this case, the client is
    broadcasting its request.")):'
  id: totrans-572
  prefs: []
  type: TYPE_NORMAL
  zh: 以下步骤展示了具有外部配置地址的设备如何使用DHCP获取其他参数（参见[图62-5](ch62s05.html#dhcp_parameter_configuration_process_a_d
    "图62-5. DHCP参数配置过程 已拥有IP地址的设备可以使用此图所示的简单请求/回复交换从DHCP服务器获取其他配置参数。在这种情况下，客户端正在广播其请求。"））：
- en: '**Client Creates DHCPINFORM Message**'
  id: totrans-573
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端创建DHCPINFORM消息**'
- en: The client (which may be a DHCP server acting as a client) creates a DHCPINFORM
    message. It fills in its own IP address in the CIAddr field, since that IP address
    is current and valid. It may request specific parameters using the Parameter Request
    List option or simply accept the defaults provided by the server.
  id: totrans-574
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 客户端（可能是充当客户端的DHCP服务器）创建一个DHCPINFORM消息。它在CIAddr字段中填写自己的IP地址，因为该IP地址是当前有效的。它可以使用参数请求列表选项请求特定的参数，或者简单地接受服务器提供的默认参数。
- en: '**Client Sends DHCPINFORM Message**'
  id: totrans-575
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端发送DHCPINFORM消息**'
- en: The client sends the DHCPINFORM message unicast, if it knows the identity and
    address of a DHCP server; otherwise, it broadcasts it.
  id: totrans-576
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果客户端知道DHCP服务器的身份和地址，它将单播发送DHCPINFORM消息；否则，它将广播发送。
- en: '**Server Receives and Processes DHCPINFORM Message**'
  id: totrans-577
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**服务器接收并处理DHCPINFORM消息**'
- en: The message is received and processed by the DHCP server or servers (if there
    are multiple servers and the request was broadcast). Each server checks to see
    if it has the parameters needed by the client in its database.
  id: totrans-578
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 消息被DHCP服务器或服务器（如果有多个服务器且请求是广播的）接收和处理。每个服务器检查其数据库中是否包含客户端所需的参数。
- en: '**Server Creates DHCPACK Message**'
  id: totrans-579
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**服务器创建DHCPACK消息**'
- en: Each server that has the information the client needs creates a DHCPACK message,
    which includes the needed parameters in the appropriate DHCP option fields. (Often,
    this will be only a single server.)
  id: totrans-580
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 每个拥有客户端所需信息的服务器都会创建一个DHCPACK消息，其中包含适当的DHCP选项字段中的所需参数。（通常，这将是单个服务器。）
- en: '**Server Sends DHCPACK Message**'
  id: totrans-581
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**服务器发送DHCPACK消息**'
- en: The server sends the message unicast back to the client.
  id: totrans-582
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 服务器将消息单播回客户端。
- en: '**Client Receives and Processes DHCPACK Message**'
  id: totrans-583
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**客户端接收并处理DHCPACK消息**'
- en: The client receives the DHCPACK message sent by the server, processes it, and
    sets its parameters accordingly.
  id: totrans-584
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 客户端接收由服务器发送的DHCPACK消息，对其进行处理，并相应地设置其参数。
- en: '![DHCP parameter configuration process A device that already has an IP address
    can use the simple request/reply exchange shown in this figure to get other configuration
    parameters from a DHCP server. In this case, the client is broadcasting its request.](httpatomoreillycomsourcenostarchimages288217.png.jpg)'
  id: totrans-585
  prefs: []
  type: TYPE_IMG
  zh: '![DHCP参数配置过程 已拥有IP地址的设备可以使用此图所示的简单请求/回复交换从DHCP服务器获取其他配置参数。在这种情况下，客户端正在广播其请求。](httpatomoreillycomsourcenostarchimages288217.png.jpg)'
- en: Figure 62-5. DHCP parameter configuration process A device that already has
    an IP address can use the simple request/reply exchange shown in this figure to
    get other configuration parameters from a DHCP server. In this case, the client
    is broadcasting its request.
  id: totrans-586
  prefs: []
  type: TYPE_NORMAL
  zh: 图62-5. DHCP参数配置过程 已拥有IP地址的设备可以使用此图所示的简单请求/回复交换从DHCP服务器获取其他配置参数。在这种情况下，客户端正在广播其请求。
- en: If a client receives no reply to its DHCPINFORM message, it will retransmit
    it periodically. After a retry period, it will give up and use default configuration
    values. It will also typically generate an error report to inform an administrator
    or user of the problem.
  id: totrans-587
  prefs: []
  type: TYPE_NORMAL
  zh: 如果客户端未收到对它的DHCPINFORM消息的回复，它将定期重新发送。在重试期过后，它将放弃并使用默认配置值。它通常还会生成一个错误报告，通知管理员或用户问题所在。
- en: Tip
  id: totrans-588
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 提示
- en: '**KEY CONCEPT** Devices that are not using DHCP to acquire IP addresses can
    still use its other configuration capabilities. A client can broadcast a *DHCPINFORM*
    message to request that any available server send it parameters for how the network
    is to be used. DHCP servers respond with the requested parameters and/or default
    parameters, carried in DHCP options of a *DHCPACK* message.'
  id: totrans-589
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** 不使用DHCP获取IP地址的设备仍然可以使用其其他配置功能。客户端可以广播一个*DHCPINFORM*消息，请求任何可用的服务器发送有关如何使用网络的参数。DHCP服务器通过DHCPACK消息的DHCP选项响应请求的参数和/或默认参数。'
- en: Chapter 63. DHCP MESSAGING, MESSAGE TYPES, AND FORMATS
  id: totrans-590
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第63章. DHCP 消息、消息类型和格式
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages287681.png.jpg)'
  id: totrans-591
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages287681.png.jpg)'
- en: The preceding chapter on DHCP configuration and operation demonstrated how DHCP
    works by showing the various leasing and information-exchange processes. All of
    these procedures rely heavily on the exchange of information between the client
    and server, which is accomplished through DHCP *messages*. Like all protocols,
    DHCP uses a special message format and a set of rules that govern how messages
    are created, addressed, and transported.
  id: totrans-592
  prefs: []
  type: TYPE_NORMAL
  zh: 前一章关于DHCP配置和操作的章节通过展示各种租约和信息交换过程来演示了DHCP是如何工作的。所有这些过程都高度依赖于客户端和服务器之间的信息交换，这是通过DHCP
    *消息*来实现的。像所有协议一样，DHCP使用一种特殊的消息格式和一套规则来规范消息的创建、寻址和传输。
- en: In this chapter, I provide the details of how DHCP creates and sends messages,
    and show the formats used for DHCP messages and options. I begin with a description
    of how DHCP creates, addresses, and transports messages, and how it deals with
    message retransmission. I then outline the DHCP general message format, showing
    how it is similar to the BOOTP message format on which it is based and also where
    it differs. I describe DHCP options, the format used for them, and the special
    option overloading feature used for efficiency. I conclude the section with a
    complete list of DHCP options.
  id: totrans-593
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我提供了DHCP创建和发送消息的详细情况，并展示了DHCP消息和选项使用的格式。我首先描述了DHCP如何创建、寻址和传输消息，以及如何处理消息重传。然后，我概述了DHCP的一般消息格式，展示了它与基于其的BOOTP消息格式的相似之处以及差异之处。我描述了DHCP选项，它们使用的格式，以及用于提高效率的特殊选项过载功能。最后，我给出了DHCP选项的完整列表。
- en: Tip
  id: totrans-594
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**RELATED INFORMATION** *DHCP is most closely related to BOOTP in the area
    of messaging. DHCP options are based closely on BOOTP vendor extensions (see [Chapter 60](ch60.html
    "Chapter 60. TCP/IP BOOTSTRAP PROTOCOL (BOOTP)")), and many of the specific DHCP
    option types are the same as BOOTP vendor information fields. To avoid duplication,
    the summary table in this chapter lists the options/extensions for both protocols,
    indicating which ones are used by both BOOTP and DHCP, and which are used only
    by DHCP*.'
  id: totrans-595
  prefs: []
  type: TYPE_NORMAL
  zh: '**相关信息** *DHCP在消息方面与BOOTP最为接近。DHCP选项紧密基于BOOTP供应商扩展（见[第60章](ch60.html "第60章.
    TCP/IP 引导协议 (BOOTP)"))，许多具体的DHCP选项类型与BOOTP供应商信息字段相同。为了避免重复，本章的总结表中列出了两种协议的选项/扩展，指出了哪些选项/扩展同时被BOOTP和DHCP使用，以及哪些仅由DHCP使用*。'
- en: DHCP Message Generation, Addressing, Transport, and Retransmission
  id: totrans-596
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP消息生成、寻址、传输和重传
- en: As you've learned, nearly every aspect of DHCP's operation is oriented around
    the notion of a client device exchanging information with a server. You can also
    see this reflected in all of the major characteristics of DHCP messaging. This
    includes the format of DHCP messages, as well as the specifics of how DHCP messages
    are created, addressed, and transmitted, and when necessary, retransmitted.
  id: totrans-597
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所学的，DHCP的几乎所有操作都是围绕客户端设备与服务器交换信息这一概念展开的。你还可以在DHCP消息的所有主要特性中看到这一点。这包括DHCP消息的格式，以及DHCP消息是如何创建、寻址、传输，以及在必要时重新传输的具体细节。
- en: Message Generation and General Formatting
  id: totrans-598
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 消息生成和一般格式
- en: 'DHCP messaging is similar in many ways to that of BOOTP, the protocol on which
    DHCP was based. BOOTP defined only two message types: a request and a reply. DHCP
    is much more complex. It uses eight different types of messages, but these are
    still categorized as either request or reply messages, depending on who sends
    them and why. DHCP uses a special DHCP Message Type option to indicate the exact
    DHCP message type, but still treats a message from a client seeking information
    as a request, and a response from a server containing information as a reply.'
  id: totrans-599
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP消息在许多方面与基于其的BOOTP协议相似。BOOTP定义了两种消息类型：请求和回复。DHCP要复杂得多。它使用八种不同类型的消息，但这些消息仍然根据发送者和发送原因被分类为请求或回复消息。DHCP使用特殊的DHCP消息类型选项来指示确切的DHCP消息类型，但仍然将客户端寻求信息的消息视为请求，将服务器包含信息的回复视为回复。
- en: A client generates a message using the general DHCP message format, which is
    very similar to the BOOTP message format. When a server replies to a client message,
    it does not generate the reply as a completely new message, but rather copies
    the client request, changes fields as appropriate, and sends the reply back to
    the client. A special transaction identifier (XID) is placed in the request and
    maintained in the reply, which allows a client to know which reply goes with a
    particular request.
  id: totrans-600
  prefs: []
  type: TYPE_NORMAL
  zh: 客户端使用通用的 DHCP 消息格式生成消息，该格式与 BOOTP 消息格式非常相似。当服务器回复客户端消息时，它不会生成一个全新的回复，而是复制客户端请求，根据需要更改字段，并将回复发送回客户端。在请求中放置一个特殊的交易标识符（XID），并在回复中保持不变，这允许客户端知道哪个回复与特定的请求相对应。
- en: Message Transport
  id: totrans-601
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 消息传输
- en: 'DHCP uses the User Datagram Protocol (UDP) for transport, just as BOOTP does,
    and for the same reasons: simplicity and support for broadcasts. It also has many
    of the same addressing concerns as BOOTP, as discussed in [Chapter 60](ch60.html
    "Chapter 60. TCP/IP BOOTSTRAP PROTOCOL (BOOTP)"). Clients usually will send requests
    by broadcast on the local network, to allow them to contact any available DHCP
    server. The exception to this is when a client is trying to renew a lease with
    a server that it already knows. For compatibility with BOOTP, DHCP uses the same
    well-known (reserved) UDP port number, 67, for client requests to servers.'
  id: totrans-602
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP 使用用户数据报协议（UDP）进行传输，正如 BOOTP 所做的那样，出于相同的原因：简单性和支持广播。它也像 BOOTP 一样有许多相同的寻址问题，如[第
    60 章](ch60.html "第 60 章。TCP/IP 引导协议 (BOOTP)")中所述。客户端通常会在本地网络上通过广播发送请求，以便它们可以联系任何可用的
    DHCP 服务器。例外情况是当客户端试图与它已经知道的某个服务器续订租约时。为了与 BOOTP 兼容，DHCP 使用相同的知名（保留）UDP 端口号 67，用于客户端向服务器发送请求。
- en: 'Some DHCP message exchanges require a server to respond back to a client that
    has a valid and active IP address. An example is a DHCPACK message sent in reply
    to a DHCPINFORM request. In this situation, the server can always send a reply
    unicast back to the client. Other message exchanges, however, present the same
    chicken-and-egg conundrum that we saw with BOOTP: If a client is using DHCP to
    obtain an IP address, we can''t assume that IP address is available for us to
    use to send a reply.'
  id: totrans-603
  prefs: []
  type: TYPE_NORMAL
  zh: 一些 DHCP 消息交换需要服务器向具有有效和活动 IP 地址的客户端进行响应。一个例子是作为对 DHCPINFORM 请求的响应发送的 DHCPACK
    消息。在这种情况下，服务器可以始终向客户端发送单播回复。然而，其他消息交换却出现了我们在 BOOTP 中看到的相同的“先有鸡还是先有蛋”的困境：如果客户端正在使用
    DHCP 获取 IP 地址，我们不能假设该 IP 地址可供我们使用来发送回复。
- en: 'In BOOTP, there were two possible solutions to this situation: The server could
    send back its reply using broadcast addressing as well, or the server could send
    back a reply directly to the host at layer 2\. Due to the performance problems
    associated with broadcasts, DHCP tries to make the latter method the default for
    server replies. It assumes that a client''s TCP/IP software will be capable of
    accepting and processing an IP datagram delivered at layer 2, even before the
    IP stack is initialized.'
  id: totrans-604
  prefs: []
  type: TYPE_NORMAL
  zh: 在 BOOTP 中，对此情况有两种可能的解决方案：服务器可以使用广播寻址发送回复，或者服务器可以直接在第二层向主机发送回复。由于广播相关的性能问题，DHCP
    尝试将后一种方法作为服务器回复的默认方法。它假设客户端的 TCP/IP 软件将能够接受和处理在第二层交付的 IP 数据报，即使在 IP 栈初始化之前也是如此。
- en: As the standard itself puts it, "DHCP requires creative use of the client's
    TCP/IP software and liberal interpretation of RFC 1122." RFC 1122 is a key standard
    describing the detailed implementation requirements of TCP/IP hosts. The DHCP
    standard, however, acknowledges the fact that not all devices may support this
    behavior. It allows a client to force servers to send back replies using broadcasts
    instead. This is done by the client setting the special Broadcast (B) flag to
    1 in its request.
  id: totrans-605
  prefs: []
  type: TYPE_NORMAL
  zh: 正如标准本身所说，“DHCP 需要创造性地使用客户端的 TCP/IP 软件，并对 RFC 1122 进行自由解释。”RFC 1122 是一个关键标准，描述了
    TCP/IP 主机的详细实现要求。然而，DHCP 标准承认并非所有设备都可能支持这种行为。它允许客户端强制服务器使用广播发送回复。这是通过客户端在其请求中将特殊的广播（B）标志设置为
    1 来实现的。
- en: Since DHCP, like BOOTP, must use either layer 2 delivery or layer 3 broadcasts
    for server replies, it requires a separate well-known port number for servers
    to send to. Again, for compatibility with BOOTP, the same port number is used,
    68\. This port number is used whether a server reply is sent unicast or broadcast.
  id: totrans-606
  prefs: []
  type: TYPE_NORMAL
  zh: 由于 DHCP，就像 BOOTP 一样，必须使用第 2 层交付或第 3 层广播来发送服务器响应，因此它需要一个单独的知名端口号，以便服务器发送。同样，为了与
    BOOTP 兼容，使用相同的端口号 68。无论服务器响应是单播还是广播，都使用此端口号。
- en: Tip
  id: totrans-607
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** Requests from BOOTP clients are normally sent broadcast, to
    reach any available DHCP server. However, there are certain exceptions, such as
    in lease renewal, when a request is sent directly to a known server. DHCP servers
    can send their replies either broadcast to the special port number reserved for
    DHCP clients or unicast using layer 2\. The DHCP standards specify that layer
    2 delivery should be used when possible to avoid unnecessary broadcast traffic.'
  id: totrans-608
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** 从BOOTP客户端发出的请求通常以广播方式发送，以到达任何可用的DHCP服务器。然而，有一些例外，例如在续租时，请求会直接发送到已知的服务器。DHCP服务器可以通过广播到为DHCP客户端保留的特殊端口号或使用层2进行单播来发送其响应。DHCP标准规定，在可能的情况下应使用层2交付以避免不必要的广播流量。'
- en: Retransmission of Lost Messages
  id: totrans-609
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 丢失消息的重传
- en: Using UDP provides benefits such as simplicity and efficiency to DHCP, but since
    UDP is unreliable, there is no guarantee that messages will get to their destination.
    This can lead to potential confusion on the part of a client. Consider, for example,
    a client sending a DHCPDISCOVER message and waiting for DHCPOFFER messages in
    reply. If it gets no response, does this mean that there is no DHCP server willing
    to offer it service or simply that its DHCPDISCOVER got lost somewhere on the
    network? The same applies to most other request/reply sequences, such as a client
    waiting for a DHCPACK or DHCPNAK message in reply to a DHCPREQUEST or DHCPINFORM
    message.
  id: totrans-610
  prefs: []
  type: TYPE_NORMAL
  zh: 使用UDP为DHCP提供了诸如简单性和效率等好处，但由于UDP不可靠，无法保证消息能够到达目的地。这可能导致客户端产生潜在的困惑。例如，考虑一个客户端发送DHCPDISCOVER消息并等待DHCPOFFER响应的情况。如果它没有收到任何响应，这难道意味着没有DHCP服务器愿意提供服务，或者只是它的DHCPDISCOVER在网络上某处丢失了？这种情况同样适用于大多数其他请求/响应序列，例如客户端等待DHCPREQUEST或DHCPINFORM消息的DHCPACK或DHCPNAK响应。
- en: The fact that messages can be lost means that DHCP itself must keep track of
    messages sent, and if there is no response, retransmit them. Since there are so
    many message exchanges in DHCP, there is much that can go wrong. As in BOOTP,
    DHCP puts responsibility for this squarely on the shoulders of the client. This
    makes sense, since the client initiates contact and can most easily keep track
    of messages sent and retransmit them when needed. A server can't know when a client's
    request is lost, but a client can react when it doesn't receive a reply from the
    server.
  id: totrans-611
  prefs: []
  type: TYPE_NORMAL
  zh: 消息可能丢失的事实意味着DHCP本身必须跟踪发送的消息，并在没有响应时重新发送它们。由于DHCP中有许多消息交换，因此可能出现很多问题。与BOOTP一样，DHCP将责任明确地放在客户端身上。这是有道理的，因为客户端是发起联系的一方，并且最容易跟踪发送的消息，并在需要时重新发送它们。服务器无法知道客户端的请求何时丢失，但客户端可以在没有收到服务器的回复时做出反应。
- en: In any request/reply message exchange, the client uses a retransmission timer
    that is set to a period of time that represents how long it is reasonable for
    it to wait for a response. If no reply is received by the time the timer expires,
    the client assumes that either its request or the response coming back was lost.
    The client then retransmits the request. If this request again elicits no reply,
    the client will continue retransmitting for a period of time.
  id: totrans-612
  prefs: []
  type: TYPE_NORMAL
  zh: 在任何请求/响应消息交换中，客户端使用一个重传计时器，该计时器设置为一段时间，表示它合理等待响应的时间。如果在计时器到期之前没有收到回复，客户端会假设其请求或返回的响应已丢失。然后客户端重新发送请求。如果这个请求再次没有引起回复，客户端将继续在一定时间内重传。
- en: To prevent large numbers of DHCP clients from retransmitting requests simultaneously
    (which would potentially clog the network), the client must use a randomized exponential
    backoff algorithm to determine when exactly a retransmission is made. As in BOOTP,
    this is similar to the technique used to recover from collisions in Ethernet.
    The DHCP standard specifies that the delay should be based on the speed of the
    underlying network between the client and the server. More specifically, it says
    that in a standard Ethernet network, the first retransmission should be delayed
    4 seconds plus or minus a random value from 0 to 1 second; in other words, some
    value is chosen between 3 and 5 seconds. The delay is then doubled with each subsequent
    transmission (7 to 9 seconds, then 15 to 17 seconds, and so forth) up to a maximum
    of 64 +/– 1 second.
  id: totrans-613
  prefs: []
  type: TYPE_NORMAL
  zh: 为了防止大量的DHCP客户端同时重传请求（这可能会阻塞网络），客户端必须使用随机指数退避算法来确定何时进行重传。与BOOTP一样，这类似于在以太网中恢复碰撞的技术。DHCP标准指定延迟应基于客户端和服务器之间底层网络的速度。更具体地说，它表示在标准以太网网络中，第一次重传应延迟4秒加减0到1秒的随机值；换句话说，选择介于3到5秒之间的某个值。然后，随后的每次传输延迟加倍（7到9秒，然后15到17秒，以此类推），直到最大64
    +/– 1秒。
- en: To prevent it from retrying endlessly, the client normally has logic that limits
    the number of retries. The amount of time that retransmissions go on depends on
    the type of request being sent; that is, what process is being undertaken. If
    a client is forced to give up due to too many retries, it will generally either
    take some sort of default action or generate an error message.
  id: totrans-614
  prefs: []
  type: TYPE_NORMAL
  zh: 为了防止客户端无限重试，客户端通常具有限制重试次数的逻辑。重传的时间取决于发送请求的类型；也就是说，正在进行什么过程。如果客户端因为重试次数过多而被迫放弃，它通常会采取某种默认操作或生成错误消息。
- en: Tip
  id: totrans-615
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** Like BOOTP, DHCP uses UDP for transport, which does not provide
    any reliability features. DHCP clients must detect when requests are sent and
    no response is received, and retransmit requests periodically. Special logic is
    used to prevent clients from sending excessive numbers of requests during difficult
    network conditions.'
  id: totrans-616
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** 与BOOTP一样，DHCP使用UDP进行传输，这并不提供任何可靠性功能。DHCP客户端必须检测到发送请求但没有收到响应的情况，并定期重新发送请求。使用特殊逻辑来防止客户端在网络条件困难时发送过多的请求。'
- en: DHCP Message Format
  id: totrans-617
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP消息格式
- en: When DHCP was created, its developers had a bit of an issue related to how exactly
    they should structure DHCP messages. BOOTP was already widely used, and maintaining
    compatibility between DHCP and BOOTP was an important goal. This meant that DHCP's
    designers needed to continue using the existing BOOTP message format. However,
    DHCP has more functionality than BOOTP, and this means that it can hold more information
    than can easily fit in the limited BOOTP message format.
  id: totrans-618
  prefs: []
  type: TYPE_NORMAL
  zh: 当DHCP被创建时，其开发者遇到了一些关于如何确切地构建DHCP消息的问题。BOOTP已经被广泛使用，保持DHCP与BOOTP的兼容性是一个重要目标。这意味着DHCP的设计师需要继续使用现有的BOOTP消息格式。然而，DHCP比BOOTP具有更多的功能，这意味着它可以包含比容易适应有限的BOOTP消息格式更多的信息。
- en: 'This apparent contradiction was resolved in two ways:'
  id: totrans-619
  prefs: []
  type: TYPE_NORMAL
  zh: 这种明显的矛盾以两种方式得到解决：
- en: The existing BOOTP message format was maintained for basic functionality, but
    DHCP clients and servers were programmed to use the BOOTP message fields in slightly
    different ways.
  id: totrans-620
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 维持现有的BOOTP消息格式以保持基本功能，但DHCP客户端和服务器被编程为以略微不同的方式使用BOOTP消息字段。
- en: The BOOTP vendor extensions were formalized and became DHCP *options*. Despite
    the name *options*, some of these additional fields are for basic DHCP functionality,
    and they are quite mandatory!
  id: totrans-621
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: BOOTP供应商扩展被正式化并成为DHCP *选项*。尽管名为*选项*，但其中一些附加字段是用于基本DHCP功能的，它们是相当强制性的！
- en: With this dual approach, DHCP devices have access to the extra information they
    need. Meanwhile, the basic field format is unchanged, allowing DHCP servers to
    communicate with older BOOTP clients, which ignore the extra DHCP information
    that doesn't relate to them. See the discussion of BOOTP/DHCP interoperability
    (in [Chapter 64](ch64.html "Chapter 64. DHCP CLIENT/SERVER IMPLEMENTATION, FEATURES,
    AND IPV6 SUPPORT")) for more information.
  id: totrans-622
  prefs: []
  type: TYPE_NORMAL
  zh: 采用这种双重方法，DHCP设备可以访问它们所需的额外信息。同时，基本字段格式保持不变，允许DHCP服务器与较旧的BOOTP客户端通信，这些客户端会忽略与它们无关的额外DHCP信息。有关BOOTP/DHCP互操作性的讨论，请参阅[第64章](ch64.html
    "第64章。DHCP客户端/服务器实现、功能和IPv6支持")。
- en: The DHCP message format is illustrated in [Figure 63-1](ch63s02.html#dhcp_message_format-id001
    "Figure 63-1. DHCP message format") and described fully in Tables [Table 63-1](ch63s02.html#dhcp_message_format-id002
    "Table 63-1. DHCP Message Format") and [Table 63-2](ch63s02.html#dhcp_message_htype_values
    "Table 63-2. DHCP Message HType Values"). In the table, I have specifically indicated
    which fields are used in DHCP in a manner similar to how they are used in BOOTP,
    and which are significantly different.
  id: totrans-623
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP 消息格式在 [图 63-1](ch63s02.html#dhcp_message_format-id001 "图 63-1. DHCP 消息格式")
    中展示，并在表 [表 63-1](ch63s02.html#dhcp_message_format-id002 "表 63-1. DHCP 消息格式") 和
    [表 63-2](ch63s02.html#dhcp_message_htype_values "表 63-2. DHCP 消息 HType 值") 中进行了详细描述。在表中，我特别指出了哪些字段在
    DHCP 中的使用方式与在 BOOTP 中相似，哪些字段有显著的不同。
- en: '![DHCP message format](httpatomoreillycomsourcenostarchimages288219.png)'
  id: totrans-624
  prefs: []
  type: TYPE_IMG
  zh: '![DHCP 消息格式](httpatomoreillycomsourcenostarchimages288219.png)'
- en: Figure 63-1. DHCP message format
  id: totrans-625
  prefs: []
  type: TYPE_NORMAL
  zh: 图 63-1. DHCP 消息格式
- en: Table 63-1. DHCP Message Format
  id: totrans-626
  prefs: []
  type: TYPE_NORMAL
  zh: 表 63-1. DHCP 消息格式
- en: '| Field Name | Size (Bytes) | Description |'
  id: totrans-627
  prefs: []
  type: TYPE_TB
  zh: '| 字段名称 | 大小（字节） | 描述 |'
- en: '| --- | --- | --- |'
  id: totrans-628
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| Op | 1 | Operation Code: This code represents the general category of the
    DHCP message. A client sending a request to a server uses an opcode of 1; a server
    replying uses a code of 2\. So, for example, a DHCPREQUEST would be a request,
    and a DHCPACK or DHCPNAK is a reply. The actual specific type of DHCP message
    is encoded using the DHCP Message Type option. |'
  id: totrans-629
  prefs: []
  type: TYPE_TB
  zh: '| Op | 1 | 操作代码：此代码表示 DHCP 消息的一般类别。客户端向服务器发送请求时使用操作码 1；服务器回复时使用代码 2。例如，DHCPREQUEST
    是一个请求，而 DHCPACK 或 DHCPNAK 是一个回复。实际具体的 DHCP 消息类型是通过 DHCP 消息类型选项进行编码的。|'
- en: '| HType | 1 | Hardware Type: This field specifies the type of hardware used
    for the local network, and it is used in exactly the same way as the equivalent
    field (HRD) in the Address Resolution Protocol (ARP) message format. Some of the
    most common values for this field are shown in [Table 63-2](ch63s02.html#dhcp_message_htype_values
    "Table 63-2. DHCP Message HType Values"). |'
  id: totrans-630
  prefs: []
  type: TYPE_TB
  zh: '| HType | 1 | 硬件类型：此字段指定用于本地网络的硬件类型，并且与地址解析协议（ARP）消息格式中的等效字段（HRD）以完全相同的方式使用。此字段的一些最常见值在
    [表 63-2](ch63s02.html#dhcp_message_htype_values "表 63-2. DHCP 消息 HType 值") 中显示。|'
- en: '| Hlen | 1 | Hardware Address Length: Specifies how long hardware addresses
    are in this message. For Ethernet or other networks using IEEE 802 MAC addresses,
    the value is 6\. This is also the same as a field in the ARP field format, HLN.
    |'
  id: totrans-631
  prefs: []
  type: TYPE_TB
  zh: '| Hlen | 1 | 硬件地址长度：指定此消息中硬件地址的长度。对于使用 IEEE 802 MAC 地址的以太网或其他网络，该值为 6。这也与 ARP
    字段格式中的字段 HLN 相同。|'
- en: '| Hops | 1 | Hops: Set to 0 by a client before transmitting a request and used
    by relay agents to control the forwarding of BOOTP and/or DHCP messages. |'
  id: totrans-632
  prefs: []
  type: TYPE_TB
  zh: '| Hops | 1 | 跳数：客户端在发送请求之前将其设置为 0，并由中继代理用于控制 BOOTP 和/或 DHCP 消息的转发。|'
- en: '| XID | 4 | Transaction Identifier: A 32-bit identification field generated
    by the client, to allow it to match up the request with replies received from
    DHCP servers. |'
  id: totrans-633
  prefs: []
  type: TYPE_TB
  zh: '| XID | 4 | 事务标识符：客户端生成的一个 32 位标识字段，允许它与从 DHCP 服务器接收到的回复进行匹配。|'
- en: '| Secs | 2 | Seconds: In BOOTP, this field was vaguely defined and not always
    used. For DHCP, it is defined as the number of seconds elapsed since a client
    began an attempt to acquire or renew a lease. This may be used by a busy DHCP
    server to prioritize replies when multiple client requests are outstanding. |'
  id: totrans-634
  prefs: []
  type: TYPE_TB
  zh: '| Secs | 2 | 秒数：在 BOOTP 中，此字段定义得比较模糊，并不总是使用。对于 DHCP，它定义为客户端开始尝试获取或续订租约以来经过的秒数。这可以由繁忙的
    DHCP 服务器用于在多个客户端请求待处理时优先回复。|'
- en: '| Flags | 2 | Flags: This corresponds to the formerly empty 2-byte field in
    the BOOTP message format defined by RFC 951, which was redefined as a Flags field
    in RFC 1542\. The field presently contains just one flag subfield. This is the
    B (Broadcast) flag subfield, 1 bit in size, which is set to 1 if the client doesn''t
    know its own IP address at the time it sends its request. This serves as an immediate
    indicator to the DHCP server or relay agent that receives the request that it
    should send its reply back by broadcast. The other subfield, which is 15 bits,
    is reserved, set to 0, and not used. |'
  id: totrans-635
  prefs: []
  type: TYPE_TB
  zh: '| 标志 | 2 | 标志：这对应于由 RFC 951 定义的 BOOTP 消息格式中的之前为空的 2 字节字段，该字段在 RFC 1542 中被重新定义为标志字段。该字段目前仅包含一个标志子字段。这是
    B（广播）标志子字段，大小为 1 位，如果客户端在发送请求时不知道自己的 IP 地址，则将其设置为 1。这作为立即指示 DHCP 服务器或中继代理接收到的请求，应通过广播发送其回复的标志。另一个子字段，大小为
    15 位，是保留的，设置为 0，不使用。|'
- en: '| CIAddr | 4 | Client IP Address: The client puts its own current IP address
    in this field if and only if it has a valid IP address while in the *BOUND, RENEWING*,
    or *REBINDING* states; otherwise, it sets the field to 0\. The client can only
    use this field when its address is actually valid and usable, not during the process
    of acquiring an address. Specifically, the client does not use this field to request
    a particular IP address in a lease; it uses the Requested IP Address DHCP option.
    |'
  id: totrans-636
  prefs: []
  type: TYPE_TB
  zh: '| CIAddr | 4 | 客户端 IP 地址：如果客户端在 *BOUND、RENEWING* 或 *REBINDING* 状态下具有有效的 IP
    地址，则仅在此时将当前 IP 地址放入此字段；否则，将字段设置为 0。客户端只能在其实际有效且可用的地址上使用此字段，而不是在获取地址的过程中。具体来说，客户端不使用此字段请求特定的
    IP 地址；它使用请求 IP 地址 DHCP 选项。|'
- en: '| YIAddr | 4 | Your IP Address: The IP address that the server is assigning
    to the client. |'
  id: totrans-637
  prefs: []
  type: TYPE_TB
  zh: '| YIAddr | 4 | 您的 IP 地址：服务器分配给客户端的 IP 地址。|'
- en: '| SIAddr | 4 | Server IP Address: The meaning of this field is slightly changed
    in DHCP. In BOOTP, it is the IP address of the BOOTP server sending a BOOTREPLY
    message. In DHCP, it is the address of the server that the client should use for
    the next step in the bootstrap process, which may or may not be the server sending
    this reply. The sending server always includes its own IP address in the Server
    Identifier DHCP option. |'
  id: totrans-638
  prefs: []
  type: TYPE_TB
  zh: '| SIAddr | 4 | 服务器 IP 地址：此字段在 DHCP 中的含义略有变化。在 BOOTP 中，它是发送 BOOTREPLY 消息的 BOOTP
    服务器的 IP 地址。在 DHCP 中，它是客户端在引导过程中下一步应使用的服务器的地址，这可能或可能不是发送此回复的服务器。发送服务器始终在服务器标识 DHCP
    选项中包含其自己的 IP 地址。|'
- en: '| GIAddr | 4 | Gateway IP Address: This field is used just as it is in BOOTP,
    to route BOOTP messages when BOOTP relay agents are involved to facilitate the
    communication of BOOTP requests and replies between a client and a server on different
    subnets or networks. See the description of DHCP relaying. As with BOOTP, this
    field is not used by clients and does not represent the server giving the client
    the address of a default router (that''s done using the Router DHCP option). |'
  id: totrans-639
  prefs: []
  type: TYPE_TB
  zh: '| GIAddr | 4 | 网关 IP 地址：此字段的使用方式与 BOOTP 相同，当涉及 BOOTP 中继代理时用于路由 BOOTP 消息，以促进在不同子网或网络上的客户端和服务器之间进行
    BOOTP 请求和回复的通信。有关 DHCP 中继的描述。与 BOOTP 一样，此字段不用于客户端，也不表示服务器向客户端提供默认路由器的地址（这是使用路由器
    DHCP 选项完成的）。|'
- en: '| CHAddr | 16 | Client Hardware Address: The hardware (layer 2) address of
    the client, which is used for identification and communication. |'
  id: totrans-640
  prefs: []
  type: TYPE_TB
  zh: '| CHAddr | 16 | 客户端硬件地址：客户端的硬件（第 2 层）地址，用于标识和通信。|'
- en: '| SName | 64 | Server Name: The server sending a DHCPOFFER or DHCPACK message
    may optionally put its name in this field. This can be a simple text nickname
    or a fully qualified DNS domain name (such as myserver.organization.org). This
    field may also be used to carry DHCP options, using the option overload feature,
    indicated by the value of the DHCP Option Overload option. |'
  id: totrans-641
  prefs: []
  type: TYPE_TB
  zh: '| SName | 64 | 服务器名称：发送 DHCPOFFER 或 DHCPACK 消息的服务器可以选择将其名称放入此字段。这可以是一个简单的昵称或完全限定的
    DNS 域名（例如 myserver.organization.org）。此字段还可以用于携带 DHCP 选项，使用选项超载功能，由 DHCP 选项超载选项的值指示。|'
- en: '| File | 128 | Boot Filename: Optionally used by a client to request a particular
    type of boot file in a DHCPDISCOVER message. Used by a server in a DHCPOFFER to
    fully specify a boot file directory path and filename. This field may also be
    used to carry DHCP options, using the option overload feature, indicated by the
    value of the DHCP Option Overload option. |'
  id: totrans-642
  prefs: []
  type: TYPE_TB
  zh: '| File | 128 | 引导文件名：客户端可选用于在 DHCPDISCOVER 消息中请求特定类型的引导文件。服务器在 DHCPOFFER 中使用以完全指定引导文件目录路径和文件名。此字段还可以用于携带
    DHCP 选项，使用选项超载功能，由 DHCP 选项超载选项的值指示。|'
- en: '| Options | Variable | Options: Holds DHCP options, including several parameters
    required for basic DHCP operation. Note that this field was fixed at 64 bytes
    in length in BOOTP but is variable in length in DHCP. See the next section for
    more information. This field may be used by both the client and server. |'
  id: totrans-643
  prefs: []
  type: TYPE_TB
  zh: '| Options | 可变 | 选项：包含基本 DHCP 操作所需的几个参数，用于存储 DHCP 选项。请注意，在 BOOTP 中，此字段长度固定为
    64 字节，但在 DHCP 中长度可变。有关更多信息，请参阅下一节。此字段可由客户端和服务器使用。|'
- en: Table 63-2. DHCP Message HType Values
  id: totrans-644
  prefs: []
  type: TYPE_NORMAL
  zh: 表 63-2. DHCP 消息 HType 值
- en: '| HType Value | Hardware Type |'
  id: totrans-645
  prefs: []
  type: TYPE_TB
  zh: '| HType Value | 硬件类型 |'
- en: '| --- | --- |'
  id: totrans-646
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| 1 | Ethernet (10 Mb) |'
  id: totrans-647
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 以太网（10 Mb）|'
- en: '| 6 | IEEE 802 Networks |'
  id: totrans-648
  prefs: []
  type: TYPE_TB
  zh: '| 6 | IEEE 802 网络 |'
- en: '| 7 | ARCNet |'
  id: totrans-649
  prefs: []
  type: TYPE_TB
  zh: '| 7 | ARCNet |'
- en: '| 11 | LocalTalk |'
  id: totrans-650
  prefs: []
  type: TYPE_TB
  zh: '| 11 | LocalTalk |'
- en: '| 12 | LocalNet (IBM PCNet or SYTEK LocalNET) |'
  id: totrans-651
  prefs: []
  type: TYPE_TB
  zh: '| 12 | LocalNet（IBM PCNet 或 SYTEK LocalNET）|'
- en: '| 14 | Switched Multimegabit Data Service (SMDS) |'
  id: totrans-652
  prefs: []
  type: TYPE_TB
  zh: '| 14 | 交换式多兆比特数据服务 (SMDS) |'
- en: '| 15 | Frame Relay |'
  id: totrans-653
  prefs: []
  type: TYPE_TB
  zh: '| 15 | 帧中继 |'
- en: '| 16 | Asynchronous Transfer Mode (ATM) |'
  id: totrans-654
  prefs: []
  type: TYPE_TB
  zh: '| 16 | 异步传输模式 (ATM) |'
- en: '| 17 | High-Level Data Link Control (HDLC) |'
  id: totrans-655
  prefs: []
  type: TYPE_TB
  zh: '| 17 | 高级数据链路控制 (HDLC) |'
- en: '| 18 | Fibre Channel |'
  id: totrans-656
  prefs: []
  type: TYPE_TB
  zh: '| 18 | 光纤通道 |'
- en: '| 19 | ATM |'
  id: totrans-657
  prefs: []
  type: TYPE_TB
  zh: '| 19 | ATM |'
- en: '| 20 | Serial Line |'
  id: totrans-658
  prefs: []
  type: TYPE_TB
  zh: '| 20 | 串行线 |'
- en: The DHCP standard does not specify the details of how DHCP messages are encapsulated
    within UDP. I would assume that due to the other similarities to BOOTP, DHCP maintains
    BOOTP's optional use of message checksums. It also most likely assumes that messages
    will not be fragmented (sent with the Do Not Fragment bit set to 1 in the IP datagram).
    This is to allow BOOTP clients to avoid the complexity of reassembling fragmented
    messages.
  id: totrans-659
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP 标准没有指定 DHCP 消息如何在 UDP 中封装的细节。我假设由于与其他 BOOTP 的相似性，DHCP 维持了 BOOTP 选项使用消息校验和的做法。它还很可能假设消息不会被分片（在
    IP 数据报中将 Do Not Fragment 位设置为 1）。这是为了让 BOOTP 客户端避免重新组装分片消息的复杂性。
- en: Unlike with BOOTP, which has a fixed message size, DHCP messages are variable
    in length. This is the result of changing BOOTP's 64-byte Vend field into the
    variable-length Options field. DHCP relies on options much more than BOOTP does,
    and a device must be capable of accepting a message with an Options field at least
    312 bytes in length. The SName and File fields may also be used to carry options,
    as described in the next section.
  id: totrans-660
  prefs: []
  type: TYPE_NORMAL
  zh: 与具有固定消息大小的 BOOTP 不同，DHCP 消息的长度是可变的。这是将 BOOTP 的 64 字节 Vend 字段更改为可变长度的 Options
    字段的结果。DHCP 比BOOTP更依赖于选项，设备必须能够接受至少 312 字节长度的 Options 字段的消息。SName 和 File 字段也可以用来携带选项，如下一节所述。
- en: DHCP Options
  id: totrans-661
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP 选项
- en: When BOOTP was first developed, its message format included a 64-byte Vend field,
    called the Vendor-Specific Area. The idea behind this field was to provide flexibility
    to the protocol. The BOOTP standard did not define any specific way of using this
    field. Instead, the field was left open for the creators of different types of
    hardware to use it to customize BOOTP to meet the needs of their clients and/or
    servers.
  id: totrans-662
  prefs: []
  type: TYPE_NORMAL
  zh: 当 BOOTP 首次开发时，其消息格式包括一个 64 字节的 Vend 字段，称为供应商特定区域。这个字段背后的想法是为协议提供灵活性。BOOTP 标准没有定义使用此字段的任何特定方式。相反，该字段被留空，供不同类型硬件的创建者使用，以将其定制为满足其客户端和/或服务器的需求。
- en: Including this sort of undefined field is a good idea because it makes a protocol
    easily *extensible*—allowing the protocol to be easily enhanced in the future
    through the definition of new fields while not disturbing any existing fields.
    The problem with the BOOTP Vendor-Specific Area, however, is that the extensibility
    was vendor-specific. It was useful only for special fields that were particular
    to a single vendor.
  id: totrans-663
  prefs: []
  type: TYPE_NORMAL
  zh: 包含这种未定义的字段是一个好主意，因为它使协议易于 *扩展*——允许通过定义新字段轻松增强协议，同时不影响任何现有字段。然而，BOOTP 供应商特定区域的问题在于，其可扩展性是供应商特定的。它只对特定于单个供应商的特殊字段有用。
- en: What was really needed was a way to define new fields for general-purpose, vendor-independent
    parameter communication, but there was no field in the BOOTP message format that
    would let this happen. The solution came in the form of RFC 1048, which defined
    a technique called BOOTP *vendor information extensions*. This method redefines
    the Vendor-Specific Area to allow it to carry general parameters between a client
    and server. This idea was so successful that it largely replaced the older vendor-specific
    use of the Vend field.
  id: totrans-664
  prefs: []
  type: TYPE_NORMAL
  zh: 真正需要的是一种定义新字段以进行通用、供应商无关的参数通信的方法，但在 BOOTP 消息格式中没有这样的字段可以实现这一点。解决方案以 RFC 1048
    的形式出现，它定义了一种称为 BOOTP *供应商信息扩展*的技术。这种方法重新定义了供应商特定区域，使其能够携带客户端和服务器之间的通用参数。这个想法非常成功，以至于在很大程度上取代了较老的供应商特定
    Vend 字段的使用。
- en: DHCP maintains, formalizes, and further extends the idea of using the Vend field
    to carry general-purpose parameters. Instead of being called vendor information
    extensions or vendor information fields, these fields are now called simply DHCP
    *options*. Similarly, the Vend field has been renamed the Options field, reflecting
    its new role as a way of conveying vendor-independent options between a client
    and server.
  id: totrans-665
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP 维护、规范并进一步扩展了使用 Vend 字段来携带通用参数的想法。这些字段现在简单地被称为 DHCP *选项*，而不是被称为供应商信息扩展或供应商信息字段。同样，Vend
    字段已被重命名为 Options 字段，反映了它在客户端和服务器之间传达供应商无关选项的新角色。
- en: Options and Option Format
  id: totrans-666
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 选项和选项格式
- en: Keeping with the desire to maintain compatibility between BOOTP and DHCP, the
    DHCP Options field is, in most ways, the same as the vendor-independent interpretation
    of the BOOTP Vend field introduced by RFC 1048\. The first four bytes of the field
    still carry the magic cookie value 99.130.83.99 to identify the information as
    vendor-independent option fields. The rest of the Option field consists of one
    or more subfields, each of which has a *type, length, value (TLV-encoded)* substructure,
    as in BOOTP.
  id: totrans-667
  prefs: []
  type: TYPE_NORMAL
  zh: 为了保持BOOTP和DHCP之间的兼容性，DHCP选项字段在大多数方面与RFC 1048引入的BOOTP Vend字段的无供应商解释相同。字段的前四个字节仍然携带魔数值99.130.83.99，以标识这些信息为无供应商选项字段。选项字段的其余部分由一个或多个子字段组成，每个子字段都具有与BOOTP中相同的*类型、长度、值（TLV编码）*子结构。
- en: The main differences between BOOTP vendor information fields and DHCP options
    are the field names and the fact that the DHCP Options field is variable in length
    (the BOOTP Vend field is fixed at 64 bytes). The structure of the DHCP Options
    field as a whole is shown in [Figure 63-2](ch63s03.html#dhcp_options_field_format_the_format_of_
    "Figure 63-2. DHCP Options field format The format of the DHCP Options field is,
    unsurprisingly, very similar to that of the BOOTP Vendor-Specific Area, as shown
    in Figure 60-4 in Chapter 60\. The Options field begins with the same four-byte
    magic cookie and then contains a number of variable-length option fields. Each
    option has the format described in Table 63-3."), and the subfield names of each
    option are described in [Table 63-3](ch63s03.html#dhcp_option_format "Table 63-3. DHCP
    Option Format").
  id: totrans-668
  prefs: []
  type: TYPE_NORMAL
  zh: BOOTP供应商信息字段和DHCP选项之间的主要区别在于字段名称以及DHCP选项字段长度是可变的（BOOTP Vend字段固定为64字节）。整个DHCP选项字段的结构如图[图63-2](ch63s03.html#dhcp_options_field_format_the_format_of_
    "图63-2. DHCP选项字段格式 DHCP选项字段的格式，不出所料，与BOOTP供应商特定区域非常相似，如图60章中的图60-4所示。选项字段以相同的四个字节魔数开头，然后包含多个可变长度的选项字段。每个选项的格式如表63-3中所述。"),并且每个选项的子字段名称在[表63-3](ch63s03.html#dhcp_option_format
    "表63-3. DHCP选项格式")中描述。
- en: '![DHCP Options field format The format of the DHCP Options field is, unsurprisingly,
    very similar to that of the BOOTP Vendor-Specific Area, as shown in in . The Options
    field begins with the same four-byte magic cookie and then contains a number of
    variable-length option fields. Each option has the format described in .](httpatomoreillycomsourcenostarchimages288221.png.jpg)'
  id: totrans-669
  prefs: []
  type: TYPE_IMG
  zh: '![DHCP选项字段格式 DHCP选项字段的格式，不出所料，与BOOTP供应商特定区域非常相似，如图所示。选项字段以相同的四个字节魔数开头，然后包含多个可变长度的选项字段。每个选项的格式在。](httpatomoreillycomsourcenostarchimages288221.png.jpg)'
- en: Figure 63-2. DHCP Options field format The format of the DHCP Options field
    is, unsurprisingly, very similar to that of the BOOTP Vendor-Specific Area, as
    shown in [Figure 60-4](ch60s05.html#bootp_vendor-specific_area_format_showin "Figure 60-4. BOOTP
    Vendor-Specific Area format showing vendor information fields") in [Chapter 60](ch60.html
    "Chapter 60. TCP/IP BOOTSTRAP PROTOCOL (BOOTP)"). The Options field begins with
    the same four-byte magic cookie and then contains a number of variable-length
    option fields. Each option has the format described in [Table 63-3](ch63s03.html#dhcp_option_format
    "Table 63-3. DHCP Option Format").
  id: totrans-670
  prefs: []
  type: TYPE_NORMAL
  zh: 图63-2. DHCP选项字段格式 DHCP选项字段的格式，不出所料，与BOOTP供应商特定区域非常相似，如图[图60-4](ch60s05.html#bootp_vendor-specific_area_format_showin
    "图60-4. BOOTP供应商特定区域格式显示供应商信息字段")所示，位于[第60章](ch60.html "第60章. TCP/IP引导协议(BOOTP)")。选项字段以相同的四个字节魔数开头，然后包含多个可变长度的选项字段。每个选项的格式在[表63-3](ch63s03.html#dhcp_option_format
    "表63-3. DHCP选项格式")中描述。
- en: All of the DHCP options follow the format shown in [Table 63-3](ch63s03.html#dhcp_option_format
    "Table 63-3. DHCP Option Format"), except for two special cases, again the same
    as with BOOTP. A Code value of 0 is used as a *pad*, when subfields need to be
    aligned on word boundaries; it contains no information. The value 255 is used
    to mark the end of the vendor information fields. Both of these codes contain
    no actual data, so to save space, when either is used, just the single Code value
    is included and the Len and Data fields are omitted. A device seeing a Code value
    of 0 just skips it as filler. A device seeing a Code value of 255 knows it has
    reached the end of the fields in this Options field.
  id: totrans-671
  prefs: []
  type: TYPE_NORMAL
  zh: 所有的 DHCP 选项都遵循 [表 63-3](ch63s03.html#dhcp_option_format "表 63-3. DHCP 选项格式")
    中所示的格式，除了两个特殊情况，与 BOOTP 一样。代码值 0 用作填充，当子字段需要对齐在字边界上时；它不包含任何信息。值 255 用于标记供应商信息字段的结束。这两个代码都不包含实际数据，因此为了节省空间，当使用任何一个时，只需包含单个代码值，并省略
    Len 和 Data 字段。看到代码值为 0 的设备将其视为填充内容跳过。看到代码值为 255 的设备知道它已到达此选项字段中的字段末尾。
- en: Table 63-3. DHCP Option Format
  id: totrans-672
  prefs: []
  type: TYPE_NORMAL
  zh: 表 63-3. DHCP 选项格式
- en: '| Subfield Name | Size (Bytes) | Description |'
  id: totrans-673
  prefs: []
  type: TYPE_TB
  zh: '| 子字段名称 | 大小（字节） | 描述 |'
- en: '| --- | --- | --- |'
  id: totrans-674
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| Code | 1 | Option Code: A single octet that specifies the option type. |'
  id: totrans-675
  prefs: []
  type: TYPE_TB
  zh: '| 代码 | 1 | 选项代码：一个单字节，用于指定选项类型。 |'
- en: '| Len | 1 | Option Length: The number of bytes in this particular option. This
    does not include the two bytes for the Code and Len subfields. |'
  id: totrans-676
  prefs: []
  type: TYPE_TB
  zh: '| Len | 1 | 选项长度：此特定选项的字节数。这不包括 Code 和 Len 子字段的两个字节。 |'
- en: '| Data | Variable | Option Data: The data being sent, which has a length indicated
    by the Len subfield, and which is interpreted based on the Code subfield. |'
  id: totrans-677
  prefs: []
  type: TYPE_TB
  zh: '| 数据 | 可变 | 选项数据：正在发送的数据，其长度由 Len 子字段指示，并根据 Code 子字段进行解释。 |'
- en: Option Categories
  id: totrans-678
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 选项类别
- en: Before DHCP was invented, a series of BOOTP standards was published defining
    the current list of BOOTP vendor information extensions. When DHCP was developed,
    a single standard was created that merged both BOOTP vendor information extensions
    and DHCP options, since again, they are basically the same. The most recent of
    these is RFC 2132, entitled (ta-da!) "DHCP Options and BOOTP Vendor Extensions."
  id: totrans-679
  prefs: []
  type: TYPE_NORMAL
  zh: 在 DHCP 被发明之前，一系列 BOOTP 标准被发布，定义了当前BOOTP供应商信息扩展的列表。当 DHCP 被开发时，创建了一个单一的标准，它合并了BOOTP供应商信息扩展和
    DHCP 选项，因为它们基本上是相同的。其中最新的是 RFC 2132，标题为（哇！）"DHCP 选项和 BOOTP 供应商扩展"。
- en: 'RFC 2132 lists several dozen fields that can be used either as DHCP options
    or BOOTP vendor information fields, grouped into several categories. In addition,
    there is also a set of fields that are used only in DHCP, not in BOOTP. Despite
    being called *options*, only some really are optional; others are necessary for
    the basic operation of DHCP. They are carried as option fields for only one reason:
    to allow DHCP to keep using the same basic message format as BOOTP for compatibility.
    [Table 63-4](ch63s03.html#dhcp_option_categories "Table 63-4. DHCP Option Categories")
    summarizes the categories used for DHCP options.'
  id: totrans-680
  prefs: []
  type: TYPE_NORMAL
  zh: RFC 2132 列出了几十个字段，这些字段可以用作 DHCP 选项或 BOOTP 供应商信息字段，分为几个类别。此外，还有一个仅用于 DHCP 而不用于
    BOOTP 的字段集。尽管被称为 *选项*，但只有一些是可选的；其他对于 DHCP 的基本操作是必要的。它们仅作为选项字段携带，只有一个原因：允许 DHCP
    继续使用与 BOOTP 相同的基本消息格式以保持兼容性。[表 63-4](ch63s03.html#dhcp_option_categories "表 63-4.
    DHCP 选项类别") 总结了用于 DHCP 选项的类别。
- en: Table 63-4. DHCP Option Categories
  id: totrans-681
  prefs: []
  type: TYPE_NORMAL
  zh: 表 63-4. DHCP 选项类别
- en: '| Option Category | Description |'
  id: totrans-682
  prefs: []
  type: TYPE_TB
  zh: '| 选项类别 | 描述 |'
- en: '| --- | --- |'
  id: totrans-683
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| RFC 1497 Vendor Extensions | The BOOTP vendor extensions defined in RFC 1497,
    the last RFC describing vendor extension fields that was BOOTP-specific (before
    DHCP was created). For easier reference, these were kept in a single group when
    DHCP options were created, even though some of the functions they represent might
    fit better in other categories. (See [Table 63-5](ch63s04.html#dhcpbootp_options_rfc__vendor_extensions
    "Table 63-5. DHCP/BOOTP Options: RFC 1497 Vendor Extensions").) |'
  id: totrans-684
  prefs: []
  type: TYPE_TB
  zh: '| RFC 1497 供应商扩展 | 在 RFC 1497 中定义的 BOOTP 供应商扩展，这是描述供应商扩展字段最后一个与 BOOTP 特定的 RFC（在
    DHCP 创建之前）。为了便于参考，当创建 DHCP 选项时，这些都被保留在一个单独的组中，尽管它们所表示的一些功能可能更适合其他类别。（参见 [表 63-5](ch63s04.html#dhcpbootp_options_rfc__vendor_extensions
    "表 63-5. DHCP/BOOTP 选项：RFC 1497 供应商扩展")。） |'
- en: '| IP Layer Parameters per Host | Parameters that control the operation of the
    Internet Protocol (IP) on a host, which affect the host as a whole and are not
    interface-specific. (See [Table 63-6](ch63s04.html#dhcpbootp_options_ip_layer_parameters_pe
    "Table 63-6. DHCP/BOOTP Options: IP Layer Parameters per Host").) |'
  id: totrans-685
  prefs: []
  type: TYPE_TB
  zh: '| 每个主机的 IP 层参数 | 控制主机上 Internet 协议（IP）操作的参数，这些参数影响整个主机，而不是特定于接口。（参见[表63-6](ch63s04.html#dhcpbootp_options_ip_layer_parameters_pe
    "表63-6. DHCP/BOOTP 选项：每个主机的 IP 层参数")。) |'
- en: '| IP Layer Parameters per Interface | Parameters that affect the operation
    of IP for a particular interface of a host. (Some devices have only one interface;
    others have more.) (See [Table 63-7](ch63s04.html#dhcpbootp_options_ip_layer_paramet-id001
    "Table 63-7. DHCP/BOOTP Options: IP Layer Parameters per Interface").) |'
  id: totrans-686
  prefs: []
  type: TYPE_TB
  zh: '| 每个接口的 IP 层参数 | 影响主机特定接口上 IP 操作的参数。（一些设备只有一个接口；其他设备有更多。）（参见[表63-7](ch63s04.html#dhcpbootp_options_ip_layer_paramet-id001
    "表63-7. DHCP/BOOTP 选项：每个接口的 IP 层参数")。) |'
- en: '| Link Layer Parameters per Interface | Parameters that affect the data link
    layer operation of a host, on a per-interface basis. (See [Table 63-8](ch63s04.html#dhcpbootp_options_link_layer_parameters_
    "Table 63-8. DHCP/BOOTP Options: Link Layer Parameters per Interface").) |'
  id: totrans-687
  prefs: []
  type: TYPE_TB
  zh: '| 每个接口的链路层参数 | 基于每个接口影响主机数据链路层操作的参数。（参见[表63-8](ch63s04.html#dhcpbootp_options_link_layer_parameters_
    "表63-8. DHCP/BOOTP 选项：每个接口的链路层参数")。) |'
- en: '| TCP Parameters | Parameters that impact the operation of the TCP layer; specified
    on a per-interface basis. (See [Table 63-9](ch63s04.html#dhcpbootp_options_tcp_parameters
    "Table 63-9. DHCP/BOOTP Options: TCP Parameters").) |'
  id: totrans-688
  prefs: []
  type: TYPE_TB
  zh: '| TCP 参数 | 影响 TCP 层操作的参数；基于每个接口指定。（参见[表63-9](ch63s04.html#dhcpbootp_options_tcp_parameters
    "表63-9. DHCP/BOOTP 选项：TCP 参数")。) |'
- en: '| Application and Service Parameters | Parameters used to configure or control
    the operation of various miscellaneous applications or services. (See [Table 63-10](ch63s04.html#dhcpbootp_options_application_and_servic
    "Table 63-10. DHCP/BOOTP Options: Application and Service Parameters").) |'
  id: totrans-689
  prefs: []
  type: TYPE_TB
  zh: '| 应用和服务参数 | 用于配置或控制各种杂项应用或服务操作的参数。（参见[表63-10](ch63s04.html#dhcpbootp_options_application_and_servic
    "表63-10. DHCP/BOOTP 选项：应用和服务参数")。) |'
- en: '| DHCP Extensions | Parameters that are DHCP-specific and used to control the
    operation of the DHCP protocol itself. (See [Table 63-12](ch63s04.html#dhcp_options_dhcp_extensions
    "Table 63-12. DHCP Options: DHCP Extensions").) |'
  id: totrans-690
  prefs: []
  type: TYPE_TB
  zh: '| DHCP 扩展 | DHCP 特定的参数，用于控制 DHCP 协议本身的操作。（参见[表63-12](ch63s04.html#dhcp_options_dhcp_extensions
    "表63-12. DHCP 选项：DHCP 扩展")。) |'
- en: The tables at the end of this chapter provide a complete list of the DHCP options
    defined in RFC 2132.
  id: totrans-691
  prefs: []
  type: TYPE_NORMAL
  zh: 本章末尾的表格提供了 RFC 2132 中定义的所有 DHCP 选项的完整列表。
- en: Due to the popularity of DHCP, several other options have been defined since
    that standard was published. Each time a new option is created, documenting it
    would have required a new successor to RFC 2132, which would be confusing and
    time-consuming. Instead, the maintenance of these options and extensions has been
    moved from the RFC process to a set of files maintained by the Internet Assigned
    Numbers Authority (IANA), just like so many other parameters. There is also a
    process by which a developer can request additional standard extensions to be
    added to DHCP. This is described in section 10 of RFC 2132.
  id: totrans-692
  prefs: []
  type: TYPE_NORMAL
  zh: 由于 DHCP 的普及，自该标准发布以来已经定义了几个其他选项。每次创建一个新选项时，都需要一个新的后续 RFC 2132 来对其进行文档化，这将很混乱且耗时。相反，这些选项和扩展的维护已从
    RFC 流程转移到由互联网数字分配机构（IANA）维护的一组文件，就像许多其他参数一样。还有一个过程，开发者可以通过该过程请求将额外的标准扩展添加到 DHCP。这在本节
    RFC 2132 的第 10 节中描述。
- en: Tip
  id: totrans-693
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** DHCP takes BOOTP''s vendor information extensions and formalizes
    them into an official feature called DHCP *options*. The BOOTP Vendor Specific
    Area field becomes the DHCP Options field, and it can contain an arbitrary number
    of parameters to be sent from the server to the client. Some of these include
    pieces of data that are actually mandatory for the successful operation of DHCP.
    There are several dozen DHCP options, which are divided into functional categories.'
  id: totrans-694
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** DHCP 将 BOOTP 的供应商信息扩展正式化为一个称为 DHCP *选项* 的官方功能。BOOTP 供应商特定区域字段变为 DHCP
    选项字段，它可以包含从服务器发送到客户端的任意数量的参数。其中一些实际上对于 DHCP 的成功操作是必需的。有几十个 DHCP 选项，它们被分为功能类别。'
- en: Option Overloading
  id: totrans-695
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 选项重载
- en: 'Since DHCP relies so much more on the use of options than BOOTP did, the size
    of the Options field could theoretically grow quite large. However, since DHCP
    is using UDP for transport, the overall size of a message is limited. This theoretically
    could have led to a situation where a message might run out of room and be unable
    to carry all its options. Meanwhile, there are two more spacious fields in the
    message format: SName and File, which are 64 bytes and 128 bytes, respectively.
    These fields might not even be needed in some cases, because many devices use
    DHCP for getting a lease and parameters, not to download a boot image. Even if
    they are needed, they might be carrying much less information than their large
    fixed size allows.'
  id: totrans-696
  prefs: []
  type: TYPE_NORMAL
  zh: 由于DHCP比BOOTP更多地依赖于选项的使用，因此选项字段的大小理论上可能会非常大。然而，由于DHCP使用UDP进行传输，消息的整体大小是有限的。这理论上可能导致消息空间不足，无法携带所有选项。同时，消息格式中还有两个更大的字段：SName和File，分别占用64字节和128字节。在某些情况下，这些字段可能甚至不需要，因为许多设备使用DHCP来获取租约和参数，而不是下载引导映像。即使需要，它们携带的信息可能远少于它们允许的大固定大小。
- en: To make better use of the total space in the message format, DHCP includes a
    special feature called *option overloading*, which allows the SName and File fields
    to be used to carry more option fields instead of their conventional information.
    Use of this option is itself indicated through the use of a DHCP option, Option
    Overload, which tells a device receiving a message how to interpret the two fields.
    If option overloading is used, the SName and/or File fields are read and interpreted
    in the same way as the Options field, after all of the options in the Options
    field are parsed. If the message actually does need to carry a server name or
    boot file, these are included as separate options (number 66 and number 67, respectively),
    which are variable in length and can therefore be made exactly the length needed.
  id: totrans-697
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地利用消息格式的总空间，DHCP包含一个称为*选项过载*的特殊功能，该功能允许使用SName和File字段来携带更多的选项字段，而不是它们传统的信息。使用此选项本身是通过使用一个DHCP选项，即选项过载来指示的，它告诉接收消息的设备如何解释这两个字段。如果使用选项过载，则在解析完选项字段中的所有选项之后，将按照与选项字段相同的方式读取和解释SName和/或File字段。如果消息实际上需要携带服务器名称或引导文件，这些将作为单独的选项（分别编号为66和67）包含，这些选项的长度是可变的，因此可以精确到所需的长度。
- en: Incidentally, the creators of DHCP did recognize that even though vendor-independent
    options are important, a vendor might want to be able to send vendor-specific
    information just as the original BOOTP defined. To this end, they created a DHCP
    option called Vendor Specific Information. This option allows a vendor to encapsulate
    a set of vendor-specific option fields within the normal DHCP option structure.
    In essence, you can think of this as a way of nesting a conventional BOOTP Vend
    field (of variable length) within a single DHCP option. Other DHCP options can
    be carried simultaneously, subject to overall message-length limits. Note that
    this supplements an already existing BOOTP option that allows reference to be
    made to a file containing vendor-specific information.
  id: totrans-698
  prefs: []
  type: TYPE_NORMAL
  zh: 顺便提一下，DHCP的创造者确实认识到，尽管供应商无关的选项很重要，但供应商可能希望能够发送与原始BOOTP定义相同的供应商特定信息。为此，他们创建了一个名为供应商特定信息的DHCP选项。此选项允许供应商在正常的DHCP选项结构中封装一组供应商特定选项字段。本质上，你可以将其视为将传统的BOOTP供应商字段（可变长度）嵌套在单个DHCP选项中的方式。其他DHCP选项可以同时携带，但受整体消息长度限制。请注意，这补充了一个已经存在的BOOTP选项，该选项允许引用包含供应商特定信息的文件。
- en: Tip
  id: totrans-699
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** Since DHCP messages can contain so many options, a special
    feature called option *overloading* was created. When enabled, overloading allows
    options to make use of the large SName and File fields in the DHCP message format
    for options.'
  id: totrans-700
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** 由于DHCP消息可以包含许多选项，因此创建了一个称为选项*过载*的特殊功能。当启用时，过载允许选项利用DHCP消息格式中的大SName和File字段。'
- en: Summary of DHCP Options/BOOTP Vendor Information Fields
  id: totrans-701
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP选项/BOOTP供应商信息字段摘要
- en: BOOTP *vendor information fields* are used to carry additional vendor-independent
    configuration parameters. These were used as the basis for DHCP *options*, which
    extend the concept to include parameters used to manage the operation of DHCP
    as a whole, as described in the previous section. Since BOOTP vendor information
    fields and DHCP options are essentially the same (except for the DHCP-specific
    fields), they are described in the same TCP/IP standard, and hence, in this single
    part of the book.
  id: totrans-702
  prefs: []
  type: TYPE_NORMAL
  zh: BOOTP *厂商信息字段*用于携带额外的厂商无关的配置参数。这些被用作DHCP *选项*的基础，该选项将概念扩展到包括用于管理整个DHCP操作的参数，如前节所述。由于BOOTP厂商信息字段和DHCP选项本质上相同（除了DHCP特定的字段），它们在同一个TCP/IP标准中描述，因此在本书的这一部分中描述。
- en: The following tables list each of the DHCP options/BOOTP vendor information
    fields. The tables show each option's Code value, the length of the Data subfield
    for the option, the formal name of the option, and a brief description of how
    it is used. For simplicity in the tables, where I say *option*, please read it
    as *option/vendor information field*, since they are the same (except, for the
    DHCP-specific options).
  id: totrans-703
  prefs: []
  type: TYPE_NORMAL
  zh: 以下表格列出了每个DHCP选项/BOOTP厂商信息字段。表格显示了每个选项的代码值、选项数据子字段的长度、选项的正式名称以及如何使用的简要描述。为了表格的简洁性，当我说*选项*时，请将其理解为*选项/厂商信息字段*，因为它们是相同的（除了DHCP特定的选项）。
- en: Note
  id: totrans-704
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*There are a lot of options in these tables, and some of them define parameters
    that are used by somewhat obscure protocols that I do not cover in this book.
    The brief descriptions may not be enough for you to completely understand how
    each and every option is used. Note in particular that many of the original BOOTP
    vendor information fields that are used to communicate the addresses of certain
    types of servers are now archaic and may no longer be used*.'
  id: totrans-705
  prefs: []
  type: TYPE_NORMAL
  zh: '*这些表格中有许多选项，其中一些定义了被某些不太为人所知的协议使用的参数，而这些协议我在本书中没有涉及。简短的描述可能不足以让您完全理解每个选项是如何使用的。特别是请注意，许多最初用于传达某些类型服务器地址的BOOTP厂商信息字段现在已经过时，可能不再使用*。'
- en: RFC 1497 Vendor Extensions
  id: totrans-706
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: RFC 1497 厂商扩展
- en: '[Table 63-5](ch63s04.html#dhcpbootp_options_rfc__vendor_extensions "Table 63-5. DHCP/BOOTP
    Options: RFC 1497 Vendor Extensions") shows the DHCP/BOOTP options that were originally
    defined in RFC 1497.'
  id: totrans-707
  prefs: []
  type: TYPE_NORMAL
  zh: '[表63-5](ch63s04.html#dhcpbootp_options_rfc__vendor_extensions "表63-5. DHCP/BOOTP
    选项：RFC 1497 厂商扩展")显示了最初在RFC 1497中定义的DHCP/BOOTP选项。'
- en: 'Table 63-5. DHCP/BOOTP Options: RFC 1497 Vendor Extensions'
  id: totrans-708
  prefs: []
  type: TYPE_NORMAL
  zh: 表63-5. DHCP/BOOTP 选项：RFC 1497 厂商扩展
- en: '| Code Value | Data Length (Bytes) | Name and Description |'
  id: totrans-709
  prefs: []
  type: TYPE_TB
  zh: '| 代码值 | 数据长度（字节） | 名称和描述 |'
- en: '| --- | --- | --- |'
  id: totrans-710
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| 0 | 0 | Pad: A single byte used as filler to align a subsequent field on
    a word (2-byte) boundary. It contains no information. One of two options that
    is a single byte in length, having no Data subfield (the other is the End option).
    |'
  id: totrans-711
  prefs: []
  type: TYPE_TB
  zh: '| 0 | 0 | 填充：用作填充以将后续字段对齐到字（2字节）边界的单个字节。它不包含任何信息。长度为单个字节的两个选项之一，没有数据子字段（另一个是结束选项）。|'
- en: '| 1 | 4 | Subnet Mask: A 32-bit subnet mask being supplied for the client to
    use on the current network. It must appear in the option list before the Router
    option if both are present. |'
  id: totrans-712
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 4 | 子网掩码：提供给客户端在当前网络中使用的32位子网掩码。如果两者都存在，它必须在选项列表中出现在路由器选项之前。|'
- en: '| 2 | 4 | Time Offset: Specifies the time offset of the client''s subnet in
    seconds from *Coordinated Universal Time (UTC, formerly Greenwich Mean Time or
    GMT)*. Positive values represent areas east of the prime meridian (in the United
    Kingdom); negative values represent areas west of the prime meridian. Essentially,
    this is used to indicate the time zone of the subnet. |'
  id: totrans-713
  prefs: []
  type: TYPE_TB
  zh: '| 2 | 4 | 时间偏移：指定客户端子网相对于协调世界时（UTC，以前称为格林尼治标准时间或GMT）的秒数偏移。正值表示位于本初子午线以东的地区（在英国）；负值表示位于本初子午线以西的地区。基本上，这是用来指示子网时区的。|'
- en: '| 3 | Variable (multiple of 4) | Router: Specifies a list of 32-bit router
    addresses for the client to use on the local network. Routers are listed in the
    order of preference for the client to use. |'
  id: totrans-714
  prefs: []
  type: TYPE_TB
  zh: '| 3 | 可变（4的倍数） | 路由器：指定客户端在本地网络中使用的32位路由器地址列表。路由器按照客户端使用的优先级顺序列出。|'
- en: '| 4 | Variable (multiple of 4) | Time Server: Specifies a list of time server
    addresses (per RFC 868, see [Chapter 88](ch88.html "Chapter 88. TCP/IP ADMINISTRATION
    AND TROUBLESHOOTING UTILITIES AND PROTOCOLS")) for the client to use on the local
    network. Servers are listed in the order of preference for the client to use.
    |'
  id: totrans-715
  prefs: []
  type: TYPE_TB
  zh: '| 4 | 变量（4的倍数）| 时间服务器：指定客户端在本地网络中使用的时服务器地址列表（根据RFC 868，见第88章[TCP/IP管理及故障排除工具和协议]）。服务器按客户端使用的优先顺序列出。
    |'
- en: '| 5 | Variable (multiple of 4) | IEN-116 Name Server: Specifies a list of IEN-116
    name server addresses for the client to use on the local network. Servers are
    listed in the order of preference for the client to use. Note that this option
    is not used for DNS name servers. |'
  id: totrans-716
  prefs: []
  type: TYPE_TB
  zh: '| 5 | 变量（4的倍数）| IEN-116域名服务器：指定客户端在本地网络中使用的IEN-116域名服务器地址列表。服务器按客户端使用的优先顺序列出。注意，此选项不用于DNS域名服务器。
    |'
- en: '| 6 | Variable (multiple of 4) | DNS Name Server: Specifies a list of DNS (see
    [Chapter 52](ch52.html "Chapter 52. DOMAIN NAME SYSTEM (DNS) OVERVIEW, FUNCTIONS,
    AND CHARACTERISTICS")) name server addresses for the client to use on the local
    network. Servers are listed in the order of preference for the client to use.
    |'
  id: totrans-717
  prefs: []
  type: TYPE_TB
  zh: '| 6 | 变量（4的倍数）| DNS域名服务器：指定客户端在本地网络中使用的DNS（见第52章[域名系统（DNS）概述、功能和特性]）域名服务器地址列表。服务器按客户端使用的优先顺序列出。
    |'
- en: '| 7 | Variable (multiple of 4) | Log Server: Specifies a list of MIT-LCS UDP
    log server addresses for the client to use on the local network. Servers are listed
    in the order of preference for the client to use. |'
  id: totrans-718
  prefs: []
  type: TYPE_TB
  zh: '| 7 | 变量（4的倍数）| 日志服务器：指定客户端在本地网络中使用的MIT-LCS UDP日志服务器地址列表。服务器按客户端使用的优先顺序列出。
    |'
- en: '| 8 | Variable (multiple of 4) | Cookie Server: Specifies a list of RFC 865
    cookie server addresses for the client to use on the local network. Servers are
    listed in the order of preference for the client to use. |'
  id: totrans-719
  prefs: []
  type: TYPE_TB
  zh: '| 8 | 变量（4的倍数）| Cookie服务器：指定客户端在本地网络中使用的RFC 865 Cookie服务器地址列表。服务器按客户端使用的优先顺序列出。
    |'
- en: '| 9 | Variable (multiple of 4) | LPR Server: Specifies a list of RFC 1179 line
    printer server addresses for the client to use on the local network. Servers are
    listed in the order of preference for the client to use. |'
  id: totrans-720
  prefs: []
  type: TYPE_TB
  zh: '| 9 | 变量（4的倍数）| LPR服务器：指定客户端在本地网络中使用的RFC 1179行式打印机服务器地址列表。服务器按客户端使用的优先顺序列出。
    |'
- en: '| 10 | Variable (multiple of 4) | Impress Server: Specifies a list of Imagen
    Impress server addresses for the client to use on the local network. Servers are
    listed in the order of preference for the client to use. |'
  id: totrans-721
  prefs: []
  type: TYPE_TB
  zh: '| 10 | 变量（4的倍数）| Impress服务器：指定客户端在本地网络中使用的Imagen Impress服务器地址列表。服务器按客户端使用的优先顺序列出。
    |'
- en: '| 11 | Variable (multiple of 4) | Resource Location Server: Specifies a list
    of RFC 887 resource location server addresses for the client to use on the local
    network. Servers are listed in the order of preference for the client to use.
    |'
  id: totrans-722
  prefs: []
  type: TYPE_TB
  zh: '| 11 | 变量（4的倍数）| 资源定位服务器：指定客户端在本地网络中使用的RFC 887资源定位服务器地址列表。服务器按客户端使用的优先顺序列出。
    |'
- en: '| 12 | Variable | Host Name: Specifies a host name for the client. This may
    or may not be a DNS host name; see option15. |'
  id: totrans-723
  prefs: []
  type: TYPE_TB
  zh: '| 12 | 变量 | 主机名：指定客户端的主机名。这可能是一个DNS主机名，也可能不是；见选项15。 |'
- en: '| 13 | 2 | Boot File Size: Specifies the size of the default boot image file
    for the client, expressed in units of 512 bytes. |'
  id: totrans-724
  prefs: []
  type: TYPE_TB
  zh: '| 13 | 2 | 引导文件大小：指定客户端默认引导映像文件的大小，以512字节为单位。 |'
- en: '| 14 | Variable | Merit Dump File: Specifies the path and filename of the file
    to which the client should dump its core image in the event that it crashes. |'
  id: totrans-725
  prefs: []
  type: TYPE_TB
  zh: '| 14 | 变量 | 优势转储文件：指定客户端在崩溃时应该将其核心镜像转储到哪个文件路径和文件名。 |'
- en: '| 15 | Variable | Domain Name: Specifies the DNS domain name for the client.
    Compare this with option 12. |'
  id: totrans-726
  prefs: []
  type: TYPE_TB
  zh: '| 15 | 变量 | 域名：指定客户端的DNS域名。与选项12进行比较。 |'
- en: '| 16 | 4 | Swap Server: Specifies the address of the client''s swap server.
    |'
  id: totrans-727
  prefs: []
  type: TYPE_TB
  zh: '| 16 | 4 | 交换服务器：指定客户端交换服务器的地址。 |'
- en: '| 17 | Variable | Root Path: Specifies the path name of the client''s root
    disk. This allows the client to access files it may need, using a protocol such
    as the Network File System (NFS; see [Chapter 58](ch58.html "Chapter 58. NETWORK
    FILE AND RESOURCE SHARING AND THE TCP/IP NETWORK FILE SYSTEM (NFS)")). |'
  id: totrans-728
  prefs: []
  type: TYPE_TB
  zh: '| 17 | 变量 | 根路径：指定客户端根磁盘的路径名。这允许客户端使用网络文件系统（NFS；见第58章[网络文件和资源共享及TCP/IP网络文件系统（NFS）]）等协议访问可能需要的文件。
    |'
- en: '| 18 | Variable | Extensions Path: Specifies the name of a file that contains
    vendor-specific fields that the client can interpret in the same way as the Options
    or Vend field in a DHCP/BOOTP message. This was defined to allow a client and
    server to still exchange vendor-specific information even though the Option/Vend
    field is now used for the general-purpose fields described in this chapter. Also
    see option 43. |'
  id: totrans-729
  prefs: []
  type: TYPE_TB
  zh: '| 18 | 可变 | 扩展路径：指定包含客户端可以像DHCP/BOOTP消息中的选项或Vend字段一样解释的厂商特定字段的文件名。这被定义为允许客户端和服务器在Option/Vend字段现在用于本章中描述的通用字段的情况下，仍然交换厂商特定信息。也请参阅选项43。|'
- en: '| 255 | 0 | End: Placed after all other options to mark the end of the option
    list. One of two options that is a single byte in length, having no Data subfield
    (the other is the Pad option). |'
  id: totrans-730
  prefs: []
  type: TYPE_TB
  zh: '| 255 | 0 | 结束：放置在其他所有选项之后，以标记选项列表的结束。这是一个长度为单字节的选项之一，没有数据子字段（另一个是填充选项）。|'
- en: IP Layer Parameters per Host
  id: totrans-731
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 每个主机的IP层参数
- en: '[Table 63-6](ch63s04.html#dhcpbootp_options_ip_layer_parameters_pe "Table 63-6. DHCP/BOOTP
    Options: IP Layer Parameters per Host") shows the parameters that control the
    operation of IP on a host as a whole. They are not interface-specific.'
  id: totrans-732
  prefs: []
  type: TYPE_NORMAL
  zh: '[表63-6](ch63s04.html#dhcpbootp_options_ip_layer_parameters_pe "表63-6. DHCP/BOOTP选项：每个主机的IP层参数")显示了控制主机上IP操作的整体参数。它们不是接口特定的。'
- en: 'Table 63-6. DHCP/BOOTP Options: IP Layer Parameters per Host'
  id: totrans-733
  prefs: []
  type: TYPE_NORMAL
  zh: 表63-6. DHCP/BOOTP选项：每个主机的IP层参数
- en: '| Code Value | Data Length (Bytes) | Name and Description |'
  id: totrans-734
  prefs: []
  type: TYPE_TB
  zh: '| 代码值 | 数据长度（字节） | 名称和描述 |'
- en: '| --- | --- | --- |'
  id: totrans-735
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| 19 | 1 | IP Forwarding Enable/Disable: A value of 1 turns on IP forwarding
    (that is, routing) on a client that is capable of that function; a value of 0
    turns it off. |'
  id: totrans-736
  prefs: []
  type: TYPE_TB
  zh: '| 19 | 1 | IP转发启用/禁用：值为1在能够执行该功能的客户端上打开IP转发（即路由）；值为0关闭它。|'
- en: '| 20 | 1 | Non-Local Source Routing Enable/Disable Option: A value of 1 tells
    a client capable of routing to allow forwarding of IP datagrams with nonlocal
    source routes. A value of 0 tells the client not to allow this. See the source
    routing IP datagram option (see [Chapter 21](ch21.html "Chapter 21. INTERNET PROTOCOL
    DATAGRAM ENCAPSULATION AND FORMATTING")) for a bit more information on this and
    option 21. |'
  id: totrans-737
  prefs: []
  type: TYPE_TB
  zh: '| 20 | 1 | 非本地源路由启用/禁用选项：值为1告诉能够路由的客户端允许转发具有非本地源路由的IP数据报。值为0告诉客户端不允许这样做。有关此选项和选项21的更多信息，请参阅源路由IP数据报选项（见[第21章](ch21.html
    "第21章. 互联网协议数据报封装和格式"))。|'
- en: '| 21 | Variable (multiple of 8) | Policy Filter: A set of address/mask pairs
    used to filter nonlocal source-routed datagrams. |'
  id: totrans-738
  prefs: []
  type: TYPE_TB
  zh: '| 21 | 可变（8的倍数） | 策略过滤器：一组地址/掩码对，用于过滤非本地源路由数据报。|'
- en: '| 22 | 2 | Maximum Datagram Reassembly Size: Tells the client the size of the
    largest datagram that the client should be prepared to reassemble. The minimum
    value is 576 bytes. |'
  id: totrans-739
  prefs: []
  type: TYPE_TB
  zh: '| 22 | 2 | 最大数据报重组大小：告知客户端客户端应准备重新组装的最大数据报的大小。最小值为576字节。|'
- en: '| 23 | 1 | Default IP Time to Live: Specifies the default value that the client
    should use for the Time to Live field in creating IP datagrams. |'
  id: totrans-740
  prefs: []
  type: TYPE_TB
  zh: '| 23 | 1 | 默认IP生存时间：指定客户端在创建IP数据报时应用于生存时间字段的默认值。|'
- en: '| 24 | 4 | Path MTU Aging Timeout: Specifies the number of seconds the client
    should use in aging path maximum transmission unit (MTU) values determined using
    path MTU discovery. |'
  id: totrans-741
  prefs: []
  type: TYPE_TB
  zh: '| 24 | 4 | 路径MTU老化超时：指定客户端应使用多少秒来老化使用路径MTU发现确定的路径最大传输单元（MTU）值。|'
- en: '| 25 | Variable (multiple of 2) | Path MTU Plateau Table: Specifies a table
    of values to be used in performing path MTU discovery. |'
  id: totrans-742
  prefs: []
  type: TYPE_TB
  zh: '| 25 | 变量（2的倍数） | 路径MTU平台表：指定用于执行路径MTU发现的值表。|'
- en: IP Layer Parameters per Interface
  id: totrans-743
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 每个接口的IP层参数
- en: '[Table 63-7](ch63s04.html#dhcpbootp_options_ip_layer_paramet-id001 "Table 63-7. DHCP/BOOTP
    Options: IP Layer Parameters per Interface") shows the parameters that are specific
    to a particular host interface at the IP level.'
  id: totrans-744
  prefs: []
  type: TYPE_NORMAL
  zh: '[表63-7](ch63s04.html#dhcpbootp_options_ip_layer_paramet-id001 "表63-7. DHCP/BOOTP选项：每个接口的IP层参数")显示了在IP层特定于特定主机接口的参数。'
- en: 'Table 63-7. DHCP/BOOTP Options: IP Layer Parameters per Interface'
  id: totrans-745
  prefs: []
  type: TYPE_NORMAL
  zh: 表63-7. DHCP/BOOTP选项：每个接口的IP层参数
- en: '| Code Value | Data Length (Bytes) | Name and Description |'
  id: totrans-746
  prefs: []
  type: TYPE_TB
  zh: '| 代码值 | 数据长度（字节） | 名称和描述 |'
- en: '| --- | --- | --- |'
  id: totrans-747
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| 26 | 2 | Interface MTU: Specifies the MTU to be used for IP datagrams on
    this interface. The minimum value is 68. |'
  id: totrans-748
  prefs: []
  type: TYPE_TB
  zh: '| 26 | 2 | 接口MTU：指定在此接口上用于IP数据报的MTU。最小值为68。|'
- en: '| 27 | 1 | All Subnets Are Local: When set to 1, tells the client that it may
    assume that all subnets of the IP network it is on have the same MTU as its own
    subnet. When 0, the client must assume that some subnets may have smaller MTUs
    than the client''s subnet. |'
  id: totrans-749
  prefs: []
  type: TYPE_TB
  zh: '| 27 | 1 | 所有子网都是本地：当设置为1时，告诉客户端它可能假设它所在的IP网络的所有子网都具有与其自己的子网相同的MTU。当为0时，客户端必须假设某些子网可能具有比客户端子网更小的MTU。
    |'
- en: '| 28 | 4 | Broadcast Address: Tells the client what address it should use for
    broadcasts on this interface. |'
  id: totrans-750
  prefs: []
  type: TYPE_TB
  zh: '| 28 | 4 | 广播地址：告诉客户端在此接口上用于广播的地址。 |'
- en: '| 29 | 1 | Perform Mask Discovery: A value of 1 tells the client that it should
    use Internet Control Message Protocol (ICMP; see [Chapter 31](ch31.html "Chapter 31. ICMP
    CONCEPTS AND GENERAL OPERATION")) to discover a subnet mask on the local subnet.
    A value of 0 tells the client not to perform this discovery. |'
  id: totrans-751
  prefs: []
  type: TYPE_TB
  zh: '| 29 | 1 | 执行掩码发现：值为1告诉客户端它应该使用Internet控制消息协议（ICMP；参见[第31章](ch31.html "第31章.
    ICMP概念和一般操作"))在本地子网上发现子网掩码。值为0告诉客户端不要执行此发现。 |'
- en: '| 30 | 1 | Mask Supplier: Set to 1 to tell the client that it should respond
    to ICMP subnet mask requests on this interface. |'
  id: totrans-752
  prefs: []
  type: TYPE_TB
  zh: '| 30 | 1 | 面具供应商：设置为1以告知客户端它应该在此接口上响应ICMP子网掩码请求。 |'
- en: '| 31 | 1 | Perform Router Discovery: A value of 1 tells the client to use the
    ICMP router discovery process to solicit a local router. A value of 0 tells the
    client to not do so. Note that DHCP itself can be used to specify one or more
    local routers using option 3. |'
  id: totrans-753
  prefs: []
  type: TYPE_TB
  zh: '| 31 | 1 | 执行路由器发现：值为1告诉客户端使用ICMP路由器发现过程来请求本地路由器。值为0告诉客户端不要这样做。注意，DHCP本身可以使用选项3指定一个或多个本地路由器。
    |'
- en: '| 32 | 4 | Router Solicitation Address: Tells the client the address to use
    as the destination for router solicitations. |'
  id: totrans-754
  prefs: []
  type: TYPE_TB
  zh: '| 32 | 4 | 路由器请求地址：告诉客户端用于路由器请求的目的地址。 |'
- en: '| 33 | Variable (multiple of 8) | Static Route: Provides the client with a
    list of static routes it can put into its routing cache. The list consists of
    a set of IP address pairs; each pair defines a destination and a router to be
    used to reach the destination. |'
  id: totrans-755
  prefs: []
  type: TYPE_TB
  zh: '| 33 | 可变（8的倍数） | 静态路由：向客户端提供它可以放入其路由缓存中的静态路由列表。该列表由一组IP地址对组成；每一对定义了一个目的地和用于到达目的地的路由器。
    |'
- en: Link Layer Parameters per Interface
  id: totrans-756
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 每个接口的链路层参数
- en: '[Table 63-8](ch63s04.html#dhcpbootp_options_link_layer_parameters_ "Table 63-8. DHCP/BOOTP
    Options: Link Layer Parameters per Interface") lists the DHCP/BOOTP options that
    are specific to a particular link layer (layer 2) interface.'
  id: totrans-757
  prefs: []
  type: TYPE_NORMAL
  zh: '[表63-8](ch63s04.html#dhcpbootp_options_link_layer_parameters_ "表63-8. DHCP/BOOTP选项：每个接口的链路层参数")列出了特定于特定链路层（第二层）接口的DHCP/BOOTP选项。'
- en: 'Table 63-8. DHCP/BOOTP Options: Link Layer Parameters per Interface'
  id: totrans-758
  prefs: []
  type: TYPE_NORMAL
  zh: 表63-8. DHCP/BOOTP选项：每个接口的链路层参数
- en: '| Code Value | Data Length (Bytes) | Name and Description |'
  id: totrans-759
  prefs: []
  type: TYPE_TB
  zh: '| 代码值 | 数据长度（字节） | 名称和描述 |'
- en: '| --- | --- | --- |'
  id: totrans-760
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| 34 | 1 | Trailer Encapsulation: When set to 1, tells the client to negotiate
    the use of trailers, as defined in RFC 893\. A value of 0 tells the client not
    to use this feature. |'
  id: totrans-761
  prefs: []
  type: TYPE_TB
  zh: '| 34 | 1 | 尾部封装：当设置为1时，告诉客户端协商使用RFC 893中定义的尾部。值为0时，告诉客户端不要使用此功能。 |'
- en: '| 35 | 4 | ARP Cache Timeout: Specifies how long, in seconds, the client should
    hold entries in its ARP cache (see [Chapter 13](ch13.html "Chapter 13. ADDRESS
    RESOLUTION AND THE TCP/IP ADDRESS RESOLUTION PROTOCOL (ARP)")). |'
  id: totrans-762
  prefs: []
  type: TYPE_TB
  zh: '| 35 | 4 | ARP缓存超时：指定客户端应在其ARP缓存中保留条目的时间长度（以秒为单位；参见[第13章](ch13.html "第13章.
    地址解析和TCP/IP地址解析协议（ARP)")). |'
- en: '| 36 | 1 | Ethernet Encapsulation: Tells the client what type of encapsulation
    to use when transmitting over Ethernet at layer 2\. If the option value is 0,
    it specifies that Ethernet II encapsulation should be used, per RFC 894; when
    the value is 1, it tells the client to use IEEE 802.3 encapsulation, per RFC 1042.
    |'
  id: totrans-763
  prefs: []
  type: TYPE_TB
  zh: '| 36 | 1 | 以太网封装：告诉客户端在第二层通过以太网传输时应使用哪种封装类型。如果选项值是0，则指定应使用RFC 894中定义的以太网II封装；当值为1时，告诉客户端使用RFC
    1042中定义的IEEE 802.3封装。 |'
- en: TCP Parameters
  id: totrans-764
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: TCP参数
- en: 'The options impacting the operation of TCP are shown in [Table 63-9](ch63s04.html#dhcpbootp_options_tcp_parameters
    "Table 63-9. DHCP/BOOTP Options: TCP Parameters").'
  id: totrans-765
  prefs: []
  type: TYPE_NORMAL
  zh: 影响TCP操作选项的显示在[表63-9](ch63s04.html#dhcpbootp_options_tcp_parameters "表63-9. DHCP/BOOTP选项：TCP参数")中。
- en: 'Table 63-9. DHCP/BOOTP Options: TCP Parameters'
  id: totrans-766
  prefs: []
  type: TYPE_NORMAL
  zh: 表63-9. DHCP/BOOTP选项：TCP参数
- en: '| Code Value | Data Length (Bytes) | Name and Description |'
  id: totrans-767
  prefs: []
  type: TYPE_TB
  zh: '| 代码值 | 数据长度（字节） | 名称和描述 |'
- en: '| --- | --- | --- |'
  id: totrans-768
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| 37 | 1 | Default TTL: Specifies the default TTL the client should use when
    sending TCP segments. |'
  id: totrans-769
  prefs: []
  type: TYPE_TB
  zh: '| 37 | 1 | 默认 TTL：指定客户端在发送 TCP 数据段时应使用的默认 TTL。|'
- en: '| 38 | 4 | TCP Keepalive Interval: Specifies how long (in seconds) the client
    should wait on an idle TCP connection before sending a keepalive message. A value
    of 0 instructs the client not to send such messages unless specifically instructed
    to do so by an application. |'
  id: totrans-770
  prefs: []
  type: TYPE_TB
  zh: '| 38 | 4 | TCP Keepalive 间隔：指定客户端在发送 keepalive 消息之前应在空闲 TCP 连接上等待多长时间（以秒为单位）。值为
    0 指示客户端除非应用程序明确指示，否则不要发送此类消息。|'
- en: '| 39 | 1 | TCP Keepalive Garbage: When set to 1, tells a client it should send
    TCP keepalive messages that include an octet of "garbage" for compatibility with
    implementations that require this. |'
  id: totrans-771
  prefs: []
  type: TYPE_TB
  zh: '| 39 | 1 | TCP Keepalive 垃圾：当设置为 1 时，告诉客户端它应该发送包含一个字节“垃圾”的 TCP keepalive 消息，以与需要此功能的实现保持兼容。|'
- en: Application and Service Parameters
  id: totrans-772
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 应用程序和服务参数
- en: '[Table 63-10](ch63s04.html#dhcpbootp_options_application_and_servic "Table 63-10. DHCP/BOOTP
    Options: Application and Service Parameters") shows the miscellaneous options
    that control the operation of various applications and services.'
  id: totrans-773
  prefs: []
  type: TYPE_NORMAL
  zh: '[表 63-10](ch63s04.html#dhcpbootp_options_application_and_servic "表 63-10. DHCP/BOOTP
    选项：应用程序和服务参数") 显示了控制各种应用程序和服务操作的各种选项。'
- en: 'Table 63-10. DHCP/BOOTP Options: Application and Service Parameters'
  id: totrans-774
  prefs: []
  type: TYPE_NORMAL
  zh: 表 63-10. DHCP/BOOTP 选项：应用程序和服务参数
- en: '| Code Value | Data Length (Bytes) | Name and Description |'
  id: totrans-775
  prefs: []
  type: TYPE_TB
  zh: '| 代码值 | 数据长度（字节）| 名称和描述 |'
- en: '| --- | --- | --- |'
  id: totrans-776
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| 40 | Variable | Network Information Service Domain: Specifies the client''s
    Network Information Service (NIS) domain. Contrast this with option 64. |'
  id: totrans-777
  prefs: []
  type: TYPE_TB
  zh: '| 40 | 变量 | 网络信息服务域：指定客户端的 Network Information Service（NIS）域。与选项 64 对比。|'
- en: '| 41 | Variable (multiple of 4) | Network Information Servers: Specifies a
    list of IP addresses of NIS servers the client may use. Servers are listed in
    the order of preference for the client to use. Contrast this with option 65. |'
  id: totrans-778
  prefs: []
  type: TYPE_TB
  zh: '| 41 | 变量（4 的倍数）| 网络信息服务器：指定客户端可能使用的 NIS 服务器 IP 地址列表。服务器按客户端使用的优先顺序列出。与选项 65
    对比。|'
- en: '| 42 | Variable (multiple of 4) | Network Time Protocol Servers: Specifies
    a list of IP addresses of Network Time Protocol (NTP) servers the client may use.
    Servers are listed in the order of preference for the client to use. |'
  id: totrans-779
  prefs: []
  type: TYPE_TB
  zh: '| 42 | 变量（4 的倍数）| 网络时间协议服务器：指定客户端可能使用的网络时间协议（NTP）服务器 IP 地址列表。服务器按客户端使用的优先顺序列出。|'
- en: '| 43 | Variable | Vendor Specific Information: Allows an arbitrary set of vendor-specific
    information items to be included as a single option within a DHCP or BOOTP message.
    This information is structured using the same format as the Options or Vend field
    itself, except that it does not start with a magic cookie. See the "DHCP Options"
    section earlier in this chapter for more details. |'
  id: totrans-780
  prefs: []
  type: TYPE_TB
  zh: '| 43 | 变量 | 供应商特定信息：允许将任意一组供应商特定信息项作为单个选项包含在 DHCP 或 BOOTP 消息中。此信息使用与选项或 Vend
    字段相同的格式进行结构化，但不需要以魔法cookie开头。有关更多详细信息，请参阅本章前面的“DHCP 选项”部分。|'
- en: '| 44 | Variable (multiple of 4) | NetBIOS over TCP/IP Name Servers: Specifies
    a list of IP addresses of NetBIOS name servers (per RFC 1001/1002) that the client
    may use. Servers are listed in the order of preference for the client to use.
    |'
  id: totrans-781
  prefs: []
  type: TYPE_TB
  zh: '| 44 | 变量（4 的倍数）| NetBIOS over TCP/IP 命名服务器：指定客户端可能使用的 NetBIOS 命名服务器（根据 RFC
    1001/1002）的 IP 地址列表。服务器按客户端使用的优先顺序列出。|'
- en: '| 45 | Variable (multiple of 4) | NetBIOS over TCP/IP Datagram Distribution
    Servers: Specifies a list of IP addresses of NetBIOS datagram distribution servers
    (per RFC 1001/1002) that the client may use. Servers are listed in the order of
    preference for the client to use. |'
  id: totrans-782
  prefs: []
  type: TYPE_TB
  zh: '| 45 | 变量（4 的倍数）| NetBIOS over TCP/IP 数据报分发服务器：指定客户端可能使用的 NetBIOS 数据报分发服务器（根据
    RFC 1001/1002）的 IP 地址列表。服务器按客户端使用的优先顺序列出。|'
- en: '| 46 | 1 | NetBIOS over TCP/IP Node Type: Tells the client what sort of NetBIOS
    node type it should use. Four different bit values are used to define the possible
    node type combinations, as listed in [Table 63-11](ch63s04.html#netbios_over_tcpip_node_type_option__val
    "Table 63-11. NetBIOS Over TCP/IP Node Type (Option 46) Values"). |'
  id: totrans-783
  prefs: []
  type: TYPE_TB
  zh: '| 46 | 1 | NetBIOS over TCP/IP 节点类型：告诉客户端应使用哪种 NetBIOS 节点类型。使用四个不同的位值来定义可能的节点类型组合，如
    [表 63-11](ch63s04.html#netbios_over_tcpip_node_type_option__val "表 63-11. NetBIOS
    Over TCP/IP 节点类型（选项 46）值") 中列出。|'
- en: '| 47 | Variable | NetBIOS over TCP/IP Scope: Specifies the NetBIOS over TCP/IP
    scope parameter for the client. |'
  id: totrans-784
  prefs: []
  type: TYPE_TB
  zh: '| 47 | 变量 | NetBIOS over TCP/IP 范围：指定客户端的 NetBIOS over TCP/IP 范围参数。|'
- en: '| 48 | Variable (multiple of 4) | X Window System Font Servers: Specifies a
    list of IP addresses of X Window System Font servers that the client may use.
    Servers are listed in the order of preference for the client to use. |'
  id: totrans-785
  prefs: []
  type: TYPE_TB
  zh: '| 48 | 变量（4的倍数） | X窗口系统字体服务器：指定客户端可能使用的X窗口系统字体服务器的IP地址列表。服务器按客户端使用的优先顺序列出。
    |'
- en: '| 49 | Variable (multiple of 4) | X Window System Display Manager: Specifies
    a list of IP addresses of systems running the X Window System Display Manager
    that the client may use. Addresses are listed in the order of preference for the
    client to use. |'
  id: totrans-786
  prefs: []
  type: TYPE_TB
  zh: '| 49 | 变量（4的倍数） | X窗口系统显示管理器：指定客户端可能使用的运行X窗口系统显示管理器的系统的IP地址列表。地址按客户端使用的优先顺序列出。
    |'
- en: '| 64 | Variable | Network Information Service+ Domain: Specifies the client''s
    NIS+ domain. Contrast this with option 40. |'
  id: totrans-787
  prefs: []
  type: TYPE_TB
  zh: '| 64 | 变量 | 网络信息服务+域：指定客户端的NIS+域。与选项40相对比。 |'
- en: '| 65 | Variable (multiple of 4) | Network Information Service+ Servers: Specifies
    a list of IP addresses of NIS+ servers the client may use. Servers are listed
    in the order of preference for the client to use. Contrast this with option 41.
    |'
  id: totrans-788
  prefs: []
  type: TYPE_TB
  zh: '| 65 | 变量（4的倍数） | 网络信息服务+服务器：指定客户端可能使用的NIS+服务器的IP地址列表。服务器按客户端使用的优先顺序列出。与选项41相对比。
    |'
- en: '| 68 | Variable (multiple of 4) | Mobile IP Home Agent: Specifies a list of
    IP addresses of home agents that the client can use in Mobile IP (see [Chapter 30](ch30.html
    "Chapter 30. INTERNET PROTOCOL MOBILITY SUPPORT (MOBILE IP)")). Agents are listed
    in the order of preference for the client to use; normally a single agent is specified.
    |'
  id: totrans-789
  prefs: []
  type: TYPE_TB
  zh: '| 68 | 变量（4的倍数） | 移动IP家庭代理：指定客户端在移动IP（参见[第30章](ch30.html "第30章. 互联网协议移动支持（移动IP）")）中可以使用的家庭代理的IP地址列表。代理按客户端使用的优先顺序列出；通常指定单个代理。
    |'
- en: '| 69 | Variable (multiple of 4) | Simple Mail Transport Protocol (SMTP) Servers:
    Specifies a list of IP addresses of SMTP servers the client may use. Servers are
    listed in the order of preference for the client to use. See [Chapter 77](ch77.html
    "Chapter 77. TCP/IP ELECTRONIC MAIL DELIVERY PROTOCOL: THE SIMPLE MAIL TRANSFER
    PROTOCOL (SMTP)") for more on SMTP. |'
  id: totrans-790
  prefs: []
  type: TYPE_TB
  zh: '| 69 | 变量（4的倍数） | 简单邮件传输协议（SMTP）服务器：指定客户端可能使用的SMTP服务器的IP地址列表。服务器按客户端使用的优先顺序列出。有关SMTP的更多信息，请参见[第77章](ch77.html
    "第77章. TCP/IP 电子邮件投递协议：简单邮件传输协议（SMTP）")。 |'
- en: '| 70 | Variable (multiple of 4) | Post Office Protocol (POP3) Servers: Specifies
    a list of IP addresses of POP3 servers the client may use. Servers are listed
    in the order of preference for the client to use. See [Chapter 78](ch78.html "Chapter 78. TCP/IP
    ELECTRONIC MAIL ACCESS AND RETRIEVAL PROTOCOLS AND METHODS"). |'
  id: totrans-791
  prefs: []
  type: TYPE_TB
  zh: '| 70 | 变量（4的倍数） | 邮局协议（POP3）服务器：指定客户端可能使用的POP3服务器的IP地址列表。服务器按客户端使用的优先顺序列出。参见[第78章](ch78.html
    "第78章. TCP/IP 电子邮件访问和检索协议与方法")。 |'
- en: '| 71 | Variable (multiple of 4) | Network News Transfer Protocol (NNTP) Servers:
    Specifies a list of IP addresses of NNTP servers the client may use. Servers are
    listed in the order of preference for the client to use. See [Chapter 85](ch85.html
    "Chapter 85. USENET (NETWORK NEWS) AND THE TCP/IP NETWORK NEWS TRANSFER PROTOCOL
    (NNTP)"). |'
  id: totrans-792
  prefs: []
  type: TYPE_TB
  zh: '| 71 | 变量（4的倍数） | 网络新闻传输协议（NNTP）服务器：指定客户端可能使用的NNTP服务器的IP地址列表。服务器按客户端使用的优先顺序列出。参见[第85章](ch85.html
    "第85章. USENET（网络新闻）和TCP/IP网络新闻传输协议（NNTP）")。 |'
- en: '| 72 | Variable (multiple of 4) | Default World Wide Web (WWW) Servers: Specifies
    a list of IP addresses of World Wide Web (HTTP) servers the client may use. Servers
    are listed in the order of preference for the client to use. See [Chapter 79](ch79.html
    "Chapter 79. WORLD WIDE WEB AND HYPERTEXT OVERVIEW AND CONCEPTS"). |'
  id: totrans-793
  prefs: []
  type: TYPE_TB
  zh: '| 72 | 变量（4的倍数） | 默认万维网（WWW）服务器：指定客户端可能使用的万维网（HTTP）服务器的IP地址列表。服务器按客户端使用的优先顺序列出。参见[第79章](ch79.html
    "第79章. 万维网和超文本概述与概念")。 |'
- en: '| 73 | Variable (multiple of 4) | Default Finger Servers: Specifies a list
    of IP addresses of Finger servers the client may use. Servers are listed in the
    order of preference for the client to use. |'
  id: totrans-794
  prefs: []
  type: TYPE_TB
  zh: '| 73 | 变量（4的倍数） | 默认Finger服务器：指定客户端可能使用的Finger服务器的IP地址列表。服务器按客户端使用的优先顺序列出。
    |'
- en: '| 74 | Variable (multiple of 4) | Default Internet Relay Chat (IRC) Servers:
    Specifies a list of IP addresses of Internet Relay Chat (IRC) servers the client
    may use. Servers are listed in the order of preference for the client to use.
    |'
  id: totrans-795
  prefs: []
  type: TYPE_TB
  zh: '| 74 | 变量（4的倍数） | 默认互联网中继聊天（IRC）服务器：指定客户端可能使用的互联网中继聊天（IRC）服务器的IP地址列表。服务器按客户端使用的优先顺序列出。
    |'
- en: '| 75 | Variable (multiple of 4) | StreetTalk Servers: Specifies a list of IP
    addresses of StreetTalk servers the client may use. Servers are listed in the
    order of preference for the client to use. |'
  id: totrans-796
  prefs: []
  type: TYPE_TB
  zh: '| 75 | 可变（4 的倍数） | StreetTalk 服务器：指定客户端可能使用的 StreetTalk 服务器 IP 地址列表。服务器按客户端使用的优先顺序列出。
    |'
- en: '| 76 | Variable (multiple of 4) | StreetTalk Directory Assistance (STDA) Servers:
    Specifies a list of IP addresses of STDA servers the client may use. Servers are
    listed in the order of preference for the client to use. |'
  id: totrans-797
  prefs: []
  type: TYPE_TB
  zh: '| 76 | 可变（4 的倍数） | StreetTalk 目录辅助（STDA）服务器：指定客户端可能使用的 STDA 服务器的 IP 地址列表。服务器按客户端使用的优先顺序列出。
    |'
- en: Table 63-11. NetBIOS Over TCP/IP Node Type (Option 46) Values
  id: totrans-798
  prefs: []
  type: TYPE_NORMAL
  zh: 表 63-11. NetBIOS 通过 TCP/IP 节点类型（选项 46）值
- en: '| Option 46 Subfield Name | Size (Bits) | Description |'
  id: totrans-799
  prefs: []
  type: TYPE_TB
  zh: '| 选项 46 子字段名称 | 大小（位） | 描述 |'
- en: '| --- | --- | --- |'
  id: totrans-800
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| Reserved | 4 | Reserved: Not used. |'
  id: totrans-801
  prefs: []
  type: TYPE_TB
  zh: '| 保留 | 4 | 保留：未使用。 |'
- en: '| H-Node | 1 | H-Node: Set to 1 to tell the client to act as a NetBIOS H-node.
    |'
  id: totrans-802
  prefs: []
  type: TYPE_TB
  zh: '| H-Node | 1 | H-Node：设置为 1 以指示客户端作为 NetBIOS H-节点操作。 |'
- en: '| M-Node | 1 | M-Node: Set to 1 to tell the client to act as a NetBIOS M-node.
    |'
  id: totrans-803
  prefs: []
  type: TYPE_TB
  zh: '| M-Node | 1 | M-Node：设置为 1 以指示客户端作为 NetBIOS M-节点操作。 |'
- en: '| P-Node | 1 | P-Node: Set to 1 to tell the client to act as a NetBIOS P-node.
    |'
  id: totrans-804
  prefs: []
  type: TYPE_TB
  zh: '| P-Node | 1 | P-Node：设置为 1 以指示客户端作为 NetBIOS P-节点操作。 |'
- en: '| B-Node | 1 | B-Node: Set to 1 to tell the client to act as a NetBIOS B-node.
    |'
  id: totrans-805
  prefs: []
  type: TYPE_TB
  zh: '| B-Node | 1 | B-Node：设置为 1 以指示客户端作为 NetBIOS B-节点操作。 |'
- en: DHCP Extensions
  id: totrans-806
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP 扩展
- en: 'Last, but certainly not least, [Table 63-12](ch63s04.html#dhcp_options_dhcp_extensions
    "Table 63-12. DHCP Options: DHCP Extensions") describes the DHCP-only options
    that control the operation of the DHCP protocol.'
  id: totrans-807
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，但同样重要的是，[表 63-12](ch63s04.html#dhcp_options_dhcp_extensions "表 63-12. DHCP
    选项：DHCP 扩展") 描述了仅用于控制 DHCP 协议操作的 DHCP 专用选项。
- en: 'Table 63-12. DHCP Options: DHCP Extensions'
  id: totrans-808
  prefs: []
  type: TYPE_NORMAL
  zh: 表 63-12. DHCP 选项：DHCP 扩展
- en: '| Code Value | Data Length (Bytes) | Name and Description |'
  id: totrans-809
  prefs: []
  type: TYPE_TB
  zh: '| 代码值 | 数据长度（字节） | 名称和描述 |'
- en: '| --- | --- | --- |'
  id: totrans-810
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| 50 | 4 | Requested IP Address: Used in a client''s DHCPDISCOVER message to
    request a particular IP address assignment. |'
  id: totrans-811
  prefs: []
  type: TYPE_TB
  zh: '| 50 | 4 | 请求的 IP 地址：在客户端的 DHCPDISCOVER 消息中用于请求特定的 IP 地址分配。 |'
- en: '| 51 | 4 | IP Address Lease Time: Used in a client request to ask a server
    for a particular DHCP lease duration, or in a server reply to tell the client
    the offered lease time. It is specified in units of seconds. |'
  id: totrans-812
  prefs: []
  type: TYPE_TB
  zh: '| 51 | 4 | IP 地址租约时间：在客户端请求中用于请求特定的 DHCP 租约持续时间，或在服务器回复中告知客户端提供的租约时间。它以秒为单位指定。
    |'
- en: '| 52 | 1 | Option Overload: Used to tell the recipient of a DHCP message that
    the message''s SName and/or File fields are being used to carry options, instead
    having their normal meanings. This option implements the option overload feature.
    There are three possible values for this single-byte option: 1 means the File
    field is carrying the option data, 2 means the SName field has the option data,
    and 3 means both fields have the option data. |'
  id: totrans-813
  prefs: []
  type: TYPE_TB
  zh: '| 52 | 1 | 选项过载：用于告知 DHCP 消息的接收者，消息的 SName 和/或 File 字段正在用于携带选项，而不是它们的正常含义。此选项实现了选项过载功能。此单字节选项有三个可能的值：1
    表示 File 字段携带选项数据，2 表示 SName 字段包含选项数据，3 表示两个字段都包含选项数据。 |'
- en: '| 53 | 1 | DHCP Message Type: Indicates the specific type of DHCP message,
    as listed in Table 6-13. |'
  id: totrans-814
  prefs: []
  type: TYPE_TB
  zh: '| 53 | 1 | DHCP 消息类型：指示 DHCP 消息的具体类型，如表 6-13 中所示。 |'
- en: '| 54 | 4 | Server Identifier: The IP address of a particular DHCP server. This
    option is included in messages sent by DHCP servers to identify themselves as
    the source of the message. It is also used by a client in a DHCPREQUEST message
    to specify which server''s lease it is accepting. |'
  id: totrans-815
  prefs: []
  type: TYPE_TB
  zh: '| 54 | 4 | 服务器标识符：特定 DHCP 服务器的 IP 地址。此选项包含在 DHCP 服务器发送的消息中，以标识其为消息的来源。它还由客户端在
    DHCPREQUEST 消息中使用，以指定它接受的租约是哪个服务器的。 |'
- en: '| 55 | Variable | Parameter Request List: Used by a DHCP client to request
    a list of particular configuration parameter values from a DHCP server. |'
  id: totrans-816
  prefs: []
  type: TYPE_TB
  zh: '| 55 | 可变 | 参数请求列表：由 DHCP 客户端用于从 DHCP 服务器请求特定配置参数值的列表。 |'
- en: '| 56 | Variable | Message: Used by a server or client to indicate an error
    or other message. |'
  id: totrans-817
  prefs: []
  type: TYPE_TB
  zh: '| 56 | 可变 | 消息：由服务器或客户端用于指示错误或其他消息。 |'
- en: '| 57 | 2 | Maximum DHCP Message Size: Used by a DHCP client or server to specify
    the maximum size of DHCP message it is willing to accept. The minimum legal value
    is 576 bytes. |'
  id: totrans-818
  prefs: []
  type: TYPE_TB
  zh: '| 57 | 2 | 最大 DHCP 消息大小：由 DHCP 客户端或服务器用于指定它愿意接受的最大 DHCP 消息大小。最小合法值是 576 字节。
    |'
- en: '| 58 | 4 | Renewal (T1) Time Value: Tells the client the value to use for its
    renewal timer. |'
  id: totrans-819
  prefs: []
  type: TYPE_TB
  zh: '| 58 | 4 | 更新（T1）时间值：告知客户端用于其更新计时器的值。 |'
- en: '| 59 | 4 | Rebinding (T2) Time Value: Tells the client the value to use for
    its rebinding timer. |'
  id: totrans-820
  prefs: []
  type: TYPE_TB
  zh: '| 59 | 4 | 绑定（T2）时间值：告诉客户端用于其绑定定时器的值。 |'
- en: '| 60 | Variable | Vendor Class Identifier: Included in a message sent by a
    DHCP client to specify its vendor and configuration. This may be used to prompt
    a server to send the correct vendor-specific information using option 43. |'
  id: totrans-821
  prefs: []
  type: TYPE_TB
  zh: '| 60 | 可变 | 供应商类标识符：在DHCP客户端发送的消息中包含，以指定其供应商和配置。这可能被用来提示服务器使用选项43发送正确的供应商特定信息。'
- en: '| 61 | Variable | Client Identifier: Used optionally by a client to specify
    a unique client identification for itself that differs from the DHCP default.
    This identifier is expected by servers to be unique among all DHCP clients and
    is used to index the DHCP server''s configuration parameter database. |'
  id: totrans-822
  prefs: []
  type: TYPE_TB
  zh: '| 61 | 可变 | 客户端标识符：客户端可选地用来指定一个与DHCP默认值不同的唯一客户端标识符。服务器期望此标识符在所有DHCP客户端中是唯一的，并用于索引DHCP服务器的配置参数数据库。'
- en: '| 66 | Variable | TFTP Server Name: When the DHCP message''s SName field has
    been used for options using the option overload feature, this option may be included
    to specify the Trivial File Transfer Protocol (TFTP) server name that would normally
    appear in the SName field. |'
  id: totrans-823
  prefs: []
  type: TYPE_TB
  zh: '| 66 | 可变 | TFTP服务器名称：当DHCP消息的SName字段被用于选项 overload功能时，此选项可能被包含以指定通常出现在SName字段中的简单文件传输协议（TFTP）服务器名称。'
- en: '| 67 | Variable | Bootfile Name: When the DHCP message''s File field has been
    used for options using the option overload feature, this option may be included
    to specify the boot filename that would normally appear in the File field. |'
  id: totrans-824
  prefs: []
  type: TYPE_TB
  zh: '| 67 | 可变 | 引导文件名：当DHCP消息的文件字段被用于选项 overload功能时，此选项可能被包含以指定通常出现在文件字段中的引导文件名。'
- en: Table 63-13. DHCP Message Type (Option 53) Values
  id: totrans-825
  prefs: []
  type: TYPE_NORMAL
  zh: 表63-13. DHCP消息类型（选项53）值
- en: '| Option 53 Value | DHCP Message Type |'
  id: totrans-826
  prefs: []
  type: TYPE_TB
  zh: '| 选项53值 | DHCP消息类型 |'
- en: '| --- | --- |'
  id: totrans-827
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| 1 | DHCPDISCOVER |'
  id: totrans-828
  prefs: []
  type: TYPE_TB
  zh: '| 1 | DHCPDISCOVER |'
- en: '| 2 | DHCPOFFER |'
  id: totrans-829
  prefs: []
  type: TYPE_TB
  zh: '| 2 | DHCPOFFER |'
- en: '| 3 | DHCPREQUEST |'
  id: totrans-830
  prefs: []
  type: TYPE_TB
  zh: '| 3 | DHCPREQUEST |'
- en: '| 4 | DHCPDECLINE |'
  id: totrans-831
  prefs: []
  type: TYPE_TB
  zh: '| 4 | DHCPDECLINE |'
- en: '| 5 | DHCPACK |'
  id: totrans-832
  prefs: []
  type: TYPE_TB
  zh: '| 5 | DHCPACK |'
- en: '| 6 | DHCPNAK |'
  id: totrans-833
  prefs: []
  type: TYPE_TB
  zh: '| 6 | DHCPNAK |'
- en: '| 7 | DHCPRELEASE |'
  id: totrans-834
  prefs: []
  type: TYPE_TB
  zh: '| 7 | DHCPRELEASE |'
- en: '| 8 | DHCPINFORM |'
  id: totrans-835
  prefs: []
  type: TYPE_TB
  zh: '| 8 | DHCPINFORM |'
- en: Chapter 64. DHCP CLIENT/SERVER IMPLEMENTATION, FEATURES, AND IPV6 SUPPORT
  id: totrans-836
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第64章。DHCP客户端/服务器实现、功能及IPv6支持
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages287681.png.jpg)'
  id: totrans-837
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages287681.png.jpg)'
- en: 'The preceding chapters in this part describe the fundamentals of the operation
    of DHCP: the address leasing system, configuration processes, and messaging. With
    this foundation in place, we can now proceed to look into some of the more interesting
    details of how DHCP is implemented. We can also delve into some of the extra capabilities
    and special features that change the basic DHCP mechanisms we have already studied.'
  id: totrans-838
  prefs: []
  type: TYPE_NORMAL
  zh: 本部分的前几章描述了DHCP操作的基础：地址租赁系统、配置过程和消息。有了这个基础，我们现在可以进一步探讨DHCP实现的一些更有趣的细节。我们还可以深入研究一些额外的功能和特殊功能，这些功能改变了我们已研究的基本DHCP机制。
- en: In this chapter, I discuss DHCP client/server implementation issues, special
    features that enhance the protocol, and some of the problems and issues related
    to making DHCP work. I begin with a discussion of DHCP server and client implementation
    and management issues. I discuss DHCP message relaying and how it is related to
    the relaying feature used for the Boot Protocol (BOOTP). I describe the DHCP feature
    for providing automatic default addressing when a client cannot contact a server,
    and the conflict detection feature for multiple servers. I then cover some of
    the issues related to interoperability of DHCP and BOOTP, and provide an outline
    of some of the more important problems and issues related to DHCP security. I
    conclude with an overview of DHCP for IP version 6 (DHCPv6).
  id: totrans-839
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我讨论了DHCP客户端/服务器实现问题、增强协议的特殊功能以及与使DHCP工作相关的一些问题和挑战。我首先讨论了DHCP服务器和客户端的实现与管理问题。我讨论了DHCP消息中继及其与用于引导协议（BOOTP）的中继功能的相关性。我描述了当客户端无法联系服务器时，DHCP提供自动默认地址的功能以及用于多服务器的冲突检测功能。然后，我涵盖了与DHCP和BOOTP互操作性相关的一些问题，并概述了一些与DHCP安全相关的重要问题和挑战。最后，我概述了IPv6（DHCPv6）的DHCP。
- en: DHCP Server and Client Implementation and Management Issues
  id: totrans-840
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP服务器和客户端实现与管理问题
- en: DHCP is a client/server protocol, relying on both the server and client to fulfill
    certain responsibilities. Of the two device roles, the DHCP server is arguably
    the more important, because it is in the server that most of the functionality
    of DHCP is actually implemented.
  id: totrans-841
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP是一种客户端/服务器协议，依赖于服务器和客户端共同履行某些职责。在这两个设备角色中，DHCP服务器可以说是更重要的，因为大多数DHCP功能实际上是在服务器中实现的。
- en: DHCP Server Implementations
  id: totrans-842
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP服务器实现
- en: The server maintains the configuration database, keeps track of address ranges,
    and manages leases. For this reason, DHCP servers are typically much more complex
    than DHCP clients. In essence, without a DHCP server, there really is no DHCP.
    Thus, deciding how to implement DHCP servers is a large part of implementing the
    protocol.
  id: totrans-843
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器维护配置数据库，跟踪地址范围，并管理租约。因此，DHCP服务器通常比DHCP客户端复杂得多。本质上，没有DHCP服务器，实际上就没有DHCP。因此，决定如何实现DHCP服务器是实现协议的重要组成部分。
- en: A classic DHCP server consists of DHCP server software running on a server hardware
    platform of one sort or another. A DHCP server usually will not be a dedicated
    computer, except on very large networks. It is more common for a hardware server
    to provide DHCP services along with performing other functions, such as acting
    as an application server, serving as a general database server, providing DNS
    services, and so forth. So, a DHCP server does not need to be a special computer;
    any device that can run a DHCP server implementation can act as a server.
  id: totrans-844
  prefs: []
  type: TYPE_NORMAL
  zh: 经典的DHCP服务器由运行在某种服务器硬件平台上的DHCP服务器软件组成。通常，DHCP服务器不会是专用计算机，除非是在非常大的网络中。更常见的是，硬件服务器在执行其他功能的同时提供DHCP服务，例如充当应用服务器、通用数据库服务器、提供DNS服务等等。因此，DHCP服务器不需要是特殊的计算机；任何可以运行DHCP服务器实现的设备都可以充当服务器。
- en: In fact, the DHCP server may not even need to be a host computer at all. Today,
    many routers include DHCP functionality. Programming a router to act as a DHCP
    server allows clients that connect to the router to be automatically assigned
    IP addresses. This provides numerous potential advantages in an environment where
    a limited number of public IP addresses is shared among multiple clients, or where
    IP Network Address Translation (NAT; see [Chapter 28](ch28.html "Chapter 28. IP
    NETWORK ADDRESS TRANSLATION (NAT) PROTOCOL")) is used to dynamically share a small
    number of addresses. Since DHCP requires a database, a router that acts as a DHCP
    server requires some form of permanent storage. This is often implemented using
    flash memory on routers; "true" servers use hard disk storage.
  id: totrans-845
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，DHCP服务器甚至可能不需要是一台主机计算机。如今，许多路由器都集成了DHCP功能。编程路由器以充当DHCP服务器允许连接到路由器的客户端自动分配IP地址。这在有限数量的公共IP地址在多个客户端之间共享的环境中，或者在使用IP网络地址转换（NAT；参见[第28章](ch28.html
    "第28章。IP网络地址转换(NAT)协议"）动态共享少量地址的环境中提供了许多潜在优势。由于DHCP需要数据库，充当DHCP服务器的路由器需要某种形式的永久存储。这通常是通过路由器上的闪存来实现；"真正的"服务器使用硬盘存储。
- en: Virtually all modern operating systems include support for DHCP, including most
    variants of UNIX, Linux, newer versions of Microsoft Windows, Novell NetWare,
    and others. In some cases, you may need to run the server version of the operating
    system to have a host act as a DHCP server. For example, while Microsoft Windows
    XP supports DHCP, I don't believe that a DHCP server comes in the Windows XP Home
    Edition, though you could install one yourself.
  id: totrans-846
  prefs: []
  type: TYPE_NORMAL
  zh: 几乎所有现代操作系统都包括对DHCP的支持，包括UNIX、Linux的大多数变种、较新版本的Microsoft Windows、Novell NetWare以及其他操作系统。在某些情况下，你可能需要运行操作系统的服务器版本，以便让主机充当DHCP服务器。例如，虽然Microsoft
    Windows XP支持DHCP，但我相信Windows XP家庭版中并没有内置DHCP服务器，尽管你可以自行安装一个。
- en: DHCP Server Software Features
  id: totrans-847
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: DHCP服务器软件功能
- en: 'In most networks, you will choose the operating system based on a large number
    of factors. The choice of operating system will then dictate what options you
    have for selecting DHCP server software. Most common operating systems have a
    number of options available for software. While all will implement the core DHCP
    protocol, they will differ in terms of the usual software attributes: cost, performance,
    ease of use, and so on. They may also differ in terms of their features, such
    as the following:'
  id: totrans-848
  prefs: []
  type: TYPE_NORMAL
  zh: 在大多数网络中，你将根据大量因素选择操作系统。然后，操作系统的选择将决定你选择DHCP服务器软件的选项。大多数常见的操作系统都有多种软件选项。虽然所有这些都将实现核心DHCP协议，但它们在通常的软件属性方面会有所不同：成本、性能、易用性等。它们也可能在功能方面有所不同，例如以下方面：
- en: How they allow address ranges (scopes) to be defined
  id: totrans-849
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 他们如何定义地址范围（作用域）
- en: How clients can be grouped and managed
  id: totrans-850
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户端如何分组和管理
- en: The level of control an administrator has over parameters returned to a client
  id: totrans-851
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理员对返回给客户端的参数的控制级别
- en: The level of control an administrator has over general operation of the protocol,
    such as specification of the T1 and T2 timers and other variables, and how leases
    are allocated and renewals handled
  id: totrans-852
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理员对协议的一般操作的控制级别，例如指定T1和T2计时器和其他变量，以及如何分配租赁和如何处理续订
- en: Security features
  id: totrans-853
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安全功能
- en: Ability to interact with DNS to support dynamic device naming
  id: totrans-854
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 能够与DNS交互以支持动态设备命名
- en: Optional features such as BOOTP support, conflict detection, and Automatic Private
    IP Addressing (all discussed later in this chapter)
  id: totrans-855
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可选功能，如BOOTP支持、冲突检测和自动私有IP地址分配（本章后面将讨论）
- en: Choosing the Number of Servers
  id: totrans-856
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 选择服务器数量
- en: In setting up DHCP for a network, there are a number of important factors to
    consider and decisions to be made. One of the most critical is the number of servers
    you want to have. In theory, each network requires only one DHCP server; in practice,
    this is often not a great idea. Servers sometimes experience hardware or software
    failures, or they must be taken down for maintenance. If there is only one server
    and clients can't reach it, no DHCP clients will be able to get addresses. For
    this reason, two or more servers are often used.
  id: totrans-857
  prefs: []
  type: TYPE_NORMAL
  zh: 在为网络设置DHCP时，需要考虑和做出许多重要因素和决策。其中最关键的是您希望拥有的服务器数量。理论上，每个网络只需要一个DHCP服务器；在实践中，这通常不是一个好主意。服务器有时会经历硬件或软件故障，或者必须关闭进行维护。如果只有一个服务器并且客户端无法访问它，那么没有任何DHCP客户端能够获取地址。因此，通常使用两个或更多服务器。
- en: If you do use more than one server, you need to carefully plan how you will
    configure each one. One of the first decisions you will need to make is which
    servers will be responsible for which addresses and clients. You need to determine
    whether you want the servers to have distinct or overlapping address pools, as
    discussed in the explanation of DHCP address ranges in [Chapter 61](ch61.html
    "Chapter 61. DHCP OVERVIEW AND ADDRESS ALLOCATION CONCEPTS"). Distinct pools ensure
    that addresses remain unique, but result in unallocatable addresses if a server
    fails. Overlapping addresses are more flexible, but risk address conflicts unless
    a feature like conflict detection (described later in this chapter) is used.
  id: totrans-858
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用多个服务器，您需要仔细规划如何配置每个服务器。您需要做出的第一个决定之一是哪些服务器将负责哪些地址和客户端。您需要确定您是否希望服务器具有不同的或重叠的地址池，正如在[第61章](ch61.html
    "第61章。DHCP概述和地址分配概念")中解释DHCP地址范围时所述。不同的池确保地址保持唯一，但如果服务器失败，会导致地址不可分配。重叠的地址更灵活，但如果未使用冲突检测（本章后面将讨论）等特性，则存在地址冲突的风险。
- en: Server Placement, Setup, and Maintenance
  id: totrans-859
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 服务器位置、设置和维护
- en: Once you know how many servers you want, you need to determine on which part
    of the network you want to place them. If you have many physical networks, you
    may also need to use DHCP relaying to allow all clients to reach a server. Since
    the structure of the network may affect the number of servers you use, many of
    these decisions are interrelated.
  id: totrans-860
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您知道您想要多少个服务器，您需要确定您想在网络的哪个部分放置它们。如果您有多个物理网络，您可能还需要使用DHCP中继来允许所有客户端都能访问服务器。由于网络结构可能会影响您使用的服务器数量，许多这些决策是相互关联的。
- en: You must make policy decisions related to all the DHCP operating parameters
    discussed in the previous chapters. The two big decisions are the size and structure
    of the address pool, and making lease policy decisions such as the lease length
    and the settings for the T1 and T2 timers. You also must decide which clients
    will be dynamically allocated addresses and how manually configured clients will
    be handled.
  id: totrans-861
  prefs: []
  type: TYPE_NORMAL
  zh: 您必须就前几章中讨论的所有DHCP操作参数做出政策决策。两个主要决策是地址池的大小和结构，以及做出租赁策略决策，例如租赁长度和T1和T2计时器的设置。您还必须决定哪些客户端将动态分配地址，以及如何处理手动配置的客户端。
- en: Finally, it's essential for the administrator to remember that an organization's
    DHCP server is a database server and must be treated accordingly. Like any database
    server, it must be maintained and managed carefully. Administrative policies must
    be put into place to ensure the security and efficient operation of the server.
    Also, unlike certain other types of database systems, the DHCP database is not
    automatically replicated; the server database should therefore be routinely backed
    up, and using RAID storage is also a good idea.
  id: totrans-862
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，管理员必须记住，组织的 DHCP 服务器是一个数据库服务器，必须相应地对待。像任何数据库服务器一样，它必须得到仔细的维护和管理。必须制定管理政策以确保服务器的安全和高效运行。此外，与某些其他类型的数据库系统不同，DHCP
    数据库不是自动复制的；因此，服务器数据库应定期备份，使用 RAID 存储也是一个好主意。
- en: DHCP Client Implementations
  id: totrans-863
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP 客户端实现
- en: Just as a DHCP server consists of server software running on a server platform
    or hardware acting as a server, a DHCP client is simply DHCP client software running
    on a client device. Most often, a client device is a host computer connected to
    a TCP/IP internetwork. DHCP is so widely accepted today that virtually all hosts
    include DHCP client software. The DHCP client is usually integrated into graphical
    operating systems like Windows, or is implemented using a specific client daemon
    like *dhclient* or *dhcpd* on UNIX/Linux.
  id: totrans-864
  prefs: []
  type: TYPE_NORMAL
  zh: 正如 DHCP 服务器由运行在服务器平台或硬件上的服务器软件组成一样，DHCP 客户端只是运行在客户端设备上的 DHCP 客户端软件。最常见的情况是，客户端设备是连接到
    TCP/IP 内部网络的宿主计算机。今天，DHCP 得到了如此广泛的接受，几乎所有的宿主都包含了 DHCP 客户端软件。DHCP 客户端通常集成到图形操作系统如
    Windows 中，或者在 UNIX/Linux 上使用特定的客户端守护进程，如 *dhclient* 或 *dhcpd*。
- en: Since the entire idea behind DHCP is to put the server in charge of parameter
    storage, configuration, and address management, DHCP clients are relatively simple.
    The client implements the messaging protocol and communicates parameters received
    from the DHCP server to the rest of the TCP/IP software components as needed.
    It doesn't do a whole lot else.
  id: totrans-865
  prefs: []
  type: TYPE_NORMAL
  zh: 由于 DHCP 的整个理念是将服务器置于参数存储、配置和地址管理的主导地位，因此 DHCP 客户端相对简单。客户端实现了消息协议，并根据需要将接收自 DHCP
    服务器的参数传达给 TCP/IP 软件组件。它没有做很多其他的事情。
- en: In fact, there's not really much for an administrator to do to set up a client
    to use DHCP. In some operating systems, it's as simple as "throwing a switch,"
    by enabling DHCP support within the client itself. This prompts the client to
    then stop using any manually configured parameters and start searching for a DHCP
    server instead. The server then becomes responsible for the client's configuration
    and address assignment.
  id: totrans-866
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，管理员在设置客户端使用 DHCP 时并没有太多事情要做。在某些操作系统中，这就像“打开一个开关”一样简单，通过在客户端内部启用 DHCP 支持。这会提示客户端停止使用任何手动配置的参数，并开始寻找
    DHCP 服务器。然后，服务器负责客户端的配置和地址分配。
- en: Since the client doesn't do a great deal in DHCP other than communicate with
    the server, not much is required in the way of user software for a DHCP client.
    In most cases, control over the DHCP client software is accomplished using a TCP/IP
    configuration utility, as described in [Chapter 88](ch88.html "Chapter 88. TCP/IP
    ADMINISTRATION AND TROUBLESHOOTING UTILITIES AND PROTOCOLS"). Windows clients
    use the programs *ipconfig* or *winipcfg* to display the status of their current
    DHCP leases. These programs also allow the client to manually release the current
    lease or renew it.
  id: totrans-867
  prefs: []
  type: TYPE_NORMAL
  zh: 由于客户端在 DHCP 中除了与服务器通信之外并没有做很多工作，因此对于 DHCP 客户端来说，用户软件的需求并不多。在大多数情况下，通过 TCP/IP
    配置实用程序来控制 DHCP 客户端软件，如 [第 88 章](ch88.html "第 88 章。TCP/IP 管理和故障排除实用程序和协议") 中所述。Windows
    客户端使用 *ipconfig* 或 *winipcfg* 程序来显示当前 DHCP 租赁的状态。这些程序还允许客户端手动释放当前租赁或更新它。
- en: Releasing the lease means early lease termination using the DHCPRELEASE message.
    This is usually the only way that a lease is terminated. Renewing the lease is
    a manual version of the automated renewal process. Releasing and renewing the
    lease may be done in sequence to reset a client that is in a confused state or
    is having some other type of DHCP or connectivity problem.
  id: totrans-868
  prefs: []
  type: TYPE_NORMAL
  zh: 释放租赁意味着使用 DHCPRELEASE 消息提前终止租赁。这通常是终止租赁的唯一方式。更新租赁是自动更新过程的手动版本。释放和更新租赁可以按顺序进行，以重置处于混乱状态或遇到其他类型
    DHCP 或连接问题的客户端。
- en: DHCP Message Relaying and BOOTP Relay Agents
  id: totrans-869
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP 消息中继和 BOOTP 中继代理
- en: DHCP is the third-generation host configuration protocol for TCP/IP. We've already
    discussed extensively how it was based directly on BOOTP, which was, in turn,
    an enhancement of the earlier Reverse Address Resolution Protocol (RARP). Even
    though each new protocol has made significant improvements over its predecessor,
    each iteration has retained certain limitations that are actually common to all
    host configuration protocols.
  id: totrans-870
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP是TCP/IP的第三代主机配置协议。我们已经广泛讨论了它是如何直接基于BOOTP的，而BOOTP本身是早期反向地址解析协议（RARP）的增强。尽管每个新协议在其前辈的基础上都做出了显著的改进，但每一代迭代都保留了一些实际上是所有主机配置协议共有的限制。
- en: One of the most important limitations with host configuration protocols is the
    reliance on broadcasts for communication. Whenever we are dealing with a situation
    where a client needs to communicate but doesn't know its IP address and doesn't
    know the address of a server that will provide it, the client needs to use broadcast
    addressing. However, for performance reasons, broadcasts are normally propagated
    only on the local network. This means that the client and server would always
    need to be on the same physical network for host configuration to occur. Of course,
    we don't want this to be the case. It would require that a large internetwork
    have a different server on every network, greatly reducing the benefits of centralized
    configuration information and creating numerous administrative hassles.
  id: totrans-871
  prefs: []
  type: TYPE_NORMAL
  zh: 主机配置协议的一个重要限制是依赖于广播进行通信。每当我们在处理一个客户端需要通信但不知道其IP地址，也不知道将提供该地址的服务器地址的情况时，客户端需要使用广播地址。然而，出于性能原因，广播通常只在本地网络中传播。这意味着客户端和服务器始终需要在同一物理网络上才能进行主机配置。当然，我们不希望这种情况发生。这需要在一个大型互联网的每个网络中都有一个不同的服务器，这会大大减少集中配置信息的好处，并造成许多管理上的麻烦。
- en: RARP didn't have any solution to this problem, which is one reason why it was
    so limited in usefulness. BOOTP's solution is to allow a client and server to
    be on different networks through the use of BOOTP *relay agents*.
  id: totrans-872
  prefs: []
  type: TYPE_NORMAL
  zh: RARP没有解决这个问题，这也是它在使用上如此有限的一个原因。BOOTP的解决方案是允许客户端和服务器通过使用BOOTP *中继代理*在不同的网络上。
- en: BOOTP Relay Agents for DHCP
  id: totrans-873
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP的BOOTP中继代理
- en: A *relay agent* is a device that is not a BOOTP server, but which runs a special
    software module that allows it to act in the place of a server. A relay agent
    can be placed on networks where there are BOOTP clients but no BOOTP servers.
    The relay agent intercepts requests from clients and relays them to the server.
    The server then responds back to the agent, which forwards the response to the
    client. A full rationale and description of operation of BOOTP relay agents can
    be found in [Chapter 60](ch60.html "Chapter 60. TCP/IP BOOTSTRAP PROTOCOL (BOOTP)").
  id: totrans-874
  prefs: []
  type: TYPE_NORMAL
  zh: '*中继代理*是一种不是BOOTP服务器的设备，但它运行一个特殊的软件模块，允许它代替服务器的作用。中继代理可以放置在有BOOTP客户端但没有BOOTP服务器的网络上。中继代理拦截来自客户端的请求并将它们转发到服务器。然后服务器将响应发送回代理，代理再将响应转发给客户端。BOOTP中继代理的完整理由和操作描述可以在[第60章](ch60.html
    "第60章. TCP/IP引导协议(BOOTP)")中找到。'
- en: The designers of DHCP were satisfied with the basic concepts and operation behind
    BOOTP relay agents, which had already been in use for many years. For this reason,
    they made the specific decision to continue using BOOTP relay agent functionality
    in DHCP. In fact, this is one of the reasons why the decision was made to retain
    the BOOTP message format in DHCP, and also the basic two-message request/reply
    communication protocol. This allows BOOTP relay agents to handle DHCP messages
    as if they were BOOTP messages. This is also why the mention of BOOTP in the title
    of this topic is not a typo—DHCP uses BOOTP relay agents. Even the DHCP standard
    says that a "BOOTP relay agent is an Internet host or router that passes DHCP
    messages between DHCP clients and DHCP servers."
  id: totrans-875
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP的设计者对BOOTP中继代理背后的基本概念和操作感到满意，这些概念和操作已经使用了多年。因此，他们做出了继续在DHCP中使用BOOTP中继代理功能的具体决定。事实上，这也是决定保留BOOTP消息格式在DHCP中的原因之一，以及基本的请求/回复通信协议。这允许BOOTP中继代理将DHCP消息处理成BOOTP消息。这也是为什么在这个主题的标题中提到BOOTP不是打字错误——DHCP使用BOOTP中继代理。甚至DHCP标准也说明，“BOOTP中继代理是一个在DHCP客户端和DHCP服务器之间传递DHCP消息的互联网主机或路由器。”
- en: In practice, the agents are indeed sometimes called *DHCP relay agents*. You
    may also see the terms *BOOTP/DHCP relay agent* and *DHCP/BOOTP relay agent*.
  id: totrans-876
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，代理有时确实被称为*DHCP中继代理*。你也可能看到*BOOTP/DHCP中继代理*和*DHCP/BOOTP中继代理*这样的术语。
- en: DHCP Relaying Process
  id: totrans-877
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP中继过程
- en: Since DHCP was designed specifically to support BOOTP relay agents, the agents
    behave in DHCP much as they do in BOOTP. Although DHCP has much more complex message
    exchanges, they are all still designed around the notion of a client request and
    server response. There are just more requests and responses.
  id: totrans-878
  prefs: []
  type: TYPE_NORMAL
  zh: 由于DHCP是专门为支持BOOTP中继代理而设计的，因此代理在DHCP中的行为与在BOOTP中类似。尽管DHCP的消息交换更加复杂，但它们仍然都是围绕客户端请求和服务器响应的概念设计的。只是请求和回复更多。
- en: The BOOTP agent looks for broadcasts sent by the client and then forwards them
    to the server (as described in the BOOTP relay agent behavior discussion in [Chapter 60](ch60.html
    "Chapter 60. TCP/IP BOOTSTRAP PROTOCOL (BOOTP)")), and then returns replies from
    the server. The additional information in the DHCP protocol is implemented using
    additions to the BOOTP message format in the form of DHCP options, which the relay
    agent doesn't look at. It just treats them as it does BOOTP requests and replies.
  id: totrans-879
  prefs: []
  type: TYPE_NORMAL
  zh: BOOTP代理寻找客户端发送的广播，然后将它们转发到服务器（如[第60章](ch60.html "第60章. TCP/IP引导协议(BOOTP)"))中所述的BOOTP中继代理行为讨论中所述），然后返回来自服务器的回复。DHCP协议中的附加信息是通过在BOOTP消息格式中添加DHCP选项来实现的，中继代理不会查看这些选项。它只是像处理BOOTP请求和回复一样处理它们。
- en: Tip
  id: totrans-880
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** To permit DHCP clients and DHCP servers to reside on different
    physical networks, an intermediary device is required to facilitate message exchange
    between networks. DHCP uses the same mechanism for this as BOOTP: the deployment
    of *BOOTP* relay agents. The relay agent captures client requests, forwards them
    to the server, and then returns the server''s responses back to the client.'
  id: totrans-881
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** 要允许DHCP客户端和DHCP服务器位于不同的物理网络上，需要一个中介设备来促进网络之间的消息交换。DHCP为此使用与BOOTP相同的机制：部署*BOOTP*中继代理。中继代理捕获客户端请求，将它们转发到服务器，然后将服务器的响应返回给客户端。'
- en: 'In summary, when a relay agent is used, here''s what the various client requests
    and server replies in the DHCP operation section become:'
  id: totrans-882
  prefs: []
  type: TYPE_NORMAL
  zh: 总结来说，当使用中继代理时，DHCP操作部分中的各种客户端请求和服务器回复如下：
- en: '**Client Request** When a client broadcasts a request, the relay agent intercepts
    it on UDP port 67\. It checks the Hops field and discards the request if the value
    is greater than 16; otherwise, it increments the field. The agent puts its own
    address into the GIAddr field unless another relay agent has already put its address
    in the field. It then forwards the client request to a DHCP server, either unicast
    or broadcast on another network.'
  id: totrans-883
  prefs: []
  type: TYPE_NORMAL
  zh: '**客户端请求** 当客户端广播请求时，中继代理在UDP端口67上拦截它。它检查跳数字段，如果值大于16，则丢弃请求；否则，增加该字段。除非另一个中继代理已经将它的地址放入该字段，否则代理将把它的自己的地址放入GIAddr字段。然后代理将客户端请求转发到DHCP服务器，要么是单播，要么是在另一个网络上的广播。'
- en: '**Server Reply** The server sees a nonzero value in the GIAddr field and sends
    the reply to the relay agent whose IP address is in that field. The relay agent
    then sends the reply back to the client, using either unicast or broadcast (as
    explained in the discussion of DHCP addressing in [Chapter 61](ch61.html "Chapter 61. DHCP
    OVERVIEW AND ADDRESS ALLOCATION CONCEPTS")).'
  id: totrans-884
  prefs: []
  type: TYPE_NORMAL
  zh: '**服务器回复** 服务器看到GIAddr字段中的非零值，并将回复发送到该字段中IP地址所在的中继代理。然后中继代理使用单播或广播（如[第61章](ch61.html
    "第61章. DHCP概述和地址分配概念")中关于DHCP寻址的讨论所述）将回复发送回客户端。'
- en: One difference between BOOTP and DHCP is that certain communications from the
    client to the server are unicast. The most noticeable instance of this is when
    a client tries to renew its lease with a specific DHCP server. Since it sends
    this request unicast, it can go to a DHCP server on a different network using
    conventional IP routing, and the relay agent does not need to be involved.
  id: totrans-885
  prefs: []
  type: TYPE_NORMAL
  zh: BOOTP和DHCP之间的一个区别是，客户端到服务器的一些通信是单播的。最明显的例子是当客户端尝试使用特定的DHCP服务器续订其租约时。由于它以单播的形式发送此请求，它可以使用传统的IP路由访问不同网络上的DHCP服务器，中继代理不需要参与。
- en: DHCP Autoconfiguration/Automatic Private IP Addressing (APIPA)
  id: totrans-886
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP自动配置/自动私有IP地址分配（APIPA）
- en: The IP address of a TCP/IP host is, in many ways, its identity. Every TCP/IP
    network requires that all hosts have unique addresses to facilitate communication.
    When a network is manually configured with a distinct IP address for each host,
    the hosts permanently know who they are. When hosts are made DHCP clients, they
    no longer have a permanent identity; they rely on a DHCP server to tell them who
    they are.
  id: totrans-887
  prefs: []
  type: TYPE_NORMAL
  zh: TCP/IP主机的IP地址在许多方面是其身份的象征。每个TCP/IP网络都需要所有主机都有唯一的地址，以便促进通信。当网络为每个主机手动配置一个独特的IP地址时，主机永久知道自己的身份。当主机成为DHCP客户端时，它们就不再有永久身份；它们依赖于DHCP服务器来告诉它们自己的身份。
- en: 'This dependency is not a problem as long as DHCP is functioning normally and
    a host can get a lease, and, in fact, has many benefits that we have explored.
    Unfortunately, a number of circumstances can arise that result in a client failing
    to get a lease. The client may not be able to obtain a lease, reacquire one after
    reboot, or renew an existing lease. There are several possible reasons why this
    might happen:'
  id: totrans-888
  prefs: []
  type: TYPE_NORMAL
  zh: 只要DHCP正常运行并且主机能够获取到租约，这种依赖性就不会成为问题，实际上，它还带来了许多我们已经探讨过的益处。不幸的是，可能会出现一些情况，导致客户端无法获取租约。客户端可能无法获取租约，重启后也无法重新获取，或者无法续租现有的租约。这种情况可能发生的几个可能原因包括：
- en: The DHCP server may have experienced a failure or may be taken down for maintenance.
  id: totrans-889
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: DHCP服务器可能已经出现故障，或者可能因维护而关闭。
- en: The relay agent on the client's local network may have failed.
  id: totrans-890
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户端本地网络上的中继代理可能已经失败。
- en: Another hardware malfunction or power failure may make communication impossible.
  id: totrans-891
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 另一次硬件故障或断电可能会导致通信无法进行。
- en: The network may have run out of allocatable addresses.
  id: totrans-892
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 网络可能已经耗尽了可分配的地址。
- en: Without a lease, the host has no IP address, and without an address, the host
    is effectively dead in the water. The base DHCP specification doesn't really specify
    any recourse for the host in the event that it cannot successfully obtain a lease.
    It is left up to the implementor to decide what to do, and when DHCP was first
    created, many host implementations would simply display an error message and leave
    the host unusable until an administrator or user took action.
  id: totrans-893
  prefs: []
  type: TYPE_NORMAL
  zh: 没有租约，主机就没有IP地址，没有地址，主机实际上就处于瘫痪状态。基本的DHCP规范并没有为无法成功获取租约的主机指定任何补救措施。这取决于实现者来决定该做什么，以及当DHCP最初创建时，许多主机实现会简单地显示错误消息，并使主机直到管理员或用户采取行动才可用。
- en: Clearly, this is far from an ideal situation. It would be better if we could
    just have a DHCP client that is unable to reach a server automatically configure
    itself. In fact, the Internet Engineering Task Force (IETF) reserved a special
    IP address block for this purpose (see [Chapter 17](ch17.html "Chapter 17. CLASSFUL
    (CONVENTIONAL) ADDRESSING")). This block, 169.254.0.1 through 169.254.255.254
    (or 169.254.0.0/16 in classless notation) is reserved for autoconfiguration, as
    mentioned in RFC 3330, "Hosts obtain these addresses by auto-configuration, such
    as when a DHCP server may not be found."
  id: totrans-894
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，这远非理想情况。如果我们可以有一个无法连接到服务器的DHCP客户端自动配置自己，那就更好了。实际上，互联网工程任务组（IETF）为此目的预留了一个特殊的IP地址块（见[第17章](ch17.html
    "第17章。类ful（常规）寻址"））。这个地址块，从169.254.0.1到169.254.255.254（或无类记法中的169.254.0.0/16），被预留用于自动配置，如RFC
    3330中所述，“主机通过自动配置获取这些地址，例如当无法找到DHCP服务器时。”
- en: Strangely, however, no TCP/IP standard was defined to specify how such autoconfiguration
    works. To fill the void, Microsoft created an implementation that it calls *Automatic
    Private IP Addressing (APIPA)*. Due to Microsoft's market power, APIPA has been
    deployed on millions of machines, and has thus become a de facto standard in the
    industry. Many years later, the IETF did define a formal standard for this functionality,
    in RFC 3927, "Dynamic Configuration of IPv4 Link-Local Addresses."
  id: totrans-895
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，奇怪的是，并没有TCP/IP标准被定义来指定这种自动配置是如何工作的。为了填补这一空白，微软创建了一个它称之为*自动私有IP地址分配（APIPA）*的实现。由于微软的市场力量，APIPA已经在数百万台机器上部署，因此已经成为行业中的事实标准。多年以后，IETF确实为这一功能定义了一个正式标准，在RFC
    3927中，“IPv4链路本地地址的动态配置。”
- en: APIPA Operation
  id: totrans-896
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: APIPA操作
- en: 'APIPA is really so simple that it''s surprising it took so long for someone
    to come up with the idea. It takes over at the point where any DHCP lease process
    fails. Instead of just halting with an error message, APIPA randomly chooses an
    address within the aforementioned private addressing block. It then performs a
    test very similar to the one in step 13 in the DHCP allocation process (see [Chapter 62](ch62.html
    "Chapter 62. DHCP CONFIGURATION AND OPERATION")): It uses ARP to generate a request
    on the local network to see if any other client responds using the address it
    has chosen. If there is a reply, APIPA tries another random address and repeats
    the test. When the APIPA software finds an address that is not in use, it is given
    to the client as a default address. The client will then use default values for
    other configuration parameters that it would normally receive from the DHCP server.
    This process is illustrated in [Figure 64-1](ch64s03.html#dhcp_automatic_private_ip_addressing_api
    "Figure 64-1. DHCP Automatic Private IP Addressing (APIPA) In this example, Client
    1 is trying to get an IP address from its DHCP server, but the server is out of
    addresses, so it does not respond to the client''s requests. The client is configured
    to use APIPA, so it randomly selects an address from the APIPA address block.
    It sends an ARP request on the local network to see if any other device is using
    that address. Usually, there will be no conflict, but here Client 2 is using the
    address, so it responds. Client 1 chooses a different address, and this time gets
    no reply. It begins using that address, while continuing to check regularly for
    a DHCP server to come online.").'
  id: totrans-897
  prefs: []
  type: TYPE_NORMAL
  zh: APIPA实际上非常简单，令人惊讶的是，这么长时间才有人想出这个主意。它在任何DHCP租约过程失败时接管。它不是仅仅通过错误消息停止，而是随机选择上述私有地址块中的一个地址。然后它执行一个与DHCP分配过程中的第13步非常相似的测试（见[第62章](ch62.html
    "第62章。DHCP配置和操作"))：它使用ARP在本地网络上生成一个请求，以查看是否有其他客户端使用它选择的地址响应。如果有回复，APIPA尝试另一个随机地址并重复测试。当APIPA软件找到一个未被使用的地址时，它将该地址作为默认地址分配给客户端。然后客户端将使用从DHCP服务器通常接收的其他配置参数的默认值。这个过程在[图64-1](ch64s03.html#dhcp_automatic_private_ip_addressing_api
    "图64-1。DHCP自动私有IP地址分配（APIPA）在这个例子中，客户端1试图从其DHCP服务器获取IP地址，但服务器地址耗尽，因此它没有响应客户端的请求。客户端配置为使用APIPA，因此它从APIPA地址块中随机选择一个地址。它在本地网络上发送一个ARP请求，以查看是否有其他设备使用该地址。通常，不会有冲突，但在这里客户端2正在使用该地址，因此它做出了响应。客户端1选择了一个不同的地址，这次没有收到回复。它开始使用该地址，同时继续定期检查DHCP服务器是否上线。")中进行了说明。
- en: A client using an autoconfigured address will continue to try to contact a DHCP
    server periodically. By default, this check is performed every five minutes. If
    and when it finds one, it will obtain a lease and replace the autoconfigured address
    with the proper leased address.
  id: totrans-898
  prefs: []
  type: TYPE_NORMAL
  zh: 使用自动配置地址的客户将定期尝试联系DHCP服务器。默认情况下，此检查每五分钟执行一次。如果找到，它将获取一个租约，并用正确的租约地址替换自动配置的地址。
- en: APIPA is ideally suited to small networks, where all devices are on a single
    physical link. Conceivably, with 20 APIPA-enabled DHCP clients on a network with
    a single DHCP server, you could take the server down for maintenance and still
    have all the clients work properly, using 169.254.*x*.*x* addresses.
  id: totrans-899
  prefs: []
  type: TYPE_NORMAL
  zh: APIPA非常适合小型网络，其中所有设备都在单个物理链路上。理论上，在一个具有单个DHCP服务器的网络中，如果有20个启用APIPA的DHCP客户端，你可以在维护期间关闭服务器，而所有客户端仍然可以正常工作，使用169.254.*x*.*x*地址。
- en: Bear in mind, however, that APIPA is not a proper replacement for full DHCP.
  id: totrans-900
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，请注意，APIPA并不是完整DHCP的适当替代品。
- en: '![DHCP Automatic Private IP Addressing (APIPA) In this example, Client 1 is
    trying to get an IP address from its DHCP server, but the server is out of addresses,
    so it does not respond to the client''s requests. The client is configured to
    use APIPA, so it randomly selects an address from the APIPA address block. It
    sends an ARP request on the local network to see if any other device is using
    that address. Usually, there will be no conflict, but here Client 2 is using the
    address, so it responds. Client 1 chooses a different address, and this time gets
    no reply. It begins using that address, while continuing to check regularly for
    a DHCP server to come online.](httpatomoreillycomsourcenostarchimages288223.png.jpg)'
  id: totrans-901
  prefs: []
  type: TYPE_IMG
  zh: '![DHCP 自动私有 IP 地址分配 (APIPA) 在本例中，客户端 1 正在尝试从其 DHCP 服务器获取 IP 地址，但服务器地址已用尽，因此它不会响应用户的请求。客户端配置为使用
    APIPA，因此它从 APIPA 地址块中随机选择一个地址。它在本地网络上发送一个 ARP 请求，以查看是否有其他设备正在使用该地址。通常情况下，不会发生冲突，但在这里客户端
    2 正在使用该地址，因此它做出了响应。客户端 1 选择了一个不同的地址，这次没有收到回复。它开始使用该地址，同时继续定期检查 DHCP 服务器是否上线。](httpatomoreillycomsourcenostarchimages288223.png.jpg)'
- en: Figure 64-1. DHCP Automatic Private IP Addressing (APIPA) In this example, Client
    1 is trying to get an IP address from its DHCP server, but the server is out of
    addresses, so it does not respond to the client's requests. The client is configured
    to use APIPA, so it randomly selects an address from the APIPA address block.
    It sends an ARP request on the local network to see if any other device is using
    that address. Usually, there will be no conflict, but here Client 2 is using the
    address, so it responds. Client 1 chooses a different address, and this time gets
    no reply. It begins using that address, while continuing to check regularly for
    a DHCP server to come online.
  id: totrans-902
  prefs: []
  type: TYPE_NORMAL
  zh: 图 64-1. DHCP 自动私有 IP 地址分配 (APIPA) 在本例中，客户端 1 正在尝试从其 DHCP 服务器获取 IP 地址，但服务器地址已用尽，因此它不会响应用户的请求。客户端配置为使用
    APIPA，因此它从 APIPA 地址块中随机选择一个地址。它在本地网络上发送一个 ARP 请求，以查看是否有其他设备正在使用该地址。通常情况下，不会发生冲突，但在这里客户端
    2 正在使用该地址，因此它做出了响应。客户端 1 选择了一个不同的地址，这次没有收到回复。它开始使用该地址，同时继续定期检查 DHCP 服务器是否上线。
- en: APIPA Limitations
  id: totrans-903
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: APIPA 限制
- en: The 169.254.0.0/16 block is a private IP range and comes with all the limitations
    of private IP addresses, including inability to use these addresses on the Internet.
    Also, APIPA cannot provide the other configuration parameters that a client may
    need to get from a DHCP server. Finally, APIPA will not work properly in conjunction
    with proxy ARP, because the proxy will respond for any of the private addresses,
    so they will all appear to be used.
  id: totrans-904
  prefs: []
  type: TYPE_NORMAL
  zh: 169.254.0.0/16 块是一个私有 IP 范围，并带有所有私有 IP 地址的限制，包括无法在互联网上使用这些地址。此外，APIPA 无法提供客户端可能需要从
    DHCP 服务器获取的其他配置参数。最后，APIPA 与代理 ARP 一起使用时可能无法正常工作，因为代理将响应用户的任何私有地址，因此它们都会看起来已被使用。
- en: Since it uses ARP to check for address conflicts, APIPA is not well suited for
    large internetworks. To use it on an internetwork with multiple subnets would
    require software that allows each subnet to use a different portion of the full
    169.254.0.0/16 blocks, to avoid conflicts.
  id: totrans-905
  prefs: []
  type: TYPE_NORMAL
  zh: 由于它使用 ARP 检查地址冲突，APIPA 不太适合大型互连网络。要在具有多个子网的网络中使用它，需要软件允许每个子网使用 169.254.0.0/16
    块的不同部分，以避免冲突。
- en: In practice, APIPA is a solution for small networks. Large internetworks deal
    with the problem of not being able to contact a DHCP server by taking steps to
    ensure that a client can always contact a DHCP server.
  id: totrans-906
  prefs: []
  type: TYPE_NORMAL
  zh: 在实践中，APIPA 是小型网络的一种解决方案。大型互连网络通过确保客户端始终可以联系到 DHCP 服务器来处理无法联系 DHCP 服务器的难题。
- en: Tip
  id: totrans-907
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** An optional DHCP feature called *Automatic Private IP Addressing
    (APIPA)* was developed to allow clients to still be able to communicate in the
    event that they are unable to obtain an IP address from a DHCP server. When enabled,
    the client chooses a random address from a special reserved block of private IP
    addresses and checks to make sure the address is not already in use by another
    device. It continues to check for a DHCP server periodically until it is able
    to find one.'
  id: totrans-908
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** 一个名为 *自动私有 IP 地址分配 (APIPA)* 的可选 DHCP 功能被开发出来，以便在客户端无法从 DHCP 服务器获取
    IP 地址的情况下，仍然能够进行通信。当启用时，客户端从专门保留的私有 IP 地址块中随机选择一个地址，并检查该地址是否已被其他设备使用。它将继续定期检查
    DHCP 服务器，直到找到为止。'
- en: DHCP Server Conflict Detection
  id: totrans-909
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP 服务器冲突检测
- en: One of the primary decisions any TCP/IP administrator using DHCP must make is
    how many DHCP servers to deploy. A single server has the advantage of simplicity,
    but provides no redundancy in the event of failure. It also means that whenever
    the DHCP server is down, clients can't get addresses. For these reasons, most
    larger networks use two or more servers.
  id: totrans-910
  prefs: []
  type: TYPE_NORMAL
  zh: 对于任何使用DHCP的TCP/IP管理员来说，必须做出的主要决定之一是部署多少个DHCP服务器。单个服务器具有简单性的优势，但在发生故障时没有冗余。这也意味着，每当DHCP服务器宕机时，客户端都无法获取地址。出于这些原因，大多数大型网络都使用两个或更多服务器。
- en: 'When you have two servers or more—let''s say two for sake of this discussion—you
    then have another decision to make: How do you divide the address pool between
    the servers? As I explored in detail in the discussion of DHCP address pools in
    [Chapter 61](ch61.html "Chapter 61. DHCP OVERVIEW AND ADDRESS ALLOCATION CONCEPTS"),
    there are two options: give the servers overlapping addresses or making them non-overlapping.
    Unfortunately, in classic DHCP, neither is really a great solution. Overlapping
    ranges mean both servers might try to assign the same address, since DHCP includes
    no provision for communication between servers. Non-overlapping ranges avoid this
    problem, but make only some of the addresses available to each server.'
  id: totrans-911
  prefs: []
  type: TYPE_NORMAL
  zh: 当你有两个或更多服务器时——为了讨论方便，我们假设有两个服务器——你还需要做出另一个决定：如何将地址池在服务器之间划分？正如我在[第61章](ch61.html
    "第61章。DHCP概述和地址分配概念")中详细讨论DHCP地址池时所指出的，有两种选择：给服务器分配重叠地址或使它们不重叠。不幸的是，在经典DHCP中，这两种方法都不是很好的解决方案。重叠范围意味着两个服务器可能会尝试分配相同的地址，因为DHCP没有提供服务器之间通信的条款。非重叠范围避免了这个问题，但只让每个服务器可用一些地址。
- en: It's strange that the DHCP standard didn't provide better support for cross-server
    coordination, even though there clearly was a need for it. However, certain DHCP
    implementations include an optional feature to allow two servers to have overlapping
    scopes without address clashes occurring. This is a feature commonly found on
    Microsoft DHCP servers and may also be present in other implementations. It is
    called *DHCP server conflict detection*.
  id: totrans-912
  prefs: []
  type: TYPE_NORMAL
  zh: 很奇怪，尽管显然有这种需求，但DHCP标准没有提供更好的跨服务器协调支持。然而，某些DHCP实现包括一个可选功能，允许两个服务器在没有地址冲突的情况下具有重叠的作用域。这是在Microsoft
    DHCP服务器上常见的一个功能，也可能存在于其他实现中。它被称为*DHCP服务器冲突检测*。
- en: The idea behind conflict detection is very simple. Suppose a DHCP server receives
    a DHCPDISCOVER message from a client and decides to offer it a lease. Before sending
    the DHCPOFFER message, the server conducts a *probe* by sending ICMP Echo (ping)
    messages (see [Chapter 33](ch33.html "Chapter 33. ICMPV4 INFORMATIONAL MESSAGE
    TYPES AND FORMATS")) out to the address it plans to offer. It then waits a short
    period of time to hear if it receives any ICMP Echo Reply messages back. If it
    does, it knows the IP address is in use and chooses a different one.
  id: totrans-913
  prefs: []
  type: TYPE_NORMAL
  zh: 冲突检测背后的想法非常简单。假设一个DHCP服务器从客户端收到一个DHCPDISCOVER消息，并决定向它提供一个租约。在发送DHCPOFFER消息之前，服务器通过向它计划提供的地址发送ICMP
    Echo（ping）消息来进行*探测*（见[第33章](ch33.html "第33章。ICMPV4信息性消息类型和格式")）。然后它等待一小段时间，看是否收到任何ICMP
    Echo Reply消息。如果收到了，它就知道该IP地址正在使用，并选择另一个地址。
- en: If all DHCP servers are configured to do this before offering an address, then
    it is possible to give all of them the same, overlapping addresses for assignment.
    They won't have any way of coordinating with each other, but as long as they ask
    first by doing an ICMP check, there won't be any problems. This provides an administrator
    with the advantages of overlapping address ranges—simplicity and access to all
    addresses by all servers—without risk of address conflicts. The only small drawback
    is a little extra network traffic to perform the check, and possibly a few milliseconds
    of server CPU time if a new address needs to be chosen.
  id: totrans-914
  prefs: []
  type: TYPE_NORMAL
  zh: 如果所有DHCP服务器在提供地址之前都配置为执行此操作，那么可以给它们分配相同的、重叠的地址。它们没有协调彼此的方式，但只要它们通过执行ICMP检查来首先询问，就不会有任何问题。这为管理员提供了重叠地址范围的优点——简单性和所有服务器都能访问所有地址——而没有地址冲突的风险。唯一的缺点是执行检查会产生一点额外的网络流量，如果需要选择新的地址，可能还会占用服务器CPU时间几毫秒。
- en: If you were paying attention when you read about the DHCP allocation process
    in [Chapter 62](ch62.html "Chapter 62. DHCP CONFIGURATION AND OPERATION"), you
    may have noticed that what I am describing here sounds familiar. In fact, it's
    true that this feature isn't anything new. The use of ICMP to check an address
    before offering it is actually mentioned in RFC 2131 as part of the standard DHCP
    allocation process, and you can find it mentioned as step 5 in the allocation
    process description.
  id: totrans-915
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您在阅读第 62 章（[第 62 章。DHCP 配置和操作](ch62.html "第 62 章。DHCP 配置和操作")）中关于 DHCP 分配过程的内容时留心，您可能会注意到我这里描述的内容听起来很熟悉。事实上，这个功能并不是什么新东西。在提供地址之前使用
    ICMP 检查地址的做法实际上在 RFC 2131 中作为标准 DHCP 分配过程的一部分被提及，您可以在分配过程描述中找到它作为第 5 步。
- en: So why was conflict detection required to be an extra feature? The reason is
    that the use of ICMP wasn't mandatory because the standard says servers *should*
    do it, not that they *must* do it. This choice was made to provide flexibility
    in implementing DHCP, but that flexibility comes at a cost. So, if you want to
    use this feature, you need to look for support for it in your server software.
  id: totrans-916
  prefs: []
  type: TYPE_NORMAL
  zh: 那么为什么冲突检测需要成为一个额外功能呢？原因在于，使用 ICMP 不是强制性的，因为标准说服务器*应该*这样做，而不是*必须*这样做。这个选择是为了在实现
    DHCP 时提供灵活性，但这种灵活性是有代价的。因此，如果您想使用这个功能，您需要在您的服务器软件中寻找对其的支持。
- en: Tip
  id: totrans-917
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** Some DHCP implementations include a feature called *server
    conflict detection*. When this feature is activated, it causes each server to
    always check to make sure an address is not in use before granting it to a client.
    When conflict detection is used by all DHCP servers on a network, the servers
    can be given overlapping scopes, so each can assign any of the organization''s
    IP addresses, while at the same time not needing to be concerned about two clients
    being assigned the same address by different servers.'
  id: totrans-918
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** 一些 DHCP 实现包括一个名为 *服务器冲突检测* 的功能。当此功能被激活时，它会使得每个服务器在授予地址给客户端之前，总是检查该地址是否未被使用。当网络上的所有
    DHCP 服务器都使用冲突检测时，服务器可以被赋予重叠的作用域，这样每个服务器都可以分配组织中的任何 IP 地址，同时不必担心两个客户端被不同的服务器分配了相同的地址。'
- en: DHCP and BOOTP Interoperability
  id: totrans-919
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP 和 BOOTP 互操作性
- en: I've talked extensively about how DHCP was designed based on BOOTP and how they
    use the same basic communication method and message format. This was done for
    several reasons, one of the most important of which was ensuring interoperability
    of the two protocols. Given this, you might expect that we could simply say that
    BOOTP and DHCP are compatible with each other, and that's that.
  id: totrans-920
  prefs: []
  type: TYPE_NORMAL
  zh: 我已经广泛地讨论了 DHCP 是如何基于 BOOTP 设计的，以及它们如何使用相同的基本通信方法和消息格式。这样做是出于几个原因，其中最重要的一个原因是确保两种协议的互操作性。鉴于这一点，您可能会期望我们只需简单地说
    BOOTP 和 DHCP 是兼容的，就是这样。
- en: 'It is true that DHCP was intended to be compatible with BOOTP. RFC 2131 lists
    the following as one of DHCP''s design goals: "DHCP must provide service to existing
    BOOTP clients." This seems pretty clear. The reuse of the BOOTP message format
    is one of the keys to DHCP and BOOTP compatibility. DHCP functionality is implemented
    not through new fields, but rather through DHCP-specific options, such as the
    DHCP Message Type option that specifies the all-important type of DHCP messages.
    DHCP devices can look for this extra information, while BOOTP devices can ignore
    it.'
  id: totrans-921
  prefs: []
  type: TYPE_NORMAL
  zh: 诚然，DHCP 的目的是与 BOOTP 兼容。RFC 2131 列出了以下内容作为 DHCP 的设计目标之一：“DHCP 必须为现有的 BOOTP 客户端提供服务。”这似乎很清楚。重新使用
    BOOTP 消息格式是 DHCP 和 BOOTP 兼容的关键。DHCP 功能不是通过新字段实现的，而是通过 DHCP 特定的选项实现的，例如 DHCP 消息类型选项，它指定了至关重要的
    DHCP 消息类型。DHCP 设备可以查找这些额外信息，而 BOOTP 设备可以忽略它们。
- en: However, while DHCP and BOOTP are similar, they are not the same, and so there
    are some interoperability concerns that crop up when they are used together. The
    DHCP message format is structurally the same as the BOOTP format, but the interpretation
    of certain fields is slightly different. BOOTP clients don't understand DHCP,
    so when BOOTP and DHCP are used together, the DHCP client or server must sometimes
    behave slightly differently to compensate. Further complicating matters are the
    facts that not all implementations of DHCP and BOOTP are necessarily exactly the
    same and that certain specifications in the DHCP standard are not mandatory.
  id: totrans-922
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，尽管DHCP和BOOTP相似，但它们并不相同，因此当它们一起使用时，会出现一些互操作性问题。DHCP消息格式在结构上与BOOTP格式相同，但对某些字段的解释略有不同。BOOTP客户端不理解DHCP，因此当BOOTP和DHCP一起使用时，DHCP客户端或服务器有时必须稍微不同地表现以补偿。进一步复杂化问题的事实是，并非所有DHCP和BOOTP的实现都必然完全相同，以及DHCP标准中的一些规范不是强制的。
- en: 'For these reasons, we cannot just assume that DHCP and BOOTP will work together.
    To address some of these issues, the IETF published RFC 1534, "Interoperation
    Between DHCP and BOOTP," at the same time that DHCP was originally created. This
    document looks at how the protocols work together, focusing on the two distinct
    client/server interoperating combinations: a BOOTP client connecting to a DHCP
    server, and a DHCP client connecting to a BOOTP server. Let''s consider each case.'
  id: totrans-923
  prefs: []
  type: TYPE_NORMAL
  zh: 由于这些原因，我们不能简单地假设DHCP和BOOTP可以一起工作。为了解决这些问题中的某些，IETF在DHCP最初创建的同时发布了RFC 1534，“DHCP和BOOTP之间的互操作性”。这份文件探讨了这些协议是如何协同工作的，重点关注两种不同的客户端/服务器互操作组合：一个BOOTP客户端连接到DHCP服务器，以及一个DHCP客户端连接到BOOTP服务器。让我们考虑每种情况。
- en: BOOTP Clients Connecting to a DHCP Server
  id: totrans-924
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 连接到DHCP服务器的BOOTP客户端
- en: As indicated by the preceding quote from RFC 2131, DHCP was specifically intended
    to allow a DHCP server to handle requests from BOOTP clients. The protocol itself
    is set up to enable this, but it does require that the DHCP server be given certain
    intelligence to know how to deal with BOOTP clients.
  id: totrans-925
  prefs: []
  type: TYPE_NORMAL
  zh: 如RFC 2131中的引言所示，DHCP的特定目的是允许DHCP服务器处理来自BOOTP客户端的请求。该协议本身被设置成启用这一点，但它确实需要DHCP服务器具备一定的智能来知道如何处理BOOTP客户端。
- en: One of the most important issues is that BOOTP clients will follow the BOOTP
    configuration process and not the DHCP leasing processes. The DHCP server must
    use BOOTP messages with the BOOTP meanings for fields when dealing with BOOTP
    clients. A server determines that a client is using BOOTP instead of DHCP by looking
    for the presence of the DHCP Message Type option, which must be present in all
    DHCP messages but is not used for BOOTP.
  id: totrans-926
  prefs: []
  type: TYPE_NORMAL
  zh: 其中一个最重要的问题是BOOTP客户端将遵循BOOTP配置过程，而不是DHCP租赁过程。当处理BOOTP客户端时，DHCP服务器必须使用具有BOOTP含义的字段来使用BOOTP消息。服务器通过寻找DHCP消息类型选项的存在来确定客户端是否使用BOOTP而不是DHCP，这个选项必须存在于所有DHCP消息中，但不用于BOOTP。
- en: If a DHCP server detects that it is dealing with a BOOTP client, it can respond
    with configuration information for the client. The server can use either manual
    or automatic allocation for the client. Automatic allocation means the server
    chooses an address from its pool of unused addresses, but assigns it permanently.
    BOOTP clients are not capable of dynamic allocation, since BOOTP is static in
    nature.
  id: totrans-927
  prefs: []
  type: TYPE_NORMAL
  zh: 如果DHCP服务器检测到它正在处理一个BOOTP客户端，它可以向客户端提供配置信息。服务器可以使用手动或自动分配给客户端。自动分配意味着服务器从其未使用的地址池中选择一个地址，但永久分配它。由于BOOTP本质上是静态的，BOOTP客户端无法进行动态分配。
- en: A DHCP server may include BOOTP vendor information fields in its response to
    a BOOTP client, including ones defined since BOOTP was created. However, it obviously
    must not send any DHCP-specific options.
  id: totrans-928
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP服务器可以在对BOOTP客户端的响应中包含BOOTP供应商信息字段，包括自BOOTP创建以来定义的字段。然而，它显然不能发送任何特定的DHCP选项。
- en: DHCP Clients Connecting to a BOOTP Server
  id: totrans-929
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 连接到BOOTP服务器的DHCP客户端
- en: A DHCP client can obtain configuration information from a BOOTP server, because
    the server will respond to the client's initial DHCPDISCOVER message as if it
    were a BOOTP BOOTREQUEST message. The DHCP client can tell that a BOOTP reply
    has been received because there will be no DHCP Message Type option.
  id: totrans-930
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP客户端可以从BOOTP服务器获取配置信息，因为服务器将像对BOOTP BOOTREQUEST消息的响应一样响应客户端的初始DHCPDISCOVER消息。DHCP客户端可以通过没有DHCP消息类型选项来识别已收到BOOTP回复。
- en: A response from a BOOTP server should be treated as an infinite lease, since
    again, that's all that BOOTP supports. Note that if a DHCP client receives a response
    from both a BOOTP server and a DHCP server, it should use the DHCP response and
    not the BOOTP response (even if this means it gets a shorter lease).
  id: totrans-931
  prefs: []
  type: TYPE_NORMAL
  zh: 应将BOOTP服务器的响应视为无限期租约，因为再次强调，这正是BOOTP所支持的。请注意，如果DHCP客户端同时从BOOTP服务器和DHCP服务器收到响应，它应该使用DHCP响应而不是BOOTP响应（即使这意味着它得到的租约更短）。
- en: DHCP Security Issues
  id: totrans-932
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP安全问题
- en: DHCP was designed in the early 1990s, when the number of organizations on the
    Internet was relatively small. Furthermore, it was based on BOOTP, which was created
    in the 1980s, when the Internet as we know it today barely even existed. In those
    days, Internet security wasn't a big issue, because it was mostly a small group
    of research and educational organizations using TCP/IP on the Internet. As a result,
    DHCP, like many protocols of that era, doesn't do much to address security concerns.
  id: totrans-933
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP是在20世纪90年代初设计的，当时互联网上的组织数量相对较少。此外，它基于1980年代创建的BOOTP，当时我们今天所知道的互联网几乎还不存在。在那个时代，互联网安全并不是一个大问题，因为主要是少数研究机构和教育组织在互联网上使用TCP/IP。因此，DHCP，就像那个时代的许多协议一样，并没有做很多来处理安全问题。
- en: Actually, this is a bit understated. Not only does DHCP run over the Internet
    Protocol (IP) and the User Datagram Protocol (UDP), which are inherently insecure,
    but the DHCP protocol itself has no security provisions whatsoever. This is a
    fairly serious issue in modern networks, because of the sheer power of DHCP, which
    deals with critical configuration information.
  id: totrans-934
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，这有点低估了。不仅DHCP运行在互联网协议（IP）和用户数据报协议（UDP）上，这些协议本身就不安全，而且DHCP协议本身没有任何安全措施。这在现代网络中是一个相当严重的问题，因为DHCP的强大功能涉及到关键的配置信息。
- en: DHCP Security Concerns
  id: totrans-935
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP安全关注点
- en: 'There are two different classes of potential security problems related to DHCP:'
  id: totrans-936
  prefs: []
  type: TYPE_NORMAL
  zh: 与DHCP相关的潜在安全问题分为两类：
- en: '**Unauthorized DHCP Servers** If a malicious person plants a rogue DHCP server,
    it is possible that this device could respond to client requests and supply them
    with spurious configuration information. This could be used to make clients unusable
    on the network, or worse, set them up for further abuse later on. For example,
    a hacker could exploit a bogus DHCP server to direct a DHCP client to use a router
    under the hacker''s control, rather than the one the client is supposed to use.'
  id: totrans-937
  prefs: []
  type: TYPE_NORMAL
  zh: '**未经授权的DHCP服务器** 如果一个恶意的人放置了一个恶意DHCP服务器，那么这个设备可能对客户端请求做出响应，并向他们提供虚假的配置信息。这可能被用来使客户端在网络上无法使用，或者更糟，为以后的进一步滥用做准备。例如，一个黑客可以利用一个虚假的DHCP服务器将DHCP客户端引导到使用黑客控制的路由器，而不是客户端应该使用的路由器。'
- en: '**Unauthorized DHCP Clients** A client could be set up that masquerades as
    a legitimate DHCP client and thereby obtain configuration information intended
    for that client. This information could then be used to compromise the network
    later on. Alternatively, a malicious person could use software to generate a lot
    of bogus DHCP client requests to use up all the IP addresses in a DHCP server''s
    pool. More simply, this could be used by a thief to steal an IP address from an
    organization for his own use.'
  id: totrans-938
  prefs: []
  type: TYPE_NORMAL
  zh: '**未经授权的DHCP客户端** 一个客户端可能被设置成伪装成合法的DHCP客户端，从而获取为该客户端指定的配置信息。这些信息随后可能被用来在以后破坏网络。或者，一个恶意的人可能使用软件生成大量的虚假DHCP客户端请求，以耗尽DHCP服务器池中的所有IP地址。更简单地说，这可能被一个小偷用来从组织那里窃取IP地址以供自己使用。'
- en: 'These are obviously serious concerns. The normal recommended solutions to these
    risks generally involve providing security at lower layers. For example, one of
    the most important techniques for preventing unauthorized servers and clients
    is careful control over physical access to the network: layer 1 security. Security
    techniques implemented at layer 2 may also be of use—for example, in the case
    of wireless LANs. Since DHCP runs over UDP and IP, one could use IPSec at layer
    3 to provide authentication.'
  id: totrans-939
  prefs: []
  type: TYPE_NORMAL
  zh: 这些显然是严重的问题。通常推荐的解决这些风险的方案通常涉及在较低层提供安全措施。例如，防止未经授权的服务器和客户端的一个重要技术是仔细控制对网络的物理访问：第1层安全。在第二层实现的安全技术也可能有用——例如，在无线局域网的情况下。由于DHCP运行在UDP和IP上，可以在第3层使用IPSec提供认证。
- en: DHCP Authentication
  id: totrans-940
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCP认证
- en: To try to address some of the more specific security concerns within DHCP itself,
    in June 2001, the IETF published RFC 3118, "Authentication for DHCP Messages."
    This standard describes an enhancement that replaces the normal DHCP messages
    with authenticated ones. Clients and servers check the authentication information
    and reject messages that come from invalid sources. The technology involves the
    use of a new DHCP option type, the Authentication option, and operating changes
    to several of the leasing processes to use this option.
  id: totrans-941
  prefs: []
  type: TYPE_NORMAL
  zh: 为了尝试解决DHCP本身的一些更具体的安全问题，2001年6月，IETF发布了RFC 3118，“DHCP消息的身份验证”。这个标准描述了一种增强功能，用经过身份验证的消息替换了正常的DHCP消息。客户端和服务器检查身份验证信息，并拒绝来自无效来源的消息。这项技术涉及使用一种新的DHCP选项类型，即身份验证选项，并对几个租赁过程进行操作更改以使用此选项。
- en: Unfortunately, 2001 was pretty late in the DHCP game, and there are millions
    of DHCP clients and servers around that don't support this new standard. Both
    the client and server must be programmed to use authentication for this method
    to have value. A DHCP server that supports authentication could use it for clients
    that support the feature and skip it for those that do not. However, the fact
    that this option is not universal means that it is not widely deployed, and most
    networks must rely on more conventional security measures.
  id: totrans-942
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，2001年在DHCP领域已经相当晚，现在有数百万的DHCP客户端和服务器不支持这个新标准。客户端和服务器都必须编程以使用身份验证，这样这种方法才有价值。支持身份验证的DHCP服务器可以为支持该功能的客户端使用它，而对于不支持该功能的客户端则跳过。然而，由于这个选项不是通用的，所以它并没有得到广泛部署，大多数网络必须依赖更传统的安全措施。
- en: DHCP for IP Version 6 (DHCPv6)
  id: totrans-943
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: DHCP for IP Version 6 (DHCPv6)
- en: 'DHCP is currently the standard host configuration protocol for the TCP/IP protocol
    suite. TCP/IP is built on version 4 of IP (IPv4). However, development work has
    been under way since the early 1990s on a successor to IPv4: version 6 of the
    Internet Protocol (IPv6; see [Part II-4](pt07.html "Part II-4. INTERNET PROTOCOL
    VERSION 6 (IPV6)") for more information). This new IP standard will be the future
    of TCP/IP.'
  id: totrans-944
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP目前是TCP/IP协议套件的标准主机配置协议。TCP/IP建立在IP版本4（IPv4）之上。然而，自20世纪90年代初以来，一直在进行IPv4的继任者：互联网协议版本6（IPv6；更多信息请参阅[第二部分-4](pt07.html
    "第二部分-4. 互联网协议版本6 (IPv6)")）。这个新的IP标准将是TCP/IP的未来。
- en: While most of the changes that IPv6 brings impact technologies at the lower
    layers of the TCP/IP architectural model, the significance of the modifications
    means that many other TCP/IP protocols are also affected. This is particularly
    true of protocols that work with addresses or configuration information, including
    DHCP. For this reason, a new version of DHCP is required for IPv6\. Development
    has been under way for quite some time on *DHCP for IPv6*, also sometimes called
    *DHCPv6*. At the time of writing, DHCPv6 has not yet been formally published—it
    is still an Internet draft under discussion.
  id: totrans-945
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然IPv6带来的大多数变化影响的是TCP/IP架构模型中的底层技术，但这些修改的重要性意味着许多其他TCP/IP协议也受到影响。这尤其适用于与地址或配置信息一起工作的协议，包括DHCP。因此，IPv6需要一个新版本的DHCP。在写作本文时，DHCPv6尚未正式发布——它仍然是一个正在讨论中的互联网草案。
- en: Note
  id: totrans-946
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*In discussions purely oriented around IPv6, DHCPv6 is sometimes just called
    DHCP, and the original DHCP is called DHCPv4*.'
  id: totrans-947
  prefs: []
  type: TYPE_NORMAL
  zh: '*在纯粹围绕IPv6的讨论中，DHCPv6有时简称为DHCP，而原始的DHCP则称为DHCPv4*。'
- en: Two Methods for Autoconfiguration in IPv6
  id: totrans-948
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: IPv6中的两种自动配置方法
- en: 'One of the many enhancements introduced in IPv6 is an overall strategy for
    easier administration of IP devices, including host configuration. There are two
    basic methods defined for autoconfiguration of IPv6 hosts:'
  id: totrans-949
  prefs: []
  type: TYPE_NORMAL
  zh: 在IPv6中引入的许多改进之一是为更容易管理IP设备制定的整体策略，包括主机配置。为IPv6主机的自动配置定义了两种基本方法：
- en: '**Stateless Autoconfiguration** A method defined to allow a host to configure
    itself without help from any other device.'
  id: totrans-950
  prefs: []
  type: TYPE_NORMAL
  zh: '**无状态自动配置** 一种定义出来的方法，允许主机在没有其他设备帮助的情况下自行配置。'
- en: '**Stateful Autoconfiguration** A technique where configuration information
    is provided to a host by a server.'
  id: totrans-951
  prefs: []
  type: TYPE_NORMAL
  zh: '**有状态自动配置** 一种技术，其中配置信息由服务器提供给主机。'
- en: Which of these methods is used depends on the characteristics of the network.
    Stateless autoconfiguration is described in RFC 2462 and discussed in [Chapter 24](ch24.html
    "Chapter 24. IPV6 OVERVIEW, CHANGES, AND TRANSITION"). Stateful autoconfiguration
    for IPv6 is provided by DHCPv6\. As with regular DHCP, DHCPv6 may be used to obtain
    an IP address and other configuration parameters, or just to get configuration
    parameters when the client already has an IP address.
  id: totrans-952
  prefs: []
  type: TYPE_NORMAL
  zh: 使用哪种方法取决于网络的特点。无状态自动配置在RFC 2462中描述，并在[第24章](ch24.html "第24章。IPV6概述、变更和过渡")中讨论。IPv6的有状态自动配置由DHCPv6提供。与常规DHCP一样，DHCPv6可以用来获取IP地址和其他配置参数，或者当客户端已经有一个IP地址时，仅获取配置参数。
- en: DHCPv6 Operation Overview
  id: totrans-953
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCPv6操作概述
- en: The operation of DHCPv6 is similar to that of DHCPv4, but the protocol itself
    has been completely rewritten. It is not based on the older DHCP or on BOOTP,
    except in conceptual terms. It still uses UDP, but it uses new port numbers, a
    new message format, and restructured options. All of this means that the new protocol
    is not strictly compatible with DHCPv4 or BOOTP, though I believe work is under
    way on a method to allow DHCPv6 servers to work with IPv4 devices.
  id: totrans-954
  prefs: []
  type: TYPE_NORMAL
  zh: DHCPv6的操作与DHCPv4类似，但协议本身已经被完全重写。它不仅在概念上基于旧的DHCP或BOOTP。它仍然使用UDP，但使用新的端口号、新的消息格式和重新构建的选项。所有这些都意味着新的协议与DHCPv4或BOOTP并不完全兼容，尽管我相信正在进行一项方法的研究，以允许DHCPv6服务器与IPv4设备一起工作。
- en: Tip
  id: totrans-955
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '**KEY CONCEPT** Since DHCP works with IP addresses and other configuration
    parameters, the change from IPv4 to IPv6 requires a new version of DHCP commonly
    called *DHCPv6*. This new DHCP represents a significant change from the original
    DHCP and is still under development. DHCPv6 is used for IPv6 *stateful autoconfiguration*.
    The alternative is *stateless autoconfiguration*, a feature of IPv6 that allows
    a client to determine its IP address without need for a server.'
  id: totrans-956
  prefs: []
  type: TYPE_NORMAL
  zh: '**关键概念** 由于DHCP与IP地址和其他配置参数一起工作，从IPv4到IPv6的转换需要一个新的DHCP版本，通常称为*DHCPv6*。这个新的DHCP与原始DHCP有显著的不同，并且仍在开发中。DHCPv6用于IPv6的*有状态自动配置*。另一种选择是*无状态自动配置*，这是IPv6的一个特性，允许客户端在不需要服务器的情况下确定其IP地址。'
- en: DHCPv6 is also oriented around IPv6 methods of addressing, especially the use
    of link-local scoped multicast addresses (see [Chapter 25](ch25.html "Chapter 25. IPV6
    ADDRESSING")). This allows efficient communication even before a client has been
    assigned an IP address. Once a client has an address and knows the identity of
    a server, it may communicate with the server directly using unicast addressing.
  id: totrans-957
  prefs: []
  type: TYPE_NORMAL
  zh: DHCPv6也是围绕IPv6的寻址方法，特别是链路本地作用域的多播地址的使用（见[第25章](ch25.html "第25章。IPV6寻址"））。这允许在客户端分配IP地址之前进行有效的通信。一旦客户端有了地址并知道了服务器的身份，它就可以使用单播寻址直接与服务器通信。
- en: DHCPv6 Message Exchanges
  id: totrans-958
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DHCPv6消息交换
- en: 'There are two basic client/server message exchanges that are used in DHCPv6:
    the *four-message exchange* and the *two-message exchange*. The former is used
    when a client needs to obtain an IPv6 address and other parameters. This process
    is similar to the regular DHCP address allocation process. Highly simplified,
    it involves these steps:'
  id: totrans-959
  prefs: []
  type: TYPE_NORMAL
  zh: DHCPv6中使用了两种基本的客户端/服务器消息交换：*四消息交换*和*两消息交换*。前者用于客户端需要获取IPv6地址和其他参数时。这个过程与常规DHCP地址分配过程类似。高度简化地，它涉及以下步骤：
- en: The client sends a multicast Solicit message to find a DHCPv6 server and ask
    for a lease.
  id: totrans-960
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 客户端发送一个多播请求消息来寻找DHCPv6服务器并请求租约。
- en: Any server that can fulfill the client's request responds to it with an Advertise
    message.
  id: totrans-961
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 任何能够满足客户端请求的服务器都会用一条广告消息来响应它。
- en: The client chooses one of the servers and sends a Request message to it, asking
    to confirm the offered address and other parameters.
  id: totrans-962
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 客户端选择一个服务器并发送一个请求消息给它，请求确认提供的地址和其他参数。
- en: The server responds with a Reply message to finalize the process.
  id: totrans-963
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 服务器通过回复消息来响应，以最终完成这个过程。
- en: There is also a shorter variation of the four-message process above, where a
    client sends a Solicit message and indicates that a server should respond back
    immediately with a Reply message.
  id: totrans-964
  prefs: []
  type: TYPE_NORMAL
  zh: 上述四消息过程的简短变体也存在，其中客户端发送一个请求消息，并指示服务器应立即回复一个回复消息。
- en: 'If the client already has an IP address, either assigned manually or obtained
    in some other way, a simpler process can be undertaken, similar to how in regular
    DHCP the DHCPINFORM message is used:'
  id: totrans-965
  prefs: []
  type: TYPE_NORMAL
  zh: 如果客户端已经有一个IP地址，无论是手动分配的还是以其他方式获得的，可以采取一个更简单的流程，类似于在常规DHCP中如何使用DHCPINFORM消息：
- en: The client multicasts an Information-Request message.
  id: totrans-966
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 客户端广播一个Information-Request（信息请求）消息。
- en: A server with configuration information for the client sends back a Reply message.
  id: totrans-967
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 拥有客户端配置信息的服务器发送回一个Reply（回复）消息。
- en: As in regular DHCP, a DHCPv6 client renews its lease after a period of time
    by sending a Renew message. DHCPv6 also supports relay agent functionality, as
    in DHCPv4.
  id: totrans-968
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 与常规DHCP一样，DHCPv6客户端通过发送Renew（续租）消息在一段时间后更新其租约。DHCPv6也支持中继代理功能，与DHCPv4相同。
