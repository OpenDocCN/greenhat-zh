- en: Chapter 19\. OPENVPN SERVER 2.0.6
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第 19 章. OPENVPN 服务器 2.0.6
- en: '[HTTP://OPENVPN.NET](HTTP://OPENVPN.NET)'
  id: totrans-1
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[HTTP://OPENVPN.NET](HTTP://OPENVPN.NET)'
- en: 19.1\. SUMMARY
  id: totrans-2
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.1. 摘要
- en: OpenVPN is an open source VPN implementation that uses the OpenSSL library to
    encrypt data traveling over a public network. A VPN (virtual private network)
    is a private connection from one point to another that utilizes an existing network
    as a transport medium. VPNs are popular with businesses because they allow secure
    communication between sites or employees without the need to lease dedicated WAN
    (wide area network) lines.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: OpenVPN 是一个开源 VPN 实现，它使用 OpenSSL 库加密通过公共网络传输的数据。VPN（虚拟专用网络）是从一个点到另一个点的私有连接，它利用现有网络作为传输媒介。VPN
    因其允许在站点或员工之间进行安全通信而受到企业的青睐，无需租赁专用 WAN（广域网）线路。
- en: James Yonan began developing OpenVPN in early 2002\. Yonan's employer at the
    time afforded him the freedom to telecommute. As a result, he became interested
    in telecommunication tools. His examination of the open source VPN community revealed
    a divide between security-conscious and usability-based software projects. Yonan's
    OpenVPN has grown into a very popular and complete VPN solution that addresses
    both security and usability issues. Yonan continues development of OpenVPN as
    project leader.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 詹姆斯·约南（James Yonan）在 2002 年初开始开发 OpenVPN。当时他的雇主允许他远程办公，因此他对远程通信工具产生了兴趣。他对开源
    VPN 社区的考察揭示了安全意识与基于可用性软件项目之间的分歧。约南的 OpenVPN 已经发展成为一个非常受欢迎且功能完善的 VPN 解决方案，它解决了安全和可用性问题。约南作为项目负责人继续开发
    OpenVPN。
- en: There are several VPN implementations, each of which offers various levels of
    security and functionality.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种 VPN 实现，每种都提供不同层次的安全性和功能性。
- en: PPTP (Point to Point Tunneling Protocol) is used to implement some VPNs. It
    is considered insecure due to a publicly known security exploit.
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: PPTP（点对点隧道协议）用于实现一些 VPN。由于一个公开的安全漏洞，它被认为是不安全的。
- en: L2TP/IPsec (Layer 2 Tunneling Protocol with Internet Protocol Security) is a
    reasonably secure VPN solution. However, it has problems traversing many basic
    NAT routers.
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: L2TP/IPsec（带有互联网协议安全的第二层隧道协议）是一个相对安全的 VPN 解决方案。然而，它穿越许多基本 NAT 路由器时存在问题。
- en: OpenVPN is a cross-platform VPN solution that has proven to be secure, sustainable
    across NAT routers, and scalable. OpenVPN does require client software installation
    to function and can be complicated to set up initially.
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OpenVPN 是一个跨平台 VPN 解决方案，已被证明是安全的、在 NAT 路由器上可持续的，并且可扩展。OpenVPN 需要安装客户端软件才能运行，并且最初设置可能很复杂。
- en: OpenVPN supports routed or bridged VPNs. A routed VPN creates a virtual subnet
    for the client and routes traffic over the VPN if addressed to a system on the
    remote side. A bridged VPN connects clients to an existing network subnet. Data
    is broadcast through the bridge like a virtual Ethernet hub. A bridged VPN tunnel
    can provide a client with the same network functionality as being connected locally
    to that network. This guide outlines the setup of a bridged VPN rather than the
    default routed method.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: OpenVPN 支持路由或桥接 VPN。路由 VPN 为客户端创建一个虚拟子网，并将流量通过 VPN 路由到远程端系统。桥接 VPN 将客户端连接到现有的网络子网。数据像虚拟以太网集线器一样通过桥接广播。桥接
    VPN 隧道可以为客户端提供与本地连接到该网络相同的网络功能。本指南概述了桥接 VPN 的设置，而不是默认的路由方法。
- en: A bridged VPN joins remote clients to a local network as if they were onsite,
    with all of the benefits of being on that local network. Also, bridged VPNs can
    use non-routable protocols (required by Windows file shares, broadcast traffic,
    LAN games, and so on) that small office and home office users may find useful.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 桥接 VPN 将远程客户端连接到本地网络，就像它们在现场一样，享有该本地网络的全部好处。此外，桥接 VPN 可以使用非路由协议（由 Windows 文件共享、广播流量、局域网游戏等所需），小型办公室和家庭办公室用户可能会发现这些协议很有用。
- en: 19.2\. RESOURCES
  id: totrans-11
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.2. 资源
- en: OpenVPN Articles
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: OpenVPN 文章
- en: '[http://openvpn.net/articles.html](http://openvpn.net/articles.html)'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://openvpn.net/articles.html](http://openvpn.net/articles.html)'
- en: 19.3\. REQUIRED
  id: totrans-14
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.3. 必需条件
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) FreeBSD 7.0-RELEASE
    (see "[FreeBSD 7.0](freebsd_7.0_split_000.html#freebsd_7.0)")'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
  zh: '![FreeBSD 7.0-RELEASE](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg)
    FreeBSD 7.0-RELEASE（见 "[FreeBSD 7.0](freebsd_7_0_split_000.html#freebsd_7_0)"）'
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Updated ports
    collection (see "[FreeBSD Ports Collection](freebsd_ports_collection.html#freebsd_ports_collection)")'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![更新后的端口集合](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) 更新后的端口集合（见
    "[FreeBSD 端口集合](freebsd_ports_collection.html#freebsd_ports_collection)"）'
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Internet
    connection'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '![互联网连接](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg)'
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) OpenSSL (see
    "[OpenSSL 0.9.8g](openssl_0.9.8g.html#openssl_0.9.8g)")'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![OpenSSL](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) OpenSSL
    (参见 "[OpenSSL 0.9.8g](openssl_0.9.8g.html#openssl_0.9.8g)")'
- en: 19.4\. OPTIONAL
  id: totrans-19
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.4\. 可选
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Local DNS
    server (see "[ISC BIND DNS Server 9.4.2](isc_bind_dns_server_9.4.2.html#isc_bind_dns_server_9.4.2)")
    for resolving hostnames of systems on the local network and resolving VPN client
    DNS queries'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '![本地DNS服务器](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) 用于解析本地网络系统主机名和解析VPN客户端DNS查询的本地DNS服务器（参见
    "[ISC BIND DNS服务器 9.4.2](isc_bind_dns_server_9.4.2.html#isc_bind_dns_server_9.4.2)"）'
- en: 19.5\. PREPARATION
  id: totrans-21
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.5\. 准备
- en: You'll need to determine your local network's default gateway, default DNS servers,
    and the device name of your server's network interface. The commands shown below
    will help you obtain these addresses.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要确定您本地网络默认网关、默认DNS服务器以及服务器网络接口的设备名称。以下命令将帮助您获取这些地址。
- en: 'To display the IP address of the local network''s default gateway and the device
    name, become root and enter:'
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要显示本地网络默认网关的IP地址和设备名称，成为root用户并输入：
- en: '[PRE0]'
  id: totrans-24
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Here, the default gateway is `192.168.1.1`. The device name of the network interface
    is `ed0`.
  id: totrans-25
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在这里，默认网关是`192.168.1.1`。网络接口的设备名为`ed0`。
- en: 'To display the DNS servers currently configured for use on your system, enter:'
  id: totrans-26
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要显示当前配置用于系统上的DNS服务器，请输入：
- en: '[PRE1]'
  id: totrans-27
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 19.6\. INSTALL
  id: totrans-28
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.6\. 安装
- en: 'To begin the OpenVPN installation process, enter the following commands:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始OpenVPN的安装过程，请输入以下命令：
- en: '[PRE2]'
  id: totrans-30
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: A menu should appear with an option for OpenVPN. We will leave this option at
    its default (off), so press [tab] to select OK and then [enter] to continue.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 应该会出现一个菜单，其中包含一个OpenVPN选项。我们将保留此选项的默认设置（关闭），因此按[Tab]键选择OK，然后按[Enter]键继续。
- en: 19.7\. CONFIGURE
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.7\. 配置
- en: Once the installation process completes, it is time to configure OpenVPN for
    use on your system.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 安装过程完成后，是时候为您的系统配置OpenVPN了。
- en: 'Create a directory named openvpn in /usr/local/etc and copy the sample configuration
    file to it with the following commands (we''ll edit this file later):'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在/usr/local/etc下创建一个名为openvpn的目录，并使用以下命令将示例配置文件复制到其中（我们稍后会编辑此文件）：
- en: '[PRE3]'
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Begin creating the SSL Certificates and keys that are necessary for OpenVPN
    to function. Create a subdirectory of the openvpn directory named keys, for use
    as your working directory. The following commands will create the keys directory
    and copy the appropriate OpenSSL and script files to it:'
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 开始创建OpenVPN正常运行所需的SSL证书和密钥。在openvpn目录下创建一个名为keys的子目录，用作工作目录。以下命令将创建keys目录并将适当的OpenSSL和脚本文件复制到其中：
- en: '[PRE4]'
  id: totrans-37
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Create a CA certificate and key using the CA.pl script:'
  id: totrans-38
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用CA.pl脚本创建CA证书和密钥：
- en: '[PRE5]'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: When prompted for a CA certificate filename, simply press [enter] to create
    the file.
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当提示输入CA证书文件名时，只需按[Enter]键创建文件。
- en: When asked for a PEM passphrase, enter one, and be sure to remember it. You
    will need it later.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当提示输入PEM密码短语时，输入一个，并确保记住它。您稍后需要它。
- en: When prompted for Country Name, State, Locality, and so on, enter the appropriate
    responses. Enter `**OpenVPN-CA**` for the Common Name.
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当提示输入国家名称、州、城市等时，输入适当的响应。将通用名称输入为`**OpenVPN-CA**`。
- en: After entering an email address, you will be prompted for a challenge password.
    Just press [enter] twice; the challenge password and company name are optional.
    You will be returned to the command prompt once you enter the PEM passphrase you
    created in step 5.
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入电子邮件地址后，您将被提示输入挑战密码。只需按[Enter]键两次；挑战密码和公司名称是可选的。您输入步骤5中创建的PEM密码短语后，将返回到命令提示符。
- en: 'Generate a certificate request. Enter the following command to begin this process:'
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 生成证书请求。输入以下命令开始此过程：
- en: '[PRE6]'
  id: totrans-45
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: When asked for a passphrase, enter the same one you used earlier for the sake
    of simplicity.
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当提示输入密码短语时，为了简单起见，请输入您之前使用的相同密码。
- en: Enter the same information you entered earlier, but enter `**server**` for the
    Common Name.
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入您之前输入的信息，但将通用名称输入为`**服务器**`。
- en: After entering an email address, you will be prompted for a challenge password.
    Just press [enter] twice; the challenge password and company name are optional.
    You will be returned to the command prompt.
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入电子邮件地址后，您将被提示输入挑战密码。只需按[Enter]键两次；挑战密码和公司名称是可选的。您输入步骤5中创建的PEM密码短语后，将返回到命令提示符。
- en: 'Create the signed certificate from the request and certificate authority files
    we produced above. Begin the certificate signing process with:'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从我们生成的请求和证书权威机构文件创建签名的证书。使用以下命令开始证书签名过程：
- en: '[PRE7]'
  id: totrans-50
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Enter the password you assigned earlier.
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入您之前分配的密码。
- en: Answer yes to the Sign the certificate and commit prompts to create a signed
    SSL Certificate.
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 回答“是”以签署证书并提交提示以创建一个签名的 SSL 证书。
- en: The signed SSL Certificate is in the current working directory and is named
    newcert.pem. To make it easily identifiable, we'll copy this file to openvpn-cert.pem
    and our private key to openvpn-encrypted-key.pem below. The CA certificate and
    key are in the demoCA directory. We will copy them to the current working directory
    and rename them openvpn-CAcert.pem and openvpn-encrypted-CAkey.pem respectively.
  id: totrans-53
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 签名的 SSL 证书位于当前工作目录中，名称为 newcert.pem。为了使其易于识别，我们将将其复制到 openvpn-cert.pem，并将我们的私钥复制到
    openvpn-encrypted-key.pem。CA 证书和密钥位于 demoCA 目录中。我们将将它们复制到当前工作目录，并分别重命名为 openvpn-CAcert.pem
    和 openvpn-encrypted-CAkey.pem。
- en: 'Enter the following commands to organize your SSL Certificates as mentioned
    above:'
  id: totrans-54
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入以下命令以按上述方式组织您的 SSL 证书：
- en: '[PRE8]'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'The openvpn-encrypted-key.pem file is encrypted with the password you entered
    earlier. We will remove this encryption so OpenVPN can use the file. The following
    commands will remove the encryption and make the file readable by the root user:'
  id: totrans-56
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: openvpn-encrypted-key.pem 文件使用您之前输入的密码加密。我们将移除此加密，以便 OpenVPN 可以使用该文件。以下命令将移除加密并使文件可供
    root 用户读取：
- en: 'Code View:'
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 代码视图：
- en: '[PRE9]'
  id: totrans-58
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Now we begin producing client certificates with private keys for use with OpenVPN.
    In this example, we will use the names client01, client02, and so on. (You may
    use a different naming convention that helps you to identify clients easily.)
  id: totrans-59
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 现在我们开始生成用于 OpenVPN 的客户端证书和私钥。在此示例中，我们将使用 client01、client02 等名称。（您可以使用不同的命名约定，以便您能够轻松识别客户端。）
- en: 'To create the private key and certificate request for client01, enter the following
    commands:'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要为 client01 创建私钥和证书请求，请输入以下命令：
- en: '[PRE10]'
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: When prompted for the Country Name, State, Locality, and so on, enter the appropriate
    responses.
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当提示输入国家名称、州、地区等时，输入适当的响应。
- en: You must enter client01 for the Common Name because each client must have a
    unique Common Name. You may replace `*client01*` with another name if you used
    a different naming convention, as long as each new client name is unique.
  id: totrans-63
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您必须输入 client01 作为通用名称，因为每个客户端都必须有一个唯一的通用名称。如果您使用了不同的命名约定，您可以将 `*client01*` 替换为另一个名称，只要每个新客户端名称都是唯一的。
- en: '* * *'
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '***'
- en: '***Note:*** You may press [enter] at the optional challenge password and company
    name prompts to bypass them; they are not necessary.'
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '***注意：*** 在可选的挑战密码和公司名称提示时，您可以按 [enter] 键跳过它们；它们不是必需的。'
- en: '* * *'
  id: totrans-66
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '***'
- en: 'Create a signed client certificate using the OpenVPN certificate authority
    we created earlier:'
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用我们之前创建的 OpenVPN 证书权威机构创建一个签名的客户端证书：
- en: '[PRE11]'
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: When prompted, enter the password you assigned earlier.
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当提示时，输入您之前分配的密码。
- en: Answer yes to the Sign the certificate and commit prompts to continue.
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 回答“是”以签署证书并提交提示以继续。
- en: To create additional certificates and keys for additional clients, repeat steps
    17 through 22 above, substituting client02, client03, and so on for client01\.
    (Be sure to change the Common Name to reflect the iteration of the client you
    are creating.)
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要为其他客户端创建额外的证书和密钥，重复上述步骤 17 到 22，将 client02、client03 等替换为 client01。（务必将通用名称更改为反映您正在创建的客户端的迭代。）
- en: Once you have created your client certificates, transfer the appropriate certificate
    (client01-cert.pem) and key (client01-key.pem) to your client system using a secure
    medium (SFTP, removable media, etc.). Do not expose the client01-key.pem file
    to the public!
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 一旦您创建了客户端证书，请使用安全介质（SFTP、可移动媒体等）将适当的证书（client01-cert.pem）和密钥（client01-key.pem）传输到您的客户端系统。不要将
    client01-key.pem 文件暴露给公众！
- en: 'You need to create a Diffie-Hellman parameter in order for OpenVPN to function
    correctly. To do so, ensure that you are still in the /usr/local/etc/openvpn/keys
    working directory, then enter the following command:'
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您需要创建一个 Diffie-Hellman 参数，以便 OpenVPN 正确运行。为此，请确保您仍在 /usr/local/etc/openvpn/keys
    工作目录中，然后输入以下命令：
- en: '[PRE12]'
  id: totrans-74
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Edit the openvpn.conf file that you created in step 1\. First, open openvpn.conf:'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 编辑您在步骤 1 中创建的 openvpn.conf 文件。首先，打开 openvpn.conf：
- en: '[PRE13]'
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Uncomment the `dev tap` declaration (~52) by removing the semicolon (`;`) from
    the beginning of the line. Comment the `dev tun` declaration by inserting a semicolon
    at the beginning of the line. This tells OpenVPN to use the `tap` device, which
    is needed for Ethernet bridging. These two lines should now appear like this:'
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 取消注释`dev tap`声明（~52），通过删除该行开头的分号（`;`）。通过在行首插入分号注释`dev tun`声明。这告诉OpenVPN使用`tap`设备，这对于以太网桥接是必需的。这两行现在应如下所示：
- en: '[PRE14]'
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Tell OpenVPN where to find the CA certificate, server certificate, and server
    private key. Scroll down to the `ca` declaration (~78) and replace `ca.crt` with
    the relative path (relative to the openvpn directory) and filename of your CA
    certificate file. Do the same for the `cert` and `key` declarations. The lines
    should appear as follows:'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 告诉OpenVPN在哪里可以找到CA证书、服务器证书和服务器私钥。向下滚动到`ca`声明（~78），将`ca.crt`替换为相对于openvpn目录的相对路径和CA证书文件名。对`cert`和`key`声明做同样的操作。这些行应如下所示：
- en: '[PRE15]'
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Tell OpenVPN where the Diffie-Hellman parameter file resides. Modify the `dh`
    declaration (~87) to point to dh2048.pem in the openvpn directory. It should now
    appear as follows:'
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 告诉OpenVPN Diffie-Hellman参数文件所在的位置。将`dh`声明（~87）修改为指向openvpn目录中的dh2048.pem。现在它应如下所示：
- en: '[PRE16]'
  id: totrans-82
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Comment out the `server` declaration (~96) by inserting a semicolon (`;`) at
    the beginning of the line. This line should now appear as follows:'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注释掉`server`声明（~96），通过在行首插入分号（`;`）。现在该行应如下所示：
- en: '[PRE17]'
  id: totrans-84
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Uncomment the `server-bridge` statement (~115) by removing the semicolon from
    the beginning of the line. Modify the IP addresses on this line to reflect your
    network: The first IP address should be your local network''s default gateway;
    the second is the netmask of the local network; the third defines the lower limit
    of the client IP address pool; and the fourth defines the upper limit of the client
    IP address pool. This line should appear something like this:'
  id: totrans-85
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 取消注释`server-bridge`语句（~115），通过删除该行开头的分号。修改该行上的IP地址以反映您的网络：第一个IP地址应该是您本地网络的默认网关；第二个是本地网络的子网掩码；第三个定义客户端IP地址池的下限；第四个定义客户端IP地址池的上限。该行应类似于以下内容：
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjVnMA--.jpg)'
  id: totrans-86
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '* * *'
- en: '* * *'
  id: totrans-87
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: '***Note:*** If you are using a local DHCP server (common in NAT routers) be
    sure the range you specify here doesn''t overlap the range of IP addresses used
    by the DHCP server. If you are using a DHCP server built into a NAT router, check
    its configuration interface for this range. For example, if the DHCP server has
    a starting IP address of 192.168.1.10 with a maximum of 50 users, you would have
    a range from 192.168.1.10 to 192.168.1.60, and you could safely use a range of
    192.168.1.61 to 192.168.1.69 for VPN clients (assuming there are no static IP
    assignments in this range).'
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '***注意：*** 如果您正在使用本地DHCP服务器（在NAT路由器中很常见），请确保您在此处指定的范围不与DHCP服务器使用的IP地址范围重叠。如果您正在使用内置在NAT路由器中的DHCP服务器，请检查其配置界面以获取此范围。例如，如果DHCP服务器有一个起始IP地址为192.168.1.10，最大用户数为50，则您将有一个从192.168.1.10到192.168.1.60的范围，并且您可以安全地使用从192.168.1.61到192.168.1.69的范围用于VPN客户端（假设在此范围内没有静态IP分配）。'
- en: '* * *'
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: 'Uncomment the `push redirect-gateway` declaration (~181). This line should
    appear as follows:'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 取消注释`push redirect-gateway`声明（~181）。该行应如下所示：
- en: '[PRE18]'
  id: totrans-91
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '* * *'
  id: totrans-92
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: '***Note:*** This option changes the default gateway of the VPN client to that
    of the gateway on the OpenVPN server side network. It is useful when you are on
    an untrusted remote network (such as those found in hotel rooms, Wi-Fi hotspots,
    etc.) and want to eliminate the risk of exposing your data to potential attackers.
    You may leave this line untouched if you do not wish to enable this feature, and
    skip to step 34 below.'
  id: totrans-93
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '***注意：*** 此选项将VPN客户端的默认网关更改为OpenVPN服务器端网络上的网关。当您处于不受信任的远程网络（如酒店房间、Wi-Fi热点等）中，并希望消除将您的数据暴露给潜在攻击者的风险时，此功能很有用。如果您不希望启用此功能，请保持此行不变，并跳到以下步骤34。'
- en: '* * *'
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: Uncomment the `push dhcp-option` statement (~187). This option instructs VPN
    clients to use the specified DNS server for hostname lookups. This line should
    now appear as follows, with your default DNS server IP substituted for the one
    shown here in italics.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 取消注释`push dhcp-option`语句（~187）。此选项指示VPN客户端使用指定的DNS服务器进行主机名查找。现在该行应如下所示，用您的默认DNS服务器IP地址替换此处斜体显示的IP地址。
- en: '[PRE19]'
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '* * *'
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: '***Note:*** As of this writing the above feature functions on GUI OpenVPN clients
    running Windows (OpenVPN GUI) or Macintosh (Tunnelblick). If you have clients
    on other platforms, visit their client software vendor for updates or manually
    set their DNS server IP after their VPN connection is established.'
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '***注意：*** 到本文写作时，上述功能在Windows（OpenVPN GUI）或Macintosh（Tunnelblick）的GUI OpenVPN客户端上运行。如果您在其他平台上拥有客户端，请访问其客户端软件供应商以获取更新，或在VPN连接建立后手动设置其DNS服务器IP地址。'
- en: '* * *'
  id: totrans-99
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: 'To enable communication between VPN clients (two users connected simultaneously),
    uncomment the `client-to-client` declaration (~196). The line should appear as
    follows:'
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了启用VPN客户端之间的通信（同时连接的两个用户），取消注释`client-to-client`声明（~196）。该行应如下所示：
- en: '[PRE20]'
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Uncomment `user nobody` and `group nobody` (~254). This reduces OpenVPN''s
    privileges after initialization. These two lines should appear like this:'
  id: totrans-102
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 取消注释`user nobody`和`group nobody`（~254）。这减少了初始化后OpenVPN的权限。这两行应如下所示：
- en: '[PRE21]'
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Save and exit.
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 保存并退出。
- en: 19.8\. TESTING
  id: totrans-105
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.8\. 测试
- en: In this section, we'll perform some tests to confirm that OpenVPN answers requests
    properly. You'll need a computer with an OpenVPN client installed and configured
    before continuing. (See "[Notes](notes.html#notes)" of page 143 for information
    on client setup.)
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将执行一些测试以确认OpenVPN能够正确响应请求。在继续之前，您需要一台安装并配置了OpenVPN客户端的计算机。（有关客户端设置的信息，请参阅第143页的“[注意事项](notes.html#notes)”）
- en: 'The kernel modules `if_bridge` and `if_tap` must be loaded in order to allow
    traffic on a remote client to bridge into the local network. Load these two modules
    like this:'
  id: totrans-107
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了允许远程客户端上的流量桥接到本地网络，必须加载内核模块`if_bridge`和`if_tap`。如下加载这两个模块：
- en: '[PRE22]'
  id: totrans-108
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Create the virtual bridge and tap network interfaces that will act as a virtual
    hub between remote clients and the local network, as follows (replace `*ed0*`
    with the device name of your network interface):'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建虚拟桥接和tap网络接口，这些接口将作为远程客户端和本地网络之间的虚拟中心，如下所示（将`*ed0*`替换为您的网络接口设备名称）：
- en: '[PRE23]'
  id: totrans-110
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Start OpenVPN and watch for incoming connections from your OpenVPN client.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 启动OpenVPN并监视来自您的OpenVPN客户端的传入连接。
- en: '[PRE24]'
  id: totrans-112
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'You should see output similar to this:'
  id: totrans-113
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您应该看到类似以下输出：
- en: 'Code View:'
  id: totrans-114
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 代码视图：
- en: '[PRE25]'
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '* * *'
  id: totrans-116
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: '***Note:*** If possible, try connecting a client to the server from outside
    the local network. (Remember to forward UDP port 1194 to the server if it is behind
    a NAT router.) Once a connection is initiated, you should see status messages
    scroll by in real time.'
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '***注意：*** 如果可能，尝试从本地网络外部将客户端连接到服务器。（如果服务器位于NAT路由器后面，请记住转发UDP端口1194到服务器。）一旦发起连接，您应该看到实时滚动的状态消息。'
- en: '* * *'
  id: totrans-118
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: When you have completed testing, press [ctrl-C] at the console to shut down
    OpenVPN. Assuming the test was successful, configure OpenVPN and the necessary
    bridge and tap interfaces to start automatically at system startup.
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当您完成测试后，在控制台按下[ctrl-C]以关闭OpenVPN。假设测试成功，配置OpenVPN以及必要的桥接和tap接口以在系统启动时自动启动。
- en: 'Enable the `if_bridge` and `if_tap` kernel modules at startup by first opening
    loader.conf in /boot like this:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过首先以如下方式打开/boot中的loader.conf来在启动时启用`if_bridge`和`if_tap`内核模块：
- en: '[PRE26]'
  id: totrans-121
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Carefully add the following lines and double-check for typos:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 仔细添加以下行并检查是否有错别字：
- en: '[PRE27]'
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Save and exit.
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存并退出。
- en: 'Add a single line to the sysctl.conf file in /etc to automatically apply the
    `up` flag to the `tap0` interface when the OpenVPN daemon opens it. To do so,
    open sysctl.conf like so:'
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在`/etc`目录下的sysctl.conf文件中添加一行，以在OpenVPN守护进程打开`tap0`接口时自动应用`up`标志。为此，以如下方式打开sysctl.conf：
- en: '[PRE28]'
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'and add the following line:'
  id: totrans-127
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 并添加以下行：
- en: '[PRE29]'
  id: totrans-128
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Save and exit.
  id: totrans-129
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 保存并退出。
- en: 'Add the OpenVPN startup lines and bridge statements to the rc.conf file in
    /etc. Open rc.conf:'
  id: totrans-130
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将OpenVPN启动行和桥接语句添加到`/etc`目录下的rc.conf文件中。打开rc.conf：
- en: '[PRE30]'
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'and add the following lines (replace `*ed0*` with the device name of your network
    interface):'
  id: totrans-132
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 并添加以下行（将`*ed0*`替换为您的网络接口设备名称）：
- en: '[PRE31]'
  id: totrans-133
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Save, exit, and reboot.
  id: totrans-134
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 保存、退出并重启。
- en: Retest OpenVPN by reconnecting with a client system to confirm that it starts
    properly.
  id: totrans-135
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过与客户端系统重新连接来重新测试OpenVPN，以确认其正确启动。
- en: 19.9\. CONFIG FILES
  id: totrans-136
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.9\. 配置文件
- en: /usr/local/etc/openvpn/openvpn.conf
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: /usr/local/etc/openvpn/openvpn.conf
- en: Main configuration file
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 主配置文件
- en: 19.10\. LOG FILES
  id: totrans-139
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.10\. 日志文件
- en: /var/log/messages
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: /var/log/messages
- en: Contains output from OpenVPN
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 包含来自OpenVPN的输出
- en: /usr/local/etc/openvpn/openvpn-status.log
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: /usr/local/etc/openvpn/openvpn-status.log
- en: Shows the status of current connections updated every minute
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 显示每分钟更新的当前连接状态
- en: /usr/local/etc/openvpn/ipp.txt
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: /usr/local/etc/openvpn/ipp.txt
- en: Records client virtual IP addresses
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 记录客户端虚拟IP地址
- en: 19.11\. NOTES
  id: totrans-146
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 19.11\. 注意事项
- en: 'When you are ready to configure an OpenVPN client, you will need these four
    files on the client system:'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 当你准备配置 OpenVPN 客户端时，你需要在客户端系统上准备以下四个文件：
- en: The OpenVPN public CA certificate file (openvpn-CAcert.pem)
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OpenVPN 公共 CA 证书文件 (openvpn-CAcert.pem)
- en: The client certificate (client01-cert.pem)
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户证书（client01-cert.pem）
- en: The client private key (client01-key.pem)
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户私钥（client01-key.pem）
- en: A client OpenVPN configuration file (example below)
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户端 OpenVPN 配置文件（以下为示例）
- en: You should already have the first three files (we created them earlier). The
    fourth file is a modification of the openvpn.conf file we used to configure the
    server above.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该已经拥有了前三个文件（我们之前已经创建过它们）。第四个文件是对我们用于配置上述服务器的openvpn.conf文件的修改。
- en: 'Listed below is a copy of a client version of the openvpn.conf that would work
    with the server configuration in this chapter (change the items shown in italics
    to match your configuration):'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE32]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: You should keep these four files in the same directory on the client system.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该在客户端系统上的同一目录中保留这四个文件。
- en: See the documentation from your specific client application for additional installation
    details. The OpenVPN website has a list of popular OpenVPN client GUIs for different
    platforms at [http://openvpn.net/gui.html](http://openvpn.net/gui.html).
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 请参阅您特定客户端应用的文档以获取更多安装细节。OpenVPN 网站列出了适用于不同平台的流行 OpenVPN 客户端 GUI，链接为 [http://openvpn.net/gui.html](http://openvpn.net/gui.html)。
