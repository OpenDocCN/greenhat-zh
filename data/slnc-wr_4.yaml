- en: Part IV. The Big Picture
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第四部分。大局观
- en: '*Our legal department advised us not to say “the network is the computer” here*'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*我们的法律部门建议我们在这里不要说“网络即计算机”*'
- en: —
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: —
- en: Chapter 16. Parasitic Computing, or How Pennies Add Up
  id: totrans-3
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第16章。寄生计算，或者如何积少成多
- en: '*Where the old truth that having an army of minions is better than doing the
    job yourself is once again confirmed*'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '*旧有的真理——拥有一个手下比亲自做工作更好——再次得到了证实*'
- en: —
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: —
- en: I hope you’ve enjoyed the ride so far. I’ve discussed a number of fancy problems
    that affect the security and privacy of information from its input at the keyboard
    to its ultimate destination hundreds or thousands of miles away. But it is too
    early for either of us to throw a party; something is missing from the picture—something
    far bigger than what we have discussed so far. The dark matter.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 我希望到目前为止你已经享受了这次旅程。我讨论了许多影响信息安全和隐私的复杂问题，从键盘输入到最终目的地数百或数千英里之外。但对我们俩来说，现在还为时尚早；画面中缺少了某些东西——比我们迄今为止讨论的还要大得多——暗物质。
- en: 'The problem with our story so far is simple: communications do not occur in
    a void. Although the process of exchanging data is usually limited to two systems
    and a dozen or so intermediate ones, the grand context of all events simply cannot
    be ignored; the properties of the surrounding environment can shape the reality
    of a chitchat between endpoints in profound ways. We cannot ignore the relevance
    of systems that are not directly involved in communications or the importance
    of all the tiny, seemingly isolated bits of individually trivial events that data
    meets along its path. It can be fatal to focus only on what appears relevant to
    a specific application or a particular case, as I hope this book has shown you
    thus far.'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 我们故事中的问题很简单：通信不会在真空中发生。尽管数据交换的过程通常限于两个系统和十几个中间系统，但所有事件的宏大背景绝对不能被忽视；周围环境的特性可以以深刻的方式塑造端点之间闲聊的现实。我们不能忽视那些没有直接参与通信的系统的相关性，以及所有看似孤立、各自微不足道的单个事件的重要性，数据在其路径上遇到这些事件。只关注对特定应用或特定案例看似相关的事物可能是致命的，正如我希望这本书到目前为止已经向你展示的那样。
- en: Rather than fall into this shortsighted trap, I’ve chosen to embrace the grand
    scheme of things in all its glory. Thus, the fourth and last part of this book
    focuses exclusively on the security of networking as a whole and discusses the
    Internet as an ecosystem, instead of a collection of systems accomplishing specific
    tasks. We pay tribute to the seemingly inert matter that binds the world together.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 而不是陷入这种短视的陷阱，我选择拥抱事物的宏伟蓝图，尽其所有光辉。因此，本书的第四部分和最后一部分专门关注整个网络的安全，并将互联网视为一个生态系统，而不是完成特定任务的系统集合。我们向将世界联系在一起看似无生命的物质致敬。
- en: This part of the book begins with an analysis of a concept that appears to be
    the most appropriate way to make the transition. For many computer geeks, this
    concept, called parasitic computing, has revolutionized the way we think of the
    Internet.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 本书这一部分从分析一个概念开始，这个概念似乎是最合适的过渡方式。对于许多计算机爱好者来说，这个被称为寄生计算的概念，彻底改变了我们对互联网的看法。
- en: Nibbling at the CPU
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 咬噬CPU
- en: A humble research paper published in letters to *Nature* by Albert-Laszlo Barabasz,
    Vincent W. Freeh, Hawoong Jeong, and Jay B. Brochman in 2001^([[108](apb.html#ftn.CHP-16-BIB-1)])
    could easily have gone unnoticed. At first glance, this letter did not seem worthy
    of much attention; in fact, it posed a seemingly laughable proposition. The authors
    suggest that traffic could be created within well-established network protocols
    such as TCP/IP that would pose (as a message) a trivial arithmetic challenge—a
    problem to be solved—to a remote computer; the remote system would unwittingly
    solve the problem while parsing the message and preparing a response. But why
    would anyone waste time casting riddles at emotionless machines? What could one
    gain from this? Wouldn’t it be as much fun to solve them yourself? Of course,
    the answer is quite interesting.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 一篇谦逊的研究论文，由Albert-Laszlo Barabasz、Vincent W. Freeh、Hawoong Jeong和Jay B. Brochman于2001年在《自然》杂志的来信栏目上发表，本可能被轻易忽视。乍一看，这封信似乎不值得过多关注；事实上，它提出了一个看似可笑的论点。作者们建议，在TCP/IP等成熟的网络协议中可以创建流量，对远程计算机提出一个简单的算术挑战——一个需要解决的问题；远程系统在解析消息和准备响应时会无意中解决这个问题。但为什么有人会浪费时间向无情的机器投掷谜题呢？从这能获得什么？自己解决它们不是更有趣吗？当然，答案非常有趣。
- en: 'First, there is a business to solving puzzles with a computer: much of today’s
    cryptography is based on the relative difficulty of solving a set of so-called
    non-polynomial^([[33](#ftn.CHP-16-FN-1)]) (NP) problems. NP-complete problems
    seem to take pleasure in crashing every codebreaker’s party at the least opportune
    times. The ability to solve them efficiently—whether with enormous computing power,
    clever algorithms, or both—would likely take a lucky inventor one step closer
    to world domination. There’s the incentive, then, but how would one do it?'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，用计算机解决谜题是一项业务：今天的大多数密码学都是基于解决一组所谓的非多项式^([[33](#ftn.CHP-16-FN-1)])（NP）问题的相对难度。NP
    完全问题似乎喜欢在最不合适的时候破坏每个密码破译者的派对。高效解决它们的能力——无论是使用巨大的计算能力、巧妙算法，还是两者兼而有之——可能会让一个幸运的发明家离世界霸权更近一步。因此，有这个激励，但一个人该如何去做呢？
- en: The method proposed in the research is quite novel. The paper first states that
    many NP problems in mathematics can be easily expressed in terms of Boolean satisfiability
    (SAT) equations. SAT equations represent these problems as Boolean logic operations,
    effectively constructing a sequence of parameters and variables (a Boolean formula).
    A classic example of an SAT formula might be
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 研究中提出的方法相当新颖。论文首先指出，数学中的许多 NP 问题可以很容易地用布尔可满足性（SAT）方程来表述。SAT 方程将这些问题表示为布尔逻辑运算，有效地构建了一系列参数和变量（布尔公式）。一个经典的
    SAT 公式示例可能是
- en: '| P = (x[1] XOR x[2]) AND (~x[2] AND x[3]) |'
  id: totrans-14
  prefs: []
  type: TYPE_TB
  zh: '| P = (x[1] XOR x[2]) AND (~x[2] AND x[3]) |'
- en: Here, *P* is the formula (problem) itself, and *x*[1]to *x*[3] are binary inputs,
    or parameters.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，*P* 是公式（问题）本身，而 *x*[1] 到 *x*[3] 是二进制输入，或参数。
- en: 'Although there are 2³ possible combinations of values for x[1], x[2], and x[3],
    only one of them makes *P* true: x[1] = 1, x[2] = 0, x[3] = 1\. Hence, we say
    that only this triplet is a solution to *P*. Finding solutions to SAT problems
    boils down to determining a set of values for all variables in the equation, for
    which the whole formula that incorporates those variables has a logic value of
    truth. Although trivial SAT problems like the one shown earlier are easy to solve,
    even without invoking any solving mechanism other than trial and error, more complex
    multivariable cases are indeed NP complete, and, consequently, other NP problems
    can be reduced to SAT problems in polynomial (meaning sane) time.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然对于 x[1]、x[2] 和 x[3] 的值有 2³ 种可能的组合，但只有其中一种使得 *P* 为真：x[1] = 1，x[2] = 0，x[3]
    = 1。因此，我们说只有这个三元组是 *P* 的解。解决 SAT 问题的本质在于确定方程中所有变量的值，使得包含这些变量的整个公式具有逻辑真值。尽管像前面展示的简单
    SAT 问题很容易解决，即使不调用任何除了试错之外的求解机制，更复杂的多变量情况确实是 NP 完全的，因此，其他 NP 问题可以在多项式（即合理的）时间内被归结为
    SAT 问题。
- en: And here lies the problem. We can formulate a hard NP problem in terms of SAT,
    but this does not buy us much. As of this writing, when it comes to a non-trivial
    equation, even the best SAT-solving algorithms known aren’t much more effective
    than a brute-force search whereby all possibilities are tried, and the value of
    the formula is evaluated for each possibility. This means that if we have a SAT
    problem and enough computing power to even consider approaching it, attempting
    a solution using brute force is not such an insane approach, and we would not
    get much further by with a more sophisticated one. Anyway, there’s not much to
    lose by trying.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是问题所在。我们可以用 SAT 来表述一个困难的 NP 问题，但这并没有给我们带来太多好处。截至本文写作时，即使是针对一个非平凡方程，已知最好的 SAT
    求解算法也并不比穷举搜索更有效，穷举搜索尝试所有可能性，并对每个可能性评估公式的值。这意味着如果我们有一个 SAT 问题，并且有足够的计算能力去考虑它，那么使用穷举法尝试解决方案并不是一个疯狂的方法，而且使用更复杂的方法也不会让我们走得更远。无论如何，尝试一下也不会损失太多。
- en: 'And here’s the revelation that binds SAT problems and TCP/IP networking. The
    basic observation made by the researchers is fairly obvious (or should be, if
    you subscribe to *Nature*): the checksumming algorithm of TCP (or IP), as discussed
    in [Chapter 9](ch09.html "Chapter 9. Foreign Accent"), although in principle designed
    for a wholly different purpose than solving equations, is nothing more than a
    set of Boolean operations subsequently performed on bits of the input message.
    After all, at the low level, the algorithm boils down to pure Boolean logic carried
    out on words of the transmitted packet. They conclude that, by providing specific
    contents of the packet (“input”), the remote system can thus be forced to carry
    out a set of arithmetic operations and then evaluate its correctness—its agreement
    with the checksum declared in the TCP or IP header.'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是揭示将 SAT 问题与 TCP/IP 网络联系起来的秘密。研究人员的基本观察相当明显（或者应该是这样的，如果你订阅了 *Nature*）：TCP（或
    IP）的校验和算法，如 [第 9 章](ch09.html "第 9 章. 外国口音") 中所讨论的，虽然在原则上是为一个完全不同的目的而设计的，即解决方程，但实际上不过是一系列对输入消息位进行的布尔操作。毕竟，在低级别上，该算法简化为在传输数据包的单词上执行纯粹的布尔逻辑。他们得出结论，通过提供数据包的特定内容（“输入”），远程系统可以被迫执行一系列算术运算，然后评估其正确性——即与
    TCP 或 IP 报头中声明的校验和的一致性。
- en: Although the operation performed by the remote system during the checksumming
    process is in every single iteration exactly the same, it has a functionality
    sufficient to serve as a universal logic gate, a mechanism we remember from [Chapter 2](ch02.html
    "Chapter 2. Extra Efforts Never Go Unnoticed"). By interleaving the actual tested
    input with carefully chosen “control” words that invert or otherwise alter the
    partial checksum computed thus far, it is possible to carry out any Boolean operation.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管远程系统在校验和过程中的操作在每次迭代中都是完全相同的，但它具有足够的功能作为通用逻辑门，这是我们记得的 [第 2 章](ch02.html "第
    2 章. 付出额外努力永远不会被忽视") 中的机制。通过将实际测试的输入与精心选择的“控制”单词交织在一起，这些单词反转或以其他方式改变迄今为止计算的局部校验和，可以执行任何布尔运算。
- en: 'This, in turn, means that SAT logic can be easily re-created using a specific
    sequence control and “input” bits in a packet once the data is exposed to a checksumming
    algorithm; equation variables (chosen this or the other way) are interleaved with
    fixed words that are used to transmogrify the current checksum value so that the
    outcome of the next operation mimics a specific Boolean operator. The final result—the
    value to which a packet sums—denotes the final outcome: the logic value of a formula
    to be evaluated.'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 这反过来意味着，一旦数据暴露于校验和算法，就可以使用数据包中的特定序列控制和“输入”位轻松重新创建 SAT 逻辑；方程变量（以这种方式或那种方式选择）与用于转换当前校验和值的固定单词交织在一起，以便下一个操作的输出模仿特定的布尔运算符。最终结果——数据包的总和值——表示最终结果：要评估公式的逻辑值。
- en: Thus, the satisfiability test is quite accidentally carried out by the remote
    recipient when, upon arrival, it attempts to validate the checksum. If the checksum
    comes out as 1 (or as some other value that in our SAT computation system corresponds
    to an SAT statement evaluating true), it passes the satisfiability test for the
    variable values chosen for this particular packet (and the traffic is passed to
    higher layers and acted upon). If the checksum fails, the formula has not been
    satisfied, and the packet is dropped silently. In other words, if our input bits
    denoted a specific hypothesis, the recipient had either verified it or proved
    it wrong, taking different actions depending on the outcome.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，可满足性测试是在远程接收者在到达时尝试验证校验和时意外进行的。如果校验和结果为 1（或在我们 SAT 计算系统中对应于评估为真的 SAT 语句的某个其他值），则该特定数据包选择的变量值通过了可满足性测试（并且流量被传递到更高层并执行）。如果校验和失败，则公式没有被满足，数据包将被静默丢弃。换句话说，如果我们的输入位表示一个特定的假设，接收者要么验证它，要么证明它是错误的，根据结果采取不同的行动。
- en: Further, a party wanting to solve an SAT problem quickly can prepare a set of
    all possible combinations of variable values (inputs) for a given formula, interleave
    it with information that causes the inputs to combine with others in the most
    desirable way, stuff this information into TCP packets, and send them out (nearly
    in parallel) to a large number of hosts around the globe. The checksum for a packet
    would be set manually to a value we know the “hypothesis” would produce if proven
    true, instead of actually calculating it. Only hosts that receive packets with
    variable values for which the formula evaluates to the desired value would respond
    to the traffic; other systems would simply disregard such traffic as corrupted
    due to the checksum mismatch. The sender can thus determine the correct solution
    without performing massive computations and can simply look up the set of values
    used in packets sent to those hosts that replied to a request.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，想要快速解决SAT问题的任何一方可以准备一组给定公式的所有可能的变量值（输入）组合，将这些值与导致输入以最理想的方式组合的信息交织在一起，将这些信息放入TCP数据包中，并将它们发送到全球范围内的众多主机（几乎并行）。数据包的校验和可以手动设置为已知“假设”如果被证明为真将产生的值，而不是实际计算它。只有接收到具有使公式评估为所需值的变量值的数据包的主机才会响应流量；其他系统会简单地忽略这种由于校验和不匹配而损坏的流量。因此，发送者可以在不执行大量计算的情况下确定正确解决方案，只需查找发送给那些响应请求的主机的数据包中使用的值集。
- en: The research goes further and reports on a successful attempt to solve an NP
    problem using real-world hosts across the globe, thus providing not only theoretical
    background, but also actual confirmation of the approach.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 研究进一步深入，并报告了使用全球范围内的实际主机成功解决NP问题的尝试，从而不仅提供了理论背景，而且还实际证实了这种方法。
- en: 'The impact of this technique is quite subtle, but also important: it proves
    that it is possible to effectively “outsource” computations to unaware and unwilling
    remote parties on the network, including sets of operations needed to solve real-world
    computing problems, without actually attacking these systems, taking them over,
    installing malicious software, or otherwise interfering with legitimate tasks.
    One person can thus, effectively, divide a specific computational task among a
    large number of systems. In the process, they can consume only a tiny and negligible
    fraction of a system’s computing power that could nevertheless add up to the equivalent
    of a decent supercomputer, when millions of systems work on a problem together.'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 这种技术的影响相当微妙，但也很重要：它证明了可以将计算任务有效地“外包”给网络上的不知情和不情愿的远程方，包括解决现实世界计算问题所需的一系列操作，而无需实际攻击这些系统、接管它们、安装恶意软件或以其他方式干扰合法任务。因此，一个人可以有效地将一个特定的计算任务分配给大量系统。在这个过程中，他们只需消耗系统计算能力的一小部分，这部分计算能力加起来却可能相当于一台相当不错的超级计算机，当数百万个系统共同处理一个问题时。
- en: World domination at hand? Not so fast.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 世界统治即将到来？并非如此迅速。
- en: '* * *'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[33](#CHP-16-FN-1)]) In complexity theory, polynomial problems can be solved
    by a Turing machine in time that is polynomially proportional to input length
    (number or size of variables for which the answer must be found). This means that
    the time needed to solve a polynomial problem corresponds directly to the input
    length raised to a constant exponent, which can be zero (causing the time not
    to depend on input length at all, as with testing for parity). Non-polynomial
    (NP) problems have no known solutions of this nature and may require dramatically
    more time to solve as the input length increases, exhibiting, for example, exponential
    dependency. A subset of NP problems, known as NP complete, are proven to have
    no polynomial time solutions. NP problems are generally regarded as “hard” for
    nontrivial inputs, whereas P problems are less expensive to solve.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[33](#CHP-16-FN-1)]) 在复杂性理论中，多项式问题可以通过图灵机在时间上以多项式比例与输入长度（必须找到答案的变量数量或大小）成比例地解决。这意味着解决多项式问题所需的时间直接对应于输入长度乘以一个常数指数，这个指数可以是零（导致时间完全不依赖于输入长度，例如在奇偶性测试中）。非多项式（NP）问题没有已知的此类解决方案，并且随着输入长度的增加，可能需要显著更多的时间来解决，例如表现出指数依赖性。被称为NP完全的NP问题子集已被证明没有多项式时间解决方案。NP问题通常被认为对于非平凡输入是“困难”的，而P问题则更容易解决。
- en: Practical Considerations
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 实际考虑因素
- en: . . . or, perhaps, not just yet. The approach suggested in the aforementioned
    research is revolutionary and interesting, but not necessarily a particularly
    practical way to build a supercomputer by stealing from the rich. The amount of
    bandwidth needed to sustain a reasonable computing rate, and the amount of computations
    needed to prepare trivia for other systems to solve, is quite high. As a result,
    this scheme is not efficient enough to outsource the solving of complex mathematical
    problems to a global supercluster of unwilling victims.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: . . . 或者，也许，还不是时候。上述研究中提出的方法是革命性的和有趣的，但并不一定是一个特别实用的方法来通过窃取富人的资源来构建超级计算机。为了维持合理的计算速率所需的带宽量，以及为其他系统解决准备的计算量相当高。因此，这个方案效率不足，无法将复杂数学问题的解决外包给一个全球超级集群的不情愿的受害者。
- en: In the scheme outlined earlier, the requirement of exponential computing power
    is exchanged for the requirement of exponential bandwidth. This is not necessarily
    a decent trade-off, particularly because only relatively simple tests can be pushed
    out, considering the packet size limitations of most networks. (All of them could
    likely be solved in the time it takes to transmit this data over Ethernet.) This
    technique proves that the attack is possible and provides a truly universal venue
    to facilitate it, but using more specific attack scenarios might yield much more
    useful results.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面概述的方案中，指数级计算能力的需要被交换为指数级带宽的需要。这并不一定是一个合理的权衡，尤其是考虑到大多数网络的包大小限制，只有相对简单的测试可以被推出去。（所有这些可能都在通过以太网传输这些数据所需的时间内被解决。）这项技术证明了攻击是可能的，并提供了一个真正通用的场所来促进它，但使用更具体的攻击场景可能会产生更有用的结果。
- en: Other ways of stealing negligible amounts of individual computing power are
    perhaps more interesting as ways to achieve impressive computing power at a low
    cost. For example, certain types of client software (such as web browsers) can
    be easily used to execute even fairly complex algorithms in a relatively trivial
    way. One such example, a “Chinese lottery” computing scheme detailed in RFC 3607,^([[109](apb.html#ftn.CHP-16-BIB-2)])
    is used by a tiny Java applet that Jean-Luc Cooke’s [md5crk.com](http://md5crk.com)
    website encourages webmasters to add to their web pages. Once this applet is added
    to a site, every visitor to it can execute the applet on their system, borrowing
    a negligible amount of CPU cycles in order to contribute them to a project aimed
    at finding MD5 shortcut function collisions. (Collisions are two different messages
    that produce the same shortcut. They are elusive and anecdotal, although most
    definitely possible,^([[34](#ftn.CHP-16-FN-2)]) beings that can allow us to better
    understand the weaknesses of shortcut functions and could empirically prove and
    demonstrate that MD5 is too weak to be a match for today’s computers.)
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 其他窃取少量个人计算能力的方法可能作为以低成本实现强大计算能力的方式更有趣。例如，某些类型的客户端软件（如网络浏览器）可以很容易地以相对简单的方式执行甚至相当复杂的算法。一个这样的例子，详细说明在RFC
    3607中的“中国彩票”计算方案，由让-吕克·库克（Jean-Luc Cooke）的[md5crk.com](http://md5crk.com)网站鼓励网站管理员添加到他们的网页上。一旦这个小程序被添加到网站上，每个访问者都可以在自己的系统上运行该小程序，借用微不足道的CPU周期，以贡献给旨在寻找MD5简短函数碰撞的项目。（碰撞是产生相同简短函数的两个不同的消息。它们难以捉摸且具有轶事性质，尽管绝对可能，因为它们可以帮助我们更好地理解简短函数的弱点，并且可以经验性地证明和展示MD5对于今天的计算机来说太弱了，无法与之匹配。）
- en: 'Java applets are small pieces of machine-independent programs that are by default
    executed by web browsers in special, restricted “sandbox” environments. They have
    no access to local disk storage and (only in theory) no ability to do any harm,
    though they can use limited network connectivity to perform computations and to
    add certain visual elements to a web page. They are most commonly used to enhance
    websites with additional features, such as interactive games, visual effects,
    and so on. But Jean-Luc used these applets to do something else: to find likely
    candidates for collisions using the joint computing power of hundreds or thousands
    of systems around the world, simultaneously.'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: Java小程序是独立于机器的小程序片段，默认情况下由网络浏览器在特殊的、受限的“沙盒”环境中执行。它们无法访问本地磁盘存储，并且（理论上）无法造成任何伤害，尽管它们可以使用有限的网络连接来执行计算并在网页上添加某些视觉元素。它们最常用于增强网站的功能，例如交互式游戏、视觉效果等。但让-吕克使用这些小程序来做其他事情：利用全球数百或数千个系统的联合计算能力，同时寻找碰撞的潜在候选者。
- en: 'The principle behind the applet’s operation was trivial: The applet was executed
    on client systems worldwide whenever a cooperating website was visited; then,
    once launched, the applet tried to calculate MD5 shortcuts for different randomly
    chosen messages. This continued until a shortcut that matched a certain arbitrarily
    chosen and fixed masking pattern was found. Such a pattern could be “any shortcut
    with zero for the last four bytes” or something similar. The pattern was chosen
    so that it does not take too long to find a suitable shortcut by trial and error
    (so that the person does not have to leave the web page and stop the code before
    it is found), but so that only a small fraction of all possible shortcuts would
    match the rule.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 该小程序操作背后的原理很简单：每当访问一个合作的网站时，该小程序就会在全球的客户端系统上执行；然后，一旦启动，小程序就会尝试计算不同随机选择的消息的MD5快捷方式。这个过程会一直持续，直到找到一个与某个任意选择并固定的掩码模式相匹配的快捷方式。这种模式可能是“任何最后四个字节为零的快捷方式”或类似的东西。这种模式的选择是为了确保通过试错找到合适的快捷方式不会花费太多时间（这样人们就不必离开网页并在找到之前停止代码），但同时又只有一小部分所有可能的快捷方式会符合规则。
- en: Once a suitable message was found, the program “phoned home” with the candidate.
    The author could then examine the submissions. The applet had already examined
    and rejected a number of collision candidates, and only submitted those that matched
    a predefined condition (ones that were partly identical). Because much less variation
    is possible in the data collected this way, the likelihood of a collision in a
    chunk of *n* entries is considerably higher than for purely random data. By analogy,
    the likelihood of running into two visually indistinguishable apples in an amount
    of fruit we are capable of going through within one day is higher if we order
    for delivery only those apples that have nearly the same weight and color, as
    opposed to purchasing a wagon of arbitrary fruit.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦找到合适的信息，程序就会将候选者“打电话回家”。作者可以检查这些提交。小程序已经检查并拒绝了一些冲突候选者，并且只提交了那些符合预定义条件（部分相同的）的候选者。由于通过这种方式收集的数据变化可能性较小，因此在*n*个条目中的一块数据发生冲突的可能性比纯随机数据要高得多。通过类比，如果我们只订购重量和颜色几乎相同的苹果进行配送，而不是购买一车任意水果，那么在一天内能够处理的水果中遇到两个视觉上无法区分的苹果的可能性就会更高。
- en: Although somewhere in the gray area of cyber-ethics, this ingenious approach
    first openly deployed by [md5crk.com](http://md5crk.com) really worked and provided
    a good demonstration of how parasitic computing can be both quite effective and
    stealthy. It appears that the ability to steal processor cycles originally intended
    to be used for “rightful” purposes is well within reach, and perhaps used more
    often that we want it to be. And this possibility is here to stay.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管在网络安全伦理的灰色地带，这种由[md5crk.com](http://md5crk.com)首次公开部署的巧妙方法确实有效，并很好地展示了寄生计算如何既有效又隐蔽。看起来，窃取原本打算用于“正当”目的的处理器周期的能力触手可及，而且可能比我们希望的更频繁地被使用。这种可能性将长期存在。
- en: But, a cranky skeptic continues, can parasitic computing do more than just nibble
    tiny bits of CPU power to facilitate cracking encryption schemes, a task few of
    us are truly interested in?
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，一个挑剔的怀疑者继续问道，寄生计算除了窃取CPU的微小部分来帮助破解加密方案之外，还能做些什么？这项任务很少有人真正感兴趣？
- en: '* * *'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[34](#CHP-16-FN-2)]) While this book was being prepared for printing, a team
    of Chinese researchers from Shandong University—Xiaoyun Wang, Dengguo Feng, Xuejia
    Lai, and Hongbo Yu—advised of a technique for finding and provided samples of
    MD4, MD5, HAVAL-128, and RIPEMD-128 collisions. This is one of the more important
    bits of news in modern cryptography, and confirmation that those functions are
    inadequate for some security-related applications. While the [md5crk.com](http://md5crk.com)
    project has closed down, its contributions to exploring the field of parasitic
    computing remain valid.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[34](#CHP-16-FN-2)]) 当这本书准备印刷时，来自山东大学的一组中国研究人员——王晓云、冯登国、赖雪佳和余红波——提出了一种寻找MD4、MD5、HAVAL-128和RIPEMD-128冲突的技术，并提供了样本。这是现代密码学中更为重要的新闻之一，并证实了这些函数对于某些安全相关应用是不够的。虽然[md5crk.com](http://md5crk.com)项目已经关闭，但其对探索寄生计算领域的贡献仍然有效。
- en: 'Parasitic Storage: The Early Days'
  id: totrans-39
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 寄生存储：早期阶段
- en: When you shout, acoustic waves move through the air, gradually losing energy
    and dispersing in all directions. However, if they encounter a solid obstacle
    along the way they will likely bounce, and, if the angle is just right, they will
    bounce back to you. The audible result is that a split second after shouting you
    will hear an echo of your own voice.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 当你喊叫时，声波会穿过空气，逐渐失去能量并向四面八方扩散。然而，如果它们在途中遇到固体障碍物，它们很可能会反弹，并且如果角度恰到好处，它们会反弹回你这里。可听到的结果是，在你喊叫后的瞬间，你会听到自己声音的回声。
- en: 'But what happens when an information theory geek reads their code aloud standing
    on the top of a mountain, directing their words toward a rocky valley? I thought
    you’d never ask. In such case, they cannot help but make a clever observation:
    if they read it fast and then immediately forget about what they just recited
    (because they become preoccupied with other matters), they can still eventually
    recover the information he when it bounces back off the bottom of the valley and
    is echoed back. Voilà—a convenient data storage mechanism.'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 但是，当一位信息理论爱好者站在山顶上，大声朗读他们的代码，将他们的话语指向一个岩石山谷时，会发生什么呢？我想你肯定想知道。在这种情况下，他们不可避免地会做出一个聪明的观察：如果他们快速阅读然后立即忘记他们刚才背诵的内容（因为他们被其他事情占据了注意力），他们仍然可以在信息从山谷底部反弹回来并回声返回时最终恢复信息。哇——一个方便的数据存储机制。
- en: Sounds ridiculous? Maybe we are just too young. Early types of computer memory
    modules used a similar acoustic technique that allowed the processor to store
    some information “offline” and recover it later. Instead of using air (through
    which waves spread a bit too fast to provide reasonable storage capacities without
    building extremely large memory units), a mercury-filled drum was used (an environment
    in which acoustic waves propagate much more slowly). The principle remained the
    same, however, and even gave an interesting meaning to the term *memory leak*.
    Such a device, *mercury delay line memory*, was used, for example, in the famous
    UNIVAC I.^([[35](#ftn.CHP-16-FN-3)])
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 听起来很荒谬？也许我们只是太年轻了。早期的计算机内存模块使用了一种类似的技术，允许处理器将一些信息“离线”存储，并在稍后恢复。而不是使用空气（通过空气，声波传播得有点太快，无法在不构建极其庞大的内存单元的情况下提供合理的存储容量），使用了一个装满水银的鼓（在这种环境中，声波传播得要慢得多）。然而，原理保持不变，甚至给“内存泄漏”这个术语赋予了有趣的意义。例如，这种设备，即水银延迟线内存，被用于著名的UNIVAC
    I.^([[35](#ftn.CHP-16-FN-3)])。
- en: Naturally, this slow, bulky, dangerous, and inconvenient sort of memory was
    dropped in favor of other solutions as soon as the technology matured. However,
    the invention itself had some charm to it, and wouldn’t fade into oblivion that
    easily. A short presentation by Saqib A. Khan at the DefCON conference in Las
    Vegas in 2002 revived it and gave us the first hints about how to use the properties
    of a large-scale network to construct similar types of momentary storage using
    the Internet as a medium. But this time, the description of acoustic memory did
    not sound ridiculously primitive, but rather unbelievably cool to all hackers
    and geeks watching this short slide show. Acoustic memory had made its comeback
    in style.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 自然地，这种缓慢、笨重、危险且不便的记忆方式，随着技术的成熟，很快就被其他解决方案所取代。然而，这项发明本身具有一定的魅力，并不会那么轻易地消失在人们的记忆中。2002年，萨基布·A·汗在拉斯维加斯的DefCON会议上做了一次简短的演讲，重新唤起了人们对它的兴趣，并为我们提供了关于如何利用大规模网络的特性，通过互联网作为媒介来构建类似类型的瞬时存储的第一手信息。但这一次，关于声学记忆的描述听起来不再那么荒谬原始，而是对观看这个简短幻灯片的黑客和极客们来说，不可思议地酷。声学记忆以一种时尚的方式回归了。
- en: Because the round-trip times for packets (the time needed for a message to arrive
    at a remote system, and for a response to come back) are nonzero, a certain amount
    of data can always be kept “on the wire” by repeatedly sending out and receiving
    portions of it and waiting for it to echo back. Saqib used ICMP (Internet Control
    Message Protocol) “echo request” (ping) packets to achieve this effect; most systems
    on the Internet respond to such packets with “echo reply,” quoting the original
    payload they received.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 由于数据包的往返时间（即消息到达远程系统所需的时间和响应返回所需的时间）不为零，可以通过重复发送和接收数据包的部分内容并等待其回声来始终在“线”上保持一定量的数据。萨基布使用了ICMP（互联网控制消息协议）“回声请求”（ping）数据包来实现这一效果；互联网上的大多数系统都会对这些数据包做出“回声响应”，引用它们收到的原始有效载荷。
- en: This seemed like a cool trick. However, it was also far from practical for any
    reasonable application, because it required frequent retransmissions of portions
    of data. Because ICMP “echo reply” is sent back nearly immediately after the “echo
    request” is received, only a small amount of data could be pushed out before being
    sent back and needing to be recovered off the wire. As a result, the amount of
    data that could be stored this way could be no larger than the amount that the
    user could push out in, at best, a couple of seconds (and more commonly, under
    a tenth of a second).
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 这看起来像是一个酷炫的技巧。然而，对于任何合理应用来说，它都离实际应用还很远，因为它需要频繁地重新传输数据的一部分。由于ICMP“回显应答”在接收到“回显请求”后几乎立即发送，因此在数据被发送回并需要从线路上恢复之前，只能推送出很少量的数据。因此，以这种方式可以存储的数据量不会超过用户在最多几秒钟内（通常不到一秒钟）能够推送出的数据量。
- en: Ah, but parasitic storage could be improved.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 啊，但是寄生存储可以改进。
- en: '* * *'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[35](#CHP-16-FN-3)]) Perhaps it is worth noting that a low-capacity, analog
    delay line memory was also used in early implementations of SECAM (Séquentiel
    Couleur avec Mémoire, or Sequential Color with Memory) TV receivers. Unlike NTSC
    or PAL, the SECAM signal uses a reduced color resolution; red and blue chrominance
    components are transmitted alternatively, never both at once. The other component
    must be taken from the preceeding line to determine how a specific pixel should
    look. To make this possible, a memory device needed to be implemented.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[35](#CHP-16-FN-3)]) 可能值得指出的是，低容量、模拟延迟线存储器也用于SECAM（Séquentiel Couleur avec
    Mémoire，或顺序彩色存储）电视接收器的早期实现中。与NTSC或PAL不同，SECAM信号使用降低的色彩分辨率；红色和蓝色色度分量交替传输，永远不会同时传输。其他分量必须从前一帧中获取，以确定特定像素的外观。为了实现这一点，需要实现一个存储设备。
- en: Making Parasitic Storage Feasible
  id: totrans-49
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使寄生存储可行
- en: 'In 2003, Wojciech Purczynski and I coauthored a paper called “Juggling with
    Packets: Parasitic Data Storage.” We took the concept of parasitic storage a bit
    further and considered a number of methods that could be used to dramatically
    extend the Internet’s storage capacity, while conserving the bandwidth needed
    to sustain the information. Our research focused on several other ways to store
    data on remote systems and classified them based on the properties of the storage
    medium (its visibility, volatility, and reliability). We also included a detailed
    discussion of the hypothetical storage capacities for each of the techniques.'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在2003年，我和Wojciech Purczynski共同撰写了一篇名为“用数据包进行杂耍：寄生数据存储”的论文。我们将寄生存储的概念进一步拓展，并考虑了多种可以显著扩展互联网存储容量同时保持维持信息所需带宽的方法。我们的研究集中在几种其他在远程系统上存储数据的方法上，并根据存储介质的特性（其可见性、易失性和可靠性）对它们进行了分类。我们还对每种技术的假设存储容量进行了详细讨论。
- en: The paper was quite short and—I hope—refreshing and humorous, and it’s included
    here.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 这篇论文相当简短，并且——我希望——清新有趣，它被包含在这里。
- en: '[PRE0]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Applications, Social Considerations, and Defense
  id: totrans-53
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 应用、社会考虑和防御
- en: But what now? What is the benefit of having practical parasitic computing and
    storage schemes, if the benefits are still not nearly good enough to make it a
    tempting alternative to just getting more hardware?
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 但是现在呢？如果实际寄生计算和存储方案的好处仍然不足以让它成为一个比增加更多硬件更有吸引力的替代品，那么拥有这些方案有什么好处呢？
- en: Despite advances in the practical exploitation of parasitic computing, applications
    that aim to extend the sheer computing power or storage space of a traditional
    system may appear pointless when we consider the abundance of cheap memory and
    gigahertz processors.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管在实用化寄生计算方面取得了进展，但当考虑到廉价内存和千兆赫兹处理器的丰富性时，旨在扩展传统系统纯粹的计算能力或存储空间的应用可能看起来毫无意义。
- en: 'The unseen potential of this technology may, however, lie in a wholly different
    set of applications: *volatile computing*. The ability to build usable distributed
    computers that can disperse at will, leaving no physical traces and storing no
    meaningful data at any one location, might be a powerful privacy tool and also
    pose some challenges for forensics and law enforcement. The ability to build volatile
    store-and-keep memory that collapses shortly after taking a single node offline,
    but that does not involve frequent retransmissions of data, might provide a good
    level of deniability for an offender (or an oppressed entity, for that matter)
    and require many common evidence collection procedures to change quite dramatically.'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，这项技术的潜在价值可能在于一套完全不同的应用领域：*易失性计算*。构建可用的分布式计算机的能力，这些计算机可以随意分散，不留任何物理痕迹，在任何单一位置也不存储任何有意义的数据，这可能是一种强大的隐私工具，同时也可能对法医和执法部门构成一些挑战。构建易失性存储和保持内存的能力，在单个节点离线后不久就会崩溃，但又不涉及频繁的数据重传，这可能为犯罪分子（或任何受压迫的实体）提供一定程度的否认能力，并且需要许多常见的证据收集程序发生相当大的变化。
- en: 'Furthermore, imagine volatile systems that could, once bootstrapped and initialized,
    sustain themselves for extended periods of time, living in the Internet and taking
    no localized physical presence. Two designs are possible for volatile, distributed
    computer systems, and neither is that absurd:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，想象一下易失性系统，一旦启动和初始化，就可以在互联网上持续很长时间，没有本地化的物理存在。对于易失性分布式计算机系统，有两种可能的设计，而且都不荒谬：
- en: Systems can be designed so that they complete a complex task by finding a solution
    in parallel (already largely accomplished by the SAT computing scheme discussed
    previously). The disadvantage of such systems is that the computation result must
    be retrieved and the next iteration of processing must be initiated manually by
    occasionally “reseeding” the entire system from some location. Solutions that
    rely on low-level properties of protocols such as TCP would likely fall into this
    category.
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以设计系统，使它们通过并行找到解决方案来完成复杂任务（这已经在之前讨论的SAT计算方案中基本实现）。这类系统的缺点是必须手动检索计算结果，并偶尔从某个位置重新“播种”整个系统以启动下一次处理迭代。依赖于协议的低级属性（如TCP）的低级解决方案可能会落入这一类别。
- en: Systems can be designed so that they execute subsequent iterations of distributed
    computing themselves. All types of abuse of higher-level features (such as embedded
    document-rendering algorithms) and of some network services might be used to facilitate
    this type of activity.
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 可以设计系统，使它们自己执行分布式计算的后续迭代。所有高级功能（如嵌入式文档渲染算法）和某些网络服务的滥用都可能被用来促进这种活动。
- en: In each case, the consequences can be quite profound. For example, how do you
    take down a redundant self-repairing machine that uses no single system, but rather
    borrows tiny bits of memory and processing power from others for fractions of
    a second—and uses no vulnerabilities to do so or clearly distinguishable traffic
    that can be filtered out? And isn’t it also a bit disconcerting to realize that
    we would not be able to immediately discern the goals of such a distributed computer?
    Bowing respectfully to the masters of bad science fiction, I believe the domination
    of computers is imminent and want to welcome our new machine overlords.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 在每种情况下，后果都可能非常严重。例如，如何摧毁一个冗余的自修复机器，该机器不使用单一系统，而是从其他人那里借用一小部分内存和处理能力几秒钟——而且不使用任何漏洞或明显可过滤的流量？而且，意识到我们无法立即识别这种分布式计算机的目标，难道不是也有些令人不安吗？向糟糕的科幻小说大师们表示尊敬，我相信计算机的统治即将到来，并欢迎我们新的机器主宰。
- en: Food for Thought
  id: totrans-61
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 思考食物
- en: Defense against parasitic computing is generally extremely difficult. The ability
    to store data or to cause the other party to perform certain trivial computations
    is often bound to the fundamental functionality of network protocols. This is
    a characteristic that we cannot conceive of removing without wiping out the Internet
    as we know it and introducing a host of new problems more serious than the one
    remedied.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 防御寄生计算通常极其困难。存储数据或导致对方执行某些简单计算的能力通常与网络协议的基本功能绑定。这是我们无法想象在不抹去我们所知的互联网的同时消除这种特性，并引入一系列比解决的问题更严重的新问题的。
- en: Protecting a single system against becoming a node for parasitic computing is
    also fairly difficult, because the number of resources stolen from a system is
    often a negligible fraction of the idle CPU time and memory and, hence, might
    easily go unnoticed.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 保护单个系统免于成为寄生计算节点也是相当困难的，因为从系统中窃取的资源通常只是空闲CPU时间和内存的微不足道的一部分，因此可能很容易被忽视。
- en: Chances are good that parasitic computing has yet to show its full potential
    and that the threat—irrelevant or nonexistent for single systems but significant
    for the net as a whole—is here to stay.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 很可能寄生计算尚未展现出其全部潜力，而这种威胁——对于单个系统来说可能无关紧要或不存在，但对于整个网络来说却具有重要意义——将会持续存在。
- en: Chapter 17. Topology of the Network
  id: totrans-65
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第17章 网络拓扑
- en: '*On how the knowledge of the world around us may help track down friends and
    foes*'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: '*关于我们周围世界的知识如何帮助我们追踪朋友和敌人*'
- en: —
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: —
- en: What is the shape of the Internet? No committee oversees it or decides where,
    how, and why it should expand or how new and existing systems should be organized
    or managed. The Internet grows in all directions in ways that are equally driven
    by demand, economics, politics, technology, and blind luck.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 互联网的形状是什么？没有委员会来监督它或决定它应该在哪里、如何以及为什么应该扩展，或者新的和现有的系统应该如何组织或管理。互联网在所有方向上以同样由需求、经济、政治、技术和盲目运气驱动的方向发展。
- en: 'Yet the Internet is not a shapeless blob: there are planned, locally governed
    hierarchies of autonomous systems, with core routers surrounded by lesser nodes,
    with links configured by automatic mechanisms or carefully designed by humans.
    The Internet is a spectacular mesh, a complex and fragile cobweb covering the
    entire industrialized and developing world. The task of capturing this ever-changing
    topology appears challenging, but also tempting, especially when we realize how
    we can benefit from the information collected.'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，互联网并非无形状的团块：存在由自主系统组成的计划内、本地管理的层次结构，核心路由器周围环绕着较小的节点，链接由自动机制配置或由人类精心设计。互联网是一个壮观的网状结构，一个复杂而脆弱的蜘蛛网，覆盖着整个工业化和发展中国家。捕捉这个不断变化的拓扑结构似乎是一项挑战，但同时也很有吸引力，尤其是当我们意识到我们可以如何从收集到的信息中受益。
- en: In this chapter, I’ll first discuss two notable attempts to map the Internet’s
    topology, and then I’ll moralize once more on the potential uses for the information
    gathered this way to do things that our ancestors could not even dream of.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我将首先讨论两个著名的尝试来绘制互联网的拓扑结构，然后我将再次道德化地讨论收集到的信息的潜在用途，这些用途可以让我们的祖先连做梦都不敢想的事情成为可能。
- en: Capturing the Moment
  id: totrans-71
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 捕捉这一刻
- en: The most comprehensive attempt to map the Internet was undertaken by the Cooperative
    Association for Internet Data Analysis (CAIDA), an organization funded, among
    others, by federal research agencies (NSF, DHS, DARPA) and the industry (Cisco,
    Sun). The organization was formed to come up with traffic and infrastructure analysis
    and tools for the common benefit of the Internet community, in hopes of making
    it better, more reliable, more resilient, and more robust.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 对互联网进行最全面映射的尝试是由互联网数据分析合作协会（CAIDA）进行的，该组织由联邦研究机构（如NSF、DHS、DARPA）以及行业（如Cisco、Sun）资助。该组织的成立是为了提出交通和基础设施分析工具，以供互联网社区共同受益，希望使其变得更好、更可靠、更具弹性和更健壮。
- en: Since 2000, one of CAIDA’s flagship public projects has been the creation and
    maintenance of the autonomous system core network map (aka “Skitter”). As of this
    publication, their most recent capture represents data for 12,517 major autonomous
    systems, corresponding to 1,134,634 IP addresses and 2,434,073 links (logical
    paths) between them.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 自2000年以来，CAIDA的旗舰公共项目之一就是创建和维护自主系统核心网络图（也称为“Skitter”）。截至本出版物，他们最新的捕获代表了12,517个主要自主系统的数据，对应于1,134,634个IP地址和2,434,073个链接（逻辑路径）。
- en: Despite sounding astonishingly arcane, the CAIDA Internet map was created with
    only publicly accessible router BGP configuration data, empirical network testing
    results (traceroute), and WHOIS records for network blocks. This map is organized
    using polar coordinates. Points representing each system are located at an angle
    corresponding to the physical location of a network’s declared headquarters location
    and the radius corresponding to the “peering relevance” of this particular autonomous
    system. The latter parameter is derived by calculating the number of other autonomous
    systems observed to accept traffic from this particular node. Thus, massive core
    systems are located toward the center of the map, whereas systems that have direct
    contact with only a couple of nodes are located near the outer perimeter. Lines
    in the graph simply correspond to peering relations between routers.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管听起来非常晦涩难懂，但CAIDA互联网地图仅使用公开可访问的路由器BGP配置数据、经验网络测试结果（traceroute）和网络块WHOIS记录创建。这个地图使用极坐标组织。代表每个系统的点位于一个角度上，对应于网络声明的总部位置的物理位置，以及对应于该特定自治系统的“对等关系相关性”的半径。后者是通过计算观察到的其他自治系统接受来自该特定节点的流量数量来得到的。因此，庞大的核心系统位于地图的中心，而只与几个节点直接接触的系统则位于外围附近。图中的线条简单地对应于路由器之间的对等关系。
- en: Note
  id: totrans-75
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Quite regrettably, we were not allowed to use a graphical representation of
    CAIDA Skitter graphics in the book free of charge. I encourage you, however, to
    see this stunning picture online at [http://www.caida.org/analysis/topology/as_core_network/pics/ascoreApr2003.gif](http://www.caida.org/analysis/topology/as_core_network/pics/ascoreApr2003.gif)
    where it is available to the general public at no cost.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 非常遗憾，我们无法在书中免费使用CAIDA Skitter图形的图表。然而，我鼓励您在线查看这张令人惊叹的图片，网址为[http://www.caida.org/analysis/topology/as_core_network/pics/ascoreApr2003.gif](http://www.caida.org/analysis/topology/as_core_network/pics/ascoreApr2003.gif)，公众可以免费获取。
- en: Another noteworthy attempt to map the network used an approach that relied on
    analyzing distances to various networks, as seen from a particular location (in
    this case, from Bell Laboratories), to build a treelike structure quite unlike
    the complex mesh created by CAIDA. Conducted by Bill Cheswick in 2000,^([[110](apb.html#ftn.CHP-17-BIB-1)])
    this analysis resulted in the map shown in [Figure 17-1](ch17.html#bill_cheswickas_map_of_the_internet
    "Figure 17-1. Bill Cheswick’s map of the Internet"). This structure does not parametrize
    the graph depending on the physical or administrative location of a system; the
    relative distance from the center corresponds to the number of hops between that
    node and Bell Labs, however.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个值得注意的尝试绘制网络的方法是，通过分析从特定位置（在本例中为贝尔实验室）观察到的到各种网络的距离，构建一个类似于树状结构，而不是CAIDA创建的复杂网状结构。这项分析由比尔·切斯威克于2000年进行，^([[110](apb.html#ftn.CHP-17-BIB-1)])
    结果在[图17-1](ch17.html#bill_cheswickas_map_of_the_internet "图17-1. 比尔·切斯威克的互联网地图")中展示。这个结构并不根据系统的物理或行政位置来参数化图；从中心到该节点的相对距离对应于该节点与贝尔实验室之间的跳数。
- en: Although the two attempts appear to involve massive data collection and analysis,
    it is not prohibitively difficult for an amateur to attempt to map the network
    on even a fairly low-end link. Probing all publicly routable subnets with a single
    packet might require generating only a couple of gigabytes of traffic—the equivalent
    of a couple of hours to one day on a typical DSL connection. The only risk is
    that of upsetting some system administrators, but with the proliferation of computer
    worms and automated attacks, very few have a sensitivity threshold that low. Mapping
    the observed structure of the Internet is possible, and it can be rewarding, especially
    because it can tell us a lot about how the worldwide network is organized.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这两个尝试似乎涉及大量数据收集和分析，但对于业余爱好者来说，即使在低端链路上尝试绘制网络也不是特别困难。使用单个数据包探测所有公开路由的子网可能只需要生成几GB的流量——相当于典型DSL连接上几个小时到一天的时间。唯一的危险是可能会激怒一些系统管理员，但随着计算机蠕虫和自动化攻击的泛滥，很少有系统管理员对这种低敏感度阈值有反应。绘制观察到的互联网结构是可能的，并且可能会很有成效，尤其是因为它可以告诉我们很多关于全球网络是如何组织的信息。
- en: '![Bill Cheswick’s map of the Internet](httpatomoreillycomsourcenostarchimages1138106.png.jpg)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![比尔·切斯威克的互联网地图](httpatomoreillycomsourcenostarchimages1138106.png.jpg)'
- en: Figure 17-1. Bill Cheswick’s map of the Internet
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 图17-1. 比尔·切斯威克的互联网地图
- en: But, as it turns out, the data, such as the information acquired by CAIDA, Bill
    Cheswick, or just about any proficient user of the Net, can also be successfully
    used to better understand the nature and better examine the origin of a mysterious
    traffic we might one day stumble upon.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 但实际上，数据，例如CAIDA、比尔·切斯威克或几乎任何熟练的互联网用户获得的信息，也可以成功地用来更好地理解神秘流量的性质，并更好地检查我们可能有一天偶然遇到的流量的来源。
- en: Using Topology Data for Origin Identification
  id: totrans-82
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用拓扑数据识别来源
- en: Spoofed traffic is one of the Internet’s major problems—or, at the very least,
    one of its more annoying woes. Blindly spoofed packets with bogus or specially
    chosen but deceptive source addresses can be used to abuse trust relationships
    between computers, inject malicious contents (such as unsolicited bulk mailings)
    without leaving conclusive traces and legitimate origin information, and so forth.
    Blind spoofing can also be used to hide the identity of an attacker conducting
    system probes (“decoy scanning” discussed earlier in [Chapter 13](ch13.html "Chapter 13. Smoke
    and Mirrors")). The worst plague of all is, however, spoofing used to carry out
    Denial of Service (DoS) attacks.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 欺骗流量是互联网的主要问题之一——或者至少是其中较为令人烦恼的问题之一。盲目地使用虚假或特别选择的但具有欺骗性的源地址发送的数据包，可以用来滥用计算机之间的信任关系，注入恶意内容（如未经请求的大规模邮件）而不留下明确的痕迹和合法的原始信息，等等。盲目欺骗还可以用来隐藏进行系统探测的攻击者的身份（“诱饵扫描”在[第13章](ch13.html
    "第13章. 烟雾和镜子")中已有讨论）。然而，所有问题中最严重的是用于执行拒绝服务（DoS）攻击的欺骗。
- en: In a typical DoS attack, the administrator is given a chance to see the origin
    of malicious traffic directed against one of their services (and presumably intended
    to bring it down and cause inconvenience or loss to the operator). It is possible
    to randomly spoof offending packets, however, and in such cases the administrator
    is left helpless, unable to filter out the traffic coming from the attacker without
    cutting off other users. Their only hope is to work with the upstream provider
    to investigate the actual origin of the traffic on the link layer and pass the
    information to the offender’s ISP; this, however, takes time, and lots of it.
    It also requires convincing all parties, without a court order, that the case
    is worthy of investigation (and their time and money). This situation makes it
    particularly important for the system administrator to be equipped with tools
    and methods to differentiate between spoofed and legitimate traffic.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 在典型的DoS攻击中，管理员有机会看到针对他们服务之一（并且可能旨在使其崩溃并给运营商带来不便或损失）的恶意流量的来源。然而，可能随机欺骗违规数据包，在这种情况下，管理员将无能为力，无法过滤掉来自攻击者的流量，而不切断其他用户的连接。他们唯一的希望是与上游提供商合作，调查链路层上流量的实际来源，并将信息传递给违规者的ISP；然而，这需要时间，而且需要很多时间。这也要求在没有法院命令的情况下，让所有各方都相信这个案例值得调查（以及他们的时间和金钱）。这种情况使得系统管理员配备区分欺骗流量和合法流量的工具和方法变得尤为重要。
- en: 'When I used to live and work in the United States (I live in Poland these days),
    my colleague Mark Loveless decided to implement an idea originally proposed by
    Donald McLachlan: He would measure time to live (TTL) on network traffic between
    him and the presumed sender of a packet to automatically determine whether an
    incoming packet had been spoofed. The challenge of identifying the origin of a
    network packet in a world where the information cannot be trusted is important,
    and the ability to do so, even if only in a specific subset of cases, would greatly
    benefit many analytic and administrative tasks, for the reasons mentioned earlier.'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 当我以前在美国生活和工作时（现在我在波兰），我的同事马克·洛夫莱斯决定实施唐纳德·麦克拉克兰最初提出的一个想法：他会测量他与一个数据包的假定发送者之间的生存时间（TTL），以自动确定传入的数据包是否被欺骗。在一个信息不可信的世界中，确定网络数据包的来源是一个重要挑战，而且即使只是在特定子集的情况下，这种能力也会极大地促进许多分析和管理任务，如前所述。
- en: To understand Donald and Mark’s idea, consider that the remote system, from
    which we are seeing traffic, is at a specific logical distance from us, separated
    by a given number of network devices. Thus, all packets legitimately sent by this
    system exhibit a certain TTL on arrival, corresponding to the default initial
    TTL configured on that system, minus the number of intermediate systems the packet
    has gone through (as discussed in [Chapter 9](ch09.html "Chapter 9. Foreign Accent")).
    However, for spoofed traffic that presumably originates on a wholly different
    network, the initial TTL and the distance is most likely different than the aforementioned
    observation would suggest. Mark’s tool, despoof,^([[111](apb.html#ftn.CHP-17-BIB-2)])
    compares the TTLs observed on specially induced and previously received traffic
    in order to distinguish between legitimate and falsified traffic.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 要理解唐纳德和马克的想法，考虑一下，我们从其中看到流量的远程系统，与我们之间有一个特定的逻辑距离，由一定数量的网络设备隔开。因此，该系统合法发送的所有数据包在到达时都会显示一定的TTL，对应于该系统上配置的默认初始TTL减去数据包经过的中间系统数量（如第9章[第9章.
    外国口音](ch09.html "第9章. 外国口音")中所述）。然而，对于可能源自完全不同网络的伪造流量，初始TTL和距离很可能与上述观察结果不同。马克的工具despoof^([[111](apb.html#ftn.CHP-17-BIB-2)])比较了特别诱导和先前接收到的流量中观察到的TTL，以区分合法和伪造的流量。
- en: 'However, although this method might work well in individual cases when used
    against unsuspecting attackers, at least two problems are associated with it:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，尽管这种方法在针对毫无防备的攻击者时可能效果很好，但至少有两个问题与之相关：
- en: A paranoid attacker can measure distances before the attack and choose a TTL
    that matches the expected value. Although possible, this trick is a bit difficult
    to implement. For one thing, the attacker might be physically unable to set TTL
    high enough to achieve a specific value that would match the expected value of
    a real packet once the packet reaches its destination. This attacker’s plan could
    be thwarted if the system that he is trying to impersonate uses a default TTL
    at or near 255 (the maximum possible) and he is farther from the target than the
    system he is trying to impersonate (hence it is very much impossible for him to
    send a packet that would, upon arrival at the destination, have the desired TTL).
    Of course, few systems use the highest possible TTL, and it is rare for an attacker
    to want to impersonate a specific system to begin with.
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个偏执的攻击者可以在攻击之前测量距离并选择一个与预期值匹配的TTL。尽管可能，但这个技巧实施起来有些困难。一方面，攻击者可能无法将TTL设置得足够高，以达到与真实数据包到达目的地时预期值相匹配的具体值。如果他被试图冒充的系统使用的默认TTL在255（最大可能值）或附近，并且他离目标比他试图冒充的系统更远（因此他不可能发送一个在到达目的地时会有所需TTL的数据包），那么他的计划可能会被挫败。当然，很少有系统使用最高的TTL，而且攻击者一开始就想冒充特定系统的可能性也很小。
- en: 'The attacker’s second challenge is that he might not be able to determine the
    exact distance between his victim and the impersonated system if he is nowhere
    near them and does not know the routing specifics between these hosts. But if
    the victim uses despoof to dynamically implement filtering rules to cut off malicious
    packets, the attacker might just try various TTLs from various sources until he
    sees that the victim is no longer capable of making the distinction. (This would
    be obvious: the system targeted would begin to exhibit the effects of a successful
    attack, such as a performance impact.)'
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 攻击者的第二个挑战是，如果他离受害者很远，并且不知道这些主机之间的路由细节，他可能无法确定受害者和冒充系统之间的确切距离。但如果受害者使用despoof动态实施过滤规则来切断恶意数据包，攻击者可能会尝试从各种来源尝试不同的TTL，直到他看到受害者不再能够区分为止。（这将是明显的：被攻击的系统将开始表现出成功攻击的效果，例如性能影响。）
- en: Each time a suspicious packet is received, the recipient must start an investigation
    and then wait for the results to arrive. This makes it impractical to use despoof
    as a basis for an automatic defense, especially in response to DoS attacks. However,
    this method is still quite useful for determining the actual origin of a “decoy
    scan.”
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每次接收到可疑数据包时，接收者都必须开始调查，然后等待结果到来。这使得将despoof作为自动防御的基础变得不切实际，尤其是在应对DoS攻击时。然而，这种方法对于确定“诱饵扫描”的实际来源仍然非常有用。
- en: Without the knowledge of a specific network’s topology, it is difficult to do
    any better than with despoof; the TTL analysis technique implemented by this tool
    is good enough to recognize and stop many common probes and individual attacks,
    but what next?
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 没有特定网络拓扑的知识，很难比使用despoof做得更好；这个工具实现的TTL分析技术足够好，可以识别并阻止许多常见的探测和个别攻击，但接下来怎么办？
- en: Combine Mark’s tool with real-time data on the network structure, and apply
    passive fingerprinting to determine the initial TTL of a system that sends specific
    requests, and this technique becomes much more powerful. This additional data
    allows us to perform an initial passive assessment of incoming traffic by comparing
    observed and initial TTLs with the expected distance indicated by the network
    map. ^([[36](#ftn.CHP-17-FN-1)]) Because the distance we should be seeing can
    be determined without initiating any active probe of the network topology data,
    we can instantly distinguish between legitimate and malicious traffic without
    much effort. This, in turn, makes it possible to react to massive incidents quite
    reliably and to detect individual low-profile probes without alerting the attacker
    that a spoofing detection system is in place.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 将马克的工具与网络结构的实时数据相结合，并应用被动指纹识别来确定发送特定请求的系统的初始TTL，这种技术就变得更加强大。这些额外的数据使我们能够通过比较观察到的初始TTL与网络图所示预期的距离来进行对传入流量的初步被动评估。^([[36](#ftn.CHP-17-FN-1)])
    由于我们可以不启动任何主动探测网络拓扑数据来确定我们应该看到的距离，因此我们可以几乎不费吹灰之力就区分合法和恶意流量。这反过来又使得我们能够相当可靠地应对大规模事件，并检测到单个低配置探测，而不会让攻击者知道有欺骗检测系统在位。
- en: Obviously, there is plenty to be gained from taking the structure of a network
    into account when considering peer-to-peer relations. But spoofing detection is
    only the beginning.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，在考虑对等关系时，考虑到网络的结构可以获得很多好处。但欺骗检测只是开始。
- en: '* * *'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[36](#CHP-17-FN-1)]) In such an approach, the comparison of TTLs must be
    performed with a certain error margin, because there can be several additional
    hops within internal networks. Too, some routes are asymmetric, and their lengths
    can differ slightly depending on the direction in which the traffic is being exchanged.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[36](#CHP-17-FN-1)]) 在这种方法中，必须允许一定的误差范围来比较TTLs，因为内部网络中可能有几个额外的跳数。此外，一些路由是非对称的，它们的长度可能会根据流量交换的方向略有不同。
- en: Network Triangulation with Mesh-Type Topology Data
  id: totrans-96
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网络三角测量与网格型拓扑数据
- en: Network triangulation is a considerably more interesting application of network
    topology mesh-type data for the purpose of traffic analysis. We can use network
    triangulation to determine the approximate location of an attacker who sends spoofed
    packets without the help of those operating the underlying routing backbone, as
    soon as they choose to attack more than one target at once or in succession—truly,
    happiness in misery.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 网络三角测量是网络拓扑网格型数据在流量分析目的上的一个相当有趣的应用。一旦攻击者选择同时或连续攻击多个目标，我们可以使用网络三角测量来确定发送欺骗数据包的攻击者的近似位置，而不需要那些操作底层路由骨干的人员的帮助——这真是痛苦中的快乐。
- en: 'Well, to be correct: although triangulation works best when the attacker chooses
    several targets, in some scenarios, it may work quite well even if they choose
    to attack only one service. In particular, we might be able to observe the same
    attack from different viewpoints when the object attacked has several IP addresses
    and the service is being served from several physical locations in order to distribute
    the load and make the entire structure fault tolerant (as is common with web services).
    In all other scenarios, we can get a range of data on an attack when system administrators
    notice that more than one system is being targeted by an attacker and share their
    data about the incident.'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 好吧，为了准确起见：虽然当攻击者选择多个目标时，三角测量效果最佳，但在某些场景中，即使他们选择仅攻击一个服务，也可能效果相当好。特别是，当攻击目标具有多个IP地址，并且服务由多个物理位置提供，以分散负载并使整个结构容错（如网络服务常见的那样）时，我们可能能够从不同的角度观察到相同的攻击。在所有其他场景中，当系统管理员注意到多个系统被攻击者针对并分享他们关于事件的资料时，我们可以获得关于攻击的一系列数据。
- en: 'Regardless of the case, once data believed to come from a single source is
    seen at more than one destination, we can triangulate. For each destination at
    which the traffic is seen, only a specific set of networks are at a distance that
    can be determined by observing the distance through which the offending packet
    has traveled (again, possible to find out by examining TTL^([[37](#ftn.CHP-17-FN-2)])).
    An intersection of all those sets for every observation point would yield a smaller
    set—or, often, only a single network—from which the attack could originate, as
    shown in [Figure 17-2](ch17s04.html#a_naive_network_triangulation_colon_only "Figure 17-2. A
    naive network triangulation: only one origin is consistent with all observations.
    The attacker may be spoofing source addresses, but can’t fool the victims.").'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 无论情况如何，一旦认为来自单一来源的数据出现在多个目的地，我们就可以进行三角测量。对于每个观察到流量的目的地，只有一组特定的网络距离可以通过观察违规数据包经过的距离来确定（再次，可以通过检查
    TTL 来找出）。所有观察点的这些集合的交集将产生一个更小的集合——或者通常情况下，只有一个网络——攻击可能由此发起，如图 [图 17-2](ch17s04.html#a_naive_network_triangulation_colon_only
    "图 17-2. 傻瓜网络三角测量：只有一个来源与所有观察结果一致。攻击者可能正在欺骗源地址，但无法欺骗受害者") 所示。
- en: The ability to perform the trace on our own frees us from unconditional dependence
    on ISPs and helps to precisely pinpoint who is attacking or probing our network—and
    perhaps find out why.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 能够自行执行跟踪使我们摆脱了对 ISP 的无条件依赖，并有助于精确确定谁在攻击或探测我们的网络——也许还能找出原因。
- en: Although this approach is much more difficult to thwart than traditional despoofing,
    a clever attacker might still be able to fool an observer by randomizing a different
    TTL (or range of TTLs) to be used for every target. True, we know of no tools
    to do this at present, but this might change.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管这种方法比传统的去欺骗方法更难阻止，但一个狡猾的攻击者仍然可能通过为每个目标随机化不同的 TTL（或 TTL 范围）来欺骗观察者。诚然，我们目前不知道有工具能做这件事，但这可能会改变。
- en: The battle is lost? Nope—there is a way to keep perpetrators from fooling us
    that way.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 战斗已经失败了吗？不，有一种方法可以防止肇事者用这种方式欺骗我们。
- en: '* * *'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[37](#CHP-17-FN-2)]) Even if the tool uses random TTLs, it is possible to
    judge the distance by using the maximum TTL observed if a number of packets can
    be observed at each destination (which is almost always the case). For example,
    if the scan tool randomizes initial TTLs in the range of 32 to 255, but for several
    thousand packets received at the destination, none had a TTL higher than 247,
    the host is quite likely to be 255 – 247 = 8 systems away.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[37](#CHP-17-FN-2)]) 即使工具使用随机的 TTL，如果可以在每个目的地观察到多个数据包，那么通过观察数据包经过的距离（再次，可以通过检查
    TTL 来找出）来判断距离是可能的。例如，如果扫描工具在 32 到 255 的范围内随机化初始 TTL，但在目的地接收到的数千个数据包中，没有一个的 TTL
    超过 247，那么主机很可能有 255 - 247 = 8 个系统距离。
- en: Network Stress Analysis
  id: totrans-105
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 网络压力分析
- en: 'The solution, dubbed “network stress analysis,” comes in the form of a fine
    piece of research presented by Hal Brunch and Bill Cheswick at the LISA conference
    in 2000.^([[112](apb.html#ftn.CHP-17-BIB-3)]) Brunch and Cheswick proposed an
    interesting use for tree-type network topology data (similar to the graph shown
    earlier in [Figure 17-1](ch17.html#bill_cheswickas_map_of_the_internet "Figure 17-1. Bill
    Cheswick’s map of the Internet")) obtained for a specific location. They came
    up with a way to use the data to detect the origin of a particular type of spoofed
    traffic: Denial of Service. The approach itself is fairly trivial and is based
    on the assumption that such an attack would stress not only the system against
    which it is being carried out, but also interim routers, and that this stress
    could be externally measured by the victim and used to—almost literally—go back
    and find a yarn by pulling the wire.'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 解决方案被称为“网络压力分析”，以一篇由 Hal Brunch 和 Bill Cheswick 在 2000 年 LISA 大会上展示的优秀研究成果的形式出现。[^([[112](apb.html#ftn.CHP-17-BIB-3))]]
    Brunch 和 Cheswick 提出了一种对树形网络拓扑数据（类似于前面在 [图 17-1](ch17.html#bill_cheswickas_map_of_the_internet
    "图 17-1. Bill Cheswick 的互联网地图")) 中获得的数据的有趣用途，这些数据是针对特定位置的。他们想出了一种使用这些数据来检测特定类型欺骗流量（拒绝服务）来源的方法。这种方法本身相当简单，基于这样一个假设：这种攻击不仅会对所针对的系统造成压力，还会对中间路由器造成压力，而这种压力可以通过受害者外部测量并用来——几乎可以说是——通过拉动电线来回溯找到线索。
- en: '![A naive network triangulation: only one origin is consistent with all observations.
    The attacker may be spoofing source addresses, but can’t fool the victims.](httpatomoreillycomsourcenostarchimages1138108.png.jpg)'
  id: totrans-107
  prefs: []
  type: TYPE_IMG
  zh: '![一个简单的网络三角剖分：只有一个源头与所有观察结果一致。攻击者可能正在伪造源地址，但无法欺骗受害者。](httpatomoreillycomsourcenostarchimages1138108.png.jpg)'
- en: 'Figure 17-2. A naive network triangulation: only one origin is consistent with
    all observations. The attacker may be spoofing source addresses, but can’t fool
    the victims.'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 图17-2. 一个简单的网络三角剖分：只有一个源头与所有观察结果一致。攻击者可能正在伪造源地址，但无法欺骗受害者。
- en: The job of stress-testing network links is achieved by first building or obtaining
    a tree of links from your location to all networks on the Internet and then going
    through subsequent branches of this tree structure when an attack occurs. For
    each branch (which, in reality, denotes a connection to a higher-order router),
    we can iteratively measure network load on this node by sending test traffic to
    or through the router associated with it. (In this particular paper, a UDP [User
    Datagram Protocol] chargen is used, but ICMP requests or any other type of messages
    could be also used.) We choose a more loaded node as a potential candidate for
    the incoming traffic and then list and test all branches that spawn from this
    node until we trace the traffic back to the origin.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 通过首先从您的位置构建或获取到所有互联网网络的链接树，然后在攻击发生时遍历此树结构的后续分支，来完成对网络链接的压力测试工作。对于每个分支（在现实中，这表示与更高阶路由器的连接），我们可以通过向或通过与其关联的路由器发送测试流量来迭代测量此节点的网络负载。（在这篇特定的论文中，使用了UDP
    [用户数据报协议] chargen，但也可以使用ICMP请求或其他类型的消息。）我们选择一个更负载的节点作为潜在入流候选，然后列出并测试从这个节点产生的所有分支，直到我们追踪到流量源头。
- en: '[Figure 17-3](ch17s04.html#recursive_attack_backtrace_using_network "Figure 17-3. Recursive
    attack backtrace using network topology data and stress testing") illustrates
    a simple trace-back scenario. In the first phase, the attacked system attempts
    to measure the performance of the three nearest Internet routers when an attack
    occurs; it concludes that the first (topmost) router is the most saturated.'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: '[图17-3](ch17s04.html#recursive_attack_backtrace_using_network "图17-3. 使用网络拓扑数据和压力测试进行递归攻击回溯")展示了简单的回溯场景。在第一阶段，当攻击发生时，受攻击的系统试图测量三个最近的互联网路由器的性能；它得出结论，第一个（最顶部的）路由器是最饱和的。'
- en: Based on this information, the victim chooses to test only those routers directly
    connected (peering) with this device. In this particular figure, only three devices
    are to be tested (the remaining six are not to be tested because they do not peer
    with this device), and, again, the first one is the most loaded. The process continues
    until a router that is directly connected to a specific network, for which a physical
    location and owner information can be discovered through public databases, is
    determined to be the final endpoint.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 基于这些信息，受害者选择只测试与此设备直接连接（对等）的路由器。在这个特定的图中，只有三个设备需要测试（剩余的六个不需要测试，因为它们不与此设备对等），再次，第一个是最负载的。这个过程会持续进行，直到确定一个直接连接到特定网络的路由器，通过公共数据库可以找到其物理位置和所有者信息，作为最终端点。
- en: '![Recursive attack backtrace using network topology data and stress testing](httpatomoreillycomsourcenostarchimages1138110.png.jpg)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
  zh: '![使用网络拓扑数据和压力测试进行递归攻击回溯](httpatomoreillycomsourcenostarchimages1138110.png.jpg)'
- en: Figure 17-3. Recursive attack backtrace using network topology data and stress
    testing
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 图17-3. 使用网络拓扑数据和压力测试进行递归攻击回溯
- en: 'A potential problem arises: some devices might be heavily loaded for reasons
    other than handling DoS traffic; other devices might have plenty of spare CPU
    cycles and would not be considerably affected by relaying malicious traffic.'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 出现了一个潜在问题：一些设备可能因为处理DoS流量以外的其他原因而负载过重；其他设备可能有充足的CPU周期，不会因为中继恶意流量而受到严重影响。
- en: To solve this issue, the research proposes putting an artificial short-term
    load on the router (by generating additional traffic) and then observing how this
    test affects the bandwidth and latency of the DoS requests; if this particular
    device is indeed involved in relaying malicious packets, the attack rate should
    drop when we put load on the device (again, likely by generating additional bogus
    TCP, UDP, or ICMP requests, designed more to consume a device’s CPU power than
    to congest its interfaces). Hence, there should be a correlation only on those
    branches that are involved in servicing the malicious traffic.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 为了解决这个问题，研究提出了在路由器上施加人工短期负载（通过生成额外流量）并观察这种测试如何影响DoS请求的带宽和延迟；如果这个特定设备确实参与了恶意数据包的中继，那么当我们对设备施加负载时（再次，可能通过生成额外的伪造TCP、UDP或ICMP请求，这些请求更多地是为了消耗设备的CPU功率而不是使其接口拥塞），攻击率应该会下降。因此，应该只在涉及服务恶意流量的分支上存在相关性。
- en: This brilliant and simple scheme had been successfully used in test environments.
    However, because it involves interacting with routers and placing an additional
    load on them, certain ethical considerations come into play when we consider using
    it in the real world.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 这个聪明而简单的方案已经在测试环境中成功使用。然而，因为它涉及到与路由器交互并在其上放置额外的负载，所以在考虑在现实世界中使用它时，某些伦理问题就出现了。
- en: Food for Thought
  id: totrans-117
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 思考题
- en: The main difficulty in using the techniques discussed in this chapter for tracking
    down attackers is that we need to construct and update network maps for each location.
    It is not immediately clear how often such maps should be refreshed, and what
    methods would prove most reliable and least intrusive.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章讨论的技术用于追踪攻击者的主要困难在于，我们需要为每个地点构建和更新网络图。并不立即清楚这些图应该多久刷新一次，以及哪些方法将证明最可靠且最不具侵入性。
- en: Another possible issue is that much of the core Internet infrastructure is redundant.
    Some alternative routes may be chosen only when the primary route fails or is
    saturated, though in some cases the switch may occur as a part of load balancing.
    Thus, some empirical maps may become obsolete in a matter of minutes or hours—although
    such cases are not very common.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个可能的问题是，大部分核心互联网基础设施是冗余的。在某些情况下，只有在主路由失败或饱和时，才会选择某些替代路由，尽管在某些情况下，切换可能作为负载平衡的一部分发生。因此，某些经验性地图可能在几分钟或几小时内就过时了——尽管这种情况并不常见。
- en: In the end, although private, individual uses of various despoofing tactics
    may prove very successful, there are many open questions that need to be answered
    before we can deploy such techniques on a large scale—and some of the questions
    are not as much about technical issues.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，尽管使用各种去伪战术的私人、个人用途可能非常成功，但在我们可以大规模部署这些技术之前，还有许多需要回答的问题——其中一些问题并不完全是关于技术问题。
- en: Chapter 18. Watching the Void
  id: totrans-121
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第18章 监视虚空
- en: '*When looking down the abyss, what does not kill us makes us stronger*'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '*当我们凝视深渊时，没有杀死我们的东西使我们变得更强大*'
- en: —
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: —
- en: We have looked at many ways to discover information and intercept data by observing
    the communications between two systems or by watching the side effects of such
    communications. The story does not end here, however. Sometimes, by averting our
    eyes from the target we hope to probe, we can see even more.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经探讨了通过观察两个系统之间的通信或观察此类通信的副作用来发现信息和拦截数据的方法。然而，故事还没有结束。有时，通过避开我们希望探测的目标，我们甚至可以看到更多。
- en: An entire set of methods commonly referred to as “black-hole monitoring” is
    dedicated to observing and analyzing unwanted or unsolicited traffic that arrives
    accidentally, erroneously, or in mangled form at a specific destination. These
    methods most often include simply running a packet dump utility and then painstakingly
    analyzing and theorizing about every single observance.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 一整套通常被称为“黑洞监控”的方法，致力于观察和分析意外、错误或以损坏形式到达特定目的地的未请求或不想要的流量。这些方法通常包括简单地运行数据包转储工具，然后痛苦地分析和理论化每一个观察结果。
- en: Although in a perfect world, we should gain nothing by looking for data where
    we are not supposed to find it, in reality we can use these methods to gather
    abundant bits of information and invaluable hints as to the condition of a network
    as a whole. Even though the information is mostly random and we cannot choose
    who we listen to, we can still benefit from the effort.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管在一个完美的世界中，我们不应该在不应找到数据的地方寻找数据，但现实中我们可以使用这些方法收集大量信息，并获得关于整个网络状况的无价线索。尽管信息大多是随机的，我们无法选择我们听谁的话，但我们仍然可以从这些努力中受益。
- en: Direct Observation Tactics
  id: totrans-127
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 直接观察策略
- en: One application of black-hole monitoring lies in detecting and analyzing global
    attack trends. Many black hat hackers in possession of new attack techniques often
    simply scan large blocks of network addresses to find vulnerable targets that
    can be compromised and ultimately used for illicit activities (presumably to collect
    skip hosts^([[38](#ftn.CHP-18-FN-1)]) or to build attack drone networks for automated
    attacks). We can use black-hole monitoring to alert us to new vulnerabilities
    being exploited in the wild by simply observing increased standard network scan
    activity from various sources.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 黑洞监控的一个应用在于检测和分析全球攻击趋势。许多掌握新攻击技术的黑帽黑客通常会简单地扫描大量网络地址，以寻找可被利用的脆弱目标，最终用于非法活动（可能是为了收集跳转主机^([[38](#ftn.CHP-18-FN-1)])
    或构建用于自动攻击的攻击无人机网络）。我们可以通过观察来自各种来源的标准网络扫描活动增加，来使用黑洞监控提醒我们野外正在被利用的新漏洞。
- en: Many network administrators deploy black-hole monitoring. They sometimes combine
    it with honeypots (in which a fake “lure” system is put out on the network to
    catch attackers and intercept their tools and identify their techniques^([[113](apb.html#ftn.CHP-18-BIB-1)]))
    to produce an advance warning system that will allow them to be the first to know
    about impeding breakouts of worms and other malware. (You can also use black-hole
    traffic to calibrate “noise levels” and detect targeted attacks against your servers
    more efficiently, without picking up automated, indiscriminate malicious activity.)
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 许多网络管理员部署黑洞监控。他们有时会将其与蜜罐（在网络中放置一个假的“诱饵”系统来捕捉攻击者，拦截他们的工具并识别他们的技术^([[113](apb.html#ftn.CHP-18-BIB-1)]))
    结合使用，以产生一个预警系统，使他们能够首先了解蠕虫和其他恶意软件即将爆发的信息。（您还可以使用黑洞流量来校准“噪声水平”并更有效地检测针对您的服务器的针对性攻击，而不会收集自动的、无差别的恶意活动。）
- en: Researchers such as Dug Song and Jose Nazario (Jose most recently in his book
    *Defense and Detection Strategies against Internet Worms*^([[114](apb.html#ftn.CHP-18-BIB-2)]))
    have attempted to analyze black-hole activity during massive outbreaks of network
    worms. Their goal is to better understand and model the distribution (initial
    propagation and reinfection) dynamics of the network and to test the efficiency
    and persistence of the worms’ infection algorithms. Their research will help us
    to devise future defenses against massive, distributed threats, while providing
    valuable insight into the state of the network today. Some examples of their findings
    are shown in [Figure 18-1](ch18.html#windows_worm_propagation_characteristics
    "Figure 18-1. Windows worm propagation characteristics") through [Figure 18-4](ch18s02.html#worm_persistence_over_time._note_that_th
    "Figure 18-4. Worm persistence over time. Note that there is no trivial spike-falloff
    pattern for CodeRed and that the model behaves like a biological population model.").
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 如杜格·桑格和何塞·纳萨里奥（何塞最近在他的书《针对互联网蠕虫的防御和检测策略》^([[114](apb.html#ftn.CHP-18-BIB-2)]))
    等研究人员，曾尝试在大量网络蠕虫爆发期间分析黑洞活动。他们的目标是更好地理解和模拟网络的分布（初始传播和再感染）动态，并测试蠕虫感染算法的效率和持续性。他们的研究将帮助我们设计针对大规模、分布式威胁的未来防御措施，同时为今天网络的状态提供宝贵的见解。他们的发现示例显示在[图18-1](ch18.html#windows_worm_propagation_characteristics
    "图18-1. Windows蠕虫传播特性")通过[图18-4](ch18s02.html#worm_persistence_over_time._note_that_th
    "图18-4. 蠕虫随时间持久性。注意CodeRed没有简单的峰值衰减模式，该模型的行为类似于生物种群模型。"）。
- en: '[Figure 18-1](ch18.html#windows_worm_propagation_characteristics "Figure 18-1. Windows
    worm propagation characteristics") shows how a worm propagates during an outbreak.
    The data is based on the number of observed attack attempts on TCP port 137, a
    part of the Windows NetBIOS implementation, which is installed by default on all
    Windows computers and targeted by many types of self-propagating malware. Notice
    in this figure how, after a week of initial propagation—when both the number of
    infected sites (sources) and systems attacked on the observed black-hole network
    were steadily and rapidly increasing—a stabilization period suddenly stretches
    for over a month with dramatic peaks and valleys. Such a propagation footprint
    is highly unique to a worm and the network conditions in which it operates; it
    also reflects the subtleties of the target selection and infection algorithms
    used by the author.'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: '[图18-1](ch18.html#windows_worm_propagation_characteristics "图18-1. Windows蠕虫传播特性")展示了在爆发期间蠕虫的传播方式。数据基于对TCP端口137的观察到的攻击尝试次数，这是Windows
    NetBIOS实现的一部分，默认安装在所有Windows计算机上，并且被许多类型的自传播恶意软件所针对。注意在这个图中，在最初的传播一周后——当受感染的站点（源）和被观察到的黑洞网络上的攻击系统数量稳步且快速增加时——一个稳定期突然持续了一个多月，出现了戏剧性的高峰和低谷。这种传播足迹对于蠕虫及其运行的网络安全条件来说非常独特；它还反映了作者使用的目标选择和感染算法的微妙之处。'
- en: '[Figure 18-2](ch18.html#sqlsnake_worm_target_selection_algorithm "Figure 18-2. SQLSnake
    worm target selection algorithm histogram; note the nonuniform but generally continuous
    coverage of the address space") shows a different aspect of the worm propagation
    algorithm and depicts the properties of the target selection algorithm. In this
    case, a popular worm that targeted Microsoft SQL servers appears to have fairly
    continuous coverage of the address space (although addresses with octets between
    about 200 and 225 are chosen considerably more often, and the worm appears to
    skip values over 225 altogether).'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '[图18-2](ch18.html#sqlsnake_worm_target_selection_algorithm "图18-2. SQLSnake蠕虫目标选择算法直方图；注意地址空间的非均匀但总体连续覆盖")展示了蠕虫传播算法的不同方面，并描述了目标选择算法的特性。在这种情况下，一个针对Microsoft
    SQL服务器的流行蠕虫似乎对地址空间有相当连续的覆盖（尽管在约200到225之间的八位字节被选择得相当频繁，而且蠕虫似乎完全跳过了225以上的值）。'
- en: '![Windows worm propagation characteristics](httpatomoreillycomsourcenostarchimages1138112.png)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![Windows蠕虫传播特性](httpatomoreillycomsourcenostarchimages1138112.png)'
- en: Figure 18-1. Windows worm propagation characteristics
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 图18-1. Windows蠕虫传播特性
- en: '![SQLSnake worm target selection algorithm histogram; note the nonuniform but
    generally continuous coverage of the address space](httpatomoreillycomsourcenostarchimages1138114.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![SQLSnake蠕虫目标选择算法直方图；注意地址空间的非均匀但总体连续覆盖](httpatomoreillycomsourcenostarchimages1138114.png)'
- en: Figure 18-2. SQLSnake worm target selection algorithm histogram; note the nonuniform
    but generally continuous coverage of the address space
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 图18-2. SQLSnake蠕虫目标选择算法直方图；注意地址空间的非均匀但总体连续覆盖
- en: '[Figure 18-3](ch18.html#the_slapper_worm_target_selection_algori "Figure 18-3. The
    Slapper worm target selection algorithm histogram. This shows a far more uniform
    distribution, but noncontinuous coverage with gaps suggesting that the least significant
    bits of each of the “random” addresses are constant—perhaps due to a programming
    glitch.") shows the same graph for a different network worm, Slapper. This worm
    targeted Linux systems, exploiting a flaw in a popular OpenSSL encryption library.
    The algorithm appears to offer considerably more uniform, but much less continuous
    coverage, with gaping holes across certain values.'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '[图18-3](ch18.html#the_slapper_worm_target_selection_algori "图18-3. Slapper蠕虫目标选择算法直方图。这显示了远更均匀的分布，但非连续覆盖，存在间隙，表明每个“随机”地址的最不重要位是常数——可能是因为编程错误。")展示了不同网络蠕虫Slapper的相同图表。这个蠕虫针对Linux系统，利用了流行的OpenSSL加密库中的一个漏洞。该算法似乎提供了相当均匀的覆盖，但连续性较差，某些值之间存在巨大的空洞。'
- en: '![The Slapper worm target selection algorithm histogram. This shows a far more
    uniform distribution, but noncontinuous coverage with gaps suggesting that the
    least significant bits of each of the “random” addresses are constant—perhaps
    due to a programming glitch.](httpatomoreillycomsourcenostarchimages1138116.png)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![Slapper蠕虫目标选择算法直方图。这显示了远更均匀的分布，但非连续覆盖，存在间隙，表明每个“随机”地址的最不重要位是常数——可能是因为编程错误。](httpatomoreillycomsourcenostarchimages1138116.png)'
- en: Figure 18-3. The Slapper worm target selection algorithm histogram. This shows
    a far more uniform distribution, but noncontinuous coverage with gaps suggesting
    that the least significant bits of each of the “random” addresses are constant—perhaps
    due to a programming glitch.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 图18-3. Slapper蠕虫目标选择算法直方图。这显示了更加均匀的分布，但非连续的覆盖，存在间隙，表明每个“随机”地址的最不显著位是恒定的——可能是因为编程错误。
- en: '[Figure 18-4](ch18s02.html#worm_persistence_over_time._note_that_th "Figure 18-4. Worm
    persistence over time. Note that there is no trivial spike-falloff pattern for
    CodeRed and that the model behaves like a biological population model.") shows
    worm persistence patterns over time. For example, some worms appear to die off
    steadily as systems are patched and disinfected, while others use algorithms that
    cause sudden and recurring rise and fall patterns (familiar to anyone who has
    experimented with population or epidemiology models based on natural phenomena).'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: '[图18-4](ch18s02.html#worm_persistence_over_time._note_that_th "图18-4. 蠕虫随时间持久性。注意CodeRed没有简单的峰值衰减模式，并且模型的行为类似于生物种群模型。")显示了蠕虫随时间的持久性模式。例如，一些蠕虫似乎随着系统的修补和消毒而稳步死亡，而其他蠕虫则使用算法导致突然和反复的上升和下降模式（对任何尝试过基于自然现象的种群或流行病学模型的人来说都很熟悉）。'
- en: As Jose and his colleagues strive to demonstrate, black-hole monitoring may
    not be only a routine and perhaps completely needless activity, but also a great
    way to discover the secret life of all things malicious. Alas, the story does
    not end there. By observing only the traffic we consider aimed at us, we miss
    the most interesting bits of data.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 正如何塞和他的同事们努力证明的那样，黑洞监控可能不仅是一项常规活动，也许完全是多余的，而且也是发现所有恶意事物秘密生活的一种极好方式。然而，故事还没有结束。仅仅观察我们认为针对我们的流量，我们就错过了最有趣的数据。
- en: '* * *'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[38](#CHP-18-FN-1)]) Skip host is a system used as an intermediate hop for
    carrying out further attacks or other illicit activity (such as sending spam).
    This technique makes it more difficult to track the ultimate offender, because
    their origin is not directly known, and a number of administrators or jurisdictions
    must cooperate to find them.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[38](#CHP-18-FN-1)]) 跳过主机是一种用作中间跳转以执行进一步攻击或其他非法活动（如发送垃圾邮件）的系统。这种技术使得追踪最终罪犯变得更加困难，因为他们的来源不是直接知道的，需要多个管理员或司法管辖区合作才能找到他们。
- en: Attack Fallout Traffic Analysis
  id: totrans-144
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 攻击后果流量分析
- en: The other application of black-hole monitoring relies on observing traffic that
    was never aimed at us in the first place, but which is merely a side effect of
    other activity.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 黑洞监控的另一种应用是观察从未针对我们，但仅仅是其他活动副作用的流量。
- en: '![Worm persistence over time. Note that there is no trivial spike-falloff pattern
    for CodeRed and that the model behaves like a biological population model.](httpatomoreillycomsourcenostarchimages1138118.png.jpg)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![蠕虫随时间持久性。注意CodeRed没有简单的峰值衰减模式，并且模型的行为类似于生物种群模型。](httpatomoreillycomsourcenostarchimages1138118.png.jpg)'
- en: Figure 18-4. Worm persistence over time. Note that there is no trivial spike-falloff
    pattern for CodeRed and that the model behaves like a biological population model.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 图18-4. 蠕虫随时间持久性。注意CodeRed没有简单的峰值衰减模式，并且模型的行为类似于生物种群模型。
- en: Here we can see how a number of common reconnaissance and attack schemes use
    address spoofing to conceal an attacker’s identity. The assumption is that an
    administrator will have difficulty differentiating decoy traffic from bogus addresses
    from the attacker’s actual probes. Although as I’ve shown in previous chapters,
    this approach does not guarantee the attacker complete anonymity; in order to
    successfully “despoof” the traffic, an administrator must implement extensive
    logging and additional measures at the time of the attack. Because these procedures
    are not always implemented, attackers can often spoof their attacks quite effectively
    and remain out of the spotlight.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们可以看到许多常见的侦察和攻击方案如何使用地址欺骗来隐藏攻击者的身份。假设管理员将难以区分诱饵流量和攻击者实际探测的虚假地址。尽管如我在前几章中所示，这种方法并不能保证攻击者完全匿名；为了成功“去欺骗”流量，管理员必须在攻击时实施广泛的日志记录和额外的措施。因为这些程序并不总是实施，攻击者通常可以非常有效地欺骗他们的攻击，并保持不在聚光灯下。
- en: Whether packets are spoofed or not, the attacked system will in good faith respond
    to all requests including those allegedly coming from made-up addresses. However,
    only the responses to packets with a proper source address arrive back at the
    sender; all other probes generate responses that are scattered all around the
    Internet, and we can often catch them.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 不论数据包是否被伪造，被攻击的系统都将诚实地响应所有请求，包括那些声称来自虚构地址的请求。然而，只有带有正确源地址的数据包的响应会返回给发送者；所有其他探测都会生成散布在互联网各处的响应，我们通常可以捕捉到它们。
- en: Although it may seem unlikely that we will receive such a misdirected packet,
    remember that a considerable number of SYN+ACK, RST+ACK, and RST packets are generated
    in response to decoy scans or SYN flood attacks. The Internet address space appears
    vast, with millions of packets typically involved in such attacks, but it is quite
    likely that over time, some will reach every single network block. Although the
    likelihood of a single, randomly generated spoofed packet bouncing back to a specific
    address is only 1 in 4,294,967,296 (1 to 2^(32)), assuming that a typical small
    subnet assigned to a small company or organization usually consists of 256 addresses
    (class C network or equivalent), this probability is increased to 1 in 16,777,216
    (1 to 2^(24)). This can be further improved by ruling out address ranges that
    are known to be reserved for special purposes or which are otherwise not noteworthy
    and thus excluded in certain types of attacks.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然我们收到这种误定向的数据包似乎不太可能，但请记住，相当数量的SYN+ACK、RST+ACK和RST数据包是作为诱饵扫描或SYN洪水攻击的响应生成的。互联网地址空间看似庞大，通常涉及数百万个数据包的此类攻击，但相当可能的是，随着时间的推移，其中一些会到达每个网络块。尽管随机生成的伪造数据包弹回到特定地址的可能性仅为1/4,294,967,296（1到2的32次方），假设典型的小型子网分配给小型公司或组织通常由256个地址组成（C类网络或等效），这种概率增加到1/16,777,216（1到2的24次方）。通过排除已知为特殊用途保留的地址范围或因其他原因在特定类型的攻击中被排除的地址范围，这个概率还可以进一步提高。
- en: Because the face of a single SYN packet is about 40 bytes (and compresses well
    in bulk) and a typical network link available to a casual attacker has a throughput
    of approximately 10 to 150 kilobytes per IP layer per second (low-end DSL and
    T1 line, respectively), he can push out 250 to nearly 3,000 packets in this time
    frame—or 900,000 to circa 10,000,000 packets per hour.^([[39](#ftn.CHP-18-FN-2)])
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 由于单个SYN数据包的大小大约为40字节（并且在大批量中压缩良好），而一个普通攻击者可用的典型网络链路的吞吐量大约为每秒10到150千字节（分别对应低端DSL和T1线路），他可以在这一时间段内发送250到近3000个数据包——或者每小时900,000到约10,000,000个数据包。[39](#ftn.CHP-18-FN-2)
- en: For a typical DoS attack to produce any noticeable results and cause major inconvenience
    to the victim, it usually has to be carried out for several hours or days. (The
    attacker wants to inconvenience their victim for as long as possible.) As a result,
    dozens to hundreds of millions of packets are sent, generating a similar number
    of SYN+ACK or RST+ACK replies.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 对于典型的拒绝服务攻击（DoS）要产生任何明显的效果并给受害者造成重大不便，通常需要持续数小时或数天。（攻击者希望尽可能长时间地给受害者带来不便。）因此，会发送数十亿到数亿个数据包，产生数量相似的数量级的SYN+ACK或RST+ACK响应。
- en: Due to this huge amount of traffic, it’s quite reasonable to expect that even
    a relatively small entity could notice the fallout of a small SYN flood attack
    as it happens, even if the recipient host drops many attack packets. Furthermore,
    administrators able to monitor class B equivalent networks (65,356 addresses,
    usually owned by larger companies, ISPs, research institutions, and so forth)
    would be able to pick up much smaller events quickly.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 由于流量如此巨大，我们完全有理由预期，即使接收主机丢弃了许多攻击数据包，即使是相对较小的实体也能在攻击发生时注意到小SYN洪水攻击的影响。此外，能够监控B类等效网络（65,356个地址，通常由大型公司、ISP、研究机构等拥有）的管理员能够快速捕捉到更小的事件。
- en: Because all the fallout replies in a spoofed DoS attack include certain details
    of the messages fabricated by the attacker to trigger those responses in the first
    place (such as port and sequence numbers, timing information, and so forth), we
    can use these replies to extract important information about the type and scale
    of attack. We can use these replies to determine whether a specific service has
    been targeted, how many systems have been targeted, the bandwidth available to
    the attacker, and the tool used to perform the attack (by examining source port
    selection, chosen sequence numbers, and “random” IP patterns^([[40](#ftn.CHP-18-FN-3)])).
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 由于在伪造的DoS攻击中，所有响应的回波都包含攻击者为了最初触发这些响应而编造的消息的某些细节（例如端口号和序列号、时间信息等），我们可以利用这些回复来提取有关攻击类型和规模的重要信息。我们可以利用这些回复来确定是否针对了特定的服务，有多少系统受到了攻击，攻击者可用的带宽，以及执行攻击所使用的工具（通过检查源端口选择、选择的序列号和“随机”IP模式^([[40](#ftn.CHP-18-FN-3)]))。
- en: Finally, by analyzing the sources of these ricochet responses, we might notice
    that a particular network segment is under attack or be able to identify global
    “hostility trends,” perhaps to better prepare if a specific industry or business
    is being targeted. We can also use this information to learn about attacks that
    are being covered up by the victim or to identify false claims of attacks. (Claims
    that certain targets are being attacked by cyber-terrorists are sometimes made
    as a PR stunt to justify financial losses or to push a specific political agenda.
    Of recent, some experts accused SCO of taking their servers off-line and pretending
    to be a victim of a coordinated DoS attack to discredit the Linux users community.)
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，通过分析这些回波响应的来源，我们可能会注意到某个网络段正在遭受攻击，或者能够识别全球的“敌对趋势”，这可能有助于更好地准备，如果某个特定行业或企业正在遭受攻击。我们还可以利用这些信息来了解受害者掩盖的攻击，或者识别攻击的虚假声明。（有时，声称某些目标正遭受网络恐怖分子攻击的说法，是一种公关手段，用以证明财务损失或推动特定的政治议程。最近，一些专家指责SCO关闭了他们的服务器，并假装成为协调DoS攻击的受害者，以诋毁Linux用户社区。）
- en: '* * *'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[39](#CHP-18-FN-2)]) Note that determined, seasoned attackers proficient
    in Denial of Service attacks often have dozens or hundreds of “zombie” nodes at
    their command, thus increasing this estimate dramatically.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[39](#CHP-18-FN-2)]) 注意，那些熟练掌握拒绝服务攻击的坚定、经验丰富的攻击者通常控制着数十个或数百个“僵尸”节点，这大大增加了这个估计。
- en: ^([[40](#CHP-18-FN-3)]) For example, some tools only “spoof” packets from even
    or odd IP addresses due to coding flaws. Analyses similar to those conducted by
    Jose Nazario and others typically prove to be as good at pinpointing attack tools
    as they do at identifying worms.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[40](#CHP-18-FN-3)]) 例如，由于编码错误，一些工具只“伪造”来自偶数或奇数IP地址的数据包。与Jose Nazario等人进行的类似分析通常证明在确定攻击工具方面与识别蠕虫一样有效。
- en: Detecting Malformed or Misdirected Data
  id: totrans-159
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 检测格式错误或误向数据
- en: This application for monitoring black holes relies on monitoring traffic that
    does not seem to make any sense, but that still appears to reach a specific destination.
    To better illustrate the problem, allow me this digression.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 这种用于监控黑洞的应用依赖于监控看似没有意义，但仍然似乎到达特定目的地的流量。为了更好地说明问题，请允许我进行一些离题的讨论。
- en: In 1999, a group of friends, colleagues in Poland, and I began a humble after-hours
    project. Our goals were to track down a hard-to-explain set of RST+ACK packets
    that we had noticed arriving at networks we maintained and to monitor unusual
    and unsolicited traffic patterns arriving at unused network segments in general.
    It was great fun, and, as you might imagine, it resulted in a good deal of speculation
    when we tried to reasonably explain some of the most unusual cases. Our research
    also enabled us to learn more about the world around us as we encountered some
    exceedingly bizarre and seemingly inexplicable traffic that, once properly analyzed,
    provided more insight into the vast conspiraces of our wired world.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 在1999年，一群朋友、波兰的同事和我开始了一个谦逊的业余项目。我们的目标是追踪我们维护的网络中到达的难以解释的RST+ACK数据包集合，并监控一般到达未使用网络段的不寻常和未经请求的流量模式。这很有趣，正如你可能想象的那样，当我们试图合理地解释一些最不寻常的情况时，这导致了大量的猜测。我们的研究还使我们能够更多地了解我们周围的世界，因为我们遇到了一些极其奇特且看似无法解释的流量，一旦经过适当分析，就为我们提供了对我们有线世界广泛阴谋的更多洞察。
- en: 'Although formally abandoned, this project ended up in my private “Museum of
    Broken Packets,”^([[115](apb.html#ftn.CHP-18-BIB-3)]) a semihumorous web page
    dedicated to tracking down, documenting, and explaining packets that should never
    have reached their destination or that should never have looked the way they did.
    The stated purpose of the museum was as follows:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然形式上已被放弃，但这个项目最终落入了我的私人“破损数据包博物馆”，^([[115](apb.html#ftn.CHP-18-BIB-3)])这是一个半幽默的网页，致力于追踪、记录和解释那些本不应该到达目的地或本不应该以那种方式出现的数据包。博物馆的声明目的是如下：
- en: The purpose of this museum is to provide a shelter for strange, unwanted, malformed
    packets—abandoned and doomed freaks of nature—as we, mere mortals, meet them on
    the twisted paths of our grand journey called life. Our exhibits—or, if you wish,
    inhabitants—are often just a shadow of what they used to be before they met a
    hostile, faulty router. Some of them were born deformed in the depth of a broken
    IP stack implementation. Others were normal packets, just like their friends (you
    or me), but got lost looking for the ultimate meaning of their existence and arrived
    where we should never have seen them. In every case, we try to discover the unique
    history of each packet’s life, and to help you understand how difficult it is
    to be a sole messenger in the hostile universe of bits and bytes.
  id: totrans-163
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: 这家博物馆的目的是为我们这些凡人，在人生这条曲折的道路上遇到的各种奇怪、不受欢迎、畸形的数据包——被遗弃和注定要灭亡的自然怪胎——提供一个庇护所。我们的展品——或者如果你愿意，居民——通常只是它们在遇到敌对、故障的路由器之前的样子的一丝影子。其中一些在破损的IP堆栈实现深度中天生畸形。另一些则是像他们的朋友（你或我）一样的正常数据包，但在寻找它们存在的终极意义时迷路了，到达了我们不应该看到的地方。在每一种情况下，我们都试图发现每个数据包生活的独特历史，并帮助你理解在充满敌意的比特和字节宇宙中做一个孤独的使者是多么困难。
- en: And this is what the last type of black-hole monitoring boils down to. Although
    the task can appear pointless at first, it is foolish to assume so. The museum
    made it possible to passively uncover dark secrets about various proprietary devices
    and well-protected networks, and running such an experiment elsewhere would undoubtedly
    result in the same or greater accomplishments.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是最后一种黑洞监控类型归结为的东西。虽然这项任务一开始可能看起来毫无意义，但认为它是愚蠢的。博物馆使我们可以被动地揭露关于各种专有设备和受保护的网络的黑暗秘密，在其他地方进行这样的实验无疑会取得相同或更大的成就。
- en: 'Some of the exhibits in my museum include marvels such as the following:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 我博物馆中的展品包括以下这样的奇迹：
- en: Packets originating from networks with a specific type of web accelerator, router,
    or firewall; the device appends, strips, or otherwise mangles some of the data.
    A good example is a flaw in certain Nortel CVX devices that is responsible for
    the occasional stripping of TCP headers from packets (as discussed in [Chapter 11](ch11.html
    "Chapter 11. In Recognition of Anomalies")). The uniqueness of this flaw enables
    us to learn a good deal about a number of remote networks without having to actually
    go out and probe them.
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 来自具有特定类型网络加速器、路由器或防火墙的网络的数据包；该设备会附加、删除或以其他方式破坏一些数据。一个很好的例子是某些Nortel CVX设备中的缺陷，该缺陷偶尔会从数据包中剥离TCP头（如第11章中讨论的[第11章](ch11.html
    "第11章。为了识别异常")）。这个缺陷的独特性使我们能够在不实际外出探测的情况下，了解许多远程网络的大量信息。
- en: Several line noise exhibits, showing packets containing either utter garbage
    or data that certainly did not belong to a specific connection. One of the most
    surprising exhibits is unsolicited traffic containing data that appears to be
    a dump of .de DNS zone contents (a listing of all domains in Germany). The traffic
    could not have originated just anywhere, because mere mortals have no rights to
    obtain such a list. Instead, it must have originated at an authorized party able
    to obtain and transfer this data and must have been mangled either by the sender
    or by a device somewhere along the way. Although all cases shed little light on
    the nature of mishaps on the network, cases such as this one often enrich the
    observer with unexpected—and often valuable—findings.
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 几个行噪声展品，展示了包含要么是垃圾数据要么是肯定不属于特定连接的数据的数据包。最令人惊讶的展品之一是不请自来的流量，其中包含看起来像是.de DNS区域内容（德国所有域的列表）的转储。这种流量不可能来自任何地方，因为凡人没有权利获得这样的列表。相反，它必须来自一个有权获取和传输这些数据的授权方，并且可能是在发送者或沿途某个设备中被破坏的。尽管所有这些案例都很少能揭示网络事故的本质，但像这样的案例往往会使观察者获得意外——通常是宝贵的——发现。
- en: Other noteworthy exhibits included cases of apparent espionage camouflaged to
    appear as regular traffic and many other coding or networking hiccups. But enough
    bragging—if you feel compelled to find out more, visit [http://lcamtuf.coredump.cx/mobp/](http://lcamtuf.coredump.cx/mobp/).
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 其他值得注意的展品包括伪装成常规流量的明显间谍活动以及许多其他编码或网络小故障。但别再吹嘘了——如果你觉得有必要了解更多信息，请访问[http://lcamtuf.coredump.cx/mobp/](http://lcamtuf.coredump.cx/mobp/)。
- en: Food for Thought
  id: totrans-169
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 思考的食物
- en: Many regard black-hole monitoring as just another way to detect attacks against
    their systems (and perhaps an expensive way, given the scarcity of public IP space
    resources). But the real value of this technique is that it makes it possible
    to not only identify known attacks (something that can be done just as well in
    many other locations, without wasting IP space), but also detect and analyze subtle
    patterns that would otherwise be lost below the “noise level” in an extensively
    used network.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 许多人认为黑洞监控只是检测针对他们系统攻击的另一种方式（考虑到公共IP空间资源的稀缺，这可能是一种昂贵的方式）。但这项技术的真正价值在于，它不仅能够识别已知的攻击（这在许多其他地方也可以做到，而不必浪费IP空间），还能够检测和分析那些在其他情况下可能被网络“噪声水平”淹没的微妙模式。
- en: Naturally, performing this type of black-hole monitoring is not easy and remains
    expensive. It takes time to learn how to find that needle in the haystack of the
    usual worm and black hat activity that, in a sufficiently extensive network, usually
    bears no significance beyond statistical reporting.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，执行这种类型的黑洞监控并不容易，而且仍然很昂贵。需要时间来学习如何在通常的蠕虫和黑客活动的大杂烩中找到那根针，在足够广泛的网络中，这些活动通常除了统计报告外没有其他意义。
- en: Yet, for the joy of finally finding the needle, it is often worth a try.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，为了最终找到那根针的喜悦，尝试一下通常是值得的。
