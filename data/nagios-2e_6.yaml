- en: Part VI. Part VI Appendixes
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第六部分附录
- en: Appendix A. An Overview of the Nagios Configuration Parameters
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 附录A. Nagios配置参数概述
- en: 'Nagios contains two independent main configuration files: **`nagios.cfg`**
    controls operation of the Nagios daemon, **`cgi.cfg`** configures the Web interface.
    Both files should be located in the Nagios configuration directory, which is normally
    **`/etc/nagios`**.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios包含两个独立的配置文件：**`nagios.cfg`** 控制Nagios守护进程的操作，**`cgi.cfg`** 配置Web界面。这两个文件应位于Nagios配置目录中，通常为
    **`/etc/nagios`**。
- en: '**`nagios.cfg`** specifies a series of further configuration database and log
    files, and their functions for the respective parameter will be briefly described
    in the following reference. The notation ⇒**`parameter`** refers to the description
    of the **`parameter`** in the configuration file currently being discussed.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '**`nagios.cfg`** 指定了一系列进一步的配置数据库和日志文件，以及各自参数的功能将在以下参考中简要描述。符号 ⇒**`parameter`**
    指的是当前正在讨论的配置文件中 **`parameter`** 的描述。'
- en: Unless specified otherwise, parameters may have either the value **`0`** (disabled)
    or **`1`** (enabled). If a parameter has a default value, this is specified accordingly.
    For some path details, the standard value is defined by options during compiling.
    The values listed in this case correspond to the paths used in the book (see [Table 1-1](../Text/ch01s02.html#installation_parameters_for_nagios
    "Table 1-1. Installation parameters for Nagios"), page 40).
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 除非另有指定，否则参数可能具有 **`0`** (禁用) 或 **`1`** (启用) 的值。如果参数有默认值，则相应指定。对于某些路径细节，标准值是在编译时通过选项定义的。在这种情况下列出的值对应于书中使用的路径（见[表1-1](../Text/ch01s02.html#installation_parameters_for_nagios
    "表1-1. Nagios的安装参数")，第40页）。
- en: For some parameters there are no defaults. If these are missing from the configuration,
    Nagios does not provide the corresponding function (so, for example, without the
    **`cfg_dir`** parameter, Nagios ignores the object definitions stored in separate
    directories).
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 对于某些参数没有默认值。如果配置中缺少这些值，Nagios不会提供相应的功能（例如，如果没有 **`cfg_dir`** 参数，Nagios将忽略存储在单独目录中的对象定义）。
- en: Depending on the version of Nagios you're using, not all parameters will always
    be available. (Nagios 2.x) denotes those limited to Nagios 2.x, while (Nagios
    3.0) denotes those that have been added in Nagios 3.0.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 根据您使用的Nagios版本，并非所有参数始终都可用。（Nagios 2.x）表示仅限于Nagios 2.x的参数，而（Nagios 3.0）表示在Nagios
    3.0中添加的参数。
- en: A.1 The Main Configuration File **`nagios.cfg`**
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: A.1 主要配置文件 **`nagios.cfg`**
- en: '**`accept_passive_host_checks`**'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '**`accept_passive_host_checks`**'
- en: 'Global switch for passive host checks; the value **`0`** suppresses them. Even
    though passive host checks are allowed according to **`nagios.cfg`**, this feature
    must be explicitly enabled when defining the host object. Default value:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 被动主机检查的全局开关；值 **`0`** 会抑制它们。尽管根据 **`nagios.cfg`** 允许被动主机检查，但必须在定义主机对象时明确启用此功能。默认值：
- en: '**`accept_passive_host_checks=1`**'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: '**`accept_passive_host_checks=1`**'
- en: '**`accept_passive_service_checks`**'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: '**`accept_passive_service_checks`**'
- en: 'Global switch for passive service checks. Even though the value **`1`** allows
    corresponding tests, this feature must be explicitly enabled when defining the
    service object. Default value:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 被动服务检查的全局开关。尽管值 **`1`** 允许相应的测试，但此功能必须在定义服务对象时明确启用。默认值：
- en: '**`accept_passive_service_checks=1`**'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '**`accept_passive_service_checks=1`**'
- en: '**`additional_freshness_latency`** (Nagios 3.0)'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '**`additional_freshness_latency`** (Nagios 3.0)'
- en: 'Adds the latency, specified in seconds, to the fixed freshness interval. An
    upcoming freshness check (see [13.4 Reacting to Out-of-Date Information of Passive
    Checks](../Text/ch13s04.html "13.4 Reacting to Out-of-Date Information of Passive
    Checks") from page 295) is delayed by this time before it is run. Example:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 将指定的秒数延迟添加到固定新鲜度间隔。在运行之前，即将到来的新鲜度检查（见[13.4 对被动检查过时信息的反应](../Text/ch13s04.html
    "13.4 对被动检查过时信息的反应")，第295页）将被延迟。示例：
- en: '**`additional_freshness_latency=15`**'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '**`additional_freshness_latency=15`**'
- en: The default is **`0`** (no additional delay).
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 默认值为 **`0`** (无额外延迟)。
- en: '**`admin_email`**'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '**`admin_email`**'
- en: 'The e-mail address of the administrator responsible for the Nagios server,
    to which you have access through the macro **`$ADMINEMAIL$`**. If there is no
    explicit configuration of a contact object, Nagios will not send an e-mail to
    this address. Example (no default value):'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 负责Nagios服务器管理的管理员电子邮件地址，您可以通过宏 **`$ADMINEMAIL$`** 访问。如果没有明确配置联系人对象，Nagios不会向此地址发送电子邮件。示例（无默认值）：
- en: '**`admin_email=nagios`**'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '**`admin_email=nagios`**'
- en: '**`admin_pager`**'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '**`admin_pager`**'
- en: 'Pager number, SMS number, or e-mail address for a pager gateway/ SMS gateway
    through which the administrator of the Nagios server can be reached. Accessible
    through the macro **`$ADMINPAGER$`**. Example (no default value):'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 传呼机号码、短信号码或用于通过管理员可以联系到的传呼机网关/短信网关的电子邮件地址。可以通过宏 **`$ADMINPAGER$`** 访问。示例（无默认值）：
- en: '**`admin_pager=pagenagios`**'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '**`admin_pager=pagenagios`**'
- en: '**`aggregate_status_updates`**'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '**`aggregate_status_updates`**'
- en: 'Specifies whether Nagios writes status information from hosts, services, and
    its own programs for the time interval **`⇒status_update_interval`** in a block
    to the **`⇒status_file`**. The value 0 means Nagios updates this file immediately
    after every event. Default value:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 指定 Nagios 是否将来自主机、服务和其自身程序的状态信息写入 **`⇒status_update_interval`** 时间间隔的块中到 **`⇒status_file`**。值
    0 表示 Nagios 在每个事件之后立即更新此文件。默认值：
- en: '**`aggregate_status_updates=1`**'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '**`aggregate_status_updates=1`**'
- en: Nagios 3.0 works fundamentally according to the first method, which is why the
    parameter is omitted.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 3.0 基本上按照第一种方法工作，这就是为什么参数被省略的原因。
- en: '**`auto_reschedule_checks`**'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: '**`auto_reschedule_checks`**'
- en: 'With this experimental feature, Nagios spreads tests equally over the time
    period, to avoid peaks. This can considerably reduce performance and in particular
    is of no use if Nagios is already struggling to keep on schedule because of poor
    performance. Normally this option should be switched off. Default value:'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 使用这个实验性功能，Nagios 将测试均匀地分布在时间周期内，以避免峰值。这可能会显著降低性能，尤其是在 Nagios 已经因为性能不佳而难以保持时间表的情况下，这一点尤其没有用。通常应该关闭此选项。默认值：
- en: '**`auto_reschedule_checks=0`**'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '**`auto_reschedule_checks=0`**'
- en: '**`auto_rescheduling_interval`**'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: '**`auto_rescheduling_interval`**'
- en: 'In the intervals specified here, Nagios distributes tests which are to be executed
    in the next **`auto_rescheduling_window`** seconds, so that there is an equal
    load. Default value:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里指定的间隔内，Nagios 将在接下来的 **`auto_rescheduling_window`** 秒内执行的测试进行分配，以确保负载均衡。默认值：
- en: '**`auto_rescheduling_interval=30`**'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '**`auto_rescheduling_interval=30`**'
- en: '**`auto_rescheduling_window`**'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '**`auto_rescheduling_window`**'
- en: 'All tests that are to take place in the next number of seconds specified here
    are rescheduled by Nagios so that they are spread equally over this time period.
    Checks specified for a future time that lie outside this interval are not (yet)
    taken into account. Experimental feature; use only in exceptional cases! Default
    value:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里指定的接下来几秒钟内将要进行的所有测试都将由 Nagios 重新安排，以便它们在这段时间内均匀分布。指定在未来时间但位于此间隔之外的时间进行的检查（目前）不考虑。这是一个实验性功能；仅在特殊情况下使用！默认值：
- en: '**`auto_rescheduling_window=180`**'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: '**`auto_rescheduling_window=180`**'
- en: '**`broker_module`** (Nagios 3.0)'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '**`broker_module`** (Nagios 3.0)'
- en: 'This parameter integrates the specified event broker module (see [17.1 The
    Event Broker](../Text/ch17.html#the_event_broker "17.1 The Event Broker") from
    page 376) during the system start. Apart from the full path, you can also specify
    the module-specific arguments. The following example integrates the NDO event
    broker module (see also [17.4.4 Loading the Event Broker module in Nagios](../Text/ch17s04.html#loading_the_event_broker_module_in_nagio
    "17.4.4 Loading the Event Broker module in Nagios"), page 386):'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数在系统启动时集成指定的事件代理模块（见第 17.1 节“事件代理”，第 376 页）。除了完整路径外，还可以指定模块特定的参数。以下示例集成了 NDO
    事件代理模块（另见第 17.4.4 节“在 Nagios 中加载事件代理模块”，第 386 页）：
- en: '**`broker_module=/usr/local/nagios/bin/ndomod-3x.o config_file=/etc/ nagios/ndomod.cfg`**'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '**`broker_module=/usr/local/nagios/bin/ndomod-3x.o config_file=/etc/nagios/ndomod.cfg`**'
- en: The module-specific argument **`config_file`** provides the path for its configuration
    file. To integrate several modules, just specify the parameter **`broker_module`**
    for each module separately.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 模块特定的参数 **`config_file`** 提供了其配置文件的路径。要集成多个模块，只需为每个模块分别指定参数 **`broker_module`**。
- en: '**`cached_host_check_horizon`**(Nagios 3.0)'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '**`cached_host_check_horizon`**(Nagios 3.0)'
- en: 'Specifies the time in seconds in which Nagios recycles the result of a host
    check. Nagios does not repeat the test within this time frame but considers the
    cached result of the last check to still be up to date. This saves time and resources.
    Example:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 指定 Nagios 回收主机检查结果的秒数。在此时间框架内，Nagios 不会重复测试，但认为最后一次检查的缓存结果仍然是最新的。这可以节省时间和资源。示例：
- en: '**`cached_host_check_liorizon=30`**'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: '**`cached_host_check_liorizon=30`**'
- en: The value **`0`** switches off caching; the default is **`15`**. How large this
    value should be depends on circumstances. Large values take considerable strain
    off Nagios, but then there is a danger that the values may become obsolete and
    will no longer be valid.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 值 **`0`** 会关闭缓存；默认值为 **`15`**。此值的大小取决于具体情况。大值可以显著减轻Nagios的负担，但同时也存在这些值可能变得过时且不再有效的风险。
- en: '**`cached_service_check_horizon`**(Nagios 3.0)'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '**`cached_service_check_horizon`**(Nagios 3.0)'
- en: 'Like **`⇒cached_host_check_horizon`**, but Nagios uses cached service check
    results only for dependencies. This parameter therefore only has an effect on
    performance if there is a very large number of service dependency checks. Example:'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 与 **`⇒cached_host_check_horizon`** 类似，但Nagios仅使用缓存的服务检查结果来处理依赖关系。因此，此参数只有在存在大量服务依赖关系检查时才会对性能产生影响。例如：
- en: '**`cached_service_check_horizon=30`**'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: '**`cached_service_check_horizon=30`**'
- en: The value **`0`** switches off caching; the default is **`15`**.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 值 **`0`** 会关闭缓存；默认值为 **`15`**。
- en: '**`cfg_dir`**'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: '**`cfg_dir**'
- en: 'The directory in which the configuration files containing object definitions
    are located. Nagios searches through it recursively for configuration files with
    the extension **`.cfg`**. Files with other names are ignored, so that you can
    place help files in this directory, such as a CSV file from which host definitions
    are generated automatically by a script. To integrate individual files **`⇒cfg_file`**.
    The directive may be specified as often as you want (see also [2.1 The Main Configuration
    File nagios.cfg](../Text/ch02.html#the_main_configuration_file_nagios.cfg "2.1
    The Main Configuration File nagios.cfg"), page 55). Example (no default value
    set):'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 存放包含对象定义的配置文件的目录。Nagios会递归地搜索扩展名为 **`.cfg`** 的配置文件。其他名称的文件将被忽略，因此您可以将帮助文件放在此目录中，例如，一个CSV文件，该文件由脚本自动生成主机定义。要集成单个文件
    **`⇒cfg_file`**。此指令可以指定多次（也请参阅 [2.1 主配置文件nagios.cfg](../Text/ch02.html#the_main_configuration_file_nagios.cfg
    "2.1 主配置文件nagios.cfg")，第55页）。例如（未设置默认值）：
- en: cfg_dir=/etc/nagios/servers
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: cfg_dir=/etc/nagios/servers
- en: '**`cfg_file`**'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: '**`cfg_file`**'
- en: 'Integrates a single file with object definitions. More on this in [2.1 The
    Main Configuration File nagios.cfg](../Text/ch02.html#the_main_configuration_file_nagios.cfg
    "2.1 The Main Configuration File nagios.cfg"), page 55\. The directive can be
    specified as often as you want. Example (no default value set):'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 集成一个包含对象定义的单个文件。更多关于这一点的内容请参阅 [2.1 主配置文件nagios.cfg](../Text/ch02.html#the_main_configuration_file_nagios.cfg
    "2.1 主配置文件nagios.cfg")，第55页。此指令可以指定多次。例如（未设置默认值）：
- en: '**`cfg_file=/etc/nagios/checkcommands.cfg`**'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '**`cfg_file=/etc/nagios/checkcommands.cfg`**'
- en: Nagios 3.0 allows relative paths to be set, starting from the directory in which
    the file **`nagios.cfg`** is located.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 3.0允许设置相对路径，从包含文件 **`nagios.cfg`** 的目录开始。
- en: '**`check_external_commands`**'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_external_commands`**'
- en: 'Enables the interface for external commands. Necessary for passive checks or
    if commands are to be executed through the Web interface. More on this in [13.1
    The Interface for External Commands](../Text/ch13.html#the_interface_for_external_commands
    "13.1 The Interface for External Commands"), page 292\. Default value:'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 启用外部命令的接口。对于被动检查或要通过Web界面执行命令时是必要的。更多关于这一点的内容请参阅 [13.1 外部命令接口](../Text/ch13.html#the_interface_for_external_commands
    "13.1 外部命令接口")，第292页。默认值：
- en: '**`check_external_commands=0`**'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_external_commands=0`**'
- en: '**`check_for_orphaned_hosts`** (Nagios 3.0)'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_for_orphaned_hosts`** (Nagios 3.0)'
- en: Starting with Nagios 3.0, this parameter adds the host pendant to the ⇒ **`check_for_orphaned_services`**
    that already existed in Nagios 2.x.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 从Nagios 3.0开始，此参数将主机附加到已经在Nagios 2.x中存在的 ⇒ **`check_for_orphaned_services`**。
- en: '**`check_for_orphaned_services`**'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_for_orphaned_services`**'
- en: If the results of a service check are not received after a certain time, this
    is referred to as an *orphaned service*. Since Nagios only reschedules service
    checks if a result exists, it could be the case that a service is never again
    tested. Normally this only happens if a running service check is terminated manually
    from outside.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在一段时间后没有收到服务检查的结果，这被称为 *孤儿服务*。由于Nagios只有在存在结果的情况下才会重新安排服务检查，因此可能存在服务永远不会再次被测试的情况。通常这种情况只会发生在运行中的服务检查被手动从外部终止的情况下。
- en: 'If there is a suspicion that such orphaned services have occurred, you should
    set **`check_for_orphaned_services`** to **`1`** for debugging purposes. This
    is then confirmed if Nagios writes a corresponding error entry to the log file.
    Whether this is justified or not can easily be seen in the Web interface: you
    can have all services displayed independently of their status, and sorted by the
    last test time, in ascending order. Normally the execution of an active check
    should not be longer ago than specified in **`normal_check_interval`**. Default
    value:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 如果怀疑出现了这样的孤儿服务，您应该将**`check_for_orphaned_services`**设置为**`1`**以进行调试。然后，如果Nagios将相应的错误条目写入日志文件，则可以确认这一点。是否合理很容易在Web界面中看到：您可以独立于其状态显示所有服务，并按最后测试时间升序排序。通常，主动检查的执行不应早于**`normal_check_interval`**中指定的日期。默认值：
- en: '**`check_for_orphaned_services=0`**'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_for_orphaned_services=0`**'
- en: '**`check_host_freshness`**'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_host_freshness`**'
- en: 'Allows a passive host check to be tested actively if no check result has arrived
    for a long time. If Nagios considers the test result to be too old, ⇒**`host_freshness_check_interval`**
    steps in. More on *freshness checking* in [13.4 Reacting to Out-of-Date Information
    of Passive Checks](../Text/ch13s04.html "13.4 Reacting to Out-of-Date Information
    of Passive Checks"), page 295\. Default value:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 允许在长时间没有检查结果到达时，对被动主机检查进行主动测试。如果Nagios认为测试结果过旧，则 ⇒**`host_freshness_check_interval`**介入。更多关于*新鲜度检查*的信息，请参阅[13.4
    对被动检查过时信息的反应](../Text/ch13s04.html "13.4 对被动检查过时信息的反应")，第295页。默认值：
- en: '**`check_host_freshness=1`**'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_host_freshness=1`**'
- en: '**`check_result_path`** (Nagios 3.0)'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_result_path`** (Nagios 3.0)'
- en: 'The path in which check results are cached in file form from Nagios 3.0\. There
    should be no other files in this directory, since Nagios regularly empties it.
    Each Nagios instance requires a separate directory. Example:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 从Nagios 3.0开始，检查结果以文件形式缓存的路径。此目录中不应有其他文件，因为Nagios会定期清空它。每个Nagios实例需要一个单独的目录。示例：
- en: '**`check_result_path=/var/nagios/checkresults`**'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_result_path=/var/nagios/checkresults`**'
- en: '**`check_result_reaper_frequency`** (Nagios 3.0)'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_result_reaper_frequency`** (Nagios 3.0)'
- en: 'Reaper processes gather in check results and process these for Nagios. **`check_result_reaper_frequency`**
    defines in seconds the interval at which these processes are started. A short
    interval increases the system load; a long interval could lead to delays in the
    Nagios scheduling. Example:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 收割进程在检查结果中聚集，并为Nagios处理这些结果。**`check_result_reaper_frequency`**定义了这些进程启动的间隔（以秒为单位）。短间隔会增加系统负载；长间隔可能导致Nagios调度延迟。示例：
- en: '**`check_result_reaper_frequency=5`**'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_result_reaper_frequency=5`**'
- en: The parameter replaces ⇒service_reaper_frequency from Nagios 2.x.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 该参数替换了Nagios 2.x中的 ⇒service_reaper_frequency。
- en: '**`check_service_freslmess`**'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_service_freslmess`**'
- en: 'The service equivalent to **`check_host_freshness`**. The time after which
    Nagios considers the test result to be too old is defined by the parameter ⇒**`service_freshness_check_interval`**.
    Default value:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 等同于**`check_host_freshness`**的服务。Nagios认为测试结果过旧的时间由参数 ⇒**`service_freshness_check_interval`**定义。默认值：
- en: '**`check_service_freslmess=1`**'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_service_freslmess=1`**'
- en: '**`child_process_fork_twice`** (Nagios 3.0)'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: '**`child_process_fork_twice`** (Nagios 3.0)'
- en: 'Nagios normally starts two sub-processes when service or host checks are performed.
    This is not necessary but is intended to make the system more robust against plugin
    calls that crash. Default:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 当执行服务或主机检查时，Nagios通常启动两个子进程。这不是必需的，但旨在使系统对插件调用崩溃具有更强的鲁棒性。默认：
- en: '**`child_process_fork_twice=1`**'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: '**`child_process_fork_twice=1`**'
- en: The parameter **`use_large_installation_tweaks`** ([A.1 The Main Configuration
    File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    The Main Configuration File nagios.cfg")) sets the value **`0`** (just one sub-process);
    **`child_process_fork_twice=1`** activates this, despite the fact that **`use_large_installation_tweaks`**
    is set.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 参数**`use_large_installation_tweaks`** ([A.1 主配置文件 nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件 nagios.cfg")) 设置值为**`0`**（仅一个子进程）；**`child_process_fork_twice=1`**激活此功能，尽管**`use_large_installation_tweaks`**已设置。
- en: '**`command_check_interval`**'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '**`command_check_interval`**'
- en: Defines the time interval in which Nagios tests the External Command File (see
    [13.1 The Interface for External Commands](../Text/ch13.html#the_interface_for_external_commands
    "13.1 The Interface for External Commands"), page 292) for new entries. For this
    to happen at all, ⇒**`check_external_coramands`** must be enabled.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 定义 Nagios 测试外部命令文件（见 [13.1 外部命令接口](../Text/ch13.html#the_interface_for_external_commands
    "13.1 外部命令接口"), 第 292 页）新条目的时间间隔。要使此操作发生，必须启用 ⇒**`check_external_coramands`**。
- en: A simple number as the value refers to the time unit specified by ⇒**`interval_leiigth`**
    (normally 60 seconds, so that **`1`** stands for one minute). The value **`−1`**
    means that Nagios tests the interface as often as possible. If the number is supplemented
    (without a space) with the unit s, seconds can also be explicitly specified.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 简单数字作为值表示由 ⇒**`interval_leiigth`** 指定的时间单位（通常为 60 秒，因此 **`1`** 代表一分钟）。值 **`−1`**
    表示 Nagios 尽可能频繁地测试接口。如果数字后面补充（不带空格）单位 s，也可以显式指定秒。
- en: 'The interval dependent on passive checks may not be too large, since the operating
    system in the External Command File, a named pipe, can normally only save 4 KB.
    Default value:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 依赖于被动检查的间隔可能不会太大，因为外部命令文件中的操作系统，一个命名管道，通常只能保存 4 KB。默认值：
- en: '**`command_check_interval=-1`**'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: '**`command_check_interval=-1`**'
- en: '**`command_file`**'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '**`command_file`**'
- en: 'The named pipe that serves as an External Command File. It should only be writable
    for the user **`nagios`** and the group **`nagcmd`** (see also [13.1 The Interface
    for External Commands](../Text/ch13.html#the_interface_for_external_commands "13.1
    The Interface for External Commands"), page 292). Default value:'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 作为外部命令文件的命名管道。它应该只对用户 **`nagios`** 和组 **`nagcmd`** 可写（另见 [13.1 外部命令接口](../Text/ch13.html#the_interface_for_external_commands
    "13.1 外部命令接口"), 第 292 页）。默认值：
- en: '**`command_file=/var/nagios/rw/nagios.cmd`**'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: '**`command_file=/var/nagios/rw/nagios.cmd`**'
- en: '**`comment_file (Nagios 2.x)`**'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: '**`comment_file (Nagios 2.x)`**'
- en: 'File in which Nagios stores the comments, which can be specified through the
    Web interface. Default value:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 通过 Web 界面指定的 Nagios 存储注释的文件。默认值：
- en: '**`comment_file=/var/nagios/comments.dat`**'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '**`comment_file=/var/nagios/comments.dat`**'
- en: This parameter has been removed in Nagios 3.0; comments are now stored in the
    file **`status.dat`**.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数已在 Nagios 3.0 中删除；注释现在存储在文件 **`status.dat`** 中。
- en: '**`date_format`**'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '**`date_format`**'
- en: 'The date format that Nagios displays in the Web interface or uses in the date
    and time macro. Possible values are **`us`** (**``*`mm/dd/yyyy hh:mm:ss`*``**),
    euro (**``*`dd/mm/yyyy hh:mm:ss`*``**), **`iso8601`** (**``*`yyyy-mm-dd hh:mm:ss`*``**),
    and **`strict-iso8601`** (**``*`yyyy-mm-ddThh:mm:ss`*``**). Default value:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 在 Web 界面中显示或用于日期和时间宏的日期格式。可能的值有 **`us`** （``*`mm/dd/yyyy hh:mm:ss`*``**），欧元（``*`dd/mm/yyyy
    hh:mm:ss`*``**），**`iso8601`** （``*`yyyy-mm-dd hh:mm:ss`*``**），和 **`strict-iso8601`**
    （``*`yyyy-mm-ddThh:mm:ss`*``**）。默认值：
- en: '**`date_format=us`**'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '**`date_format=us`**'
- en: '**`downtime_file`** (Nagios 2.x)'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: '**`downtime_file`** （Nagios 2.x）'
- en: 'File in which the downtime details are saved, which can be specified through
    the Nagios Web interface for hosts and/or services (see [16.3 Planning Downtimes](../Text/ch16s03.html
    "16.3 Planning Downtimes"), page 359). Default value:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 保存停机详情的文件，可以通过 Nagios Web 界面为主机和/或服务指定（见 [16.3 规划停机时间](../Text/ch16s03.html
    "16.3 规划停机时间"), 第 359 页）。默认值：
- en: '**`downtime_file=/var/nagios/downtime.dat`**'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: '**`downtime_file=/var/nagios/downtime.dat`**'
- en: This parameter has been removed in Nagios 3.0; comments are now stored in the
    file **`status.dat`**.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数已在 Nagios 3.0 中删除；注释现在存储在文件 **`status.dat`** 中。
- en: '**`debug_file`** (Nagios 3.0)'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: '**`debug_file`** （Nagios 3.0）'
- en: 'For Nagios 2.x, debugging still had to be activated when compiling (for instance,
    with **`./configure --enable-DEBUGALL`**; see **`configure --help`**). In Nagios
    3.0 this can normally be configured in **`nagios.cfg`**. **`debug_file`** defines
    the file to which the debugging output is written. Example:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 Nagios 2.x，在编译时仍需要激活调试（例如，使用 **`./configure --enable-DEBUGALL`**；见 **`configure
    --help`**）。在 Nagios 3.0 中，这通常可以在 **`nagios.cfg`** 中配置。**`debug_file`** 定义了调试输出写入的文件。示例：
- en: '**`debug_file=/var/nagios/debug.log`**'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '**`debug_file=/var/nagios/debug.log`**'
- en: '**`debug_level`** (Nagios 3.0)'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: '**`debug_level`** （Nagios 3.0）'
- en: 'This defines what information is logged. The parameter has the following values,
    which can also be combined:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 这定义了记录的信息。该参数有以下值，也可以组合使用：
- en: '| **`−1`** all information |'
  id: totrans-106
  prefs: []
  type: TYPE_TB
  zh: '| **`−1`** 所有信息 |'
- en: '| **`0`** switches off debugging |'
  id: totrans-107
  prefs: []
  type: TYPE_TB
  zh: '| **`0`** 关闭调试 |'
- en: '| **`1`** Start/end of function calls |'
  id: totrans-108
  prefs: []
  type: TYPE_TB
  zh: '| **`1`** 函数调用开始/结束 |'
- en: '| **`2`** Information on the configuration |'
  id: totrans-109
  prefs: []
  type: TYPE_TB
  zh: '| **`2`** 配置信息 |'
- en: '| **`4`** Information on processes |'
  id: totrans-110
  prefs: []
  type: TYPE_TB
  zh: '| **`4`** 进程信息 |'
- en: '| **`8`** Scheduling details |'
  id: totrans-111
  prefs: []
  type: TYPE_TB
  zh: '| **`8`** 调度细节 |'
- en: '| **`16`** Host and service checks |'
  id: totrans-112
  prefs: []
  type: TYPE_TB
  zh: '| **`16`** 主机和服务的检查 |'
- en: '| **`32`** Messages |'
  id: totrans-113
  prefs: []
  type: TYPE_TB
  zh: '| **`32`** 消息 |'
- en: '| **`64`** Event broker |'
  id: totrans-114
  prefs: []
  type: TYPE_TB
  zh: '| **`64`** 事件代理 |'
- en: 'Example:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 示例：
- en: '**`debug_level=−1`**'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '**`debug_level=−1`**'
- en: '**`debug_verbosity`** (Nagios 3.0)'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: '**`debug_verbosity`**（Nagios 3.0）'
- en: 'Defines the level of verbosity when debugging: The value **`0`** provides only
    basic information, while **`1`** information is slightly more detailed. The value
    **`2`** provides much more detailed information that is generally only of interest
    to developers. Default:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 定义了调试时的详细程度：值**`0`**仅提供基本信息，而**`1`**提供稍微详细的信息。值**`2`**提供更多详细的信息，通常只有开发人员才会感兴趣。默认：
- en: '**`debug_verbos ity=1`**'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: '**`debug_verbosity=1`**'
- en: '**`enable_embedded_perl`** (Nagios 3.0)'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: '**`enable_embedded_perl`**（Nagios 3.0）'
- en: 'Switches on the Embedded Perl Interpreter ([Appendix G](../Text/apg.html "Appendix G. The
    Embedded Perl Interpreter") from page 669), provided it has been built in. In
    Nagios 2.x a built-in Interpreter is always active, whereas Nagios 3.0 allows
    this to be set with this parameter. Example:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 如果已内置，则开启嵌入式Perl解释器（[附录G](../Text/apg.html "附录G. 嵌入式Perl解释器")，第669页），Nagios
    2.x中内置的解释器始终处于活动状态，而Nagios 3.0允许通过此参数设置。示例：
- en: '**`enable_embedded_perl=1`**'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '**`enable_embedded_perl=1`**'
- en: switches on the Interpreter, the value **`0`** switches it off. The default
    is **`1`** if the Interpreter has been built in, otherwise **`0`**.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 开启解释器，值**`0`**关闭它。如果解释器已内置，则默认为**`1`**，否则为**`0`**。
- en: '**`enable_environment_macros`** (Nagios 3.0)'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '**`enable_environment_macros`**（Nagios 3.0）'
- en: 'Nagios standard macros, such as **`$HOSTADDRESS$`** (see [D.1.8 Using standard
    macros about the environment](../Text/apd.html#using_standard_macros_about_the_environm
    "D.1.8 Using standard macros about the environment"), page 631) can (even in Nagios
    2.x) be accessed as environment variables. In Nagios 3.0 the number of available
    macros has increased so drastically that to process them in large environments
    would lead to performance problems. Default:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios标准宏，如**`$HOSTADDRESS$`**（参见[使用环境标准宏](../Text/apd.html#using_standard_macros_about_the_environm
    "使用环境标准宏")，第631页）可以在Nagios 2.x中作为环境变量访问。在Nagios 3.0中，可用的宏数量急剧增加，因此在大型环境中处理它们可能会导致性能问题。默认：
- en: '**`enable_environment_macros=1`**'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: '**`enable_environment_macros=1`**'
- en: The value **`0`** switches off this mechanism.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 值**`0`**关闭此机制。
- en: '**`enable_event_handlers`**'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '**`enable_event_handlers`**'
- en: 'Globally switches the option on (or off) to work with event handlers for service
    and host checks. More on this in [Appendix C](../Text/apc.html "Appendix C. Event
    Handlers"), page 619\. Default value:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 全局切换选项以使用服务和主机检查的事件处理器。更多内容请参阅[附录C](../Text/apc.html "附录C. 事件处理器")，第619页。默认值：
- en: '**`enable_event_handlers=l`**'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '**`enable_event_handlers=l`**'
- en: '**`enable_flap_detection`**'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: '**`enable_flap_detection`**'
- en: 'Defines whether Nagios is generally able to detect continually changing states
    (*flap detection*, more on this in [Appendix B](../Text/apb.html "Appendix B. Rapidly
    Alternating States: Flapping"), page 611). Default value:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 定义了Nagios是否通常能够检测持续变化的状态（*状态波动检测*，更多内容请参阅[附录B](../Text/apb.html "附录B. 快速交替状态：波动")，第611页）。默认值：
- en: '**`enable_flap_detection=0`**'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: '**`enable_flap_detection=0`**'
- en: '**`enable_notifications`**'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '**`enable_notifications`**'
- en: 'Defines whether Nagios can send notifications. Switching off this feature normally
    only makes sense on the central hosts of a distributed installation, which themselves
    cannot generate notifications, and instead forward their test results to a central
    Nagios instance (see [Chapter 15](../Text/ch15.html "Chapter 15. Distributed Monitoring")
    from page 317). Default value:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 定义了Nagios是否可以发送通知。关闭此功能通常只在分布式安装的中心主机上才有意义，这些主机本身无法生成通知，而是将测试结果转发到中心Nagios实例（参见第15章[分布式监控](../Text/ch15.html
    "第15章. 分布式监控")，第317页）。默认值：
- en: '**`enable_notifications=l`**'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '**`enable_notifications=l`**'
- en: '**`enable_predictive_host_dependency_checks`** (Nagios 3.0)'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '**`enable_predictive_host_dependency_checks`**（Nagios 3.0）'
- en: 'Nagios 3.x caches host check results if a corresponding time frame is given
    with ⇒**`cached_host_check_horizon`**. The parameter **`enable_predictive_host_dependency_checks`**
    uses caching not only to decide between DOWN and UNREACHABLE for unreachable hosts,
    but also for host dependency checks, provided some have been defined (see [12.6.2
    Only in exceptional cases: host dependencies](../Text/ch12s06.html#only_in_exceptional_cases_colon_host_de
    "12.6.2 Only in exceptional cases: host dependencies"), page 289).'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 如果提供了相应的时间范围，Nagios 3.x会缓存主机检查结果⇒**`cached_host_check_horizon`**。参数**`enable_predictive_host_dependency_checks`**不仅用于决定无法到达的主机的DOWN和UNREACHABLE状态，还用于主机依赖关系检查，前提是已经定义了一些（参见[12.6.2
    特殊情况：主机依赖](../Text/ch12s06.html#only_in_exceptional_cases_colon_host_de "12.6.2
    特殊情况：主机依赖")，第289页）。
- en: '**`enable_predictive_service_dependency_checks`** (Nagios 3.0)'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '**`enable_predictive_service_dependency_checks`** (Nagios 3.0)'
- en: 'If this parameter is enabled (value **`1`**), service checks will use cached
    results to resolve dependencies instead of peforming the checks again. There is
    more on service dependency checks in [12.6.1 The standard case: service dependencies](../Text/ch12s06.html#the_standard_case_colon_service_depende
    "12.6.1 The standard case: service dependencies"), page 285.'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 如果此参数启用（值**`1`**），服务检查将使用缓存的结果来解决依赖关系，而不是再次执行检查。有关服务依赖关系检查的更多信息，请参见[12.6.1 标准情况：服务依赖](../Text/ch12s06.html#the_standard_case_colon_service_depende
    "12.6.1 标准情况：服务依赖")，第285页。
- en: '**`event_broker_options`**'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: '**`event_broker_options`**'
- en: 'The event broker as a new interface in Nagios 2.0 allows third parties to add
    some features to Nagios in the form of loadable modules, for example to save test
    results to a database instead of to a file. One application that uses the event
    broker interface is the NDOutils ([Chapter 17](../Text/ch17.html "Chapter 17. Flexible
    Web Interface with the NDOUtils") from page 375). Possible values are **`0`**
    (switched off) and **`−1`** (accept all broker modules). Default value:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 2.0中的事件代理作为新接口允许第三方以可加载模块的形式向Nagios添加一些功能，例如将测试结果保存到数据库而不是文件中。使用事件代理接口的一个应用程序是NDOutils（[第17章](../Text/ch17.html
    "第17章. 使用NDOUtils的灵活Web界面")，从第375页）。可能的值是**`0`**（关闭）和**`−1`**（接受所有代理模块）。默认值：
- en: '**`event_broker_options=0`**'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: '**`event_broker_options=0`**'
- en: '**`event_handler_timeout`**'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: '**`event_handler_timeout`**'
- en: 'The time after which Nagios terminates the event handlers which have not yet
    finished. Default value:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios终止尚未完成的事件处理器的超时时间。默认值：
- en: '**`event_handler_timeout=30`**'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: '**`event_handler_timeout=30`**'
- en: '**`execute_host_checks`**'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: '**`execute_host_checks`**'
- en: 'Enables/disables active host checks globally. This is only worth switching
    off in distributed environments with a central Nagios instance that only accepts
    passive results from other Nagios servers (see [Chapter 15](../Text/ch15.html
    "Chapter 15. Distributed Monitoring"), page 317). Default value:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 全局启用/禁用活动主机检查。仅在具有中央Nagios实例的分布式环境中才值得关闭，该实例仅接受来自其他Nagios服务器的被动结果（参见[第15章](../Text/ch15.html
    "第15章. 分布式监控")，第317页）。默认值：
- en: '**`execute_host_checks=1`**'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: '**`execute_host_checks=1`**'
- en: '**`execute_service_checks`**'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: '**`execute_service_checks`**'
- en: 'Like **`execute_host_checks`**, but for service checks. Default value:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 与**`execute_host_checks`**类似，但用于服务检查。默认值：
- en: '**`execute_service_checks=1`**'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '**`execute_service_checks=1`**'
- en: '**`external_command_buffer_slots`** (Nagios 3.0)'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: '**`external_command_buffer_slots`** (Nagios 3.0)'
- en: 'Specifies the maximum number of external commands that the external command
    file interface ([13.1 The Interface for External Commands](../Text/ch13.html#the_interface_for_external_commands
    "13.1 The Interface for External Commands") from page 292) can store temporarily.
    If the buffer is not large enough, some results might be lost. Default:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 指定外部命令文件接口（[13.1 外部命令接口](../Text/ch13.html#the_interface_for_external_commands
    "13.1 外部命令接口")，第292页）可以临时存储的外部命令的最大数量。如果缓冲区不够大，可能会丢失一些结果。默认：
- en: '**`external_command_buffer_slots=4096`**'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: '**`external_command_buffer_slots=4096`**'
- en: '**`free_child_process_memory`** (Nagios 3.0)'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: '**`free_child_process_memory`** (Nagios 3.0)'
- en: Nagios normally clears up sub-processes from the memory, but the parameter **`use_large_installation_tweaks=1`**
    (see [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")) switches off this behavior by default.
    With
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios通常从内存中清除子进程，但参数**`use_large_installation_tweaks=1`**（参见[A.1 主配置文件nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件nagios.cfg")）默认关闭此行为。使用
- en: '**`free_child_process_memory=1`**'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: '**`free_child_process_memory=1`**'
- en: you can reactivate the cleaning up process, despite **`use_large_installation_tweaks=1`**
    being set.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 即使设置了**`use_large_installation_tweaks=1`**，也可以重新激活清理过程。
- en: '**`global_host_event_handler`**'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: '**`global_host_event_handler`**'
- en: 'Defines a global host event handler, in addition to the host-specific event
    handlers defined with **`event_handler`**. For this, both the global parameter
    ⇒**`enable_event_handlers`** as well as the parameter **`event_handler_enabled`**
    must be enabled in the host definition. Nagios executes the global event handler,
    a normal command object, before the host-specific one. Example (no default value
    set):'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 定义一个全局主机事件处理器，除了使用**`event_handler`**定义的主机特定事件处理器外。为此，主机定义中的全局参数⇒**`enable_event_handlers`**以及参数**`event_handler_enabled`**都必须启用。Nagios在执行主机特定事件处理器之前，先执行全局事件处理器，这是一个正常的命令对象。示例（未设置默认值）：
- en: '**`global_host_event_handler=`****``*`name_of_the_command-object`*``**'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: '**`global_host_event_handler=`****``*`name_of_the_command-object`*``**'
- en: '**`global_service_event_handler`**'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: '**`global_service_event_handler`**'
- en: 'The service-specific equivalent to **`global_host_event_handler`**. Apart from
    ⇒**`enable_event_handlers`**, the parameter **`event_handler_enabled`** in the
    service definition must also be enabled. Example (no default value set):'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 服务特定的等效于**`global_host_event_handler`**。除了⇒**`enable_event_handlers`**之外，服务定义中的参数**`event_handler_enabled`**也必须启用。示例（未设置默认值）：
- en: '**`global_service_event_handler=`****``*`name_of_command_object`*``**'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: '**`global_service_event_handler=`****``*`name_of_command_object`*``**'
- en: '**`high_host_flap_threshold`**'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '**`high_host_flap_threshold`**'
- en: 'Upper limit of flap detection for host checks. Details are given in [Appendix B](../Text/apb.html
    "Appendix B. Rapidly Alternating States: Flapping"), page 611\. Default value:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 主机检查中检测跳变的上限。详细信息请见[附录B](../Text/apb.html "附录B. 快速交替状态：跳变"), 第611页。默认值：
- en: '**`high_host_flap_threshold=30.0`**'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: '**`high_host_flap_threshold=30.0`**'
- en: '**`high_service_flap_threshold`**'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: '**`high_service_flap_threshold`**'
- en: 'Upper limit of flap detection for service checks (see [Appendix B](../Text/apb.html
    "Appendix B. Rapidly Alternating States: Flapping")). Default value:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 服务检查中检测跳变的上限（见[附录B](../Text/apb.html "附录B. 快速交替状态：跳变")). 默认值：
- en: '**`high_service_flap_threshold=30.0`**'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: '**`high_service_flap_threshold=30.0`**'
- en: '**`host_check_timeout`**'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_check_timeout`**'
- en: 'Time in seconds after which Nagios aborts a host check if this has not yet
    returned a result. Default value:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios在未返回结果的情况下，在多少秒后终止主机检查。默认值：
- en: '**`host_check_timeout=30`**'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_check_timeout=30`**'
- en: '**`host_freshness_check_interval`**'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_freshness_check_interval`**'
- en: 'Interval between two *freshness checks* in seconds. Default value:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 两次*新鲜度检查*之间的秒数间隔。默认值：
- en: '**`host_freshness_check_interval=60`**'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_freshness_check_interval=60`**'
- en: '**`host_inter_check_delay_method`**'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_inter_check_delay_method`**'
- en: 'Controls how Nagios processes host checks after a restart. A sophisticated
    procedure aims to prevent Nagios in this situation from executing all tests simultaneously,
    and thus overloading the server. Possible values are: **`s`** (*smart*, intelligent,
    automatic distribution of the host checks), **`n`** (*no*, all checks start simultaneously),
    **`d`** (*dumb*, Nagios processes the tests at intervals of seconds), and an interval
    specified in seconds, in the format **``*`x.xx`*``**. Default value:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 控制Nagios在重启后如何处理主机检查。一个复杂的程序旨在防止Nagios在这种情况下同时执行所有测试，从而过载服务器。可能的值是：**`s`**（*智能*，智能，自动分配主机检查），**`n`**（*无*，所有检查同时开始），**`d`**（*愚蠢*，Nagios以秒为间隔处理测试），以及以秒为单位的间隔，格式为**``*`x.xx`*``**。默认值：
- en: '**`host_inter_check_delay_method=s`**'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_inter_check_delay_method=s`**'
- en: '**`host_perfdata_command`**'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_perfdata_command`**'
- en: A Nagios command object that should check the performance data after every host
    check. Requires the ⇒**`process_performance_data`** parameter to be set.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 一个Nagios命令对象，应在每次主机检查后检查性能数据。需要设置⇒**`process_performance_data`**参数。
- en: 'This parameter only makes sense in a few cases, since Nagios executes host
    checks only if necessary, and therefore at very irregular intervals. It is used
    if performance data are to be processed without a template ([19.1 Processing Plugin
    Performance Data with Nagios](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 Processing Plugin Performance Data with Nagios"), page 404). Example (no
    default value set):'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数仅在少数情况下有意义，因为Nagios仅在必要时执行主机检查，因此间隔非常不规则。如果要在没有模板的情况下处理性能数据（[19.1 使用Nagios处理插件性能数据](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 使用Nagios处理插件性能数据"), 第404页），则使用此参数。示例（未设置默认值）：
- en: '**`host_perfdata_command=process-host-perfdata`**'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_perfdata_command=process-host-perfdata`**'
- en: '**`host_perfdata_file`**'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_perfdata_file`**'
- en: 'Specifies a file or named pipe through which Nagios forwards performance data
    from host checks via a template mechanism to an external program (see [Chapter 19](../Text/ch19.html
    "Chapter 19. Graphic Display of Performance Data"), page 403). ⇒**`process_performance_data`**
    must be set. Example (no default value set):'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 指定一个文件或命名管道，通过该文件或管道 Nagios 将主机检查的性能数据通过模板机制转发到外部程序（参见 [第 19 章](../Text/ch19.html
    "第 19 章. 性能数据的图形显示"), 第 403 页）。⇒**`process_performance_data`** 必须设置。示例（未设置默认值）：
- en: '**`host_perfdata_file=/tmp/host-perfdata`**'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_perfdata_file=/tmp/host-perfdata`**'
- en: '**`host_perfdata_file_mode`**'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_perfdata_file_mode`**'
- en: 'Defines how data is passed on to the file ⇒**`host_perf data_file`**. Possible
    values are **`a`** (*append* to a normal file) or **`w`** (*write* to a new file),
    and for Nagios 3.0 also **`p`** (*non blocking write*), which is particularly
    useful for pipes. Example (no default value set):'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 定义如何将数据传递到文件 ⇒**`host_perf data_file`**。可能的值是 **`a`** (*追加* 到一个普通文件) 或 **`w`**
    (*写入*到一个新文件)，对于 Nagios 3.0，还有 **`p`** (*非阻塞写入*)，这对于管道特别有用。示例（未设置默认值）：
- en: '**`host_perfdata_file_mode=a`**'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_perfdata_file_mode=a`**'
- en: '**`host_perfdata_file_processing_command`**'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_perfdata_file_processing_command`**'
- en: 'Nagios command object that is called after host performance data is passed
    on to the ⇒**`host_perf data_file`** interface. The parameter is only used with
    the template mechanism and is optional. Programs such as **`perf2rrd`** ([19.3
    Preparing Performance Data for Evaluation with Perf2rrd](../Text/ch19s03.html
    "19.3 Preparing Performance Data for Evaluation with Perf2rrd"), page 415) have
    their own daemon that permanently reads data from the interface. Example (no default
    value set):'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 命令对象在将主机性能数据传递到 ⇒**`host_perf data_file`** 接口之后被调用。该参数仅在模板机制中使用，是可选的。例如，**`perf2rrd`**
    ([19.3 使用 Perf2rrd 准备性能数据以供评估](../Text/ch19s03.html "19.3 使用 Perf2rrd 准备性能数据以供评估"),
    第 415 页) 有自己的守护进程，它永久地从接口读取数据。示例（未设置默认值）：
- en: '**`host_perfdata_file_processing_command=process-host-perfdata-file`**'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_perfdata_file_processing_command=process-host-perfdata-file`**'
- en: '**`host_perfdata_file_processing_interval`**'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_perfdata_file_processing_interval`**'
- en: 'If this interval—specified in seconds—is larger than **`0`**, the command belonging
    to it (⇒**`host_perfdata_file_processing_command`**) is run periodically at these
    intervals. **`0`** ensures that it is not used. Example (no default value set):'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 如果这个间隔——以秒为单位——大于 **`0`**，则属于它的命令（⇒**`host_perfdata_file_processing_command`**）将在这个间隔内定期运行。**`0`**
    确保它不被使用。示例（未设置默认值）：
- en: '**`host_perfdata_file_processing_interval=0`**'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_perfdata_file_processing_interval=0`**'
- en: '**`host_perfdata_file_template`**'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_perfdata_file_template`**'
- en: 'Describes the output format of the performance data. The Nagios macros and
    format details in it, such as **`\t`** (tabulator) or **`\n`** (linefeed) are
    replaced in the output. More on the use of templates in [19.1 Processing Plugin
    Performance Data with Nagios](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 Processing Plugin Performance Data with Nagios"), page 404\. Example (no
    default value set):'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 描述性能数据的输出格式。Nagios 宏和其中包含的格式细节，如 **`\t`** (制表符) 或 **`\n`** (换行符)，在输出中被替换。更多关于模板的使用，请参阅
    [19.1 使用 Nagios 处理插件性能数据](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 使用 Nagios 处理插件性能数据"), 第 404 页。示例（未设置默认值）：
- en: host_perfdata_file_template=$TIMET$\t$HOSTNAME$\t$HOST-EXECUTIONTIME$\t\$HOSTOUTPUT$\t$HOSTPERFDATA$
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: host_perfdata_file_template=$TIMET$\t$HOSTNAME$\t$HOST-EXECUTIONTIME$\t\$HOSTOUTPUT$\t$HOSTPERFDATA$
- en: '**`illegal_macro_output_chars`**'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: '**`illegal_macro_output_chars`**'
- en: 'Lists characters that are discarded when macros are substituted for notifications,
    to avoid problems such as interpretation by the shell. The parameter has no influence
    on the substitution of macros in host or service definitions. Example (no default
    value set):'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 列出在宏替换通知时被丢弃的字符，以避免诸如由 shell 解释等问题。该参数对主机或服务定义中宏的替换没有影响。示例（未设置默认值）：
- en: '**`illegal_macro_output_chars='' ˜$&|''"<>`**'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: '**`illegal_macro_output_chars='' ˜$&|''"<>`** '
- en: '**`illegal_object_name_chars`**'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: '**`illegal_object_name_chars`**'
- en: 'Specifies impermissible characters in the names of Nagios objects. It is recommended
    that at least the characters listed in the following example be specified (no
    default value set):'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 指定 Nagios 对象名称中不允许的字符。建议至少指定以下示例中列出的字符（未设置默认值）：
- en: illegal_object_name_chars='˜ !$%^&*|'"<>?, () =
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: illegal_object_name_chars='˜ !$%^&*|'"<>?, () =
- en: '**`interval_length`**'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: '**`interval_length`**'
- en: 'Defines the time unit in seconds to which time details in object definitions
    (such as with **`normal_check_interval`** or **`retry_check_interval`**) refer.
    If **`interval_length`** is **`60`** seconds, the time specification is **`5`**
    five minutes. You should only change the default of 60 seconds if there is good
    reason to do so. **`interval_length`** has no influence on time parameters in
    **`nagios.cfg`**, however. Default value:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 定义对象定义（如**`normal_check_interval`**或**`retry_check_interval`**）中时间细节所参照的秒数时间单位。如果**`interval_length`**为**`60`**秒，则时间指定为**`5`**分钟。只有有充分的理由，您才应该更改默认的60秒。然而，**`interval_length`**对**`nagios.cfg`**中的时间参数没有影响。默认值：
- en: '**`interval_length=60`**'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: '**`interval_length=60`**'
- en: '**`lock_file`**'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: '**`lock_file`**'
- en: 'Specifies a lock file for the Nagios daemon containing the process ID (PID)
    of the daemon running. Is required for start/stop purposes. Default value:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 指定包含Nagios守护进程进程ID（PID）的Nagios守护进程锁定文件。启动/停止操作需要此文件。默认值：
- en: '**`lock_file=/var/nagios/nagios.lock`**'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: '**`lock_file=/var/nagios/nagios.lock`**'
- en: '**`log_archive_path`**'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_archive_path`**'
- en: 'The archive directory for rotating Nagios log files. Evaluations are based
    on the archive files copied there. If one of the files is deleted, the information
    contained in it is lost. Nagios uses the directory only if log rotation is enabled
    with the ⇒**`log_rotation_method`** parameter. Default value:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios日志文件的归档目录。评估基于复制到该目录的归档文件。如果删除其中一个文件，则其中包含的信息将丢失。Nagios仅在启用⇒**`log_rotation_method`**参数进行日志轮转时使用该目录。默认值：
- en: '**`log_archive_path=/var/nagios/archives`**'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_archive_path=/var/nagios/archives`**'
- en: '**`log_event_handlers`**'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_event_handlers`**'
- en: 'Should event handler actions appear in the log file? The parameter is used
    primarily to search for errors. Default value:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 事件处理器操作是否应出现在日志文件中？此参数主要用于查找错误。默认值：
- en: '**`log_event_handlers=1`**'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_event_handlers=1`**'
- en: '**`log_external_commands`**'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_external_commands`**'
- en: 'Should Nagios log external commands (see [13.1 The Interface for External Commands](../Text/ch13.html#the_interface_for_external_commands
    "13.1 The Interface for External Commands"), page 292) in the log file? Default
    value:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios是否应在日志文件中记录外部命令（见[13.1 外部命令接口](../Text/ch13.html#the_interface_for_external_commands
    "13.1 外部命令接口"), 第292页）？默认值：
- en: '**`log_external_commands=1`**'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_external_commands=1`**'
- en: '**`log_file`**'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_file`**'
- en: 'The central log file. Apart from errors and problems, it also retains all events.
    All history evaluations use this file. For log rotation, Nagios provides a separate
    mechanism, with ⇒**`log_rotation_method`**, and you should not use external programs
    here. Default value:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 中心日志文件。除了错误和问题外，它还保留所有事件。所有历史评估都使用此文件。对于日志轮转，Nagios提供了一个单独的机制，即⇒**`log_rotation_method`**，您不应在此处使用外部程序。默认值：
- en: '**`log_file=/var/nagios/nagios.log`**'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_file=/var/nagios/nagios.log`**'
- en: '**`log_host_retries`**'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_host_retries`**'
- en: 'Specifies whether Nagios should log host check repeats because of an error
    state. This is absolutely essential if event handlers (see [Appendix C](../Text/apc.html
    "Appendix C. Event Handlers"), page 619) are used which are to react to soft states.
    Default value:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 指定Nagios是否应记录由于错误状态而导致的主机检查重复。如果使用的事件处理器（见[附录C](../Text/apc.html "附录C. 事件处理器"),
    第619页）需要响应软状态，则此选项绝对必要。默认值：
- en: '**`log_host_retries=0`**'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_host_retries=0`**'
- en: '**`log_initial_states`**'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_initial_states`**'
- en: 'Specifies whether the start state of services and hosts should appear in the
    log file when the Nagios system is started. Default value:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 指定在Nagios系统启动时，服务主机启动状态是否应出现在日志文件中。默认值：
- en: '**`log_initial_states=0`**'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_initial_states=0`**'
- en: '**`log_notifications`**'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_notifications`**'
- en: 'Defines whether Nagios should also log notifications in the log file. Default
    value:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 定义Nagios是否也应将通知记录到日志文件中。默认值：
- en: '**`log_notifications=1`**'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_notifications=1`**'
- en: '**`log_passive_checks`**'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_passive_checks`**'
- en: 'Specifies whether Nagios should log passive checks in the log file. Default
    value:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 指定Nagios是否应在日志文件中记录被动检查。默认值：
- en: '**`log_passive_checks=1`**'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_passive_checks=1`**'
- en: '**`log_rotation_method`**'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_rotation_method`**'
- en: 'Defines whether the log file ⇒**`log_file`** should be saved periodically to
    the archive ⇒**`log_archive_path`**. Log rotating should always be left to Nagios
    itself, rather than any external programs, or otherwise the software will have
    difficulties in evaluating history data. Possible values are **`n`** (*none*,
    no archiving), **`h`** (*hourly*, at the beginning of each hour), **`d`** (*daily*,
    each day at 00:00 hours), **`w`** (*weekly*, at midnight from Saturday to Sunday),
    and **`m`** (*monthly*, the first day of each month at 00:00 hours). Default:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 定义是否应该定期将日志文件⇒**`log_file`**保存到存档⇒**`log_archive_path`**。日志轮转应始终由Nagios本身处理，而不是任何外部程序，否则软件在评估历史数据时将遇到困难。可能的值是**`n`**（无存档，不存档）、**`h`**（每小时，每个小时的开始）、**`d`**（每天，每天00:00小时）、**`w`**（每周，周六午夜至周日午夜）和**`m`**（每月，每月的第一天00:00小时）。默认：
- en: '**`log_rotation_method=n`**'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_rotation_method=n`**'
- en: '**`log_service_retries`**'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_service_retries`**'
- en: 'Should Nagios log the repeat of a service check because of a soft state error?
    This is useful for debugging when developing event handlers, but otherwise it
    is best to leave this out. Default value:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios是否应该记录由于软状态错误而重复的服务检查？这在开发事件处理器时进行调试很有用，但否则最好省略。默认值：
- en: '**`log_service_retries=0`**'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_service_retries=0`**'
- en: '**`low_host_flap_threshold`**'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: '**`low_host_flap_threshold`**'
- en: 'Lower limit for flap detection for hosts checks. Details are described in [Appendix B](../Text/apb.html
    "Appendix B. Rapidly Alternating States: Flapping"), page 611\. Default value:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 主机检查的翻转检测的下限。详细信息请参阅[附录B](../Text/apb.html "附录B. 快速交替状态：翻转")，第611页。默认值：
- en: '**`low_host_flap_threshold=20.0`**'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: '**`low_host_flap_threshold=20.0`**'
- en: '**`low_service_flap_threshold`**'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: '**`low_service_flap_threshold`**'
- en: 'Like **`low_host_flap_threshold`**, but for service checks. Default value:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 与**`low_host_flap_threshold`**类似，但用于服务检查。默认值：
- en: '**`low_service_flap_threshold=20.0`**'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: '**`low_service_flap_threshold=20.0`**'
- en: '**`max_check_result_file_age`** (Nagios 3.0)'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: '**`max_check_result_file_age`** (Nagios 3.0)'
- en: 'Defines the maximum age of a check result file in seconds, which the Reaper
    process from the directory **`check_result_path`** still processes. Older files
    are discarded. Example:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 定义检查结果文件的最大年龄（以秒为单位），Reaper进程从目录**`check_result_path`**中仍然处理这些文件。较旧的文件将被丢弃。例如：
- en: '**`max_check_result_file_age=1800`**'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: '**`max_check_result_file_age=1800`**'
- en: Check results are only processed here if the accompanying file is not older
    than 30 minutes. A value of **`0`** ignores the age of the result files.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 只有当伴随文件不超过30分钟时，这里的检查结果才会被处理。**`0`**的值忽略结果文件的年龄。
- en: '**`max_check_result_reaper_time (Nagios 3.0)`**'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: '**`max_check_result_reaper_time (Nagios 3.0)`**'
- en: 'Restricts the runtime of an individual Reaper process to the time in seconds
    specified. Example:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 限制单个Reaper进程的运行时间为指定的秒数。例如：
- en: '**`max_check_result_reaper_time=10`**'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: '**`max_check_result_reaper_time=10`**'
- en: Here the Reaper process is canceled after 10 seconds. Check results left over
    are processed by the next reaper process.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，Reaper进程在10秒后被取消。检查结果中剩余的将由下一个Reaper进程处理。
- en: '**`max_concurrent_checks`**'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: '**`max_concurrent_checks`**'
- en: 'Specifies how many checks Nagios may execute simultaneously. The value **`0`**
    allows an unlimited number. A restriction through a value larger than zero may,
    under unfavorable circumstances, lead to the test not being executed in time.
    Default value:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 指定Nagios可以同时执行多少个检查。值**`0`**允许无限数量。在不利的条件下，通过大于零的值进行限制可能会导致测试未能及时执行。默认值：
- en: '**`max_concurrent_cnecks=0`**'
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: '**`max_concurrent_cnecks=0`**'
- en: '**`max_debug_file_size (Nagios 3.0)`**'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: '**`max_debug_file_size (Nagios 3.0)`**'
- en: 'Limits the size of the debugging file to the value specified in bytes. Example:'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 将调试文件的大小限制为指定的字节数。例如：
- en: '**`max_debug_file_size=2048000`**'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: '**`max_debug_file_size=2048000`**'
- en: If the size exceeds the given value, Nagios adds the ending **`.old`** to the
    file. If a file already exists with the same name, it will be deleted. You must
    therefore make provision for twice the size specified here, since there could
    be two files (with and without the suffix **`.old`**) with the maximum size at
    the same time.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 如果大小超过给定值，Nagios将添加结尾的**`.old`**到文件。如果已存在同名文件，它将被删除。因此，您必须为此指定的大小提供两倍的空间，因为可能同时存在两个文件（带有和没有后缀**`.old`**）的最大大小。
- en: '**`max_host_check_spread`**'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: '**`max_host_check_spread`**'
- en: 'At what time interval (in minutes) should Nagios have started all host checks
    after a restart? Prevents all tests from being executed simultaneously, which
    would overload the Nagios server. Default value:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 重启后，Nagios应在多长时间间隔（以分钟为单位）内启动所有主机检查？这可以防止所有测试同时执行，从而避免过载Nagios服务器。默认值：
- en: '**`max_host_check_spread=30`**'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: '**`max_host_check_spread=30`**'
- en: '**`max_service_check_spread`**'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: '**`max_service_check_spread`**'
- en: 'Like **`max_host_check_spread`**, but for service checks. Default value:'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 与**`max_host_check_spread`**类似，但用于服务检查。默认值：
- en: '**`max_service_check_spread=30`**'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: '**`max_service_check_spread=30`**'
- en: '**`nagios_group`**'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: '**`nagios_group`**'
- en: 'The group with whose permissions the Nagios daemon runs. Default value (is
    defined during compilation):'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios守护进程运行的权限所属的组。默认值（在编译时定义）：
- en: '**`nagios_group=nagios`**'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: '**`nagios_group=nagios`**'
- en: '**`nagios_user`**'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: '**`nagios_user`**'
- en: 'The user with whose permissions the Nagios daemon runs. Default value (is defined
    during compilation):'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios守护进程运行的权限所属的用户。默认值（在编译时定义）：
- en: '**`nagios_user=nagios`**'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: '**`nagios_user=nagios`**'
- en: '**`notification_timeout`**'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: '**`notification_timeout`**'
- en: 'After how many seconds should Nagios abort the attempt to deliver a notification?
    Some actions, such as sending an SMS message, require a certain amount of time,
    since the system first waits for confirmation from the recipient. The value should
    therefore not be too low. Default value:'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios在多少秒后应该放弃发送通知的尝试？一些操作，例如发送短信，需要一定的时间，因为系统首先等待接收者的确认。因此，这个值不应太低。默认值：
- en: '**`notification_timeout=30`**'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: '**`notification_timeout=30`**'
- en: '**`object_cache_file`**'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: '**`object_cache_file`**'
- en: 'The file in which Nagios stores all objects after it starts. Since the Web
    interface uses this file, the normal configuration files with the object definitions
    can be edited while Nagios is running, without jeopardizing the functionality
    of the Web interface. Default value:'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios启动后存储所有对象的文件。由于Web界面使用此文件，因此可以在Nagios运行时编辑带有对象定义的正常配置文件，而不会危及Web界面的功能。默认值：
- en: '**`object_cache_file=/var/nagios/objects.cache`**'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: '**`object_cache_file=/var/nagios/objects.cache`**'
- en: '**`obsess_over_hosts`**'
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: '**`obsess_over_hosts`**'
- en: 'Defines in general whether host check results are forwarded to a central Nagios
    instance. If the parameter is enabled, the command defined in ⇒**`ocsp_commandis`**
    run. This is used in distributed environments; a description can be found in [Chapter 15](../Text/ch15.html
    "Chapter 15. Distributed Monitoring"), page 317\. Default value:'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 在一般情况下，定义是否将主机检查结果转发到中央Nagios实例。如果启用此参数，则运行在⇒**`ocsp_commandis`**中定义的命令。这在分布式环境中使用；描述可参见[第15章](../Text/ch15.html
    "第15章. 分布式监控")，第317页。默认值：
- en: '**`obsess_over_hosts=0`**'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: '**`obsess_over_hosts=0`**'
- en: '**`obsess_over_services`**'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: '**`obsess_over_services`**'
- en: 'Defines in general whether service check results should be forwarded to a central
    Nagios instance. If the parameter is enabled, the command defined in ⇒**`ohcp_command`**
    is used. This feature is used in distributed environments (see [Chapter 15](../Text/ch15.html
    "Chapter 15. Distributed Monitoring"), page 317). Default value:'
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 在一般情况下，定义是否应将服务检查结果转发到中央Nagios实例。如果启用此参数，则使用在⇒**`ohcp_command`**中定义的命令。此功能用于分布式环境（见[第15章](../Text/ch15.html
    "第15章. 分布式监控")，第317页）。默认值：
- en: '**`obsess_over_services=0`**'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: '**`obsess_over_services=0`**'
- en: '**`ochp_command`**'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: '**`ochp_command`**'
- en: 'Defines the *obsessive compulsive host processor*, a Nagios command object
    that forwards all host check results in a distributed environment to a central
    instance (see [Chapter 15](../Text/ch15.html "Chapter 15. Distributed Monitoring"),
    page 317). Example (no default value set):'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 定义*强迫症主机处理器*，这是一个Nagios命令对象，将分布式环境中的所有主机检查结果转发到中央实例（见[第15章](../Text/ch15.html
    "第15章. 分布式监控")，第317页）。示例（未设置默认值）：
- en: '**`ochp_command=`****``*`name_of_the_command_object`*``**'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: '**`ochp_command=`****``*`name_of_the_command_object`*``**'
- en: '**`ochp_timeout`**'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: '**`ochp_timeout`**'
- en: 'Defines the timeout for the ⇒**`ochp_command`**. After this time has expired,
    Nagios aborts the execution of the command. Default value:'
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 定义⇒**`ochp_command`**的超时时间。在此指定的时间过后，Nagios将中止命令的执行。默认值：
- en: '**`ochp_timeout=15`**'
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: '**`ochp_timeout=15`**'
- en: '**`ocsp_command`**'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: '**`ocsp_command`**'
- en: 'Specifies the command object that, as the *obsessive compulsive service processor*,
    should forward all service check results in a distributed environment to a central
    instance (see [Chapter 15](../Text/ch15.html "Chapter 15. Distributed Monitoring"),
    page 317). Example (no default value set):'
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 指定命令对象，作为*强迫症服务处理器*，应将分布式环境中的所有服务检查结果转发到中央实例（见[第15章](../Text/ch15.html "第15章.
    分布式监控")，第317页）。示例（未设置默认值）：
- en: '**`ochp_command=`****``*`name_of_the_command_object`*``**'
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: '**`ochp_command=`****``*`name_of_the_command_object`*``**'
- en: '**`ocsp_timeout`**'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: '**`ocsp_timeout`**'
- en: 'The timeout for the ⇒**`ocsp_command`**. After the time specified here has
    expired, Nagios aborts the execution of the command. Default value:'
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: 对于⇒**`ocsp_command`**的超时时间。在此指定的时间过后，Nagios将中止命令的执行。默认值：
- en: '**`ocsp_timeout=15`**'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: '**`ocsp_timeout=15`**'
- en: '**`passive_host_checks_are_soft`** (Nagios 3.0)'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: '**`passive_host_checks_are_soft`**（Nagios 3.0）'
- en: Normally, the results of passive host checks are always regarded as hard states.
    With
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，被动主机检查的结果总是被视为硬状态。使用
- en: '**`passive_host_checks_are_soft=1`**'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: '**`passive_host_checks_are_soft=1`**'
- en: the same behavior can be set for active host checks. Assigning soft or hard
    states can now be regulated by the parameter **`max_check_attempts`** from the
    host definition.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 同样的行为也可以应用于主动主机检查。现在可以通过主机定义中的参数**`max_check_attempts`**来调节分配软或硬状态。
- en: '**`perfdata_timeout`**'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: '**`perfdata_timeout`**'
- en: 'Defines after how many seconds a performance command (⇒**`host_perfdata_command`**,⇒**`service_perfdata_command`**,⇒**`host_perf-data_file_processing_command`**,
    or ⇒**`service_perfdata_file_processing_command`**) should be aborted. Default
    value:'
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 定义了性能命令（⇒**`host_perfdata_command`**，⇒**`service_perfdata_command`**，⇒**`host_perf-data_file_processing_command`**，或⇒**`service_perfdata_file_processing_command`**）应该在多少秒后终止。默认值：
- en: '**`perfdata_timeout=5`**'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: '**`perfdata_timeout=5`**'
- en: '**`precached_object_file`** (Nagios 3.0)'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: '**`precached_object_file`**（Nagios 3.0）'
- en: 'Starting with Nagios 3.0, it is possible to carry out reading and checking
    the configuration even before a Nagios restart and to cache the result in the
    file specified with **`precached_object_file`** (see [H.8 Restart](../Text/aphs08.html
    "H.8 Restart") from page 690). Example:'
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 从Nagios 3.0开始，可以在Nagios重启之前执行读取和检查配置，并将结果缓存到**`precached_object_file`**指定的文件中（参见第690页的[H.8重启](../Text/aphs08.html
    "H.8重启")）。示例：
- en: '**`precached_object_file=/var/nagios/objects.precache`**'
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: '**`precached_object_file=/var/nagios/objects.precache`**'
- en: '**`process_performance_data`**'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: '**`process_performance_data`**'
- en: 'Switches on processing of performance data. This parameter should be enabled
    only if performance data really is evaluated. Otherwise it only uses up resources
    on the Nagios server. Default value:'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 开启性能数据的处理。此参数只有在性能数据确实被评估时才应启用。否则，它只会占用Nagios服务器的资源。默认值：
- en: '**`process_performance_data=0`**'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: '**`process_performance_data=0`**'
- en: '**`resource_file`**'
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: '**`resource_file`**'
- en: 'The configuration file containing the definitions of the (maximum of 32) **`$USER`**χ**`$`**
    macros. **`$USER1$`** normally specifies the path to the Nagios plugins. Otherwise
    you could save passwords here, for example, which should not be readable in the
    normal Nagios configuration files. The file must then be protected from all external
    access, and only the user **`nagios`** should be able to read it. Example (no
    default value set):'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 包含（最多32个）**`$USER`**χ**`$`** 宏定义的配置文件。**`$USER1$`** 通常指定Nagios插件的路径。否则，您可以将密码保存在这里，例如，这些密码不应在正常的Nagios配置文件中读取。然后，该文件必须受到所有外部访问的保护，并且只有用户**`nagios`**能够读取它。示例（未设置默认值）：
- en: '**`resource_file=/etc/nagios/resource.cfg`**'
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: '**`resource_file=/etc/nagios/resource.cfg`**'
- en: '**`retain_state_information`**'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: '**`retain_state_information`**'
- en: 'Determines whether Nagios will save current states to a file on shutdown (⇒**`state_retention_file`**)
    and read these again when it starts. Default value:'
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 确定Nagios在关闭时是否将当前状态保存到文件中（⇒**`state_retention_file`**），并在启动时再次读取这些状态。默认值：
- en: '**`retain_state_information=0`**'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: '**`retain_state_information=0`**'
- en: '**`retention_update_interval`**'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: '**`retention_update_interval`**'
- en: 'Every how many minutes should Nagios store current state information in the
    ⇒**`state_retention_file`**? With a value of **`0`**, the system only saves information
    if Nagios is shut down. The parameter ⇒**`retain_state_information`** must be
    enabled for this. Default value:'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios应每隔多少分钟将当前状态信息存储在⇒**`state_retention_file`**中？如果值为**`0`**，则系统仅在Nagios关闭时保存信息。必须启用参数⇒**`retain_state_information`**。默认值：
- en: '**`retention_update_interval=60`**'
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: '**`retention_update_interval=60`**'
- en: '**`service_check_timeout`**'
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_check_timeout`**'
- en: 'Number of seconds after which Nagios aborts a service check if this has not
    returned a result by then. Default value:'
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios在多少秒后如果服务检查尚未返回结果，则终止服务检查。默认值：
- en: '**`service_check_timeout=60`**'
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_check_timeout=60`**'
- en: '**`service_freshness_check_interval`**'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_freshness_check_interval`**'
- en: 'Interval between two freshness checks in seconds. Default value:'
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 两次新鲜度检查之间的秒数间隔。默认值：
- en: '**`service_freshness_check_interval=60`**'
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_freshness_check_interval=60`**'
- en: '**`service_inter_check_delay_method`**'
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_inter_check_delay_method`**'
- en: 'Controls how Nagios processes service checks after a restart. An "intelligent"
    procedure should prevent them from all starting at the same time, to avoid putting
    an unnecessary load on the server. Possible values are **s** (*smart*, automatic
    distribution), **n** (*no*, start all tests simultaneously!), **d** (*dumb*, one
    second interval between checks), as well as an explicitly specified interval in
    seconds, in the form *x. xx*. Default value:'
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 控制Nagios在重启后如何处理服务检查。一个“智能”的过程应该防止它们同时开始，以避免对服务器造成不必要的负载。可能的值是 **s** (*smart*，自动分配)，**n**
    (*no*，同时启动所有测试！)，**d** (*dumb*，检查之间间隔一秒)，以及以秒为单位的显式指定间隔，形式为 *x. xx*。默认值：
- en: '**`service_inter_check_delay_method=s`**'
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_inter_check_delay_method=s`**'
- en: '**`service_interleave_factor`**'
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_interleave_factor`**'
- en: 'Prevents the checks accumulating for a specific host from being executed at
    the same time (⇒**`max_concurrent_checks`**, 598), through Nagios distributing
    the planned checks for all hosts "intelligently" over a period of time. Possible
    values are **s** (*smart*, automatic distribution) or an integer larger than 0\.
    With a value of **`1`**, Nagios does not carry out any distribution, with a value
    of **4**, Nagios initially plans every fourth service check (that is, from the
    amount of intended checks, the 1st, 5th, 9th, etc.), then the following number
    (that is, the 2nd, 6th, 10th, etc.), and so on. The test sequence is shown by
    the **Service Detail** item in the Web interface. In case of doubt, the default
    value can be left as it is:'
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 通过 Nagios 在一段时间内“智能”地分配所有主机的计划检查，防止针对特定主机的检查同时执行（⇒**`max_concurrent_checks`**,
    598），可能的值是 **s** (*smart*，自动分配) 或大于 0 的整数。值为 **`1`** 时，Nagios 不执行任何分配；值为 **4**
    时，Nagios 首先计划每第四个服务检查（即从预期检查的数量中，第 1 个、第 5 个、第 9 个等），然后是下一个数字（即第 2 个、第 6 个、第 10
    个等），依此类推。测试序列通过 Web 界面中的 **服务详情** 项显示。如有疑问，默认值可以保持不变：
- en: '**`service_interleave_factor=s`**'
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_interleave_factor=s`**'
- en: '**`service_perfdata_command`**'
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_perfdata_command`**'
- en: The Nagios command object that is run after each service check to process performance
    data. A requirement for this is that ⇒**`process_performance_data`** must be set.
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 在每次服务检查后运行的 Nagios 命令对象，用于处理性能数据。此要求是必须设置 ⇒**`process_performance_data`**。
- en: 'The parameter is used if the performance data is to be processed without a
    template ([19.1 Processing Plugin Performance Data with Nagios](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 Processing Plugin Performance Data with Nagios"), page 404). Example (no
    default value set):'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 当性能数据需要在不使用模板的情况下进行处理时使用此参数 ([19.1 使用 Nagios 处理插件性能数据](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 使用 Nagios 处理插件性能数据"), 第 404 页)。示例（未设置默认值）：
- en: '**`service_perfdata_command=process-service-perfdata`**'
  id: totrans-336
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_perfdata_command=process-service-perfdata`**'
- en: '**`service_perfdata_file`**'
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_perfdata_file`**'
- en: 'Path to the file or named pipe through which Nagios forwards performance data
    from service checks via a template mechanism to an external program. This only
    works if ⇒**`process_performance_data`** is set. More on processing performance
    data in [Chapter 19](../Text/ch19.html "Chapter 19. Graphic Display of Performance
    Data"), page 403\. Example (no default value set):'
  id: totrans-338
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 通过模板机制将服务检查的性能数据转发到外部程序的文件或命名管道的路径。这仅在 ⇒**`process_performance_data`**
    设置的情况下有效。关于处理性能数据的更多信息请参阅 [第 19 章](../Text/ch19.html "第 19 章. 性能数据的图形显示"), 第 403
    页。示例（未设置默认值）：
- en: '**`service_perfdata_file=/tmp/service-perfdata`**'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_perfdata_file=/tmp/service-perfdata`**'
- en: '**`service_perfdata_file_mode`**'
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_perfdata_file_mode`**'
- en: 'Defines the mode in which data is passed on to ⇒**`service_perfdata_file`**.
    Possible values are **a** (*append* to a normal file), **w** (*write* to a new
    file) and in Nagios 3.0 **p** as well (*non-blocking write*), which is useful
    for pipes. Example (no default value):'
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 定义了数据传递到 ⇒**`service_perfdata_file`** 的模式。可能的值有 **a** (*append* 向正常文件追加)，**w**
    (*write* 写入新文件) 以及在 Nagios 3.0 中 **p** 也有效 (*非阻塞写入*)，这对于管道很有用。示例（无默认值）：
- en: '**`service_perfdata_file_mode=a`**'
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_perfdata_file_mode=a`**'
- en: '**`service_perfdata_file_processing_command`**'
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_perfdata_file_processing_command`**'
- en: 'A command object that is executed after Nagios has passed on service performance
    data to the ⇒**`service_perfdata_file`**. The parameter is optional and is only
    used together with the template mechanism. As long as programs that further process
    the data, such as **`perf2rrd`** ([19.3 Preparing Performance Data for Evaluation
    with Perf2rrd](../Text/ch19s03.html "19.3 Preparing Performance Data for Evaluation
    with Perf2rrd"), page 415), include their own service that permanently reads out
    the **`service_perfdata_file`**, you can manage without defining a command for
    reading out. See also [Chapter 19](../Text/ch19.html "Chapter 19. Graphic Display
    of Performance Data"), page 403\. Example (no default value set):'
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios在将服务性能数据传递给⇒**`service_perfdata_file`**之后执行的一个命令对象。该参数是可选的，并且仅与模板机制一起使用。只要进一步处理数据的程序，如**`perf2rrd`**
    ([19.3 使用Perf2rrd准备性能数据以供评估](../Text/ch19s03.html "19.3 使用Perf2rrd准备性能数据以供评估")，第415页)，包含它们自己的永久读取**`service_perfdata_file`**的服务，您就可以不定义读取命令来管理。另见[第19章](../Text/ch19.html
    "第19章. 性能数据的图形显示")，第403页。示例（未设置默认值）：
- en: '**`service_perfdata_file_processing_command=process-service-perfdata-file`**'
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_perfdata_file_processing_command=process-service-perfdata-file`**'
- en: '**`service_perfdata_file_processing_interval`**'
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_perfdata_file_processing_interval`**'
- en: 'Interval in seconds in which the command defined in ⇒**`service_perfdata_file_processing_command`**
    is periodically run. Setting the value **`0`** ensures that it is never used.
    Example (no default value set):'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 在多长时间间隔内，定义在⇒**`service_perfdata_file_processing_command`**中的命令会定期运行。将值设置为**`0`**确保它永远不会被使用。示例（未设置默认值）：
- en: '**`service_perfdata_file_processing_interval=0`**'
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_perfdata_file_processing_interval=0`**'
- en: '**`service_perfdata_file_template`**'
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_perfdata_file_template`**'
- en: 'The output format for performance data; Nagios macros and format details such
    as **`\t`** (tabulator) or **`\n`** (linefeed) are substituted in the output.
    See also [19.1 Processing Plugin Performance Data with Nagios](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 Processing Plugin Performance Data with Nagios"), page 404\. Example (no
    default value set):'
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 性能数据的输出格式；Nagios宏和格式细节，如**`\t`**（制表符）或**`\n`**（换行符），在输出中替换。另见[19.1 使用Nagios处理插件性能数据](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 使用Nagios处理插件性能数据")，第404页。示例（未设置默认值）：
- en: '**`service_perfdata_file_template=$TIMET$\t$HOSTNAME$\t$SERVICEDESC$\t$SERVICEEXECUTIONTIME$\t$SERVICELATENCY$\t$SERVICEOUTPUT$\t$SERVICEPERFDATA$`**'
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_perfdata_file_template=$TIMET$\t$HOSTNAME$\t$SERVICEDESC$\t$SERVICEEXECUTIONTIME$\t$SERVICELATENCY$\t$SERVICEOUTPUT$\t$SERVICEPERFDATA$`**'
- en: '**`service_reaper_frequency`** (Nagios 2.x)'
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_reaper_frequency`** (Nagios 2.x)'
- en: 'Every how many seconds should Nagios process accumulated service test results?
    Default value:'
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios每隔多少秒处理累积的服务测试结果？默认值：
- en: '**`service_reaper_frequency=10`**'
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_reaper_frequency=10`**'
- en: In Nagios 3.0 the corresponding parameter is called ⇒check_result_reaper_frequency
    and influences not only service checks but also host checks.
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 在Nagios 3.0中，相应的参数被称为⇒check_result_reaper_frequency，它不仅影响服务检查，还影响主机检查。
- en: '**`sleep_time`**'
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: '**`sleep_time`**'
- en: 'Pause in seconds for which Nagios waits before searching again in the scheduling
    queue for checks to be performed. Default value:'
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios在再次在调度队列中搜索要执行的检查之前等待的秒数。默认值：
- en: '**`sleep_time=0.5`**'
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: '**`sleep_time=0.5`**'
- en: '**`state_retention_file`**'
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: '**`state_retention_file`**'
- en: 'The file in which Nagios stores status information on shutdown, and from which
    the information is read in again when Nagios is started. This is used only if
    the ⇒**`retain_state_information`** parameter is set. Default value:'
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios在关闭时存储状态信息的文件，以及Nagios启动时再次从中读取信息的位置。这仅在⇒**`retain_state_information`**参数设置时使用。默认值：
- en: '**`state_retention_file=/var/nagios/retention.dat`**'
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: '**`state_retention_file=/var/nagios/retention.dat`**'
- en: '**`status_file`**'
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: '**`status_file`**'
- en: 'Path to the file in which Nagios saves all current status values and from which
    the Web interface retrieves them. Default value:'
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios保存所有当前状态值的文件路径，以及Web界面从中检索它们的位置。默认值：
- en: '**`status_file=/var/nagios/status.dat`**'
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: '**`status_file=/var/nagios/status.dat`**'
- en: '**`status_update_interval`**'
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: '**`status_update_interval`**'
- en: 'At what interval should Nagios store status values in the file⇒**`status_file`**?
    If ⇒**`aggregate_status_updates`** is not set, the system ignores this parameter
    and immediately writes the status values to this file (not recommended). Default
    value:'
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios应该在什么间隔内将状态值存储在文件⇒**`status_file`**中？如果⇒**`aggregate_status_updates`**未设置，系统将忽略此参数，并立即将状态值写入此文件（不推荐）。默认值：
- en: '**`status_update_interval=60`**'
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: '**`status_update_interval=60`**'
- en: '**`temp_file`**'
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: '**`temp_file`**'
- en: 'Path to a temporary file that Nagios uses if necessary, and deletes each time
    when it no longer requires it. Default value:'
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios在必要时使用的临时文件路径，并在不再需要时删除。默认值：
- en: '**`temp_file=/var/nagios/tempfile`**'
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: '**`temp_file=/var/nagios/tempfile`**'
- en: '**`temp_path`** (Nagios 3.0)'
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: '**`temp_path`** (Nagios 3.0)'
- en: 'A directory in which Nagios may store temporary files. The directory should
    be emptied regularly. Example:'
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios可能存储临时文件的目录。该目录应定期清空。示例：
- en: '**`temp_path=/tmp`**'
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: '**`temp_path=/tmp`**'
- en: '**`translate_passive_host_checks`**(Nagios 3.0)'
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: '**`translate_passive_host_checks`**(Nagios 3.0)'
- en: 'Determines whether Nagios should translate the result of a passive host check
    from a topological perspective to DOWN or UNREACHABLE. The default is "no":'
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: 确定Nagios是否应从拓扑角度将被动主机检查的结果转换为DOWN或UNREACHABLE。默认为“否”：
- en: '**`translate_passive_host_checks=0`**'
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: '**`translate_passive_host_checks=0`**'
- en: Passive host checks are often used in distributed environments, and Nagios does
    not have all the information concerning the topological structure of these environments.
    In that case, the default makes sense. The value 1 switches the translation to
    DOWN or UNREACHABLE.
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 被动主机检查通常用于分布式环境，而Nagios没有关于这些环境拓扑结构的所有信息。在这种情况下，默认值是合理的。值1将转换设置为DOWN或UNREACHABLE。
- en: '**`use_aggressive_host_checking`**'
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_aggressive_host_checking`**'
- en: 'Nagios makes a number of assumptions in deciding whether unreachable hosts
    are DOWN or UNREACHABLE. If this parameter is set to the value **1**, Nagios is
    very particular in the host check and in some circumstances may perform considerably
    more individual checks. Although the result will be more precise, this puts quite
    a strain on the system. This parameter should only be set if there are problems
    in detecting failed hosts. Default:'
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios在决定不可达的主机是DOWN还是UNREACHABLE时做出了一些假设。如果此参数设置为值**1**，Nagios在主机检查上非常严格，在某些情况下可能会执行相当多的单独检查。虽然结果将更精确，但这会给系统带来相当大的压力。此参数仅在检测失败的主机存在问题时应设置。默认：
- en: '**`use_aggressive_host_checking=0`**'
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_aggressive_host_checking=0`**'
- en: '**`use_embedded_perl_implicitly`** (Nagios 3.0)'
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_embedded_perl_implicitly`** (Nagios 3.0)'
- en: Automatically runs all Perl scripts in the Embedded Perl Interpreter, provided
    the script itself does not contain an explicit instruction to avoid the Interpreter.
    More on this in [G.2 Using ePN](../Text/apgs02.html "G.2 Using ePN"), page 672.
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: 自动运行嵌入式Perl解释器中的所有Perl脚本，前提是脚本本身不包含避免解释器的显式指令。更多关于此内容请参阅[G.2 使用ePN](../Text/apgs02.html
    "G.2 使用ePN")，第672页。
- en: '**`use_large_installation_tweaks`**(Nagios 3.0)'
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_large_installation_tweaks`**(Nagios 3.0)'
- en: 'This parameter covers a number of settings intended to improve the performance
    of Nagios in large environments. The following entry switches it on:'
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数包含多个设置，旨在提高Nagios在大环境中的性能。以下条目将其启用：
- en: '**`use_large_installation_tweaks=1`**'
  id: totrans-385
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_large_installation_tweaks=1`**'
- en: There is more on this in [F.2.7 Optimizing large Nagios environments](../Text/apfs03.html#optimizing_large_nagios_environmen
    "F.2.7 Optimizing large Nagios environments"), page 667.
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: 更多关于此内容请参阅[F.2.7 优化大型Nagios环境](../Text/apfs03.html#optimizing_large_nagios_environmen
    "F.2.7 优化大型Nagios环境")，第667页。
- en: '**`use_regexp_matching`**'
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_regexp_matching`**'
- en: 'Defines whether the wildcards **`*`** (any character) and **`?`** (a single
    character) are allowed in object definitions. If you want to work with regular
    expressions, ⇒**`use_true_regexp_matching`** must be used. Default value:'
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: 定义是否允许在对象定义中使用通配符**`*`**（任意字符）和**`?`**（单个字符）。如果您想使用正则表达式，则必须使用**`use_true_regexp_matching`**。默认值：
- en: '**`use_regexp_matching=0`**'
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_regexp_matching=0`**'
- en: '**`use_retained_program_state`**'
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_retained_program_state`**'
- en: 'Should changes to the parameters ⇒**`enable_notifications`**, ⇒**`en-able_flap_detection`**,
    ⇒**`enable_event_handlers`**, ⇒**`execute_service_checks`** and ⇒**`accept_passive_service_checks`**
    on the Web interface survive a Nagios restart? Only works if ⇒**`retain_status_informationis`**
    enabled. Default value:'
  id: totrans-391
  prefs: []
  type: TYPE_NORMAL
  zh: Web界面上参数的更改（**`enable_notifications`**、**`enable_flap_detection`**、**`enable_event_handlers`**、**`execute_service_checks`**
    和 **`accept_passive_service_checks`**）在Nagios重启后是否仍然有效？只有当**`retain_status_informationis`**启用时才有效。默认值：
- en: '**`use_retained_program_state=1`**'
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_retained_program_state=1`**'
- en: '**`use_retained_scheduling_info`**'
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_retained_scheduling_info`**'
- en: 'Should Nagios save current scheduling information on shutdown so it can read
    it in again when it restarts? You can temporarily disable the parameter if you
    are adding a large number of tests; otherwise it is sensible to keep it enabled.
    Default value:'
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios在关闭时是否应保存当前调度信息，以便在重启时再次读取？如果您正在添加大量测试，则可以暂时禁用此参数；否则，保持启用是明智的。默认值：
- en: '**`use_retained_scheduling_info=1`**'
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_retained_scheduling_info=1`**'
- en: '**`use_syslog`**'
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_syslog`**'
- en: 'Ensures logging of all Nagios activities in the syslog. Default value:'
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
  zh: 确保所有Nagios活动都记录在syslog中。默认值：
- en: '**`use_syslog=1`**'
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_syslog=1`**'
- en: '**`use_timezone`** (Nagios 3.0)'
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_timezone`** (Nagios 3.0)'
- en: 'Explicitly sets a time zone for Nagios. Normally, Nagios uses the time zone
    of the system on which it is running. This parameter is only required if several
    instances for different time zones are being run on one host. Example:'
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: 明确为Nagios设置时区。通常，Nagios使用其运行系统的时区。如果在一个主机上运行多个不同时区的实例，则需要此参数。示例：
- en: '**`use_timezone=Europe/Berlin`**'
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_timezone=Europe/Berlin`**'
- en: The relative path for the desired zone information file is specified, usually
    in **`/usr/lib/zoneinfo`** or **`/usr/share/zoneinfo`**.
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
  zh: 指定所需区域信息文件的相对路径，通常在**`/usr/lib/zoneinfo`**或**`/usr/share/zoneinfo`**。
- en: '**`use_true_regexp_matching`**'
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_true_regexp_matching`**'
- en: 'In contrast to ⇒**`use_regexp_matching`**, allows the use of real regular expressions
    in accordance with the POSIX standard.^([[304](#ftn.APP-A-FN-1)]) Default value:'
  id: totrans-404
  prefs: []
  type: TYPE_NORMAL
  zh: 与⇒**`use_regexp_matching`**相比，允许根据POSIX标准使用真正的正则表达式.^([[304](#ftn.APP-A-FN-1)])
    默认值：
- en: '**`use_true_regexp_matching=0`**'
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_true_regexp_matching=0`**'
- en: '* * *'
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[304](#APP-A-FN-1)]) See man 7 regex.
  id: totrans-407
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[304](#APP-A-FN-1)]) 请参阅man 7 regex。
- en: A.2 CGI Configuration in **`cgi.cfg`**
  id: totrans-408
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: A.2 **`cgi.cfg`**中的CGI配置
- en: A.2.1 Authentication parameters
  id: totrans-409
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.2.1 认证参数
- en: 'Through the contact and the contact group, Nagios allocates responsibilities
    to users from which permissions for the Web interface can likewise be inferred:
    each contact may normally only see those hosts and services for which he is also
    responsible. This is why the name of the Web login must match the contact name.'
  id: totrans-410
  prefs: []
  type: TYPE_NORMAL
  zh: 通过联系人和联系组，Nagios将责任分配给用户，从而可以推断出Web界面的权限：每个联系人通常只能看到他负责的主机和服务的那些。这就是为什么Web登录名必须与联系人名称匹配。
- en: The parameters listed below work around this concept to some extent. They are
    not intended to solve problems, however, caused by contact and Web user names
    not matching.
  id: totrans-411
  prefs: []
  type: TYPE_NORMAL
  zh: 下列参数在一定程度上解决了这一概念。然而，它们并不旨在解决由联系人和Web用户名不匹配引起的问题。
- en: cmduse_authentication
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: cmduse_authentication
- en: Determines whether you normally need to log in to the Web interface. Like the
    user name, the contact name is always used; how you store passwords is described
    in [1.5 Configuration of the Web Interface](../Text/ch01s05.html "1.5 Configuration
    of the Web Interface"), page 47.
  id: totrans-413
  prefs: []
  type: TYPE_NORMAL
  zh: 确定是否通常需要登录到Web界面。与用户名一样，联系名称始终使用；密码的存储方式请参阅[1.5 Web界面配置](../Text/ch01s05.html
    "1.5 Web界面配置")，第47页。
- en: 'In general you should never permit this authentication, but if you do, you
    should make sure that the interface for external commands ([13.1 The Interface
    for External Commands](../Text/ch13.html#the_interface_for_external_commands "13.1
    The Interface for External Commands"), page 292) is switched off completely. Default:'
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
  zh: 通常你不应该允许这种认证，但如果确实需要，你应该确保外部命令接口（[13.1 外部命令接口](../Text/ch13.html#the_interface_for_external_commands
    "13.1 外部命令接口")，第292页）完全关闭。默认：
- en: '**`use_authentication=1`**'
  id: totrans-415
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_authentication=1`**'
- en: '**`authorized_for_all_host_commands`**'
  id: totrans-416
  prefs: []
  type: TYPE_NORMAL
  zh: '**`authorized_for_all_host_commands`**'
- en: 'Allows the users specified here to run commands through the Web interface for
    all hosts, without them belonging to the appropriate contact group. Example (no
    default value set):'
  id: totrans-417
  prefs: []
  type: TYPE_NORMAL
  zh: 允许指定的用户通过Web界面为所有主机运行命令，而无需属于适当的联系组。示例（未设置默认值）：
- en: '**`authorized_for_all_host_commands=nagiosadmin`**'
  id: totrans-418
  prefs: []
  type: TYPE_NORMAL
  zh: '**`authorized_for_all_host_commands=nagiosadmin`**'
- en: '**`authorized_for_all_hosts`**'
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: '**`authorized_for_all_hosts`**'
- en: 'Allows the users specified here to look at all host information, irrespective
    of their actual responsibility Example (no default value set):'
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: 允许指定的用户查看所有主机信息，无论他们的实际责任如何。示例（未设置默认值）：
- en: '**`authorized_for_all_hosts=nagiosadmin.guest`**'
  id: totrans-421
  prefs: []
  type: TYPE_NORMAL
  zh: '**`authorized_for_all_hosts=nagiosadmin.guest`**'
- en: '**`authorized_for_all_service_commands`**'
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: '**`authorized_for_all_service_commands`**'
- en: 'Allows the users defined here to run commands for all services via the Web
    interface, independently of membership of contact groups. Example (no default
    value set):'
  id: totrans-423
  prefs: []
  type: TYPE_NORMAL
  zh: 允许在此定义的用户通过Web界面运行所有服务的命令，而不管他们是否属于联系组。示例（未设置默认值）：
- en: '**`authorized_for_all_service_commands=nagiosadmin`**'
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
  zh: '**`authorized_for_all_service_commands=nagiosadmin`**'
- en: '**`authorized_for_all_services`**'
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
  zh: '**`authorized_for_all_services`**'
- en: 'Allows the users specified to view all service information, irrespective of
    their own permissions. Example (no default value set):'
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: 允许指定的用户查看所有服务信息，无论他们的权限如何。示例（未设置默认值）：
- en: '**`authorized_for_all_services=nagiosadmin,guest`**'
  id: totrans-427
  prefs: []
  type: TYPE_NORMAL
  zh: '**`authorized_for_all_services=nagiosadmin,guest`**'
- en: '**`authorized_for_configuration_information`**'
  id: totrans-428
  prefs: []
  type: TYPE_NORMAL
  zh: '**`authorized_for_configuration_information`**'
- en: 'Enables the users specified to view all configuration data via the Web interface.
    This should be reserved for the Nagios administrators. Example (no default value
    set):'
  id: totrans-429
  prefs: []
  type: TYPE_NORMAL
  zh: 启用指定的用户通过 Web 界面查看所有配置数据。这应该仅限于 Nagios 管理员。示例（未设置默认值）：
- en: '**`authorized_for_configuration_information=nagiosadmin,jdoe`**'
  id: totrans-430
  prefs: []
  type: TYPE_NORMAL
  zh: '**`authorized_for_configuration_information=nagiosadmin,jdoe`**'
- en: '**`authorized_for_system_commands`**'
  id: totrans-431
  prefs: []
  type: TYPE_NORMAL
  zh: '**`authorized_for_system_commands`**'
- en: 'Allows the specified users to shut down or restart Nagios via the Web interface.
    Normally, nobody has this authorization. Example (no default value set):'
  id: totrans-432
  prefs: []
  type: TYPE_NORMAL
  zh: 允许指定的用户通过 Web 界面关闭或重启 Nagios。通常情况下，没有人拥有这种授权。示例（未设置默认值）：
- en: '**`authorized_for_system_commands=nagiosadmin`**'
  id: totrans-433
  prefs: []
  type: TYPE_NORMAL
  zh: '**`authorized_for_system_information=nagiosadmin,theboss,jdoe`**'
- en: '**`authorized_for_system_information`**'
  id: totrans-434
  prefs: []
  type: TYPE_NORMAL
  zh: '**`authorized_for_system_information`**'
- en: 'Allows the specified users to view Nagios process information. Normally, nobody
    may do this. Example (no default value set):'
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
  zh: 允许指定的用户通过 Web 界面查看 Nagios 进程信息。通常情况下，没有人可以这样做。示例（未设置默认值）：
- en: '**`authorized_for_system_information=nagiosadmin,theboss,jdoe`**'
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: '**`authorized_for_system_information=nagiosadmin,theboss,jdoe`**'
- en: A.2.2 Other Parameters
  id: totrans-437
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: A.2.2 其他参数
- en: '**`action_url_target`** (Nagios 3.0)'
  id: totrans-438
  prefs: []
  type: TYPE_NORMAL
  zh: '**`action_url_target`** (Nagios 3.0)'
- en: 'Sets the HTML tag **`target`** for an action URL (see [16.4.1 Extended host
    information](../Text/ch16s04.html#extended_host_information "16.4.1 Extended host
    information")). The default is **`blank`**, which opens a new window:'
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: 设置操作 URL 的 HTML 标签 **`target`**（见 [16.4.1 扩展主机信息](../Text/ch16s04.html#extended_host_information
    "16.4.1 扩展主机信息")）。默认值为 **`blank`**，将在新窗口中打开：
- en: '**`action_url_target=blank`**'
  id: totrans-440
  prefs: []
  type: TYPE_NORMAL
  zh: '**`action_url_target=blank`**'
- en: '**`default_statusmap_layout`**'
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: '**`default_statusmap_layout`**'
- en: 'Defines the layout for the status map. Possible values are **0** (coordinates
    defined through a **hostextinfo** object), **1** (the user must move by mouse
    click from one layer to the next one), **2** (compressed tree—somewhat confusing,
    because branches cut across each other in the picture), **3** (balanced tree,
    the branches are displayed so that there are no crossovers in the graphic—clearer,
    but requires much space), **4** (circular representation, with Nagios at the center:
    hosts that can be reached directly^([[305](#ftn.APP-A-FN-2)]) are shown in the
    inner circle, while on other circles are located those hosts that can be reached
    from hosts already entered in the graphic), **5** (circular, like **4**; the area
    around the host is marked in color—gray for OK, red for DOWN or UNREACHABLE; Figure
    A.27 in [16.2.4 The most important things at a glance: tac.cgi](../Text/ch16s02.html#the_most_important_things_at_a_glance_c
    "16.2.4 The most important things at a glance: tac.cgi") shows an example), and
    **6** (circular; the hosts are shown as balloons). The settings can also be changed
    in the Web interface without the need to adjust the configuration file each time,
    which makes it easier to try things out. Example:'
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
  zh: 定义状态图的布局。可能的值是 **0**（通过 **hostextinfo** 对象定义坐标），**1**（用户必须通过鼠标点击从一个层移动到下一个层），**2**（压缩树——在图片中分支交错，有些令人困惑），**3**（平衡树，分支显示得没有交错——更清晰，但需要更多空间），**4**（圆形表示，Nagios
    位于中心：可以直接到达的主机显示在内圈，而其他圈中则位于可以从图形中已进入的主机到达的主机），**5**（与 **4** 类似的圆形；主机周围用颜色标记——正常为灰色，DOWN
    或 UNREACHABLE 为红色；[16.2.4 一目了然的最重要事项：tac.cgi](../Text/ch16s02.html#the_most_important_things_at_a_glance_c
    "16.2.4 一目了然的最重要事项：tac.cgi") 中的图 A.27 展示了一个示例），以及 **6**（圆形；主机显示为气球）。这些设置也可以在 Web
    界面中更改，无需每次都调整配置文件，这使得尝试新事物变得更加容易。示例：
- en: '**`default_statusmap_layout=5`**'
  id: totrans-443
  prefs: []
  type: TYPE_NORMAL
  zh: '**`default_statusmap_layout=5`**'
- en: '**`default_statuswrl_layout`**'
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
  zh: '**`default_statuswrl_layout`**'
- en: 'Determines the layout for the VRML representation of the status page through
    **`statuswrl.cgi`**. Possible values are **0**, **2**, **3**, and **4**; the corresponding
    appearance is based on the values of the same name for ⇒**`default_statusmap_layout`**.
    Example:'
  id: totrans-445
  prefs: []
  type: TYPE_NORMAL
  zh: 通过 **`statuswrl.cgi`** 确定状态页面的 VRML 表示布局。可能的值是 **0**、**2**、**3** 和 **4**；相应的外观基于同名参数
    **`default_statusmap_layout`** 的值。示例：
- en: '**`default_statuswrl_layout=4`**'
  id: totrans-446
  prefs: []
  type: TYPE_NORMAL
  zh: '**`default_statuswrl_layout=4`**'
- en: '**`default_user_name`**'
  id: totrans-447
  prefs: []
  type: TYPE_NORMAL
  zh: '**`default_user_name`**'
- en: 'Name of a guest user who may use the Web pages without authentication. You
    should only use this parameter if the Web server is protected from unauthorized
    access, and you should look closely at what permissions this user is allocated
    through the contact groups. Example (no default value set):'
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
  zh: 可能使用网页而不进行身份验证的访客用户名。您应该只在 Web 服务器受到未经授权的访问保护时使用此参数，并且应仔细查看此用户通过联系组分配的权限。示例（未设置默认值）：
- en: '**`default_user_name=guest`**'
  id: totrans-449
  prefs: []
  type: TYPE_NORMAL
  zh: '**`default_user_name=guest`**'
- en: '**`enable_splunk_integration`** (Nagios 3.0)'
  id: totrans-450
  prefs: []
  type: TYPE_NORMAL
  zh: '**`enable_splunk_integration`** (Nagios 3.0)'
- en: Activates integration of the Splunk tool, a search engine for log files.^([[306](#ftn.APP-A-FN-3)])
  id: totrans-451
  prefs: []
  type: TYPE_NORMAL
  zh: 激活 Splunk 工具的集成，Splunk 是日志文件的搜索引擎.^([[306](#ftn.APP-A-FN-3)])
- en: '**`escape_html_tags`** (Nagios 3.0)'
  id: totrans-452
  prefs: []
  type: TYPE_NORMAL
  zh: '**`escape_html_tags`** (Nagios 3.0)'
- en: 'The value **1** disables HTML formatting in the plugin output:'
  id: totrans-453
  prefs: []
  type: TYPE_NORMAL
  zh: 值 **1** 禁用插件输出中的 HTML 格式：
- en: '**`escape_html_tags=1`**'
  id: totrans-454
  prefs: []
  type: TYPE_NORMAL
  zh: '**`escape_html_tags=1`**'
- en: Corresponding formatting thus has no effect. The default is **`0`**, which causes
    HTML formatting to be passed on.
  id: totrans-455
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，相应的格式化没有效果。默认是 **`0`**，这会导致 HTML 格式传递。
- en: '**`lock_author_name`** (Nagios 3.0)'
  id: totrans-456
  prefs: []
  type: TYPE_NORMAL
  zh: '**`lock_author_name`** (Nagios 3.0)'
- en: For various CGI actions, such as setting acknowledgements, an author name is
    specified. With the setting
  id: totrans-457
  prefs: []
  type: TYPE_NORMAL
  zh: 对于各种 CGI 动作，例如设置确认，指定作者名称。使用设置
- en: '**`lock_author_names=1`**'
  id: totrans-458
  prefs: []
  type: TYPE_NORMAL
  zh: '**`lock_author_names=1`**'
- en: this can no longer be changed (the default is the user logged in).
  id: totrans-459
  prefs: []
  type: TYPE_NORMAL
  zh: 这不能再更改（默认是登录用户）。
- en: '**`main_config_file`**'
  id: totrans-460
  prefs: []
  type: TYPE_NORMAL
  zh: '**`main_config_file`**'
- en: 'The Nagios main configuration file. Default value:'
  id: totrans-461
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 主配置文件。默认值：
- en: '**`main_config_file=/etc/nagios/nagios.cfg`**'
  id: totrans-462
  prefs: []
  type: TYPE_NORMAL
  zh: '**`main_config_file=/etc/nagios/nagios.cfg`**'
- en: '**`notes_url_target`** (Nagios 3.0)'
  id: totrans-463
  prefs: []
  type: TYPE_NORMAL
  zh: '**`notes_url_target`** (Nagios 3.0)'
- en: 'Sets the HTML tag **`target`** for Notes URLs (see [16.4.1 Extended host information](../Text/ch16s04.html#extended_host_information
    "16.4.1 Extended host information")). The default is **`blank`**, which opens
    a new window:'
  id: totrans-464
  prefs: []
  type: TYPE_NORMAL
  zh: 设置 Notes URLs 的 HTML 标签 **`target`**（见 [16.4.1 扩展主机信息](../Text/ch16s04.html#extended_host_information
    "16.4.1 扩展主机信息")）。默认是 **`blank`**，它将在新窗口中打开：
- en: '**`notes_url_target=blank`**'
  id: totrans-465
  prefs: []
  type: TYPE_NORMAL
  zh: '**`notes_url_target=blank`**'
- en: '**`physical_html_path`**'
  id: totrans-466
  prefs: []
  type: TYPE_NORMAL
  zh: '**`physical_html_path`**'
- en: 'Path in the file system that leads to the Nagios directory for documentation
    and images. See also ⇒**`url_html_path`**. Default value:'
  id: totrans-467
  prefs: []
  type: TYPE_NORMAL
  zh: 文件系统中指向 Nagios 文档和图像目录的路径。另见 ⇒**`url_html_path`**。默认值：
- en: '**`physical_html_path=/usr/local/nagios/share`**'
  id: totrans-468
  prefs: []
  type: TYPE_NORMAL
  zh: '**`physical_html_path=/usr/local/nagios/share`**'
- en: '**`refresh_rate`**'
  id: totrans-469
  prefs: []
  type: TYPE_NORMAL
  zh: '**`refresh_rate`**'
- en: 'Specifies at what intervals the Web page is automatically updated. Default
    value:'
  id: totrans-470
  prefs: []
  type: TYPE_NORMAL
  zh: 指定网页自动更新的间隔。默认值：
- en: '**`refresh_rate=60`**'
  id: totrans-471
  prefs: []
  type: TYPE_NORMAL
  zh: '**`refresh_rate=60`**'
- en: '**`splunk_url`** (Nagios 3.0)'
  id: totrans-472
  prefs: []
  type: TYPE_NORMAL
  zh: '**`splunk_url`** (Nagios 3.0)'
- en: 'Defines the URL for the Splunk search engine. Example:'
  id: totrans-473
  prefs: []
  type: TYPE_NORMAL
  zh: 定义 Splunk 搜索引擎的 URL。示例：
- en: '**`splunk_url=http://127.0.0.1:8000/`**'
  id: totrans-474
  prefs: []
  type: TYPE_NORMAL
  zh: '**`splunk_url=http://127.0.0.1:8000/`**'
- en: The parameter ⇒**`enable_splunk_integration`** ([A.2.2 Other Parameters](../Text/apas02.html#other_parameters
    "A.2.2 Other Parameters")) must also be enabled for this.
  id: totrans-475
  prefs: []
  type: TYPE_NORMAL
  zh: 参数 ⇒**`enable_splunk_integration`** ([A.2.2 其他参数](../Text/apas02.html#other_parameters
    "A.2.2 其他参数")) 也必须启用。
- en: '**`statusmap_background_image`**'
  id: totrans-476
  prefs: []
  type: TYPE_NORMAL
  zh: '**`statusmap_background_image`**'
- en: 'The background image for the status map display. Example (no default value
    set):'
  id: totrans-477
  prefs: []
  type: TYPE_NORMAL
  zh: 状态图显示的背景图像。示例（未设置默认值）：
- en: '**`statusmap_background_image=smbackground.gd2`**'
  id: totrans-478
  prefs: []
  type: TYPE_NORMAL
  zh: '**`statusmap_background_image=smbackground.gd2`**'
- en: '**`statuswrl_include`**'
  id: totrans-479
  prefs: []
  type: TYPE_NORMAL
  zh: '**`statuswrl_include`**'
- en: 'A file with its own VRML objects used in the VRML representation. The path
    is specified relative to ⇒**`html_physical_path`**. Example (no default value
    set):'
  id: totrans-480
  prefs: []
  type: TYPE_NORMAL
  zh: 用于 VRML 表示的具有自己的 VRML 对象的文件。路径相对于 ⇒**`html_physical_path`** 指定。示例（未设置默认值）：
- en: '**`statuswrl_include=myworld.wrl`**'
  id: totrans-481
  prefs: []
  type: TYPE_NORMAL
  zh: '**`statuswrl_include=myworld.wrl`**'
- en: '**`url_html_path`**'
  id: totrans-482
  prefs: []
  type: TYPE_NORMAL
  zh: '**`url_html_path`**'
- en: 'The logical path to the Nagios documents and images from the point of view
    of the browser, starting from the document root of the Web server. If you use
    this path in a URL, you will be taken to the Nagios start page. Default value:'
  id: totrans-483
  prefs: []
  type: TYPE_NORMAL
  zh: 从浏览器的角度来看，Nagios 文档和图像的逻辑路径，从 Web 服务器文档根开始。如果您在此路径中使用 URL，您将被带到 Nagios 启动页面。默认值：
- en: '**`url_html_path=/nagios`**'
  id: totrans-484
  prefs: []
  type: TYPE_NORMAL
  zh: '**`url_html_path=/nagios`**'
- en: '**``**`use_pending_states`** (Nagios 3.0)``**'
  id: totrans-485
  prefs: []
  type: TYPE_NORMAL
  zh: '**``**`use_pending_states`** (Nagios 3.0)``**'
- en: How should hosts and services be displayed in the Web interface if no check
    has yet taken place for this?
  id: totrans-486
  prefs: []
  type: TYPE_NORMAL
  zh: 如果尚未对此进行检查，主机和服务应在 Web 界面中如何显示？
- en: '**`use_pending_states=1`**'
  id: totrans-487
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_pending_states=1`**'
- en: shows unchecked hosts and services with the state **`PENDING`**; the value **`0`**
    can be left as it is.
  id: totrans-488
  prefs: []
  type: TYPE_NORMAL
  zh: 显示未检查的主机和服务的状态 **`PENDING`**；值 **`0`** 可以保持不变。
- en: '* * *'
  id: totrans-489
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[305](#APP-A-FN-2)]) That is, without the "diversion" via parents.
  id: totrans-490
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[305](#APP-A-FN-2)]) 即，不通过父级进行“转移”。
- en: ^([[306](#APP-A-FN-3)]) [http://www.splunk.com/](http://www.splunk.com/)
  id: totrans-491
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[306](#APP-A-FN-3)]) [http://www.splunk.com/](http://www.splunk.com/)
- en: 'Appendix B. Rapidly Alternating States: Flapping'
  id: totrans-492
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 附录 B. 快速交替状态：翼尖
- en: If the state of a host or service keeps on changing over and over, Nagios inundates
    the administrator with a flood of problem and recovery messages, which can not
    only be very irritating but also distract the administrator's attention from other,
    perhaps more urgent problems.
  id: totrans-493
  prefs: []
  type: TYPE_NORMAL
  zh: 如果主机或服务的状态不断变化，Nagios会向管理员发送大量的问题和恢复消息，这不仅会非常令人烦恼，还会分散管理员对其他可能更紧急问题的注意力。
- en: With a special mechanism, Nagios quickly recognizes alternating states and can
    inform the administrator of these selectively. The Nagios documentation refers
    to such alternating states as *state flapping* and to their detection as *flap
    detection*.
  id: totrans-494
  prefs: []
  type: TYPE_NORMAL
  zh: 通过一种特殊机制，Nagios可以快速识别交替状态，并可以选择性地通知管理员。Nagios文档将此类交替状态称为*状态翼尖*，并将它们的检测称为*翼尖检测*。
- en: 'Whether these alternating states involve hosts or services has no influence
    on the detection mechanism itself. The differences are more to be found in the
    nature of host and service checks: Nagios carries out service checks periodically,
    and therefore regularly. In this way the system continuously receives new information
    on the current status. Regular host checks only make sense from Nagios 3.0 onward
    (see [H.7 A New Logic for Host Checks](../Text/aphs07.html "H.7 A New Logic for
    Host Checks") from page 689). In Nagios 2.x, host checks generally take place
    only if needed, so Nagios has to obtain the appropriate information in other ways.'
  id: totrans-495
  prefs: []
  type: TYPE_NORMAL
  zh: 这些交替状态涉及主机或服务本身对检测机制没有影响。差异更多地体现在主机和服务检查的性质上：Nagios定期执行服务检查，因此定期。这样，系统可以持续接收有关当前状态的新信息。从Nagios
    3.0开始，定期主机检查才有意义（参见第689页的[H.7 主机检查的新逻辑](../Text/aphs07.html "H.7 主机检查的新逻辑")）。在Nagios
    2.x中，主机检查通常仅在需要时进行，因此Nagios必须通过其他方式获取适当的信息。
- en: B.1 Flap Detection with Services
  id: totrans-496
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: B.1 使用服务进行翼尖检测
- en: To detect alternating states you need a complete list of all states that occurred
    during the last service checks. For this purpose Nagios stores the last 21 test
    results for each service and then overwrites the oldest value in each case in
    the memory. In these 21 states, a maximum of 20 changes can occur.
  id: totrans-497
  prefs: []
  type: TYPE_NORMAL
  zh: 要检测交替状态，你需要一个包含上次服务检查期间发生的所有状态的完整列表。为此，Nagios为每个服务存储最后21个测试结果，然后在内存中覆盖每个情况下的最老值。在这21个状态中，最多可以发生20次变化。
- en: '[Figure B-1](../Text/apb.html#nagios_saves_the_last_21_states_to_detec "Figure B-1. Nagios
    saves the last 21 states to detect frequently alternating states. This service
    changed its state twelve times") shows an example. The x-axis numbers the possible
    alternating states in each case from 1 to 20, and the heads of the arrow indicate
    alternating states that have actually occurred.'
  id: totrans-498
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 B-1](../Text/apb.html#nagios_saves_the_last_21_states_to_detec "图 B-1. Nagios保存最后21个状态以检测频繁交替状态。此服务状态变化了十二次")展示了示例。x轴为每个情况中可能的交替状态编号，从1到20，箭头的头部指示实际发生的交替状态。'
- en: '![Nagios saves the last 21 states to detect frequently alternating states.
    This service changed its state twelve times](../Images/tagoreillycom20081104nostarchimages224014.png.jpg)'
  id: totrans-499
  prefs: []
  type: TYPE_IMG
  zh: '![Nagios保存最后21个状态以检测频繁交替状态。此服务状态变化了十二次](../Images/tagoreillycom20081104nostarchimages224014.png.jpg)'
- en: Figure B-1. Nagios saves the last 21 states to detect frequently alternating
    states. This service changed its state twelve times
  id: totrans-500
  prefs: []
  type: TYPE_NORMAL
  zh: 图 B-1. Nagios保存最后21个状态以检测频繁交替状态。此服务状态变化了十二次
- en: In the period specified, the state of the system shown changed 12 times out
    of a possible 20, which as a percentage is 60 percent. At 0 percent, not one alternation
    state has taken place, and 100% means that the service really was in a different
    state every time it was recorded.
  id: totrans-501
  prefs: []
  type: TYPE_NORMAL
  zh: 在指定期间，系统状态的变化次数为20次中的12次，百分比是60%。0%表示没有发生任何交替状态，而100%则意味着服务每次记录时都处于不同的状态。
- en: When determining the percentage value, Nagios assigns less significance to older
    changes of state than to more recent ones. Accordingly it weights the oldest change
    in state at **`1`** in [Figure B-1](../Text/apb.html#nagios_saves_the_last_21_states_to_detec
    "Figure B-1. Nagios saves the last 21 states to detect frequently alternating
    states. This service changed its state twelve times") with 0.8, and the most recent
    at **`20`** with 1.2\. From left to right, the factor increases each time by approx.
    0.02,^([[307](#ftn.APP-B-FN-1)]) resulting in a linear progression.
  id: totrans-502
  prefs: []
  type: TYPE_NORMAL
  zh: 在确定百分比值时，Nagios将较旧的状态变化赋予的权重低于较新的变化。因此，在[图B-1](../Text/apb.html#nagios_saves_the_last_21_states_to_detec
    "图B-1. Nagios保存最后21个状态以检测频繁交替的状态。此服务状态改变了12次")中，它将最旧的状态变化权重设置为**`1`**，而最近的权重设置为**`20`**，权重每次增加约0.02，^([[307](#ftn.APP-B-FN-1)])从而实现线性增长。
- en: 'This weighting does not have any major effects on the end result in this example:
    for [Figure B-1](../Text/apb.html#nagios_saves_the_last_21_states_to_detec "Figure B-1. Nagios
    saves the last 21 states to detect frequently alternating states. This service
    changed its state twelve times"), this results in 62.21 percent (instead of 60),
    a slight shift, since the state in the second half changed more often. If there
    was only a single change of state at **`20`**, the weighting would have the most
    effect: instead of 5% (that is, one change out of a possible 20) this would result
    in 5 * 1.2 = 6 percent.'
  id: totrans-503
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，这种加权对最终结果没有太大影响：对于[图B-1](../Text/apb.html#nagios_saves_the_last_21_states_to_detec
    "图B-1. Nagios保存最后21个状态以检测频繁交替的状态。此服务状态改变了12次")，这导致62.21%（而不是60%），略有变化，因为第二半部分的状态变化更频繁。如果只有一次状态变化在**`20`**，加权将产生最大影响：5%（即可能的20次变化中的一次）将变为5
    * 1.2 = 6%。
- en: 'Using threshold values which can be defined—two for services, two for hosts—Nagios
    defines whether a service or host is "flapping". Both the upper and lower limits
    are specified as percentages. If the detected change state exceeds the upper threshold,
    Nagios categorizes the service as *flapping*. This has consequences: Nagios logs
    the event in the log file, adds a nonpermanent comment,^([[308](#ftn.APP-B-FN-2)])
    and stops any notifications concerning this from being sent.'
  id: totrans-504
  prefs: []
  type: TYPE_NORMAL
  zh: 使用可以定义的阈值值——两个用于服务，两个用于主机——Nagios定义了服务或主机是否处于“折叠”状态。上下限都指定为百分比。如果检测到的状态变化超过上限，Nagios将该服务分类为*折叠*。这会产生一些后果：Nagios将事件记录在日志文件中，添加一个非永久性注释，^([[308](#ftn.APP-B-FN-2)])并停止发送与此相关的任何通知。
- en: If the percentage value falls below the lower limit, the system undoes this
    step; that is, the comment disappears, notifications are sent again, and the result
    also appears in the log file.
  id: totrans-505
  prefs: []
  type: TYPE_NORMAL
  zh: 如果百分比值低于下限，系统将撤销此步骤；也就是说，注释将消失，将再次发送通知，结果也将出现在日志文件中。
- en: B.1.1 Nagios configuration
  id: totrans-506
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: B.1.1 Nagios配置
- en: 'Flap detection is configured at two locations: in the central configuration
    file and in the definition of the service object. In **`nagios.cfg`** the feature
    is switched on generally with the parameter **`enable_flap_detection`**, and global
    limit values are also defined here, which will always apply if nothing else is
    defined for the service in question:'
  id: totrans-507
  prefs: []
  type: TYPE_NORMAL
  zh: 折叠检测配置在两个位置：在中央配置文件中以及服务对象定义中。在**`nagios.cfg`**中，该功能通常通过参数**`enable_flap_detection`**来开启，并且在这里也定义了全局限制值，如果没有为该服务定义其他内容，这些值将始终适用：
- en: '[PRE0]'
  id: totrans-508
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The value **`1`** set here for **`enable_flap_detection`** enables flap detection,
    and **`0`** switches it off.
  id: totrans-509
  prefs: []
  type: TYPE_NORMAL
  zh: 这里为**`enable_flap_detection`**设置的值**`1`**启用了折叠检测，而**`0`**将其关闭。
- en: The lower limit **`low_service_flap_threshold`** lies at 5 percent in this case,
    the upper **`high_service_flap_threshold`** limit at 20\. This means that Nagios
    categorizes a service as flapping if the history saved detects at least five changes
    in state (more than four out of a possible 20).^([[309](#ftn.APP-B-FN-3)]) The
    lower five percent limit corresponds to one change in state. To drop below this,
    all 21 states must be identical.^([[310](#ftn.APP-B-FN-4)])
  id: totrans-510
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，下限**`low_service_flap_threshold`**位于5%，上限**`high_service_flap_threshold`**限制在20%。这意味着如果保存的历史记录检测到至少五个状态变化（超过可能的20个中的四个），Nagios将服务分类为折叠。下限的五个百分比相当于一个状态变化。要低于这个值，所有21个状态都必须相同.^([[309](#ftn.APP-B-FN-3)])要低于这个下限，所有21个状态都必须相同.^([[310](#ftn.APP-B-FN-4)])
- en: 'In the definition of a service object, you have another chance to decide whether
    flap detection is desired in this case. You also have an option to specify threshold
    values for this service that differ from the global settings:'
  id: totrans-511
  prefs: []
  type: TYPE_NORMAL
  zh: 在服务对象的定义中，您还有机会决定在这种情况下是否需要启用翻动检测。您还可以选择为此服务指定与全局设置不同的阈值值：
- en: '[PRE1]'
  id: totrans-512
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The value **`1`** in **`flap_detection_enabled`** switches on the feature for
    this service, and **`0`** (the default) switches it off. The two limit values
    **`low_flap_threshold`** and **`high_flap_threshold`** define the limit values
    that override the globally defined values. If they are set to **`0`**, or are
    omitted, the global thresholds will apply.
  id: totrans-513
  prefs: []
  type: TYPE_NORMAL
  zh: '**`flap_detection_enabled`**中的值**`1`**启用此服务的功能，而**`0`**（默认值）则关闭它。两个限制值**`low_flap_threshold`**和**`high_flap_threshold`**定义了覆盖全局定义值的限制值。如果它们设置为**`0`**或被省略，则应用全局阈值。'
- en: Starting with Nagios 3.0, the parameter **`flap_detection_options`** enables
    only specified states to be taken into account when detecting changes in states.
    Possible values are **`o`** (OK), **`w`** (WARNING), **`c`** (CRITICAL), and **`u`**
    (UNKNOWN). The default is
  id: totrans-514
  prefs: []
  type: TYPE_NORMAL
  zh: 从Nagios 3.0版本开始，参数**`flap_detection_options`**允许在检测状态变化时仅考虑指定的状态。可能的值有**`o`**（OK）、**`w`**（WARNING）、**`c`**（CRITICAL）和**`u`**（UNKNOWN）。默认值为
- en: '[PRE2]'
  id: totrans-515
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: If the values are restricted to **`w`**, **`c`**, only WARNING and CRITICAL
    play a role in detection; the other states are ignored. Nagios 3.0 also saves
    states when flap detection is switched off globally and introduces a corresponding
    new message type. More on this in [H.4 Rapidly Changing States](../Text/aphs04.html
    "H.4 Rapidly Changing States") from page 687.
  id: totrans-516
  prefs: []
  type: TYPE_NORMAL
  zh: 如果值限制为**`w`**、**`c`**，则只有WARNING和CRITICAL在检测中起作用；其他状态被忽略。Nagios 3.0在全局关闭翻动检测时也保存状态，并引入了相应的新消息类型。更多内容请参阅第687页的[H.4快速变化状态](../Text/aphs04.html
    "H.4快速变化状态")。
- en: B.1.2 The history memory and the chronological progression of the changes in
    state
  id: totrans-517
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: B.1.2 历史内存和状态变化的时序进展
- en: 'Since the history only saves hard states and soft recovery, the sections on
    the x-axis cannot be allocated so easily on a chronological basis, because the
    intervals between possible changes of state are not equal. Assuming that the service
    object has the following definitions:'
  id: totrans-518
  prefs: []
  type: TYPE_NORMAL
  zh: 由于历史记录只保存硬状态和软恢复，x轴上的部分不能如此容易地按时间顺序分配，因为可能的状态变化之间的间隔并不相等。假设服务对象具有以下定义：
- en: '[PRE3]'
  id: totrans-519
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Nagios checks the service two more times after a change in state from OK to
    WARNING has taken place, before the service changes to the hard state WARNING
    (state 1 in [Figure B-1](../Text/apb.html#nagios_saves_the_last_21_states_to_detec
    "Figure B-1. Nagios saves the last 21 states to detect frequently alternating
    states. This service changed its state twelve times") in page 612). Since the
    last check, which returned OK, a total of seven minutes^([[311](#ftn.APP-B-FN-5)])
    has elapsed, since the two soft states after five and six minutes are not included
    in the history.
  id: totrans-520
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios在服务从OK状态变为WARNING状态后，在服务变为硬状态WARNING（[图B-1](../Text/apb.html#nagios_saves_the_last_21_states_to_detec
    "图B-1. Nagios保存最后21个状态以检测频繁交替的状态。此服务状态改变了十二次")中的状态1）之前再次检查服务两次。从最后一次返回OK的检查以来，总共过去了七分钟^([[311](#ftn.APP-B-FN-5)])，因为五分钟和六分钟后的两个软状态不包括在历史记录中。
- en: If the next service check, as in [Figure B-1](../Text/apb.html#nagios_saves_the_last_21_states_to_detec
    "Figure B-1. Nagios saves the last 21 states to detect frequently alternating
    states. This service changed its state twelve times"), again detects a WARNING
    (i.e., the state does not change this time), then only five minutes elapse this
    time between states 1 and 2\. The x-axis therefore only illustrates time in a
    linear form in exceptional circumstances—if no change of state occurs, for example.
  id: totrans-521
  prefs: []
  type: TYPE_NORMAL
  zh: 如果下一个服务检查，如[图B-1](../Text/apb.html#nagios_saves_the_last_21_states_to_detec
    "图B-1. Nagios保存最后21个状态以检测频繁交替的状态。此服务状态改变了十二次")所示，再次检测到WARNING（即这次状态没有变化），那么状态1和2之间这次只间隔了五分钟。因此，x轴因此只在特殊情况下以线性形式表示时间——例如，如果没有状态变化发生。
- en: B.1.3 Representation in the Web interface
  id: totrans-522
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: B.1.3 Web界面中的表示
- en: 'Services that Nagios categorizes as flapping are visible in the Web interface
    at three points: in the summaries generated by **`tac.cgi`** ([16.2.4 The most
    important things at a glance: tac.cgi](../Text/ch16s02.html#the_most_important_things_at_a_glance_c
    "16.2.4 The most important things at a glance: tac.cgi"), page 345) and **`status.cgi`**
    ([16.2.1 Variations in status display: status.cgi](../Text/ch16s02.html#variations_in_status_display_colon_stat
    "16.2.1 Variations in status display: status.cgi"), page 334), as well as on the
    information page created by **`extinfo.cgi`** ([16.2.2 Additional information
    and control center: extinfo.cgi](../Text/ch16s02.html#additional_information_and_control_cent
    "16.2.2 Additional information and control center: extinfo.cgi"), page 339).'
  id: totrans-523
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 将其归类为摆动状态的服务在 Web 界面中有三个可见点：由 **`tac.cgi`** 生成的摘要（[16.2.4 一目了然的最重要事项：tac.cgi](../Text/ch16s02.html#the_most_important_things_at_a_glance_c
    "16.2.4 一目了然的最重要事项：tac.cgi")，第 345 页）和 **`status.cgi`**（[16.2.1 状态显示的变体：status.cgi](../Text/ch16s02.html#variations_in_status_display_colon_stat
    "16.2.1 状态显示的变体：status.cgi")，第 334 页），以及由 **`extinfo.cgi`** 创建的信息页面（[16.2.2 附加信息和控制中心：extinfo.cgi](../Text/ch16s02.html#additional_information_and_control_cent
    "16.2.2 附加信息和控制中心：extinfo.cgi")，第 339 页）。
- en: 'The quickest way to get there is through **`tac.cgi`** ([Figure B-2](../Text/apb.html#tac.cgi_notes_changing_states_in_section
    "Figure B-2. tac.cgi notes changing states in section Monitoring Features")):
    a link in the **`Monitoring Features`** section marked by **`x Services Flapping`**
    takes you to the status overview of services which continually change their state.
    The status overview shown in [Figure B-3](../Text/apb.html#animated_horizontal_bars_denote_flapping
    "Figure B-3. Animated horizontal bars denote flapping states") can also be opened
    directly with **`status.cgi?host=all&style=detail&serviceprops=1024`**.'
  id: totrans-524
  prefs: []
  type: TYPE_NORMAL
  zh: 最快到达那里的方式是通过 **`tac.cgi`** ([图 B-2](../Text/apb.html#tac.cgi_notes_changing_states_in_section
    "图 B-2. `tac.cgi` 在 `监控功能` 部分记录状态变化"))：在 **`监控功能`** 部分标记为 **`x Services Flapping`**
    的链接会将你带到不断改变状态的服务状态概述。[图 B-3](../Text/apb.html#animated_horizontal_bars_denote_flapping
    "图 B-3. 动画水平条表示摆动状态") 中显示的状态概述也可以直接通过 **`status.cgi?host=all&style=detail&serviceprops=1024`**
    打开。
- en: '**`serviceprops=1024`** describes all services that Nagios categorizes as flapping.
    **`style=detail`** provides a detailed view (in contrast to **`overview`**, as
    can be seen in Figure B.10 in [16.2 An Overview of the Individual CGI Programs](../Text/ch16s02.html
    "16.2 An Overview of the Individual CGI Programs")), and **`host=all`** includes
    all hosts.'
  id: totrans-525
  prefs: []
  type: TYPE_NORMAL
  zh: '**`serviceprops=1024`** 描述了 Nagios 将其归类为摆动状态的所有服务。**`style=detail`** 提供详细视图（与
    **`overview`** 相比，如图 B.10 所示 [16.2 个体 CGI 程序概述](../Text/ch16s02.html "16.2 个体
    CGI 程序概述"))，而 **`host=all`** 包含所有主机。'
- en: '![tac.cgi notes changing states in section Monitoring Features](../Images/tagoreillycom20081104nostarchimages224016.png.jpg)'
  id: totrans-526
  prefs: []
  type: TYPE_IMG
  zh: '![tac.cgi 在 `监控功能` 部分记录状态变化](../Images/tagoreillycom20081104nostarchimages224016.png.jpg)'
- en: Figure B-2. `tac.cgi` notes changing states in section `Monitoring Features`
  id: totrans-527
  prefs: []
  type: TYPE_NORMAL
  zh: 图 B-2. `tac.cgi` 在 `监控功能` 部分记录状态变化
- en: In the status view in [Figure B-3](../Text/apb.html#animated_horizontal_bars_denote_flapping
    "Figure B-3. Animated horizontal bars denote flapping states"), a white field
    with several horizontal gray bars moving to and fro reveal that a flapping service
    is involved. At the same time a white speech bubble denotes the existence of a
    comment on this (generated automatically by Nagios).
  id: totrans-528
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [图 B-3](../Text/apb.html#animated_horizontal_bars_denote_flapping "图 B-3.
    动画水平条表示摆动状态") 的状态视图中，一个带有几个水平灰色条移动来去的白色区域揭示了一个摆动服务正在涉及。同时，一个白色话泡表示对此（由 Nagios
    自动生成）的评论存在。
- en: '![Animated horizontal bars denote flapping states](../Images/tagoreillycom20081104nostarchimages224018.png.jpg)'
  id: totrans-529
  prefs: []
  type: TYPE_IMG
  zh: '![动画水平条表示摆动状态](../Images/tagoreillycom20081104nostarchimages224018.png.jpg)'
- en: Figure B-3. Animated horizontal bars denote flapping states
  id: totrans-530
  prefs: []
  type: TYPE_NORMAL
  zh: 图 B-3. 动画水平条表示摆动状态
- en: 'If you click in the status view on the flapping icon next to the service in
    question, **`extinfo.cgi`** generates additional information on the service ([Figure B-4](../Text/apb.html#percent_state_change_colon_reveals_how_o
    "Figure B-4. Percent State Change: reveals how often the hard state changed, as
    a percentage")), showing the changes in state in percent next to the flapping
    category, depicted by a red bar labeled with **YES**.'
  id: totrans-531
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在状态视图中点击问题服务旁边的摆动图标，**`extinfo.cgi`** 会生成关于该服务的附加信息（[图 B-4](../Text/apb.html#percent_state_change_colon_reveals_how_o
    "图 B-4. 状态变化百分比：揭示硬状态如何频繁变化，以百分比表示"))，显示在摆动类别旁边的状态变化百分比，由标记为 **YES** 的红色条表示。
- en: '![Percent State Change: reveals how often the hard state changed, as a percentage](../Images/tagoreillycom20081104nostarchimages224020.png.jpg)'
  id: totrans-532
  prefs: []
  type: TYPE_IMG
  zh: '![百分比状态变化：揭示了硬状态变化的频率，以百分比表示](../Images/tagoreillycom20081104nostarchimages224020.png.jpg)'
- en: 'Figure B-4. `Percent State Change`: reveals how often the hard state changed,
    as a percentage'
  id: totrans-533
  prefs: []
  type: TYPE_NORMAL
  zh: 图B-4. `百分比状态变化`：揭示了硬状态变化的频率，以百分比表示
- en: The page also contains the nonpermanent comment generated by Nagios ([Figure B-5](../Text/apb.html#with_this_comment_comma_nagios_categoriz
    "Figure B-5. With this comment, Nagios categorizes a service as flapping")), which
    points out that the sending of messages has been stopped until the status of the
    service becomes stable again. It disappears, therefore, when Nagios is restarted.
  id: totrans-534
  prefs: []
  type: TYPE_NORMAL
  zh: 页面还包含由Nagios生成的非永久性注释（[图B-5](../Text/apb.html#with_this_comment_comma_nagios_categoriz
    "图B-5. 带有此注释，Nagios将服务分类为翻页"))，指出消息发送已停止，直到服务状态再次稳定。因此，当Nagios重启时，它就会消失。
- en: '![With this comment, Nagios categorizes a service as flapping](../Images/tagoreillycom20081104nostarchimages224022.png.jpg)'
  id: totrans-535
  prefs: []
  type: TYPE_IMG
  zh: '![带有此注释，Nagios将服务分类为翻页](../Images/tagoreillycom20081104nostarchimages224022.png.jpg)'
- en: Figure B-5. With this comment, Nagios categorizes a service as flapping
  id: totrans-536
  prefs: []
  type: TYPE_NORMAL
  zh: 图B-5. 带有此注释，Nagios将服务分类为翻页
- en: '* * *'
  id: totrans-537
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[307](#APP-B-FN-1)]) (1.2–0.8)/19=0.0211
  id: totrans-538
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[307](#APP-B-FN-1)]) (1.2–0.8)/19=0.0211
- en: ^([[308](#APP-B-FN-2)]) Nonpermanent comments disappear after the monitoring
    system is restarted, but permanent ones remain.
  id: totrans-539
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[308](#APP-B-FN-2)]) 在监控系统重启后，非永久性注释会消失，但永久性注释会保留。
- en: ^([[309](#APP-B-FN-3)]) If the changes in state took place recently, the weighting
    would ensure that four changes in state would already be enough to exceed the
    20 percent limit.
  id: totrans-540
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[309](#APP-B-FN-3)]) 如果状态变化最近发生，加权将确保四个状态变化就已经足够超过20%的限制。
- en: ^([[310](#APP-B-FN-4)]) If a single change of state takes place in the first
    half, the weighting results in a value of less than 5 percent.
  id: totrans-541
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[310](#APP-B-FN-4)]) 如果在第一半部分发生单个状态变化，加权结果将小于5%。
- en: ^([[311](#APP-B-FN-5)]) 5 5+2*1=7
  id: totrans-542
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[311](#APP-B-FN-5)]) 5 5+2*1=7
- en: B.2 Flap Detection for Hosts
  id: totrans-543
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: B.2 主机的翻页检测
- en: 'Nagios tries to detect changing states of a host in two ways: in the host check
    itself (either in the context of the active check from Nagios 3.0 or in on-demand
    checks), and also if a service check for a host was performed, the last flap detection
    of which took place some time ago. When Nagios next performs a service check to
    detect a changing state is determined by the average value for all service check
    intervals.'
  id: totrans-544
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios试图以两种方式检测主机的状态变化：在主机检查本身（无论是Nagios 3.0的主动检查还是按需检查）以及如果为主机执行了服务检查，并且最近进行了翻页检测。Nagios下一次执行服务检查以检测状态变化是由所有服务检查间隔的平均值确定的。
- en: Regular host checks are also not necessary from Nagios 3.0 onward, and recent
    versions of Nagios manage perfectly well without them. For reasons of performance,
    they really should be avoided in Nagios 2.x ([4.2 On-Demand Host Checks vs. Periodic
    Reachability Tests](../Text/ch04s02.html "4.2 On-Demand Host Checks vs. Periodic
    Reachability Tests"), page 95). By making use of a trick to perform service checks
    only when required, Nagios compensates for the fact that regular host check results
    are missing. If at least one service check returns an OK, Nagios concludes from
    this that the host is also reachable and is in an OK state. The results of flap
    detection are stored by Nagios in the history.
  id: totrans-545
  prefs: []
  type: TYPE_NORMAL
  zh: 从Nagios 3.0开始，常规主机检查也不再是必要的，Nagios的最新版本完全可以不使用它们。出于性能考虑，在Nagios 2.x中应尽量避免它们（[4.2
    需求主机检查与周期性可达性测试](../Text/ch04s02.html "4.2 需求主机检查与周期性可达性测试"), 第95页）。通过使用一种技巧仅在需要时执行服务检查，Nagios弥补了常规主机检查结果缺失的事实。如果至少有一个服务检查返回OK，Nagios就会据此得出主机也是可达的并且处于OK状态的结论。翻页检测的结果由Nagios存储在历史记录中。
- en: The same flap detection mechanism is used for hosts as for services. So the
    difference is only in how Nagios determines the corresponding data basis.
  id: totrans-546
  prefs: []
  type: TYPE_NORMAL
  zh: 同样的翻页检测机制在主机和服务中都使用。所以区别仅在于Nagios如何确定对应的数据基础。
- en: 'Whether flap detection is desired for hosts is revealed by the central configuration
    file **`nagios.cfg`** and the definition of the host objects. The global parameter
    **`enable_flap_detection`**, which applies equally to hosts and services, must
    be set to **`1`**:'
  id: totrans-547
  prefs: []
  type: TYPE_NORMAL
  zh: 是否需要为主机启用翻页检测由中央配置文件**`nagios.cfg`**和主机对象定义揭示。全局参数**`enable_flap_detection`**，适用于主机和服务，必须设置为**`1`**：
- en: '[PRE4]'
  id: totrans-548
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The threshold parameters for hosts include **`host`** in their names, but they
    have the same effect as their **`service`** equivalents.^([[312](#ftn.APP-B-FN-6)])
  id: totrans-549
  prefs: []
  type: TYPE_NORMAL
  zh: 主机阈值参数的名称中包含**`host`**，但它们与它们的**`service`**等效参数具有相同的效果.^([[312](#ftn.APP-B-FN-6)])
- en: 'For the host object itself, detection is switched on with **`flap_detection_enabled`**
    **`1`** and off with **`0`**:'
  id: totrans-550
  prefs: []
  type: TYPE_NORMAL
  zh: 对于主机对象本身，检测通过**`flap_detection_enabled`** **`1`**开启，通过**`0`**关闭：
- en: '[PRE5]'
  id: totrans-551
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The optional parameters **`low_flap_threshold`** and **`high_flap_threshold`**
    allow for host-specific thresholds. If these are omitted, the global threshold
    values are used.
  id: totrans-552
  prefs: []
  type: TYPE_NORMAL
  zh: 可选参数**`low_flap_threshold`**和**`high_flap_threshold`**允许为主机设置特定的阈值。如果省略这些参数，则使用全局阈值值。
- en: As for service checks, Nagios from 3.0 onward also has the additional **`flap_detection_options`**
    parameter here. Possible values in the host definition are **`o`** (OK), **`d`**
    (DOWN), and **`u`** (UNREACHABLE). Only the states specified for the parameter
    are used in flap detection, and if this parameter is not given, then all possible
    states are used.
  id: totrans-553
  prefs: []
  type: TYPE_NORMAL
  zh: 对于服务检查，从3.0版本开始，Nagios在这里还增加了额外的**`flap_detection_options`**参数。在主机定义中可能的值有**`o`**（正常），**`d`**（已关闭）和**`u`**（不可达）。只有为参数指定的状态用于翻页检测，如果没有提供此参数，则使用所有可能的状态。
- en: '* * *'
  id: totrans-554
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[312](#APP-B-FN-6)]) See [B.1 Flap Detection with Services](../Text/apb.html#flap_detection_with_services
    "B.1 Flap Detection with Services").
  id: totrans-555
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[312](#APP-B-FN-6)])参见[B.1 使用服务进行翻页检测](../Text/apb.html#flap_detection_with_services
    "B.1 使用服务进行翻页检测")。
- en: Appendix C. Event Handlers
  id: totrans-556
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 附录C. 事件处理器
- en: If the state of a host or service alternates between OK and error states, you
    can use an *event handler* to run any programs you want. You can make use of this
    if a service fails, for example, and you want Nagios to try and restart it. This
    provides an opportunity to solve minor problems without the administrator needing
    to intervene.
  id: totrans-557
  prefs: []
  type: TYPE_NORMAL
  zh: 如果主机或服务的状态在正常和错误状态之间交替，你可以使用*事件处理器*运行任何你想要的程序。例如，如果服务失败，你可以利用这个功能让Nagios尝试重新启动它。这为解决小问题提供了机会，而不需要管理员干预。
- en: 'Use of the *event handlers* is not just restricted to self-healing, however:
    with an appropriate script you can just as easily log current values or the event
    itself in a database. But there are more suitable methods for doing this, described
    in [19.1 Processing Plugin Performance Data with Nagios](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 Processing Plugin Performance Data with Nagios"), page 404\. A failed printer
    service serves as an example here of using an event handler for self-healing.
    In this example the printer service **`lpd`** is used, but this method can be
    applied in general to any service for which a start-stop script is available.'
  id: totrans-558
  prefs: []
  type: TYPE_NORMAL
  zh: '*事件处理器*的使用不仅限于自我修复：使用适当的脚本，你同样可以轻松地将当前值或事件本身记录到数据库中。但在[19.1 使用Nagios处理插件性能数据](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 使用Nagios处理插件性能数据")中描述了更合适的方法，第404页。这里以失败的打印机服务为例，说明了使用事件处理器进行自我修复。在这个例子中使用了打印机服务**`lpd`**，但这种方法可以普遍应用于任何有启动停止脚本的服务的场景。'
- en: C.1 Execution Times for the Event Handler
  id: totrans-559
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: C.1 事件处理器的执行时间
- en: 'The following parameters in the service definition ensure that Nagios tests
    the service under normal circumstances every five minutes, but in cases of error,
    every two minutes:'
  id: totrans-560
  prefs: []
  type: TYPE_NORMAL
  zh: 在服务定义中以下参数确保Nagios每五分钟在正常情况下测试一次服务，但在出错情况下，每两分钟测试一次：
- en: '[PRE6]'
  id: totrans-561
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: An error state becomes hard after four tests leading to the same result.
  id: totrans-562
  prefs: []
  type: TYPE_NORMAL
  zh: 经过四次测试后，如果结果相同，错误状态会变得难以处理。
- en: '![When does Nagios run the event handler?](../Images/tagoreillycom20081104nostarchimages224024.png.jpg)'
  id: totrans-563
  prefs: []
  type: TYPE_IMG
  zh: '![Nagios何时运行事件处理器？](../Images/tagoreillycom20081104nostarchimages224024.png.jpg)'
- en: Figure C-1. When does Nagios run the event handler?
  id: totrans-564
  prefs: []
  type: TYPE_NORMAL
  zh: 图C-1. Nagios何时运行事件处理器？
- en: '[Figure C-1](../Text/apc.html#when_does_nagios_run_the_event_handler_q "Figure C-1. When
    does Nagios run the event handler?") shows an example of the change of the **`lpd`**
    service from an OK state to CRITICAL, and back again. After 10 minutes test No.
    2 detects that the service is no longer available. The soft state that results
    causes Nagios to examine **`lpd`** more closely at two-minute intervals (checks
    No. 3, 4, and 5). Test No. 5 returns a CRITICAL for the fourth time, causing Nagios
    to categorize this as a hard state and to go back to the normal, five-minute test
    interval. In check No. 7 the service is functioning again, and the state changes
    from CRITICAL to OK (for hard state, see [4.3 States of Hosts and Services](../Text/ch04s03.html
    "4.3 States of Hosts and Services"), page 96.).'
  id: totrans-565
  prefs: []
  type: TYPE_NORMAL
  zh: '[图C-1](../Text/apc.html#when_does_nagios_run_the_event_handler_q "图C-1. 当Nagios运行事件处理器时？")展示了**`lpd`**服务从OK状态变为CRITICAL，然后再变回OK状态的示例。10分钟后，测试编号2检测到服务不再可用。由此产生的软状态导致Nagios以两分钟的间隔更仔细地检查**`lpd`**（检查编号3、4和5）。测试编号5第四次返回CRITICAL，导致Nagios将其分类为硬状态，并回到正常的五分钟测试间隔。在检查编号7中，服务再次运行，状态从CRITICAL变为OK（关于主机的状态，见[4.3
    主机和服务的状态](../Text/ch04s03.html "4.3 主机和服务的状态")，第96页）。'
- en: Event handlers are carried out by Nagios for soft error states (in checks No.
    2, 3, 4), the first time a hard error state occurs (in check No. 5), and in the
    resetting of the OK state after an error (irrespective of whether this is a hard
    or soft recovery).
  id: totrans-566
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios对软错误状态（在检查编号2、3、4中）执行事件处理器，首次出现硬错误状态（在检查编号5中），以及在错误后的OK状态重置（无论这是硬恢复还是软恢复）。
- en: Since hard error states lead to the administrator being notified, it is recommended
    that the repair attempt is moved to the time of the soft error states. If it succeeds
    at this point in time, the administrator is spared these minor details. Ideally
    the service will be running again before a user even notices that it has failed.
  id: totrans-567
  prefs: []
  type: TYPE_NORMAL
  zh: 由于硬错误状态会导致管理员被通知，因此建议将修复尝试移至软错误状态的时间。如果在此时刻成功，管理员就可以避免这些细节。理想情况下，在用户甚至注意到服务失败之前，服务应该已经重新启动。
- en: The fact that Nagios only executes the event handler when a hard error state
    first occurs prevents periodic attempts at repair that do not lead to the desired
    result after all (if the attempt had succeeded, no further hard error states would
    have occurred).
  id: totrans-568
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios仅在首次出现硬错误状态时才执行事件处理器，这防止了进行修复尝试，但这些尝试最终并没有达到预期的结果（如果尝试成功，则不会发生进一步的硬错误状态）。
- en: C.2 Defining the Event Handler in the Service Definition
  id: totrans-569
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: C.2 在服务定义中定义事件处理器
- en: Although Nagios executes the event handler for every event, it does not have
    to carry out an action each time. In our example the handler should attempt to
    reset the printer service on the third soft error state (check No. 4) and on the
    first hard error state (check No. 5), and do nothing at all the other execution
    times.
  id: totrans-570
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然Nagios为每个事件执行事件处理器，但它不必每次都执行操作。在我们的例子中，处理器应该在第三次软错误状态（检查编号4）和第一次硬错误状态（检查编号5）时尝试重置打印机服务，在其他执行时间则什么都不做。
- en: 'For this purpose, the service definition is modified as follows:'
  id: totrans-571
  prefs: []
  type: TYPE_NORMAL
  zh: 为了这个目的，服务定义被修改如下：
- en: '[PRE7]'
  id: totrans-572
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The **`event_handler`** parameter expects a Nagios command object that will
    run the handler script:'
  id: totrans-573
  prefs: []
  type: TYPE_NORMAL
  zh: '**`event_handler`**参数期望一个Nagios命令对象，该对象将运行处理器脚本：'
- en: '[PRE8]'
  id: totrans-574
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'In this example it is called **`restart-lpd.sh`** and is not located directly
    in the Nagios plugin directory **`/usr/local/nagios/libexec`**, but in a subdirectory
    called **`/usr/local/nagios/libexec/eventhandler`**, as suggested in the Nagios
    documentation. The script receives three macros as parameters: the current state
    **`$SERVICESTATE$`** (OK, WARNING, CRITICAL, or UNKNOWN), the state type **`$SERVICESTATETYPE$`**
    (**`SOFT`**, or **`HARD`**), and the number of the current (possibly repeated)
    attempt **`$SERVICE ATTEMPT$`** (e.g., **`3`** if the test is being performed
    for the third time). If the event handler is to be used for host checks, then
    the macros **`$HOSTSTATE$`**, **`$HOSTSTATE-TYPE$`**, and **`$HOSTATTEMPT$`**
    are used instead.'
  id: totrans-575
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，它被称为**`restart-lpd.sh`**，并且并不直接位于Nagios插件目录**`/usr/local/nagios/libexec`**中，而是在一个名为**`/usr/local/nagios/libexec/eventhandler`**的子目录中，正如Nagios文档中所建议的。该脚本接收三个宏作为参数：当前状态**`$SERVICESTATE$`**（OK、WARNING、CRITICAL或UNKNOWN），状态类型**`$SERVICESTATETYPE$`**（**`SOFT`**或**`HARD`**），以及当前（可能重复的）尝试次数**`$SERVICE
    ATTEMPT$`**（例如，如果测试正在进行第三次，则为**`3`**）。如果事件处理器用于主机检查，则使用宏**`$HOSTSTATE$`**、**`$HOSTSTATE-TYPE$`**和**`$HOSTATTEMPT$`**。
- en: C.3 The Handler Script
  id: totrans-576
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: C.3 处理器脚本
- en: The actual treatment of the error—depending on the current event—is dealt with
    by the script defined in the command definition. So that we can concentrate on
    the essential aspects in this context, we shall assume that **`lpd`** is installed
    on the Nagios server itself. This enables the service to be restarted locally,
    without the need for a remote shell such as the Secure Shell.
  id: totrans-577
  prefs: []
  type: TYPE_NORMAL
  zh: 实际处理错误（根据当前事件）由命令定义中定义的脚本处理。因此，为了在这个上下文中集中精力关注本质方面，我们假设**`lpd`**安装在Nagios服务器本身上。这使得服务可以在本地重启，而无需远程shell（如Secure
    Shell）。
- en: 'The script **`restart-lpd.sh`** checks to see exactly what event is involved,
    using the macros passed on to it, and either does nothing at all or tries to restart
    **`lpd`**:'
  id: totrans-578
  prefs: []
  type: TYPE_NORMAL
  zh: '**`restart-lpd.sh`**脚本检查确切涉及的事件，使用传递给它的宏，要么什么也不做，要么尝试重启**`lpd`**：'
- en: '[PRE9]'
  id: totrans-579
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: The **`case`** statement first checks to see what state exists. Only if it is
    CRITICAL will the script do anything; it does not carry out any action for other
    states. If the service is in a critical state, either the state type must be **`HARD`**
    or (**`||`**) a corresponding soft state must occur for the third time in succession,
    so that **`restart-lpd.sh`** can execute the **`lpd`** init script with the argument
    **`restart`**.^([[313](#ftn.APP-C-FN-1)])
  id: totrans-580
  prefs: []
  type: TYPE_NORMAL
  zh: '**`case`** 语句首先检查存在什么状态。只有当它是CRITICAL时，脚本才会执行任何操作；对于其他状态，它不会执行任何操作。如果服务处于临界状态，则状态类型必须是**`HARD`**或者（**`||`**）相应的软状态必须连续发生三次，这样**`restart-lpd.sh`**才能使用**`restart`**参数执行**`lpd`**初始化脚本。[^[[313](#ftn.APP-C-FN-1])]'
- en: 'The script is executed with the permissions of the user **`nagios`**, who may
    neither stop nor restart system services. This is why **`sudo`** is used, which
    provides temporary **`root`** permissions exclusively for the start-up script
    **`/etc/init.d/lpd`**, just for this user. The corresponding configuration can
    be found in the file **`/etc/sudoers`**, but if it is edited then you must use
    the program **`visudo`** rather than a standard editor (this checks the configuration
    file for syntax errors when it is saved):'
  id: totrans-581
  prefs: []
  type: TYPE_NORMAL
  zh: 脚本以**`nagios`**用户的权限执行，该用户既不能停止也不能重启系统服务。这就是为什么使用**`sudo`**的原因，它只为启动脚本**`/etc/init.d/lpd`**提供临时的**`root`**权限，仅限该用户。相应的配置可以在文件**`/etc/sudoers`**中找到，但如果编辑它，则必须使用程序**`visudo`**而不是标准编辑器（这会在保存时检查配置文件的语法错误）：
- en: '[PRE10]'
  id: totrans-582
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Then you add the following line to the configuration file:'
  id: totrans-583
  prefs: []
  type: TYPE_NORMAL
  zh: 然后你需要在配置文件中添加以下行：
- en: '[PRE11]'
  id: totrans-584
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'In plain language this means: the user **`nagios`** may run the command **`/etc/init.d/lpd`**
    on the host **`nagsrv`**. The command is run as the user **`root`**, but no password
    is required for this.'
  id: totrans-585
  prefs: []
  type: TYPE_NORMAL
  zh: 用简单的话说就是：用户**`nagios`**可以在**`nagsrv`**主机上运行**`/etc/init.d/lpd`**命令。命令以**`root`**用户身份运行，但不需要密码。
- en: '* * *'
  id: totrans-586
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[313](#APP-C-FN-1)]) If you want to get to know Bash programming more closely,
    we can recommend the excellent *Advanced Bash-Scripting Guide* ([http://www.tldp.org/LDP/abs/html](http://www.tldp.org/LDP/abs/html))
    by Mendel Cooper.
  id: totrans-587
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[313](#APP-C-FN-1)]) 如果你想更深入地了解Bash编程，我们可以推荐Mendel Cooper的杰出作品*高级Bash脚本指南*
    ([http://www.tldp.org/LDP/abs/html](http://www.tldp.org/LDP/abs/html))。
- en: C.4 Things to Note When Using Event Handlers
  id: totrans-588
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: C.4 使用事件处理器时需要注意的事项
- en: If you restart a service that is already in a soft error state as described
    here, the administrator will not receive any notification as long as the action
    was successful. Although the log file records the restart, it will scarcely be
    noticed unless you search the log file explicitly for such events. This means
    that the administrator will seldom investigate the cause of the service failure.
  id: totrans-589
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你重新启动一个已经处于软错误状态的服务，只要操作成功，管理员将不会收到任何通知。尽管日志文件记录了重启，但除非你明确搜索日志文件以查找此类事件，否则几乎不会被注意到。这意味着管理员很少会调查服务失败的原因。
- en: You should therefore bear in mind that eliminating the problem is the best solution,
    and that a restart is only second best. Like air bags in automobiles, the event
    handler should just be regarded as an additional security measure, and should
    certainly not represent the primary method of handling errors. If you carry out
    the restart only when a hard error state occurs, the administrator is confronted
    with the problem through the notification mechanism.
  id: totrans-590
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，你应该记住，消除问题是最好的解决方案，而重启只是次优选择。就像汽车中的安全气囊一样，事件处理器应仅被视为一种额外的安全措施，绝对不能代表处理错误的初级方法。如果你仅在发生硬错误状态时执行重启，管理员将通过通知机制面对问题。
- en: In addition, not every service is suitable for an automatic restart. With OpenLDAP
    in versions before 2.1.17, a problem occurred sporadically in the replication
    through **`slurpd`**, which left behind a corrupted replication file. Although
    the replication service could be restarted, it died again after a short time.
    To really get the replication up and running again, you would have to repair the
    replication file manually.
  id: totrans-591
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，并非每个服务都适合自动重启。在2.1.17版本之前的OpenLDAP中，通过 **`slurpd`** 复制时偶尔会出现问题，留下了损坏的复制文件。尽管复制服务可以重启，但它在短时间内又死了。要真正让复制再次运行，您就必须手动修复复制文件。
- en: You should always remember this example and never have complete faith in self-healing.
    In the worst case, restarting a service repeatedly and without thought could lead
    to loss of data, which might be rectified only by retrieving data from the backups.
  id: totrans-592
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该始终记住这个例子，并且永远不要完全相信自我修复。在最坏的情况下，反复无思考地重启服务可能会导致数据丢失，这可能只能通过从备份中检索数据来纠正。
- en: Appendix D. Macros
  id: totrans-593
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 附录D. 宏
- en: 'Macros are the salt in the Nagios soup, for without them each service would
    have to be defined individually for each host and each command defined separately
    for each host and each service. They are identified by the dollar signs surrounding
    them: **`$macro$`**. We will look at the definition of a command with the plugin
    **`check_http`** (see [6.4.2 Web server control via HTTP](../Text/ch06s04.html#web_server_control_via_http
    "6.4.2 Web server control via HTTP"), page 119):'
  id: totrans-594
  prefs: []
  type: TYPE_NORMAL
  zh: 宏是Nagios汤中的盐，因为没有它们，每个服务都必须为每个主机单独定义，每个命令都必须为每个主机和每个服务单独定义。它们通过围绕它们的美元符号来识别：**`$macro$`**。我们将查看使用插件
    **`check_http`** 的命令定义（见[6.4.2 通过HTTP控制Web服务器](../Text/ch06s04.html#web_server_control_via_http
    "6.4.2 通过HTTP控制Web服务器")，第119页）：
- en: '[PRE12]'
  id: totrans-595
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'The definition contains three different macros: the user macro **`$USER1$`**,
    defined in the file **`resource.cfg`** (see [2.14 The Resources File resource.cfg](../Text/ch02s14.html
    "2.14 The Resources File resource.cfg"), page 79), as well as **`$HOSTADDRESS$`**
    and **`$ARG1$`**. The 32 possible user macros **`$USER1$`** to **`$USER32$`**
    are like constants that you use to record information, such as the path to the
    plugin directory (normally in **`$USER1$`**) or even passwords that should not
    appear in the normal configuration. The file **`resource.cfg`** may then be readable
    only for the user **`nagios`**.'
  id: totrans-596
  prefs: []
  type: TYPE_NORMAL
  zh: 定义包含三个不同的宏：用户宏 **`$USER1$`**，在文件 **`resource.cfg`** 中定义（见[2.14 资源文件 resource.cfg](../Text/ch02s14.html
    "2.14 资源文件 resource.cfg")，第79页），以及 **`$HOSTADDRESS$`** 和 **`$ARG1$`**。32个可能的用户宏
    **`$USER1$`** 到 **`$USER32$`** 类似于常量，您可以使用它们来记录信息，例如插件目录的路径（通常在 **`$USER1$`**
    中）或甚至不应出现在正常配置中的密码。然后，文件 **`resource.cfg`** 可能只能由用户 **`nagios`** 读取。
- en: 'The second macro, **`$HOSTADDRESS$`**, is a so-called *standard macro*, which
    is replaced by the host address of the host definition before the command is run:'
  id: totrans-597
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个宏 **`$HOSTADDRESS$`** 是所谓的 *标准宏*，在命令运行之前，它被替换为主机定义中的主机地址：
- en: '[PRE13]'
  id: totrans-598
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: If the service **`linux0l;HTTP`** calls the command **`check_http`**, the command
    will obtain the host address from the parameter **`address`**. However, standard
    macros can provide not only the contents of a parameter from an object definition,
    as in this case, but also dynamic values that can change. Examples include the
    state of a host (e.g., **`$HOSTSTATE$`**), the output of a plugin (e.g., **`$SERVICEOUTPUT$`**),
    and system information, such as the start time of Nagios or the current time,
    or information on the configuration or static values.
  id: totrans-599
  prefs: []
  type: TYPE_NORMAL
  zh: 如果服务 **`linux0l;HTTP`** 调用命令 **`check_http`**，该命令将从参数 **`address`** 中获取主机地址。然而，标准宏不仅可以提供对象定义中参数的内容，如本例所示，还可以提供可以变化的动态值。例如，主机的状态（例如，**`$HOSTSTATE$`**）、插件的输出（例如，**`$SERVICEOUTPUT$`**）以及系统信息，例如Nagios的启动时间或当前时间，或者有关配置或静态值的信息。
- en: The **`$ARGx$`** macros contain the command line arguments in sequence. These
    appear in the service definition after the exclamation mark following the command
    **`check_http`**. The exclamation mark is also used as a separator between the
    individual arguments. In this way, spaces can be used within an argument, as in
    the example here (**`-u test.html`**), without any problem whatsoever.
  id: totrans-600
  prefs: []
  type: TYPE_NORMAL
  zh: '**`$ARGx$`** 宏按顺序包含命令行参数。这些参数出现在命令 **`check_http`** 后面的感叹号之后。感叹号还用作各个参数之间的分隔符。这样，可以在参数内部使用空格，如本例所示（**`-u
    test.html`**），而不会出现任何问题。'
- en: 'Nagios can handle two other groups of macros: on-demand and custom macros.
    *On-demand macros* (see [D.2 On-Demand Macros](../Text/apds02.html "D.2 On-Demand
    Macros") in page 632) are extended standard macros that are used to access values
    belonging to an external object: for example, **`$H0STADDRESS:linux02$`** returns
    the IP address of **`linux02`**, irrespective of whether we are in the host or
    service definition of **`linuxOl`** or **`linux04`**.'
  id: totrans-601
  prefs: []
  type: TYPE_NORMAL
  zh: 'Nagios 可以处理两组其他宏：按需宏和自定义宏。*按需宏*（见第 632 页的 [D.2 按需宏](../Text/apds02.html "D.2
    按需宏"））是扩展的标准宏，用于访问属于外部对象的价值：例如，**`$H0STADDRESS:linux02$`** 返回 **`linux02`** 的
    IP 地址，无论我们是在 **`linuxOl`** 或 **`linux04`** 的主机或服务定义中的主机或服务定义。 '
- en: '*Custom macros*, also referred to as *user-defined variables*, were only introduced
    in Nagios 3.0\. The definition of host, service, and contact objects is now supplemented
    with definitions you can make yourself, in whatever manner you like. [D.3 Macros
    for User-defined Variables](../Text/apds03.html "D.3 Macros for User-defined Variables")
    from page 633 deals with these custom macros in more detail.'
  id: totrans-602
  prefs: []
  type: TYPE_NORMAL
  zh: '*自定义宏*，也称为 *用户定义变量*，仅在 Nagios 3.0 中引入。现在，主机、服务和联系对象的定义现在补充了您可以自己定义的定义，无论您喜欢什么方式。[D.3
    用户定义变量的宏](../Text/apds03.html "D.3 用户定义变量的宏"）从第 633 页更详细地处理这些自定义宏。'
- en: D.1 Standard Macros
  id: totrans-603
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: D.1 标准宏
- en: It would go beyond the scope of this book to describe all the available macros.
    The description below concentrates on the most important ones. A complete list
    is given in a tabular overview in the online documentation.^([[314](#ftn.APP-D-FN-1)])
  id: totrans-604
  prefs: []
  type: TYPE_NORMAL
  zh: 描述所有可用的宏超出了本书的范围。下面的描述集中在最重要的宏上。完整的列表在在线文档中的表格概览中给出。[314](#ftn.APP-D-FN-1)]
- en: Not all macros can be used everywhere. For this reason the tables provide information
    on the contexts in which each one is applicable. Normally this can be deduced
    with a bit of common sense. A service macro does not belong in a host check or
    a host notification, and likewise, a notification macro has no place in a host
    or service check. A value (such as a host state) which first has to be found is
    of course not yet available while it is being identified (that is, during the
    host check).
  id: totrans-605
  prefs: []
  type: TYPE_NORMAL
  zh: 并非所有宏都可以在任何地方使用。因此，表格提供了关于每个宏适用上下文的信息。通常，这可以通过一点常识推断出来。服务宏不属于主机检查或主机通知，同样，通知宏在主机或服务检查中也没有位置。当然，必须首先找到的值（例如主机状态）在识别过程中（即主机检查期间）尚未可用。
- en: 'Macros can basically be used in the following actions: for host and service
    checks, for host and service notifications, when running event handlers ([Appendix C](../Text/apc.html
    "Appendix C. Event Handlers"), page 619) or the OCSP/OHCP commands ([Chapter 15](../Text/ch15.html
    "Chapter 15. Distributed Monitoring"), page 317), and also when processing performance
    data with the accompanying commands ([19.1.1 The template mechanism](../Text/ch19.html#the_template_mechanism
    "19.1.1 The template mechanism"), page 405 and [19.1.2 Using external commands
    to process performance data](../Text/ch19.html#using_external_commands_to_process_perf
    "19.1.2 Using external commands to process performance data"), page 407).'
  id: totrans-606
  prefs: []
  type: TYPE_NORMAL
  zh: 宏基本上可以在以下操作中使用：用于主机和服务检查、用于主机和服务通知、在运行事件处理器 ([附录 C](../Text/apc.html "附录 C.
    事件处理器")，第 619 页) 或 OCSP/OHCP 命令 ([第 15 章](../Text/ch15.html "第 15 章. 分布式监控")，第
    317 页)，以及使用伴随命令处理性能数据时 ([19.1.1 模板机制](../Text/ch19.html#the_template_mechanism
    "19.1.1 模板机制")，第 405 页和 [19.1.2 使用外部命令处理性能数据](../Text/ch19.html#using_external_commands_to_process_perf
    "19.1.2 使用外部命令处理性能数据")，第 407 页)。
- en: D.1.1 Host macros
  id: totrans-607
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: D.1.1 主机宏
- en: Table D-1. Selected host macros
  id: totrans-608
  prefs: []
  type: TYPE_NORMAL
  zh: 表 D-1. 选择的宿主机宏
- en: '| Macro | Description |'
  id: totrans-609
  prefs: []
  type: TYPE_TB
  zh: '| 宏 | 描述 |'
- en: '| --- | --- |'
  id: totrans-610
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| **`$HOSTNAME$`** | Host name from the **`host_name`** parameter for the host
    definition |'
  id: totrans-611
  prefs: []
  type: TYPE_TB
  zh: '| **`$HOSTNAME$`** | 主机定义中来自 **`host_name`** 参数的主机名 |'
- en: '| **`$HOSTALIAS$`** | Alias from the **`alias`** parameter for the host definition
    |'
  id: totrans-612
  prefs: []
  type: TYPE_TB
  zh: '| **`$HOSTALIAS$`** | 主机定义中来自 **`alias`** 参数的别名 |'
- en: '| **`$HOSTADDRESS$`** | IP address or FQDN from the host definition parameter
    |'
  id: totrans-613
  prefs: []
  type: TYPE_TB
  zh: '| **`$HOSTADDRESS$`** | 主机定义参数中的 IP 地址或 FQDN |'
- en: '| **`$HOSTSTATE$`** | State as text: UP, DOWN, UNREACHABLE |'
  id: totrans-614
  prefs: []
  type: TYPE_TB
  zh: '| **`$HOSTSTATE$`** | 文本形式的状态：UP，DOWN，UNREACHABLE |'
- en: '| **`$HOSTSTATEID$`** | State in numerical form: **`0`** (UP), **`1`** (DOWN),
    **`2`** (UNREACHABLE) |'
  id: totrans-615
  prefs: []
  type: TYPE_TB
  zh: '| **`$HOSTSTATEID$`** | 数值形式的状态：**`0`**（UP），**`1`**（DOWN），**`2`**（UNREACHABLE）
    |'
- en: '| **`$HOSTSTATETYPE$`** | **`HARD`**, **`SOFT`** |'
  id: totrans-616
  prefs: []
  type: TYPE_TB
  zh: '| **`$HOSTSTATETYPE$`** | **`HARD`**，**`SOFT`** |'
- en: '| **`$HOSTOUTPUT$`** | The first line of the text output of the host check
    |'
  id: totrans-617
  prefs: []
  type: TYPE_TB
  zh: '| **`$HOSTOUTPUT$`** | 主机检查文本输出的第一行 |'
- en: '| **`$HOSTLONGOUTPUT$`**(Nagios 3.0) | Long text of the host check, if this
    provides multiple-line information |'
  id: totrans-618
  prefs: []
  type: TYPE_TB
  zh: '| **`$HOSTLONGOUTPUT$`**(Nagios 3.0) | 主机检查的长文本，如果提供多行信息 |'
- en: '| **`$HOSTPERFDATA$`** | Performance data from the host check |'
  id: totrans-619
  prefs: []
  type: TYPE_TB
  zh: '| **`$HOSTPERFDATA$`** | 主机检查的性能数据 |'
- en: '[Table D-1](../Text/apd.html#selected_host_macros "Table D-1. Selected host
    macros") documents the most important macros in connection with hosts. The macros
    **`$HOSTNAME$`**, **`$HOSTALIAS$`**, and **`$HOSTADDRESS$`** provide information
    from the host definition itself, so they are static. **`$HOSTSTATEID$`** and **`$HOSTSTATE$`**
    do *not* give the return value of the plugin—**`1`** (OK) or **`2`** (CRITICAL)—but
    the result after the topological evaluation by Nagios. **`$HOSTSTATETYPE$`** defines
    whether Nagios really has completed the check (hard state) or whether the check
    is to be repeated (soft state).'
  id: totrans-620
  prefs: []
  type: TYPE_NORMAL
  zh: '[表 D-1](../Text/apd.html#selected_host_macros "表 D-1. 选定的主机宏") 记录了与主机相关联的最重要宏。宏
    **`$HOSTNAME$`**、**`$HOSTALIAS$`** 和 **`$HOSTADDRESS$`** 提供来自主机定义本身的信息，因此它们是静态的。**`$HOSTSTATEID$`**
    和 **`$HOSTSTATE$`** 并不给出插件返回值——**`1`**（OK）或 **`2`**（CRITICAL），而是Nagios进行拓扑评估后的结果。**`$HOSTSTATETYPE$`**
    定义Nagios是否真正完成了检查（硬状态）或检查是否需要重复（软状态）。'
- en: D.1.2 Service macros
  id: totrans-621
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: D.1.2 服务宏
- en: '[Table D-2](../Text/apd.html#selected_macros_for_services "Table D-2. Selected
    macros for services") presents selected service macros.'
  id: totrans-622
  prefs: []
  type: TYPE_NORMAL
  zh: '[表 D-2](../Text/apd.html#selected_macros_for_services "表 D-2. 选定的服务宏") 展示了选定的服务宏。'
- en: Table D-2. Selected macros for services
  id: totrans-623
  prefs: []
  type: TYPE_NORMAL
  zh: 表 D-2. 选定的服务宏
- en: '| Macro | Description |'
  id: totrans-624
  prefs: []
  type: TYPE_TB
  zh: '| 宏 | 描述 |'
- en: '| --- | --- |'
  id: totrans-625
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| **`$SERVICEDESC$`** | Name of the service, taken from the parameter **`service_description`**
    from the service definition |'
  id: totrans-626
  prefs: []
  type: TYPE_TB
  zh: '| **`$SERVICEDESC$`** | 服务的名称，从服务定义中的参数 **`service_description`** 中获取 |'
- en: '| **`$SERVICESTATE$`** | The state in text form: OK, WARNING, CRITICAL, UNKNOWN
    |'
  id: totrans-627
  prefs: []
  type: TYPE_TB
  zh: '| **`$SERVICESTATE$`** | 文本形式的状态：OK，WARNING，CRITICAL，UNKNOWN |'
- en: '| **`$SERVICESTATEID$`** | The state numerically: **`0`** (OK), **`1`** (WARNING),
    **`2`** (CRITICAL), **`3`** (UNKNOWN) |'
  id: totrans-628
  prefs: []
  type: TYPE_TB
  zh: '| **`$SERVICESTATEID$`** | 状态的数值：**`0`**（OK），**`1`**（WARNING），**`2`**（CRITICAL），**`3`**（UNKNOWN）
    |'
- en: '| **`$SERVICESTATETYPE$`** | **`HARD`**, **`SOFT`** |'
  id: totrans-629
  prefs: []
  type: TYPE_TB
  zh: '| **`$SERVICESTATETYPE$`** | **`HARD`**，**`SOFT`** |'
- en: '| **`$SERVICEOUTPUT$`** | The first line of the text output of the plugin during
    the service check |'
  id: totrans-630
  prefs: []
  type: TYPE_TB
  zh: '| **`$SERVICEOUTPUT$`** | 服务检查期间插件文本输出的第一行 |'
- en: '| **`$SERVICELONGOUTPUT$`** (Nagios 3.0) | The long text of the service check,
    if this provides multiple-line output |'
  id: totrans-631
  prefs: []
  type: TYPE_TB
  zh: '| **`$SERVICELONGOUTPUT$`** (Nagios 3.0) | 服务检查的长文本，如果提供多行输出 |'
- en: '| **`$SERVICEPERFDATA$`** | Performance data of the service check |'
  id: totrans-632
  prefs: []
  type: TYPE_TB
  zh: '| **`$SERVICEPERFDATA$`** | 服务检查的性能数据 |'
- en: D.1.3 Group macros
  id: totrans-633
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: D.1.3 组宏
- en: The host group macros described in [Table D-3](../Text/apd.html#selected_group_macros
    "Table D-3. Selected group macros") are provided by Nagios for service and contact
    groups as well. The string **`HOST`** in the macro name is replaced accordingly
    by ys**`SERVICE`** or **`CONTACT`**.
  id: totrans-634
  prefs: []
  type: TYPE_NORMAL
  zh: '[表 D-3](../Text/apd.html#selected_group_macros "表 D-3. 选定的组宏") 中描述的主机组宏也由Nagios为服务和联系人组提供。宏名称中的字符串
    **`HOST`** 根据相应地替换为 **`SERVICE`** 或 **`CONTACT`**。'
- en: The macros **`$HOSTGROUPNAME$`** and **`$HOSTGROUPNAMES$`** are always connected
    to the host. The same applies for the equivalent **`SERVICEGROUP`** (connected
    to a service) and **`CONTACTGR0UP`** macros (connected to a contact). Whereas
    **`$HOSTGROUPNAME$`** always returns the first host group of the associated host,
    **`$HOSTGROUPNAMES$`** displays a complete, comma-separated list of all host groups
    of which the host is a member.
  id: totrans-635
  prefs: []
  type: TYPE_NORMAL
  zh: 宏 **`$HOSTGROUPNAME$`** 和 **`$HOSTGROUPNAMES$`** 总是与主机相关联。对于等效的 **`SERVICEGROUP`**（与服务相关联）和
    **`CONTACTGROUP`** 宏（与联系人相关联）也是如此。其中 **`$HOSTGROUPNAME$`** 总是返回关联主机的第一个主机组，而 **`$HOSTGROUPNAMES$`**
    显示一个完整的、以逗号分隔的列表，列出主机所属的所有主机组。
- en: Table D-3. Selected group macros
  id: totrans-636
  prefs: []
  type: TYPE_NORMAL
  zh: 表 D-3. 选定的组宏
- en: '| Macro | Description |'
  id: totrans-637
  prefs: []
  type: TYPE_TB
  zh: '| 宏 | 描述 |'
- en: '| --- | --- |'
  id: totrans-638
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| **`$HOSTGROUPNAME$`** | Name of the first host group |'
  id: totrans-639
  prefs: []
  type: TYPE_TB
  zh: '| **`$HOSTGROUPNAME$`** | 第一个主组名称 |'
- en: '| **`$HOSTGROUPNAMES$`** | Comma-separated list of all host groups to which
    the associated host belongs |'
  id: totrans-640
  prefs: []
  type: TYPE_TB
  zh: '| **`$HOSTGROUPNAMES$`** | 与关联主机相关的所有主机组的一个以逗号分隔的列表 |'
- en: '| **`$HOSTGROUPALIAS$`** | Alias of the host group |'
  id: totrans-641
  prefs: []
  type: TYPE_TB
  zh: '| **`$HOSTGROUPALIAS$`** | 主组别名 |'
- en: '| **`$HOSTGROUPMEMBERS$`** | Members of the host group |'
  id: totrans-642
  prefs: []
  type: TYPE_TB
  zh: '| **`$HOSTGROUPMEMBERS$`** | 主机组成员 |'
- en: In contrast, the macros **`$HOSTGROUPALIAS$`** and **`$HOSTGROUPMEMBERS$`**
    refer to a host group. However, now there are no activities using a host group
    as a reference point.^([[315](#ftn.APP-D-FN-2)]) So what is the purpose of these
    macros? They can be implemented as on-demand macros (see [D.2 On-Demand Macros](../Text/apds02.html
    "D.2 On-Demand Macros") from page 632). For example, **`$HOSTGROUPMEMBERS:Linux$`**
    displays a list of all members of the **`Linux`** host group.
  id: totrans-643
  prefs: []
  type: TYPE_NORMAL
  zh: 相比之下，宏 **`$HOSTGROUPALIAS$`** 和 **`$HOSTGROUPMEMBERS$`** 指的是主机组。然而，现在没有活动使用主机组作为参考点.^([[315](#ftn.APP-D-FN-2)])
    因此，这些宏的目的是什么？它们可以作为按需宏实现（参见第 632 页的 [D.2 按需宏](../Text/apds02.html "D.2 按需宏")）。例如，**`$HOSTGROUPMEMBERS:Linux$`**
    显示了 **`Linux`** 主机组所有成员的列表。
- en: On the other hand, if the macro is run in a "normal" context, Nagios identifies
    the first host group specified in the host definition and assesses the accompanying
    value. The same applies for service and contact groups.
  id: totrans-644
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，如果宏在“正常”环境中运行，Nagios 会识别主机定义中指定的第一个主机组并评估其伴随的值。对于服务和联系组也是如此。
- en: D.1.4 Contact macros
  id: totrans-645
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: D.1.4 联系宏
- en: The macros listed in [Table D-4](../Text/apd.html#selected_contact_macros "Table D-4. Selected
    contact macros") reference all the parameters in the respective contact definition.
  id: totrans-646
  prefs: []
  type: TYPE_NORMAL
  zh: 列在 [表 D-4](../Text/apd.html#selected_contact_macros "表 D-4. 通知所选联系宏") 中的宏引用了相应联系定义中的所有参数。
- en: Table D-4. Selected contact macros
  id: totrans-647
  prefs: []
  type: TYPE_NORMAL
  zh: 表 D-4. 通知所选联系宏
- en: '| Macro | Parameter to be read out |'
  id: totrans-648
  prefs: []
  type: TYPE_TB
  zh: '| 宏 | 要读取的参数 |'
- en: '| --- | --- |'
  id: totrans-649
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| **`$CONTACTNAME$`** | **`contact_name`** |'
  id: totrans-650
  prefs: []
  type: TYPE_TB
  zh: '| **`$CONTACTNAME$`** | **`contact_name`** |'
- en: '| **`$CONTACTALIAS$`** | **`alias`** |'
  id: totrans-651
  prefs: []
  type: TYPE_TB
  zh: '| **`$CONTACTALIAS$`** | **`alias`** |'
- en: '| **`$CONTACTEMAIL$`** | **`email`** |'
  id: totrans-652
  prefs: []
  type: TYPE_TB
  zh: '| **`$CONTACTEMAIL$`** | **`email`** |'
- en: '| **`$CONTACTPAGER$`** | Parameter **`pager`** of the contact |'
  id: totrans-653
  prefs: []
  type: TYPE_TB
  zh: '| **`$CONTACTPAGER$`** | 联系的 **`pager`** 参数 |'
- en: '| **`$CONTACTADDRESSn$`** | One of six possible contact addresses, where **`n`**
    is a digit between **`1`** and **`6`**^([[a](#ftn.APP-D-FN-3)]) |'
  id: totrans-654
  prefs: []
  type: TYPE_TB
  zh: '| **`$CONTACTADDRESSn$`** | 六个可能的联系地址之一，其中 **`n`** 是介于 **`1`** 和 **`6`** 之间的数字^([[a](#ftn.APP-D-FN-3)])
    |'
- en: '|'
  id: totrans-655
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: '^([[a](#APP-D-FN-3)]) The exact contents of **`$CONTACTADDRESSn$`** are specified
    by the Nagios administrator. Anything goes: other telephone numbers, e-mail addresses,
    or even Granny''s phone number.'
  id: totrans-656
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[a](#APP-D-FN-3)]) **`$CONTACTADDRESSn$`** 的确切内容由 Nagios 管理员指定。任何内容都可以：其他电话号码、电子邮件地址，甚至是奶奶的电话号码。
- en: '|'
  id: totrans-657
  prefs: []
  type: TYPE_NORMAL
  zh: '|'
- en: D.1.5 Notification macros
  id: totrans-658
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: D.1.5 通知宏
- en: '[Table D-5](../Text/apd.html#selected_macros_for_notifications "Table D-5. Selected
    macros for notifications") shows a selection of macros for notifications.'
  id: totrans-659
  prefs: []
  type: TYPE_NORMAL
  zh: '[表 D-5](../Text/apd.html#selected_macros_for_notifications "表 D-5. 通知所选宏")
    展示了通知所选宏的示例。'
- en: Table D-5. Selected macros for notifications
  id: totrans-660
  prefs: []
  type: TYPE_NORMAL
  zh: 表 D-5. 通知所选宏
- en: '| Macro | Description |'
  id: totrans-661
  prefs: []
  type: TYPE_TB
  zh: '| 宏 | 描述 |'
- en: '| --- | --- |'
  id: totrans-662
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| **`$NOTIFICATIONTYPE$`** | Notification type (for values, see text) |'
  id: totrans-663
  prefs: []
  type: TYPE_TB
  zh: '| **`$NOTIFICATIONTYPE$`** | 通知类型（有关值，请参阅文本） |'
- en: '| **`$NOTIFICATIONRECIPIENTS$`** (Nagios 3.0) | Comma-separated list of all
    recipients |'
  id: totrans-664
  prefs: []
  type: TYPE_TB
  zh: '| **`$NOTIFICATIONRECIPIENTS$`** (Nagios 3.0) | 所有收件人的逗号分隔列表 |'
- en: '| **`$HOSTNOTIFICATIONNUMBER$`** | Notification counter |'
  id: totrans-665
  prefs: []
  type: TYPE_TB
  zh: '| **`$HOSTNOTIFICATIONNUMBER$`** | 通知计数器 |'
- en: '| **`$SERVICENOTIFICATIONNUMBER$`** (Nagios 3.0) | Notification counter |'
  id: totrans-666
  prefs: []
  type: TYPE_TB
  zh: '| **`$SERVICENOTIFICATIONNUMBER$`** (Nagios 3.0) | 通知计数器 |'
- en: '**`$NOTIFICATI0NTYPE$`** describes the type of notification. For Nagios 2.x
    the notification types are **`PROBLEM`**, **`RECOVERY`**, **`ACKNOWLEDGEMENT`**,
    **`FLAPPING-START`**, and **`FLAPPINGSTOP`**. Nagios 3.0 also has **`FLAPPINGDISABLED`**,
    as well as **`DOWNTIMESTART`**, **`DOWNTIMEEND`**, and **`DOWNTIMECANCELLED`**.'
  id: totrans-667
  prefs: []
  type: TYPE_NORMAL
  zh: '**`$NOTIFICATIONTYPE$`** 描述了通知的类型。对于 Nagios 2.x，通知类型是 **`PROBLEM`**、**`RECOVERY`**、**`ACKNOWLEDGEMENT`**、**`FLAPPING-START`**
    和 **`FLAPPINGSTOP`**。Nagios 3.0 还包括 **`FLAPPINGDISABLED`**、**`DOWNTIMESTART`**、**`DOWNTIMEEND`**
    和 **`DOWNTIMECANCELLED`**。'
- en: The macro **`$NOTIFICATIONRECIPIENTS$`** is only available from Nagios 3.0;
    it contains a comma-separated list of all recipients of the notification that
    has just been sent. Also new in this version are the two macros **`$HOSTNOTIFICATIONNUMBER$`**
    and **`$SERVICENOTIFICATIONNUMBER$`**. These contain the incremented number of
    the last sent message, which is important for escalation management. Acknowledge
    messages are ignored in this case, as are flapping messages or messages on planned
    maintenance periods. As soon as the state of the host or service is again OK,
    this counter is reset to 0, and in the event of an error, counting starts again
    from the beginning.
  id: totrans-668
  prefs: []
  type: TYPE_NORMAL
  zh: 宏 **`$NOTIFICATIONRECIPIENTS$`** 仅从 Nagios 3.0 版本开始可用；它包含刚刚发送的通知的所有收件人的逗号分隔列表。此版本中还包括两个新宏
    **`$HOSTNOTIFICATIONNUMBER$`** 和 **`$SERVICENOTIFICATIONNUMBER$`**。这些宏包含最后发送消息的递增编号，这对于升级管理非常重要。在这种情况下，忽略确认消息，以及摆动消息或计划维护期间的消息。一旦主机或服务的状态再次变为正常，此计数器将重置为
    0，并且在发生错误时，计数将从开始处重新开始。
- en: D.1.6 Macros to specify time and date
  id: totrans-669
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: D.1.6 用于指定时间和日期的宏
- en: The output of the date macro from [Table D-6](../Text/apd.html#selected_macros_for_details_of_the_date
    "Table D-6. Selected macros for details of the date") depends on the date form
    specified in the parameter **`date_format`** ([A.1 The Main Configuration File
    nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1 The
    Main Configuration File nagios.cfg")).
  id: totrans-670
  prefs: []
  type: TYPE_NORMAL
  zh: 日期宏的输出（[表 D-6](../Text/apd.html#selected_macros_for_details_of_the_date "表 D-6.
    用于日期详细信息的选定宏"））取决于参数中指定的日期格式 **`date_format`** ([A.1 主配置文件 nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件 nagios.cfg")）。
- en: Table D-6. Selected macros for details of the date
  id: totrans-671
  prefs: []
  type: TYPE_NORMAL
  zh: 表 D-6. 用于日期详细信息的选定宏
- en: '| Macro | Example |'
  id: totrans-672
  prefs: []
  type: TYPE_TB
  zh: '| 宏 | 示例 |'
- en: '| --- | --- |'
  id: totrans-673
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| **`$LONGDATETIME$`** | **`Sa 29 Dec 17:23:22 CET 2007`** |'
  id: totrans-674
  prefs: []
  type: TYPE_TB
  zh: '| **`$LONGDATETIME$`** | **`Sa 29 Dec 17:23:22 CET 2007`** |'
- en: '| **`$SHORTDATETIME$`** | **`2007-12-29 17:23:22`** |'
  id: totrans-675
  prefs: []
  type: TYPE_TB
  zh: '| **`$SHORTDATETIME$`** | **`2007-12-29 17:23:22`** |'
- en: '| **`$DATE$`** | **`2007-12-29`** |'
  id: totrans-676
  prefs: []
  type: TYPE_TB
  zh: '| **`$DATE$`** | **`2007-12-29`** |'
- en: '| **`$TIME$`** | **`17:23:22`** |'
  id: totrans-677
  prefs: []
  type: TYPE_TB
  zh: '| **`$TIME$`** | **`17:23:22`** |'
- en: '| **`$TIMET$`** | **`1198945589`** |'
  id: totrans-678
  prefs: []
  type: TYPE_TB
  zh: '| **`$TIMET$`** | **`1198945589`** |'
- en: '**`$LONGDATETIME$`** outputs a format also provided by the **`date`** program
    without any parameters. The examples for **`$SHORTDATETIME$`** and **`$DATE$`**
    correspond to the **`date_format=iso8601`** setting. With the value **`date_format=us`**,
    the date would be written here as **`12/29/2007`**. **`$TIME$`** contains only
    the time, whereas **`$TIMET$`** shows the epoch time (seconds elapsed since 01.01.1970).'
  id: totrans-679
  prefs: []
  type: TYPE_NORMAL
  zh: '**`$LONGDATETIME$`** 输出与 **`date`** 程序提供的无参数格式相同的格式。**`$SHORTDATETIME$`** 和
    **`$DATE$`** 的示例对应于 **`date_format=iso8601`** 设置。使用 **`date_format=us`** 值时，日期将写为
    **`12/29/2007`**。**`$TIME$`** 仅包含时间，而 **`$TIMET$`** 显示纪元时间（自 1970 年 01 月 01 日起经过的秒数）。'
- en: D.1.7 Statistics macros
  id: totrans-680
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: D.1.7 统计宏
- en: If you use the macros shown in [Table D-7](../Text/apd.html#selected_macros_for_statistical_purposes
    "Table D-7. Selected macros for statistical purposes") in notifications, the macro
    in each case will show the number of hosts or services for which the contact to
    whom the notification is sent is responsible. This means that different recipients
    may receive different figures for the same notification.
  id: totrans-681
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在通知中使用[表 D-7](../Text/apd.html#selected_macros_for_statistical_purposes "表
    D-7. 用于统计目的的选定宏"）中显示的宏，则每个情况下的宏将显示通知发送的联系人负责的主机或服务的数量。这意味着不同的收件人可能会收到相同通知的不同数据。
- en: Table D-7. Selected macros for statistical purposes
  id: totrans-682
  prefs: []
  type: TYPE_NORMAL
  zh: 表 D-7. 用于统计目的的选定宏
- en: '| Macro | Description |'
  id: totrans-683
  prefs: []
  type: TYPE_TB
  zh: '| 宏 | 描述 |'
- en: '| --- | --- |'
  id: totrans-684
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| **`$TOTALHOSTSUP$`** | Number of hosts in UP state |'
  id: totrans-685
  prefs: []
  type: TYPE_TB
  zh: '| **`$TOTALHOSTSUP$`** | UP状态下的主机数量 |'
- en: '| **`$TOTALHOSTSDOWN$`** | Number of hosts in DOWN state |'
  id: totrans-686
  prefs: []
  type: TYPE_TB
  zh: '| **`$TOTALHOSTSDOWN$`** | DOWN状态下的主机数量 |'
- en: '| **`$TOTALHOSTSUNREACHABLE$`** | Number of hosts in UNREACHABLE state |'
  id: totrans-687
  prefs: []
  type: TYPE_TB
  zh: '| **`$TOTALHOSTSUNREACHABLE$`** | UNREACHABLE状态下的主机数量 |'
- en: '| **`$TOTALSERVICESOK$`** | Number of services in OK state |'
  id: totrans-688
  prefs: []
  type: TYPE_TB
  zh: '| **`$TOTALSERVICESOK$`** | OK状态下的服务数量 |'
- en: '| **`$TOTALSERVICESCRITICAL$`** | Number of services in CRITICAL state |'
  id: totrans-689
  prefs: []
  type: TYPE_TB
  zh: '| **`$TOTALSERVICESCRITICAL$`** | CRITICAL状态下的服务数量 |'
- en: '| **`$TOTALSERVICESWARNING$`** | Number of services in WARNING state |'
  id: totrans-690
  prefs: []
  type: TYPE_TB
  zh: '| **`$TOTALSERVICESWARNING$`** | WARNING状态下的服务数量 |'
- en: '| **`$TOTALSERVICESUNKNOWN$`** | Number of services in UNKNOWN state |'
  id: totrans-691
  prefs: []
  type: TYPE_TB
  zh: '| **`$TOTALSERVICESUNKNOWN$`** | UNKNOWN状态下的服务数量 |'
- en: '| **`$TOTALSERVICEPROBLEMS$`** | Total number of services with problems |'
  id: totrans-692
  prefs: []
  type: TYPE_TB
  zh: '| **`$TOTALSERVICEPROBLEMS$`** | 存在问题的服务总数 |'
- en: D.1.8 Using standard macros about the environment
  id: totrans-693
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: D.1.8 使用关于环境的标准宏
- en: All standard macros can be provided by Nagios as environment variables, if required.
    The variable name here is derived from the name of the macro without the dollar
    sign, to which the prefix **`NAGIOS_`** is added. The macro **`$HOSTADDRESS$`**
    thus converts to the environment variable **`NAGIOS_HOST-ADDRESS`**. Among the
    on-demand macros (see next section), the host and service macros are not available
    as environment variables for reasons of security, and the same goes for the **`$USERx$`**
    macros, since these could contain sensitive information such as passwords.
  id: totrans-694
  prefs: []
  type: TYPE_NORMAL
  zh: 如果需要，所有标准宏都可以由Nagios作为环境变量提供。这里的变量名是从宏名称中去除美元符号得到的，并添加了前缀**`NAGIOS_`**。因此，宏**`$HOSTADDRESS$`**转换为环境变量**`NAGIOS_HOST-ADDRESS`**。在按需宏（见下一节）中，由于安全原因，宿主和服务宏作为环境变量不可用，**`$USERx$`**宏也是如此，因为这些可能包含敏感信息，如密码。
- en: Providing these environment variables takes a great deal of time. You should
    therefore consider whether you can do without them altogether in Nagios 3.0 (see
    the parameters **`use_large_installation_tweaks`**, [A.1 The Main Configuration
    File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    The Main Configuration File nagios.cfg"), and **`enable_environment_macros`**,
    [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")). In Nagios 2.x the environment
    variable cannot be switched off.
  id: totrans-695
  prefs: []
  type: TYPE_NORMAL
  zh: 提供这些环境变量需要花费大量时间。因此，你应该考虑是否可以在Nagios 3.0中完全不需要它们（参见参数**`use_large_installation_tweaks`**，[A.1
    主配置文件nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    主配置文件nagios.cfg")，以及**`enable_environment_macros`**，[A.1 主配置文件nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件nagios.cfg"))。在Nagios 2.x中，环境变量无法关闭。
- en: Instead of accessing the Nagios environment variable directly from an external
    script, as in the following example,
  id: totrans-696
  prefs: []
  type: TYPE_NORMAL
  zh: 以下示例中，不是直接从外部脚本中访问Nagios环境变量，
- en: '[PRE14]'
  id: totrans-697
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: which is called as follows,
  id: totrans-698
  prefs: []
  type: TYPE_NORMAL
  zh: 它可以通过以下方式调用，
- en: '[PRE15]'
  id: totrans-699
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'as an alternative, you could pass on the contents of the macro to the script
    explicitly as an argument:'
  id: totrans-700
  prefs: []
  type: TYPE_NORMAL
  zh: 作为替代，你可以明确地将宏的内容作为参数传递给脚本：
- en: '[PRE16]'
  id: totrans-701
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Then you can manage without the Nagios environment variable in the script itself:'
  id: totrans-702
  prefs: []
  type: TYPE_NORMAL
  zh: 然后你可以在脚本本身中不使用Nagios环境变量来管理：
- en: '[PRE17]'
  id: totrans-703
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '**`goodscript`** retrieves the relevant value from the command line, with **`$1`**.'
  id: totrans-704
  prefs: []
  type: TYPE_NORMAL
  zh: '**`goodscript`**使用**`$1`**从命令行检索相关值。'
- en: '* * *'
  id: totrans-705
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: '^([[314](#APP-D-FN-1)]) Nagios 2.x: [http://nagios.sourceforge.net/docs/2_0/macros.html](http://nagios.sourceforge.net/docs/2_0/macros.html);'
  id: totrans-706
  prefs: []
  type: TYPE_NORMAL
  zh: '^([[314](#APP-D-FN-1)]) Nagios 2.x: [http://nagios.sourceforge.net/docs/2_0/macros.html](http://nagios.sourceforge.net/docs/2_0/macros.html);'
- en: 'Nagios 3.0: [http://nagios.sourceforge.net/docs/3_0/macrolist.html](http://nagios.sourceforge.net/docs/3_0/macrolist.html)'
  id: totrans-707
  prefs: []
  type: TYPE_NORMAL
  zh: 'Nagios 3.0: [http://nagios.sourceforge.net/docs/3_0/macrolist.html](http://nagios.sourceforge.net/docs/3_0/macrolist.html)'
- en: ^([[315](#APP-D-FN-2)]) It is possible to run commands for a host group from
    the Web interface, but Nagios always resolves these into single actions for each
    host.
  id: totrans-708
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[315](#APP-D-FN-2)]) 从Web界面运行主机组的命令是可能的，但Nagios总是将这些解析为每个主机的单个操作。
- en: D.2 On-Demand Macros
  id: totrans-709
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: D.2 按需宏
- en: 'On-demand macros—which have existed since Nagios 2.0—reference the same contents
    as standard macros do. The subtle difference between them lies in the context
    of what they reference. Whereas standard macros refer exclusively to the host,
    service, or contact object currently being used, on-demand macros enable access
    to values from any external objects you please:'
  id: totrans-710
  prefs: []
  type: TYPE_NORMAL
  zh: 按需宏——自Nagios 2.0以来就存在——引用的内容与标准宏相同。它们之间的细微差别在于它们引用的上下文。而标准宏仅引用当前正在使用的宿主、服务或联系对象，按需宏则允许访问任何外部对象中的值：
- en: '[PRE18]'
  id: totrans-711
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'The macros are the same as standard macros, but their names include the name
    of the host to which the reference is made. The colon is used as a separator.
    For services, the service name also needs to be specified, again separated with
    another colon:'
  id: totrans-712
  prefs: []
  type: TYPE_NORMAL
  zh: 宏与标准宏相同，但它们的名称包括引用的宿主名称。冒号用作分隔符。对于服务，还需要指定服务名称，再次用另一个冒号分隔：
- en: '[PRE19]'
  id: totrans-713
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: If the host field is left empty, the macro refers to the host in whose context
    the macro is called. If, for instance, you are checking the disk usage via NRPE
    on the host **`linux01`** with the service **`Disks`** NRPE, then the standard
    macro **`$SERVICESTATE$`** will return the state of the service **`linux01;Disks`**,
    whereas the on-demand macro **`$SERVICESTATE::NRPE$`** will display the state
    of the service **`linux01;NRPE`**. An appropriate script can take into account
    the dependency here between the service **`NRPE`** and an NRPE-based check such
    as **`Disks`**.
  id: totrans-714
  prefs: []
  type: TYPE_NORMAL
  zh: 如果主机字段留空，则宏引用调用宏的主机。例如，如果你通过NRPE在主机**`linux01`**上检查磁盘使用情况，使用服务**`Disks`** NRPE，那么标准宏**`$SERVICESTATE$`**将返回服务**`linux01;Disks`**的状态，而按需宏**`$SERVICESTATE::NRPE$`**将显示服务**`linux01;NRPE`**的状态。适当的脚本可以考虑到服务**`NRPE`**和基于NRPE的检查（如**`Disks`**）之间的依赖关系。
- en: 'For contact objects, the external reference point is a contact in each case:'
  id: totrans-715
  prefs: []
  type: TYPE_NORMAL
  zh: 对于联系对象，外部参考点是每个情况下的一个联系点：
- en: '[PRE20]'
  id: totrans-716
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: In addition to this, there are also on-demand macros for host, service, and
    contact groups, and in each case the reference point is the group concerned.
  id: totrans-717
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，还有针对主机、服务和联系组的按需宏，并且在每个情况下，参考点是相关的组。
- en: D.3 Macros for User-defined Variables
  id: totrans-718
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: D.3 用户定义变量的宏
- en: 'Starting from Nagios 3.0, you can specify your own macros in host, service,
    and contact definitions. These macros, called *custom macros* in Nagios jargon,
    are treated like normal standard macros, and their names begin with an underscore
    to make them more easily identifiable:'
  id: totrans-719
  prefs: []
  type: TYPE_NORMAL
  zh: 从Nagios 3.0开始，你可以在主机、服务和联系定义中指定自己的宏。这些宏在Nagios术语中被称为*自定义宏*，它们被像正常的标准宏一样处理，并且它们的名称以下划线开头，以便更容易识别：
- en: '[PRE21]'
  id: totrans-720
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'They are addressed with a prefixed object type:'
  id: totrans-721
  prefs: []
  type: TYPE_NORMAL
  zh: 它们使用前缀对象类型来表示：
- en: '[PRE22]'
  id: totrans-722
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: The macro again starts with an underscore, but the underscore supplied in the
    definition is omitted. This is difficult to read. If you want to use the underscore
    as a separator, for instance between **`HOST`** and **`NSCLIENT_PORT`**, the custom
    macro must begin with a double underscore. Thus,
  id: totrans-723
  prefs: []
  type: TYPE_NORMAL
  zh: 该宏再次以下划线开头，但在定义中提供的下划线被省略。这很难阅读。如果你想在**`HOST`**和**`NSCLIENT_PORT`**之间使用下划线作为分隔符，例如，自定义宏必须以两个下划线开头。因此，
- en: '[PRE23]'
  id: totrans-724
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: turns into
  id: totrans-725
  prefs: []
  type: TYPE_NORMAL
  zh: 转换为
- en: '[PRE24]'
  id: totrans-726
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: In the definition of a custom macro, upper and lower case are not distinguished,
    but when the macro is called it is always written in capitals. Besides providing
    abbreviations for content used mainly for documentation purposes, such as **`ASSETID`**
    or **`DEPARTMENT`**, such user-defined macros can also be used to neatly define
    commands.
  id: totrans-727
  prefs: []
  type: TYPE_NORMAL
  zh: 在自定义宏的定义中，大小写不区分，但在调用宏时，它总是以大写形式书写。除了为主要用于文档目的的内容提供缩写，如**`ASSETID`**或**`DEPARTMENT`**，此类用户定义宏还可以用来整洁地定义命令。
- en: For example, if you are monitoring a Windows environment with the NS-Client
    mechanism, a service is installed on the host being monitored that listens to
    a specific port ([20.2.1 NSClient](../Text/ch20s02.html#nsclient "20.2.1 NSClient"),
    page 464). Under certain circumstances you will be forced to change the standard
    port. If you now have several servers with different ports, you must tell the
    plugin on which port it is to run the query.
  id: totrans-728
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果你使用NS-Client机制监控Windows环境，则在被监控的主机上安装了一个服务，该服务监听特定的端口（[20.2.1 NSClient](../Text/ch20s02.html#nsclient
    "20.2.1 NSClient"), 第464页）。在特定情况下，你将被迫更改标准端口。如果你现在有多个服务器，它们使用不同的端口，你必须告诉插件它在哪个端口上运行查询。
- en: One method would be to also include the port as an argument for each service
    definition, or to define a second command with a permanently stored, alternative
    port. However, if the port on the target system is now changed, the entire service
    definition of the target system must be modified.
  id: totrans-729
  prefs: []
  type: TYPE_NORMAL
  zh: 一种方法是将端口也作为每个服务定义的参数包含在内，或者定义一个带有永久存储的备用端口的第二个命令。然而，如果目标系统上的端口现在已更改，则必须修改目标系统的整个服务定义。
- en: A more elegant solution is to store the port, as above, as a custom macro in
    the host definition and to evaluate the custom macro in the command.
  id: totrans-730
  prefs: []
  type: TYPE_NORMAL
  zh: 一个更优雅的解决方案是将端口，如上所述，存储为主机定义中的自定义宏，并在命令中评估该自定义宏。
- en: This solution, which unfortunately works only in Nagios 3.0, is described for
    the NSClient service in [20.2.5 Rectifying problems with port 1248](../Text/ch20s02.html#rectifying_problems_with_port
    "20.2.5 Rectifying problems with port 1248") from page 471, and an equivalent
    example for NRPE can be found in [H.2 Variable and Macros](../Text/aphs02.html
    "H.2 Variable and Macros") from page 685.
  id: totrans-731
  prefs: []
  type: TYPE_NORMAL
  zh: 这种解决方案遗憾的是只能在Nagios 3.0中工作，它在[20.2.5 端口1248问题的修正](../Text/ch20s02.html#rectifying_problems_with_port
    "20.2.5 端口1248问题的修正")的第471页中进行了描述，NRPE的等效示例可以在[H.2 变量和宏](../Text/aphs02.html "H.2
    变量和宏")的第685页找到。
- en: 'D.4 Macro Contents: Not Everything Is Allowed'
  id: totrans-732
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: D.4 宏内容：并非所有内容都允许
- en: A number of macros contain values that were not defined within the Nagios configuration
    or defined by Nagios itself, but which originate from external programs. These
    include macros that record the plugin output (**`$HOSTOUTPUT$`**, **`$LONGHOSTOUTPUT$`**,
    **`$HOSTPERFDATA$`**), and the corresponding macros for services. Via the Web
    interface, the administrator can pass on values to Nagios through acknowledgments,
    which can be read out from the macros **`$HOSTACKAUTHOR$`**, **`$HOSTACKCOMMENT$`**,
    and the equivalent service macros.
  id: totrans-733
  prefs: []
  type: TYPE_NORMAL
  zh: 许多宏包含的值既不是在Nagios配置中定义的，也不是由Nagios本身定义的，而是来自外部程序。这些包括记录插件输出的宏（**`$HOSTOUTPUT$`**、**`$LONGHOSTOUTPUT$`**、**`$HOSTPERFDATA$`**），以及对应服务的宏。通过Web界面，管理员可以通过确认来将值传递给Nagios，这些值可以从宏**`$HOSTACKAUTHOR$`**、**`$HOSTACKCOMMENT$`**和等效的服务宏中读取。
- en: 'To guard against the possibility that these macros might contain damaging code,
    which might trigger a buffer overflow or enable other mischievous things, Nagios
    removes "dangerous" lines. What these are is defined by the parameter **`illegal_object_name_chars`**
    ([A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")):'
  id: totrans-734
  prefs: []
  type: TYPE_NORMAL
  zh: 为了防止这些宏可能包含的破坏性代码，这些代码可能会触发缓冲区溢出或启用其他恶意行为，Nagios会移除“危险”的行。这些“危险”的行由参数**`illegal_object_name_chars`**定义（[A.1
    主配置文件nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    主配置文件nagios.cfg"))：
- en: '[PRE25]'
  id: totrans-735
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: The Nagios administrator can change these, but he must be aware that fewer characters
    means a higher potential of risk.
  id: totrans-736
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios管理员可以更改这些设置，但他必须意识到字符越少，潜在的风险越高。
- en: Appendix E. Single Sign-On for the Nagios Web Interface
  id: totrans-737
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 附录E. Nagios Web界面的单点登录
- en: For the login to the Web interface, Nagios takes the user who has authenticated
    himself to the Web server, usually Apache. In principle it makes no difference
    how this authentication comes about, but the name of the contact must match the
    user name passed on to the CGI programs from the Web server. Nagios is quite tolerant
    in terms of its name conventions here. Even user names such as **`wob@EXAMPLE.NET`**
    or **`EXAMPLE/wob`** are possible. This is enabled by *single sign-on (SSO)*,
    which means that users only need to log on a single time. Ideally, all applications
    should accept the authentication that has already been performed, and the user
    will not be asked for a password every time.
  id: totrans-738
  prefs: []
  type: TYPE_NORMAL
  zh: 对于Web界面的登录，Nagios使用已经对Web服务器进行身份验证的用户，通常是Apache。原则上，这种身份验证是如何发生的没有区别，但联系人的名称必须与从Web服务器传递给CGI程序的用户名相匹配。Nagios在这里对名称约定相当宽容。即使是**`wob@EXAMPLE.NET`**或**`EXAMPLE/wob`**这样的用户名也是可能的。这是通过*单点登录（SSO）*实现的，这意味着用户只需要登录一次。理想情况下，所有应用程序都应接受已经完成的身份验证，用户不需要每次都输入密码。
- en: Security experts have been busy discussing the pros and cons^([[316](#ftn.APP-E-FN-1)])
    of single sign-on, but it is very popular with users. We will therefore not go
    into the disscussion on security.
  id: totrans-739
  prefs: []
  type: TYPE_NORMAL
  zh: 安全专家们一直在忙于讨论单点登录的利弊^([[316](#ftn.APP-E-FN-1)))，但它在用户中非常受欢迎。因此，我们不会深入讨论安全问题。
- en: Single sign-on, in combination with the Nagios Web interface, means that the
    user is automatically authenticated from the browser when the Nagios CGI programs
    are called, and a password is no longer required. Of course, what is described
    here can also be used for other Web pages—this could be the NagVis, PNP, or a
    Wiki. There are hardly any limits to the opportunities for using single sign-on.
  id: totrans-740
  prefs: []
  type: TYPE_NORMAL
  zh: 单点登录与Nagios Web界面的结合意味着，当调用Nagios CGI程序时，用户会自动从浏览器进行身份验证，不再需要密码。当然，这里所描述的也可以用于其他Web页面——这可能是NagVis、PNP或Wiki。单点登录的使用机会几乎没有限制。
- en: This chapter describes the use of two alternative Apache modules for Apache
    2 that enable a single sign-on scenario. As the authentication server, a running
    Active Directory in Windows 2003 is required.^([[317](#ftn.APP-E-FN-2)]) On the
    client side, the browser used must support the selected HTTP authentication procedure.
    Microsoft Internet Explorer and Firefox are both suitable for this.
  id: totrans-741
  prefs: []
  type: TYPE_NORMAL
  zh: 本章描述了 Apache 2 中两个替代模块的使用，这些模块可以启用单点登录场景。作为认证服务器，需要 Windows 2003 上运行的活动目录.^([[317](#ftn.APP-E-FN-2)])
    在客户端，使用的浏览器必须支持所选的 HTTP 认证程序。微软 Internet Explorer 和 Firefox 都适合这个用途。
- en: The Apache module **`mod_auth_kerb`** uses Kerberos directly, and could therefore
    be used in an exclusively Linux environment (without Active Directory). Since
    the author himself does not have a production Kerberos environment with Linux
    clients available, we will not deal with this topic here. If you are running a
    fully functional Kerberos environment in Linux/Unix, you should find it easy to
    modify the **`mod_auth_kerb`** section to your environment.
  id: totrans-742
  prefs: []
  type: TYPE_NORMAL
  zh: Apache 模块 **`mod_auth_kerb`** 直接使用 Kerberos，因此可以在仅限 Linux 环境中使用（没有 Active Directory）。由于作者自己没有可用的生产
    Kerberos 环境，包括 Linux 客户端，所以我们在这里不会讨论这个话题。如果你在 Linux/Unix 上运行一个完全功能的 Kerberos 环境，你应该很容易修改
    **`mod_auth_kerb`** 部分以适应你的环境。
- en: The Apache module **`mod_auth_ntlm_winbind`** makes use of **`ntlm_auth`**,
    a program that is a component of Samba 3.0\. It therefore requires a complete
    Samba installation, and the server must be a member of an Active Directory domain.
  id: totrans-743
  prefs: []
  type: TYPE_NORMAL
  zh: Apache 模块 **`mod_auth_ntlm_winbind`** 利用 **`ntlm_auth`**，这是一个 Samba 3.0 的组件。因此，它需要一个完整的
    Samba 安装，服务器必须是 Active Directory 域的成员。
- en: E.1 HTTP Authentication for Single Sign-On
  id: totrans-744
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: E.1 单点登录的 HTTP 认证
- en: Microsoft has supported single sign-on via Web browser for some time now. The
    original procedure was based on (*NT LAN Manager (NTLM)*, a protocol that is also
    used in networks, for example when logging in to a domain or when accessing network
    drives. Here the client sends a so-called *type 1 message* containing the host
    and domain names of the client. The server replies with an NTLM challenge (an
    NTLM *type 2 message*), and the client completes authentication with a *type 3
    message*, which in turn sends back to the server not only the client name and
    domain, but also the challenge, which has been encrypted with the client's password.
    The procedure is Microsoft-specific and was never published as a standard. Nevertheless,
  id: totrans-745
  prefs: []
  type: TYPE_NORMAL
  zh: 微软已经支持通过 Web 浏览器进行单点登录一段时间了。原始程序基于 (*NT 网络管理器 (NTLM)*，这是一种在网络中使用的协议，例如在登录域或访问网络驱动器时。在这里，客户端发送一个包含客户端主机和域名所谓的
    *类型 1 消息*。服务器回复一个 NTLM 挑战（一个 NTLM *类型 2 消息*），客户端通过一个 *类型 3 消息*完成认证，这个消息反过来发送回服务器，不仅包括客户端名称和域名，还包括用客户端密码加密的挑战。这个程序是微软特有的，从未作为标准发布。尽管如此，
- en: Firefox is able to use it. The HTTP authentication-related descriptions of the
    NTLM protocol can also be found on the Internet.^([[318](#ftn.APP-E-FN-3)])
  id: totrans-746
  prefs: []
  type: TYPE_NORMAL
  zh: Firefox 能够使用它。NTLM 协议与 HTTP 认证相关的描述也可以在互联网上找到.^([[318](#ftn.APP-E-FN-3)])
- en: Microsoft will soon replace the NTLM-based authentication with a newer, Kerberos-based
    authentication. With Windows Server 2008, NTLM will no longer be available for
    HTTP authentication, at least on the server side.
  id: totrans-747
  prefs: []
  type: TYPE_NORMAL
  zh: 微软将很快用基于 Kerberos 的新认证替换基于 NTLM 的认证。在 Windows Server 2008 中，NTLM 将不再可用于 HTTP
    认证，至少在服务器端。
- en: The successor to this has already been in practical use for some time. It uses
    a generic interface called *Generic Security Services Application Program Interface
    (GSSAPI)*. For HTTP authentication, as well as GSSAPI, a mechanism called *SPNEGO
    (Simple and Protected Negotiate*) is used, through which concrete authentication
    is negotiated. Microsoft describes the HTTP authentication in an informal Request
    for Comment, RFC 4559.^([[319](#ftn.APP-E-FN-4)]) This also discusses the NTLM
    procedure. The SPNEGO, used for the newer variation, is described in RFC 4178.^([[320](#ftn.APP-E-FN-5)])
  id: totrans-748
  prefs: []
  type: TYPE_NORMAL
  zh: 这种技术的继任者已经实际应用了一段时间。它使用了一个名为 *通用安全服务应用程序接口 (GSSAPI)* 的通用接口。对于 HTTP 认证，以及 GSSAPI，使用了一个名为
    *SPNEGO (简单保护协商)* 的机制，通过该机制进行具体的认证协商。微软在非正式的请求评论 (RFC 4559) 中描述了 HTTP 认证.^([[319](#ftn.APP-E-FN-4)])
    这也讨论了 NTLM 程序。用于较新变体的 SPNEGO 在 RFC 4178 中描述.^([[320](#ftn.APP-E-FN-5)])
- en: 'The SPNEGO procedure is somewhat shorter than the NTLM authentication and is
    closer to the HTTP authentication methods **`Basic`** and **`Digest`**. First,
    the client requests a protected page with the command **`GET`**. The server replies
    with the status code **`401`** (Unauthorized) and includes the possible authentication
    procedures:'
  id: totrans-749
  prefs: []
  type: TYPE_NORMAL
  zh: SPNEGO 流程比 NTLM 认证要短一些，并且更接近 HTTP 认证方法 **`Basic`** 和 **`Digest`**。首先，客户端使用 **`GET`**
    命令请求受保护的页面。服务器回复状态码 **`401`** (Unauthorized) 并包含可能的认证流程：
- en: '[PRE26]'
  id: totrans-750
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'The server in this example provides a choice of three procedures: **`Negotiate`**
    stands for the Kerberos-based SPNEGO procedure, **`NTLM`** stands for the older
    NTLM authentication, and **`Basic`** refers to the classic user password method
    in which the authentication data are transmitted in plain text. It is now up to
    the client to decide on one of the three procedures. The client—here an instance
    of Microsoft Internet Explorer 6.0—selects the secure Kerberos-based procedure:'
  id: totrans-751
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个示例中，服务器提供了三种流程的选择：**`Negotiate`** 代表基于 Kerberos 的 SPNEGO 流程，**`NTLM`** 代表较旧的
    NTLM 认证，而 **`Basic`** 指的是经典的用户密码方法，其中认证数据以明文形式传输。现在客户端需要决定使用这三种流程中的哪一种。客户端——这里是一个
    Microsoft Internet Explorer 6.0 的实例——选择了基于安全的 Kerberos 流程：
- en: '[PRE27]'
  id: totrans-752
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: After the HTTP header field **`Authorization`** comes the keyword **`Negotiate`**,
    followed by the Base64-encoded authentication data. If this is successful,
  id: totrans-753
  prefs: []
  type: TYPE_NORMAL
  zh: 在 HTTP 头部字段 **`Authorization`** 之后是关键字 **`Negotiate`**，后面跟着 Base64 编码的认证数据。如果成功，
- en: 'the server replies in turn with the HTTP code **`200`** (OK), and the HTTP
    header also contains authentication data,^([[321](#ftn.APP-E-FN-6)]) which the
    client processes:'
  id: totrans-754
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器依次回复 HTTP 状态码 **`200`** (OK)，并且 HTTP 头部也包含认证数据，^([[321](#ftn.APP-E-FN-6)])
    客户端会处理这些数据：
- en: '[PRE28]'
  id: totrans-755
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: If successful, the browser will display the HTTP page it has received. The negotiate
    procedure is shown in a somewhat simplified form here, and it is possible that
    the server sends back a **`401`** code (Unauthorized) with the **`WWW-Authenticate`**
    field after it receives the **`Authorization`** packet of the client, because
    further authentication data is required. The client then sends another **`Authorization`**
    header entry, as requested. This is repeated until the server answers with **`200
    OK`**.
  id: totrans-756
  prefs: []
  type: TYPE_NORMAL
  zh: 如果成功，浏览器将显示它接收到的 HTTP 页面。这里以某种简化的形式展示了协商过程，服务器在接收到客户端的 **`Authorization`** 数据包后，可能会发送回
    **`401`** 状态码 (Unauthorized) 和 **`WWW-Authenticate`** 字段，因为需要进一步的身份验证数据。客户端随后发送另一个
    **`Authorization`** 头部条目，如请求所示。这个过程会重复，直到服务器回复 **`200 OK`**。
- en: '* * *'
  id: totrans-757
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[316](#APP-E-FN-1)]) [http://en.wikipedia.org/wiki/Single_sign_on](http://en.wikipedia.org/wiki/Single_sign_on)
  id: totrans-758
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[316](#APP-E-FN-1)]) [http://en.wikipedia.org/wiki/Single_sign_on](http://en.wikipedia.org/wiki/Single_sign_on)
- en: ^([[317](#APP-E-FN-2)]) The scenario described may also work with Windows 2000,
    but the author was not able to test this. Nevertheless, there are certainly differences
    in the Kerberos implementation between Windows 2000 and Windows 2003, which probably
    require adjustments to the procedure descrbed here.
  id: totrans-759
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[317](#APP-E-FN-2)]) 所描述的场景也可能适用于 Windows 2000，但作者未能进行测试。尽管如此，Windows 2000
    和 Windows 2003 在 Kerberos 实现上肯定存在差异，这可能导致需要对这里描述的流程进行调整。
- en: ^([[318](#APP-E-FN-3)]) [http://www.innovation.ch/personal/ronald/ntlm.html](http://www.innovation.ch/personal/ronald/ntlm.html),
    in more detail at [http://davenport.sourceforge.net/ntlm.html](http://davenport.sourceforge.net/ntlm.html)
  id: totrans-760
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[318](#APP-E-FN-3)]) [http://www.innovation.ch/personal/ronald/ntlm.html](http://www.innovation.ch/personal/ronald/ntlm.html)，更详细的信息请见
    [http://davenport.sourceforge.net/ntlm.html](http://davenport.sourceforge.net/ntlm.html)
- en: ^([[319](#APP-E-FN-4)]) [http://rfc.sunsite.dk/rfc/rfc4559.html](http://rfc.sunsite.dk/rfc/rfc4559.html)
  id: totrans-761
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[319](#APP-E-FN-4)]) [http://rfc.sunsite.dk/rfc/rfc4559.html](http://rfc.sunsite.dk/rfc/rfc4559.html)
- en: ^([[320](#APP-E-FN-5)]) [http://rfc.sunsite.dk/rfc/rfc4178.html](http://rfc.sunsite.dk/rfc/rfc4178.html)
  id: totrans-762
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[320](#APP-E-FN-5)]) [http://rfc.sunsite.dk/rfc/rfc4178.html](http://rfc.sunsite.dk/rfc/rfc4178.html)
- en: ^([[321](#APP-E-FN-6)]) In general, Kerberos provides authentication on both
    sides, so the server must also authenticate itself with the client.
  id: totrans-763
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[321](#APP-E-FN-6)]) 通常，Kerberos 在双方都提供认证，因此服务器也必须向客户端进行自我认证。
- en: E.2 Kerberos Authentication with **`mod_auth_kerb`**
  id: totrans-764
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: E.2 使用 **`mod_auth_kerb`** 进行 Kerberos 认证
- en: 'The module **`mod_auth_kerb`** integrates Apache into an existing Kerberos
    environment and allows authentication through two procedures: simple authentication
    with the **`Basic`** method or the negotiation procedure SP-NEGO, described in
    RFC 4559.'
  id: totrans-765
  prefs: []
  type: TYPE_NORMAL
  zh: 模块 **`mod_auth_kerb`** 将 Apache 集成到现有的 Kerberos 环境中，并允许通过两种方式进行认证：使用 **`Basic`**
    方法的简单认证或 RFC 4559 中描述的协商过程 SP-NEGO。
- en: Both procedures are shown in [Figure E-1](../Text/apes02.html#mod_auth_kerb_allows_full
    "Figure E-1. mod_auth_kerb allows full authentication via Kerberos, via SPNEGO.
    With the Basic procedure, communication between Web server and Kerberos server
    also runs via the Kerberos protocol."). For an authentication via negotiate (only
    Kerberos v5), the client fetches a ticket from the Kerberos server (1), which
    it forwards to the Web server (2). The Web server in turn sends the ticket via
    the Kerberos protocol to the Kerberos server for inspection (3). What is not shown
    is the response of the Web server to the client if authentication is successful
    (or if it fails).
  id: totrans-766
  prefs: []
  type: TYPE_NORMAL
  zh: 两个程序都在 [图 E-1](../Text/apes02.html#mod_auth_kerb_allows_full "图 E-1. `mod_auth_kerb`
    允许通过 Kerberos 和 SPNEGO 进行完全认证。使用 `Basic` 程序，Web 服务器和 Kerberos 服务器之间的通信也通过 Kerberos
    协议进行。") 中展示。对于通过协商认证（仅 Kerberos v5），客户端从 Kerberos 服务器获取票据（1），并将其转发给 Web 服务器（2）。Web
    服务器随后通过 Kerberos 协议将票据发送给 Kerberos 服务器进行验证（3）。未展示的是，如果认证成功（或失败），Web 服务器对客户端的响应。
- en: '![mod_auth_kerb allows full authentication via Kerberos, via SPNEGO. With the
    Basic procedure, communication between Web server and Kerberos server also runs
    via the Kerberos protocol.](../Images/tagoreillycom20081104nostarchimages224026.png)'
  id: totrans-767
  prefs: []
  type: TYPE_IMG
  zh: '![`mod_auth_kerb` 允许通过 Kerberos 和 SPNEGO 进行完全认证。使用 `Basic` 程序，Web 服务器和 Kerberos
    服务器之间的通信也通过 Kerberos 协议进行。](../Images/tagoreillycom20081104nostarchimages224026.png)'
- en: Figure E-1. `mod_auth_kerb` allows full authentication via Kerberos, via SPNEGO.
    With the `Basic` procedure, communication between Web server and Kerberos server
    also runs via the Kerberos protocol.
  id: totrans-768
  prefs: []
  type: TYPE_NORMAL
  zh: 图 E-1. `mod_auth_kerb` 允许通过 Kerberos 和 SPNEGO 进行完全认证。使用 `Basic` 程序，Web 服务器和
    Kerberos 服务器之间的通信也通过 Kerberos 协议进行。
- en: With the **`Basic`** authentication the client sends a user/password pair in
    plain text to the Web server (4). The server for its part, however, transmits
    the authentication data via the Kerberos protocol to the Kerberos server (5)—which
    doen't alter the fact that the authentication between the Web server and client
    takes place without protection. It is essential that SSL encryption is used here.
    The Web server itself has a permanent ticket for the HTTP service so that it can
    communicate with the Kerberos server in the first place.
  id: totrans-769
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 **`Basic`** 认证，客户端将用户/密码对以明文形式发送到 Web 服务器（4）。然而，服务器部分通过 Kerberos 协议将认证数据传输到
    Kerberos 服务器（5）——这并不改变 Web 服务器和客户端之间的认证没有保护的事实。在这里使用 SSL 加密是至关重要的。Web 服务器本身有一个用于
    HTTP 服务的永久票据，以便它首先可以与 Kerberos 服务器通信。
- en: E.2.1 Installation
  id: totrans-770
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: E.2.1 安装
- en: The module is available at SourceForge,^([[322](#ftn.APP-E-FN-7)]) where you
    can also find some notes on the installation and a little documentation. Modern
    distributions include the module as a package, which has the advantage that you
    don't need to worry about the dependencies of other packages—the installer automatically
    installs the required software. In Debian "Etch" the module is called **`libapache2-mod-auth-kerb`**.
    You should have at least version 5.3, since earlier versions have some minor bugs,
    especially when working with Microsoft Internet Explorer 6.0.^([[323](#ftn.APP-E-FN-8)])
  id: totrans-771
  prefs: []
  type: TYPE_NORMAL
  zh: 该模块可在 SourceForge 上找到，^([[322](#ftn.APP-E-FN-7)]) 其中也提供了一些关于安装和少量文档的说明。现代发行版将该模块作为包提供，这有一个优点，即您无需担心其他包的依赖关系——安装程序会自动安装所需的软件。在
    Debian "Etch" 中，该模块称为 **`libapache2-mod-auth-kerb`**。您应该至少拥有版本 5.3，因为早期版本有一些小错误，尤其是在与
    Microsoft Internet Explorer 6.0 一起工作时.^([[323](#ftn.APP-E-FN-8)])
- en: 'To carry out the configuration, the programs **`klist`** and **`kinit`** are
    also required, and in Debian "Etch" these can be found in the package **`krb5-user`**
    (and not in **`krb5-clients`**!). One more note on Kerberos itself: The description
    in this book is based on the Kerberos implementation of the Massachusetts Institute
    of Technology (MIT), which is also used in Microsoft Windows.'
  id: totrans-772
  prefs: []
  type: TYPE_NORMAL
  zh: 执行配置需要程序 **`klist`** 和 **`kinit`**，在 Debian "Etch" 中，这些程序可以在包 **`krb5-user`**（而不是
    **`krb5-clients`**）中找到！关于 Kerberos 本身的一个额外说明：本书中的描述基于麻省理工学院（MIT）的 Kerberos 实现，该实现也用于
    Microsoft Windows。
- en: E.2.2 Creating a service ticket for Apache
  id: totrans-773
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: E.2.2 为 Apache 创建服务票据
- en: 'To participate in the Kerberos procedure, Apache requires a service ticket
    with a quite specific realm:'
  id: totrans-774
  prefs: []
  type: TYPE_NORMAL
  zh: 要参与 Kerberos 流程，Apache 需要一个具有相当特定领域的服务票据：
- en: '[PRE29]'
  id: totrans-775
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: This consists of the protocol, in this case **`HTTP`**, the fully qualified
    domain name (FQDN), and the realm of the domain. The protocol and the domain realm
    must be written in capitals, and the FQDN must exactly match the name with which
    the Web server is addressed later on. Otherwise, the client will refuse to work
    during the negotiate procedure. Below, **`nagios.example.net`** will be used as
    the FQDN, and the domain controller has the name **`dc01.example.net`**.
  id: totrans-776
  prefs: []
  type: TYPE_NORMAL
  zh: 这包括协议，在本例中为**`HTTP`**，完全限定域名（FQDN）和域的域。协议和域域必须大写，FQDN必须与Web服务器稍后使用的名称完全匹配。否则，客户端将在协商过程中拒绝工作。下面，将使用**`nagios.example.net`**作为FQDN，域控制器名称为**`dc01.example.net`**。
- en: 'The Kerberos implementation in Windows 2003 requires that the service ticket
    is bound to one user. To do this, a user is set up (in the example, **`webnagios`**)
    who does not need to have any special permissions. To create a ticket manually,
    you need the support tools in an Active Directory environment, which are best
    installed on a domain controller. After the installation, you change to the directory
    where the support tools are located and create the service ticket with the program
    **`ktpass`**:'
  id: totrans-777
  prefs: []
  type: TYPE_NORMAL
  zh: Windows 2003中的Kerberos实现要求服务票据绑定到一个用户。为此，需要设置一个用户（在示例中为**`webnagios`**），该用户不需要任何特殊权限。要手动创建票据，需要Active
    Directory环境中的支持工具，最好安装在域控制器上。安装后，切换到支持工具所在的目录，并使用程序**`ktpass`**创建服务票据：
- en: '[PRE30]'
  id: totrans-778
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: The ticket is then copied to a directory, preferably in the Apache installation,
    for example to **`/etc/apache2/keytabs`**.
  id: totrans-779
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，票据将被复制到一个目录中，最好是Apache安装目录中，例如到**`/etc/apache2/keytabs`**。
- en: E.2.3 Kerberos configuration
  id: totrans-780
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: E.2.3 Kerberos配置
- en: '**`/etc/krb5.conf`** is used as the configuration file for Kerberos:'
  id: totrans-781
  prefs: []
  type: TYPE_NORMAL
  zh: '**`/etc/krb5.conf`**用作Kerberos的配置文件：'
- en: '[PRE31]'
  id: totrans-782
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: The **`[libdefaults]`** section basically defines the defaults. It is important
    here that the domain realm is written in upper case. In the **`[realms]`** section,
    the individual realms are defined with their respective servers. The parameter
    **`kdc`** describes Kerberos servers that act as a key service (all domain controllers
    in the Active Directory), and **`admin_server`** is the Kerberos master (normally
    the first domain controller in the Active Directory). It must be possible to resolve
    the name specified here into an IP address, which can be tested with a **`ping`**
    to the FQDN given here.
  id: totrans-783
  prefs: []
  type: TYPE_NORMAL
  zh: '**`[libdefaults]`**部分基本上定义了默认值。在这里，重要的是域域必须大写。在**`[realms]`**部分，定义了各自的域和相应的服务器。参数**`kdc`**描述了充当密钥服务的Kerberos服务器（Active
    Directory中的所有域控制器），而**`admin_server`**是Kerberos主服务器（通常是Active Directory中的第一个域控制器）。必须能够将这里指定的名称解析为IP地址，这可以通过对给定的FQDN进行**`ping`**测试来验证。'
- en: 'To see if Kerberos is working, it is best to use the program **`kinit`**, which—if
    successful—will obtain a valid ticket from the Kerberos server:'
  id: totrans-784
  prefs: []
  type: TYPE_NORMAL
  zh: 要检查Kerberos是否工作，最好使用程序**`kinit`**，如果成功，它将从Kerberos服务器获取一个有效的票据：
- en: '[PRE32]'
  id: totrans-785
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '**`kinit`** requires a valid account as an argument, and it is important that
    the domain after the user name is written in upper case. If the password is correct
    and everything works, **`kinit`** will have no output. The ticket obtained can
    now be shown, with **`klist`**:'
  id: totrans-786
  prefs: []
  type: TYPE_NORMAL
  zh: '**`kinit`**需要一个有效的账户作为参数，并且用户名后的域名必须大写。如果密码正确且一切正常，**`kinit`**将没有输出。现在可以使用**`klist`**显示获取的票据：'
- en: '[PRE33]'
  id: totrans-787
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: E.2.4 Apache configuration
  id: totrans-788
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: E.2.4 Apache配置
- en: You must make sure that Apache really does load the module **`mod_auth_kerb`**
    when it starts. When installing through a distribution, the module is already
    preconfigured. In Debian "Etch" the accompanying **`LoadModule`** directive can
    be found in the file **`/etc/apache2/mods-available/auth_ kerb.load:`**
  id: totrans-789
  prefs: []
  type: TYPE_NORMAL
  zh: 确保Apache在启动时确实加载了模块**`mod_auth_kerb`**。通过发行版安装时，模块已经预先配置。在Debian "Etch"中，可以在文件**`/etc/apache2/mods-available/auth_kerb.load:`**中找到相应的**`LoadModule`**指令。
- en: '[PRE34]'
  id: totrans-790
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'For activation, Debian uses the command **`a2enmod`**, which basically does
    nothing more than place a symlink in the directory **`/etc/apache2/mods-enabled/`**,
    pointing to the configuration file:'
  id: totrans-791
  prefs: []
  type: TYPE_NORMAL
  zh: 对于激活，Debian使用命令**`a2enmod`**，该命令基本上只是在一个目录中放置一个指向配置文件的符号链接**`/etc/apache2/mods-enabled/`**。
- en: '[PRE35]'
  id: totrans-792
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'To be able to use Kerberos for authentication, you need to modify the Apache
    configuration file **`/etc/apache2/conf.d/nagios.conf`**, which was described
    in [1.5.3 User authentication](../Text/ch01s05.html#user_authentication "1.5.3
    User authentication") ([1.5.2 SELinux](../Text/ch01s05.html#selinux "1.5.2 SELinux")):'
  id: totrans-793
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用 Kerberos 进行身份验证，您需要修改 Apache 配置文件 **`/etc/apache2/conf.d/nagios.conf`**，该文件在
    [1.5.3 用户身份验证](../Text/ch01s05.html#user_authentication "1.5.3 用户身份验证") ([1.5.2
    SELinux](../Text/ch01s05.html#selinux "1.5.2 SELinux")) 中有描述：
- en: '[PRE36]'
  id: totrans-794
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: '**`AuthType`** specifies that Kerberos should be used. With **`AuthName`**
    the authentication is given a name, which is displayed in the **`Basic`** authentication.
    **`KrbAuthRealms`** describes one or more domain realms, and if there are several,
    they are separated by spaces.'
  id: totrans-795
  prefs: []
  type: TYPE_NORMAL
  zh: '**`AuthType`** 指定应使用 Kerberos。通过 **`AuthName`** 为身份验证赋予一个名称，该名称将在 **`Basic`**
    身份验证中显示。**`KrbAuthRealms`** 描述一个或多个域领域，如果有多个，则由空格分隔。'
- en: The service ticket generated on the domain controller is specified under **`Krb5Keytab`**.
    **`KrbMethodK5Passwd on`**, apart from the negotiate procedure, allows simple
    authentication using a password, in which the browser sends the password via **`Basic`**
    authentication to the Web server. With **`KrbMethodNegotiate on`** the negotiate
    procedure is switched on, and a completely closed Kerberos circuit is established.
    Then **`KrbSaveCredentials`** determines whether received authentication data
    are to be cached, in case other CGI applications should use these automatically.
    This is not necessary for our purposes, which is why we switch it off with the
    **`off`** option. Finally, **`require valid-user`** ensures that only valid users
    can gain access. A more detailed configuration, such as specifying a group or
    individual users, is not necessary, because Nagios manages its users itself and
    needs only the name of the authenticated user.
  id: totrans-796
  prefs: []
  type: TYPE_NORMAL
  zh: 在域控制器上生成的服务票据在 **`Krb5Keytab`** 下指定。**`KrbMethodK5Passwd on`** 除了协商过程外，还允许使用密码进行简单身份验证，其中浏览器通过
    **`Basic`** 身份验证将密码发送到 Web 服务器。通过 **`KrbMethodNegotiate on`** 开启协商过程，并建立一个完全封闭的
    Kerberos 电路。然后 **`KrbSaveCredentials`** 决定是否缓存接收到的身份验证数据，以防其他 CGI 应用程序应自动使用这些数据。对于我们来说，这并不是必要的，因此我们使用
    **`off`** 选项将其关闭。最后，**`require valid-user`** 确保只有有效用户才能访问。不需要更详细的配置，例如指定组或单个用户，因为
    Nagios 自己管理其用户，只需要认证用户的名称。
- en: E.2.5 Definition of a Nagios contact
  id: totrans-797
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: E.2.5 Nagios 联系人定义
- en: To be able to use single sign-on in Nagios, you now just need to adapt the name
    of the contact to the new, authenticated Web user **`user@REALM:`**
  id: totrans-798
  prefs: []
  type: TYPE_NORMAL
  zh: 要在 Nagios 中使用单点登录，现在您只需将联系人的名称修改为新认证的 Web 用户 **`user@REALM:`**
- en: '[PRE37]'
  id: totrans-799
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'The contact definition (see [2.7 Defining Addressees for Error Messages: contact](../Text/ch02s07.html
    "2.7 Defining Addressees for Error Messages: contact") in page 70) assumes that
    a template (see [2.11 Templates](../Text/ch02s11.html "2.11 Templates") in page
    75) exists with the name **`template-contact-webuser`**.'
  id: totrans-800
  prefs: []
  type: TYPE_NORMAL
  zh: 联系人定义（见第 70 页的 [2.7 定义错误消息接收者：联系人](../Text/ch02s07.html "2.7 定义错误消息接收者：联系人")）假设存在一个名为
    **`template-contact-webuser`** 的模板（见第 75 页的 [2.11 模板](../Text/ch02s11.html "2.11
    模板")）。
- en: When modifying the authentication and the name change connected with this, you
    must also modify the CGI configuration file **`cgi.cfg`** (see [A.2 CGI Configuration
    in cgi.cfg](../Text/apas02.html "A.2 CGI Configuration in cgi.cfg") from page
    606), if this is to explicitly contain entered users in the **`authorized_*`**
    parameters.
  id: totrans-801
  prefs: []
  type: TYPE_NORMAL
  zh: 当修改身份验证及其相关的名称更改时，您还必须修改 CGI 配置文件 **`cgi.cfg`**（见第 606 页的 [A.2 cgi.cfg 中的 CGI
    配置](../Text/apas02.html "A.2 cgi.cfg 中的 CGI 配置")），如果需要明确包含在 **`authorized_*`**
    参数中的用户。
- en: '* * *'
  id: totrans-802
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[322](#APP-E-FN-7)]) [http://modauthkerb.sourceforge.net/](http://modauthkerb.sourceforge.net/)
  id: totrans-803
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[322](#APP-E-FN-7)]) [http://modauthkerb.sourceforge.net/](http://modauthkerb.sourceforge.net/)
- en: ^([[323](#APP-E-FN-8)]) Even if the negotiation procedure was being used at
    browser startup, a password window pops up after a while and the IE switches back
    to Basic authentication.
  id: totrans-804
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[323](#APP-E-FN-8)]) 即使在浏览器启动时使用了协商过程，一段时间后仍会弹出密码窗口，IE 浏览器会切换回基本身份验证。
- en: E.3 Single Sign-On with **`mod_auth_ntlm_winbind`**
  id: totrans-805
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: E.3 使用 **`mod_auth_ntlm_winbind`** 进行单点登录
- en: The Apache module **`mod_auth_ntlm_winbind`** uses the program originally developed
    for Squid, **`ntlm_auth`**, for authentication, and so one of its requirements
    is a Samba server installation in which the server itself is a member of an Active
    Directory domain. **`ntlm_auth`** uses **`winbind`** and therefore offers smooth
    integration into an existing Active Directory.
  id: totrans-806
  prefs: []
  type: TYPE_NORMAL
  zh: Apache模块**`mod_auth_ntlm_winbind`**使用最初为Squid开发的程序**`ntlm_auth`**进行身份验证，因此其要求之一是在其中服务器本身是Active
    Directory域成员的Samba服务器安装。**`ntlm_auth`**使用**`winbind`**，因此可以平滑地集成到现有的Active Directory中。
- en: 'The module has three methods available for authentication: NTLM, Negotiate
    (SPNEGO), and the **`Basic`** authentication. In Summer 2007 there were still
    problems with Negotiate. Developed originally for a proxy, the method did not
    quite fit the needs of a Web server and therefore was not used. At the time of
    writing, NTLM and **`Basic`** authentication remain, but this may change after
    this book is published. NTLM works very well, whereby **`ntlm_auth`** also allows
    the selection of a specific group. But you should also bear in mind that Microsoft
    is discontinuing NTLM for HTTP authentication with Windows Server 2008.'
  id: totrans-807
  prefs: []
  type: TYPE_NORMAL
  zh: 该模块提供了三种身份验证方法：NTLM、Negotiate（SPNEGO）和**`Basic`**身份验证。在2007年夏季，Negotiate仍然存在问题。该方法最初是为代理开发的，并不完全符合Web服务器的需求，因此没有被使用。在撰写本文时，NTLM和**`Basic`**身份验证仍然存在，但在此书出版后可能会发生变化。NTLM工作得非常好，其中**`ntlm_auth`**还允许选择特定的组。但你也应该记住，Microsoft正在停止在Windows
    Server 2008中使用NTLM进行HTTP身份验证。
- en: E.3.1 Installation
  id: totrans-808
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: E.3.1 安装
- en: The module is still very new. It has the version number 0.0.0 and can only be
    obtained in the source code from Subversion^([[324](#ftn.APP-E-FN-9)]) or from
    corresponding **`unpacked`** directories.^([[325](#ftn.APP-E-FN-10)]) Some documentation,
    in addition to the included **`README`**, can be found at SourceForge.^([[326](#ftn.APP-E-FN-11)])
  id: totrans-809
  prefs: []
  type: TYPE_NORMAL
  zh: 该模块仍然非常新。它的版本号是0.0.0，只能从Subversion源代码或相应的**`unpacked`**目录中获取。除了包含的**`README`**之外，你还可以在SourceForge上找到一些文档。[^[[324](#ftn.APP-E-FN-9)]][^[[325](#ftn.APP-E-FN-10)]][^[[326](#ftn.APP-E-FN-11)]]
- en: 'For the installation you change to the directory where the source code has
    been unpacked:'
  id: totrans-810
  prefs: []
  type: TYPE_NORMAL
  zh: 对于安装，你切换到源代码解压的目录：
- en: '[PRE38]'
  id: totrans-811
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: '**`autoconf`** generates a **`configure`** file, which is then run to query
    the specific system parameters. The classic **`make ; make install`** usually
    doesn''t work; luckily, there is no more work involved in running the Apache extension
    tool **`apxs2`** directly, which knows the precise settings of the installed Apache
    environment. The option **`-c`** compiles the C file specified, and **`-i`** installs
    the result to the directory where the other dynamically loadable modules are located.'
  id: totrans-812
  prefs: []
  type: TYPE_NORMAL
  zh: '**`autoconf`**生成一个**`configure`**文件，然后运行以查询特定的系统参数。经典的**`make ; make install`**通常不起作用；幸运的是，运行Apache扩展工具**`apxs2`**时不再需要更多的工作，它知道已安装Apache环境的精确设置。选项**`-c`**编译指定的C文件，而**`-i`**将结果安装到其他可动态加载的模块所在的目录。'
- en: 'For Debian there is an Apache configuration file in the form of the file **`auth_ntlm_winbind.load`**
    in the subdirectory **`debian`**, which automatically loads the module when Apache
    is started:'
  id: totrans-813
  prefs: []
  type: TYPE_NORMAL
  zh: 对于Debian，Apache配置文件以**`auth_ntlm_winbind.load`**文件的形式存在于**`debian`**子目录中，当Apache启动时会自动加载该模块：
- en: '[PRE39]'
  id: totrans-814
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: This file is copied to the directory **`/etc/apache2/mods-available`**, and
    it is activated with **`a2enmod auth_ntlm_winbind`**.
  id: totrans-815
  prefs: []
  type: TYPE_NORMAL
  zh: 此文件被复制到目录**`/etc/apache2/mods-available`**，并通过**`a2enmod auth_ntlm_winbind`**激活。
- en: 'For other distributions the entry shown is entered in the file in which the
    dynamic modules are loaded, and the path to the module directory is adjusted accordingly.
    Then Apache is started again:'
  id: totrans-816
  prefs: []
  type: TYPE_NORMAL
  zh: 对于其他发行版，显示的条目被输入到动态模块加载的文件中，并相应地调整模块目录的路径。然后重新启动Apache：
- en: '[PRE40]'
  id: totrans-817
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: A simple restart will not be sufficient in most cases.
  id: totrans-818
  prefs: []
  type: TYPE_NORMAL
  zh: 在大多数情况下，简单的重启是不够的。
- en: E.3.2 Preparing Samba
  id: totrans-819
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: E.3.2 准备Samba
- en: So that **`mod_auth_ntlm_winbind`** can perform its services, the server on
    which Apache is running must be included in the Active Directory domain as the
    Samba server. To do this, you need a current Samba-3 server package. The installation
    is best performed using the on-board resources of the distribution.
  id: totrans-820
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使**`mod_auth_ntlm_winbind`**能够执行其服务，运行Apache的服务器必须作为Samba服务器包含在Active Directory域中。为此，你需要一个当前的Samba-3服务器软件包。最好使用发行版的内置资源进行安装。
- en: 'For the domain membership, Kerberos (as described in [E.2.3 Kerberos configuration](../Text/apes02.html#kerberos_configuration
    "E.2.3 Kerberos configuration") from page 642) must be completely configured,
    and in addition you need a valid administrator ticket for access to the domain,
    obtained using **`kinit`**. If Samba is used only for the Apache module, a very
    simple Samba configuration is sufficient:'
  id: totrans-821
  prefs: []
  type: TYPE_NORMAL
  zh: 对于域成员资格，Kerberos（如第 642 页的 [E.2.3 Kerberos 配置](../Text/apes02.html#kerberos_configuration
    "E.2.3 Kerberos configuration") 中所述）必须完全配置，并且您还需要使用 **`kinit`** 获得的有效的管理员票据来访问域。如果仅使用
    Samba 的 Apache 模块，则足够简单的 Samba 配置即可：
- en: '[PRE41]'
  id: totrans-822
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: '**`workgroup`** and **`realm`** correspond to the NetBIOS domain names and
    the fully written-out domain name of the Active Directory domain. For **`realm`**,
    it is again important that you write the name in capitals. **`security=ads`**
    describes the membership in an Active Directory domain. For the password server
    you must give at least one, and preferably two, domain controllers; **`encrypt
    passwords = yes`** is mandatory.'
  id: totrans-823
  prefs: []
  type: TYPE_NORMAL
  zh: '**`workgroup`** 和 **`realm`** 分别对应 NetBIOS 域名和 Active Directory 域的完整域名。对于 **`realm`**，再次强调，您必须将名称大写。**`security=ads`**
    描述了 Active Directory 域的成员资格。对于密码服务器，您至少需要提供一个，最好提供两个域控制器；**`encrypt passwords
    = yes`** 是强制性的。'
- en: The parameters **`idmap*`** and **`winbind enum*`** map Windows users and groups
    to Unix users and groups. For the **`winbind separator`** you should select a
    Unix-compatible character, normally **`/`**, to separate the domain from the user
    name, as in **`EXAMPLE/wob`**. If this results in problems with applications,
    however, you can replace this character with another one, provided that Nagios
    can handle it. Here **`hosts allow`** allows access only from the local host.
  id: totrans-824
  prefs: []
  type: TYPE_NORMAL
  zh: 参数 **`idmap*`** 和 **`winbind enum*`** 将 Windows 用户和组映射到 Unix 用户和组。对于 **`winbind
    separator`**，您应该选择一个与 Unix 兼容的字符，通常是 **`/`**，以分隔域名和用户名，例如 **`EXAMPLE/wob`**。如果这导致应用程序出现问题，则可以替换此字符为另一个字符，前提是
    Nagios 可以处理它。在这里 **`hosts allow`** 只允许来自本地主机的访问。
- en: 'The parameter **`winbind use default domain`** defines whether a missing domain
    should be replaced automatically by the default domain from **`workgroup`**. Then
    the domain can be omitted in the **`Basic`** authentication. At the same time,
    **`mod_auth_ntlm_winbind`** removes the domain name in the HTTP user. Users are
    treated differently, depending on the domain membership: Users from external domains
    are assigned to the HTTP user **`FOREIGN/`****``*`user`*``**, whereas users from
    the same domain are assigned only to **``*`user`*``** (without a domain in front).
    If you are just using a single domain, you can set the parameter to **`yes`**,
    and you will no longer need to worry about a possible prefixed domain.'
  id: totrans-825
  prefs: []
  type: TYPE_NORMAL
  zh: 参数 **`winbind use default domain`** 定义了是否应该自动用 **`workgroup`** 的默认域替换缺失的域。然后可以在
    **`Basic`** 认证中省略域。同时，**`mod_auth_ntlm_winbind`** 从 HTTP 用户中移除域名。用户根据域成员资格被不同对待：来自外部域的用户被分配到
    HTTP 用户 **`FOREIGN/`****``*`user`*``**，而来自同一域的用户只分配到 **``*`user`*``**（前面没有域）。如果您只使用单个域，可以将参数设置为
    **`yes`**，这样您就不再需要担心可能的前缀域。
- en: 'Access to the domain is achieved with the Samba command **`net ads join`**:'
  id: totrans-826
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Samba 命令 **`net ads join`** 来实现域访问：
- en: '[PRE42]'
  id: totrans-827
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'After successfully joining, it is essential that you restart both Samba and
    Winbind:'
  id: totrans-828
  prefs: []
  type: TYPE_NORMAL
  zh: 在成功加入后，您必须重新启动 Samba 和 Winbind：
- en: '[PRE43]'
  id: totrans-829
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'You can test whether everything is working properly with **`wbinfo -t`**. The
    command runs an encrypted RPC call, which is only possible if the server really
    is a member in the domain:'
  id: totrans-830
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用 **`wbinfo -t`** 测试是否一切正常。该命令运行加密的 RPC 调用，只有当服务器确实是域成员时才可能：
- en: '[PRE44]'
  id: totrans-831
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: If you still want to play around a bit with Winbind, you can display all users
    displayed with **`wbinfo -u`** and all groups with **`wbinfo -g`**. When run for
    the first time after being started, it will take a while until the two programs
    display anything.
  id: totrans-832
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您还想稍微玩一下 Winbind，可以使用 **`wbinfo -u`** 显示所有用户，使用 **`wbinfo -g`** 显示所有组。在启动后首次运行时，需要一段时间两个程序才会显示任何内容。
- en: 'For authentication, Apache calls the program **`ntlm_auth`** with the permissions
    under which the Web server is running. In Debian this is the user **`www-data`**
    from the group **`www-data`**. With his permissions, **`ntlm_auth`** tries to
    access the directory **`/var/lib/samba/winbindd_privileged/`**. This must belong
    to the user **`root`** and be readable for the user under which Apache is running,
    and otherwise nobody else may access the directory:'
  id: totrans-833
  prefs: []
  type: TYPE_NORMAL
  zh: 对于认证，Apache 使用 Web 服务器运行的权限调用程序 **`ntlm_auth`**。在 Debian 中，这是来自 **`www-data`**
    组的 **`www-data`** 用户。在他的权限下，**`ntlm_auth`** 尝试访问目录 **`/var/lib/samba/winbindd_privileged/`**。这必须属于用户
    **`root`**，并且对于 Apache 运行的用户来说是可读的，否则其他人无法访问该目录：
- en: '[PRE45]'
  id: totrans-834
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: If the access permissions are incorrectly set, **`ntlm_auth`** will refuse its
    services.
  id: totrans-835
  prefs: []
  type: TYPE_NORMAL
  zh: 如果访问权限设置不正确，**`ntlm_auth`** 将拒绝提供服务。
- en: E.3.3 Apache configuration
  id: totrans-836
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: E.3.3 Apache 配置
- en: 'The module **`mod_auth_ntlm_winbind`** requires only a few entries in the Apache
    configuration file **`/etc/apache2/conf.d/nagios.conf`**, since the overwhelming
    part of the configuration takes place in Kerberos and Samba. The file **`nagios.conf`**,
    described in [1.5.3 User authentication](../Text/ch01s05.html#user_authentication
    "1.5.3 User authentication") (page 49), is changed as follows:'
  id: totrans-837
  prefs: []
  type: TYPE_NORMAL
  zh: 模块 **`mod_auth_ntlm_winbind`** 只需要在 Apache 配置文件 **`/etc/apache2/conf.d/nagios.conf`**
    中进行少量条目，因为配置的大部分工作都在 Kerberos 和 Samba 中完成。在 [1.5.3 用户认证](../Text/ch01s05.html#user_authentication
    "1.5.3 用户认证")（第 49 页）中描述的文件 **`nagios.conf`** 的更改如下：
- en: '[PRE46]'
  id: totrans-838
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Only three parameters are needed for NTLM authentication: **`AuthType`** selects
    the authentication module, **`NTLMAuth`** on activates the NTLM procedure, and
    **`NTLMAuthHelper`** defines the specific call of **`ntlm_auth`**. Here the protocol
    **`squid-2.5-ntlmssp`** is used, which was originally intended for Squid.'
  id: totrans-839
  prefs: []
  type: TYPE_NORMAL
  zh: NTLM 认证只需要三个参数：**`AuthType`** 选择认证模块，**`NTLMAuth`** 激活 NTLM 流程，**`NTLMAuthHelper`**
    定义 **`ntlm_auth`** 的具体调用。这里使用的是协议 **`squid-2.5-ntlmssp`**，它最初是为 Squid 设计的。
- en: The **`Basic`** authentication, in which the browser sends user and password
    in plain text to the Web server, also requires a *Basic Realm* to be specified
    in the form of the parameter **`NTLMBasicRealm`**. The value of the parameter
    **`NTLMBasic Authoritative`** controls whether a failed attempt (User not found)
    can then be answered (**`on`**) or whether further authentication modules—if they
    exist—should be queried (**`off`**).
  id: totrans-840
  prefs: []
  type: TYPE_NORMAL
  zh: '**`Basic`** 认证，其中浏览器以明文形式将用户名和密码发送到 Web 服务器，还需要指定一个 *Basic Realm*，形式为参数 **`NTLMBasicRealm`**。参数
    **`NTLMBasic Authoritative`** 的值控制是否可以回答失败尝试（用户未找到），或者是否应该查询其他认证模块（如果存在）(**`off`**)。'
- en: If it does not really functon properly, the negotiation procedure should not
    be configured under any circumstances. If the Web server offers negotiation along
    with the other procedures, the browser will always choose to negotiate. The authentication
    is then bound to fail.
  id: totrans-841
  prefs: []
  type: TYPE_NORMAL
  zh: 如果它确实无法正常工作，则无论如何都不应配置协商过程。如果 Web 服务器提供与其他过程一起协商，则浏览器将始终选择协商。然后认证将注定失败。
- en: By the way, with the **`ntlm_auth`** parameter **`--require-membership-of`**,
    membership in a particular group can be forced. **`/usr/bin/ntlm_auth--require-membership-of
    =EXAMPLE/admins`** returns OK only if the user who is authenticating himself is
    a member of the group **`admins`**. The separator/corresponds to the value of
    **`winbind separator`** given in **`smb.conf`**.
  id: totrans-842
  prefs: []
  type: TYPE_NORMAL
  zh: 顺便说一下，使用 **`ntlm_auth`** 参数 **`--require-membership-of`** 可以强制特定组的成员资格。**`/usr/bin/ntlm_auth--require-membership-of
    =EXAMPLE/admins`** 只有当正在认证自己的用户是 **`admins`** 组的成员时才返回 OK。分隔符对应于在 **`smb.conf`**
    中给出的 **`winbind separator`** 的值。
- en: E.3.4 Defining a Nagios contact
  id: totrans-843
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: E.3.4 定义 Nagios 联系人
- en: 'In the definition of the contact, the setting **`winbind use default domain`**
    in the Samba configuration file **`smb.conf`** must be taken into account. If
    the value **`no`** is given there (or if the parameter is not given at all), the
    contact name will always consist of the domain, written in capitals, the **`winbind
    separator`**, and the user name:'
  id: totrans-844
  prefs: []
  type: TYPE_NORMAL
  zh: 在联系人定义中，必须考虑 Samba 配置文件 **`smb.conf`** 中的设置 **`winbind use default domain`**。如果那里给出
    **`no`** 值（或者参数根本未给出），则联系人名称将始终由域名（大写）、**`winbind separator`** 和用户名组成：
- en: '[PRE47]'
  id: totrans-845
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: On the other hand, if **`winbind use default domain`** is set to **`yes`**,
    the domain is omitted for users in the domain to which the Nagios server belongs.
    For users in external domains, the naming convention with the prefixed domain
    is retained.
  id: totrans-846
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，如果 **`winbind use default domain`** 设置为 **`yes`**，则对于属于 Nagios 服务器所属域的用户，将省略域名。对于外部域的用户，则保留带有前缀域的命名约定。
- en: '* * *'
  id: totrans-847
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[324](#APP-E-FN-9)]) svn co [svn://svnanon.samba.org/lorikeet/trunk/mod_auth_ntlm_winbind_mod_auth_ntlm_winbind](svn://svnanon.samba.org/lorikeet/trunk/mod_auth_ntlm_winbind_mod_auth_ntlm_winbind)
  id: totrans-848
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[324](#APP-E-FN-9)]) svn co [svn://svnanon.samba.org/lorikeet/trunk/mod_auth_ntlm_winbind_mod_auth_ntlm_winbind](svn://svnanon.samba.org/lorikeet/trunk/mod_auth_ntlm_winbind_mod_auth_ntlm_winbind)
- en: ^([[325](#APP-E-FN-10)]) [http://samba.org/ftp/unpacked/lorikeet/mod_auth_ntlm_winbind/](http://samba.org/ftp/unpacked/lorikeet/mod_auth_ntlm_winbind/)
  id: totrans-849
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[325](#APP-E-FN-10)]) [http://samba.org/ftp/unpacked/lorikeet/mod_auth_ntlm_winbind/](http://samba.org/ftp/unpacked/lorikeet/mod_auth_ntlm_winbind/)
- en: ^([[326](#APP-E-FN-11)]) [http://adldap.sourceforge.net/mod_auth_ntlm_winbind.php](http://adldap.sourceforge.net/mod_auth_ntlm_winbind.php)
  id: totrans-850
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[326](#APP-E-FN-11)]) [http://adldap.sourceforge.net/mod_auth_ntlm_winbind.php](http://adldap.sourceforge.net/mod_auth_ntlm_winbind.php)
- en: E.4 Mozilla Firefox as a Web Client
  id: totrans-851
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: E.4 Mozilla Firefox 作为 Web 客户端
- en: Configuring the Mozilla Web browser in Windows XP is very simple, provided that
    the workstation is a member in the Active Directory domain. With the address **`about:config`**
    you can call up the current configuration in Firefox and enter **`negotiate`**
    as the filter (see [Figure E-2](../Text/apes04.html#single_sign-on_via_spnego_solidus
    "Figure E-2. Single sign-on via SPNEGO/Kerberos is enabled in the Firefox settings
    under network.negotiate")). In the **`network.negotiate-auth.trusted-uris`** parameter
    you enter all hosts or domains for which an automatic login should take place.
    Multiple entries are separated by spaces or commas. If a target host or its domain
    is not in the list, Firefox will certainly ask for the user name and password.
    These are transmitted in plain text, however, which is why you should prefer automatic
    login in all cases.
  id: totrans-852
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Windows XP 中配置 Mozilla 网络浏览器非常简单，前提是工作站是 Active Directory 域的成员。使用地址 **`about:config`**
    您可以在 Firefox 中调用当前配置，并将 **`negotiate`** 作为过滤器输入（见[图 E-2](../Text/apes04.html#single_sign_on_via_spnego_solidus
    "图 E-2. 在 Firefox 的 `network.negotiate` 设置下启用了通过 SPNEGO/Kerberos 的单点登录")）。在 **`network.negotiate-auth.trusted-uris`**
    参数中，您输入所有应自动登录的主机或域名。多个条目由空格或逗号分隔。如果目标主机或其域名不在列表中，Firefox 将肯定会要求用户名和密码。然而，这些信息是以明文形式传输的，因此您应始终优先选择自动登录。
- en: '![Single sign-on via SPNEGO/Kerberos is enabled in the Firefox settings under
    network.negotiate](../Images/tagoreillycom20081104nostarchimages224028.png.jpg)'
  id: totrans-853
  prefs: []
  type: TYPE_IMG
  zh: '![在 Firefox 的 `network.negotiate` 设置下启用了通过 SPNEGO/Kerberos 的单点登录](../Images/tagoreillycom20081104nostarchimages224028.png.jpg)'
- en: Figure E-2. Single sign-on via SPNEGO/Kerberos is enabled in the Firefox settings
    under `network.negotiate`
  id: totrans-854
  prefs: []
  type: TYPE_NORMAL
  zh: 图 E-2. 在 Firefox 的 `network.negotiate` 设置下启用了通过 SPNEGO/Kerberos 的单点登录。
- en: In Linux you can also authenticate yourself with Firefox automatically via the
    negotiation procedure. You need only a valid user ticket to do this.
  id: totrans-855
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Linux 中，您也可以通过协商过程自动使用 Firefox 进行身份验证。您只需要一个有效的用户票据即可完成此操作。
- en: 'As long as the Linux workstation logins are not already actively processed
    via Kerberos, it is enough just to obtain the ticket manually with **`kinit`**.
    In addition the file **`/etc/krb5.conf`** must be configured as described in [E.2.3
    Kerberos configuration](../Text/apes02.html#kerberos_configuration "E.2.3 Kerberos
    configuration") from page 642\. As a normal user, you fetch the ticket with the
    realm of the corresponding Windows user:'
  id: totrans-856
  prefs: []
  type: TYPE_NORMAL
  zh: 只要 Linux 工作站登录尚未通过 Kerberos 活跃处理，只需使用 **`kinit`** 手动获取票据即可。此外，文件 **`/etc/krb5.conf`**
    必须按照[第 E.2.3 节 Kerberos 配置](../Text/apes02.html#kerberos_configuration "第 E.2.3
    节 Kerberos 配置")中从第 642 页所述进行配置。作为普通用户，您可以使用对应 Windows 用户的领域获取票据：
- en: '[PRE48]'
  id: totrans-857
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: Afterward, you can check with **`klist`** to see whether you really have received
    a ticket. This is usually only valid for eight hours. After the time has expired,
    you must fetch a new ticket, because without a valid ticket Firefox will announce
    itself again with the user/password query.
  id: totrans-858
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，您可以使用 **`klist`** 检查是否真的收到了票据。这通常只有效八小时。时间过期后，您必须获取新的票据，因为没有有效的票据，Firefox
    将再次通过用户/密码查询宣布自己。
- en: E.4.1 Firefox and NTLM
  id: totrans-859
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: E.4.1 Firefox 和 NTLM
- en: Along with the SPNEGO/Kerberos procedure, Firefox is also capable of performing
    authentication via NTLM. To do this, you enter the desired domains or hosts in
    the parameter **`network.automatic-ntlm-auth.trusted-uris`**. In Windows XP, everything
    else runs automatically.
  id: totrans-860
  prefs: []
  type: TYPE_NORMAL
  zh: 除了SPNEGO/Kerberos过程外，Firefox也能够通过NTLM进行身份验证。为此，你需要在参数**`network.automatic-ntlm-auth.trusted-uris`**中输入所需的域或主机。在Windows
    XP中，其他所有操作都会自动进行。
- en: 'In Linux, NTLM authentication is normally not available, since a Linux client
    cannot authenticate itself via NTLM to a Windows domain in the Active Directory.
    But there is also a solution here: the *NTLM Authorization Proxy Server* **`ntlmaps`**^([[327](#ftn.APP-E-FN-12)])
    allows even Linux clients to take part in an NTLM-based Web authentication. A
    description of this would go beyond the scope of this book, however.'
  id: totrans-861
  prefs: []
  type: TYPE_NORMAL
  zh: 在Linux中，通常不可用NTLM身份验证，因为Linux客户端无法通过NTLM在Active Directory中验证自身到Windows域。但这里也有解决方案：*NTLM授权代理服务器*
    **`ntlmaps`**^([[327](#ftn.APP-E-FN-12)]) 允许Linux客户端参与基于NTLM的Web身份验证。然而，对此的描述将超出本书的范围。
- en: '* * *'
  id: totrans-862
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[327](#APP-E-FN-12)]) [http://ntlmaps.sourceforge.net/](http://ntlmaps.sourceforge.net/)
  id: totrans-863
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[327](#APP-E-FN-12)]) [http://ntlmaps.sourceforge.net/](http://ntlmaps.sourceforge.net/)
- en: E.5 Microsoft Internet Explorer as a Web Client
  id: totrans-864
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: E.5 微软Internet Explorer作为Web客户端
- en: Microsoft Internet Explorer can handle both the SPNEGO/Kerberos and the NTLM
    authentication procedures. For reasons of security, however, Internet Explorer
    does not always immediately provide information on account data. You should therefore
    enter the Nagios host in the security settings under **Trusted Sites**, using
    exactly the same URL that it will be called with later on ([Figure E-3](../Text/apes05.html#how_to_add_hosts_for_trusted
    "Figure E-3. How to add hosts for trusted sites in Internet Explorer")).
  id: totrans-865
  prefs: []
  type: TYPE_NORMAL
  zh: 微软Internet Explorer可以处理SPNEGO/Kerberos和NTLM身份验证过程。然而，出于安全考虑，Internet Explorer并不总是立即提供账户数据信息。因此，你应该在安全设置下的**受信任站点**中输入Nagios主机，使用与之后调用时完全相同的URL（[图E-3](../Text/apes05.html#how_to_add_hosts_for_trusted
    "图E-3. 如何在Internet Explorer中添加受信任站点的主机")）。
- en: '![How to add hosts for trusted sites in Internet Explorer](../Images/tagoreillycom20081104nostarchimages224030.png.jpg)'
  id: totrans-866
  prefs: []
  type: TYPE_IMG
  zh: '![如何在Internet Explorer中添加受信任站点的主机](../Images/tagoreillycom20081104nostarchimages224030.png.jpg)'
- en: Figure E-3. How to add hosts for trusted sites in Internet Explorer
  id: totrans-867
  prefs: []
  type: TYPE_NORMAL
  zh: 图E-3. 如何在Internet Explorer中添加受信任站点的主机
- en: In addition you should check, in **Custom Level**, whether the user name and
    password really need to be transmitted for the level selected ([Figure E-4](../Text/apes05.html#when_updating_the_trustworthy_sites
    "Figure E-4. When updating the trustworthy sites, Automatic logon with current
    user name and password must be checked")). After the changes, it does not do any
    harm to restart Internet Explorer.
  id: totrans-868
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，你还应该在**自定义级别**中检查，是否真的需要为所选级别传输用户名和密码（[图E-4](../Text/apes05.html#when_updating_the_trustworthy_sites
    "图E-4. 在更新受信任站点时，必须勾选“自动使用当前用户名和密码登录")））。更改后，重启Internet Explorer并不会造成任何伤害。
- en: '![When updating the trustworthy sites, Automatic logon with current user name
    and password must be checked](../Images/tagoreillycom20081104nostarchimages224032.png.jpg)'
  id: totrans-869
  prefs: []
  type: TYPE_IMG
  zh: '![在更新受信任站点时，必须勾选“自动使用当前用户名和密码登录”](../Images/tagoreillycom20081104nostarchimages224032.png.jpg)'
- en: Figure E-4. When updating the trustworthy sites, Automatic logon with current
    user name and password must be checked
  id: totrans-870
  prefs: []
  type: TYPE_NORMAL
  zh: 图E-4. 在更新受信任站点时，必须勾选“自动使用当前用户名和密码登录”
- en: Appendix F. Tips on Optimizing Performance
  id: totrans-871
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 附录F. 优化性能的技巧
- en: It is very difficult to describe, in general terms, a Nagios installation that
    performs well. Nagios should perform checks immediately, that is, it should have
    a small *latency time* for host and service checks. This is the difference between
    the planned and actual execution times of the check. If this is an hour or more,
    you can certainly talk about disastrous performance. On the other hand, latency
    of less than a second represents very good performance. In between these extremes,
    the borders between acceptable and unacceptable are somewhat hazy.
  id: totrans-872
  prefs: []
  type: TYPE_NORMAL
  zh: 用一般术语描述一个性能良好的Nagios安装是非常困难的。Nagios应该立即执行检查，也就是说，它应该对主机和服务检查有很小的*延迟时间*。这是检查的计划执行时间和实际执行时间之间的差异。如果这是一个小时或更长时间，你当然可以谈论灾难性的性能。另一方面，小于一秒的延迟代表非常好的性能。在这两个极端之间，可接受和不可接受之间的界限有些模糊。
- en: 'The latency time of host and service checks can be measured objectively. Other,
    more subjective impressions are more difficult to evaluate. Doggedly working on
    the command line of the host, a really high system load, or a long time lag for
    a page to be displayed when the Nagios Web interface is called: whether such things
    are regarded as performance problems or can be tolerated, depends on what your
    specific requirements are. If the Web interface always needs more than ten seconds
    to display even just a few services, this is certainly not acceptable for interactive
    use. A load of 40 on a powerful 4-CPU machine may not be a problem, while a load
    of 10 on a less powerful system may already be catastrophic.'
  id: totrans-873
  prefs: []
  type: TYPE_NORMAL
  zh: 主机和服务的延迟时间可以客观地测量。其他更为主观的印象更难评估。在主机命令行上坚持不懈地工作，系统负载极高，或者当调用Nagios Web界面时页面显示时间过长：这些是否被视为性能问题或可以容忍，取决于您的具体要求。如果Web界面显示即使是少量服务也需要超过十秒钟，这当然不适合交互式使用。在强大的4-CPU机器上，负载为40可能不是问题，而在较不强大的系统上，负载为10可能已经灾难性。
- en: Of course, the capacity of the host system on which Nagios is installed also
    heavily influences the overall performance. A very slow RAID system, for instance,
    could slow down Nagios considerably if Nagios wants to write a large number of
    check results to the RAID within a short period of time, and the NDOUtils simultaneously
    want to save all events to a database. If the latency values of Nagios are within
    tolerance, there is no reason from the perspective of Nagios to change the configuration
    of the RAID system.
  id: totrans-874
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，Nagios安装的主机系统的容量也会严重影响整体性能。例如，一个非常慢的RAID系统，如果Nagios需要在短时间内将大量检查结果写入RAID，并且NDOUtils同时想要将所有事件保存到数据库中，那么它可能会显著减慢Nagios的速度。如果Nagios的延迟值在容许范围内，从Nagios的角度来看，就没有理由更改RAID系统的配置。
- en: So that we can better distinguish between individual qualities, we will introduce
    two concepts here. A *performance indicator* is a measure of the objective performance
    of Nagios. The latency time of service and host checks is by far the best choice
    for a performance indicator. As soon as anything at all starts creating problems
    for Nagios, this nearly always manifests itself directly in the latency.
  id: totrans-875
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地区分个体品质，我们在这里引入两个概念。一个*性能指标*是衡量Nagios客观性能的度量。服务主机检查的延迟时间到目前为止是最佳的性能指标。一旦任何问题开始影响Nagios，这几乎总是直接体现在延迟上。
- en: '*Problem indicators*, on the other hand, are parameters which may point to
    a possible problem, but whose absolute values alone does not allow a judgment
    to be made about the actual performance. These may be system measurements, such
    as a high CPU load or permanent swapping of the host on which Nagios is running,
    or they may be internal Nagios measurements, such as a permanently full queue
    for the results of external commands (see [F.2.6 Preferring passive checks](../Text/apfs03.html
    "F.2.6 Preferring passive checks") in page 666).'
  id: totrans-876
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，*问题指标*是可能指向潜在问题的参数，但仅凭其绝对值本身并不能对实际性能做出判断。这些可能是系统测量，例如高CPU负载或Nagios运行的主机上的永久性交换，或者它们可能是Nagios的内部测量，例如外部命令结果的永久性满队列（参见第666页的[F.2.6
    优先使用被动检查](../Text/apfs03.html "F.2.6 优先使用被动检查")）。
- en: F.1 Internal Statistics of Nagios
  id: totrans-877
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: F.1 Nagios的内部统计
- en: 'Nagios displays a short version of the performance indicators in the so-called
    tactical overview of the Web interface, at the top right, (see Figure in [16.2.4
    The most important things at a glance: tac.cgi](../Text/ch16s02.html#the_most_important_things_at_a_glance_c
    "16.2.4 The most important things at a glance: tac.cgi")), and a slightly more
    detailed version via **`extinfo.cgi`** (see Figure in [16.2.2 Additional information
    and control center: extinfo.cgi](../Text/ch16s02.html#additional_information_and_control_cent
    "16.2.2 Additional information and control center: extinfo.cgi")). In addition,
    the command-line program **`nagiostats`** shows individual performance values
    or a summary of all data.'
  id: totrans-878
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios在Web界面的所谓战术概览中显示性能指标的简短版本，位于右上角（参见[16.2.4 一目了然的最重要事项：tac.cgi](../Text/ch16s02.html#the_most_important_things_at_a_glance_c
    "16.2.4 一目了然的最重要事项：tac.cgi")中的图），并通过**`extinfo.cgi`**显示一个稍微详细一点的版本（参见[16.2.2 额外信息和控制中心：extinfo.cgi](../Text/ch16s02.html#additional_information_and_control_cent
    "16.2.2 额外信息和控制中心：extinfo.cgi")中的图）。此外，命令行程序**`nagiostats`**显示个别性能值或所有数据的摘要。
- en: F.1.1 The command-line tool nagiostats
  id: totrans-879
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: F.1.1 Nagios的命令行工具nagiostats
- en: '**`nagiostats`** is installed automatically during the Nagios installation
    and is located in the same directory as the main **`nagios`** program itself (in
    our case: **`/usr/local/nagios/bin`**). It requires, as a parameter, the main
    configuration file **`nagios.cfg`**, along with the path to it, in order to display
    all values in Nagios 2.x. (For Nagios 3.0 this is not necessary.)'
  id: totrans-880
  prefs: []
  type: TYPE_NORMAL
  zh: '**`nagiostats`** 在安装 Nagios 时自动安装，并且位于主 **`nagios`** 程序相同的目录中（在我们的案例中：**`/usr/local/nagios/bin`**）。它需要一个参数，即主配置文件
    **`nagios.cfg`** 的路径，以便在 Nagios 2.x 中显示所有值。（对于 Nagios 3.0，这并非必需。）'
- en: '[PRE49]'
  id: totrans-881
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: The program first provides information on the evaluated status file and the
    Nagios version. The details of the **`Command Buffers`** in the second paragraph
    are of more interest. If the command buffer becomes full, Nagios will have problems
    processing commands via the interface for external commands. All passive checks
    will suffer from this (see [F.2.6 Preferring passive checks](../Text/apfs03.html
    "F.2.6 Preferring passive checks")).
  id: totrans-882
  prefs: []
  type: TYPE_NORMAL
  zh: 程序首先提供关于评估状态文件和 Nagios 版本的信息。第二段中 **`Command Buffers`** 的详细信息更有趣。如果命令缓冲区满了，Nagios
    将无法通过外部命令的接口处理命令。所有被动检查都会受到影响（参见 [F.2.6 优先选择被动检查](../Text/apfs03.html "F.2.6 优先选择被动检查")）。
- en: The next two blocks provide values on host and service checks. Many of them
    are of a purely informative nature. If the right column contains several values,
    as for the two performance indicators **`Active Service Latency`** and **`Active
    Host Latency`** (shown here in bold type), without the page on left offering any
    explanation of this, then these are the minimum and maximum values and a mean
    value.
  id: totrans-883
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来的两个块提供了主机和服务检查的值。其中许多纯粹是信息性的。如果右侧包含多个值，例如两个性能指标 **`Active Service Latency`**
    和 **`Active Host Latency`**（此处以粗体显示），而左侧页面没有提供任何解释，那么这些是最小值、最大值和平均值。
- en: You should keep an eye on the two problem indicators **`Active Host Execution
    Time`** and **`Active Service Execution Time`**. Long execution times for host
    checks due to failed hosts certainly have a negative influence on Nagios's performance.
    With a standard timeout of 10 seconds for plug-ins, average values of more than
    30 seconds are rather ominous, assuming that long timeouts were not configured
    explicitly. Although long execution times for service checks usually have no significant
    effect on performance, they nevertheless reveal that something is not right.
  id: totrans-884
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该关注两个问题指示器 **`Active Host Execution Time`** 和 **`Active Service Execution
    Time`**。由于失败的主机导致的检查执行时间过长，无疑会对 Nagios 的性能产生负面影响。假设没有明确配置长超时，插件的标准超时时间为 10 秒，超过
    30 秒的平均值相当不祥。尽管服务检查的长时间执行通常对性能没有显著影响，但它们仍然表明某些事情不正常。
- en: The details for **`Active/Passive Host/Service Checks Last 1/5/15 min`** in
    the final information block provide statistics that describe how the current check
    results were determined. The details under **`Scheduled`** deal with the checks
    planned regularly by Nagios, and the **`On-demand`** lines deal with tests executed
    while taking account of current circumstances. For hosts, these include checks
    made due to failed hosts, and, for services, tests triggered by dependencies.
    If a test can be avoided because of an already existing and relatively up-to-date
    value, this is listed in the **`Cached`** line.
  id: totrans-885
  prefs: []
  type: TYPE_NORMAL
  zh: 最终信息块中关于 **`Active/Passive Host/Service Checks Last 1/5/15 min`** 的详细信息提供了描述当前检查结果是如何确定的统计数据。**`Scheduled`**
    下的详细信息处理 Nagios 定期计划执行的检查，而 **`On-demand`** 行处理在考虑当前情况时执行的测试。对于主机，这包括由于主机失败而进行的检查，对于服务，则是由于依赖关系触发的测试。如果可以避免测试，因为已经存在一个相对较新的值，这将在
    **`Cached`** 行中列出。
- en: For host checks, the statistic in the line **`Serial`** also reveals how many
    tests were executed in series in accordance with the inefficient old host check
    logic. The line **`Parallel`** deals with host checks executed in parallel and
    also shows the values for regularly planned and executed host checks. Active host
    checks can contribute in Nagios 3.0 to an improvement in performance. In Nagios
    2.x you should leave them out if possible. The improvements in the host check
    logic are described in [H.7 A New Logic for Host Checks](../Text/aphs07.html "H.7
    A New Logic for Host Checks") in page 689.
  id: totrans-886
  prefs: []
  type: TYPE_NORMAL
  zh: 对于主机检查，**`Serial`** 行中的统计也揭示了根据效率低下的旧主机检查逻辑，串联执行了多少次测试。**`Parallel`** 行处理并行执行的主机检查，并显示定期计划和执行的主机检查的值。在Nagios
    3.0中，主动主机检查可以改善性能。在Nagios 2.x中，如果可能的话，你应该尽量不使用它们。主机检查逻辑的改进在[第H.7节 新的主机检查逻辑](../Text/aphs07.html
    "H.7 A New Logic for Host Checks")中描述，见第689页。
- en: 'The 5-minute average resource of **`Active Service Checks Last`** gives information
    on the activities of Nagios rather than on the absolute number of service checks:
    10,000 service checks with a check interval of 20 minutes result in just 2,500
    checks in the 5-minute average, but 1,000 checks with a check interval of just
    1 minute lead to 5,000 in the 5-minute average.'
  id: totrans-887
  prefs: []
  type: TYPE_NORMAL
  zh: '**`Active Service Checks Last`** 的5分钟平均资源提供了Nagios活动信息，而不是服务检查的绝对数量：20分钟检查间隔的10,000次服务检查在5分钟平均中只产生2,500次检查，但1分钟检查间隔的1,000次检查在5分钟平均中则达到5,000次。'
- en: 'The absolute number of all checks therefore does not mean a lot. The crucial
    issue is how many checks Nagios carries out per time unit: 2,500 service checks
    in 5 minutes results in an average of 8.33 checks per second. This means that
    Nagios starts 8.33 checks every second and at the same time has to gather and
    process the results of 8.33 other checks, forward any performance data to an external
    program, and then it might even have to wait for each check to be handed over.
    If the NDOUtils are used in addition (see [Chapter 17](../Text/ch17.html "Chapter 17. Flexible
    Web Interface with the NDOUtils"), page 375), the system also passes on results
    to the event broker.'
  id: totrans-888
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，所有检查的绝对数量并不代表太多。关键问题是Nagios每单位时间执行了多少次检查：5分钟内的2,500次服务检查导致平均每秒8.33次检查。这意味着Nagios每秒启动8.33次检查，同时还需要收集和处理8.33次其他检查的结果，将任何性能数据转发到外部程序，然后可能还需要等待每个检查完成。如果还使用了NDOUtils（见[第17章](../Text/ch17.html
    "Chapter 17. Flexible Web Interface with the NDOUtils")，第375页），系统还会将结果传递给事件代理。
- en: Determining single values
  id: totrans-889
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 确定单个值
- en: '**`nagiostats`** also displays selected values, with the options **`--mrtg`**
    and **`--data=`****``*`variables`*``**. What values are available here can be
    seen by running **`nagiostats -h:`**'
  id: totrans-890
  prefs: []
  type: TYPE_NORMAL
  zh: '**`nagiostats`** 还显示选定的值，使用**`--mrtg`** 和 **`--data=`****``*`variables`*``**
    选项。这里可用的值可以通过运行**`nagiostats -h:`** 来查看。'
- en: '[PRE50]'
  id: totrans-891
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'Here, the **`x`** in **`NUMACTSVCCHECKSxM`** is replaced with the desired time
    period in minutes: **`1`**, **`5`**, **`15`**, or **`60`**:'
  id: totrans-892
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，**`NUMACTSVCCHECKSxM`** 中的**`x`**被替换为所需的分钟数：**`1`**、**`5`**、**`15`** 或 **`60`**：
- en: '[PRE51]'
  id: totrans-893
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'With **`xxxACTSVCLAT`**, **`nagiostats`** behaves in a similar manner; now
    **`xxx`** is replaced by **`MIN`** (Minimum), **`MAX`** (Maximum), or **`AVG`**
    (mean value). Multiple target values are separated by commas:'
  id: totrans-894
  prefs: []
  type: TYPE_NORMAL
  zh: '**`xxxACTSVCLAT`**，**`nagiostats`** 的行为与此类似；现在**`xxx`**被替换为**`MIN`**（最小值）、**`MAX`**（最大值）或**`AVG`**（平均值）。多个目标值由逗号分隔：'
- en: '[PRE52]'
  id: totrans-895
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: The output here is given in milliseconds, and each value has its own line. The
    average latency time for service checks is therefore 0.203 seconds, and the maximum,
    0.934 seconds. The switch **`--mrtg`** indicates that this output is intended
    primarily for processing by MRTG, as will be seen in the next section. Individual
    output of performance indicators is also very useful when you are writing your
    own plugins. We will look at this in [F.1.3 A plugin to monitor latency](../Text/apf.html#a_plugin_to_monitor_latency
    "F.1.3 A plugin to monitor latency") from page 660.
  id: totrans-896
  prefs: []
  type: TYPE_NORMAL
  zh: 此处的输出以毫秒为单位，每个值占一行。因此，服务检查的平均延迟时间为0.203秒，最大值为0.934秒。**`--mrtg`** 开关表示此输出主要用于由MRTG处理，如下一节所示。当你在编写自己的插件时，性能指标的单个输出也非常有用。我们将在[第F.1.3节
    监控延迟的插件](../Text/apf.html#a_plugin_to_monitor_latency "F.1.3 A plugin to monitor
    latency")中查看，见第660页。
- en: F.1.2 Showing Nagios performance graphically
  id: totrans-897
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: F.1.2 以图形方式显示Nagios性能
- en: The *Multi Router Traffic Grapher (MRTG)*^([[328](#ftn.APP-F-FN-1)]) was originally
    developed to represent the bandwidth of active network components in graphical
    form. MRTG always displays two measured values in a graphic, one as a green area,
    the other as a blue line. When representing network bandwidths, these are normally
    for incoming and outgoing traffic. Nagios uses MRTG to display the values delivered
    by **`nagiostats`**.
  id: totrans-898
  prefs: []
  type: TYPE_NORMAL
  zh: '*多路由器流量图（MRTG）*^([[328](#ftn.APP-F-FN-1)])最初是为了以图形形式表示活动网络组件的带宽而开发的。MRTG始终在图形中显示两个测量值，一个作为绿色区域，另一个作为蓝色线条。在表示网络带宽时，这些通常是入站和出站流量。Nagios使用MRTG来显示**`nagiostats`**提供的值。'
- en: Usually the best way to install MRTG is from the package of the same name provided
    by the distribution you are using. The sources can be found on the homepage.^([[329](#ftn.APP-F-FN-2)])
  id: totrans-899
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，安装MRTG的最佳方式是从您使用的发行版提供的同名软件包中安装。源代码可以在主页上找到.^([[329](#ftn.APP-F-FN-2)])
- en: 'MRTG is run by cron every five minutes. Debian includes the ready-made cron
    table **`/etc/cron.d/mrtg`**; the tool expects its configuration to be in **`/etc/mrtg.cfg`**.
    The file provided by Debian contains just two global settings:'
  id: totrans-900
  prefs: []
  type: TYPE_NORMAL
  zh: MRTG每五分钟由cron运行一次。Debian包含了现成的cron表**`/etc/cron.d/mrtg`**；该工具期望其配置在**`/etc/mrtg.cfg`**。Debian提供的文件仅包含两个全局设置：
- en: '[PRE53]'
  id: totrans-901
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: '**`WorkDir`** specifies the directory in which MRTG should save the current
    graphics, and **`WriteExpires`** creates additional Expire files for Apache. This
    parameter can be omitted, however.'
  id: totrans-902
  prefs: []
  type: TYPE_NORMAL
  zh: '**`WorkDir`** 指定MRTG保存当前图形的目录，**`WriteExpires`** 为Apache创建额外的Expire文件。然而，此参数可以省略。'
- en: To these two lines you simply append the configuration file **`mrtg.cfg`** included
    by Nagios in the **`./sample-config`** directory of the source code.
  id: totrans-903
  prefs: []
  type: TYPE_NORMAL
  zh: 您只需将这些两行追加到Nagios在源代码的**`./sample-config`**目录中包含的配置文件**`mrtg.cfg`**。
- en: 'Finally, you use the program **`indexmaker`**, which is also part of the MRTG
    package, to generate the overview page shown in [Figure F-1](../Text/apf.html#mrtg_overview_page_for
    "Figure F-1. MRTG overview page for the Nagios performance indicators"):'
  id: totrans-904
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，您使用MRTG包中包含的程序**`indexmaker`**来生成如图 [图F-1](../Text/apf.html#mrtg_overview_page_for
    "图F-1. Nagios性能指标概览页") 所示的概览页。
- en: '[PRE54]'
  id: totrans-905
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: '![MRTG overview page for the Nagios performance indicators](../Images/tagoreillycom20081104nostarchimages224034.png.jpg)'
  id: totrans-906
  prefs: []
  type: TYPE_IMG
  zh: '![MRTG性能指标概览页](../Images/tagoreillycom20081104nostarchimages224034.png.jpg)'
- en: Figure F-1. MRTG overview page for the Nagios performance indicators
  id: totrans-907
  prefs: []
  type: TYPE_NORMAL
  zh: 图F-1. Nagios性能指标概览页
- en: If you click on one of the graphics on this page, a detailed view will appear
    that displays the graphs in different time resolutions, as shown in [Figure F-2](../Text/apf.html#detail_view_for_the_lat
    "Figure F-2. Detail view for the latency time for service checks") (daily, weekly,
    monthly, and annually).
  id: totrans-908
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您点击此页上的任何图形，将出现一个详细视图，显示不同时间分辨率的图形，如图 [图F-2](../Text/apf.html#detail_view_for_the_lat
    "图F-2. 服务检查延迟的详细视图")（每日、每周、每月和每年）所示。
- en: '![Detail view for the latency time for service checks](../Images/tagoreillycom20081104nostarchimages224036.png.jpg)'
  id: totrans-909
  prefs: []
  type: TYPE_IMG
  zh: '![服务检查延迟的详细视图](../Images/tagoreillycom20081104nostarchimages224036.png.jpg)'
- en: Figure F-2. Detail view for the latency time for service checks
  id: totrans-910
  prefs: []
  type: TYPE_NORMAL
  zh: 图F-2. 服务检查延迟的详细视图
- en: The graphical display of the check latencies over the course of time allows
    you to see at a glance whether a high latency is a isolated event, part of a trend,
    or a permanent problem. The view in [Figure F-2](../Text/apf.html#detail_view_for_the_lat
    "Figure F-2. Detail view for the latency time for service checks") clearly shows
    that the measures taken on Saturday afternoon^([[330](#ftn.APP-F-FN-3)]) have
    had a positive effect (see weekly graphic). Instead of 20–80 seconds, the service
    check latency now lies at values below one second.
  id: totrans-911
  prefs: []
  type: TYPE_NORMAL
  zh: 随时间推移检查延迟的图形显示让您可以一眼看出高延迟是孤立事件、趋势的一部分还是永久性问题。如图 [图F-2](../Text/apf.html#detail_view_for_the_lat
    "图F-2. 服务检查延迟的详细视图") 所示，周六下午采取的措施已经产生了积极效果（见周度图形）。服务检查的延迟现在低于一秒，不再是20-80秒。
- en: The accompanying online documentation^([[331](#ftn.APP-F-FN-4)]) contains more
    detailed links for each individual graphic, with links to the documentation of
    various parameters that can be used to influence the indicators shown in each
    graphic.
  id: totrans-912
  prefs: []
  type: TYPE_NORMAL
  zh: 伴随的在线文档^([[331](#ftn.APP-F-FN-4)]) 包含每个图形的更详细链接，以及链接到可用于影响每个图形显示的指标的各个参数的文档。
- en: F.1.3 A plugin to monitor latency
  id: totrans-913
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: F.1.3 监控延迟的插件
- en: What could be more appropriate than to have Nagios monitor its own performance
    and, if necessary, use the notification system? To do this, you can query the
    latency values with **`nagiostats`** or use the plugin **`check_mrtg`** to query
    the performance data already collected through MRTG.
  id: totrans-914
  prefs: []
  type: TYPE_NORMAL
  zh: 有什么比让Nagios监控其自身性能，并在必要时使用通知系统更合适呢？为此，您可以使用**`nagiostats`**查询延迟值，或者使用插件**`check_mrtg`**查询通过MRTG已收集的性能数据。
- en: 'We will choose the first method here and provide the latency time for service
    checks as a passive check result for Nagios. The shell script intended for this
    purpose is run via cron independently of the Nagios scheduling. A plugin actively
    run by Nagios may in some circumstances return no results, or only irregular ones,
    if the Nagios schedule has become totally messed up because of performance problems.
    The script looks like this:'
  id: totrans-915
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在这里选择第一种方法，并将服务检查的延迟时间作为被动检查结果提供给Nagios。为此目的的shell脚本通过cron独立于Nagios调度运行。在某些情况下，如果Nagios调度因为性能问题而完全混乱，Nagios主动运行的插件可能不会返回任何结果，或者只返回不规律的结果。脚本看起来是这样的：
- en: '[PRE55]'
  id: totrans-916
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: First **`nagiostats`** determines the current value for average service latencies
    (**`AVGACTSVCLAT`**). The script saves the result in the variable **`LATENCY`**
    and decides, using the thresholds in **`WARN`** and **`CRIT`**, whether it should
    return OK, WARNING, or CRITICAL.
  id: totrans-917
  prefs: []
  type: TYPE_NORMAL
  zh: 首先**`nagiostats`**确定平均服务延迟的当前值（**`AVGACTSVCLAT`**）。脚本将结果保存到变量**`LATENCY`**中，并使用**`WARN`**和**`CRIT`**中的阈值决定是否返回OK、WARNING或CRITICAL。
- en: '**`OUTCMD`**, **`OUTINFO`**, and **`OUTPERF`** compose the command that is
    passed on to the interface for external commands (see also [13.1 The Interface
    for External Commands](../Text/ch13.html#the_interface_for_external_commands "13.1
    The Interface for External Commands"), page 292). It begins with the timestamp
    in square brackets. The command **`PROCESS_SERVICE_CHECK_RESULT`** is followed
    by the host name and the service name **`Service Latency`**, the status, and the
    actual output, including performance data. In Nagios 3.0 it is better to omit
    the detail of the configuration file, with **`--config`**, because **`nagiostats`**
    will otherwise begin its output with an additional info line that only interferes
    with the script:'
  id: totrans-918
  prefs: []
  type: TYPE_NORMAL
  zh: '**`OUTCMD`**、**`OUTINFO`**和**`OUTPERF`**组成了传递给外部命令接口的命令（参见[13.1 外部命令接口](../Text/ch13.html#the_interface_for_external_commands
    "13.1 外部命令接口")，第292页）。它以方括号中的时间戳开始。命令**`PROCESS_SERVICE_CHECK_RESULT`**后面跟着主机名、服务名**`Service
    Latency`**、状态和实际输出，包括性能数据。在Nagios 3.0中，最好省略配置文件的详细内容，使用**`--config`**，因为否则**`nagiostats`**将开始输出额外的信息行，这只会干扰脚本：'
- en: '[PRE56]'
  id: totrans-919
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'In Nagios 2.x, however, you need to specify the configuration file. So that
    the cron daemon runs the script at regular intervals, a **`nagios`** file is created
    in the directory **`/etc/cron.d`** containing the following line:'
  id: totrans-920
  prefs: []
  type: TYPE_NORMAL
  zh: 在Nagios 2.x版本中，然而，您需要指定配置文件。这样cron守护进程才能定期运行脚本，在目录**`/etc/cron.d`**中创建一个名为**`nagios`**的文件，包含以下行：
- en: '[PRE57]'
  id: totrans-921
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'All that is missing now is an appropriately defined service:'
  id: totrans-922
  prefs: []
  type: TYPE_NORMAL
  zh: 现在所缺少的只是一个定义得当的服务：
- en: '[PRE58]'
  id: totrans-923
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: '**`host_name`** and **`service_description`** must match the corresponding
    detals in the script. Active checks are switched off, passive ones enabled. So
    that Nagios doesn''t perform a check itself at some point, **`check_freshness`**
    must be set to **`0`** (see also [13.4 Reacting to Out-of-Date Information of
    Passive Checks](../Text/ch13s04.html "13.4 Reacting to Out-of-Date Information
    of Passive Checks"), page 295). The definition here uses a service template defined
    somewhere else (see also [2.11 Templates](../Text/ch02s11.html "2.11 Templates"),
    page 75).'
  id: totrans-924
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_name`**和**`service_description`**必须与脚本中的对应细节匹配。主动检查被关闭，被动检查被启用。为了确保Nagios在某个时刻不会自行执行检查，**`check_freshness`**必须设置为**`0`**（参见[13.4
    对被动检查过时信息的响应](../Text/ch13s04.html "13.4 对被动检查过时信息的响应")，第295页）。这里的定义使用在别处定义的服务模板（参见[2.11
    模板](../Text/ch02s11.html "2.11 模板")，第75页）。'
- en: 'After a reload, Nagios accepts the information from the script and processes
    it. If you use PNP to process the performance data ([19.6 Smooth Plotting with
    PNP](../Text/ch19s06.html "19.6 Smooth Plotting with PNP"), page 446), you should
    make sure that Nagios includes the name of the check command (in this case, **`check_dummy`**).
    If you want to use a different name, you need to specify the performance label
    **`svclat`** in the script:'
  id: totrans-925
  prefs: []
  type: TYPE_NORMAL
  zh: 在重新加载后，Nagios接受来自脚本的信息并处理它。如果你使用PNP来处理性能数据（[19.6 使用PNP进行平滑绘图](../Text/ch19s06.html
    "19.6 使用PNP进行平滑绘图")，第446页），你应该确保Nagios包括检查命令的名称（在这种情况下，**`check_dummy`**）。如果你想使用不同的名称，你需要在脚本中指定性能标签**`svclat`**：
- en: '[PRE59]'
  id: totrans-926
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'PNP accepts labels in the form **``*`wrapper :: check_command :: label`*``**,
    from which the tool extracts the name between the double colons (in this case,
    **`check_svc_latency`**), so that it can use it as the plugin name. This trick
    normally works for all passive checks.'
  id: totrans-927
  prefs: []
  type: TYPE_NORMAL
  zh: 'PNP接受以下形式的标签 **``*`wrapper :: check_command :: label`*``**，工具从中提取双冒号之间的名称（在这种情况下，**`check_svc_latency`**），以便它可以将其用作插件名称。这个技巧通常适用于所有被动检查。'
- en: '* * *'
  id: totrans-928
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[328](#APP-F-FN-1)]) [http://www.mrtg.org/](http://www.mrtg.org/)
  id: totrans-929
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[328](#APP-F-FN-1)]) [http://www.mrtg.org/](http://www.mrtg.org/)
- en: ^([[329](#APP-F-FN-2)]) [http://www.mrtg.org/](http://www.mrtg.org/)
  id: totrans-930
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[329](#APP-F-FN-2)]) [http://www.mrtg.org/](http://www.mrtg.org/)
- en: ^([[330](#APP-F-FN-3)]) Namely, enlarging the free memory that Linux uses for
    file system caching, in order to improve I/O performance for the MySQL database
    used by the NDOUtils and the overall file system accesses.
  id: totrans-931
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[330](#APP-F-FN-3)]) 也就是说，扩大Linux用于文件系统缓存的空闲内存，以提高NDOUtils使用的MySQL数据库的I/O性能以及整体文件系统访问性能。
- en: ^([[331](#APP-F-FN-4)]) [http://nagios.sourceforge.net/docs/3_0/mrtggraphs.html](http://nagios.sourceforge.net/docs/3_0/mrtggraphs.html)
  id: totrans-932
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[331](#APP-F-FN-4)]) [http://nagios.sourceforge.net/docs/3_0/mrtggraphs.html](http://nagios.sourceforge.net/docs/3_0/mrtggraphs.html)
- en: F.2 Measures for Improving Performance
  id: totrans-933
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: F.2 提高性能的措施
- en: If performance is subjectively poor and the latency of the service check lies
    permanently in the red zone, then you need to act. But where do you start? Trying
    things out is preferable to studying the problem, and there are no patent recipes.
    Normally you will lose sight of the overall picture very quickly if you try making
    small adjustments here and there. You should therefore always change just one
    parameter at a time and give Nagios time to adjust to the new state of affairs.
    Depending on the system, the number of checks to be performed in the five-minute
    average, and other indicators, sometimes a few minutes is enough to notice changes
    using **`nagiostats`** or MRTG, but at other times even half an hour may not be
    long enough if the latency has built up over a longer period of time.
  id: totrans-934
  prefs: []
  type: TYPE_NORMAL
  zh: 如果性能主观上较差，并且服务检查的延迟始终处于红色区域，那么你需要采取行动。但你应该从哪里开始？尝试解决问题比研究问题更好，而且没有专利配方。通常，如果你在这里和那里进行小的调整，你很快就会失去对整体图景的把握。因此，你应该一次只更改一个参数，并给Nagios时间来适应新的状态。根据系统、五分钟平均要执行的检查数量以及其他指标，有时几分钟就足够用**`nagiostats`**或MRTG注意到变化，但有时即使过了半小时，如果延迟已经积累了一段时间，可能也不够。
- en: The following sections deal with various problem zones in Nagios that could
    be the cause of poor performance.
  id: totrans-935
  prefs: []
  type: TYPE_NORMAL
  zh: 以下章节讨论了Nagios中可能成为性能问题原因的各种问题区域。
- en: 'F.2.1 Service checks: as often as necessary, as few as possible'
  id: totrans-936
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: F.2.1 服务检查：尽可能少，尽可能必要
- en: Would you use a cannon to shoot at sparrows? Surely not. Apart from the fact
    that you would ordinarily never shoot at sparrows, even if you had to, you would
    never use such an oversized weapon as a cannon. Likewise, what is the proper choice
    for the intervals for your service checks? Why check the usage of a hard drive
    every 60 seconds, unless you or a colleague will react within a few minutes to
    a warning threshold being overstepped? Maybe an interval of five to ten minutes
    will do the job just as well. And if the typical growth rate of the data stored
    in the file system lies at five percent per week, then a check interval of 15
    minutes is certainly enough.
  id: totrans-937
  prefs: []
  type: TYPE_NORMAL
  zh: 你会用大炮去打麻雀吗？当然不会。除了你通常永远不会打麻雀的事实，即使你不得不这样做，你也永远不会使用像大炮这样的大号武器。同样，你的服务检查间隔的正确选择是什么？为什么每隔60秒检查一次硬盘的使用情况，除非你或你的同事会在几分钟内对超过警告阈值的警告做出反应？也许五到十分钟的间隔就能达到同样的效果。而且如果文件系统中存储的数据的典型增长率为每周五%，那么15分钟的检查间隔肯定足够了。
- en: If you install security patches only once per day and non-critical security
    updates just once per week, it is of little use to check the relevant version
    status every five minutes. And why check virus signatures every fifteen minutes
    if you only download them every two hours? Do you react immediately after the
    first alarm, or only if no update has been performed for several hours?
  id: totrans-938
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你每天只安装一次安全补丁，每周只安装一次非关键安全更新，那么每五分钟检查相关版本状态就没什么用了。如果你每两小时才下载一次病毒签名，为什么还要每十五分钟检查一次病毒签名呢？你是在第一次警报后立即反应，还是只有在几个小时没有更新后才反应？
- en: These are not just academic questions—they are intended to make you think. There
    are certainly situations in which a service needs to be checked once per minute,
    for instance when compliance with Service Level Agreements is concerned, and the
    contract penalties for outages are calculated on a per-minute basis. But this
    is no reason to test other services every minute if a fifteen-minute check would
    be sufficient. The bottom line is *check as often as necessary, but as little
    as possible*.
  id: totrans-939
  prefs: []
  type: TYPE_NORMAL
  zh: 这些不仅仅是学术问题——它们旨在让你思考。当然，有些情况下服务需要每分钟检查一次，例如当涉及到服务等级协议的遵守时，并且停机合同罚款是按分钟计算的。但这并不是说如果十五分钟检查就足够了，还需要每分钟测试其他服务。总之，*检查的频率要尽可能少，但又要满足必要的需求*。
- en: Start with an average check interval of 5 minutes. For less critical or static
    services, you can extend the interval to 10, 15, 30, or 60 minutes, or perhaps
    even more. Only if it is absolutely essential should you lower the interval below
    the 5-minute limit—and do it selectively for individual checks. 2,000 service
    checks, performed on average every two minutes, generate about the same load as
    5,000 service checks with an average interval of 5 minutes. This small difference
    of 3 minutes can be a real problem for Nagios.
  id: totrans-940
  prefs: []
  type: TYPE_NORMAL
  zh: 以平均5分钟的检查间隔开始。对于不太关键或静态的服务，可以将间隔延长到10、15、30或60分钟，甚至更长。只有当绝对必要时，才应该将间隔降低到5分钟以下——并且有选择性地为单个检查进行。
- en: F.2.2 Processing performance data intelligently
  id: totrans-941
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: F.2.2 智能处理性能数据
- en: Processing performance data can, under unfavorable conditions, be a real performance
    killer.
  id: totrans-942
  prefs: []
  type: TYPE_NORMAL
  zh: 在不利的条件下，处理性能数据可能会成为真正的性能杀手。
- en: For the template mechanism, in which Nagios first has to format performance
    data and then write them to a file, and have these files processed at regular
    intervals by an external command ([19.1.1 The template mechanism](../Text/ch19.html#the_template_mechanism
    "19.1.1 The template mechanism"), page 405), the internal Nagios logic stops when
    the command is called. Nagios expects a confirmation when the program called has
    finished its work. If the external program requires some time to do its task,
    it is easy to work out that calling an external command directly for each individual
    check result ([19.1.2 Using external commands to process performance data](../Text/ch19.html#using_external_commands_to_process_perf
    "19.1.2 Using external commands to process performance data"), page 407) can put
    a considerable strain on Nagios. The template mechanism can provide relief here.
    If 400 check results are waiting each minute (2,000 checks in the 5-minute average)
    and Nagios calls the external command for the template mechanism every 30 seconds,
    this will process some 200 results in one go. Although this will take somewhat
    longer than an external program that processes just one single result, 199 program
    starts are no longer needed.
  id: totrans-943
  prefs: []
  type: TYPE_NORMAL
  zh: 对于模板机制，其中Nagios首先需要格式化性能数据，然后将它们写入文件，并由外部命令定期处理这些文件（[19.1.1 模板机制](../Text/ch19.html#the_template_mechanism
    "19.1.1 模板机制")，第405页），当调用命令时，内部Nagios逻辑会停止。Nagios期望在程序完成工作后得到确认。如果外部程序需要一些时间来完成其任务，很容易得出结论，直接为每个单独的检查结果调用外部命令（[19.1.2
    使用外部命令处理性能数据](../Text/ch19.html#using_external_commands_to_process_perf "19.1.2
    使用外部命令处理性能数据")，第407页）会对Nagios造成相当大的压力。模板机制可以在这里提供缓解。如果每分钟有400个检查结果等待（5分钟平均有2,000个检查），而Nagios每30秒就为模板机制调用外部命令，这将一次性处理大约200个结果。虽然这会比只处理单个结果的外部程序花费更长的时间，但不再需要199个程序启动。
- en: With a large number of check results, this may still not be enough, because
    Nagios also waits here every 30 seconds for the external program and waits until
    it has terminated.
  id: totrans-944
  prefs: []
  type: TYPE_NORMAL
  zh: 对于大量的检查结果，这可能仍然不够，因为Nagios在这里每30秒也会等待外部程序，直到它终止。
- en: 'To keep this pause as brief as possible, you can make use of the bulk mode
    in PNP ([19.6 Smooth Plotting with PNP](../Text/ch19s06.html "19.6 Smooth Plotting
    with PNP"), page 446): then Nagios just moves the file with the cached results
    to a special directory every 30 seconds. This happens without any time loss. Full
    responsibility for processing the external data is given to a daemon that Nagios
    does not have to control. Details of this are described in [19.6.4 Bulk processing
    of performance data](../Text/ch19s06.html#bulk_processing_of_performance_data
    "19.6.4 Bulk processing of performance data") from page 452.'
  id: totrans-945
  prefs: []
  type: TYPE_NORMAL
  zh: 为了尽可能缩短这个暂停时间，你可以使用PNP的批量模式（[19.6 使用PNP进行平滑绘图](../Text/ch19s06.html "19.6 使用PNP进行平滑绘图")，第446页）：然后Nagios每30秒将带有缓存结果的文件移动到特殊目录。这不会造成任何时间损失。处理外部数据的全权责任交给一个Nagios不需要控制的守护进程。这些细节在[19.6.4
    批量处理性能数据](../Text/ch19s06.html#bulk_processing_of_performance_data "19.6.4 批量处理性能数据")中有描述，从第452页开始。
- en: 'Another aspect of intelligent processing is to record performance data only
    where they are evaluated and required. An example of the opposite would be to
    send performance data for all checks to a tool such as NagiosGrapher ([19.5 Automated
    to a Large Extent: NagiosGrapher](../Text/ch19s05.html "19.5 Automated to a Large
    Extent: NagiosGrapher"), page 426) and then discard the data not required on the
    side of the collector daemon **`collect2.pl`**. Processing performance data for
    required services is switched on with **`process_perf_data=1`** in the service
    definition.'
  id: totrans-946
  prefs: []
  type: TYPE_NORMAL
  zh: 智能处理的一个方面是仅在需要评估的地方记录性能数据。相反的例子可能是将所有检查的性能数据发送到像NagiosGrapher（[19.5 自动化到很大程度：NagiosGrapher](../Text/ch19s05.html
    "19.5 自动化到很大程度：NagiosGrapher")，第426页）这样的工具，然后在收集守护进程**`collect2.pl`**的侧边丢弃不需要的数据。对于所需服务的性能数据处理是通过在服务定义中设置**`process_perf_data=1`**来启用的。
- en: F.2.3 Avoiding plugins in interpreted languages
  id: totrans-947
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: F.2.3 避免在解释型语言中使用插件
- en: The standard plugins for Nagios were written predominantly in C and C++, and
    there are good reasons for this. Admittedly, it is usually easier to write a plugin
    in a script language; however, a plugin in an interpreted language is checked
    for correct syntax each time it is run, then interpreted at runtime, and finally
    executed.
  id: totrans-948
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios的标准插件主要是用C和C++编写的，这有很好的理由。诚然，通常在脚本语言中编写插件更容易；然而，在解释型语言中的插件每次运行时都会检查正确的语法，然后在运行时进行解释，最后执行。
- en: Not only that, every time such a plugin is called, the relevant interpreter
    is started. With a compiled plugin, one does not have to put up with all of this.
    Syntax checking and the compiling process only take place once, and the result
    can be executed directly, without the additional support of another program, such
    as an interpreter, which is not exactly small. Considering the many hundreds of
    thousands of calls that are made during the lifetime of an interpreted plugin,
    you are looking at resource commitments that could really be used for more sensible
    purposes.
  id: totrans-949
  prefs: []
  type: TYPE_NORMAL
  zh: 更重要的是，每次调用此类插件时，都会启动相应的解释器。对于编译型插件，你不必忍受所有这些。语法检查和编译过程只发生一次，结果可以直接执行，无需额外支持另一个程序，比如解释器，这并不小。考虑到在解释型插件的生命周期中会进行数百万次调用，你可能会发现这些资源本可以用于更合理的目的。
- en: This is not to fundamentally question the use of interpreted languages in general.
    For certain purposes, it is simply easier to implement a plugin into a script
    language. But you should not be surprised at the resources that will be needed
    if you perform 5,000 service checks in the 5-minute average exclusively with interpreted
    plugins. Then simple PC hardware will certainly not suffice for the Nagios server.
  id: totrans-950
  prefs: []
  type: TYPE_NORMAL
  zh: 这并不是从根本上质疑在一般情况下使用解释型语言。对于某些目的，将插件实现为脚本语言可能更容易。但如果你在5分钟的平均时间内仅使用解释型插件执行5,000次服务检查，你不需要对此所需的资源感到惊讶。那么简单的PC硬件肯定不足以满足Nagios服务器。
- en: 'There is an almost perfect solution if you want to use Perl plugins: Nagios''s
    built-in Perl interpreter (see [Appendix G](../Text/apg.html "Appendix G. The
    Embedded Perl Interpreter") from page 669). Although not all Perl plugins will
    run under this, the majority do, which considerably reduces strain on the Nagios
    server.'
  id: totrans-951
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想使用Perl插件，有一个几乎完美的解决方案：Nagios内置的Perl解释器（见[附录G](../Text/apg.html "附录G. 嵌入式Perl解释器")，第669页）。尽管不是所有Perl插件都能在这个环境下运行，但大多数都可以，这大大减轻了Nagios服务器的负担。
- en: F.2.4 Optimizing host checks
  id: totrans-952
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: F.2.4 优化主机检查
- en: One performance factor that should not be underestimated is the way in which
    Nagios executes a host check. Sometimes considerable time can be lost here, regardless
    of the Nagios version.
  id: totrans-953
  prefs: []
  type: TYPE_NORMAL
  zh: 一个不应被低估的性能因素是Nagios执行主机检查的方式。有时，无论Nagios版本如何，都可能在这里浪费大量时间。
- en: For host checks, a **`check_ping`** or **`check_icmp`** is normally used (see
    [6.2 Reachability Test with Ping](../Text/ch06s02.html "6.2 Reachability Test
    with Ping")). Older **`check_ping`** versions wait for an ICMP echo reply or wait
    for the timeout. It does not evaluate "**`ICMP Host Unreachable`**" messages,
    so that time is lost unnecessarily. **`check_icmp`** uses a special host detection
    mode if it is run under the name **`check_host`** (see [6.2 Reachability Test
    with Ping](../Text/ch06s02.html "6.2 Reachability Test with Ping")). This causes
    the check to be interrupted immediately if an **`ICMP Host Unreachable`** message
    arrives.
  id: totrans-954
  prefs: []
  type: TYPE_NORMAL
  zh: 对于主机检查，通常使用**`check_ping`**或**`check_icmp`**（参见[6.2 使用Ping进行可达性测试](../Text/ch06s02.html
    "6.2 使用Ping进行可达性测试"））。较旧的**`check_ping`**版本等待ICMP回显回复或等待超时。它不会评估“**`ICMP Host
    Unreachable`**”消息，因此会不必要地浪费时间。**`check_icmp`**在以**`check_host`**名称运行时使用特殊的宿主机检测模式（参见[6.2
    使用Ping进行可达性测试](../Text/ch06s02.html "6.2 使用Ping进行可达性测试"））。这导致如果收到**`ICMP Host
    Unreachable`**消息，检查将立即中断。
- en: Newer versions of **`check_icmp`** and **`check_ping`** take the ICMP error
    message into account, even without a special prompt. Version 1.4.11 of the Nagios
    plugins does have a faulty **`check_icmp`**, however. If you run it as **`check_host`**,
    it will not detect the ICMP error message immediately and requires more time than
    necessary. Nagios 2.x calls all host checks in series, or one after the other.
    If a central network node should fail, it checks several hundred hosts in many
    setups. If the host check for unreachable hosts is only interrupted after ten
    seconds, it will take a huge amount of time until Nagios has checked all hosts.
    The length of a host check in case of error is of considerable significance here.
    You could, if need be, use a shorter timeout, but then you run the risk of false
    alarms, if a network connection with narrow bandwidth is overloaded at that moment,
    for instance, and the response times are longer than the reduced timeout. The
    evaluation of ICMP error messages is much safer here. The catastrophic performance,
    with hundreds of failed hosts due to the serial checks, will still remain, however—an
    important reason to change to Nagios 3.0 in large environments.
  id: totrans-955
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_icmp`**和**`check_ping`**的新版本考虑了ICMP错误消息，即使没有特殊提示。然而，Nagios插件1.4.11版本的**`check_icmp`**存在故障。如果您将其作为**`check_host`**运行，它将不会立即检测到ICMP错误消息，并且需要比必要更长的时间。Nagios
    2.x按顺序调用所有主机检查，或者一个接一个地执行。如果中心网络节点出现故障，在许多配置中，它将检查数百个主机。如果无法到达的主机检查仅在十秒后中断，那么Nagios检查所有主机将需要大量时间。在这种情况下，错误发生时主机检查的长度具有重要意义。如果需要，您可以使用更短的超时时间，但这样会冒假警报的风险，例如，如果当时网络连接带宽较窄且响应时间超过缩短的超时时间。在这里评估ICMP错误消息要安全得多。然而，由于串行检查导致数百个主机失败，这种灾难性的性能问题仍然存在——这是在大环境中转向Nagios
    3.0的重要原因之一。'
- en: Whereas it is usually better in Nagios 2.x to do without active host checks,
    in Nagios 3.0 these may help in certain circumstances to improve performance,
    if you can have the check results cached with the parameters **`cached_host_check_horizon`**
    and **`cached_service_check_horizon`** (see [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")) for the interval specified. If
    an on-demand check occurs, this will not even be run if the existing result is
    sufficiently up to date.
  id: totrans-956
  prefs: []
  type: TYPE_NORMAL
  zh: 与Nagios 2.x版本相比，通常最好不使用主动主机检查，但在Nagios 3.0中，在某些情况下，这些检查可能有助于提高性能，如果您可以将检查结果与参数**`cached_host_check_horizon`**和**`cached_service_check_horizon`**（参见[A.1
    主配置文件nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    主配置文件nagios.cfg"））缓存，并指定时间间隔。如果发生即时检查，如果现有结果足够新，则甚至不会运行此检查。
- en: Whether active host checks really do improve performance must be tested in individual
    cases by means of **`nagiostats`**. If the number of cached host checks is relatively
    small in comparison to the number of on-demand checks, caching will not be of
    much use. You could increase the **`cached_host_check_horizon`**—the interval
    for caching—but then you run the risk of using old results that are no longer
    relevant. It is best to try out different time horizons and observe the latency.
    As a comparison, you should try turning off caching altogether, with **`cached_host_check_horizon=0`**.
  id: totrans-957
  prefs: []
  type: TYPE_NORMAL
  zh: 是否活跃的主机检查确实能提高性能必须通过**`nagiostats`**在个别情况下进行测试。如果与按需检查的数量相比，缓存的检查数量相对较小，则缓存不会很有用。你可以增加**`cached_host_check_horizon`**——缓存的间隔，但这样你就有可能使用不再相关的旧结果。最好是尝试不同的时间范围并观察延迟。作为比较，你应该尝试完全关闭缓存，将**`cached_host_check_horizon=0`**。
- en: In connection with host checks, Nagios 3.0 also has the parameter **`aggressive_host_checks`**.
    If this is set to the value **`1`** (and therefore active), Nagios will be very
    exact in its checking, but it needs time to do this. In normal operation you should
    therefore always make sure that the system makes more sensible assumptions for
    host checks with **`aggressive_host_ checks=0`** and so does not test hosts with
    scrupulous precision.
  id: totrans-958
  prefs: []
  type: TYPE_NORMAL
  zh: 在主机检查方面，Nagios 3.0还有一个参数**`aggressive_host_checks`**。如果将其设置为值**`1`**（因此是活跃的），Nagios将非常精确地进行检查，但这需要时间。因此，在正常操作中，你应该始终确保系统在**`aggressive_host_checks=0`**的情况下对主机检查做出更合理的假设，这样就不会以严格的精度测试主机。
- en: F.2.5 The matter of the Reaper
  id: totrans-959
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: F.2.5 关于Reaper的问题
- en: Nagios 3.0 stores the check results in a directory intended for just this purpose,
    specified by the parameter **`check_result_path`** (see [A.1 The Main Configuration
    File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    The Main Configuration File nagios.cfg")). The *Reaper* (this is the "harvesting
    machine" of the Nagios core) retrieves these regularly.
  id: totrans-960
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 3.0将检查结果存储在由参数**`check_result_path`**指定的目录中，该目录专门用于此目的（参见[A.1 主配置文件nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件nagios.cfg")）。*Reaper*（这是Nagios核心的“收割机”）会定期检索这些结果。
- en: 'Two parameters control the procedure: **`check_result_reaper_frequen-cy`**^([[332](#ftn.APP-F-FN-5)])
    specifies the interval, in seconds, at which the Reaper searches the directory
    for new results (see [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")). If the interval is increased,
    it is possible that latency times may also increase. You should only change the
    default of **`5`** seconds to a lower value, and only do this if a large number
    of checks are waiting and Nagios never really empties the directory for the check
    results.'
  id: totrans-961
  prefs: []
  type: TYPE_NORMAL
  zh: 两个参数控制该过程：**`check_result_reaper_frequency`**^([[332](#ftn.APP-F-FN-5)])指定Reaper搜索新结果的时间间隔（秒）（参见[A.1
    主配置文件nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    主配置文件nagios.cfg")）。如果间隔增加，延迟时间也可能增加。你应该只将默认的**`5`**秒更改为更低的值，并且只有在大量检查等待且Nagios从未真正清空检查结果目录的情况下才这样做。
- en: The second parameter, **`max_check_result_reaper_time`**, interrupts activities
    after the time specified, so that Nagios is not held up for ages by the Reaper.
    The default here is **`30`** seconds (see [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")).
  id: totrans-962
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个参数，**`max_check_result_reaper_time`**，在指定时间后中断活动，这样Nagios就不会因为Reaper而长时间停滞。这里的默认值是**`30`**秒（参见[A.1
    主配置文件nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    主配置文件nagios.cfg")）。
- en: In Nagios 2.x only the parameter **`service_reaper_frequency`** ([A.1 The Main
    Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")) is available, and moreover Nagios
    does not store check results in file form, but in a message queue.
  id: totrans-963
  prefs: []
  type: TYPE_NORMAL
  zh: 在Nagios 2.x中，只有**`service_reaper_frequency`** ([A.1 主配置文件nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件nagios.cfg"))参数可用，而且Nagios不将检查结果以文件形式存储，而是存储在消息队列中。
- en: At this point we ought to mention that the Reaper has only a limited influence
    on performance. Provided that you keep the defaults of the two parameters unchanged,
    changing the parameter **`check_result_reaper_frequency`** will not solve any
    problems that have arisen elsewhere. Nevertheless, if you are running out of ideas
    as to what else you can try, it is certainly worthwhile to change this setting.
    In any case, you should monitor the check latency times graphically. If there
    are no changes, you should go back to the defaults.
  id: totrans-964
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，我们应该提到，Reaper对性能的影响是有限的。只要您保持两个参数的默认值不变，更改**`check_result_reaper_frequency`**参数将无法解决其他地方出现的问题。尽管如此，如果您已经尝试了其他方法但仍然没有头绪，更改此设置无疑是值得的。无论如何，您都应该通过图形方式监控检查的延迟时间。如果没有变化，您应该恢复到默认设置。
- en: '* * *'
  id: totrans-965
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[332](#APP-F-FN-5)]) In Nagios 2.x the parameter is called service_reaper_frequency,
    see [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg").
  id: totrans-966
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[332](#APP-F-FN-5)]) 在Nagios 2.x中，该参数称为service_reaper_frequency，参见[A.1 主配置文件nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件nagios.cfg")。
- en: F.2.6 Preferring passive checks
  id: totrans-967
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: F.2.6 优先考虑被动检查
- en: Instead of getting Nagios to actively start each check individually, you can
    also use external applications and forward check results as passive checks to
    Nagios. The external application—even if this is just a cron job—relieves strain
    on Nagios in several areas, including scheduling. Nagios needs only to accept
    the result and sort it accordingly.
  id: totrans-968
  prefs: []
  type: TYPE_NORMAL
  zh: 而不是让Nagios主动逐个启动每个检查，您还可以使用外部应用程序并将检查结果作为被动检查转发给Nagios。外部应用程序——即使这只是一个cron作业——也能在多个方面减轻Nagios的压力，包括调度。Nagios只需要接受结果并相应地排序。
- en: 'In a number of cases you can even go a step further and do without a regular
    check, for instance if a UPS sends an SNMP trap when there is a power failure,
    which Nagios processes as a passive check (see [14.6 Application Example II: Processing
    SNMP Traps](../Text/ch14s06.html "14.6 Application Example II: Processing SNMP
    Traps"), page 312).'
  id: totrans-969
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多情况下，您甚至可以更进一步，无需进行常规检查，例如，如果UPS在电源故障时发送SNMP陷阱，Nagios将其作为被动检查处理（参见[14.6 应用示例II：处理SNMP陷阱](../Text/ch14s06.html
    "14.6 应用示例II：处理SNMP陷阱")，第312页）。
- en: Passive check results are cached by Nagios. By default there are 4096 so-called
    *Command Buffer Slots* available for this. Each buffer slot accepts just one external
    command. If this maximum has almost been reached, you should certainly enlarge
    the value with the parameter **`external_command_buffer_slots`** (see [A.1 The
    Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")), whether or not you have concrete
    performance problems. One report on the buffer slots used is provided by **`nagio-stats`**;
    its values are best displayed by MRTG on the time axis (see [F.1.2 Showing Nagios
    performance graphically](../Text/apf.html#showing_nagios_performance_graphic "F.1.2
    Showing Nagios performance graphically")). Too few buffer slots will certainly
    lead to a loss in performance.
  id: totrans-970
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios会缓存被动检查的结果。默认情况下，有4096个所谓的*命令缓冲区槽位*可用于此。每个缓冲区槽位只接受一个外部命令。如果这个最大值几乎已经达到，您应该肯定地使用参数**`external_command_buffer_slots`**（参见[A.1
    主配置文件nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    主配置文件nagios.cfg")）来增加其值，无论您是否有具体的性能问题。有关缓冲区槽位使用的报告由**`nagio-stats`**提供；其值最好通过MRTG在时间轴上显示（参见[F.1.2
    以图形方式显示Nagios性能](../Text/apf.html#showing_nagios_performance_graphic "F.1.2 以图形方式显示Nagios性能")）。缓冲区槽位太少肯定会引起性能下降。
- en: F.2.7 Optimizing large Nagios environments
  id: totrans-971
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: F.2.7 优化大型Nagios环境
- en: For very large environments, Nagios has available the parameter **`use_large_installation_tweaks`**
    ([A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")). If this is set to **`1`**, Nagios
    optimizes a number of processes that can be very time-intensive, especially in
    large environments. Thus the system does without explicit memory release for child
    processes. leaving this task entirely to the operating system.
  id: totrans-972
  prefs: []
  type: TYPE_NORMAL
  zh: 对于非常大的环境，Nagios提供了**`use_large_installation_tweaks`**参数（[A.1 主配置文件nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件nagios.cfg")）。如果此参数设置为**`1`**，Nagios将优化许多可能非常耗时的过程，尤其是在大型环境中。因此，系统无需为子进程显式释放内存，这项任务完全由操作系统负责。
- en: Normally Nagios starts checks via a two-pronged fork so that it can defend itself
    against crashes and other abnormalities when the plugin is run. Checks are then
    performed not as child processes, but as grandchild processes. The two-pronged
    fork leaves cleaning up after grandchild processes to the operating system. If,
    instead of this, Nagios is happy with a simple fork (with **`use_large_installation_tweaks=1`**),
    it will have to look after all the cleaning up work for all check processes, because
    these are now running directly as child processes. But in return the system load
    is reduced, because only half as many processes need to be started. This generally
    improves performance.
  id: totrans-973
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，Nagios 通过双叉分支启动检查，以便在插件运行时能够防御崩溃和其他异常。检查不是作为子进程，而是作为孙进程执行的。双叉分支将孙进程的清理工作留给操作系统。如果
    Nagios 满足于简单的叉（**`use_large_installation_tweaks=1`**），它将不得不负责所有检查进程的清理工作，因为这些进程现在直接作为子进程运行。但作为回报，系统负载会降低，因为只需要启动一半数量的进程。这通常可以提高性能。
- en: As a third measure, Nagios switches off the envivronment variables for *summary
    macros* ([D.1.7 Statistics macros](../Text/apd.html#statistics_macros "D.1.7 Statistics
    macros"), page 631). It takes up a great deal of time to make these available.
  id: totrans-974
  prefs: []
  type: TYPE_NORMAL
  zh: 作为第三项措施，Nagios 关闭了用于 *摘要宏* 的环境变量（[D.1.7 统计宏](../Text/apd.html#statistics_macros
    "D.1.7 统计宏"，第 631 页)）。使这些变量可用需要花费大量时间。
- en: The parameter **`enable_environment_macros`** ([A.1 The Main Configuration File
    nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1 The
    Main Configuration File nagios.cfg")) goes even further—with the value **`0`**,
    Nagios in general no longer makes available the content of macros as environment
    variables (see [D.1.8 Using standard macros about the environment](../Text/apd.html#using_standard_macros_about_the_environm
    "D.1.8 Using standard macros about the environment") from page 631).
  id: totrans-975
  prefs: []
  type: TYPE_NORMAL
  zh: 参数 **`enable_environment_macros`** ([A.1 主配置文件 nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件 nagios.cfg")) 更进一步——当值为 **`0`** 时，Nagios 通常不再将宏的内容作为环境变量提供（参见 [D.1.8
    关于环境的标准宏](../Text/apd.html#using_standard_macros_about_the_environm "D.1.8 关于环境的标准宏"，第
    631 页)）。
- en: The macros can be used as normal within the Nagios configuration, but now external
    scripts can no longer access them implicitly. Switching this off saves considerable
    resources, especially in large environments, and in many cases the environment
    variables are not needed at all.
  id: totrans-976
  prefs: []
  type: TYPE_NORMAL
  zh: 这些宏可以在 Nagios 配置中正常使用，但现在外部脚本无法隐式访问它们。关闭这一功能可以节省大量资源，尤其是在大型环境中，而且在许多情况下，根本不需要这些环境变量。
- en: F.2.8 Optimizing the NDOUtils database
  id: totrans-977
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: F.2.8 优化 NDOUtils 数据库
- en: The NDOUtils take advantage of the possibility of writing all information which
    is at the disposal of Nagios to an external database, via the event broker ([Chapter 17](../Text/ch17.html
    "Chapter 17. Flexible Web Interface with the NDOUtils") from page 375). The parameter
    **`event_broker_options`** controls which data Nagios passes on here. The default
    is **`−1`**, which means that any information available is passed on.
  id: totrans-978
  prefs: []
  type: TYPE_NORMAL
  zh: NDOUtils 利用将 Nagios 可用的所有信息写入外部数据库的可能性，通过事件代理器（[第 17 章](../Text/ch17.html "第
    17 章. 使用 NDOUtils 的灵活 Web 界面"，第 375 页)）。参数 **`event_broker_options`** 控制Nagios传递哪些数据。默认值为
    **`−1`**，这意味着传递所有可用信息。
- en: From a performance point of view, this is quite a bad choice. If you just require
    selected data—such as the results of host and service checks—you should pass on
    only this information. Everything else consumes unnecessary resources and influences
    performance without providing any benefits in return. Further information, including
    possible values for the parameter event_broker_options, is given in [17.1 The
    Event Broker](../Text/ch17.html#the_event_broker "17.1 The Event Broker") from
    page 376.
  id: totrans-979
  prefs: []
  type: TYPE_NORMAL
  zh: 从性能角度来看，这是一个相当糟糕的选择。如果你只需要选择性的数据——例如主机和服务检查的结果——你应该只传递这些信息。其他所有内容都会消耗不必要的资源，并影响性能，而不会带来任何回报。包括参数
    event_broker_options 的可能值在内的更多信息，请参阅 [17.1 事件代理](../Text/ch17.html#the_event_broker
    "17.1 事件代理"，第 376 页)。
- en: Appendix G. The Embedded Perl Interpreter
  id: totrans-980
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 附录 G. 嵌入式 Perl 解释器
- en: Perl is an interpreted scripting language. When a Perl script is started, it
    is read by the Perl interpreter, checked for errors, transformed into executable
    code only at runtime, and finally executed. Programs in languages such as C or
    C++ are checked for errors, compiled only once, and saved as binary code that
    can be run directly. Here the checking and compilation process takes place just
    once—before the program is run for the first time—whereas a Perl script is checked
    and compiled each time it is run. This takes place at an astounding speed, but
    it still takes time.
  id: totrans-981
  prefs: []
  type: TYPE_NORMAL
  zh: Perl是一种解释型脚本语言。当启动一个Perl脚本时，它会被Perl解释器读取，检查错误，仅在运行时转换为可执行代码，并最终执行。用C或C++等语言编写的程序在运行前会检查错误，只编译一次，并保存为可以直接运行的二进制代码。在这里，检查和编译过程只发生一次——在程序第一次运行之前——而Perl脚本每次运行时都会进行检查和编译。这个过程发生得非常快，但仍然需要时间。
- en: But things get worse—for each script, no matter how small it is, the heavyweight
    Perl interpreter is loaded every time. It's as if, in order to add two numbers
    together, you needed to switch on your PC, wait until you can log in, then run
    a spreadsheet program in which you can finally enter the two numbers.
  id: totrans-982
  prefs: []
  type: TYPE_NORMAL
  zh: 但情况变得更糟——对于每个脚本，无论它有多小，都必须每次都加载这个重量级的Perl解释器。这就像，为了将两个数字相加，你需要打开你的电脑，等待登录，然后运行一个电子表格程序，你才能最终输入这两个数字。
- en: What if you want to continue using the spreadsheet? Well, then the computer
    must be turned on and the spreadsheet program must be installed and running so
    you can enter your numbers. Transferring the analogy to Nagios scripts, this means
    that an instance of the Perl interpreter must already be running on the Nagios
    server—and preferably this instance should be used for all plugins, so that each
    plugin can be executed immediately when it is called. This is precisely what the
    Embedded Perl interpreter, which is embedded into Nagios, does. The technique
    is not new; the Apache module **`mod_perl`** works in the same way.
  id: totrans-983
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想继续使用电子表格，那么电脑必须开启，电子表格程序必须安装并运行，这样你才能输入你的数字。将这个类比应用到Nagios脚本中，这意味着Perl解释器的一个实例必须已经在Nagios服务器上运行——而且最好是这个实例用于所有插件，这样每个插件在被调用时都可以立即执行。这正是Nagios中嵌入的Perl解释器所做的事情。这项技术并不新颖；Apache模块**`mod_perl`**也是以同样的方式工作的。
- en: 'However, the Embedded Perl interpreter does have one slight drawback: It makes
    more demands of a Perl script than the normal Perl interpreter does. Not every
    plugin that runs on the command line without problems will work under the embedded
    interpreter. It is often a matter of small details. Debugging is very difficult
    with this interpreter, and even with simple errors, it is not easy to localize
    them and adjust the plugin accordingly. But you should not be put off by this,
    because in Nagios 3.x the interpreter can be selectively switched off, and in
    Nagios 2.x a trick can be used to bypass it.'
  id: totrans-984
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，嵌入的Perl解释器确实有一个小小的缺点：它对Perl脚本的要求比正常的Perl解释器更多。并不是每个在命令行上运行没有问题的插件都能在嵌入的解释器下工作。这通常是一些小细节的问题。使用这个解释器进行调试非常困难，即使是非常简单的错误，定位它们并相应地调整插件也不是一件容易的事情。但你不应该因此气馁，因为在Nagios
    3.x中，解释器可以选择性地关闭，而在Nagios 2.x中，可以使用一个技巧来绕过它。
- en: 'A quick note on terminology: In the official Nagios documentation, ePN stands
    for *Embedded Perl Nagios*, that is, Nagios with a Perl interpreter compiled into
    it. In general usage, the term means the integrated Perl interpreter itself. This
    is how we use the term in this book as well. Either way, Nagios is needed in order
    to use it.'
  id: totrans-985
  prefs: []
  type: TYPE_NORMAL
  zh: 关于术语的简要说明：在官方Nagios文档中，ePN代表*嵌入Perl Nagios*，即编译了Perl解释器的Nagios。在一般用法中，这个术语指的是集成的Perl解释器本身。在这本书中，我们也是这样使用这个术语的。无论如何，使用它都需要Nagios。
- en: G.1 Requirements of an ePN-capable Plugin
  id: totrans-986
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: G.1 具备ePN功能的插件的要求
- en: 'Many primitive errors can be avoided from the beginning if you use the pragmas
    **`use strict`** and **`use warnings`**:'
  id: totrans-987
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用**`use strict`**和**`use warnings`**这两个pragma，许多原始错误从一开始就可以避免：
- en: '[PRE60]'
  id: totrans-988
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: '**`use strict`** treats the code very precisely and forces the predefinition
    of all variables (e. g., **`my $var;`**). **`use warnings`** displays extended
    error information, which greatly simplifies the search for the line or statement
    causing the error. For Perl versions prior to 5.6, **`use warnings`** does not
    exist, and you must use the **`-w`** switch, for example in the first line of
    the script:'
  id: totrans-989
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use strict`** 对代码非常精确，并强制预先定义所有变量（例如，**`my $var;`**）。**`use warnings`**
    显示扩展的错误信息，这极大地简化了查找导致错误的行或语句。对于 5.6 版本之前的 Perl，**`use warnings`** 不存在，你必须使用 **`-w`**
    开关，例如在脚本的第一个行：'
- en: '[PRE61]'
  id: totrans-990
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: Detailed information on pragmas can be found in **`man 3perl strict`** and **`man
    3perl warnings`**, as well as the corresponding Perldoc pages on the Internet.^([[333](#ftn.APP-G-FN-1)])
  id: totrans-991
  prefs: []
  type: TYPE_NORMAL
  zh: 关于语法的详细信息可以在 **`man 3perl strict`** 和 **`man 3perl warnings`** 中找到，以及互联网上相应的
    Perldoc 页面.^([[333](#ftn.APP-G-FN-1)])
- en: 'To obtain a better understanding of the following notes, you must be aware
    of two things. On one hand, the plugin is loaded just once into the interpreter,
    so initialization sequences are performed explicitly only the very fist time it
    is run. On the other hand, the interpreter embeds the Perl code into other Perl
    code. Thus the end of the plugin code itself is not the end of the complete Perl
    code executed for this plugin. Actions that refer implicitly to the end of the
    respective script therefore sometimes generate undesired side effects, and you
    should take notice of the following tips:'
  id: totrans-992
  prefs: []
  type: TYPE_NORMAL
  zh: 为了更好地理解以下说明，你必须了解两件事。一方面，插件只被加载到解释器中一次，因此初始化序列仅在第一次运行时显式执行。另一方面，解释器将 Perl 代码嵌入到其他
    Perl 代码中。因此，插件代码的结束并不是执行此插件的完整 Perl 代码的结束。因此，有时会生成不期望的副作用，你应该注意以下提示：
- en: If possible, make do without **`BEGIN!`**
  id: totrans-993
  prefs: []
  type: TYPE_NORMAL
  zh: 如果可能，尽量避免使用 **`BEGIN!`**
- en: In a **`BEGIN`** statement you normally include statements that initialize values
    or should, for one reason or another, be executed before the rest of the code.
    ePN runs this section only the very first time the plugin is executed. Statements
    that must be executed every time a plugin is called will come to nothing. It is
    therefore better to leave out the **`BEGIN`** section altogether.
  id: totrans-994
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个 **`BEGIN`** 语句中，你通常包括初始化值或由于某种原因应该在代码的其他部分之前执行的语句。ePN 只在插件第一次执行时运行此部分。每次调用插件时都必须执行的语句将毫无意义。因此，最好完全省略
    **`BEGIN`** 部分。
- en: Define an explicit exit code!
  id: totrans-995
  prefs: []
  type: TYPE_NORMAL
  zh: 定义一个明确的退出代码！
- en: A normal Perl script always ends (provided you do not explicitly specify an
    exit code) with the exit code **`0`**. This does not work with the ePN, since
    other code is run after the script code. Although such plugins return an OK when
    run on the command line (without ePN), they return UNKNOWN under ePN.
  id: totrans-996
  prefs: []
  type: TYPE_NORMAL
  zh: 正常的 Perl 脚本总是以退出代码 **`0`** 结束（除非你明确指定退出代码）。在 ePN 中这不起作用，因为脚本代码之后还有其他代码运行。尽管这样的插件在命令行上运行时（没有
    ePN）会返回 OK，但在 ePN 中它们返回 UNKNOWN。
- en: Make do without **`__DATA__`** or **`__END__`** sections!
  id: totrans-997
  prefs: []
  type: TYPE_NORMAL
  zh: 尽量避免使用 **`__DATA__`** 或 **`__END__`** 部分！
- en: 'Both instructions explicitly terminate the execution of the Perl code. In ePN
    this is not the case, however. For this reason you must leave out such instructions.
    For example, instead of the **`__DATA__`**, section you could use a Here instruction:'
  id: totrans-998
  prefs: []
  type: TYPE_NORMAL
  zh: 这两条指令都明确终止了 Perl 代码的执行。然而，在 ePN 中并非如此。因此，你必须省略此类指令。例如，你可以在 **`__DATA__`** 部分使用
    Here 指令：
- en: '[PRE62]'
  id: totrans-999
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: Do not misuse lexical variables as global variables!
  id: totrans-1000
  prefs: []
  type: TYPE_NORMAL
  zh: 不要误用词法变量作为全局变量！
- en: 'Lexical variables such as **`my $value`** define values required locally. You
    should therefore not access these directly from subroutines. Store the corresponding
    values as global values instead:'
  id: totrans-1001
  prefs: []
  type: TYPE_NORMAL
  zh: 词法变量，如 **`my $value`**，定义了局部所需的值。因此，你应该不要直接从子程序中访问这些值。相反，将这些值作为全局值存储：
- en: '[PRE63]'
  id: totrans-1002
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'It is better still to pass on the variable as a reference:'
  id: totrans-1003
  prefs: []
  type: TYPE_NORMAL
  zh: 更好的做法是将变量作为引用传递：
- en: '[PRE64]'
  id: totrans-1004
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: Terminate all actions and functions!
  id: totrans-1005
  prefs: []
  type: TYPE_NORMAL
  zh: 终止所有操作和函数！
- en: 'The Embedded Perl Interpreter also stumbles over small details. To cite an
    example, consider POD documentation integrated into the script (see [25.2 The
    Perl Online Documentation](../Text/ch25s02.html "25.2 The Perl Online Documentation"),
    page 566): Normally the documentation section is completed with **`=cut`**. At
    the end of the Perl script, Perl ensures an implicit end, so that a documentation
    section not finished with **`=cut`** at the end of the script will not cause a
    problem on the command line. But ePN appends Perl code to this, so that omitting
    **`=cut`** always leads to an error.'
  id: totrans-1006
  prefs: []
  type: TYPE_NORMAL
  zh: 嵌入式 Perl 解释器也会在一些小细节上出现问题。以一个例子来说明，考虑将 POD 文档集成到脚本中（参见 [25.2 Perl 在线文档](../Text/ch25s02.html
    "25.2 Perl 在线文档")，第 566 页）：通常文档部分会用 **`=cut`** 来结束。在 Perl 脚本末尾，Perl 会确保一个隐式的结束，这样如果脚本末尾没有用
    **`=cut`** 结束的文档部分，在命令行上就不会有问题。但是 ePN 会附加 Perl 代码到这个部分，所以省略 **`=cut`** 总是会导致错误。
- en: This error pattern also recurs in other contexts, so that you should make a
    habit of always explicitly cleaning up. If the plugin opens a file, it must also
    explicitly close it.
  id: totrans-1007
  prefs: []
  type: TYPE_NORMAL
  zh: 这种错误模式也出现在其他上下文中，因此你应该养成总是显式清理的习惯。如果插件打开了一个文件，它也必须显式关闭它。
- en: More information is provided by the Nagios online documentation^([[334](#ftn.APP-G-FN-2)])
    and the mod_perl Users Guide.^([[335](#ftn.APP-G-FN-3)]) For errors that occur
    exclusively with the ePN, the included mini-version is of help, and is described
    in [G.3 The Testing Tool new_mini_epn](../Text/apgs03.html "G.3 The Testing Tool
    new_mini_epn") in page 674.
  id: totrans-1008
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 在线文档^([[334](#ftn.APP-G-FN-2)]) 和 mod_perl 用户指南^([[335](#ftn.APP-G-FN-3)])
    提供了更多信息。对于仅与 ePN 相关的错误，包含的迷你版本很有帮助，并在 [G.3 测试工具 new_mini_epn](../Text/apgs03.html
    "G.3 测试工具 new_mini_epn") 页 674 中描述。
- en: '* * *'
  id: totrans-1009
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[333](#APP-G-FN-1)]) [http://perldoc.perl.org/strict.html](http://perldoc.perl.org/strict.html)
    and [http://perldoc.perl.org/warnings.html](http://perldoc.perl.org/warnings.html)
  id: totrans-1010
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[333](#APP-G-FN-1)]) [http://perldoc.perl.org/strict.html](http://perldoc.perl.org/strict.html)
    和 [http://perldoc.perl.org/warnings.html](http://perldoc.perl.org/warnings.html)
- en: ^([[334](#APP-G-FN-2)]) [http://nagios.sourceforge.net/docs/3_0/epnplugins.html](http://nagios.sourceforge.net/docs/3_0/epnplugins.html)
  id: totrans-1011
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[334](#APP-G-FN-2)]) [http://nagios.sourceforge.net/docs/3_0/epnplugins.html](http://nagios.sourceforge.net/docs/3_0/epnplugins.html)
- en: ^([[335](#APP-G-FN-3)]) [http://perl.apache.org/docs/1.0/guide/](http://perl.apache.org/docs/1.0/guide/)
  id: totrans-1012
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[335](#APP-G-FN-3)]) [http://perl.apache.org/docs/1.0/guide/](http://perl.apache.org/docs/1.0/guide/)
- en: G.2 Using ePN
  id: totrans-1013
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: G.2 使用 ePN
- en: In order to use the Embedded Perl interpreter, this feature must be compiled
    into Nagios. This suffices for Nagios 2.x, but for Nagios 3.0 you must also set
    parameters in the main configuration file **`nagios.cfg`**. In addition, Nagios
    3.0 allows each individual Perl plugin to activate or to switch off the Embedded
    Perl interpreter.
  id: totrans-1014
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使用嵌入式 Perl 解释器，这个特性必须编译到 Nagios 中。这适用于 Nagios 2.x，但对于 Nagios 3.0，你必须在主配置文件
    **`nagios.cfg`** 中设置参数。此外，Nagios 3.0 允许每个单独的 Perl 插件激活或关闭嵌入式 Perl 解释器。
- en: G.2.1 Compiling ePN
  id: totrans-1015
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: G.2.1 编译 ePN
- en: The interpreter is integrated during the **`configure`** call, with the switch
    **`--enable-embedded-perl`**. In Nagios 2.x you should also use the option **`--with-perlcache`**,
    which ensures that the interpreter caches scripts that have already been loaded,
    thus speeding them up if they are run again. Nagios 3.0 sets this implicitly if
    **`--enable-embedded-perl`** is specified.
  id: totrans-1016
  prefs: []
  type: TYPE_NORMAL
  zh: 解释器在 **`configure`** 调用期间集成，使用开关 **`--enable-embedded-perl`**。在 Nagios 2.x 中，你还应该使用选项
    **`--with-perlcache`**，这确保了解释器缓存已加载的脚本，如果再次运行它们，则会加快速度。如果指定了 **`--enable-embedded-perl`**，Nagios
    3.0 会隐式设置此选项。
- en: 'Caching in Nagios 2.x has one drawback: In some circumstances Nagios will not
    recognize changes made later on to a Perl script. The only remedy here is a reload
    or a restart of Nagios. On a development system, which is only used to develop
    or test plugins, it certainly makes sense to do without caching. On production
    Nagios systems, however, the benefits of caching cannot be overlooked. In Nagios
    3.0, the Perl interpreter takes account of changes to the script and reloads these
    if required.'
  id: totrans-1017
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Nagios 2.x 中，缓存有一个缺点：在某些情况下，Nagios 不会识别对 Perl 脚本后来所做的更改。这里唯一的补救措施是重新加载或重启
    Nagios。在开发系统中，该系统仅用于开发或测试插件，不使用缓存当然是有意义的。然而，在生产 Nagios 系统中，缓存的好处不容忽视。在 Nagios
    3.0 中，Perl 解释器会考虑脚本的更改，并在需要时重新加载这些更改。
- en: G.2.2 Interpreter-specific parameters in nagios.cfg
  id: totrans-1018
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: G.2.2 nagios.cfg 中的解释器特定参数
- en: 'Starting from Nagios 3.0, parameters in the main configuration file **`nagios.cfg`**
    determine whether the Embedded Perl interpreter is used or not:'
  id: totrans-1019
  prefs: []
  type: TYPE_NORMAL
  zh: 从Nagios 3.0开始，主配置文件**`nagios.cfg`**中的参数确定是否使用嵌入式Perl解释器：
- en: '[PRE65]'
  id: totrans-1020
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: '**`enable_embedded_perl=1`** enables the general use of the interpreter, and
    the value **`0`** switches it off. The second parameter is used for fine-tuning.
    **`use_embedded_perl_implicitly=1`** automatically switches on the interpreter
    for each plugin, provided the plugin itself does not contain any further instructions
    (see next section). The value **`0`** switches ePN off for the time being, and
    then each plugin must decide for itself whether to use it or not.'
  id: totrans-1021
  prefs: []
  type: TYPE_NORMAL
  zh: '**`enable_embedded_perl=1`**启用了解释器的通用使用，而值**`0`**将其关闭。第二个参数用于微调。**`use_embedded_perl_implicitly=1`**会自动为每个插件打开解释器，前提是插件本身不包含任何其他指令（参见下一节）。值**`0`**暂时关闭ePN，然后每个插件必须自行决定是否使用它。'
- en: G.2.3 Disabling ePN on a per-plugin basis
  id: totrans-1022
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: G.2.3 在每个插件的基础上禁用ePN
- en: 'In Nagios 3.0, the parameter **`use_embedded_perl_implicitly`** is supplemented
    with an instruction that can be set within every plugin:'
  id: totrans-1023
  prefs: []
  type: TYPE_NORMAL
  zh: 在Nagios 3.0中，参数**`use_embedded_perl_implicitly`**被补充了一个可以在每个插件中设置的指令：
- en: '[PRE66]'
  id: totrans-1024
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'The text **`# nagios: +epn`** or **`-epn`** must appear within the first ten
    lines. With **`+epn`** the plugin is executed in the ePN environment, and with
    **`-epn`** it is not. This explicit detail in the plugin has the highest priority
    Only if the instruction is missing does Nagios 3.0 use the parameter **`use_embedded_
    perl_implicitly`**.'
  id: totrans-1025
  prefs: []
  type: TYPE_NORMAL
  zh: '文本**`# nagios: +epn`**或**`-epn`**必须出现在前十条线中。使用**`+epn`**时，插件将在ePN环境中执行，而使用**`-epn`**则不会。这个插件中的明确细节具有最高优先级。只有当缺少指令时，Nagios
    3.0才会使用参数**`use_embedded_perl_implicitly`**。'
- en: In many cases, existing Perl plugins will work in ePN. We therefore recommend
    that you use the setting **`use_embedded_perl_implicitly=1`**. For plugins that
    cause problems, you can explicitly switch off the use of the interpreter with
    **`-epn`**.
  id: totrans-1026
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多情况下，现有的Perl插件将在ePN中工作。因此，我们建议使用设置**`use_embedded_perl_implicitly=1`**。对于引起问题的插件，你可以使用**`-epn`**显式关闭解释器的使用。
- en: 'In Nagios 2.x there is no option to switch the Embedded Interpreter on or off
    at runtime or in the plugin. Once it has been compiled into Nagios, it is always
    active. But there is a workaround that you can use when defining a command, by
    prefixing **`/usr/bin/perl`** to the actual command line:'
  id: totrans-1027
  prefs: []
  type: TYPE_NORMAL
  zh: 在Nagios 2.x版本中，没有选项可以在运行时或在插件中切换嵌入式解释器的开关。一旦它被编译进Nagios，它就始终处于激活状态。但是，在定义命令时，你可以通过在实际命令行前加上**`/usr/bin/perl`**作为前缀来使用一种解决方案：
- en: '[PRE67]'
  id: totrans-1028
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: Thus, for the plugin **`check_disk.pl`**, the normal Perl interpreter is started
    each time the plugin is run, and ePN is sidestepped.
  id: totrans-1029
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，对于插件**`check_disk.pl`**，每次运行插件时都会启动正常的Perl解释器，而ePN则被绕过。
- en: G.3 The Testing Tool **`new_mini_epn`**
  id: totrans-1030
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: G.3 测试工具**`new_mini_epn`**
- en: 'In its source code, Nagios includes two utilities that simulate an ePN environment,
    which considerably simplifies searching for errors: **`mini_epn`** and the more
    recent **`new_mini_epn`**. They are not absolutely identical in behavior to ePN,
    but this involves only a small number of exotic scenarios. In general the following
    applies: If a Nagios plugin does not run in the mini-interpreter, it won''t run
    in the ePN either.'
  id: totrans-1031
  prefs: []
  type: TYPE_NORMAL
  zh: 在其源代码中，Nagios包含了两个模拟ePN环境的实用工具，这大大简化了错误搜索：**`mini_epn`**和较新的**`new_mini_epn`**。它们的行为与ePN并不完全相同，但这只涉及少数几个特殊场景。一般来说，以下规则适用：如果一个Nagios插件在mini解释器中无法运行，那么在ePN中也无法运行。
- en: The two programs are located in the subdirectory **`./contrib`** of the source
    code and are not installed automatically. If you want to use them, run
  id: totrans-1032
  prefs: []
  type: TYPE_NORMAL
  zh: 这两个程序位于源代码的子目录**`./contrib`**中，并且不会自动安装。如果你想使用它们，请运行
- en: '[PRE68]'
  id: totrans-1033
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'but *under no circumstances* should you run **`make install!`** The Makefile
    in this directory does not take into account the defaults for paths and may change
    the access permissions for directories such as **`/bin`** and **`/var`**. The
    programs must be executed in the directory in which the file **`p1.pl`** is located.
    During the basic installation of Nagios, this is copied to **`/usr/local/nagios/bin`**,
    and so these two programs are also copied there:'
  id: totrans-1034
  prefs: []
  type: TYPE_NORMAL
  zh: 但在任何情况下都不应该运行**`make install!`**。此目录中的Makefile没有考虑路径的默认值，可能会更改**`/bin`**和**`/var`**等目录的访问权限。程序必须在包含文件**`p1.pl`**的目录中执行。在Nagios的基本安装过程中，它被复制到**`/usr/local/nagios/bin`**，因此这两个程序也被复制到那里：
- en: '[PRE69]'
  id: totrans-1035
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: In the **`./contrib`** directory itself there is an obsolete **`p1.pl`**, which
    should not be used. The up-to-date **`p1.pl`** installed by Nagios is located
    in the main directory of the source code.
  id: totrans-1036
  prefs: []
  type: TYPE_NORMAL
  zh: 在 **`./contrib`** 目录本身中有一个过时的 **`p1.pl`**，不应使用。Nagios 安装的最新版 **`p1.pl`** 位于源代码的主目录中。
- en: 'In order to run the mini-interpreter, you change, as the user **`nagios`**,
    to the directory **`/usr/local/nagios/bin`** and run the program without parameters:'
  id: totrans-1037
  prefs: []
  type: TYPE_NORMAL
  zh: 为了运行迷你解释器，您需要以用户 **`nagios`** 的身份切换到目录 **`/usr/local/nagios/bin`** 并不带参数运行程序：
- en: '[PRE70]'
  id: totrans-1038
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'You are taken to a simple comand line from which you can run plugins. You should
    always include the full path to the plugin:'
  id: totrans-1039
  prefs: []
  type: TYPE_NORMAL
  zh: 您将被带到简单的命令行，您可以在其中运行插件。您应该始终包含插件的完整路径：
- en: '[PRE71]'
  id: totrans-1040
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: The mini-interpreter displays the return code, along with the actual output
    of the plugin after the **`&`** character.
  id: totrans-1041
  prefs: []
  type: TYPE_NORMAL
  zh: 迷你解释器显示返回代码，以及 **`&`** 字符之后的插件实际输出。
- en: If one mini-interpreter does not find an error, you should try the other one
    out, as it is possible that it may react differently in this special case. In
    addition, you should always run the interpreter with the permissions of the user
    under which Nagios is running (in this book, this is **`nagios`**), to rule out
    problems with access permissions from the start.
  id: totrans-1042
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一个迷你解释器没有找到错误，您应该尝试使用另一个，因为在这种情况下它可能会有不同的反应。此外，您应该始终以 Nagios 运行的用户权限运行解释器（在这本书中是
    **`nagios`**），以排除从开始就存在访问权限问题。
- en: The mini-interpreter caches the executed plugin just like its big brother does
    and is not aware at runtime of any changes made to the plugin. If you have made
    changes to the plugin, you should restart the mini-interpreter, otherwise you
    may be searching in vain for an error at the wrong spot.
  id: totrans-1043
  prefs: []
  type: TYPE_NORMAL
  zh: 迷你解释器像其大哥一样缓存已执行的插件，并且在运行时不会意识到对插件所做的任何更改。如果您对插件进行了更改，您应该重新启动迷你解释器，否则您可能会在错误的位置徒劳地寻找错误。
- en: Appendix H. What's New in Nagios 3.0?
  id: totrans-1044
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 附录 H. Nagios 3.0 的新特性
- en: Nagios 3.0 presents a series of improvements and innovations compared to the
    2.x versions.^([[336](#ftn.APP-H-FN-1)]). Much of this is not noticeable from
    the outside, and the configuration is also nearly identical; normally Nagios 3.0
    will also start with a functioning Nagios-2.x configuration. None of the new configuration
    parameters are absolutely essential.
  id: totrans-1045
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 3.0 相比 2.x 版本带来了一系列的改进和创新.^([[336](#ftn.APP-H-FN-1)]). 其中许多改进在外观上并不明显，配置也几乎相同；通常
    Nagios 3.0 也会使用一个功能正常的 Nagios-2.x 配置启动。所有新的配置参数都不是绝对必要的。
- en: Some parameters were renamed, and Nagios 3.0 complains on startup that a parameter
    contained in the configuration has been removed, then sets the new variable to
    a sensible value. The objects **`hostextinfo`** and **`service-extinfo`** are
    considered to be obsolete, but can still be used, at least in version 3.0.
  id: totrans-1046
  prefs: []
  type: TYPE_NORMAL
  zh: 一些参数已被重命名，Nagios 3.0 在启动时会抱怨配置中包含的某个参数已被删除，然后将其设置为合理的值。对象 **`hostextinfo`**
    和 **`service-extinfo`** 被认为是过时的，但仍然可以使用，至少在 3.0 版本中。
- en: Apart from the configuration, the internal logic has been improved in many places.
    For instance the changed way of running host checks has led to significantly higher
    performance, especially for very large installations.
  id: totrans-1047
  prefs: []
  type: TYPE_NORMAL
  zh: 除了配置之外，内部逻辑在很多地方也得到了改进。例如，运行主机检查方式的变化导致性能显著提高，尤其是在非常大的安装中。
- en: H.1 Changes in Object Definitions
  id: totrans-1048
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: H.1 对象定义的变化
- en: Nagios 3.0 now allows floating point decimals when specifying check and notification
    intervals. The new parameter **`check_interval =2.5`**, which replaces the **`normal_check_interval`**,
    determines that Nagios will perform a check every two-and-a-half time units. The
    time unit itself is defined by **`interval_length`** in the main configuration
    file **`nagios.cfg`** (see [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")). With the default of 60 seconds,
    a **`check_interval`** of **`2.5`** corresponds to 150 seconds.
  id: totrans-1049
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 3.0 现在允许在指定检查和通知间隔时使用浮点小数。新参数 **`check_interval =2.5`**，取代了 **`normal_check_interval`**，表示
    Nagios 将每两个半时间单位执行一次检查。时间单位本身由主配置文件 **`nagios.cfg`** 中的 **`interval_length`**
    定义（参见 [A.1 主配置文件 nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件 nagios.cfg")）。默认为 60 秒，**`check_interval`** 的 **`2.5`** 对应 150 秒。
- en: H.1.1 The **`host`** object
  id: totrans-1050
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: H.1.1 **`host`** 对象
- en: 'Aliases are no longer absolutely essential in Nagios 3.0\. If this detail is
    missing in the host definition, the host name is used automatically. **`host`**
    objects can make use of the following options from version 3.0:'
  id: totrans-1051
  prefs: []
  type: TYPE_NORMAL
  zh: 别名在Nagios 3.0中不再是绝对必要的。如果主机定义中缺少此细节，则自动使用主机名。**`host`**对象可以从3.0版本开始使用以下选项：
- en: '[PRE72]'
  id: totrans-1052
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: '**`display_name`**'
  id: totrans-1053
  prefs: []
  type: TYPE_NORMAL
  zh: '**`display_name`**'
- en: Defines an alternative name that should appear later in the Web interface and
    other future user interfaces. The CGI programs of Nagios 3.0 do not yet use this
    parameter. The default is **`host_name`**.
  id: totrans-1054
  prefs: []
  type: TYPE_NORMAL
  zh: 定义一个替代名称，该名称应在Web界面和其他未来的用户界面中显示。Nagios 3.0的CGI程序尚未使用此参数。默认值为**`host_name`**。
- en: '**`contacts`**'
  id: totrans-1055
  prefs: []
  type: TYPE_NORMAL
  zh: '**`contacts`**'
- en: Nagios 3.0 now allows individual contacts to be specified directly in the host
    definition. Until now you could only enter contact groups here, so you always
    had to first define a specific contact group for each individual contact. You
    can still use contact groups and specify them together with individual contacts.
  id: totrans-1056
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 3.0现在允许在主机定义中直接指定单个联系人。到目前为止，您只能在此处输入联系人组，因此您必须首先为每个单个联系人定义一个特定的联系人组。您仍然可以使用联系人组，并可以与单个联系人一起指定它们。
- en: '**`first_notification_delay`**'
  id: totrans-1057
  prefs: []
  type: TYPE_NORMAL
  zh: '**`first_notification_delay`**'
- en: Delay the sending of the first notification (in Nagios time units, defined by
    the new parameter **`interval_length`**; see [A.1 The Main Configuration File
    nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1 The
    Main Configuration File nagios.cfg")). Normally Nagios sends a notification immediately
    after a error turns into a hard state. In order for the first notification to
    be sent only after a certain time has elapsed, you previously had to use the escalation
    mechanism (see [12.5 Escalation Management](../Text/ch12s05.html "12.5 Escalation
    Management"), page 282). With the parameter **`first_notification_delay`** this
    can now be done more easily.
  id: totrans-1058
  prefs: []
  type: TYPE_NORMAL
  zh: 延迟发送第一条通知（以Nagios时间单位发送，由新参数**`interval_length`**定义；参见[A.1 主配置文件nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件nagios.cfg")）。通常Nagios在错误变为硬状态后立即发送通知。为了仅在经过一段时间后才发送第一条通知，您之前必须使用升级机制（参见[12.5
    升级管理](../Text/ch12s05.html "12.5 升级管理")，第282页）。现在可以通过参数**`first_notification_delay`**更轻松地完成此操作。
- en: '**`flap_detection_options`**'
  id: totrans-1059
  prefs: []
  type: TYPE_NORMAL
  zh: '**`flap_detection_options`**'
- en: 'With **`flap_detection_options`**, certain states of flap detection ([Appendix B](../Text/apb.html
    "Appendix B. Rapidly Alternating States: Flapping"), page 611) can be ruled out.'
  id: totrans-1060
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**`flap_detection_options`**，可以排除某些翻转检测状态（[附录B](../Text/apb.html "附录B. 快速交替状态：翻转")，第611页）。
- en: Possible values are **`o`** (OK), **`u`**(UNREACHABLE), and **`d`** (DOWN).
    If you exclude the OK states with **`flap_detection_options o`**, Nagios will
    only take into account the change between UNREACHABLE and DOWN.
  id: totrans-1061
  prefs: []
  type: TYPE_NORMAL
  zh: 可能的值是**`o`**（OK）、**`u`**（UNREACHABLE）和**`d`**（DOWN）。如果您使用**`flap_detection_options
    o`**排除OK状态，Nagios将只考虑UNREACHABLE和DOWN之间的变化。
- en: '**`notification_options`**'
  id: totrans-1062
  prefs: []
  type: TYPE_NORMAL
  zh: '**`notification_options`**'
- en: If the new value **`s`** is specified, Nagios will send a notification if a
    maintenance interval (see [16.3 Planning Downtimes](../Text/ch16s03.html "16.3
    Planning Downtimes") from page 359) is started, finished, or canceled.
  id: totrans-1063
  prefs: []
  type: TYPE_NORMAL
  zh: 如果指定了新值**`s`**，则Nagios将在维护间隔（参见[16.3 计划停机时间](../Text/ch16s03.html "16.3 计划停机时间")，第359页)开始、结束或取消时发送通知。
- en: '**`initial_state`**'
  id: totrans-1064
  prefs: []
  type: TYPE_NORMAL
  zh: '**`initial_state`**'
- en: Sets the initial state of the host. Normally Nagios assumes that this is UP
    (**`initial_state o`**). **`d`** sets the initial state to DOWN, **`u`** to UNREACHABLE.
  id: totrans-1065
  prefs: []
  type: TYPE_NORMAL
  zh: 设置主机的初始状态。通常Nagios假设这是UP（**`initial_state o`**）。**`d`** 将初始状态设置为DOWN，**`u`**
    设置为UNREACHABLE。
- en: '**`retry_interval`**'
  id: totrans-1066
  prefs: []
  type: TYPE_NORMAL
  zh: '**`retry_interval`**'
- en: After how many time units will an active host check be repeated if **`max_check_attempts`**
    is larger than 1? There is more on the new features for host checks in [H.7 A
    New Logic for Host Checks](../Text/aphs07.html "H.7 A New Logic for Host Checks").
  id: totrans-1067
  prefs: []
  type: TYPE_NORMAL
  zh: 如果**`max_check_attempts`**大于1，则活动主机检查将在多少时间单位后重复？有关主机检查的新功能的更多信息，请参见[H.7 主机检查的新逻辑](../Text/aphs07.html
    "H.7 主机检查的新逻辑")。
- en: Extended host information
  id: totrans-1068
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 扩展主机信息
- en: The objects **`hostextinfo`** and **`serviceextinfo`** are considered obsolete,
    but are still evaluated by Nagios 3.0\. When checking the configuration, as well
    as on restarting, Nagios issues a corresponding warning. Later Nagios versions
    will no longer support this object type.
  id: totrans-1069
  prefs: []
  type: TYPE_NORMAL
  zh: 对象**`hostextinfo`**和**`serviceextinfo`**被认为是过时的，但Nagios 3.0仍然评估这些对象。在检查配置以及重启时，Nagios会发出相应的警告。以后的Nagios版本将不再支持此对象类型。
- en: 'Additional information for the Web interfaces (see [16.4.1 Extended host information](../Text/ch16s04.html#extended_host_information
    "16.4.1 Extended host information") from page 363) are now defined directly in
    the host (or service):'
  id: totrans-1070
  prefs: []
  type: TYPE_NORMAL
  zh: Web 接口的附加信息（见第 363 页的 [16.4.1 扩展主机信息](../Text/ch16s04.html#extended_host_information
    "16.4.1 扩展主机信息"））现在直接在主机（或服务）中定义：
- en: '[PRE73]'
  id: totrans-1071
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: H.1.2 The service object
  id: totrans-1072
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: H.1.2 服务对象
- en: 'The innovations for the service object are essentially the same as those for
    the host object. The parameters **`flap_detection_options`**, **`notification_options`**,
    and **`initial_state`** are now assigned the values **`w`** (WARNING) and **`c`**
    (CRITICAL) instead of the host states DOWN and UNREACHABLE:'
  id: totrans-1073
  prefs: []
  type: TYPE_NORMAL
  zh: 服务对象的新功能基本上与主机对象相同。参数 **`flap_detection_options`**、**`notification_options`**
    和 **`initial_state`** 现在分配的值是 **`w`**（警告）和 **`c`**（严重），而不是主机状态 DOWN 和 UNREACHABLE：
- en: '[PRE74]'
  id: totrans-1074
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: The three parameters **`contact_groups`**, **`notification_interval`**, and
    **`notification_period`** are no longer mandatory in Nagios 3.0\. If they are
    omitted, they are taken from the **`host`** object. The parameter **`alias`**
    is also optional, and if it is not set, the name is taken from **`service_description`**.
  id: totrans-1075
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 3.0 中，三个参数 **`contact_groups`**、**`notification_interval`** 和 **`notification_period`**
    已不再是强制性的。如果省略，它们将从 **`host`** 对象中获取。参数 **`alias`** 也是可选的，如果未设置，则名称将从 **`service_description`**
    中获取。
- en: The parameter **`parallelize_check`**, which in Nagios 2.0 is set by default
    to 1 and can be altered to prevent parallel service checks, is dropped entirely
    in Nagios 3.0; service checks here are always performed in parallel.
  id: totrans-1076
  prefs: []
  type: TYPE_NORMAL
  zh: 参数 **`parallelize_check`**，在 Nagios 2.0 中默认设置为 1，可以更改以防止并行服务检查，在 Nagios 3.0
    中被完全删除；这里的服务检查总是并行执行的。
- en: The parameters **`normal_check_interval`** and **`retry_check_interval`** were
    renamed to **`check_interval`** and **`retry_interval`**, in order to use the
    same identifier as for the host definition. The old name remains valid so that
    Nagios does not show an error message.
  id: totrans-1077
  prefs: []
  type: TYPE_NORMAL
  zh: 参数 **`normal_check_interval`** 和 **`retry_check_interval`** 已重命名为 **`check_interval`**
    和 **`retry_interval`**，以便使用与主机定义相同的标识符。旧名称仍然有效，以便 Nagios 不显示错误消息。
- en: H.1.3 Group objects
  id: totrans-1078
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: H.1.3 组对象
- en: 'With the parameters **`hostgroup_members`**, **`servicegroup_members`**, and
    **`contactgroup_members`** you can now also define groups of the same type as
    members of a group, and thus form hierarchies:'
  id: totrans-1079
  prefs: []
  type: TYPE_NORMAL
  zh: 使用参数 **`hostgroup_members`**、**`servicegroup_members`** 和 **`contactgroup_members`**，你现在也可以定义与组相同类型的组作为组成员，从而形成层次结构：
- en: '[PRE75]'
  id: totrans-1080
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'Extended group information for the group types **`hostgroup`** and **`service-group`**
    allows additional information to be stored, in a similar way as for host and service
    definitions. **`notes`** here is a simple text which is displayed on the page
    with the extended status information (see [16.2.2 Additional information and control
    center: extinfo.cgi](../Text/ch16s02.html#additional_information_and_control_cent
    "16.2.2 Additional information and control center: extinfo.cgi") in page 339).
    The two URLs point to external Web pages, for instance so that a Wiki can be integrated
    for the purpose of online documentation.'
  id: totrans-1081
  prefs: []
  type: TYPE_NORMAL
  zh: 对于组类型 **`hostgroup`** 和 **`service-group`** 的扩展组信息允许存储附加信息，类似于主机和服务定义。这里的 **`notes`**
    是一个简单的文本，它将在包含扩展状态信息的页面上显示（见第 339 页的 [16.2.2 附加信息和控制中心：extinfo.cgi](../Text/ch16s02.html#additional_information_and_control_cent
    "16.2.2 附加信息和控制中心：extinfo.cgi"））。这两个 URL 指向外部网页，例如，以便将 Wiki 集成到在线文档的目的。
- en: H.1.4 The contact object
  id: totrans-1082
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: H.1.4 联系对象
- en: 'The value **`n`** (none) for the parameters **`host_notifications_options`**
    and **`service_notifications_options`** switches off notifications completely.
    This can also be achieved with a separate on/off function via the interface for
    external commands ([13.1 The Interface for External Commands](../Text/ch13.html#the_interface_for_external_commands
    "13.1 The Interface for External Commands"), page 292), which requires the new
    parameters **`host_notifications_enabled`** and **`service_notifications_enabled`**:'
  id: totrans-1083
  prefs: []
  type: TYPE_NORMAL
  zh: 参数 **`host_notifications_options`** 和 **`service_notifications_options`** 的值
    **`n`**（无）完全关闭通知。这也可以通过外部命令接口的开关功能实现（[13.1 外部命令接口](../Text/ch13.html#the_interface_for_external_commands
    "13.1 外部命令接口"），第 292 页），这需要新的参数 **`host_notifications_enabled`** 和 **`service_notifications_enabled`**：
- en: '[PRE76]'
  id: totrans-1084
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: They can be set to **`1`** (on) or **`0`** (off). **`can_submit_commands`**
    controls whether a contact may only view his hosts and services, or whether he
    can run commands for them via the Web interface. In Nagios 2.0 every user who
    has access to hosts and services may do this. The default is **`1`** (commands
    are allowed), **`0`** allows only viewing.
  id: totrans-1085
  prefs: []
  type: TYPE_NORMAL
  zh: 它们可以被设置为**`1`**（开启）或**`0`**（关闭）。**`can_submit_commands`**控制一个联系人是否只能查看他的主机和服务，或者是否可以通过Web界面为他们运行命令。在Nagios
    2.0中，每个可以访问主机和服务的用户都可以这样做。默认是**`1`**（允许命令），**`0`**只允许查看。
- en: H.1.5 Time definitions
  id: totrans-1086
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: H.1.5 时间定义
- en: 'Periods of time can be defined much more flexibly in Nagios 3.0 than was previously
    the case:'
  id: totrans-1087
  prefs: []
  type: TYPE_NORMAL
  zh: 在Nagios 3.0中，可以比以前更灵活地定义时间段：
- en: '[PRE77]'
  id: totrans-1088
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: 'Whereas Nagios 2.x allows only single weekdays to be defined, you can now also
    specify an ISO date (**`2007-12-23`**), the first day of a specific month (**`april
    1`**), the first day of each month (**`day 1`**), the second Monday in May (**`monday
    2 may`**), or every third Monday in the month (**`monday 3`**). Intervals are
    also allowed here, consisting of two time specifications separated by a - sign.
    In addition, time periods independent of the month or day of the week are possible:
    **`2007-12-01 - 2009-04-01 / 3`** describes evey third day from 01\. 12\. 2007
    to 01\. 04\. 2009.'
  id: totrans-1089
  prefs: []
  type: TYPE_NORMAL
  zh: 与Nagios 2.x只允许定义单个工作日不同，现在你也可以指定ISO日期（**`2007-12-23`**），特定月份的第一天（**`april 1`**），每月的第一天（**`day
    1`**），五月的第二个星期一（**`monday 2 may`**），或每月的第三个星期一（**`monday 3`**）。这里也允许使用间隔，由一个减号分隔的两个时间指定。此外，还可以定义与月份或星期几无关的时间段：**`2007-12-01
    - 2009-04-01 / 3`**描述了从2007年12月1日到2009年4月1日的每第三天。
- en: The parameter **`exclude`** rules out the time periods that follow (themselves
    also **`timeperiod`** objects).
  id: totrans-1090
  prefs: []
  type: TYPE_NORMAL
  zh: 参数**`exclude`**排除了后面的时间段（它们本身也是**`timeperiod`**对象）。
- en: More information on defining times can be found in [2.10 Defining a Time Period
    with timeperiod](../Text/ch02s10.html "2.10 Defining a Time Period with timeperiod")
    from page 74.
  id: totrans-1091
  prefs: []
  type: TYPE_NORMAL
  zh: 在[2.10 使用timeperiod定义时间周期](../Text/ch02s10.html "2.10 使用timeperiod定义时间周期")中可以找到有关定义时间周期的更多信息，该部分位于第74页。
- en: H.1.6 Dependency descriptions
  id: totrans-1092
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: H.1.6 依赖描述
- en: 'There is a new parameter for the objects **`hostdependency`** and **`servicedependency`**
    called **`dependency_period`**, which defines how long dependencies are valid.
    An object of the type **`timeperiod`** is specified as the value. If this parameter
    is missing, dependencies are unrestricted in time:'
  id: totrans-1093
  prefs: []
  type: TYPE_NORMAL
  zh: 对象**`hostdependency`**和**`servicedependency`**有一个新参数称为**`dependency_period`**，它定义了依赖的有效时长。指定一个**`timeperiod`**对象作为值。如果此参数缺失，依赖在时间上不受限制：
- en: '[PRE78]'
  id: totrans-1094
  prefs: []
  type: TYPE_PRE
  zh: '[PRE78]'
- en: 'So-called *Same-Host Dependencies* are also new; these are **`servicedependencies`**
    that refer to the same host. In this case the parameter **`dependend_host_name`**
    is simply omitted:'
  id: totrans-1095
  prefs: []
  type: TYPE_NORMAL
  zh: 所说的*同一主机依赖性*也是新的；这些是**`servicedependencies`**，它们引用同一主机。在这种情况下，参数**`dependend_host_name`**被简单地省略：
- en: '[PRE79]'
  id: totrans-1096
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: The **`Disk_Usage`** service therefore depends on the **`NRPE`** service on
    the same host.
  id: totrans-1097
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，**`Disk_Usage`**服务依赖于同一主机上的**`NRPE`**服务。
- en: If the parameter **`host_name`** is replaced with **`hostgroup_name`**, the
    same dependency can be defined for an entire host group. In Nagios 2.x this is
    not possible. If you defined **`dependent_hostgroup_name`**, the **`Disk_Usage`**
    services for all hosts of the group would be dependent on all the **`NRPE`** services
    for these hosts, which would be counterproductive in many cases.
  id: totrans-1098
  prefs: []
  type: TYPE_NORMAL
  zh: 如果将参数**`host_name`**替换为**`hostgroup_name`**，可以为整个主机组定义相同的依赖关系。在Nagios 2.x中这是不可能的。如果你定义了**`dependent_hostgroup_name`**，该组中所有主机的**`Disk_Usage`**服务将依赖于这些主机上的所有**`NRPE`**服务，这在许多情况下都是不利的。
- en: H.1.7 Escalation objects
  id: totrans-1099
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: H.1.7 升级对象
- en: 'As with the host and service definition, it is also possible starting with
    Nagios 3.0 to specify individual contacts instead of a whole contact group for
    host and service escalations, by means of **`contacts`**:'
  id: totrans-1100
  prefs: []
  type: TYPE_NORMAL
  zh: 与主机和服务定义一样，从Nagios 3.0开始，也可以通过**`contacts`**指定个别联系人而不是整个联系人组来进行主机和服务升级，以代替：
- en: '[PRE80]'
  id: totrans-1101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: H.1.8 Inheritance
  id: totrans-1102
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: H.1.8 继承
- en: 'It was already possible in Nagios 2.x to define templates for objects and for
    the actual object to inherit the properties of the template. Multiple inheritance
    is now possible in Nagios 3.0, and an inheritance can also be selectively suppressed.
    In the following example, the two templates **`host_generic_t`** and **`host_site_t`**
    are inherited by the host **`linux01`**:'
  id: totrans-1103
  prefs: []
  type: TYPE_NORMAL
  zh: 在Nagios 2.x中，已经可以定义对象模板以及实际对象继承模板的属性。Nagios 3.0现在允许多重继承，并且还可以选择性地抑制继承。在以下示例中，两个模板**`host_generic_t`**和**`host_site_t`**被主机**`linux01`**继承：
- en: '[PRE81]'
  id: totrans-1104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: 'The parameters **`check_interval`** and **`retry_interval`** are defined in
    both templates. In this case the first template to be defined (**`host_site_t`**)
    is used, and the result appears as follows:'
  id: totrans-1105
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_interval`** 和 **`retry_interval`** 参数在两个模板中都有定义。在这种情况下，使用的是首先定义的模板（**`host_site_t`**），结果如下所示：'
- en: '[PRE82]'
  id: totrans-1106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: Both check intervals originate from the template **`host_site_t`**. The value
    **`zero`** for **`parents`** suppresses the inheritance; a value defined in the
    templates is not carried over, and the parameter is not set.
  id: totrans-1107
  prefs: []
  type: TYPE_NORMAL
  zh: 两个检查间隔都源自模板 **`host_site_t`**。对于 **`parents`** 的 **`zero`** 值会抑制继承；模板中定义的值不会传递，并且参数不会被设置。
- en: Equally new is the option of combining a specified value with the value from
    the template. The plus sign in **`hostgroups`** carries over the value from the
    template and adds the specified value to this. Until now, inherited values were
    completely overwritten by an object. The defaults from the templates, however,
    can only be combined with the values specified in the object for standard parameters
    containing a list in text form (for example, **`hostgroups`**, **`servicegroups`**,
    **`contact_groups`**).
  id: totrans-1108
  prefs: []
  type: TYPE_NORMAL
  zh: 同样新的是可以将指定值与模板中的值结合起来的选项。在 **`hostgroups`** 中的加号会传递模板中的值并添加指定的值。直到现在，继承的值会被对象完全覆盖。然而，模板中的默认值只能与对象中指定的值结合，这些值是包含文本形式列表的标准参数（例如，**`hostgroups`**、**`servicegroups`**、**`contact_groups`**）。
- en: For **`contact_groups`** within escalations, there is an additional variation
    of the plus sign. If the enclosing escalation object does not define a contact
    group whose properties can be inherited, the accompanying host (for host escalations)
    or service definition (for service escalations) is used. The three parameters
    **`contact_groups`**, **`notification_interval`**, and **`notification_period`**
    are inherited from the host object automatically by the service object, so that
    their definition there is no longer mandatory.
  id: totrans-1109
  prefs: []
  type: TYPE_NORMAL
  zh: 对于在升级中的 **`contact_groups`**，还有一个加号的额外变体。如果包含的升级对象没有定义可以继承属性的联系组，则使用伴随的主机（对于主机升级）或服务定义（对于服务升级）。三个参数
    **`contact_groups`**、**`notification_interval`** 和 **`notification_period`** 会自动由服务对象从主机对象继承，因此在那里定义不再是必需的。
- en: The online documentation included in Nagios uses a more complex example to describe
    multiple inheritance.^([[337](#ftn.APP-H-FN-2)])
  id: totrans-1110
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 包含的在线文档使用一个更复杂的示例来描述多重继承.^([[337](#ftn.APP-H-FN-2)])
- en: '* * *'
  id: totrans-1111
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[336](#APP-H-FN-1)]) See also [http://nagios.sourceforge.net/docs/3_0/whatsnew.html](http://nagios.sourceforge.net/docs/3_0/whatsnew.html).
  id: totrans-1112
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[336](#APP-H-FN-1)]) 参见 [http://nagios.sourceforge.net/docs/3_0/whatsnew.html](http://nagios.sourceforge.net/docs/3_0/whatsnew.html)。
- en: ^([[337](#APP-H-FN-2)]) [http://localhost/nagios/docs/objectinheritance.html](http://localhost/nagios/docs/objectinheritance.html)
  id: totrans-1113
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[337](#APP-H-FN-2)]) [http://localhost/nagios/docs/objectinheritance.html](http://localhost/nagios/docs/objectinheritance.html)
- en: H.2 Variable and Macros
  id: totrans-1114
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: H.2 变量和宏
- en: 'You can define your own variables in the objects **`host`**, **`service`**,
    and **`contact`**. The names of these always begin with an underscore and are
    inherited like normal variables:'
  id: totrans-1115
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在 **`host`**、**`service`** 和 **`contact`** 对象中定义自己的变量。这些变量的名称总是以下划线开头，并且像普通变量一样继承：
- en: '[PRE83]'
  id: totrans-1116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE83]'
- en: 'The variable **`_NRPE_PORT`** is accessed with **`$_HOSTNRPE_PORT$`**, which
    means that the object type (**`HOST`**, **`SERVICE`**, or **`CONTACT`**) is added
    *after* the underscore. This is slightly unfortunate, as it is more difficult
    to read. The macro created can be used elsewhere, for example in the definition
    of a command:'
  id: totrans-1117
  prefs: []
  type: TYPE_NORMAL
  zh: 变量 **`_NRPE_PORT`** 通过 **`$_HOSTNRPE_PORT$`** 访问，这意味着对象类型（**`HOST`**、**`SERVICE`**
    或 **`CONTACT`**）在下划线后添加。这有点不幸，因为它更难阅读。创建的宏可以在其他地方使用，例如在命令的定义中：
- en: '[PRE84]'
  id: totrans-1118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE84]'
- en: Macros allow access to configuration data, states, and check results. In Nagios
    3.0 the macro **`$NOTIFICATIONNUMBER$`**, which contains the number of notifications
    sent for the current state, has been removed. It has been replaced by the host-
    and service-specific macros **`$HOSTNOTIFICATIONNUM-BER$`** and **`$SERVICENOTIFICATIONNUMBER$`**.
  id: totrans-1119
  prefs: []
  type: TYPE_NORMAL
  zh: 宏允许访问配置数据、状态和检查结果。在 Nagios 3.0 中，包含当前状态发送的通知数量的宏 **`$NOTIFICATIONNUMBER$`**
    已被移除。它已被主机和服务特定的宏 **`$HOSTNOTIFICATIONNUM-BER$`** 和 **`$SERVICENOTIFICATIONNUMBER$`**
    替换。
- en: The list of available macros has grown considerably. Some new ones are **`$L0NGH0ST0UTPUT$`**
    and **`$LONGSERVICEOUTPUT$`**, for example, which contain the extended plugin
    output of multiple-line plugin results (see [H.10 Extended Plugin Output](../Text/aphs10.html
    "H.10 Extended Plugin Output") and [8.5.1 Multiple-line plugin output](../Text/ch08s05.html#multiple-line_plugin_output
    "8.5.1 Multiple-line plugin output"), page 193).
  id: totrans-1120
  prefs: []
  type: TYPE_NORMAL
  zh: 可用宏的列表已经大幅增长。例如，一些新宏是 **`$L0NGH0ST0UTPUT$`** 和 **`$LONGSERVICEOUTPUT$`**，它们包含多行插件结果的扩展插件输出（参见[H.10
    扩展插件输出](../Text/aphs10.html "H.10 扩展插件输出")和[8.5.1 多行插件输出](../Text/ch08s05.html#multiple-line_plugin_output
    "8.5.1 多行插件输出")，第193页）。
- en: The macros **`$H0STN0TIFICATI0NID$`**, **`$SERVICENOTIFICATIONID$`**, **`$H0ST-EVENTID$`**,
    **`$SERVICEEVENTID$`**, **`$LASTHOSTEVENTID$`**, and **`$LASTSERVICE-EVENTID$`**
    assign to each event a unique identification number that has been added in Nagios
    3.0.
  id: totrans-1121
  prefs: []
  type: TYPE_NORMAL
  zh: 宏 **`$H0STN0TIFICATI0NID$`**、**`$SERVICENOTIFICATIONID$`**、**`$H0ST-EVENTID$`**、**`$SERVICEEVENTID$`**、**`$LASTHOSTEVENTID$`**
    和 **`$LASTSERVICE-EVENTID$`** 为每个事件分配一个唯一的识别号码，该号码是在Nagios 3.0中添加的。
- en: '**`$HOSTDISPLAYNAME$`** and **`$SERVICEDISPLAYNAME$`** return the **`display_name`**
    set in the host and service definition.'
  id: totrans-1122
  prefs: []
  type: TYPE_NORMAL
  zh: '**`$HOSTDISPLAYNAME$`** 和 **`$SERVICEDISPLAYNAME$`** 返回在主机和服务定义中设置的 **`display_name`**。'
- en: 'Also of interest are the new macros that enable the last state to be accessed:
    **`$LASTHOSTSTATE$`** and **`$LASTHOSTSTATEID$`** give the previous host state,
    and **`$LASTSERVICESTATE$`** and **`$LASTSERVICESTATEID$`** are used for the previous
    service state. The **`*ID`** macros provide the numerical value (e. g., **`2`**
    for the critical state of services), and the other two provide the corresponding
    text (e. g., WARNING for services and DOWN for hosts).'
  id: totrans-1123
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个值得关注的新宏是允许访问最后状态：**`$LASTHOSTSTATE$`** 和 **`$LASTHOSTSTATEID$`** 提供前一个主机状态，而
    **`$LASTSERVICESTATE$`** 和 **`$LASTSERVICESTATEID$`** 用于前一个服务状态。**`*ID`** 宏提供数值（例如，服务的严重状态为**`2`**），而其他两个提供相应的文本（例如，服务为WARNING，主机为DOWN）。
- en: 'Macros can usually also be read out via the environment, but the increased
    number of macros has an effect on performance. If you don''t access Nagios macros
    through environment variables, it is therefore better to switch this feature off
    entirely in Nagios 3.0:'
  id: totrans-1124
  prefs: []
  type: TYPE_NORMAL
  zh: 宏通常也可以通过环境读取，但宏数量的增加会影响性能。如果你不通过环境变量访问Nagios宏，因此在Nagios 3.0中最好完全关闭此功能：
- en: '[PRE85]'
  id: totrans-1125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE85]'
- en: How you can use macros is described in [Appendix D](../Text/apd.html "Appendix D. Macros")
    in page 625\. The complete list of all macros can be found in the online documentation.^([[338](#ftn.APP-H-FN-3)])
    The change log for Nagios 3.0^([[339](#ftn.APP-H-FN-4)]) will tell you which of
    these are new.
  id: totrans-1126
  prefs: []
  type: TYPE_NORMAL
  zh: 如何使用宏在[附录D](../Text/apd.html "附录D. 宏")第625页中描述。所有宏的完整列表可以在在线文档中找到.^([[338](#ftn.APP-H-FN-3)])
    Nagios 3.0的变更日志将告诉你哪些是新的。
- en: '* * *'
  id: totrans-1127
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[338](#APP-H-FN-3)]) [http://nagios.sourceforge.net/docs/3_0/macrolist.html](http://nagios.sourceforge.net/docs/3_0/macrolist.html)
  id: totrans-1128
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[338](#APP-H-FN-3)]) [http://nagios.sourceforge.net/docs/3_0/macrolist.html](http://nagios.sourceforge.net/docs/3_0/macrolist.html)
- en: ^([[339](#APP-H-FN-4)]) [http://nagios.sourceforge.net/docs/3_0/whatsnew.html](http://nagios.sourceforge.net/docs/3_0/whatsnew.html)
  id: totrans-1129
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[339](#APP-H-FN-4)]) [http://nagios.sourceforge.net/docs/3_0/whatsnew.html](http://nagios.sourceforge.net/docs/3_0/whatsnew.html)
- en: H.3 Downtime, Comments, and Acknowledgments
  id: totrans-1130
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: H.3 停机时间、注释和确认
- en: Comments and maintenance intervals are now saved together with other information
    in the status and retention file. These special files and the accompanying parameters
    **`downtime_file`** and **`comment_file`** have been removed from Nagios 3.0\.
    With an upgrade from Nagios 2.x to this version you can keep any existing comments
    and maintenance intervals—how to do this is described in [H.13 Upgrade from Nagios
    2.x to 3.0](../Text/aphs13.html "H.13 Upgrade from Nagios 2.x to 3.0").
  id: totrans-1131
  prefs: []
  type: TYPE_NORMAL
  zh: 注释和维护间隔现在与其他信息一起保存在状态和保留文件中。这些特殊文件和相关参数 **`downtime_file`** 和 **`comment_file`**
    已从Nagios 3.0中删除。从Nagios 2.x升级到这个版本，你可以保留任何现有的注释和维护间隔——如何做到这一点在[H.13 从Nagios 2.x升级到3.0](../Text/aphs13.html
    "H.13 从Nagios 2.x升级到3.0")中描述。
- en: A further change involves the commenting of acknowledgments. Until now, non-persistent
    acknowledgments were deleted with every restart. In Nagios 3.0 they now survive;
    the system deletes the comment for an acknowledgment only when the problem has
    been rectified, so that the service or host status is OK.
  id: totrans-1132
  prefs: []
  type: TYPE_NORMAL
  zh: 另一项变化涉及注释的处理。到目前为止，非持久性注释会在每次重启时被删除。在Nagios 3.0中，它们现在可以保留；系统仅在问题得到纠正时删除注释，以便服务或主机状态为正常。
- en: H.4 Rapidly Changing States
  id: totrans-1133
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: H.4 状态快速变化
- en: Nagios 3.0 now records the state history even when flap detection is switched
    off. If you switch this on globally, with **`enable_flap_detection`** (see [A.1
    The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")), Nagios will test all hosts and
    services immediately for flapping.
  id: totrans-1134
  prefs: []
  type: TYPE_NORMAL
  zh: 即使关闭了翻转检测，Nagios 3.0 现在也会记录状态历史。如果您全局开启 **`enable_flap_detection`**（参见第 796
    页的 [A.1 主配置文件 nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件 nagios.cfg")），Nagios 将立即对所有主机和服务进行翻转测试。
- en: For globally switched off flap detection, Nagios logs flapping states to the
    log file and sends messages of the notification type FLAPPINGDISABLED, if you
    have specified **`f`** (flapping) in the **`notification_options`** in the host
    or service definition.
  id: totrans-1135
  prefs: []
  type: TYPE_NORMAL
  zh: 对于全局关闭翻转检测，如果主机或服务定义中的 **`notification_options`** 中指定了 **`f`**（翻转），Nagios 将将翻转状态记录到日志文件，并发送通知类型为
    FLAPPINGDISABLED 的消息。
- en: Whereas Nagios 2.x still recorded every change in state, in Nagios 3.0 the parameter
    **`flap_detection_options`** (see [H.1.1 The host object](../Text/aph.html#the_host_object
    "H.1.1 The host object"), page 679) allows this to be restricted to certain states.
    Only the states specified are then included in the calculation of the change in
    state.
  id: totrans-1136
  prefs: []
  type: TYPE_NORMAL
  zh: 与 Nagios 2.x 仍然记录每个状态变化不同，在 Nagios 3.0 中，参数 **`flap_detection_options`**（参见第
    679 页的 [H.1.1 主机对象](../Text/aph.html#the_host_object "H.1.1 主机对象")）允许将其限制为某些状态。然后只将指定的状态包含在状态变化计算中。
- en: H.5 External Commands
  id: totrans-1137
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: H.5 外部命令
- en: The list of external commands has grown larger in Nagios 3.0, so that considerably
    more things can be set through the relevant interface (see [13.1 The Interface
    for External Commands](../Text/ch13.html#the_interface_for_external_commands "13.1
    The Interface for External Commands"), page 292.).
  id: totrans-1138
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Nagios 3.0 中，外部命令列表变得更长，因此可以通过相关界面设置更多的事情（参见第 292 页的 [13.1 外部命令的界面](../Text/ch13.html#the_interface_for_external_commands
    "13.1 外部命令的界面")）。
- en: 'Of special interest here is the command **`PROCESS_FILE`**, which is passed
    a file that itself contains external commands. This allows for the bulk processing
    of passive checks:'
  id: totrans-1139
  prefs: []
  type: TYPE_NORMAL
  zh: 其中，命令 **`PROCESS_FILE`** 特别引人注目，它传递一个包含外部命令的文件。这允许大量处理被动检查：
- en: '[PRE86]'
  id: totrans-1140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE86]'
- en: '**`PROCESS_FILE`** requires the full path to the file that is to be processed.
    The second argument determines whether the file is kept after processing (**`0`**)
    or deleted (a value not equal to **`0`**).'
  id: totrans-1141
  prefs: []
  type: TYPE_NORMAL
  zh: '**`PROCESS_FILE`** 需要指定要处理的文件的完整路径。第二个参数决定在处理完成后是否保留文件（**`0`** 表示保留）或删除（非 **`0`**
    值）。'
- en: 'Two other new commands allow you to make your own notifications. Notifications
    actually have a fixed type (**`PROBLEM`**, **`RECOVERY`**, **`ACKNOWLEDGE`**,
    etc.; see [Table 12-1](../Text/ch12s04.html#macros_used_in_notify-by-email_and_host
    "Table 12-1. Macros used in notify-by-email and host-notify-by-email") in page
    277), which is queried via the macro **`$N0TIFI-CATI0NTYPE$`**. The so-called
    *Custom Notifications*, in contrast, are of the type **`CUSTOM`** and allow notifications
    outside the otherwise strict rules. This means that broadcasts—messages to all—are
    also possible:'
  id: totrans-1142
  prefs: []
  type: TYPE_NORMAL
  zh: 另外两个新命令允许您创建自己的通知。通知实际上有一个固定的类型（**`PROBLEM`**、**`RECOVERY`**、**`ACKNOWLEDGE`**
    等；参见第 277 页的 [表 12-1](../Text/ch12s04.html#macros_used_in_notify-by-email_and_host
    "表 12-1. 在 notify-by-email 和 host-notify-by-email 中使用的宏")），通过宏 **`$N0TIFI-CATI0NTYPE$`**
    进行查询。所谓的 *自定义通知*，相比之下，类型为 **`CUSTOM`**，允许在通常严格的规则之外进行通知。这意味着广播——对所有人的消息——也是可能的：
- en: '[PRE87]'
  id: totrans-1143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE87]'
- en: Instead of the *options* placeholder, you specify a bitmask, which controls
    the behavior of the two commands. The value **`0`** means "no option set." **`1`**
    ensures a broadcast message to all normal contacts and to those who are added
    during an escalation. **`2`** forces the message to be sent, regardless of whether
    notifications are switched on or off for the host, service, or contact, and ignores
    any time window that may be set. Finally, the value **`4`** increments the notification
    counter, and the message is then counted in the escalation procedure. Normally
    a Custom Notification is not counted.
  id: totrans-1144
  prefs: []
  type: TYPE_NORMAL
  zh: 代替 *选项* 占位符，您指定一个位掩码，它控制两个命令的行为。值 **`0`** 表示“未设置选项。”**`1`** 确保向所有正常联系人以及在整个升级过程中添加的联系人发送广播消息。**`2`**
    强制发送消息，无论主机、服务或联系人是否启用了通知，并且忽略可能设置的任何时间窗口。最后，值 **`4`** 增加通知计数器，消息随后在升级过程中被计数。通常自定义通知不会被计数。
- en: A complete description of all external commands is provided on the developer
    pages of the Nagios homepage.^([[340](#ftn.APP-H-FN-5)]) The Web interface there
    enables a selective search to be made for commands that are allowed in a specific
    Nagios version or deal with a certain topic (for example, services, hosts, **scheduled
    downtime** (maintenance window), **notifications**).
  id: totrans-1145
  prefs: []
  type: TYPE_NORMAL
  zh: 所有外部命令的完整描述都提供在 Nagios 主页的开发者页面。[^[[340](#ftn.APP-H-FN-5)]) 那里的 Web 界面允许进行选择性搜索，以查找特定
    Nagios 版本允许的命令或处理特定主题（例如，服务、主机、**计划内停机**（维护窗口）、**通知**）。
- en: '* * *'
  id: totrans-1146
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[340](#APP-H-FN-5)]) [http://www.nagios.org/developerinfo/externalconunands/conunandlist.php](http://www.nagios.org/developerinfo/externalconunands/conunandlist.php)
  id: totrans-1147
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[340](#APP-H-FN-5)]) [http://www.nagios.org/developerinfo/externalconunands/conunandlist.php](http://www.nagios.org/developerinfo/externalconunands/conunandlist.php)
- en: H.6 Embedded Perl
  id: totrans-1148
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: H.6 嵌入式 Perl
- en: Handling the Embedded Perl Interpreter (see [Appendix G](../Text/apg.html "Appendix G. The
    Embedded Perl Interpreter") from page 669) is also easier in Nagios 3.0\. It can
    be switched on or off with the parameter **`enable_embeded_perl`** in the main
    configuration file **`nagios.cfg`**. The parameter **`use_embedded_perl_implicitly`**
    controls whether a plugin should implicitly use the activated interpreter if there
    are no instructions to the contrary (see also [G.2 Using ePN](../Text/apgs02.html
    "G.2 Using ePN") from page 672). In Nagios 2.x there was only the option of switching
    the interpreter on or off when compiling the Nagios system.
  id: totrans-1149
  prefs: []
  type: TYPE_NORMAL
  zh: 处理嵌入式 Perl 解释器（参见第 669 页的 [附录 G](../Text/apg.html "附录 G. 嵌入式 Perl 解释器")）在 Nagios
    3.0 中也更容易。它可以通过主配置文件 **`nagios.cfg`** 中的参数 **`enable_embeded_perl`** 来开启或关闭。参数
    **`use_embedded_perl_implicitly`** 控制是否在没有相反指令的情况下，插件应隐式使用激活的解释器（有关更多信息，请参阅第 672
    页的 [G.2 使用 ePN](../Text/apgs02.html "G.2 使用 ePN")）。在 Nagios 2.x 中，在编译 Nagios 系统时只有开启或关闭解释器的选项。
- en: If the switch **`--with-embedded-perl`** is enabled, the **`configure`** script
    of Nagios 3.0 automatically uses the switch **`--with-perlcache`** as well. If
    Nagios detects that something has changed in the script to be executed, it will
    reload the script. In version 2.x you had to restart Nagios with the Perl cache
    switched on.
  id: totrans-1150
  prefs: []
  type: TYPE_NORMAL
  zh: 如果启用了开关 **`--with-embedded-perl`**，Nagios 3.0 的 **`configure`** 脚本将自动使用开关 **`--with-perlcache`**。如果
    Nagios 检测到要执行的脚本中有所变化，它将重新加载脚本。在 2.x 版本中，您必须开启 Perl 缓存后重启 Nagios。
- en: H.7 A New Logic for Host Checks
  id: totrans-1151
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: H.7 主机检查的新逻辑
- en: Nagios 2.x performs host checks serially, so it waits for the results of the
    individual check before checking other hosts in the direct vicinity to find out
    if the first host is DOWN or UNREACHABLE (see the figure in [4.1 Taking into Account
    the Network Topology](../Text/ch04.html#taking_into_account_the_network_topology
    "4.1 Taking into Account the Network Topology")). In contrast, Nagios 3.0 works
    in parallel here, provided that the parameter **`max_check_attempts`** for the
    host to be checked is larger than **`1`**. For **`max_check_attempts=l`** the
    system behaves as in version 2.x.
  id: totrans-1152
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 2.x 以串行方式执行主机检查，因此它会在检查直接附近的其他主机之前等待单个检查的结果，以确定第一个主机是否是 DOWN 或 UNREACHABLE（参见
    [4.1 考虑网络拓扑](../Text/ch04.html#taking_into_account_the_network_topology "4.1 考虑网络拓扑")
    中的图）。相比之下，Nagios 3.0 在这里以并行方式工作，前提是待检查的主机的 **`max_check_attempts`** 参数大于 **`1`**。对于
    **`max_check_attempts=l`**，系统的行为与 2.x 版本相同。
- en: In some cases this strongly influence performance, so you should always set
    a value larger than **`1`** in Nagios 3.0\. Running host checks in parallel also
    means that a check result will sometimes get lost, since Nagios no longer waits
    until the result for every single check is available. The parameter **`check_for_orphaned_hosts`**
    now ensures that Nagios will deal with orphaned checks.
  id: totrans-1153
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，这会强烈影响性能，因此您应该在 Nagios 3.0 中始终设置一个大于 **`1`** 的值。并行运行主机检查也意味着有时会丢失检查结果，因为
    Nagios 不再等待每个单个检查的结果都可用。参数 **`check_for_orphaned_hosts`** 现在确保 Nagios 将处理孤儿检查。
- en: Active host checks can even improve performance in certain environments, if
    the equally new feature of *check caching* is used. Here Nagios accesses the result
    of a recently performed check, provided that this can be considered to be up to
    date. This means that the system saves a considerable amount of time in host checks
    for failed services, in resolving the topology for failed hosts, and for forward-looking
    dependency checks (see last section). For service checks, caching only plays a
    role for service dependencies.
  id: totrans-1154
  prefs: []
  type: TYPE_NORMAL
  zh: 如果使用同样新功能的 *缓存检查*，主动主机检查甚至可以在某些环境中提高性能。在这种情况下，Nagios 访问最近执行的检查结果，前提是这可以被认为是最新的。这意味着系统在处理失败服务的宿主机检查、解决失败宿主机的拓扑结构以及前瞻性依赖性检查（见最后一节）时可以节省大量时间。对于服务检查，缓存仅在服务依赖性方面发挥作用。
- en: How large the time horizon for caching should be is defined for host checks
    by the parameter **`cached_host_check_horizon`** (see also [A.1 The Main Configuration
    File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    The Main Configuration File nagios.cfg")) and for service checks by the parameter
    **`cached_service_check_horizon`** ([A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")). The default is 15 seconds in each
    case, and the value **`0`** switches caching off entirely.
  id: totrans-1155
  prefs: []
  type: TYPE_NORMAL
  zh: 缓存的时间范围应该有多大，对于主机检查由参数 **`cached_host_check_horizon`** (参见 [A.1 主配置文件 nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件 nagios.cfg")) 定义，对于服务检查由参数 **`cached_service_check_horizon`** ([A.1
    主配置文件 nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    主配置文件 nagios.cfg")) 定义。默认情况下，每个参数都是 15 秒，而值 **`0`** 完全关闭缓存。
- en: 'The larger the time interval in which Nagios caches results, the more often
    Nagios accesses the cache without actually performing the check itself. However,
    this does have a crucial disadvantage: The cached result may be obsolete. Therefore,
    you always need to compromise between obsolete results and taking the strain off
    Nagios. You will have to decide for yourself how large the time interval for caching
    should be. Again, the preferred method is to measure the latency times of service
    checks, which are a good indication of the performance of Nagios. If there is
    no visible difference over a long period of time between a caching time of 30
    seconds and one of 60 seconds, it is better to select the shorter period, since
    you will be working with more up-to-date results in this case. How you measure
    the latency times of checks is described in [F.1.3 A plugin to monitor latency](../Text/apf.html#a_plugin_to_monitor_latency
    "F.1.3 A plugin to monitor latency") from page 660.'
  id: totrans-1156
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 缓存结果的间隔越大，Nagios 访问缓存而不实际执行检查的频率就越高。然而，这确实有一个关键缺点：缓存的結果可能已过时。因此，您始终需要在过时的结果和减轻
    Nagios 的负担之间做出妥协。您必须自己决定缓存的时间间隔应该有多大。再次强调，首选的方法是测量服务检查的延迟时间，这可以很好地指示 Nagios 的性能。如果在
    30 秒和 60 秒的缓存时间之间，长时间内没有明显的差异，那么选择较短的时间间隔更好，因为在这种情况下，您将使用更及时的结果。如何测量检查的延迟时间，请参阅第
    660 页的 [F.1.3 监控延迟的插件](../Text/apf.html#a_plugin_to_monitor_latency "F.1.3 监控延迟的插件")。
- en: Whether or not active host checks in combination with check caching lead to
    an improvement in performance can also be tested with **`nagiostats`** ([F.1.1
    The command-line tool nagiostats](../Text/apf.html#the_command-line_tool_nagiostats
    "F.1.1 The command-line tool nagiostats"), page 654). The program displays the
    number of cached host checks whose results have been reused by Nagios in the last
    minute, in the last five minutes, and in the last fifteen minutes.
  id: totrans-1157
  prefs: []
  type: TYPE_NORMAL
  zh: 是否通过结合主动主机检查和缓存检查可以提高性能，也可以用 **`nagiostats`** ([F.1.1 命令行工具 nagiostats](../Text/apf.html#the_command-line_tool_nagiostats
    "F.1.1 命令行工具 nagiostats"), 第 654 页)) 进行测试。程序显示在过去一分钟、过去五分钟和过去十五分钟内，Nagios 重新使用缓存的宿主机检查结果的次数。
- en: 'In distributed environments, or for redundant Nagios installations, the perspective
    is sometimes altered: Nagios server A has a different topological view of the
    network than Nagios server B. The result of a host check that server A sends to
    server B as a passive check result may in some cases no longer match. What is
    categorized by server A as UNREACHABLE may be a failed host in the DOWN state
    from the perspective of server B. The parameter **`translate_passive_host_checks`**
    ([A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")) enables Nagios to reclassify passive
    host checks that it has been sent.'
  id: totrans-1158
  prefs: []
  type: TYPE_NORMAL
  zh: 在分布式环境中，或者对于冗余的Nagios安装，有时视角会发生变化：Nagios服务器A对网络的拓扑视图与Nagios服务器B不同。服务器A发送给服务器B作为被动检查结果的主机检查结果在某些情况下可能不再匹配。服务器A分类为UNREACHABLE的，从服务器B的角度看可能是一个处于DOWN状态失败的主机。参数
    **`translate_passive_host_checks`** ([A.1 主配置文件 nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件 nagios.cfg")) 允许Nagios重新分类它已接收的被动主机检查。
- en: To achieve greater fine-tuning, passive host checks may now also accept a soft
    state if you set the parameter **`max_check_attempts`** in the host definition
    to a value larger than **`1`** and enable the parameter **`passive_host_checks_are_soft`**
    (page 600) in the main configuration file. Until now, passive host checks were
    always "hard."
  id: totrans-1159
  prefs: []
  type: TYPE_NORMAL
  zh: 为了实现更精细的调整，如果将主机定义中的参数 **`max_check_attempts`** 设置为大于 **`1`** 的值，并在主配置文件中启用参数
    **`passive_host_checks_are_soft`**（第600页），被动主机检查现在也可以接受软状态。到目前为止，被动主机检查始终是“硬”的。
- en: H.8 Restart
  id: totrans-1160
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: H.8 重启
- en: 'When you start Nagios, it rechecks the configuration each time for errors and
    dependencies. Depending on the specific environment, this can be very quick, or
    it may last a long time, during which Nagios will not operate. In Nagios 3.0 there
    is an option to disconnect this test from the restart and instead save the result
    in a separate temporary file. When Nagios starts, it will read this file, and
    the otherwise usual processing of objects is left out at this point. Whether this
    is worthwhile or not is revealed by **`nagios -s`**:'
  id: totrans-1161
  prefs: []
  type: TYPE_NORMAL
  zh: 当你启动Nagios时，它会每次重新检查配置以查找错误和依赖关系。根据具体环境，这可能非常快，或者可能持续很长时间，在此期间Nagios将不会运行。在Nagios
    3.0中，有一个选项可以将此测试与重启分离，并将结果保存到单独的临时文件中。当Nagios启动时，它会读取此文件，并且在这个点上省略了通常的对象处理。是否值得这样做可以通过
    **`nagios -s`** 来揭示：
- en: '[PRE88]'
  id: totrans-1162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE88]'
- en: The times marked with **`*`** are saved with this *precaching* procedure. In
    this example, 75 percent of the startup time is occupied with processing the defined
    objects, but in absolute terms, this is just a tenth of a second and so is hardly
    worth mentioning.
  id: totrans-1163
  prefs: []
  type: TYPE_NORMAL
  zh: 标记有 **`*`** 的时间是通过这种 *预缓存* 程序保存的。在这个例子中，启动时间的75%用于处理定义的对象，但从绝对意义上讲，这仅仅是十分之一秒，所以几乎不值一提。
- en: 'If there is real potential for savings, precaching is turned on with the following
    steps:'
  id: totrans-1164
  prefs: []
  type: TYPE_NORMAL
  zh: 如果有真正的节省潜力，可以通过以下步骤打开预缓存：
- en: '[PRE89]'
  id: totrans-1165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE89]'
- en: The first call uses the options **`-v`** to check the configuration and **`-p`**
    to cache the processed objects in a separate file. The file is defined in **`nagios.cfg`**
    with the parameter **`precached_object_file`** ([A.1 The Main Configuration File
    nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1 The
    Main Configuration File nagios.cfg")). Then Nagios is stopped in the second step.
  id: totrans-1166
  prefs: []
  type: TYPE_NORMAL
  zh: 第一次调用使用选项 **`-v`** 检查配置，并使用 **`-p`** 将处理过的对象缓存到单独的文件中。该文件由 **`nagios.cfg`**
    文件中的参数 **`precached_object_file`** 定义（[A.1 主配置文件 nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件 nagios.cfg")）。然后，在第二步停止Nagios。
- en: The third step is to start the system with the options **`-udx`**. The option
    **`-u`** reads the contents of the precaching file, and **`-d`** starts Nagios
    as a daemon, as normal. **`-x`** prevents the test for circular dependencies,
    but assumes that this call is always based on a tested configuration, like the
    one generated in step 1\. Whether the option **`-x`** really saves time or not
    can be seen in the example above from the line **`Circular Paths`** in the **`CONFIG
    VERIFICATION TIMES`** section.
  id: totrans-1167
  prefs: []
  type: TYPE_NORMAL
  zh: 第三步是使用选项 **`-udx`** 启动系统。选项 **`-u`** 读取预缓存文件的內容，**`-d`** 正常启动Nagios作为守护进程。**`-x`**
    防止循环依赖的测试，但假设这个调用始终基于一个经过测试的配置，就像步骤1中生成的配置一样。选项 **`-x`** 是否真的节省时间，可以从上面的例子中 **`CONFIG
    VERIFICATION TIMES`** 部分的 **`Circular Paths`** 行中看出。
- en: H.9 Performance Optimization
  id: totrans-1168
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: H.9 性能优化
- en: Besides performance optimizations that are not externally visible, Nagios 3.0
    includes a number of parameters intended to improve performance in large installations.
    The most important of these is **`large_installation_tweaks`** ([F.2.6 Preferring
    passive checks](../Text/apfs03.html "F.2.6 Preferring passive checks")).
  id: totrans-1169
  prefs: []
  type: TYPE_NORMAL
  zh: 除了对外部不可见的性能优化之外，Nagios 3.0 还包括一些旨在提高大型安装性能的参数。其中最重要的是 **`large_installation_tweaks`**
    ([F.2.6 优先使用被动检查](../Text/apfs03.html "F.2.6 优先使用被动检查"))。
- en: The improvement of performance in an existing environment is dealt with in [Appendix F](../Text/apf.html
    "Appendix F. Tips on Optimizing Performance") from page 653.
  id: totrans-1170
  prefs: []
  type: TYPE_NORMAL
  zh: 在现有环境中性能的提升处理可以在 [附录 F](../Text/apf.html "附录 F. 优化性能的技巧") 从第 653 页找到。
- en: H.10 Extended Plugin Output
  id: totrans-1171
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: H.10 扩展插件输出
- en: Nagios 3.0 is finally capable of processing multi-line plugin output. The total
    length of the output must not exceed 8 KB—but you must also make sure that all
    the transmission paths are compatible for such an amount of data. NRPE currently
    still needs to be adjusted in the source code ([8.5.2 Installation requirements](../Text/ch08s05.html#installation_requirements
    "8.5.2 Installation requirements")); the plugin **`check_by_ssh`** from the standard
    plugins inversion 1.4.10 ([Chapter 9](../Text/ch09.html "Chapter 9. Executing
    Plugins via SSH")) can deal with the 8 KB.
  id: totrans-1172
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 3.0 最终能够处理多行插件输出。输出的总长度不得超过 8 KB——但你必须确保所有传输路径都能兼容这么大的数据量。NRPE 目前仍需要在源代码中进行调整（[8.5.2
    安装要求](../Text/ch08s05.html#installation_requirements "8.5.2 安装要求")）；标准插件反转 1.4.10
    中的插件 **`check_by_ssh`**（[第 9 章](../Text/ch09.html "第 9 章. 通过 SSH 执行插件"））可以处理 8
    KB。
- en: The format of the extended and muti-line outputs are described in [8.5.1 Multiple-line
    plugin output](../Text/ch08s05.html#multiple-line_plugin_output "8.5.1 Multiple-line
    plugin output") (page 193), and an example of the use of the extended format is
    provided by the plugin **`check_multi`** ([8.5 Summarizing Checks with check_multi](../Text/ch08s05.html
    "8.5 Summarizing Checks with check_multi") from page 191).
  id: totrans-1173
  prefs: []
  type: TYPE_NORMAL
  zh: 扩展和多行输出的格式在 [8.5.1 多行插件输出](../Text/ch08s05.html#multiple-line_plugin_output
    "8.5.1 多行插件输出")（第 193 页）中描述，插件 **`check_multi`**（[8.5 使用 check_multi 汇总检查](../Text/ch08s05.html
    "8.5 使用 check_multi 汇总检查"）从第 191 页）提供了一个扩展格式的使用示例。
- en: H.11 CGI
  id: totrans-1174
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: H.11 CGI
- en: The Nagios Web interface has also undergone some interesting changes. Some new
    parameters have been added to the configuration file **`cgi.cfg`** ([A.2 CGI Configuration
    in cgi.cfg](../Text/apas02.html "A.2 CGI Configuration in cgi.cfg"), page 606).
    **`lock_author_names`** prevents the user name, which is included if you set an
    acknowledgement or a comment on a host or service, from being changed. Instead
    the user name specified by the user when authenticating himself to the Web server
    is used. Each registered user is thus an authenticated user.
  id: totrans-1175
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 网络界面也经历了一些有趣的变化。配置文件 **`cgi.cfg`**（[A.2 cgi.cfg 中的 CGI 配置](../Text/apas02.html
    "A.2 cgi.cfg 中的 CGI 配置"，第 606 页)）中添加了一些新参数。**`lock_author_names`** 防止在设置主机或服务的确认或注释时包含的用户名被更改。相反，使用用户在向
    Web 服务器进行身份验证时指定的用户名。因此，每个注册用户都是一个经过身份验证的用户。
- en: '**`escape_html_tags`** determines whether HTML formatting in the plugin output
    is used (value **`0`**) or whether Nagios removes it (value **`1`**). In order
    to link it with **`action_url`** ([16.4.1 Extended host information](../Text/ch16s04.html#extended_host_information
    "16.4.1 Extended host information")) and **`notes_url`** ([16.4.1 Extended host
    information](../Text/ch16s04.html#extended_host_information "16.4.1 Extended host
    information")), there is now an additional option to specify a target window,
    with **`action_url_target`** and **`notes_url_target`**.'
  id: totrans-1176
  prefs: []
  type: TYPE_NORMAL
  zh: '**`escape_html_tags`** 决定了插件输出中的 HTML 格式是否被使用（值 **`0`**）或者 Nagios 是否将其移除（值
    **`1`**）。为了与 **`action_url`** ([16.4.1 扩展主机信息](../Text/ch16s04.html#extended_host_information
    "16.4.1 扩展主机信息")) 和 **`notes_url`** ([16.4.1 扩展主机信息](../Text/ch16s04.html#extended_host_information
    "16.4.1 扩展主机信息")) 相关联，现在有一个额外的选项来指定目标窗口，即 **`action_url_target`** 和 **`notes_url_target`**。'
- en: 'With the CGI program **`status.cgi`** ([16.2.1 Variations in status display:
    status.cgi](../Text/ch16s02.html#variations_in_status_display_colon_stat "16.2.1
    Variations in status display: status.cgi"), page 334) you can now select hard
    and soft states via **`hostprops`** and **`serviceprops`** as well. This is particularly
    useful when using NagVis ([Chapter 18](../Text/ch18.html "Chapter 18. NagVis"),
    page 389), since NagVis by default only displays hard error states.'
  id: totrans-1177
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 CGI 程序 **`status.cgi`**（参见 [16.2.1 状态显示的变体：status.cgi](../Text/ch16s02.html#variations_in_status_display_colon_stat
    "16.2.1 状态显示的变体：status.cgi"，第 334 页)），您现在也可以通过 **`hostprops`** 和 **`serviceprops`**
    选择硬状态和软状态。这在使用 NagVis ([第 18 章](../Text/ch18.html "第 18 章. NagVis"，第 389 页)）时尤其有用，因为
    NagVis 默认只显示硬错误状态。
- en: H.12 Miscellaneous
  id: totrans-1178
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: H.12 杂项
- en: One of the improvements that does not fit into any of the above sections is
    the parameter **`use_timezone`** (page 606), with which you can set the time zone
    independently of the time zone set on the Nagios server. This is only necessary
    if several Nagios instances are running on a single machine.
  id: totrans-1179
  prefs: []
  type: TYPE_NORMAL
  zh: 上述各节中未包含的改进之一是参数 **`use_timezone`**（第 606 页），您可以使用它独立于 Nagios 服务器上设置的时间区域来设置时区。这仅在多个
    Nagios 实例在单个机器上运行时才是必要的。
- en: The parameter **`additional_freslmess_latency`** (see [Appendix A](../Text/apa.html
    "Appendix A. An Overview of the Nagios Configuration Parameters")) delays freshness
    checks (see [13.4 Reacting to Out-of-Date Information of Passive Checks](../Text/ch13s04.html
    "13.4 Reacting to Out-of-Date Information of Passive Checks"), page 295), normally
    using a time period specified in seconds, in case Nagios has to wait too long
    for a result for passive checks.
  id: totrans-1180
  prefs: []
  type: TYPE_NORMAL
  zh: 参数 **`additional_freslmess_latency`**（参见 [附录 A](../Text/apa.html "附录 A. Nagios
    配置参数概述"））延迟了新鲜度检查（参见 [13.4 对被动检查过时信息的响应](../Text/ch13s04.html "13.4 对被动检查过时信息的响应"，第
    295 页)），通常使用以秒为单位指定的时间段，以防 Nagios 等待被动检查的结果时间过长。
- en: The directives **`cfg_file`** and **`cfg_dir`** ([A.1 The Main Configuration
    File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    The Main Configuration File nagios.cfg")) can now also handle relative paths.
    The base directory is the directory containing the file **`nagios.cfg`**.
  id: totrans-1181
  prefs: []
  type: TYPE_NORMAL
  zh: 指令 **`cfg_file`** 和 **`cfg_dir`**（参见 [A.1 主配置文件 nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件 nagios.cfg"））现在也可以处理相对路径。基本目录是包含文件 **`nagios.cfg`** 的目录。
- en: The parameter **`temp_path`** allows a temporary directory to be specified explicitly
    (in Nagios 2.x the temporary space consists of only a single file, defined in
    the parameter **`temp_file`**).
  id: totrans-1182
  prefs: []
  type: TYPE_NORMAL
  zh: 参数 **`temp_path`** 允许显式指定临时目录（在 Nagios 2.x 中，临时空间仅由一个文件组成，该文件由参数 **`temp_file`**
    定义）。
- en: Nagios 3.0 now allows multiple-line instructions in all configuration files.
    An instruction that is continued on the following line must end with a backslash
    **`\`**.
  id: totrans-1183
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 3.0 现在允许所有配置文件中包含多行指令。在下一行继续的指令必须以反斜杠 **`\`** 结尾。
- en: H.13 Upgrade from Nagios 2.x to 3.0
  id: totrans-1184
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: H.13 从 Nagios 2.x 升级到 3.0
- en: If you already have a running Nagios-2.x environment, you can change over to
    Nagios 3.0 with little effort. The existing configuration will usually run unchanged.
  id: totrans-1185
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你已经有一个运行的 Nagios-2.x 环境，你可以轻松地过渡到 Nagios 3.0。现有的配置通常不会改变。
- en: 'Nagios 3.0 is very particular when testing, however. It is quite possible that
    a so far undiscovered error—one tolerated or ignored by Nagios 2.0—will prevent
    Nagios 3.0 from starting. It is therefore a good idea to test your configuration
    before upgrading. To do this, you run the installation as described in [1.2 Compiling
    Source Code](../Text/ch01s02.html "1.2 Compiling Source Code") in page 39 with
    **`configure`** and **`make all`**, but without running **`make install`**. You
    will obtain an executable Nagios-3.0 binary in the **`base`** subdirectory, which
    you can use to test the existing configuration from the source code directory:'
  id: totrans-1186
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，Nagios 3.0 在测试时非常挑剔。很可能是一个迄今为止未发现的错误——Nagios 2.0 可以容忍或忽略的错误——将阻止 Nagios 3.0
    启动。因此，在升级之前测试您的配置是一个好主意。为此，您按照 [1.2 编译源代码](../Text/ch01s02.html "1.2 编译源代码"，第
    39 页)中描述的步骤运行安装，使用 **`configure`** 和 **`make all`**，但不运行 **`make install`**。您将在
    **`base`** 子目录中获得可执行的 Nagios-3.0 二进制文件，您可以使用它从源代码目录测试现有的配置：
- en: '[PRE90]'
  id: totrans-1187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE90]'
- en: If Nagios finds an error here, this error will prevent the start of the new
    Nagios version if it is not eliminated. At some points Nagios 3.0 will give warnings
    and information about the new features, but these do not stand in the way of a
    restart.
  id: totrans-1188
  prefs: []
  type: TYPE_NORMAL
  zh: 如果Nagios在这里发现错误，如果不消除这个错误，它将阻止新版本的Nagios启动。在某些点上，Nagios 3.0会给出关于新特性的警告和信息，但这些不会阻碍重启。
- en: Nevertheless, there are a few small details that you should attend to before
    Nagios 3.0 goes into operation. The parameter **`service_reaper_frequency`** is
    now called **`check_result_reaper_frequency`** ([A.1 The Main Configuration File
    nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1 The
    Main Configuration File nagios.cfg")); it is simply renamed in **`nagios.cfg.aggregate_status_updates`**
    is removed altogether, so it is commented out in **`nagios.cfg`**.
  id: totrans-1189
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管如此，在Nagios 3.0投入运行之前，还有一些小细节需要注意。参数**`service_reaper_frequency`**现在被称为**`check_result_reaper_frequency`**
    ([A.1 主配置文件 nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件 nagios.cfg")); 它在**`nagios.cfg.aggregate_status_updates`**中被完全删除，因此在**`nagios.cfg`**中被注释掉。
- en: The macro **`$NOTIFICATIONNUMBER$`** was sensibly split up into a host- and
    a service-specific macro (**`$HOSTNOTIFICATIONNUMBER$`** and **`$SERVICEN0TI-FICATI0NNUMBER$`**).
    Commands and scripts that use the macro must be adjusted to ensure that they work
    correctly.
  id: totrans-1190
  prefs: []
  type: TYPE_NORMAL
  zh: 宏**`$NOTIFICATIONNUMBER$`**被合理地拆分为主机和特定服务的宏（**`$HOSTNOTIFICATIONNUMBER$`**和**`$SERVICEN0TI-FICATI0NNUMBER$`**）。使用该宏的命令和脚本必须进行调整，以确保它们能正确工作。
- en: 'In order to retain the maintenance intervals and comments from the no longer
    used files specified in **`downtime_file`** and **`comment_file`** (in this book,
    **`comments.dat`** and **`downtime.dat`**), you must stop Nagios, save them, and
    then remove the Info block at the beginning from them, since this may occur only
    once in the new file, specified in **`retention_file`**:'
  id: totrans-1191
  prefs: []
  type: TYPE_NORMAL
  zh: 为了保留在**`downtime_file`**和**`comment_file`**（在这本书中是**`comments.dat`**和**`downtime.dat`**）中指定的不再使用的文件中的维护间隔和注释，您必须停止Nagios，保存它们，然后从它们中删除开头的Info块，因为在新文件中这可能只发生一次，该文件在**`retention_file`**中指定：
- en: '[PRE91]'
  id: totrans-1192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE91]'
- en: 'Then the contents of the two files are copied to the end of the retention file,
    which here in this book is the file **`/var/nagios/retention.dat`**:'
  id: totrans-1193
  prefs: []
  type: TYPE_NORMAL
  zh: 然后将这两个文件的内容复制到保留文件的末尾，在这里这本书中是文件**`/var/nagios/retention.dat`**：
- en: '[PRE92]'
  id: totrans-1194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE92]'
- en: 'Now the three remaining installation steps are performed (see [1.2 Compiling
    Source Code](../Text/ch01s02.html "1.2 Compiling Source Code")):'
  id: totrans-1195
  prefs: []
  type: TYPE_NORMAL
  zh: 现在执行剩下的三个安装步骤（见[1.2 编译源代码](../Text/ch01s02.html "1.2 编译源代码"))：
- en: '[PRE93]'
  id: totrans-1196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE93]'
