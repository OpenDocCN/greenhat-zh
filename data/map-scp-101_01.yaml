- en: Chapter 1. MAPPING BASICS
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第1章. 地图基础
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages671943.png.jpg)'
  id: totrans-1
  prefs: []
  type: TYPE_IMG
  zh: '![无标题的图片](httpatomoreillycomsourcenostarchimages671943.png.jpg)'
- en: '*X* marks the spot, right? That''s the old pirate saying. Have you ever wondered
    who made maps for the pirates? The pirates had to do it themselves. No wonder
    they were so cranky! If they''d only had today''s technology, the pirates could
    have used someone else''s map and only had to mark the *X* themselves, leaving
    the intricate coastline detail to the cartographer.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '*X*标记了地点，对吧？这是老海盗的说法。你有没有想过是谁为海盗制作地图？海盗不得不自己来做。难怪他们那么烦躁！如果他们只有今天的技术，海盗就可以使用别人的地图，只需要自己标记*X*，把复杂的海岸线细节留给制图师。'
- en: Luckily, you live in the present day and have all sorts of mapping options.
    You can use Google Maps, Yahoo! Maps, and many others. And these maps make mapping
    easy; all you need are just a few lines of code to include a map on your web page.
    [Figure 1-1](ch01.html#local_search_site_yelp_uses_google_maps "Figure 1-1. Local
    search site Yelp uses Google Maps.") shows a page from Yelp, a restaurant review
    site and one of thousands of sites that use maps to mark locations.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，你生活在现在，有各种各样的地图选项。你可以使用Google Maps、Yahoo! Maps以及许多其他地图。这些地图使地图制作变得简单；你只需要几行代码就可以在你的网页上包含地图。[图1-1](ch01.html#local_search_site_yelp_uses_google_maps
    "图1-1. 本地搜索网站Yelp使用Google Maps.")显示了来自Yelp的页面，这是一个餐厅评论网站，也是成千上万个使用地图标记位置的网站之一。
- en: '![Local search site Yelp uses Google Maps.](httpatomoreillycomsourcenostarchimages671947.png.jpg)'
  id: totrans-4
  prefs: []
  type: TYPE_IMG
  zh: '![本地搜索网站Yelp使用Google Maps.](httpatomoreillycomsourcenostarchimages671947.png.jpg)'
- en: Figure 1-1. Local search site Yelp uses Google Maps.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 图1-1. 本地搜索网站Yelp使用Google Maps。
- en: To embed a map, you need to use an API. An AP . . . what? API stands for *Application
    Programming Interface*, and it consists of a collection of functions that make
    creating maps easier. You'll still have to do some programming, but writing your
    code will be trivial compared to what you'd have to do if you had to do everything
    yourself. Sound familiar, matey?
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 要嵌入地图，你需要使用一个API。一个API……什么？API代表*应用程序编程接口*，它由一系列使创建地图更简单的函数组成。你仍然需要进行一些编程，但与如果你必须自己完成所有事情相比，编写代码将变得微不足道。这听起来熟悉吗，伙计？
- en: 'The Mapping APIs: Google, Yahoo!, and Mapstraction'
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 地图API：Google、Yahoo!和Mapstraction
- en: As I mentioned, you can choose from a number of mapping API providers. The features
    and the style of the maps vary, though the APIs share a number of elements. This
    book will cover mapping tools from Google and Yahoo!, but most of the code examples
    will use a JavaScript library called Mapstraction, which is also an API, but different
    from the others. Mapstraction is not a mapping service itself; instead, it is
    a wrapper for other APIs. You write the code once, and it will work on Google
    Maps, Yahoo! Maps, and ten other providers.^([[1](#ftn.CHP-1-FN-1)])
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我提到的，你可以从许多地图API提供者中选择。地图的功能和风格各不相同，尽管API共享许多元素。这本书将涵盖Google和Yahoo!的地图工具，但大多数代码示例将使用一个名为Mapstraction的JavaScript库，它也是一个API，但与其他的不同。Mapstraction本身不是一个地图服务；相反，它是其他API的包装器。你只需编写一次代码，它就可以在Google
    Maps、Yahoo! Maps和其他十个提供者上工作.^([[1](#ftn.CHP-1-FN-1)])
- en: Mapstraction doesn't always support every provider's features, but it covers
    those features the services share and more. For the majority of mapping projects,
    using Mapstraction makes sense. Every now and then, you'll come across an example
    that only works with one provider. In those cases, I will clearly indicate where
    the Mapstraction code ends and the proprietary code begins.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: Mapstraction并不总是支持每个提供者的所有功能，但它涵盖了这些服务共享的功能以及更多。对于大多数地图项目来说，使用Mapstraction是有意义的。偶尔，你会遇到只能与一个提供者一起工作的示例。在这些情况下，我会清楚地指出Mapstraction代码的结束和专有代码的开始。
- en: Using Mapstraction is about foresight. How much code will you need to rewrite
    if, for example, Google shuts down its Maps API? If that sounds far-fetched, then
    consider instead what might happen if your mapping provider starts showing annoying
    ads or another comes along that has maps with colors more suitable to your design.
    Mapstraction allows you to switch seamlessly between providers. So you write the
    code once, and it works everywhere.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Mapstraction是关于前瞻性的。例如，如果Google关闭其地图API，你需要重写多少代码？如果这听起来不太可能，那么考虑一下，如果你的地图提供者开始显示令人讨厌的广告，或者另一个提供者出现了，其地图颜色更适合你的设计，会发生什么。Mapstraction允许你在提供者之间无缝切换。所以你只需编写一次代码，它就可以在任何地方工作。
- en: Before you can begin plotting locations on a map, however, you need to understand
    mapping basics. One of the most important concepts is the coordinate system used
    to describe a point on the earth. Let's look at how that is done.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在你开始在地图上标记位置之前，你需要了解地图的基础知识。最重要的概念之一是用来描述地球上某一点的坐标系。让我们看看这是如何完成的。
- en: '* * *'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[1](#CHP-1-FN-1)]) CloudMade, FreeEarth, Map24, MapQuest, Microsoft, MultiMap,
    OpenLayers, OpenSpace, OpenStreetMap, and ViaMichelin
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[1](#CHP-1-FN-1)]) CloudMade, FreeEarth, Map24, MapQuest, Microsoft, MultiMap,
    OpenLayers, OpenSpace, OpenStreetMap, and ViaMichelin
- en: Describe a Point on the Earth
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 描述地球上的一个点
- en: Geographers have a difficult job, taking a round earth and giving it meaning
    on a flat map. For those with the skills, the job is an exercise in accepting
    imprecision. Because, despite what Columbus said, the earth is not round; it's
    not even a sphere. The earth is an ellipsoid, slightly wider than it is tall.
    We owe the astronomers and mathematicians who have worked hard over the past few
    hundred years to help us pinpoint a location as accurately as we can a great many
    "thank yous."
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 地理学家的工作很困难，他们需要将一个圆形的地球在平面上赋予意义。对于那些有技能的人来说，这项工作是一项接受不精确性的练习。因为，尽管哥伦布说过，地球不是圆的；它甚至不是一个球体。地球是一个椭球体，比它的高度略宽。我们非常感谢过去几百年来辛勤工作的天文学家和数学家，他们帮助我们尽可能精确地确定位置。
- en: The most common way to describe a point on the earth is to use latitude and
    longitude coordinates. This system is used by GPS devices, every web mapping API
    provider, and this book. With it, we can convert a complicated ellipsoid into
    a standard coordinate frame like we used in algebra class to create graphs. A
    world map is shown in [Figure 1-2](ch01s02.html#world_map_with_grid_overlay "Figure 1-2. World
    map with grid overlay") with the axes overlaid.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 描述地球上某一点最常见的方式是使用纬度和经度坐标。这个系统被GPS设备、每个网络地图API提供商和这本书所使用。有了它，我们可以将复杂的椭球体转换成我们用于在代数课上创建图表的标准坐标系。一张带有网格覆盖的世界地图在[图1-2](ch01s02.html#world_map_with_grid_overlay
    "图1-2. 带有网格覆盖的世界地图")中显示，轴被叠加。
- en: 'The points we plot indicate locations on earth, with an error of only two centimeters
    (0.8 of an inch). Rather than calling the axes *x* and *y*, as we did in school,
    we call them latitude and longitude. We can express coordinate pairs in several
    ways:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 我们所标记的点表示地球上的位置，误差仅为两厘米（0.8英寸）。我们不像在学校里那样将轴称为*x*和*y*，而是称它们为纬度和经度。我们可以用几种方式表示坐标对：
- en: '| **45° 33′ 25″ N, 122° 31′ 55″ W** |'
  id: totrans-18
  prefs: []
  type: TYPE_TB
  zh: '| **45° 33′ 25″ N, 122° 31′ 55″ W** |'
- en: '| **45° 33.4′, −122° 31.9′ or 45d33.4m, −122d31.9m** |'
  id: totrans-19
  prefs: []
  type: TYPE_TB
  zh: '| **45° 33.4′, −122° 31.9′ 或 45d33.4m, −122d31.9m** |'
- en: '| **45.55713, −122.53194** |'
  id: totrans-20
  prefs: []
  type: TYPE_TB
  zh: '| **45.55713, −122.53194** |'
- en: As you might have guessed, these coordinate pairs are all roughly equal ways
    of expressing the same point. The units are degrees (°), minutes (′), and seconds
    (″). Each degree is split into 60 minutes, and each minute is then further diced
    into 60 seconds. The decimal representation, in the third example, is used by
    mapping providers and is the style you will see most in this book.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所猜想的，这些坐标对都是大致相同地表达同一点的方法。单位是度（°）、分（′）和秒（″）。每个度被分成60分，每个分再进一步分成60秒。第三种示例中的十进制表示法被地图提供商使用，也是你在这本书中最常看到的形式。
- en: Like the coordinate frame we're all familiar with, each axis has a zero point,
    with values increasing in one direction and decreasing in the other direction.
    Therefore, latitudes and longitudes can have both positive and negative numbers.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 就像我们所有人都熟悉的坐标系一样，每个轴都有一个零点，数值在一个方向上增加，在另一个方向上减少。因此，纬度和经度都可以有正负数。
- en: '*Latitude* measures the vertical axis, which describes how far north or south
    a location is. The zero point for latitude is the equator. To the north, the values
    increase until reaching 90 degrees at the pole. South of the equator, latitude
    decreases, with −90 degrees being the other pole.'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '*纬度*衡量垂直轴，它描述了一个位置距离北或南有多远。纬度的零点是赤道。向北，数值增加，直到在极点达到90度。赤道以南，纬度减少，−90度是另一个极点。'
- en: '![World map with grid overlay](httpatomoreillycomsourcenostarchimages671949.png.jpg)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![带有网格覆盖的世界地图](httpatomoreillycomsourcenostarchimages671949.png.jpg)'
- en: Figure 1-2. World map with grid overlay
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 图1-2. 带有网格覆盖的世界地图
- en: The horizontal axis measurement is called *longitude*. Longitude describes how
    far west or east a location is. The earth does not have a natural vertical equator,
    so scientists and politicians had to decide on a zero point. They chose the location
    of astronomer George Biddell Airy's telescope in Greenwich, London (the Royal
    Observatory), to be the *Prime Meridian*. To the east of this spot, longitudes
    increase to 180 degrees on the other side of the earth. Similarly, longitude decreases
    to −180 degrees to the west, meeting positive longitudes opposite the Prime Meridian
    (called the *antipodal* meridian).
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 水平轴的测量称为**经度**。经度描述了一个位置在西方或东方有多远。地球没有自然的垂直赤道，所以科学家和政治家必须决定一个零点。他们选择了天文学家乔治·比德尔·艾里的望远镜在伦敦格林威治（皇家天文台）的位置作为**本初子午线**。在此点以东，经度增加到地球另一侧的180度。同样，经度减少到−180度，在西方与正经度相对（称为**对跖子午线**）。
- en: Why does latitude stop at 90 degrees and longitude continue to 180 degrees?
    The horizontal axis does not have any poles, so picking a place to stop would
    be as arbitrary as the meridians. Also, latitude degrees are parallel to one another,
    whereas longitudinal lines become closer to each other at the poles. Points along
    a specific latitude are symmetrical. If you traced the hypothetical 100 degrees
    latitude halfway around the earth, you would arrive at 80 degrees latitude, so
    you might as well just call it that.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么纬度在90度停止，而经度继续到180度？水平轴没有任何极点，所以选择一个停止点将像子午线一样任意。此外，纬度度数彼此平行，而经度线在极点处彼此更近。特定纬度上的点是对称的。如果你追踪假设的100度纬度在地球半圈，你会到达80度纬度，所以你不妨就称它为那样。
- en: Now that you have a feel for how coordinates are used, let's look at the different
    ways they are expressed and how you can switch between them.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你对坐标的使用有了感觉，让我们看看它们的不同表达方式以及如何在它们之间切换。
- en: Convert Between Decimal and Degree Formats
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在十进制度和度数格式之间转换
- en: When I first introduced latitude and longitude points, I showed several examples.
    If you work with enough geographic data, you'll likely end up seeing each of those
    ways of expressing the same point. In this section, I'll show you how to convert
    between the two most common formats.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 当我第一次介绍纬度和经度点时，我展示了几个例子。如果你处理足够的地理数据，你可能会看到表达相同点的这些方式。在本节中，我将向你展示如何在两种最常见格式之间进行转换。
- en: Mapping APIs accept latitude and longitude values as a pair of decimal numbers.
    For example, the No Starch Press office in San Francisco is situated at 37.7740486,
    −122.4101883\. What does that mean? First, finding the major degrees is easy—these
    are the numbers before the decimal, so 37 and −122 in this case.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 地图API接受纬度和经度值作为一对小数。例如，旧金山的No Starch Press办公室位于37.7740486, −122.4101883。这意味着什么？首先，找到主要度数很容易——这些是在小数点之前的数字，所以在这个例子中是37和−122。
- en: The remaining decimals describe how close this value is to the next degree.
    A latitude of 37.7740486 is more than halfway between the 37th and 38th degree.
    A portion of a degree is expressed as minutes and seconds.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 剩余的小数描述了这个值接近下一个度数有多近。纬度为37.7740486位于第37度和第38度之间的一半以上。一度的一部分表示为分钟和秒。
- en: 'Multiply the decimal portion of the coordinates by 60 to get the number of
    minutes:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 将坐标的小数部分乘以60以得到分钟数：
- en: '| **0.7740486 × 60 = 46.442916 minutes** |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| **0.7740486 × 60 = 46.442916分钟** |'
- en: '| **0.4101883 × 60 = 24.611298 minutes** |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| **0.4101883 × 60 = 24.611298分钟** |'
- en: 'Now we''re getting somewhere. The latitude is 37 degrees, 46 minutes. The longitude
    is −122 degrees, 24 minutes. However, the answer has a decimal portion. We need
    to repeat the previous step, multiplying these new decimals by 60 to determine
    the number of seconds:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有进展了。纬度是37度46分。经度是−122度24分。然而，答案有小数部分。我们需要重复之前的步骤，将这些新的小数乘以60，以确定秒数：
- en: '| **0.442916 × 60 = 26.57496 seconds** |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| **0.442916 × 60 = 26.57496秒** |'
- en: '| **0.611298 × 60 = 36.67788 seconds** |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| **0.611298 × 60 = 36.67788秒** |'
- en: Again, we're left with a decimal portion. Unless we want to be extremely precise,
    we can just take the whole number at this point. The difference between 26.57496
    seconds and 26 seconds is one hundredth of a mile. Some people choose to leave
    a single digit after the decimal point. Then our measurement is precise within
    about five feet, which is almost certainly less than a pixel on a web map.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，我们只剩下一个小数部分。除非我们想要极其精确，否则我们只需取整数部分即可。26.57496秒与26秒之间的差异是1/100英里。有些人选择在小数点后保留一位数字。然后我们的测量精度大约在五英尺以内，这几乎肯定小于网络地图上的一个像素。
- en: The final answer after converting from point 37.7740486, −122.4101883 to degree,
    minute, second format is 37° 46′ 26″ N, 122° 24′ 36″ W.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 将点37.7740486, −122.4101883从度、分、秒格式转换为度、分、秒格式后的最终答案是37° 46′ 26″ N，122° 24′ 36″
    W。
- en: Note the directions, which show this location is in the northern and western
    hemispheres. Also, the longitude is no longer expressed as a negative because
    the location is west of the Prime Meridian.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 注意方向，这表明该位置位于北半球和西半球。此外，经度不再表示为负数，因为该位置位于本初子午线以西。
- en: Converting from degree, minute, second to decimal format is even easier. As
    before, converting the degree is easy, as it becomes the whole number portion
    to the left of the decimal. Now we just have to remember to use a negative number
    to indicate the southern and western hemispheres.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 从度、分、秒转换为小数格式甚至更容易。与之前一样，转换度数很容易，因为它成为小数点左边的整数部分。现在我们只需记住使用负数来表示南半球和西半球。
- en: 'Next, we convert the minutes portion into seconds (multiply by 60) and add
    that result to the existing seconds:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，将分钟部分转换为秒（乘以60）并将该结果加到现有的秒数上：
- en: '| **46 × 60 + 26 = 2,786 seconds latitude** |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
  zh: '| **46 × 60 + 26 = 2,786秒纬度** |'
- en: '| **24 × 60 + 36 = 1,476 seconds longitude** |'
  id: totrans-45
  prefs: []
  type: TYPE_TB
  zh: '| **24 × 60 + 36 = 1,476秒经度** |'
- en: 'Finally, divide each of those results by the number of seconds in one degree,
    which is 3,600 (60 × 60):'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，将每个结果除以一度中的秒数，即3,600（60 × 60）：
- en: '| **2,786 / 3600 = 0.77389** |'
  id: totrans-47
  prefs: []
  type: TYPE_TB
  zh: '| **2,786 / 3600 = 0.77389** |'
- en: '| **1,476 / 3600 = 0.41000** |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
  zh: '| **1,476 / 3600 = 0.41000** |'
- en: The answer after converting point 37° 46′ 26″ N, 122° 24′ 36″ W to decimal format
    is 37.77389, −122.41000\. The answer is roughly the same as the decimal version
    the section started with. The difference is the rounding error, which isn't very
    significant for this purpose. You will discover more about precision in the next
    project.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 将点37° 46′ 26″ N，122° 24′ 36″ W转换为小数格式后的答案是37.77389，−122.41000。这个答案与该节开始时的小数版本大致相同。差异是舍入误差，对于这个目的来说并不非常显著。你将在下一个项目中发现更多关于精度的问题。
- en: Determine Precision of Decimal Coordinates
  id: totrans-50
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 确定小数坐标的精度
- en: The latitude and longitude format most commonly used expresses degrees as decimals.
    Mapping providers, and also most services, convert from degrees to decimals to
    provide location data.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 最常用的经纬度格式将度数表示为小数。地图服务提供商以及大多数服务都将度数转换为小数以提供位置数据。
- en: 'You might remember a tricky little thing about decimals from learning real
    numbers in math class: they can go on forever. You have to decide how many digits
    to use, much like calculators only have room for a certain amount of numbers.
    At some point, decimals need to be chopped off.'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能还记得在数学课上学习实数时遇到的一个小难题：它们可以无限延伸。你必须决定使用多少位数字，就像计算器只能容纳一定数量的数字一样。在某个时候，小数需要被截断。
- en: The number of decimals in latitude and longitude points varies by service. However,
    most services provide at least five digits after the decimal. As you can see in
    [Table 1-1](ch01s02.html#latitude_precision_by_number_of_decimals "Table 1-1. Latitude
    Precision by Number of Decimals"), five digits is enough to get within four feet
    of the location. In other words, for plotting points on a web map, five digits
    is plenty.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 纬度和经度点的小数位数因服务而异。然而，大多数服务至少提供小数点后五位数字。正如你在[表1-1](ch01s02.html#latitude_precision_by_number_of_decimals
    "表1-1. 小数位数纬度精度")中看到的那样，五位数字足以将位置精确到四英尺以内。换句话说，对于在网络上绘制点，五位数字已经足够了。
- en: Table 1-1. Latitude Precision by Number of Decimals
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 表1-1. 小数位数纬度精度
- en: '| Digits after decimal | Possible error |'
  id: totrans-55
  prefs: []
  type: TYPE_TB
  zh: '| 小数点后位数 | 可能的误差 |'
- en: '| --- | --- |'
  id: totrans-56
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| 1 | 7 miles (11 km) |'
  id: totrans-57
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 7英里（11公里） |'
- en: '| 2 | ¾ mile (1 km) |'
  id: totrans-58
  prefs: []
  type: TYPE_TB
  zh: '| 2 | 3/4英里（1公里） |'
- en: '| 3 | 370 feet (110 meters) |'
  id: totrans-59
  prefs: []
  type: TYPE_TB
  zh: '| 3 | 370英尺（110米） |'
- en: '| 4 | 37 feet (11 meters) |'
  id: totrans-60
  prefs: []
  type: TYPE_TB
  zh: '| 4 | 37英尺（11米） |'
- en: '| 5 | 4 feet (1 meter) |'
  id: totrans-61
  prefs: []
  type: TYPE_TB
  zh: '| 5 | 4英尺（1米） |'
- en: 'City-level coordinates often have as few as one digit after the decimal. Only
    using one digit gives a possible error of 7 miles, but the coordinates will still
    be within the bounds of most cities. For example, Yahoo!''s weather API (used
    in [#69: Create a Weather Map](ch10s02.html "#69: Create a Weather Map") in [#69:
    Create a Weather Map](ch10s02.html "#69: Create a Weather Map")) gives city coordinates
    to only two digits of precision, which reduces the error to less than one mile.'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '城市级别的坐标通常在小数点后只有一位数字。仅使用一位数字可能导致7英里的误差，但坐标仍然在大多数城市的范围内。例如，Yahoo!的天气API（在[第69节：创建天气地图](ch10s02.html
    "#69: Create a Weather Map")中使用，[第69节：创建天气地图](ch10s02.html "#69: Create a Weather
    Map")）只提供两位精度的城市坐标，这使误差降低到不到一英里。'
- en: Longitude precision is not as easy to calculate as latitude, because degrees
    of longitude are not parallel. At the equator, the latitude and longitude charts
    would be the same. As longitude lines near the poles, however, they come closer
    together. The good news is that the latitude error is the maximum that can exist
    for longitude, so, in most cases, the error is smaller for longitudes.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 经度的精度不像纬度那样容易计算，因为经度线不是平行的。在赤道，纬度和经度图将是相同的。然而，当经度线接近两极时，它们会越来越靠近。好消息是纬度误差是经度可能存在的最大误差，因此，在大多数情况下，经度的误差更小。
- en: Note
  id: totrans-64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The latitude error also varies by about 1 km between the equator and the poles,
    but this error is a much smaller variation than with longitude.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 纬度误差在赤道和两极之间大约变化1公里，但这个误差与经度相比要小得多。
- en: 'You''ll learn more about the strange quirks of longitude in [#36: Calculate
    Distance Between Two Points](ch06.html#number_symble_36_colon_calculate_distanc
    "#36: Calculate Distance Between Two Points") in [#36: Calculate Distance Between
    Two Points](ch06.html#number_symble_36_colon_calculate_distanc "#36: Calculate
    Distance Between Two Points"), where I''ll show how to adjust for the different
    distances between degrees based on latitude.'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: '你将在[第36节：计算两点之间的距离](ch06.html#number_symble_36_colon_calculate_distanc "#36:
    Calculate Distance Between Two Points")中了解更多关于经度奇怪特性的内容，在那里我会展示如何根据纬度调整度之间的不同距离。'
- en: Create Your First Map
  id: totrans-67
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建你的第一个地图
- en: You are about to embark upon an education in neocartography, taking yourself
    from plain ol' web developer to a Geolocative Web Developer. We'll create a basic
    map in this section, and it will serve as a building block for future projects.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 你即将开始学习新制图学，从普通的网络开发者转变为地理定位网络开发者。在本节中，我们将创建一个基本的地图，它将成为未来项目的基石。
- en: First, we'll use the Google Maps API to create a map centered on the No Starch
    Press offices in San Francisco. Then, I'll show you the changes necessary to create
    the same map using Yahoo!'s service. Finally, I'll show how nearly identical Mapstraction
    code can create both of those maps.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将使用Google Maps API创建一个以旧金山No Starch Press办公室为中心的地图。然后，我会向你展示如何使用Yahoo!的服务创建相同的地图。最后，我会展示几乎相同的Mapstraction代码如何创建这两个地图。
- en: Create a Google Map
  id: totrans-70
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建一个Google地图
- en: Google is the 500 pound gorilla in many areas of the Web, and mapping is no
    exception. Most map developers choose the Google Maps API, if only because of
    its ubiquity. In addition to being everywhere, Google Maps is fast and stable.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: Google在许多网络领域都是500磅的大猩猩，地图也不例外。大多数地图开发者选择Google Maps API，仅因为其无处不在。除了无处不在，Google
    Maps还快速稳定。
- en: Google Maps has been around since 2005\. That's not to say the Maps team isn't
    innovating. On the contrary, Google Maps is often the first to add new features
    to its API, such as driving directions and a 360-degree view of any address in
    many cities in the United States and select places across the globe.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: Google Maps自2005年以来一直存在。这并不是说地图团队没有创新。相反，Google Maps经常是第一个在其API中添加新功能的，例如驾驶方向和在美国许多城市以及全球选定地点的任何地址的360度视图。
- en: 'Let''s create a basic map using Google. Open a new HTML file and type the following:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们使用Google创建一个基本的地图。打开一个新的HTML文件，并输入以下内容：
- en: '[PRE0]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Save your file and load it in a browser. The result should look something like
    [Figure 1-3](ch01s03.html#a_basic_google_map "Figure 1-3. A basic Google Map"),
    with your Google Map centered on No Starch Press's neighborhood in San Francisco.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 保存你的文件并在浏览器中打开它。结果应该看起来像[图1-3](ch01s03.html#a_basic_google_map "图1-3. 一个基本的Google地图")，你的Google地图将位于旧金山No
    Starch Press所在地区的中心。
- en: '![A basic Google Map](httpatomoreillycomsourcenostarchimages671951.png.jpg)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![一个基本的Google地图](httpatomoreillycomsourcenostarchimages671951.png.jpg)'
- en: Figure 1-3. A basic Google Map
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 图1-3. 基本的Google地图
- en: As you can see, the HTML hooks are minimal. An empty `div` tag ❸ with an `id`
    attribute is all that's required. The JavaScript function `create_map()` takes
    over and makes calls to the API. This function can have any name you want. In
    many examples in this book, I'll use this same name.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，HTML钩子是最小的。只需要一个带有`id`属性的空`div`标签 ❸。JavaScript函数`create_map()`接管并调用API。这个函数可以取任何你想要的名称。在这本书的许多示例中，我会使用这个相同的名称。
- en: Before creating the map, we'll need to set some options ❶. The minimum amount
    of information needed is a center (using a latitude/longitude pair), a zoom level
    and a map type. Then, we pass those options and reference the `div` tag's `id`
    to create a map ❷.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 在创建地图之前，我们需要设置一些选项 ❶。所需的最基本信息是一个中心点（使用经纬度对），缩放级别和地图类型。然后，我们传递这些选项并引用`div`标签的`id`来创建地图
    ❷。
- en: And just like that you've created your first Google Map. Read on to see how
    this map is different from Yahoo! and how you can use Mapstraction to write code
    once that will work with any mapping provider.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 就这样，你已经创建了你的第一个Google地图。继续阅读，了解这个地图与Yahoo!的不同之处以及如何使用Mapstraction编写一次即可与任何地图提供商一起工作的代码。
- en: Create a Yahoo! Map
  id: totrans-81
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建一个Yahoo!地图
- en: Yahoo! released its mapping API around the same time as Google. Unfortunately,
    the first version was Flash-based and difficult to use. Google grabbed an early
    lead and Yahoo! has been playing catch-up ever since. Now Yahoo! has a JavaScript
    API with features similar to Google's.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: Yahoo!在Google发布其地图API的大约同一时间发布了它的地图API。不幸的是，第一个版本是基于Flash的，使用起来很困难。Google抢得了先机，而Yahoo!一直处于追赶状态。现在Yahoo!有一个具有与Google类似功能的JavaScript
    API。
- en: 'You''ll need an API key from Yahoo! and a Yahoo! account to use its maps. To
    register an application, which gives you a key, visit this web page: [https://developer.yahoo.com/wsregapp/](https://developer.yahoo.com/wsregapp/).'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要从Yahoo!获取一个API密钥和一个Yahoo!账户才能使用其地图。要注册应用程序，以获取密钥，请访问此网页：[https://developer.yahoo.com/wsregapp/](https://developer.yahoo.com/wsregapp/)。
- en: Select the option with no authentication because you will not be accessing Yahoo!
    user data. Fill out the rest of the form with information about your application,
    click the button, and you're set.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 选择无认证的选项，因为你将不会访问Yahoo!用户数据。填写表单的其余部分，包括有关你的应用程序的信息，点击按钮，设置完成。
- en: 'Once you get your API key, you''re ready to create a Yahoo! Map. To do that,
    start with the Google example in the previous section. Replace the call to Google''s
    JavaScript to instead include Yahoo!''s code (be sure to use your API key):'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你获得了API密钥，你就可以创建一个Yahoo!地图了。要做到这一点，从上一节中的Google示例开始。将调用Google的JavaScript替换为包含Yahoo!的代码（确保使用你的API密钥）：
- en: '[PRE1]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Next, alter the contents of the `create_map` function like so:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，按照如下方式修改`create_map`函数的内容：
- en: '[PRE2]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Save your file and load it in a browser. The result should look something like
    [Figure 1-4](ch01s03.html#a_basic_yahoo_exclamation_map "Figure 1-4. A basic Yahoo!
    Map"), with your Yahoo! Map centered on No Starch Press's neighborhood in San
    Francisco.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 保存你的文件，并在浏览器中加载它。结果应该类似于[图1-4](ch01s03.html#a_basic_yahoo_exclamation_map "图1-4.
    基本的Yahoo!地图")，你的Yahoo!地图将位于旧金山No Starch Press的社区中心。
- en: '![A basic Yahoo! Map](httpatomoreillycomsourcenostarchimages671953.png.jpg)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
  zh: '![基本的Yahoo!地图](httpatomoreillycomsourcenostarchimages671953.png.jpg)'
- en: Figure 1-4. A basic Yahoo! Map
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 图1-4. 基本的Yahoo!地图
- en: The code is not that different from Google Maps. You create a new map by referencing
    the `div` tag's `id` ❶. And you give the map a center by using a latitude/longitude
    pair ❷. The biggest differences are in terms of syntax and order. With Yahoo,
    you create a map, then add options, such as the zoom level and center.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 代码与Google地图没有太大区别。你通过引用`div`标签的`id`来创建一个新的地图 ❶。然后，你使用经纬度对给地图设置一个中心点 ❷。最大的区别在于语法和顺序。在Yahoo中，你创建地图，然后添加选项，如缩放级别和中心点。
- en: The concept behind the two maps is very similar. But these minor differences
    compound to become a big pain, however, if you need to switch from one to the
    other. That's why Mapstraction is so powerful, as you will see in the next section.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 两个地图背后的概念非常相似。但是，这些细微的差异累积起来，如果你需要从其中一个切换到另一个，就会变得非常痛苦。这就是为什么Mapstraction如此强大的原因，你将在下一节中看到。
- en: Create a Mapstraction Map
  id: totrans-94
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建一个Mapstraction地图
- en: Mapstraction is a little different from Google Maps and Yahoo! Maps. Mapstraction
    is an open source JavaScript library that ties into other mapping APIs. If you
    use Mapstraction, you can switch from one type of map to another with very little
    work, as opposed to rewriting your code completely.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: Mapstraction与Google Maps和Yahoo! Maps略有不同。Mapstraction是一个开源的JavaScript库，它可以与其他地图API集成。如果你使用Mapstraction，你可以通过非常少的努力在一种类型的地图和另一种类型之间切换，而不是完全重写你的代码。
- en: Using Mapstraction limits your risk to changes being made to an API. For example,
    if your site's traffic takes you beyond the limit for your chosen provider, or
    the provider begins placing ads on the map, Mapstraction lets you switch providers
    quickly and inexpensively.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Mapstraction可以降低API更改的风险。例如，如果你的网站流量超过了所选提供者的限制，或者提供者开始在地图上放置广告，Mapstraction让你能够快速且低成本地切换提供者。
- en: To use Mapstraction, you must first choose a provider. In this example, I'm
    using Mapstraction to create a Google Map.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用Mapstraction，你必须首先选择一个提供者。在这个例子中，我正在使用Mapstraction来创建一个Google地图。
- en: 'Open a new HTML file and type the following:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 打开一个新的HTML文件并输入以下内容：
- en: '[PRE3]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Just like you would for a normal Google Map, we include Google's JavaScript
    ❶. For this code to work, you also need to download the Mapstraction files. Go
    to [http://mapstraction.com/](http://mapstraction.com/), and follow the instructions
    to save the files in the same directory as your HTML file. Best practices would
    dictate that you keep JavaScript files in their own directory, separate from your
    HTML, but I'm simplifying things for this example.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 就像为正常的Google地图一样，我们包括Google的JavaScript ❶。为了使这段代码正常工作，你还需要下载Mapstraction文件。访问[http://mapstraction.com/](http://mapstraction.com/)，并按照说明将文件保存在与你的HTML文件相同的目录下。最佳实践会建议你将JavaScript文件保存在它们自己的目录中，与HTML文件分开，但为了这个例子，我在简化事情。
- en: The Mapstraction files you should have, at minimum, are *mxn.js*, *mxn.core.js*
    and *googlev3.core.js*. You may also have files for other providers, such as *yahoo.core.js*.
    The only one we need to reference in our HTML code is *mxn.js*, which loads the
    other files that it needs, including those that we pass it in the filename ❷.
    Then, in the `create_map` function, we let it know which type of map ❸ we are
    creating.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 你至少应该拥有的Mapstraction文件是*mxn.js*、*mxn.core.js*和*googlev3.core.js*。你可能还会有其他提供者的文件，例如*yahoo.core.js*。在我们HTML代码中需要引用的只有一个*mxn.js*，它会加载它需要的其他文件，包括我们通过文件名传递给它的那些文件
    ❷。然后，在`create_map`函数中，我们让它知道我们正在创建哪种类型的地图 ❸。
- en: Once you have your Mapstraction map, save your HTML file and load it in a browser.
    The result should look exactly like the Google Map in [Figure 1-4](ch01s03.html#a_basic_yahoo_exclamation_map
    "Figure 1-4. A basic Yahoo! Map"). This Google Map, created via Mapstraction,
    should be centered on No Starch Press's neighborhood in San Francisco.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你有了你的Mapstraction地图，保存你的HTML文件并在浏览器中加载它。结果应该看起来与[图1-4](ch01s03.html#a_basic_yahoo_exclamation_map
    "图1-4. 基本的Yahoo!地图")中的Google地图完全一样。这个通过Mapstraction创建的Google地图应该位于旧金山No Starch
    Press的社区中心。
- en: Use Yahoo! Maps with Mapstraction
  id: totrans-103
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用Mapstraction和Yahoo!地图
- en: To get an idea of how powerful the Mapstraction library is, let's try using
    Yahoo! Maps instead of Google Maps. You only have to change a few bits in the
    code. And the best part is even if you have a lot of Mapstraction code, you will
    still only need to change this one line.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 为了了解Mapstraction库有多强大，让我们尝试使用Yahoo!地图而不是Google地图。你只需要在代码中更改几个部分。最好的部分是，即使你有大量的Mapstraction代码，你仍然只需要更改这一行。
- en: 'As when switching from a standard Google Map to a Yahoo! Map, you need to include
    Yahoo!''s JavaScript. Before moving on, ensure the following lines are in your
    file:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 就像从标准Google地图切换到Yahoo!地图一样，你需要包括Yahoo!'s JavaScript。在继续之前，确保以下行在你的文件中：
- en: '[PRE4]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Note that rather than loading the Mapstraction JavaScript with Google support,
    we specified the Yahoo! version of Mapstraction ❶. Although the core of Mapstraction
    is provider agnostic, you need to tell it which of the providers you want to use.
    You also need to make sure you have *yahoo.core.js* in the same directory as *mxn.js*.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，我们不是加载带有Google支持的Mapstraction JavaScript，而是指定了Yahoo!版本的Mapstraction ❶。尽管Mapstraction的核心是提供者无关的，但你需要告诉它你想要使用哪个提供者。你还需要确保*yahoo.core.js*与*mxn.js*在同一个目录下。
- en: 'Now let''s look at the Mapstraction code itself inside the `create_map` function:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们看看`create_map`函数内部的Mapstraction代码：
- en: '[PRE5]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Here, the only difference between the Mapstraction map made with Google and
    this map is we've noted we're making a Yahoo! map ❷. That's it. No need to change
    the `setCenterAndZoom` or `LatLonPoint` functions. The syntax is the same because
    Mapstraction is wrapped around the providers.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，使用谷歌制作的Mapstraction地图和这个地图之间的唯一区别是我们已经注明我们正在制作一个雅虎地图❷。仅此而已。无需更改`setCenterAndZoom`或`LatLonPoint`函数。语法相同，因为Mapstraction是围绕提供者包装的。
- en: Save and reload your file and what was once a Google Map should be replaced
    with a Yahoo! Map instead, exactly like [Figure 1-5](ch01s04.html#basic_map_shown_with_surrounding_tiles
    "Figure 1-5. Basic map shown with surrounding tiles"). It is the same Yahoo! Map,
    only this one was created through Mapstraction.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 保存并重新加载你的文件，原本的谷歌地图应该会被雅虎地图所替代，就像[图1-5](ch01s04.html#basic_map_shown_with_surrounding_tiles
    "图1-5. 显示周围瓦片的基本地图")所示。这是同一张雅虎地图，只是这一张是通过Mapstraction创建的。
- en: Mapstraction is like magic, only better. In fact, you don't even have to choose
    Google *or* Yahoo!. You could have both within the same map or one of each on
    a page.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: Mapstraction就像魔法一样，但更好。实际上，你甚至不需要选择谷歌*或*雅虎！你可以在同一张地图中同时使用两者，或者在一页上使用每个中的一个。
- en: Find the Underlying Map Tiles
  id: totrans-113
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 查找底层地图瓦片
- en: A web map's draggability might be its best attribute. I often find myself dragging
    a map just because I can. The feature also turns out to be a really good illusion.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 网络地图的可拖动性可能是其最好的属性。我经常发现自己只是因为可以而拖动地图。这个特性也证明是一个非常棒的错觉。
- en: What looks like one seamless map is actually many small tiles, placed next to
    each other. You might have noticed this in a moment of network lag, when a section
    of your map failed to load. Network lag is most likely to happen after you've
    changed the zoom level or if you quickly drag the map far from its original location.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来像是一张无缝地图，实际上是由许多并排放置的小瓦片组成的。你可能曾在网络延迟的一瞬间注意到这一点，当时你的地图的一部分未能加载。网络延迟最可能发生在你更改缩放级别或快速将地图从原始位置拖远之后。
- en: Providers often attempt to avoid disrupting the illusion of seamlessness by
    preloading all the tiles that touch the tiles in your current area.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 提供者通常会尝试通过预加载所有接触你当前区域瓦片的瓦片来避免打破无缝的错觉。
- en: Each tile has a standard size of 256 pixels square. In the basic map example,
    six tiles are at least partially visible. If Google is the provider, it also loads
    additional surrounding tiles. [Figure 1-5](ch01s04.html#basic_map_shown_with_surrounding_tiles
    "Figure 1-5. Basic map shown with surrounding tiles") shows how the visible portion
    of the map corresponds to its tiles. In the original view, we only see slivers
    of the top two tiles.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 每个瓦片的标准尺寸为256像素平方。在基本地图示例中，有六个瓦片至少部分可见。如果谷歌是提供者，它还会加载额外的周围瓦片。[图1-5](ch01s04.html#basic_map_shown_with_surrounding_tiles
    "图1-5. 显示周围瓦片的基本地图")显示了地图的可见部分如何对应其瓦片。在原始视图中，我们只能看到顶部两个瓦片的边缘。
- en: '![Basic map shown with surrounding tiles](httpatomoreillycomsourcenostarchimages671955.png.jpg)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![显示周围瓦片的基本地图](httpatomoreillycomsourcenostarchimages671955.png.jpg)'
- en: Figure 1-5. Basic map shown with surrounding tiles
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 图1-5. 显示周围瓦片的基本地图
- en: What happens when we change zoom levels? We need to download a completely new
    set of tiles. The details shown are different for each zoom level, and each tile
    now represents a different amount of the earth.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们更改缩放级别时会发生什么？我们需要下载一组全新的瓦片。每个缩放级别显示的细节都不同，每个瓦片现在代表地球的不同部分。
- en: Due to copyright concerns, providers tend to make it difficult to access their
    tiles directly. You can, however, look at the tiles that are downloaded to your
    browser when you access a provider's maps. Doing this will give you a better idea
    of how the tile system works.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 由于版权问题，提供者往往会使其瓦片难以直接访问。然而，当你访问提供者的地图时，你可以查看下载到浏览器中的瓦片。这样做将更好地了解瓦片系统是如何工作的。
- en: Though you can get at the files in a number of ways, I'll show you a very easy
    method using the Firefox browser and the Firebug developer add-on. You can find
    them at [http://www.getfirefox.com/](http://www.getfirefox.com/) and [http://www.getfirebug.com/](http://www.getfirebug.com/),
    respectively.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然你可以通过多种方式获取文件，但我将向你展示一个使用Firefox浏览器和Firebug开发者插件非常简单的方法。你可以在[http://www.getfirefox.com/](http://www.getfirefox.com/)和[http://www.getfirebug.com/](http://www.getfirebug.com/)找到它们，分别。
- en: In Firefox, load an embedded map, such as the one in the basic map example.
    Click the Firebug icon in the lower-right corner, or choose **Firebug ▸ Open Firebug**
    from the Tools menu. In the Firebug panel, click the **Inspect** button, which
    allows you to see highlighted page elements. Hover your mouse over the center
    of the map, and a blue border should appear around a portion of the map. You have
    found a tile!
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 在Firefox中，加载一个嵌入的地图，例如基本地图示例中的地图。点击右下角的Firebug图标，或从工具菜单中选择**Firebug ▸ 打开Firebug**。在Firebug面板中，点击**检查**按钮，这允许你看到高亮的页面元素。将鼠标悬停在地图中心，应该会在地图的一部分周围出现一个蓝色边框。你找到了一个瓦片！
- en: With a tile highlighted, click the mouse, and you will be taken to HTML code
    with an image tag, as shown in [Figure 1-6](ch01s04.html#use_firebug_to_find_tiles
    "Figure 1-6. Use Firebug to find tiles."). At first, this tag may seem confusing
    because you didn't add this image to your code. Unlike simply viewing source code
    in a browser, Firebug shows the page with the elements added by JavaScript. To
    create a map, your provider had to inject images as child elements of the map
    `div` tag.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 当一个瓦片被高亮时，点击鼠标，你将被带到包含图像标签的HTML代码中，如图[图1-6](ch01s04.html#use_firebug_to_find_tiles
    "图1-6. 使用Firebug查找瓦片")所示。一开始，这个标签可能看起来很令人困惑，因为你没有将此图像添加到你的代码中。与在浏览器中简单地查看源代码不同，Firebug显示了添加了JavaScript元素的页面。为了创建地图，你的提供商必须将图像注入到地图`div`标签的子元素中。
- en: In the `src` attribute of the image, you'll see the URL to the single tile that
    you highlighted with Firebug. You can copy that URL into a new window or tab to
    see only that tile, without including the context of its surrounding brethren.
    Also, you can doctor the parameters in the URL to view other tiles.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 在图片的`src`属性中，你会看到使用Firebug高亮的单个瓦片的URL。你可以将这个URL复制到一个新的窗口或标签页中，只查看那个瓦片，而不包括其周围兄弟的上下文。此外，你还可以修改URL中的参数来查看其他瓦片。
- en: The earth is made up of thousands or millions of tiles, depending on the zoom
    level. Mapping providers refer to tiles based on a simple grid system. You can
    think of this as similar to a paper map, which helps you identify areas by referencing
    them based on a letter-number combination. For example, you might look in (K,
    18) to find Maple Street.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 地球由数千或数百万个瓦片组成，具体取决于缩放级别。地图提供商根据简单的网格系统来引用瓦片。你可以将其想象成类似于纸地图，它通过字母-数字组合来帮助你识别区域。例如，你可能查看(K,
    18)以找到Maple Street。
- en: Tiles are called by their grid reference, too; only these are usually numbered
    in the thousands. For example, my San Francisco example might contain a tile that
    is at (5241, 3718). The grid is different for each zoom level, so that reference
    is an important third piece of information needed to call a particular tile. To
    call the tile to the right of the example tile, I would look for (5242, 3718)
    at the same zoom level. Only the first number changes because it represents the
    horizontal portion of the grid. Vertically, both tiles are in row 3718.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 瓦片也通过其网格参考来命名；只是这些通常以千为单位编号。例如，我的旧金山示例可能包含一个位于(5241, 3718)的瓦片。每个缩放级别都有不同的网格，因此这个参考是调用特定瓦片所需的重要第三条信息。要调用示例瓦片右侧的瓦片，我会在同一缩放级别查找(5242,
    3718)。只有第一个数字会改变，因为它代表网格的水平部分。垂直方向上，两个瓦片都在第3718行。
- en: 'To recap, you''ll usually find three numbers in the tile URLs: the horizontal
    grid reference (often called *X*), the vertical grid reference (*Y*), and the
    zoom level.'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 总结一下，你通常会在瓦片URL中找到三个数字：水平网格参考（通常称为*X*），垂直网格参考(*Y*)和缩放级别。
- en: 'Mapstraction provides a way to use whatever tiles you would like, regardless
    of the provider. Again, most providers don''t support direct access to the tiles.
    Many times you might find they use methods to prevent you from calling them. You
    could always create your own tiles. I show you how to do that and how to connect
    them to Mapstraction in [#26: Use Custom Tiles](ch04s11.html "#26: Use Custom
    Tiles") in [#26: Use Custom Tiles](ch04s11.html "#26: Use Custom Tiles").'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 'Mapstraction提供了一种使用你想要的任何瓦片的方法，无论提供商如何。再次强调，大多数提供商不支持直接访问瓦片。很多时候，你可能发现他们使用方法来阻止你调用它们。你始终可以创建自己的瓦片。我在[第26节：使用自定义瓦片](ch04s11.html
    "#26: Use Custom Tiles")中向你展示了如何做到这一点以及如何将它们连接到Mapstraction。[第26节：使用自定义瓦片](ch04s11.html
    "#26: Use Custom Tiles")。'
- en: '![Use Firebug to find tiles.](httpatomoreillycomsourcenostarchimages671957.png.jpg)'
  id: totrans-130
  prefs: []
  type: TYPE_IMG
  zh: '![使用Firebug查找瓦片。](httpatomoreillycomsourcenostarchimages671957.png.jpg)'
- en: Figure 1-6. Use Firebug to find tiles.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 图1-6. 使用Firebug查找瓦片。
- en: Change the Map Size
  id: totrans-132
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 更改地图大小
- en: The initial map size is determined by CSS styles for the `div` tag. You can
    change the size of the map programmatically with Mapstraction, however.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 初始地图大小由`div`标签的CSS样式确定。然而，你可以使用Mapstraction以编程方式更改地图的大小。
- en: 'Add the following line to the `create_map` function, or include it as a click
    event in a link (see [Appendix A](apa.html "Appendix A. JAVASCRIPT QUICK START")):'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 将以下行添加到`create_map`函数中，或者将其作为链接的点击事件包含（参见[附录A](apa.html "附录A. JAVASCRIPT 快速入门"))：
- en: '[PRE6]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: When the `resizeTo` function is called, you pass a width and height. Mapstraction
    then immediately sets the size of the map to the desired pixels. Note the center
    of the map is not reset. If you shrink the map, you may need to recenter the map
    to keep your same center-point in view.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 当调用`resizeTo`函数时，你需要传递宽度和高度。Mapstraction随后立即将地图的大小设置为所需的像素。请注意，地图的中心不会被重置。如果你缩小地图，你可能需要重新定位地图以保持相同的中心点在视图中。
- en: 'Also, a word of caution about shrinking your map: Depending on the provider
    you use, interface elements may begin to collide. Be sure to test to see how small
    a map you can get away with.'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，关于缩小地图的一些建议：根据你使用的提供商，界面元素可能会开始碰撞。务必测试以查看你可以缩小到多小。
- en: Add Zoom and Other Controls
  id: totrans-138
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 添加缩放和其他控件
- en: One of the best things about using maps on your website is that users can explore
    with them. They want to see what's nearby, look more closely at a particular location,
    or figure out where a spot is in relation to the city or country. The basic maps
    I've shown so far do not give users very much control.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的网站上使用地图的最好之处之一是用户可以使用它们进行探索。他们想看看附近有什么，更仔细地查看特定位置，或者弄清楚某个地点在城市或国家中的位置。我迄今为止展示的基本地图并没有给用户太多的控制权。
- en: Let's give the users an interface to click, so they can zoom and pan around
    the map. Mapstraction offers several ways to do this.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们给用户提供一个可以点击的界面，这样他们就可以在地图上缩放和平移。Mapstraction提供了几种实现此功能的方法。
- en: Small Controls
  id: totrans-141
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 小控件
- en: Small controls are useful when your map isn't very big, such as when you stick
    it in a sidebar. Also, if you don't expect users to perform many zooms, you might
    prefer to keep the interface clean.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 当你的地图不是很大时，小控件很有用，例如当你将其嵌入侧边栏时。此外，如果你不期望用户进行很多缩放操作，你可能更喜欢保持界面简洁。
- en: 'To add small controls to your map, add this line in your `create_map` function
    after you have set the `mapstraction` variable:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 要在你的地图中添加小控件，请在设置`mapstraction`变量后在`create_map`函数中添加此行：
- en: '[PRE7]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Save and reload your file, and you should see a small set of buttons in the
    upper-left corner of your map. Exactly how the controls look will depend on which
    mapping provider you instruct Mapstraction to use. The map will likely contain
    plus and minus buttons for zooming and a collection of arrow buttons for panning.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 保存并重新加载你的文件，你应该会在地图的左上角看到一组小按钮。控件的具体外观将取决于你指示Mapstraction使用的地图服务提供商。地图可能包含用于缩放的加号和减号按钮，以及一组箭头按钮用于平移。
- en: Large Controls
  id: totrans-146
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 大控件
- en: If your map is the focal point of your website or page, you probably want large
    controls. While small controls only let users zoom in or out one level at a time,
    with large controls you can skip to any zoom level.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的地图是网站或页面的焦点，你可能想要大控件。虽然小控件只能让用户逐级缩放，但大控件可以跳到任何缩放级别。
- en: 'Add this line to your `create_map` function:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 将此行添加到你的`create_map`函数中：
- en: '[PRE8]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Save and reload your file. When using Google Maps, Mapstraction adds several
    other controls in addition to the larger zoom/pan tools. To see how small and
    large zoom/pan tools look, see [Figure 1-7](ch01s06.html#small_and_large_zoom_controls_in_google
    "Figure 1-7. Small and large zoom controls in Google Maps (top) and Yahoo! Maps
    (bottom)").
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 保存并重新加载你的文件。当使用Google Maps时，Mapstraction除了较大的缩放/平移工具外，还会添加几个其他控件。要查看小和大缩放/平移工具的外观，请参阅[图1-7](ch01s06.html#small_and_large_zoom_controls_in_google
    "图1-7. Google Maps（顶部）和Yahoo! Maps（底部）中的小和大缩放控制")。
- en: 'To only add the large versions of zoom/pan, try this function:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 要仅添加缩放/平移的大版本，尝试此函数：
- en: '[PRE9]'
  id: totrans-152
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Here, you pass an object (declared with curly braces) with a single option for
    large zoom controls.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，你需要传递一个对象（用花括号声明），并为其提供一个用于大缩放控制的选项。
- en: '![Small and large zoom controls in Google Maps (top) and Yahoo! Maps (bottom)](httpatomoreillycomsourcenostarchimages671959.png.jpg)![Small
    and large zoom controls in Google Maps (top) and Yahoo! Maps (bottom)](httpatomoreillycomsourcenostarchimages671961.png.jpg)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![Google Maps（顶部）和Yahoo! Maps（底部）中的小和大缩放控制](httpatomoreillycomsourcenostarchimages671959.png.jpg)![Google
    Maps（顶部）和Yahoo! Maps（底部）中的小和大缩放控制](httpatomoreillycomsourcenostarchimages671961.png.jpg)'
- en: Figure 1-7. Small and large zoom controls in Google Maps (top) and Yahoo! Maps
    (bottom)
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 图1-7. Google地图（顶部）和Yahoo!地图（底部）中的小和大缩放控件
- en: Map-Type Controls
  id: totrans-156
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 地图类型控件
- en: Mapping providers often let users choose which type of map to view. In addition
    to a normal map, a satellite view and a hybrid of normal and satellite view are
    common. Not every map provider has all of these views. For example, some use aerial
    photography instead of satellite or don't have photographic imagery at all.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 地图服务提供商通常允许用户选择查看哪种类型的地图。除了普通地图外，卫星视图和普通与卫星视图的混合视图也很常见。并非每个地图服务提供商都提供所有这些视图。例如，一些使用航空摄影而不是卫星图像，或者根本不提供摄影图像。
- en: 'Use this command to add a map-type control to your map, like the one in [Figure 1-8](ch01s06.html#map_type_controls_in_google_maps
    "Figure 1-8. Map type controls in Google Maps"), so users can choose how they
    want to see your map:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此命令将地图类型控件添加到您的地图中，就像[图1-8](ch01s06.html#map_type_controls_in_google_maps
    "图1-8. Google地图中的地图类型控件")中所示，以便用户可以选择他们想要查看的地图：
- en: '[PRE10]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Save and reload your file to see the buttons in the upper-right corner of your
    map (with most providers).
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 保存并重新加载您的文件，以查看地图右上角（在大多数服务提供商中）的按钮。
- en: '![Map type controls in Google Maps](httpatomoreillycomsourcenostarchimages671963.png.jpg)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
  zh: '![Google地图中的地图类型控件](httpatomoreillycomsourcenostarchimages671963.png.jpg)'
- en: Figure 1-8. Map type controls in Google Maps
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 图1-8. Google地图中的地图类型控件
- en: Set Zoom Level
  id: totrans-163
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置缩放级别
- en: Now you've added some controls to your map, and users can change the zoom level.
    In most projects, you'll want to give users this power. Regardless, you need to
    set an initial zoom level, so the mapping provider knows what to show.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经为地图添加了一些控件，用户可以更改缩放级别。在大多数项目中，您会希望赋予用户这种权力。无论如何，您需要设置一个初始缩放级别，这样地图服务提供商就知道要显示什么。
- en: Zoom levels determine how much detail is shown. A map of the entire world cannot
    contain streets or parks. Showing country borders is about as complex as that
    map can get—even most cities are smaller than a pixel. When zoomed in to a city-level
    map, you'll see major streets, but perhaps not neighborhood features.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 缩放级别决定了显示多少细节。整个世界的地图无法包含街道或公园。显示国界线与该地图的复杂程度相当——甚至大多数城市都比一个像素小。当缩放到城市级别的地图时，您将看到主要街道，但可能看不到街区特征。
- en: 'In the basic map, you set the center and the zoom at the same time. Mapstraction
    also has a function that only sets the zoom level, while keeping the center the
    same:'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 在基本地图中，您同时设置中心和缩放级别。Mapstraction还有一个仅设置缩放级别而保持中心不变的功能：
- en: '[PRE11]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: As with the `setCenterAndZoom` function, the zoom level is communicated as an
    integer. In this example, I set a zoom level of 10, whereas I used 15 in the basic
    map. What do these numbers mean? Which one is zoomed in closer?
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 与`setCenterAndZoom`函数一样，缩放级别以整数形式传达。在这个例子中，我设置了10的缩放级别，而在基本地图中我使用了15。这些数字代表什么？哪一个更接近缩放？
- en: Mapstraction uses zoom levels 0–16, with the larger numbers corresponding to
    being more zoomed in—a greater level of detail. With satellite view, you may be
    able to zoom in even further. [Table 1-2](ch01s07.html#mapstraction_zoom_levels
    "Table 1-2. Mapstraction Zoom Levels") shows an approximate correspondence between
    zoom levels and the area usually shown. Naturally, the exact level is determined
    by the size of a country, state, or city.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: Mapstraction使用缩放级别0-16，较大的数字对应于更详细的缩放级别。使用卫星视图，您甚至可以进一步缩放。[表1-2](ch01s07.html#mapstraction_zoom_levels
    "表1-2. Mapstraction缩放级别")显示了缩放级别与通常显示的区域之间的近似对应关系。当然，确切级别取决于国家、州或城市的大小。
- en: Table 1-2. Mapstraction Zoom Levels
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 表1-2. Mapstraction缩放级别
- en: '| Geography description | Zoom level |'
  id: totrans-171
  prefs: []
  type: TYPE_TB
  zh: '| 地理描述 | 缩放级别 |'
- en: '| --- | --- |'
  id: totrans-172
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| World | 0 |'
  id: totrans-173
  prefs: []
  type: TYPE_TB
  zh: '| 世界 | 0 |'
- en: '| Country | 4 |'
  id: totrans-174
  prefs: []
  type: TYPE_TB
  zh: '| 国家 | 4 |'
- en: '| State | 7 |'
  id: totrans-175
  prefs: []
  type: TYPE_TB
  zh: '| 州 | 7 |'
- en: '| City | 13 |'
  id: totrans-176
  prefs: []
  type: TYPE_TB
  zh: '| 城市 | 13 |'
- en: '| Street | 16 |'
  id: totrans-177
  prefs: []
  type: TYPE_TB
  zh: '| 街道 | 16 |'
- en: Another reason to appreciate Mapstraction is it accommodates the different ways
    mapping providers handle zoom levels. Yahoo!, for example, uses a reverse numbering
    system, where larger numbers mean the map is more zoomed out. MapQuest, on the
    other hand, counts the same as Mapstraction, but has fewer levels with minimal
    detail. Through its single interface, Mapstraction takes care of these discrepancies.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 欣赏Mapstraction的另一个原因是它适应了地图服务提供商处理缩放级别的不同方式。例如，Yahoo!使用反向编号系统，其中较大的数字意味着地图缩放程度更大。另一方面，MapQuest的计数方式与Mapstraction相同，但具有更少的级别和最少的细节。通过其单一接口，Mapstraction处理这些差异。
- en: 'Just as you can set the zoom level, Mapstraction has a very similar command
    to retrieve the current zoom level:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 就像您可以设置缩放级别一样，Mapstraction有一个非常相似的命令来检索当前缩放级别：
- en: '[PRE12]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'The integer returned is within the 0–16 Mapstraction range, converting from
    the provider''s zoom system, if necessary. You can use a combination of `setZoom`
    and `getZoom` to create your own controls, rather than sticking with the mapping
    provider''s defaults. [#23: Create Your Own Zoom Interface](ch04s08.html "#23:
    Create Your Own Zoom Interface") in [#23: Create Your Own Zoom Interface](ch04s08.html
    "#23: Create Your Own Zoom Interface") shows how to do this with step-by-step
    instructions.'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: '返回的整数位于 0-16 的 Mapstraction 范围内，如果需要，则从提供者的缩放系统中转换。你可以使用 `setZoom` 和 `getZoom`
    的组合来创建自己的控件，而不是坚持使用地图提供者的默认设置。[创建自己的缩放界面](ch04s08.html "#23: Create Your Own Zoom
    Interface") 在 [创建自己的缩放界面](ch04s08.html "#23: Create Your Own Zoom Interface")
    中展示了如何通过逐步说明来完成此操作。'
- en: Set Map Type
  id: totrans-182
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 设置地图类型
- en: Most mapping providers offer three options for determining the look of maps.
    You can choose a simple map, which is the default, a satellite view, or a combination
    of the two. As I showed previously, you can let the user decide which map type
    to view by adding a control, usually to the upper-right corner of the map. The
    map type can also be set programmatically, which is what we'll do in this section.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数地图提供者提供了三种确定地图外观的选项。你可以选择一个简单的地图，这是默认设置，卫星视图，或者两者的组合。正如我之前所展示的，你可以通过添加控件（通常位于地图的右上角）让用户决定要查看哪种地图类型。地图类型也可以通过编程方式设置，这就是本节我们将要做的。
- en: 'You can set the map type at any time, though the most common situation is declaring
    something other than the default type when the map is loaded. For example, add
    this line to the `create_map` function of your basic map to show the satellite
    view layered with street information:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在任何时候设置地图类型，尽管最常见的情况是在地图加载时声明除默认类型之外的内容。例如，将此行添加到基本地图的 `create_map` 函数中，以显示带有街道信息的卫星视图：
- en: '[PRE13]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The argument that the `setMapType` function accepts is just a simple integer,
    but as you can see, we passed it some other type of variable. Mapstraction has
    *constants*—special variables that are created to give more meaning than simple
    numbers—that make choosing a map type easy. Setting the map type to `HYBRID` makes
    more sense than remembering that you need to pass along the number 3 when you
    want both street and satellite views. [Table 1-3](ch01s08.html#mapstraction_map_types
    "Table 1-3. Mapstraction Map Types") shows all the map-type options and their
    corresponding numeric values.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: '`setMapType` 函数接受的参数只是一个简单的整数，但正如你所看到的，我们传递了其他类型的变量。Mapstraction 有 *常量*——这些特殊变量是为了赋予比简单数字更多的意义而创建的，这使得选择地图类型变得容易。将地图类型设置为
    `HYBRID` 比记住在需要同时显示街道和卫星视图时需要传递数字 3 要有意义得多。[表 1-3](ch01s08.html#mapstraction_map_types
    "表 1-3. Mapstraction 地图类型") 展示了所有地图类型选项及其对应的数值。'
- en: Table 1-3. Mapstraction Map Types
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 表 1-3. Mapstraction 地图类型
- en: '| Name | Value |'
  id: totrans-188
  prefs: []
  type: TYPE_TB
  zh: '| 名称 | 值 |'
- en: '| --- | --- |'
  id: totrans-189
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `Mapstraction.ROAD` | 1 |'
  id: totrans-190
  prefs: []
  type: TYPE_TB
  zh: '| `Mapstraction.ROAD` | 1 |'
- en: '| `Mapstraction.SATELLITE` | 2 |'
  id: totrans-191
  prefs: []
  type: TYPE_TB
  zh: '| `Mapstraction.SATELLITE` | 2 |'
- en: '| `Mapstraction.HYBRID` | 3 |'
  id: totrans-192
  prefs: []
  type: TYPE_TB
  zh: '| `Mapstraction.HYBRID` | 3 |'
- en: 'Map-type constants are also useful when retrieving the current map type from
    Mapstraction. Just as you can both *set* and *get* the zoom level, you can access
    the map type. Add this line sometime after you''ve created your map:'
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 当从 Mapstraction 获取当前地图类型时，地图类型常量也非常有用。正如你可以设置和获取缩放级别一样，你也可以访问地图类型。在你创建地图之后，添加此行：
- en: '[PRE14]'
  id: totrans-194
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Remember, the `setMapType` function accepts an integer value as an argument.
    The value returned from `getMapType` is 1, 2, or 3\. Again, referring to map types
    by the Mapstraction constants is much easier. For example, you can use a `switch...
    case` statement to perform different actions based on the map type:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，`setMapType` 函数接受一个整数作为参数。`getMapType` 返回的值是 1、2 或 3。再次强调，通过 Mapstraction
    常量来引用地图类型要容易得多。例如，你可以使用 `switch...case` 语句根据地图类型执行不同的操作：
- en: '[PRE15]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Replace the comments (the lines that start with two slashes) with the code you
    would want to use in the circumstances described. For example, you might want
    to remove driving directions from a map if only the satellite map is showing,
    because showing driving directions when no streets are visible makes less sense.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 将注释（以两个斜杠开始的行）替换为你想要在描述的情境中使用的代码。例如，你可能想要在只显示卫星地图的情况下从地图中删除路线，因为当没有街道可见时显示路线没有意义。
- en: Recenter the Map
  id: totrans-198
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 重新定位地图
- en: If you're already displaying a map, then you gave it a center with the `setCenterAndZoom`
    function. You never know when users will drag the map away from your center. Knowing
    how to reset the center—and just the center—can be useful.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您已经显示了一个地图，那么您已经使用`setCenterAndZoom`函数给它设置了一个中心点。您永远不知道用户何时会将地图拖离您的中心点。知道如何重置中心点——仅重置中心点——可能很有用。
- en: 'Add the following line to the `create_map` function, or include it as a click
    event in a link:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 将以下行添加到`create_map`函数中，或者将其作为链接中的点击事件包含在内：
- en: '[PRE16]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Of course, snapping a map directly to a point can be jarring. Luckily, the
    user can pan to the new center point, as if he or she dragged the map there:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，直接将地图移动到某个点可能会让人感到突然。幸运的是，用户可以拖动到新的中心点，就像他们拖动地图到那里一样：
- en: '[PRE17]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Here we're passing an options object to the `setCenter` function. The curly
    braces declare an object in JavaScript with values set by `key:value` pairs. Mapstraction
    will look for whether `pan` exists. If `pan` is set to `true`, then the map will
    pan smoothly to the new point.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们向`setCenter`函数传递了一个选项对象。大括号在JavaScript中声明了一个对象，其值由`key:value`对设置。Mapstraction会检查是否存在`pan`。如果`pan`设置为`true`，则地图将平滑地移动到新点。
- en: Retrieve the Center of the Map
  id: totrans-205
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 检索地图中心
- en: When you load a new map, you need to give it a center. Then you give up control,
    as your users drag and pan that map to their heart's content. That's good, because
    maps are interactive. On the other hand, you may want to know the map's current
    center.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 当您加载一个新的地图时，需要给它一个中心点。然后您放弃控制权，因为您的用户会根据他们的意愿拖动和缩放地图。这是好事，因为地图是交互式的。另一方面，您可能想知道地图的当前中心点。
- en: 'Mapstraction has a simple command to retrieve the map''s center:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: Mapstraction有一个简单的命令来检索地图的中心：
- en: '[PRE18]'
  id: totrans-208
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'The variable created, `centerpoint`, holds the result from the call to `getCenter()`
    as a `LatLonPoint`, which is the way Mapstraction stores coordinates. Keeping
    coordinates in a variable is handy because you can turn around and pass that to
    other functions. Or you can access the latitude and longitude directly:'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 创建的变量`centerpoint`保存了`getCenter()`调用返回的结果，作为一个`LatLonPoint`，这是Mapstraction存储坐标的方式。将坐标保存在变量中很方便，因为您可以转身将其传递给其他函数。或者您可以直接访问纬度和经度：
- en: '[PRE19]'
  id: totrans-210
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Now, you can use those values to add a marker to your map, plot local results
    on a map, or for some other purpose.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您可以使用这些值在地图上添加标记，在地图上绘制本地结果，或用于其他目的。
- en: Find Point Where User Clicked
  id: totrans-212
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 查找用户点击的点
- en: Out-of-the-box interactivity makes mapping APIs pretty special. Using built-in
    controls, users can drag and pan the map, zoom in, and change map types. Users
    can also click, but nothing will happen unless you help them out.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 开箱即用的交互性使得地图API非常特别。使用内置控件，用户可以拖动和缩放地图，放大，并更改地图类型。用户也可以点击，但除非您帮助他们，否则不会发生任何事情。
- en: 'To find the point where a user clicks, you need to "listen" for the click event:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 要找到用户点击的点，您需要“监听”点击事件：
- en: '[PRE20]'
  id: totrans-215
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: When the user clicks anywhere within the map, an anonymous function is called
    with `clickpoint` as an argument. Similar to when you retrieve the center of a
    map, the variable is a `LatLonPoint`. This example uses a JavaScript alert to
    display the latitude and longitude of the point where the user clicked, as shown
    in [Figure 1-9](ch01s11.html#javascript_alert_showing_latitude_and_lo "Figure 1-9. JavaScript
    alert showing latitude and longitude of click point").
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 当用户点击地图上的任何位置时，会以`clickpoint`作为参数调用一个匿名函数。这与您检索地图中心时类似，变量是一个`LatLonPoint`。本例使用JavaScript弹窗来显示用户点击点的纬度和经度，如图[图1-9](ch01s11.html#javascript_alert_showing_latitude_and_lo
    "图1-9. JavaScript弹窗显示点击点的纬度和经度")所示。
- en: '![JavaScript alert showing latitude and longitude of click point](httpatomoreillycomsourcenostarchimages671965.png.jpg)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
  zh: '![JavaScript弹窗显示点击点的纬度和经度](httpatomoreillycomsourcenostarchimages671965.png.jpg)'
- en: Figure 1-9. JavaScript alert showing latitude and longitude of click point
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 图1-9. JavaScript弹窗显示点击点的纬度和经度
- en: Of course, you'll want to do something more useful than a JavaScript alert.
    For example, you could add a marker to your map at that point. As it happens,
    the next chapter shows you how to do that and more.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，您可能想要做一些比JavaScript弹窗更有用的事情。例如，您可以在该点在地图上添加标记。碰巧的是，下一章将向您展示如何做到这一点以及更多。
