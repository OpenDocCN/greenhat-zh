- en: Chapter 9. EDGES AND ANALYSIS
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 9 章。边和数据分析
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages651574.png.jpg)'
  id: totrans-1
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages651574.png.jpg)'
- en: With the tools I've discussed throughout this book, you can analyze and present
    your data in just about any way you might need. In this chapter, you'll consider
    a couple of similar systems and learn how to connect them to your flow collector.
    Then you'll look at a couple of common use cases that illustrate what you can
    accomplish with flow analysis.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 通过本书中讨论的工具，您可以用您可能需要的任何方式分析和展示您的数据。在本章中，您将考虑几个类似系统，并学习如何将它们连接到您的流量收集器。然后，您将查看几个常见用例，说明您可以使用流量分析实现什么。
- en: NetFlow v9
  id: totrans-3
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: NetFlow v9
- en: NetFlow version 9 is mostly used for IPv6 (although it can be extended to include
    other types of information as well) and is only rarely deployed. Although most
    NetFlow sensors support multiple versions, such as 5 or 7 in addition to 9, a
    few manufacturers make hardware that speaks only version 9\. When version 9 becomes
    more widely used, flow-tools and its brethren will probably develop support for
    it. Until that time, however, how can you cope with NetFlow version 9 data?
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: NetFlow 版本 9 主要用于 IPv6（尽管它可以扩展以包含其他类型的信息），并且很少部署。尽管大多数 NetFlow 传感器支持多个版本，如 5
    或 7 以及 9，但一些制造商生产的硬件只能使用版本 9。当版本 9 得到更广泛的应用时，flow-tools 和其同类产品可能会开发对其的支持。然而，在此之前，您如何处理
    NetFlow 版本 9 数据呢？
- en: Other free flow collectors accept version 9 flows. You can translate version
    9 data into flow-tools format. I'll show how to use `flowd`^([[11](#ftn.CHP-9-FN-1)])
    ([http://www.mindrot.org/projects/flowd/](http://www.mindrot.org/projects/flowd/)),
    by the author of `softflowd`. To transform your data into a `flow-capture` record
    file, you first need to install `flowd`.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 其他免费流量收集器接受版本 9 流量。您可以将版本 9 数据转换为 flow-tools 格式。我将展示如何使用 `flowd`^([[11](#ftn.CHP-9-FN-1)])
    ([http://www.mindrot.org/projects/flowd/](http://www.mindrot.org/projects/flowd/))，这是
    `softflowd` 的作者开发的。要将您的数据转换为 `flow-capture` 记录文件，您首先需要安装 `flowd`。
- en: Installing flowd
  id: totrans-6
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装 `flowd`
- en: 'If your operating system includes a `flowd` package, use it. If not, you should
    install `flowd`, but before you do, install the following software:'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的操作系统包含 `flowd` 软件包，请使用它。如果没有，您应该安装 `flowd`，但在安装之前，您应该安装以下软件：
- en: BSD `yacc` (usually packaged as `byacc` on Linux systems)
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: BSD `yacc`（在 Linux 系统上通常打包为 `byacc`）
- en: GNU `make`
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: GNU `make`
- en: Yes, that's GNU-style `make` plus BSD-style `yacc`.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 是的，这是 GNU 风格的 `make` 加上 BSD 风格的 `yacc`。
- en: The `flowd` software expects to run as the unprivileged user *_flowd*. Create
    this user before building the software.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: '`flowd` 软件期望以无特权的用户 *_flowd* 运行。在构建软件之前，请创建此用户。'
- en: Once `yacc` and `make` are installed, build `flowd` much like you would flow-tools
    or `softflowd`. The `configure` script includes a variety of options. Here, I
    build and install `flowd` under */usr/local/flowd*`:`
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦安装了 `yacc` 和 `make`，构建 `flowd` 的方式与构建 flow-tools 或 `softflowd` 类似。`configure`
    脚本包含各种选项。在这里，我在 */usr/local/flowd* 下构建和安装 `flowd`：
- en: '[PRE0]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: That's it! You should get a configuration file and the program itself.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 就这些！您应该会得到一个配置文件和程序本身。
- en: Configuring flowd
  id: totrans-15
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置 `flowd`
- en: Where you control `flow-capture` with command-line arguments, `flowd` uses a
    configuration file. Most `flowd` configuration options are similar to options
    offered by `flow-capture`.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 在您使用命令行参数控制 `flow-capture` 的地方，`flowd` 使用配置文件。大多数 `flowd` 配置选项与 `flow-capture`
    提供的选项类似。
- en: '[PRE1]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: '`flowd` stores flow records in the logfile at ❶. Like `flow-capture`''s `ft-`
    files, a `flowd` log is a compressed binary file that you cannot view directly.
    Like most other software, `flowd` records its process ID in a PID file, as shown
    at ❷. Most systems store PID files in the directory */var/run*.'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '`flowd` 将流量记录存储在日志文件中 ❶。与 `flow-capture` 的 `ft-` 文件类似，`flowd` 日志是一个无法直接查看的压缩二进制文件。像大多数其他软件一样，`flowd`
    在 PID 文件中记录其进程 ID，如图 ❷ 所示。大多数系统将 PID 文件存储在目录 */var/run* 中。'
- en: '`flowd` must listen to the network, and at ❸ you specify an IP address and
    a UDP port, separated by a colon. If you were to use an IP of 0.0.0.0, `flowd`
    would listen for incoming flow data on all IP addresses on the system. To restrict
    the IP addresses `flowd` accepts flow data from, list a router''s IP address as
    a flow source, as shown at ❹.'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: '`flowd` 必须监听网络，并在 ❸ 中指定一个 IP 地址和一个 UDP 端口，用冒号分隔。如果您使用 IP 0.0.0.0，`flowd` 将监听系统上所有
    IP 地址的传入流量数据。要限制 `flowd` 接受流量数据的 IP 地址，请将路由器的 IP 地址作为流量源列出，如图 ❹ 所示。'
- en: Although `flowd` has comprehensive filtering features to let you record only
    certain types of flows, you tell `flowd` at ❺ to record everything and at ❻ to
    accept everything the sensor transmits.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然`flowd`具有全面的过滤功能，让您仅记录某些类型的流量，但您在❺处告诉`flowd`记录所有内容，并在❻处接受传感器传输的所有内容。
- en: Once you've finished editing your configuration file, start `flowd`, and tell
    your version 9 sensor to transmit data to this collector's IP address and port.
    When version 9 flow data arrives, `flowd` should record it in the logfile. Once
    you see the logfile grow larger, it's time to convert data to flow-tools format.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 修改完配置文件后，启动`flowd`，并告诉您的版本9传感器将数据传输到该收集器的IP地址和端口。当版本9流量数据到达时，`flowd`应该将其记录在日志文件中。一旦您看到日志文件变大，就是将数据转换为flow-tools格式的时候了。
- en: Converting flowd Data to Flow-tools
  id: totrans-22
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 将flowd数据转换为Flow-tools
- en: 'NetFlow version 9 includes the information expected in a NetFlow v5 record:
    source and destination addresses and ports, protocol numbers, packet counts, and
    so on. You need to automatically extract this information from the `flowd` log
    and import it into a `flow-capture ft-` file. Fortunately, Craig Weinhold''s `flowd2ft`
    script does this for you. You can copy the script from the following listing or
    download it from [http://www.networkflowanalysis.com/](http://www.networkflowanalysis.com/).
    Let''s look at it.'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: NetFlow版本9包括NetFlow v5记录中预期的信息：源和目标地址和端口、协议号、数据包计数等。您需要自动从`flowd`日志中提取这些信息并将其导入到`flow-capture
    ft-`文件中。幸运的是，Craig Weinhold的`flowd2ft`脚本为您做了这件事。您可以从以下列表中复制脚本或从[http://www.networkflowanalysis.com/](http://www.networkflowanalysis.com/)下载它。让我们看看它。
- en: '[PRE2]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Before using this script, you'll need to set the configuration variables. At
    ❶ you hard-code the location of the `flow-import` program. At ❷ you point the
    script to the directory you want to use to store your created `flow-capture` files.
    At ❸ you give the script the time zone offset in minutes so that it can include
    that information in the filename just like `flow-capture` would. At ❹ you tell
    the script to create a new `ft-` file every 300 seconds, just as your usual `flow-capture`
    instances do.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用此脚本之前，您需要设置配置变量。在❶处，您将`flow-import`程序的路径硬编码。在❷处，您将脚本指向您想要用于存储创建的`flow-capture`文件的目录。在❸处，您给脚本提供分钟数的时间区域偏移量，以便它可以在文件名中包含该信息，就像`flow-capture`一样。在❹处，您告诉脚本每300秒创建一个新的`ft-`文件，就像您的常规`flow-capture`实例一样。
- en: The script also needs to know where the `flowd-reader` program (❺) is installed
    and where to find the `flowd` configuration (❻). At ❼ the script reads the `flowd`
    configuration file for the rest of its settings and then at ❽ moves the existing
    `flowd` file out of the way so that it can restart `flowd` and close the existing
    logfile. Finally, at ❾ it reads the freshly closed logfile and creates a new `flow-capture`
    file.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 脚本还需要知道`flowd-reader`程序（❺）的安装位置以及如何找到`flowd`配置（❻）。在❼处，脚本读取`flowd`配置文件以获取其余设置，然后在❽处将现有的`flowd`文件移开，以便重新启动`flowd`并关闭现有的日志文件。最后，在❾处，它读取新关闭的日志文件并创建一个新的`flow-capture`文件。
- en: 'After configuring the script, run it once by hand. It should create a new `ft-`
    logfile in the destination directory and tell you how many flows it processed.
    If the script doesn''t run correctly, check your settings and error and log messages.
    Once you''re sure that your script is running properly, have your system run it
    every five minutes by making the appropriate entry in `cron`, as shown here:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 配置脚本后，手动运行一次。它应该在目标目录中创建一个新的`ft-`日志文件，并告诉你处理了多少流量。如果脚本运行不正确，请检查您的设置和错误日志消息。一旦您确定脚本运行正常，请通过在`cron`中添加适当的条目，使系统每五分钟运行一次，如下所示：
- en: '[PRE3]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: You will now have flow records that are compatible with the rest of your flow
    reporting system. You can use these records to set up FlowScan, run `flow-report`,
    or do anything else you like.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您将拥有与您其余流量报告系统兼容的流量记录。您可以使用这些记录来设置FlowScan，运行`flow-report`或执行您喜欢的任何其他操作。
- en: '* * *'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[11](#CHP-9-FN-1)]) I seriously considered using `flowd` for this book, but
    it doesn't yet have the variety of canned reports that `flow-capture` supports.
    I expect this to change over time, however, and if you need an IPv6 flow collector
    and are comfortable writing reports in Perl or Python, you should consider `flowd`.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[11](#CHP-9-FN-1)]) 我认真考虑过使用`flowd`来编写这本书，但它还没有像`flow-capture`支持的那样多种预定义报告。然而，我预计这会随着时间的推移而改变，如果您需要一个IPv6流量收集器并且能够用Perl或Python编写报告，您应该考虑使用`flowd`。
- en: sFlow
  id: totrans-32
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: sFlow
- en: 'sFlow is a flow export technology invented by InMon that competes with Cisco''s
    NetFlow. Many vendors, such as HP and Extreme, offer equipment that exports sFlow
    but not NetFlow. No need to despair, though: You can translate sFlow packets into
    NetFlow version 5 data and feed that to flow-tools.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: sFlow 是由 InMon 发明的流量导出技术，与思科的 NetFlow 竞争。许多供应商，如 HP 和 Extreme，提供导出 sFlow 但不导出
    NetFlow 的设备。不过，没有必要绝望：你可以将 sFlow 数据包转换为 NetFlow 版本 5 数据，并将其提供给 flow-tools。
- en: Note
  id: totrans-34
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If you have a lot of sFlow-based equipment, however, you should really look
    into an sFlow reporting system. I recommend converting sFlow to NetFlow when you
    have an existing `flow-tools` setup and a couple of sFlow devices that you'd like
    to integrate into that system, not when you have a data center full of sFlow hardware.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，如果你有很多基于 sFlow 的设备，那么真正需要考虑的是一个 sFlow 报告系统。我建议在你有一个现有的 `flow-tools` 设置和几个你想要集成到该系统中的
    sFlow 设备时将 sFlow 转换为 NetFlow，而不是当你有一个满载 sFlow 硬件的数据中心时。
- en: Configuring sFlow Export with sflowenable
  id: totrans-36
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 sflowenable 配置 sFlow 导出
- en: Some sFlow sensors can be configured through the GUI or command line, but a
    few sFlow sensors require configuration via SNMP. Although you could manually
    use SNMP GET and SET commands to set up sFlow, the fine folks at InMon offer a
    script to automate this process for you. Grab a copy of `sflowenable` from [http://www.inmon.com/technology/sflowenable/](http://www.inmon.com/technology/sflowenable/).
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 一些 sFlow 传感器可以通过 GUI 或命令行进行配置，但有一些 sFlow 传感器需要通过 SNMP 进行配置。虽然你可以手动使用 SNMP GET
    和 SET 命令来设置 sFlow，但 InMon 的那些好人提供了一个脚本来自动化这个过程。从 [http://www.inmon.com/technology/sflowenable/](http://www.inmon.com/technology/sflowenable/)
    获取 `sflowenable` 的副本。
- en: '`sflowenable` requires the net-snmp tools you probably already have installed
    on your network management workstation. It also requires GNU `awk`, also known
    as `gawk`. Some operating systems include `gawk` as the default `awk`; others
    have it as an add-on package. If `sflowenable` fails with cryptic `awk` errors,
    you have the wrong `awk`. Install `gawk`, and either edit the script to use `gawk`
    instead of `awk` or alias `awk` to `gawk` in your shell. Now say that three times
    fast.'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '`sflowenable` 需要你可能已经安装在你的网络管理工作站上的 net-snmp 工具。它还需要 GNU `awk`，也称为 `gawk`。一些操作系统将
    `gawk` 作为默认的 `awk` 包含在内；其他操作系统则将其作为附加包提供。如果 `sflowenable` 因为神秘的 `awk` 错误而失败，你使用的
    `awk` 是错误的。安装 `gawk`，然后编辑脚本以使用 `gawk` 而不是 `awk`，或者在你的 shell 中将 `awk` 别名为 `gawk`。现在快速地说三遍。'
- en: Running `sflowenable` requires the sensor hostname and a read-write SNMP community,
    the collector IP, and the UDP port you want to receive sFlow data on.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 运行 `sflowenable` 需要传感器主机名和读写 SNMP 社区、收集器 IP 地址以及你想要接收 sFlow 数据的 UDP 端口。
- en: '[PRE4]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'For example, to activate sFlow on the device bigSwitch, using the SNMP community
    LucasRulez, and to transmit the data to a sFlow collector on the host 192.0.2.15
    on port 5515, I would run the following:'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，为了在设备 bigSwitch 上激活 sFlow，使用 SNMP 社区 LucasRulez，并将数据传输到主机 192.0.2.15 上的端口
    5515 的 sFlow 收集器，我会运行以下命令：
- en: '[PRE5]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: You should see data coming to port 5515 on your collector almost immediately.
    But wait a minute—you have nothing that can listen to sFlow, let alone do anything
    with it! You'll handle that detail now.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该几乎立即在你的收集器上看到数据流向端口 5515。但是等等——你没有可以监听 sFlow 的东西，更不用说做任何事情了！你现在将处理这个细节。
- en: Convert sFlow to NetFlow
  id: totrans-44
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 转换 sFlow 到 NetFlow
- en: The `sflowtool` program is a free sFlow collector, capture, and converter available
    from [http://www.inmon.com/technology/sflowTools.php](http://www.inmon.com/technology/sflowTools.php).
    Among its features, it can convert a sFlow data stream to NetFlow version 5 and
    send it to a NetFlow collector. This is perfect for these purposes.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: '`sflowtool` 程序是一个免费的 sFlow 收集器、捕获器和转换器，可以从 [http://www.inmon.com/technology/sflowTools.php](http://www.inmon.com/technology/sflowTools.php)
    获取。在其特性中，它可以转换 sFlow 数据流到 NetFlow 版本 5 并发送到 NetFlow 收集器。这对于这些目的来说非常完美。'
- en: '`sflowtool` is a simple program with no special prerequisites. Build it with
    the familiar `./configure`, `make`, `make install` routine you''ve used repeatedly.'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '`sflowtool` 是一个没有特殊要求的简单程序。你可以使用熟悉的 `./configure`、`make`、`make install` 程序来构建它，这些程序你已经多次使用过了。'
- en: To have `sflowtool` convert and retransmit data, you need a port to listen for
    sFlow connections, a `flow-capture` host, and the `flow-capture` port.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 要让 `sflowtool` 转换并重新传输数据，你需要一个用于监听 sFlow 连接的端口、一个 `flow-capture` 主机以及 `flow-capture`
    端口。
- en: '[PRE6]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'In the earlier example, I assumed that you had a sFlow collector on port 5515\.
    Let''s assume you want to accept those sFlow packets, convert them to NetFlow,
    and retransmit them to a `flow-capture` instance running on the same host on port
    5516\. You would run `sflowtool` like this:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的示例中，我假设你有一个在端口 5515 上的 sFlow 收集器。让我们假设你想要接受这些 sFlow 数据包，将它们转换为 NetFlow，并将它们重新传输到同一主机上的端口
    5516 上运行的 `flow-capture` 实例。你会这样运行 `sflowtool`：
- en: '[PRE7]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Now configure a `flow-capture` instance to record the flow data, and you have
    data from your sFlow-only device with no local scripts or conversion routines
    necessary.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 现在配置一个 `flow-capture` 实例以记录流量数据，你就可以从仅支持 sFlow 的设备中获取数据，无需任何本地脚本或转换程序。
- en: Problem Solving with Flow Data
  id: totrans-52
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用流量数据解决问题
- en: You've explored the usefulness of various flow analysis features throughout
    this book. Now you'll look at a few case studies of real problems and possible
    solutions. Some of these I've touched on earlier; others are completely new.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 你已经在本书中探讨了各种流量分析功能的有用性。现在，你将查看一些真实问题的案例研究和可能的解决方案。其中一些我在前面已经提到过；其他则是全新的。
- en: Finding Busted Software
  id: totrans-54
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 找到损坏的软件
- en: 'Under normal circumstances, a small percentage of TCP connections break regularly
    on every network. Software stacks misbehave, clients try to connect to defunct
    printers, and users who ought to know better install freeware that behaves unspeakably.
    Perhaps the fastest way to use flow data to improve your network is to check for
    these broken connections, identify their sources and destinations, and discover
    what software on the affected machines is causing the problems. The following
    are two common groups of "broken" TCP connections:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 在正常情况下，每个网络上的 TCP 连接都会定期断开一小部分。软件堆栈行为不当，客户端尝试连接到已废弃的打印机，应该知道更好的用户安装了行为无法言喻的免费软件。也许使用流量数据来改善你的网络最快的方法就是检查这些损坏的连接，确定它们的来源和目的地，并发现受影响机器上导致问题的软件。以下是有两种常见的“损坏”TCP
    连接组：
- en: '**SYN-only flows**'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '**仅 SYN 流**'
- en: A machine attempts to connect to a remote host that doesn't answer.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 一台机器尝试连接到一个不响应的远程主机。
- en: '**RST-only flows**'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '**仅 RST 流**'
- en: A machine attempts to connect to a remote host that refuses the connection.
    You can write filters for each of these and report on them separately.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 一台机器尝试连接到一个拒绝连接的远程主机。你可以为这些情况编写过滤器，并分别报告它们。
- en: Broken Connection Filters
  id: totrans-60
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 损坏的连接过滤器
- en: 'The following filters will capture these two types of broken TCP connection:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 以下过滤器将捕获这两种类型的损坏 TCP 连接：
- en: '[PRE8]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Here you define a primitive for SYN-only flows at ❶, a corresponding filter
    at ❸, an RST-only primitive at ❷, and its matching filter at ❹.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，你定义了一个仅 SYN 流的原型 ❶，一个相应的过滤器 ❸，一个仅 RST 的原型 ❷，以及它的匹配过滤器 ❹。
- en: Checking for Resets
  id: totrans-64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 检查重置
- en: Now use the `rst-only` filter on a sample of typical traffic.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 现在在一个典型流量的样本上使用 `rst-only` 过滤器。
- en: '[PRE9]'
  id: totrans-66
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Choose records from a time where you expect "typical" traffic. For example,
    if your office is open only from 9 **am** to 5 **pm**, the flow records from 2
    **am** will not represent normal use (although they're probably interesting to
    look at separately). On my network, I'm analyzing records at ❶ from 10 **am**
    to 11 **am**.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 选择你预期“典型”流量的时间段的记录。例如，如果你的办公室只在上午 9 点到下午 5 点开放，那么凌晨 2 点的流量记录将不会代表正常使用（尽管它们可能单独查看很有趣）。在我的网络上，我正在分析上午
    10 点到 11 点的记录 ❶。
- en: You're hunting for machines that are either sending or receiving abnormally
    large numbers of SYN-only or RST-only flows. Although you might initially view
    the data with `flow-print`, what you really want is a list of IP addresses and
    the number of matching flows, as offered by the `ip-address` report at ❷. I want
    to sort in decreasing order, as shown at ❸. In this hour, the first two hosts
    have 30 times more RST-only flows than the host in third place, as you can see
    at ❹. Something isn't behaving well there.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 你正在寻找发送或接收异常大量仅 SYN 或仅 RST 流的机器。虽然你可能会最初用 `flow-print` 查看数据，但你真正想要的是一个 IP 地址列表和匹配流量的数量，如
    `ip-address` 报告 ❷ 所提供的。我想按降序排序，如 ❸ 所示。在这个小时里，前两个主机的仅 RST 流量比第三名的机器多 30 倍，如 ❹ 所见。那里似乎有什么行为不正常。
- en: 'The next step is to check a few more time windows to see whether this behavior
    is consistent or whether these two hosts were just having trouble at a particular
    time. Assuming that the behavior is consistent, take a closer look at the RST-only
    traffic from the first host. In this example, I''m using the `ip-addr` report
    created in [Chapter 4](ch04.html "Chapter 4. FILTERING FLOWS"), so I don''t need
    to differentiate between source and destination addresses yet:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 下一步是检查更多的时段，看看这种行为是否一致，或者这两个主机是否只是在特定时间有问题。假设行为是一致的，那么更仔细地查看第一个主机的 RST-only
    流量。在这个例子中，我正在使用在[第 4 章](ch04.html "第 4 章。过滤流量")中创建的 `ip-addr` 报告，所以我还不需要区分源地址和目标地址：
- en: '[PRE10]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: As you can see in the previous listing, each flow appears basically identical
    at first glance. The host 192.0.2.184 sends two TCP RSTs to 192.0.2.197, from
    port 443 to a high-numbered port. These are rejected HTTPS requests. If you were
    to view all traffic between these two hosts, you'd see that 192.0.2.197 makes
    HTTPS requests to 192.0.2.184, which then rejects them.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 如您在前面的列表中看到的，每个流在第一眼看来基本上是相同的。主机 192.0.2.184 向 192.0.2.197 发送了两个 TCP RST，从端口
    443 到一个高端口。这些都是被拒绝的 HTTPS 请求。如果您查看这两个主机之间的所有流量，您会看到 192.0.2.197 向 192.0.2.184
    发送 HTTPS 请求，然后被拒绝。
- en: 'Running `flow-print` a second time with a format that includes timestamps,
    such as the following, shows that the client makes this request every few seconds:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 第二次运行 `flow-print` 并使用包括时间戳的格式，如下所示，显示客户端每隔几秒就发起这个请求：
- en: '[PRE11]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: The host 192.0.2.197 is running a piece of software that is broken or misconfigured.
    Now go ask the system administrator what's going on.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 主机 192.0.2.197 正在运行一个损坏或配置错误的软件。现在去询问系统管理员发生了什么。
- en: Note that my test network is fairly small. In an enterprise data center, you
    might find dozens of different software packages behaving badly; I've personally
    seen misconfigured software try to contact other hosts hundreds of times a second.
    Although TCP RSTs don't usually consume enough bandwidth to cause problems, resolving
    these problems makes the software more efficient, reduces hardware requirements,
    and might reduce network traffic and service delays in unexpected ways.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，我的测试网络相当小。在企业数据中心，您可能会发现几十种不同的软件包表现不佳；我亲眼见过配置错误的软件每秒尝试联系其他主机数百次。尽管 TCP RST
    通常不会消耗足够的带宽来引起问题，但解决这些问题可以使软件更高效，减少硬件需求，并可能以意想不到的方式减少网络流量和服务延迟。
- en: Checking for Failed Connections
  id: totrans-76
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 检查失败的连接
- en: SYN-only flows show that a host requested a connection but nothing answered.
    Either the requested address is not on the network, the host at that address cannot
    answer the request, or the host is silently ignoring the request. Although you
    probably know whether your equipment is configured to silently ignore requests,
    identifying the first two types of hosts can be very useful. You'll identify IP
    addresses with high levels of SYN-only flows much like you checked for RST-only
    flows; only the filter changes.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: SYN-only 流表明主机请求了一个连接，但没有得到响应。要么请求的地址不在网络上，要么该地址的主机无法响应请求，或者该主机正在静默忽略请求。尽管您可能知道您的设备是否配置为静默忽略请求，但识别前两种类型的设备可能非常有用。您将像检查
    RST-only 流一样识别具有高 SYN-only 流量的 IP 地址；只是过滤器有所变化。
- en: '[PRE12]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'In this report, once again you have a clear outlier: the host 192.0.2.13 shown
    at ❶ has many more SYN-only flows than any other host. To see why, look at that
    host''s traffic using the same technique you used for a particular RST-only host,
    as shown here:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 在这份报告中，您再次看到了一个明显的异常值：显示在❶处的主机 192.0.2.13 比其他任何主机都有更多的 SYN-only 流。为了了解原因，请使用与特定
    RST-only 主机相同的技巧查看该主机的流量，如下所示：
- en: '[PRE13]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: As you can see, the host 192.0.2.13 repeatedly tries to contact 192.0.2.16,
    first on port 24 at ❶ and then port 26 (❷), port 27 (❸), port 28 (❹), and so on.
    This particular data shows that 192.0.2.13 is trying every port between 1 and
    1024 on 192.0.2.16\. The connection attempts then move to 192.0.2.17.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，主机 192.0.2.13 重复尝试联系 192.0.2.16，首先是在端口 24 上（❶），然后是端口 26（❷），端口 27（❸），端口
    28（❹），以此类推。这一特定数据表明 192.0.2.13 正在尝试 192.0.2.16 上的 1 到 1024 之间的所有端口。随后，连接尝试转向 192.0.2.17。
- en: This activity is indicative of a port scanner. Remember, not all port scanners
    scan ports sequentially—the key is to look for the same IP being hit at many ports
    in a relatively brief time. If 192.0.2.13 is your security workstation and you
    habitually scan your own network, this might be normal behavior. However, worms
    and intruders also use port scanners to identify vulnerable targets. If you don't
    know why this machine is scanning the network, find out!
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 这个活动表明这是一台端口扫描器。记住，并非所有端口扫描器都是按顺序扫描端口的——关键是要寻找在相对较短的时间内被同一IP地址在多个端口上击中的情况。如果192.0.2.13是你的安全工作站，并且你习惯性地扫描自己的网络，这可能是一种正常行为。然而，蠕虫和入侵者也会使用端口扫描器来识别易受攻击的目标。如果你不知道这台机器为什么扫描网络，找出原因！
- en: One interesting thing in this output is that the port scan appears to skip port
    25\. Remember, you're checking for flows that reset immediately. If a host responds
    on a port, it won't appear on this list. In this case, 192.0.2.16 runs a mail
    server; viewing all the traffic between these hosts would show a flow to port
    25 and an answering flow.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个输出中，有一个有趣的现象是端口扫描似乎跳过了端口25。记住，你正在检查立即重置的数据流。如果一个主机在端口上响应，它将不会出现在这个列表中。在这种情况下，192.0.2.16运行着一个邮件服务器；查看这些主机之间的所有流量将显示一个到端口25的数据流和一个响应的数据流。
- en: 'Investigating another IP with a high SYN-only count might produce results like
    these:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 调查另一个具有高只包含SYN计数器的IP地址可能会产生类似以下的结果：
- en: '[PRE14]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Each of these different source IP addresses is trying to connect to 192.0.2.158,
    all on TCP port 80\. A quick check shows that this machine is a web server, and
    it does answer requests on port 80\. Why do you see these SYN-only flows?
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 这些不同的源IP地址都在尝试连接到192.0.2.158，所有这些都是在TCP端口80上。快速检查显示，这台机器是一个Web服务器，并且它确实在端口80上响应请求。为什么你会看到这些只包含SYN的数据流？
- en: If your network equipment is reporting a flow, it certainly delivered the packet
    to the network node because delivering packets is a much higher-priority task
    than flow reporting! In this particular case, removing the `syn-only` filter from
    the `flow-print` command showed that the web server answered thousands of requests.
    `flow-report` told you that this host had 193 SYN-only flows during the hour you
    checked, but the web server just didn't answer these 193 requests. Maybe it ran
    out of memory or CPU. Perhaps the network card was saturated, or the web server
    software was reloaded.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的网络设备报告了一个数据流，那么它肯定将数据包发送到了网络节点，因为发送数据包是一个比流量报告更高的优先级任务！在这个特定的情况下，从`flow-print`命令中移除`syn-only`过滤器显示Web服务器响应了数千个请求。"flow-report"告诉你，在你检查的那个小时内，这台主机有193个只包含SYN的数据流，但Web服务器并没有响应这193个请求。可能是它耗尽了内存或CPU。也许网卡已经饱和，或者Web服务器软件被重新加载了。
- en: Graphing the times the SYN-only packets appeared might give some answers, especially
    when compared with a graph of the number of connections opened at that time or
    list of times the server performs internal maintenance. As the network administrator,
    all you can say is that during this hour users got a "Page Cannot Be Displayed"
    or some similar error 193 times. Is this acceptable in your environment and situation?
    Probably not.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 绘制只包含SYN的数据包出现的时间图可能会提供一些答案，特别是当与当时打开的连接数量图或服务器执行内部维护的时间列表进行比较时。作为网络管理员，你只能说，在这个小时内，用户遇到了“页面无法显示”或类似的错误193次。在你的环境和情况下，这是可以接受的吗？可能不是。
- en: The nice thing with this type of result is that you know what part of the delivery
    system failed. The network delivered the packets, and the web server didn't answer.
    If the web server administrator reports that he's getting complaints about network
    timeouts, you can provide evidence that the timeouts aren't actually network problems
    and offer suggestions on how to fix the issues.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 这种类型的结果的好处是，你知道交付系统中的哪个部分失败了。网络交付了数据包，而Web服务器没有响应。如果Web服务器管理员报告说他在收到关于网络超时的投诉，你可以提供证据表明超时实际上并不是网络问题，并提出解决问题的建议。
- en: Identifying Worms
  id: totrans-90
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 识别蠕虫
- en: If you're on an enterprise network, worms cause something worse than system
    trouble. They cause meetings. With management. And because your antivirus software
    probably kicked up desktop alarms as the worm tried to propagate, those meetings
    will probably include senior managers who will ask inconvenient questions about
    how you spend your time.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在一个企业网络中，蠕虫造成的麻烦远不止系统问题。它们会引发会议。与管理层一起。由于你的防病毒软件可能在蠕虫尝试传播时触发桌面警报，这些会议可能包括高级管理人员，他们可能会提出关于你如何度过时间的尴尬问题。
- en: Your best response is to find the worm source as quickly as possible. For example,
    in spring 2009, my employer's antivirus systems began spewing warnings about infection
    attempts from the Conficker virus. At a global company with tens of thousands
    of desktops, manually identifying virus sources could take countless man-hours
    and would require cooperation across umpteen time zones and multiple language
    barriers. Even though I had flow data for only three plants out of dozens around
    the world, flow analysis identified the sources in about 15 minutes and spared
    most of those meetings.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 你最好的应对策略是尽快找到蠕虫的源头。例如，在2009年春季，我的雇主的安全系统开始发出关于Conficker病毒感染尝试的警告。在一个拥有数万台桌面的全球公司中，手动识别病毒源头可能需要无数的人时，并需要跨越多个时区和多种语言障碍的合作。尽管我只有全球数十个工厂中的三个工厂的流量数据，但流量分析在约15分钟内就确定了源头，并避免了大多数会议。
- en: 'To find a worm, first identify the worm''s propagation method. A few minutes
    on Google tells me that Conficker spreads through Microsoft''s file-sharing port,
    on TCP/445\. The worm probes every IP on its network to identify Windows hosts
    and infects any it finds. This is unusual behavior: Although many servers will
    receive connections from many different hosts, very few systems will try to reach
    every other host on a network.'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 要找到蠕虫，首先确定蠕虫的传播方式。几分钟的谷歌搜索告诉我，Conficker通过微软的文件共享端口，在TCP/445上传播。蠕虫探测其网络上的每个IP以识别Windows主机，并感染它找到的任何主机。这种行为是不寻常的：尽管许多服务器会从许多不同的主机接收连接，但很少会有系统试图连接到网络上的每个其他主机。
- en: 'You can use the `ip-source-address-destination-count` report to count the number
    of hosts a system tries to contact, as shown here:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用`ip-source-address-destination-count`报告来统计系统尝试联系的主机数量，如下所示：
- en: '[PRE15]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: As you can see, I begin at ❶ with the flow files for the time window when the
    worm attacked my local network. I then search at ❷ only for the flows going to
    or from port 445, and I run these flows through the `ip-source-address-destination-count`
    report at ❸. Unnecessary fields are removed at ❹ to make the output easier to
    read.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 正如你所见，我从❶开始，查找的是蠕虫攻击我的本地网络的时间窗口内的流量文件。然后我在❷处仅搜索流向或来自端口445的流量，并在❸处通过`ip-source-address-destination-count`报告运行这些流量。为了使输出更易于阅读，❹处移除了不必要的字段。
- en: Note
  id: totrans-97
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Remember that this report and its counterpart, `ip-destination-address-source-count`,
    do not have built-in sorting functions. You must sort these externally, as shown
    at ❺. (One consequence of sorting externally is that the header for each column
    appears at the bottom of the list. I've restored the header to the top of this
    example to make it easier to understand. Do the same for your managers.)
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，这个报告及其对应报告`ip-destination-address-source-count`没有内置的排序功能。你必须在外部进行排序，如下❺所示。（外部排序的一个后果是，每个列的标题出现在列表的底部。我已经将这个示例的标题恢复到了顶部，以便更容易理解。对你的经理们也这样做。）
- en: 'This report reveals two hosts that try to connect to a remarkably large number
    of other hosts: 172.17.84.14 connected or tried to connect to 1,851 different
    hosts on my data center network, as shown at ❻. Because the network has fewer
    than 500 active computers, this is immediately suspicious. The second host shown
    at ❼ has a similar profile, while the third at ❽ is my corporate file server,
    which has many fewer connections.'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 该报告揭示了两个试图连接到大量其他主机的计算机：172.17.84.14在我的数据中心网络上连接或尝试连接了1,851个不同的主机，如下❻所示。由于网络中少于500台活跃的计算机，这立即引起了怀疑。❽处显示的第二个主机具有类似的配置，而❽处的第三个是我的公司文件服务器，它的连接数要少得多。
- en: These two machines turned out to be on a test network in a different hemisphere.
    Without flow analysis, I could never have identified these machines. With analysis,
    an email documenting the results got me out of having to attend any of the follow-up
    meetings.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 这两台机器实际上位于不同半球的一个测试网络上。没有流量分析，我永远无法识别这些机器。有了分析，一份记录结果的电子邮件让我免去了参加任何后续会议的需要。
- en: Traffic to Illegal Addresses
  id: totrans-101
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 流向非法地址的流量
- en: Is your firewall misconfigured? Yes. Yes, it is. You just don't know it.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 你的防火墙配置错误吗？是的。是的，它是。你只是不知道而已。
- en: Most firewalls use Network Address Translation (NAT) to connect hosts on private
    addresses to ones on the public Internet. If you have a complicated firewall policy
    and a firewall platform that encourages complicated or downright bizarre NAT rules,^([[12](#ftn.CHP-9-FN-2)])
    it's easy to accidentally leak untranslated addresses onto your Internet-facing
    network. If you're running multiple firewalls using one policy, it becomes almost
    inevitable. Your ISP should filter internal addresses from your Internet circuits,
    so any traffic with private IP addresses on your external network is coming from
    you (or you and your ISP need to have a little talk).
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数防火墙使用网络地址转换（NAT）将私有地址上的主机连接到公共互联网上的地址。如果您有一个复杂的防火墙策略，并且防火墙平台鼓励复杂或甚至古怪的NAT规则^([[12](#ftn.CHP-9-FN-2)]),
    那么不小心将未翻译的地址泄露到您的面向互联网的网络中很容易。如果您正在使用一个策略运行多个防火墙，这几乎不可避免。您的ISP应该从您的互联网电路中过滤内部地址，因此任何在您的外部网络上带有私有IP地址的流量都来自您（或者您和您的ISP需要稍微谈谈）。
- en: It's easy to track down traffic from private addresses. First, define a filter
    that includes your internal addresses.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 跟踪来自私有地址的流量很容易。首先，定义一个包括您内部地址的过滤器。
- en: '[PRE16]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Here you identify at ❶ three blocks of IP addresses that are used internally
    and define a filter for them. Next, go to the directory where you store flow records
    for your Internet-facing network, filter for these addresses, and print the results.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，您在❶处确定了三个用于内部的三块IP地址，并为它们定义了一个过滤器。接下来，转到您存储面向互联网网络流量记录的目录，对这些地址进行过滤，并打印结果。
- en: '[PRE17]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Each of these flows passed through a firewall rule with an improper NAT configuration.
    In other words, these rules are broken, and they will impact you in unexpected
    ways. For example, the line at ❶ shows a host trying to send email from a private
    address. The connection never completes, of course. If this is your backup mail
    exchanger, you'll have a nasty surprise when your primary breaks. Similarly, at
    ❷ you also have a host trying to make name service queries from a private address.
    Fixing these in advance will reduce future outages.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 每个这些流量都通过了具有不正确NAT配置的防火墙规则。换句话说，这些规则是错误的，并且它们将以意想不到的方式影响您。例如，❶行显示一个主机试图从一个私有地址发送电子邮件。当然，连接永远不会完成。如果这是您的备用邮件交换机，当您的首选邮件交换机出现问题时，您将会有一个令人不快的惊喜。同样，在❷处，您也有一个主机试图从一个私有地址进行域名服务查询。提前修复这些问题将减少未来的中断。
- en: Traffic to Nonexistent Hosts
  id: totrans-109
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 非存在主机的流量
- en: Theoretically, removing network servers should reduce network usage. Unfortunately,
    that's not always true.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 理论上，移除网络服务器应该减少网络使用。不幸的是，这并不总是正确的。
- en: At one point, certain desktops on my employer's corporate network would not
    become useful until more than five minutes after the user entered their username
    and password. This is slow even for commodity operating systems. Although not
    every workstation was affected, most of those that were impacted were at remote
    locations where I lacked diagnostic equipment. I had a user try one of these workstations
    at a specific time and then checked the flow records to see whether that workstation
    had tried to contact anything at my data center during that window.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 在某个时候，我雇主公司网络上的某些桌面电脑在用户输入用户名和密码五分钟之后才会变得有用。即使是普通操作系统，这也太慢了。尽管并非每个工作站都受到影响，但受影响的大部分工作站都在我缺乏诊断设备的远程位置。我让一个用户在特定时间尝试了一个这样的工作站，然后检查流量记录，看看该工作站是否在窗口期间尝试联系我的数据中心中的任何东西。
- en: As it turned out, most of the traffic from that workstation during that time
    was trying to reach my Novell login server, which had been turned off a few days
    before. The workstation still had the client installed, however. Apparently the
    Novell client software insisted on trying to contact the login server even though
    it had been told to shut down. Removing the Novell client from that client resolved
    the slow login issues.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 结果表明，在那个时间段内，那个工作站的大部分流量都在尝试连接我的Novell登录服务器，该服务器几天前已被关闭。然而，工作站仍然安装了客户端。显然，Novell客户端软件坚持尝试联系登录服务器，尽管它被告知要关闭。从那个客户端中移除Novell客户端解决了缓慢登录的问题。
- en: With one problem identified, I next used FlowGrapher to diagram traffic from
    that remote plant to the disconnected server's IP address. For two hours every
    morning, this traffic consumed almost 25 percent of the plant's network connection.
    Although removing the disabled client had previously been considered unnecessary,
    this evidence changed people's minds.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 在确定了一个问题后，我接下来使用FlowGrapher绘制了从那个远程工厂到断开连接的服务器IP地址的流量图。每天早上两个小时，这种流量几乎消耗了工厂网络连接的25%。尽管之前认为移除禁用客户端是不必要的，但这个证据改变了人们的想法。
- en: Strictly speaking, this wasn't a network problem, but diagnosing it required
    involvement by a network administrator and resolving it reduced the number of
    network complaints. And remember, all a network engineer wants is for his users
    to shut up.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 严格来说，这不是一个网络问题，但诊断它需要网络管理员的参与，而解决问题减少了网络投诉的数量。记住，网络工程师想要的只是让他的用户闭嘴。
- en: '* * *'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[12](#CHP-9-FN-2)]) (Cough.) Checkpoint. (Cough.)
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[12](#CHP-9-FN-2)]) (咳嗽。) 检查点。(咳嗽。)
- en: Afterword
  id: totrans-117
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 后记
- en: I'm certain that most of you get along fabulously with each and every one of
    your co-workers, your work environment is a delight and a joy, and your IT group
    is a seamless, cohesive team without bitter bickering or belabored backbiting.
    Those of you unfortunate enough to work in a less supportive environment should
    read this.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 我确信你们中的大多数人都能与每一位同事相处得非常好，你们的工作环境令人愉快，充满乐趣，你们的IT团队是一个无缝、团结的团队，没有恶意的争吵或痛苦的诽谤。对于那些在不太支持的环境中工作的人来说，应该读一读这篇文章。
- en: Flow analysis will change your problem-solving capacities. You'll solve odd
    issues that have haunted your network for years. You'll conclusively show that
    problems that everyone has comfortably blamed on the network are actually server
    or software problems. You'll even be able to dig up a whole list of weird problems
    that other people are causing on the network. All of this will quickly change
    your relationship with your co-workers and management.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 流量分析将改变你的问题解决能力。你将解决那些多年来一直困扰你网络的奇怪问题。你将最终证明，那些大家都舒适地归咎于网络的问题实际上是服务器或软件问题。你甚至能够挖出一长串其他人正在网络上造成的问题。所有这些都会迅速改变你与同事和管理层的关系。
- en: Systems administration and network engineers have a long tradition of being
    difficult to work with; we even have archetypes like the Bastard Operator from
    Hell. Now that you have evidence, it's tempting to make those who doubted you
    suffer for their intransigence. Now that you have evidence, though, you can afford
    to be generous. When something is your problem, admit it. When you show that something
    isn't your problem, however, say something like "Here's the evidence identifying
    the problem. Although this is clearly not a network issue, I'm happy to help you
    solve your problem." Admittedly, this is much less satisfying than using words
    like "you loser." Unlikely as it seems, a positive attitude can change co-worker
    and management attitudes about the network staff and can improve your life.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 系统管理和网络工程师有与难以共事的传统；我们甚至有像地狱里的混蛋操作员这样的原型。现在你有证据了，你可能会想让你那些怀疑你的人为他们的固执付出代价。然而，现在你有证据了，你可以表现得更加宽容。当你遇到问题时，承认它。当你表明某件事不是你的问题时，然而，可以说些像“这里有证据表明问题。尽管这显然不是网络问题，但我很高兴帮助你解决问题。”诚然，这比用“你
    loser”这样的词要令人满意得多。虽然看起来不太可能，但积极的态度可以改变同事和管理层对网络员工的态度，并改善你的生活。
- en: And if not, well, at least you'll know for certain that it's not your problem.
    And it's *never* too late to call someone a doofus.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 如果不是这样，至少你可以确信这不是你的问题。而且，永远不晚于称呼某人傻瓜。
