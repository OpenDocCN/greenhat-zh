- en: 'Chapter 11. CITRIX XENSERVER: XEN FOR THE ENTERPRISE'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第11章。思杰XenServer：面向企业的Xen
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages333191.png.jpg)'
  id: totrans-1
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages333191.png.jpg)'
- en: Until now, we've focused exclusively on the open source version of Xen. However,
    that's not the only choice available. The Xen guys have also released a packaged
    version of Xen that's aimed at turning Xen into a product that is suitable for
    the enterprise.^([[60](#ftn.CHP-11-FNOTE-1)])
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 一直以来，我们只关注Xen的开源版本。然而，这并不是唯一的选择。Xen团队还发布了一个打包的Xen版本，旨在将Xen转变为适合企业的产品。^([[60](#ftn.CHP-11-FNOTE-1)])
- en: One implication that you may have gotten reading between the lines of this book
    is that Xen is still in a state of development. It is, in a word, hackerware.
    It's good 'ware—obviously we think it's stable enough for real people to use every
    day—but it's still a lot of work to set up and get going.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 你在阅读本书时可能已经隐约感觉到，Xen仍然处于开发状态。一句话来说，它是黑客软件。它是好的软件——显然我们认为它足够稳定，可以让真实的人们每天使用——但它仍然需要大量的工作来设置和启动。
- en: There are a couple of reasonable explanations for this state of affairs. Partly
    this is because hackers are not, as a group, very good at finishing things. The
    work to take a product from 90 percent finished to 100 percent finished isn't
    usually difficult, just tedious. Open source is wonderful, but it's not great
    at producing full-on commercial *products*.^([[61](#ftn.CHP-11-FNOTE-2)]) Another
    issue is that Xen, by nature, is invasive and fundamental. One hesitates to use
    words like *paradigm*, but there you have it—virtualization is a different way
    of computing, a different way of thinking about computers, and it requires a lot
    of very polished software support.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这种状况，有几个合理的解释。部分原因是因为黑客作为一个群体，并不擅长完成事情。将产品从90%完成到100%完成的工作通常并不困难，只是有点繁琐。开源软件很棒，但它在生产完整的商业*产品*方面并不出色。^([[61](#ftn.CHP-11-FNOTE-2)])
    另一个问题在于，Xen本质上具有侵入性和基础性。人们犹豫是否使用“范式”这样的词，但就是这样——虚拟化是一种不同的计算方式，一种不同的思考计算机的方式，它需要大量的非常精致的软件支持。
- en: Citrix (who acquired XenSource, the company founded by the original Xen team)
    works to ease the transition by providing this software—creating a software stack,
    developing a certification process, and establishing best practices so that administrators
    can roll out Xen with a minimum of fuss and uncertainty. They work on the open
    source version of Xen and contribute changes to it, but they also do an additional
    level of QA aimed at turning Xen into a product that you can feel comfortable
    trusting with your business.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 思杰（该公司收购了由原始Xen团队创立的XenSource公司）通过提供这种软件来简化过渡——创建软件堆栈，开发认证流程，并建立最佳实践，以便管理员可以以最小的麻烦和不确定性推出Xen。他们致力于Xen的开源版本，并向其贡献更改，但他们还进行了一个额外的质量保证级别，旨在将Xen转变为你可以放心信任你的业务的产物。
- en: You may ask how this is possible, considering that Xen is still under the GPL.
    Citrix can do this while obeying the terms of Xen's license because Xen's client/server
    architecture and modular design allow them to extend the basic hypervisor, adding
    new features as modules and userspace processes that work in conjunction with
    the GPL software. Citrix uses the open source hypervisor with open source Linux,
    plus added modules and proprietary control software to provide an integrated distribution
    of Xen, much like a traditional Linux distro but with a strong emphasis on virtualization.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会问这是如何可能的，考虑到Xen仍然处于GPL协议之下。思杰可以这样做，同时遵守Xen许可条款，因为Xen的客户端/服务器架构和模块化设计允许他们扩展基本虚拟机管理程序，添加作为模块和与GPL软件协同工作的用户空间进程的新功能。思杰使用开源虚拟机管理程序与开源Linux相结合，加上额外的模块和专有控制软件，提供Xen的集成发行版，就像传统的Linux发行版一样，但强调虚拟化。
- en: Citrix's Xen Products
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 思杰的Xen产品
- en: The Citrix product consists of two components, XenServer and XenEssentials.
    XenServer is the hypervisor and basic management tools, and it is available for
    free.^([[62](#ftn.CHP-11-FNOTE-3)]) XenEssentials is a suite of utilities that
    cost money.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 思杰的产品由两个组件组成，XenServer和XenEssentials。XenServer是虚拟机管理程序和基本管理工具，它是免费的。^([[62](#ftn.CHP-11-FNOTE-3)])
    XenEssentials是一套付费的实用程序。
- en: The basic free product is simply called XenServer. XenServer supports most of
    the features of the paid Citrix products, with the same management interface.
    It's aimed at development, test, and noncritical production deployments, as well
    as people who want to test or play with Xen.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 基本免费产品简单地称为XenServer。XenServer支持付费Citrix产品的大多数功能，拥有相同的管理界面。它面向开发、测试和非关键生产部署，以及想要测试或玩转Xen的人。
- en: Citrix's pay product is called Citrix Essentials for XenServer, with various
    levels of licensing. It doesn't have all the features of open source Xen, but
    it has all the features Citrix feels comfortable supporting and some commercial
    product exclusives. Citrix, as far as we can tell, charges as much as the market
    will bear for this version.^([[63](#ftn.CHP-11-FNOTE-4)]) This is, of course,
    subject to change at any time. Negotiate with your Citrix representative, preferably
    in some form of gladiatorial combat.^([[64](#ftn.CHP-11-FNOTE-5)])
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: Citrix的付费产品称为Citrix Essentials for XenServer，具有各种级别的许可。它并不具备开源Xen的所有功能，但它拥有Citrix认为可以舒适支持的所有功能以及一些商业产品的独家功能。据我们所知，Citrix为这个版本收取的金额与市场承受能力相当.^([[63](#ftn.CHP-11-FNOTE-4)])
    当然，这随时可能改变。最好与你的Citrix代表协商，最好是进行某种形式的角斗士战斗.^([[64](#ftn.CHP-11-FNOTE-5)])
- en: By and large, we're going to focus exclusively on the base product and components
    that are available for free.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 总体而言，我们将专注于免费提供的基产品和组件。
- en: '* * *'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[60](#CHP-11-FNOTE-1)]) Sorry, we know, marketing speak. But it is the easiest
    way for us to convey the aim of the product.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[60](#CHP-11-FNOTE-1)]) 我们知道，这是营销术语。但这是我们传达产品目标的最简单方式。
- en: ^([[61](#CHP-11-FNOTE-2)]) This is not to disparage the fine work of the people
    behind polished products we use daily, such as Linux, Mozilla, and Vim. We're
    just saying that the last 10 percent is the most difficult, not that it never
    gets done.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[61](#CHP-11-FNOTE-2)]) 这并不是贬低我们日常使用的精美产品背后的人们的优秀工作，比如Linux、Mozilla和Vim。我们只是说，最后的10%是最困难的，并不是说它永远不会完成。
- en: ^([[62](#CHP-11-FNOTE-3)]) That's free as in beer, as the greybeards say.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[62](#CHP-11-FNOTE-3)]) 正如老人们所说，这是免费的啤酒。
- en: ^([[63](#CHP-11-FNOTE-4)]) We were unable to find coherent pricing information.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[63](#CHP-11-FNOTE-4)]) 我们无法找到连贯的定价信息。
- en: ^([[64](#CHP-11-FNOTE-5)]) After spending weeks trying to get prices for colocation
    out of salespeople, Luke suspects gladiatorial combat would be more pleasant than
    the traditional methods for negotiating price. prgmr.com favors the "the price
    on the website is the price you pay" model.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[64](#CHP-11-FNOTE-5)]) 在花费数周时间试图从销售人员那里获取托管定价信息后，Luke怀疑角斗士战斗会比传统的谈判价格方法更愉快。prgmr.com更喜欢“网站上的价格就是你要支付的价格”模式。
- en: The Benefits of Using Citrix XenServer
  id: totrans-18
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用Citrix XenServer的好处
- en: The XenServer product improves on open source Xen primarily in the area of manageability.
    They've streamlined and automated common tasks while retaining most of the transparency
    of open source Xen.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: XenServer产品在可管理性方面对开源Xen进行了改进。他们在简化并自动化常见任务的同时，保留了开源Xen的大部分透明度。
- en: Ten Minutes to Xen
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 十分钟到达异域
- en: Our model is one where the CD enters the drive and the computer is a better
    machine as a result (in ten minutes or less). That is what XenExpress^([[65](#ftn.CHP-11-FNOTE-6)])
    is all about.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的模式是CD进入驱动器，计算机因此成为一台更好的机器（在十分钟或更短的时间内）。这正是XenExpress^([[65](#ftn.CHP-11-FNOTE-6)])的全部内容。
- en: — Frank Artale, *XenSource*
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: — 弗兰克·阿塔莱，*XenSource*
- en: One of the best demonstrations of this is in what Citrix calls *Xen in ten minutes*
    or *Ten to Xen*. They've dramatically simplified the bootstrap aspect of Xen,
    where you have to install a dom0 OS and modify it to work nicely with Xen's control
    software and the hypervisor.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 这其中最好的演示之一就是Citrix所称之为的“十分钟Xen”或“十到Xen”。他们极大地简化了Xen的引导部分，在这一部分中，你需要安装一个dom0操作系统，并修改它以便与Xen的控制软件和虚拟机管理程序良好地协同工作。
- en: 'Citrix reasons that you shouldn''t actually be *doing* anything with the dom0,
    other than controlling domUs. Therefore, the product installs a basic Linux OS
    that includes only the components needed to run Xen: a kernel, a shell, some libraries,
    a text editor, Python, syslog, SSH (and so forth), and the Xen software. In this
    approach, software that''s not needed to control Xen, such as the daemons that
    provide a server''s *raison d''etre*, should be installed in a domU. Of course,
    it''s still Linux—based on CentOS, in fact—and there''s nothing to stop you from
    installing other software. However, we recommend sticking with Citrix''s approach
    and keeping your core virtualization server uncluttered.'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: Citrix 认为，你实际上不应该对 dom0 进行任何操作，除了控制 domUs。因此，该产品安装了一个基本的 Linux 操作系统，其中只包含运行
    Xen 所需的组件：一个内核、一个外壳、一些库、一个文本编辑器、Python、syslog、SSH（等等），以及 Xen 软件。在这种方法中，不需要控制 Xen
    的软件，例如提供服务器存在理由的守护进程，应该安装在 domU 中。当然，它仍然是基于 Linux 的——实际上是基于 CentOS 的——而且没有任何阻止你安装其他软件的东西。然而，我们建议坚持使用
    Citrix 的方法，并保持你的核心虚拟化服务器整洁。
- en: The basic package does, in fact, take about 10 minutes to install, as advertised.
    Be sure to get the supplementary Linux pack, which includes Debian templates and
    supporting tools for Linux VMs. When that's done, it's a simple matter to create
    domUs from the included Debian template or from install media.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 基本包实际上确实需要大约 10 分钟来安装，正如广告中所说的那样。务必获取补充的 Linux 包，其中包含 Debian 模板和 Linux 虚拟机的支持工具。完成这些后，从包含的
    Debian 模板或安装介质创建 domUs 就是一件简单的事情。
- en: Citrix XenServer has other advantages. Perhaps most important, it feels much
    more centralized than the open source Xen. All of the decisions that we've been
    writing about—storage, networking, and so forth—are handled in a centralized way,
    using a consistent interface. Where possible, they've made sensible default decisions
    for you. They're not necessarily going to be the best for all situations, but
    at least they'll be reasonable for Xen's purposes.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: Citrix XenServer 还有其他优点。也许最重要的是，它感觉比开源 Xen 更集中。我们一直在讨论的所有决策——存储、网络等等——都是以集中的方式处理的，使用一致的界面。在可能的情况下，他们已经为你做出了合理的默认决策。这些决策不一定适用于所有情况，但至少对于
    Xen 的用途来说将是合理的。
- en: Take storage, for example. Citrix uses the same architecture as open source
    Xen, using unmodified Linux drivers in the dom0 to access physical devices. They
    layer LVM on top of this to abstract physical storage and increase flexibility,
    as we've outlined elsewhere. Citrix builds on these open source tools by offering
    a way of administering storage through the same GUI as the more Xen-specific aspects
    of the system, allowing you to focus on virtual machines rather than obscure disk-administration
    commands. If you like, you can still use the familiar commands. Citrix's Xen product
    isn't out to reinvent the wheel or obfuscate the basic workings of the system;
    they've just provided an alternative to make common tasks a little easier.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 以存储为例。Citrix 使用与开源 Xen 相同的架构，在 dom0 中使用未经修改的 Linux 驱动程序来访问物理设备。他们在其上叠加 LVM 以抽象物理存储并增加灵活性，正如我们在其他地方概述的那样。Citrix
    通过提供一种通过与系统更具体的 Xen 特性相同的 GUI 来管理存储的方式，来构建这些开源工具，这样你可以专注于虚拟机而不是晦涩的磁盘管理命令。如果你愿意，你仍然可以使用熟悉的命令。Citrix
    的 Xen 产品并不是要重新发明轮子或使系统的基本工作原理变得晦涩；他们只是提供了一个替代方案，使常见任务变得稍微容易一些。
- en: '* * *'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[65](#CHP-11-FNOTE-6)]) XenExpress was the name of the free product when
    XenSource was XenSource, before Citrix bought them.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[65](#CHP-11-FNOTE-6)]) 当 XenSource 还是 XenSource 时，XenExpress 是免费产品的名称，在
    Citrix 收购他们之前。
- en: The Disadvantages of Using Citrix XenServer
  id: totrans-30
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Citrix XenServer 的缺点
- en: Even with the high-end Essentials product, there's a trade-off between stability
    and features. Citrix exposes only those hypervisor features that they feel are
    mature enough to use in a production environment. For example, migration was added
    a couple of years after it had been introduced in the open source version.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 即使是高端 Essentials 产品，稳定性和功能之间也存在权衡。Citrix 只公开他们认为足够成熟，可以在生产环境中使用的虚拟化功能。例如，迁移是在开源版本推出两年后添加的。
- en: There's also no easy way of moving VMs between open source and commercial Xen
    at the moment. (You can, of course, move VMs manually by using the lower-level
    methods outlined in [Chapter 9](ch09.html "Chapter 9. XEN MIGRATION").) If you
    standardize on open source or commercial Xen, it may be difficult to reverse that
    decision later, although the Open Virtualization Format (OVF), which has some
    support from open source tools,^([[66](#ftn.CHP-11-FNOTE-7)]) promises to improve
    the situation.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 目前还没有简单的方法在开源Xen和商业Xen之间迁移虚拟机。（当然，你可以通过使用第9章中概述的底层方法手动迁移虚拟机。）如果你标准化使用开源或商业Xen，以后可能很难改变这个决定，尽管Open
    Virtualization Format (OVF)（它得到了一些开源工具的支持，^([[66](#ftn.CHP-11-FNOTE-7)]))承诺将改善这种情况。
- en: 'Beyond that, open source is still an ideological issue. Some people use it
    whenever possible; some avoid it as a pestilence. We use the open source product
    because it''s good enough for us and because apparently our time is worthless.
    Citrix offers a straightforward transaction: Give them money and they''ll give
    you Xen as a product, rather than Xen as heavily customizable hackerware. Step
    on board and take your chances.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 除此之外，开源仍然是一个意识形态问题。有些人尽可能使用它；有些人则像躲避瘟疫一样避免它。我们使用开源产品，因为它对我们来说足够好，而且显然我们的时间是毫无价值的。Citrix提供了一种直接的交易：给他们钱，他们就会以Xen产品的形式给你Xen，而不是高度可定制的黑客软件。登上船并承担你的风险。
- en: '* * *'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[66](#CHP-11-FNOTE-7)]) [http://open-ovf.wiki.sourceforge.net/](http://open-ovf.wiki.sourceforge.net/)
    is a good place to start.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[66](#CHP-11-FNOTE-7)]) [http://open-ovf.wiki.sourceforge.net/](http://open-ovf.wiki.sourceforge.net/)
    是一个不错的起点。
- en: Getting Started
  id: totrans-36
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 入门
- en: Having said all that, the best way to get started with Citrix's XenServer is
    probably just to try the product and see if you like it. The entry-level version
    is available for free. You can download it at [http://www.citrix.com/xenserver/getitfree/](http://www.citrix.com/xenserver/getitfree/)
    and upgrade it at any time simply by entering a license key. Besides, they're
    telling the truth when they say it takes about 10 minutes to install, so why not?
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 说了这么多，开始使用Citrix的XenServer的最佳方式可能就是尝试这个产品，看看你是否喜欢它。入门级版本是免费的。你可以在 [http://www.citrix.com/xenserver/getitfree/](http://www.citrix.com/xenserver/getitfree/)
    下载它，并通过输入许可证密钥在任何时候升级它。此外，他们所说的安装大约需要10分钟是真实的，所以为什么不试试呢？
- en: Prerequisites
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 先决条件
- en: 'First, check to make sure that you meet the minimum system requirements:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，检查以确保你满足最低系统要求：
- en: 64-bit CPU, that is, AMD Opteron, Athlon 64, Phenom, or whatever else AMD's
    marketing department has come up with, or most Intel Xeons of the last few years,
    as well as the Core 2 (but not Core).
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 64位CPU，即AMD Opteron、Athlon 64、Phenom或AMD市场营销部门想出的任何其他东西，以及过去几年中的大多数Intel Xeon，以及Core
    2（但不包括Core）。
- en: A certain amount of memory, depending on how many virtual machines you want.
    Citrix's minimum is 1GB, which sounds reasonable to us.
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据你想要多少虚拟机，需要一定量的内存。Citrix的最低要求是1GB，这对我们来说听起来是合理的。
- en: Sufficient disk space. The XenServer backend will take 8GB, leaving the rest
    available for domUs. Of course, you can also use network storage for VMs.
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 足够的磁盘空间。XenServer后端将占用8GB，其余的可用空间留给domUs。当然，你也可以为虚拟机使用网络存储。
- en: HVM support is required if you want to run Windows domUs, but otherwise it's
    optional.
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你想要运行Windows domUs，则需要HVM支持，但否则它是可选的。
- en: Installing Citrix XenServer
  id: totrans-44
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装Citrix XenServer
- en: As we've mentioned, Citrix's product is a complete system; install it like any
    other OS. For us, that meant downloading the ISO, burning it to a CD, and booting
    our target machine from the CD. We also grabbed the *Linux Guest Support disc*,
    which includes support for Linux guests.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们提到的，Citrix的产品是一个完整的系统；像安装任何其他操作系统一样安装它。对我们来说，这意味着下载ISO文件，将其烧录到CD上，并从CD引导目标机器。我们还抓取了
    *Linux Guest Support disc*，它包括对Linux虚拟机的支持。
- en: The machine goes through a nongraphical install and asks some standard questions
    about keyboard, time, and network setup—the usual. Compared to a normal Linux
    install, it's incredibly spare and streamlined because the product itself has
    the single focus of virtualization. For example, there's no opportunity to set
    up partitioning. At the end, it prompted us to insert supplementary CDs, so we
    put in the Linux support disc.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 机器将进行非图形安装，并询问一些关于键盘、时间和网络设置的常规问题——通常是这些。与正常的Linux安装相比，它极其简洁和精简，因为该产品本身只有一个虚拟化的焦点。例如，没有设置分区的机会。最后，它提示我们插入补充CD，所以我们放进了Linux支持CD。
- en: Ten minutes and one reboot later, we're staring at a screen that advises us
    to log in via the administration frontend, XenCenter.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 十分钟后，一次重启后，我们面对一个屏幕，建议我们通过管理前端 XenCenter 登录。
- en: USING A SERIAL CONSOLE WITH XENSERVER
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 XENSERVER 的串行控制台
- en: We would never consider using a server without serial console access. Citrix's
    Xen product, although it doesn't support a serial console out of the box, can
    support a serial console with a little configuration.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 我们永远不会考虑使用没有串行控制台访问权限的服务器。尽管 Citrix 的 Xen 产品默认不支持串行控制台，但通过一些配置可以支持串行控制台。
- en: 'It''s a little more difficult than you''d expect because Citrix uses Extlinux
    to boot rather than GRUB. However, Extlinux''s configuration is similar. The only
    file we need to adjust is */boot/extlinux.cfg*. Note that we specify the options
    to Xen and the Linux kernel on the same long line:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 这比您预期的要困难一些，因为 Citrix 使用 Extlinux 启动而不是 GRUB。然而，Extlinux 的配置类似。我们唯一需要调整的文件是
    */boot/extlinux.cfg*。请注意，我们在同一长行上指定了 Xen 和 Linux 内核的选项：
- en: '[PRE0]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Because this is basically CentOS, it already has ttyS0 listed in */etc/inittab*
    with a getty. Reboot and enjoy the serial console.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 因为这基本上是 CentOS，它已经在 */etc/inittab* 中列出了 ttyS0 并带有 getty。重启并享受串行控制台。
- en: 'Citrix''s Xen GUI: XenCenter'
  id: totrans-53
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Citrix 的 Xen 图形界面：XenCenter
- en: We are, of course, fond of following advice.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 我们当然喜欢遵循建议。
- en: Citrix's system, like the open source version of Xen, uses a client/server architecture
    to control the virtual machines. Unlike the open source version, they include
    a graphical Xen console that can automate many of the boring details of running
    Xen.^([[67](#ftn.CHP-11-FNOTE-8)])
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: Citrix 的系统，就像 Xen 的开源版本一样，使用客户端/服务器架构来控制虚拟机。与开源版本不同，它们包括一个图形 Xen 控制台，可以自动化运行
    Xen 的许多无聊细节.^([[67](#ftn.CHP-11-FNOTE-8)])
- en: In fact, the package includes both a GUI and a command-line utility. As of version
    5, the GUI is a Windows application called XenCenter, and the command-line tool
    is called `xe`. They offer roughly the same functionality, but the XenCenter GUI
    has more features, and `xe` supports certain more arcane operations. Citrix suggests
    using `xe` for scripted (or otherwise automated) operation and the XenCenter for
    interactive administration. There's also a character-based menu system called
    `xsconsole` that normally runs on the Xen server's physical console, but which
    can be run in any shell session in dom0\. It provides access to many common operations.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 事实上，该软件包包括一个图形界面工具和一个命令行工具。截至版本 5，图形界面是一个名为 XenCenter 的 Windows 应用程序，而命令行工具被称为
    `xe`。它们提供大致相同的功能，但 XenCenter 图形界面有更多功能，而 `xe` 支持某些更复杂的操作。Citrix 建议使用 `xe` 进行脚本（或自动化）操作，并使用
    XenCenter 进行交互式管理。还有一个基于字符的菜单系统，称为 `xsconsole`，通常在 Xen 服务器的物理控制台上运行，但也可以在 dom0
    的任何 shell 会话中运行。它提供了对许多常见操作的访问。
- en: You'll need a Windows machine for the GUI client. Although version 3.2 and previous
    versions were written in Java, and are therefore cross-platform, versions 4.0
    and above require the .NET-based XenCenter. Previous versions of the client will
    not be able to connect to the XenServer host. The requirement that the client
    runs under Windows, of course, also means that you can't run the client directly
    on the machine that's running Citrix's product.^([[68](#ftn.CHP-11-FNOTE-9)])
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要一个 Windows 机器来运行 GUI 客户端。虽然版本 3.2 及之前的版本是用 Java 编写的，因此是跨平台的，但版本 4.0 及以上版本需要基于
    .NET 的 XenCenter。之前的客户端将无法连接到 XenServer 主机。客户端必须在 Windows 下运行的要求当然也意味着您不能直接在运行
    Citrix 产品的机器上运行客户端.^([[68](#ftn.CHP-11-FNOTE-9)])
- en: Unlike the open source version of Xen, communication between the tools and hypervisor
    doesn't go through `xend`. Instead, both the command-line and graphical tools
    connect to the `xapi` service on the Xen server via TCP/IP, using SSL to encrypt
    traffic.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 与 Xen 的开源版本不同，工具和虚拟机管理程序之间的通信不通过 `xend` 进行。相反，命令行工具和图形工具都通过 TCP/IP 连接到 Xen 服务器上的
    `xapi` 服务，并使用 SSL 加密流量。
- en: '* * *'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[67](#CHP-11-FNOTE-8)]) The XenCenter cannot connect to open source Xen.
    We tried.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[67](#CHP-11-FNOTE-8)]) XenCenter 无法连接到开源 Xen。我们尝试过。
- en: ^([[68](#CHP-11-FNOTE-9)]) Although you could run the client inside of a Windows
    install under the XenSource product, it does raise an interesting chicken-and-egg
    problem.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[68](#CHP-11-FNOTE-9)]) 尽管您可以在 XenSource 产品下 Windows 安装中运行客户端，但这确实引发了一个有趣的“先有鸡还是先有蛋”的问题。
- en: Administering VMs with the XenCenter
  id: totrans-62
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 XenCenter 管理虚拟机
- en: Having successfully installed both the Citrix server and the XenCenter client,
    we started our nice, shiny GUI frontend, told it about our XenServer, and logged
    in. The login process is straightforward and immediately drops you into a comprehensive
    two-panel interface, as shown in [Figure 11-1](ch11s06.html#xencenter_console
    "Figure 11-1. XenCenter console").
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 成功安装了 Citrix 服务器和 XenCenter 客户端后，我们启动了漂亮、闪亮的 GUI 前端，告诉它我们的 XenServer，并登录。登录过程简单直接，立即将您带入一个综合的双面板界面，如图
    [图 11-1](ch11s06.html#xencenter_console "图 11-1. XenCenter 控制台") 所示。
- en: The left panel displays hosts, both physical and virtual, in a tree view. On
    the right side, we can interact with the selected VM or change its parameters
    via the tabs at the top. Most tasks are broken out into a wizard-based interface.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 左侧面板以树形视图显示物理和虚拟主机。在右侧，我们可以通过顶部的选项卡与选定的虚拟机交互或更改其参数。大多数任务都分解为基于向导的界面。
- en: These tasks are based on a concept of *lifecycle management*; you can create
    VMs, edit them, and destroy them, all by clicking through a series of dialog boxes.
    The user interface aims to make these steps, especially creation, as easy as possible;
    after all, part of the attraction of virtual computing appliances is that it's
    easy to add more machines or scale back as necessary.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 这些任务基于 *生命周期管理* 的概念；您可以通过一系列对话框创建虚拟机、编辑它们以及销毁它们。用户界面旨在使这些步骤，尤其是创建，尽可能简单；毕竟，虚拟计算设备的一个吸引力就是可以轻松添加更多机器或按需缩减。
- en: '![XenCenter console](httpatomoreillycomsourcenostarchimages333233.png.jpg)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![XenCenter 控制台](httpatomoreillycomsourcenostarchimages333233.png.jpg)'
- en: Figure 11-1. XenCenter console
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11-1. XenCenter 控制台
- en: Installing DomU Images
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装 DomU 映像
- en: 'XenServer offers several install methods: First, you can install from the included
    Debian Etch template. Second, you can install a supported distro using a template
    and distro-specific installer. Third, there is the HVM install using emulated
    devices. Finally, we have physical-to-virtual conversion using the P2V tool.'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: XenServer 提供了多种安装方法：首先，您可以从包含的 Debian Etch 模板安装。其次，您可以使用模板和特定发行版的安装程序安装受支持的发行版。第三，有使用仿真设备的
    HVM 安装。最后，我们有使用 P2V 工具的物理到虚拟转换。
- en: The Debian install is the fastest and easiest, but it's the least flexible.
    Templated installation is a good option, allowing PV installs of a good variety
    of Linux distros, though not all of them. The HVM install works well for everything
    but requires a machine that supports HVM and results in a domain running in HVM
    mode (which may be suboptimal, depending on your application). P2V allows you
    to clone an existing hardware-based Linux installation and to create templates
    based on that existing system, but it is inconvenient and works with only a few
    older distros.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: Debian 安装是最快、最简单的，但它的灵活性最低。模板安装是一个不错的选择，允许 PV 安装多种 Linux 发行版，尽管不是全部。HVM 安装对几乎所有东西都有效，但需要支持
    HVM 的机器，并导致在 HVM 模式下运行的域（这可能会根据您的应用程序而次优）。P2V 允许您克隆现有的基于硬件的 Linux 安装，并基于该现有系统创建模板，但它不方便，并且仅与少数较旧的发行版兼容。
- en: Installing from the Debian Templates
  id: totrans-71
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 从 Debian 模板安装
- en: The easiest way to install a VM is to use the prepopulated Debian Etch template.
    This template is a preconfigured basic install, designed to make starting a Xen
    instance almost a one-click affair. (There is also a Debian Lenny template, but
    it is an installer, not a fully populated instance.)
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 安装虚拟机最简单的方法是使用预填充的 Debian Etch 模板。此模板是一个预配置的基本安装，旨在使启动 Xen 实例几乎成为一键操作。（还有一个
    Debian Lenny 模板，但它是一个安装程序，而不是一个完全填充的实例。）
- en: To install from a template, log in to the Xen host using the graphical interface,
    select the XenServer from the list in the left panel of the screen (it should
    be the first entry), right-click it, and select **New VM**. It will pop up a wizard
    interface that allows you to configure the machine. Select the Debian Etch template.
    Answer the questions about RAM and disk space (the defaults should be fine), click
    **Finish**, and it'll create a guest.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 要从模板安装，请使用图形界面登录到 Xen 主机，从屏幕左侧面板的列表中选择 XenServer（应该是第一个条目），右键单击它，然后选择 **新建虚拟机**。它将弹出一个向导界面，允许您配置该机器。选择
    Debian Etch 模板。回答有关 RAM 和磁盘空间的问题（默认值应该可以），点击 **完成**，它将创建一个虚拟机。
- en: After the guest boots, it performs some first-boot configuration, then starts
    as a normal paravirtualized Xen instance, with the text console and graphical
    console already set up and ready to work with, as shown in [Figure 11-2](ch11s07.html#the_graphical_console_of_a_freshly_insta
    "Figure 11-2. The graphical console of a freshly installed domU").
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 客户机启动后，它执行一些首次启动配置，然后作为一个正常的半虚拟化Xen实例启动，文本控制台和图形控制台已经设置好并准备好工作，如图11-2所示。
- en: '![The graphical console of a freshly installed domU](httpatomoreillycomsourcenostarchimages333235.png.jpg)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![新安装的domU的图形控制台](httpatomoreillycomsourcenostarchimages333235.png.jpg)'
- en: Figure 11-2. The graphical console of a freshly installed domU
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 图11-2. 新安装的domU的图形控制台
- en: Templated Linux VM
  id: totrans-77
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 模板化Linux VM
- en: To ensure that the VM kernels are compatible with both Xen and the domU operating
    environment, the XenServer product supports installation of only a few RPM-based
    distros and, of course, the already-mentioned Debian VM templates. This support
    is implemented through templates, which are essentially canned VM configurations.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保VM内核与Xen和domU操作系统环境兼容，XenServer产品仅支持安装少数基于RPM的发行版，当然，还包括前面提到的Debian VM模板。这种支持是通过模板实现的，这些模板实际上是预制的VM配置。
- en: Installing a supported distro is almost as easy as installing the Debian templates.
    Go to the **Install** dialog, select your distro and an install source (physical
    media, ISO, or network), enter a name, tweak the parameters if desired, and click
    **Install**.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 安装受支持的发行版几乎和安装Debian模板一样简单。转到**安装**对话框，选择你的发行版和安装源（物理介质、ISO或网络），输入一个名称，如果需要，调整参数，然后点击**安装**。
- en: It's a bit harder to install an unsupported distro. However, the hardware emulation
    mode allows you to install any Linux distro by selecting the **Other Install Media**
    template and booting from the OS CD. From that point, proceed as with a normal
    install on hardware.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 安装不受支持的发行版要困难一些。然而，硬件仿真模式允许你通过选择**其他安装介质**模板并从OS CD引导来安装任何Linux发行版。从那时起，按照硬件上的正常安装进行操作。
- en: When you have the domain installed, you can configure it for paravirtualization
    and then convert it to a template.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 当你安装了域后，你可以将其配置为半虚拟化，然后将其转换为模板。
- en: Windows Install
  id: totrans-82
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Windows安装
- en: Install Windows by selecting the **XenServer** server, selecting **Install VM**
    from the context menu, and then filling in the resulting dialog. Select the template
    that corresponds to the version of Windows that you want to install, and change
    the CD-ROM/DVD setting so that it points to the install media.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 通过选择**XenServer**服务器，从上下文菜单中选择**安装VM**，然后填写出现的对话框来安装Windows。选择与你要安装的Windows版本相对应的模板，并更改CD-ROM/DVD设置，使其指向安装介质。
- en: Click **Install**. Xen will create a new VM. When the machine comes up, it'll
    be in HVM mode, with the HVM BIOS configured to boot from the emulated CD-ROM.
    From that point, you can install Windows in the ordinary way. It's really quite
    a turnkey process; Citrix has put a lot of work into making Windows installation
    easy.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**安装**。Xen将创建一个新的虚拟机。当机器启动时，它将在HVM模式下运行，HVM BIOS配置为从模拟的CD-ROM引导。从那时起，你可以以普通方式安装Windows。这实际上是一个非常简单的过程；Citrix投入了大量工作来简化Windows的安装。
- en: Creating DomU Images with P2V
  id: totrans-85
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用P2V创建DomU镜像
- en: The final way of installing is with the P2V install tool, short for *physical
    to virtual*. The tool creates domU images from physical Linux boxes, allowing
    you to install domUs on hardware that doesn't support HVM. Unfortunately, the
    P2V tool only supports a small number of Red Hat–like systems. Any other systems
    will cause it to quit with an error.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 安装的最后一种方式是使用P2V安装工具，简称*物理到虚拟*。该工具可以从物理Linux服务器创建domU镜像，允许你在不支持HVM的硬件上安装domU。不幸的是，P2V工具仅支持少数类似Red
    Hat的系统。任何其他系统都会导致它出错并退出。
- en: The tool comes as part of the XenServer install CD. To use it, boot the source
    machine from the XenServer CD. Interrupt the boot and enter **`p2v-legacy`** at
    the prompt if you're virtualizing a 32-bit system, or boot to the installer and
    select the **P2V** option if you're virtualizing a 64-bit system. A series of
    prompts will guide you through network setup and selecting a destination.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 该工具是XenServer安装光盘的一部分。要使用它，从XenServer光盘引导源机器。如果你正在虚拟化32位系统，则在提示符处输入**`p2v-legacy`**中断引导，或者如果你正在虚拟化64位系统，则引导到安装程序并选择**P2V**选项。一系列提示将引导你完成网络设置和选择目标。
- en: Existing filesystems on the machine will be copied and sent to the remote Citrix
    Xen server, which automatically creates configuration files and uses an appropriate
    kernel. Note that the P2V tool will conflate partitions in the copy process. In
    this way it's similar to the tar(1) process that we describe in [Chapter 3](ch03.html
    "Chapter 3. PROVISIONING DOMUS"), with added autoconfiguration magic.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 机器上的现有文件系统将被复制并发送到远程 Citrix Xen 服务器，该服务器自动创建配置文件并使用适当的内核。请注意，P2V 工具在复制过程中会合并分区。这种方式与我们在
    [第 3 章](ch03.html "第 3 章。DOMU 配置") 中描述的 tar(1) 过程类似，增加了自动配置的魔法。
- en: Converting Pre-existing Virtual or Physical Machines with XenConvert
  id: totrans-89
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 XenConvert 转换现有的虚拟或物理机器
- en: If you have virtual machines in the VMware VMDK, Microsoft VHD, or cross-platform
    OVF formats, you can convert them to Xen virtual machines using Citrix's Windows-based
    XenConvert utility. XenConvert will also work on physical Windows machines, similarly
    to the P2V utility.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你拥有 VMware VMDK、Microsoft VHD 或跨平台 OVF 格式的虚拟机，你可以使用基于 Windows 的 Citrix XenConvert
    工具将它们转换为 Xen 虚拟机。XenConvert 也可以在物理 Windows 机器上运行，类似于 P2V 工具。
- en: XenConvert is quite simple to use. First, download the Windows installer from
    Citrix's site, at [http://www.citrix.com/xenserver_xenconvert_free](http://www.citrix.com/xenserver_xenconvert_free).
    Install the package, run the program, and follow the prompts.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: XenConvert 使用起来相当简单。首先，从 Citrix 网站下载 Windows 安装程序，网址为 [http://www.citrix.com/xenserver_xenconvert_free](http://www.citrix.com/xenserver_xenconvert_free)。安装软件包，运行程序，并按照提示操作。
- en: XenServer Tools in the DomU
  id: totrans-92
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DomU 中的 XenServer 工具
- en: When you have a domain installed, you will almost certainly want to install
    the XenServer tools, which improve integration between the domain and the management
    interface. In particular, the tools allow the XenCenter to collect performance
    data from the domU. Under Windows, the Citrix tools also include paravirtualized
    drivers, which bypass the (slow) emulated drivers in favor of Xen-style ring buffers
    and so forth.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 当你安装了域后，你几乎肯定会想安装 XenServer 工具，这些工具可以改善域与管理界面之间的集成。特别是，这些工具允许 XenCenter 从 domU
    收集性能数据。在 Windows 下，Citrix 工具还包括虚拟化驱动程序，它们绕过（速度较慢的）模拟驱动程序，转而使用 Xen 风格的环形缓冲区等。
- en: To install the tools, select the virtual machine in XenCenter, right-click it,
    and choose the **Install XenServer Tools** option from the context menu to switch
    the emulated CD. An alert box will pop up, advising you of the proper steps to
    perform.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 要安装工具，在 XenCenter 中选择虚拟机，右键单击它，然后从上下文菜单中选择 **安装 XenServer 工具** 选项以切换模拟 CD。一个警告框将弹出，提示你执行适当的步骤。
- en: Under Windows, the installer will autorun. Answer the prompts and let it go
    ahead with the install.^([[69](#ftn.CHP-11-FNOTE-10)]) Reboot, selecting the **PV**
    option at the bootloader. Windows will detect and configure your new PV devices.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Windows 下，安装程序将自动运行。回答提示，让它继续安装。^([[69](#ftn.CHP-11-FNOTE-10)]) 重启系统，在引导加载程序中选择
    **PV** 选项。Windows 将检测并配置你的新 PV 设备。
- en: 'With Linux VMs, as the prompt says, perform these commands:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 Linux 虚拟机，如提示所述，执行以下命令：
- en: '[PRE1]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The *install.sh* script will select an appropriate package and install it. Reboot
    and enjoy the utilization graphs.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '*install.sh* 脚本将选择合适的软件包并安装它。重启系统并享受利用图表。'
- en: 'xe: Citrix XenServer''s Command-Line Tool'
  id: totrans-99
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: xe：Citrix XenServer 的命令行工具
- en: Citrix also ships a command-line interface alongside the graphical console.
    This command-line tool is called `xe`, and it's recommended for backups and similar
    automated tasks. In our opinion, it's definitely less pleasant than the XenCenter
    for everyday use. It's probably just our bias, but it also seems more cumbersome
    than the open source equivalent, `xm`.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: Citrix 还提供图形控制台之外的命令行界面。这个命令行工具称为 `xe`，它适用于备份和类似的自动化任务。据我们看来，它在日常使用中可能不如 XenCenter
    那么方便。这可能只是我们的偏见，但它似乎也比开源的等效工具 `xm` 更繁琐。
- en: You can use `xe` either from a separate management host (which can run either
    Windows or Linux) or in local mode directly on the XenServer host.^([[70](#ftn.CHP-11-FNOTE-11)])
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用 `xe` 从单独的管理主机（可以运行 Windows 或 Linux）或直接在 XenServer 主机上以本地模式使用。^([[70](#ftn.CHP-11-FNOTE-11)])
- en: 'Citrix includes `xe` as an RPM on the Linux supplement CD in the *client_install*
    directory. Make sure you have the required stunnel package. In our case, to install
    it on Slackware, we did:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: Citrix 在 Linux 补充 CD 的 *client_install* 目录中包含了 `xe` 作为 RPM。确保你有所需的 stunnel 软件包。在我们的案例中，要在
    Slackware 上安装它，我们执行了以下操作：
- en: '[PRE2]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: When the client is installed on a remote machine, you can run it. Make sure
    to specify `-s`, otherwise it'll assume that you want to connect to the local
    host and fail.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 当客户端安装在远程机器上时，您可以运行它。请确保指定 `-s`，否则它将假设您想连接到本地主机并失败。
- en: '[PRE3]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Whether you're using `xe` locally or remotely, the commands and parameters are
    the same. `xe` is actually a very thin wrapper around the Xen API. It exposes
    almost all the functionality offered by the API, with a corresponding difficulty
    of use. If you run it with the `help --all` command, it outputs a daunting usage
    message, detailing a huge variety of possible actions.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 无论您是在本地还是远程使用`xe`，命令和参数都是相同的。`xe`实际上是对Xen API的一个非常薄的包装。它几乎暴露了API提供的所有功能，但使用起来难度较大。如果您使用`help
    --all`命令运行它，它会输出一个令人畏惧的使用信息，详细说明了大量可能的行为。
- en: Fortunately, we can break these commands into groups. In general, there are
    commands to interact with the host and with virtual machines. There are commands
    to get logging information. There are pool commands. We have commands to administer
    virtual devices such as vifs and vbds.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，我们可以将这些命令分成组。一般来说，有与主机和虚拟机交互的命令。有获取日志信息的命令。有池命令。我们有管理虚拟设备（如vifs和vbds）的命令。
- en: 'Although some of the `xe` commands are similar to `xm` commands, the `xe` syntax
    is a bit more elaborate. The first argument must be a command name, followed by
    any switches, followed by any command parameters, in `name=value` syntax. It looks
    cumbersome, but Citrix has shipped a very nice bash completion setup to make autocomplete
    work well for the `xe`-specific parameters. It even fills in UUIDs. Thus:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然一些`xe`命令与`xm`命令类似，但`xe`的语法稍微复杂一些。第一个参数必须是命令名，然后是任何开关，然后是任何命令参数，使用`name=value`语法。看起来有些繁琐，但Citrix提供了一套非常好的bash自动完成设置，使得自动补全对`xe`特定参数工作得很好。它甚至可以填写UUID。因此：
- en: '[PRE4]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'becomes, with `xe`:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`xe`变为：
- en: '[PRE5]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The documentation and the various recipes that are offered on Citrix's website
    have more advice on using `xe`.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: Citrix网站上的文档和各种提供的食谱提供了更多关于使用`xe`的建议。
- en: XenServer's Disk Management
  id: totrans-113
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: XenServer的磁盘管理
- en: The XenServer software reserves a pair of 4GB partitions for itself, leaving
    the rest of the disk available for domUs. The first partition has the active XenServer
    install. The second partition is ordinarily left blank; however, if the server
    is upgraded, that partition is formatted and used as a complete backup of the
    previous install.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: XenServer软件为自身预留了一对4GB分区，其余磁盘空间可用于domUs。第一个分区包含活动的XenServer安装。第二个分区通常是空的；然而，如果服务器升级，该分区将被格式化并用作之前安装的完整备份。
- en: Warning
  id: totrans-115
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 警告
- en: '*Note that this backup only applies to the dom0 data; the installer will wipe
    domU storage repositories on the disk. The moral? Back up domUs manually before
    upgrading XenSource*.'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '*请注意，此备份仅适用于dom0数据；安装程序将擦除磁盘上的domU存储库。教训？在升级XenSource之前，请手动备份domUs*。'
- en: The rest of the space is put into a volume group, or, as Citrix calls it, a
    *storage repository*. As domUs are created, the server divides the space using
    LVM. The storage setup, for a single disk, can be seen in [Figure 11-3](ch11s07.html#xensource_disk_layout
    "Figure 11-3. XenSource disk layout"). Each additional disk becomes a single PV,
    which is added to the storage pool.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 其余空间被放入一个卷组，或者，如Citrix所说，是一个*存储库*。随着domUs的创建，服务器使用LVM来划分空间。对于单个磁盘的存储设置可以在[图11-3](ch11s07.html#xensource_disk_layout
    "图11-3. XenSource磁盘布局")中看到。每个额外的磁盘成为一个单独的物理卷（PV），并将其添加到存储池中。
- en: '![XenSource disk layout](httpatomoreillycomsourcenostarchimages333237.png.jpg)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![XenSource磁盘布局](httpatomoreillycomsourcenostarchimages333237.png.jpg)'
- en: Figure 11-3. XenSource disk layout
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 图11-3. XenSource磁盘布局
- en: Each LV gets a very long name that uses a UUID (universally unique identifier)
    to associate it with a VM.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 每个逻辑卷（LV）都会得到一个非常长的名称，该名称使用UUID（通用唯一标识符）来将其与虚拟机（VM）关联。
- en: Xen Storage Repositories
  id: totrans-121
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Xen存储库
- en: 'If you log in to the XenServer on the console or via SSH using the root password
    that you entered during the install, you can use standard Linux commands to examine
    the installed environment. To continue our example, you can use the LVM tools:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用在安装过程中输入的root密码通过控制台或SSH登录到XenServer，您可以使用标准的Linux命令来检查已安装的环境。继续我们的例子，您可以使用LVM工具：
- en: '[PRE6]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'However, you''ll usually want to use the Citrix-provided higher-level commands
    because those also update the storage metadata. Equivalently, to list storage
    repositories using `xe`:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，您通常会想使用Citrix提供的更高级的命令，因为这些命令也会更新存储元数据。等效地，要使用`xe`列出存储库：
- en: '[PRE7]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Note that the SR UUID matches the name of the volume group.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，SR UUID 与卷组名称匹配。
- en: A complete description of `xe`'s capabilities with regard to storage is best
    left to Citrix's documentation. However, we'll describe a brief session to illustrate
    the relationship between LVM, Xen's storage pools, and the hypervisor.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 关于 `xe` 在存储方面的完整描述最好留给 Citrix 的文档。然而，我们将简要描述一个会话，以说明 LVM、Xen 的存储池和虚拟机管理程序之间的关系。
- en: 'Let''s say that you''ve added a new SATA disk to your XenServer, */dev/sdb*.
    To extend the default XenServer storage pool to the new disk, you can treat the
    storage pool as a normal LVM volume group:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 假设您已向 XenServer 添加了一个新的 SATA 硬盘，*/dev/sdb*。要将默认 XenServer 存储池扩展到新磁盘，您可以像处理正常的
    LVM 卷组一样处理存储池：
- en: '[PRE8]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The only unusual thing that we've done here is to restart the `xapi` service
    so that the various administration tools can use the new storage.
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里我们唯一不寻常的操作是重新启动 `xapi` 服务，以便各种管理工具可以使用新的存储。
- en: 'However, Citrix recommends that you perform these operations through their
    management stack. If you want to do anything more complex, like create a new storage
    repository, it''s better to use the appropriate `xe` commands rather than work
    with LVM directly. Here''s an example of the same operation, using `xe`:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，Citrix 建议您通过他们的管理堆栈执行这些操作。如果您想进行更复杂的操作，如创建新的存储库，最好使用适当的 `xe` 命令而不是直接与 LVM
    交互。以下是一个使用 `xe` 执行相同操作的示例：
- en: '[PRE9]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'That''s all there is to it. Now the GUI should immediately show a new storage
    repository under the XenServer machine. We can confirm its status using `xe sr-list`:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 就这些了。现在 GUI 应该会立即显示 XenServer 机器下的新存储库。我们可以使用 `xe sr-list` 来确认其状态：
- en: '[PRE10]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Citrix's website has more information on adding storage with `xe`, including
    the options of using file-backed storage, iSCSI, or NFS. They also cover such
    topics as removing storage repositories and setting QoS controls on VM storage.
    We defer to them for further details.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: Citrix 的网站提供了有关使用 `xe` 添加存储的更多信息，包括使用基于文件的存储、iSCSI 或 NFS 的选项。他们还涵盖了诸如删除存储库和设置虚拟机存储的
    QoS 控制等主题。我们期待他们提供更多详细信息。
- en: Emulated CD-ROM Access
  id: totrans-136
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 模拟 CD-ROM 访问
- en: One of the slickest things about Citrix's product is their CD-ROM emulation.^([[71](#ftn.CHP-11-FNOTE-12)])
    In addition to giving VMs the option of mounting the physical drives attached
    to the machine, it presents ISO images as possible CDs. When you change the CD,
    the domU immediately registers that a new disc has been inserted.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: Citrix 产品最令人印象深刻的特点之一是他们的 CD-ROM 模拟。[^[[71](#ftn.CHP-11-FNOTE-12)]) 除了给虚拟机提供挂载连接到机器的物理驱动器的选项外，它还将
    ISO 图像作为可能的 CD 提供。当你更换 CD 时，domU 会立即注册已插入新磁盘。
- en: 'XenServer looks for local ISO images in */opt/xensource/packages/iso*, and
    it looks for shared ISO images in */var/opt/xen/iso_import*. Both of these paths
    are on the server, not the admin host. Note that the XenServer host has a very
    limited root filesystem and devotes most of its disk space to virtual machines;
    thus, we recommend using shared NFS or CIFS storage for ISOs. However, local ISO
    storage is still possible. For example, to make a Windows 2003 ISO conveniently
    accessible to the XenServer VM installer, we can:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: XenServer 在 */opt/xensource/packages/iso* 中查找本地 ISO 图像，并在 */var/opt/xen/iso_import*
    中查找共享 ISO 图像。这两个路径都在服务器上，而不是管理主机上。请注意，XenServer 主机具有非常有限的根文件系统，并将大部分磁盘空间用于虚拟机；因此，我们建议为
    ISO 使用共享的 NFS 或 CIFS 存储。然而，本地 ISO 存储仍然是可能的。例如，为了使 Windows 2003 ISO 图像方便地供 XenServer
    VM 安装程序使用，我们可以：
- en: '[PRE11]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Then restart the `xapi` service as before, and select the new ISO from the drop-down
    menu in XenCenter's graphical console tab. You can also use this ISO as an install
    source when creating virtual machines.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，像以前一样重新启动 `xapi` 服务，并在 XenCenter 图形控制台选项卡的下拉菜单中选择新的 ISO。您还可以在创建虚拟机时使用此 ISO
    作为安装源。
- en: XenServer VM Templates
  id: totrans-141
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: XenServer VM 模板
- en: The templates are one of the nicest features of XenCenter. They allow you to
    create a virtual machine with predefined specifications with a couple of clicks.
    Although Citrix includes some templates, you'll probably want to add your own.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 模板是 XenCenter 最好的功能之一。它们允许您通过几个点击创建具有预定义规格的虚拟机。尽管 Citrix 包含了一些模板，但您可能希望添加自己的。
- en: The easiest way to create VM templates is to create a VM with the desired setup
    and then convert it to a template using the XenSource management software. Right-click
    the machine in the GUI and select **Convert to Template**. Conceptually, this
    is like the *golden client* concept used by, say, SystemImager; you first tailor
    a client to meet your needs and then export it as the model for future installs.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 创建虚拟机模板的最简单方法是创建一个具有所需设置的虚拟机，然后使用XenSource管理软件将其转换为模板。在GUI中右键单击机器，并选择**转换为模板**。从概念上讲，这类似于SystemImager等使用的*金客户端*概念；您首先调整客户端以满足您的需求，然后将其作为未来安装的模型导出。
- en: '[PRE12]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Another option is to use the P2V tool. To create a template from a physical
    machine, boot the machine from the XenServer CD as you would to create a VM, but
    direct the output of the P2V tool at an NFS share rather than a XenServer host.
    The template will show up in the XenCenter client's list of available templates.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个选项是使用P2V工具。要从物理机创建模板，就像创建虚拟机一样从XenServer CD启动机器，但将P2V工具的输出指向NFS共享而不是XenServer主机。模板将出现在XenCenter客户端的可用模板列表中。
- en: '* * *'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[69](#CHP-11-FNOTE-10)]) By the way, Citrix is, in fact, serious about the
    drivers not supporting pre-SP2 Windows XP. We tried.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[69](#CHP-11-FNOTE-10)]) 顺便说一下，Citrix实际上非常认真对待不支持预SP2 Windows XP的驱动程序。我们尝试过。
- en: ^([[70](#CHP-11-FNOTE-11)]) We are told that you can even use `xe` on Windows.
    Not that we would dirty our hands using an OS like Windows to administer a Linux/Xen
    server.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[70](#CHP-11-FNOTE-11)])[^[[70](#CHP-11-FNOTE-11)]] 我们被告知您甚至可以在Windows上使用`xe`。并不是说我们会用像Windows这样的操作系统来管理Linux/Xen服务器。
- en: ^([[71](#CHP-11-FNOTE-12)]) After years of being too lazy to set up an automounter,
    we are easily impressed.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[71](#CHP-11-FNOTE-12)])[^[[71](#CHP-11-FNOTE-12)]] 经过多年懒得设置自动挂载器，我们很容易感到印象深刻。
- en: XenServer Resource Pools
  id: totrans-150
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: XenServer资源池
- en: One of the most compelling features of Citrix's product is their integration
    of resource pools. These pools are the manifestation of the utility computing
    model for Xen, in which a program is decoupled from a physical machine and run
    in a virtual machine on any member of a cluster of physical machines.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: Citrix产品中最吸引人的特性之一是他们资源池的集成。这些池是Xen的效用计算模型的表现，其中程序与物理机器解耦，并在物理机集群的任何成员上运行的虚拟机上运行。
- en: To create a resource pool, just select a XenServer virtualization host in the
    XenCenter client and create a pool from it.^([[72](#ftn.CHP-11-FNOTE-13)]) When
    that's done, you can add more machines to the pool through the interface. (Up
    to 16 hosts are supported in a pool, although we've heard of people using more.)
    Furthermore, you can add storage to the pool, rather than to an individual machine,
    and create VMs that use shared storage. When you have domains based on shared
    storage, you can easily migrate them to other machines in the pool through the
    XenCenter GUI, as shown in [Figure 11-4](ch11s08.html#adding_nfs_storage_to_a_pool_through_xen
    "Figure 11-4. Adding NFS storage to a pool through XenCenter").
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 要创建资源池，只需在XenCenter客户端中选择一个XenServer虚拟化主机，并从中创建一个池。[^[[72](#ftn.CHP-11-FNOTE-13)]]
    完成后，您可以通过界面添加更多机器到池中。（池中最多支持16个主机，尽管我们听说有人使用更多。）此外，您可以将存储添加到池中，而不是单个机器，并创建使用共享存储的虚拟机。当您有基于共享存储的域时，您可以通过XenCenter
    GUI轻松地将它们迁移到池中的其他机器，如图11-4所示。[^[[70](#CHP-11-FNOTE-11)]]
- en: As you can see, Citrix has made migration basically a point-and-click operation.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，Citrix已经使迁移基本上成为一个点选操作。
- en: We're not going to discuss pool administration at length; we mention it here
    mostly to emphasize that the feature exists.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不会详细讨论池管理；我们在这里提到它主要是为了强调该功能的存在。
- en: '![Adding NFS storage to a pool through XenCenter](httpatomoreillycomsourcenostarchimages333239.png.jpg)'
  id: totrans-155
  prefs: []
  type: TYPE_IMG
  zh: '![通过XenCenter向池中添加NFS存储](httpatomoreillycomsourcenostarchimages333239.png.jpg)'
- en: Figure 11-4. Adding NFS storage to a pool through XenCenter
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 图11-4. 通过XenCenter向池中添加NFS存储
- en: '* * *'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[72](#CHP-11-FNOTE-13)]) Some of the documentation claims that this feature
    is only available to paying customers, but we were able to manage fine. Consult
    Citrix for further clarification.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[72](#CHP-11-FNOTE-13)])[^[[72](#CHP-11-FNOTE-13)]) 一些文档声称此功能仅对付费客户可用，但我们能够很好地管理。请咨询Citrix以获取进一步澄清。
- en: 'Citrix XenServer: A Brief Review'
  id: totrans-159
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Citrix XenServer：简要回顾
- en: Overall, we're quite pleased with Citrix's product. They have a polished tool
    that takes the drudgery out of Xen administration, and they've made a stable product.
    In our opinion, it's considerably better than using any of the frontends that
    are available from the open source version, and it's at least as reliable.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 总体而言，我们对Citrix的产品非常满意。他们有一个磨砺过的工具，可以消除Xen管理的繁琐，他们已经制作了一个稳定的产品。据我们看，它比使用开源版本中可用的任何前端都要好得多，并且至少同样可靠。
- en: Along with the XenCenter frontend (the most obvious difference), XenServer does
    well in ease of installation and manageability. The combination of templates and
    streamlined domU creation is particularly nice.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 除了XenCenter前端（最明显的区别）之外，XenServer在安装和可管理性方面表现良好。模板和简化domU创建的组合尤其令人愉快。
- en: Another advantage of the XenServer product is its inclusion of paravirtualized
    drivers for Windows. Although GPL PV drivers are in development and available
    (see [Chapter 13](ch13.html "Chapter 13. XEN AND WINDOWS") for more information),
    they aren't as mature as the Citrix implementation. The drivers make a huge difference
    and aren't available with the open source product. They may be the single most
    compelling reason to run XenServer.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: XenServer产品的另一个优点是它包含了Windows的半虚拟化驱动程序。尽管GPL PV驱动程序正在开发中并且可用（更多信息请参阅[第13章](ch13.html
    "第13章。XEN和Windows")），但它们不如Citrix的实现成熟。这些驱动程序带来了巨大的差异，并且开源产品中不可用。它们可能是运行XenServer的最具说服力的单一原因。
- en: Finally, virtually all of the interesting features of open source Xen are supported.
    Storage and network options are pared down somewhat, but the available options
    should be enough for most purposes.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，开源Xen的大部分有趣特性都得到了支持。存储和网络选项有所减少，但可用的选项应该足够大多数用途。
- en: It isn't all roses, however. The biggest problem that we ran into while testing
    it was its narrow support for obscure platforms, or even less-popular Linux distros
    like Gentoo or Slackware. Although it's possible to get other distros running,
    it's inconvenient, and convenience is one of XenServer's key selling points. Another
    annoyance is the need for a Windows machine to administer the Xen server—previous
    versions used a cross-platform Java client. However, because the frontend is apparently
    written in C#, perhaps we'll see a Mono port at some point.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，并非一切尽善尽美。我们在测试过程中遇到的最大问题是它对一些不为人知的平台或甚至更不受欢迎的Linux发行版（如Gentoo或Slackware）的支持范围很窄。尽管可能让其他发行版运行，但这并不方便，而便利性是XenServer的关键卖点之一。另一个烦恼是需要一台Windows机器来管理Xen服务器——之前的版本使用了一个跨平台的Java客户端。然而，由于前端显然是用C#编写的，我们可能会在某个时候看到Mono端口。
- en: Can Citrix's product replace the open source Xen? As always, the answer is maybe.
    It offers significant improvements in management and some interesting new capabilities,
    but that's balanced against the substantial cost and annoying limitations. We're
    sticking with the free version, but, then, our time is worthless.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: Citrix的产品能否取代开源Xen？一如既往，答案是也许。它在管理和一些有趣的新功能方面提供了显著的改进，但这也平衡了巨大的成本和令人烦恼的限制。我们坚持使用免费版本，但我们的时间毫无价值。
