- en: Chapter 14. TIPS
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 14 章。提示
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages333191.png.jpg)'
  id: totrans-1
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages333191.png.jpg)'
- en: By now you're some kind of Xen expert, we imagine.^([[81](#ftn.CHP-14-FNOTE-1)])
    As such, now we'd like to devote a chapter to the more esoteric aspects of working
    with Xen. Here are some things that didn't seem to fit anywhere else—stuff like
    the framebuffer, forwarding PCI devices, or building added functionality into
    the XenStore. Tips, in other words.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 到现在为止，你已经成为某种 Xen 专家，我们想象。^([[81](#ftn.CHP-14-FNOTE-1)]) 因此，现在我们想要用一章的篇幅来探讨与
    Xen 一起工作的更神秘方面。这里有一些似乎不适合其他地方的东西——比如帧缓冲区、转发 PCI 设备，或者将附加功能构建到 XenStore 中。换句话说，就是提示。
- en: A number of the topics in [Chapter 15](ch15.html "Chapter 15. TROUBLESHOOTING")
    might also come in handy when you work through our examples here. Some of the
    software discussed here is even more bleeding edge than the rest of Xen, which
    is itself some kind of *heavenly sword*, ravening and incarnadine. What we're
    trying to get at is that the material in this chapter might not work straight
    off.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里的工作示例中，[第 15 章](ch15.html "第 15 章. 故障排除") 中的一些主题也可能很有用。这里讨论的一些软件甚至比 Xen 本身还要前沿，而
    Xen 本身就像一把*天剑*，凶猛而鲜艳。我们试图说明的是，本章中的材料可能不会立即生效。
- en: Compiling Xen
  id: totrans-4
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 编译 Xen
- en: Although we've relied, for the most part, on Xen packages provided by distro
    maintainers, we think it's generally worthwhile to compile Xen from scratch. This
    will allow you to use a much more up-to-date version of Xen than versions that
    come with the distros. It also lets you enable options that the distro maintainers
    may have disabled.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管我们大部分时间都依赖于发行版维护者提供的 Xen 软件包，但我们认为从头开始编译 Xen 通常是有价值的。这将允许你使用比发行版中提供的版本更新的
    Xen 版本。这也让你能够启用发行版维护者可能已禁用的选项。
- en: If you're feeling adventurous, it's also nice to be able to play with the code—change
    it around a bit, perhaps, or add some `printk` messages to help with debugging.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你喜欢冒险，能够玩弄代码——稍作修改，或者添加一些 `printk` 消息以帮助调试，也是很不错的。
- en: The easiest way to compile is to check out the latest source from the Mercurial
    repository. Start by making sure you have Mercurial and a bunch of build dependencies.
    On CentOS 5, we installed these packages with `yum`:^([[82](#ftn.CHP-14-FNOTE-2)])
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 编译的最简单方法是检查 Mercurial 仓库的最新源代码。首先确保你有 Mercurial 和一系列构建依赖项。在 CentOS 5 上，我们使用
    `yum` 安装了这些软件包：^([[82](#ftn.CHP-14-FNOTE-2)])
- en: mercurial
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: mercurial
- en: zlib-devel
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: zlib-devel
- en: gcc
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: gcc
- en: libX11-devel
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: libX11-devel
- en: openssl-devel
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: openssl-devel
- en: ncurses-devel
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ncurses-devel
- en: bridge-utils
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: bridge-utils
- en: python-devel
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: python-devel
- en: git
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: git
- en: dev86
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: dev86
- en: glibc-devel
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: glibc-devel
- en: 'If you want the docs to build successfully, you should also install the following
    packages:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想要成功构建文档，你还应该安装以下软件包：
- en: texinfo
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: texinfo
- en: tetex-latex
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: tetex-latex
- en: pstoedit
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: pstoedit
- en: transfig
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: transfig
- en: Given the large amount of Xen documentation available online and from other
    sources, the included docs are fairly optional.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑到在线和其他来源提供的 Xen 文档数量庞大，所包含的文档相当可选。
- en: When these packages are installed, clone the development repository. We're using
    *xen-unstable* here, but if you'd like to use a less unstable repo, you might
    want to try something like *xen-3.3-testing.hg*. As of early 2009, prgmr.com runs
    *xen-3.3-testing.hg*. It has been pretty stable.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 当这些软件包安装完成后，克隆开发仓库。这里我们使用 *xen-unstable*，但如果你想要使用一个不那么不稳定的仓库，你可能想尝试像 *xen-3.3-testing.hg*
    这样的东西。截至 2009 年初，prgmr.com 运行 *xen-3.3-testing.hg*。它相当稳定。
- en: '[PRE0]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: RPMFORGE REPOSITORY
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: RPMFORGE 仓库
- en: 'If you want to install all the previously listed packages using `yum`, you
    must use the RPMForge repo. To do so safely, `install yum-priorities`. On CentOS
    5:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想要使用 `yum` 安装之前列出的所有软件包，你必须使用 RPMForge 仓库。为了安全地这样做，请安装 `yum-priorities`。在
    CentOS 5 上：
- en: '[PRE1]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Edit each of the files under `/etc/yum.repos.d/*` and add the line `priority=N`,where
    `N` is a number from 1 to 99 (lower number is greater priority). You want `base`,
    `addons`, `updates`, and `extras` to be priority `1`; `centosplus` and `contrib`
    to be priority `2`; and everything else to be priority `10` or higher.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 编辑 `/etc/yum.repos.d/*` 下的每个文件，并添加行 `priority=N`，其中 `N` 是 1 到 99 之间的数字（数字越小，优先级越高）。你希望
    `base`、`addons`、`updates` 和 `extras` 的优先级为 `1`；`centosplus` 和 `contrib` 的优先级为
    `2`；其他所有内容的优先级为 `10` 或更高。
- en: 'Now, install RPMforge:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，安装 RPMforge：
- en: '[PRE2]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Of course, if your machine is x86_64, substitute the appropriate architecture:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，如果你的机器是 x86_64，请替换为适当的架构：
- en: '[PRE3]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'then install `rpmforge` with:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 然后使用以下命令安装 `rpmforge`：
- en: '[PRE4]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Finally, edit */etc/yum.repos.d/rpmforge.repo* and add `priority=10`.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，编辑 */etc/yum.repos.d/rpmforge.repo* 并添加 `priority=10`。
- en: 'This will download the repo to a local directory (*xen-unstable.hg* in this
    case). Next, `cd` into that directory and run `make world`:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 这将把仓库下载到本地目录（在本例中为*xen-unstable.hg*）。接下来，`cd`进入该目录并运行`make world`：
- en: '[PRE5]'
  id: totrans-39
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'This will build and install the Xen hypervisor, its supporting tools, and a
    Linux kernel for dom0\. DomUs can use it as well. Often, this will be all you
    need. However, if you want to change your kernel configuration, you can. To configure
    the Linux kernel, run:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 这将构建和安装Xen虚拟机管理程序、其支持工具以及一个用于dom0的Linux内核。DomUs也可以使用它。通常，这将是你需要的一切。然而，如果你想更改你的内核配置，你可以。要配置Linux内核，请运行：
- en: '[PRE6]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: This will open the standard Linux kernel configurator. Configure the kernel
    as usual.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 这将打开标准的Linux内核配置器。像往常一样配置内核。
- en: Note
  id: totrans-43
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*You probably want to leave the dom0 8250 serial driver disabled because it
    conflicts with the Xen serial console. As usual, don''t forget the drivers for
    your boot device*.'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: '*你可能想禁用dom0的8250串行驱动程序，因为它与Xen串行控制台冲突。像往常一样，不要忘记你的启动设备的驱动程序*。'
- en: 'Then run:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 然后运行：
- en: '[PRE7]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'This builds and installs the kernel. Now, if you are on CentOS, you probably
    want to make an initrd:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 这将构建和安装内核。现在，如果你在使用CentOS，你可能想创建一个initrd：
- en: '[PRE8]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Note
  id: totrans-49
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*There is a bug in early releases of RHEL 5.3 that causes problems with this.
    See* [https://bugzilla.redhat.com/show_bug.cgi?id=488991](https://bugzilla.redhat.com/show_bug.cgi?id=488991)
    *for details. The solution is to add* *`--allow-missing`* *to the* *`mkinitrd`*
    *command line, thus*: *`# mkinitrd /boot/initrd-2.6.18.8-xen.img 2.6.18.8-xen
    --allow-missing`*.'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '*RHEL 5.3早期版本中存在一个bug，会导致这个问题。有关详细信息，请参阅[https://bugzilla.redhat.com/show_bug.cgi?id=488991](https://bugzilla.redhat.com/show_bug.cgi?id=488991)。解决方案是在*
    *`mkinitrd`* *命令行中添加* *`--allow-missing`* *，因此：* *`# mkinitrd /boot/initrd-2.6.18.8-xen.img
    2.6.18.8-xen --allow-missing`*。'
- en: 'Now, you need to fix */boot/grub/menu.lst*. Add a stanza like this, but remember
    to use appropriate devices, paths, and possibly filenames:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你需要修复*/boot/grub/menu.lst*。添加如下段落，但请记住使用适当的设备、路径，以及可能还有文件名：
- en: '[PRE9]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Reboot and enjoy your new Xen installation.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 重启并享受你的新Xen安装。
- en: '* * *'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[81](#CHP-14-FNOTE-1)]) Or at least, anyone who hasn't thrown this book out
    the window must be extremely good at filling in vague directions.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[81](#CHP-14-FNOTE-1)]) 或者至少，任何没有把这本书扔出窗户的人一定非常擅长填补模糊的方向。
- en: ^([[82](#CHP-14-FNOTE-2)]) We've also included a more Debian-centric set of
    compilation instructions in [paravirt_ops Dom0](ch14s03.html "paravirt_ops Dom0")
    on [Alternate Kernels (Dom0 and DomU)](ch14s02.html#alternate_kernels_dom0_and_domu
    "Alternate Kernels (Dom0 and DomU)") and [paravirt_ops DomU](ch14s04.html "paravirt_ops
    DomU") on [paravirt_ops DomU](ch14s04.html "paravirt_ops DomU").
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[82](#CHP-14-FNOTE-2)]) 我们还在[备用内核（Dom0和DomU）](ch14s02.html#alternate_kernels_dom0_and_domu
    "备用内核（Dom0和DomU)")[paravirt_ops Dom0](ch14s03.html "paravirt_ops Dom0")和[paravirt_ops
    DomU](ch14s04.html "paravirt_ops DomU")中包含了一套更以Debian为中心的编译指令。
- en: Compile-Time Tuning
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 编译时调整
- en: That's the quick and easy way to build Xen, but the basic compilation with `make
    world` is just the beginning. Compilation represents the first opportunity we
    have to configure Xen, and there's a lot more that we can do with it now that
    we've had some practice.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是构建Xen的快速简单方法，但基本的编译`make world`只是开始。编译代表了我们有配置Xen的第一个机会，而且现在我们已经有所实践，我们可以做更多的事情。
- en: Most of the compile-time tuning can be done by twiddling variables in *Config.mk*,
    at the top level of the Xen source tree. This file is fairly extensively commented
    and amenable to editing—take a look. You'll find that there's a brief section
    where you can decide which optional Xen bits to build.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 大部分的编译时调整可以通过在Xen源树的顶层*Config.mk*文件中调整变量来完成。这个文件有相当多的注释，并且易于编辑——看看。你会发现有一个简短的段落，你可以决定要构建哪些可选的Xen组件。
- en: 'We usually turn on all of the optional components except for the Virtual Trusted
    Platform Module (VTPM) tools, leading to a section like this:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通常打开所有可选组件，除了虚拟可信平台模块（VTPM）工具，导致出现如下部分：
- en: '[PRE10]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Note
  id: totrans-62
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*Xen''s VTPM tools are interesting. They''ve been a subject of heavy development,
    they have some interesting implications for signed code, and there''s the looming
    specter of DRM, but we just haven''t gotten into them. If you decide to build
    them, you can add virtual TPMs to domains via the* *`vtpm=`* *option in the domain
    configuration*.'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '*Xen的VTPM工具很有趣。它们一直是重点开发对象，对于签名代码有一些有趣的含义，还有DRM的阴影，但我们还没有深入研究。如果你决定构建它们，你可以在域配置中的*
    *`vtpm=`* *选项中添加虚拟TPM*。'
- en: 'If you''re having trouble (trust us, you probably will at some point), it would
    be a good idea to make a debug build. To do that, set the `DEBUG` variable at
    the top of the file:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你遇到麻烦（相信我们，你可能在某个时候会遇到），制作一个调试版本可能是个好主意。为此，在文件顶部设置 `DEBUG` 变量：
- en: '[PRE11]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Don''t worry: Xen will not run in debug mode unless you specifically instruct
    it to do so at runtime.'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 别担心：Xen 不会在调试模式下运行，除非你在运行时明确指示它这样做。
- en: These optional Xen components have a bunch of undocumented dependencies, some
    of which aren't checked for by the Makefiles. In particular, the LIBXENAPI_BINDINGS
    demand libxml2 and curl or the -devel versions of these packages, if you're using
    a Red Hat derivative.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 这些可选的 Xen 组件有一系列未记录的依赖项，其中一些在 Makefiles 中没有被检查。特别是，LIBXENAPI_BINDINGS 需要安装 libxml2
    和 curl 或这些软件包的 -devel 版本，如果你使用的是 Red Hat 衍生版本。
- en: Also, if something doesn't work when you build the tools, it would probably
    be a good idea to avoid running `make world` again because that takes a while.
    Most likely, you can get by with just `make tools`.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，如果在构建工具时出现问题，为了避免再次运行 `make world`（因为这需要一段时间），可能是一个好主意。很可能会发现，只需运行 `make
    tools` 就可以解决问题。
- en: Alternate Kernels (Dom0 and DomU)
  id: totrans-69
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 替代内核（Dom0 和 DomU）
- en: 'The default Xen Makefile will build a single kernel that can be used in both
    the dom0 and domU. If saving memory is a high priority, you can build a separate
    kernel for each. These kernels will each have a reasonable set of configuration
    options: minimal for the domU, modular for the dom0\. Specify the `KERNELS` variable
    on your `make` command line:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 默认的 Xen Makefile 会构建一个可以在 dom0 和 domU 中使用的单个内核。如果你将节省内存作为高优先级，可以为每个构建一个单独的内核。这些内核将各自有一组合理的配置选项：domU
    的配置最小化，dom0 的配置模块化。在 `make` 命令行上指定 `KERNELS` 变量：
- en: '[PRE12]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The primary reason to do this, of course, is so that you can strip all the non-Xen
    device drivers out of the domU kernel. This saves memory and—if you happen to
    be testing a lot of kernels—compile time.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，这样做的主要原因是你可以从 domU 内核中移除所有非 Xen 设备驱动程序。这节省了内存，如果你碰巧在测试大量内核，还可以节省编译时间。
- en: paravirt_ops Dom0
  id: totrans-73
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: paravirt_ops Dom0
- en: To understand why paravirt_ops gets treated as a separate piece, we have to
    recall that a lot of the early Xen development took place before virtualization
    went mainstream. The Xen developers, to paravirtualize the Linux kernel, made
    sweeping changes that proved to be difficult to merge with mainline kernel development.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 要理解为什么 paravirt_ops 被视为一个单独的部分，我们必须回忆起许多早期的 Xen 开发是在虚拟化成为主流之前进行的。为了对 Linux 内核进行
    para-virtualization，Xen 开发者进行了广泛的更改，这些更改证明很难与主线内核开发合并。
- en: paravirt_ops is a generic solution to this problem. It's a kernel-level framework
    for adding code to enable Linux to run under various hypervisors, including Xen.
    The idea is that, by making these interfaces part of the official kernel, we can
    make Xen less invasive and easier to maintain.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: paravirt_ops 是解决这个问题的通用解决方案。它是一个内核级框架，用于添加代码以使 Linux 能够在各种虚拟机管理程序下运行，包括 Xen。想法是，通过将这些接口作为官方内核的一部分，我们可以使
    Xen 更少侵入性，更容易维护。
- en: Xen has supported paravirt_ops domUs since version 3.1, and the official Linux
    kernel has had domU support since version 2.6.23 for i386 and since version 2.6.26
    for x86_64\. Unfortunately, the kernel.org kernel, as of this writing, only has
    guest support.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: Xen 自 3.1 版本以来支持 paravirt_ops domUs，官方 Linux 内核自 2.6.23 版本以来对 i386 支持domU，自
    2.6.26 版本以来对 x86_64 支持domU。不幸的是，截至本文撰写时，kernel.org 内核只支持客户机。
- en: But there is light at the end of the tunnel. With the latest patches from Jeremy
    Fitzhardinge's paravirt_ops dom0 work and a Xen 3.4 hypervisor, it is, in fact,
    possible to run a paravirt_ops dom0 based on Linux kernel version 2.6.30.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 但隧道尽头有光。通过 Jeremy Fitzhardinge 的 paravirt_ops dom0 工作的最新补丁和 Xen 3.4 虚拟机管理程序，实际上可以在基于
    Linux 内核版本 2.6.30 的 paravirt_ops dom0 上运行。
- en: These directions represent a snapshot from a very long development process.
    They work for us today. URLs may change. The status of the software certainly
    will. With that in mind, though, here's how we set up a functioning paravirt_ops
    dom0.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 这些说明代表了一个非常长的开发过程的快照。它们对我们今天有效。URL 可能会改变。软件的状态肯定也会改变。然而，考虑到这一点，以下是设置一个功能性的 paravirt_ops
    dom0 的方法。
- en: 'First, you''re going to need some development packages. This time we''re using
    the Debian package names:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，你需要一些开发包。这次我们使用的是 Debian 软件包名称：
- en: mercurial
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: mercurial
- en: build-essential
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: build-essential
- en: libncurses5-dev
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: libncurses5-dev
- en: gawk
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: gawk
- en: openssl
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: openssl
- en: xorg-dev
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: xorg-dev
- en: gettext
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: gettext
- en: python-dev
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: python-dev
- en: gitk
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: gitk
- en: libcurl4-openssl-dev
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: libcurl4-openssl-dev
- en: bcc
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: bcc
- en: libz-dev
  id: totrans-91
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: libz-dev
- en: libxml2-dev
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: libxml2-dev
- en: Next, check out Xen-unstable with Mercurial. We warned you that this stuff is
    still in development.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，使用 Mercurial 检出 Xen-unstable。我们警告过你，这些功能仍在开发中。
- en: '[PRE13]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Then check out the current Linux patches from Jeremy Fitzhardinge''s git repo:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 然后从 Jeremy Fitzhardinge 的 git 仓库检出当前的 Linux 补丁：
- en: '[PRE14]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Configure the kernel. We copied the Ubuntu configuration to *.config* and used
    that as a base.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 配置内核。我们将 Ubuntu 的配置复制到 *.config* 并以此为基础。
- en: '[PRE15]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Since we''re building a paravirt_ops dom0, make sure to turn on the appropriate
    support:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们正在构建 paravirt_ops dom0，请确保启用适当的支持：
- en: '[PRE16]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Be sure to turn on the Xen block device frontend support, under:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 确保在以下位置启用 Xen 块设备前端支持：
- en: '[PRE17]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Next, build the kernel.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，构建内核。
- en: '[PRE18]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Add */proc/xen* to `fstab` and mount it so that tools like `xend` will be able
    to communicate with the hypervisor:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 将 */proc/xen* 添加到 `fstab` 并挂载它，以便 `xend` 等工具能够与虚拟机管理程序通信：
- en: '[PRE19]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Create a GRUB entry to boot your new Xen paravirt_ops dom0:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个 GRUB 条目来引导你的新 Xen paravirt_ops dom0：
- en: '[PRE20]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Make sure that these are appropriate values for your setup, of course. That's
    all there is to it.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，请确保这些值适合你的设置。这就是全部内容。
- en: paravirt_ops DomU
  id: totrans-110
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: paravirt_ops DomU
- en: '"But what," you ask, "is all this about using a kernel.org kernel in a domU?"
    If you just want to make your own domU kernel, this is a much less involved process,
    supported without out-of-tree patches since version 2.6.23\. All of these directions
    are presented from within a domU that boots using PV-GRUB or PyGRUB—no intervention
    from the dom0 administrator should be necessary.'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: “但是，”你可能会问，“所有这些关于在 domU 中使用 kernel.org 内核是什么意思？”如果你只是想制作自己的 domU 内核，这个过程要简单得多，自
    2.6.23 版本以来无需树外补丁即可支持。所有这些说明都是从使用 PV-GRUB 或 PyGRUB 启动的 domU 内部提供的——不需要 dom0 管理员的干预。
- en: 'First, download the kernel source you prefer:'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，下载你偏好的内核源代码：
- en: '[PRE21]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Next, install the packages normally required to build the kernel. This example
    is for Debian, but it should be easy enough to find out what packages your favorite
    distro needs to build the kernel.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，安装构建内核通常所需的软件包。这个例子是为 Debian 定制的，但应该很容易找到你喜欢的发行版构建内核所需的软件包。
- en: '[PRE22]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Untar and configure the kernel. Personally, we like `menuconfig`, but that''s
    just a matter of taste:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 解包并配置内核。我们个人喜欢 `menuconfig`，但这只是个人喜好问题：
- en: '[PRE23]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Don''t forget to enable Xen support:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 不要忘记启用 Xen 支持：
- en: '[PRE24]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Don''t forget your network driver:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 不要忘记你的网络驱动程序：
- en: '[PRE25]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'or your disk driver:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 或者你的磁盘驱动程序：
- en: '[PRE26]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Xenfs, which allows you to access the XenBus, is sometimes useful:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: Xenfs，它允许你访问 XenBus，有时很有用：
- en: '[PRE27]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Then customize to your heart's content. Remember, you can remove support for
    just about all hardware now. We also leave out the balloon driver. RAM is cheap,
    and we like having definite memory allocations.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 然后随心所欲地进行自定义。记住，你现在可以移除几乎所有硬件的支持。我们还省略了气球驱动程序。RAM 很便宜，我们喜欢有明确的内存分配。
- en: 'Now, make the kernel as usual:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，像往常一样构建内核：
- en: '[PRE28]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Make your initrd as per the usual kernel build. Since we're using Debian for
    this example, that means using `mkinitramfs`. If you compiled `xenblk` as a module,
    make sure to include it.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 按照常规内核构建方式制作你的 initrd。由于我们在这个例子中使用 Debian，这意味着使用 `mkinitramfs`。如果你将 `xenblk`
    编译为模块，请确保将其包含在内。
- en: '[PRE29]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Set up GRUB as you normally would:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 按照常规设置 GRUB：
- en: '[PRE30]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'One last thing before you reboot: Note that the device name for your console
    will be hvc0, for *hypervisor console*. This takes the place of the Xen-specific
    xvc0\. If your distro doesn''t do so already, you probably want to set up the
    domain to start a `getty` on hvc0\. Now, simply restart your domain (halt it and
    start it up if you are using PyGRUB) and enjoy your modern kernel.'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 在重启之前，最后一件事情：请注意，你的控制台设备名称将是 hvc0，即 *虚拟机管理程序控制台*。这取代了 Xen 特定的 xvc0。如果你的发行版还没有这样做，你可能想设置域以在
    hvc0 上启动 `getty`。现在，只需重新启动你的域（如果你使用 PyGRUB，请先停止再启动）并享受你的现代内核。
- en: '[PRE31]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'The Xen API: The Way of the Future'
  id: totrans-135
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Xen API：未来的道路
- en: The Xen API is an XML-RPC interface to Xen that replaces the old interface used
    for communication with the hypervisor. It promises to provide a standard, stable
    interface so that people can build Xen frontends without worrying about the interface
    changing out from under them. It also extends the previous Xen command set so
    that more of Xen's functionality can be harnessed in a standardized tool.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: Xen API 是一个 XML-RPC 接口，用于替代与虚拟机管理程序通信的旧接口。它承诺提供一个标准、稳定的接口，以便人们可以构建 Xen 前端而不用担心接口会发生变化。它还扩展了之前的
    Xen 命令集，以便在标准化的工具中利用更多 Xen 的功能。
- en: In current versions of Xen, the API is an optional component, but that shouldn't
    deter you from using it; the most recent Citrix Xen Server product, for example,
    relies on the API exclusively for communication between the administration frontend
    and the virtualization host.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 在当前版本的Xen中，API是一个可选组件，但这不应该阻止你使用它；例如，最新的Citrix Xen Server产品完全依赖于API来实现管理前端和虚拟化主机之间的通信。
- en: 'The Xen API is enabled by setting the LIBXENAPI_BINDINGS flag at the top of
    *Config.mk*:'
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: Xen API是通过在*Config.mk*文件顶部设置LIBXENAPI_BINDINGS标志来启用的：
- en: '[PRE32]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: When you've built Xen with support for the Xen API, the use of the API is controlled
    by the `(xen-api-server)` directive in */etc/xen/xend-config.sxp*.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 当你用支持Xen API的方式构建Xen时，API的使用由*/etc/xen/xend-config.sxp*中的`(xen-api-server)`指令控制。
- en: '[PRE33]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: This directive turns on the API server and specifies how to connect to it. Each
    list in parentheses is a connection method. In this case, we're using TCP port
    9363 and a local Unix socket, each with no authentication whatsoever.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 这个指令开启了API服务器并指定了如何连接到它。括号中的每个列表都是一个连接方法。在这种情况下，我们使用TCP端口9363和一个本地Unix套接字，每个都没有任何身份验证。
- en: 'To specify that we want to authenticate using PAM, we can modify this configuration
    a bit:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 要指定我们想要使用PAM进行身份验证，我们可以稍微修改一下这个配置：
- en: '[PRE34]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Ordinarily, even when developing a Xen client, you won't need to interact with
    the Xen API at a low level. Bindings exist for most of the popular languages,
    including C and, of course, Python. The Xen.org API documentation, accessible
    from [http://wiki.xensource.com/xenwiki/XenApi/](http://wiki.xensource.com/xenwiki/XenApi/),
    is the last word on the subject.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，即使在开发Xen客户端时，你也不需要以低级别与Xen API交互。大多数流行语言都有绑定，包括C和当然还有Python。Xen.org API文档，可通过[http://wiki.xensource.com/xenwiki/XenApi/](http://wiki.xensource.com/xenwiki/XenApi/)访问，是关于这个主题的最后一言。
- en: Managing Memory with the Balloon Driver
  id: totrans-146
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用气球驱动程序管理内存
- en: Moving on from compile time and installation issues to the serious day-to-day
    business of running Xen, we encounter the problem of memory. As we've mentioned,
    most Xen installations are limited in practice by physical memory.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 从编译时间和安装问题转向运行Xen的日常业务，我们遇到了内存问题。正如我们提到的，大多数Xen安装实际上受限于物理内存。
- en: Xen expends a great deal of effort on virtualizing memory; its approach is one
    of the defining features of paravirtualization, and it usually "just works," on
    a level low enough to ignore completely. However, it sometimes can benefit from
    a bit of attention by the administrator.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: Xen在虚拟化内存上投入了大量的努力；其方法是半虚拟化的一个定义特征，通常“只需工作”，在足够低的级别上可以完全忽略。然而，有时管理员的一点点关注可能会带来好处。
- en: 'We''ve been dancing around the subject of memory oversubscription for a long
    time, and we''d better come clean: It is possible to assign a dynamic amount of
    memory to a domU, but we don''t do it because it''s not suitable for our *virtual
    private server* model. Also, the developers have historically been leery about
    recommending it for production. However, it does exist, and there are some good
    reasons to use it, which we''re sure you can imagine.'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 我们已经围绕内存超订阅的主题绕来绕去很长时间了，我们最好坦白：可以为domU分配一定量的动态内存，但我们没有这样做，因为它不适合我们的*虚拟专用服务器*模式。此外，开发者们从历史上就对这个建议用于生产持谨慎态度。然而，它确实存在，而且有一些很好的理由去使用它，我们相信你能想象到。
- en: Xen's control over reallocating memory to virtual machines is somewhat indirect.
    First, the value in the domU config file for memory is a *maximum*—conceptually,
    the amount of memory that's physically accessible to the virtual machine. The
    amount of memory in the config file is what the kernel sees at boot. Adding more
    would require a reboot. This is being worked on, mostly from the direction of
    Linux's memory hotplug. We confidently expect someone to provide a patch soon.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: Xen对虚拟机内存重新分配的控制是间接的。首先，domU配置文件中内存的值是一个*最大值*——从概念上讲，这是虚拟机可以物理访问的内存量。配置文件中的内存量是内核在启动时看到的。增加内存需要重启。这项工作正在进行中，主要来自Linux的内存热插拔方向。我们相信很快会有人提供补丁。
- en: Within this inflexible maximum, Xen can reduce this memory using the *balloon
    driver*, which is nothing but a module that sits in the domU and *inflates* to
    consume memory, which it then hands back to the hypervisor.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个不灵活的最大值内，Xen可以使用*气球驱动程序*来减少内存，这只是一个位于domU中并*膨胀*以消耗内存的模块，然后将其归还给虚拟机管理程序。
- en: Because the dom0 is also a Xen domain, it also can have a memory balloon, which
    Xen uses to reclaim dom0 memory for allocation to domUs.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 因为dom0也是一个Xen域，它也可以拥有一个内存气球，Xen使用它来回收dom0内存以分配给domUs。
- en: Note
  id: totrans-153
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*We favor setting the dom0 memory directly with the* *`dom0_mem`* *boot option,
    which actively hides memory from the dom0\. By setting* *`(dom0-min-mem 0)`* *and*
    *`(enable-dom0-ballooning no)`* *in* xend-config.sxp, *we can ensure that dom0
    doesn''t balloon out, and thus has a consistent memory reservation*.^([[83](#ftn.CHP-14-FNOTE-3)])'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: '*我们倾向于使用* *`dom0_mem`* *引导选项直接设置dom0内存，这会主动隐藏内存以防止dom0使用。通过在* *xend-config.sxp*
    *中设置* *`(dom0-min-mem 0)`* *和* *`(enable-dom0-ballooning no)`* *，我们可以确保dom0不会膨胀，从而保持一致的内存预留。^([[83](#ftn.CHP-14-FNOTE-3)])'
- en: 'You can use `xm` to manually adjust the amount of memory used by the balloon:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用`xm`手动调整气球使用的内存量：
- en: '[PRE35]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: The domain treats this as a target, giving memory to the balloon as it becomes
    free.^([[84](#ftn.CHP-14-FNOTE-4)]) Thus, it's possible that a heavily loaded
    domain will take a while to give up memory to the balloon.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 该域将其视为目标，当内存空闲时，会将其分配给气球.^([[84](#ftn.CHP-14-FNOTE-4)]) 因此，一个负载较重的域可能需要一段时间才能将内存释放给气球。
- en: 'You can see the effect of the balloon in the list of VMs:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在虚拟机列表中看到气球的效果：
- en: '[PRE36]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'You can also see balloon-related information from within the domU via */proc/xen/balloon*:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 您也可以通过*/proc/xen/balloon*从domU内部查看与气球相关的信息：
- en: '[PRE37]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: Note
  id: totrans-162
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*The balloon is pretty aggressive; it can cause an out-of-memory condition
    in the domU. Use it with caution*.'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: '*气球相当积极；它可能导致domU出现内存不足的情况。请谨慎使用*。'
- en: '* * *'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[83](#CHP-14-FNOTE-3)]) In newer versions of Xen, you really only need `(enable-dom0-ballooning
    no)`, but that has no effect on older versions. Before the `enable-dom0-ballooning`
    option was enabled, setting `dom0-min-mem` to 0 would disable ballooning. Really,
    you could get away with just setting `dom0-min-mem` to 0; I tested it after embarrassing
    myself on the xen-devel list, and it works, but `(enable-dom0-ballooning no)`
    is nice and clear, and this sort of thing is important enough to specify twice.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[83](#CHP-14-FNOTE-3)]) 在Xen的新版本中，您实际上只需要设置* *`(enable-dom0-ballooning no)`*
    *，但这在旧版本中没有效果。在`enable-dom0-ballooning`选项启用之前，将`dom0-min-mem`设置为0将禁用气球。实际上，您只需将`dom0-min-mem`设置为0即可；我在在xen-devel列表上出丑之后测试了它，它有效，但`(enable-dom0-ballooning
    no)`既清晰又简洁，这类事情足够重要，值得两次指定。
- en: ^([[84](#CHP-14-FNOTE-4)]) Although Linux does its best to keep memory in use
    at all times, it'll give memory to the balloon rather than using it for buffers
    or cache.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[84](#CHP-14-FNOTE-4)]) 尽管Linux尽力在所有时间都保持内存的使用，但它会将内存分配给气球，而不是用于缓冲区或缓存。
- en: PCI Forwarding
  id: totrans-167
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: PCI转发
- en: You can allow a domU to access arbitrary PCI devices and use them with full
    privileges. Of course, there's no such thing as a free lunch; Xen can't miraculously
    duplicate PCI hardware. For a domU to use a PCI device, it has to be hidden from
    the dom0 and not forwarded to any other domUs.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以允许domU访问任意PCI设备并使用它们，具有完全的权限。当然，没有免费的午餐；Xen不能神奇地复制PCI硬件。为了使domU使用PCI设备，它必须从dom0中隐藏，并且不会转发到任何其他domUs。
- en: '![Xen PCI device forwarding](httpatomoreillycomsourcenostarchimages333249.png.jpg)'
  id: totrans-169
  prefs: []
  type: TYPE_IMG
  zh: '![Xen PCI设备转发](httpatomoreillycomsourcenostarchimages333249.png.jpg)'
- en: Figure 14-1. Xen PCI device forwarding
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 图14-1. Xen PCI设备转发
- en: As [Figure 14-1](ch14s07.html#xen_pci_device_forwarding "Figure 14-1. Xen PCI
    device forwarding") shows, PCI forwarding uses a client/server model in which
    the *pcifront driver* runs in the domU and communicates directly with the *pciback
    driver*, which binds to the PCI device and hides it from the dom0.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 如[图14-1](ch14s07.html#xen_pci_device_forwarding "图14-1. Xen PCI设备转发")所示，PCI转发使用客户端/服务器模型，其中*pcifront驱动程序*在domU中运行，并直接与绑定到PCI设备的*pciback驱动程序*通信。
- en: First, consider the device that you want to forward to the domU. The test machine
    that we're sitting in front of appears to have seven (!) USB controllers, so we'll
    just take a couple of those.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，考虑您想要转发到domU的设备。我们坐在这台测试机前的设备似乎有七个(!) USB控制器，所以我们只取其中几个。
- en: 'Use `lspci` to determine bus IDs:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`lspci`确定总线ID：
- en: '[PRE38]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: We'll forward `00:1a.1` and `00:1a.7`, which are the second of the USB1 controllers
    listed and the USB2 controller. Your device names will most likely vary from those
    in this example.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将转发`00:1a.1`和`00:1a.7`，这是USB1控制器列表中的第二个和USB2控制器。您的设备名称可能与这个示例中的不同。
- en: 'If pciback is compiled into the kernel, you can boot the dom0 with a `pciback.hide`
    option on the kernel command line. For these two controllers, the option would
    look like this:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 pciback 编译进内核，您可以在内核命令行上使用 `pciback.hide` 选项来引导 dom0。对于这两个控制器，选项看起来是这样的：
- en: '[PRE39]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: If pciback is a module, it's a little more difficult. We need to detach the
    PCI device from its driver and attach it to the pciback passthrough.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 pciback 是一个模块，那么会稍微困难一些。我们需要将 PCI 设备从其驱动程序中分离出来，并将其连接到 pciback 透传。
- en: '[PRE40]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Now put these devices into the domU config file:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 现在将这些设备放入 domU 配置文件中：
- en: '[PRE41]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: On the next domU boot, these USB controllers should appear and be available
    to the native drivers in the domU. Hardware devices on platforms without an IOMMU
    can DMA to arbitrary memory regions. This can be a security problem if you're
    giving PCI access to arbitrary domains. The moral is to treat all domains with
    access to the PCI bus as privileged. Make sure you can trust them.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一个 domU 引导时，这些 USB 控制器应该会出现，并可供 domU 中的本地驱动程序使用。在无 IOMMU 的平台上，硬件设备可以 DMA 到任意内存区域。如果您将
    PCI 访问权限授予任意域，这可能会成为安全问题。道德是，将所有具有 PCI 总线访问权限的域视为特权域。确保您可以信任它们。
- en: GRUB Configuration
  id: totrans-183
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: GRUB 配置
- en: Of course, we've dealt with GRUB in passing because it's one of the basic prerequisites
    for Xen. However, there are a few more aspects of GRUB that are worth mentioning
    in depth. A fair number of Xen's behavior knobs can be tweaked in GRUB at boot
    time by adjusting the command-line parameters passed to the hypervisor.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，我们只是顺便提到了 GRUB，因为它是 Xen 的基本先决条件之一。然而，还有几个关于 GRUB 的方面值得深入探讨。Xen 的许多行为旋钮可以在引导时通过调整传递给虚拟机管理程序的命令行参数来调整。
- en: 'For example, the already-mentioned `dom0_mem` parameter adjusts the amount
    of memory that Xen allows the dom0 to see:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，已经提到的 `dom0_mem` 参数调整了 Xen 允许 dom0 看见的内存量：
- en: '[PRE42]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'To keep the system from rebooting if you have a kernel panic, which happens
    more often than we would like, especially when trying to get machines initially
    set up, add `noreboot` to the `kernel` line:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 为了防止系统在内核恐慌时重启，这种情况比我们希望的更常见，尤其是在尝试设置机器时，请将 `noreboot` 添加到 `kernel` 行：
- en: '[PRE43]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'as well as `panic=0` to the Linux `module` line:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 以及将 `panic=0` 添加到 Linux 的 `module` 行：
- en: '[PRE44]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: This is, of course, in addition to the plethora of options supported by the
    Linux kernel, which you can then add to `vmlinuz`'s `module` line as you see fit.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 这当然是在 Linux 内核支持的众多选项的基础上，您可以根据需要将其添加到 `vmlinuz` 的 `module` 行。
- en: The Serial Console
  id: totrans-192
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 串行控制台
- en: One other important GRUB-related task is setting up your serial console. As
    mentioned, we consider the serial console to be the gold standard for console
    access to any sort of server. It's much simpler than any sort of graphical interface,
    easy to access with a variety of devices, and is the output most likely to provide
    useful information when the machine is crashing. Furthermore, because of the client/server
    architecture inherent in the system, anything that a crashing machine manages
    to print goes to another, physically separate machine, where it can be analyzed
    at leisure.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个重要的与 GRUB 相关的任务是设置您的串行控制台。如前所述，我们认为串行控制台是任何类型服务器控制台访问的黄金标准。它比任何图形界面都要简单得多，可以通过各种设备轻松访问，并且在机器崩溃时最有可能提供有用的信息。此外，由于系统固有的客户端/服务器架构，任何崩溃的机器成功打印的内容都会发送到另一台物理上独立的机器，在那里可以随意分析。
- en: Xen comes with miniterm, a minimal serial client for this sort of thing, in
    case you don't have access to a serial client. This is unlikely, but the client
    is tiny, so why not?
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: Xen 随带 miniterm，这是一个用于此类操作的简化串行客户端，以防您无法访问串行客户端。这种情况不太可能发生，但客户端很小，为什么不试试呢？
- en: Miniterm is in the *tools/misc/miniterm* subdirectory of the Xen source tree.
    If you've built all the tools with Xen, it'll already be built and possibly even
    installed; if not, you can simply type **`make`** in that directory and run the
    resulting executable.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: Miniterm 位于 Xen 源树的 *tools/misc/miniterm* 子目录中。如果您已经使用 Xen 构建了所有工具，它可能已经构建并可能甚至安装了；如果没有，您只需在那个目录中输入
    **`make`** 并运行生成的可执行文件。
- en: Enabling Serial Output
  id: totrans-196
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启用串行输出
- en: 'There are four components that need to have their output redirected to the
    serial port: GRUB, Xen, the Linux kernel, and Linux''s userland. Each of the first
    three is a simple matter of adding a directive to GRUB''s *menu.lst*.'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 有四个组件需要将它们的输出重定向到串行端口：GRUB、Xen、Linux 内核和 Linux 的用户空间。前三个组件只需在 GRUB 的 *menu.lst*
    中添加一个指令即可。
- en: 'First, near the top of the file, add these lines:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，在文件顶部附近，添加以下几行：
- en: '[PRE45]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'Edit the Xen kernel line to tell the hypervisor to use the first serial port
    for output:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 编辑Xen内核行，告诉虚拟机管理器使用第一个串行端口进行输出：
- en: '[PRE46]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'Tell the Linux kernel to print its messages on `ttyS0`:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 告诉Linux内核在`ttyS0`上打印其消息：
- en: '[PRE47]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Finally, edit */etc/inittab* and add a line like the following:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，编辑*/etc/inittab*并添加以下类似的行：
- en: '[PRE48]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: You may also want to add `ttyS0` to */etc/securetty* so that root will be able
    to log in, after the manner of a traditional console.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能还想将`ttyS0`添加到*/etc/securetty*中，这样root就可以像传统控制台一样登录。
- en: The Xen Hypervisor Console
  id: totrans-207
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Xen虚拟机管理器控制台
- en: Xen adds another layer to the serial console by using it to access extra hypervisor
    features. First, break into the hypervisor console by pressing CTRL-A three times
    on the serial console. This won't work on the VGA console. You'll get a (XEN)
    prompt.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: Xen通过使用它来访问额外的虚拟机管理器功能，为串行控制台添加了另一层。首先，在串行控制台上按CTRL-A三次进入虚拟机管理器控制台。这不会在VGA控制台上工作。你会得到一个(XEN)提示。
- en: When you're in the hypervisor console, there are several useful (or at least
    interesting) commands you can give Xen. Try typing **`h`** for help or one of
    the informational commands, like **`m`**. You can also crash the machine, reboot
    it, or dump various pieces of information. Poke around and try it.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 当你在虚拟机管理器控制台上时，你可以给Xen提供几个有用的（或者至少有趣的）命令。尝试输入**`h`**以获取帮助或使用其中一个信息性命令，如**`m`**。你还可以使机器崩溃、重新启动或转储各种信息。探索并尝试它。
- en: To exit the hypervisor console, type CTRL-A three more times.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 要退出虚拟机管理器控制台，请按CTRL-A三次。
- en: Xen and LILO
  id: totrans-211
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Xen和LILO
- en: This section only applies to the real dinosaurs out there, but we sympathize.
    In keeping with the feeling that you have vanished into the mysterious past, we
    will present this example using Xen 3.0.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 这个部分仅适用于真正的恐龙们，但我们表示同情。为了保持你仿佛消失在神秘过去的感受，我们将使用Xen 3.0来展示这个示例。
- en: If you're dead set on using LILO, rather than GRUB, you will be pleased to learn
    that it is possible. Although it's generally thought that LILO's lack of an equivalent
    to GRUB's `module` directive makes it impossible for it to boot Xen, it's possible
    to get around that by combining the hypervisor, dom0 kernel, and initrd into one
    file using `mbootpack`.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你坚决要使用LILO而不是GRUB，你会很高兴地得知这是可能的。尽管一般认为LILO缺少GRUB的`module`指令的等价物，这使得它无法引导Xen，但可以通过使用`mbootpack`将虚拟机管理器、dom0内核和initrd合并到一个文件中，来绕过这个问题。
- en: 'Consider the following entry in *grub.conf*:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑*grub.conf*中的以下条目：
- en: '[PRE49]'
  id: totrans-215
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'It loads the hypervisor, *xen-3.0.gz*, as the kernel then unpacks *vmlinuz-2.6-xen*
    and *initrd.gz* into memory. To combine these files, first decompress:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 它将虚拟机管理器*xen-3.0.gz*作为内核加载，然后解压缩*vmlinuz-2.6-xen*和*initrd.gz*到内存中。要合并这些文件，首先解压缩：
- en: '[PRE50]'
  id: totrans-217
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: Note the change from *vmlinuz* to *vmlinux*. It's not important except that
    it keeps you from overwriting the kernel at the beginning of the `gzcat` process.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 注意从*vmlinuz*到*vmlinux*的变化。这并不重要，除非它防止你在`gzcat`过程的开始处覆盖内核。
- en: 'Then combine the three files using `mbootpack`:'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 然后使用`mbootpack`合并这三个文件：
- en: '[PRE51]'
  id: totrans-220
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'The *grub.conf* entry then becomes a *lilo.conf* entry:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: '*grub.conf*条目随后变为*lilo.conf*条目：'
- en: '[PRE52]'
  id: totrans-222
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: Finally, run the `lilo` command.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，运行`lilo`命令。
- en: '[PRE53]'
  id: totrans-224
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: The Virtual Framebuffer
  id: totrans-225
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 虚拟帧缓冲区
- en: For as much as purists would like to claim that all administration should be
    done via serial port, there's something to be said for all this newfangled graphical
    technology that we've been using for, oh, around the last 25 years. Xen makes
    a concession to these forward-thinking beliefs by including a facility for a *virtual
    framebuffer*.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管纯粹主义者可能会声称所有管理都应该通过串行端口完成，但我们对于过去25年左右一直在使用的这种新奇的图形技术也有话要说。Xen通过包含一个用于*虚拟帧缓冲区*的功能，对这些前瞻性信念做出了让步。
- en: 'You will need to edit your *Config.mk* file to build the VFB:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要编辑你的*Config.mk*文件来构建VFB：
- en: '[PRE54]'
  id: totrans-228
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: At this point you'll also need libvncserver and libsdl-dev. Install them in
    your chosen way. We installed CentOS's SDL-devel package and installed libvncserver
    from source. Then we built Xen and installed it in the usual way.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，你还需要安装libvncserver和libsdl-dev。以你选择的方式安装它们。我们安装了CentOS的SDL-devel包，并从源代码安装了libvncserver。然后我们构建了Xen，并以通常的方式安装它。
- en: 'To actually use the framebuffer within a domain, you''ll need to specify it
    in the config file. Recent versions of Xen have improved the syntax somewhat.
    The `vfb=` option controls all aspects of the virtual framebuffer, just as the
    `vif=` and `disk=` lines control virtual interfaces and virtual block devices.
    For example:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 要在域内实际使用framebuffer，你需要在配置文件中指定它。Xen的最近版本在语法上有所改进。`vfb=`选项控制虚拟framebuffer的所有方面，就像`vif=`和`disk=`行控制虚拟接口和虚拟块设备一样。例如：
- en: '[PRE55]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Here we specify a VNC VFB and tell the VNC server to listen on the first unused
    port that''s over the given number. (We go into more detail on the options available
    in [Appendix B](apb.html "Appendix B. THE STRUCTURE OF THE XEN CONFIG FILE").)
    Or, if you''re feeling adventurous, there''s the SDL version:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们指定了一个VNC VFB，并告诉VNC服务器在给定数字之上的第一个未使用端口上监听。（我们将在[附录B](apb.html "附录B. Xen配置文件的结构")中详细介绍可用的选项。）或者，如果你喜欢冒险，还有SDL版本：
- en: '[PRE56]'
  id: totrans-233
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: Simple.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 简单。
- en: Use of the XenStore for Fun and Profit
  id: totrans-235
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: XenStore的有趣和有利可图的用途
- en: The XenStore is the configuration database in which Xen stores information on
    the running domUs. Although Xen uses the XenStore internally for vital matters
    like setting up virtual devices, you can also write arbitrary data to it from
    domUs as well as from dom0\. Think of it as some sort of interdomain socket.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: XenStore是Xen存储运行中的domUs信息的配置数据库。尽管Xen在设置虚拟设备等关键事务内部使用XenStore，但你也可以从domUs以及dom0写入任意数据到其中。将其视为某种跨域套接字。
- en: This opens up all sorts of possibilities. For example, domains could, in theory,
    negotiate among themselves for access to shared resources. Or you could have something
    like the *talk* system on the shared UNIX machines of yore—multiuser chat between
    people running on the same host. You could use it to propagate host-specific messages,
    for example, warning people of impending backups or migration. For the most part,
    though, such applications remain to be written.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 这打开了许多可能性。例如，理论上，域之间可以协商以获取对共享资源的访问权限。或者，你可以有像过去共享UNIX机器上的*talk*系统一样的东西——在同一主机上运行的人之间的多用户聊天。你可以用它来传播特定于主机的消息，例如，警告人们即将进行的备份或迁移。不过，大多数这样的应用仍然有待编写。
- en: It's a little inconvenient to interact with the XenStore manually because no
    one's gotten around to providing a handy shell-style interface. In the meantime,
    we have to make do with tools that interrogate single keys.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 由于没有人提供方便的shell样式界面，手动与XenStore交互有点不方便。在此期间，我们只能使用查询单个键的工具来凑合。
- en: 'To look at the XenStore, you can use the `xenstore-list` command. Here''s a
    shell script from the Xen wiki that dumps keys from the xenstore recursively with
    `xenstore-list`:'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看XenStore，可以使用`xenstore-list`命令。以下是从Xen wiki中摘录的一个shell脚本，它使用`xenstore-list`递归地导出xenstore中的键：
- en: '[PRE57]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'You''ll see that we have three hard-coded top-level keys: `vm`, `local/domain`,
    and `tool`. These each have a well-defined purpose to the hypervisor: `vm` stores
    domain information by UUID; `local/domain` stores domain information by ID (one
    might say that `vm` exports domain data in a form suitable for migration, and
    `local/domain` stores it for local use); and `tool` stores tool-specific information.'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 你会看到我们有三个硬编码的顶级键：`vm`、`local/domain`和`tool`。这些键对虚拟机管理程序都有明确的用途：`vm`通过UUID存储域信息；`local/domain`通过ID存储域信息（可以说`vm`以适合迁移的形式导出域数据，而`local/domain`则用于本地存储）；`tool`存储特定工具的信息。
- en: 'Poke around, look at the keys and how they map the information that you already
    know about the domain from other sources, like `xm list --long`. For example,
    to get the memory usage target for the domain, run:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 探索一下，看看键是如何映射你从其他来源（如`xm list --long`）已知的关于域的信息的。例如，要获取域的内存使用目标，请运行：
- en: '[PRE58]'
  id: totrans-243
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: Many of the keys in the XenStore are also writable. Although we don't recommend
    adjusting memory usage by writing to the XenStore, see the next section for an
    example of interdomain communication via writable XenStore keys.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: XenStore中的许多键也是可写的。尽管我们不推荐通过写入XenStore来调整内存使用，但下一节将给出通过可写XenStore键进行跨域通信的示例。
- en: Automatically Connecting to the VNC Console on Domain Boot
  id: totrans-245
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在域启动时自动连接到VNC控制台
- en: One neat feature of the Xen LiveCD is that Xen domains, when started, will automatically
    pop up a VNC window when they've finished booting. The infrastructure that makes
    this possible is a script in the domU, a listener in the dom0, and the XenBus
    between them.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: Xen LiveCD的一个巧妙特性是，当Xen域启动时，它们在完成引导后会自动弹出一个VNC窗口。使这一功能成为可能的基础设施是一个位于domU中的脚本、一个位于dom0中的监听器以及它们之间的XenBus。
- en: 'The script in the domU, *vnc-advertiser*, fires off from the domU startup scripts
    and waits for an Xvnc session to start. When it finds one, it writes to the XenStore:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 位于domU中的脚本*vnc-advertiser*从domU启动脚本中触发，并等待一个Xvnc会话开始。当它找到一个会话时，它会写入XenStore：
- en: '[PRE59]'
  id: totrans-248
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'In the dom0, a corresponding script watches for writes to the XenStore. On
    the LiveCD, it''s named *vnc-watcher.py*. This script is a good example of general-purpose
    uses for the XenStore, so we''ve copied it wholesale here, with verbose annotations:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 在dom0中，一个相应的脚本会监视对XenStore的写入操作。在LiveCD上，它被命名为*vnc-watcher.py*。这个脚本是XenStore通用用途的好例子，所以我们将其完整复制在此，并附上详尽的注释：
- en: '[PRE60]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: There are a couple of other sections that we would have loved to include here,
    but that aren't ready as of this writing, for example, the ongoing open source
    efforts to build an Amazon EC2 clone or the high-availability work being done
    by Project Kemari.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 我们本希望在这里包含一些其他部分，但截至撰写本文时，它们尚未准备好，例如，目前正在进行的开源努力以构建Amazon EC2的克隆或Project Kemari正在进行的高可用性工作。
- en: Anyway, please visit our website ([http://prgmr.com/xen/](http://prgmr.com/xen/))
    for more on the cool yet frightfully everyday things that we do with Xen.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 无论如何，请访问我们的网站([http://prgmr.com/xen/](http://prgmr.com/xen/))，了解更多关于我们用Xen做的酷炫但令人畏惧的日常事情。
- en: Also, if you've broken your system trying to upgrade Xen from source, there's
    no better time than the present to take a look at the next chapter.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，如果你在尝试从源代码升级Xen时破坏了系统，那么现在正是查看下一章的好时机。
