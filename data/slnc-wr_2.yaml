- en: Part II. Safe Harbor
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第二部分。安全港
- en: '*On the threats that lurk in between the computer and the Internet*'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*在计算机和互联网之间潜伏的威胁*'
- en: —
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: —
- en: Chapter 5. Blinkenlights
  id: totrans-3
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第五章。闪烁灯
- en: '*Where we conclude that pretty can also be deadly, and we learn to read from
    LEDs*'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '*我们得出结论，美丽也可能致命，我们学会了从LED中阅读*'
- en: —
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: —
- en: The first part of this book focused on various problems related to the design
    of the data entry point system. Those problems were limited to deducing input
    by observing seemingly unrelated behavioral patterns by a user with local access
    to a system. But as information moves farther down its path to the addressee and
    leaves this system, its exposure broadens, and problems become more tangible.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 本书的第一部分关注与数据输入点系统设计相关的各种问题。这些问题仅限于通过观察似乎无关的行为模式来推断输入，这些模式是由对系统具有本地访问权限的用户观察到的。但随着信息沿着其路径进一步移动并离开这个系统，其暴露范围扩大，问题变得更加具体。
- en: The second part of this book focuses on some of the problems that occur while
    the data remains within reach, but just after it leaves the originating system-—moments
    before it enters the Internet. The exposure discussed here is limited to roughly
    the physical footprint of a local area network with its direct surroundings. An
    attack at this level requires an observation point that is local to the origin,
    but it does not require system-level access.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 本书第二部分关注数据仍在可触及范围内，但刚刚离开原始系统时出现的一些问题——在它进入互联网之前的一瞬间。这里讨论的暴露范围限于大约一个局域网及其直接周边的物理足迹。在这个层面上进行攻击需要观察点位于源头附近，但不需要系统级访问权限。
- en: 'The specific problem discussed in this chapter is somewhat different from those
    discussed previously: the exposure now manifests at the hardware level, much like
    in TEMPEST, but is different. The beauty of this phenomenon, and the ease of observing
    it with no specialized equipment, more than justify giving it a closer look.'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 本章讨论的具体问题与之前讨论的问题略有不同：现在的暴露现在在硬件层面上体现，类似于TEMPEST，但有所不同。这一现象的美丽之处，以及无需专用设备就能轻松观察到的便利性，完全有理由更深入地研究它。
- en: The Art of Transmitting Data
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 传输数据的艺术
- en: 'The need for computers to communicate with other electronic devices has been
    apparent since the beginning of practical computing, as has the difficulty of
    achieving this task reliably and on a budget. We can control the machine’s internal
    communication by providing generous and custom-fit interfaces among all major
    components with a desired capacity, maintaining precise signal characteristics,
    and using a common reference clock for all operations, so that the recipient always
    knows when to listen, and the sender always knows when to transmit data. But communication
    over longer distances or to devices equipped with nonspecialized, cheap interfaces
    is a different challenge: the computer is forced to communicate over a medium
    that usually does not allow for the degree of freedom we have grown accustomed
    to working with on the insides of a single machine.'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 计算机与其他电子设备进行通信的需求自实用计算开始以来就显而易见，实现这一任务既可靠又经济困难。我们可以通过在所有主要组件之间提供充足且定制化的接口，保持精确的信号特性，并使用所有操作的公共参考时钟来控制机器的内部通信，这样接收者总是知道何时监听，发送者总是知道何时传输数据。但是，在更长的距离或非专业、廉价的接口设备上进行通信则是一个不同的挑战：计算机被迫通过一种通常不允许我们习惯于在单台机器内部进行操作的自由度进行通信。
- en: In fact, the situation is quite the opposite. The customer expects simple, convenient,
    practical, and cheap solutions, and requiring computers to be connected through
    a $100, 3-inch, 100-wire cable didn’t seem like a winning solution. Simplicity
    is a necessity. The core of any external communication channel almost always relies
    on the serial transmission of subsequent bits that only when reassembled and grouped
    together produce numeric values, text strings, or other pieces of data native
    to the machine environment of the sender or recipient. In the most seemingly trivial
    and obvious scenario, when two machines or devices connected only by a pair of
    wires need to exchange information, they do so by setting one of the wires to
    high or low voltage in relation to the other (reference) line—or by using any
    other differing signals or states, for that matter. They do so in order to send
    subsequent bits of data at a given frequency—a frequency that must be kept reasonably
    close and in sync on both devices.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，情况正好相反。客户期望简单、方便、实用且价格低廉的解决方案，而要求通过一根价值100美元、3英寸长、100芯的电缆将计算机连接起来，似乎并不是一个获胜的解决方案。简单是一个必需品。任何外部通信通道的核心几乎总是依赖于后续比特的串行传输，只有当这些比特重新组装并分组在一起时，才能产生数值、文本字符串或其他数据，这些数据是发送方或接收方机器环境中的原生数据。在最看似微不足道和明显的情况下，当仅通过一对电线连接的两台机器或设备需要交换信息时，它们通过将其中一根电线相对于另一根（参考）线设置为高电压或低电压（或者使用任何其他不同的信号或状态）来实现。它们这样做是为了以给定的频率发送后续的数据比特——这个频率必须在两个设备上保持合理接近并同步。
- en: Even in such a trivial design, a number of problems immediately arise. First,
    the devices do not share a reference clock. Although both have internal quartz-based
    clocks, no two affordable clocks are ever accurate enough to maintain reliable
    and fast communications over an extended period of time due to slight manufacturing
    imperfections, interference, and other physical conditions. And serial communications
    demand precise synchronization. The straightforward bit-encoding scheme, usually
    referred to as Non-Return to Zero (NRZ), simply outputs one signal (voltage) for
    0 and another signal for 1\. In such a system, it is easy to keep both endpoints
    synchronized when values change on a regular basis—the system simply needs to
    detect a falling or rising edge, use it as a rough reference, and adjust its own
    clock accordingly. But given a longer sequence of 1s or 0s, it becomes difficult
    for the receiving side to accurately determine how many bits are being sent. In
    fact, even a small clock drift can cause problems, and there is no way to compensate
    for this during the exchange of a constant sequence of bits.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 即使在这样的简单设计中，也会立即出现许多问题。首先，设备没有共享一个参考时钟。尽管两者都有基于石英的内部时钟，但由于细微的制造缺陷、干扰和其他物理条件，没有任何两个经济实惠的时钟足够精确，能够在较长的时间内保持可靠和快速的通信。串行通信需要精确的同步。简单的位编码方案，通常称为非归零（NRZ），简单地输出一个信号（电压）表示0，另一个信号表示1。在这样的系统中，当值定期变化时，很容易保持两端同步——系统只需检测下降或上升沿，将其用作粗略的参考，并相应地调整自己的时钟。但是，给定一个较长的1s或0s序列，接收方很难准确地确定正在发送多少比特。事实上，即使是微小的时钟漂移也可能导致问题，而且在交换恒定序列的比特时无法补偿这一点。
- en: The obvious solution, to simply interleave the data with a separate, distinguishable
    timing signal, is not always the most convenient and efficient method; increased
    complexity and reduced throughput is often perceived as a nuisance.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 显然的方法，即简单地通过一个单独的、可区分的时序信号将数据交织在一起，并不总是最方便和高效的方法；增加的复杂性和降低的吞吐量通常被视为一种麻烦。
- en: To effectively address this problem, many systems use a scheme called *Manchester
    encoding*, also known as *biphase code*. The algorithm for Manchester coding,
    shown along with NRZ in [Figure 5-1](ch05.html#serial_line_transmission_encodingsmnrz_a
    "Figure 5-1. Serial line transmission encodings—NRZ and biphase (Manchester)"),
    encodes data using signal edges, as opposed to signal levels. The original, aforementioned
    NRZ encoding uses an internal clock to measure voltage levels at a constant pace,
    interpreting low voltage as binary 0 and high voltage as 1\. Manchester encoding,
    on the other hand, carries data in transitions from low to high voltage or vice
    versa. In such a design, the signal is switched to high to denote binary 1 and
    to low to indicate 0.^([[11](#ftn.CHP-5-FN-1)])
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 为了有效地解决这个问题，许多系统使用一种称为**曼彻斯特编码**的方案，也称为**双相码**。曼彻斯特编码的算法，如[图5-1](ch05.html#serial_line_transmission_encodingsmnrz_a
    "图5-1. 串行线路传输编码——NRZ和双相（曼彻斯特)")所示，与NRZ一起展示，使用信号边缘来编码数据，而不是使用信号电平。原始的、上述NRZ编码使用一个内部时钟以恒定的速度测量电压水平，将低电压解释为二进制0，将高电压解释为1。另一方面，曼彻斯特编码通过从低电压到高电压或相反的转换来传输数据。在这种设计中，信号切换到高电平表示二进制1，切换到低电平表示0。[11](#ftn.CHP-5-FN-1)]
- en: 'Although such encoding does not require the clocks to be kept synchronized,
    it is also not quite enough as it is: there is no way to encode two binary 0s
    or 1s, because it is not possible to go from low to high voltage twice without
    returning to low halfway down the road (and vice versa). To allow this type of
    information to be encoded, transitions that occur shortly after a falling or rising
    signal edge are ignored, thus allowing the system to encode multiple occurrences
    of 0 and 1 by returning to the same voltage midcycle. To manage the “blackout”
    period after a transition, a simple one-shot interval clock is necessary.'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管这种编码不需要时钟保持同步，但它本身也并不足够：无法编码两个二进制0或1，因为不可能在不返回到低电平一半路程的情况下两次从低电压到高电压（反之亦然）。为了允许这种类型的信息被编码，忽略在下降或上升信号边缘之后立即发生的转换，从而允许系统通过在半周期中返回到相同的电压来编码0和1的多个出现。为了管理转换后的“黑屏”期，需要一个简单的单次间隔时钟。
- en: '![Serial line transmission encodings—NRZ and biphase (Manchester)](httpatomoreillycomsourcenostarchimages1138020.png.jpg)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![串行线路传输编码——NRZ和双相（曼彻斯特）](httpatomoreillycomsourcenostarchimages1138020.png.jpg)'
- en: Figure 5-1. Serial line transmission encodings—NRZ and biphase (Manchester)
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 图5-1. 串行线路传输编码——NRZ和双相（曼彻斯特）
- en: The design of a serial line based on the self-synchronizing scheme discussed
    above is often extended to provide full-duplex communications in which both parties
    can talk at once, either by using two separate lines (transmit and receive, Tx
    and Rx for short) or by using advanced echo detection and cancellation tricks
    to differentiate between its own signal and the data sent from the other side.
    Some mediums require or allow for more sophisticated signaling schemes, for example
    sending more than just one bit in every cycle; yet the principle of communications
    remains essentially the same, and Manchester encoding over the lowest possible
    number of wires—often two—is prevalent across the entire domain.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 基于上述讨论的自同步方案的串行线路设计通常被扩展以提供全双工通信，在这种通信中，双方可以同时交谈，要么通过使用两条独立的线路（发送和接收，简称Tx和Rx）或通过使用高级回声检测和消除技巧来区分其自身的信号和从另一侧发送的数据。某些介质需要或允许更复杂的信号方案，例如在每个周期中发送不止一个比特；然而，通信的基本原理仍然是相同的，在整个领域内，使用最低可能数量的线——通常是两条——的曼彻斯特编码非常普遍。
- en: Equipped with a knowledge of the basics of “wire pair” serial communications,
    let’s take a peak at two prominent examples of serial communications in the world
    of networking, see how they exchange data internally, and look at how this information
    can leak to third parties without the user noticing.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 在掌握了“线对”串行通信的基本知识后，让我们来看看网络世界中两个突出的串行通信示例，看看它们如何内部交换数据，以及如何查看这些信息在没有用户注意的情况下泄露给第三方。
- en: From Your Email to Loud Noises . . . Back and Forth
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 从您的电子邮件到大声噪音……来回往返
- en: The most popular long-distance computer communications device is, hands down,
    a modem. Initially introduced in the 1950s for the maintenance and control of
    certain types of military equipment at remote locations, the modem brought the
    Internet to the masses. Although today often considered some-what obsolete, the
    modem has given birth to many advanced technologies, such as affordable high-speed
    DSL (Digital Subscriber Line) systems or cable modems. These devices all use clever
    variations of the same set of techniques to communicate over phone lines or other
    nondedicated analog media using either audible or inaudible signals. The research
    invested in improving modems also contributed to our understanding of numerous
    large-scale design problems in electronics in general and computer and network
    design in particular. Thus, an understanding of how modems work is key to exploring
    other, perhaps more up-to-date, methods of long-distance data transmission.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 毫无疑问，最受欢迎的长距离计算机通信设备是调制解调器。最初在20世纪50年代推出，用于在偏远地点维护和控制某些类型的军事设备，调制解调器将互联网带给了大众。尽管今天通常被认为有些过时，但调制解调器催生了许多先进技术，例如经济实惠的高速数字用户线路（DSL）系统或电缆调制解调器。这些设备都使用相同技术集的巧妙变体，通过电话线或其他非专用模拟媒介使用可听或不可听信号进行通信。对改进调制解调器所投入的研究也促进了我们对电子学中众多大规模设计问题的理解，特别是计算机和网络设计。因此，了解调制解调器的工作原理对于探索其他，可能更现代的长距离数据传输方法至关重要。
- en: 'The universality of the telephone line makes it a natural medium for computers
    to use for communication. Phone lines can be found almost anywhere, and phone
    systems provide excellent call-routing capabilities, making it possible to reach
    just about any location with little if any effort. There is a tiny caveat, though:
    phone lines were meant to carry the human voice, transmitted as a waveform, within
    narrow-frequency response range (usually not exceeding several kHz). Because these
    frequencies were recorded as voltage changes over a pair of wires and relayed
    through a number of analog repeaters and amplifiers, the standard of quality for
    the transmission wasn’t particularly high. It had to be just good enough for people
    to hear and understand each other, and because the human brain is a superb signal
    filtering and processing system, occasional noise or sound-level fluctuations
    were not much of a concern—not until much later on, when customers grew a bit
    picky.'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 电话线的通用性使其成为计算机用于通信的自然媒介。电话线几乎无处不在，电话系统提供了出色的呼叫路由能力，使得几乎可以轻松地到达任何地点。然而，有一个小小的注意事项：电话线原本是为了传输人类声音而设计的，这些声音以波形形式在狭窄的频率响应范围内（通常不超过几kHz）传输。因为这些频率被记录为两根电线上的电压变化，并通过多个模拟中继器和放大器进行传输，所以传输的标准质量并不特别高。它只需要足够好，以便人们能够听到并理解对方，而且由于人脑是一个出色的信号滤波和处理系统，偶尔的噪音或音量波动并不是什么大问题——直到后来，当客户变得稍微挑剔一些。
- en: 'Computers, on the other hand, are generally engineered to exchange binary information,
    which is encoded using fairly precise voltage levels over well-designed, short
    lines with good signal characteristics and low capacitance—an exact opposite of
    long-distance, poorly shielded telephone lines with inadequate signal characteristics.
    Computers also need to talk much faster and much more than humans usually do.
    As such, modem designers had (huge understatement here) a difficult challenge
    to solve: They had to determine a way to encode bits of data not only in a manner
    that could be efficiently transmitted to a remote system over the wire (something
    that Manchester encoding made a bit easier), but also as audible signals that
    could be accurately distinguished at the other end of the line regardless of often
    entirely unpredictable voltage changes and other transmission artifacts. They
    had to employ robust error-correction algorithms and variable transmission speeds
    to compensate for poor line quality, occasional cross talk, trucks going over
    a buried phone line, birds building a nest on a pole, and so forth. The designers
    nodded, scratched their heads, and after perhaps just 40 years brought us an affordable
    and fairly fast method for computer-to-computer communication. Let’s take an abbreviated
    look at how this developed and how the technology matured—yet essentially stayed
    the same—over the decades that followed.'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 与此相反，计算机通常被设计用来交换二进制信息，这些信息通过在精心设计的、较短的线路中使用相当精确的电压水平进行编码，这些线路具有良好的信号特性和低电容——这与长距离、保护不良且信号特性不足的电话线路正好相反。计算机还需要比人类通常的速度快得多，并且需要交流的信息量也大得多。因此，调制解调器设计师们（这里是一个巨大的夸张）面临着一项艰巨的挑战：他们必须确定一种方法来编码数据位，不仅能够通过线路高效地传输到远程系统（曼彻斯特编码使这一点变得稍微容易一些），而且还能够作为可听信号，在线路的另一端准确地区分，无论电压变化和其他传输伪影通常是完全不可预测的。他们必须采用鲁棒的错误纠正算法和可变传输速度来补偿线路质量差、偶尔的串扰、卡车压过地下电话线、鸟儿在电线杆上筑巢等情况。设计师们点头、挠头，也许在40年后，他们为我们带来了一个既经济又相当快速的计算机间通信方法。让我们简要地看看这一发展过程以及技术是如何在接下来的几十年中成熟——尽管本质上保持不变。
- en: 'The history of commercial modem development and standardization began in the
    1960s when two standards, Bell 103/113 and V.21, were conceived. Both standards
    provided an amazing (for the time) 300-baud (bits per second) full-duplex connectivity
    using a technique called *frequency shift keying* (FSK). FSK is a mysterious-sounding
    term that happens to stand for a rather trivial signal-encoding scheme: it uses
    two different tones to denote different values, one frequency for “low,” and another
    frequency for “high.” The advantage of using audible frequencies over other types
    of signaling is rather significant: this is the only type of signal that can be
    relayed through the phone system fairly well—after all, this is what the system
    was designed for. All other signals are more or less destined to be trashed beyond
    recognition before reaching the other end of the wire, in the best-case scenario,
    or being immediately filtered out by bandpass filters somewhere down the line
    in the worst case.'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 商业调制解调器开发和标准化的历史始于20世纪60年代，当时提出了两个标准，即Bell 103/113和V.21。这两个标准都提供了一种在当时令人惊叹的300波特（每秒比特数）全双工连接，使用的技术称为*频率移位键控*（FSK）。FSK是一个听起来很神秘的术语，实际上代表了一种相当简单的信号编码方案：它使用两种不同的音调来表示不同的值，一个频率表示“低”，另一个频率表示“高”。使用可听频率而不是其他类型信号的优势相当显著：这是唯一一种可以在电话系统中相当好地转发的信号——毕竟，这就是系统的设计目的。所有其他信号在最佳情况下可能被彻底破坏，在最坏的情况下，可能被线路某处的带通滤波器立即过滤掉。
- en: 'In addition to FSK encoding, the aforementioned Bell 103/113 and V.21 standards
    split the frequency range that could be transmitted over phone lines in two: one
    of the modems, the caller, used a frequency of 980 Hz to encode low and 1,180
    Hz to encode high. The other end, the answerer, used the higher part of the spectrum:
    1,650 Hz and 1,850 Hz, respectively. Why split the frequency in this way? Because
    a phone line is essentially just a pair of wires, which can be used for transmission
    by two devices simultaneously (full duplex), but only if they are capable of dealing
    with the fact that their respective transmissions would superimpose on each other.
    In full-duplex communication, each device must be able to distinguish its own
    signal from the data it’s receiving and filter it out. If it cannot do so successfully,
    each device would have to pause while the other end is talking (simplex mode),
    severely impairing the already sort of unimpressive throughput. By splitting the
    frequency, the phone line is essentially made to carry what it sees as two different
    “voices,” thus ensuring that simultaneous communication can occur with no collisions.'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 除了FSK编码外，上述贝尔103/113和V.21标准将电话线可以传输的频率范围分成两部分：一端调制解调器，即呼叫者，使用980 Hz来编码低频，使用1,180
    Hz来编码高频。另一端，即应答者，使用频谱的高部分：分别为1,650 Hz和1,850 Hz。为什么以这种方式分割频率？因为电话线本质上只是一对电线，可以被两个设备同时用来传输（全双工），但前提是它们能够处理它们各自的传输会相互叠加的事实。在全双工通信中，每个设备必须能够区分自己的信号和它接收到的数据，并将其过滤掉。如果不能成功做到这一点，每个设备在另一端说话时都必须暂停（单工模式），这会严重损害已经不太令人印象深刻的吞吐量。通过分割频率，电话线本质上被用来传输它视为两个不同的“声音”，从而确保可以无冲突地同时进行通信。
- en: It took 25 more years for modems to take another step in the right direction.
    The next major set of standards, Bell 212A and V.22, took a big leap forward and
    dropped frequency shift keying in favor of *differential phase shift keying* (DPSK).
    Rather than change the frequency of a wave, DPSK shifts its phase to signal different
    values.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 调制解调器在正确的方向上又迈出了25年的步伐。下一个主要的标准集，贝尔212A和V.22，迈出了巨大的步伐，并放弃了频率移位键控，转而采用*差分相移键控*（DPSK）。DPSK不是改变波的频率，而是通过改变其相位来表示不同的值。
- en: The phase shift technique essentially introduces a minimal time shift, or delay,
    that causes the output audio signal to be slightly out of sync with the original
    reference wave, while maintaining exactly the same shape (see [Figure 5-2](ch05.html#frequency_shift_versus_phase_shift
    "Figure 5-2. Frequency shift versus phase shift")).
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 相移技术本质上引入了最小的时间移位或延迟，导致输出音频信号略微与原始参考波不同步，同时保持完全相同的形状（参见[图5-2](ch05.html#frequency_shift_versus_phase_shift
    "图5-2. 频率移位与相移")）。
- en: '![Frequency shift versus phase shift](httpatomoreillycomsourcenostarchimages1138022.png.jpg)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
  zh: '![频率移位与相移对比](httpatomoreillycomsourcenostarchimages1138022.png.jpg)'
- en: Figure 5-2. Frequency shift versus phase shift
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 图5-2. 频率移位与相移
- en: 'The value of the phase shift, also called the *shift value*, is expressed in
    degrees (a reference to its effect on trigonometric functions: y = sin(x) shifted
    by 90° is exactly the same as y = sin(90° + x). A shift value of 360° denotes
    a shift by the entire wavelength, which simply puts the waves right back in sync
    and has no effect on the waveform. The correspondence of various phase shifts
    is shown in [Figure 5-3](ch05.html#phase_shifted_signals_open_parenthesis_l "Figure 5-3. Phase
    shifted signals (left) and a result of subtracting a reference waveform to more
    easily distinguish between phases (right)"), on the left.'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 相移的值，也称为*移位值*，用度数表示（这是对其对三角函数影响的一个参考：y = sin(x)通过90°移位与y = sin(90° + x)完全相同。360°的移位值表示整个波长的移位，这简单地将波重新同步，对波形没有影响。各种相移的对应关系如图[图5-3](ch05.html#phase_shifted_signals_open_parenthesis_l
    "图5-3. 相移信号（左）和通过减去参考波形以更容易区分相位的成果（右）")所示，在左侧。
- en: Once both parties are synchronized and have a way to compare the signal received
    over the cable with the expected waveform, the actual encoded data can be easily
    retrieved. A differential circuit can compare two signals, subtract them, and
    easily determine the exact phase shift of the signal, by comparing it to a reference
    signal, as shown in [Figure 5-3](ch05.html#phase_shifted_signals_open_parenthesis_l
    "Figure 5-3. Phase shifted signals (left) and a result of subtracting a reference
    waveform to more easily distinguish between phases (right)"), on the right.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦双方同步并且有方法将电缆接收到的信号与预期的波形进行比较，实际编码的数据就可以轻松检索。差分电路可以比较两个信号，将它们相减，并通过将其与参考信号进行比较，轻松确定信号的精确相位偏移，如图[图5-3](ch05.html#phase_shifted_signals_open_parenthesis_l
    "图5-3. 相位偏移信号（左）和减去参考波形以更容易区分相位的結果（右）")所示，在右侧。
- en: The new standard also took advantage of a more advanced data-encoding method.
    Instead of simply using two alternating signals to transmit 0s and 1s, as was
    the case previously, V.22 encodes whole *dibits*—slang for pairs of bits. Encoding
    two bits at once can be achieved using four phase shift values, with the amount
    of shift used to denote each of the possible values chosen so that values are
    uniformly and possibly farthest spaced through the entire 360° spectrum—and thus
    easily distinguishable from each other (see [Table 5-1](ch05.html#using_phase_shifts_to_encode_two_bits_of
    "Table 5-1. Using phase shifts to encode two bits of data (dibit)")).
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 新标准还利用了一种更先进的数据编码方法。与之前简单地使用两个交替信号来传输0和1的情况不同，V.22编码整个*二进制*——即比特对的俚语。一次编码两个比特可以通过使用四个相位偏移值来实现，所使用的偏移量用来表示每个可能的值，以便值在整个360°频谱中均匀分布，并且可能相隔最远——因此可以很容易地区分彼此（参见[表5-1](ch05.html#using_phase_shifts_to_encode_two_bits_of
    "表5-1. 使用相位偏移来编码两个比特的数据（二进制)”))。
- en: '![Phase shifted signals (left) and a result of subtracting a reference waveform
    to more easily distinguish between phases (right)](httpatomoreillycomsourcenostarchimages1138024.png.jpg)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![相位偏移信号（左）和减去参考波形以更容易区分相位的結果（右）](httpatomoreillycomsourcenostarchimages1138024.png.jpg)'
- en: Figure 5-3. Phase shifted signals (left) and a result of subtracting a reference
    waveform to more easily distinguish between phases (right)
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 图5-3. 相位偏移信号（左）和减去参考波形以更容易区分相位的結果（右）
- en: The use of dibits allowed for significantly faster transfer speed (1,200 baud)
    without the need to increase the physical rate with which the actual signal was
    modulated. Twice as much information—twice as many bits—was carried within every
    single beep.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 使用二进制允许显著提高传输速度（1,200 波特），而无需增加实际信号调制的物理速率。每个单个蜂鸣声可以携带两倍多的信息——两倍的比特数。
- en: Table 5-1. Using phase shifts to encode two bits of data (dibit)
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 表5-1. 使用相位偏移来编码两个比特的数据（二进制）
- en: '| Dibit | Phase Shift |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| Dibit | 相位偏移 |'
- en: '| --- | --- |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| `00` | 90° |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| `00` | 90° |'
- en: '| `01` | 0° |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '| `01` | 0° |'
- en: '| `10` | 180° |'
  id: totrans-41
  prefs: []
  type: TYPE_TB
  zh: '| `10` | 180° |'
- en: '| `11` | 270° |'
  id: totrans-42
  prefs: []
  type: TYPE_TB
  zh: '| `11` | 270° |'
- en: Note
  id: totrans-43
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 备注
- en: Although it is theoretically possible to use such an extended alphabet—that
    is, composite signal units similar to dibits (that have more than two states and
    thus encode more than one bit at once)—with FSK encoding as well, it is a bit
    more problematic to do so. FSK signals must avoid subharmonics and other frequencies
    that are particularly prone to distortion when sent through phone systems, thus
    severely limiting the set of possible states. The advantage of DPSK over FSK is
    that it uses a fixed frequency that is known to cause the fewest transmission
    problems and, hence, can be used more reliably at higher transmission rates.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然在理论上使用这种扩展字母表——即类似于二进制（具有超过两种状态，因此可以一次编码多个比特）的复合信号单元——与FSK编码也是可能的，但这样做会有些问题。FSK信号必须避免通过电话系统发送时特别容易失真的次谐波和其他频率，从而严重限制了可能的状态集。DPSK相对于FSK的优势在于它使用一个已知会导致最少传输问题的固定频率，因此可以在更高的传输速率下更可靠地使用。
- en: In the next few years, the pace of research accelerated a bit, and a number
    of new standards surfaced. The V.22bis standard took the concept of wide alphabet
    signaling a bit further, combining DPSK with signal amplitude (loudness) modulation
    to build a two-dimensional set of 16 possible values. The transition from a measured
    signal to binary values was expressed using a two-dimensional table. The value
    to which a signal corresponds is obtained by first looking up the column, based
    on the measured phase-shift value, and then the row is looked up based on the
    amplitude measurement. A simplified but analogous two-by-four example is shown
    in [Table 5-2](ch05.html#two-dimensional_encoding_of_three_bits "Table 5-2. Two-dimensional
    encoding of three bits using two distinct signal parameters").
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的几年里，研究步伐加快了一些，出现了一些新的标准。V.22bis 标准将宽字母表信号的概念进一步发展，将 DPSK 与信号幅度（响度）调制相结合，构建了一个包含
    16 个可能值的二维集合。从测量信号到二进制值的转换使用二维表格表示。信号对应的值首先根据测量的相位偏移值查找列，然后根据幅度测量查找行。一个简化的但类似的二乘四示例显示在[表
    5-2](ch05.html#two-dimensional_encoding_of_three_bits "表 5-2. 使用两个不同的信号参数对三个比特进行二维编码")中。
- en: Table 5-2. Two-dimensional encoding of three bits using two distinct signal
    parameters
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 表 5-2. 使用两个不同的信号参数对三个比特进行二维编码
- en: '|   | Phase 0° | Phase 90° | Phase 180° | Phase 270° |'
  id: totrans-47
  prefs: []
  type: TYPE_TB
  zh: '|    | 相位 0° | 相位 90° | 相位 180° | 相位 270° |'
- en: '| --- | --- | --- | --- | --- |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- |'
- en: '| **Low amplitude** | 000 (0) | 001 (1) | 010 (2) | 011 (3) |'
  id: totrans-49
  prefs: []
  type: TYPE_TB
  zh: '| **低幅度** | 000 (0) | 001 (1) | 010 (2) | 011 (3) |'
- en: '| **High amplitude** | 100 (4) | 101 (5) | 110 (6) | 111 (7) |'
  id: totrans-50
  prefs: []
  type: TYPE_TB
  zh: '| **高幅度** | 100 (4) | 101 (5) | 110 (6) | 111 (7) |'
- en: To add to the confusion, this new approach was called *quadrature amplitude
    modulation* (QAM). QAM once again made it possible to go from 1,200 to 2,400 bps
    without actually improving signal modulation speed, but by extending the number
    of meanings a single atom of signal can have.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 为了增加混乱，这种新方法被称为**正交幅度调制**（QAM）。QAM 再次使得从 1,200 bps 提高到 2,400 bps 成为可能，而实际上并没有提高信号调制速度，而是通过扩展单个信号原子可以具有的意义的数量。
- en: 'The next major evolutionary step was V.32\. V.32 was the first design to introduce
    a novel concept: instead of splitting frequencies, it used advanced echo cancellation
    circuitry^([[12](#ftn.CHP-5-FN-2)]) to detect and subtract the signal transmitted
    by the device itself from the data received over the wire. This technique allowed
    both devices (sender and receiver) to use the entire frequency spectrum, instead
    of just half of it, while still doing full-duplex.'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个主要的发展步骤是 V.32。V.32 是第一个引入新概念的设计：它不是分割频率，而是使用先进的回波消除电路^([[12](#ftn.CHP-5-FN-2)])来检测和减去设备本身通过线路传输的信号。这项技术使得发送方和接收方都可以使用整个频谱，而不仅仅是其中的一半，同时仍然进行全双工通信。
- en: Development continued, and the V.34 protocol soon appeared. Although the rate
    at which the signal could safely alternate before introducing excessive distortion
    did not noticeably change over the years, the standard was considerably faster
    than its predecessors. V.34 achieves a throughput of 28,800 baud, sometimes pushed
    a bit further by manufacturers to a unofficial speed of 33,600 baud (33.6 Kbps)
    by sending only about 2,500 to 3,500 signal samples (alphabet symbols) per second;
    however, it combines four different encoding schemes to build a four-dimensional
    structure with 1,664 possible states, making it possible to send as many as 41
    bits at once. As it turns out, it’s not about raw speed but how you use what you’ve
    got.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 发展持续进行，V.34 协议很快出现。尽管在多年间，信号在引入过度失真之前可以安全交替的速度没有明显变化，但该标准比其前辈要快得多。V.34 实现了 28,800
    波特的吞吐量，有时通过制造商仅发送大约 2,500 到 3,500 个信号样本（字母表符号）每秒，将其推到了一个非官方的速度 33,600 波特（33.6
    Kbps）；然而，它结合了四种不同的编码方案，构建了一个具有 1,664 个可能状态的四维结构，使得一次可以发送多达 41 比特。实际上，这并不是关于原始速度，而是关于如何使用你所拥有的。
- en: 'It is widely believed that the V.34 standard and its derivatives approach the
    theoretical limit for transmission of data via the voice-oriented telephone system.
    Although this may seem an odd statement given the prevalence of 56 Kbps modems,
    there is a catch: 56 Kbps devices achieve this transmission rate in a wholly different
    way than in analog solutions. Given that most phone systems have migrated from
    analog to digital since modems were first developed, and because most dial-up
    providers can now interface their systems directly with digital telecommunication
    systems, service providers can return to the most obvious but, until recently,
    impossible solution: changing line voltages instead of shifting frequencies when
    sending data to a subscriber. Because the signal is carried as digital data from
    the beginning—and can travel over buried copper lines only till the nearest telco
    facility—there are virtually no signal quality problems, and the only limit is
    the voice-carrying capacity designed into the phone system hardware. Working at
    8,000 symbols per second, but operating with a considerably smaller alphabet (usually
    about 128 symbols, or voltage levels), it is possible to send data to a subscriber
    who is connected to a digital phone system with high-quality wire using a 56 Kbps
    modem at a higher speed than usual. The upstream transfer is still implemented
    the old-fashioned way, though, and is considerably slower; as such, the modem
    is only partly 56 Kbps, and only when conditions permit.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 人们普遍认为，V.34标准及其衍生标准在通过以语音为导向的电话系统传输数据方面接近理论极限。尽管考虑到56 Kbps调制解调器的普遍存在，这个说法可能显得有些奇怪，但有一个转折：56
    Kbps设备以与模拟解决方案完全不同的方式实现这种传输速率。鉴于大多数电话系统自从调制解调器最初开发以来已经从模拟迁移到数字，并且大多数拨号服务提供商现在可以直接将他们的系统与数字电信系统接口，服务提供商可以回归最明显但直到最近仍不可能的解决方案：在向用户发送数据时改变线路电压而不是改变频率。因为信号从一开始就是以数字数据的形式传输的——并且只能通过埋设的铜线传输到最近的电信设施——实际上没有信号质量问题，唯一的限制是电话系统硬件中设计的语音承载能力。以每秒8,000个符号的速度工作，但使用相当小的字母表（通常约为128个符号或电压等级），可以使用56
    Kbps调制解调器以比通常更高的速度向连接到数字电话系统的用户发送数据。尽管上行传输仍然以传统方式实现，速度相当慢；因此，调制解调器只部分达到56 Kbps，并且只有在条件允许的情况下。
- en: The Day Today
  id: totrans-55
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 今天的日子
- en: 'Not much has changed since the conception of modem technology. As transmission
    protocols advanced, so did the error-correction and fallback mechanisms needed
    to ensure reliable transmission when your favorite quadruped decides to chew the
    phone cable. A jungle of standards were spawned: V.42 provided a basic CRC (cyclic
    redundancy check) implementation, MNP-1 to MNP-4 provided proprietary error-correction
    algorithms, V.42bis and MNP-5 provided integrity checking combined with compression,
    and so on. But the real revolution is yet to come.'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 自从调制解调器技术的构想以来，变化不大。随着传输协议的进步，所需的错误纠正和回退机制也相应发展，以确保当您最喜欢的四足动物决定咬电话线时，仍能保证可靠的传输。产生了许多标准：V.42提供了一个基本的CRC（循环冗余检查）实现，MNP-1到MNP-4提供了专有的错误纠正算法，V.42bis和MNP-5提供了完整性检查与压缩相结合，等等。但真正的革命尚未到来。
- en: 'Or is it? You might argue that DSL and cable modems are a revolutionary technology
    that has changed the world. I am willing to argue: in fact, they are quite similar
    to their older cousins, modems. The only significant difference between the two
    is that the other endpoint—the server that handles all connections—has moved from
    a distant city where the service provider is located to the nearest local telco
    facility, and the connection to it can be made directly using the copper wire
    coming from the customer’s residence or business. Because that direct connection
    again does not go through any other equipment, these devices can use high, inaudible
    frequencies and subtler signals that would otherwise be distorted or not relayed
    at all over the telephone network. In contrast, the good old modem was strictly
    limited to a narrow range of audible frequencies and signals that the phone system
    was intended to carry and that it could carry well. In many ways, DSL devices
    have it much easier than the old modem.'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 或者是吗？你可能会争辩说，DSL和电缆调制解调器是一项革命性的技术，它改变了世界。我愿意争辩：事实上，它们与它们的较老版本——调制解调器——非常相似。这两者之间唯一的显著区别是，另一个端点——处理所有连接的服务器——已经从服务提供商所在的城市移动到了最近的本地电信设施，并且可以通过来自客户住宅或商业建筑的铜线直接连接到它。因为这种直接连接再次没有通过任何其他设备，这些设备可以使用高、不可听见的频率和更微妙的信号，否则这些信号会在电话网络中被扭曲或根本无法中继。相比之下，那个好老的调制解调器严格限于电话系统旨在携带并且能够良好携带的窄带范围内的可听频率和信号。在许多方面，DSL设备比老式调制解调器更容易。
- en: As we see, designing a modem is actually quite a complex and difficult task;
    that’s why it took us decades to advance from bulky and expensive 300-baud devices
    to where we are now.^([[60](apb.html#ftn.CHP-5-BIB-1)]) Surprisingly, all these
    devices can talk to one another, even to devices ten years older, even at the
    lowest speeds we long forgot about. Too, all are usually aware of the standards
    known to date, including the dozens of alternatives and forks of each. Doesn’t
    that make modems even more a marvel of computer engineering?
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们所见，设计调制解调器实际上是一项相当复杂和困难的任务；这就是为什么我们花了数十年时间从笨重且昂贵的300波特设备发展到现在的水平.^([[60](apb.html#ftn.CHP-5-BIB-1)])
    令人惊讶的是，所有这些设备都可以相互通信，甚至可以与十年前的设备通信，即使是在我们早已遗忘的最低速度下。同样，它们通常都了解迄今为止的规范，包括每个规范的数十个替代方案和分支。这难道不是使调制解调器成为计算机工程奇迹的另一个原因吗？
- en: But who pulls the strings?
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 但是谁在拉这些线呢？
- en: Sometimes, a Modem Is Just a Modem
  id: totrans-60
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 有时，调制解调器仅仅是一个调制解调器
- en: 'Modem-to-modem communications is, of course, not where the story starts or
    ends. The modem is just a piece of fairly inert middleware that’s hardly even
    a good paperweight. For a modem to be of any use, it must be able to communicate
    with a computer to receive commands and exchange data, even when it’s only being
    used for something as feeble as random web browsing. Internal modems have it easy:
    ISA (Integrated Systems Architecture), PCI (Peripheral Component Interconnect),
    PCMCIA (PC Memory Card International Association), and some other dedicated buses
    provide high-speed and fairly generous parallel interfaces that make the communication
    process almost trivial.'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 调制解调器之间的通信当然不是故事开始或结束的地方。调制解调器只是一个小巧而几乎无用的中间件，甚至不是一个好的镇纸。为了使调制解调器有用，它必须能够与计算机通信以接收命令和交换数据，即使它只是被用于像随机网页浏览这样微不足道的事情。内置调制解调器比较容易：ISA（集成系统架构）、PCI（外围组件互连）、PCMCIA（PC内存卡国际协会）以及一些其他专用总线提供了高速且相当慷慨的并行接口，使得通信过程几乎变得微不足道。
- en: External modems (of the analog or DSL kind), however, have to do things the
    hard way, with a serial link. Most analog modems use the well-known serial protocol
    RS-232 (renamed in the ’90s to the much more descriptive EIA/TIA-232-E^([[61](apb.html#ftn.CHP-5-BIB-2)]));
    many newer ones use USB (Universal Serial Bus). As we get close to the information
    disclosure scenarios in those devices, we want to get a glimpse of what happens
    to the data on its way between the modem and the computer, too, because that plays
    a crucial role in the attack.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，外置调制解调器（无论是模拟的还是DSL类型的）必须通过串行链路来处理事情。大多数模拟调制解调器使用众所周知的串行协议RS-232（在90年代更名为更具描述性的EIA/TIA-232-E^([[61](apb.html#ftn.CHP-5-BIB-2)]));许多较新的调制解调器使用USB（通用串行总线）。当我们接近这些设备的信息披露场景时，我们还想一瞥调制解调器和计算机之间数据传输过程中发生的事情，因为这在攻击中起着至关重要的作用。
- en: Although external modems have to use inhumane means of communicating not only
    with a remote system, but also with the local machine itself, thanks to the proximity
    to the computer and the fact that interfaces such as RS-232 are digital and were
    designed for use by computers to start with, this stage is still much simpler
    than the phone line modulation and demodulation for which bit modems became famous.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管外部调制解调器必须使用不人道的手段与远程系统以及本地机器本身进行通信，但由于计算机的邻近性和接口如RS-232是数字的，并且最初是为计算机设计的，这一阶段仍然比著名的电话线路调制解调器的调制解调和解调要简单得多。
- en: 'RS-232 uses a fairly straightforward implementation of bipolar encoding for
    the data exchanged over two separate lines and backs this with a set of NRZ control
    lines. To make life a bit more interesting, RS-232 comes with a multitude of link
    or protocol features that make it fairly difficult to implement from scratch:
    its asynchronous nature, a wide array of possible settings and speeds, and unusual
    voltage levels. But with all this, RS-232 still does not even come close to a
    real challenge for an implementator who had dealt with signal modulation over
    phone lines.'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: RS-232使用了一种相当直接的二进制编码实现，用于在两条独立的线上交换数据，并辅以一组NRZ控制线。为了让生活更有趣，RS-232还提供了一系列的链路或协议功能，这使得从头开始实现它变得相当困难：它的异步特性、广泛的可能设置和速度，以及不寻常的电压水平。但即便如此，对于处理过电话线路信号调制的实现者来说，RS-232仍然算不上真正的挑战。
- en: USB, on the other hand, attempts to standardize and unify the serial interface.
    Although USB requires higher-end circuitry than RS-232 in order to interface a
    computer with a device (because of, among other things, a higher level of abstraction
    and higher supported transmission speeds), the USB is universal (hence its name)
    and has fewer oddities and legacy features.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，USB试图标准化和统一串行接口。尽管USB需要比RS-232更高端的电路来连接计算机和设备（其中之一是因为更高的抽象层次和更高的支持传输速度），但USB是通用的（因此得名），并且具有更少的怪异性和遗留功能。
- en: Last but not least, a common method of communicating with local devices is the
    use of Ethernet, a mechanism somewhat similar to, but predating, USB. Let us look
    at Ethernet for a while now, and I am sure all those communication protocols will
    eventually meet in one place.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 最后但同样重要的是，与本地设备通信的常用方法是使用以太网，这是一种与USB类似但更早出现的机制。让我们现在来看看以太网，我相信所有这些通信协议最终都会在同一个地方相遇。
- en: Collisions Under Control
  id: totrans-67
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 控制碰撞
- en: Ethernet networks are, in essence, an advanced type of a multiparty serial link.^([[62](apb.html#ftn.CHP-5-BIB-3)])
    An Ethernet network is composed of a number of computers connected by a shared
    medium—nothing particularly complex, in its most basic form, just a pair of fairly
    regular wires. When a device on the network uses the medium, it applies a specific
    voltage to the wire, and all other connected systems can interpret the data by
    measuring the voltages. A set of checks ensures that devices do not try to use
    the link at the same time and that recovery is smooth if an accident happens.
    Still, even considering this possibility, the basic design is unbelievably trivial,
    compared with modems.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 从本质上讲，以太网网络是一种多党串行链路的高级类型。[62](apb.html#ftn.CHP-5-BIB-3) 一个以太网网络由多个通过共享介质连接的计算机组成——在最基本的形式中，这只是一对相当规则的电线。当网络上的设备使用介质时，它会将特定的电压应用到电线上，所有其他连接的系统都可以通过测量电压来解释数据。一系列的检查确保设备不会同时尝试使用链路，如果发生意外，恢复过程将很顺利。尽管如此，即使考虑到这种可能性，与调制解调器相比，基本设计仍然令人难以置信地简单。
- en: To work around the problem of two parties talking at once, a standard named
    Carrier Sense Multiple Access with Collision Detection (CSMA/CD) is used as the
    core mechanism controlling all communication via Ethernet. Before sending any
    data, every device connected to Ethernet follows a CSMA procedure to see if another
    device is using the cable by checking the modem’s electrical properties. If no
    other transmission is occurring, the device enters the transmission phase and
    beams its data out to the masses.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 为了解决双方同时说话的问题，使用了一个名为载波侦听多路访问与碰撞检测（CSMA/CD）的标准作为控制所有通过以太网通信的核心机制。在发送任何数据之前，连接到以太网的每个设备都遵循CSMA程序，通过检查调制解调器的电气特性来查看是否有其他设备正在使用电缆。如果没有其他传输发生，设备进入传输阶段，并将数据发送给所有设备。
- en: In this phase, the data is sent on the wire as a sequence of bits using *bipolar
    encoding*; the traffic contains a header with all the necessary sender and recipient
    information and a proper checksum intended to protect the integrity of the data
    in case of external or internal interference, quadruped or not. A network interface
    that considers itself to be acting on behalf of a recipient, presumably by comparing
    the observed destination address provided in the packet with its unique MAC (hardware)
    address stored on the card, should accept this traffic and verify the checksum.
    At the same time, all other parties should ignore this frame; naturally, if they
    do not (and almost every card can be instructed not to), the user can view or
    react to traffic addressed to others. (You can see how Ethernet was designed in
    the spirit of far-fetched trust and altruism—a noble but risky approach.)
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个阶段，数据以比特序列的形式通过*双极性编码*在电线上发送；流量包含一个带有所有必要发送者和接收者信息以及一个适当的校验和的报头，旨在保护数据在遭受外部或内部干扰时的完整性，无论是四足动物还是其他。一个将自己视为代表接收方行事的网络接口，可能通过比较数据包中提供的观察到的目标地址与其存储在卡上的唯一MAC（硬件）地址进行比较，应该接受这种流量并验证校验和。同时，所有其他方都应该忽略这个帧；自然地，如果他们不这样做（几乎每张卡都可以被指示不要这样做），用户可以查看或对指向其他人的流量做出反应。（你可以看到以太网是如何在设计精神上体现了远不可及的信任和利他主义——一种高尚但风险较高的方法。）
- en: It is possible (and not very unlikely) for two devices on an Ethernet network
    to start sending at exactly the same moment, even though both checked just microseconds
    or nanoseconds ago for another party transmitting. And, if they do transmit at
    exactly the same moment, a disaster is bound to happen. Two transmissions are
    mixed up and mangled, and the sent data should fail the checksum test at the destination
    . . . or should it?
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 在以太网网络上，两个设备可能在同一时刻开始发送数据，尽管它们刚刚检查了微秒或纳秒前是否有其他方正在传输。如果它们确实在完全相同的时刻传输，灾难几乎是不可避免的。两个传输被混合并损坏，发送的数据在目的地应该无法通过校验和测试……或者不是吗？
- en: Although the use of a checksum implemented within the Ethernet frame specification
    is typically sufficient to verify data transmission accuracy, it may not be particularly
    effective if the link is saturated and hundreds or thousands of collisions occur
    in a short period of time; it is just small enough to accidentally come out correct
    from time to time. The law of probabilities tells us that some damaged packets
    will—just by chance—have the same check-sum as an original packet. Furthermore,
    even if we ignore the problem of checksum deficiencies, we still want to stop
    collisions as soon as possible—by just letting collisions run rampant, you might
    find that you are no longer able to ensure the timely retransmissions of mangled
    and dropped frames in your network. After all, the sender sent it with no indication
    of a problem, and the recipient did not receive anything even remotely resembling
    a useful packet.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管在以太网帧规范中实现的校验和通常足以验证数据传输的准确性，但如果链路饱和且在短时间内发生数百或数千次冲突，它可能并不特别有效；它只是足够小，有时会意外地正确。概率法则告诉我们，一些损坏的包——仅仅通过偶然——会有与原始包相同的校验和。此外，即使我们忽略校验和不足的问题，我们仍然希望尽快停止冲突——如果让冲突肆虐，你可能会发现你不再能够确保网络中损坏和丢失的帧的及时重传。毕竟，发送者发送时没有表明任何问题，而接收者甚至没有收到任何类似有用数据包的东西。
- en: 'The solution comes with the latter part of the standard: collision detection
    (CD). The specification calls for the sender to monitor the network link while
    explaining their business to others. If another party is caught trying to talk
    at the same time, that should be detected (again, with a simple measurement of
    the electrical properties of the line), and the transmission should be immediately
    aborted. The device should also send a special jam code to ensure that both frames
    (the one being sent and the one that interfered with it) will be unconditionally
    dropped, without even getting to the checksum verification; the recipient should
    be able to spot the jam code and stop the reception of data being processed. The
    device then idles for a gradually increasing and preferably (initially) random
    period of time after every attempt (called retransmission backoff), to minimize
    the likelihood of a subsequent collision.'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 解决方案包含标准的后半部分：碰撞检测（CD）。规范要求发送者在向他人解释他们的业务时监控网络链路。如果检测到另一方试图同时说话，那么应该检测到（再次，通过简单地测量线路的电气特性），并且应该立即中止传输。设备还应发送一个特殊的拥塞代码，以确保两个帧（正在发送的帧和干扰它的帧）将被无条件丢弃，甚至没有到达校验和验证；接收方应该能够识别拥塞代码并停止处理中的数据接收。设备在每次尝试（称为重传退避）之后都会空闲一段逐渐增加且最好是（最初）随机的时期，以最大限度地减少后续碰撞的可能性。
- en: Note
  id: totrans-74
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'A fun fact: The jam code mechanism imposes an unusual requirement on the protocol.
    All frames must have a minimum (!) length, with the value calculated such that
    it allows the jam code to be generated and propagated to all machines before the
    transmission is completed. With very short frames, there may not be enough time
    to achieve this. Hence, the sender is required to artificially pad all their outgoing
    transmissions.'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 一个有趣的事实：拥塞代码机制对协议提出了一个不寻常的要求。所有帧都必须有最小（！）长度，其值计算得使得在传输完成之前，拥塞代码能够生成并传播到所有机器。对于非常短的帧，可能没有足够的时间实现这一点。因此，发送者需要人工填充所有他们的输出传输。
- en: '[Figure 5-4](ch05.html#the_stages_of_a_typical_ethernet_convers "Figure 5-4. The
    stages of a typical Ethernet conversation") shows the exact sequence of events
    in a typical collision scenario. As you can see, Sender A hopes to send data to
    the recipient but notices another transmission occurring, at which point they
    decide to wait until that transmission stops. Sender A then prepares to send the
    data but, unfortunately, Sender B does the same, and both conclude that it is
    safe to send data at nearly the same time.'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '[图5-4](ch05.html#the_stages_of_a_typical_ethernet_convers "图5-4. 典型以太网对话的阶段")显示了典型碰撞场景中事件的精确顺序。正如你所见，发送者A希望向接收者发送数据，但注意到另一个传输正在进行，此时他们决定等待那个传输停止。发送者A随后准备发送数据，但不幸的是，发送者B也做了同样的事情，并且双方都得出结论，几乎同时发送数据是安全的。'
- en: Both attempt to transmit, data gets mangled, and at that point both detect the
    other transmission and quickly send a jam code to instruct the recipient to disregard
    this frame. Finally, both senders back off for a random amount of time and hopefully
    manage not to start simultaneously the next time around.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 两次尝试都试图传输，数据被破坏，此时双方都检测到对方的传输，并迅速发送一个拥塞代码来指示接收方忽略这个帧。最后，双方发送者都会退避一段时间，并希望在下一次不会同时开始。
- en: 'Behind the Scenes: Wiring Soup and How We Dealt with It'
  id: totrans-78
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 背后故事：布线汤和我们是如何应对的
- en: Although not an example of a particularly scalable or elegant design, the Ethernet
    protocol is amazingly powerful and easy to deploy; it enabled the building of
    cheap peer-structure networks using coaxial cables just about anywhere. As such,
    it has become a de facto standard, replacing many other (and sometimes superior,
    but more expensive or proprietary) networking architectures.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管不是特别可扩展或优雅设计的例子，但以太网协议非常强大且易于部署；它使得使用同轴电缆在几乎任何地方构建廉价的对等结构网络成为可能。因此，它已经成为一个事实上的标准，取代了许多其他（有时甚至更优越，但更昂贵或专有）的网络架构。
- en: '![The stages of a typical Ethernet conversation](httpatomoreillycomsourcenostarchimages1138026.png.jpg)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![典型以太网对话的阶段](httpatomoreillycomsourcenostarchimages1138026.png.jpg)'
- en: Figure 5-4. The stages of a typical Ethernet conversation
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 图5-4. 典型以太网对话的阶段
- en: Naturally, simple Ethernet over coaxial cable had its limits and disadvantages;
    it was essentially based on a long piece of wire with devices hooked up to it
    at various locations, and with resistors on both ends, not something you'd want
    to be responsible for maintaining in a large office. A simple and difficult-to-debug
    mishap, such as a shorted terminal, could bring the entire infrastructure down.
    A more advanced—but only marginally more expensive—replacement was warmly welcomed.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 自然，简单的同轴电缆以太网有其局限性和缺点；它基本上是基于一根长长的电线，各种设备连接在它的各个位置，两端都有电阻，这不是你希望在大型办公室中负责维护的东西。一个简单且难以调试的事故，比如短路终端，可能会使整个基础设施崩溃。一个更先进——但仅略贵一点的——替代品受到了热烈的欢迎。
- en: Electronic multiport repeaters (hubs) made it possible to run wiring without
    much effort using twisted pair wiring (Cat-3 and Cat-5 cables with RJ-45 connectors).
    To use them, you simply plugged a piece of wire from your machine into a black
    box, and all other devices connected to this black box could communicate with
    it without much consideration of electrical problems or the risk that a single
    cable failure would bring down the entire network.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 电子多端口中继器（集线器）使得使用双绞线（Cat-3和Cat-5电缆带RJ-45连接器）进行布线变得几乎不需要费力。要使用它们，你只需将一根线从你的机器插入一个黑色盒子，然后所有连接到这个黑色盒子的其他设备都可以与之通信，而不必过多考虑电气问题或单根电缆故障导致整个网络崩溃的风险。
- en: '*Hubs* are, in essence, simple repeaters that broadcast all traffic received
    on one port to all other ports. They make it possible to build easily reconfigurable
    and more reliable star-type networks, but they do little else. As the network
    grows, the cost of broadcasting every bit of information to all locations, and
    the fact that only one party can talk at once across the entire network, makes
    it all too evident that the simplicity of this design is its major weakness.'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: '*集线器*本质上是非常简单的中继器，它们将接收到的所有流量广播到所有其他端口。它们使得构建易于重新配置和更可靠的星型网络成为可能，但除此之外它们几乎不做其他事情。随着网络的扩大，将每比特信息广播到所有位置的成本，以及在整个网络中一次只有一个参与者可以发言的事实，都使得这种设计的简单性成为其主要弱点。'
- en: '*Switches* turned out to be the solution. Switches are the next generation
    of hubs. Equipped with a decent processor and some memory, they’re a more expensive
    alternative to hubs that provide, under normal circumstances, additional high-level
    analysis of Ethernet frames. This analysis associates hardware addresses with
    specific ports and optimizes frame routing by delivering certain packets directly
    to the appropriate port (in unicast mode), instead of broadcasting them to all
    parties (see [Figure 5-5](ch05.html#hubs_versus_switches_in_local_networks "Figure 5-5. Hubs
    versus switches in local networks")). This greatly improves performance in more
    extensive networks.'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: '*交换机*最终成为了解决方案。交换机是集线器的下一代产品。配备了一个不错的处理器和一些内存，它们是比集线器更昂贵的替代品，在正常情况下，它们提供了对以太网帧的额外高级分析。这种分析将硬件地址与特定端口关联起来，并通过将某些数据包直接发送到适当的端口（在单播模式下），而不是广播给所有参与者（见[图5-5](ch05.html#hubs_versus_switches_in_local_networks
    "图5-5. 本地网络中集线器与交换机的对比"))来优化帧路由。这在更大型的网络中大大提高了性能。'
- en: Note
  id: totrans-86
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Another fun fact: Real hubs are almost extinct nowadays. Almost all 10/100
    Mb devices marketed as hubs actually use basic switch chipsets; it is simply cheaper
    to repackage the chip than to develop and maintain several variants.'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个有趣的事实：现在的真实集线器几乎已经灭绝。几乎所有标榜为集线器的10/100 Mb设备实际上都使用基本的交换芯片组；重新包装芯片比开发和维护几个变体要便宜得多。
- en: '![Hubs versus switches in local networks](httpatomoreillycomsourcenostarchimages1138028.png.jpg)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![本地网络中集线器与交换机的对比](httpatomoreillycomsourcenostarchimages1138028.png.jpg)'
- en: Figure 5-5. Hubs versus switches in local networks
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 图5-5. 本地网络中集线器与交换机的对比
- en: I’m guessing that at this point you’re asking yourself, Where the heck are you
    going with all this? What do modems have to do with information disclosure? What
    significance do serial links have in this context? How do Ethernet networks fit
    in? And what the heck are blinkenlights?
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 我猜这时你可能在想，你到底要带我去哪里？调制解调器与信息披露有什么关系？在这个背景下串行链路有什么意义？以太网网络如何适应？闪烁灯光究竟是什么？
- en: Glad you asked. I am about to get there—to the last question, that is.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 很高兴你问了。我正要说到那里——也就是最后一个问题。
- en: Blinkenlights in Communications
  id: totrans-92
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 通信中的闪烁灯光
- en: Historically, almost all refrigerator-sized computers were equipped with numerous
    prominently exposed diagnostic interfaces. These included arrays of tiny lights
    that displayed, among other things, certain arcane properties of the internal
    state of a machine, such as internal registers or flags of the core processing
    unit or an indication of whether the cat living underneath had been fed today.
    As computers became more reliable and compact, and an average user no longer had
    to understand the machine’s internals in order to use it efficiently, the lights
    started to disappear from many devices. Ever-increasing clock speeds also contributed
    to the decline—most of the time it was no longer possible for humans to get any
    meaningful information from such a visual signal that would change thousands or
    millions of times every second.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 从历史上看，几乎所有的冰箱大小的计算机都配备了众多显眼的诊断接口。这些接口包括一系列小灯，它们显示的内容包括机器内部状态的一些神秘属性，例如内部寄存器或核心处理单元的标志，或者显示今天是否给住在下面的猫喂食了。随着计算机变得更加可靠和紧凑，普通用户不再需要理解机器的内部结构才能高效地使用它，这些灯开始从许多设备中消失。不断增长的时钟速度也导致了这种下降——大多数时候，人类已经无法从这种每秒变化数千或数百万次的视觉信号中获得任何有意义的信息。
- en: Yet, the lights prevailed in some applications; for example, almost all networking
    devices feature light-emitting diodes (LEDs) on their front or back panel. These
    provide link diagnostics, such as an indication of whether a particular module
    or socket is functioning properly, a party is connected, data is being transferred,
    and so on. The lights are not merely a diagnostic tool either; their hypnotic
    patterns have strange appeal, and their mystery plants seeds of uncertainty, fear,
    and respect in the hearts of lay people who enter the realm of the server room.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在某些应用中，这些灯仍然存在；例如，几乎所有的网络设备在其前面或后面面板上都有发光二极管（LED）。这些提供了链路诊断，例如指示特定模块或插槽是否正常工作，是否有连接，数据是否正在传输等等。这些灯不仅仅是诊断工具；它们的催眠模式具有奇特的吸引力，它们的神秘感在进入服务器房间领域的普通人心目中播下了不确定、恐惧和尊重的种子。
- en: 'The term *blinkenlights* or *blinkenlichten* has been used to describe the
    much-adored institution of diagnostic LEDs on computer equipment ever since the
    dark ages of computing, bathing the computer geek in the soothing green light
    during those long, lonely nights spent at the terminal. It came from an amusing
    prank note in mock German (itself a spoof of another, noncomputer joke from WWII),
    displayed some time in the 1950s at IBM laboratories. The note later propagated
    into a majority of server rooms and computer science laboratories across the world
    and went like this (as quoted from Eric S. Raymond’s *Hacker’s Dictionary*):'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 术语 *blinkenlights* 或 *blinkenlichten* 自从计算机的黑暗时代以来就被用来描述计算机设备上备受喜爱的诊断LED机构，那些在终端孤独长夜中度过，被舒缓的绿色灯光沐浴的计算机极客。它源自一份有趣的恶作剧便条，这是一份模仿德语的便条（本身是对二战时期另一个非计算机笑话的恶搞），大约在20世纪50年代在IBM实验室展出。这份便条后来传播到世界各地的多数服务器房间和计算机科学实验室，内容如下（摘自Eric
    S. Raymond的《黑客字典》）：
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages1138030.png)'
  id: totrans-96
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages1138030.png)'
- en: Communications equipment is one of the last domains in which blinken-lights
    prevail and prosper. But that’s not all. Almost all these devices use serial lines
    for communications. And, for the sake of simplicity and aesthetics, “activity”
    LEDs are sometimes wired almost directly, through a simple driver circuit, to
    the transmit or receive line of the device. Curtain falls.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 通信设备是最后一个仍然盛行和繁荣的闪烁灯领域。但不仅如此。几乎所有这些设备都使用串行线路进行通信。为了简单和美观，有时“活动”LED几乎直接通过一个简单的驱动电路连接到设备的发射或接收线路。帷幕落下。
- en: '* * *'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[11](#CHP-5-FN-1)]) Or the other way around, depending on the transmitter
    design.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[11](#CHP-5-FN-1)]) 或者反过来，这取决于发射器的设计。
- en: ^([[12](#CHP-5-FN-2)]) Echo cancellation circuits attempt to distinguish signals
    being sent by the device itself from those coming from the other party, and to
    eliminate or significantly reduce the former. Various types of such devices are
    commonly used not only in digital data transfer, but also to improve phone call
    quality, eliminate microphone feedback during public events, and solve many other
    everyday problems.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[12](#CHP-5-FN-2)]) 消音电路试图区分由设备本身发送的信号和来自另一方的信号，并消除或显著减少前者。这类设备的各种类型不仅广泛应用于数字数据传输，而且用于提高电话通话质量，消除公共活动中的麦克风反馈，以及解决许多其他日常问题。
- en: The Implications of Aesthetics
  id: totrans-101
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 美学的影响
- en: It took decades for the problem to be discovered, and once it happened (in 2002),
    it struck us all as so obvious and trivial we wanted to bang our heads on the
    keyboard a couple of times.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 这个问题被发现花费了数十年时间，一旦发生（在2002年），它对我们所有人来说都如此明显和简单，以至于我们想要敲打键盘几次。
- en: Joe Lughry and David A. Umphress, in a research paper titled “Information Leakage
    from Optical Emanations,”^([[63](apb.html#ftn.CHP-5-BIB-4)]) discovered a new
    type of signal-disclosure scenario in certain types of network equipment, most
    often modems. They concluded that someone observing these lights could go beyond
    simply watching the magic lights with the naked eye.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: Joe Lughry和David A. Umphress在一份题为“光辐射信息泄露”的研究论文中^([[63](apb.html#ftn.CHP-5-BIB-4)])发现了一种新的信号泄露场景，在特定类型的网络设备中，最常见的是调制解调器。他们得出结论，观察这些灯光的人可以超越仅仅用肉眼观看这些神奇灯光。
- en: LEDs, unlike incandescent bulbs, usually have short rise and fall times, meaning
    that they turn on and off almost instantly. That’s not surprising; after all,
    high-end LEDs are used to control fiber-optic links and some other optoelectronic
    communication channels. As such, the blinking of an LED hooked up to a serial
    data transmission line can actually often mirror single bits of the transmission
    as it occurs on the wire. Given a way to record this activity at a sufficient
    speed, it should be possible to retrieve this information, from at least as far
    as you can see the tiny blinking light on a device with the naked eye (or with
    a telephoto lens).
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 与白炽灯泡不同，LED灯通常具有很短的上升和下降时间，这意味着它们几乎可以瞬间开启和关闭。这并不令人惊讶；毕竟，高端LED被用于控制光纤链路和一些其他光电通信通道。因此，连接到串行数据传输线的LED闪烁实际上可以经常反映传输线上发生的单个比特。如果有一种方法可以以足够快的速度记录这种活动，那么应该可以从至少你用肉眼（或用长焦镜头）可以看到的设备上的微小闪烁灯光中检索到这些信息。
- en: 'This research caused some stir in the industry; it was eventually also both
    downplayed and overhyped, and hence a great deal of confusion ensued, and very
    little has changed. The paper resulted in many conflicting reports, but its basic
    premise is simple and truly beautiful. The beauty of this technique is that it
    is trivial to devise such a device to receive the signal: the equally cheap and
    popular counterparts of LEDs—photodiodes and phototransistors—are easy to acquire
    and equally easy to interface with the computer. And the exposure zone, unlike
    most of the TEMPEST activity we discussed in [Chapter 3](ch03.html "Chapter 3. Ten
    Heads of the Hydra"), is not merely the subject of urban legends and pure laboratory
    results, but can be directly observed and measured.'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 这项研究在业界引起了一些轰动；它最终既被轻描淡写，又被过度炒作，因此随之而来的是大量的混淆，几乎没有发生变化。这篇论文导致了许多相互矛盾的报道，但它的基本前提简单而真正美丽。这种技术的美妙之处在于，设计这样的接收设备非常简单：与LED一样便宜且受欢迎的替代品——光电二极管和光电晶体管——很容易获得，并且同样容易与计算机接口。而且，曝光区域，与我们在[第3章](ch03.html
    "第3章. 九头蛇的头部")中讨论的大多数TEMPEST活动不同，不仅仅是城市传说和纯实验室结果的主体，而且可以直接观察和测量。
- en: In the course of their research, the authors performed a set of experiments
    to verify that the signal could be successfully acquired from as far away as 20
    meters (just under 100 feet) without the need for additional digital signal conditioning.
    And common sense suggests that this might actually be an understatement, especially
    when good optics are used. (The authors used a 100 mm focal length, f/2.0 lens
    for the test, but a much better telephoto lens is commonly available to many midrange
    SLR (single lens reflex) photography amateurs. Those who are willing to part with
    their money can buy a superb-quality lens with a focal length of as much as 1,200
    mm.)
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在他们的研究过程中，作者进行了一系列实验来验证信号可以从20米（不到100英尺）远的地方成功获取，而不需要额外的数字信号处理。常识表明，这实际上可能是一个低估，尤其是在使用良好的光学设备时。（作者在测试中使用了100
    mm焦距、f/2.0的镜头，但许多中端单反相机摄影爱好者都可以获得更好的远摄镜头。那些愿意花钱的人可以购买焦距高达1,200 mm的高质量镜头。）
- en: The paper takes a defensive stance in several cases, and a careful reader might
    be tempted to conclude that some of the devices classified are not vulnerable
    to the problem. In particular, some of the Ethernet devices may exhibit a more
    subtle variant of the vulnerability, as you’ll see in the prevention section later
    in this chapter. But first let’s peek at the problem with our own (computerized)
    eyes, shall we?
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些情况下，论文采取了防御性的立场，一个仔细的读者可能会倾向于得出结论，一些被分类的设备并不容易受到该问题的影响。特别是，一些以太网设备可能表现出更微妙的漏洞变体，正如你将在本章后面的预防部分中看到的。但首先，让我们用我们自己的（计算机化）眼睛来看看这个问题，好吗？
- en: Building Your Own Spy Gear . . .
  id: totrans-108
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 构建自己的间谍装备……
- en: The simplicity of building a snooping device makes it quite tempting to do so.
    This section contains several suggestions and rough schematics on how to build
    and connect such a device to an ordinary computer. Although the circuit is not
    particularly complex and does not require a master’s degree in soldering and a
    printed board circuit design software, a minimum level of proficiency in electronics
    is desirable, as is a dose of common sense. Although external interfaces of today’s
    computers are fairly robust and foolproof, there is always the risk of damaging
    equipment when attaching home-brew devices in a really innovative way, in a brief
    moment of insanity. It’s happened to the best of us.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 构建窃听设备的简单性使其颇具吸引力。本节包含了一些关于如何构建和连接此类设备到普通计算机的建议和粗略的电路图。尽管电路并不特别复杂，也不需要焊接和印刷电路板设计软件的硕士学位，但至少需要具备一定的电子学知识和一些常识。尽管今天计算机的外部接口相当坚固且不易出错，但在疯狂的创新方式下连接自制设备时，总是存在损坏设备的风险。这种情况甚至可能发生在我们最好的情况下。
- en: The baseline design is extremely trivial. It calls for a single phototransistor
    (a component consisting of a transistor driven by a built-in photodiode), a regular
    low-power NPN (Negative-Positive-Negative) transistor to amplify the signal a
    bit further (not always necessary), and a set of potentiometers (perhaps in the
    range of 10 kΩ just to have enough flexibility) to experimentally pull down the
    voltage and control the circuit’s sensitivity and threshold points. There are
    no particular requirements for the components, although your mileage will vary
    depending on which ones you use. Be sure to select a phototransistor that has
    a decent response in the visible light range, though all cheap ones should work.
    (For reference, a green LED emits a wavelength of approximately 520 nm.)
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 基线设计极其简单。它需要一个单光敏晶体管（由内置光电二极管驱动的晶体管组件），一个普通的低功耗NPN（负-正-负）晶体管来进一步放大信号（不一定总是必要的），以及一套电位器（可能为10
    kΩ，以便有足够的灵活性）来实验性地降低电压并控制电路的灵敏度和阈值点。对于组件没有特别的要求，尽管你的使用效果会根据你使用的组件而有所不同。不过，务必选择一个在可见光范围内有良好响应的光敏晶体管，尽管所有便宜的光敏晶体管都应该可以工作。（作为参考，绿色LED发出的波长约为520
    nm。）
- en: A sample circuit design is shown in [Figure 5-6](ch05s03.html#a_simple_receiver_circuit
    "Figure 5-6. A simple receiver circuit").
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 一个示例电路设计如图 [图5-6](ch05s03.html#a_simple_receiver_circuit "图5-6. 简单接收电路") 所示。
- en: '![A simple receiver circuit](httpatomoreillycomsourcenostarchimages1138032.png.jpg)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
  zh: '![简单接收电路](httpatomoreillycomsourcenostarchimages1138032.png.jpg)'
- en: Figure 5-6. A simple receiver circuit
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 图5-6. 简单接收电路
- en: 'The circuit has an optimal running voltage of approximately 5V and a low maximum
    current: a power supply capable of delivering perhaps 10 to 50 mA is more than
    enough. A word of warning: If you use a supply capable of delivering a higher
    voltage, you will risk damaging the port or the computer; likewise, if you use
    a more powerful supply and do not prevent higher current from flowing through
    the circuit.'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 该电路的最佳运行电压约为5V，最大电流较低：一个能够提供大约10到50 mA的电源就足够了。警告：如果您使用能够提供更高电压的电源，您将冒着损坏端口或计算机的风险；同样，如果您使用更强大的电源并且没有防止电路中流动更高的电流，也会造成风险。
- en: Note
  id: totrans-115
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Setting Rvar1 or Rvar2 to a very low resistance may short the circuit. If you
    want to fiddle with the knobs mindlessly, it might be a good idea to add a fixed
    resistor to limit the current drain.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 将Rvar1或Rvar2设置到非常低的电阻可能会短路电路。如果您想盲目地摆弄旋钮，可能最好添加一个固定电阻以限制电流消耗。
- en: You must shield the phototransistor from external light sources—for example,
    by enclosing it in an opaque tube. Because the phototransistor has no focusing
    mechanism, it is not likely to pick up more distant signals (other than ambient
    light). Thus, for initial tests, it is a good idea to cover it entirely to simulate
    darkness and then put it by an LED to excite the circuit. You can also connect
    another LED temporarily between the GND and the output line to test the circuit.
    The test LED should light up when the sensor is directed at a light source, but
    otherwise be fairly dark.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 您必须屏蔽光电晶体管免受外部光源的影响——例如，通过将其封装在一个不透明的管子中。因为光电晶体管没有聚焦机制，它不太可能捕捉到更远的信号（除了环境光）。因此，对于初始测试，完全覆盖它以模拟黑暗，然后放在LED旁边以激发电路是一个好主意。您还可以在GND和输出线之间临时连接另一个LED来测试电路。当传感器指向光源时，测试LED应该点亮，否则应该相当暗。
- en: . . . And Using It with a Computer
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '...以及使用计算机'
- en: If the circuit with a test LED hookup works so far, well done; you have built
    a fancy TV remote tester. Because generic, cheap phototransistors are eager to
    pick up infrared light, your creation should “translate” IR (infrared) into visible
    light, but that’s about all the fun stuff it will do. To make it a bit more useful,
    you need to interface the circuit with the computer. A good way to do so is through
    a line printer interface, LPT, if your computer has one. Unfortunately, this wonderful
    hardware hacker’s tool is being dropped from some of the more compact and fancy
    designs.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 如果带有测试LED连接的电路到目前为止工作正常，那么做得好；你已经构建了一个花哨的电视遥控器测试器。因为通用的、便宜的光电晶体管渴望捕捉红外光，你的创造应该能够“翻译”红外光（IR）为可见光，但这几乎就是它能做的所有有趣的事情。为了使其更有用，你需要将电路与计算机连接起来。如果您的计算机有一个行打印机接口（LPT），这是一个很好的方法。不幸的是，这个出色的硬件黑客工具正在被一些更紧凑和花哨的设计所摒弃。
- en: Although initially designed to be unidirectional (for output only), the LPT
    interface provides a number of status feedback lines, such as “paper out,” “busy,”
    and “acknowledgment,” that were intended to provide a means for the printer to
    complain about problems. You can easily read the data that issues through this
    interface by accessing port 0x379 (the LPT1 status register) on a PC-compatible
    system. By hooking the circuit to a parallel port, you can easily transmit information
    back to the computer. Although you might want to connect the circuit to a different
    interface, LPT is much faster than, say, RS-232, and you won’t have to cope with
    any mundane protocols, signaling schemes, or unusual voltage levels. Too, unlike
    USB and some other current solutions, you do not need special controllers to implement
    a fairly complex protocol to even be able to talk to your PC.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然最初设计为单向（仅用于输出），但LPT接口提供了一些状态反馈线，如“纸尽”、“忙碌”和“确认”，旨在为打印机提供抱怨问题的手段。您可以通过访问PC兼容系统上的端口0x379（LPT1状态寄存器）轻松读取通过此接口发出的数据。通过将电路连接到并行端口，您可以轻松地将信息传回计算机。虽然您可能希望将电路连接到不同的接口，但LPT比RS-232等其他接口要快得多，而且您不必处理任何平凡的协议、信号方案或异常的电压水平。此外，与USB和一些其他当前解决方案不同，您不需要特殊的控制器来实现一个相当复杂的协议，甚至能够与您的PC通信。
- en: Note
  id: totrans-121
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Although LPT also offers bi-directional operation modes (ECP or EPP), it is
    usually pointless to attempt to use this functionality for such a simple task.
    In the unidirectional mode, four bits are available for input, more than enough
    for this application; switching to bi-directional modes such as EPP or ESP provides
    an extra four bits.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然LPT也提供双向操作模式（ECP或EPP），但对于如此简单的任务尝试使用此功能通常是没有意义的。在单向模式下，有四个输入位可用，对于此应用来说已经足够；切换到双向模式如EPP或ESP可以提供额外的四个位。
- en: It is up to you to choose the status line to use. [Table 5-3](ch05s04.html#lpt_pinout
    "Table 5-3. LPT pinout") shows a pin layout of the DB25 connector used for a printer
    port. The rows shaded gray can be used for input.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 选择要使用的状态行由您决定。[表5-3](ch05s04.html#lpt_pinout "表5-3. LPT引脚布局")显示了用于打印机端口的DB25连接器的引脚布局。灰色阴影的行可用于输入。
- en: To interface the circuit with this port, you can simply connect the ground reference
    point on the connector with the one used in your circuit and then hook up the
    output line to any of the five pins. (Remember to disconnect the LED used for
    diagnostics first.) Next, monitor the status port as you first expose it to light
    and then cover the sensor. In either case, the value read depends on how you hooked
    up the circuit; the exact value does not matter, as long as the two values are
    different.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 要将电路与该端口接口，您只需将连接器上的地参考点与电路中使用的地连接，然后将输出线连接到任意五个引脚之一。（请记住先断开用于诊断的LED。）接下来，在首次将传感器暴露于光线下并覆盖传感器时，监控状态端口。在两种情况下，读取的值取决于您如何连接电路；确切的值并不重要，只要两个值不同即可。
- en: Table 5-3. LPT pinout
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 表5-3. LPT引脚布局
- en: '| LPT Port: DB25 Pinout (Standard Mode) |'
  id: totrans-126
  prefs: []
  type: TYPE_TB
  zh: '| LPT端口：DB25引脚布局（标准模式） |'
- en: '| --- |'
  id: totrans-127
  prefs: []
  type: TYPE_TB
  zh: '| --- |'
- en: '| Pin | Name | Function |'
  id: totrans-128
  prefs: []
  type: TYPE_TB
  zh: '| 引脚 | 名称 | 功能 |'
- en: '| --- | --- | --- |'
  id: totrans-129
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| 1 | Strobe | Control output bit 0 |'
  id: totrans-130
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 选通 | 控制输出位0 |'
- en: '| 2 | D0 | Data output bit 0 |'
  id: totrans-131
  prefs: []
  type: TYPE_TB
  zh: '| 2 | D0 | 数据输出位0 |'
- en: '| 3 | D1 | Data output bit 1 |'
  id: totrans-132
  prefs: []
  type: TYPE_TB
  zh: '| 3 | D1 | 数据输出位1 |'
- en: '| 4 | D2 | Data output bit 2 |'
  id: totrans-133
  prefs: []
  type: TYPE_TB
  zh: '| 4 | D2 | 数据输出位2 |'
- en: '| 5 | D3 | Data output bit 3 |'
  id: totrans-134
  prefs: []
  type: TYPE_TB
  zh: '| 5 | D3 | 数据输出位3 |'
- en: '| 6 | D4 | Data output bit 4 |'
  id: totrans-135
  prefs: []
  type: TYPE_TB
  zh: '| 6 | D4 | 数据输出位4 |'
- en: '| 7 | D5 | Data output bit 5 |'
  id: totrans-136
  prefs: []
  type: TYPE_TB
  zh: '| 7 | D5 | 数据输出位5 |'
- en: '| 8 | D6 | Data output bit 6 |'
  id: totrans-137
  prefs: []
  type: TYPE_TB
  zh: '| 8 | D6 | 数据输出位6 |'
- en: '| 9 | D7 | Data output bit 7 |'
  id: totrans-138
  prefs: []
  type: TYPE_TB
  zh: '| 9 | D7 | 数据输出位7 |'
- en: '| 10 | ACK | Status input bit 2 |'
  id: totrans-139
  prefs: []
  type: TYPE_TB
  zh: '| 10 | ACK | 状态输入位2 |'
- en: '| 11 | Busy | Status input bit 3 |'
  id: totrans-140
  prefs: []
  type: TYPE_TB
  zh: '| 11 | 忙 | 状态输入位3 |'
- en: '| 12 | Paper Out | Status input bit 1 |'
  id: totrans-141
  prefs: []
  type: TYPE_TB
  zh: '| 12 | 纸张输出 | 状态输入位1 |'
- en: '| 13 | Select In | Status input bit 0 |'
  id: totrans-142
  prefs: []
  type: TYPE_TB
  zh: '| 13 | 选择输入 | 状态输入位0 |'
- en: '| 14 | Autofeed | Control output bit 1 |'
  id: totrans-143
  prefs: []
  type: TYPE_TB
  zh: '| 14 | 自动进纸 | 控制输出位1 |'
- en: '| 15 | Error | Status input (unused) |'
  id: totrans-144
  prefs: []
  type: TYPE_TB
  zh: '| 15 | 错误 | 状态输入（未使用） |'
- en: '| 16 | Init | Control output bit 2 |'
  id: totrans-145
  prefs: []
  type: TYPE_TB
  zh: '| 16 | 初始化 | 控制输出位2 |'
- en: '| 17 | Select | Control output bit 3 |'
  id: totrans-146
  prefs: []
  type: TYPE_TB
  zh: '| 17 | 选择 | 控制输出位3 |'
- en: '| 18 | GND | Ground (0V) |'
  id: totrans-147
  prefs: []
  type: TYPE_TB
  zh: '| 18 | GND | 地（0V） |'
- en: '| 19 | GND | Ground (0V) |'
  id: totrans-148
  prefs: []
  type: TYPE_TB
  zh: '| 19 | GND | 地（0V） |'
- en: '| 20 | GND | Ground (0V) |'
  id: totrans-149
  prefs: []
  type: TYPE_TB
  zh: '| 20 | GND | 地（0V） |'
- en: '| 21 | GND | Ground (0V) |'
  id: totrans-150
  prefs: []
  type: TYPE_TB
  zh: '| 21 | GND | 地（0V） |'
- en: '| 22 | GND | Ground (0V) |'
  id: totrans-151
  prefs: []
  type: TYPE_TB
  zh: '| 22 | GND | 地（0V） |'
- en: '| 23 | GND | Ground (0V) |'
  id: totrans-152
  prefs: []
  type: TYPE_TB
  zh: '| 23 | GND | 地（0V） |'
- en: '| 24 | GND | Ground (0V) |'
  id: totrans-153
  prefs: []
  type: TYPE_TB
  zh: '| 24 | GND | 地（0V） |'
- en: '| 25 | GND | Ground (0V) |'
  id: totrans-154
  prefs: []
  type: TYPE_TB
  zh: '| 25 | GND | 地（0V） |'
- en: Because chip logic requires somewhat different input levels than your test LED
    diode, you might have to tweak the `Rvar2` until you get distinct readings from
    the port when you cover the sensor, and when you expose it to light. To accomplish
    this, it is best to be able to monitor the port in real time on the computer itself.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 由于芯片逻辑需要与您的测试LED二极管不同的输入电平，您可能需要调整`Rvar2`，直到在覆盖传感器和将传感器暴露于光线下时从端口获得不同的读取值。为此，最好能够在计算机上实时监控端口。
- en: The way you can monitor the state of the port will depend on the operating system
    and the programming language you are using. If you’re using C, the function used
    to read the value off a port is `inb(port)`, so in this particular case you would
    issue `inb(0x379)` and check the return value. In other languages, it is likely
    to have a similar name. (Try looking for `in`, `inport`, `readport`, and so forth.)
    Also, Windows users may find the built-in “debug” utility and its “i” (port read)
    function quite handy.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 监控端口状态的方法将取决于您使用的操作系统和编程语言。如果您使用C语言，用于从端口读取值的函数是`inb(port)`，因此在这种情况下，您将发出`inb(0x379)`并检查返回值。在其他语言中，它可能具有类似的名字。（尝试查找`in`、`inport`、`readport`等。）此外，Windows用户可能会发现内置的“调试”实用程序及其“i”（端口读取）功能非常方便。
- en: Note
  id: totrans-157
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 备注
- en: On some systems, such as Linux, you might need to request that the system give
    you permission to access a specific port first. Consult the documentation for
    `iopl(3)` or a similar call for more information.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 在某些系统上，例如Linux，您可能需要请求系统首先给予您访问特定端口的权限。有关`iopl(3)`或类似调用的更多信息，请参阅文档。
- en: At this point, you are ready to go. You can choose to point your probe at any
    LED on a device, adjust the sensor based on its brightness, and start reading
    alternating patterns of light and dark signals, as you discover how they correspond
    to the exchanged information, if at all.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，您已经准备好出发了。您可以选择将探头指向设备上的任何LED，根据其亮度调整传感器，并开始读取光和暗信号的交替模式，同时发现它们如何与交换的信息相对应，如果有的话。
- en: Note
  id: totrans-160
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If you’re curious, you might try to examine the brightness of the indicator
    diode, not only a binary representation of its state. It might turn out that even
    though a specific LED is not intended to directly map a signal on the serial line
    to its blink patterns, there is some analog cross talk between circuits, and the
    serial line signal will have some influence on the brightness. A cheap analog-to-digital
    converter such as TLV571 from Texas Instruments is just asking to be used this
    way.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您好奇，您可能会尝试检查指示二极管的亮度，而不仅仅是其状态的二进制表示。结果可能表明，即使特定的LED不是为了将串行线上的信号直接映射到其闪烁模式，电路之间仍然存在一些模拟串扰，串行线信号将对亮度产生影响。德州仪器的TLV571这样的廉价模拟-数字转换器正是用来这样使用的。
- en: 'You can use this approach to sample the frequency of less than 1 million bits
    per second, which should suffice for capturing transmission on many interfaces,
    but not necessarily on Ethernet ports (which transmit at least 10 million bits
    per second). Past this capture capacity, your LPT port will likely reach its physical
    throughput limits, but do not despair: as long as the sensor (phototransistor)
    can switch at the rate sufficient to capture communications in question, you still
    have an option. Remember that LPT is a parallel port. To reach faster capture
    speeds, such as the one needed for Ethernet, combine a trivial clock, a counter
    circuit, and a set of sample-and-hold latches (such as 74LS377) to sequentially
    store data between the port read attempts on the computer side. You can accumulate
    this information for a short period of time and then, by using more than just
    one status pin (or by switching the port to bi-directional mode), easily send
    several bits—samples—to the computer, in a single burst, in one read cycle, thus
    improving the read rate four- or eightfold.'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用这种方法来采样每秒低于100万比特的频率，这对于捕获许多接口上的传输应该是足够的，但并不一定适用于以太网端口（以太网端口传输的比特率至少为1000万比特每秒）。超过这个捕获能力，您的并行端口（LPT）很可能会达到其物理吞吐量限制，但不要绝望：只要传感器（光敏晶体管）能够以足够快的速度切换以捕获相关通信，您仍然有选择。记住，并行端口（LPT）是一个并行端口。为了达到更快的捕获速度，例如以太网所需的，可以将一个简单的时钟、一个计数电路和一组采样保持锁存器（如74LS377）结合起来，在计算机端口读取尝试之间顺序存储数据。您可以在短时间内积累这些信息，然后，通过使用不止一个状态引脚（或将端口切换到双向模式），在单个读取周期内一次性发送多个比特——样本——到计算机，从而提高读取速率四倍或八倍。
- en: I’ll spare you a further, perhaps needless, excursion into the world of electronics.
    If you want to toy with the idea of high-speed or analog sampling, or perhaps
    just get your kicks from soldiering stuff together and hooking it to a computer,
    you might want to take a look at my fairly comprehensive introductory tutorial
    under the thin disguise of a computer-controlled robot design project. You should
    be able to find it at [http://lcamtuf.coredump.cx/robot.txt](http://lcamtuf.coredump.cx/robot.txt).
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 我将省略进一步的、可能是不必要的对电子世界的探索。如果您想尝试高速或模拟采样，或者只是从组装东西并将其连接到计算机中获得乐趣，您可能想看看我在一个计算机控制机器人设计项目薄薄伪装下的相当全面的入门教程。您应该能在[http://lcamtuf.coredump.cx/robot.txt](http://lcamtuf.coredump.cx/robot.txt)找到它。
- en: 'And now, for those with interests that lean more toward practical security:
    a brief discussion of how to address the issue, short of covering all LEDs in
    the office with duct tape.'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，对于那些对实用安全更感兴趣的人：简要讨论如何解决这个问题，而不仅仅是用胶带覆盖办公室里的所有LED。
- en: Preventing Blinkenlights Data Disclosure—and Why It Will Fail
  id: totrans-165
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 防止闪烁灯数据泄露——以及为什么它会失败
- en: The easiest solution to the problem, and one suggested by the original research,
    is *pulse stretching*—a practice intended to distort the blinks on an indicator
    by prolonging some of them, thus making any practical data recovery seemingly
    not feasible. *Pulse stretching circuits* are a group of fairly trivial devices
    that extend the duration of an encountered “high” input signal for an additional
    period of time. Most basic pulse stretcher design relies on a capacitor that charges
    in the presence of an input signal and then discharges slowly. This capacitor
    is connected to a *binary discriminator*, which is not a nickname for a vicious
    wrestling champion, but rather a device that converts analog data into binary
    output by applying a particular threshold (outputting a voltage for logical 1
    for all input voltages above *n*, and 0 for all input voltages below). In this
    case, it uses a certain capacitor charge level as the discrimination point.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 解决这个问题的最简单方法，也是原始研究中提出的方法，是**脉冲扩展**——一种通过延长一些闪烁来扭曲指示器闪烁的实践，从而使任何实际的数据恢复看似不可行。**脉冲扩展电路**是一组相当简单的设备，它们将遇到的“高”输入信号的持续时间额外延长。大多数基本的脉冲扩展器设计依赖于一个在输入信号存在时充电并在之后缓慢放电的电容器。这个电容器连接到一个**二进制判别器**，它不是一个邪恶摔跤冠军的昵称，而是一种通过应用特定的阈值将模拟数据转换为二进制输出的设备（对于所有高于*n*的输入电压输出逻辑1的电压，对于所有低于*n*的输入电压输出0）。在这种情况下，它使用一定的电容器充电水平作为判别点。
- en: 'More advanced and reliable designs, including purely digital circuitry, are
    also common, and all can be used in hubs and switches to make LEDs nice to look
    at. Without them, the high-speed blinking at way more than 50 cycles per second
    (considered the limit on our ability to perceive flicker), would usually result
    in our seeing the lights as dim but seemingly constant. A discriminator causes
    the LED to be driven by 1 more often than by 0 by extending the duration of each
    1 pulse. This makes the LED light brighter and blink less often. [Figure 5-7](ch05s05.html#pulse_stretcher_behavior_comma_3x
    "Figure 5-7. Pulse stretcher behavior, 3x") shows the behavior of such a pulse
    stretcher: a single spike (single 1) is stretched to last three times as long,
    whereas all 0s are left as they are.'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 更高级和可靠的设计，包括纯数字电路，也很常见，并且所有这些都可以用于集线器和交换机，使LED看起来更美观。没有它们，超过每秒50次（被认为是我们的闪烁感知极限）的高速闪烁通常会导致我们看到的灯光看起来较暗但似乎恒定。通过延长每个1脉冲的持续时间，判别器使得LED被1驱动比被0驱动的频率更高。这使得LED灯光更亮，闪烁频率更低。[图5-7](ch05s05.html#pulse_stretcher_behavior_comma_3x
    "图5-7. 脉冲扩展器行为，3倍")展示了这种脉冲扩展器的行为：单个尖峰（单个1）被拉伸到原来的三倍长，而所有的0都保持不变。
- en: '![Pulse stretcher behavior, 3x](httpatomoreillycomsourcenostarchimages1138034.png.jpg)'
  id: totrans-168
  prefs: []
  type: TYPE_IMG
  zh: '![脉冲扩展器行为，3倍](httpatomoreillycomsourcenostarchimages1138034.png.jpg)'
- en: Figure 5-7. Pulse stretcher behavior, 3x
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 图5-7. 脉冲扩展器行为，3倍
- en: While their primary purpose is aesthetic, as I have mentioned, this also seems
    to be a good way to solve the problem of light emissions information disclosure,
    by letting the attacker deduce only certain general properties of the traffic.
    Thus, at best, the attacker can figure out only general properties of the traffic,
    such as when something is being sent and when it is not.^([[13](#ftn.CHP-5-FN-3)])
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然它们的主要目的是美观，正如我提到的，这似乎也是解决光发射信息泄露问题的好方法，通过让攻击者只能推断出交通的某些一般属性。因此，在最理想的情况下，攻击者只能推断出交通的一般属性，例如何时有东西被发送，何时没有发送。^([[13](#ftn.CHP-5-FN-3)])
- en: 'What seems to be a good solution, however, is not always. Consider the following
    sample data and the corresponding serial line signal:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，看似良好的解决方案并不总是如此。考虑以下样本数据和相应的串行线路信号：
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages1138036.png)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages1138036.png)'
- en: Assume the signal is processed using a 5x pulse stretcher that makes every 1
    last for five additional cycles. (The original paper suggests a safe limit of
    2x, but we’ll exaggerate to make a point.)
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 假设信号是使用5倍脉冲扩展器处理的，使得每个1持续五次额外的周期。（原始论文建议一个安全的极限是2倍，但我们将夸张一下以说明问题。）
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages1138038.png.jpg)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages1138038.png.jpg)'
- en: 'Although it might appear that almost all important information has been lost
    when compared with the input signal we want to intercept, it is possible to recover
    much of it by making four important observations:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管与我们要拦截的输入信号相比，可能看起来几乎所有的信息都已经丢失，但通过做出四个重要的观察，我们仍然可以恢复其中大部分信息：
- en: Obviously, all areas where the stretcher output is zero must have been zero
    in the original signal.
  id: totrans-176
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 显然，所有拉伸器输出为零的区域在原始信号中必须为零。
- en: Each stretched run of 1s must have been triggered by 1 at the starting location
    in the original stream.
  id: totrans-177
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个扩展的1序列必须是由原始流中的起始位置触发的一个1。
- en: Each run of L 1s must have originally contained at least one 1 for every *N*
    cycles, where *N* is the stretch factor for this circuit; otherwise, there would
    be gaps in the run. The count of 1s in a block of data represented under a single
    stretch of 1s in output is greater than or equal to L/*N* rounded up.
  id: totrans-178
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个L 1序列最初必须包含至少一个1，每*N*个周期，其中*N*是此电路的拉伸因子；否则，运行中会有间隙。在单个1扩展输出下表示的数据块中的1的计数大于或等于L/*N*向上取整。
- en: Every run ends after exactly *N*−1 zeros in the original stream. We know that
    these zeros must have been preceded with 1; otherwise the run would have ended
    sooner.
  id: totrans-179
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个运行在原始流中恰好有*N*−1个零后结束。我们知道这些零必须由1 precede；否则，运行将提前结束。
- en: 'By applying this knowledge to the previous example, we can reconstruct most
    of the original data, as follows:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 通过将此知识应用于之前的例子，我们可以重建大部分原始数据，如下所示：
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages1138040.png.jpg)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages1138040.png.jpg)'
- en: In the previous fairly realistic example, fewer than 9 out of 32 bits of data
    were lost due to pulse stretching and cannot be conclusively reconstructed (marked
    with question marks in the graphic). Thus, we recovered 99.999988% of the potential
    search space. We must guess at the remaining data, which (especially if the data
    snooped is regular English text, such as email) is rather trivial to reconstruct
    compared to the starting point. The authors of the research suggest that even
    N = 1.5 or N = 2 “on” time pulse stretching is sufficient to obfuscate the data,
    but this is not necessarily so.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 在之前的相当现实的例子中，由于脉冲扩展，只有不到9个32位数据中的数据丢失，无法最终重建（在图形中以问号标记）。因此，我们恢复了99.999988%的潜在搜索空间。我们必须猜测剩余的数据，而这些数据（尤其是如果被窃听的数据是常规英语文本，如电子邮件）与起点相比，重建起来相当简单。该研究的作者建议，即使N
    = 1.5或N = 2的“开启”时间脉冲扩展也足以混淆数据，但这并不一定如此。
- en: The previous reconstruction scheme works with stretches of 0s or 1s. Some links
    use return-to-zero (RZ) encodings (such as the Manchester scheme mentioned earlier),
    and because the signal is constantly alternating there, the 2x stretching might
    indeed be sufficient to obfuscate all data. However, this is only true if the
    LED is driven by a signal prior to initial internal decoding to NRZ—which, in
    most situations, is not the case. In fact, applying pulse stretching to RZ-encoded
    signal is often a silly idea in that the LED would be on all the time; hence there
    seems to be no point in doing that in the first place.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 之前的重建方案适用于0s或1s的扩展。一些链路使用归零（RZ）编码（如之前提到的曼彻斯特方案），由于信号不断交替，2倍扩展确实可能足以混淆所有数据。然而，这只在LED由在初始内部解码到NRZ之前的信号驱动时才成立——在大多数情况下并非如此。实际上，将脉冲扩展应用于RZ编码信号通常是一个愚蠢的想法，因为LED将一直处于开启状态；因此，最初做这件事似乎没有意义。
- en: 'As noted previously, an additional problem stems from the quality of the pulse
    stretcher and its susceptibility to interference from other internal circuits:
    LED voltage fluctuations that result in slight brightness changes during a “stretch”
    period might disclose some information. Capacitor-based solutions, in particular,
    can fall into this category.'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，另一个问题源于脉冲扩展器的质量和其对其他内部电路干扰的敏感性：在“拉伸”期间导致LED亮度略有变化的光电压波动可能会泄露一些信息。特别是基于电容的解决方案可能会落入这一类别。
- en: Thus, some systems, particularly Ethernet devices known to deploy pulse stretching,
    can be partly vulnerable to attack, even though the original paper discussed earlier
    concluded that there is no direct correlation between the transmitted data and
    the behavior of an LED, based on the observation of a recorded blinking pattern
    using an oscilloscope.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，一些系统，特别是已知部署脉冲扩展的以太网设备，可能部分容易受到攻击，尽管之前讨论的原始论文得出结论，基于使用示波器观察记录的闪烁模式，传输数据与LED行为之间没有直接相关性。
- en: The optimal solution, particularly with other types of encoding, or when pulse
    stretching is not desirable for some other reason (for example, if the designer
    wants to avoid making the LED light appear constantly for the time of a transmission)
    is to sample the line at a fairly low frequency (for example, 20 Hz) and latch
    it to a register that holds it until the next sample and that also controls the
    LED.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 最佳解决方案，尤其是在其他类型的编码中，或者当脉冲扩展不是出于某些其他原因（例如，如果设计者想避免在传输期间使LED灯持续发光）所希望的情况时，是在相当低的频率（例如，20
    Hz）下采样线路，并将其锁定到一个寄存器中，该寄存器在下一个采样之前保持其状态，并控制LED。
- en: And, now, back to plain English.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们回到普通的英语。
- en: '* * *'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[13](#CHP-5-FN-3)]) This, technically speaking, is still an attack venue,
    per the discussion in [Chapter 1](ch01.html "Chapter 1. I Can Hear You Typing"),
    yet it is considerably less effective and practical, for we only get a rough idea
    of what is going on, not a copy of the data.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[13](#CHP-5-FN-3)]) 从技术上来说，这仍然是一个攻击场所，根据[第1章](ch01.html "第1章。我能听到你在打字")中的讨论，但它相对不那么有效和实用，因为我们只能得到一个大致的了解，而不是数据的副本。
- en: Food for Thought
  id: totrans-190
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 思考的食物
- en: Other than network device LEDs, plenty of other, equally interesting light emissions
    leak scenarios can be found, although the amount of information disclosed can
    be significantly lower. For example, consider disk activity LEDs. Of course, disk
    communication is not using serial signaling; instead, portions of data, ranging
    from bytes to 32-bit words, are sent simultaneously using a set of signal lines.
    And, although the LED is usually attached to indicate only a state of a specific
    control line, it is still possible to deduce many aspects of system activity by
    measuring seek times or the amount of data stored and read. (Depending on what
    the LED is actually attached to, it may be possible to measure either or both.)
    Although it’s unlikely that this information would give an attacker any immediate
    advantage, certain induced I/O activities can be combined with hard-disk drive
    LED observation to draw interesting conclusions, although I am unaware of any
    research in this area.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 除了网络设备的LED灯之外，还可以找到许多其他同样有趣的光辐射泄露场景，尽管泄露的信息量可能显著较低。例如，考虑磁盘活动LED灯。当然，磁盘通信并不是使用串行信号；相反，数据的一部分，从字节到32位字，是通过一组信号线同时发送的。而且，尽管LED灯通常只连接到指示特定控制线状态，但通过测量寻道时间或存储和读取的数据量，仍然可以推断出许多系统活动的方面。（根据LED灯实际连接的位置，可能可以测量其中一个或两个。）尽管这些信息可能不会给攻击者带来任何立即的优势，但某些诱导的I/O活动可以与硬盘驱动器LED观察相结合，得出有趣的结论，尽管我对这个领域的任何研究都不了解。
- en: Other potential attack venues involve many USB devices and other proprietary
    interfaces. As mentioned earlier, USB is a serial bus, and some USB appliances
    do have activity indicators.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 其他潜在的攻击场所涉及许多USB设备和其他专有接口。如前所述，USB是一种串行总线，一些USB设备确实有活动指示器。
- en: Various other unusual and arcane information-disclosure venues have also been
    proposed, partly researched or at least toyed with. These include measuring the
    acoustic effects of recharging capacitors as the CPU consumes various levels of
    power depending on the executed instruction^([[64](apb.html#ftn.CHP-5-BIB-5)])
    or measuring a black box device by analyzing its power consumption with the help
    of statistical analysis.^([[65](apb.html#ftn.CHP-5-BIB-6)]) Once again, no truly
    comprehensive research has been done in the area of disclosure channels other
    than classic EMF (electromagnetic field) emanations—and it appears to be a good
    idea to investigate. Best of luck. :-)
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 还提出了各种其他不寻常和神秘的信息泄露场所，部分进行了研究或至少进行了尝试。这包括通过分析CPU根据执行指令消耗不同级别的功率时充电电容的声学效应^([[64](apb.html#ftn.CHP-5-BIB-5)])，或者通过统计分析帮助分析其功耗来测量黑盒设备^([[65](apb.html#ftn.CHP-5-BIB-6)])。再次强调，除了经典的电磁场（EMF）辐射之外，还没有对泄露通道领域进行真正全面的研究——这似乎是一个很好的研究想法。祝你好运。:-)
- en: Chapter 6. Echoes of the Past
  id: totrans-194
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第6章。过去的回声
- en: '*Where, on the example of a curious Ethernet flaw, we learn that it is good
    to speak precisely*'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: '*在以太网漏洞的例子中，我们了解到精确表达的好处*'
- en: —
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: —
- en: The previous chapter tackled the basics of Ethernet communications. This seemingly
    foolproof and amazingly trivial mechanism appears to be incapable of causing serious
    security issues, except for the possible abuse of the trust relationship caused
    by the regular broadcasting of data to all parties on the network. This is a well-known
    and well-understood property of Ethernet networks, for which good remedies include
    switches, bridges, and network segmentation, to name just a few.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 上一章讨论了以太网通信的基础。这个看似无懈可击且令人惊讶简单的机制似乎无法引起严重的安全问题，除了可能由于向网络上的所有方定期广播数据而导致的信任关系滥用。这是以太网网络众所周知且被充分理解的特性，其中一些有效的补救措施包括交换机、网桥和网络分段，仅举几例。
- en: Nonetheless, this issue manifests itself in ways wholly unforeseen, due largely
    to an unfortunate choice of words, or lack thereof, in the official implementation
    requirements for Ethernet drivers. A widespread implementation problem is the
    result, and it has reached a scale that has earned it a place as this chapter.
    It provides an interesting case study for this class of nobody-at-fault problems.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管如此，这个问题以完全无法预见的方式表现出来，这主要归因于以太网驱动程序官方实施要求中不幸的用词选择，或者缺乏用词。结果是普遍的实施问题，并且已经达到了一个规模，足以使它在这一章中占有一席之地。它为这一类无过错问题提供了一个有趣的案例研究。
- en: Building the Tower of Babel
  id: totrans-199
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 建造巴别塔
- en: 'The Ethernet protocol provides the basic means to distribute bytes over a piece
    of wire: a low-level data-encoding scheme, and a data format to contain a portion
    of the information. The Ethernet frame contains the information about the local
    disposition of the data it carries (that is, who is sending it and who should
    be the recipient) and a brief description of the type of information encapsulated.
    Additional methods for error detection are also provided, and then the entire
    frame is pushed out to a potential recipient and all other systems. In terms of
    functionality, Ethernet is similar to data portion encapsulation schemes used
    over different mediums or in different applications, such as frame relay, Asynchronous
    Transfer Mode (ATM), Point-to-Point Protocol (PPP), and so forth.'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网协议提供了在一段线缆上分配字节的基本手段：一种低级的数据编码方案，以及一种数据格式来包含部分信息。以太网帧包含了它所携带的数据的本地处理信息（即，谁在发送它以及谁应该是接收者）以及封装信息的简要描述。还提供了额外的错误检测方法，然后整个帧被推送到可能的接收者以及所有其他系统。从功能上讲，以太网类似于在不同介质或不同应用中使用的数据部分封装方案，例如帧中继、异步传输模式（ATM）、点对点协议（PPP）等等。
- en: The question is, “What data should be carried by such an Ethernet frame?” Computers
    use hundreds of formats and application protocols and can run applications ranging
    from scientific simulations to network games and chat clients. As such, although
    it is possible to simply encapsulate the data for a remote recipient within an
    Ethernet frame as is, it is usually a bad idea because the recipient won’t know
    how to handle it. Is it incoming email? A web picture? Or perhaps configuration
    data? You can’t tell. Too, because a typical computer runs a variety of programs
    almost simultaneously, the distinction is even further blurred.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 问题是，“这样一个以太网帧应该携带什么数据？”计算机使用数百种格式和应用协议，可以运行从科学模拟到网络游戏和聊天客户端的各种应用程序。因此，尽管可以在以太网帧中简单地封装远程接收者的数据，但通常这不是一个好主意，因为接收者不知道如何处理它。是传入的电子邮件？网页图片？还是可能是配置数据？你无法确定。此外，由于典型的计算机几乎同时运行各种程序，这种区别甚至更加模糊。
- en: 'Ethernet poses yet another problem on a larger scale; specifically, how to
    reach the other end. Broadcasting data to all parties on a local network is easy;
    but what if the other system, the party one of the local users hopes to reach,
    is not local? What if it has to be reached over a wide area network (WAN) and
    uses a wholly different link-layer protocol? Even if a way can be found to route
    traffic to that remote destination, a more fundamental issue remains: how to address
    the package.'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网在更大规模上又提出了另一个问题；具体来说，如何到达另一端。向本地网络上的所有方广播数据很容易；但如果另一个系统，即本地用户希望到达的一方，不是本地的呢？如果它必须通过广域网（WAN）并且使用完全不同的链路层协议来访问呢？即使找到了将流量路由到那个远程目的地的方法，一个更基本的问题仍然存在：如何寻址这个包。
- en: Ethernet uses its own unique, specialized addressing scheme. It calls hosts
    by their theoretically unique hardware card identification numbers (Media Access
    Control addresses, or MAC addresses) embedded by the manufacturer on every Ethernet
    adapter. These numbers are meaningful only to Ethernet; they are meaningless to
    any other type of network and are nearly impossible to use to track down a piece
    of hardware if you are not on the local setup. This raises a trust issue. For
    example, who bought a card with the address of 00:0D:56:E3:FB:E4, and where are
    they now? Can you trust them to really be the original purchaser and not an impostor?
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网使用其独特的、专门的寻址方案。它通过制造商在每个以太网适配器上嵌入的理论上唯一的硬件卡识别号（媒体访问控制地址，或MAC地址）来称呼主机。这些数字对以太网来说是有意义的；对任何其他类型的网络来说都是没有意义的，如果你不在本地设置中，几乎不可能使用这些数字来追踪硬件。这引发了一个信任问题。例如，谁购买了地址为00:0D:56:E3:FB:E4的卡，他们现在在哪里？你能信任他们真的是原始购买者而不是冒名顶替者吗？
- en: Low-level host-addressing schemes, such as this one, usually are no help in
    relaying data to its destination unless the hardware with a particular MAC address
    is attached directly to the sender’s physical network. There is no way to directly
    map a physical device identifier to a particular location on the globe and determine
    which path should be used to send it information.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 低级主机寻址方案，如这个方案，通常在将数据转发到目的地时没有帮助，除非具有特定MAC地址的硬件直接连接到发送者的物理网络。没有直接将物理设备标识符映射到地球上的特定位置并确定发送信息应使用的路径的方法。
- en: The OSI Model
  id: totrans-205
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: OSI模型
- en: The link-level protocols were designed to support communication between local
    nodes or, in some extreme cases, between two fixed endpoints on a shared link.
    To make internetworking possible and some more practical uses of the networks
    feasible, a hierarchical structure of network protocols called Open System Interconnection
    (OSI) was devised.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 链路层协议被设计来支持本地节点之间的通信，或者在极端情况下，在共享链路上的两个固定端点之间进行通信。为了使互连网络成为可能，并使网络的某些更实际的应用成为可行，设计了一个称为开放系统互连（OSI）的网络协议分层结构。
- en: The OSI model (see [Figure 6-1](ch06.html#the_physical_data_layout_in_the_osi_mode
    "Figure 6-1. The physical data layout in the OSI model, an example")) defines
    the physical connection level as the first layer and builds higher-level features
    on top of it. Link-level protocols constitute the second layer (data link layer)
    and are, as expected, defined as a way to communicate with other local nodes that
    use the same physical link. These protocols carry higher-level, link-independent
    protocol data, defined as the third layer (network layer) of the model. The Internet
    Protocol, IP for short, is the most prominent example of such a protocol.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: OSI模型（见[图6-1](ch06.html#the_physical_data_layout_in_the_osi_mode "图6-1. OSI模型中的物理数据布局示例"））将物理连接层定义为第一层，并在其之上构建更高层的功能。链路层协议构成了第二层（数据链路层），正如预期的那样，被定义为与其他使用相同物理链路的本地节点通信的方式。这些协议携带更高层的、链路无关的协议数据，定义为模型的第三层（网络层）。互联网协议，简称IP，是这类协议中最突出的例子。
- en: '![The physical data layout in the OSI model, an example](httpatomoreillycomsourcenostarchimages1138042.png.jpg)'
  id: totrans-208
  prefs: []
  type: TYPE_IMG
  zh: '![OSI模型中的物理数据布局示例](httpatomoreillycomsourcenostarchimages1138042.png.jpg)'
- en: Figure 6-1. The physical data layout in the OSI model, an example
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 图6-1. OSI模型中的物理数据布局示例
- en: The third layer is designed to provide information about the general disposition
    of the traffic as well as universal identification of both the origin and final
    destination of data using network-specific addressing, thus making it easier to
    route the packet. Unlike the second-layer protocols, the third layer is not discarded
    or modified en route and is devoid of any link-specific features such as MAC addresses,
    CSMA/CD (Carrier Sense Multiple Access with Collision Detection) overhead, and
    so forth.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 第三层被设计用来提供有关流量的一般分布情况以及使用网络特定寻址对数据源和最终目的地的通用识别，从而使得路由分组变得更容易。与第二层协议不同，第三层在传输过程中不会被丢弃或修改，并且不包含任何链路特定特征，如MAC地址、CSMA/CD（载波侦听多路访问与碰撞检测）开销等。
- en: The fourth layer provides the means for establishing specific communication
    channels between endpoints starting and terminating on a given machine. This provides
    a way for simultaneous communication of multiple types and channels. None of the
    fourth-level protocols needs to be understood by intermediate systems to properly
    deliver the traffic to the destination. The packets are interpreted only by the
    final recipient to determine which application should be receiving the data and
    how this piece of information relates to adjacent packets.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 第四层提供了在给定机器上起始和终止的端点之间建立特定通信通道的手段。这为多种类型和通道的同步通信提供了一种方式。第四层的任何协议都不需要中间系统理解，以便正确地将流量传输到目的地。数据包仅由最终接收者解释，以确定哪个应用程序应该接收数据以及这一信息片段如何与相邻的数据包相关。
- en: The subsequent layers of the OSI model are perhaps less interesting and have
    a tendency to blend together. The fifth level is supposed to provide reliability
    features that are often incorporated either in fourth-level protocols, such as
    TCP/IP (Transmission Control Protocol/Internet Protocol), or on the application
    level. In some cases, they are not even implemented at all if there is no need
    to achieve reliable communications. The sixth level provides “library” functions,
    such as decompression and decoding of the data and, as with the fifth level, is
    usually perceived in terms of application-level functionality. Finally, the seventh
    layer is the application layer, the place where data is transferred in a specific
    format.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: OSI模型的后续层可能不太有趣，并且有融合在一起的趋势。第五层本应提供可靠性功能，这些功能通常包含在第四层协议中，如TCP/IP（传输控制协议/互联网协议），或者在应用层。在某些情况下，如果没有必要实现可靠的通信，它们甚至根本不会实现。第六层提供“库”功能，如数据的解压缩和解码，并且与第五层一样，通常以应用级功能来感知。最后，第七层是应用层，数据以特定格式在此层传输。
- en: Notice that the higher layers in the OSI model are independent of the lower
    layers as they apply to the carried data. When the time is right, the lower layers
    can gradually be disposed of without losing the data or the ability to further
    process it. The second layer is discarded at every intermediate system; the third
    layer can be discarded once the data is delivered to its destination system. The
    fourth layer is dropped before delivering the data to the client application.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，OSI模型中的高层相对于底层是独立的，因为它们应用于承载的数据。当时机成熟时，底层可以逐渐被丢弃，而不会丢失数据或进一步处理数据的能力。第二层在每一个中间系统中都会被丢弃；第三层在数据被传输到其目的地系统后可以丢弃。第四层在将数据传输到客户端应用程序之前被丢弃。
- en: The third layer usually remains completely independent of the underlying link-level
    protocol by providing complete sender and addressee information, an integrity
    protection mechanism (checksumming), and information about the size of the carried
    payload. This is precisely what IP does.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 第三层通常通过提供完整的发送者和接收者信息、完整性保护机制（校验和）以及承载有效载荷的大小信息，与底层链路层协议完全独立。这正是IP所做的事情。
- en: One important consequence of this design is that any superfluous information
    appended to the packet on layer 2 while in transit will not affect the way the
    IP information is interpreted by the addressee.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 这种设计的一个重要后果是，在传输过程中附加到第二层数据包上的任何多余信息都不会影响接收者解释IP信息的方式。
- en: The Missing Sentence
  id: totrans-216
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 缺失的句子
- en: 'In the previous chapter’s discussion of the design of the Ethernet, I mentioned
    an interesting requirement that arises out of a need to provide reliable jam code
    propagation for the purpose of collision notification: the *minimum* size limit
    for an Ethernet frame.'
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一章关于以太网设计的讨论中，我提到了一个有趣的需求，即出于提供可靠的中断代码传播以实现冲突通知的目的：以太网帧的*最小*尺寸限制。
- en: This requirement was carried over to the official IP-over-Ethernet encapsulation
    specifications, such as RFC 1042, “A Standard for the Transit of Internet Protocol
    Datagrams Over IEEE 802 Networks,”^([[66](apb.html#ftn.CHP-6-BIB-1)]) by requiring
    frames that were shorter than this minimum length to be padded. The padding can
    be carried out at will and has no effect on the carried data on the IP layer,
    as the packet length specified in the IP headers does not change. Thus, the padding
    will not be interpreted by the recipient as a part of higher-level OSI model traffic.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 这个要求被带到了官方的IP-over-Ethernet封装规范中，例如RFC 1042，“在IEEE 802网络中传输互联网协议数据报的标准”[[66](apb.html#ftn.CHP-6-BIB-1)]，它要求长度短于此最小长度的帧进行填充。填充可以随意进行，并且对IP层上携带的数据没有影响，因为IP头中指定的数据包长度不会改变。因此，填充不会被接收方解释为OSI模型高层流量的一个部分。
- en: There is, however, a slight problem. Although the RFC requires the padding to
    be initialized to zero, it does not specify who should provide and prepare the
    padding and at what software stage the padding should occur. The need for the
    padding to be of a particular value is also a requirement that in its nature is
    fairly arbitrary; hence, no attention is paid to it—setting it any other way would
    not impact how the protocol works, because the extraneous data is simply discarded
    upon receipt.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，存在一个轻微的问题。尽管RFC要求填充必须初始化为零，但它没有指定谁应该提供和准备填充，以及填充应该在哪个软件阶段发生。填充需要具有特定值的需求本质上是一种相当随意的需求；因此，对此没有给予关注——以任何其他方式设置都不会影响协议的工作，因为接收到的额外数据会被简单地丢弃。
- en: To add to the confusion, many network interface cards provide an autopadding
    feature if a packet the operating system sent to the hardware is too short—but,
    naturally, not to ensure the specific contents of a padding if frame size has
    been already taken care of in software. This led to wide-spread confusion among
    some developers who chose to obey the size requirement and extend the size of
    a packet in software by simply increasing its declared length. They often did
    not realize that the data between the end of the IP packet and the end of the
    padded frame was not prepared (initialized to zeros) by the driver, the operating
    system, or the hardware.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 更令人困惑的是，许多网络接口卡提供自动填充功能，如果操作系统发送给硬件的数据包太短——但自然地，不是为了确保填充的具体内容，如果帧大小已经在软件中得到了处理。这导致一些选择遵守大小要求的开发者中广泛存在混淆，他们简单地通过增加声明的长度来在软件中扩展数据包的大小。他们通常没有意识到，IP数据包末尾和填充帧末尾之间的数据没有被驱动程序、操作系统或硬件准备（初始化为零）。
- en: The problem went largely unnoticed for years, although it caused an awkward
    issue that regularly drove some network hackers insane. The packets they received
    from local systems often contained some extra garbage at the end—such as fragments
    of website contents or even chat conversations that were clearly irrelevant. They
    blamed the recipient (faulty equipment, the network traffic analysis application,
    libraries) but ultimately gave up looking for a cause because the issue was of
    marginal relevance. The issue never got the attention it deserved.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 这个问题多年来几乎未被注意，尽管它引起了一些尴尬的问题，这些问题经常让一些网络黑客感到疯狂。他们从本地系统接收到的数据包通常在末尾包含一些额外的垃圾数据——例如网站内容的片段或显然无关的聊天对话。他们责怪接收方（设备故障、网络流量分析应用程序、库）但最终放弃寻找原因，因为这个问题的重要性微乎其微。这个问题从未得到应有的关注。
- en: That is, not until Ofir Arkin and Josh Anderson of @Stake decided to give it
    a closer look in 2003\. Their paper “EtherLeak—Ethernet Frame Padding Information
    Leaks”^([[67](apb.html#ftn.CHP-6-BIB-2)]) examined the problem in more detail.
    The authors realized that a large number of mainstream systems, such as Linux,
    NetBSD, Microsoft Windows, and other platforms, fail to initialize the memory
    at the end of the newly prepared Ethernet frame after modifying its length. Some
    implementations even fail to change the size of a frame properly or to send a
    proper number of bytes to the hardware layer.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 直到2003年，Ofir Arkin和Josh Anderson在@Stake决定更仔细地研究这个问题。他们的论文“EtherLeak——以太网帧填充信息泄露”[[67](apb.html#ftn.CHP-6-BIB-2)]更详细地研究了这个问题。作者意识到，大量主流系统，如Linux、NetBSD、Microsoft
    Windows和其他平台，在修改长度后未能初始化新准备的以太网帧末尾的内存。一些实现甚至未能正确更改帧的大小或向硬件层发送适当数量的字节。
- en: 'As a result, the IP packet is padded with data that happens to be stored in
    the portion of memory the system used previously for other purposes. The memory
    could contain part of a previously sent packet or some other kernel memory fragment,
    depending on the design of the driver or the operating system. This, of course,
    creates a fascinating information disclosure scenario: An attacker sends inconspicuous
    and legitimate traffic to the victim and, with some luck, obtains potentially
    sensitive information. The amount of information disclosed is typically sufficient
    to justify concern.'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，IP数据包被填充了系统之前用于其他目的的内存部分中存储的数据。内存可能包含之前发送的数据包的一部分或其他内核内存片段，这取决于驱动程序或操作系统的设计。这当然创造了一个迷人的信息泄露场景：攻击者向受害者发送不明显且合法的流量，并且如果运气好的话，可以获得可能敏感的信息。泄露的信息量通常足以证明担忧。
- en: 'The exposure is limited to a single Ethernet network and, as such, is fairly
    localized and noncritical in a typical LAN environment. Still, it definitely remains
    a problem of some significance, and even though any local network is partly vulnerable
    to snooping, this particular problem suggests some conclusions that extend beyond
    the most obvious:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 这种暴露仅限于单个以太网网络，因此在一个典型的局域网环境中，它相对局部化和非关键。尽管如此，这确实是一个具有一定重要性的问题，尽管任何本地网络都部分容易受到窃听，但这个问题提出了一些结论，这些结论超出了最明显的：
- en: On systems that use dynamic buffers for outgoing Ethernet frames (Linux, for
    example), the padding can expose not only the previous frame, but other memory
    contents, such as edited or viewed documents, URLs, passwords, or other sensitive
    resources. In this case, a careful observer might be able to gain access to information
    they could not otherwise intercept on the network.
  id: totrans-225
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在使用动态缓冲区来处理出站以太网帧的系统（例如Linux）中，填充可能会暴露不仅前一个帧，还包括其他内存内容，例如编辑或查看的文档、URL、密码或其他敏感资源。在这种情况下，一个细心的观察者可能能够获取到他们原本无法在网络中截获的信息。
- en: On systems that use static buffers only to prepare Ethernet frames, the problem
    can be exploited to defeat systems that protect against traffic sniffing, such
    as switches, enabling the attacker to intercept data from a different connection.
  id: totrans-226
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在仅使用静态缓冲区来准备以太网帧的系统上，可以利用这个问题来击败那些保护防止流量嗅探的系统，如交换机，从而使得攻击者能够截取来自不同连接的数据。
- en: In certain static buffer designs, information from another segment on a multihoned
    machine, with one network interface connected to a general LAN and the other interface
    hooked up to a restricted network, can be exposed, thus relaying portions of presumably
    secret data to the public infrastructure.
  id: totrans-227
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在某些静态缓冲区设计中，来自多端口机器上另一个段的信息，其中一个网络接口连接到通用局域网，另一个接口连接到受限网络，可能会被暴露，从而将可能被认为是秘密数据的部分转发到公共基础设施。
- en: The authors of the paper extensively reviewed several open-source implementations
    and concluded that a variety of approaches and buffer layouts are commonly used
    and that there is no predominant buffer allocation and usage scheme. Their conclusion?
    A typical diverse network environment is likely to be affected by all three types
    of issues at some point.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 论文作者广泛审查了几个开源实现，并得出结论，各种方法和缓冲区布局被普遍使用，并且没有占主导地位的缓冲区分配和用法方案。他们的结论是？一个典型的多样化网络环境可能会在某个时刻受到所有三种类型问题的影響。
- en: Food for Thought
  id: totrans-229
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 思考之食
- en: The issue discussed here is not unique to Ethernet or network design. These
    problems almost always arise when an otherwise detailed implementation guideline
    omits or only vaguely discusses a single necessary step, causing numerous developers
    to simply overlook the problem while implementing the standard. Had they been
    given more vague overall instructions, developers would probably be forced to
    think through the problem. Instead, they implement step-by-step instructions and
    are far more vulnerable to committing errors. “Foolproof” instructions that tell
    how to perform certain tasks, as opposed to what to achieve, often backfire.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 这里讨论的问题不仅限于以太网或网络设计。这些问题几乎总是在一个本应详细的实现指南省略或仅模糊讨论单个必要步骤时出现，导致许多开发者在实现标准时简单地忽略了这个问题。如果他们得到了更模糊的整体指示，开发者可能被迫思考这个问题。相反，他们实施逐步指令，并且更容易犯错误。“万无一失”的指令，告诉如何执行某些任务，而不是要达到什么目标，往往适得其反。
- en: We will return to the problems of protocol leak scenarios, albeit in a slightly
    different context, in [Part III](pt03.html "Part III. Out in the Wild") of this
    book.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在本书的第三部分[Part III](pt03.html "Part III. Out in the Wild")中，以略有不同的背景重新回到协议泄露场景的问题。
- en: Chapter 7. Secure in Switched Networks
  id: totrans-232
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第7章。在交换网络中保持安全
- en: '*Or, why Ethernet LANs cannot be quite fixed, no matter how hard we try*'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: '*或者，为什么无论我们多么努力，以太网局域网都无法完全固定*'
- en: —
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: —
- en: Ethernet networks do not provide a universal and easy way to ensure the integrity
    or confidentiality of the data they transmit, nor are they engineered to with-stand
    malicious, intentionally injected traffic. Ethernet is merely a means for interfacing
    a number of local, presumably trusted systems.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网网络不提供一种通用的、简单的方法来确保它们传输数据的完整性和机密性，它们也没有设计成能够抵御恶意、故意注入的流量。以太网仅仅是一种将多个本地、假设为可信的系统进行接口的手段。
- en: Assuming this level of trust is convenient at the design stage and is theoretically
    sufficient for peer systems on the same network and often at roughly the same
    physical location. But, as the old saying goes, only in theory is there no difference
    between theory and practice. In practice, there is a difference.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 假设在设计阶段这种信任程度是方便的，并且在理论上对于同一网络上的对等系统和通常位于大致相同物理位置的系统来说是足够的。但是，正如俗话所说，只有在理论上，理论与实践之间没有区别。在实践中，是有区别的。
- en: As it turns out, local networks are difficult to fully control and must be protected
    from their own users as well as from external threats. Any expanding local network
    is bound to encounter a rogue user, whether from within the organization or from
    outside, exploiting a flaw in one of the systems. The occurrence of such an exploit
    is only a matter of time, as almost all network administrators learn at some point.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 事实上，本地网络很难完全控制，并且必须保护它们免受自身用户以及外部威胁的影响。任何扩展的本地网络都注定会遇到一个恶意用户，无论是来自组织内部还是外部，利用系统中某个漏洞。这种攻击的发生只是时间问题，因为几乎所有的网络管理员在某一点上都会学到这一点。
- en: Practical network security is the art of detecting incidents, minimizing exposure,
    and assessing and understanding the risk on all levels, not only an exercise in
    building perimeter defenses. The problem? A bare-bones Ethernet infrastructure
    is prone to all types of data interception, hijacking, and impersonation scenarios;
    once an intruder or a malicious but legitimate user controls a single system on
    the network—breaking through a single line of defense—this person can wreak havoc
    on the infrastructure and gain access or take over certain resources and services
    with minimal effort.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 实际的网络安全是检测事件、最小化暴露、评估和理解所有层面的风险的艺术，而不仅仅是建立外围防御的练习。问题是什么？裸骨的以太网基础设施容易受到各种数据拦截、劫持和仿冒场景的影响；一旦入侵者或恶意但合法的用户控制了网络上的单个系统——突破了一道防线——这个人就可以对基础设施造成破坏，并以最小的努力获取或接管某些资源和服务。
- en: Some Theory
  id: totrans-239
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 一些理论
- en: Ethernet switches, a class of smart devices designed to route unicast traffic
    on the second OSI layer to the appropriate port instead of broadcasting it to
    all nodes (as is the case with hubs or direct connections), may appear to solve
    this problem. They are often thought to solve the security problems associated
    with the ability for one system to observe or hijack third-party traffic, but
    this is not so. The solution is not that simple, and the confusion caused by this
    presumption sometimes causes more harm than the switches could do good in the
    first place. But first things first. To understand the exposure, let’s look at
    how Ethernet switches really work.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网交换机，一类智能设备，旨在将第二层OSI上的单播流量路由到适当的端口，而不是像集线器或直接连接那样广播到所有节点，似乎可以解决这个问题。它们通常被认为可以解决与一个系统观察或劫持第三方流量相关的安全问题，但这并非如此。解决方案并不简单，这种假设造成的混淆有时比交换机最初能做的危害更大。但首先，为了理解暴露情况，让我们看看以太网交换机实际上是如何工作的。
- en: Address Resolution and Switching
  id: totrans-241
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 地址解析和交换
- en: All communication within a local network is based on the addressing scheme discussed
    in [Chapter 5](ch05.html "Chapter 5. Blinkenlights"). Unique identifiers assigned
    by the hardware manufacturer to a specific endpoint device are used to address
    systems and deliver data frames. However, the Internet and most of today’s private
    networks are built around a more flexible and universal suite of protocols and
    use an addressing scheme on the third OSI layer, commonly known as Internet Protocol
    (IP) addresses. The IP address is first used to direct the traffic across the
    world to an appropriate local network using a hierarchy of routing tables on middle
    systems all over the globe; not until the packet reaches the perimeter of the
    destination network must the final recipient be located the old-fashioned way,
    by a hardware address lookup.
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 本地网络内的所有通信都是基于在[第5章](ch05.html "第5章。闪烁灯")中讨论的寻址方案。硬件制造商为特定端点设备分配的唯一标识符用于寻址系统和传输数据帧。然而，互联网和今天的大多数私有网络都是围绕一个更灵活和通用的协议套件构建的，并使用第三层OSI的寻址方案，通常称为互联网协议（IP）地址。IP地址首先用于通过全球中间系统上的路由表层次结构将流量引导到适当的地方网络；直到数据包到达目标网络的边缘，才必须以传统方式定位最终接收者，即通过硬件地址查找。
- en: Whenever a system on the local network decides to locate another local party
    with a specific IP address, it uses a special address resolution protocol (ARP)
    to determine the association between a physical card address—the basis for addressing
    systems on a local network—and the IP address, a universal internetworking system
    identifier.^([[68](apb.html#ftn.CHP-7-BIB-1)]) The sender distributes an ARP query
    to a special broadcast address on the local network. This reserved address is
    guaranteed to be received and processed by all systems on the network, regardless
    of the actual hardware address assigned to specific nodes. In this scenario, the
    system that considers itself to have the right to use the IP address specified
    in the query is expected to send a response to the sender, thus disclosing its
    hardware address in answer to the query; all other folks are supposed to silently
    ignore the broadcast ARP packet. After this exchange, both parties now know each
    other’s IP and media access control (MAC) addresses. They should cache the finding
    in a special buffer to eliminate the need to perform additional lookups every
    time a portion of data is exchanged and then proceed with the actual communications—but
    other than that, they are ready to swap some packets based on IP addressing. This
    design is a charming and delightful example of an old-time trust and courtesy.
    But what can be done to contain the exposure caused by a malicious bystander on
    the same network, who pretends to be someone else, and what can be done to prevent
    the more curious users or evil foes from reaching too far? Manufacturers of the
    Ethernet hardware most certainly did not help network administrators by making
    it possible and trivial to change MAC addresses on most of today’s devices—presumably
    allowing the user to reprogram then in order not to end up in trouble should one
    day a batch of cards turn out to have duplicate addresses.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 当本地网络上的一个系统决定定位具有特定IP地址的另一个本地方时，它使用一个特殊的地址解析协议（ARP）来确定物理卡地址（本地网络系统寻址的基础）与IP地址（通用互联网系统标识符）之间的关联。[68](apb.html#ftn.CHP-7-BIB-1)
    发送者将ARP查询分发到本地网络上的一个特殊广播地址。这个保留地址保证会被网络上的所有系统接收和处理，无论分配给特定节点的实际硬件地址是什么。在这种情况下，认为自己有权使用查询中指定的IP地址的系统应向发送者发送响应，从而在回答查询时披露其硬件地址；其他人则应静默忽略广播ARP数据包。在此交换之后，双方现在都知道对方的IP地址和媒体访问控制（MAC）地址。他们应该在特殊缓冲区中缓存这个发现，以消除每次交换数据部分时进行额外查找的需要，然后继续实际通信——但除此之外，他们准备根据IP地址交换一些数据包。这种设计是一个古老而迷人的信任和礼貌的例子。但如何限制同一网络上的恶意旁观者造成的暴露，他假装成另一个人，以及如何防止好奇心强或邪恶的对手走得太远？以太网硬件制造商通过使大多数设备上的MAC地址更改变得可能且简单，肯定没有帮助网络管理员——可能允许用户重新编程，以防万一一批卡片出现重复地址时陷入麻烦。
- en: Again, switches appear to solve the problem. The basic design concept behind
    a smart switching device relies on duplicating the MAC address cache on the level
    of an interim network device. A switching device is equipped with numerous Ethernet
    ports, each of which connects to a single system (or, less often, a set of systems).
    But instead of serving as dumb repeaters, sending all traffic received on one
    port to all others (as Ethernet hubs do), switches attempt to memorize MAC addresses
    associated with a machine connected to each port, effectively creating MAC-to-port
    associations, as opposed to the MAC-to-IP mappings created by endpoint systems.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 再次，交换机似乎解决了这个问题。智能交换设备背后的基本设计概念依赖于在临时网络设备级别复制 MAC 地址缓存。交换设备配备了多个以太网端口，每个端口连接到单个系统（或较少情况下，是一组系统）。但交换机不是作为哑重复器，将一个端口接收到的所有流量发送到所有其他端口（就像以太网集线器那样），而是尝试记住连接到每个端口的机器的
    MAC 地址，有效地创建 MAC 到端口的关联，而不是由端点系统创建的 MAC 到 IP 映射。
- en: The data, stored in content addressable memory^([[14](#ftn.CHP-7-FN-1)]) (CAM),
    determines where to deliver incoming packets. Whenever a portion of traffic arrives,
    the switch attempts to determine which port the addressee is on. If this information
    is available, the packet is delivered directly (and only) to this particular port,
    keeping the information away from others and improving network performance.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 存储在内容可寻址内存^([[14](#ftn.CHP-7-FN-1)])（CAM）中的数据决定了如何交付传入的数据包。每当部分流量到达时，交换机会尝试确定接收者所在的端口。如果此信息可用，数据包将直接（并且仅）发送到该特定端口，将信息从其他人那里隔离开来，从而提高网络性能。
- en: Virtual Networks and Traffic Management
  id: totrans-246
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 虚拟网络和流量管理
- en: 'Some more advanced switch solutions provide additional features intended to
    make it easier to manage extensive networks and to lower deployment times and
    expenses. These features also appear to help with network security and may include
    the following:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 一些更高级的交换机解决方案提供了额外的功能，旨在使管理大型网络更加容易，并降低部署时间和成本。这些功能似乎也有助于网络安全，可能包括以下内容：
- en: '**Virtual LAN (VLAN)**'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: '**虚拟局域网 (VLAN**)'
- en: A general name for a set of methods used to divide a pool of ports on a physical
    device into a set of separate logical networks, thus separating traffic on a group
    of ports from others and preventing any kind of traffic from crossing between
    those groups on the switch level. (This scheme is most commonly implemented using
    the IEEE 802.1Q standard, discussed in the next item in detail.) Implementing
    a VLAN is like splitting a single switch into several fully independent devices,
    except that the VLAN solution is far more flexible and cost-effective, because
    it is possible to reshape your network and reallocate physical resources at will.
    VLANs were met with a warm welcome by network staff everywhere because they promised
    to offer a simple yet powerful way to build a set of separate networks on a single
    device or, for example, separate servers from workstations, without the need to
    buy a dedicated switch for each group.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个通用的名称，用于描述一系列方法，用于将物理设备上的端口池划分为一组独立的逻辑网络，从而将一组端口的流量与其他流量分离，并防止任何类型的流量在交换机级别之间交叉。（此方案通常使用
    IEEE 802.1Q 标准实现，将在下一项中详细讨论。）实现 VLAN 就像将单个交换机分割成多个完全独立的设备，只不过 VLAN 解决方案更加灵活且成本效益更高，因为它允许您随意重新设计网络和重新分配物理资源。VLAN
    在网络工作人员中受到了热烈的欢迎，因为它们承诺提供一种简单而强大的方式，在单个设备上构建一组独立的网络，例如，将服务器与工作站分离，无需为每个组购买专用交换机。
- en: '**Trunking**'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: '**聚合**'
- en: 'A natural extension of the baseline VLAN design. Trunks use the IEEE 802.1Q
    frame-tagging scheme to tunnel multiple VLAN traffic over a single link, instead
    of forcing the user to run separate wire for every VLAN to be populated to another
    device, as shown in [Figure 7-1](ch07.html#vlan_trunking_in_action._vlans_propagate
    "Figure 7-1. VLAN trunking in action. VLANs propagated across two devices. Devices
    on all instances of both VLAN #1 and VLAN #2 can talk with each other, but cross
    talk between VLAN #1 and VLAN #2 is not possible."). Packets from all or some
    VLANs on the source switch are tagged with enough information to determine their
    originating VLAN within the Ethernet frame header, tunneled to the other endpoint
    over a traditional link, decoded, and then pushed out into appropriate VLANs at
    the destination. Although this option usually results in lower performance than
    running a separate cable for every subnet, it is much more practical. Trunked
    systems often also feature DTP (Dynamic Trunking Protocol), a trunk autoconfiguration
    protocol that enables devices to automatically discover and exchange encapsulated
    frames other trunk-enabled devices with no special administrative actions required.'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: '基线VLAN设计的自然扩展。 trunk使用IEEE 802.1Q帧标记方案在单个链路上隧道多个VLAN流量，而不是强迫用户为每个要填充到另一个设备的VLAN运行单独的线缆，如图[图7-1](ch07.html#vlan_trunking_in_action._vlans_propagate
    "图7-1. VLAN trunking in action. VLANs propagated across two devices. Devices on
    all instances of both VLAN #1 and VLAN #2 can talk with each other, but cross
    talk between VLAN #1 and VLAN #2 is not possible.")所示。来自源交换机上的所有或某些VLAN的数据包被标记上足够的信息，以便在以太网帧头部确定它们的原始VLAN，通过传统的链路隧道到另一个端点，解码后，然后推送到目标端适当的VLAN。尽管这种选项通常会导致比为每个子网运行单独的线缆的性能更低，但它要实际得多。trunk系统通常还具备DTP（动态trunking协议），这是一种trunk自动配置协议，允许设备在没有特殊管理操作的情况下自动发现和交换封装帧，其他trunk启用设备。'
- en: '![VLAN trunking in action. VLANs propagated across two devices. Devices on
    all instances of both VLAN #1 and VLAN #2 can talk with each other, but cross
    talk between VLAN #1 and VLAN #2 is not possible.](httpatomoreillycomsourcenostarchimages1138044.png.jpg)'
  id: totrans-252
  prefs: []
  type: TYPE_IMG
  zh: '![VLAN trunking in action. VLANs propagated across two devices. Devices on
    all instances of both VLAN #1 and VLAN #2 can talk with each other, but cross
    talk between VLAN #1 and VLAN #2 is not possible.](httpatomoreillycomsourcenostarchimages1138044.png.jpg)'
- en: 'Figure 7-1. VLAN trunking in action. VLANs propagated across two devices. Devices
    on all instances of both VLAN #1 and VLAN #2 can talk with each other, but cross
    talk between VLAN #1 and VLAN #2 is not possible.'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: '图7-1. VLAN trunking in action. VLANs propagated across two devices. Devices
    on all instances of both VLAN #1 and VLAN #2 can talk with each other, but cross
    talk between VLAN #1 and VLAN #2 is not possible.'
- en: '**Spanning tree protocol (STP)**'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: '**生成树协议（STP**）'
- en: Lets you build redundant network structures in which switches are interconnected
    in more than one location, in order to maintain fault tolerance. Traditionally,
    such a design could cause broadcast traffic and some other packets to loop forever
    while also causing network performance to deteriorate significantly, because the
    data received on one interface and forwarded to another in effect bounces back
    to the originator (see [Figure 7-2](ch07.html#packet_storm_problem_and_stp_election_sc
    "Figure 7-2. Packet storm problem and STP election scheme; left side shows a fault-tolerant
    network with no STP, where some packets are bound to loop (almost) forever between
    switches; right side is the same network where one of the devices was automatically
    elected a master node using STP, and for which the logical topology was adjusted
    to eliminate loops. When one of the links fails, the network would be reconfigured
    to ensure proper operations."), left).
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 允许您构建冗余的网络结构，其中交换机在多个位置相互连接，以保持容错性。传统上，这种设计可能会导致广播流量和一些其他数据包永远循环，同时也会显著降低网络性能，因为在一个接口上接收到的数据被转发到另一个接口时实际上会弹回原始发送者（参见[图7-2](ch07.html#packet_storm_problem_and_stp_election_sc
    "图7-2. 数据包风暴问题和STP选举方案；左侧显示了一个没有STP的容错网络，其中一些数据包注定会在交换机之间循环（几乎）永远；右侧是相同的网络，其中一个设备被自动选为主节点使用STP，并且逻辑拓扑被调整以消除循环。当其中一个链路失败时，网络会重新配置以确保正常操作。"),
    左侧）。
- en: When designing a network, it is often difficult to avoid accidental broadcast
    loops. It is also sometimes desirable to design architectures with potential loops
    (in which one switch connects to two or more switches), because this type of design
    is much more fault tolerant and a single device or single link can be taken out
    without dividing the entire network into two separate islands.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 设计网络时，往往难以避免意外广播环的出现。有时，设计具有潜在环路的架构（其中某个交换机连接到两个或更多交换机）也是可取的，因为这种设计具有更高的容错性，单个设备或单个链路被移除时，整个网络不会分裂成两个独立的岛屿。
- en: To make it possible to build loops and other nontrivial architectures without
    causing serious performance problems, STP implements an election mechanism to
    select a “root” node switch. Based on the result of this election, a treelike
    traffic distribution hierarchy is built from this node down, and links that could
    cause a reverse propagation of broadcast traffic are temporarily disabled (see
    [Figure 7-2](ch07.html#packet_storm_problem_and_stp_election_sc "Figure 7-2. Packet
    storm problem and STP election scheme; left side shows a fault-tolerant network
    with no STP, where some packets are bound to loop (almost) forever between switches;
    right side is the same network where one of the devices was automatically elected
    a master node using STP, and for which the logical topology was adjusted to eliminate
    loops. When one of the links fails, the network would be reconfigured to ensure
    proper operations."), right). You can quickly change this simple self-organizing
    hierarchy when one of the nodes drops off and reactivate a link previously deemed
    unnecessary.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 为了能够在不引起严重性能问题的同时构建环路和其他非平凡架构，STP实现了一个选举机制来选择一个“根”节点交换机。基于选举结果，从该节点向下构建一个树状流量分布层次结构，并暂时禁用可能导致广播流量反向传播的链路（参见[图7-2](ch07.html#packet_storm_problem_and_stp_election_sc
    "图7-2. 数据包风暴问题和STP选举方案；左侧显示了一个没有STP的容错网络，其中一些数据包注定会在交换机之间（几乎）永远循环；右侧是相同的网络，其中一个设备被自动选为根节点交换机，并使用STP调整了逻辑拓扑以消除环路。当其中一个链路失败时，网络会重新配置以确保正常运行。"),
    右）。当其中一个节点掉线时，您可以快速更改这个简单的自组织层次结构，并重新激活之前认为不必要的链路。
- en: '![Packet storm problem and STP election scheme; left side shows a fault-tolerant
    network with no STP, where some packets are bound to loop (almost) forever between
    switches; right side is the same network where one of the devices was automatically
    elected a master node using STP, and for which the logical topology was adjusted
    to eliminate loops. When one of the links fails, the network would be reconfigured
    to ensure proper operations.](httpatomoreillycomsourcenostarchimages1138046.png.jpg)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![数据包风暴问题和STP选举方案；左侧显示了一个没有STP的容错网络，其中一些数据包注定会在交换机之间（几乎）永远循环；右侧是相同的网络，其中一个设备被自动选为根节点交换机，并使用STP调整了逻辑拓扑以消除环路。当其中一个链路失败时，网络会重新配置以确保正常运行。](httpatomoreillycomsourcenostarchimages1138046.png.jpg)'
- en: Figure 7-2. Packet storm problem and STP election scheme; left side shows a
    fault-tolerant network with no STP, where some packets are bound to loop (almost)
    forever between switches; right side is the same network where one of the devices
    was automatically elected a master node using STP, and for which the logical topology
    was adjusted to eliminate loops. When one of the links fails, the network would
    be reconfigured to ensure proper operations.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 图7-2. 数据包风暴问题和STP选举方案；左侧显示了一个没有STP的容错网络，其中一些数据包注定会在交换机之间（几乎）永远循环；右侧是相同的网络，其中一个设备被自动选为根节点交换机，并使用STP调整了逻辑拓扑以消除环路。当其中一个链路失败时，网络会重新配置以确保正常运行。
- en: '* * *'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[14](#CHP-7-FN-1)]) As its name suggests, this type of memory can be directly
    addressed by the parameter for which you are trying to determine the value, which
    saves time that would normally have to be spent on searching for the parameter.
    A library catalog is a trivial example of CAM—you do not need to go through all
    the books in the library just to find one; you determine where to look based on
    what you are looking for (a piece of information about the “content”).
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[14](#CHP-7-FN-1)]) 如其名所示，这种类型的内存可以直接通过您试图确定值的参数进行寻址，这节省了通常需要花费在搜索参数上的时间。图书馆目录是CAM的一个简单例子——您不需要翻阅图书馆中的所有书籍，只需找到一本书；您根据您要查找的内容（关于“内容”的信息）来确定查找位置。
- en: Attacking the Architecture
  id: totrans-262
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 攻击架构
- en: The mechanisms discussed so far were engineered to improve the bottom line while
    providing high performance, on top of a network design that provides no security
    features whatsoever.^([[69](apb.html#ftn.CHP-7-BIB-2)]) Although certain common,
    well-understood, and easy-to-prevent attacks, such as *MAC spoofing* (the ability
    for any person to spoof an ARP message and impersonate a device with a particular
    IP) are widely recognized as a pitfall of local area networking and are easy to
    prevent with properly configured switches, some other serious design flaws are
    not so trivial and, in fact, not prevented so easily. It is not always obvious
    that solutions commonly perceived as designed to improve security in fact do nothing
    to help it.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止讨论的机制都是为了提高底线，同时提供高性能，在没有任何安全特性的网络设计之上。尽管某些常见的、易于理解的且易于预防的攻击，如*MAC欺骗*（任何人都能够欺骗ARP消息并冒充具有特定IP的设备）被广泛认为是局域网的一个陷阱，并且可以通过正确配置的交换机轻松预防，但一些其他严重的设计缺陷并不那么简单，实际上也不容易预防。并非总是明显，那些通常被认为是为了提高安全性而设计的解决方案实际上并没有帮助提高安全性。
- en: CAM and Traffic Interception
  id: totrans-264
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: CAM和流量拦截
- en: One of the more spectacular reasons not to consider switches as a security feature
    is the *CAM overflow* scenario. The CAM that stores MAC-to-port associations has
    a fixed and limited size and is generally constructed in a nondiscriminatory manner.
    Whenever a system cannot be located in CAM, the switch has but one way to deliver
    the packet—it must fall back to the hub mode, broadcasting the packet to all systems,
    hoping the recipient will recognize this traffic as addressed to himself and that
    other systems will be nice enough to disregard it altogether. Thus, a careful
    attacker can employ a tactic to generate a large number of bogus ARP requests
    and responses, or some other packets, impersonating a vast number of separate
    network devices, just to fill up the switch’s CAM. Once the CAM is full, the attack
    has effectively degraded the network security by disabling smart frame routing
    on the switch and forcing it to fall back to broadcasting all data. This, in turn,
    allows the attacker to snoop on all communications, as if the network was not
    switched at all. The attacker can do all this without impersonating the recipient
    or visibly affecting the operations of the network, so the victim might well remain
    completely unaware of this problem. This is a design issue; it is not a flaw in
    the intended purpose of these devices, but a serious misconception in the popular
    understanding of how switches work. And, rest assured, it is nearly impossible
    to fully address this problem in a typical environment. Some switches do implement
    port and time limits to prevent such attacks, but these are never 100 percent
    effective.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑到交换机不是安全特性之一的一个更引人注目的理由是*CAM溢出*场景。存储MAC到端口关联的CAM具有固定和有限的大小，并且通常以非歧视性的方式构建。每当系统无法在CAM中定位时，交换机只有一个方法来交付数据包——它必须回退到集线器模式，向所有系统广播数据包，希望接收者能识别出这是针对自己的流量，而其他系统会足够友好地完全忽略它。因此，一个谨慎的攻击者可以采取策略生成大量虚假的ARP请求和响应，或者一些其他的数据包，冒充大量不同的网络设备，只是为了填满交换机的CAM。一旦CAM满了，攻击就有效地降低了网络安全性，通过禁用交换机上的智能帧路由并迫使其回退到广播所有数据。这反过来又允许攻击者窃听所有通信，就像网络根本就没有交换一样。攻击者可以不冒充接收者或明显影响网络的运行来做所有这些，因此受害者可能完全不知道这个问题。这是一个设计问题；这并不是这些设备预期用途中的缺陷，而是一个对交换机工作原理的普遍理解的严重误解。而且，请放心，在典型环境中，几乎不可能完全解决这个问题。一些交换机确实实现了端口和时间限制来防止此类攻击，但这些方法永远不会100%有效。
- en: 'Other Attack Scenarios: DTP, STP, Trunks'
  id: totrans-266
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 其他攻击场景：DTP、STP、Trunks
- en: Other problems are usually easier to prevent and remain more evident (can be
    often detected by the victim), but still illustrate Ethernet-level security issues.
    For example, an attack on the aforementioned DTP mechanism is one interesting
    possibility. DTP autonegotiation is often enabled for all ports on a device in
    order to provide easier setup. The problem is that a clever attacker can hence
    pretend to be a trunk-enabled switch, rather than a mere end-user workstation
    or a humble server; once recognized by the switch it is connected to as a friendly
    device, he would start receiving 802.1Q tagged frames, including traffic in other
    virtual LANs served by the switch it is connected to, being able to intercept
    or inject malicious traffic to networks with which he is not supposed to be able
    to communicate. In many networks where the same switch handles both protected,
    “demilitarized” networks and common corporate LAN infrastructure, such an attack
    may be yield very useful data by enabling members of one of the networks to snoop
    on or interact with the other.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 其他问题通常更容易预防，并且更为明显（受害者通常能够检测到），但仍然说明了以太网级别的安全问题。例如，对上述DTP机制的攻击是一种有趣的可能性。DTP自动协商通常在设备的所有端口上启用，以便更容易设置。问题是，一个聪明的攻击者可以假装成启用中继的交换机，而不是一个普通的终端工作站或谦逊的服务器；一旦被连接的交换机识别为友好设备，他就开始接收802.1Q标记的帧，包括由连接的交换机提供的其他虚拟局域网的流量，能够拦截或注入恶意流量到他不应该能够通信的网络。在许多网络中，同一个交换机同时处理受保护的“非军事化”网络和常见的公司局域网基础设施，这种攻击可能通过使一个网络的成员能够窃听或与另一个网络交互，从而获得非常有用的数据。
- en: You can resolve this DTP problem on some devices by changing the default configuration
    and clearly defining a set of dedicated trunk-enabled ports on the switch. However,
    the problem does not end here—our other friend, STP, can be abused in a similar
    manner, allowing an attacker to choose self as the “root” switch and receive a
    cut of the network traffic. Disabling STP discovery might be even more difficult
    in a typical corporate environment.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过更改默认配置并在交换机上明确定义一组专用中继启用端口来解决某些设备上的DTP问题。然而，问题并没有结束——我们的另一个朋友STP也可以以类似的方式被滥用，允许攻击者选择自己作为“根”交换机并接收一部分网络流量。在典型的企业环境中，禁用STP发现可能更加困难。
- en: Still another problem arises when any trunk originates or terminates at a nondedicated
    VLAN. (That is, the port used for trunking is placed in a VLAN also used by workstations.)
    By injecting already tagged frames, it is possible to inject traffic to a trunk.
    This is arguably a configuration flaw, and the problem is often overlooked, since
    many engineers assume the method for implementing trunks is far more advanced
    and magical than it really is.
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 当任何中继在非专用VLAN中起源或终止时，又会出现另一个问题。（也就是说，用于中继的端口放置在也由工作站使用的VLAN中。）通过注入已标记的帧，可以将流量注入到中继。这可以说是配置缺陷，这个问题通常被忽视，因为许多工程师认为实现中继的方法比实际情况要高级和神奇得多。
- en: Prevention of Attacks
  id: totrans-270
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 攻击预防
- en: These problems are often difficult to solve, particularly in a network that
    was not firmly and closely supervised through all phases of its development and
    expansion. Although certain high-end devices provide extended security features
    to counter potential attack vectors and mitigate or eliminate some of the risks,
    Ethernet networks were not designed to provide security, nor were many of the
    smart devices created to manage these networks. The attacker can easily render
    some or all of their features useless and downgrade the network security model
    to the least desirable option.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 这些问题通常很难解决，尤其是在一个在其开发和扩展的各个阶段都没有得到严格和紧密监督的网络中。尽管某些高端设备提供了扩展的安全功能来对抗潜在的攻击向量并减轻或消除一些风险，但以太网网络并不是为了提供安全而设计的，许多智能设备也不是为了管理这些网络而创建的。攻击者可以轻易地使一些或所有功能失效，并将网络安全模型降级到最不希望的选择。
- en: Although there are methods and rigid practices to follow in order to secure
    a local Ethernet network, the complexity of this process and the additional financial
    cost and performance impact that doing so often carries, let alone the number
    of vectors to be addressed, all make it obvious that the technology was not engineered
    with any level of practical security in mind.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然有方法和严格的做法可以遵循以确保本地以太网网络的安全，但这个过程复杂性、额外的财务成本和性能影响，以及需要解决的问题数量，都清楚地表明这项技术并不是在设计时考虑到任何实际的安全级别。
- en: Food for Thought
  id: totrans-273
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 思考的食物
- en: When Ethernet was developed, it seemed reasonable to disregard any security
    considerations in the design decisions and to leave the burden of securing the
    network to higher-level architecture, encryption, and so on. Over time, however,
    this initial decision has begun to contribute to the overall maintenance costs
    of Ethernet networks and the difficulty of keeping them reasonably hack proof
    without sacrificing functionality in some ways.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 当以太网开发时，在设计决策中忽视任何安全考虑似乎是合理的，并将保护网络的责任留给高级架构、加密等。然而，随着时间的推移，这个最初的决策已经开始对以太网网络的总体维护成本以及在不牺牲某些功能的情况下保持它们合理难以被黑客攻击的难度做出了贡献。
- en: The problem is hardly limited to the Ethernet, either. Many networks designed
    to be trusted based on physical-access or equipment-access criteria—including,
    for example, most of the world’s phone systems—are inherently and uncontrollably
    exposed to internal threats with little or no way to efficiently contain the exposure
    and control the collateral damage resulting from a single-system compromise within
    the grid. As the size of the network grows, and the number of interchanges increases,
    the probability of one of the systems being operated by a malicious user or insufficiently
    protected either on physical or remote access steadily approaches 1\. Although
    traditionally, access to the backbone, rather than access to an end-user station,
    would be required to compromise the system—thus making the situation somewhat
    different from Ethernet—nowadays, Voice-over-IP (VoIP) systems quickly make up
    for this inconvenience, frequently allowing easy spoofing and other trickery by
    putting too much trust on the user endpoint side.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 问题并不仅限于以太网。许多基于物理访问或设备访问标准设计的网络，例如，世界上大多数电话系统，本质上且无法控制地暴露于内部威胁之下，几乎没有或没有有效的方法来限制这种暴露并控制来自单个系统在电网中受到损害的附带损害。随着网络规模的扩大和交换数量的增加，某个系统被恶意用户操作或物理或远程访问保护不足的概率稳步接近1。尽管传统上，要损害系统，需要访问骨干网络而不是终端用户站，这使得情况与以太网有所不同——但现在，VoIP（语音-over-IP）系统迅速弥补了这一不便，经常通过过度信任用户端点来允许轻松的欺骗和其他诡计。
- en: Chapter 8. Us versus Them
  id: totrans-276
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第8章。我们与他们对立
- en: '*What else can happen in the local perimeter of “our” network? Quite a bit!*'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: '*在我们的“本地”网络范围内还能发生什么其他事情？相当多！*'
- en: —
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: —
- en: Local network designs, such as the Token Ring or now predominant Ethernet, were
    engineered under the assumption that there was no need to assure security on the
    level (or layer) of the technology used to transmit the data itself. When computers
    were first developed, users sharing a network were expected to play nice.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 本地网络设计，如令牌环或现在占主导地位的以太网，是在假设没有必要在用于传输数据的技术的（或层）级别确保安全性的情况下设计的。当计算机最初开发时，共享网络的用户被期望表现得很好。
- en: Although for this reason alone one might assume that the designers of Ethernet
    would have seen no need to incorporate full-fledged security functionality into
    their design, they are to be blamed for the unwarranted optimism and not foreseeing
    the inevitable. Ethernet simply did not leave space to easily implement integrity,
    confidentiality, and sender-verification mechanisms at higher-order OSI layers,
    devices, and applications. Subsequent protocols and communication schemes attempted
    to implement partial privacy and a level of undeniability of communications—but
    only to reach a point where we realized it is not possible to implement adequate
    security there without going back and reworking the link layer. The only other
    possibility we were left with was building computationally expensive and complex
    cryptographic hacks on top of the system, of which the sheer complexity contributes
    to a number of security problems discovered year after year.
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管仅基于这一原因，人们可能会认为以太网的开发者没有必要将完整的安全功能纳入其设计，但他们应受到无根据的乐观和未能预见必然性的责备。以太网根本就没有留下空间来轻松实现OSI高层、设备和应用程序中的完整性、机密性和发送者验证机制。随后的协议和通信方案试图实现部分隐私和通信不可否认性的一定程度——但仅仅达到我们意识到，如果不回到并重新工作链路层，就不可能在那里实现适当的安全性的地步。我们剩下的唯一可能性是在系统之上构建计算昂贵且复杂的加密破解，其纯粹复杂性导致每年发现许多安全问题。
- en: This unfortunate and later quite intentional trend had effectively created a
    set of networking mechanisms that, although they perform well and are affordable,
    are not suitable for handling even moderately sensitive data in the presence of
    a hostile party (and almost all user-related data flow on a local network is sensitive).
    Solutions that try to address these problems—such as virtual private network (VPN)
    applications, encrypted encapsulation for the lucky few of the most popular web
    protocols, advanced switches, and so forth—are usually far more expensive and
    sophisticated than they could have been had security been a key factor when devising
    the initial concept for an Ethernet communications scheme.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 这种不幸且后来相当故意的趋势有效地创建了一套网络机制，尽管它们性能良好且价格合理，但在存在敌对一方的情况下，它们不适合处理即使是中等敏感的数据（几乎所有与用户相关的本地网络数据流都是敏感的）。试图解决这些问题的解决方案——如虚拟专用网络（VPN）应用程序、加密封装的幸运的少数最流行的网络协议、高级交换机等——通常比在为以太网通信方案构思初始概念时将安全作为关键因素时要昂贵和复杂得多。
- en: Before we arrived there, we lived in partial denial for quite a while. When
    security became a real-world concern (with the expansion of the Internet and a
    sudden proliferation of system compromises), the first defenses to appear focused
    on the external world, while ignoring threats that could come from within the
    “trusted” network. But it wasn’t too long before a couple of corporate and institutional
    entities learned some painful lessons. With time, it became obvious that external
    defenses such as firewalls and intrusion detection systems alone were not enough,
    even when properly configured across the enterprise. The network layer was still
    vulnerable, allowing an insider to compromise data exchanges without exploiting
    the security vulnerabilities of any single system in the company.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们到达那里之前，我们相当长时间处于部分否认的状态。当安全成为现实世界的关注点（随着互联网的扩展和系统妥协的突然激增）时，最初出现的防御措施集中在外部世界，而忽视了可能来自“受信任”网络内部的威胁。但不久之后，一些企业和机构实体吸取了一些痛苦的教训。随着时间的推移，很明显，仅靠外部防御措施，如防火墙和入侵检测系统，即使配置得当，也不足以保护企业。网络层仍然容易受到攻击，允许内部人员在不利用公司任何单个系统的安全漏洞的情况下破坏数据交换。
- en: 'Although you can argue that the network could be secured by deploying appropriate
    encryption and cryptographic identity and integrity verification mechanisms on
    all interfaces, that is often impractical or impossible, particularly without
    impacting the performance and reliability of the network and incurring significant
    costs (not to mention the issues of compatibility with various operating systems
    and applications). Besides, as I have mentioned, cryptography is not always the
    answer: not only is it much easier to successfully attack when the data can be
    seen and intercepted (replay or timing attacks, for example), but certain types
    of information—such as the Ethernet frame-padding flaw discussed previously—can
    thwart all efforts to protect the user.'
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管你可以争辩说，通过在所有接口上部署适当的加密和加密身份及完整性验证机制来保护网络，但这通常是不切实际的或不可能的，尤其是在不影响网络性能和可靠性以及产生重大成本的情况下（更不用说与各种操作系统和应用程序的兼容性问题了）。此外，正如我提到的，加密并不总是答案：当数据可以被看到和拦截时（例如重放或定时攻击），攻击成功的可能性要大得多，而且某些类型的信息——例如之前讨论过的以太网帧填充漏洞——可以阻止所有保护用户的努力。
- en: In [Part II](pt02.html "Part II. Safe Harbor") of this book, we are addressing
    some of the threats inherent in local networks that expose information without
    a traditional attack ever occurring. All these problems will remain with us as
    long as networks use the old and tested design that is rather ill-suited for networking
    today.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书的[第二部分](pt02.html "第二部分。安全港")中，我们正在解决一些固有于本地网络中的威胁，这些威胁在没有发生传统攻击的情况下暴露信息。只要网络使用的是旧的和经过测试的设计，这种设计对于今天的网络来说相当不合适，所有这些问题就会伴随着我们。
- en: We are now ready to move forward, but before we dive into the wild and fascinating
    world beyond the local perimeter, let’s glance at some other interesting (and
    more specific) exposure scenarios.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在准备向前迈进，但在我们深入探索本地边界之外的狂野和迷人的世界之前，让我们先看看一些其他有趣的（并且更具体的）暴露场景。
- en: Logical Blinkenlights and Their Unusual Application
  id: totrans-286
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 逻辑闪烁灯及其不寻常的应用
- en: One such example relates to the abuse of logical indicators—that is, counters,
    flags, and other gizmos that have no physical representation but, rather, are
    maintained by a computer and made available in software, commonly implemented
    in local networks. Logical indicators are a helpful feature that, once again,
    assume that the local network is to be trusted.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 这样一个例子与逻辑指示符的滥用有关——也就是说，计数器、标志和其他没有物理表示但由计算机维护并在软件中提供的装置，通常在本地网络中实现。逻辑指示符是一个有用的功能，再次假设本地网络是可以信赖的。
- en: The Simple Network Management Protocol^([[70](apb.html#ftn.CHP-8-BIB-1)]) (SNMP)
    is the most popular method for monitoring and sometimes administrating network
    devices. SNMP is often implemented on endpoint systems (servers and workstations)
    as well as network devices, such as switches, routers, and printers.
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 简单网络管理协议^([[70](apb.html#ftn.CHP-8-BIB-1)))（SNMP）是监控和有时管理网络设备最流行的方法。SNMP通常在端点系统（服务器和工作站）以及网络设备（如交换机、路由器和打印机）上实现。
- en: SNMP provides a means for reading (or modifying) an abstract representation
    of many system and application internals, operational and configuration parameters,
    and statistics. Using SNMP, you can query a network printer about the number of
    network cards it has or its uptime and then use exactly the same method to query
    a mainframe for the same information, even though the information needs to be
    obtained internally by the device in a wholly different way on each system. Hence,
    SNMP makes it easy to monitor and manage heterogeneous environments without implementing
    a multitude of native access protocols and check procedures.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: SNMP提供了一种读取（或修改）许多系统和应用程序内部抽象表示的方法，包括操作和配置参数以及统计数据。使用SNMP，你可以查询网络打印机有多少网络卡或其运行时间，然后使用完全相同的方法查询主机以获取相同的信息，尽管在每个系统中，设备需要以完全不同的方式内部获取这些信息。因此，SNMP使得在不实现大量本地访问协议和检查程序的情况下，轻松监控和管理异构环境变得容易。
- en: Naturally, SNMP itself has plenty of implementation and deployment security
    issues, but that is not my point here. Even when properly implemented, this functionality
    can lead to a security information disclosure, such as providing read-only access
    to the seemingly irrelevant statistics of a network interface. (This hole is eliminated
    if the protocol is carefully restricted, but that is often impossible on certain
    types of network equipment.) A careful attacker can observe frame or packet counters
    on a system running SNMP and use that information to derive profiling information
    needed for timing attacks, which can recover interactive session information or
    other interesting characteristics, in a manner similar to the approach discussed
    in [Chapter 1](ch01.html "Chapter 1. I Can Hear You Typing").
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 自然地，SNMP本身有许多实现和部署安全问题，但这里不是我的重点。即使正确实现，此功能也可能导致安全信息泄露，例如提供对网络接口看似无关的统计数据的只读访问。（如果仔细限制协议，这个漏洞就会被消除，但在某些类型的网络设备上这通常是不可能的。）一个细心的攻击者可以观察运行SNMP的系统的帧或数据包计数器，并使用这些信息推导出用于时间攻击的配置文件信息，以恢复交互会话信息或其他有趣的特征，其方法类似于在[第1章](ch01.html
    "第1章。我能听到你在打字")中讨论的方法。
- en: Whoops. But really, can this much bad happen because of this?
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 哎呀。但真的，这么多坏事情会因为这个原因发生吗？
- en: Show Me Your Typing, and I Will Tell You Who You Are
  id: totrans-292
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 展示你的打字，我会告诉你你是谁
- en: 'Although I’ve mentioned this class of problems several times already, and they
    may seem abstract, their consequences are real, even when the keystroke reconstruction
    vector, on which I focused in [Chapter 1](ch01.html "Chapter 1. I Can Hear You
    Typing"), is disregarded. For example, in a fascinating development, a group of
    German researchers from Institut für Bankinnovation have created a commercial
    product, PSYLock, that provides typing-pattern-based biometrics^([[71](apb.html#ftn.CHP-8-BIB-2)]):
    Using PSYLock they have been able to uniquely identify (and hence possibly track)
    users by examining how they use the keyboard.'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然我已经多次提到这类问题，它们可能看起来很抽象，但它们的后果是真实的，即使在我关注的[第1章](ch01.html "第1章。我能听到你在打字")中忽略按键重建向量也是如此。例如，在令人着迷的发展中，来自Institut
    für Bankinnovation的一组德国研究人员创建了一个商业产品PSYLock，它提供基于打字模式的生物识别^([[71](apb.html#ftn.CHP-8-BIB-2)))：使用PSYLock，他们能够通过检查用户如何使用键盘来唯一识别（因此可能追踪）用户。
- en: PSYLock relies primarily on measurements of interkeystroke timing, a trick I
    discussed previously. Given the ability to observe packet counters for a specific
    machine and calculate when, in an interactive session, a key is pressed by the
    user, you can identify a person regardless of which terminal they use. Some interesting
    applications, both malicious and supervisory in nature, can be suggested based
    on the application of this concept to the network layer. If the attacker knows
    that there is an interactive session of some remote access protocol between a
    station for which they can monitor SNMP switch port statistics, they can, by repeatedly
    polling the counter, determine when keys are pressed and, hence, draw conclusions
    as to what is being typed or who is typing.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: PSYLock主要依赖于按键间时间间隔的测量，这是我之前讨论过的技巧。鉴于能够观察特定机器的包计数器并计算在交互会话中用户何时按键的能力，你可以识别出无论他们使用哪个终端的人。基于将此概念应用于网络层，可以提出一些有趣的应用，这些应用既可以是恶意的，也可以是监督性的。如果攻击者知道他们可以监控SNMP交换机端口统计信息的某个站点的远程访问协议的交互会话，他们可以通过重复轮询计数器来确定何时按键，从而得出正在输入的内容或谁正在输入的结论。
- en: A more lightweight variant of the attack, not requiring any of the advanced
    modeling that we had to cope with before, is also feasible. In their Bugtraq posting
    titled “Passive Analysis of SSH (Secure Shell) Traffic,”^([[72](apb.html#ftn.CHP-8-BIB-3)])
    Solar Designer and Dug Song, among other things suggest yet another possible attack,
    this time using the SSH protocol, a common method for connecting to a remote system.
    Although SSH is encrypted, in versions released prior to their research it is
    possible to measure the length of a password by carefully analyzing the size of
    an observed packet during login (the password is sent in a single chunk of data
    once entered by the user).
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击的一个更轻量级的变体，不需要我们之前必须应对的任何高级建模，也是可行的。在他们的Bugtraq帖子“SSH（安全壳）流量被动分析”中，Solar Designer和Dug
    Song等人（以及其他事项）建议了另一种可能的攻击，这次使用的是SSH协议，这是一种常见的连接到远程系统的方法。尽管SSH是加密的，但在他们研究之前发布的版本中，通过仔细分析登录期间观察到的数据包的大小，可以测量密码的长度（密码在用户输入后以单个数据块发送）。
- en: This technique could well be successfully applied to other cryptographic protocols
    that do not take active measures to hide the length of a password by padding it
    before sending. And, no suprise, the attack can be carried out simply by observing
    an SNMP byte counter, rather than by directly monitoring traffic.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 这种技术可以成功地应用于其他加密协议，这些协议在发送之前不会通过填充来隐藏密码长度。不出所料，攻击可以通过简单地观察SNMP字节数计数器来执行，而不是直接监控流量。
- en: 'The Unexpected Bits: Personal Data All Around'
  id: totrans-297
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 意料之外的片段：周围无处不在的个人数据
- en: Yet another reason we should not be thrilled by the prospect of a hostile party
    peeking at our network (regardless of whether we believe the data they can see
    is sensitive) is that plenty of software violates the principle of least astonishment.
    The principle of least astonishment is a fundamental rule of software design that
    basically says that a program should respond to the user in ways that surprise
    them least—in a consistent, intuitive, predictable, or otherwise expected manner.
    As it turns out, many programs from several software publishers send an amazing
    amount of valuable information, far beyond what we might expect, often putting
    users in a situation they did not bargain for. As always, Microsoft Windows leads
    the pack of these astonishing programs and does a great job of releasing information
    in intentional, but often overlooked and nonobvious ways, but the friendly software
    giant is not alone.
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个我们不应该对敌对方窥视我们网络（无论我们是否认为他们能看到的数据是敏感的）的前景感到兴奋的理由是，大量的软件违反了最小惊讶原则。最小惊讶原则是软件设计的基本规则，基本上说，一个程序应该以最不令人惊讶的方式对用户做出反应——以一致、直观、可预测或预期的其他方式。事实证明，许多来自几个软件出版商的程序发送了大量的有价值信息，远远超出了我们的预期，通常使用户陷入他们未曾预料到的境地。正如往常一样，微软Windows在令人惊讶的程序中处于领先地位，并且出色地以有意但经常被忽视且不明显的方式发布信息，但友好的软件巨头并不孤单。
- en: Although few users know it, when Windows is working in a domain and is configured
    to use roaming profiles to enable the user to log in from a different workstation
    and access their personal data, large portions of the user’s registry are sent
    to the domain controller each time they log in or out. Although the information
    contained in the profile may seem quite worthless at first, it includes various
    personal settings and history information that can be quite interesting, including
    last-executed commands, last-visited web pages, and last-opened documents.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管很少有用户知道这一点，但当Windows在域中工作并配置为使用漫游配置文件以使用户能够从不同的工作站登录并访问其个人数据时，每次用户登录或注销时，用户的大量注册表都会发送到域控制器。尽管配置文件中包含的信息最初可能看起来毫无价值，但它包括各种个人设置和历史信息，这些信息可能非常有意思，包括最后执行的命令、最后访问的网页和最后打开的文档。
- en: Similarly, and perhaps even more astonishing, if a user’s home directory within
    the domain resides on a network drive, Windows looks up all commands entered by
    the user in the Run box first on the remote server and then locally. Thus, the
    information about all commands issued by the user is disclosed via the Server
    Message Block (SMB) protocol to a careful observer.
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 同样地，也许甚至更加令人惊讶的是，如果一个用户的家庭目录位于域内的网络驱动器上，Windows会首先在远程服务器上，然后在本地上查找用户在运行框中输入的所有命令。因此，用户发出的所有命令的信息都通过服务器消息块（SMB）协议泄露给一个细心的观察者。
- en: These and many other examples make it painfully obvious that almost all network
    data should be assumed to be sensitive. As such, local networks at large are not
    particularly well suited to transport any commonly occurring data, except for
    specific, limited, or additionally protected setups. And we have no good way to
    protect this information without rolling out heavy artillery, such as cryptographic
    IP tunnels or similar software or by redesigning every aspect of networking from
    scratch.
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 这些以及其他许多例子痛苦地表明，几乎所有网络数据都应该被认为是敏感的。因此，大型本地网络并不特别适合传输任何常见的数据，除非是特定的、有限的或额外受保护的环境。而且我们没有很好的方法来保护这些信息，除非部署重型武器，如加密IP隧道或类似的软件，或者从头开始重新设计网络的所有方面。
- en: Wi-Fi Vulnerabilities
  id: totrans-302
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Wi-Fi漏洞
- en: 'It would be unfair to close this chapter and ignore the problems with the wireless
    replacement to Ethernet: wi-fi.'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在这个章节的结尾忽略无线以太网替代品：Wi-Fi的问题，那就太不公平了。
- en: Wireless networks based on the IEEE 802.11 protocol are gaining momentum in
    the corporate world, as well as among ordinary home users. Unfortunately, even
    long before gaining widespread acceptance, and even though they were designed
    with the intent to maintain a level of additional security over wired hookups,
    wi-fi proved fairly difficult to deploy properly, perhaps because it attempted
    to follow in the footsteps of its older brother a bit too closely.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 基于IEEE 802.11协议的无线网络在企业界以及普通家庭用户中正在获得动力。不幸的是，甚至在获得广泛接受之前，尽管它们的设计意图是在有线连接之上保持一定程度的额外安全性，Wi-Fi证明很难正确部署，可能是因为它试图过于紧密地跟随其老大哥的脚步。
- en: The 802.11 standard is, in its operating principles, not that much different
    from Ethernet. It uses a traditional “one can talk, others listen” media access
    control scheme, the only difference being that instead of a pair of wires, the
    carrier of the signal is now just a designated radio frequency. Which brings us
    to 802.11’s first problem.
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 802.11标准在其操作原理上与以太网并没有太大的区别。它使用传统的“一个可以说话，其他人在听”的介质访问控制方案，唯一的区别在于，信号载体现在只是一段指定的无线电频率。这让我们来到了802.11的第一个问题。
- en: In May 2004, the Queensland University of Technology’s Information Security
    Research Centre (ISRC) announced its findings that any 802.11 network in any enterprise
    could be brought to a grinding halt in a matter of seconds simply by transmitting
    a signal that inhibits other parties from trying to talk. Naturally, the same
    is true for Ethernet, except that you must be able to connect to a network plug
    first, which of course makes the attacker much easier to track and the problem
    easier to solve. You can simply check the switch then follow the cable. This attack
    is not exactly a surprise, but it’s not what business adopters expected either.
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 在2004年5月，昆士兰科技大学的信息安全研究中心（ISRC）宣布了其研究结果：任何企业的任何802.11网络都可以在几秒钟内被简单地通过发送一个阻止其他方尝试通信的信号而完全瘫痪。当然，对于以太网来说，情况也是如此，但你必须首先能够连接到网络插孔，这无疑使得攻击者更容易追踪，问题也更容易解决。你可以简单地检查交换机，然后追踪电缆。这种攻击并不完全令人惊讶，但也不是企业采用者所预期的。
- en: That’s not where the problems end. Where the 802.11 standard attempted to thwart
    carrier-level attacks, it actually failed miserably. The Wired Equivalent Privacy
    (WEP) mechanism was designed for wi-fi networks to provide a level of protection
    against eavesdropping on network sessions by external parties, thus providing
    security roughly comparable to traditional LANs. However, a number of design flaws
    in the WEP scheme were found in 2001 by researchers from the University of California
    and Zero Knowledge Systems, which proved the scheme grossly inappropriate. Regrettably,
    even by that time wi-fi had been deployed widely enough to make necessary modifications
    difficult to implement.^([[73](apb.html#ftn.CHP-8-BIB-4)])
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 问题并没有就此结束。802.11标准试图阻止运营商级别的攻击，但实际上却失败了。有线等效隐私（WEP）机制是为了为Wi-Fi网络提供一种保护水平，以防止外部方窃听网络会话，从而提供与传统局域网相当的安全保障。然而，2001年，加州大学和零知识系统的研究人员发现了WEP方案中的多个设计缺陷，这证明了该方案完全不合适。遗憾的是，即使到那时，Wi-Fi已经广泛部署，以至于进行必要的修改变得难以实施。[^([73](apb.html#ftn.CHP-8-BIB-4))]
- en: To add insult to injury, use of WEP is optional, and most wireless network devices
    have WEP turned off; they’re ready to accept and relay any traffic they receive.
    Although this is generally acceptable with wired networks, where an additional
    layer of security is provided on the physical level, wireless networks are open
    to any random person within range.
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 更糟糕的是，WEP的使用是可选的，并且大多数无线网络设备都关闭了WEP；它们准备好接受和转发它们接收到的任何流量。尽管这在有线网络中通常是可接受的，因为物理层面上还提供了一层额外的安全保护，但无线网络对任何在范围内的随机人员都是开放的。
- en: '![Tracy Reed’s warflying adventure (courtesy of Tracy Reed of Copilot Consulting
    at treed@copilotconsulting.com)](httpatomoreillycomsourcenostarchimages1138048.png.jpg)'
  id: totrans-309
  prefs: []
  type: TYPE_IMG
  zh: '![Tracy Reed的战飞冒险（由Copilot Consulting的Tracy Reed提供，邮箱：treed@copilotconsulting.com)](http://atomoreilly.com/source/nostarch/images/1138048.png.jpg)'
- en: Figure 8-1. Tracy Reed’s warflying adventure (courtesy of Tracy Reed of Copilot
    Consulting at [treed@copilotconsulting.com](mailto:treed@copilotconsulting.com))
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 图8-1. Tracy Reed的战飞冒险（由Copilot Consulting的Tracy Reed提供，邮箱：[treed@copilotconsulting.com](mailto:treed@copilotconsulting.com))
- en: The practice of wardriving—equipping a car with a wi-fi–capable laptop and going
    on urban network-finding expeditions—became extremely popular once it was discovered
    that a majority of large businesses—particularly in large shopping malls and commercial
    districts in every city—have partly or fully open wireless networks. The abuse
    is often quite trivial, ranging from networking for free to sending spam or conducting
    remote attacks through the victim’s network, but the risk of a network being penetrated
    from inside by a skilled attacker is real.
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: wardriving的做法——在汽车上配备一台具有Wi-Fi功能的笔记本电脑，进行城市网络寻找探险——一旦发现大多数大型企业——尤其是在每个城市的大型购物中心和商业区——部分或全部开放无线网络，就变得极为流行。滥用行为通常相当微不足道，从免费使用网络到发送垃圾邮件或通过受害者的网络进行远程攻击，但网络被熟练的攻击者从内部渗透的风险是真实的。
- en: What is the true scale of the problem? Suffice it to say that at some point
    wardriving became passé with the birth of warflying (wardriving, but with a plane
    rather than a ground vehicle). In 2002, Tracy Reed of Copilot Consulting decided
    to fly around and vicinity with a wireless scanner. Cruising at 1,500 feet, he
    managed to find nearly 400 access points with default configurations and likely
    free network access to the Internet or internal corporate networks for any person
    nearby (see [Figure 8-1](ch08s03.html#tracy_reedas_warflying_adventure_open_pa
    "Figure 8-1. Tracy Reed’s warflying adventure (courtesy of Tracy Reed of Copilot
    Consulting at treed@copilotconsulting.com)") and [Figure 8-2](ch08s03.html#silicon_valley_warflying
    "Figure 8-2. Silicon Valley warflying")). Only 23 percent of the devices scanned
    were protected by WEP (which is, in general, easy to crack anyway) or better mechanisms.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 这个问题的真正规模有多大？ suffice it to say that at some point wardriving became passé with
    the birth of warflying (wardriving, but with a plane rather than a ground vehicle).
    In 2002, Tracy Reed of Copilot Consulting decided to fly around and vicinity with
    a wireless scanner. Cruising at 1,500 feet, he managed to find nearly 400 access
    points with default configurations and likely free network access to the Internet
    or internal corporate networks for any person nearby (see [图 8-1](ch08s03.html#tracy_reedas_warflying_adventure_open_pa
    "图 8-1. Tracy Reed的空中侦察冒险（由Copilot Consulting的Tracy Reed提供，邮箱：treed@copilotconsulting.com")
    和 [图 8-2](ch08s03.html#silicon_valley_warflying "图 8-2. 硅谷空中侦察"))). Only 23 percent
    of the devices scanned were protected by WEP (which is, in general, easy to crack
    anyway) or better mechanisms.
- en: Go figure.
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: Go figure.
- en: '![Silicon Valley warflying](httpatomoreillycomsourcenostarchimages1138050.png.jpg)'
  id: totrans-314
  prefs: []
  type: TYPE_IMG
  zh: '![硅谷空中侦察](httpatomoreillycomsourcenostarchimages1138050.png.jpg)'
- en: Figure 8-2. Silicon Valley warflying
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8-2. 硅谷空中侦察
