<html><head></head><body>
  <div class="part" title="Part&#xA0;I.&#xA0;From Source Code to a Running Installation">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="from_source_code_to_a_running_installat"/>Part I. From Source Code to a Running Installation</h1>
    </div>

    <div class="partintro" id="id2458574" title="From Source Code to a Running Installation"/>
  </div>


  <div class="chapter" title="Chapter&#xA0;1.&#xA0;Installation">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="installation"/>Chapter 1. Installation</h1>
    </div>

    <p>The simplest method of installation is for you to install the Nagios packages that are supplied with the distribution you are using. Nagios 2.x is by now extremely mature and is therefore a component of most distributions. The paths of individual directories in those packages maintained by Linux distributors are usually different from the default specified in the source package, and thus from the paths used in this book.<a class="indexterm" id="IDX-CHP-1-0034"/></p>

    <p>Nagios 3.0 is relatively new; it is recommended here that you "get your hands dirty" by compiling and installing the software yourself. The following installation guide also applies to Nagios 2.x, and any differences between versions 2.x and 3.0 are mentioned explicitly in the text.</p>

    <p>If you compile your own software, you have control over the directory structures and a number of other parameters. A Nagios system compiled in this way also provides an almost complete main configuration file, in which, initially, nothing has to be changed. But it should be mentioned here that compiling Nagios yourself might involve a laborious search for the necessary development packages, depending on what is already installed on the computer.<a class="indexterm" id="IDX-CHP-1-0035"/></p>

    <div class="sect1" title="1.1 Preparations">
      <div class="titlepage">
        <h1 class="title" id="heading_id_3"><a id="preparations"/>1.1 Preparations</h1>
      </div>

      <p>For compiling Nagios itself you require <strong class="userinput"><code>gcc</code></strong>, <strong class="userinput"><code>make</code></strong>, <strong class="userinput"><code>autoconf</code></strong>, and <strong class="userinput"><code>automake</code></strong>. Required libraries are <strong class="userinput"><code>libgd</code></strong><sup>[<a class="footnote" href="#ftn.CHP-1-FN-1" id="CHP-1-FN-1">9</a>]</sup> and <strong class="userinput"><code>openssl</code></strong><sup>[<a class="footnote" href="#ftn.CHP-1-FN-2" id="CHP-1-FN-2">10</a>]</sup>. The development packages for these must also be installed (depending on the distribution, with either the ending <strong class="userinput"><code>-dev</code></strong> or <strong class="userinput"><code>-devel</code></strong>): <strong class="userinput"><code>libssl-dev</code></strong>, <strong class="userinput"><code>libgd-dev</code></strong>, <strong class="userinput"><code>libc6-dev</code></strong>.<a class="indexterm" id="IDX-CHP-1-0036"/><a class="indexterm" id="IDX-CHP-1-0037"/><a class="indexterm" id="IDX-CHP-1-0038"/><a class="indexterm" id="IDX-CHP-1-0039"/></p>

      <p>With Debian and Ubuntu you prepare by using <strong class="userinput"><code>apt-get install</code></strong> to install the packages <strong class="userinput"><code>apache2</code></strong>, <strong class="userinput"><code>build-essential</code></strong>, and <strong class="userinput"><code>libgd2-dev</code></strong>. In Open-SUSE you install <strong class="userinput"><code>apache2</code></strong> via YAST2, along with all C/C++ development libraries, as well as the package <strong class="userinput"><code>gd</code></strong>. In Fedora you run the command <strong class="userinput"><code>yum install</code></strong> on the command line and enter the packages <strong class="userinput"><code>httpd</code></strong>, <strong class="userinput"><code>gcc</code></strong>, <strong class="userinput"><code>glibc</code></strong>, <strong class="userinput"><code>glibc-common</code></strong>, <strong class="userinput"><code>gd</code></strong>, and <strong class="userinput"><code>gd-devel</code></strong> as arguments.</p>

      <p>For the plugins it is recommended that you also install the following packages: <strong class="userinput"><code>ntpdate</code></strong><sup>[<a class="footnote" href="#ftn.CHP-1-FN-3" id="CHP-1-FN-3">11</a>]</sup> (possibly contained in the package <strong class="userinput"><code>ntp</code></strong> or <strong class="userinput"><code>xntp</code></strong>), <strong class="userinput"><code>snmp</code></strong>,<sup>[<a class="footnote" href="#ftn.CHP-1-FN-4" id="CHP-1-FN-4">12</a>]</sup> <strong class="userinput"><code>smbclient</code></strong><sup>[<a class="footnote" href="#ftn.CHP-1-FN-5" id="CHP-1-FN-5">13</a>]</sup> (possibly a component of the package <strong class="userinput"><code>samba-client</code></strong>), the <strong class="userinput"><code>libldap2</code></strong> library, and the relevant development package <strong class="userinput"><code>libldap2-dev</code></strong><sup>[<a class="footnote" href="#ftn.CHP-1-FN-6" id="CHP-1-FN-6">14</a>]</sup> (depending on the distribution, the appropriate packages are also called <strong class="userinput"><code>openldap2-client</code></strong> and <strong class="userinput"><code>openldap2-devel</code></strong>). You will also need to install the client and developer packages for the database used (e.g., <strong class="userinput"><code>postgresql-client</code></strong> and <strong class="userinput"><code>postgresql-dev(el)</code></strong>).</p>

      <div class="sect2" title="1.1.1 Determining and setting up the required users">
        <div class="titlepage">
          <h2 class="title" id="heading_id_4"><a id="determining_and_setting_up_the_required"/>1.1.1 Determining and setting up the required users</h2>
        </div>

        <p>Prior to compiling and installing, use the command <strong class="userinput"><code>groupadd</code></strong> to set up the groups necessary for operation. Groups <strong class="userinput"><code>nagios</code></strong> and <strong class="userinput"><code>nagcmd</code></strong> are set up with <strong class="userinput"><code>groupadd</code></strong>, and the user <strong class="userinput"><code>nagios</code></strong>, who is assigned to these groups and with whose permissions the Nagios server runs is set up with <strong class="userinput"><code>useradd</code></strong>:</p><a id="I_programlisting1_d1e830"/>
        <pre class="programlisting">linux:~ # <span class="strong"><strong>groupadd -g 9000 nagios</strong></span>
linux:~ # <span class="strong"><strong>groupadd -g 9001 nagcmd</strong></span>
linux:~ # <span class="strong"><strong>useradd -u 9000 -g nagios -G nagcmd -d /usr/local/nagios</strong></span> \
<span class="strong"><strong>    -c "Nagios Admin" nagios</strong></span></pre>

        <p>Instead of the user (9000) and group IDs (9000 or 9001) used here, any other available IDs may be used. The primary group <strong class="userinput"><code>nagios</code></strong> of the user <strong class="userinput"><code>nagios</code></strong> should remain reserved exclusively for this user.</p>

        <p>The CGI scripts are run by Nagios under the user ID of the user with whose permissions the Apache Web server runs. In order for this user to access certain protected areas of Nagios, an additional group is required, the so-called <span class="emphasis"><em>Nagios Command Group</em></span> <strong class="userinput"><code>nagcmd</code></strong>. Only the Web user and the user <strong class="userinput"><code>nagios</code></strong> should belong to this group. The Web user can be determined from the Apache configuration file. In Debian/Ubuntu this is located at <strong class="userinput"><code>/etc/apache2/apache2.conf</code></strong>; in Fedora it is at <strong class="userinput"><code>/etc/httpd/httpd.conf</code></strong>:<a class="indexterm" id="IDX-CHP-1-0040"/></p><a id="I_programlisting1_d1e876"/>
        <pre class="programlisting">linux:~ # <span class="strong"><strong>grep "^User" /etc/apache2/apache2.conf</strong></span>
User www-data</pre>

        <p>The user determined in this way (in Debian/Ubuntu <strong class="userinput"><code>www-data</code></strong>, in Open-SUSE <strong class="userinput"><code>www-run</code></strong>, and in Fedora <strong class="userinput"><code>httpd</code></strong>) is additionally assigned to the group <strong class="userinput"><code>nagcmd</code></strong>, shown here using the example for Debian/Ubuntu:</p><a id="I_programlisting1_d1e895"/>
        <pre class="programlisting">linux:~ # <span class="strong"><strong>usermod -G nagcmd www-data</strong></span></pre>

        <p>In the example, the Web user is called <strong class="userinput"><code>www-data</code></strong>. The command <strong class="userinput"><code>usermod</code></strong> (this changes the data for an existing user account) also includes the Web user in the <strong class="userinput"><code>nagcmd</code></strong> group thanks to the <strong class="userinput"><code>-G</code></strong> option, by manipulating the corresponding entry in the file <strong class="userinput"><code>/etc/group</code></strong>.</p>

        <p>In addition, the directory specified as the home directory of the user <strong class="userinput"><code>nagios</code></strong>, <strong class="userinput"><code>/usr/local/nagios</code></strong>, the configuration directory <strong class="userinput"><code>/etc/nagios</code></strong>, and the directory <strong class="userinput"><code>/var/nagios</code></strong>, which records variable data while Nagios is running, are set up manually and are assigned to the user <strong class="userinput"><code>nagios</code></strong> and to the group of the same name:<a class="indexterm" id="IDX-CHP-1-0041"/></p><a id="I_programlisting1_d1e937"/>
        <pre class="programlisting">linux:~ # <span class="strong"><strong>mkdir /usr/local/nagios /etc/nagios /var/nagios</strong></span>
linux:~ # <span class="strong"><strong>chown nagios.nagios /usr/local/nagios /etc/nagios /var/nagios</strong></span></pre>
      </div>
    </div>

    <div class="footnotes">
      <br/>
      <hr/>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-1" id="ftn.CHP-1-FN-1">9</a>]</sup> <a class="ulink" href="http://www.boutell.com/gd/">http://www.boutell.com/gd/</a></p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-2" id="ftn.CHP-1-FN-2">10</a>]</sup> <a class="ulink" href="http://www.openssl.org/">http://www.openssl.org/</a> Depending on the distribution, the required RPM and Debian packages are sometimes named differently. Here you need to refer to the search help in the corresponding distribution. For Debian, the homepage will be of help. For example, if a <strong class="userinput"><code>configure</code></strong> instruction complains of a missing <strong class="userinput"><code>gd.h</code></strong> file, you can search specifically at <a class="ulink" href="http://www.debian.org/distrib/packages">http://www.debian.org/distrib/packages</a> for the contents of packages. The search will then come up with all packages that contain the file <strong class="userinput"><code>gd.h</code></strong>.</p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-3" id="ftn.CHP-1-FN-3">11</a>]</sup> <a class="ulink" href="http://ntp.isc.org/bin/view/Main/SoftwareDownloads">http://ntp.isc.org/bin/view/Main/SoftwareDownloads</a></p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-4" id="ftn.CHP-1-FN-4">12</a>]</sup> <a class="ulink" href="http://net-snmp.sourceforge.net/">http://net-snmp.sourceforge.net/</a></p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-5" id="ftn.CHP-1-FN-5">13</a>]</sup> <a class="ulink" href="http://samba.org/samba/">http://samba.org/samba/</a></p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-6" id="ftn.CHP-1-FN-6">14</a>]</sup> <a class="ulink" href="http://www.openldap.org/">http://www.openldap.org/</a></p>
      </div>
    </div>
  </div>


  <div class="sect1" title="1.2 Compiling Source Code">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="compiling_source_code"/>1.2 Compiling Source Code</h1>
    </div>

    <p>The Nagios source code is available for download on the project page.<sup>[<a class="footnote" href="#ftn.CHP-1-FN-7" id="CHP-1-FN-7">15</a>]</sup> The installation description below is for version 3.0, which is provided by the developers as a tarball. A Nagios 2.x installation runs in an almost identical manner:<a class="indexterm" id="IDX-CHP-1-0042"/><a class="indexterm" id="IDX-CHP-1-0043"/><a class="indexterm" id="IDX-CHP-1-0044"/><a class="indexterm" id="IDX-CHP-1-0045"/></p><a id="I_programlisting1_d1e965"/>
    <pre class="programlisting">linux:~ # <span class="strong"><strong>mkdir /usr/local/src</strong></span>
linux:~ # <span class="strong"><strong>cd /usr/local/src</strong></span>
linux:local/src # <span class="strong"><strong>tar xvzf</strong></span> <span class="bolditalic">path/to/</span><span class="strong"><strong>nagios-3.0.tar.gz</strong></span>
...</pre>

    <p>The three commands unpack the source code into the directory created for this purpose, <strong class="userinput"><code>/usr/local/src</code></strong>. A subdirectory called <strong class="userinput"><code>nagios-3.0</code></strong> is also created, containing the Nagios sources. To prepare these for compilation, enter the parameter deviating from the default value when running the <strong class="userinput"><code>configure</code></strong> command. <a class="xref" href="../Text/ch01s02.html#installation_parameters_for_nagios" title="Table 1-1. Installation parameters for Nagios">Table 1-1</a> lists the most important parameters:</p><a id="I_programlisting1_d1e994"/>
    <pre class="programlisting">linux:~ # <span class="strong"><strong>cd /usr/local/src/nagios-3.0</strong></span>
linux:src/nagios-3.0 # <span class="strong"><strong>./configure</strong></span> \
<span class="strong"><strong>    --sysconfdir=/etc/nagios</strong></span> \
<span class="strong"><strong>    --localstatedir=/var/nagios</strong></span> \
<span class="strong"><strong>    --with-command-group=nagcmd</strong></span>
...</pre>

    <p>The values chosen here ensure that the installation routine selects the directories used in the book and sets all parameters correctly when generating the main configuration file. This simplifies fine tuning of the configuration considerably. If you want to use the Embedded Perl Interpreter to accelerate the execution of Perl scripts, then you also need the two switches <strong class="userinput"><code>--with-perlcache and --enable-embedded-perl</code></strong>.</p>

    <p>In Nagios 3.0 you can leave out <strong class="userinput"><code>--with-perlcache</code></strong>, as it is enabled automatically by <strong class="userinput"><code>--enable-embedded-perl</code></strong>. You can find more on the Embedded Perl Interpreter in <a class="xref" href="../Text/apg.html" title="Appendix G. The Embedded Perl Interpreter">Appendix G</a>, page 669.</p>

    <div class="table">
      <a id="installation_parameters_for_nagios"/>

      <p class="title">Table 1-1. Installation parameters for Nagios</p>

      <div class="table-contents">
        <table class="sgc-3" summary="Installation parameters for Nagios">
          <colgroup>
            <col/>
            <col/>
            <col/>
          </colgroup>

          <thead>
            <tr>
              <th class="sgc-1" valign="bottom">
                <p>Property<a class="indexterm" id="IDX-CHP-1-0046"/></p>
              </th>

              <th class="sgc-1" valign="bottom">
                <p>Value</p>
              </th>

              <th class="sgc-1" valign="bottom">
                <p>configure Option</p>
              </th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <td class="sgc-2" valign="top">
                <p>Root directory</p>
              </td>

              <td class="sgc-2" valign="top">
                <p><strong class="userinput"><code>/usr/local/nagios</code></strong></p>
              </td>

              <td class="sgc-2" valign="top">
                <p><strong class="userinput"><code>--prefix</code></strong></p>
              </td>
            </tr>

            <tr>
              <td class="sgc-2" valign="top">
                <p>Configuration directory</p>
              </td>

              <td class="sgc-2" valign="top">
                <p><strong class="userinput"><code>/etc/nagios</code></strong></p>
              </td>

              <td class="sgc-2" valign="top">
                <p><strong class="userinput"><code>--sysconfdir</code></strong></p>
              </td>
            </tr>

            <tr>
              <td class="sgc-2" valign="top">
                <p>Directory for variable data</p>
              </td>

              <td class="sgc-2" valign="top">
                <p><strong class="userinput"><code>/var/nagios</code></strong></p>
              </td>

              <td class="sgc-2" valign="top">
                <p><strong class="userinput"><code>--localstatedir</code></strong></p>
              </td>
            </tr>

            <tr>
              <td class="sgc-2" valign="top">
                <p>Nagios user (UserID)</p>
              </td>

              <td class="sgc-2" valign="top">
                <p><strong class="userinput"><code>nagios (9000)</code></strong></p>
              </td>

              <td class="sgc-2" valign="top">
                <p><strong class="userinput"><code>--with-nagios-user</code></strong></p>
              </td>
            </tr>

            <tr>
              <td class="sgc-2" valign="top">
                <p>Nagios group (GroupID)</p>
              </td>

              <td class="sgc-2" valign="top">
                <p><strong class="userinput"><code>nagios (9000)</code></strong></p>
              </td>

              <td class="sgc-2" valign="top">
                <p><strong class="userinput"><code>--with-nagios-group</code></strong></p>
              </td>
            </tr>

            <tr>
              <td class="sgc-2" valign="top">
                <p>Nagios Command Group (GroupID)</p>
              </td>

              <td class="sgc-2" valign="top">
                <p><strong class="userinput"><code>nagcmd (9001)</code></strong></p>
              </td>

              <td class="sgc-2" valign="top">
                <p><strong class="userinput"><code>--with-command-group</code></strong></p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <p><strong class="userinput"><code>If --prefix</code></strong> is not specified, Nagios installs itself in the <strong class="userinput"><code>/usr/local/nagios</code></strong> directory. We recommend that you stick to this directory.<sup>[<a class="footnote" href="#ftn.CHP-1-FN-8" id="CHP-1-FN-8">16</a>]</sup><a class="indexterm" id="IDX-CHP-1-0047"/></p>

    <p>The system normally stores its configuration files in the directory <strong class="userinput"><code>etc</code></strong> beneath its root directory. In general it is better to store these in the <strong class="userinput"><code>/etc</code></strong> hierarchy however. Here we use <strong class="userinput"><code>/etc/nagios</code></strong>.<sup>[<a class="footnote" href="#ftn.CHP-1-FN-9" id="CHP-1-FN-9">17</a>]</sup></p>

    <p>Variable data such as the log file and the status file are by default stored in the directory <strong class="userinput"><code>/usr/local/nagios/var</code></strong>. This is in the <strong class="userinput"><code>/usr</code></strong> hierarchy which should only contain programs and other read-only files, not writable ones. In order to ensure that this is the case, we use <strong class="userinput"><code>/var/nagios</code></strong>.<sup>[<a class="footnote" href="#ftn.CHP-1-FN-10" id="CHP-1-FN-10">18</a>]</sup></p>

    <p>Irrespective of these changes, in most cases <strong class="userinput"><code>configure</code></strong> does not run through faultlessly the very first time, since one package or another is missing. For required libraries such as <strong class="userinput"><code>libgd</code></strong>, Nagios almost always demands the relevant developer package with the header files (here, <strong class="userinput"><code>libgd-dev</code></strong> or <strong class="userinput"><code>libgd-devel</code></strong>). Depending on the distribution, their names will end in <strong class="userinput"><code>-devel</code></strong> or <strong class="userinput"><code>-dev</code></strong>.</p>

    <p>After all the tests have been run through, <strong class="userinput"><code>configure</code></strong> presents a summary of all the important configuration parameters:</p><a id="I_programlisting1_d1e1198"/>
    <pre class="programlisting"><span class="strong"><strong>***</strong></span> Configuration summary for nagios 3.0 <span class="strong"><strong>***</strong></span>:

General Options:
----------------
       Nagios executable:   nagios
       Nagios user/group:   nagios,nagios
      Command user/group:   nagios,nagcmd
           Embedded Perl:   yes, with caching
            Event Broker:   yes
       Install $prefix:   /usr/local/nagios
                 Lock file: /var/nagios/nagios.lock
 Check result  directory:   /var/nagios/spool/checkresults
         Init  directory:   /etc/init.d
Apache conf.d  directory:   /etc/apache2/conf.d
           Mail program:    /usr/bin/mail
                Host OS:    linux-gnu

Web Interface Options:
------------------
               HTML URL:    http://localhost/nagios/
                CGI URL:    http://localhost/nagios/cgi-bin/
Traceroute (used by WAP):   /usr/sbin/traceroute</pre>

    <p>In Nagios 2.x the lines <strong class="userinput"><code>Check result directory</code></strong>, <strong class="userinput"><code>Apache conf.d directory</code></strong>, and <strong class="userinput"><code>Mail program</code></strong> are missing.</p>

    <p>If a <strong class="userinput"><code>yes</code></strong> is written after the item <strong class="userinput"><code>Embedded Perl</code></strong>, the Embedded Perl Interpreter is enabled. The <span class="emphasis"><em>Event Broker</em></span> provides an interface for extensions that can be loaded as additional modules while the system is running.<sup>[<a class="footnote" href="#ftn.CHP-1-FN-11" id="CHP-1-FN-11">19</a>]</sup></p>

    <p>If you are satisfied with the result, <strong class="userinput"><code>make</code></strong> starts the actual compilation and then installs the software:<sup>[<a class="footnote" href="#ftn.CHP-1-FN-12" id="CHP-1-FN-12">20</a>]</sup><a class="indexterm" id="IDX-CHP-1-0048"/><a class="indexterm" id="IDX-CHP-1-0049"/><a class="indexterm" id="IDX-CHP-1-0050"/></p><a id="I_programlisting1_d1e1259"/>
    <pre class="programlisting">linux:src/nagios-3.0 # <span class="strong"><strong>make all</strong></span>
...
linux:src/nagios-3.0 # <span class="strong"><strong>make install</strong></span>
...
linux:src/nagios-3.0 # <span class="strong"><strong>make install-init</strong></span>
...
linux:src/nagios-3.0 # <span class="strong"><strong>make install-commandmode</strong></span>
...
linux:src/nagios-3.0 # <span class="strong"><strong>make install-config</strong></span>
...</pre>

    <p>The command <strong class="userinput"><code>make all</code></strong> compiles all the relevant programs, which are then copied to the appropriate directories, together with CGI scripts and documentation, by <strong class="userinput"><code>make install</code></strong>. Apart from <strong class="userinput"><code>/etc/nagios</code></strong> and <strong class="userinput"><code>/var/nagios</code></strong>, further directories are created under <strong class="userinput"><code>/usr/local/nagios</code></strong>, which are summarized in <a class="xref" href="../Text/ch01s02.html#nagios_directories_under_solidus_usr_sol" title="Table 1-2. Nagios directories under /usr/local/nagios">Table 1-2</a>.<a class="indexterm" id="IDX-CHP-1-0051"/><a class="indexterm" id="IDX-CHP-1-0052"/></p>

    <div class="table">
      <a id="nagios_directories_under_solidus_usr_sol"/>

      <p class="title">Table 1-2. Nagios directories under <code class="userinput">/usr/local/nagios</code></p>

      <div class="table-contents">
        <table class="sgc-3" summary="Nagios directories under /usr/local/nagios">
          <colgroup>
            <col/>
            <col/>
          </colgroup>

          <thead>
            <tr>
              <th class="sgc-1" valign="bottom">
                <p>Directory</p>
              </th>

              <th class="sgc-1" valign="bottom">
                <p>Contents</p>
              </th>
            </tr>
          </thead>

          <tbody>
            <tr>
              <td class="sgc-2" valign="top">
                <p><strong class="userinput"><code>./bin</code></strong></p>
              </td>

              <td class="sgc-2" valign="top">
                <p>Executable Nagios main program</p>
              </td>
            </tr>

            <tr>
              <td class="sgc-2" valign="top">
                <p><strong class="userinput"><code>./libexec</code></strong></p>
              </td>

              <td class="sgc-2" valign="top">
                <p>Plugins</p>
              </td>
            </tr>

            <tr>
              <td class="sgc-2" valign="top">
                <p><strong class="userinput"><code>./sbin</code></strong></p>
              </td>

              <td class="sgc-2" valign="top">
                <p>CGI scripts</p>
              </td>
            </tr>

            <tr>
              <td class="sgc-2" valign="top">
                <p><strong class="userinput"><code>./share</code></strong></p>
              </td>

              <td class="sgc-2" valign="top">
                <p>Documentation, HTML files for the Web interface</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <p>The command <strong class="userinput"><code>make install-commandmode</code></strong> generates the directory that is required for later usage of the <span class="emphasis"><em>command file mechanism</em></span> (see <a class="xref" href="../Text/ch13.html#the_interface_for_external_commands" title="13.1 The Interface for External Commands">13.1 The Interface for External Commands</a>, page 292) onwards. This step is optional, depending on the intended use, but since it is easy to forget later on, it is better to take precautions now. The final <strong class="userinput"><code>make install-config</code></strong> creates the example configuration, which will be used in <a class="xref" href="../Text/ch02.html" title="Chapter 2. Nagios Configuration">Chapter 2</a>, page 53.</p>

    <div class="footnotes">
      <br/>
      <hr/>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-7" id="ftn.CHP-1-FN-7">15</a>]</sup> <a class="ulink" href="http://www.nagios.org/">http://www.nagios.org/</a></p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-8" id="ftn.CHP-1-FN-8">16</a>]</sup> In accordance with the <span class="emphasis"><em>Filesystem Hierarchy Standard</em></span> FHS, version 2.3, or local programs loaded by the administrator should be installed in <strong class="userinput"><code>/usr/local</code></strong></p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-9" id="ftn.CHP-1-FN-9">17</a>]</sup> This is not entirely compatible with FHS 2.3, which would prefer to have the configuration files in <strong class="userinput"><code>/etc/local/nagios</code></strong>.</p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-10" id="ftn.CHP-1-FN-10">18</a>]</sup> This also does not quite match the requirements of the FHS 2.3. But since Nagios makes no differentiation between spool, cache, and status information, an FHS-true reproduction is not possible to achieve in a simple manner.</p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-11" id="ftn.CHP-1-FN-11">19</a>]</sup> At the time of going to press there were not yet any external extensions, which is why the Event Broker is currently only of interest to developers.</p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-12" id="ftn.CHP-1-FN-12">20</a>]</sup> Caution is needed when updating from Nagios 2.x to Nagios 3.0: Here you should first back up the existing configuration, initially run only <strong class="userinput"><code>make all</code></strong>, and carefully read <a class="xref" href="../Text/aphs13.html" title="H.13 Upgrade from Nagios 2.x to 3.0">H.13 Upgrade from Nagios 2.x to 3.0</a> in page 693. In Nagios 3.0 a <strong class="userinput"><code>make install-config</code></strong> command overwrites existing files!</p>
      </div>
    </div>
  </div>


  <div class="sect1" title="1.3 Starting Nagios Automatically">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="starting_nagios_automatically"/>1.3 Starting Nagios Automatically</h1>
    </div>

    <p>The command <strong class="userinput"><code>make install-init</code></strong> installs a suitable init script for the system start. Here <strong class="userinput"><code>make</code></strong> automatically tries to detect the correct path, which for most Linux distributions is <strong class="userinput"><code>/etc/init.d</code></strong>. Depending on your system, this may not be correct, which is why you should check it. In order for Nagios to start automatically when the system is booted, symbolic links are created in the <strong class="userinput"><code>/etc/rc?.d</code></strong> directories. With Debian and Ubuntu using System-V-Init, the included system script <strong class="userinput"><code>update-rc.d</code></strong> performs this task:<a class="indexterm" id="IDX-CHP-1-0053"/><a class="indexterm" id="IDX-CHP-1-0054"/><a class="indexterm" id="IDX-CHP-1-0055"/><a class="indexterm" id="IDX-CHP-1-0056"/></p><a id="I_programlisting1_d1e1407"/>
    <pre class="programlisting">linux:~ # <span class="strong"><strong>update-rc.d nagios defaults 99</strong></span></pre>

    <p>This command creates symlinks beginning with the prefix <strong class="userinput"><code>S99</code></strong> to the directories <strong class="userinput"><code>rc2.d</code></strong> to <strong class="userinput"><code>rc5.d</code></strong>, so that Nagios starts automatically when changing to runlevels 2 to 5. In addition it ensures that <strong class="userinput"><code>K99</code></strong> symlinks in the directories <strong class="userinput"><code>rc0.d</code></strong>, <strong class="userinput"><code>rc1.d</code></strong>, and <strong class="userinput"><code>rc6.d</code></strong> are responsible for stopping Nagios when the system is shut down and rebooted, as well as when it changes to maintenance mode. This corresponds to the following command-line commands:</p><a id="I_programlisting1_d1e1435"/>
    <pre class="programlisting">linux:~ # <span class="strong"><strong>ln -s /etc/init.d/nagios /etc/rc2.d/S99nagios</strong></span>
linux:~ # <span class="strong"><strong>ln -s /etc/init.d/nagios /etc/rc3.d/S99nagios</strong></span>
linux:~ # <span class="strong"><strong>ln -s /etc/init.d/nagios /etc/rc4.d/S99nagios</strong></span>
linux:~ # <span class="strong"><strong>ln -s /etc/init.d/nagios /etc/rc5.d/S99nagios</strong></span>
linux:~ # <span class="strong"><strong>ln -s /etc/init.d/nagios /etc/rc0.d/K99nagios</strong></span>
linux:~ # <span class="strong"><strong>ln -s /etc/init.d/nagios /etc/rc1.d/K99nagios</strong></span>
linux:~ # <span class="strong"><strong>ln -s /etc/init.d/nagios /etc/rc6.d/K99nagios</strong></span></pre>

    <p>For OpenSUSE the required symlinks are created using the script <strong class="userinput"><code>insserv</code></strong>:</p><a id="I_programlisting1_d1e1463"/>
    <pre class="programlisting">linux:~ # <span class="strong"><strong>insserv nagios</strong></span></pre>

    <p>Fedora users perform this task with <strong class="userinput"><code>chkconfig</code></strong>:</p><a id="I_programlisting1_d1e1472"/>
    <pre class="programlisting">linux:~ # <span class="strong"><strong>chkconfig --add nagios</strong></span>
linux:~ # <span class="strong"><strong>nagios on</strong></span></pre>
  </div>


  <div class="sect1" title="1.4 Installing and Testing Plugins">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="installing_and_testing_plugins"/>1.4 Installing and Testing Plugins</h1>
    </div>

    <p>What is now still missing are the plugins. They must be downloaded separately from <a class="ulink" href="http://www.nagios.org/">http://www.nagios.org/</a> and installed. As independent programs, they are subject to a different versioning system than Nagios. The current version at the time of going to press was version 1.4.11, but you can, for example, also use plugins from earlier version if you don't mind doing without the most recent features. Although the plugins are distributed in a common source distribution, they are independent of one another, so that you can replace one version of an individual plugin with another one at any time, or with one you have written yourself.</p>

    <div class="sect2" title="1.4.1 Installation">
      <div class="titlepage">
        <h2 class="title" id="heading_id_3"><a id="installation-id1"/>1.4.1 Installation</h2>
      </div>

      <p>The installation of the plugin sources takes place, like the Nagios ones, in the directory <strong class="userinput"><code>/usr/local</code></strong>:</p><a id="I_programlisting1_d1e1494"/>
      <pre class="programlisting">linux:~ # <span class="strong"><strong>cd /usr/local/src</strong></span>
linux:local/src # <span class="strong"><strong>tar xvzf</strong></span> <span class="bolditalic">path /to/</span><span class="strong"><strong>nagios-plugins-1.4.tar.gz</strong></span>
linux:src/nagios-plugins-1.4.11 # <span class="strong"><strong>./configure</strong></span> \
<span class="strong"><strong>    --sysconfdir=/etc/nagios</strong></span> \
<span class="strong"><strong>    --localstatedir=/var/nagios</strong></span> \
<span class="strong"><strong>        --enable-perl-modules</strong></span>
...</pre>

      <p>When running the <strong class="userinput"><code>configure</code></strong> command you should specify the same non-default values as for the server, which here are the configuration directory (<strong class="userinput"><code>/etc/nagios</code></strong>) and the directory intended for the data saved by Nagios (<strong class="userinput"><code>/var/nagios</code></strong>). Since the Nagios plugins are not maintained by the same people as Nagios itself, you should always check in advance, with <strong class="userinput"><code>./configure --help</code></strong>, whether the <strong class="userinput"><code>configure</code></strong> options for Nagios and the plugins really match or deviate from one another.</p>

      <p>The switch <strong class="userinput"><code>--enable-perl-modules</code></strong> is only needed if you intend to install the Perl module <strong class="userinput"><code>Nagios::Plugin</code></strong>—for example, if you are using it to program your own plugins in Perl. You can read more on this in <a class="xref" href="../Text/ch24s02.html" title="24.2 The Perl Module Nagios::Plugin">24.2 The Perl Module Nagios::Plugin</a>, page 560.</p>

      <p>It is possible that a series of <strong class="userinput"><code>WARNING</code></strong>s may appear in the output of the <strong class="userinput"><code>configure</code></strong> command, something like this:</p><a id="I_programlisting1_d1e1555"/>
      <pre class="programlisting">...
configure: WARNING: Skipping radius plugin
configure: WARNING: install radius libs to compile this plugin (see
           REQUIREMENTS).
...
configure: WARNING: Tried /usr/bin/perl - install Net ::SNMP perl
           module if you want to use the perl snmp plugins
...</pre>

      <p>If you are not using Radius, you need not have qualms about ignoring the corresponding error messages. Otherwise you should install the missing packages and repeat the <strong class="userinput"><code>configure</code></strong> procedure. The quite frequently required SNMP functionality is missing a Perl module in this example. This may be installed either in the form of the distribution package or via the online CPAN archive:<sup>[<a class="footnote" href="#ftn.CHP-1-FN-13" id="CHP-1-FN-13">21</a>]</sup></p><a id="I_programlisting1_d1e1569"/>
      <pre class="programlisting">linux:~ # <span class="strong"><strong>perl -MCPAN -e 'install Net::SNMP'</strong></span>
...</pre>

      <p>If you are running the CPAN procedure for the first time, it will guide you interactively through a self-explanatory setup, and you can answer nearly all of the questions with the default option.</p>

      <p>Running <strong class="userinput"><code>make</code></strong> in the directory <strong class="userinput"><code>nagios-plugins-1.4.11</code></strong> will compile all plugins. Afterwards you have the opportunity to perform tests, with <strong class="userinput"><code>make check</code></strong>. Because these tests have not been particularly carefully programmed, you will often see many error messages that have more to do with the test itself than with the plugin. If you still want to try it, then the <strong class="userinput"><code>Cache</code></strong> Perl module must also be installed. Regardless of whether you use <strong class="userinput"><code>make check</code></strong>, you should manually check the most important plugins after the installation.<a class="indexterm" id="IDX-CHP-1-0057"/></p>

      <p>The command <strong class="userinput"><code>make install</code></strong> finally anchors the plugins in the subdirectory <strong class="userinput"><code>libexec</code></strong> (which in our case is <strong class="userinput"><code>/usr/local/nagios/libexec</code></strong>). However, not all of them are installed through this command. The source directory <strong class="userinput"><code>contrib</code></strong> contains a number of plugins that <strong class="userinput"><code>make install</code></strong> does not install automatically.</p>

      <p>Most plugins in this directory are shell or Perl scripts. Where needed, these are simply copied to the plugin directory <strong class="userinput"><code>/usr/local/nagios/libexec</code></strong>. The few C programs first must be compiled, which in some cases may be no laughing matter, since a corresponding makefile, and often even a description of the required libraries, can be missing. If a simple <strong class="userinput"><code>make</code></strong> is not sufficient, as in the case of</p><a id="I_programlisting1_d1e1623"/>
      <pre class="programlisting">linux:nagios-plugins-1.4.11/contrib # <span class="strong"><strong>make check_cluster2</strong></span><sup>[<a class="footnote" href="#ftn.CHP-1-FN-14" id="CHP-1-FN-14">22</a>]</sup>
cc     check_cluster2.c   -o check_cluster2</pre>

      <p>then it is best to look for help in the mailing list <strong class="userinput"><code>nagiosplug-help</code></strong>.<sup>[<a class="footnote" href="#ftn.CHP-1-FN-15" id="CHP-1-FN-15">23</a>]</sup> The compiled program must also be copied to the plugin directory.</p>
    </div>

    <div class="sect2" title="1.4.2 Plugin test">
      <div class="titlepage">
        <h2 class="title" id="heading_id_4"><a id="plugin_test"/>1.4.2 Plugin test</h2>
      </div>

      <p>Because plugins are independent programs, they can already be used manually for test purposes right now—before the installation of Nagios has been completed. In any case you should check the <strong class="userinput"><code>check_icmp</code></strong> plugin, which plays an essential role. It checks whether another computer can be reached via <strong class="userinput"><code>ping</code></strong>, and it is the only plugin to be used both as a service check and a host check. If it is not working correctly, Nagios will not work correctly either, since the system cannot perform any service checks as long as it categorizes a host as "down." <a class="xref" href="../Text/ch06s02.html" title="6.2 Reachability Test with Ping">6.2 Reachability Test with Ping</a>, 108, describes <strong class="userinput"><code>check_icmp</code></strong> in detail, which is why there is only short introduction here describing its manual use.<a class="indexterm" id="IDX-CHP-1-0058"/><a class="indexterm" id="IDX-CHP-1-0059"/><a class="indexterm" id="IDX-CHP-1-0060"/><a class="indexterm" id="IDX-CHP-1-0061"/><a class="indexterm" id="IDX-CHP-1-0062"/><a class="indexterm" id="IDX-CHP-1-0063"/></p>

      <p>In order for the plugin to function correctly it must, like the <strong class="userinput"><code>/bin/ping</code></strong> program, be run as the user <strong class="userinput"><code>root</code></strong>. This is done by providing it with the <span class="emphasis"><em>SUID bit</em></span>.With current plugin versions, <strong class="userinput"><code>make install</code></strong> sets this automatically. One way this can be seen is in the fact that the sources contain an additional directory, <strong class="userinput"><code>plugins-root</code></strong>. With older plugin versions you have to do this manually:</p><a id="I_programlisting1_d1e1701"/>
      <pre class="programlisting">linux:~ # <span class="strong"><strong>chown root.nagios /usr/local/nagios/libexec/check_icmp</strong></span>
linux:~ # <span class="strong"><strong>chmod 4711 /usr/local/nagios/libexec/check_icmp</strong></span>
linux:~ # <span class="strong"><strong>ls -l /usr/local/nagios/libexec/check_icmp</strong></span>
-rwsr-x--x 1 root nagios 61326 2005-02-08 19:49 check_icmp</pre>

      <p>Brief instructions for the plugin are given with the <strong class="userinput"><code>-h</code></strong> option:<sup>[<a class="footnote" href="#ftn.CHP-1-FN-16" id="CHP-1-FN-16">24</a>]</sup></p><a id="I_programlisting1_d1e1722"/>
      <pre class="programlisting">nagios@linux:~$ <span class="strong"><strong>/usr/local/nagios/libexec/check_icmp -h</strong></span>
Usage: check_icmp [options] [-H] host1 host2 hostn

Where options are any combination of:
<span class="strong"><strong> *</strong></span> -H | --host        specify a target
<span class="strong"><strong> *</strong></span> -w | --warn        warning threshold (currently 200.000ms,40%)
<span class="strong"><strong> *</strong></span> -c | --crit        critical threshold (currently 500.000ms,80%)
<span class="strong"><strong> *</strong></span> -n | --packets     number of packets to send (currently 5)
<span class="strong"><strong> *</strong></span> -i | --interval    max packet interval (currently 80.000ms)
<span class="strong"><strong> *</strong></span> -I | --hostint     max target interval (currently 0.000ms)
<span class="strong"><strong> *</strong></span> -l | --ttl         TTL on outgoing packets (currently 0)
<span class="strong"><strong> *</strong></span> -t | --timeout     timeout value (seconds, currently 10)
<span class="strong"><strong> *</strong></span> -b | --bytes       icmp packet size (currenly ignored)
  -v | --verbose     verbosity++
  -h | --help        this cruft
The -H switch is optional. Naming a host (or several) to check is not.</pre>

      <p>For a simple test it is sufficient to specify an IP address (it is immaterial whether you prefix the <strong class="userinput"><code>-H</code></strong> flag or not):<a class="indexterm" id="IDX-CHP-1-0064"/></p><a id="I_programlisting1_d1e1765"/>
      <pre class="programlisting">user@linux:~$ <span class="strong"><strong>cd /usr/local/nagios/libexec</strong></span>
user@linux:nagios/libexec$ <span class="strong"><strong>./check_icmp -H 192.168.1.13</strong></span>
OK - 192.168.1.13: rta 0.261ms, lost 0%|rta=0.261ms;200.000;500.000;0;
pl=0%;40;80;;</pre>

      <p>The output appears as a single line, which has been line-wrapped here for the printed version: with zero percent package loss (<strong class="userinput"><code>lost 0%</code></strong>), the test has been passed. Nagios uses only the first 300 bytes of the output line. If the plugin provides more information, this is cut off.</p>

      <p>If you would like to test other plugins, we refer you to <a class="xref" href="../Text/ch06.html" title="Chapter 6. Plugins for Network Services">Chapter 6</a> and <a class="xref" href="../Text/ch07.html" title="Chapter 7. Testing Local Resources">Chapter 7</a>, which describe the most important plugins in detail. All (reasonably well-programmed) plugins provide somewhat more detailed instructions with the <strong class="userinput"><code>--help</code></strong> option.</p>
    </div>

    <div class="footnotes">
      <br/>
      <hr/>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-13" id="ftn.CHP-1-FN-13">21</a>]</sup> The <span class="emphasis"><em>Comprehensive Perl Archive Network</em></span> at <a class="ulink" href="http://www.cpan.org/">http://www.cpan.org/</a></p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-14" id="ftn.CHP-1-FN-14">22</a>]</sup> With <strong class="userinput"><code>check_cluster</code></strong>, hosts and services of a cluster can be monitored. Here you usually want to be notified if all nodes or redundant services provided fail at the same time. If one specific service fails on the other hand, this is not critical, as long as other hosts in the cluster provide this service.</p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-15" id="ftn.CHP-1-FN-15">23</a>]</sup> <a class="ulink" href="http://lists.sourceforge.net/lists/listinfo/nagiosplug-help">http://lists.sourceforge.net/lists/listinfo/nagiosplug-help</a></p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-16" id="ftn.CHP-1-FN-16">24</a>]</sup> The listed options are explained in detail in <a class="xref" href="../Text/ch06s02.html" title="6.2 Reachability Test with Ping">6.2 Reachability Test with Ping</a> from page 108.</p>
      </div>
    </div>
  </div>


  <div class="sect1" title="1.5 Configuration of the Web Interface">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="configuration_of_the_web_interface"/>1.5 Configuration of the Web Interface</h1>
    </div>

    <p>In order for the Web front end of Nagios to function, the Web server must know the CGI directory and the main Web directory. The following description applies to both Apache 1.3, Apache 2.0, and 2.2.<a class="indexterm" id="IDX-CHP-1-0065"/><a class="indexterm" id="IDX-CHP-1-0066"/><a class="indexterm" id="IDX-CHP-1-0067"/><a class="indexterm" id="IDX-CHP-1-0068"/><a class="indexterm" id="IDX-CHP-1-0069"/></p>

    <div class="sect2" title="1.5.1 Setting up Apache">
      <div class="titlepage">
        <h2 class="title" id="heading_id_3"><a id="setting_up_apache"/>1.5.1 Setting up Apache</h2>
      </div>

      <p>As long as you have not added a different address for the front end, through the <strong class="userinput"><code>configure</code></strong> script with <strong class="userinput"><code>-with-cgiurl</code></strong>, Nagios expects the CGI programs at the URL <strong class="userinput"><code>/nagios/cgi-bin</code></strong> (actual directory: <strong class="userinput"><code>/usr/local/na-gios/sbin</code></strong>) as well as the remaining HTML files below <strong class="userinput"><code>/nagios</code></strong> (actual directory: <strong class="userinput"><code>/usr/local/nagios/share</code></strong>). Nagios 3.0 includes its own <strong class="userinput"><code>make</code></strong> target for the Web interface, which configures the directories and sets corresponding aliases for the two URLs:</p><a id="I_programlisting1_d1e1836"/>
      <pre class="programlisting">linux:~ # <span class="strong"><strong>make install-webconf</strong></span>
...</pre>

      <p>This command installs the file <strong class="userinput"><code>nagios.conf</code></strong> in the configuration directory of Apache. In Debian/Ubuntu and OpenSUSE it is named <strong class="userinput"><code>/etc/apache2/</code></strong> <strong class="userinput"><code>conf.d</code></strong>, or in Fedora <strong class="userinput"><code>/etc/httpd/conf.d</code></strong>. It looks like this:<a class="indexterm" id="IDX-CHP-1-0070"/><a class="indexterm" id="IDX-CHP-1-0071"/></p><a id="I_programlisting1_d1e1865"/>
      <pre class="programlisting">ScriptAlias /nagios/cgi-bin "/usr/local/nagios/sbin"
&lt;Directory "/usr/local/nagios/sbin"&gt;
  Options ExecCGI
  AllowOverride None
  Order allow,deny
  Allow from all
# Order deny,allow
# Deny from all
# Allow from 127.0.0.1
  AuthName "Nagios Access"
  AuthType Basic
  AuthUserFile /etc/nagios/htpasswd.users
Require valid-user
&lt;/Directory&gt;</pre>

      <p>In Nagios 2.x you have to set up the file by hand.</p>

      <p>The directive <strong class="userinput"><code>ScriptAlias</code></strong> ensures that Apache accesses the Nagios CGI directory when calling a URL such as <a class="ulink" href="http://nagios-server/nagios/cgi-bin">http://nagios-server/nagios/cgi-bin</a>, irrespective of where the Apache CGI directories may be located. <strong class="userinput"><code>Options ExcecCGI</code></strong> ensures that the Web server accepts all the scripts located there as CGI. <strong class="userinput"><code>Order</code></strong> and <strong class="userinput"><code>Allow</code></strong> initially allow unrestricted access here to the Web server. If you want to restrict access, the sequence of the <strong class="userinput"><code>Order</code></strong> arguments is altered:</p><a id="I_programlisting1_d1e1889"/>
      <pre class="programlisting">Order deny, allow
Deny from all
Allow from 127.0.0.1
Allow from 192.0.2.0/24</pre>

      <p>This example ensures that only clients from the network <strong class="userinput"><code>192.0.2.0/24 (/24</code></strong> stands for the subnet mask <strong class="userinput"><code>255.255.255.0</code></strong>) and <strong class="userinput"><code>localhost</code></strong> gain access to the directory specified. The three <strong class="userinput"><code>Auth*</code></strong>- and the <strong class="userinput"><code>Require</code></strong> directives ensure authenticated access; more on user authentication in <a class="xref" href="../Text/ch01s05.html#user_authentication" title="1.5.3 User authentication">1.5.3 User authentication</a> in page 49.</p>

      <p>The section for the Nagios documents directory <strong class="userinput"><code>/usr/local/nagios/share</code></strong> is constructed in a similar fashion: the directive <strong class="userinput"><code>Alias</code></strong> allows the directory beneath the URL <a class="ulink" href="http://nagios-server/nagios">http://nagios-server/nagios</a> to be addressed, independently of where the Apache-<strong class="userinput"><code>DocumentRoot</code></strong> is located.</p>

      <p>The directives <strong class="userinput"><code>Order</code></strong> and <strong class="userinput"><code>Allow</code></strong> (and also <strong class="userinput"><code>Deny</code></strong>, if needed) are set in identical manner to the CGI section. Authentication is not absolutely essential in the documentation sphere, but it is certainly useful if you want to install extensions such as PNP there (see <a class="xref" href="../Text/ch19s06.html" title="19.6 Smooth Plotting with PNP">19.6 Smooth Plotting with PNP</a>, page 446).</p>

      <p>The command</p><a id="I_programlisting1_d1e1940"/>
      <pre class="programlisting">linux:~ # <span class="strong"><strong>/etc/init.d/apache reload</strong></span></pre>

      <p>loads the new configuration. If everything has worked out correctly, the Nagios main page appears in the Web browser under <a class="ulink" href="http://nagios-server/nagios">http://nagios-server/nagios</a>.</p>
    </div>

    <div class="sect2" title="1.5.2 SELinux">
      <div class="titlepage">
        <h2 class="title" id="heading_id_4"><a id="selinux"/>1.5.2 SELinux</h2>
      </div>

      <p>Just a few distributions—in particular, Fedora—enable the <span class="emphasis"><em>Security Enhanced Linux</em></span> (SELinux) by default. When enabled and appropriately configured, this allows services such as the Apache Web server access only to files and directories explicitly mentioned. The directories <strong class="userinput"><code>/usr/local/nagios/bin</code></strong> and <strong class="userinput"><code>/usr/local/nagios/share</code></strong> used by Nagios are not among these. The consequence: SELinux first refuses Apache access until this is allowed via the configuration. The command <strong class="userinput"><code>getenforce</code></strong> shows whether the <span class="emphasis"><em>Enforcing Mode</em></span>, in which SELinux enforces the strict observance of the configured access rights, is switched on. This can be switched off with the command<a class="indexterm" id="IDX-CHP-1-0073"/><a class="indexterm" id="IDX-CHP-1-0074"/><a class="indexterm" id="IDX-CHP-1-0072"/></p><a id="I_programlisting1_d1e1980"/>
      <pre class="programlisting">linux:~ # <span class="strong"><strong>setenforce 0</strong></span></pre>

      <p>To retain this status at the next system start, the settings in <strong class="userinput"><code>/etc/selinux/config</code></strong> are changed. Rather than switching off the Enforcing Mode, though, it is better to configure the required accesses specifically. This does require some understanding of how SELinux works, and some general Linux experience -knowledge that would go beyond the scope of this book. For those who want to get to grips more intensively with the subject, further information can be found in the Wiki of the Nagios community,<sup>[<a class="footnote" href="#ftn.CHP-1-FN-17" id="CHP-1-FN-17">25</a>]</sup> including a link to a concrete guide.<sup>[<a class="footnote" href="#ftn.CHP-1-FN-18" id="CHP-1-FN-18">26</a>]</sup></p>
    </div>

    <div class="sect2" title="1.5.3 User authentication">
      <div class="titlepage">
        <h2 class="title" id="heading_id_5"><a id="user_authentication"/>1.5.3 User authentication</h2>
      </div>

      <p>In the state in which it is delivered, Nagios allows only authenticated users access to the CGI directory. This means that users not "logged in" have no way to see anything other than the homepage and the documentation. They are blocked off from access to other functions.<a class="indexterm" id="IDX-CHP-1-0075"/><a class="indexterm" id="IDX-CHP-1-0076"/><a class="indexterm" id="IDX-CHP-1-0077"/><a class="indexterm" id="IDX-CHP-1-0078"/></p>

      <p>There is a good reason for this: apart from status queries and other display functions, Nagios has the ability to send commands via the Web interface. The interface for external commands is used for this purpose (<a class="xref" href="../Text/ch13.html#the_interface_for_external_commands" title="13.1 The Interface for External Commands">13.1 The Interface for External Commands</a>, page 292). If this is active, checks can be switched on and off via the Web browser, for example, and Nagios can even be restarted. Only authorized users should be in a position to do this. Besides, general security considerations would indicate that the huge volume of information provided by Nagios should only be made available to trustworthy persons.<a class="indexterm" id="IDX-CHP-1-0079"/></p>

      <p>First of all, the parameter <strong class="userinput"><code>use_authenticationin</code></strong> the CGI configuration file <strong class="userinput"><code>cgi.cfg</code></strong> <sup>[<a class="footnote" href="#ftn.CHP-1-FN-19" id="CHP-1-FN-19">27</a>]</sup> of Nagios must be set to 1:</p><a id="I_programlisting1_d1e2050"/>
      <pre class="programlisting">use_authentication=1</pre>

      <p>This is the default during installation. The simplest authentication form provided by Apache is the file-based <strong class="userinput"><code>Basic</code></strong> authentication, which is already enabled in the configuration file:</p><a id="I_programlisting1_d1e2057"/>
      <pre class="programlisting">AuthName "Nagios Access"
AuthType Basic
AuthUserFile /etc/nagios/htpasswd.users
Require valid-user</pre>

      <p><strong class="userinput"><code>AuthName</code></strong> is an information field that the browser displays if the Web server requests authentication. <strong class="userinput"><code>AuthType Basic</code></strong> stands for simple authentication, in which the password is transmitted without encryption, as long as no SSL connection is used. It is best to save the password file—here <strong class="userinput"><code>htpasswd.users</code></strong>—in the Nagios configuration directory <strong class="userinput"><code>/etc/nagios</code></strong>. The final parameter, <strong class="userinput"><code>require valid-user</code></strong>, means that all authenticated users have access (there are no restrictions for specific groups; only the user-password pair must be valid).<a class="indexterm" id="IDX-CHP-1-0080"/></p>

      <p>The (freely selectable) name of the password file will be specified here so that it displays what type of password file is involved. It is generated with the <strong class="userinput"><code>htpasswd2</code></strong> program, included in Apache. (In Apache 1.3 and some other distributions, the program is called <strong class="userinput"><code>htpasswd</code></strong>.) Running</p><a id="I_programlisting1_d1e2086"/>
      <pre class="programlisting">linux:/etc/nagios <span class="strong"><strong># htpasswd2 -c htpasswd.users nagios</strong></span>
New password: <span class="bolditalic">passwort</span>
Re-type new password: <span class="bolditalic">passwort</span>
Adding password for user nagios</pre>

      <p>generates a new password file with a password for the user <strong class="userinput"><code>nagios</code></strong>. Its format is relatively simple:</p><a id="I_programlisting1_d1e2103"/>
      <pre class="programlisting">nagios:7NlyfpdI2UZEs</pre>

      <p>Each line contains a user-password pair, separated by a colon.<sup>[<a class="footnote" href="#ftn.CHP-1-FN-20" id="CHP-1-FN-20">28</a>]</sup> If you want to add other users, you should ensure that you omit the <strong class="userinput"><code>-c</code></strong> (<span class="emphasis"><em>create</em></span>) option. Otherwise <strong class="userinput"><code>htpasswd(2)</code></strong> will recreate the file and delete the old contents:</p><a id="I_programlisting1_d1e2120"/>
      <pre class="programlisting">linux:/etc/nagios <span class="strong"><strong># htpasswd2 htpasswd.users</strong></span> <span class="bolditalic">another_user</span></pre>

      <p>The user name cannot be chosen freely but must match the name of a contact person (see <a class="xref" href="../Text/ch02s07.html" title="2.7 Defining Addressees for Error Messages: contact">2.7 Defining Addressees for Error Messages: contact</a>, page 70). Only the Web user (depending on your distro, <strong class="userinput"><code>www-data</code></strong>, <strong class="userinput"><code>www-run</code></strong> oder <strong class="userinput"><code>httpd</code></strong>, see <a class="xref" href="../Text/ch01.html#determining_and_setting_up_the_required" title="1.1.1 Determining and setting up the required users">1.1.1 Determining and setting up the required users</a>) can access the generated <strong class="userinput"><code>htpasswd.users</code></strong> file, and it should be protected from access by anyone else:</p><a id="I_programlisting1_d1e2146"/>
      <pre class="programlisting">linux:/etc/nagios <span class="strong"><strong># chown www-data htpasswd.users</strong></span>
linux:/etc/nagios <span class="strong"><strong># chmod 600 htpasswd</strong></span></pre>

      <p>In combination with its own modules and those of third parties, Apache allows a series of other authentication methods. These include authentication via an LDAP directory, via Pluggable Authentication Modules (PAM),<sup>[<a class="footnote" href="#ftn.CHP-1-FN-21" id="CHP-1-FN-21">29</a>]</sup> or using SMB via a Windows server. Here we refer you to the relevant literature and the highly detailed documentation on the Apache homepage.<sup>[<a class="footnote" href="#ftn.CHP-1-FN-22" id="CHP-1-FN-22">30</a>]</sup> A quite advanced example, in which a user already authenticated by Kerberos does not have to authenticate himself again, is described in <a class="xref" href="../Text/ape.html" title="Appendix E. Single Sign-On for the Nagios Web Interface">Appendix E</a> in page 637.<a class="indexterm" id="IDX-CHP-1-0081"/></p>

      <p>Even though configuration of the Web interface is now finished, at the moment only the documentation is properly displayed: Nagios itself must first be correspondingly adjusted—as described in detail in the following chapter—before it can be used for monitoring data made available in this way.</p>
    </div>

    <div class="footnotes">
      <br/>
      <hr/>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-17" id="ftn.CHP-1-FN-17">25</a>]</sup> Search <a class="ulink" href="http://www.nagioscommunity.org/wiki/">http://www.nagioscommunity.org/wiki/</a> for the keyword <strong class="userinput"><code>SELinux</code></strong>.</p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-18" id="ftn.CHP-1-FN-18">26</a>]</sup> <a class="ulink" href="http://www.rickwargo.com/2006/10/29/fc6-selinux-and-nagios/">http://www.rickwargo.com/2006/10/29/fc6-selinux-and-nagios/</a></p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-19" id="ftn.CHP-1-FN-19">27</a>]</sup> More on this in <a class="xref" href="../Text/ch02s13.html" title="2.13 CGI Configuration in cgi.cfg">2.13 CGI Configuration in cgi.cfg</a> from page 77.</p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-20" id="ftn.CHP-1-FN-20">28</a>]</sup> To be precise, the second position does not contain the password itself, but rather its hash value.</p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-21" id="ftn.CHP-1-FN-21">29</a>]</sup> The "Pluggable Authentication Modules" now control authentication in all Linux distributions, so that you can also use existing user accounts here.</p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-1-FN-22" id="ftn.CHP-1-FN-22">30</a>]</sup> <a class="ulink" href="http://httpd.apache.org/">http://httpd.apache.org/</a></p>
      </div>
    </div>
  </div>


  <div class="chapter" title="Chapter&#xA0;2.&#xA0;Nagios Configuration">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="nagios_configuration"/>Chapter 2. Nagios Configuration</h1>
    </div>

    <p>Although the Nagios configuration can become quite large, you only need to handle a small part of this to get a system up and running. Luckily many parameters in Nagios are already set to sensible default settings. So this chapter will be concerned primarily with the most basic and frequently used parameters, which is quite sufficient for an initial configuration.<a class="indexterm" id="IDX-CHP-2-0082"/></p>

    <p>Further details on the configuration are provided by the chapters on individual Nagios features: in <a class="xref" href="../Text/ch06.html" title="Chapter 6. Plugins for Network Services">Chapter 6</a> in network plugins (page 105), there are many examples on the configuration of services. All parameters of the Nagios messaging system are explained in detail in <a class="xref" href="../Text/ch12.html" title="Chapter 12. The Nagios Notification System">Chapter 12</a>, page 265, and the parameters for controlling the Web interface are described in <a class="xref" href="../Text/ch16.html" title="Chapter 16. The Classical Web Interface">Chapter 16</a>, page 327. In addition to this, Nagios includes its own extensive documentation (<strong class="userinput"><code>/usr/local/nagios/share/docs</code></strong>), which can also be reached from the Web interface. This can always be recommended as a useful source for further information, which is why each of the sections below refer to the corresponding location in the original documentation.<a class="indexterm" id="IDX-CHP-2-0083"/></p>

    <p>The installation routine in <strong class="userinput"><code>make install-config</code></strong> (see <a class="xref" href="../Text/ch01s02.html" title="1.2 Compiling Source Code">1.2 Compiling Source Code</a> in page 39) stores examples of individual configuration files in the directory <strong class="userinput"><code>/etc/nagios</code></strong>. But be careful: whereas the names of the example files in Nagios 2.0 ended in <strong class="userinput"><code>-sample</code></strong> (so that a possible update does not overwrite the files required for production), this is no longer the case in the current Nagios 2.x versions and in Nagios 3.0. Existing files are overwritten here. Admittedly, <strong class="userinput"><code>make install</code></strong> does rename existing files: thus <strong class="userinput"><code>nagios.cfg</code></strong> is turned into <strong class="userinput"><code>nagios.cfg˜</code></strong>. But this only happens once. After running <strong class="userinput"><code>make install</code></strong> one more time, the original contents of the file are deleted once and for all. For this reason it is essential that you back up the existing configuration <span class="emphasis"><em>prior to</em></span> running <strong class="userinput"><code>make install-config</code></strong>.<a class="indexterm" id="IDX-CHP-2-0084"/></p>

    <p>After this command, the directory <strong class="userinput"><code>/etc/nagios</code></strong> of Nagios 3.0 contains the three main configuration files: <strong class="userinput"><code>nagios.cfg</code></strong>, <strong class="userinput"><code>cgi.cfg</code></strong>, and <strong class="userinput"><code>resource.cfg</code></strong>. Object definitions end up in other files in the subdirectory <strong class="userinput"><code>objects</code></strong>:<a class="indexterm" id="IDX-CHP-2-0085"/><a class="indexterm" id="IDX-CHP-2-0086"/></p><a id="I_programlisting2_d1e2253"/>
    <pre class="programlisting">user@linux:/etc/nagios$ <span class="strong"><strong>tree</strong></span><sup>[<a class="footnote" href="#ftn.CHP-2-FN-1" id="CHP-2-FN-1">31</a>]</sup>
.
|-- nagios.cfg
|-- cgi.cfg
|-- resource.cfg
'-- objects
    |-- templates.cfg
    |-- commands.cfg
    |-- contacts.cfg
    |-- timeperiods.cfg
    |-- localhost.cfg
    |-- windows.cfg
    |-- printer.cfg
    '-- switch.cfg</pre>

    <p>Nagios 2.10 uses fewer files; objects are defined only in the files <strong class="userinput"><code>localhost.cfg</code></strong> and <strong class="userinput"><code>commands.cfg</code></strong>:<a class="indexterm" id="IDX-CHP-2-0088"/></p><a id="I_programlisting2_d1e2272"/>
    <pre class="programlisting">user@linux:/etc/nagios$ <span class="strong"><strong>tree</strong></span>
.
|-- nagios.cfg
|-- cgi.cfg
|-- resource.cfg
|-- localhost.cfg
'-- commands.cfg</pre>

    <p>All subsequent work should be carried out as the user <strong class="userinput"><code>nagios</code></strong>. If you are editing files as the superuser, you must ensure yourself that the contents of directory <strong class="userinput"><code>/etc/nagios</code></strong> afterwards belong to the user <strong class="userinput"><code>nagios</code></strong> again. With the exception of the file <strong class="userinput"><code>resource.cfg</code></strong>—this may contain passwords, which is why only the owner <strong class="userinput"><code>nagios</code></strong> should have the read permission set— all other files may be readable for all.</p>

    <div class="sect1" title="2.1 The Main Configuration File nagios.cfg">
      <div class="titlepage">
        <h1 class="title" id="heading_id_3"><a id="the_main_configuration_file_nagios.cfg"/>2.1 The Main Configuration File <strong class="userinput"><code>nagios.cfg</code></strong></h1>
      </div>

      <p>The central configuration takes place in <strong class="userinput"><code>nagios.cfg</code></strong>. Instead of storing all configuration options there, it makes links to other configuration files (with the exception of the CGI configuration).<a class="indexterm" id="IDX-CHP-2-0089"/></p>

      <p>Those who compile and install Nagios themselves have the advantage that at first they do not even need to adjust <strong class="userinput"><code>nagios.cfg</code></strong>, since all paths are already correctly set.<sup>[<a class="footnote" href="#ftn.CHP-2-FN-2" id="CHP-2-FN-2">32</a>]</sup> And that's as much as you need to do. Nevertheless one small modification is recommended, which helps to maintain a clear picture and considerably simplifies configuration where larger networks are involved.</p>

      <p>The parameter concerned is <strong class="userinput"><code>cfg_file</code></strong>, which integrates files with object definitions (see <a class="xref" href="../Text/ch02s02.html" title="2.2 Objects—an Overview">2.2 Objects—an Overview</a> through <a class="xref" href="../Text/ch02s10.html" title="2.10 Defining a Time Period with timeperiod">2.10 Defining a Time Period with timeperiod</a> in page 59). The file <strong class="userinput"><code>nagios.cfg</code></strong>, included in the Nagios 3.0 package, contains the following entries:<a class="indexterm" id="IDX-CHP-2-0090"/><a class="indexterm" id="IDX-CHP-2-0091"/></p><a id="I_programlisting2_d1e2338"/>
      <pre class="programlisting">nagios@linux:/etc/nagios$ <span class="strong"><strong>fgrep cfg_file nagios.cfg</strong></span>
...
cfg_file=/etc/nagios/objects/commands.cfg
cfg_file=/etc/nagios/objects/contacts.cfg
cfg_file=/etc/nagios/objects/timeperiods.cfg
cfg_file=/etc/nagios/objects/templates.cfg
cfg_file=/etc/nagios/objects/localhost.cfg
...</pre>

      <p>Nagios 2.x gathers all example object files into just two configuration files:<a class="indexterm" id="IDX-CHP-2-0092"/></p><a id="I_programlisting2_d1e2350"/>
      <pre class="programlisting">nagios@linux:/etc/nagios$ <span class="strong"><strong>fgrep cfg_file nagios.cfg</strong></span>
...
cfg_file=/etc/nagios/commands.cfg
cfg_file=/etc/nagios/localhost.cfg
...</pre>

      <p>As an alternative to <strong class="userinput"><code>cfg_file</code></strong>, you can also use the parameter <strong class="userinput"><code>cfg_dir</code></strong>: this requests that you specify the name of a directory from which Nagios should integrate all configuration files ending in <strong class="userinput"><code>.cfg</code></strong> (files with other extensions are simply ignored). This also works recursively; Nagios thus evaluates all <strong class="userinput"><code>*.cfg</code></strong> files from all subdirectories. With the parameter <strong class="userinput"><code>cfg_dir</code></strong> you therefore only need to specify a signal directory, instead of calling all configuration files, with <strong class="userinput"><code>cfg_file</code></strong>, individually. The only restriction: these must be configuration files that describe objects. The configuration files <strong class="userinput"><code>cgi.cfg</code></strong> and <strong class="userinput"><code>resource.cfg</code></strong> are excluded from this, which is why, like the main configuration file <strong class="userinput"><code>nagios.cfg</code></strong>, they remain in the main directory <strong class="userinput"><code>/etc/nagios</code></strong>.<a class="indexterm" id="IDX-CHP-2-0093"/><a class="indexterm" id="IDX-CHP-2-0094"/><a class="indexterm" id="IDX-CHP-2-0095"/></p>

      <div class="sect2" title="Simple structure">
        <div class="titlepage">
          <h2 class="title" id="heading_id_4"><a id="simple_structure"/>Simple structure</h2>
        </div>

        <div class="sect3" title="Simple structure">
          <div class="titlepage">
            <h3 class="title" id="heading_id_5"><a id="simple_structure-id1"/>Simple structure</h3>
          </div>

          <p>For the object-specific configuration, it is best to create a directory called <strong class="userinput"><code>/etc/nagios/mysite</code></strong>, then remove all <strong class="userinput"><code>cfg_file</code></strong> directives in <strong class="userinput"><code>nagios.cfg</code></strong> (or comment them out with a <strong class="userinput"><code>#</code></strong> at the beginning of the line) and replace them with the following:<a class="indexterm" id="IDX-CHP-2-0096"/><a class="indexterm" id="IDX-CHP-2-0097"/><a class="indexterm" id="IDX-CHP-2-0098"/><a class="indexterm" id="IDX-CHP-2-0099"/><a class="indexterm" id="IDX-CHP-2-0100"/></p><a id="I_programlisting2_d1e2444"/>
          <pre class="programlisting">...
cfg_dir=/etc/nagios/mysite
...</pre>

          <p>The contents of the directory <strong class="userinput"><code>/etc/nagios</code></strong> will be version-independent and look like this:</p><a id="I_programlisting2_d1e2451"/>
          <pre class="programlisting">nagios@linux:/etc/nagios$ <span class="strong"><strong>tree</strong></span>
.
|-- nagios.cfg
|-- cgi.cfg
|-- resource.cfg
|-- htpasswd
'-- mysite
    |-- contactgroups.cfg
    |-- misccommands.cfg
    |-- contacts.cfg
    |-- timeperiods.cfg
    |-- checkcommands.cfg
    |-- hosts.cfg
    |-- services.cfg
    '-- hostgroups.cfg</pre>

          <p>The main directory <strong class="userinput"><code>/etc/nagios</code></strong> contains only three configuration files and the password file for protected Web access. Whether you collect all objects of the same type in one separate file, that is all host definitions in <strong class="userinput"><code>hosts.cfg</code></strong>, all services in <strong class="userinput"><code>services.cfg</code></strong>, and so on, or divide these into separate files, is left to the individual.</p>

          <p>In this example, only the top directory <strong class="userinput"><code>mysite</code></strong> needs to be integrated with <strong class="userinput"><code>cfg_dir</code></strong> in <strong class="userinput"><code>nagios.cfg</code></strong>. This forms the basis for our initial configuration.</p>
        </div>

        <div class="sect3" title="A larger location">
          <div class="titlepage">
            <h3 class="title" id="heading_id_6"><a id="a_larger_location"/>A larger location</h3>
          </div>

          <p>For larger installations, you should divide the object definitions into individual files (creating a separate file with the host definition for each host, for instance) and group these in subdirectories according to sensible criteria, as in the following example:</p><a id="I_programlisting2_d1e2483"/>
          <pre class="programlisting">...
'-- mysite
    |-- linux
    |   |-- services
    |   '-- hosts
    |   |-- linux01.cfg
    |   |-- linux02.cfg
    |   '-- linux03.cfg
    |-- windows
    |   |-- services
    |   '-- hosts
    |       |-- win03.cfg

    |       '-- win09.cfg
    '-- router
        |-- services
        '-- hosts
            |-- edge01.cfg
            |-- edge02.cfg
            '-- backbone.cfg</pre>

          <p>This example arranges the objects according to the operating system (<strong class="userinput"><code>linux</code></strong>, <strong class="userinput"><code>windows</code></strong>, and <strong class="userinput"><code>router</code></strong>). Each of these system directories has two further subdirectories: <strong class="userinput"><code>hosts</code></strong> and <strong class="userinput"><code>services</code></strong>.</p>

          <p>Each of the individual host objects are described in a separate file (for example <strong class="userinput"><code>linux01.cfg</code></strong>). These can easily be copied if you want to create other host objects with similar properties. You can copy services in a similar manner.</p>

          <p>The other object definitions are placed either directly in the directory <strong class="userinput"><code>my-site</code></strong>, as in the simple structure in <a class="xref" href="../Text/ch02.html#simple_structure" title="Simple structure">Simple structure</a>, or you can create subdirectories, as described in more detail in the next section.</p>

          <p>In <strong class="userinput"><code>nagios.cfg</code></strong> the object definitions are again bound with a single directive:</p><a id="I_programlisting2_d1e2519"/>
          <pre class="programlisting">cfg_dir=/etc/nagios/mysite</pre>
        </div>

        <div class="sect3" title="Large installations with several different locations">
          <div class="titlepage">
            <h3 class="title" id="heading_id_7"><a id="large_installations_with_several_differe"/>Large installations with several different locations</h3>
          </div>

          <p>For large installations, it is better to split up host and service objects according to location. Even for the remaining objects, we recommend that you split them up into individual files and group these into subdirectories:</p><a id="I_programlisting2_d1e2526"/>
          <pre class="programlisting">|-- global
|   |-- commands
|   |   |-- check-host-alive.cfg
|   |   |-- check_http.cfg
|   |   |-- check_icmp.cfg
... ... ...
|   |-- contacts
|   |   |-- nagios.cfg
|   |-- templates
|   |   |-- host_generic_t.cfg
|   |   |-- service_generic_t.cfg
|   |   |-- service_perfdata_t.cfg
... ... ...
|   '-- timeperiods
'-- sites
    |-- foreignsite
    |   |-- hosts
    | '-- services
    |-- mysite
    |   |-- hosts
    | '-- services
    '-- othersite
        |-- hosts
        '--services</pre>

          <p>In this example, the directory <strong class="userinput"><code>global</code></strong> gathers together all the objects that that do not themselves define a check (that is, everything that is not a host or service object). This is where the subdirectories <strong class="userinput"><code>commands</code></strong>, <strong class="userinput"><code>contacts</code></strong>, <strong class="userinput"><code>templates</code></strong>, and <strong class="userinput"><code>timeperiods</code></strong> are located, each of which contain the files for the object categories of the same name. For many command objects, individual files are easier to handle than one huge text file.</p>

          <p>If the contact objects are also stored in individual files, it is easy to disable a contact: the file extension is simply changed from <strong class="userinput"><code>.cfg</code></strong> to <strong class="userinput"><code>.cfx</code></strong> and then a reload is performed. Nagios ignores all files in object directories that do not end in <strong class="userinput"><code>.cfg</code></strong>. The overlying directories <strong class="userinput"><code>global</code></strong> and <strong class="userinput"><code>sites</code></strong> are bound into <strong class="userinput"><code>nagios.cfg</code></strong>:</p><a id="I_programlisting2_d1e2566"/>
          <pre class="programlisting">cfg_dir=/etc/nagios/global
cfg_dir=/etc/nagios/sites</pre>
        </div>

        <div class="sect3" title="Setting the European date format">
          <div class="titlepage">
            <h3 class="title" id="heading_id_8"><a id="setting_the_european_date_format"/>Setting the European date format</h3>
          </div>

          <p>The date specifications in Nagios appear by default in the American format <strong class="userinput"><code><em class="replaceable"><code>MM-DD -YYYY</code></em></code></strong>:<a class="indexterm" id="IDX-CHP-2-0101"/></p><a id="I_programlisting2_d1e2582"/>
          <pre class="programlisting">date_format=us</pre>

          <p>If you prefer something else, e.g., the European date format, it is recommended that you change the parameter <strong class="userinput"><code>date_format</code></strong> in <strong class="userinput"><code>nagios.cfg</code></strong> right from the start. The value <strong class="userinput"><code>iso8601</code></strong> ensures that Nagios date specifications are displayed in the ISO or DIN format <strong class="userinput"><code><em class="replaceable"><code>YYYY-MM-DD HH-.MM: SS</code></em></code></strong>. <a class="xref" href="../Text/ch02.html#possible_date_format" title="Table 2-1. Possible date format">Table 2-1</a> lists the possible values for <strong class="userinput"><code>date_format</code></strong>.<a class="indexterm" id="IDX-CHP-2-0102"/></p>

          <p>The other parameters in <strong class="userinput"><code>nagios.cfg</code></strong> are described in <a class="xref" href="../Text/apa.html#an_overview_of_the_nagios_configuration" title="A.1 The Main Configuration File nagios.cfg">A.1 The Main Configuration File nagios.cfg</a>; in the original documentation these can be found at <a class="ulink" href="http://localhost/nagios/docs/configmain.html">http://localhost/nagios/docs/configmain.html</a> or <strong class="userinput"><code>/usr/local/nagios/share/docs/config-main.html</code></strong>."</p>

          <div class="table">
            <a id="possible_date_format"/>

            <p class="title">Table 2-1. Possible date format</p>

            <div class="table-contents">
              <table class="sgc-3" summary="Possible date format">
                <colgroup>
                  <col/>
                  <col/>
                </colgroup>

                <thead>
                  <tr>
                    <th class="sgc-1" valign="bottom">
                      <p>Value</p>
                    </th>

                    <th class="sgc-1" valign="bottom">
                      <p>Representation</p>
                    </th>
                  </tr>
                </thead>

                <tbody>
                  <tr>
                    <td class="sgc-2" valign="top">
                      <p><strong class="userinput"><code>us</code></strong></p>
                    </td>

                    <td class="sgc-2" valign="top">
                      <p><span class="emphasis"><em>MM-DD-YYYY HH:MM:SS</em></span></p>
                    </td>
                  </tr>

                  <tr>
                    <td class="sgc-2" valign="top">
                      <p><strong class="userinput"><code>euro</code></strong></p>
                    </td>

                    <td class="sgc-2" valign="top">
                      <p><span class="emphasis"><em>DD-MM-YYYY HH:MM:SS</em></span></p>
                    </td>
                  </tr>

                  <tr>
                    <td class="sgc-2" valign="top">
                      <p><strong class="userinput"><code>iso8601</code></strong></p>
                    </td>

                    <td class="sgc-2" valign="top">
                      <p><span class="emphasis"><em>YYYY-MM-DD HH:MM:SS</em></span></p>
                    </td>
                  </tr>

                  <tr>
                    <td class="sgc-2" valign="top">
                      <p><strong class="userinput"><code>strict-iso8601</code></strong></p>
                    </td>

                    <td class="sgc-2" valign="top">
                      <p><span class="emphasis"><em>YYYY-MM-DDTHH:MM:SS</em></span></p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="footnotes">
      <br/>
      <hr/>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-2-FN-1" id="ftn.CHP-2-FN-1">31</a>]</sup> <a class="ulink" href="http://mama.indstate.edu/users/ice/tree/">http://mama.indstate.edu/users/ice/tree/</a></p>
      </div>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-2-FN-2" id="ftn.CHP-2-FN-2">32</a>]</sup> If Nagios is from a distribution package, it is worth checking at least the path details. In a well-maintained distribution these will also be matched to the Nagios directories used there.</p>
      </div>
    </div>
  </div>


  <div class="sect1" title="2.2 Objects&#x2014;an Overview">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="objects_an_overview"/>2.2 Objects—an Overview</h1>
    </div>

    <p>A Nagios object describes a specific unit: a host, a service, a contact, or the groups to which each belongs. Even commands are defined as objects. This definition has not come about by chance. Nagios is also able to inherit characteristics (<a class="xref" href="../Text/ch02s11.html" title="2.11 Templates">2.11 Templates</a> from page 75).<a class="indexterm" id="IDX-CHP-2-0103"/><a class="indexterm" id="IDX-CHP-2-0104"/><a class="indexterm" id="IDX-CHP-2-0105"/><a class="indexterm" id="IDX-CHP-2-0106"/><a class="indexterm" id="IDX-CHP-2-0107"/><a class="indexterm" id="IDX-CHP-2-0108"/><a class="indexterm" id="IDX-CHP-2-0109"/><a class="indexterm" id="IDX-CHP-2-0110"/><a class="indexterm" id="IDX-CHP-2-0111"/><a class="indexterm" id="IDX-CHP-2-0112"/><a class="indexterm" id="IDX-CHP-2-0113"/><a class="indexterm" id="IDX-CHP-2-0114"/><a class="indexterm" id="IDX-CHP-2-0115"/><a class="indexterm" id="IDX-CHP-2-0116"/><a class="indexterm" id="IDX-CHP-2-0117"/><a class="indexterm" id="IDX-CHP-2-0118"/><a class="indexterm" id="IDX-CHP-2-0119"/><a class="indexterm" id="IDX-CHP-2-0120"/><a class="indexterm" id="IDX-CHP-2-0121"/><a class="indexterm" id="IDX-CHP-2-0122"/><a class="indexterm" id="IDX-CHP-2-0123"/><a class="indexterm" id="IDX-CHP-2-0124"/></p>

    <p>Object definitions follow the following pattern:</p><a id="I_programlisting2_d1e2759"/>
    <pre class="programlisting">define <span class="emphasis"><em>object-type</em></span> {
<span class="emphasis"><em>   parameter value</em></span>
<span class="emphasis"><em>   parameter value</em></span>
   ...
}</pre>

    <p>Nagios has the following values for the <strong class="userinput"><code><em class="replaceable"><code>object-type</code></em></code></strong>:</p>

    <div class="variablelist">
      <dl>
        <dt><span class="term"><strong class="userinput"><code>host</code></strong></span></dt>

        <dd>
          <p>The host object describes one of the network nodes that are to be monitored. Nagios expects the IP address as a parameter here (or the <span class="emphasis"><em>Fully Qualified Domain Name</em></span>) and the command that should define whether the host is alive (see <a class="xref" href="../Text/ch02s03.html" title="2.3 Defining the Machines to Be Monitored, with host">2.3 Defining the Machines to Be Monitored, with host</a>, page 62). The host definition is re-referenced in the service definition.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>hostgroup</code></strong></span></dt>

        <dd>
          <p>Several hosts can be combined into a group (see <a class="xref" href="../Text/ch02s04.html" title="2.4 Grouping Computers Together with hostgroup">2.4 Grouping Computers Together with hostgroup</a> in page 65). This simplifies configuration, since entire host groups instead of single hosts can be specified when defining services (the service will then exist for each member of the group). In addition, Nagios represents the hosts of a host group together in a table in the Web front end, which helps to increase clarity.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>service</code></strong></span></dt>

        <dd>
          <p>The individual services to be monitored are defined as service objects (<a class="xref" href="../Text/ch02s05.html" title="2.5 Defining Services to Be Monitored with service">2.5 Defining Services to Be Monitored with service</a>, page 66). A service never exists independently of a host. So it is quite possible to have several services with the same name, as long as they belong to different hosts. The following code,</p><a id="I_programlisting2_d1e2807"/>
          <pre class="programlisting">define service {
   name PING
   host_name linux01
   ...
}
define service {
   name PING
   host_name linux03
}</pre>

          <p>describes two services that both have the same service name but belong to different hosts. So in the language of Nagios, a service is always a host-service pair.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>servicegroup</code></strong></span></dt>

        <dd>
          <p>As it does with host groups, Nagios combines several services and represents these in the Web front end as a unit with its own table (see <a class="xref" href="../Text/ch02s06.html" title="2.6 Grouping Services Together with servicegroup">2.6 Grouping Services Together with servicegroup</a>, page 69). Service groups are not absolutely essential, but help to improve clarity, and are also used in reporting.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>contact</code></strong></span></dt>

        <dd>
          <p>A person who is to be informed by Nagios of specific events (see <a class="xref" href="../Text/ch02s07.html" title="2.7 Defining Addressees for Error Messages: contact">2.7 Defining Addressees for Error Messages: contact</a>, page 70). Nagios uses contact objects to show to a user via the Web front end only those things for which the user is listed as a contact person. In the basic setting users do not get to see hosts and services for which they are not responsible.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>contactgroup</code></strong></span></dt>

        <dd>
          <p>Notification of events in hosts and services takes place via the contact group (<a class="xref" href="../Text/ch02s08.html" title="2.8 The Message Recipient: contactgroup">2.8 The Message Recipient: contactgroup</a>, page 72). A direct link between the host/service and a contact person is not possible.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>timeperiod</code></strong></span></dt>

        <dd>
          <p>Describes a time period within which Nagios should inform contact groups (<a class="xref" href="../Text/ch02s10.html" title="2.10 Defining a Time Period with timeperiod">2.10 Defining a Time Period with timeperiod</a>, page 74). Outside such a time slot, the system will not send any messages. The messaging chain can be fine-tuned via various <span class="emphasis"><em>time periods</em></span>, depending on the host/service and contact/contact groups. More on this will be presented in <a class="xref" href="../Text/ch12s03.html" title="12.3 The Message Filter">12.3 The Message Filter</a>, page 267.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>command</code></strong></span></dt>

        <dd>
          <p>Nagios always calls external programs via command objects (<a class="xref" href="../Text/ch02s09.html" title="2.9 When Nagios Needs to Do Something: The command Object">2.9 When Nagios Needs to Do Something: The command Object</a>, page 72). Apart from plugins, messaging programs also include e-mail or SMS messaging applications.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>servicedependency</code></strong></span></dt>

        <dd>
          <p>This object type describes dependences between services. If, for example, an application does not function without a database, a corresponding dependency object will ensure that Nagios will represent the failed database as the primary problem instead of just announcing the nonfunctioning of the application (see <a class="xref" href="../Text/ch12s06.html" title="12.6 Accounting for Dependencies between Hosts and Services">12.6 Accounting for Dependencies between Hosts and Services</a>, page 285).</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>serviceescalation</code></strong></span></dt>

        <dd>
          <p>Used to define proper escalation management: if a service is not available after a specific time period, Nagios informs a further or different circle of people. This can also be configured on multiple levels in any way you want (see <a class="xref" href="../Text/ch12s05.html" title="12.5 Escalation Management">12.5 Escalation Management</a>).</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>hostdependency</code></strong></span></dt>

        <dd>
          <p>Like <strong class="userinput"><code>servicedependency</code></strong>, but for hosts.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>hostescalation</code></strong></span></dt>

        <dd>
          <p>Like <strong class="userinput"><code>serviceescalation</code></strong>, but for hosts.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>hostextinfo</code></strong> (Nagios 2.x)</span></dt>

        <dd>
          <p><span class="emphasis"><em>Extended Host Information</em></span> objects are optional and define a specific graphic and/or URL, which Nagios additionally integrates into its graphic output. The URL can refer to a Web page that provides additional information on the host (see <a class="xref" href="../Text/ch16s04.html" title="16.4 Additional Information on Hosts and Services">16.4 Additional Information on Hosts and Services</a>, page 362).</p>

          <p><strong class="userinput"><code>hostextinfo</code></strong> This object is deprecated in Nagios 3.0, but it is still available. Nagios 3.0 integrated the object parameters into the host definition.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>serviceextinfo</code></strong> (Nagios 2.x)</span></dt>

        <dd>
          <p><span class="emphasis"><em>Extended Service Information</em></span>, like <span class="emphasis"><em>Extended Host Information</em></span>.</p>
        </dd>
      </dl>
    </div>

    <p>Not all object types are absolutely essential; especially at the beginning. You easily can do without the <strong class="userinput"><code>*dependency</code></strong>, <strong class="userinput"><code>*escalation</code></strong>, and <strong class="userinput"><code>*extinfo</code></strong> objects, as well as the <strong class="userinput"><code>servicegroup</code></strong>. <a class="xref" href="../Text/ch12.html" title="Chapter 12. The Nagios Notification System">Chapter 12</a> looks at escalation and dependencies in detail. <strong class="userinput"><code>hostextinfo</code></strong> and <strong class="userinput"><code>serviceextinfo</code></strong> are used to provide a "more colorful" graphical representation, but they are not at all necessary for running Nagios. <a class="xref" href="../Text/ch16s04.html" title="16.4 Additional Information on Hosts and Services">16.4 Additional Information on Hosts and Services</a> from page 362 looks at this in more detail. The original documentation also provides more information.<sup>[<a class="footnote" href="#ftn.CHP-2-FN-3" id="CHP-2-FN-3">33</a>]</sup></p>

    <div class="sect2" title="Notes on the object examples below">
      <div class="titlepage">
        <h2 class="title" id="heading_id_3"><a id="notes_on_the_object_examples_below-id1"/>Notes on the object examples below</h2>
      </div>

      <div class="sect3" title="Notes on the object examples below">
        <div class="titlepage">
          <h3 class="title" id="heading_id_4"><a id="notes_on_the_object_examples_below"/>Notes on the object examples below</h3>
        </div>

        <p>Although the following chapters describe individual object types in detail, only the mandatory parameters and those that are absolutely essential for meaningful operation are described there. Mandatory parameters here are always printed in <span class="strong"><strong>bold</strong></span> type. The first (comment) line in each example lists the file in which the recorded object definition is to be stored. For the parameters marked with (*), there are some differences between Nagios 2.x and Nagios 3.0, each of which will be explained in more depth in the text.<a class="indexterm" id="IDX-CHP-2-0126"/><a class="indexterm" id="IDX-CHP-2-0127"/><a class="indexterm" id="IDX-CHP-2-0125"/></p>

        <p>When you first start using Nagios, it is recommended that you restrict yourself to a minimal configuration with only one or two objects per object type, in order to keep potential sources of error to a minimum and to obtain a running system as quickly as possible. Afterwards extensions can be implemented very simply and quickly, especially if you incorporate the tips mentioned in <a class="xref" href="../Text/ch02s11.html" title="2.11 Templates">2.11 Templates</a> in templates (page 75).</p>

        <p>Time details in general refer to time units. A time unit consists of 60 seconds by default. It can be set to a different value in the configuration file <strong class="userinput"><code>nagios.cfg</code></strong>, using the parameter <strong class="userinput"><code>interval_length</code></strong>. You should really change this parameter only if you know exactly what you are doing.<a class="indexterm" id="IDX-CHP-2-0128"/></p>
      </div>
    </div>

    <div class="footnotes">
      <br/>
      <hr/>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-2-FN-3" id="ftn.CHP-2-FN-3">33</a>]</sup> <a class="ulink" href="http://localhost/nagios/docs/objectdefinitions.html#hostextinfo">http://localhost/nagios/docs/objectdefinitions.html#hostextinfo</a> or <strong class="userinput"><code>#serviceextinfo</code></strong> (Nagios 3.0)</p>

        <p><a class="ulink" href="http://localhost/nagios/docs/xodtemplate.html#hostextinfo">http://localhost/nagios/docs/xodtemplate.html#hostextinfo</a> or <strong class="userinput"><code>#ser-viceextinfo</code></strong> (Nagios 2.x); the files can be found locally in <strong class="userinput"><code>/usr/local/nagios/share/docs/</code></strong>.</p>
      </div>
    </div>
  </div>


  <div class="sect1" title="2.3 Defining the Machines to Be Monitored, with host">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="defining_the_machines_to_be_monitored_co"/>2.3 Defining the Machines to Be Monitored, with <strong class="userinput"><code>host</code></strong></h1>
    </div>

    <p>The host object is the central command post on which all host and service checks are based. It defines the machine to be monitored. The parameters printed in bold must be specified in all cases:<a class="indexterm" id="IDX-CHP-2-0129"/><a class="indexterm" id="IDX-CHP-2-0130"/><a class="indexterm" id="IDX-CHP-2-0131"/><a class="indexterm" id="IDX-CHP-2-0132"/><a class="indexterm" id="IDX-CHP-2-0133"/><a class="indexterm" id="IDX-CHP-2-0134"/><a class="indexterm" id="IDX-CHP-2-0135"/><a class="indexterm" id="IDX-CHP-2-0136"/><a class="indexterm" id="IDX-CHP-2-0137"/><a class="indexterm" id="IDX-CHP-2-0138"/><a class="indexterm" id="IDX-CHP-2-0139"/><a class="indexterm" id="IDX-CHP-2-0140"/></p><a id="I_programlisting2_d1e3056"/>
    <pre class="programlisting"># -- /etc/nagios/mysite/hosts.cfg
define host{
<span class="strong"><strong>   host_name</strong></span>                   linux01
   hostgroups                      linux-servers
<span class="strong"><strong>   alias</strong></span>(*)           Linux File Server
<span class="strong"><strong>   address</strong></span>                     192.168.1.9
   check_command                   check-host-alive
<span class="strong"><strong>   max_check_attempts</strong></span>          3
<span class="strong"><strong>   check_period</strong></span>                24×7
<span class="strong"><strong>   contact_groups</strong></span>              localadmins
<span class="strong"><strong>   notification_interval</strong></span>       120
<span class="strong"><strong>   notification_period</strong></span>         24×7
<span class="strong"><strong>   notification_options</strong></span>        d,u,r,f,s(*)
   parents                         router01
}</pre>

    <div class="variablelist">
      <dl>
        <dt><span class="term"><strong class="userinput"><code>host_name</code></strong></span></dt>

        <dd>
          <p>This parameter specifies the host name with which Nagios addresses the machine in services, host groups, and other objects. Only the special characters <strong class="userinput"><code>-</code></strong> and <strong class="userinput"><code>_</code></strong> are allowed.<a class="indexterm" id="IDX-CHP-2-0141"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>hostgroups</code></strong></span></dt>

        <dd>
          <p>This parameter allocates the host to a host group object, which must already be defined (<a class="xref" href="../Text/ch02s04.html" title="2.4 Grouping Computers Together with hostgroup">2.4 Grouping Computers Together with hostgroup</a>, page 65). A host group in the Web interface combines several hosts into a group (see <a class="xref" href="../Text/ch16s02.html#the_overview_output_style" title="Figure 16-10. The overview output style">Figure 16-10</a> in page 334). The second possibility of assigning a host to a host group, compatible with version 1.x, uses the <strong class="userinput"><code>members</code></strong> parameter in defining the host group itself. The two methods can also be combined.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>alias</code></strong></span></dt>

        <dd>
          <p>This parameter contains a short description of the host, which Nagios displays at various locations as additional information. Ordinary text is allowed here. The parameter is no longer obligatory from Nagios 3.0. If it is missing, the value from <strong class="userinput"><code>host_name</code></strong> is used.<a class="indexterm" id="IDX-CHP-2-0142"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>address</code></strong></span></dt>

        <dd>
          <p>This specifies the IP address or the <span class="emphasis"><em>Fully Qualified Domain Name</em></span> (FQDN) of the computer. If it is possible (i.e., for static IP addresses), you should use an IP address, since the resolution of a name to an IP address is always dependent on DNS working, which is not infallible.<a class="indexterm" id="IDX-CHP-2-0143"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>check_command</code></strong></span></dt>

        <dd>
          <p>This specifies the command with which Nagios checks, if necessary, to see whether the host is reachable. The parameter is optional. If it is omitted, Nagios will never carry out a host check! This can be useful for network components that are frequently switched off (for example, print servers).<a class="indexterm" id="IDX-CHP-2-0144"/><a class="indexterm" id="IDX-CHP-2-0145"/></p>

          <p>The command usually used for <strong class="userinput"><code>check_command</code></strong> is called <strong class="userinput"><code>check-host -alive</code></strong>, which is already predefined in the supplied file, <strong class="userinput"><code>checkcom-mands.cfg</code></strong> (see <a class="xref" href="../Text/ch02s09.html" title="2.9 When Nagios Needs to Do Something: The command Object">2.9 When Nagios Needs to Do Something: The command Object</a>, page 72). This makes use of either the plugin <strong class="userinput"><code>check_ping</code></strong> or the more modern <strong class="userinput"><code>check_icmp</code></strong>. Both plugins check the reachability of the host via the ICMP packets <span class="emphasis"><em>ICMP Echo Request</em></span> and <span class="emphasis"><em>Echo Reply</em></span>.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>max_check_attempts</code></strong></span></dt>

        <dd>
          <p>This parameter determines how often Nagios should try to reach the computer if the first test has gone wrong. The value <strong class="userinput"><code>3</code></strong> in the example means that the test is repeated up to three times if it returns anything other than OK in the first test. As long as there are still repeat tests to be made, Nagios refers to this as a <span class="emphasis"><em>soft state</em></span>. If the final test has been made, the system categorizes the state as <span class="emphasis"><em>hard</em></span>. Nagios notifies the system administrator exclusively of hard states, and in the example, sends messages only if the third test also ends with an error or warning.<a class="indexterm" id="IDX-CHP-2-0147"/><a class="indexterm" id="IDX-CHP-2-0146"/><a class="indexterm" id="IDX-CHP-2-0148"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>check_period</code></strong></span></dt>

        <dd>
          <p>This specifies the time period in which the host should be monitored. Really, only "round the clock" makes sense—that is, <strong class="userinput"><code>24×7</code></strong>. A <strong class="userinput"><code>timeperiod</code></strong> object is involved here, the definition of which is described in more detail in <a class="xref" href="../Text/ch02s10.html" title="2.10 Defining a Time Period with timeperiod">2.10 Defining a Time Period with timeperiod</a> in page 74. It only makes sense to use a specification other than <strong class="userinput"><code>24×7</code></strong> if you want to explicitly suppress the host check at certain times.<a class="indexterm" id="IDX-CHP-2-0149"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>contact_groups</code></strong></span></dt>

        <dd>
          <p>This specifies the receiver of messages which Nagios sends with respect to the hosts defined here, that is <strong class="userinput"><code>localadmin</code></strong>. <a class="xref" href="../Text/ch02s08.html" title="2.8 The Message Recipient: contactgroup">2.8 The Message Recipient: contactgroup</a> explains this more fully in page 72.<a class="indexterm" id="IDX-CHP-2-0150"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>notification_interval</code></strong></span></dt>

        <dd>
          <p>This specifies at what intervals Nagios should repeat notification of the continued existence of the state. 120 time units normally mean one message every 120 minutes, provided the error state continues.<a class="indexterm" id="IDX-CHP-2-0151"/><a class="indexterm" id="IDX-CHP-2-0152"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>notification_period</code></strong></span></dt>

        <dd>
          <p>This specifies at what time interval a message should be sent. A time period different from <strong class="userinput"><code>24×7</code></strong> could certainly be useful here. It is important to understand the difference here with <strong class="userinput"><code>check_period</code></strong>: if <strong class="userinput"><code>check_period</code></strong> excludes time periods, Nagios cannot even determine whether there is an error or not. But if the host is monitored round-the-clock and only the notification period is restricted by the parameter <strong class="userinput"><code>notification_period</code></strong>, Nagios will certainly log errors and also display them in the Web front end and in log evaluations. Outside the <strong class="userinput"><code>notification_period</code></strong> the system does not send any messages. A more detailed description of the notification system is given in <a class="xref" href="../Text/ch12s03.html" title="12.3 The Message Filter">12.3 The Message Filter</a>, page 267.<a class="indexterm" id="IDX-CHP-2-0153"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>notification_options</code></strong></span></dt>

        <dd>
          <p>This parameter describes the states about which Nagios should provide notification when they occur. Nagios knows the following states for computers:<a class="indexterm" id="IDX-CHP-2-0154"/></p>

          <div class="informaltable">
            <table class="sgc-2">
              <colgroup>
                <col/>
                <col/>
              </colgroup>

              <tbody>
                <tr>
                  <td class="sgc-1" valign="top">
                    <p><strong class="userinput"><code>d</code></strong></p>
                  </td>

                  <td class="sgc-1" valign="top">
                    <p>down</p>
                  </td>
                </tr>

                <tr>
                  <td class="sgc-1" valign="top">
                    <p><strong class="userinput"><code>u</code></strong></p>
                  </td>

                  <td class="sgc-1" valign="top">
                    <p>unreachable (host is not reachable because a network node between Nagios and a host has failed and the actual state of the host cannot be determined)</p>
                  </td>
                </tr>

                <tr>
                  <td class="sgc-1" valign="top">
                    <p><strong class="userinput"><code>r</code></strong></p>
                  </td>

                  <td class="sgc-1" valign="top">
                    <p>recovery (OK state after an error)</p>
                  </td>
                </tr>

                <tr>
                  <td class="sgc-1" valign="top">
                    <p><strong class="userinput"><code>f</code></strong></p>
                  </td>

                  <td class="sgc-1" valign="top">
                    <p>flapping (state changes very quickly; more on this in <a class="xref" href="../Text/apb.html" title="Appendix B. Rapidly Alternating States: Flapping">Appendix B</a> from page 611).</p>
                  </td>
                </tr>

                <tr>
                  <td class="sgc-1" valign="top">
                    <p><strong class="userinput"><code>s</code></strong></p>
                  </td>

                  <td class="sgc-1" valign="top">
                    <p>scheduled downtime (Nagios 3.0 provides information here on the start and end of a planned maintenance period, or in case a planned maintenance period is canceled. This option is not available for Nagios 2.x.)</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <p>By specifying <strong class="userinput"><code>d</code></strong>, <strong class="userinput"><code>u</code></strong>, the system will send messages if the host is not on the network or not reachable over the network, but not if it can be reached again after an error state (recovery). If <strong class="userinput"><code>n</code></strong> (none) is used as the value, Nagios will normally not give any notification.</p>

          <p>The form in which Nagios sends out a message depends on how the contact is defined. Irrespective of when you want to be notified, the Web interface always shows the current state, even if Nagios does not send a message, because the time period does not match or the system is still repeating the tests (the so-called soft state).</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>parents</code></strong></span></dt>

        <dd>
          <p>This allows the physical topology of the network to be taken into account. Here the router or the network component is given by which the host is reachable if it is not in direct contact in the same network segment. This can also be a switch between the Nagios server and the host. If Nagios does not reach the host because all parents (separated by commas) are down, then Nagios categorizes it as UNREACHABLE, but not as DOWN.<a class="indexterm" id="IDX-CHP-2-0155"/></p>
        </dd>
      </dl>
    </div>

    <p>Further information is provided by the Nagios 3.0 online help under <a class="ulink" href="http://localhost/nagios/docs//objectdefinitions.html#host">http://localhost/nagios/docs//objectdefinitions.html#host</a>.<sup>[<a class="footnote" href="#ftn.CHP-2-FN-4" id="CHP-2-FN-4">34</a>]</sup> In Nagios 2.x the file is called <strong class="userinput"><code>xodtemplate.html</code></strong> and can be found in the same directory. The differences between Nagios 2.x and Nagios 3.0 are described in <a class="xref" href="../Text/aph.html#the_host_object" title="H.1.1 The host object">H.1.1 The host object</a>, page 678.</p>

    <div class="footnotes">
      <br/>
      <hr/>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-2-FN-4" id="ftn.CHP-2-FN-4">34</a>]</sup> Locally in <strong class="userinput"><code>/usr/local/nagios/share/docs/objectdefinitions.html</code></strong>.</p>
      </div>
    </div>
  </div>


  <div class="sect1" title="2.4 Grouping Computers Together with hostgroup">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="grouping_computers_together_with_hostgro"/>2.4 Grouping Computers Together with <strong class="userinput"><code>hostgroup</code></strong></h1>
    </div>

    <p>A host group contains one or more computers so that they can be represented in the Web interface together (see <a class="xref" href="../Text/ch16s02.html#the_overview_output_style" title="Figure 16-10. The overview output style">Figure 16-10</a> in page 334)—in addition, certain objects (e.g., services) can be applied to an entire group of computers instead of having to define them individually for each host.<a class="indexterm" id="IDX-CHP-2-0156"/><a class="indexterm" id="IDX-CHP-2-0157"/><a class="indexterm" id="IDX-CHP-2-0158"/><a class="indexterm" id="IDX-CHP-2-0159"/><a class="indexterm" id="IDX-CHP-2-0160"/><a class="indexterm" id="IDX-CHP-2-0161"/></p>

    <p>The <strong class="userinput"><code>hostgroup_name</code></strong> parameter specifies a unique name for the group, alias accepts a short description. The <strong class="userinput"><code>members</code></strong> parameter lists all hosts names belonging to the group, separated by commas:<a class="indexterm" id="IDX-CHP-2-0162"/><a class="indexterm" id="IDX-CHP-2-0163"/><a class="indexterm" id="IDX-CHP-2-0164"/></p><a id="I_programlisting2_d1e3435"/>
    <pre class="programlisting"># -- /etc/nagios/mysite/hostgroups.cfg
define hostgroup{
<span class="strong"><strong>    hostgroup_name</strong></span>           linux-servers
<span class="strong"><strong>    alias</strong></span>                    Linux Servers
    members                      linux01,linux02
    hostgroup_members(*) hostgroup1,hostgroup2
}</pre>

    <p>If you specify to which group they belong in the host definition for individual member computers, with the parameter <strong class="userinput"><code>hostgroups</code></strong> (<a class="xref" href="../Text/ch02s03.html" title="2.3 Defining the Machines to Be Monitored, with host">2.3 Defining the Machines to Be Monitored, with host</a>), the <strong class="userinput"><code>members</code></strong> entry may be omitted from version 2.0. This means that you no longer have two search through all group definitions if you just want to delete a single host. The combined use—of <strong class="userinput"><code>members</code></strong> in the <strong class="userinput"><code>hostgroup</code></strong> object and at the same time, of <strong class="userinput"><code>hostgroups</code></strong> in the <strong class="userinput"><code>host</code></strong> object—is equally possible. A new host group in Nagios 3.0 is <strong class="userinput"><code>hostgroup_members</code></strong>, with which you can specify other host groups as members, and thus form hierarchies of host groups. This option is not available in Nagios 2.0.</p>
  </div>


  <div class="sect1" title="2.5 Defining Services to Be Monitored with service">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="defining_services_to_be_monitored_with"/>2.5 Defining Services to Be Monitored with <strong class="userinput"><code>service</code></strong></h1>
    </div>

    <p>A service in Nagios always consists of the combination of a host and a service name. This combination must be unique. Service names, on the other hand, may occur many times, as long as they are combined with different hosts.<a class="indexterm" id="IDX-CHP-2-0165"/><a class="indexterm" id="IDX-CHP-2-0166"/><a class="indexterm" id="IDX-CHP-2-0167"/><a class="indexterm" id="IDX-CHP-2-0168"/><a class="indexterm" id="IDX-CHP-2-0169"/><a class="indexterm" id="IDX-CHP-2-0170"/><a class="indexterm" id="IDX-CHP-2-0171"/><a class="indexterm" id="IDX-CHP-2-0172"/><a class="indexterm" id="IDX-CHP-2-0173"/><a class="indexterm" id="IDX-CHP-2-0174"/><a class="indexterm" id="IDX-CHP-2-0175"/><a class="indexterm" id="IDX-CHP-2-0176"/></p>

    <p>The simplest service consists of a simple ping, which tests whether the relevant host is reachable, and which registers the response time and any packet loss that may occur:<a class="indexterm" id="IDX-CHP-2-0177"/></p><a id="I_programlisting2_d1e3526"/>
    <pre class="programlisting"># -- /etc/nagios/mysite/services.cfg
define service{
<span class="strong"><strong>   host_name</strong></span>                         linux01
<span class="strong"><strong>   service_description</strong></span>               PING
<span class="strong"><strong>   check_command</strong></span>                     check_ping!100.0,20%!500.0,60%
<span class="strong"><strong>   max_check_attempts</strong></span>                3
<span class="strong"><strong>   normal_check_interval</strong></span>(*)          5
<span class="strong"><strong>   retry_check_interval</strong></span>(*)           1
<span class="strong"><strong>   check_period</strong></span>                      24×7
<span class="strong"><strong>   notification_interval</strong></span>             120
<span class="strong"><strong>   notification_period</strong></span>(*)            24×7
<span class="strong"><strong>   notification_options</strong></span>              w, u, c, r, f, s(*)
<span class="strong"><strong>   contact_groups</strong></span>(*)                 localadmins
}</pre>

    <p>In contrast to a host check, which Nagios carries out only if it cannot reach any other service of the host, a ping service is carried out at regular intervals. Problems in the network can be detected relatively simply through response times and packet loss rates. The host check is less suitable for this purpose.</p>

    <div class="variablelist">
      <dl>
        <dt><span class="term"><strong class="userinput"><code>host_name</code></strong></span></dt>

        <dd>
          <p>This refers to the name defined in the host object. Nagios also obtains the IP address of the computer via this. Instead of a single host name, you can also enter a comma-separated list of multiple hosts. As an alternative to <strong class="userinput"><code>host_name</code></strong>, it is also possible to use the parameter <strong class="userinput"><code>hostgroup_name</code></strong> to specify an entire host group instead of individual hosts. The service is then considered to be defined for each of the individual computers groups together in this way. Whether you make use of this optimization, or allocate your own service definitions to each computer individually, makes no difference to Nagios.<a class="indexterm" id="IDX-CHP-2-0178"/><a class="indexterm" id="IDX-CHP-2-0179"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>service_description</code></strong></span></dt>

        <dd>
          <p>This parameter defines the actual name of the service. Spaces, colons, and dashes may be included in the name. Nagios always addresses a service as a combination of host name (here: <strong class="userinput"><code>linux01</code></strong>) and service description (<strong class="userinput"><code>PING</code></strong>). This must be unique.<a class="indexterm" id="IDX-CHP-2-0180"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>servicegroups</code></strong></span></dt>

        <dd>
          <p>assigns the service to a service group object that must already be defined (<a class="xref" href="../Text/ch02s06.html" title="2.6 Grouping Services Together with servicegroup">2.6 Grouping Services Together with servicegroup</a>, page 69).</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>check_command</code></strong></span></dt>

        <dd>
          <p>This defines the command with which Nagios tests the service for functionality Arguments are passed on to the actual command, ie. <strong class="userinput"><code>check_ping</code></strong>, separated by exclamation marks. The definition of the <strong class="userinput"><code>check_ping</code></strong> command, predefined in the example files, is explained in <a class="xref" href="../Text/ch02s09.html" title="2.9 When Nagios Needs to Do Something: The command Object">2.9 When Nagios Needs to Do Something: The command Object</a> in page 72.<a class="indexterm" id="IDX-CHP-2-0181"/></p>

          <p>In the example, the values for the warning limit (<strong class="userinput"><code>100 ms, 20%</code></strong>) and for the CRITICAL status (<strong class="userinput"><code>500 ms, 60%</code></strong>) are determined. You could compare this to a traffic light: the state OK (green) occurs if the response time remains under the warning limit of 100 milliseconds, and if none or less than 20 percent of packets have been lost. The WARNING state (yellow) occurs if the packet loss or response time lies above the defined warning limit, but still beneath the critical limit. Above the critical limit, Nagios issues a CRITICAL state (red). The return value of the plugin is described at the beginning of <a class="xref" href="../Text/ch06.html" title="Chapter 6. Plugins for Network Services">Chapter 6</a> (page 6), the underlying plugin <strong class="userinput"><code>check_icmp</code></strong> is introduced in detail in <a class="xref" href="../Text/ch06s02.html" title="6.2 Reachability Test with Ping">6.2 Reachability Test with Ping</a> from page 108.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>max_check_attempts</code></strong></span></dt>

        <dd>
          <p>This specifies how often Nagios should repeat a test in order to verify and definitively accept an error state which has been discovered (or also the recovered functionality), that is, to recognize it as a <span class="emphasis"><em>hard state</em></span>. In the transitional phase (for example from OK to CRITICAL) we speak of a <span class="emphasis"><em>soft state</em></span>. Basic distinctions between soft and hard are only made by the Nagios notification system, which is why the two states are described in more detail in the context of this system (<a class="xref" href="../Text/ch12.html" title="Chapter 12. The Nagios Notification System">Chapter 12</a>, page 265). The difference has no influence in the representation in the Web interface.<a class="indexterm" id="IDX-CHP-2-0183"/><a class="indexterm" id="IDX-CHP-2-0182"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>normal_check_interval</code></strong></span></dt>

        <dd>
          <p>This specifies at what interval Nagios should test the service when the system is in a stable condition—this can equally be an OK or an error state. In the example this is five time units, which is normally five minutes. In Nagios 3.0 the parameter may also be written as <strong class="userinput"><code>check_interval</code></strong>; as for the host definition, both forms are equivalent.<a class="indexterm" id="IDX-CHP-2-0184"/><a class="indexterm" id="IDX-CHP-2-0185"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>retry_check_interval</code></strong></span></dt>

        <dd>
          <p>This describes the time interval between two tests when the state is in the process of changing (for example, from OK to WARNING), that is, when there is a soft state. In Nagios 3.0 the parameter may also be written as <strong class="userinput"><code>retry_interval</code></strong>; both forms are equivalent.<a class="indexterm" id="IDX-CHP-2-0186"/><a class="indexterm" id="IDX-CHP-2-0187"/></p>

          <p>As soon as Nagios has performed the number of tests specified in <strong class="userinput"><code>max_check_attempts</code></strong>, it checks the service again at intervals of <strong class="userinput"><code>normal_check_interval</code></strong>.<a class="indexterm" id="IDX-CHP-2-0188"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>check_period</code></strong></span></dt>

        <dd>
          <p>This describes the time period in which the service is to be monitored. The entry represents a <strong class="userinput"><code>timeperiod</code></strong> object, the definition of which is described in more detail in <a class="xref" href="../Text/ch02s10.html" title="2.10 Defining a Time Period with timeperiod">2.10 Defining a Time Period with timeperiod</a> from page 74. Here you should enter <strong class="userinput"><code>24×7</code></strong> for "round the clock" unless you want to explicitly stop the test from running at specific times (perhaps because of a scheduled maintenance slot). If the notification is to be prevented only at specific times, it is better to use the option <strong class="userinput"><code>notification_period</code></strong> or other filters of the Nagios notification system (see <a class="xref" href="../Text/ch12.html" title="Chapter 12. The Nagios Notification System">Chapter 12</a>, page 265).<a class="indexterm" id="IDX-CHP-2-0189"/><a class="indexterm" id="IDX-CHP-2-0190"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>notification_interval</code></strong></span></dt>

        <dd>
          <p>This determines at what regular intervals Nagios repeats reports on error states. In the example, the system does this every 120 time units (normally minutes), as long as the error state continues. A value of <strong class="userinput"><code>0</code></strong> causes Nagios to announce the current state only once. Beginning with Nagios 3.0, <strong class="userinput"><code>notification_interval</code></strong> is no longer an obligatory parameter. If it is missing, the value is taken from the accompanying host definition.<a class="indexterm" id="IDX-CHP-2-0191"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>notification_period</code></strong></span></dt>

        <dd>
          <p>This describes the time period within which a notification should take place. This again involves a <strong class="userinput"><code>timeperiod</code></strong> object (see <a class="xref" href="../Text/ch02s10.html" title="2.10 Defining a Time Period with timeperiod">2.10 Defining a Time Period with timeperiod</a>). Here in the example, <strong class="userinput"><code>24×7</code></strong> is used, so notification is sent round the clock. A more detailed discussion of the <strong class="userinput"><code>notification_period</code></strong> parameter can be found in <a class="xref" href="../Text/ch12s03.html" title="12.3 The Message Filter">12.3 The Message Filter</a> from page 267. Beginning with Nagios 3.0 this parameter is optional. If it is missing, the value is taken from the accompanying host definition.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>notification_options</code></strong></span></dt>

        <dd>
          <p>This determines which error states Nagios should report. Possible values which can be used here are the same states already described for host objects, i.e., <strong class="userinput"><code>c</code></strong> (critical), <strong class="userinput"><code>w</code></strong> (warning), <strong class="userinput"><code>u</code></strong> (unknown), <strong class="userinput"><code>r</code></strong> (recovered), <strong class="userinput"><code>f</code></strong> (flapping), and (from Nagios 3.0) <strong class="userinput"><code>s</code></strong> (planned maintenance interval). Specifying <strong class="userinput"><code>c</code></strong>, <strong class="userinput"><code>r</code></strong> only informs the system when a service is in a CRITICAL state and if it subsequently recovers (RECOVERY).<a class="indexterm" id="IDX-CHP-2-0192"/></p>

          <p>If you use <strong class="userinput"><code>n</code></strong> (none) as the value, Nagios will normally not send any notification. The Web interface nevertheless shows the current states.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>contact_groups</code></strong></span></dt>

        <dd>
          <p>Finally, this parameter defines the recipient group whose members should receive the notifications. Several groups can be entered as a comma-separated list. Beginning with Nagios 3.0 this parameter can be omitted. Then the value is taken from the accompanying host definition.<a class="indexterm" id="IDX-CHP-2-0193"/></p>
        </dd>
      </dl>
    </div>

    <p>Further information can be found in the Nagios 3.0 online help at <a class="ulink" href="http://localhost/nagios/docs/objectdefinitions.html#service">http://localhost/nagios/docs/objectdefinitions.html#service</a>.<sup>[<a class="footnote" href="#ftn.CHP-2-FN-5" id="CHP-2-FN-5">35</a>]</sup> For version 2.x the file is called <strong class="userinput"><code>xodtemplate.html</code></strong>. The differences between Nagios 2.x and Nagios 3.0 are described in <a class="xref" href="../Text/aph.html#the_service_object" title="H.1.2 The service object">H.1.2 The service object</a> from page 680.</p>

    <div class="footnotes">
      <br/>
      <hr/>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-2-FN-5" id="ftn.CHP-2-FN-5">35</a>]</sup> The corresponding file is located after installation in the directory <strong class="userinput"><code>/usr/local/nagios/share/docs/</code></strong>.</p>
      </div>
    </div>
  </div>


  <div class="sect1" title="2.6 Grouping Services Together with servicegroup">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="grouping_services_together_with_serviceg"/>2.6 Grouping Services Together with <strong class="userinput"><code>servicegroup</code></strong></h1>
    </div>

    <p>Service groups, like host groups, combine several services into a group, so that they can be represented together in the Web front end. This increases clarity and simplifies certain evaluations, but it is optional, and is not recommended at the beginning, in order to keep configuration simple.<a class="indexterm" id="IDX-CHP-2-0194"/></p><a id="I_programlisting2_d1e3846"/>
    <pre class="programlisting"># -- /etc/nagios/mysite/servicegroups.cfg
define servicegroup{
<span class="strong"><strong>  servicegroup_name</strong></span>            all-ping
<span class="strong"><strong>  alias</strong></span>                        All Pings
<span class="strong"><strong>  members</strong></span>                      linux01, PING, linux02, PING
  servicegroup_members(*) servicegroup1, servicegroup2
}</pre>

    <p><strong class="userinput"><code>servicegroup_name</code></strong> and <strong class="userinput"><code>alias</code></strong> have the same meanings as for the host group. It should be noted that the syntax is the same as for the <strong class="userinput"><code>members</code></strong> entry. Because a service in Nagios always consists of the combination of host and service names, both must always be listed in pairs. The computer comes first, and then the service:<a class="indexterm" id="IDX-CHP-2-0195"/><a class="indexterm" id="IDX-CHP-2-0196"/><a class="indexterm" id="IDX-CHP-2-0197"/></p><a id="I_programlisting2_d1e3876"/>
    <pre class="programlisting">members <strong class="userinput"><code>hostl</code></strong>,<strong class="userinput"><code>servicel</code></strong>,<strong class="userinput"><code>host2</code></strong>,<strong class="userinput"><code>service2</code></strong>, ...</pre>

    <p>The <strong class="userinput"><code>members</code></strong> details can be omitted if the <strong class="userinput"><code>servicegroups</code></strong> parameter is used in the service definition (<a class="xref" href="../Text/ch02s05.html" title="2.5 Defining Services to Be Monitored with service">2.5 Defining Services to Be Monitored with service</a>). If you want, you can use the two possibilities in combination. As for the host groups, hierarchies can be formed from service groups from Nagios 3.0, using the parameter <strong class="userinput"><code>service-group_members</code></strong>.</p>
  </div>


  <div class="sect1" title="2.7 Defining Addressees for Error Messages: contact">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="defining_addressees_for_error_messages"/>2.7 Defining Addressees for Error Messages: <strong class="userinput"><code>contact</code></strong></h1>
    </div>

    <p>A contact is basically a person to whom a message addressed via a contact group is sent:<a class="indexterm" id="IDX-CHP-2-0198"/><a class="indexterm" id="IDX-CHP-2-0199"/><a class="indexterm" id="IDX-CHP-2-0200"/></p><a id="I_programlisting2_d1e3921"/>
    <pre class="programlisting"># -- /etc/nagios/mysite/contacts.cfg
define contact{
<span class="strong"><strong>    contact_name</strong></span>                   nagios
<span class="strong"><strong>    alias</strong></span>                          Nagios Admin
<span class="strong"><strong>    host_notification_period</strong></span>       24×7
<span class="strong"><strong>    service_notification_period</strong></span>    24×7
<span class="strong"><strong>    service_notification_options</strong></span>   w, u, c, r
<span class="strong"><strong>    host_notification_options</strong></span>      d, u, r
   service_notification_commands      notify-by-email
   host_notification_commands         host-notify-by-email
 <span class="strong"><strong>   email</strong></span>                          nagios-admin@localhost
    can_submit_commands(*)    1
}</pre>

    <p>The contact also plays a role during authentication: a user who logs in at the Web front end only gets to see the hosts and services for which that user is entered as the contact. The user for logging in to the Web interface must therefore be identical with the value of <strong class="userinput"><code>contact_name</code></strong> specified here. The first time it is used, the user <strong class="userinput"><code>nagios</code></strong> is sufficient.<a class="indexterm" id="IDX-CHP-2-0201"/><a class="indexterm" id="IDX-CHP-2-0202"/></p>

    <div class="variablelist">
      <dl>
        <dt><span class="term"><strong class="userinput"><code>contact_name</code></strong></span></dt>

        <dd>
          <p>This parameter defines the user name. It must match the corresponding user name in the password file <strong class="userinput"><code>htpasswd</code></strong>.<a class="indexterm" id="IDX-CHP-2-0203"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>alias</code></strong></span></dt>

        <dd>
          <p>This parameter describes the contact briefly. Spaces are allowed here.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>host_notification_period</code></strong></span></dt>

        <dd>
          <p>This defines the time period during which messages on the reachability of a computer can be sent. <a class="xref" href="../Text/ch12s03.html" title="12.3 The Message Filter">12.3 The Message Filter</a> (page 267) shows how the time period details can be sensibly combined in the different object types. At the beginning, the value <strong class="userinput"><code>24×7</code></strong> (that is: always) is certainly not a bad option.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>service_notification_period</code></strong></span></dt>

        <dd>
          <p>This defines the time period in which Nagios sends notifications to the relevant user service. The entry takes effect as a filter: the generated message is simply discarded here if it is sent outside the specified time period. If no further message follows, the contact remains uninformed. You must therefore think about combining individual time periods in various different definitions. Dependencies are described extensively in <a class="xref" href="../Text/ch12s03.html" title="12.3 The Message Filter">12.3 The Message Filter</a>.<a class="indexterm" id="IDX-CHP-2-0204"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>host_notification_options</code></strong></span></dt>

        <dd>
          <p>This defines what types of host messages the user should receive. The same options are used here as for the host parameter <strong class="userinput"><code>notification_options</code></strong> (<a class="xref" href="../Text/ch02s03.html" title="2.3 Defining the Machines to Be Monitored, with host">2.3 Defining the Machines to Be Monitored, with host</a>).<a class="indexterm" id="IDX-CHP-2-0205"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>service_notification_options</code></strong></span></dt>

        <dd>
          <p>This parameter describes what types of service messages are received by the contact. The same five values are involved as for the <strong class="userinput"><code>notification_options</code></strong> parameter for service and host objects.<a class="indexterm" id="IDX-CHP-2-0206"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>service_notification_commands</code></strong></span></dt>

        <dd>
          <p>This parameter defines which commands (one or more) take charge of notification. They must be defined as the <strong class="userinput"><code>command</code></strong> object type (see <a class="xref" href="../Text/ch02s09.html" title="2.9 When Nagios Needs to Do Something: The command Object">2.9 When Nagios Needs to Do Something: The command Object</a>); basically any external programs can be integrated.<a class="indexterm" id="IDX-CHP-2-0207"/><a class="indexterm" id="IDX-CHP-2-0208"/><a class="indexterm" id="IDX-CHP-2-0209"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>host_notification_commands</code></strong></span></dt>

        <dd>
          <p>Like the <strong class="userinput"><code>service_notification_commands</code></strong> this parameter specifies which commands are to be carried out to send the notification, although here it concerns the reachability of computers.<a class="indexterm" id="IDX-CHP-2-0210"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>email</code></strong></span></dt>

        <dd>
          <p>This specifies one or more e-mail addresses (separated by commas) to which a message should be sent. The notification command can evaluate this value (one example of this is the command <strong class="userinput"><code>notify-by-email</code></strong><sup>[<a class="footnote" href="#ftn.CHP-2-FN-6" id="CHP-2-FN-6">36</a>]</sup>).<a class="indexterm" id="IDX-CHP-2-0211"/><a class="indexterm" id="IDX-CHP-2-0212"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>can_submit_commands</code></strong> (Nagios 3.0)</span></dt>

        <dd>
          <p>This controls whether the contact may execute commands via the Web interface. The value <strong class="userinput"><code>0</code></strong> forbids him from doing this. For Nagios 2.x, in general any contact may run commands via the Web interface (see <a class="xref" href="../Text/ch16s02.html#interface_for_external_commands_colon_c" title="16.2.3 Interface for external commands: cmd.cgi">16.2.3 Interface for external commands: cmd.cgi</a>, page 343). Beginning with Nagios 3.0, this parameter now also allows the definition of contacts with read-only permission.<a class="indexterm" id="IDX-CHP-2-0213"/></p>
        </dd>
      </dl>
    </div>

    <p>Further information can be found in the Nagios 3.0 online help at <a class="ulink" href="http://localhost/nagios/docs/objectdefinitions.html#contact">http://localhost/nagios/docs/objectdefinitions.html#contact</a>. In Nagios 2.x the file is called <strong class="userinput"><code>xodtemplate.html</code></strong>. The differences between Nagios 2.x and Nagios 3.0 are described in <a class="xref" href="../Text/aph.html#the_contact_object" title="H.1.4 The contact object">H.1.4 The contact object</a>, page 681.</p>

    <div class="footnotes">
      <br/>
      <hr/>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-2-FN-6" id="ftn.CHP-2-FN-6">36</a>]</sup> see <a class="xref" href="../Text/ch12s04.html#macros_used_in_notify-by-email_and_host" title="Table 12-1. Macros used in notify-by-email and host-notify-by-email">Table 12-1</a> in page 277</p>
      </div>
    </div>
  </div>


  <div class="sect1" title="2.8 The Message Recipient: contactgroup">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="the_message_recipient_colon_contactgroup"/>2.8 The Message Recipient: <strong class="userinput"><code>contactgroup</code></strong></h1>
    </div>

    <p>The <strong class="userinput"><code>contactgroup</code></strong> serves as the interface between the notification system and the individual contacts. Nagios never addresses individual contacts directly in various object definitions, but always goes through the contact group.<a class="indexterm" id="IDX-CHP-2-0214"/><a class="indexterm" id="IDX-CHP-2-0215"/></p>

    <p>Here Nagios also expects a name (<strong class="userinput"><code>contactgroup_name</code></strong>) and a comment (<strong class="userinput"><code>alias</code></strong>), which reveals to visitors of the Web site what the purpose of the group is. For members (<strong class="userinput"><code>members</code></strong>) of the group, you can enter an individual contact or a comma-separated list of several contacts:<a class="indexterm" id="IDX-CHP-2-0216"/></p><a id="I_programlisting2_d1e4149"/>
    <pre class="programlisting"># -- /etc/nagios/mysite/contactgroups.cfg
define contactgroup{
<span class="strong"><strong>   contactgroup_name</strong></span>    localadmins
<span class="strong"><strong>   alias</strong></span>                Local Site Administrators
<span class="strong"><strong>   members</strong></span>              nagios
   contactgroup_members(*) contactgroup1,contactgroup2
}</pre>

    <p>The additional parameter <strong class="userinput"><code>contactgroup_members</code></strong> allows Nagios 3.0 to include further contact groups as members. In Nagios 2.x this parameter is not available.<a class="indexterm" id="IDX-CHP-2-0217"/></p>
  </div>


  <div class="sect1" title="2.9 When Nagios Needs to Do Something: The command Object">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="when_nagios_needs_to_do_something_colon"/>2.9 When Nagios Needs to Do Something: The <strong class="userinput"><code>command</code></strong> Object</h1>
    </div>

    <p>Everything that Nagios does is defined in <strong class="userinput"><code>command</code></strong> objects. In the example file supplied, <strong class="userinput"><code>checkcommands.cfg</code></strong> defines a broad range of commands which only need to be included. To do this, you just copy the file to the subdirectory <strong class="userinput"><code>mysite</code></strong>:<sup>[<a class="footnote" href="#ftn.CHP-2-FN-7" id="CHP-2-FN-7">37</a>]</sup><a class="indexterm" id="IDX-CHP-2-0218"/></p><a id="I_programlisting2_d1e4194"/>
    <pre class="programlisting">nagios@linux:/etc/nagios$ <span class="strong"><strong>cp objects/checkcommands.cfg</strong></span> \ <span class="strong"><strong>mysite/checkcommands.cfg</strong></span></pre>

    <p>The existing command <strong class="userinput"><code>check_ping</code></strong> illustrates the definition of this object type:</p><a id="I_programlisting2_d1e4206"/>
    <pre class="programlisting"># -- /etc/nagios/mysite/checkcommands.cfg
...
define command{
<span class="strong"><strong>  command_name</strong></span> check_ping
<span class="strong"><strong>  command_line</strong></span> $USER1$/check_icmp -H $HOSTADDRESS$ -w $ARG1$ -c $ARG2$
-p 5
}
...</pre>

    <p><strong class="userinput"><code>check_ping</code></strong> is the name by which the command will later be called when defining a service. <strong class="userinput"><code>commard_line</code></strong> describes the command to be executed. Not only is the old plugin <strong class="userinput"><code>check_ping</code></strong> used here, but so is the more efficient <strong class="userinput"><code>check_icmp</code></strong>. The differences between the two are explained in more detail in <a class="xref" href="../Text/ch06s02.html" title="6.2 Reachability Test with Ping">6.2 Reachability Test with Ping</a> from page 108, but they use the same parameters to a large extent.<a class="indexterm" id="IDX-CHP-2-0219"/><a class="indexterm" id="IDX-CHP-2-0220"/><a class="indexterm" id="IDX-CHP-2-0221"/><a class="indexterm" id="IDX-CHP-2-0222"/></p>

    <p>The identifiers used here, surrounded by dollar signs, are macros. Nagios recognizes three different types of macros: <strong class="userinput"><code>$USERx$</code></strong> macros (<strong class="userinput"><code><em class="replaceable"><code>x</code></em></code></strong> may take on values between 1 and 32) define the file <strong class="userinput"><code>resource.cfg</code></strong>. The macro <strong class="userinput"><code>$USER1$</code></strong>, which contains the path to the plugin directory, belongs to this.<a class="indexterm" id="IDX-CHP-2-0223"/><a class="indexterm" id="IDX-CHP-2-0224"/><a class="indexterm" id="IDX-CHP-2-0225"/></p>

    <p>The second group of macros are arguments which can be passed on when a command is called. These include <strong class="userinput"><code>$ARG1$</code></strong> and <strong class="userinput"><code>$ARG2$</code></strong>.</p>

    <p>The third group defined by Nagios includes the macro <strong class="userinput"><code>$HOSTADDRESS$</code></strong>, which references the IP address of the host in the host definition (that is, the parameter <strong class="userinput"><code>address</code></strong>). This type of macro is documented in the online help at <a class="ulink" href="http://localhost/nagios/docs/macros.html">http://localhost/nagios/docs/macros.html</a>.</p>

    <p>If you call the service <strong class="userinput"><code>linux01</code></strong>, <strong class="userinput"><code>PING</code></strong>, defined in <a class="xref" href="../Text/ch02s04.html" title="2.4 Grouping Computers Together with hostgroup">2.4 Grouping Computers Together with hostgroup</a>, as a <strong class="userinput"><code>check_command</code></strong></p><a id="I_programlisting2_d1e4299"/>
    <pre class="programlisting">check_ping!100.0,20%!500.0,60%</pre>

    <p>then <strong class="userinput"><code>100.0,20%</code></strong> will appear in <strong class="userinput"><code>$ARG1$</code></strong>, and <strong class="userinput"><code>500.0,60%</code></strong> in <strong class="userinput"><code>$ARG2$</code></strong>. To separate the command and the arguments to be passed on, the exclamation mark is used.</p>

    <p>In theory, any programs at all can be started via the <strong class="userinput"><code>command_line</code></strong>, but Nagios expects a certain type of behavior here, particularly where the return value is concerned. For this reason, only Nagios plugins should be used (see <a class="xref" href="../Text/ch06.html" title="Chapter 6. Plugins for Network Services">Chapter 6</a> to <a class="xref" href="../Text/ch09.html" title="Chapter 9. Executing Plugins via SSH">Chapter 9</a>).</p>

    <div class="footnotes">
      <br/>
      <hr/>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-2-FN-7" id="ftn.CHP-2-FN-7">37</a>]</sup> In Nagios 2.0 the example file lies directly in the directory <strong class="userinput"><code>/etc/nagios</code></strong>.</p>
      </div>
    </div>
  </div>


  <div class="sect1" title="2.10 Defining a Time Period with timeperiod">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="defining_a_time_period_with_timeperiod"/>2.10 Defining a Time Period with <strong class="userinput"><code>timeperiod</code></strong></h1>
    </div>

    <p><strong class="userinput"><code>timeperiod</code></strong> objects describe time periods in which Nagios generates and/ or sends notifications. The included example files (Nagios 3.0: <strong class="userinput"><code>objects/timeperiods.cfg</code></strong>; Nagios 2.x: <strong class="userinput"><code>localhost.cfg</code></strong>) contain a number of definitions that can simply be copied to your own <strong class="userinput"><code>timeperiods.cfg</code></strong> file.<a class="indexterm" id="IDX-CHP-2-0226"/><a class="indexterm" id="IDX-CHP-2-0227"/><a class="indexterm" id="IDX-CHP-2-0228"/><a class="indexterm" id="IDX-CHP-2-0229"/><a class="indexterm" id="IDX-CHP-2-0230"/><a class="indexterm" id="IDX-CHP-2-0231"/><a class="indexterm" id="IDX-CHP-2-0232"/></p>

    <p>In this, the definition of <strong class="userinput"><code>24×7</code></strong> is stated as "Sundays to Saturdays, from 0 to 24 hours in each case:"</p><a id="I_programlisting2_d1e4372"/>
    <pre class="programlisting"># -- /etc/nagios/mysite/timeperiods.cfg
define timeperiod{
<span class="strong"><strong>   timeperiod_name</strong></span> 24×7
<span class="strong"><strong>   alias</strong></span>           24 Hours A Day, 7 Days A Week
   Sunday              00:00-24:00
   Monday              00:00-24:00
   tuesday             00:00-24:00
   wednesday           00:00-24:00
   Thursday            00:00-24:00
   Friday              00:00-24:00
   Saturday            00:00-24:00
}</pre>

    <p>The times of day on individual weekdays can also be "cobbled together" from time periods, separated by a comma:</p><a id="I_programlisting2_d1e4382"/>
    <pre class="programlisting">define timeperiod{
   ...
   Monday          00:00-09:00,12:00-13:00,17:00-24:00
   ...
}</pre>

    <p>If a day specification is omitted completely, the defined time period will not include this day in its entirety.</p>

    <p>Nagios 3.0 allows periods for individual calendar days to be defined:</p><a id="I_programlisting2_d1e4388"/>
    <pre class="programlisting">2007-12-24     08:00-12:00
may 1          00:00-24:00
monday 2 may   00:00-24:00
monday 3       00:00-24:00
...
2007-12-24 - 2008-01-08 / 2 00:00-24:00</pre>

    <p>The first line names a fixed calendar day in the ISO format, the second line describes every 1st May. The details in the third line refer to the second Monday in May, and those of the fourth line, to the third Monday of each month. The details can also be combined, in the form <strong class="userinput"><code><em class="replaceable"><code>from - to</code></em></code></strong>. A subsequent / acts as a separator: the sixth line describes every second day (<strong class="userinput"><code>/ 2</code></strong>) in the period from 24.12. 2007 to 8.1. 2008.</p>

    <p><a class="xref" href="../Text/aph.html#time_definitions" title="H.1.5 Time definitions">H.1.5 Time definitions</a>, page 682 is also devoted to the extended format of Nagios 3.0. The complete documentation can be found in the Nagios 3.0 online help at <a class="ulink" href="http://localhost/nagios/docs/objectdefinitions.html#contact">http://localhost/nagios/docs/objectdefinitions.html#contact</a>. In Nagios 2.x the corresponding file is called <strong class="userinput"><code>xodtemplate.html</code></strong>.</p>
  </div>


  <div class="sect1" title="2.11 Templates">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="templates"/>2.11 Templates</h1>
    </div>

    <p>Nagios categorizes definitions as objects for a very good reason: their features can namely be inherited by other objects—a feature that can save a lot of time otherwise spent typing. You can define a so-called <span class="emphasis"><em>template</em></span> and pass this on to other objects as a basis from which you only need to describe those details that are different.<a class="indexterm" id="IDX-CHP-2-0233"/></p>

    <p>This is best illustrated by an example (the parameters that are required for the use of templates are printed in bold):</p><a id="I_programlisting2_d1e4420"/>
    <pre class="programlisting"># -- /etc/nagios/mysite/hosts.cfg
define host{
<span class="strong"><strong>   name</strong></span>             <span class="strong"><strong>Generic-Host</strong></span>
<span class="strong"><strong>   register</strong></span>         <span class="strong"><strong>0</strong></span>

   check_command           check-host-alive
   max_check_attempts      3
   check_period            24×7
   contact_groups          localadmins
   notification_interval   120
   notification_period     24×7
   notification_options    d, u, r, f
}</pre>

    <p>With <strong class="userinput"><code>name</code></strong>, the template is first given a name so that it can be referenced later on. The following entry, <strong class="userinput"><code>register 0</code></strong>, prevents Nagios from trying to treat this template as a real host. In the example, the entries for the genuine host object are not sufficient; consequently Nagios would break off when reading the configuration file, with the error message that parameters are missing that are obligatory for such a definition, for example:</p><a id="I_programlisting2_d1e4442"/>
    <pre class="programlisting">Error: Host name is NULL</pre>

    <p>All the other parameters involve settings that are to apply to all definitions dependent on <strong class="userinput"><code>Generic-Host</code></strong>.</p>

    <p>In the actual host definition—in the following example for <strong class="userinput"><code>linux03</code></strong> and <strong class="userinput"><code>linux04</code></strong>—the parameter <strong class="userinput"><code>use</code></strong> references the template and thus takes over the preset values:</p><a id="I_programlisting2_d1e4460"/>
    <pre class="programlisting"># -- /etc/nagios/mysite/hosts.cfg
define host{
   host_name   linux03
   <span class="strong"><strong>use</strong></span>  <span class="strong"><strong>Generic-Host</strong></span>
   alias       Linux File Server
   address     192.168.0.1
}
define host{
   host_name   linux04
   <span class="strong"><strong>use  Generic-Host</strong></span>
   alias       Linux Print Server
   address     192.168.0.2
}</pre>

    <p>In this way you only need to complete those entries that vary in any way between the two hosts.<a class="indexterm" id="IDX-CHP-2-0234"/></p>

    <p>But parameters may also appear in host definitions that have already been defined by the template. In this case the definition at the host has priority it overwrites the value from the template.</p>

    <p>Templates created in this way can generally be used for all object types. Further information on their use can be found in the Nagios 3.0 online help at <a class="ulink" href="http://localhost/nagios/docs//objectinheritance.html">http://localhost/nagios/docs//objectinheritance.html</a>.<sup>[<a class="footnote" href="#ftn.CHP-2-FN-8" id="CHP-2-FN-8">38</a>]</sup> In Nagios 2.x the file is called <strong class="userinput"><code>templaterecursion.html</code></strong>. The extended possibilities of Nagios 3.0, which only begin to play a role in more complex setups, are described by <a class="xref" href="../Text/aph.html#inheritance-id1" title="H.1.8 Inheritance">H.1.8 Inheritance</a> from page 684.</p>

    <div class="footnotes">
      <br/>
      <hr/>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-2-FN-8" id="ftn.CHP-2-FN-8">38</a>]</sup> Locally in <strong class="userinput"><code>/usr/local/nagios/share/docs//objectinheritance.html</code></strong>.</p>
      </div>
    </div>
  </div>


  <div class="sect1" title="2.12 Configuration Aids for Those Too Lazy to Type">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="configuration_aids_for_those_too_lazy_to"/>2.12 Configuration Aids for Those Too Lazy to Type</h1>
    </div>

    <div class="sect2" title="2.12.1 Defining services for several computers">
      <div class="titlepage">
        <h2 class="title" id="heading_id_3"><a id="defining_services_for_several_computers"/>2.12.1 Defining services for several computers</h2>
      </div>

      <p>You can simplify things a lot in the service definition by defining a service for several hosts, or even host groups, at the same time:<a class="indexterm" id="IDX-CHP-2-0235"/></p><a id="I_programlisting2_d1e4506"/>
      <pre class="programlisting"># -- /etc/nagios/mysite/services.cfg
define service{
<span class="strong"><strong>   host_name</strong></span>         linux01,linux02,linux04,...
   service_description   PING
   ...
}</pre>

      <p>Specifying several hosts, separated by commas, ensures that Nagios defines multiple services in parallel. You can go one step further by specifying the * character instead of individual computer aliases. This will assign this service to all hosts.</p>

      <p>A third possibility is an allocation in parallel via host groups:</p><a id="I_programlisting2_d1e4515"/>
      <pre class="programlisting"># -- /etc/nagios/mysite/services.cfg
define service{
<span class="strong"><strong>   hostgroup_name</strong></span>    linux-servers,windows-servers
   service_description   PING
   ...
}</pre>

      <p>In this case the parameter <strong class="userinput"><code>hostgroup_name</code></strong> is used instead of the parameter <strong class="userinput"><code>host_name</code></strong>.<a class="indexterm" id="IDX-CHP-2-0236"/></p>
    </div>

    <div class="sect2" title="2.12.2 One host group for all computers">
      <div class="titlepage">
        <h2 class="title" id="heading_id_4"><a id="one_host_group_for_all_computers"/>2.12.2 One host group for all computers</h2>
      </div>

      <p>The quickest way to describe a host group containing all defined computers is with the wild card <strong class="userinput"><code>*</code></strong>:<a class="indexterm" id="IDX-CHP-2-0237"/><a class="indexterm" id="IDX-CHP-2-0238"/></p><a id="I_programlisting2_d1e4545"/>
      <pre class="programlisting"># -- /etc/nagios/mysite/hostgroups.cfg
define hostgroup{
   hostgroup_name    all-hosts
<span class="strong"><strong>   members    *</strong></span>
   ...
}</pre>
    </div>

    <div class="sect2" title="2.12.3 Other configuration aids">
      <div class="titlepage">
        <h2 class="title" id="heading_id_5"><a id="other_configuration_aids"/>2.12.3 Other configuration aids</h2>
      </div>

      <p>In practice, the definition of services covering multiple hosts, described in <a class="xref" href="../Text/ch02s11.html" title="2.11 Templates">2.11 Templates</a>, is by far the most important. But there are other configuration aids based on the escalation and dependency objects, introduced in <a class="xref" href="../Text/ch12s03.html#informing_different_admins_at_differen" title="Informing different admins at different times">Informing different admins at different times</a> (see <a class="xref" href="../Text/ch12s05.html" title="12.5 Escalation Management">12.5 Escalation Management</a> in page 282 and <a class="xref" href="../Text/ch12s06.html" title="12.6 Accounting for Dependencies between Hosts and Services">12.6 Accounting for Dependencies between Hosts and Services</a>12.6 in 285). There you can also use <strong class="userinput"><code>hostgroup_name</code></strong> instead of <strong class="userinput"><code>host_name</code></strong> (a list of host groups) or <strong class="userinput"><code>servicegroup_name</code></strong> instead of <strong class="userinput"><code>service_description</code></strong>. In addition you may set the value * for <strong class="userinput"><code>host_name</code></strong> and <strong class="userinput"><code>service_description</code></strong>, which covers all hosts or services.<a class="indexterm" id="IDX-CHP-2-0239"/></p>
    </div>
  </div>


  <div class="sect1" title="2.13 CGI Configuration in cgi.cfg">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="cgi_configuration_in_cgi.cfg"/>2.13 CGI Configuration in <strong class="userinput"><code>cgi.cfg</code></strong></h1>
    </div>

    <p>In order for the Web front end to work correctly, Nagios needs the configuration file <strong class="userinput"><code>cgi.cfg</code></strong>. Nagios' example file can initially be taken over one-to-one, since the paths contained in it were set correctly during installation:<a class="indexterm" id="IDX-CHP-2-0241"/><a class="indexterm" id="IDX-CHP-2-0242"/><a class="indexterm" id="IDX-CHP-2-0243"/><a class="indexterm" id="IDX-CHP-2-0244"/><a class="indexterm" id="IDX-CHP-2-0245"/><a class="indexterm" id="IDX-CHP-2-0246"/><a class="indexterm" id="IDX-CHP-2-0247"/><a class="indexterm" id="IDX-CHP-2-0248"/><a class="indexterm" id="IDX-CHP-2-0249"/><a class="indexterm" id="IDX-CHP-2-0240"/></p><a id="I_programlisting2_d1e4634"/>
    <pre class="programlisting">nagios@linux:/etc/nagios$ <span class="strong"><strong>cp sample/cgi.cfg-sample ./cgi.cfg</strong></span></pre>

    <p>Important: the file <strong class="userinput"><code>cgi.cfg</code></strong> must be located in the same directory as the file <strong class="userinput"><code>nagios.cfg</code></strong>, because the CGI programs have been compiled in this path permanently. If <strong class="userinput"><code>cgi.cfg</code></strong> is located in a different directory, the Web server must also be given an environment variable with the correct path, called <strong class="userinput"><code>NAGIOS_CGI_CONFIG</code></strong>. How this is set in the case of Apache is described in the corresponding online documentation.<sup>[<a class="footnote" href="#ftn.CHP-2-FN-9" id="CHP-2-FN-9">39</a>]</sup></p>

    <p>Out of the box, several parameters are enabled in the CGI configuration file. What these are is revealed by the following <strong class="userinput"><code>egrep</code></strong> command, which excludes comments and empty lines:</p><a id="I_programlisting2_d1e4660"/>
    <pre class="programlisting">nagios@linux:/etc/nagios$ <span class="strong"><strong>egrep -v '^$|^#' cgi.cfg-sample | less</strong></span>
main_config_file=/etc/nagios/nagios.cfg
physical_html_path=/usr/local/nagios/share
url_html_path=/nagios
show_context_help=0
use_authentication=1
...</pre>

    <div class="variablelist">
      <dl>
        <dt><span class="term"><strong class="userinput"><code>main_config_file</code></strong></span></dt>

        <dd>
          <p>This parameter specifies the main configuration file.<a class="indexterm" id="IDX-CHP-2-0250"/><a class="indexterm" id="IDX-CHP-2-0251"/><a class="indexterm" id="IDX-CHP-2-0252"/><a class="indexterm" id="IDX-CHP-2-0253"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>physical_html_path</code></strong></span></dt>

        <dd>
          <p>This specifies the absolute path in the file tree to the directory in which the HTML documents—including online documentation, images, and CSS stylesheets—are located.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>url_html_path</code></strong></span></dt>

        <dd>
          <p>This also describes the path to the Nagios HTML documents, but from the perspective of the Web server, not of the operating system.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>show_context_help</code></strong></span></dt>

        <dd>
          <p>This option provides—as long as it is switched on (value <strong class="userinput"><code>1</code></strong>)—a context-dependent help if you move the mouse in the Web interface over individual links or buttons.<a class="indexterm" id="IDX-CHP-2-0254"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>use_authentication</code></strong></span></dt>

        <dd>
          <p>This option should always be switched on (value <strong class="userinput"><code>1</code></strong>). Nagios will then only allow access to authenticated users. The authentication itself is configured in a <strong class="userinput"><code>.htaccess</code></strong> file in the CGI directory (see <a class="xref" href="../Text/ch01s05.html" title="1.5 Configuration of the Web Interface">1.5 Configuration of the Web Interface</a> in page 47). If this file is missing, and if <strong class="userinput"><code>use_authentication=1</code></strong>, then the CGI programs will refuse to work.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>default_statusmap_layout</code></strong> and <strong class="userinput"><code>default_statuswrl_layout</code></strong></span></dt>

        <dd>
          <p>These two layout parameters describe forms of representation in the graphical illustration of network dependencies. Possible values are described in <a class="xref" href="../Text/apas02.html" title="A.2 CGI Configuration in cgi.cfg">A.2 CGI Configuration in cgi.cfg</a> in page 608.<a class="indexterm" id="IDX-CHP-2-0255"/><a class="indexterm" id="IDX-CHP-2-0256"/></p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>refresh_rate</code></strong></span></dt>

        <dd>
          <p>This specifies the timespan in seconds after which the browser is instructed to reload data from the Web server. In this way the display in the browser is always up-to-date.</p>
        </dd>

        <dt><span class="term"><strong class="userinput"><code>authorized_for_all_services and authorized_for_all_hosts</code></strong></span></dt>

        <dd>
          <p>In order for a specific user to be able to see all computers and services in the Web interface right from the beginning, without taking account of the allocation of hosts and services to the correct contact group, you should also activate the following two parameters in the file <strong class="userinput"><code>cgi.cfg</code></strong>:<a class="indexterm" id="IDX-CHP-2-0257"/><a class="indexterm" id="IDX-CHP-2-0258"/></p><a id="I_programlisting2_d1e4773"/>
          <pre class="programlisting">authorized_for_all_services=nagios
authorized_for_all_hosts=nagios</pre>

          <p>The Web user (and contact) <strong class="userinput"><code>nagios</code></strong> is now able to see all hosts and all services in the Web interface, even if he is not entered as the contact responsible for all hosts or services.</p>
        </dd>
      </dl>
    </div>

    <p>A complete list of all parameters can be found in <a class="xref" href="../Text/apas02.html" title="A.2 CGI Configuration in cgi.cfg">A.2 CGI Configuration in cgi.cfg</a> in page 606.</p>

    <div class="footnotes">
      <br/>
      <hr/>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-2-FN-9" id="ftn.CHP-2-FN-9">39</a>]</sup> <a class="ulink" href="http://httpd.apache.org/docs-2.0/env.html">http://httpd.apache.org/docs-2.0/env.html</a></p>
      </div>
    </div>
  </div>


  <div class="sect1" title="2.14 The Resources File resource.cfg">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="the_resources_file_resource.cfg"/>2.14 The Resources File <strong class="userinput"><code>resource.cfg</code></strong></h1>
    </div>

    <p>Nagios expects to find the definition of macros, concerning how they are used to create command objects (<a class="xref" href="../Text/ch02s09.html" title="2.9 When Nagios Needs to Do Something: The command Object">2.9 When Nagios Needs to Do Something: The command Object</a> from page 72), in the resources file <strong class="userinput"><code>resource.cfg</code></strong>. This can also be use as supplied.<a class="indexterm" id="IDX-CHP-2-0260"/><a class="indexterm" id="IDX-CHP-2-0261"/><a class="indexterm" id="IDX-CHP-2-0262"/><a class="indexterm" id="IDX-CHP-2-0263"/><a class="indexterm" id="IDX-CHP-2-0264"/><a class="indexterm" id="IDX-CHP-2-0259"/><a class="indexterm" id="IDX-CHP-2-0265"/></p>

    <p>The location where Nagios should search for this file is defined by the <strong class="userinput"><code>resource.cfg</code></strong> parameter in the main configuration file <strong class="userinput"><code>nagios.cfg</code></strong>. It makes sense here to use the same directory in which <strong class="userinput"><code>nagios.cfg</code></strong> is also located.</p>

    <p>In its "factory settings", <strong class="userinput"><code>resource.cfg</code></strong> defines only the <strong class="userinput"><code>$USER1$</code></strong> macro, which contains the path to the plugins:<a class="indexterm" id="IDX-CHP-2-0266"/></p><a id="I_programlisting2_d1e4851"/>
    <pre class="programlisting">$USER1$=/usr/local/nagios/libexec</pre>

    <p>In total, Nagios has provisions for 32 freely definable <strong class="userinput"><code>$USERx$</code></strong> macros, where <strong class="userinput"><code><em class="replaceable"><code>x</code></em></code></strong> can be from 1 to 32. These can be very useful in combination with passwords, for example: a password is defined via such a macro in the file <strong class="userinput"><code>resource.cfg</code></strong>, which may be read only by the user <strong class="userinput"><code>nagios</code></strong>. The defined macro is used in the actual service definitions, thus hiding the password from view of curious onlookers.</p>
  </div>


  <div class="chapter" title="Chapter&#xA0;3.&#xA0;Startup">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="startup"/>Chapter 3. Startup</h1>
    </div>

    <p>Once Nagios and the plugins are installed, Apache is set up for the Web interface, and a minimal configuration is created as previously described, operation of the system can get under way. If you have not already done so, it is recommended that you first spend a bit of time on the test for the <strong class="userinput"><code>check_icmp</code></strong> plugin, described in <a class="xref" href="../Text/ch01s04.html" title="1.4 Installing and Testing Plugins">1.4 Installing and Testing Plugins</a> (page 43), to check the initial configuration.</p>

    <div class="sect1" title="3.1 Checking the Configuration">
      <div class="titlepage">
        <h1 class="title" id="heading_id_3"><a id="checking_the_configuration"/>3.1 Checking the Configuration</h1>
      </div>

      <p>The <strong class="userinput"><code>nagios</code></strong> program, which normally runs as a daemon and continually collects data, can also be used to test the configuration:<a class="indexterm" id="IDX-CHP-3-0267"/><a class="indexterm" id="IDX-CHP-3-0268"/><a class="indexterm" id="IDX-CHP-3-0269"/><a class="indexterm" id="IDX-CHP-3-0270"/><a class="indexterm" id="IDX-CHP-3-0271"/><a class="indexterm" id="IDX-CHP-3-0272"/></p><a id="I_programlisting3_d1e4910"/>
      <pre class="programlisting">nagios@linux:~$ <span class="strong"><strong>/usr/local/nagios/bin/nagios -v /etc/nagios/nagios.cfg</strong></span>
Nagios 3.0rc1
Copyright (c) 1999-2007 Ethan Galstad (http://www.nagios.org)
Last Modified: 12-17-2007
License: GPL

Reading configuration data...

Running pre-flight check on configuration data...

Checking services...
         Checked 2092 services.
Checking hosts...
Warning: Host 'eli-sw01' has no services associated with it!
         Checked 183 hosts.
Checking host groups...
         Checked 55 host groups.
Checking service groups...
         Checked 34 service groups.
Checking contacts...
         Checked 59 contacts.
Checking contact groups...
         Checked 7 contact groups.
Checking service escalations...
         Checked 0 service escalations.
Checking service dependencies...
         Checked 24 service dependencies.
Checking host escalations...
         Checked 0 host escalations.
Checking host dependencies...
         Checked 0 host dependencies.
Checking service groups...
         Checked 34 service groups.
Checking contacts...
         Checked 59 contacts.
Checking contact groups...
         Checked 7 contact groups.
Checking service escalations...
         Checked 0 service escalations.
Checking service dependencies...
         Checked 24 service dependencies.
Checking host escalations...
         Checked 0 host escalations.
Checking host dependencies...
         Checked 0 host dependencies.
Checking commands...
         Checked 105 commands.
Checking time periods...
         Checked 6 time periods.
Checking for circular paths between hosts...
Checking for circular host and service dependencies...
Checking global event handlers...
Checking obsessive compulsive processor commands...
Checking misc settings...
Total Warnings: 1
Total Errors: 0

Things look okay - No serious problems were detected during the pre-flig
ht check</pre>

      <p>Although warnings displayed here can in principle be ignored, this is not always what the inventor had in mind: perhaps you made a mistake in the configuration, and Nagios is ignoring a specific object, which you would actually like to use.</p>

      <p>If you have not defined any service for a host, for instance, Nagios will issue a warning, as in the example above for <strong class="userinput"><code>eli-sw01</code></strong>. It is therefore recommended to define a "PING" service for every host, although this is not absolutely essential. Even if the same plugin, <strong class="userinput"><code>check_icmp</code></strong>, is used here as with the host check, this is not the same thing. The host check is satisfied with a single response packet—after all, it only wants to find out if the host "is alive". As a service check, <strong class="userinput"><code>check_icmp</code></strong> registers packet run times and loss rates, which can be used to draw conclusions, if necessary, concerning existing problems with a network card.<a class="indexterm" id="IDX-CHP-3-0273"/></p>

      <p>In contrast to warnings, genuine <strong class="userinput"><code>errors</code></strong> must be eliminated, because Nagios will usually not start if the parser finds an error, as in the following example:</p><a id="I_programlisting3_d1e4936"/>
      <pre class="programlisting">Error: Could not find any host matching 'linux03'
Error: Could not expand hostgroups and/or hosts specified in service
(config file '/etc/nagios/mysite/services.cfg', starting on line 0)

***&gt; One or more problems was encountered while processing the config files...</pre>

      <p>Here the configuration mistakenly contains a host called <strong class="userinput"><code>linux03</code></strong>, for which there is no definition. If you read through the error message carefully, you will quickly realize that the error can be found in the file <strong class="userinput"><code>/etc/nagios/mysite/services.cfg</code></strong>.</p>

      <p>In the definition of independencies (<span class="emphasis"><em>host</em></span> and <span class="emphasis"><em>service dependencies</em></span>; see <a class="xref" href="../Text/ch12s06.html" title="12.6 Accounting for Dependencies between Hosts and Services">12.6 Accounting for Dependencies between Hosts and Services</a>, page 285) there is a fundamental risk that circular dependencies could be specified by mistake. Because Nagios cannot automatically resolve such dependencies, this is also checked before the start, and if necessary, an error is displayed.<a class="indexterm" id="IDX-CHP-3-0274"/></p>

      <p>When using the <strong class="userinput"><code>parents</code></strong> parameter, it is also possible that two hosts may inadvertently serve mutually as "parents;" Nagios also tests this.<a class="indexterm" id="IDX-CHP-3-0275"/></p>
    </div>
  </div>


  <div class="sect1" title="3.2 Getting Monitoring Started">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="getting_monitoring_started"/>3.2 Getting Monitoring Started</h1>
    </div>

    <p>During the Nagios installation, the command<a class="indexterm" id="IDX-CHP-3-0276"/><a class="indexterm" id="IDX-CHP-3-0277"/><a class="indexterm" id="IDX-CHP-3-0278"/><a class="indexterm" id="IDX-CHP-3-0279"/><a class="indexterm" id="IDX-CHP-3-0280"/><a class="indexterm" id="IDX-CHP-3-0281"/></p><a id="I_programlisting3_d1e4994"/>
    <pre class="programlisting">linux:src/nagios # <span class="strong"><strong>make install-init</strong></span>
...</pre>

    <p>saves a startup script in the directory containing the boot-up scripts, usually <strong class="userinput"><code>/etc/init.d</code></strong>.<a class="indexterm" id="IDX-CHP-3-0282"/></p>

    <div class="sect2" title="3.2.1 Manual start">
      <div class="titlepage">
        <h2 class="title" id="heading_id_3"><a id="manual_start"/>3.2.1 Manual start</h2>
      </div>

      <p>If the configuration test ran without error, Nagios on Debian, Ubuntu, and OpenSuSE is first started manually with this script:</p><a id="I_programlisting3_d1e5014"/>
      <pre class="programlisting">linux:~ # <span class="strong"><strong>/etc/init.d/nagios start</strong></span></pre>

      <p>Fedora provides its own startup mechanism:</p><a id="I_programlisting3_d1e5020"/>
      <pre class="programlisting">linux:~ # <span class="strong"><strong>service nagios start</strong></span></pre>

      <p>If everything runs smoothly here (which can be checked by running the Web interface—see <a class="xref" href="../Text/ch03s03.html" title="3.3 Overview of the Web Interface">3.3 Overview of the Web Interface</a> in page 85), you only need to make sure that the script is executed at system start. The required steps, depending on the distribution, are described in <a class="xref" href="../Text/ch01s03.html" title="1.3 Starting Nagios Automatically">1.3 Starting Nagios Automatically</a> in page 43.<a class="indexterm" id="IDX-CHP-3-0283"/></p>
    </div>

    <div class="sect2" title="3.2.2 Making configuration changes come into effect">
      <div class="titlepage">
        <h2 class="title" id="heading_id_4"><a id="making_configuration_changes_come_into"/>3.2.2 Making configuration changes come into effect</h2>
      </div>

      <p>If configuration changes are made, it is not required, and not even recommended, that you restart Nagios each time. Instead, you just perform a reload:</p><a id="I_programlisting3_d1e5038"/>
      <pre class="programlisting">linux:~ # <span class="strong"><strong>/etc/init.d/nagios reload</strong></span></pre>

      <p>This causes Nagios to reread the configuration, end tests for hosts and services that no longer exist, and integrate new computers and services into the test. However, with each reload there is a renewed <span class="emphasis"><em>scheduling</em></span> of checks, meaning that Nagios plans to carry out all tests afresh.<a class="indexterm" id="IDX-CHP-3-0284"/></p>

      <p>To prevent all tests from being started simultaneously at bootup, Nagios performs a so-called <span class="emphasis"><em>spreading</em></span>. Here the server spreads the start times of the tests over a configurable period.<sup>[<a class="footnote" href="#ftn.CHP-3-FN-1" id="CHP-3-FN-1">40</a>]</sup> Therefore, for a large number of services, it can take a while before Nagios continues the test for a specific service. For this reason you should never run reloads at short intervals: in the worst case, Nagios will not manage to perform some checks in the intervening period and will perform them only some time after the most recent reload.<a class="indexterm" id="IDX-CHP-3-0285"/><a class="indexterm" id="IDX-CHP-3-0286"/><a class="indexterm" id="IDX-CHP-3-0287"/></p>

      <p>Before being reloaded, the configuration is tested to eliminate any existing errors, as shown in <a class="xref" href="../Text/ch03.html#checking_the_configuration" title="3.1 Checking the Configuration">3.1 Checking the Configuration</a>.</p>
    </div>

    <div class="footnotes">
      <br/>
      <hr/>

      <div class="footnote">
        <p><sup>[<a class="para" href="#CHP-3-FN-1" id="ftn.CHP-3-FN-1">40</a>]</sup> The relevant configuration parameters are called <strong class="userinput"><code>max_host_check_spread</code></strong> and <strong class="userinput"><code>max_service_check_spread</code></strong>, see <a class="xref" href="../Text/apa.html#an_overview_of_the_nagios_configuration" title="A.1 The Main Configuration File nagios.cfg">A.1 The Main Configuration File nagios.cfg</a>, page 599.</p>
      </div>
    </div>
  </div>


  <div class="sect1" title="3.3 Overview of the Web Interface">
    <div class="titlepage">
      <h1 class="title" id="heading_id_2"><a id="overview_of_the_web_interface"/>3.3 Overview of the Web Interface</h1>
    </div>

    <p>If you call the URL <a class="ulink" href="http://nagios-server/nagios">http://nagios-server/nagios</a> in the browser when the Nagios daemon is running, you will be taken to the welcome screen shown in <a class="xref" href="../Text/ch03s03.html#the_start_screen" title="Figure 3-1. The start screen">Figure 3-1</a>.<a class="indexterm" id="IDX-CHP-3-0288"/><a class="indexterm" id="IDX-CHP-3-0289"/><a class="indexterm" id="IDX-CHP-3-0290"/><a class="indexterm" id="IDX-CHP-3-0291"/><a class="indexterm" id="IDX-CHP-3-0292"/><a class="indexterm" id="IDX-CHP-3-0293"/><a class="indexterm" id="IDX-CHP-3-0294"/><a class="indexterm" id="IDX-CHP-3-0295"/><a class="indexterm" id="IDX-CHP-3-0296"/><a class="indexterm" id="IDX-CHP-3-0297"/><a class="indexterm" id="IDX-CHP-3-0298"/><a class="indexterm" id="IDX-CHP-3-0299"/><a class="indexterm" id="IDX-CHP-3-0300"/><a class="indexterm" id="IDX-CHP-3-0301"/><a class="indexterm" id="IDX-CHP-3-0302"/><a class="indexterm" id="IDX-CHP-3-0303"/><a class="indexterm" id="IDX-CHP-3-0304"/></p>

    <div class="figure">
      <a id="the_start_screen"/>

      <div class="figure-contents mediaobject"><a id="I_mediaobject3_d1e5174"/><img alt="The start screen" src="../Images/tagoreillycom20081104nostarchimages223786.png.jpg"/></div>

      <p class="title">Figure 3-1. The start screen</p>
    </div>

    <p>The so-called "tactical overview" (<span class="strong"><strong>Tactical Overview</strong></span>), which can be reached via the first <strong class="userinput"><code>monitoring</code></strong> link in the left menu bar, is shown in <a class="xref" href="../Text/ch03s03.html#quotation_mark_tactical_quotation_mark" title="Figure 3-2. &quot;Tactical&quot; overview of all systems and services to be monitored">Figure 3-2</a>. It summarizes the status of all tested systems.</p>

    <p>Considerably more interesting in practice, however, is the display of the menu item <span class="strong"><strong>Service Problems</strong></span> (<a class="xref" href="../Text/ch03s03.html#nagios_colon_summary_of_all_service" title="Figure 3-3. Nagios: summary of all service problems">Figure 3-3</a>). It documents the services that are currently causing problems, those that are not in the OK status, in the very sense for which Nagios was conceived: to inform the administrator precisely of any problems.</p>

    <div class="figure">
      <a id="quotation_mark_tactical_quotation_mark"/>

      <div class="figure-contents mediaobject"><a id="I_mediaobject3_d1e5199"/><img alt="&quot;Tactical&quot; overview of all systems and services to be monitored" src="../Images/tagoreillycom20081104nostarchimages223788.png.jpg"/></div>

      <p class="title">Figure 3-2. "Tactical" overview of all systems and services to be monitored</p>
    </div>

    <div class="figure">
      <a id="nagios_colon_summary_of_all_service"/>

      <div class="figure-contents mediaobject"><a id="I_mediaobject3_d1e5207"/><img alt="Nagios: summary of all service problems" src="../Images/tagoreillycom20081104nostarchimages223790.png.jpg"/></div>

      <p class="title">Figure 3-3. Nagios: summary of all service problems</p>
    </div>

    <p>The first column names the host involved. If this has a gray background, Nagios can reach the computer in principle. If the host is "down" this can be seen by the red background. For services, red stands for CRITICAL and yellow for WARNING.</p>

    <p>The second column provides the service name, the third column the status again, in plain text. Column four specifies the time of the last check. Column five is interesting—it shows how long the current status has been going on.</p>

    <p>The sixth column with the heading <span class="strong"><strong>Attempt</strong></span> reveals how often Nagios has already performed the test (unsuccessfully): <strong class="userinput"><code>3/3</code></strong> means that the error status has been confirmed for the third time in succession, but that the test is only performed three times if there is an error (parameter <strong class="userinput"><code>max_check_attempts</code></strong>, see <a class="xref" href="../Text/ch02s03.html" title="2.3 Defining the Machines to Be Monitored, with host">2.3 Defining the Machines to Be Monitored, with host</a>).</p>

    <p>Finally, the last column passes on the information from the plugin to the administrator, to whom it describes the current status in more detail. The above line in <a class="xref" href="../Text/ch03s03.html#nagios_colon_summary_of_all_service" title="Figure 3-3. Nagios: summary of all service problems">Figure 3-3</a> warns that only 21 percent of disk space is still available on drive D (service <strong class="userinput"><code>DISK_D</code></strong>) of the Windows server ELISAN01.</p>

    <div class="figure">
      <a id="an_overview_of_all_hosts_open_parenthesi"/>

      <div class="figure-contents mediaobject"><a id="I_mediaobject3_d1e5240"/><img alt="An overview of all hosts (extract)" src="../Images/tagoreillycom20081104nostarchimages223792.png.jpg"/></div>

      <p class="title">Figure 3-4. An overview of all hosts (extract)</p>
    </div>

    <p>The <strong class="userinput"><code>Host Detail</code></strong> (<a class="xref" href="../Text/ch03s03.html#an_overview_of_all_hosts_open_parenthesi" title="Figure 3-4. An overview of all hosts (extract)">Figure 3-4</a>) and <strong class="userinput"><code>Service Detail</code></strong> overviews provide an overview of all hosts and services. In practice you will be looking more precisely for information, either via a single host or on a host group or service group. The name in question is entered in the <span class="strong"><strong>Show Host</strong></span> search field. <a class="xref" href="../Text/ch03s03.html#services_to_the_host_elix01_open_parent" title="Figure 3-5. Services to the host elix01 (extract)">Figure 3-5</a> shows this using the example of the <strong class="userinput"><code>elix01</code></strong> host.<a class="indexterm" id="IDX-CHP-3-0306"/><a class="indexterm" id="IDX-CHP-3-0305"/></p>

    <p>Alternatively you can search for the names of host and service groups. An interesting variation here is to have a <span class="emphasis"><em>status grid</em></span> output shown via the link <span class="strong"><strong>Hostgroup Grid</strong></span>, which displays an overview of all hosts and their corresponding services, together with the status of these (<a class="xref" href="../Text/ch03s03.html#the_host_group_elilinux_in_the_grid_rep" title="Figure 3-6. The host group eliLINUX in the grid representation">Figure 3-6</a>). Through the color of the service (green/yellow/red), you can quickly see at a glance whether there are problems in the service group or host group that you are viewing.</p>

    <div class="figure">
      <a id="services_to_the_host_elix01_open_parent"/>

      <div class="figure-contents mediaobject"><a id="I_mediaobject3_d1e5290"/><img alt="Services to the host elix01 (extract)" src="../Images/tagoreillycom20081104nostarchimages223794.png.jpg"/></div>

      <p class="title">Figure 3-5. Services to the host <code class="userinput">elix01</code> (extract)</p>
    </div>

    <div class="figure">
      <a id="the_host_group_elilinux_in_the_grid_rep"/>

      <div class="figure-contents mediaobject"><a id="I_mediaobject3_d1e5301"/><img alt="The host group eliLINUX in the grid representation" src="../Images/tagoreillycom20081104nostarchimages223796.png.jpg"/></div>

      <p class="title">Figure 3-6. The host group <code class="userinput">eliLINUX</code> in the grid representation</p>
    </div>
  </div>
</body></html>