- en: Part VI. Part VI Appendixes
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Appendix A. An Overview of the Nagios Configuration Parameters
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Nagios contains two independent main configuration files: **`nagios.cfg`**
    controls operation of the Nagios daemon, **`cgi.cfg`** configures the Web interface.
    Both files should be located in the Nagios configuration directory, which is normally
    **`/etc/nagios`**.'
  prefs: []
  type: TYPE_NORMAL
- en: '**`nagios.cfg`** specifies a series of further configuration database and log
    files, and their functions for the respective parameter will be briefly described
    in the following reference. The notation ⇒**`parameter`** refers to the description
    of the **`parameter`** in the configuration file currently being discussed.'
  prefs: []
  type: TYPE_NORMAL
- en: Unless specified otherwise, parameters may have either the value **`0`** (disabled)
    or **`1`** (enabled). If a parameter has a default value, this is specified accordingly.
    For some path details, the standard value is defined by options during compiling.
    The values listed in this case correspond to the paths used in the book (see [Table 1-1](../Text/ch01s02.html#installation_parameters_for_nagios
    "Table 1-1. Installation parameters for Nagios"), page 40).
  prefs: []
  type: TYPE_NORMAL
- en: For some parameters there are no defaults. If these are missing from the configuration,
    Nagios does not provide the corresponding function (so, for example, without the
    **`cfg_dir`** parameter, Nagios ignores the object definitions stored in separate
    directories).
  prefs: []
  type: TYPE_NORMAL
- en: Depending on the version of Nagios you're using, not all parameters will always
    be available. (Nagios 2.x) denotes those limited to Nagios 2.x, while (Nagios
    3.0) denotes those that have been added in Nagios 3.0.
  prefs: []
  type: TYPE_NORMAL
- en: A.1 The Main Configuration File **`nagios.cfg`**
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '**`accept_passive_host_checks`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Global switch for passive host checks; the value **`0`** suppresses them. Even
    though passive host checks are allowed according to **`nagios.cfg`**, this feature
    must be explicitly enabled when defining the host object. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`accept_passive_host_checks=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`accept_passive_service_checks`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Global switch for passive service checks. Even though the value **`1`** allows
    corresponding tests, this feature must be explicitly enabled when defining the
    service object. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`accept_passive_service_checks=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`additional_freshness_latency`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Adds the latency, specified in seconds, to the fixed freshness interval. An
    upcoming freshness check (see [13.4 Reacting to Out-of-Date Information of Passive
    Checks](../Text/ch13s04.html "13.4 Reacting to Out-of-Date Information of Passive
    Checks") from page 295) is delayed by this time before it is run. Example:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`additional_freshness_latency=15`**'
  prefs: []
  type: TYPE_NORMAL
- en: The default is **`0`** (no additional delay).
  prefs: []
  type: TYPE_NORMAL
- en: '**`admin_email`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The e-mail address of the administrator responsible for the Nagios server,
    to which you have access through the macro **`$ADMINEMAIL$`**. If there is no
    explicit configuration of a contact object, Nagios will not send an e-mail to
    this address. Example (no default value):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`admin_email=nagios`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`admin_pager`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Pager number, SMS number, or e-mail address for a pager gateway/ SMS gateway
    through which the administrator of the Nagios server can be reached. Accessible
    through the macro **`$ADMINPAGER$`**. Example (no default value):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`admin_pager=pagenagios`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`aggregate_status_updates`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Specifies whether Nagios writes status information from hosts, services, and
    its own programs for the time interval **`⇒status_update_interval`** in a block
    to the **`⇒status_file`**. The value 0 means Nagios updates this file immediately
    after every event. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`aggregate_status_updates=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: Nagios 3.0 works fundamentally according to the first method, which is why the
    parameter is omitted.
  prefs: []
  type: TYPE_NORMAL
- en: '**`auto_reschedule_checks`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'With this experimental feature, Nagios spreads tests equally over the time
    period, to avoid peaks. This can considerably reduce performance and in particular
    is of no use if Nagios is already struggling to keep on schedule because of poor
    performance. Normally this option should be switched off. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`auto_reschedule_checks=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`auto_rescheduling_interval`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'In the intervals specified here, Nagios distributes tests which are to be executed
    in the next **`auto_rescheduling_window`** seconds, so that there is an equal
    load. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`auto_rescheduling_interval=30`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`auto_rescheduling_window`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'All tests that are to take place in the next number of seconds specified here
    are rescheduled by Nagios so that they are spread equally over this time period.
    Checks specified for a future time that lie outside this interval are not (yet)
    taken into account. Experimental feature; use only in exceptional cases! Default
    value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`auto_rescheduling_window=180`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`broker_module`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'This parameter integrates the specified event broker module (see [17.1 The
    Event Broker](../Text/ch17.html#the_event_broker "17.1 The Event Broker") from
    page 376) during the system start. Apart from the full path, you can also specify
    the module-specific arguments. The following example integrates the NDO event
    broker module (see also [17.4.4 Loading the Event Broker module in Nagios](../Text/ch17s04.html#loading_the_event_broker_module_in_nagio
    "17.4.4 Loading the Event Broker module in Nagios"), page 386):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`broker_module=/usr/local/nagios/bin/ndomod-3x.o config_file=/etc/ nagios/ndomod.cfg`**'
  prefs: []
  type: TYPE_NORMAL
- en: The module-specific argument **`config_file`** provides the path for its configuration
    file. To integrate several modules, just specify the parameter **`broker_module`**
    for each module separately.
  prefs: []
  type: TYPE_NORMAL
- en: '**`cached_host_check_horizon`**(Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Specifies the time in seconds in which Nagios recycles the result of a host
    check. Nagios does not repeat the test within this time frame but considers the
    cached result of the last check to still be up to date. This saves time and resources.
    Example:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`cached_host_check_liorizon=30`**'
  prefs: []
  type: TYPE_NORMAL
- en: The value **`0`** switches off caching; the default is **`15`**. How large this
    value should be depends on circumstances. Large values take considerable strain
    off Nagios, but then there is a danger that the values may become obsolete and
    will no longer be valid.
  prefs: []
  type: TYPE_NORMAL
- en: '**`cached_service_check_horizon`**(Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Like **`⇒cached_host_check_horizon`**, but Nagios uses cached service check
    results only for dependencies. This parameter therefore only has an effect on
    performance if there is a very large number of service dependency checks. Example:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`cached_service_check_horizon=30`**'
  prefs: []
  type: TYPE_NORMAL
- en: The value **`0`** switches off caching; the default is **`15`**.
  prefs: []
  type: TYPE_NORMAL
- en: '**`cfg_dir`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The directory in which the configuration files containing object definitions
    are located. Nagios searches through it recursively for configuration files with
    the extension **`.cfg`**. Files with other names are ignored, so that you can
    place help files in this directory, such as a CSV file from which host definitions
    are generated automatically by a script. To integrate individual files **`⇒cfg_file`**.
    The directive may be specified as often as you want (see also [2.1 The Main Configuration
    File nagios.cfg](../Text/ch02.html#the_main_configuration_file_nagios.cfg "2.1
    The Main Configuration File nagios.cfg"), page 55). Example (no default value
    set):'
  prefs: []
  type: TYPE_NORMAL
- en: cfg_dir=/etc/nagios/servers
  prefs: []
  type: TYPE_NORMAL
- en: '**`cfg_file`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Integrates a single file with object definitions. More on this in [2.1 The
    Main Configuration File nagios.cfg](../Text/ch02.html#the_main_configuration_file_nagios.cfg
    "2.1 The Main Configuration File nagios.cfg"), page 55\. The directive can be
    specified as often as you want. Example (no default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`cfg_file=/etc/nagios/checkcommands.cfg`**'
  prefs: []
  type: TYPE_NORMAL
- en: Nagios 3.0 allows relative paths to be set, starting from the directory in which
    the file **`nagios.cfg`** is located.
  prefs: []
  type: TYPE_NORMAL
- en: '**`check_external_commands`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Enables the interface for external commands. Necessary for passive checks or
    if commands are to be executed through the Web interface. More on this in [13.1
    The Interface for External Commands](../Text/ch13.html#the_interface_for_external_commands
    "13.1 The Interface for External Commands"), page 292\. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`check_external_commands=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`check_for_orphaned_hosts`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: Starting with Nagios 3.0, this parameter adds the host pendant to the ⇒ **`check_for_orphaned_services`**
    that already existed in Nagios 2.x.
  prefs: []
  type: TYPE_NORMAL
- en: '**`check_for_orphaned_services`**'
  prefs: []
  type: TYPE_NORMAL
- en: If the results of a service check are not received after a certain time, this
    is referred to as an *orphaned service*. Since Nagios only reschedules service
    checks if a result exists, it could be the case that a service is never again
    tested. Normally this only happens if a running service check is terminated manually
    from outside.
  prefs: []
  type: TYPE_NORMAL
- en: 'If there is a suspicion that such orphaned services have occurred, you should
    set **`check_for_orphaned_services`** to **`1`** for debugging purposes. This
    is then confirmed if Nagios writes a corresponding error entry to the log file.
    Whether this is justified or not can easily be seen in the Web interface: you
    can have all services displayed independently of their status, and sorted by the
    last test time, in ascending order. Normally the execution of an active check
    should not be longer ago than specified in **`normal_check_interval`**. Default
    value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`check_for_orphaned_services=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`check_host_freshness`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Allows a passive host check to be tested actively if no check result has arrived
    for a long time. If Nagios considers the test result to be too old, ⇒**`host_freshness_check_interval`**
    steps in. More on *freshness checking* in [13.4 Reacting to Out-of-Date Information
    of Passive Checks](../Text/ch13s04.html "13.4 Reacting to Out-of-Date Information
    of Passive Checks"), page 295\. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`check_host_freshness=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`check_result_path`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'The path in which check results are cached in file form from Nagios 3.0\. There
    should be no other files in this directory, since Nagios regularly empties it.
    Each Nagios instance requires a separate directory. Example:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`check_result_path=/var/nagios/checkresults`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`check_result_reaper_frequency`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Reaper processes gather in check results and process these for Nagios. **`check_result_reaper_frequency`**
    defines in seconds the interval at which these processes are started. A short
    interval increases the system load; a long interval could lead to delays in the
    Nagios scheduling. Example:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`check_result_reaper_frequency=5`**'
  prefs: []
  type: TYPE_NORMAL
- en: The parameter replaces ⇒service_reaper_frequency from Nagios 2.x.
  prefs: []
  type: TYPE_NORMAL
- en: '**`check_service_freslmess`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The service equivalent to **`check_host_freshness`**. The time after which
    Nagios considers the test result to be too old is defined by the parameter ⇒**`service_freshness_check_interval`**.
    Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`check_service_freslmess=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`child_process_fork_twice`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Nagios normally starts two sub-processes when service or host checks are performed.
    This is not necessary but is intended to make the system more robust against plugin
    calls that crash. Default:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`child_process_fork_twice=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: The parameter **`use_large_installation_tweaks`** ([A.1 The Main Configuration
    File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    The Main Configuration File nagios.cfg")) sets the value **`0`** (just one sub-process);
    **`child_process_fork_twice=1`** activates this, despite the fact that **`use_large_installation_tweaks`**
    is set.
  prefs: []
  type: TYPE_NORMAL
- en: '**`command_check_interval`**'
  prefs: []
  type: TYPE_NORMAL
- en: Defines the time interval in which Nagios tests the External Command File (see
    [13.1 The Interface for External Commands](../Text/ch13.html#the_interface_for_external_commands
    "13.1 The Interface for External Commands"), page 292) for new entries. For this
    to happen at all, ⇒**`check_external_coramands`** must be enabled.
  prefs: []
  type: TYPE_NORMAL
- en: A simple number as the value refers to the time unit specified by ⇒**`interval_leiigth`**
    (normally 60 seconds, so that **`1`** stands for one minute). The value **`−1`**
    means that Nagios tests the interface as often as possible. If the number is supplemented
    (without a space) with the unit s, seconds can also be explicitly specified.
  prefs: []
  type: TYPE_NORMAL
- en: 'The interval dependent on passive checks may not be too large, since the operating
    system in the External Command File, a named pipe, can normally only save 4 KB.
    Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`command_check_interval=-1`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`command_file`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The named pipe that serves as an External Command File. It should only be writable
    for the user **`nagios`** and the group **`nagcmd`** (see also [13.1 The Interface
    for External Commands](../Text/ch13.html#the_interface_for_external_commands "13.1
    The Interface for External Commands"), page 292). Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`command_file=/var/nagios/rw/nagios.cmd`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`comment_file (Nagios 2.x)`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'File in which Nagios stores the comments, which can be specified through the
    Web interface. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`comment_file=/var/nagios/comments.dat`**'
  prefs: []
  type: TYPE_NORMAL
- en: This parameter has been removed in Nagios 3.0; comments are now stored in the
    file **`status.dat`**.
  prefs: []
  type: TYPE_NORMAL
- en: '**`date_format`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The date format that Nagios displays in the Web interface or uses in the date
    and time macro. Possible values are **`us`** (**``*`mm/dd/yyyy hh:mm:ss`*``**),
    euro (**``*`dd/mm/yyyy hh:mm:ss`*``**), **`iso8601`** (**``*`yyyy-mm-dd hh:mm:ss`*``**),
    and **`strict-iso8601`** (**``*`yyyy-mm-ddThh:mm:ss`*``**). Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`date_format=us`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`downtime_file`** (Nagios 2.x)'
  prefs: []
  type: TYPE_NORMAL
- en: 'File in which the downtime details are saved, which can be specified through
    the Nagios Web interface for hosts and/or services (see [16.3 Planning Downtimes](../Text/ch16s03.html
    "16.3 Planning Downtimes"), page 359). Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`downtime_file=/var/nagios/downtime.dat`**'
  prefs: []
  type: TYPE_NORMAL
- en: This parameter has been removed in Nagios 3.0; comments are now stored in the
    file **`status.dat`**.
  prefs: []
  type: TYPE_NORMAL
- en: '**`debug_file`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'For Nagios 2.x, debugging still had to be activated when compiling (for instance,
    with **`./configure --enable-DEBUGALL`**; see **`configure --help`**). In Nagios
    3.0 this can normally be configured in **`nagios.cfg`**. **`debug_file`** defines
    the file to which the debugging output is written. Example:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`debug_file=/var/nagios/debug.log`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`debug_level`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'This defines what information is logged. The parameter has the following values,
    which can also be combined:'
  prefs: []
  type: TYPE_NORMAL
- en: '| **`−1`** all information |'
  prefs: []
  type: TYPE_TB
- en: '| **`0`** switches off debugging |'
  prefs: []
  type: TYPE_TB
- en: '| **`1`** Start/end of function calls |'
  prefs: []
  type: TYPE_TB
- en: '| **`2`** Information on the configuration |'
  prefs: []
  type: TYPE_TB
- en: '| **`4`** Information on processes |'
  prefs: []
  type: TYPE_TB
- en: '| **`8`** Scheduling details |'
  prefs: []
  type: TYPE_TB
- en: '| **`16`** Host and service checks |'
  prefs: []
  type: TYPE_TB
- en: '| **`32`** Messages |'
  prefs: []
  type: TYPE_TB
- en: '| **`64`** Event broker |'
  prefs: []
  type: TYPE_TB
- en: 'Example:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`debug_level=−1`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`debug_verbosity`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines the level of verbosity when debugging: The value **`0`** provides only
    basic information, while **`1`** information is slightly more detailed. The value
    **`2`** provides much more detailed information that is generally only of interest
    to developers. Default:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`debug_verbos ity=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`enable_embedded_perl`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Switches on the Embedded Perl Interpreter ([Appendix G](../Text/apg.html "Appendix G. The
    Embedded Perl Interpreter") from page 669), provided it has been built in. In
    Nagios 2.x a built-in Interpreter is always active, whereas Nagios 3.0 allows
    this to be set with this parameter. Example:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`enable_embedded_perl=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: switches on the Interpreter, the value **`0`** switches it off. The default
    is **`1`** if the Interpreter has been built in, otherwise **`0`**.
  prefs: []
  type: TYPE_NORMAL
- en: '**`enable_environment_macros`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Nagios standard macros, such as **`$HOSTADDRESS$`** (see [D.1.8 Using standard
    macros about the environment](../Text/apd.html#using_standard_macros_about_the_environm
    "D.1.8 Using standard macros about the environment"), page 631) can (even in Nagios
    2.x) be accessed as environment variables. In Nagios 3.0 the number of available
    macros has increased so drastically that to process them in large environments
    would lead to performance problems. Default:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`enable_environment_macros=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: The value **`0`** switches off this mechanism.
  prefs: []
  type: TYPE_NORMAL
- en: '**`enable_event_handlers`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Globally switches the option on (or off) to work with event handlers for service
    and host checks. More on this in [Appendix C](../Text/apc.html "Appendix C. Event
    Handlers"), page 619\. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`enable_event_handlers=l`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`enable_flap_detection`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines whether Nagios is generally able to detect continually changing states
    (*flap detection*, more on this in [Appendix B](../Text/apb.html "Appendix B. Rapidly
    Alternating States: Flapping"), page 611). Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`enable_flap_detection=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`enable_notifications`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines whether Nagios can send notifications. Switching off this feature normally
    only makes sense on the central hosts of a distributed installation, which themselves
    cannot generate notifications, and instead forward their test results to a central
    Nagios instance (see [Chapter 15](../Text/ch15.html "Chapter 15. Distributed Monitoring")
    from page 317). Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`enable_notifications=l`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`enable_predictive_host_dependency_checks`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Nagios 3.x caches host check results if a corresponding time frame is given
    with ⇒**`cached_host_check_horizon`**. The parameter **`enable_predictive_host_dependency_checks`**
    uses caching not only to decide between DOWN and UNREACHABLE for unreachable hosts,
    but also for host dependency checks, provided some have been defined (see [12.6.2
    Only in exceptional cases: host dependencies](../Text/ch12s06.html#only_in_exceptional_cases_colon_host_de
    "12.6.2 Only in exceptional cases: host dependencies"), page 289).'
  prefs: []
  type: TYPE_NORMAL
- en: '**`enable_predictive_service_dependency_checks`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'If this parameter is enabled (value **`1`**), service checks will use cached
    results to resolve dependencies instead of peforming the checks again. There is
    more on service dependency checks in [12.6.1 The standard case: service dependencies](../Text/ch12s06.html#the_standard_case_colon_service_depende
    "12.6.1 The standard case: service dependencies"), page 285.'
  prefs: []
  type: TYPE_NORMAL
- en: '**`event_broker_options`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The event broker as a new interface in Nagios 2.0 allows third parties to add
    some features to Nagios in the form of loadable modules, for example to save test
    results to a database instead of to a file. One application that uses the event
    broker interface is the NDOutils ([Chapter 17](../Text/ch17.html "Chapter 17. Flexible
    Web Interface with the NDOUtils") from page 375). Possible values are **`0`**
    (switched off) and **`−1`** (accept all broker modules). Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`event_broker_options=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`event_handler_timeout`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The time after which Nagios terminates the event handlers which have not yet
    finished. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`event_handler_timeout=30`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`execute_host_checks`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Enables/disables active host checks globally. This is only worth switching
    off in distributed environments with a central Nagios instance that only accepts
    passive results from other Nagios servers (see [Chapter 15](../Text/ch15.html
    "Chapter 15. Distributed Monitoring"), page 317). Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`execute_host_checks=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`execute_service_checks`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Like **`execute_host_checks`**, but for service checks. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`execute_service_checks=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`external_command_buffer_slots`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Specifies the maximum number of external commands that the external command
    file interface ([13.1 The Interface for External Commands](../Text/ch13.html#the_interface_for_external_commands
    "13.1 The Interface for External Commands") from page 292) can store temporarily.
    If the buffer is not large enough, some results might be lost. Default:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`external_command_buffer_slots=4096`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`free_child_process_memory`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: Nagios normally clears up sub-processes from the memory, but the parameter **`use_large_installation_tweaks=1`**
    (see [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")) switches off this behavior by default.
    With
  prefs: []
  type: TYPE_NORMAL
- en: '**`free_child_process_memory=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: you can reactivate the cleaning up process, despite **`use_large_installation_tweaks=1`**
    being set.
  prefs: []
  type: TYPE_NORMAL
- en: '**`global_host_event_handler`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines a global host event handler, in addition to the host-specific event
    handlers defined with **`event_handler`**. For this, both the global parameter
    ⇒**`enable_event_handlers`** as well as the parameter **`event_handler_enabled`**
    must be enabled in the host definition. Nagios executes the global event handler,
    a normal command object, before the host-specific one. Example (no default value
    set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`global_host_event_handler=`****``*`name_of_the_command-object`*``**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`global_service_event_handler`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The service-specific equivalent to **`global_host_event_handler`**. Apart from
    ⇒**`enable_event_handlers`**, the parameter **`event_handler_enabled`** in the
    service definition must also be enabled. Example (no default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`global_service_event_handler=`****``*`name_of_command_object`*``**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`high_host_flap_threshold`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Upper limit of flap detection for host checks. Details are given in [Appendix B](../Text/apb.html
    "Appendix B. Rapidly Alternating States: Flapping"), page 611\. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`high_host_flap_threshold=30.0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`high_service_flap_threshold`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Upper limit of flap detection for service checks (see [Appendix B](../Text/apb.html
    "Appendix B. Rapidly Alternating States: Flapping")). Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`high_service_flap_threshold=30.0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_check_timeout`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Time in seconds after which Nagios aborts a host check if this has not yet
    returned a result. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_check_timeout=30`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_freshness_check_interval`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Interval between two *freshness checks* in seconds. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_freshness_check_interval=60`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_inter_check_delay_method`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Controls how Nagios processes host checks after a restart. A sophisticated
    procedure aims to prevent Nagios in this situation from executing all tests simultaneously,
    and thus overloading the server. Possible values are: **`s`** (*smart*, intelligent,
    automatic distribution of the host checks), **`n`** (*no*, all checks start simultaneously),
    **`d`** (*dumb*, Nagios processes the tests at intervals of seconds), and an interval
    specified in seconds, in the format **``*`x.xx`*``**. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_inter_check_delay_method=s`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_perfdata_command`**'
  prefs: []
  type: TYPE_NORMAL
- en: A Nagios command object that should check the performance data after every host
    check. Requires the ⇒**`process_performance_data`** parameter to be set.
  prefs: []
  type: TYPE_NORMAL
- en: 'This parameter only makes sense in a few cases, since Nagios executes host
    checks only if necessary, and therefore at very irregular intervals. It is used
    if performance data are to be processed without a template ([19.1 Processing Plugin
    Performance Data with Nagios](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 Processing Plugin Performance Data with Nagios"), page 404). Example (no
    default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_perfdata_command=process-host-perfdata`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_perfdata_file`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Specifies a file or named pipe through which Nagios forwards performance data
    from host checks via a template mechanism to an external program (see [Chapter 19](../Text/ch19.html
    "Chapter 19. Graphic Display of Performance Data"), page 403). ⇒**`process_performance_data`**
    must be set. Example (no default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_perfdata_file=/tmp/host-perfdata`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_perfdata_file_mode`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines how data is passed on to the file ⇒**`host_perf data_file`**. Possible
    values are **`a`** (*append* to a normal file) or **`w`** (*write* to a new file),
    and for Nagios 3.0 also **`p`** (*non blocking write*), which is particularly
    useful for pipes. Example (no default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_perfdata_file_mode=a`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_perfdata_file_processing_command`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Nagios command object that is called after host performance data is passed
    on to the ⇒**`host_perf data_file`** interface. The parameter is only used with
    the template mechanism and is optional. Programs such as **`perf2rrd`** ([19.3
    Preparing Performance Data for Evaluation with Perf2rrd](../Text/ch19s03.html
    "19.3 Preparing Performance Data for Evaluation with Perf2rrd"), page 415) have
    their own daemon that permanently reads data from the interface. Example (no default
    value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_perfdata_file_processing_command=process-host-perfdata-file`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_perfdata_file_processing_interval`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'If this interval—specified in seconds—is larger than **`0`**, the command belonging
    to it (⇒**`host_perfdata_file_processing_command`**) is run periodically at these
    intervals. **`0`** ensures that it is not used. Example (no default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_perfdata_file_processing_interval=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_perfdata_file_template`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Describes the output format of the performance data. The Nagios macros and
    format details in it, such as **`\t`** (tabulator) or **`\n`** (linefeed) are
    replaced in the output. More on the use of templates in [19.1 Processing Plugin
    Performance Data with Nagios](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 Processing Plugin Performance Data with Nagios"), page 404\. Example (no
    default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: host_perfdata_file_template=$TIMET$\t$HOSTNAME$\t$HOST-EXECUTIONTIME$\t\$HOSTOUTPUT$\t$HOSTPERFDATA$
  prefs: []
  type: TYPE_NORMAL
- en: '**`illegal_macro_output_chars`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Lists characters that are discarded when macros are substituted for notifications,
    to avoid problems such as interpretation by the shell. The parameter has no influence
    on the substitution of macros in host or service definitions. Example (no default
    value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`illegal_macro_output_chars='' ˜$&|''"<>`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`illegal_object_name_chars`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Specifies impermissible characters in the names of Nagios objects. It is recommended
    that at least the characters listed in the following example be specified (no
    default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: illegal_object_name_chars='˜ !$%^&*|'"<>?, () =
  prefs: []
  type: TYPE_NORMAL
- en: '**`interval_length`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines the time unit in seconds to which time details in object definitions
    (such as with **`normal_check_interval`** or **`retry_check_interval`**) refer.
    If **`interval_length`** is **`60`** seconds, the time specification is **`5`**
    five minutes. You should only change the default of 60 seconds if there is good
    reason to do so. **`interval_length`** has no influence on time parameters in
    **`nagios.cfg`**, however. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`interval_length=60`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`lock_file`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Specifies a lock file for the Nagios daemon containing the process ID (PID)
    of the daemon running. Is required for start/stop purposes. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`lock_file=/var/nagios/nagios.lock`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_archive_path`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The archive directory for rotating Nagios log files. Evaluations are based
    on the archive files copied there. If one of the files is deleted, the information
    contained in it is lost. Nagios uses the directory only if log rotation is enabled
    with the ⇒**`log_rotation_method`** parameter. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_archive_path=/var/nagios/archives`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_event_handlers`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Should event handler actions appear in the log file? The parameter is used
    primarily to search for errors. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_event_handlers=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_external_commands`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Should Nagios log external commands (see [13.1 The Interface for External Commands](../Text/ch13.html#the_interface_for_external_commands
    "13.1 The Interface for External Commands"), page 292) in the log file? Default
    value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_external_commands=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_file`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The central log file. Apart from errors and problems, it also retains all events.
    All history evaluations use this file. For log rotation, Nagios provides a separate
    mechanism, with ⇒**`log_rotation_method`**, and you should not use external programs
    here. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_file=/var/nagios/nagios.log`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_host_retries`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Specifies whether Nagios should log host check repeats because of an error
    state. This is absolutely essential if event handlers (see [Appendix C](../Text/apc.html
    "Appendix C. Event Handlers"), page 619) are used which are to react to soft states.
    Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_host_retries=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_initial_states`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Specifies whether the start state of services and hosts should appear in the
    log file when the Nagios system is started. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_initial_states=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_notifications`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines whether Nagios should also log notifications in the log file. Default
    value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_notifications=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_passive_checks`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Specifies whether Nagios should log passive checks in the log file. Default
    value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_passive_checks=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_rotation_method`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines whether the log file ⇒**`log_file`** should be saved periodically to
    the archive ⇒**`log_archive_path`**. Log rotating should always be left to Nagios
    itself, rather than any external programs, or otherwise the software will have
    difficulties in evaluating history data. Possible values are **`n`** (*none*,
    no archiving), **`h`** (*hourly*, at the beginning of each hour), **`d`** (*daily*,
    each day at 00:00 hours), **`w`** (*weekly*, at midnight from Saturday to Sunday),
    and **`m`** (*monthly*, the first day of each month at 00:00 hours). Default:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_rotation_method=n`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_service_retries`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Should Nagios log the repeat of a service check because of a soft state error?
    This is useful for debugging when developing event handlers, but otherwise it
    is best to leave this out. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_service_retries=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`low_host_flap_threshold`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Lower limit for flap detection for hosts checks. Details are described in [Appendix B](../Text/apb.html
    "Appendix B. Rapidly Alternating States: Flapping"), page 611\. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`low_host_flap_threshold=20.0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`low_service_flap_threshold`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Like **`low_host_flap_threshold`**, but for service checks. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`low_service_flap_threshold=20.0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`max_check_result_file_age`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines the maximum age of a check result file in seconds, which the Reaper
    process from the directory **`check_result_path`** still processes. Older files
    are discarded. Example:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`max_check_result_file_age=1800`**'
  prefs: []
  type: TYPE_NORMAL
- en: Check results are only processed here if the accompanying file is not older
    than 30 minutes. A value of **`0`** ignores the age of the result files.
  prefs: []
  type: TYPE_NORMAL
- en: '**`max_check_result_reaper_time (Nagios 3.0)`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Restricts the runtime of an individual Reaper process to the time in seconds
    specified. Example:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`max_check_result_reaper_time=10`**'
  prefs: []
  type: TYPE_NORMAL
- en: Here the Reaper process is canceled after 10 seconds. Check results left over
    are processed by the next reaper process.
  prefs: []
  type: TYPE_NORMAL
- en: '**`max_concurrent_checks`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Specifies how many checks Nagios may execute simultaneously. The value **`0`**
    allows an unlimited number. A restriction through a value larger than zero may,
    under unfavorable circumstances, lead to the test not being executed in time.
    Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`max_concurrent_cnecks=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`max_debug_file_size (Nagios 3.0)`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Limits the size of the debugging file to the value specified in bytes. Example:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`max_debug_file_size=2048000`**'
  prefs: []
  type: TYPE_NORMAL
- en: If the size exceeds the given value, Nagios adds the ending **`.old`** to the
    file. If a file already exists with the same name, it will be deleted. You must
    therefore make provision for twice the size specified here, since there could
    be two files (with and without the suffix **`.old`**) with the maximum size at
    the same time.
  prefs: []
  type: TYPE_NORMAL
- en: '**`max_host_check_spread`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'At what time interval (in minutes) should Nagios have started all host checks
    after a restart? Prevents all tests from being executed simultaneously, which
    would overload the Nagios server. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`max_host_check_spread=30`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`max_service_check_spread`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Like **`max_host_check_spread`**, but for service checks. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`max_service_check_spread=30`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`nagios_group`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The group with whose permissions the Nagios daemon runs. Default value (is
    defined during compilation):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`nagios_group=nagios`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`nagios_user`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The user with whose permissions the Nagios daemon runs. Default value (is defined
    during compilation):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`nagios_user=nagios`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`notification_timeout`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'After how many seconds should Nagios abort the attempt to deliver a notification?
    Some actions, such as sending an SMS message, require a certain amount of time,
    since the system first waits for confirmation from the recipient. The value should
    therefore not be too low. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`notification_timeout=30`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`object_cache_file`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The file in which Nagios stores all objects after it starts. Since the Web
    interface uses this file, the normal configuration files with the object definitions
    can be edited while Nagios is running, without jeopardizing the functionality
    of the Web interface. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`object_cache_file=/var/nagios/objects.cache`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`obsess_over_hosts`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines in general whether host check results are forwarded to a central Nagios
    instance. If the parameter is enabled, the command defined in ⇒**`ocsp_commandis`**
    run. This is used in distributed environments; a description can be found in [Chapter 15](../Text/ch15.html
    "Chapter 15. Distributed Monitoring"), page 317\. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`obsess_over_hosts=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`obsess_over_services`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines in general whether service check results should be forwarded to a central
    Nagios instance. If the parameter is enabled, the command defined in ⇒**`ohcp_command`**
    is used. This feature is used in distributed environments (see [Chapter 15](../Text/ch15.html
    "Chapter 15. Distributed Monitoring"), page 317). Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`obsess_over_services=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`ochp_command`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines the *obsessive compulsive host processor*, a Nagios command object
    that forwards all host check results in a distributed environment to a central
    instance (see [Chapter 15](../Text/ch15.html "Chapter 15. Distributed Monitoring"),
    page 317). Example (no default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`ochp_command=`****``*`name_of_the_command_object`*``**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`ochp_timeout`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines the timeout for the ⇒**`ochp_command`**. After this time has expired,
    Nagios aborts the execution of the command. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`ochp_timeout=15`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`ocsp_command`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Specifies the command object that, as the *obsessive compulsive service processor*,
    should forward all service check results in a distributed environment to a central
    instance (see [Chapter 15](../Text/ch15.html "Chapter 15. Distributed Monitoring"),
    page 317). Example (no default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`ochp_command=`****``*`name_of_the_command_object`*``**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`ocsp_timeout`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The timeout for the ⇒**`ocsp_command`**. After the time specified here has
    expired, Nagios aborts the execution of the command. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`ocsp_timeout=15`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`passive_host_checks_are_soft`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: Normally, the results of passive host checks are always regarded as hard states.
    With
  prefs: []
  type: TYPE_NORMAL
- en: '**`passive_host_checks_are_soft=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: the same behavior can be set for active host checks. Assigning soft or hard
    states can now be regulated by the parameter **`max_check_attempts`** from the
    host definition.
  prefs: []
  type: TYPE_NORMAL
- en: '**`perfdata_timeout`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines after how many seconds a performance command (⇒**`host_perfdata_command`**,⇒**`service_perfdata_command`**,⇒**`host_perf-data_file_processing_command`**,
    or ⇒**`service_perfdata_file_processing_command`**) should be aborted. Default
    value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`perfdata_timeout=5`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`precached_object_file`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Starting with Nagios 3.0, it is possible to carry out reading and checking
    the configuration even before a Nagios restart and to cache the result in the
    file specified with **`precached_object_file`** (see [H.8 Restart](../Text/aphs08.html
    "H.8 Restart") from page 690). Example:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`precached_object_file=/var/nagios/objects.precache`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`process_performance_data`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Switches on processing of performance data. This parameter should be enabled
    only if performance data really is evaluated. Otherwise it only uses up resources
    on the Nagios server. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`process_performance_data=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`resource_file`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The configuration file containing the definitions of the (maximum of 32) **`$USER`**χ**`$`**
    macros. **`$USER1$`** normally specifies the path to the Nagios plugins. Otherwise
    you could save passwords here, for example, which should not be readable in the
    normal Nagios configuration files. The file must then be protected from all external
    access, and only the user **`nagios`** should be able to read it. Example (no
    default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`resource_file=/etc/nagios/resource.cfg`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`retain_state_information`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Determines whether Nagios will save current states to a file on shutdown (⇒**`state_retention_file`**)
    and read these again when it starts. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`retain_state_information=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`retention_update_interval`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Every how many minutes should Nagios store current state information in the
    ⇒**`state_retention_file`**? With a value of **`0`**, the system only saves information
    if Nagios is shut down. The parameter ⇒**`retain_state_information`** must be
    enabled for this. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`retention_update_interval=60`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_check_timeout`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Number of seconds after which Nagios aborts a service check if this has not
    returned a result by then. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_check_timeout=60`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_freshness_check_interval`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Interval between two freshness checks in seconds. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_freshness_check_interval=60`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_inter_check_delay_method`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Controls how Nagios processes service checks after a restart. An "intelligent"
    procedure should prevent them from all starting at the same time, to avoid putting
    an unnecessary load on the server. Possible values are **s** (*smart*, automatic
    distribution), **n** (*no*, start all tests simultaneously!), **d** (*dumb*, one
    second interval between checks), as well as an explicitly specified interval in
    seconds, in the form *x. xx*. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_inter_check_delay_method=s`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_interleave_factor`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Prevents the checks accumulating for a specific host from being executed at
    the same time (⇒**`max_concurrent_checks`**, 598), through Nagios distributing
    the planned checks for all hosts "intelligently" over a period of time. Possible
    values are **s** (*smart*, automatic distribution) or an integer larger than 0\.
    With a value of **`1`**, Nagios does not carry out any distribution, with a value
    of **4**, Nagios initially plans every fourth service check (that is, from the
    amount of intended checks, the 1st, 5th, 9th, etc.), then the following number
    (that is, the 2nd, 6th, 10th, etc.), and so on. The test sequence is shown by
    the **Service Detail** item in the Web interface. In case of doubt, the default
    value can be left as it is:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_interleave_factor=s`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_perfdata_command`**'
  prefs: []
  type: TYPE_NORMAL
- en: The Nagios command object that is run after each service check to process performance
    data. A requirement for this is that ⇒**`process_performance_data`** must be set.
  prefs: []
  type: TYPE_NORMAL
- en: 'The parameter is used if the performance data is to be processed without a
    template ([19.1 Processing Plugin Performance Data with Nagios](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 Processing Plugin Performance Data with Nagios"), page 404). Example (no
    default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_perfdata_command=process-service-perfdata`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_perfdata_file`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Path to the file or named pipe through which Nagios forwards performance data
    from service checks via a template mechanism to an external program. This only
    works if ⇒**`process_performance_data`** is set. More on processing performance
    data in [Chapter 19](../Text/ch19.html "Chapter 19. Graphic Display of Performance
    Data"), page 403\. Example (no default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_perfdata_file=/tmp/service-perfdata`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_perfdata_file_mode`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines the mode in which data is passed on to ⇒**`service_perfdata_file`**.
    Possible values are **a** (*append* to a normal file), **w** (*write* to a new
    file) and in Nagios 3.0 **p** as well (*non-blocking write*), which is useful
    for pipes. Example (no default value):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_perfdata_file_mode=a`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_perfdata_file_processing_command`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'A command object that is executed after Nagios has passed on service performance
    data to the ⇒**`service_perfdata_file`**. The parameter is optional and is only
    used together with the template mechanism. As long as programs that further process
    the data, such as **`perf2rrd`** ([19.3 Preparing Performance Data for Evaluation
    with Perf2rrd](../Text/ch19s03.html "19.3 Preparing Performance Data for Evaluation
    with Perf2rrd"), page 415), include their own service that permanently reads out
    the **`service_perfdata_file`**, you can manage without defining a command for
    reading out. See also [Chapter 19](../Text/ch19.html "Chapter 19. Graphic Display
    of Performance Data"), page 403\. Example (no default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_perfdata_file_processing_command=process-service-perfdata-file`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_perfdata_file_processing_interval`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Interval in seconds in which the command defined in ⇒**`service_perfdata_file_processing_command`**
    is periodically run. Setting the value **`0`** ensures that it is never used.
    Example (no default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_perfdata_file_processing_interval=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_perfdata_file_template`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The output format for performance data; Nagios macros and format details such
    as **`\t`** (tabulator) or **`\n`** (linefeed) are substituted in the output.
    See also [19.1 Processing Plugin Performance Data with Nagios](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 Processing Plugin Performance Data with Nagios"), page 404\. Example (no
    default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_perfdata_file_template=$TIMET$\t$HOSTNAME$\t$SERVICEDESC$\t$SERVICEEXECUTIONTIME$\t$SERVICELATENCY$\t$SERVICEOUTPUT$\t$SERVICEPERFDATA$`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_reaper_frequency`** (Nagios 2.x)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Every how many seconds should Nagios process accumulated service test results?
    Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_reaper_frequency=10`**'
  prefs: []
  type: TYPE_NORMAL
- en: In Nagios 3.0 the corresponding parameter is called ⇒check_result_reaper_frequency
    and influences not only service checks but also host checks.
  prefs: []
  type: TYPE_NORMAL
- en: '**`sleep_time`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Pause in seconds for which Nagios waits before searching again in the scheduling
    queue for checks to be performed. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`sleep_time=0.5`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`state_retention_file`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The file in which Nagios stores status information on shutdown, and from which
    the information is read in again when Nagios is started. This is used only if
    the ⇒**`retain_state_information`** parameter is set. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`state_retention_file=/var/nagios/retention.dat`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`status_file`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Path to the file in which Nagios saves all current status values and from which
    the Web interface retrieves them. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`status_file=/var/nagios/status.dat`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`status_update_interval`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'At what interval should Nagios store status values in the file⇒**`status_file`**?
    If ⇒**`aggregate_status_updates`** is not set, the system ignores this parameter
    and immediately writes the status values to this file (not recommended). Default
    value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`status_update_interval=60`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`temp_file`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Path to a temporary file that Nagios uses if necessary, and deletes each time
    when it no longer requires it. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`temp_file=/var/nagios/tempfile`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`temp_path`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'A directory in which Nagios may store temporary files. The directory should
    be emptied regularly. Example:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`temp_path=/tmp`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`translate_passive_host_checks`**(Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Determines whether Nagios should translate the result of a passive host check
    from a topological perspective to DOWN or UNREACHABLE. The default is "no":'
  prefs: []
  type: TYPE_NORMAL
- en: '**`translate_passive_host_checks=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: Passive host checks are often used in distributed environments, and Nagios does
    not have all the information concerning the topological structure of these environments.
    In that case, the default makes sense. The value 1 switches the translation to
    DOWN or UNREACHABLE.
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_aggressive_host_checking`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Nagios makes a number of assumptions in deciding whether unreachable hosts
    are DOWN or UNREACHABLE. If this parameter is set to the value **1**, Nagios is
    very particular in the host check and in some circumstances may perform considerably
    more individual checks. Although the result will be more precise, this puts quite
    a strain on the system. This parameter should only be set if there are problems
    in detecting failed hosts. Default:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_aggressive_host_checking=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_embedded_perl_implicitly`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: Automatically runs all Perl scripts in the Embedded Perl Interpreter, provided
    the script itself does not contain an explicit instruction to avoid the Interpreter.
    More on this in [G.2 Using ePN](../Text/apgs02.html "G.2 Using ePN"), page 672.
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_large_installation_tweaks`**(Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'This parameter covers a number of settings intended to improve the performance
    of Nagios in large environments. The following entry switches it on:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_large_installation_tweaks=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: There is more on this in [F.2.7 Optimizing large Nagios environments](../Text/apfs03.html#optimizing_large_nagios_environmen
    "F.2.7 Optimizing large Nagios environments"), page 667.
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_regexp_matching`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines whether the wildcards **`*`** (any character) and **`?`** (a single
    character) are allowed in object definitions. If you want to work with regular
    expressions, ⇒**`use_true_regexp_matching`** must be used. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_regexp_matching=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_retained_program_state`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Should changes to the parameters ⇒**`enable_notifications`**, ⇒**`en-able_flap_detection`**,
    ⇒**`enable_event_handlers`**, ⇒**`execute_service_checks`** and ⇒**`accept_passive_service_checks`**
    on the Web interface survive a Nagios restart? Only works if ⇒**`retain_status_informationis`**
    enabled. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_retained_program_state=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_retained_scheduling_info`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Should Nagios save current scheduling information on shutdown so it can read
    it in again when it restarts? You can temporarily disable the parameter if you
    are adding a large number of tests; otherwise it is sensible to keep it enabled.
    Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_retained_scheduling_info=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_syslog`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Ensures logging of all Nagios activities in the syslog. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_syslog=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_timezone`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Explicitly sets a time zone for Nagios. Normally, Nagios uses the time zone
    of the system on which it is running. This parameter is only required if several
    instances for different time zones are being run on one host. Example:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_timezone=Europe/Berlin`**'
  prefs: []
  type: TYPE_NORMAL
- en: The relative path for the desired zone information file is specified, usually
    in **`/usr/lib/zoneinfo`** or **`/usr/share/zoneinfo`**.
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_true_regexp_matching`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'In contrast to ⇒**`use_regexp_matching`**, allows the use of real regular expressions
    in accordance with the POSIX standard.^([[304](#ftn.APP-A-FN-1)]) Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_true_regexp_matching=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[304](#APP-A-FN-1)]) See man 7 regex.
  prefs: []
  type: TYPE_NORMAL
- en: A.2 CGI Configuration in **`cgi.cfg`**
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A.2.1 Authentication parameters
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Through the contact and the contact group, Nagios allocates responsibilities
    to users from which permissions for the Web interface can likewise be inferred:
    each contact may normally only see those hosts and services for which he is also
    responsible. This is why the name of the Web login must match the contact name.'
  prefs: []
  type: TYPE_NORMAL
- en: The parameters listed below work around this concept to some extent. They are
    not intended to solve problems, however, caused by contact and Web user names
    not matching.
  prefs: []
  type: TYPE_NORMAL
- en: cmduse_authentication
  prefs: []
  type: TYPE_NORMAL
- en: Determines whether you normally need to log in to the Web interface. Like the
    user name, the contact name is always used; how you store passwords is described
    in [1.5 Configuration of the Web Interface](../Text/ch01s05.html "1.5 Configuration
    of the Web Interface"), page 47.
  prefs: []
  type: TYPE_NORMAL
- en: 'In general you should never permit this authentication, but if you do, you
    should make sure that the interface for external commands ([13.1 The Interface
    for External Commands](../Text/ch13.html#the_interface_for_external_commands "13.1
    The Interface for External Commands"), page 292) is switched off completely. Default:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_authentication=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`authorized_for_all_host_commands`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Allows the users specified here to run commands through the Web interface for
    all hosts, without them belonging to the appropriate contact group. Example (no
    default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`authorized_for_all_host_commands=nagiosadmin`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`authorized_for_all_hosts`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Allows the users specified here to look at all host information, irrespective
    of their actual responsibility Example (no default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`authorized_for_all_hosts=nagiosadmin.guest`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`authorized_for_all_service_commands`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Allows the users defined here to run commands for all services via the Web
    interface, independently of membership of contact groups. Example (no default
    value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`authorized_for_all_service_commands=nagiosadmin`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`authorized_for_all_services`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Allows the users specified to view all service information, irrespective of
    their own permissions. Example (no default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`authorized_for_all_services=nagiosadmin,guest`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`authorized_for_configuration_information`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Enables the users specified to view all configuration data via the Web interface.
    This should be reserved for the Nagios administrators. Example (no default value
    set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`authorized_for_configuration_information=nagiosadmin,jdoe`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`authorized_for_system_commands`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Allows the specified users to shut down or restart Nagios via the Web interface.
    Normally, nobody has this authorization. Example (no default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`authorized_for_system_commands=nagiosadmin`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`authorized_for_system_information`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Allows the specified users to view Nagios process information. Normally, nobody
    may do this. Example (no default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`authorized_for_system_information=nagiosadmin,theboss,jdoe`**'
  prefs: []
  type: TYPE_NORMAL
- en: A.2.2 Other Parameters
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**`action_url_target`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Sets the HTML tag **`target`** for an action URL (see [16.4.1 Extended host
    information](../Text/ch16s04.html#extended_host_information "16.4.1 Extended host
    information")). The default is **`blank`**, which opens a new window:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`action_url_target=blank`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`default_statusmap_layout`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines the layout for the status map. Possible values are **0** (coordinates
    defined through a **hostextinfo** object), **1** (the user must move by mouse
    click from one layer to the next one), **2** (compressed tree—somewhat confusing,
    because branches cut across each other in the picture), **3** (balanced tree,
    the branches are displayed so that there are no crossovers in the graphic—clearer,
    but requires much space), **4** (circular representation, with Nagios at the center:
    hosts that can be reached directly^([[305](#ftn.APP-A-FN-2)]) are shown in the
    inner circle, while on other circles are located those hosts that can be reached
    from hosts already entered in the graphic), **5** (circular, like **4**; the area
    around the host is marked in color—gray for OK, red for DOWN or UNREACHABLE; Figure
    A.27 in [16.2.4 The most important things at a glance: tac.cgi](../Text/ch16s02.html#the_most_important_things_at_a_glance_c
    "16.2.4 The most important things at a glance: tac.cgi") shows an example), and
    **6** (circular; the hosts are shown as balloons). The settings can also be changed
    in the Web interface without the need to adjust the configuration file each time,
    which makes it easier to try things out. Example:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`default_statusmap_layout=5`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`default_statuswrl_layout`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Determines the layout for the VRML representation of the status page through
    **`statuswrl.cgi`**. Possible values are **0**, **2**, **3**, and **4**; the corresponding
    appearance is based on the values of the same name for ⇒**`default_statusmap_layout`**.
    Example:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`default_statuswrl_layout=4`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`default_user_name`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Name of a guest user who may use the Web pages without authentication. You
    should only use this parameter if the Web server is protected from unauthorized
    access, and you should look closely at what permissions this user is allocated
    through the contact groups. Example (no default value set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`default_user_name=guest`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`enable_splunk_integration`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: Activates integration of the Splunk tool, a search engine for log files.^([[306](#ftn.APP-A-FN-3)])
  prefs: []
  type: TYPE_NORMAL
- en: '**`escape_html_tags`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'The value **1** disables HTML formatting in the plugin output:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`escape_html_tags=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: Corresponding formatting thus has no effect. The default is **`0`**, which causes
    HTML formatting to be passed on.
  prefs: []
  type: TYPE_NORMAL
- en: '**`lock_author_name`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: For various CGI actions, such as setting acknowledgements, an author name is
    specified. With the setting
  prefs: []
  type: TYPE_NORMAL
- en: '**`lock_author_names=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: this can no longer be changed (the default is the user logged in).
  prefs: []
  type: TYPE_NORMAL
- en: '**`main_config_file`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The Nagios main configuration file. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`main_config_file=/etc/nagios/nagios.cfg`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`notes_url_target`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Sets the HTML tag **`target`** for Notes URLs (see [16.4.1 Extended host information](../Text/ch16s04.html#extended_host_information
    "16.4.1 Extended host information")). The default is **`blank`**, which opens
    a new window:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`notes_url_target=blank`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`physical_html_path`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Path in the file system that leads to the Nagios directory for documentation
    and images. See also ⇒**`url_html_path`**. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`physical_html_path=/usr/local/nagios/share`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`refresh_rate`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Specifies at what intervals the Web page is automatically updated. Default
    value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`refresh_rate=60`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`splunk_url`** (Nagios 3.0)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Defines the URL for the Splunk search engine. Example:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`splunk_url=http://127.0.0.1:8000/`**'
  prefs: []
  type: TYPE_NORMAL
- en: The parameter ⇒**`enable_splunk_integration`** ([A.2.2 Other Parameters](../Text/apas02.html#other_parameters
    "A.2.2 Other Parameters")) must also be enabled for this.
  prefs: []
  type: TYPE_NORMAL
- en: '**`statusmap_background_image`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The background image for the status map display. Example (no default value
    set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`statusmap_background_image=smbackground.gd2`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`statuswrl_include`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'A file with its own VRML objects used in the VRML representation. The path
    is specified relative to ⇒**`html_physical_path`**. Example (no default value
    set):'
  prefs: []
  type: TYPE_NORMAL
- en: '**`statuswrl_include=myworld.wrl`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**`url_html_path`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The logical path to the Nagios documents and images from the point of view
    of the browser, starting from the document root of the Web server. If you use
    this path in a URL, you will be taken to the Nagios start page. Default value:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`url_html_path=/nagios`**'
  prefs: []
  type: TYPE_NORMAL
- en: '**``**`use_pending_states`** (Nagios 3.0)``**'
  prefs: []
  type: TYPE_NORMAL
- en: How should hosts and services be displayed in the Web interface if no check
    has yet taken place for this?
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_pending_states=1`**'
  prefs: []
  type: TYPE_NORMAL
- en: shows unchecked hosts and services with the state **`PENDING`**; the value **`0`**
    can be left as it is.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[305](#APP-A-FN-2)]) That is, without the "diversion" via parents.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[306](#APP-A-FN-3)]) [http://www.splunk.com/](http://www.splunk.com/)
  prefs: []
  type: TYPE_NORMAL
- en: 'Appendix B. Rapidly Alternating States: Flapping'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If the state of a host or service keeps on changing over and over, Nagios inundates
    the administrator with a flood of problem and recovery messages, which can not
    only be very irritating but also distract the administrator's attention from other,
    perhaps more urgent problems.
  prefs: []
  type: TYPE_NORMAL
- en: With a special mechanism, Nagios quickly recognizes alternating states and can
    inform the administrator of these selectively. The Nagios documentation refers
    to such alternating states as *state flapping* and to their detection as *flap
    detection*.
  prefs: []
  type: TYPE_NORMAL
- en: 'Whether these alternating states involve hosts or services has no influence
    on the detection mechanism itself. The differences are more to be found in the
    nature of host and service checks: Nagios carries out service checks periodically,
    and therefore regularly. In this way the system continuously receives new information
    on the current status. Regular host checks only make sense from Nagios 3.0 onward
    (see [H.7 A New Logic for Host Checks](../Text/aphs07.html "H.7 A New Logic for
    Host Checks") from page 689). In Nagios 2.x, host checks generally take place
    only if needed, so Nagios has to obtain the appropriate information in other ways.'
  prefs: []
  type: TYPE_NORMAL
- en: B.1 Flap Detection with Services
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: To detect alternating states you need a complete list of all states that occurred
    during the last service checks. For this purpose Nagios stores the last 21 test
    results for each service and then overwrites the oldest value in each case in
    the memory. In these 21 states, a maximum of 20 changes can occur.
  prefs: []
  type: TYPE_NORMAL
- en: '[Figure B-1](../Text/apb.html#nagios_saves_the_last_21_states_to_detec "Figure B-1. Nagios
    saves the last 21 states to detect frequently alternating states. This service
    changed its state twelve times") shows an example. The x-axis numbers the possible
    alternating states in each case from 1 to 20, and the heads of the arrow indicate
    alternating states that have actually occurred.'
  prefs: []
  type: TYPE_NORMAL
- en: '![Nagios saves the last 21 states to detect frequently alternating states.
    This service changed its state twelve times](../Images/tagoreillycom20081104nostarchimages224014.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure B-1. Nagios saves the last 21 states to detect frequently alternating
    states. This service changed its state twelve times
  prefs: []
  type: TYPE_NORMAL
- en: In the period specified, the state of the system shown changed 12 times out
    of a possible 20, which as a percentage is 60 percent. At 0 percent, not one alternation
    state has taken place, and 100% means that the service really was in a different
    state every time it was recorded.
  prefs: []
  type: TYPE_NORMAL
- en: When determining the percentage value, Nagios assigns less significance to older
    changes of state than to more recent ones. Accordingly it weights the oldest change
    in state at **`1`** in [Figure B-1](../Text/apb.html#nagios_saves_the_last_21_states_to_detec
    "Figure B-1. Nagios saves the last 21 states to detect frequently alternating
    states. This service changed its state twelve times") with 0.8, and the most recent
    at **`20`** with 1.2\. From left to right, the factor increases each time by approx.
    0.02,^([[307](#ftn.APP-B-FN-1)]) resulting in a linear progression.
  prefs: []
  type: TYPE_NORMAL
- en: 'This weighting does not have any major effects on the end result in this example:
    for [Figure B-1](../Text/apb.html#nagios_saves_the_last_21_states_to_detec "Figure B-1. Nagios
    saves the last 21 states to detect frequently alternating states. This service
    changed its state twelve times"), this results in 62.21 percent (instead of 60),
    a slight shift, since the state in the second half changed more often. If there
    was only a single change of state at **`20`**, the weighting would have the most
    effect: instead of 5% (that is, one change out of a possible 20) this would result
    in 5 * 1.2 = 6 percent.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Using threshold values which can be defined—two for services, two for hosts—Nagios
    defines whether a service or host is "flapping". Both the upper and lower limits
    are specified as percentages. If the detected change state exceeds the upper threshold,
    Nagios categorizes the service as *flapping*. This has consequences: Nagios logs
    the event in the log file, adds a nonpermanent comment,^([[308](#ftn.APP-B-FN-2)])
    and stops any notifications concerning this from being sent.'
  prefs: []
  type: TYPE_NORMAL
- en: If the percentage value falls below the lower limit, the system undoes this
    step; that is, the comment disappears, notifications are sent again, and the result
    also appears in the log file.
  prefs: []
  type: TYPE_NORMAL
- en: B.1.1 Nagios configuration
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Flap detection is configured at two locations: in the central configuration
    file and in the definition of the service object. In **`nagios.cfg`** the feature
    is switched on generally with the parameter **`enable_flap_detection`**, and global
    limit values are also defined here, which will always apply if nothing else is
    defined for the service in question:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: The value **`1`** set here for **`enable_flap_detection`** enables flap detection,
    and **`0`** switches it off.
  prefs: []
  type: TYPE_NORMAL
- en: The lower limit **`low_service_flap_threshold`** lies at 5 percent in this case,
    the upper **`high_service_flap_threshold`** limit at 20\. This means that Nagios
    categorizes a service as flapping if the history saved detects at least five changes
    in state (more than four out of a possible 20).^([[309](#ftn.APP-B-FN-3)]) The
    lower five percent limit corresponds to one change in state. To drop below this,
    all 21 states must be identical.^([[310](#ftn.APP-B-FN-4)])
  prefs: []
  type: TYPE_NORMAL
- en: 'In the definition of a service object, you have another chance to decide whether
    flap detection is desired in this case. You also have an option to specify threshold
    values for this service that differ from the global settings:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: The value **`1`** in **`flap_detection_enabled`** switches on the feature for
    this service, and **`0`** (the default) switches it off. The two limit values
    **`low_flap_threshold`** and **`high_flap_threshold`** define the limit values
    that override the globally defined values. If they are set to **`0`**, or are
    omitted, the global thresholds will apply.
  prefs: []
  type: TYPE_NORMAL
- en: Starting with Nagios 3.0, the parameter **`flap_detection_options`** enables
    only specified states to be taken into account when detecting changes in states.
    Possible values are **`o`** (OK), **`w`** (WARNING), **`c`** (CRITICAL), and **`u`**
    (UNKNOWN). The default is
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: If the values are restricted to **`w`**, **`c`**, only WARNING and CRITICAL
    play a role in detection; the other states are ignored. Nagios 3.0 also saves
    states when flap detection is switched off globally and introduces a corresponding
    new message type. More on this in [H.4 Rapidly Changing States](../Text/aphs04.html
    "H.4 Rapidly Changing States") from page 687.
  prefs: []
  type: TYPE_NORMAL
- en: B.1.2 The history memory and the chronological progression of the changes in
    state
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Since the history only saves hard states and soft recovery, the sections on
    the x-axis cannot be allocated so easily on a chronological basis, because the
    intervals between possible changes of state are not equal. Assuming that the service
    object has the following definitions:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: Nagios checks the service two more times after a change in state from OK to
    WARNING has taken place, before the service changes to the hard state WARNING
    (state 1 in [Figure B-1](../Text/apb.html#nagios_saves_the_last_21_states_to_detec
    "Figure B-1. Nagios saves the last 21 states to detect frequently alternating
    states. This service changed its state twelve times") in page 612). Since the
    last check, which returned OK, a total of seven minutes^([[311](#ftn.APP-B-FN-5)])
    has elapsed, since the two soft states after five and six minutes are not included
    in the history.
  prefs: []
  type: TYPE_NORMAL
- en: If the next service check, as in [Figure B-1](../Text/apb.html#nagios_saves_the_last_21_states_to_detec
    "Figure B-1. Nagios saves the last 21 states to detect frequently alternating
    states. This service changed its state twelve times"), again detects a WARNING
    (i.e., the state does not change this time), then only five minutes elapse this
    time between states 1 and 2\. The x-axis therefore only illustrates time in a
    linear form in exceptional circumstances—if no change of state occurs, for example.
  prefs: []
  type: TYPE_NORMAL
- en: B.1.3 Representation in the Web interface
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Services that Nagios categorizes as flapping are visible in the Web interface
    at three points: in the summaries generated by **`tac.cgi`** ([16.2.4 The most
    important things at a glance: tac.cgi](../Text/ch16s02.html#the_most_important_things_at_a_glance_c
    "16.2.4 The most important things at a glance: tac.cgi"), page 345) and **`status.cgi`**
    ([16.2.1 Variations in status display: status.cgi](../Text/ch16s02.html#variations_in_status_display_colon_stat
    "16.2.1 Variations in status display: status.cgi"), page 334), as well as on the
    information page created by **`extinfo.cgi`** ([16.2.2 Additional information
    and control center: extinfo.cgi](../Text/ch16s02.html#additional_information_and_control_cent
    "16.2.2 Additional information and control center: extinfo.cgi"), page 339).'
  prefs: []
  type: TYPE_NORMAL
- en: 'The quickest way to get there is through **`tac.cgi`** ([Figure B-2](../Text/apb.html#tac.cgi_notes_changing_states_in_section
    "Figure B-2. tac.cgi notes changing states in section Monitoring Features")):
    a link in the **`Monitoring Features`** section marked by **`x Services Flapping`**
    takes you to the status overview of services which continually change their state.
    The status overview shown in [Figure B-3](../Text/apb.html#animated_horizontal_bars_denote_flapping
    "Figure B-3. Animated horizontal bars denote flapping states") can also be opened
    directly with **`status.cgi?host=all&style=detail&serviceprops=1024`**.'
  prefs: []
  type: TYPE_NORMAL
- en: '**`serviceprops=1024`** describes all services that Nagios categorizes as flapping.
    **`style=detail`** provides a detailed view (in contrast to **`overview`**, as
    can be seen in Figure B.10 in [16.2 An Overview of the Individual CGI Programs](../Text/ch16s02.html
    "16.2 An Overview of the Individual CGI Programs")), and **`host=all`** includes
    all hosts.'
  prefs: []
  type: TYPE_NORMAL
- en: '![tac.cgi notes changing states in section Monitoring Features](../Images/tagoreillycom20081104nostarchimages224016.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure B-2. `tac.cgi` notes changing states in section `Monitoring Features`
  prefs: []
  type: TYPE_NORMAL
- en: In the status view in [Figure B-3](../Text/apb.html#animated_horizontal_bars_denote_flapping
    "Figure B-3. Animated horizontal bars denote flapping states"), a white field
    with several horizontal gray bars moving to and fro reveal that a flapping service
    is involved. At the same time a white speech bubble denotes the existence of a
    comment on this (generated automatically by Nagios).
  prefs: []
  type: TYPE_NORMAL
- en: '![Animated horizontal bars denote flapping states](../Images/tagoreillycom20081104nostarchimages224018.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure B-3. Animated horizontal bars denote flapping states
  prefs: []
  type: TYPE_NORMAL
- en: 'If you click in the status view on the flapping icon next to the service in
    question, **`extinfo.cgi`** generates additional information on the service ([Figure B-4](../Text/apb.html#percent_state_change_colon_reveals_how_o
    "Figure B-4. Percent State Change: reveals how often the hard state changed, as
    a percentage")), showing the changes in state in percent next to the flapping
    category, depicted by a red bar labeled with **YES**.'
  prefs: []
  type: TYPE_NORMAL
- en: '![Percent State Change: reveals how often the hard state changed, as a percentage](../Images/tagoreillycom20081104nostarchimages224020.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure B-4. `Percent State Change`: reveals how often the hard state changed,
    as a percentage'
  prefs: []
  type: TYPE_NORMAL
- en: The page also contains the nonpermanent comment generated by Nagios ([Figure B-5](../Text/apb.html#with_this_comment_comma_nagios_categoriz
    "Figure B-5. With this comment, Nagios categorizes a service as flapping")), which
    points out that the sending of messages has been stopped until the status of the
    service becomes stable again. It disappears, therefore, when Nagios is restarted.
  prefs: []
  type: TYPE_NORMAL
- en: '![With this comment, Nagios categorizes a service as flapping](../Images/tagoreillycom20081104nostarchimages224022.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure B-5. With this comment, Nagios categorizes a service as flapping
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[307](#APP-B-FN-1)]) (1.2–0.8)/19=0.0211
  prefs: []
  type: TYPE_NORMAL
- en: ^([[308](#APP-B-FN-2)]) Nonpermanent comments disappear after the monitoring
    system is restarted, but permanent ones remain.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[309](#APP-B-FN-3)]) If the changes in state took place recently, the weighting
    would ensure that four changes in state would already be enough to exceed the
    20 percent limit.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[310](#APP-B-FN-4)]) If a single change of state takes place in the first
    half, the weighting results in a value of less than 5 percent.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[311](#APP-B-FN-5)]) 5 5+2*1=7
  prefs: []
  type: TYPE_NORMAL
- en: B.2 Flap Detection for Hosts
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Nagios tries to detect changing states of a host in two ways: in the host check
    itself (either in the context of the active check from Nagios 3.0 or in on-demand
    checks), and also if a service check for a host was performed, the last flap detection
    of which took place some time ago. When Nagios next performs a service check to
    detect a changing state is determined by the average value for all service check
    intervals.'
  prefs: []
  type: TYPE_NORMAL
- en: Regular host checks are also not necessary from Nagios 3.0 onward, and recent
    versions of Nagios manage perfectly well without them. For reasons of performance,
    they really should be avoided in Nagios 2.x ([4.2 On-Demand Host Checks vs. Periodic
    Reachability Tests](../Text/ch04s02.html "4.2 On-Demand Host Checks vs. Periodic
    Reachability Tests"), page 95). By making use of a trick to perform service checks
    only when required, Nagios compensates for the fact that regular host check results
    are missing. If at least one service check returns an OK, Nagios concludes from
    this that the host is also reachable and is in an OK state. The results of flap
    detection are stored by Nagios in the history.
  prefs: []
  type: TYPE_NORMAL
- en: The same flap detection mechanism is used for hosts as for services. So the
    difference is only in how Nagios determines the corresponding data basis.
  prefs: []
  type: TYPE_NORMAL
- en: 'Whether flap detection is desired for hosts is revealed by the central configuration
    file **`nagios.cfg`** and the definition of the host objects. The global parameter
    **`enable_flap_detection`**, which applies equally to hosts and services, must
    be set to **`1`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: The threshold parameters for hosts include **`host`** in their names, but they
    have the same effect as their **`service`** equivalents.^([[312](#ftn.APP-B-FN-6)])
  prefs: []
  type: TYPE_NORMAL
- en: 'For the host object itself, detection is switched on with **`flap_detection_enabled`**
    **`1`** and off with **`0`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: The optional parameters **`low_flap_threshold`** and **`high_flap_threshold`**
    allow for host-specific thresholds. If these are omitted, the global threshold
    values are used.
  prefs: []
  type: TYPE_NORMAL
- en: As for service checks, Nagios from 3.0 onward also has the additional **`flap_detection_options`**
    parameter here. Possible values in the host definition are **`o`** (OK), **`d`**
    (DOWN), and **`u`** (UNREACHABLE). Only the states specified for the parameter
    are used in flap detection, and if this parameter is not given, then all possible
    states are used.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[312](#APP-B-FN-6)]) See [B.1 Flap Detection with Services](../Text/apb.html#flap_detection_with_services
    "B.1 Flap Detection with Services").
  prefs: []
  type: TYPE_NORMAL
- en: Appendix C. Event Handlers
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If the state of a host or service alternates between OK and error states, you
    can use an *event handler* to run any programs you want. You can make use of this
    if a service fails, for example, and you want Nagios to try and restart it. This
    provides an opportunity to solve minor problems without the administrator needing
    to intervene.
  prefs: []
  type: TYPE_NORMAL
- en: 'Use of the *event handlers* is not just restricted to self-healing, however:
    with an appropriate script you can just as easily log current values or the event
    itself in a database. But there are more suitable methods for doing this, described
    in [19.1 Processing Plugin Performance Data with Nagios](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 Processing Plugin Performance Data with Nagios"), page 404\. A failed printer
    service serves as an example here of using an event handler for self-healing.
    In this example the printer service **`lpd`** is used, but this method can be
    applied in general to any service for which a start-stop script is available.'
  prefs: []
  type: TYPE_NORMAL
- en: C.1 Execution Times for the Event Handler
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The following parameters in the service definition ensure that Nagios tests
    the service under normal circumstances every five minutes, but in cases of error,
    every two minutes:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: An error state becomes hard after four tests leading to the same result.
  prefs: []
  type: TYPE_NORMAL
- en: '![When does Nagios run the event handler?](../Images/tagoreillycom20081104nostarchimages224024.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure C-1. When does Nagios run the event handler?
  prefs: []
  type: TYPE_NORMAL
- en: '[Figure C-1](../Text/apc.html#when_does_nagios_run_the_event_handler_q "Figure C-1. When
    does Nagios run the event handler?") shows an example of the change of the **`lpd`**
    service from an OK state to CRITICAL, and back again. After 10 minutes test No.
    2 detects that the service is no longer available. The soft state that results
    causes Nagios to examine **`lpd`** more closely at two-minute intervals (checks
    No. 3, 4, and 5). Test No. 5 returns a CRITICAL for the fourth time, causing Nagios
    to categorize this as a hard state and to go back to the normal, five-minute test
    interval. In check No. 7 the service is functioning again, and the state changes
    from CRITICAL to OK (for hard state, see [4.3 States of Hosts and Services](../Text/ch04s03.html
    "4.3 States of Hosts and Services"), page 96.).'
  prefs: []
  type: TYPE_NORMAL
- en: Event handlers are carried out by Nagios for soft error states (in checks No.
    2, 3, 4), the first time a hard error state occurs (in check No. 5), and in the
    resetting of the OK state after an error (irrespective of whether this is a hard
    or soft recovery).
  prefs: []
  type: TYPE_NORMAL
- en: Since hard error states lead to the administrator being notified, it is recommended
    that the repair attempt is moved to the time of the soft error states. If it succeeds
    at this point in time, the administrator is spared these minor details. Ideally
    the service will be running again before a user even notices that it has failed.
  prefs: []
  type: TYPE_NORMAL
- en: The fact that Nagios only executes the event handler when a hard error state
    first occurs prevents periodic attempts at repair that do not lead to the desired
    result after all (if the attempt had succeeded, no further hard error states would
    have occurred).
  prefs: []
  type: TYPE_NORMAL
- en: C.2 Defining the Event Handler in the Service Definition
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Although Nagios executes the event handler for every event, it does not have
    to carry out an action each time. In our example the handler should attempt to
    reset the printer service on the third soft error state (check No. 4) and on the
    first hard error state (check No. 5), and do nothing at all the other execution
    times.
  prefs: []
  type: TYPE_NORMAL
- en: 'For this purpose, the service definition is modified as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'The **`event_handler`** parameter expects a Nagios command object that will
    run the handler script:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'In this example it is called **`restart-lpd.sh`** and is not located directly
    in the Nagios plugin directory **`/usr/local/nagios/libexec`**, but in a subdirectory
    called **`/usr/local/nagios/libexec/eventhandler`**, as suggested in the Nagios
    documentation. The script receives three macros as parameters: the current state
    **`$SERVICESTATE$`** (OK, WARNING, CRITICAL, or UNKNOWN), the state type **`$SERVICESTATETYPE$`**
    (**`SOFT`**, or **`HARD`**), and the number of the current (possibly repeated)
    attempt **`$SERVICE ATTEMPT$`** (e.g., **`3`** if the test is being performed
    for the third time). If the event handler is to be used for host checks, then
    the macros **`$HOSTSTATE$`**, **`$HOSTSTATE-TYPE$`**, and **`$HOSTATTEMPT$`**
    are used instead.'
  prefs: []
  type: TYPE_NORMAL
- en: C.3 The Handler Script
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The actual treatment of the error—depending on the current event—is dealt with
    by the script defined in the command definition. So that we can concentrate on
    the essential aspects in this context, we shall assume that **`lpd`** is installed
    on the Nagios server itself. This enables the service to be restarted locally,
    without the need for a remote shell such as the Secure Shell.
  prefs: []
  type: TYPE_NORMAL
- en: 'The script **`restart-lpd.sh`** checks to see exactly what event is involved,
    using the macros passed on to it, and either does nothing at all or tries to restart
    **`lpd`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: The **`case`** statement first checks to see what state exists. Only if it is
    CRITICAL will the script do anything; it does not carry out any action for other
    states. If the service is in a critical state, either the state type must be **`HARD`**
    or (**`||`**) a corresponding soft state must occur for the third time in succession,
    so that **`restart-lpd.sh`** can execute the **`lpd`** init script with the argument
    **`restart`**.^([[313](#ftn.APP-C-FN-1)])
  prefs: []
  type: TYPE_NORMAL
- en: 'The script is executed with the permissions of the user **`nagios`**, who may
    neither stop nor restart system services. This is why **`sudo`** is used, which
    provides temporary **`root`** permissions exclusively for the start-up script
    **`/etc/init.d/lpd`**, just for this user. The corresponding configuration can
    be found in the file **`/etc/sudoers`**, but if it is edited then you must use
    the program **`visudo`** rather than a standard editor (this checks the configuration
    file for syntax errors when it is saved):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'Then you add the following line to the configuration file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'In plain language this means: the user **`nagios`** may run the command **`/etc/init.d/lpd`**
    on the host **`nagsrv`**. The command is run as the user **`root`**, but no password
    is required for this.'
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[313](#APP-C-FN-1)]) If you want to get to know Bash programming more closely,
    we can recommend the excellent *Advanced Bash-Scripting Guide* ([http://www.tldp.org/LDP/abs/html](http://www.tldp.org/LDP/abs/html))
    by Mendel Cooper.
  prefs: []
  type: TYPE_NORMAL
- en: C.4 Things to Note When Using Event Handlers
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If you restart a service that is already in a soft error state as described
    here, the administrator will not receive any notification as long as the action
    was successful. Although the log file records the restart, it will scarcely be
    noticed unless you search the log file explicitly for such events. This means
    that the administrator will seldom investigate the cause of the service failure.
  prefs: []
  type: TYPE_NORMAL
- en: You should therefore bear in mind that eliminating the problem is the best solution,
    and that a restart is only second best. Like air bags in automobiles, the event
    handler should just be regarded as an additional security measure, and should
    certainly not represent the primary method of handling errors. If you carry out
    the restart only when a hard error state occurs, the administrator is confronted
    with the problem through the notification mechanism.
  prefs: []
  type: TYPE_NORMAL
- en: In addition, not every service is suitable for an automatic restart. With OpenLDAP
    in versions before 2.1.17, a problem occurred sporadically in the replication
    through **`slurpd`**, which left behind a corrupted replication file. Although
    the replication service could be restarted, it died again after a short time.
    To really get the replication up and running again, you would have to repair the
    replication file manually.
  prefs: []
  type: TYPE_NORMAL
- en: You should always remember this example and never have complete faith in self-healing.
    In the worst case, restarting a service repeatedly and without thought could lead
    to loss of data, which might be rectified only by retrieving data from the backups.
  prefs: []
  type: TYPE_NORMAL
- en: Appendix D. Macros
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Macros are the salt in the Nagios soup, for without them each service would
    have to be defined individually for each host and each command defined separately
    for each host and each service. They are identified by the dollar signs surrounding
    them: **`$macro$`**. We will look at the definition of a command with the plugin
    **`check_http`** (see [6.4.2 Web server control via HTTP](../Text/ch06s04.html#web_server_control_via_http
    "6.4.2 Web server control via HTTP"), page 119):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'The definition contains three different macros: the user macro **`$USER1$`**,
    defined in the file **`resource.cfg`** (see [2.14 The Resources File resource.cfg](../Text/ch02s14.html
    "2.14 The Resources File resource.cfg"), page 79), as well as **`$HOSTADDRESS$`**
    and **`$ARG1$`**. The 32 possible user macros **`$USER1$`** to **`$USER32$`**
    are like constants that you use to record information, such as the path to the
    plugin directory (normally in **`$USER1$`**) or even passwords that should not
    appear in the normal configuration. The file **`resource.cfg`** may then be readable
    only for the user **`nagios`**.'
  prefs: []
  type: TYPE_NORMAL
- en: 'The second macro, **`$HOSTADDRESS$`**, is a so-called *standard macro*, which
    is replaced by the host address of the host definition before the command is run:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: If the service **`linux0l;HTTP`** calls the command **`check_http`**, the command
    will obtain the host address from the parameter **`address`**. However, standard
    macros can provide not only the contents of a parameter from an object definition,
    as in this case, but also dynamic values that can change. Examples include the
    state of a host (e.g., **`$HOSTSTATE$`**), the output of a plugin (e.g., **`$SERVICEOUTPUT$`**),
    and system information, such as the start time of Nagios or the current time,
    or information on the configuration or static values.
  prefs: []
  type: TYPE_NORMAL
- en: The **`$ARGx$`** macros contain the command line arguments in sequence. These
    appear in the service definition after the exclamation mark following the command
    **`check_http`**. The exclamation mark is also used as a separator between the
    individual arguments. In this way, spaces can be used within an argument, as in
    the example here (**`-u test.html`**), without any problem whatsoever.
  prefs: []
  type: TYPE_NORMAL
- en: 'Nagios can handle two other groups of macros: on-demand and custom macros.
    *On-demand macros* (see [D.2 On-Demand Macros](../Text/apds02.html "D.2 On-Demand
    Macros") in page 632) are extended standard macros that are used to access values
    belonging to an external object: for example, **`$H0STADDRESS:linux02$`** returns
    the IP address of **`linux02`**, irrespective of whether we are in the host or
    service definition of **`linuxOl`** or **`linux04`**.'
  prefs: []
  type: TYPE_NORMAL
- en: '*Custom macros*, also referred to as *user-defined variables*, were only introduced
    in Nagios 3.0\. The definition of host, service, and contact objects is now supplemented
    with definitions you can make yourself, in whatever manner you like. [D.3 Macros
    for User-defined Variables](../Text/apds03.html "D.3 Macros for User-defined Variables")
    from page 633 deals with these custom macros in more detail.'
  prefs: []
  type: TYPE_NORMAL
- en: D.1 Standard Macros
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: It would go beyond the scope of this book to describe all the available macros.
    The description below concentrates on the most important ones. A complete list
    is given in a tabular overview in the online documentation.^([[314](#ftn.APP-D-FN-1)])
  prefs: []
  type: TYPE_NORMAL
- en: Not all macros can be used everywhere. For this reason the tables provide information
    on the contexts in which each one is applicable. Normally this can be deduced
    with a bit of common sense. A service macro does not belong in a host check or
    a host notification, and likewise, a notification macro has no place in a host
    or service check. A value (such as a host state) which first has to be found is
    of course not yet available while it is being identified (that is, during the
    host check).
  prefs: []
  type: TYPE_NORMAL
- en: 'Macros can basically be used in the following actions: for host and service
    checks, for host and service notifications, when running event handlers ([Appendix C](../Text/apc.html
    "Appendix C. Event Handlers"), page 619) or the OCSP/OHCP commands ([Chapter 15](../Text/ch15.html
    "Chapter 15. Distributed Monitoring"), page 317), and also when processing performance
    data with the accompanying commands ([19.1.1 The template mechanism](../Text/ch19.html#the_template_mechanism
    "19.1.1 The template mechanism"), page 405 and [19.1.2 Using external commands
    to process performance data](../Text/ch19.html#using_external_commands_to_process_perf
    "19.1.2 Using external commands to process performance data"), page 407).'
  prefs: []
  type: TYPE_NORMAL
- en: D.1.1 Host macros
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Table D-1. Selected host macros
  prefs: []
  type: TYPE_NORMAL
- en: '| Macro | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| **`$HOSTNAME$`** | Host name from the **`host_name`** parameter for the host
    definition |'
  prefs: []
  type: TYPE_TB
- en: '| **`$HOSTALIAS$`** | Alias from the **`alias`** parameter for the host definition
    |'
  prefs: []
  type: TYPE_TB
- en: '| **`$HOSTADDRESS$`** | IP address or FQDN from the host definition parameter
    |'
  prefs: []
  type: TYPE_TB
- en: '| **`$HOSTSTATE$`** | State as text: UP, DOWN, UNREACHABLE |'
  prefs: []
  type: TYPE_TB
- en: '| **`$HOSTSTATEID$`** | State in numerical form: **`0`** (UP), **`1`** (DOWN),
    **`2`** (UNREACHABLE) |'
  prefs: []
  type: TYPE_TB
- en: '| **`$HOSTSTATETYPE$`** | **`HARD`**, **`SOFT`** |'
  prefs: []
  type: TYPE_TB
- en: '| **`$HOSTOUTPUT$`** | The first line of the text output of the host check
    |'
  prefs: []
  type: TYPE_TB
- en: '| **`$HOSTLONGOUTPUT$`**(Nagios 3.0) | Long text of the host check, if this
    provides multiple-line information |'
  prefs: []
  type: TYPE_TB
- en: '| **`$HOSTPERFDATA$`** | Performance data from the host check |'
  prefs: []
  type: TYPE_TB
- en: '[Table D-1](../Text/apd.html#selected_host_macros "Table D-1. Selected host
    macros") documents the most important macros in connection with hosts. The macros
    **`$HOSTNAME$`**, **`$HOSTALIAS$`**, and **`$HOSTADDRESS$`** provide information
    from the host definition itself, so they are static. **`$HOSTSTATEID$`** and **`$HOSTSTATE$`**
    do *not* give the return value of the plugin—**`1`** (OK) or **`2`** (CRITICAL)—but
    the result after the topological evaluation by Nagios. **`$HOSTSTATETYPE$`** defines
    whether Nagios really has completed the check (hard state) or whether the check
    is to be repeated (soft state).'
  prefs: []
  type: TYPE_NORMAL
- en: D.1.2 Service macros
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[Table D-2](../Text/apd.html#selected_macros_for_services "Table D-2. Selected
    macros for services") presents selected service macros.'
  prefs: []
  type: TYPE_NORMAL
- en: Table D-2. Selected macros for services
  prefs: []
  type: TYPE_NORMAL
- en: '| Macro | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| **`$SERVICEDESC$`** | Name of the service, taken from the parameter **`service_description`**
    from the service definition |'
  prefs: []
  type: TYPE_TB
- en: '| **`$SERVICESTATE$`** | The state in text form: OK, WARNING, CRITICAL, UNKNOWN
    |'
  prefs: []
  type: TYPE_TB
- en: '| **`$SERVICESTATEID$`** | The state numerically: **`0`** (OK), **`1`** (WARNING),
    **`2`** (CRITICAL), **`3`** (UNKNOWN) |'
  prefs: []
  type: TYPE_TB
- en: '| **`$SERVICESTATETYPE$`** | **`HARD`**, **`SOFT`** |'
  prefs: []
  type: TYPE_TB
- en: '| **`$SERVICEOUTPUT$`** | The first line of the text output of the plugin during
    the service check |'
  prefs: []
  type: TYPE_TB
- en: '| **`$SERVICELONGOUTPUT$`** (Nagios 3.0) | The long text of the service check,
    if this provides multiple-line output |'
  prefs: []
  type: TYPE_TB
- en: '| **`$SERVICEPERFDATA$`** | Performance data of the service check |'
  prefs: []
  type: TYPE_TB
- en: D.1.3 Group macros
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The host group macros described in [Table D-3](../Text/apd.html#selected_group_macros
    "Table D-3. Selected group macros") are provided by Nagios for service and contact
    groups as well. The string **`HOST`** in the macro name is replaced accordingly
    by ys**`SERVICE`** or **`CONTACT`**.
  prefs: []
  type: TYPE_NORMAL
- en: The macros **`$HOSTGROUPNAME$`** and **`$HOSTGROUPNAMES$`** are always connected
    to the host. The same applies for the equivalent **`SERVICEGROUP`** (connected
    to a service) and **`CONTACTGR0UP`** macros (connected to a contact). Whereas
    **`$HOSTGROUPNAME$`** always returns the first host group of the associated host,
    **`$HOSTGROUPNAMES$`** displays a complete, comma-separated list of all host groups
    of which the host is a member.
  prefs: []
  type: TYPE_NORMAL
- en: Table D-3. Selected group macros
  prefs: []
  type: TYPE_NORMAL
- en: '| Macro | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| **`$HOSTGROUPNAME$`** | Name of the first host group |'
  prefs: []
  type: TYPE_TB
- en: '| **`$HOSTGROUPNAMES$`** | Comma-separated list of all host groups to which
    the associated host belongs |'
  prefs: []
  type: TYPE_TB
- en: '| **`$HOSTGROUPALIAS$`** | Alias of the host group |'
  prefs: []
  type: TYPE_TB
- en: '| **`$HOSTGROUPMEMBERS$`** | Members of the host group |'
  prefs: []
  type: TYPE_TB
- en: In contrast, the macros **`$HOSTGROUPALIAS$`** and **`$HOSTGROUPMEMBERS$`**
    refer to a host group. However, now there are no activities using a host group
    as a reference point.^([[315](#ftn.APP-D-FN-2)]) So what is the purpose of these
    macros? They can be implemented as on-demand macros (see [D.2 On-Demand Macros](../Text/apds02.html
    "D.2 On-Demand Macros") from page 632). For example, **`$HOSTGROUPMEMBERS:Linux$`**
    displays a list of all members of the **`Linux`** host group.
  prefs: []
  type: TYPE_NORMAL
- en: On the other hand, if the macro is run in a "normal" context, Nagios identifies
    the first host group specified in the host definition and assesses the accompanying
    value. The same applies for service and contact groups.
  prefs: []
  type: TYPE_NORMAL
- en: D.1.4 Contact macros
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The macros listed in [Table D-4](../Text/apd.html#selected_contact_macros "Table D-4. Selected
    contact macros") reference all the parameters in the respective contact definition.
  prefs: []
  type: TYPE_NORMAL
- en: Table D-4. Selected contact macros
  prefs: []
  type: TYPE_NORMAL
- en: '| Macro | Parameter to be read out |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| **`$CONTACTNAME$`** | **`contact_name`** |'
  prefs: []
  type: TYPE_TB
- en: '| **`$CONTACTALIAS$`** | **`alias`** |'
  prefs: []
  type: TYPE_TB
- en: '| **`$CONTACTEMAIL$`** | **`email`** |'
  prefs: []
  type: TYPE_TB
- en: '| **`$CONTACTPAGER$`** | Parameter **`pager`** of the contact |'
  prefs: []
  type: TYPE_TB
- en: '| **`$CONTACTADDRESSn$`** | One of six possible contact addresses, where **`n`**
    is a digit between **`1`** and **`6`**^([[a](#ftn.APP-D-FN-3)]) |'
  prefs: []
  type: TYPE_TB
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: '^([[a](#APP-D-FN-3)]) The exact contents of **`$CONTACTADDRESSn$`** are specified
    by the Nagios administrator. Anything goes: other telephone numbers, e-mail addresses,
    or even Granny''s phone number.'
  prefs: []
  type: TYPE_NORMAL
- en: '|'
  prefs: []
  type: TYPE_NORMAL
- en: D.1.5 Notification macros
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[Table D-5](../Text/apd.html#selected_macros_for_notifications "Table D-5. Selected
    macros for notifications") shows a selection of macros for notifications.'
  prefs: []
  type: TYPE_NORMAL
- en: Table D-5. Selected macros for notifications
  prefs: []
  type: TYPE_NORMAL
- en: '| Macro | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| **`$NOTIFICATIONTYPE$`** | Notification type (for values, see text) |'
  prefs: []
  type: TYPE_TB
- en: '| **`$NOTIFICATIONRECIPIENTS$`** (Nagios 3.0) | Comma-separated list of all
    recipients |'
  prefs: []
  type: TYPE_TB
- en: '| **`$HOSTNOTIFICATIONNUMBER$`** | Notification counter |'
  prefs: []
  type: TYPE_TB
- en: '| **`$SERVICENOTIFICATIONNUMBER$`** (Nagios 3.0) | Notification counter |'
  prefs: []
  type: TYPE_TB
- en: '**`$NOTIFICATI0NTYPE$`** describes the type of notification. For Nagios 2.x
    the notification types are **`PROBLEM`**, **`RECOVERY`**, **`ACKNOWLEDGEMENT`**,
    **`FLAPPING-START`**, and **`FLAPPINGSTOP`**. Nagios 3.0 also has **`FLAPPINGDISABLED`**,
    as well as **`DOWNTIMESTART`**, **`DOWNTIMEEND`**, and **`DOWNTIMECANCELLED`**.'
  prefs: []
  type: TYPE_NORMAL
- en: The macro **`$NOTIFICATIONRECIPIENTS$`** is only available from Nagios 3.0;
    it contains a comma-separated list of all recipients of the notification that
    has just been sent. Also new in this version are the two macros **`$HOSTNOTIFICATIONNUMBER$`**
    and **`$SERVICENOTIFICATIONNUMBER$`**. These contain the incremented number of
    the last sent message, which is important for escalation management. Acknowledge
    messages are ignored in this case, as are flapping messages or messages on planned
    maintenance periods. As soon as the state of the host or service is again OK,
    this counter is reset to 0, and in the event of an error, counting starts again
    from the beginning.
  prefs: []
  type: TYPE_NORMAL
- en: D.1.6 Macros to specify time and date
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The output of the date macro from [Table D-6](../Text/apd.html#selected_macros_for_details_of_the_date
    "Table D-6. Selected macros for details of the date") depends on the date form
    specified in the parameter **`date_format`** ([A.1 The Main Configuration File
    nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1 The
    Main Configuration File nagios.cfg")).
  prefs: []
  type: TYPE_NORMAL
- en: Table D-6. Selected macros for details of the date
  prefs: []
  type: TYPE_NORMAL
- en: '| Macro | Example |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| **`$LONGDATETIME$`** | **`Sa 29 Dec 17:23:22 CET 2007`** |'
  prefs: []
  type: TYPE_TB
- en: '| **`$SHORTDATETIME$`** | **`2007-12-29 17:23:22`** |'
  prefs: []
  type: TYPE_TB
- en: '| **`$DATE$`** | **`2007-12-29`** |'
  prefs: []
  type: TYPE_TB
- en: '| **`$TIME$`** | **`17:23:22`** |'
  prefs: []
  type: TYPE_TB
- en: '| **`$TIMET$`** | **`1198945589`** |'
  prefs: []
  type: TYPE_TB
- en: '**`$LONGDATETIME$`** outputs a format also provided by the **`date`** program
    without any parameters. The examples for **`$SHORTDATETIME$`** and **`$DATE$`**
    correspond to the **`date_format=iso8601`** setting. With the value **`date_format=us`**,
    the date would be written here as **`12/29/2007`**. **`$TIME$`** contains only
    the time, whereas **`$TIMET$`** shows the epoch time (seconds elapsed since 01.01.1970).'
  prefs: []
  type: TYPE_NORMAL
- en: D.1.7 Statistics macros
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If you use the macros shown in [Table D-7](../Text/apd.html#selected_macros_for_statistical_purposes
    "Table D-7. Selected macros for statistical purposes") in notifications, the macro
    in each case will show the number of hosts or services for which the contact to
    whom the notification is sent is responsible. This means that different recipients
    may receive different figures for the same notification.
  prefs: []
  type: TYPE_NORMAL
- en: Table D-7. Selected macros for statistical purposes
  prefs: []
  type: TYPE_NORMAL
- en: '| Macro | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| **`$TOTALHOSTSUP$`** | Number of hosts in UP state |'
  prefs: []
  type: TYPE_TB
- en: '| **`$TOTALHOSTSDOWN$`** | Number of hosts in DOWN state |'
  prefs: []
  type: TYPE_TB
- en: '| **`$TOTALHOSTSUNREACHABLE$`** | Number of hosts in UNREACHABLE state |'
  prefs: []
  type: TYPE_TB
- en: '| **`$TOTALSERVICESOK$`** | Number of services in OK state |'
  prefs: []
  type: TYPE_TB
- en: '| **`$TOTALSERVICESCRITICAL$`** | Number of services in CRITICAL state |'
  prefs: []
  type: TYPE_TB
- en: '| **`$TOTALSERVICESWARNING$`** | Number of services in WARNING state |'
  prefs: []
  type: TYPE_TB
- en: '| **`$TOTALSERVICESUNKNOWN$`** | Number of services in UNKNOWN state |'
  prefs: []
  type: TYPE_TB
- en: '| **`$TOTALSERVICEPROBLEMS$`** | Total number of services with problems |'
  prefs: []
  type: TYPE_TB
- en: D.1.8 Using standard macros about the environment
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: All standard macros can be provided by Nagios as environment variables, if required.
    The variable name here is derived from the name of the macro without the dollar
    sign, to which the prefix **`NAGIOS_`** is added. The macro **`$HOSTADDRESS$`**
    thus converts to the environment variable **`NAGIOS_HOST-ADDRESS`**. Among the
    on-demand macros (see next section), the host and service macros are not available
    as environment variables for reasons of security, and the same goes for the **`$USERx$`**
    macros, since these could contain sensitive information such as passwords.
  prefs: []
  type: TYPE_NORMAL
- en: Providing these environment variables takes a great deal of time. You should
    therefore consider whether you can do without them altogether in Nagios 3.0 (see
    the parameters **`use_large_installation_tweaks`**, [A.1 The Main Configuration
    File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    The Main Configuration File nagios.cfg"), and **`enable_environment_macros`**,
    [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")). In Nagios 2.x the environment
    variable cannot be switched off.
  prefs: []
  type: TYPE_NORMAL
- en: Instead of accessing the Nagios environment variable directly from an external
    script, as in the following example,
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: which is called as follows,
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: 'as an alternative, you could pass on the contents of the macro to the script
    explicitly as an argument:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: 'Then you can manage without the Nagios environment variable in the script itself:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: '**`goodscript`** retrieves the relevant value from the command line, with **`$1`**.'
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: '^([[314](#APP-D-FN-1)]) Nagios 2.x: [http://nagios.sourceforge.net/docs/2_0/macros.html](http://nagios.sourceforge.net/docs/2_0/macros.html);'
  prefs: []
  type: TYPE_NORMAL
- en: 'Nagios 3.0: [http://nagios.sourceforge.net/docs/3_0/macrolist.html](http://nagios.sourceforge.net/docs/3_0/macrolist.html)'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[315](#APP-D-FN-2)]) It is possible to run commands for a host group from
    the Web interface, but Nagios always resolves these into single actions for each
    host.
  prefs: []
  type: TYPE_NORMAL
- en: D.2 On-Demand Macros
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'On-demand macros—which have existed since Nagios 2.0—reference the same contents
    as standard macros do. The subtle difference between them lies in the context
    of what they reference. Whereas standard macros refer exclusively to the host,
    service, or contact object currently being used, on-demand macros enable access
    to values from any external objects you please:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: 'The macros are the same as standard macros, but their names include the name
    of the host to which the reference is made. The colon is used as a separator.
    For services, the service name also needs to be specified, again separated with
    another colon:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: If the host field is left empty, the macro refers to the host in whose context
    the macro is called. If, for instance, you are checking the disk usage via NRPE
    on the host **`linux01`** with the service **`Disks`** NRPE, then the standard
    macro **`$SERVICESTATE$`** will return the state of the service **`linux01;Disks`**,
    whereas the on-demand macro **`$SERVICESTATE::NRPE$`** will display the state
    of the service **`linux01;NRPE`**. An appropriate script can take into account
    the dependency here between the service **`NRPE`** and an NRPE-based check such
    as **`Disks`**.
  prefs: []
  type: TYPE_NORMAL
- en: 'For contact objects, the external reference point is a contact in each case:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: In addition to this, there are also on-demand macros for host, service, and
    contact groups, and in each case the reference point is the group concerned.
  prefs: []
  type: TYPE_NORMAL
- en: D.3 Macros for User-defined Variables
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Starting from Nagios 3.0, you can specify your own macros in host, service,
    and contact definitions. These macros, called *custom macros* in Nagios jargon,
    are treated like normal standard macros, and their names begin with an underscore
    to make them more easily identifiable:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: 'They are addressed with a prefixed object type:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: The macro again starts with an underscore, but the underscore supplied in the
    definition is omitted. This is difficult to read. If you want to use the underscore
    as a separator, for instance between **`HOST`** and **`NSCLIENT_PORT`**, the custom
    macro must begin with a double underscore. Thus,
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: turns into
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: In the definition of a custom macro, upper and lower case are not distinguished,
    but when the macro is called it is always written in capitals. Besides providing
    abbreviations for content used mainly for documentation purposes, such as **`ASSETID`**
    or **`DEPARTMENT`**, such user-defined macros can also be used to neatly define
    commands.
  prefs: []
  type: TYPE_NORMAL
- en: For example, if you are monitoring a Windows environment with the NS-Client
    mechanism, a service is installed on the host being monitored that listens to
    a specific port ([20.2.1 NSClient](../Text/ch20s02.html#nsclient "20.2.1 NSClient"),
    page 464). Under certain circumstances you will be forced to change the standard
    port. If you now have several servers with different ports, you must tell the
    plugin on which port it is to run the query.
  prefs: []
  type: TYPE_NORMAL
- en: One method would be to also include the port as an argument for each service
    definition, or to define a second command with a permanently stored, alternative
    port. However, if the port on the target system is now changed, the entire service
    definition of the target system must be modified.
  prefs: []
  type: TYPE_NORMAL
- en: A more elegant solution is to store the port, as above, as a custom macro in
    the host definition and to evaluate the custom macro in the command.
  prefs: []
  type: TYPE_NORMAL
- en: This solution, which unfortunately works only in Nagios 3.0, is described for
    the NSClient service in [20.2.5 Rectifying problems with port 1248](../Text/ch20s02.html#rectifying_problems_with_port
    "20.2.5 Rectifying problems with port 1248") from page 471, and an equivalent
    example for NRPE can be found in [H.2 Variable and Macros](../Text/aphs02.html
    "H.2 Variable and Macros") from page 685.
  prefs: []
  type: TYPE_NORMAL
- en: 'D.4 Macro Contents: Not Everything Is Allowed'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A number of macros contain values that were not defined within the Nagios configuration
    or defined by Nagios itself, but which originate from external programs. These
    include macros that record the plugin output (**`$HOSTOUTPUT$`**, **`$LONGHOSTOUTPUT$`**,
    **`$HOSTPERFDATA$`**), and the corresponding macros for services. Via the Web
    interface, the administrator can pass on values to Nagios through acknowledgments,
    which can be read out from the macros **`$HOSTACKAUTHOR$`**, **`$HOSTACKCOMMENT$`**,
    and the equivalent service macros.
  prefs: []
  type: TYPE_NORMAL
- en: 'To guard against the possibility that these macros might contain damaging code,
    which might trigger a buffer overflow or enable other mischievous things, Nagios
    removes "dangerous" lines. What these are is defined by the parameter **`illegal_object_name_chars`**
    ([A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs: []
  type: TYPE_PRE
- en: The Nagios administrator can change these, but he must be aware that fewer characters
    means a higher potential of risk.
  prefs: []
  type: TYPE_NORMAL
- en: Appendix E. Single Sign-On for the Nagios Web Interface
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: For the login to the Web interface, Nagios takes the user who has authenticated
    himself to the Web server, usually Apache. In principle it makes no difference
    how this authentication comes about, but the name of the contact must match the
    user name passed on to the CGI programs from the Web server. Nagios is quite tolerant
    in terms of its name conventions here. Even user names such as **`wob@EXAMPLE.NET`**
    or **`EXAMPLE/wob`** are possible. This is enabled by *single sign-on (SSO)*,
    which means that users only need to log on a single time. Ideally, all applications
    should accept the authentication that has already been performed, and the user
    will not be asked for a password every time.
  prefs: []
  type: TYPE_NORMAL
- en: Security experts have been busy discussing the pros and cons^([[316](#ftn.APP-E-FN-1)])
    of single sign-on, but it is very popular with users. We will therefore not go
    into the disscussion on security.
  prefs: []
  type: TYPE_NORMAL
- en: Single sign-on, in combination with the Nagios Web interface, means that the
    user is automatically authenticated from the browser when the Nagios CGI programs
    are called, and a password is no longer required. Of course, what is described
    here can also be used for other Web pages—this could be the NagVis, PNP, or a
    Wiki. There are hardly any limits to the opportunities for using single sign-on.
  prefs: []
  type: TYPE_NORMAL
- en: This chapter describes the use of two alternative Apache modules for Apache
    2 that enable a single sign-on scenario. As the authentication server, a running
    Active Directory in Windows 2003 is required.^([[317](#ftn.APP-E-FN-2)]) On the
    client side, the browser used must support the selected HTTP authentication procedure.
    Microsoft Internet Explorer and Firefox are both suitable for this.
  prefs: []
  type: TYPE_NORMAL
- en: The Apache module **`mod_auth_kerb`** uses Kerberos directly, and could therefore
    be used in an exclusively Linux environment (without Active Directory). Since
    the author himself does not have a production Kerberos environment with Linux
    clients available, we will not deal with this topic here. If you are running a
    fully functional Kerberos environment in Linux/Unix, you should find it easy to
    modify the **`mod_auth_kerb`** section to your environment.
  prefs: []
  type: TYPE_NORMAL
- en: The Apache module **`mod_auth_ntlm_winbind`** makes use of **`ntlm_auth`**,
    a program that is a component of Samba 3.0\. It therefore requires a complete
    Samba installation, and the server must be a member of an Active Directory domain.
  prefs: []
  type: TYPE_NORMAL
- en: E.1 HTTP Authentication for Single Sign-On
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Microsoft has supported single sign-on via Web browser for some time now. The
    original procedure was based on (*NT LAN Manager (NTLM)*, a protocol that is also
    used in networks, for example when logging in to a domain or when accessing network
    drives. Here the client sends a so-called *type 1 message* containing the host
    and domain names of the client. The server replies with an NTLM challenge (an
    NTLM *type 2 message*), and the client completes authentication with a *type 3
    message*, which in turn sends back to the server not only the client name and
    domain, but also the challenge, which has been encrypted with the client's password.
    The procedure is Microsoft-specific and was never published as a standard. Nevertheless,
  prefs: []
  type: TYPE_NORMAL
- en: Firefox is able to use it. The HTTP authentication-related descriptions of the
    NTLM protocol can also be found on the Internet.^([[318](#ftn.APP-E-FN-3)])
  prefs: []
  type: TYPE_NORMAL
- en: Microsoft will soon replace the NTLM-based authentication with a newer, Kerberos-based
    authentication. With Windows Server 2008, NTLM will no longer be available for
    HTTP authentication, at least on the server side.
  prefs: []
  type: TYPE_NORMAL
- en: The successor to this has already been in practical use for some time. It uses
    a generic interface called *Generic Security Services Application Program Interface
    (GSSAPI)*. For HTTP authentication, as well as GSSAPI, a mechanism called *SPNEGO
    (Simple and Protected Negotiate*) is used, through which concrete authentication
    is negotiated. Microsoft describes the HTTP authentication in an informal Request
    for Comment, RFC 4559.^([[319](#ftn.APP-E-FN-4)]) This also discusses the NTLM
    procedure. The SPNEGO, used for the newer variation, is described in RFC 4178.^([[320](#ftn.APP-E-FN-5)])
  prefs: []
  type: TYPE_NORMAL
- en: 'The SPNEGO procedure is somewhat shorter than the NTLM authentication and is
    closer to the HTTP authentication methods **`Basic`** and **`Digest`**. First,
    the client requests a protected page with the command **`GET`**. The server replies
    with the status code **`401`** (Unauthorized) and includes the possible authentication
    procedures:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE26]'
  prefs: []
  type: TYPE_PRE
- en: 'The server in this example provides a choice of three procedures: **`Negotiate`**
    stands for the Kerberos-based SPNEGO procedure, **`NTLM`** stands for the older
    NTLM authentication, and **`Basic`** refers to the classic user password method
    in which the authentication data are transmitted in plain text. It is now up to
    the client to decide on one of the three procedures. The client—here an instance
    of Microsoft Internet Explorer 6.0—selects the secure Kerberos-based procedure:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs: []
  type: TYPE_PRE
- en: After the HTTP header field **`Authorization`** comes the keyword **`Negotiate`**,
    followed by the Base64-encoded authentication data. If this is successful,
  prefs: []
  type: TYPE_NORMAL
- en: 'the server replies in turn with the HTTP code **`200`** (OK), and the HTTP
    header also contains authentication data,^([[321](#ftn.APP-E-FN-6)]) which the
    client processes:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE28]'
  prefs: []
  type: TYPE_PRE
- en: If successful, the browser will display the HTTP page it has received. The negotiate
    procedure is shown in a somewhat simplified form here, and it is possible that
    the server sends back a **`401`** code (Unauthorized) with the **`WWW-Authenticate`**
    field after it receives the **`Authorization`** packet of the client, because
    further authentication data is required. The client then sends another **`Authorization`**
    header entry, as requested. This is repeated until the server answers with **`200
    OK`**.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[316](#APP-E-FN-1)]) [http://en.wikipedia.org/wiki/Single_sign_on](http://en.wikipedia.org/wiki/Single_sign_on)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[317](#APP-E-FN-2)]) The scenario described may also work with Windows 2000,
    but the author was not able to test this. Nevertheless, there are certainly differences
    in the Kerberos implementation between Windows 2000 and Windows 2003, which probably
    require adjustments to the procedure descrbed here.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[318](#APP-E-FN-3)]) [http://www.innovation.ch/personal/ronald/ntlm.html](http://www.innovation.ch/personal/ronald/ntlm.html),
    in more detail at [http://davenport.sourceforge.net/ntlm.html](http://davenport.sourceforge.net/ntlm.html)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[319](#APP-E-FN-4)]) [http://rfc.sunsite.dk/rfc/rfc4559.html](http://rfc.sunsite.dk/rfc/rfc4559.html)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[320](#APP-E-FN-5)]) [http://rfc.sunsite.dk/rfc/rfc4178.html](http://rfc.sunsite.dk/rfc/rfc4178.html)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[321](#APP-E-FN-6)]) In general, Kerberos provides authentication on both
    sides, so the server must also authenticate itself with the client.
  prefs: []
  type: TYPE_NORMAL
- en: E.2 Kerberos Authentication with **`mod_auth_kerb`**
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The module **`mod_auth_kerb`** integrates Apache into an existing Kerberos
    environment and allows authentication through two procedures: simple authentication
    with the **`Basic`** method or the negotiation procedure SP-NEGO, described in
    RFC 4559.'
  prefs: []
  type: TYPE_NORMAL
- en: Both procedures are shown in [Figure E-1](../Text/apes02.html#mod_auth_kerb_allows_full
    "Figure E-1. mod_auth_kerb allows full authentication via Kerberos, via SPNEGO.
    With the Basic procedure, communication between Web server and Kerberos server
    also runs via the Kerberos protocol."). For an authentication via negotiate (only
    Kerberos v5), the client fetches a ticket from the Kerberos server (1), which
    it forwards to the Web server (2). The Web server in turn sends the ticket via
    the Kerberos protocol to the Kerberos server for inspection (3). What is not shown
    is the response of the Web server to the client if authentication is successful
    (or if it fails).
  prefs: []
  type: TYPE_NORMAL
- en: '![mod_auth_kerb allows full authentication via Kerberos, via SPNEGO. With the
    Basic procedure, communication between Web server and Kerberos server also runs
    via the Kerberos protocol.](../Images/tagoreillycom20081104nostarchimages224026.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure E-1. `mod_auth_kerb` allows full authentication via Kerberos, via SPNEGO.
    With the `Basic` procedure, communication between Web server and Kerberos server
    also runs via the Kerberos protocol.
  prefs: []
  type: TYPE_NORMAL
- en: With the **`Basic`** authentication the client sends a user/password pair in
    plain text to the Web server (4). The server for its part, however, transmits
    the authentication data via the Kerberos protocol to the Kerberos server (5)—which
    doen't alter the fact that the authentication between the Web server and client
    takes place without protection. It is essential that SSL encryption is used here.
    The Web server itself has a permanent ticket for the HTTP service so that it can
    communicate with the Kerberos server in the first place.
  prefs: []
  type: TYPE_NORMAL
- en: E.2.1 Installation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The module is available at SourceForge,^([[322](#ftn.APP-E-FN-7)]) where you
    can also find some notes on the installation and a little documentation. Modern
    distributions include the module as a package, which has the advantage that you
    don't need to worry about the dependencies of other packages—the installer automatically
    installs the required software. In Debian "Etch" the module is called **`libapache2-mod-auth-kerb`**.
    You should have at least version 5.3, since earlier versions have some minor bugs,
    especially when working with Microsoft Internet Explorer 6.0.^([[323](#ftn.APP-E-FN-8)])
  prefs: []
  type: TYPE_NORMAL
- en: 'To carry out the configuration, the programs **`klist`** and **`kinit`** are
    also required, and in Debian "Etch" these can be found in the package **`krb5-user`**
    (and not in **`krb5-clients`**!). One more note on Kerberos itself: The description
    in this book is based on the Kerberos implementation of the Massachusetts Institute
    of Technology (MIT), which is also used in Microsoft Windows.'
  prefs: []
  type: TYPE_NORMAL
- en: E.2.2 Creating a service ticket for Apache
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To participate in the Kerberos procedure, Apache requires a service ticket
    with a quite specific realm:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE29]'
  prefs: []
  type: TYPE_PRE
- en: This consists of the protocol, in this case **`HTTP`**, the fully qualified
    domain name (FQDN), and the realm of the domain. The protocol and the domain realm
    must be written in capitals, and the FQDN must exactly match the name with which
    the Web server is addressed later on. Otherwise, the client will refuse to work
    during the negotiate procedure. Below, **`nagios.example.net`** will be used as
    the FQDN, and the domain controller has the name **`dc01.example.net`**.
  prefs: []
  type: TYPE_NORMAL
- en: 'The Kerberos implementation in Windows 2003 requires that the service ticket
    is bound to one user. To do this, a user is set up (in the example, **`webnagios`**)
    who does not need to have any special permissions. To create a ticket manually,
    you need the support tools in an Active Directory environment, which are best
    installed on a domain controller. After the installation, you change to the directory
    where the support tools are located and create the service ticket with the program
    **`ktpass`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE30]'
  prefs: []
  type: TYPE_PRE
- en: The ticket is then copied to a directory, preferably in the Apache installation,
    for example to **`/etc/apache2/keytabs`**.
  prefs: []
  type: TYPE_NORMAL
- en: E.2.3 Kerberos configuration
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**`/etc/krb5.conf`** is used as the configuration file for Kerberos:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE31]'
  prefs: []
  type: TYPE_PRE
- en: The **`[libdefaults]`** section basically defines the defaults. It is important
    here that the domain realm is written in upper case. In the **`[realms]`** section,
    the individual realms are defined with their respective servers. The parameter
    **`kdc`** describes Kerberos servers that act as a key service (all domain controllers
    in the Active Directory), and **`admin_server`** is the Kerberos master (normally
    the first domain controller in the Active Directory). It must be possible to resolve
    the name specified here into an IP address, which can be tested with a **`ping`**
    to the FQDN given here.
  prefs: []
  type: TYPE_NORMAL
- en: 'To see if Kerberos is working, it is best to use the program **`kinit`**, which—if
    successful—will obtain a valid ticket from the Kerberos server:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE32]'
  prefs: []
  type: TYPE_PRE
- en: '**`kinit`** requires a valid account as an argument, and it is important that
    the domain after the user name is written in upper case. If the password is correct
    and everything works, **`kinit`** will have no output. The ticket obtained can
    now be shown, with **`klist`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE33]'
  prefs: []
  type: TYPE_PRE
- en: E.2.4 Apache configuration
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: You must make sure that Apache really does load the module **`mod_auth_kerb`**
    when it starts. When installing through a distribution, the module is already
    preconfigured. In Debian "Etch" the accompanying **`LoadModule`** directive can
    be found in the file **`/etc/apache2/mods-available/auth_ kerb.load:`**
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE34]'
  prefs: []
  type: TYPE_PRE
- en: 'For activation, Debian uses the command **`a2enmod`**, which basically does
    nothing more than place a symlink in the directory **`/etc/apache2/mods-enabled/`**,
    pointing to the configuration file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE35]'
  prefs: []
  type: TYPE_PRE
- en: 'To be able to use Kerberos for authentication, you need to modify the Apache
    configuration file **`/etc/apache2/conf.d/nagios.conf`**, which was described
    in [1.5.3 User authentication](../Text/ch01s05.html#user_authentication "1.5.3
    User authentication") ([1.5.2 SELinux](../Text/ch01s05.html#selinux "1.5.2 SELinux")):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE36]'
  prefs: []
  type: TYPE_PRE
- en: '**`AuthType`** specifies that Kerberos should be used. With **`AuthName`**
    the authentication is given a name, which is displayed in the **`Basic`** authentication.
    **`KrbAuthRealms`** describes one or more domain realms, and if there are several,
    they are separated by spaces.'
  prefs: []
  type: TYPE_NORMAL
- en: The service ticket generated on the domain controller is specified under **`Krb5Keytab`**.
    **`KrbMethodK5Passwd on`**, apart from the negotiate procedure, allows simple
    authentication using a password, in which the browser sends the password via **`Basic`**
    authentication to the Web server. With **`KrbMethodNegotiate on`** the negotiate
    procedure is switched on, and a completely closed Kerberos circuit is established.
    Then **`KrbSaveCredentials`** determines whether received authentication data
    are to be cached, in case other CGI applications should use these automatically.
    This is not necessary for our purposes, which is why we switch it off with the
    **`off`** option. Finally, **`require valid-user`** ensures that only valid users
    can gain access. A more detailed configuration, such as specifying a group or
    individual users, is not necessary, because Nagios manages its users itself and
    needs only the name of the authenticated user.
  prefs: []
  type: TYPE_NORMAL
- en: E.2.5 Definition of a Nagios contact
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To be able to use single sign-on in Nagios, you now just need to adapt the name
    of the contact to the new, authenticated Web user **`user@REALM:`**
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE37]'
  prefs: []
  type: TYPE_PRE
- en: 'The contact definition (see [2.7 Defining Addressees for Error Messages: contact](../Text/ch02s07.html
    "2.7 Defining Addressees for Error Messages: contact") in page 70) assumes that
    a template (see [2.11 Templates](../Text/ch02s11.html "2.11 Templates") in page
    75) exists with the name **`template-contact-webuser`**.'
  prefs: []
  type: TYPE_NORMAL
- en: When modifying the authentication and the name change connected with this, you
    must also modify the CGI configuration file **`cgi.cfg`** (see [A.2 CGI Configuration
    in cgi.cfg](../Text/apas02.html "A.2 CGI Configuration in cgi.cfg") from page
    606), if this is to explicitly contain entered users in the **`authorized_*`**
    parameters.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[322](#APP-E-FN-7)]) [http://modauthkerb.sourceforge.net/](http://modauthkerb.sourceforge.net/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[323](#APP-E-FN-8)]) Even if the negotiation procedure was being used at
    browser startup, a password window pops up after a while and the IE switches back
    to Basic authentication.
  prefs: []
  type: TYPE_NORMAL
- en: E.3 Single Sign-On with **`mod_auth_ntlm_winbind`**
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Apache module **`mod_auth_ntlm_winbind`** uses the program originally developed
    for Squid, **`ntlm_auth`**, for authentication, and so one of its requirements
    is a Samba server installation in which the server itself is a member of an Active
    Directory domain. **`ntlm_auth`** uses **`winbind`** and therefore offers smooth
    integration into an existing Active Directory.
  prefs: []
  type: TYPE_NORMAL
- en: 'The module has three methods available for authentication: NTLM, Negotiate
    (SPNEGO), and the **`Basic`** authentication. In Summer 2007 there were still
    problems with Negotiate. Developed originally for a proxy, the method did not
    quite fit the needs of a Web server and therefore was not used. At the time of
    writing, NTLM and **`Basic`** authentication remain, but this may change after
    this book is published. NTLM works very well, whereby **`ntlm_auth`** also allows
    the selection of a specific group. But you should also bear in mind that Microsoft
    is discontinuing NTLM for HTTP authentication with Windows Server 2008.'
  prefs: []
  type: TYPE_NORMAL
- en: E.3.1 Installation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The module is still very new. It has the version number 0.0.0 and can only be
    obtained in the source code from Subversion^([[324](#ftn.APP-E-FN-9)]) or from
    corresponding **`unpacked`** directories.^([[325](#ftn.APP-E-FN-10)]) Some documentation,
    in addition to the included **`README`**, can be found at SourceForge.^([[326](#ftn.APP-E-FN-11)])
  prefs: []
  type: TYPE_NORMAL
- en: 'For the installation you change to the directory where the source code has
    been unpacked:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE38]'
  prefs: []
  type: TYPE_PRE
- en: '**`autoconf`** generates a **`configure`** file, which is then run to query
    the specific system parameters. The classic **`make ; make install`** usually
    doesn''t work; luckily, there is no more work involved in running the Apache extension
    tool **`apxs2`** directly, which knows the precise settings of the installed Apache
    environment. The option **`-c`** compiles the C file specified, and **`-i`** installs
    the result to the directory where the other dynamically loadable modules are located.'
  prefs: []
  type: TYPE_NORMAL
- en: 'For Debian there is an Apache configuration file in the form of the file **`auth_ntlm_winbind.load`**
    in the subdirectory **`debian`**, which automatically loads the module when Apache
    is started:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE39]'
  prefs: []
  type: TYPE_PRE
- en: This file is copied to the directory **`/etc/apache2/mods-available`**, and
    it is activated with **`a2enmod auth_ntlm_winbind`**.
  prefs: []
  type: TYPE_NORMAL
- en: 'For other distributions the entry shown is entered in the file in which the
    dynamic modules are loaded, and the path to the module directory is adjusted accordingly.
    Then Apache is started again:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE40]'
  prefs: []
  type: TYPE_PRE
- en: A simple restart will not be sufficient in most cases.
  prefs: []
  type: TYPE_NORMAL
- en: E.3.2 Preparing Samba
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: So that **`mod_auth_ntlm_winbind`** can perform its services, the server on
    which Apache is running must be included in the Active Directory domain as the
    Samba server. To do this, you need a current Samba-3 server package. The installation
    is best performed using the on-board resources of the distribution.
  prefs: []
  type: TYPE_NORMAL
- en: 'For the domain membership, Kerberos (as described in [E.2.3 Kerberos configuration](../Text/apes02.html#kerberos_configuration
    "E.2.3 Kerberos configuration") from page 642) must be completely configured,
    and in addition you need a valid administrator ticket for access to the domain,
    obtained using **`kinit`**. If Samba is used only for the Apache module, a very
    simple Samba configuration is sufficient:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE41]'
  prefs: []
  type: TYPE_PRE
- en: '**`workgroup`** and **`realm`** correspond to the NetBIOS domain names and
    the fully written-out domain name of the Active Directory domain. For **`realm`**,
    it is again important that you write the name in capitals. **`security=ads`**
    describes the membership in an Active Directory domain. For the password server
    you must give at least one, and preferably two, domain controllers; **`encrypt
    passwords = yes`** is mandatory.'
  prefs: []
  type: TYPE_NORMAL
- en: The parameters **`idmap*`** and **`winbind enum*`** map Windows users and groups
    to Unix users and groups. For the **`winbind separator`** you should select a
    Unix-compatible character, normally **`/`**, to separate the domain from the user
    name, as in **`EXAMPLE/wob`**. If this results in problems with applications,
    however, you can replace this character with another one, provided that Nagios
    can handle it. Here **`hosts allow`** allows access only from the local host.
  prefs: []
  type: TYPE_NORMAL
- en: 'The parameter **`winbind use default domain`** defines whether a missing domain
    should be replaced automatically by the default domain from **`workgroup`**. Then
    the domain can be omitted in the **`Basic`** authentication. At the same time,
    **`mod_auth_ntlm_winbind`** removes the domain name in the HTTP user. Users are
    treated differently, depending on the domain membership: Users from external domains
    are assigned to the HTTP user **`FOREIGN/`****``*`user`*``**, whereas users from
    the same domain are assigned only to **``*`user`*``** (without a domain in front).
    If you are just using a single domain, you can set the parameter to **`yes`**,
    and you will no longer need to worry about a possible prefixed domain.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Access to the domain is achieved with the Samba command **`net ads join`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE42]'
  prefs: []
  type: TYPE_PRE
- en: 'After successfully joining, it is essential that you restart both Samba and
    Winbind:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE43]'
  prefs: []
  type: TYPE_PRE
- en: 'You can test whether everything is working properly with **`wbinfo -t`**. The
    command runs an encrypted RPC call, which is only possible if the server really
    is a member in the domain:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE44]'
  prefs: []
  type: TYPE_PRE
- en: If you still want to play around a bit with Winbind, you can display all users
    displayed with **`wbinfo -u`** and all groups with **`wbinfo -g`**. When run for
    the first time after being started, it will take a while until the two programs
    display anything.
  prefs: []
  type: TYPE_NORMAL
- en: 'For authentication, Apache calls the program **`ntlm_auth`** with the permissions
    under which the Web server is running. In Debian this is the user **`www-data`**
    from the group **`www-data`**. With his permissions, **`ntlm_auth`** tries to
    access the directory **`/var/lib/samba/winbindd_privileged/`**. This must belong
    to the user **`root`** and be readable for the user under which Apache is running,
    and otherwise nobody else may access the directory:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE45]'
  prefs: []
  type: TYPE_PRE
- en: If the access permissions are incorrectly set, **`ntlm_auth`** will refuse its
    services.
  prefs: []
  type: TYPE_NORMAL
- en: E.3.3 Apache configuration
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The module **`mod_auth_ntlm_winbind`** requires only a few entries in the Apache
    configuration file **`/etc/apache2/conf.d/nagios.conf`**, since the overwhelming
    part of the configuration takes place in Kerberos and Samba. The file **`nagios.conf`**,
    described in [1.5.3 User authentication](../Text/ch01s05.html#user_authentication
    "1.5.3 User authentication") (page 49), is changed as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE46]'
  prefs: []
  type: TYPE_PRE
- en: 'Only three parameters are needed for NTLM authentication: **`AuthType`** selects
    the authentication module, **`NTLMAuth`** on activates the NTLM procedure, and
    **`NTLMAuthHelper`** defines the specific call of **`ntlm_auth`**. Here the protocol
    **`squid-2.5-ntlmssp`** is used, which was originally intended for Squid.'
  prefs: []
  type: TYPE_NORMAL
- en: The **`Basic`** authentication, in which the browser sends user and password
    in plain text to the Web server, also requires a *Basic Realm* to be specified
    in the form of the parameter **`NTLMBasicRealm`**. The value of the parameter
    **`NTLMBasic Authoritative`** controls whether a failed attempt (User not found)
    can then be answered (**`on`**) or whether further authentication modules—if they
    exist—should be queried (**`off`**).
  prefs: []
  type: TYPE_NORMAL
- en: If it does not really functon properly, the negotiation procedure should not
    be configured under any circumstances. If the Web server offers negotiation along
    with the other procedures, the browser will always choose to negotiate. The authentication
    is then bound to fail.
  prefs: []
  type: TYPE_NORMAL
- en: By the way, with the **`ntlm_auth`** parameter **`--require-membership-of`**,
    membership in a particular group can be forced. **`/usr/bin/ntlm_auth--require-membership-of
    =EXAMPLE/admins`** returns OK only if the user who is authenticating himself is
    a member of the group **`admins`**. The separator/corresponds to the value of
    **`winbind separator`** given in **`smb.conf`**.
  prefs: []
  type: TYPE_NORMAL
- en: E.3.4 Defining a Nagios contact
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In the definition of the contact, the setting **`winbind use default domain`**
    in the Samba configuration file **`smb.conf`** must be taken into account. If
    the value **`no`** is given there (or if the parameter is not given at all), the
    contact name will always consist of the domain, written in capitals, the **`winbind
    separator`**, and the user name:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE47]'
  prefs: []
  type: TYPE_PRE
- en: On the other hand, if **`winbind use default domain`** is set to **`yes`**,
    the domain is omitted for users in the domain to which the Nagios server belongs.
    For users in external domains, the naming convention with the prefixed domain
    is retained.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[324](#APP-E-FN-9)]) svn co [svn://svnanon.samba.org/lorikeet/trunk/mod_auth_ntlm_winbind_mod_auth_ntlm_winbind](svn://svnanon.samba.org/lorikeet/trunk/mod_auth_ntlm_winbind_mod_auth_ntlm_winbind)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[325](#APP-E-FN-10)]) [http://samba.org/ftp/unpacked/lorikeet/mod_auth_ntlm_winbind/](http://samba.org/ftp/unpacked/lorikeet/mod_auth_ntlm_winbind/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[326](#APP-E-FN-11)]) [http://adldap.sourceforge.net/mod_auth_ntlm_winbind.php](http://adldap.sourceforge.net/mod_auth_ntlm_winbind.php)
  prefs: []
  type: TYPE_NORMAL
- en: E.4 Mozilla Firefox as a Web Client
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Configuring the Mozilla Web browser in Windows XP is very simple, provided that
    the workstation is a member in the Active Directory domain. With the address **`about:config`**
    you can call up the current configuration in Firefox and enter **`negotiate`**
    as the filter (see [Figure E-2](../Text/apes04.html#single_sign-on_via_spnego_solidus
    "Figure E-2. Single sign-on via SPNEGO/Kerberos is enabled in the Firefox settings
    under network.negotiate")). In the **`network.negotiate-auth.trusted-uris`** parameter
    you enter all hosts or domains for which an automatic login should take place.
    Multiple entries are separated by spaces or commas. If a target host or its domain
    is not in the list, Firefox will certainly ask for the user name and password.
    These are transmitted in plain text, however, which is why you should prefer automatic
    login in all cases.
  prefs: []
  type: TYPE_NORMAL
- en: '![Single sign-on via SPNEGO/Kerberos is enabled in the Firefox settings under
    network.negotiate](../Images/tagoreillycom20081104nostarchimages224028.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure E-2. Single sign-on via SPNEGO/Kerberos is enabled in the Firefox settings
    under `network.negotiate`
  prefs: []
  type: TYPE_NORMAL
- en: In Linux you can also authenticate yourself with Firefox automatically via the
    negotiation procedure. You need only a valid user ticket to do this.
  prefs: []
  type: TYPE_NORMAL
- en: 'As long as the Linux workstation logins are not already actively processed
    via Kerberos, it is enough just to obtain the ticket manually with **`kinit`**.
    In addition the file **`/etc/krb5.conf`** must be configured as described in [E.2.3
    Kerberos configuration](../Text/apes02.html#kerberos_configuration "E.2.3 Kerberos
    configuration") from page 642\. As a normal user, you fetch the ticket with the
    realm of the corresponding Windows user:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE48]'
  prefs: []
  type: TYPE_PRE
- en: Afterward, you can check with **`klist`** to see whether you really have received
    a ticket. This is usually only valid for eight hours. After the time has expired,
    you must fetch a new ticket, because without a valid ticket Firefox will announce
    itself again with the user/password query.
  prefs: []
  type: TYPE_NORMAL
- en: E.4.1 Firefox and NTLM
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Along with the SPNEGO/Kerberos procedure, Firefox is also capable of performing
    authentication via NTLM. To do this, you enter the desired domains or hosts in
    the parameter **`network.automatic-ntlm-auth.trusted-uris`**. In Windows XP, everything
    else runs automatically.
  prefs: []
  type: TYPE_NORMAL
- en: 'In Linux, NTLM authentication is normally not available, since a Linux client
    cannot authenticate itself via NTLM to a Windows domain in the Active Directory.
    But there is also a solution here: the *NTLM Authorization Proxy Server* **`ntlmaps`**^([[327](#ftn.APP-E-FN-12)])
    allows even Linux clients to take part in an NTLM-based Web authentication. A
    description of this would go beyond the scope of this book, however.'
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[327](#APP-E-FN-12)]) [http://ntlmaps.sourceforge.net/](http://ntlmaps.sourceforge.net/)
  prefs: []
  type: TYPE_NORMAL
- en: E.5 Microsoft Internet Explorer as a Web Client
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Microsoft Internet Explorer can handle both the SPNEGO/Kerberos and the NTLM
    authentication procedures. For reasons of security, however, Internet Explorer
    does not always immediately provide information on account data. You should therefore
    enter the Nagios host in the security settings under **Trusted Sites**, using
    exactly the same URL that it will be called with later on ([Figure E-3](../Text/apes05.html#how_to_add_hosts_for_trusted
    "Figure E-3. How to add hosts for trusted sites in Internet Explorer")).
  prefs: []
  type: TYPE_NORMAL
- en: '![How to add hosts for trusted sites in Internet Explorer](../Images/tagoreillycom20081104nostarchimages224030.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure E-3. How to add hosts for trusted sites in Internet Explorer
  prefs: []
  type: TYPE_NORMAL
- en: In addition you should check, in **Custom Level**, whether the user name and
    password really need to be transmitted for the level selected ([Figure E-4](../Text/apes05.html#when_updating_the_trustworthy_sites
    "Figure E-4. When updating the trustworthy sites, Automatic logon with current
    user name and password must be checked")). After the changes, it does not do any
    harm to restart Internet Explorer.
  prefs: []
  type: TYPE_NORMAL
- en: '![When updating the trustworthy sites, Automatic logon with current user name
    and password must be checked](../Images/tagoreillycom20081104nostarchimages224032.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure E-4. When updating the trustworthy sites, Automatic logon with current
    user name and password must be checked
  prefs: []
  type: TYPE_NORMAL
- en: Appendix F. Tips on Optimizing Performance
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: It is very difficult to describe, in general terms, a Nagios installation that
    performs well. Nagios should perform checks immediately, that is, it should have
    a small *latency time* for host and service checks. This is the difference between
    the planned and actual execution times of the check. If this is an hour or more,
    you can certainly talk about disastrous performance. On the other hand, latency
    of less than a second represents very good performance. In between these extremes,
    the borders between acceptable and unacceptable are somewhat hazy.
  prefs: []
  type: TYPE_NORMAL
- en: 'The latency time of host and service checks can be measured objectively. Other,
    more subjective impressions are more difficult to evaluate. Doggedly working on
    the command line of the host, a really high system load, or a long time lag for
    a page to be displayed when the Nagios Web interface is called: whether such things
    are regarded as performance problems or can be tolerated, depends on what your
    specific requirements are. If the Web interface always needs more than ten seconds
    to display even just a few services, this is certainly not acceptable for interactive
    use. A load of 40 on a powerful 4-CPU machine may not be a problem, while a load
    of 10 on a less powerful system may already be catastrophic.'
  prefs: []
  type: TYPE_NORMAL
- en: Of course, the capacity of the host system on which Nagios is installed also
    heavily influences the overall performance. A very slow RAID system, for instance,
    could slow down Nagios considerably if Nagios wants to write a large number of
    check results to the RAID within a short period of time, and the NDOUtils simultaneously
    want to save all events to a database. If the latency values of Nagios are within
    tolerance, there is no reason from the perspective of Nagios to change the configuration
    of the RAID system.
  prefs: []
  type: TYPE_NORMAL
- en: So that we can better distinguish between individual qualities, we will introduce
    two concepts here. A *performance indicator* is a measure of the objective performance
    of Nagios. The latency time of service and host checks is by far the best choice
    for a performance indicator. As soon as anything at all starts creating problems
    for Nagios, this nearly always manifests itself directly in the latency.
  prefs: []
  type: TYPE_NORMAL
- en: '*Problem indicators*, on the other hand, are parameters which may point to
    a possible problem, but whose absolute values alone does not allow a judgment
    to be made about the actual performance. These may be system measurements, such
    as a high CPU load or permanent swapping of the host on which Nagios is running,
    or they may be internal Nagios measurements, such as a permanently full queue
    for the results of external commands (see [F.2.6 Preferring passive checks](../Text/apfs03.html
    "F.2.6 Preferring passive checks") in page 666).'
  prefs: []
  type: TYPE_NORMAL
- en: F.1 Internal Statistics of Nagios
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Nagios displays a short version of the performance indicators in the so-called
    tactical overview of the Web interface, at the top right, (see Figure in [16.2.4
    The most important things at a glance: tac.cgi](../Text/ch16s02.html#the_most_important_things_at_a_glance_c
    "16.2.4 The most important things at a glance: tac.cgi")), and a slightly more
    detailed version via **`extinfo.cgi`** (see Figure in [16.2.2 Additional information
    and control center: extinfo.cgi](../Text/ch16s02.html#additional_information_and_control_cent
    "16.2.2 Additional information and control center: extinfo.cgi")). In addition,
    the command-line program **`nagiostats`** shows individual performance values
    or a summary of all data.'
  prefs: []
  type: TYPE_NORMAL
- en: F.1.1 The command-line tool nagiostats
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**`nagiostats`** is installed automatically during the Nagios installation
    and is located in the same directory as the main **`nagios`** program itself (in
    our case: **`/usr/local/nagios/bin`**). It requires, as a parameter, the main
    configuration file **`nagios.cfg`**, along with the path to it, in order to display
    all values in Nagios 2.x. (For Nagios 3.0 this is not necessary.)'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE49]'
  prefs: []
  type: TYPE_PRE
- en: The program first provides information on the evaluated status file and the
    Nagios version. The details of the **`Command Buffers`** in the second paragraph
    are of more interest. If the command buffer becomes full, Nagios will have problems
    processing commands via the interface for external commands. All passive checks
    will suffer from this (see [F.2.6 Preferring passive checks](../Text/apfs03.html
    "F.2.6 Preferring passive checks")).
  prefs: []
  type: TYPE_NORMAL
- en: The next two blocks provide values on host and service checks. Many of them
    are of a purely informative nature. If the right column contains several values,
    as for the two performance indicators **`Active Service Latency`** and **`Active
    Host Latency`** (shown here in bold type), without the page on left offering any
    explanation of this, then these are the minimum and maximum values and a mean
    value.
  prefs: []
  type: TYPE_NORMAL
- en: You should keep an eye on the two problem indicators **`Active Host Execution
    Time`** and **`Active Service Execution Time`**. Long execution times for host
    checks due to failed hosts certainly have a negative influence on Nagios's performance.
    With a standard timeout of 10 seconds for plug-ins, average values of more than
    30 seconds are rather ominous, assuming that long timeouts were not configured
    explicitly. Although long execution times for service checks usually have no significant
    effect on performance, they nevertheless reveal that something is not right.
  prefs: []
  type: TYPE_NORMAL
- en: The details for **`Active/Passive Host/Service Checks Last 1/5/15 min`** in
    the final information block provide statistics that describe how the current check
    results were determined. The details under **`Scheduled`** deal with the checks
    planned regularly by Nagios, and the **`On-demand`** lines deal with tests executed
    while taking account of current circumstances. For hosts, these include checks
    made due to failed hosts, and, for services, tests triggered by dependencies.
    If a test can be avoided because of an already existing and relatively up-to-date
    value, this is listed in the **`Cached`** line.
  prefs: []
  type: TYPE_NORMAL
- en: For host checks, the statistic in the line **`Serial`** also reveals how many
    tests were executed in series in accordance with the inefficient old host check
    logic. The line **`Parallel`** deals with host checks executed in parallel and
    also shows the values for regularly planned and executed host checks. Active host
    checks can contribute in Nagios 3.0 to an improvement in performance. In Nagios
    2.x you should leave them out if possible. The improvements in the host check
    logic are described in [H.7 A New Logic for Host Checks](../Text/aphs07.html "H.7
    A New Logic for Host Checks") in page 689.
  prefs: []
  type: TYPE_NORMAL
- en: 'The 5-minute average resource of **`Active Service Checks Last`** gives information
    on the activities of Nagios rather than on the absolute number of service checks:
    10,000 service checks with a check interval of 20 minutes result in just 2,500
    checks in the 5-minute average, but 1,000 checks with a check interval of just
    1 minute lead to 5,000 in the 5-minute average.'
  prefs: []
  type: TYPE_NORMAL
- en: 'The absolute number of all checks therefore does not mean a lot. The crucial
    issue is how many checks Nagios carries out per time unit: 2,500 service checks
    in 5 minutes results in an average of 8.33 checks per second. This means that
    Nagios starts 8.33 checks every second and at the same time has to gather and
    process the results of 8.33 other checks, forward any performance data to an external
    program, and then it might even have to wait for each check to be handed over.
    If the NDOUtils are used in addition (see [Chapter 17](../Text/ch17.html "Chapter 17. Flexible
    Web Interface with the NDOUtils"), page 375), the system also passes on results
    to the event broker.'
  prefs: []
  type: TYPE_NORMAL
- en: Determining single values
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**`nagiostats`** also displays selected values, with the options **`--mrtg`**
    and **`--data=`****``*`variables`*``**. What values are available here can be
    seen by running **`nagiostats -h:`**'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE50]'
  prefs: []
  type: TYPE_PRE
- en: 'Here, the **`x`** in **`NUMACTSVCCHECKSxM`** is replaced with the desired time
    period in minutes: **`1`**, **`5`**, **`15`**, or **`60`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE51]'
  prefs: []
  type: TYPE_PRE
- en: 'With **`xxxACTSVCLAT`**, **`nagiostats`** behaves in a similar manner; now
    **`xxx`** is replaced by **`MIN`** (Minimum), **`MAX`** (Maximum), or **`AVG`**
    (mean value). Multiple target values are separated by commas:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE52]'
  prefs: []
  type: TYPE_PRE
- en: The output here is given in milliseconds, and each value has its own line. The
    average latency time for service checks is therefore 0.203 seconds, and the maximum,
    0.934 seconds. The switch **`--mrtg`** indicates that this output is intended
    primarily for processing by MRTG, as will be seen in the next section. Individual
    output of performance indicators is also very useful when you are writing your
    own plugins. We will look at this in [F.1.3 A plugin to monitor latency](../Text/apf.html#a_plugin_to_monitor_latency
    "F.1.3 A plugin to monitor latency") from page 660.
  prefs: []
  type: TYPE_NORMAL
- en: F.1.2 Showing Nagios performance graphically
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The *Multi Router Traffic Grapher (MRTG)*^([[328](#ftn.APP-F-FN-1)]) was originally
    developed to represent the bandwidth of active network components in graphical
    form. MRTG always displays two measured values in a graphic, one as a green area,
    the other as a blue line. When representing network bandwidths, these are normally
    for incoming and outgoing traffic. Nagios uses MRTG to display the values delivered
    by **`nagiostats`**.
  prefs: []
  type: TYPE_NORMAL
- en: Usually the best way to install MRTG is from the package of the same name provided
    by the distribution you are using. The sources can be found on the homepage.^([[329](#ftn.APP-F-FN-2)])
  prefs: []
  type: TYPE_NORMAL
- en: 'MRTG is run by cron every five minutes. Debian includes the ready-made cron
    table **`/etc/cron.d/mrtg`**; the tool expects its configuration to be in **`/etc/mrtg.cfg`**.
    The file provided by Debian contains just two global settings:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE53]'
  prefs: []
  type: TYPE_PRE
- en: '**`WorkDir`** specifies the directory in which MRTG should save the current
    graphics, and **`WriteExpires`** creates additional Expire files for Apache. This
    parameter can be omitted, however.'
  prefs: []
  type: TYPE_NORMAL
- en: To these two lines you simply append the configuration file **`mrtg.cfg`** included
    by Nagios in the **`./sample-config`** directory of the source code.
  prefs: []
  type: TYPE_NORMAL
- en: 'Finally, you use the program **`indexmaker`**, which is also part of the MRTG
    package, to generate the overview page shown in [Figure F-1](../Text/apf.html#mrtg_overview_page_for
    "Figure F-1. MRTG overview page for the Nagios performance indicators"):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE54]'
  prefs: []
  type: TYPE_PRE
- en: '![MRTG overview page for the Nagios performance indicators](../Images/tagoreillycom20081104nostarchimages224034.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure F-1. MRTG overview page for the Nagios performance indicators
  prefs: []
  type: TYPE_NORMAL
- en: If you click on one of the graphics on this page, a detailed view will appear
    that displays the graphs in different time resolutions, as shown in [Figure F-2](../Text/apf.html#detail_view_for_the_lat
    "Figure F-2. Detail view for the latency time for service checks") (daily, weekly,
    monthly, and annually).
  prefs: []
  type: TYPE_NORMAL
- en: '![Detail view for the latency time for service checks](../Images/tagoreillycom20081104nostarchimages224036.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure F-2. Detail view for the latency time for service checks
  prefs: []
  type: TYPE_NORMAL
- en: The graphical display of the check latencies over the course of time allows
    you to see at a glance whether a high latency is a isolated event, part of a trend,
    or a permanent problem. The view in [Figure F-2](../Text/apf.html#detail_view_for_the_lat
    "Figure F-2. Detail view for the latency time for service checks") clearly shows
    that the measures taken on Saturday afternoon^([[330](#ftn.APP-F-FN-3)]) have
    had a positive effect (see weekly graphic). Instead of 20–80 seconds, the service
    check latency now lies at values below one second.
  prefs: []
  type: TYPE_NORMAL
- en: The accompanying online documentation^([[331](#ftn.APP-F-FN-4)]) contains more
    detailed links for each individual graphic, with links to the documentation of
    various parameters that can be used to influence the indicators shown in each
    graphic.
  prefs: []
  type: TYPE_NORMAL
- en: F.1.3 A plugin to monitor latency
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: What could be more appropriate than to have Nagios monitor its own performance
    and, if necessary, use the notification system? To do this, you can query the
    latency values with **`nagiostats`** or use the plugin **`check_mrtg`** to query
    the performance data already collected through MRTG.
  prefs: []
  type: TYPE_NORMAL
- en: 'We will choose the first method here and provide the latency time for service
    checks as a passive check result for Nagios. The shell script intended for this
    purpose is run via cron independently of the Nagios scheduling. A plugin actively
    run by Nagios may in some circumstances return no results, or only irregular ones,
    if the Nagios schedule has become totally messed up because of performance problems.
    The script looks like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE55]'
  prefs: []
  type: TYPE_PRE
- en: First **`nagiostats`** determines the current value for average service latencies
    (**`AVGACTSVCLAT`**). The script saves the result in the variable **`LATENCY`**
    and decides, using the thresholds in **`WARN`** and **`CRIT`**, whether it should
    return OK, WARNING, or CRITICAL.
  prefs: []
  type: TYPE_NORMAL
- en: '**`OUTCMD`**, **`OUTINFO`**, and **`OUTPERF`** compose the command that is
    passed on to the interface for external commands (see also [13.1 The Interface
    for External Commands](../Text/ch13.html#the_interface_for_external_commands "13.1
    The Interface for External Commands"), page 292). It begins with the timestamp
    in square brackets. The command **`PROCESS_SERVICE_CHECK_RESULT`** is followed
    by the host name and the service name **`Service Latency`**, the status, and the
    actual output, including performance data. In Nagios 3.0 it is better to omit
    the detail of the configuration file, with **`--config`**, because **`nagiostats`**
    will otherwise begin its output with an additional info line that only interferes
    with the script:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE56]'
  prefs: []
  type: TYPE_PRE
- en: 'In Nagios 2.x, however, you need to specify the configuration file. So that
    the cron daemon runs the script at regular intervals, a **`nagios`** file is created
    in the directory **`/etc/cron.d`** containing the following line:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE57]'
  prefs: []
  type: TYPE_PRE
- en: 'All that is missing now is an appropriately defined service:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE58]'
  prefs: []
  type: TYPE_PRE
- en: '**`host_name`** and **`service_description`** must match the corresponding
    detals in the script. Active checks are switched off, passive ones enabled. So
    that Nagios doesn''t perform a check itself at some point, **`check_freshness`**
    must be set to **`0`** (see also [13.4 Reacting to Out-of-Date Information of
    Passive Checks](../Text/ch13s04.html "13.4 Reacting to Out-of-Date Information
    of Passive Checks"), page 295). The definition here uses a service template defined
    somewhere else (see also [2.11 Templates](../Text/ch02s11.html "2.11 Templates"),
    page 75).'
  prefs: []
  type: TYPE_NORMAL
- en: 'After a reload, Nagios accepts the information from the script and processes
    it. If you use PNP to process the performance data ([19.6 Smooth Plotting with
    PNP](../Text/ch19s06.html "19.6 Smooth Plotting with PNP"), page 446), you should
    make sure that Nagios includes the name of the check command (in this case, **`check_dummy`**).
    If you want to use a different name, you need to specify the performance label
    **`svclat`** in the script:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE59]'
  prefs: []
  type: TYPE_PRE
- en: 'PNP accepts labels in the form **``*`wrapper :: check_command :: label`*``**,
    from which the tool extracts the name between the double colons (in this case,
    **`check_svc_latency`**), so that it can use it as the plugin name. This trick
    normally works for all passive checks.'
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[328](#APP-F-FN-1)]) [http://www.mrtg.org/](http://www.mrtg.org/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[329](#APP-F-FN-2)]) [http://www.mrtg.org/](http://www.mrtg.org/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[330](#APP-F-FN-3)]) Namely, enlarging the free memory that Linux uses for
    file system caching, in order to improve I/O performance for the MySQL database
    used by the NDOUtils and the overall file system accesses.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[331](#APP-F-FN-4)]) [http://nagios.sourceforge.net/docs/3_0/mrtggraphs.html](http://nagios.sourceforge.net/docs/3_0/mrtggraphs.html)
  prefs: []
  type: TYPE_NORMAL
- en: F.2 Measures for Improving Performance
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If performance is subjectively poor and the latency of the service check lies
    permanently in the red zone, then you need to act. But where do you start? Trying
    things out is preferable to studying the problem, and there are no patent recipes.
    Normally you will lose sight of the overall picture very quickly if you try making
    small adjustments here and there. You should therefore always change just one
    parameter at a time and give Nagios time to adjust to the new state of affairs.
    Depending on the system, the number of checks to be performed in the five-minute
    average, and other indicators, sometimes a few minutes is enough to notice changes
    using **`nagiostats`** or MRTG, but at other times even half an hour may not be
    long enough if the latency has built up over a longer period of time.
  prefs: []
  type: TYPE_NORMAL
- en: The following sections deal with various problem zones in Nagios that could
    be the cause of poor performance.
  prefs: []
  type: TYPE_NORMAL
- en: 'F.2.1 Service checks: as often as necessary, as few as possible'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Would you use a cannon to shoot at sparrows? Surely not. Apart from the fact
    that you would ordinarily never shoot at sparrows, even if you had to, you would
    never use such an oversized weapon as a cannon. Likewise, what is the proper choice
    for the intervals for your service checks? Why check the usage of a hard drive
    every 60 seconds, unless you or a colleague will react within a few minutes to
    a warning threshold being overstepped? Maybe an interval of five to ten minutes
    will do the job just as well. And if the typical growth rate of the data stored
    in the file system lies at five percent per week, then a check interval of 15
    minutes is certainly enough.
  prefs: []
  type: TYPE_NORMAL
- en: If you install security patches only once per day and non-critical security
    updates just once per week, it is of little use to check the relevant version
    status every five minutes. And why check virus signatures every fifteen minutes
    if you only download them every two hours? Do you react immediately after the
    first alarm, or only if no update has been performed for several hours?
  prefs: []
  type: TYPE_NORMAL
- en: These are not just academic questions—they are intended to make you think. There
    are certainly situations in which a service needs to be checked once per minute,
    for instance when compliance with Service Level Agreements is concerned, and the
    contract penalties for outages are calculated on a per-minute basis. But this
    is no reason to test other services every minute if a fifteen-minute check would
    be sufficient. The bottom line is *check as often as necessary, but as little
    as possible*.
  prefs: []
  type: TYPE_NORMAL
- en: Start with an average check interval of 5 minutes. For less critical or static
    services, you can extend the interval to 10, 15, 30, or 60 minutes, or perhaps
    even more. Only if it is absolutely essential should you lower the interval below
    the 5-minute limit—and do it selectively for individual checks. 2,000 service
    checks, performed on average every two minutes, generate about the same load as
    5,000 service checks with an average interval of 5 minutes. This small difference
    of 3 minutes can be a real problem for Nagios.
  prefs: []
  type: TYPE_NORMAL
- en: F.2.2 Processing performance data intelligently
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Processing performance data can, under unfavorable conditions, be a real performance
    killer.
  prefs: []
  type: TYPE_NORMAL
- en: For the template mechanism, in which Nagios first has to format performance
    data and then write them to a file, and have these files processed at regular
    intervals by an external command ([19.1.1 The template mechanism](../Text/ch19.html#the_template_mechanism
    "19.1.1 The template mechanism"), page 405), the internal Nagios logic stops when
    the command is called. Nagios expects a confirmation when the program called has
    finished its work. If the external program requires some time to do its task,
    it is easy to work out that calling an external command directly for each individual
    check result ([19.1.2 Using external commands to process performance data](../Text/ch19.html#using_external_commands_to_process_perf
    "19.1.2 Using external commands to process performance data"), page 407) can put
    a considerable strain on Nagios. The template mechanism can provide relief here.
    If 400 check results are waiting each minute (2,000 checks in the 5-minute average)
    and Nagios calls the external command for the template mechanism every 30 seconds,
    this will process some 200 results in one go. Although this will take somewhat
    longer than an external program that processes just one single result, 199 program
    starts are no longer needed.
  prefs: []
  type: TYPE_NORMAL
- en: With a large number of check results, this may still not be enough, because
    Nagios also waits here every 30 seconds for the external program and waits until
    it has terminated.
  prefs: []
  type: TYPE_NORMAL
- en: 'To keep this pause as brief as possible, you can make use of the bulk mode
    in PNP ([19.6 Smooth Plotting with PNP](../Text/ch19s06.html "19.6 Smooth Plotting
    with PNP"), page 446): then Nagios just moves the file with the cached results
    to a special directory every 30 seconds. This happens without any time loss. Full
    responsibility for processing the external data is given to a daemon that Nagios
    does not have to control. Details of this are described in [19.6.4 Bulk processing
    of performance data](../Text/ch19s06.html#bulk_processing_of_performance_data
    "19.6.4 Bulk processing of performance data") from page 452.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Another aspect of intelligent processing is to record performance data only
    where they are evaluated and required. An example of the opposite would be to
    send performance data for all checks to a tool such as NagiosGrapher ([19.5 Automated
    to a Large Extent: NagiosGrapher](../Text/ch19s05.html "19.5 Automated to a Large
    Extent: NagiosGrapher"), page 426) and then discard the data not required on the
    side of the collector daemon **`collect2.pl`**. Processing performance data for
    required services is switched on with **`process_perf_data=1`** in the service
    definition.'
  prefs: []
  type: TYPE_NORMAL
- en: F.2.3 Avoiding plugins in interpreted languages
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The standard plugins for Nagios were written predominantly in C and C++, and
    there are good reasons for this. Admittedly, it is usually easier to write a plugin
    in a script language; however, a plugin in an interpreted language is checked
    for correct syntax each time it is run, then interpreted at runtime, and finally
    executed.
  prefs: []
  type: TYPE_NORMAL
- en: Not only that, every time such a plugin is called, the relevant interpreter
    is started. With a compiled plugin, one does not have to put up with all of this.
    Syntax checking and the compiling process only take place once, and the result
    can be executed directly, without the additional support of another program, such
    as an interpreter, which is not exactly small. Considering the many hundreds of
    thousands of calls that are made during the lifetime of an interpreted plugin,
    you are looking at resource commitments that could really be used for more sensible
    purposes.
  prefs: []
  type: TYPE_NORMAL
- en: This is not to fundamentally question the use of interpreted languages in general.
    For certain purposes, it is simply easier to implement a plugin into a script
    language. But you should not be surprised at the resources that will be needed
    if you perform 5,000 service checks in the 5-minute average exclusively with interpreted
    plugins. Then simple PC hardware will certainly not suffice for the Nagios server.
  prefs: []
  type: TYPE_NORMAL
- en: 'There is an almost perfect solution if you want to use Perl plugins: Nagios''s
    built-in Perl interpreter (see [Appendix G](../Text/apg.html "Appendix G. The
    Embedded Perl Interpreter") from page 669). Although not all Perl plugins will
    run under this, the majority do, which considerably reduces strain on the Nagios
    server.'
  prefs: []
  type: TYPE_NORMAL
- en: F.2.4 Optimizing host checks
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: One performance factor that should not be underestimated is the way in which
    Nagios executes a host check. Sometimes considerable time can be lost here, regardless
    of the Nagios version.
  prefs: []
  type: TYPE_NORMAL
- en: For host checks, a **`check_ping`** or **`check_icmp`** is normally used (see
    [6.2 Reachability Test with Ping](../Text/ch06s02.html "6.2 Reachability Test
    with Ping")). Older **`check_ping`** versions wait for an ICMP echo reply or wait
    for the timeout. It does not evaluate "**`ICMP Host Unreachable`**" messages,
    so that time is lost unnecessarily. **`check_icmp`** uses a special host detection
    mode if it is run under the name **`check_host`** (see [6.2 Reachability Test
    with Ping](../Text/ch06s02.html "6.2 Reachability Test with Ping")). This causes
    the check to be interrupted immediately if an **`ICMP Host Unreachable`** message
    arrives.
  prefs: []
  type: TYPE_NORMAL
- en: Newer versions of **`check_icmp`** and **`check_ping`** take the ICMP error
    message into account, even without a special prompt. Version 1.4.11 of the Nagios
    plugins does have a faulty **`check_icmp`**, however. If you run it as **`check_host`**,
    it will not detect the ICMP error message immediately and requires more time than
    necessary. Nagios 2.x calls all host checks in series, or one after the other.
    If a central network node should fail, it checks several hundred hosts in many
    setups. If the host check for unreachable hosts is only interrupted after ten
    seconds, it will take a huge amount of time until Nagios has checked all hosts.
    The length of a host check in case of error is of considerable significance here.
    You could, if need be, use a shorter timeout, but then you run the risk of false
    alarms, if a network connection with narrow bandwidth is overloaded at that moment,
    for instance, and the response times are longer than the reduced timeout. The
    evaluation of ICMP error messages is much safer here. The catastrophic performance,
    with hundreds of failed hosts due to the serial checks, will still remain, however—an
    important reason to change to Nagios 3.0 in large environments.
  prefs: []
  type: TYPE_NORMAL
- en: Whereas it is usually better in Nagios 2.x to do without active host checks,
    in Nagios 3.0 these may help in certain circumstances to improve performance,
    if you can have the check results cached with the parameters **`cached_host_check_horizon`**
    and **`cached_service_check_horizon`** (see [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")) for the interval specified. If
    an on-demand check occurs, this will not even be run if the existing result is
    sufficiently up to date.
  prefs: []
  type: TYPE_NORMAL
- en: Whether active host checks really do improve performance must be tested in individual
    cases by means of **`nagiostats`**. If the number of cached host checks is relatively
    small in comparison to the number of on-demand checks, caching will not be of
    much use. You could increase the **`cached_host_check_horizon`**—the interval
    for caching—but then you run the risk of using old results that are no longer
    relevant. It is best to try out different time horizons and observe the latency.
    As a comparison, you should try turning off caching altogether, with **`cached_host_check_horizon=0`**.
  prefs: []
  type: TYPE_NORMAL
- en: In connection with host checks, Nagios 3.0 also has the parameter **`aggressive_host_checks`**.
    If this is set to the value **`1`** (and therefore active), Nagios will be very
    exact in its checking, but it needs time to do this. In normal operation you should
    therefore always make sure that the system makes more sensible assumptions for
    host checks with **`aggressive_host_ checks=0`** and so does not test hosts with
    scrupulous precision.
  prefs: []
  type: TYPE_NORMAL
- en: F.2.5 The matter of the Reaper
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Nagios 3.0 stores the check results in a directory intended for just this purpose,
    specified by the parameter **`check_result_path`** (see [A.1 The Main Configuration
    File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    The Main Configuration File nagios.cfg")). The *Reaper* (this is the "harvesting
    machine" of the Nagios core) retrieves these regularly.
  prefs: []
  type: TYPE_NORMAL
- en: 'Two parameters control the procedure: **`check_result_reaper_frequen-cy`**^([[332](#ftn.APP-F-FN-5)])
    specifies the interval, in seconds, at which the Reaper searches the directory
    for new results (see [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")). If the interval is increased,
    it is possible that latency times may also increase. You should only change the
    default of **`5`** seconds to a lower value, and only do this if a large number
    of checks are waiting and Nagios never really empties the directory for the check
    results.'
  prefs: []
  type: TYPE_NORMAL
- en: The second parameter, **`max_check_result_reaper_time`**, interrupts activities
    after the time specified, so that Nagios is not held up for ages by the Reaper.
    The default here is **`30`** seconds (see [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")).
  prefs: []
  type: TYPE_NORMAL
- en: In Nagios 2.x only the parameter **`service_reaper_frequency`** ([A.1 The Main
    Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")) is available, and moreover Nagios
    does not store check results in file form, but in a message queue.
  prefs: []
  type: TYPE_NORMAL
- en: At this point we ought to mention that the Reaper has only a limited influence
    on performance. Provided that you keep the defaults of the two parameters unchanged,
    changing the parameter **`check_result_reaper_frequency`** will not solve any
    problems that have arisen elsewhere. Nevertheless, if you are running out of ideas
    as to what else you can try, it is certainly worthwhile to change this setting.
    In any case, you should monitor the check latency times graphically. If there
    are no changes, you should go back to the defaults.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[332](#APP-F-FN-5)]) In Nagios 2.x the parameter is called service_reaper_frequency,
    see [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg").
  prefs: []
  type: TYPE_NORMAL
- en: F.2.6 Preferring passive checks
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Instead of getting Nagios to actively start each check individually, you can
    also use external applications and forward check results as passive checks to
    Nagios. The external application—even if this is just a cron job—relieves strain
    on Nagios in several areas, including scheduling. Nagios needs only to accept
    the result and sort it accordingly.
  prefs: []
  type: TYPE_NORMAL
- en: 'In a number of cases you can even go a step further and do without a regular
    check, for instance if a UPS sends an SNMP trap when there is a power failure,
    which Nagios processes as a passive check (see [14.6 Application Example II: Processing
    SNMP Traps](../Text/ch14s06.html "14.6 Application Example II: Processing SNMP
    Traps"), page 312).'
  prefs: []
  type: TYPE_NORMAL
- en: Passive check results are cached by Nagios. By default there are 4096 so-called
    *Command Buffer Slots* available for this. Each buffer slot accepts just one external
    command. If this maximum has almost been reached, you should certainly enlarge
    the value with the parameter **`external_command_buffer_slots`** (see [A.1 The
    Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")), whether or not you have concrete
    performance problems. One report on the buffer slots used is provided by **`nagio-stats`**;
    its values are best displayed by MRTG on the time axis (see [F.1.2 Showing Nagios
    performance graphically](../Text/apf.html#showing_nagios_performance_graphic "F.1.2
    Showing Nagios performance graphically")). Too few buffer slots will certainly
    lead to a loss in performance.
  prefs: []
  type: TYPE_NORMAL
- en: F.2.7 Optimizing large Nagios environments
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: For very large environments, Nagios has available the parameter **`use_large_installation_tweaks`**
    ([A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")). If this is set to **`1`**, Nagios
    optimizes a number of processes that can be very time-intensive, especially in
    large environments. Thus the system does without explicit memory release for child
    processes. leaving this task entirely to the operating system.
  prefs: []
  type: TYPE_NORMAL
- en: Normally Nagios starts checks via a two-pronged fork so that it can defend itself
    against crashes and other abnormalities when the plugin is run. Checks are then
    performed not as child processes, but as grandchild processes. The two-pronged
    fork leaves cleaning up after grandchild processes to the operating system. If,
    instead of this, Nagios is happy with a simple fork (with **`use_large_installation_tweaks=1`**),
    it will have to look after all the cleaning up work for all check processes, because
    these are now running directly as child processes. But in return the system load
    is reduced, because only half as many processes need to be started. This generally
    improves performance.
  prefs: []
  type: TYPE_NORMAL
- en: As a third measure, Nagios switches off the envivronment variables for *summary
    macros* ([D.1.7 Statistics macros](../Text/apd.html#statistics_macros "D.1.7 Statistics
    macros"), page 631). It takes up a great deal of time to make these available.
  prefs: []
  type: TYPE_NORMAL
- en: The parameter **`enable_environment_macros`** ([A.1 The Main Configuration File
    nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1 The
    Main Configuration File nagios.cfg")) goes even further—with the value **`0`**,
    Nagios in general no longer makes available the content of macros as environment
    variables (see [D.1.8 Using standard macros about the environment](../Text/apd.html#using_standard_macros_about_the_environm
    "D.1.8 Using standard macros about the environment") from page 631).
  prefs: []
  type: TYPE_NORMAL
- en: The macros can be used as normal within the Nagios configuration, but now external
    scripts can no longer access them implicitly. Switching this off saves considerable
    resources, especially in large environments, and in many cases the environment
    variables are not needed at all.
  prefs: []
  type: TYPE_NORMAL
- en: F.2.8 Optimizing the NDOUtils database
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The NDOUtils take advantage of the possibility of writing all information which
    is at the disposal of Nagios to an external database, via the event broker ([Chapter 17](../Text/ch17.html
    "Chapter 17. Flexible Web Interface with the NDOUtils") from page 375). The parameter
    **`event_broker_options`** controls which data Nagios passes on here. The default
    is **`−1`**, which means that any information available is passed on.
  prefs: []
  type: TYPE_NORMAL
- en: From a performance point of view, this is quite a bad choice. If you just require
    selected data—such as the results of host and service checks—you should pass on
    only this information. Everything else consumes unnecessary resources and influences
    performance without providing any benefits in return. Further information, including
    possible values for the parameter event_broker_options, is given in [17.1 The
    Event Broker](../Text/ch17.html#the_event_broker "17.1 The Event Broker") from
    page 376.
  prefs: []
  type: TYPE_NORMAL
- en: Appendix G. The Embedded Perl Interpreter
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Perl is an interpreted scripting language. When a Perl script is started, it
    is read by the Perl interpreter, checked for errors, transformed into executable
    code only at runtime, and finally executed. Programs in languages such as C or
    C++ are checked for errors, compiled only once, and saved as binary code that
    can be run directly. Here the checking and compilation process takes place just
    once—before the program is run for the first time—whereas a Perl script is checked
    and compiled each time it is run. This takes place at an astounding speed, but
    it still takes time.
  prefs: []
  type: TYPE_NORMAL
- en: But things get worse—for each script, no matter how small it is, the heavyweight
    Perl interpreter is loaded every time. It's as if, in order to add two numbers
    together, you needed to switch on your PC, wait until you can log in, then run
    a spreadsheet program in which you can finally enter the two numbers.
  prefs: []
  type: TYPE_NORMAL
- en: What if you want to continue using the spreadsheet? Well, then the computer
    must be turned on and the spreadsheet program must be installed and running so
    you can enter your numbers. Transferring the analogy to Nagios scripts, this means
    that an instance of the Perl interpreter must already be running on the Nagios
    server—and preferably this instance should be used for all plugins, so that each
    plugin can be executed immediately when it is called. This is precisely what the
    Embedded Perl interpreter, which is embedded into Nagios, does. The technique
    is not new; the Apache module **`mod_perl`** works in the same way.
  prefs: []
  type: TYPE_NORMAL
- en: 'However, the Embedded Perl interpreter does have one slight drawback: It makes
    more demands of a Perl script than the normal Perl interpreter does. Not every
    plugin that runs on the command line without problems will work under the embedded
    interpreter. It is often a matter of small details. Debugging is very difficult
    with this interpreter, and even with simple errors, it is not easy to localize
    them and adjust the plugin accordingly. But you should not be put off by this,
    because in Nagios 3.x the interpreter can be selectively switched off, and in
    Nagios 2.x a trick can be used to bypass it.'
  prefs: []
  type: TYPE_NORMAL
- en: 'A quick note on terminology: In the official Nagios documentation, ePN stands
    for *Embedded Perl Nagios*, that is, Nagios with a Perl interpreter compiled into
    it. In general usage, the term means the integrated Perl interpreter itself. This
    is how we use the term in this book as well. Either way, Nagios is needed in order
    to use it.'
  prefs: []
  type: TYPE_NORMAL
- en: G.1 Requirements of an ePN-capable Plugin
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Many primitive errors can be avoided from the beginning if you use the pragmas
    **`use strict`** and **`use warnings`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE60]'
  prefs: []
  type: TYPE_PRE
- en: '**`use strict`** treats the code very precisely and forces the predefinition
    of all variables (e. g., **`my $var;`**). **`use warnings`** displays extended
    error information, which greatly simplifies the search for the line or statement
    causing the error. For Perl versions prior to 5.6, **`use warnings`** does not
    exist, and you must use the **`-w`** switch, for example in the first line of
    the script:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE61]'
  prefs: []
  type: TYPE_PRE
- en: Detailed information on pragmas can be found in **`man 3perl strict`** and **`man
    3perl warnings`**, as well as the corresponding Perldoc pages on the Internet.^([[333](#ftn.APP-G-FN-1)])
  prefs: []
  type: TYPE_NORMAL
- en: 'To obtain a better understanding of the following notes, you must be aware
    of two things. On one hand, the plugin is loaded just once into the interpreter,
    so initialization sequences are performed explicitly only the very fist time it
    is run. On the other hand, the interpreter embeds the Perl code into other Perl
    code. Thus the end of the plugin code itself is not the end of the complete Perl
    code executed for this plugin. Actions that refer implicitly to the end of the
    respective script therefore sometimes generate undesired side effects, and you
    should take notice of the following tips:'
  prefs: []
  type: TYPE_NORMAL
- en: If possible, make do without **`BEGIN!`**
  prefs: []
  type: TYPE_NORMAL
- en: In a **`BEGIN`** statement you normally include statements that initialize values
    or should, for one reason or another, be executed before the rest of the code.
    ePN runs this section only the very first time the plugin is executed. Statements
    that must be executed every time a plugin is called will come to nothing. It is
    therefore better to leave out the **`BEGIN`** section altogether.
  prefs: []
  type: TYPE_NORMAL
- en: Define an explicit exit code!
  prefs: []
  type: TYPE_NORMAL
- en: A normal Perl script always ends (provided you do not explicitly specify an
    exit code) with the exit code **`0`**. This does not work with the ePN, since
    other code is run after the script code. Although such plugins return an OK when
    run on the command line (without ePN), they return UNKNOWN under ePN.
  prefs: []
  type: TYPE_NORMAL
- en: Make do without **`__DATA__`** or **`__END__`** sections!
  prefs: []
  type: TYPE_NORMAL
- en: 'Both instructions explicitly terminate the execution of the Perl code. In ePN
    this is not the case, however. For this reason you must leave out such instructions.
    For example, instead of the **`__DATA__`**, section you could use a Here instruction:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE62]'
  prefs: []
  type: TYPE_PRE
- en: Do not misuse lexical variables as global variables!
  prefs: []
  type: TYPE_NORMAL
- en: 'Lexical variables such as **`my $value`** define values required locally. You
    should therefore not access these directly from subroutines. Store the corresponding
    values as global values instead:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE63]'
  prefs: []
  type: TYPE_PRE
- en: 'It is better still to pass on the variable as a reference:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE64]'
  prefs: []
  type: TYPE_PRE
- en: Terminate all actions and functions!
  prefs: []
  type: TYPE_NORMAL
- en: 'The Embedded Perl Interpreter also stumbles over small details. To cite an
    example, consider POD documentation integrated into the script (see [25.2 The
    Perl Online Documentation](../Text/ch25s02.html "25.2 The Perl Online Documentation"),
    page 566): Normally the documentation section is completed with **`=cut`**. At
    the end of the Perl script, Perl ensures an implicit end, so that a documentation
    section not finished with **`=cut`** at the end of the script will not cause a
    problem on the command line. But ePN appends Perl code to this, so that omitting
    **`=cut`** always leads to an error.'
  prefs: []
  type: TYPE_NORMAL
- en: This error pattern also recurs in other contexts, so that you should make a
    habit of always explicitly cleaning up. If the plugin opens a file, it must also
    explicitly close it.
  prefs: []
  type: TYPE_NORMAL
- en: More information is provided by the Nagios online documentation^([[334](#ftn.APP-G-FN-2)])
    and the mod_perl Users Guide.^([[335](#ftn.APP-G-FN-3)]) For errors that occur
    exclusively with the ePN, the included mini-version is of help, and is described
    in [G.3 The Testing Tool new_mini_epn](../Text/apgs03.html "G.3 The Testing Tool
    new_mini_epn") in page 674.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[333](#APP-G-FN-1)]) [http://perldoc.perl.org/strict.html](http://perldoc.perl.org/strict.html)
    and [http://perldoc.perl.org/warnings.html](http://perldoc.perl.org/warnings.html)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[334](#APP-G-FN-2)]) [http://nagios.sourceforge.net/docs/3_0/epnplugins.html](http://nagios.sourceforge.net/docs/3_0/epnplugins.html)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[335](#APP-G-FN-3)]) [http://perl.apache.org/docs/1.0/guide/](http://perl.apache.org/docs/1.0/guide/)
  prefs: []
  type: TYPE_NORMAL
- en: G.2 Using ePN
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: In order to use the Embedded Perl interpreter, this feature must be compiled
    into Nagios. This suffices for Nagios 2.x, but for Nagios 3.0 you must also set
    parameters in the main configuration file **`nagios.cfg`**. In addition, Nagios
    3.0 allows each individual Perl plugin to activate or to switch off the Embedded
    Perl interpreter.
  prefs: []
  type: TYPE_NORMAL
- en: G.2.1 Compiling ePN
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The interpreter is integrated during the **`configure`** call, with the switch
    **`--enable-embedded-perl`**. In Nagios 2.x you should also use the option **`--with-perlcache`**,
    which ensures that the interpreter caches scripts that have already been loaded,
    thus speeding them up if they are run again. Nagios 3.0 sets this implicitly if
    **`--enable-embedded-perl`** is specified.
  prefs: []
  type: TYPE_NORMAL
- en: 'Caching in Nagios 2.x has one drawback: In some circumstances Nagios will not
    recognize changes made later on to a Perl script. The only remedy here is a reload
    or a restart of Nagios. On a development system, which is only used to develop
    or test plugins, it certainly makes sense to do without caching. On production
    Nagios systems, however, the benefits of caching cannot be overlooked. In Nagios
    3.0, the Perl interpreter takes account of changes to the script and reloads these
    if required.'
  prefs: []
  type: TYPE_NORMAL
- en: G.2.2 Interpreter-specific parameters in nagios.cfg
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Starting from Nagios 3.0, parameters in the main configuration file **`nagios.cfg`**
    determine whether the Embedded Perl interpreter is used or not:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE65]'
  prefs: []
  type: TYPE_PRE
- en: '**`enable_embedded_perl=1`** enables the general use of the interpreter, and
    the value **`0`** switches it off. The second parameter is used for fine-tuning.
    **`use_embedded_perl_implicitly=1`** automatically switches on the interpreter
    for each plugin, provided the plugin itself does not contain any further instructions
    (see next section). The value **`0`** switches ePN off for the time being, and
    then each plugin must decide for itself whether to use it or not.'
  prefs: []
  type: TYPE_NORMAL
- en: G.2.3 Disabling ePN on a per-plugin basis
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In Nagios 3.0, the parameter **`use_embedded_perl_implicitly`** is supplemented
    with an instruction that can be set within every plugin:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE66]'
  prefs: []
  type: TYPE_PRE
- en: 'The text **`# nagios: +epn`** or **`-epn`** must appear within the first ten
    lines. With **`+epn`** the plugin is executed in the ePN environment, and with
    **`-epn`** it is not. This explicit detail in the plugin has the highest priority
    Only if the instruction is missing does Nagios 3.0 use the parameter **`use_embedded_
    perl_implicitly`**.'
  prefs: []
  type: TYPE_NORMAL
- en: In many cases, existing Perl plugins will work in ePN. We therefore recommend
    that you use the setting **`use_embedded_perl_implicitly=1`**. For plugins that
    cause problems, you can explicitly switch off the use of the interpreter with
    **`-epn`**.
  prefs: []
  type: TYPE_NORMAL
- en: 'In Nagios 2.x there is no option to switch the Embedded Interpreter on or off
    at runtime or in the plugin. Once it has been compiled into Nagios, it is always
    active. But there is a workaround that you can use when defining a command, by
    prefixing **`/usr/bin/perl`** to the actual command line:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE67]'
  prefs: []
  type: TYPE_PRE
- en: Thus, for the plugin **`check_disk.pl`**, the normal Perl interpreter is started
    each time the plugin is run, and ePN is sidestepped.
  prefs: []
  type: TYPE_NORMAL
- en: G.3 The Testing Tool **`new_mini_epn`**
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In its source code, Nagios includes two utilities that simulate an ePN environment,
    which considerably simplifies searching for errors: **`mini_epn`** and the more
    recent **`new_mini_epn`**. They are not absolutely identical in behavior to ePN,
    but this involves only a small number of exotic scenarios. In general the following
    applies: If a Nagios plugin does not run in the mini-interpreter, it won''t run
    in the ePN either.'
  prefs: []
  type: TYPE_NORMAL
- en: The two programs are located in the subdirectory **`./contrib`** of the source
    code and are not installed automatically. If you want to use them, run
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE68]'
  prefs: []
  type: TYPE_PRE
- en: 'but *under no circumstances* should you run **`make install!`** The Makefile
    in this directory does not take into account the defaults for paths and may change
    the access permissions for directories such as **`/bin`** and **`/var`**. The
    programs must be executed in the directory in which the file **`p1.pl`** is located.
    During the basic installation of Nagios, this is copied to **`/usr/local/nagios/bin`**,
    and so these two programs are also copied there:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE69]'
  prefs: []
  type: TYPE_PRE
- en: In the **`./contrib`** directory itself there is an obsolete **`p1.pl`**, which
    should not be used. The up-to-date **`p1.pl`** installed by Nagios is located
    in the main directory of the source code.
  prefs: []
  type: TYPE_NORMAL
- en: 'In order to run the mini-interpreter, you change, as the user **`nagios`**,
    to the directory **`/usr/local/nagios/bin`** and run the program without parameters:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE70]'
  prefs: []
  type: TYPE_PRE
- en: 'You are taken to a simple comand line from which you can run plugins. You should
    always include the full path to the plugin:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE71]'
  prefs: []
  type: TYPE_PRE
- en: The mini-interpreter displays the return code, along with the actual output
    of the plugin after the **`&`** character.
  prefs: []
  type: TYPE_NORMAL
- en: If one mini-interpreter does not find an error, you should try the other one
    out, as it is possible that it may react differently in this special case. In
    addition, you should always run the interpreter with the permissions of the user
    under which Nagios is running (in this book, this is **`nagios`**), to rule out
    problems with access permissions from the start.
  prefs: []
  type: TYPE_NORMAL
- en: The mini-interpreter caches the executed plugin just like its big brother does
    and is not aware at runtime of any changes made to the plugin. If you have made
    changes to the plugin, you should restart the mini-interpreter, otherwise you
    may be searching in vain for an error at the wrong spot.
  prefs: []
  type: TYPE_NORMAL
- en: Appendix H. What's New in Nagios 3.0?
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Nagios 3.0 presents a series of improvements and innovations compared to the
    2.x versions.^([[336](#ftn.APP-H-FN-1)]). Much of this is not noticeable from
    the outside, and the configuration is also nearly identical; normally Nagios 3.0
    will also start with a functioning Nagios-2.x configuration. None of the new configuration
    parameters are absolutely essential.
  prefs: []
  type: TYPE_NORMAL
- en: Some parameters were renamed, and Nagios 3.0 complains on startup that a parameter
    contained in the configuration has been removed, then sets the new variable to
    a sensible value. The objects **`hostextinfo`** and **`service-extinfo`** are
    considered to be obsolete, but can still be used, at least in version 3.0.
  prefs: []
  type: TYPE_NORMAL
- en: Apart from the configuration, the internal logic has been improved in many places.
    For instance the changed way of running host checks has led to significantly higher
    performance, especially for very large installations.
  prefs: []
  type: TYPE_NORMAL
- en: H.1 Changes in Object Definitions
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Nagios 3.0 now allows floating point decimals when specifying check and notification
    intervals. The new parameter **`check_interval =2.5`**, which replaces the **`normal_check_interval`**,
    determines that Nagios will perform a check every two-and-a-half time units. The
    time unit itself is defined by **`interval_length`** in the main configuration
    file **`nagios.cfg`** (see [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")). With the default of 60 seconds,
    a **`check_interval`** of **`2.5`** corresponds to 150 seconds.
  prefs: []
  type: TYPE_NORMAL
- en: H.1.1 The **`host`** object
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Aliases are no longer absolutely essential in Nagios 3.0\. If this detail is
    missing in the host definition, the host name is used automatically. **`host`**
    objects can make use of the following options from version 3.0:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE72]'
  prefs: []
  type: TYPE_PRE
- en: '**`display_name`**'
  prefs: []
  type: TYPE_NORMAL
- en: Defines an alternative name that should appear later in the Web interface and
    other future user interfaces. The CGI programs of Nagios 3.0 do not yet use this
    parameter. The default is **`host_name`**.
  prefs: []
  type: TYPE_NORMAL
- en: '**`contacts`**'
  prefs: []
  type: TYPE_NORMAL
- en: Nagios 3.0 now allows individual contacts to be specified directly in the host
    definition. Until now you could only enter contact groups here, so you always
    had to first define a specific contact group for each individual contact. You
    can still use contact groups and specify them together with individual contacts.
  prefs: []
  type: TYPE_NORMAL
- en: '**`first_notification_delay`**'
  prefs: []
  type: TYPE_NORMAL
- en: Delay the sending of the first notification (in Nagios time units, defined by
    the new parameter **`interval_length`**; see [A.1 The Main Configuration File
    nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1 The
    Main Configuration File nagios.cfg")). Normally Nagios sends a notification immediately
    after a error turns into a hard state. In order for the first notification to
    be sent only after a certain time has elapsed, you previously had to use the escalation
    mechanism (see [12.5 Escalation Management](../Text/ch12s05.html "12.5 Escalation
    Management"), page 282). With the parameter **`first_notification_delay`** this
    can now be done more easily.
  prefs: []
  type: TYPE_NORMAL
- en: '**`flap_detection_options`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'With **`flap_detection_options`**, certain states of flap detection ([Appendix B](../Text/apb.html
    "Appendix B. Rapidly Alternating States: Flapping"), page 611) can be ruled out.'
  prefs: []
  type: TYPE_NORMAL
- en: Possible values are **`o`** (OK), **`u`**(UNREACHABLE), and **`d`** (DOWN).
    If you exclude the OK states with **`flap_detection_options o`**, Nagios will
    only take into account the change between UNREACHABLE and DOWN.
  prefs: []
  type: TYPE_NORMAL
- en: '**`notification_options`**'
  prefs: []
  type: TYPE_NORMAL
- en: If the new value **`s`** is specified, Nagios will send a notification if a
    maintenance interval (see [16.3 Planning Downtimes](../Text/ch16s03.html "16.3
    Planning Downtimes") from page 359) is started, finished, or canceled.
  prefs: []
  type: TYPE_NORMAL
- en: '**`initial_state`**'
  prefs: []
  type: TYPE_NORMAL
- en: Sets the initial state of the host. Normally Nagios assumes that this is UP
    (**`initial_state o`**). **`d`** sets the initial state to DOWN, **`u`** to UNREACHABLE.
  prefs: []
  type: TYPE_NORMAL
- en: '**`retry_interval`**'
  prefs: []
  type: TYPE_NORMAL
- en: After how many time units will an active host check be repeated if **`max_check_attempts`**
    is larger than 1? There is more on the new features for host checks in [H.7 A
    New Logic for Host Checks](../Text/aphs07.html "H.7 A New Logic for Host Checks").
  prefs: []
  type: TYPE_NORMAL
- en: Extended host information
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The objects **`hostextinfo`** and **`serviceextinfo`** are considered obsolete,
    but are still evaluated by Nagios 3.0\. When checking the configuration, as well
    as on restarting, Nagios issues a corresponding warning. Later Nagios versions
    will no longer support this object type.
  prefs: []
  type: TYPE_NORMAL
- en: 'Additional information for the Web interfaces (see [16.4.1 Extended host information](../Text/ch16s04.html#extended_host_information
    "16.4.1 Extended host information") from page 363) are now defined directly in
    the host (or service):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE73]'
  prefs: []
  type: TYPE_PRE
- en: H.1.2 The service object
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The innovations for the service object are essentially the same as those for
    the host object. The parameters **`flap_detection_options`**, **`notification_options`**,
    and **`initial_state`** are now assigned the values **`w`** (WARNING) and **`c`**
    (CRITICAL) instead of the host states DOWN and UNREACHABLE:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE74]'
  prefs: []
  type: TYPE_PRE
- en: The three parameters **`contact_groups`**, **`notification_interval`**, and
    **`notification_period`** are no longer mandatory in Nagios 3.0\. If they are
    omitted, they are taken from the **`host`** object. The parameter **`alias`**
    is also optional, and if it is not set, the name is taken from **`service_description`**.
  prefs: []
  type: TYPE_NORMAL
- en: The parameter **`parallelize_check`**, which in Nagios 2.0 is set by default
    to 1 and can be altered to prevent parallel service checks, is dropped entirely
    in Nagios 3.0; service checks here are always performed in parallel.
  prefs: []
  type: TYPE_NORMAL
- en: The parameters **`normal_check_interval`** and **`retry_check_interval`** were
    renamed to **`check_interval`** and **`retry_interval`**, in order to use the
    same identifier as for the host definition. The old name remains valid so that
    Nagios does not show an error message.
  prefs: []
  type: TYPE_NORMAL
- en: H.1.3 Group objects
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'With the parameters **`hostgroup_members`**, **`servicegroup_members`**, and
    **`contactgroup_members`** you can now also define groups of the same type as
    members of a group, and thus form hierarchies:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE75]'
  prefs: []
  type: TYPE_PRE
- en: 'Extended group information for the group types **`hostgroup`** and **`service-group`**
    allows additional information to be stored, in a similar way as for host and service
    definitions. **`notes`** here is a simple text which is displayed on the page
    with the extended status information (see [16.2.2 Additional information and control
    center: extinfo.cgi](../Text/ch16s02.html#additional_information_and_control_cent
    "16.2.2 Additional information and control center: extinfo.cgi") in page 339).
    The two URLs point to external Web pages, for instance so that a Wiki can be integrated
    for the purpose of online documentation.'
  prefs: []
  type: TYPE_NORMAL
- en: H.1.4 The contact object
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The value **`n`** (none) for the parameters **`host_notifications_options`**
    and **`service_notifications_options`** switches off notifications completely.
    This can also be achieved with a separate on/off function via the interface for
    external commands ([13.1 The Interface for External Commands](../Text/ch13.html#the_interface_for_external_commands
    "13.1 The Interface for External Commands"), page 292), which requires the new
    parameters **`host_notifications_enabled`** and **`service_notifications_enabled`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE76]'
  prefs: []
  type: TYPE_PRE
- en: They can be set to **`1`** (on) or **`0`** (off). **`can_submit_commands`**
    controls whether a contact may only view his hosts and services, or whether he
    can run commands for them via the Web interface. In Nagios 2.0 every user who
    has access to hosts and services may do this. The default is **`1`** (commands
    are allowed), **`0`** allows only viewing.
  prefs: []
  type: TYPE_NORMAL
- en: H.1.5 Time definitions
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Periods of time can be defined much more flexibly in Nagios 3.0 than was previously
    the case:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE77]'
  prefs: []
  type: TYPE_PRE
- en: 'Whereas Nagios 2.x allows only single weekdays to be defined, you can now also
    specify an ISO date (**`2007-12-23`**), the first day of a specific month (**`april
    1`**), the first day of each month (**`day 1`**), the second Monday in May (**`monday
    2 may`**), or every third Monday in the month (**`monday 3`**). Intervals are
    also allowed here, consisting of two time specifications separated by a - sign.
    In addition, time periods independent of the month or day of the week are possible:
    **`2007-12-01 - 2009-04-01 / 3`** describes evey third day from 01\. 12\. 2007
    to 01\. 04\. 2009.'
  prefs: []
  type: TYPE_NORMAL
- en: The parameter **`exclude`** rules out the time periods that follow (themselves
    also **`timeperiod`** objects).
  prefs: []
  type: TYPE_NORMAL
- en: More information on defining times can be found in [2.10 Defining a Time Period
    with timeperiod](../Text/ch02s10.html "2.10 Defining a Time Period with timeperiod")
    from page 74.
  prefs: []
  type: TYPE_NORMAL
- en: H.1.6 Dependency descriptions
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'There is a new parameter for the objects **`hostdependency`** and **`servicedependency`**
    called **`dependency_period`**, which defines how long dependencies are valid.
    An object of the type **`timeperiod`** is specified as the value. If this parameter
    is missing, dependencies are unrestricted in time:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE78]'
  prefs: []
  type: TYPE_PRE
- en: 'So-called *Same-Host Dependencies* are also new; these are **`servicedependencies`**
    that refer to the same host. In this case the parameter **`dependend_host_name`**
    is simply omitted:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE79]'
  prefs: []
  type: TYPE_PRE
- en: The **`Disk_Usage`** service therefore depends on the **`NRPE`** service on
    the same host.
  prefs: []
  type: TYPE_NORMAL
- en: If the parameter **`host_name`** is replaced with **`hostgroup_name`**, the
    same dependency can be defined for an entire host group. In Nagios 2.x this is
    not possible. If you defined **`dependent_hostgroup_name`**, the **`Disk_Usage`**
    services for all hosts of the group would be dependent on all the **`NRPE`** services
    for these hosts, which would be counterproductive in many cases.
  prefs: []
  type: TYPE_NORMAL
- en: H.1.7 Escalation objects
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'As with the host and service definition, it is also possible starting with
    Nagios 3.0 to specify individual contacts instead of a whole contact group for
    host and service escalations, by means of **`contacts`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE80]'
  prefs: []
  type: TYPE_PRE
- en: H.1.8 Inheritance
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'It was already possible in Nagios 2.x to define templates for objects and for
    the actual object to inherit the properties of the template. Multiple inheritance
    is now possible in Nagios 3.0, and an inheritance can also be selectively suppressed.
    In the following example, the two templates **`host_generic_t`** and **`host_site_t`**
    are inherited by the host **`linux01`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE81]'
  prefs: []
  type: TYPE_PRE
- en: 'The parameters **`check_interval`** and **`retry_interval`** are defined in
    both templates. In this case the first template to be defined (**`host_site_t`**)
    is used, and the result appears as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE82]'
  prefs: []
  type: TYPE_PRE
- en: Both check intervals originate from the template **`host_site_t`**. The value
    **`zero`** for **`parents`** suppresses the inheritance; a value defined in the
    templates is not carried over, and the parameter is not set.
  prefs: []
  type: TYPE_NORMAL
- en: Equally new is the option of combining a specified value with the value from
    the template. The plus sign in **`hostgroups`** carries over the value from the
    template and adds the specified value to this. Until now, inherited values were
    completely overwritten by an object. The defaults from the templates, however,
    can only be combined with the values specified in the object for standard parameters
    containing a list in text form (for example, **`hostgroups`**, **`servicegroups`**,
    **`contact_groups`**).
  prefs: []
  type: TYPE_NORMAL
- en: For **`contact_groups`** within escalations, there is an additional variation
    of the plus sign. If the enclosing escalation object does not define a contact
    group whose properties can be inherited, the accompanying host (for host escalations)
    or service definition (for service escalations) is used. The three parameters
    **`contact_groups`**, **`notification_interval`**, and **`notification_period`**
    are inherited from the host object automatically by the service object, so that
    their definition there is no longer mandatory.
  prefs: []
  type: TYPE_NORMAL
- en: The online documentation included in Nagios uses a more complex example to describe
    multiple inheritance.^([[337](#ftn.APP-H-FN-2)])
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[336](#APP-H-FN-1)]) See also [http://nagios.sourceforge.net/docs/3_0/whatsnew.html](http://nagios.sourceforge.net/docs/3_0/whatsnew.html).
  prefs: []
  type: TYPE_NORMAL
- en: ^([[337](#APP-H-FN-2)]) [http://localhost/nagios/docs/objectinheritance.html](http://localhost/nagios/docs/objectinheritance.html)
  prefs: []
  type: TYPE_NORMAL
- en: H.2 Variable and Macros
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You can define your own variables in the objects **`host`**, **`service`**,
    and **`contact`**. The names of these always begin with an underscore and are
    inherited like normal variables:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE83]'
  prefs: []
  type: TYPE_PRE
- en: 'The variable **`_NRPE_PORT`** is accessed with **`$_HOSTNRPE_PORT$`**, which
    means that the object type (**`HOST`**, **`SERVICE`**, or **`CONTACT`**) is added
    *after* the underscore. This is slightly unfortunate, as it is more difficult
    to read. The macro created can be used elsewhere, for example in the definition
    of a command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE84]'
  prefs: []
  type: TYPE_PRE
- en: Macros allow access to configuration data, states, and check results. In Nagios
    3.0 the macro **`$NOTIFICATIONNUMBER$`**, which contains the number of notifications
    sent for the current state, has been removed. It has been replaced by the host-
    and service-specific macros **`$HOSTNOTIFICATIONNUM-BER$`** and **`$SERVICENOTIFICATIONNUMBER$`**.
  prefs: []
  type: TYPE_NORMAL
- en: The list of available macros has grown considerably. Some new ones are **`$L0NGH0ST0UTPUT$`**
    and **`$LONGSERVICEOUTPUT$`**, for example, which contain the extended plugin
    output of multiple-line plugin results (see [H.10 Extended Plugin Output](../Text/aphs10.html
    "H.10 Extended Plugin Output") and [8.5.1 Multiple-line plugin output](../Text/ch08s05.html#multiple-line_plugin_output
    "8.5.1 Multiple-line plugin output"), page 193).
  prefs: []
  type: TYPE_NORMAL
- en: The macros **`$H0STN0TIFICATI0NID$`**, **`$SERVICENOTIFICATIONID$`**, **`$H0ST-EVENTID$`**,
    **`$SERVICEEVENTID$`**, **`$LASTHOSTEVENTID$`**, and **`$LASTSERVICE-EVENTID$`**
    assign to each event a unique identification number that has been added in Nagios
    3.0.
  prefs: []
  type: TYPE_NORMAL
- en: '**`$HOSTDISPLAYNAME$`** and **`$SERVICEDISPLAYNAME$`** return the **`display_name`**
    set in the host and service definition.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Also of interest are the new macros that enable the last state to be accessed:
    **`$LASTHOSTSTATE$`** and **`$LASTHOSTSTATEID$`** give the previous host state,
    and **`$LASTSERVICESTATE$`** and **`$LASTSERVICESTATEID$`** are used for the previous
    service state. The **`*ID`** macros provide the numerical value (e. g., **`2`**
    for the critical state of services), and the other two provide the corresponding
    text (e. g., WARNING for services and DOWN for hosts).'
  prefs: []
  type: TYPE_NORMAL
- en: 'Macros can usually also be read out via the environment, but the increased
    number of macros has an effect on performance. If you don''t access Nagios macros
    through environment variables, it is therefore better to switch this feature off
    entirely in Nagios 3.0:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE85]'
  prefs: []
  type: TYPE_PRE
- en: How you can use macros is described in [Appendix D](../Text/apd.html "Appendix D. Macros")
    in page 625\. The complete list of all macros can be found in the online documentation.^([[338](#ftn.APP-H-FN-3)])
    The change log for Nagios 3.0^([[339](#ftn.APP-H-FN-4)]) will tell you which of
    these are new.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[338](#APP-H-FN-3)]) [http://nagios.sourceforge.net/docs/3_0/macrolist.html](http://nagios.sourceforge.net/docs/3_0/macrolist.html)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[339](#APP-H-FN-4)]) [http://nagios.sourceforge.net/docs/3_0/whatsnew.html](http://nagios.sourceforge.net/docs/3_0/whatsnew.html)
  prefs: []
  type: TYPE_NORMAL
- en: H.3 Downtime, Comments, and Acknowledgments
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Comments and maintenance intervals are now saved together with other information
    in the status and retention file. These special files and the accompanying parameters
    **`downtime_file`** and **`comment_file`** have been removed from Nagios 3.0\.
    With an upgrade from Nagios 2.x to this version you can keep any existing comments
    and maintenance intervals—how to do this is described in [H.13 Upgrade from Nagios
    2.x to 3.0](../Text/aphs13.html "H.13 Upgrade from Nagios 2.x to 3.0").
  prefs: []
  type: TYPE_NORMAL
- en: A further change involves the commenting of acknowledgments. Until now, non-persistent
    acknowledgments were deleted with every restart. In Nagios 3.0 they now survive;
    the system deletes the comment for an acknowledgment only when the problem has
    been rectified, so that the service or host status is OK.
  prefs: []
  type: TYPE_NORMAL
- en: H.4 Rapidly Changing States
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Nagios 3.0 now records the state history even when flap detection is switched
    off. If you switch this on globally, with **`enable_flap_detection`** (see [A.1
    The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")), Nagios will test all hosts and
    services immediately for flapping.
  prefs: []
  type: TYPE_NORMAL
- en: For globally switched off flap detection, Nagios logs flapping states to the
    log file and sends messages of the notification type FLAPPINGDISABLED, if you
    have specified **`f`** (flapping) in the **`notification_options`** in the host
    or service definition.
  prefs: []
  type: TYPE_NORMAL
- en: Whereas Nagios 2.x still recorded every change in state, in Nagios 3.0 the parameter
    **`flap_detection_options`** (see [H.1.1 The host object](../Text/aph.html#the_host_object
    "H.1.1 The host object"), page 679) allows this to be restricted to certain states.
    Only the states specified are then included in the calculation of the change in
    state.
  prefs: []
  type: TYPE_NORMAL
- en: H.5 External Commands
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The list of external commands has grown larger in Nagios 3.0, so that considerably
    more things can be set through the relevant interface (see [13.1 The Interface
    for External Commands](../Text/ch13.html#the_interface_for_external_commands "13.1
    The Interface for External Commands"), page 292.).
  prefs: []
  type: TYPE_NORMAL
- en: 'Of special interest here is the command **`PROCESS_FILE`**, which is passed
    a file that itself contains external commands. This allows for the bulk processing
    of passive checks:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE86]'
  prefs: []
  type: TYPE_PRE
- en: '**`PROCESS_FILE`** requires the full path to the file that is to be processed.
    The second argument determines whether the file is kept after processing (**`0`**)
    or deleted (a value not equal to **`0`**).'
  prefs: []
  type: TYPE_NORMAL
- en: 'Two other new commands allow you to make your own notifications. Notifications
    actually have a fixed type (**`PROBLEM`**, **`RECOVERY`**, **`ACKNOWLEDGE`**,
    etc.; see [Table 12-1](../Text/ch12s04.html#macros_used_in_notify-by-email_and_host
    "Table 12-1. Macros used in notify-by-email and host-notify-by-email") in page
    277), which is queried via the macro **`$N0TIFI-CATI0NTYPE$`**. The so-called
    *Custom Notifications*, in contrast, are of the type **`CUSTOM`** and allow notifications
    outside the otherwise strict rules. This means that broadcasts—messages to all—are
    also possible:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE87]'
  prefs: []
  type: TYPE_PRE
- en: Instead of the *options* placeholder, you specify a bitmask, which controls
    the behavior of the two commands. The value **`0`** means "no option set." **`1`**
    ensures a broadcast message to all normal contacts and to those who are added
    during an escalation. **`2`** forces the message to be sent, regardless of whether
    notifications are switched on or off for the host, service, or contact, and ignores
    any time window that may be set. Finally, the value **`4`** increments the notification
    counter, and the message is then counted in the escalation procedure. Normally
    a Custom Notification is not counted.
  prefs: []
  type: TYPE_NORMAL
- en: A complete description of all external commands is provided on the developer
    pages of the Nagios homepage.^([[340](#ftn.APP-H-FN-5)]) The Web interface there
    enables a selective search to be made for commands that are allowed in a specific
    Nagios version or deal with a certain topic (for example, services, hosts, **scheduled
    downtime** (maintenance window), **notifications**).
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[340](#APP-H-FN-5)]) [http://www.nagios.org/developerinfo/externalconunands/conunandlist.php](http://www.nagios.org/developerinfo/externalconunands/conunandlist.php)
  prefs: []
  type: TYPE_NORMAL
- en: H.6 Embedded Perl
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Handling the Embedded Perl Interpreter (see [Appendix G](../Text/apg.html "Appendix G. The
    Embedded Perl Interpreter") from page 669) is also easier in Nagios 3.0\. It can
    be switched on or off with the parameter **`enable_embeded_perl`** in the main
    configuration file **`nagios.cfg`**. The parameter **`use_embedded_perl_implicitly`**
    controls whether a plugin should implicitly use the activated interpreter if there
    are no instructions to the contrary (see also [G.2 Using ePN](../Text/apgs02.html
    "G.2 Using ePN") from page 672). In Nagios 2.x there was only the option of switching
    the interpreter on or off when compiling the Nagios system.
  prefs: []
  type: TYPE_NORMAL
- en: If the switch **`--with-embedded-perl`** is enabled, the **`configure`** script
    of Nagios 3.0 automatically uses the switch **`--with-perlcache`** as well. If
    Nagios detects that something has changed in the script to be executed, it will
    reload the script. In version 2.x you had to restart Nagios with the Perl cache
    switched on.
  prefs: []
  type: TYPE_NORMAL
- en: H.7 A New Logic for Host Checks
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Nagios 2.x performs host checks serially, so it waits for the results of the
    individual check before checking other hosts in the direct vicinity to find out
    if the first host is DOWN or UNREACHABLE (see the figure in [4.1 Taking into Account
    the Network Topology](../Text/ch04.html#taking_into_account_the_network_topology
    "4.1 Taking into Account the Network Topology")). In contrast, Nagios 3.0 works
    in parallel here, provided that the parameter **`max_check_attempts`** for the
    host to be checked is larger than **`1`**. For **`max_check_attempts=l`** the
    system behaves as in version 2.x.
  prefs: []
  type: TYPE_NORMAL
- en: In some cases this strongly influence performance, so you should always set
    a value larger than **`1`** in Nagios 3.0\. Running host checks in parallel also
    means that a check result will sometimes get lost, since Nagios no longer waits
    until the result for every single check is available. The parameter **`check_for_orphaned_hosts`**
    now ensures that Nagios will deal with orphaned checks.
  prefs: []
  type: TYPE_NORMAL
- en: Active host checks can even improve performance in certain environments, if
    the equally new feature of *check caching* is used. Here Nagios accesses the result
    of a recently performed check, provided that this can be considered to be up to
    date. This means that the system saves a considerable amount of time in host checks
    for failed services, in resolving the topology for failed hosts, and for forward-looking
    dependency checks (see last section). For service checks, caching only plays a
    role for service dependencies.
  prefs: []
  type: TYPE_NORMAL
- en: How large the time horizon for caching should be is defined for host checks
    by the parameter **`cached_host_check_horizon`** (see also [A.1 The Main Configuration
    File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    The Main Configuration File nagios.cfg")) and for service checks by the parameter
    **`cached_service_check_horizon`** ([A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")). The default is 15 seconds in each
    case, and the value **`0`** switches caching off entirely.
  prefs: []
  type: TYPE_NORMAL
- en: 'The larger the time interval in which Nagios caches results, the more often
    Nagios accesses the cache without actually performing the check itself. However,
    this does have a crucial disadvantage: The cached result may be obsolete. Therefore,
    you always need to compromise between obsolete results and taking the strain off
    Nagios. You will have to decide for yourself how large the time interval for caching
    should be. Again, the preferred method is to measure the latency times of service
    checks, which are a good indication of the performance of Nagios. If there is
    no visible difference over a long period of time between a caching time of 30
    seconds and one of 60 seconds, it is better to select the shorter period, since
    you will be working with more up-to-date results in this case. How you measure
    the latency times of checks is described in [F.1.3 A plugin to monitor latency](../Text/apf.html#a_plugin_to_monitor_latency
    "F.1.3 A plugin to monitor latency") from page 660.'
  prefs: []
  type: TYPE_NORMAL
- en: Whether or not active host checks in combination with check caching lead to
    an improvement in performance can also be tested with **`nagiostats`** ([F.1.1
    The command-line tool nagiostats](../Text/apf.html#the_command-line_tool_nagiostats
    "F.1.1 The command-line tool nagiostats"), page 654). The program displays the
    number of cached host checks whose results have been reused by Nagios in the last
    minute, in the last five minutes, and in the last fifteen minutes.
  prefs: []
  type: TYPE_NORMAL
- en: 'In distributed environments, or for redundant Nagios installations, the perspective
    is sometimes altered: Nagios server A has a different topological view of the
    network than Nagios server B. The result of a host check that server A sends to
    server B as a passive check result may in some cases no longer match. What is
    categorized by server A as UNREACHABLE may be a failed host in the DOWN state
    from the perspective of server B. The parameter **`translate_passive_host_checks`**
    ([A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")) enables Nagios to reclassify passive
    host checks that it has been sent.'
  prefs: []
  type: TYPE_NORMAL
- en: To achieve greater fine-tuning, passive host checks may now also accept a soft
    state if you set the parameter **`max_check_attempts`** in the host definition
    to a value larger than **`1`** and enable the parameter **`passive_host_checks_are_soft`**
    (page 600) in the main configuration file. Until now, passive host checks were
    always "hard."
  prefs: []
  type: TYPE_NORMAL
- en: H.8 Restart
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'When you start Nagios, it rechecks the configuration each time for errors and
    dependencies. Depending on the specific environment, this can be very quick, or
    it may last a long time, during which Nagios will not operate. In Nagios 3.0 there
    is an option to disconnect this test from the restart and instead save the result
    in a separate temporary file. When Nagios starts, it will read this file, and
    the otherwise usual processing of objects is left out at this point. Whether this
    is worthwhile or not is revealed by **`nagios -s`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE88]'
  prefs: []
  type: TYPE_PRE
- en: The times marked with **`*`** are saved with this *precaching* procedure. In
    this example, 75 percent of the startup time is occupied with processing the defined
    objects, but in absolute terms, this is just a tenth of a second and so is hardly
    worth mentioning.
  prefs: []
  type: TYPE_NORMAL
- en: 'If there is real potential for savings, precaching is turned on with the following
    steps:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE89]'
  prefs: []
  type: TYPE_PRE
- en: The first call uses the options **`-v`** to check the configuration and **`-p`**
    to cache the processed objects in a separate file. The file is defined in **`nagios.cfg`**
    with the parameter **`precached_object_file`** ([A.1 The Main Configuration File
    nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1 The
    Main Configuration File nagios.cfg")). Then Nagios is stopped in the second step.
  prefs: []
  type: TYPE_NORMAL
- en: The third step is to start the system with the options **`-udx`**. The option
    **`-u`** reads the contents of the precaching file, and **`-d`** starts Nagios
    as a daemon, as normal. **`-x`** prevents the test for circular dependencies,
    but assumes that this call is always based on a tested configuration, like the
    one generated in step 1\. Whether the option **`-x`** really saves time or not
    can be seen in the example above from the line **`Circular Paths`** in the **`CONFIG
    VERIFICATION TIMES`** section.
  prefs: []
  type: TYPE_NORMAL
- en: H.9 Performance Optimization
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Besides performance optimizations that are not externally visible, Nagios 3.0
    includes a number of parameters intended to improve performance in large installations.
    The most important of these is **`large_installation_tweaks`** ([F.2.6 Preferring
    passive checks](../Text/apfs03.html "F.2.6 Preferring passive checks")).
  prefs: []
  type: TYPE_NORMAL
- en: The improvement of performance in an existing environment is dealt with in [Appendix F](../Text/apf.html
    "Appendix F. Tips on Optimizing Performance") from page 653.
  prefs: []
  type: TYPE_NORMAL
- en: H.10 Extended Plugin Output
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Nagios 3.0 is finally capable of processing multi-line plugin output. The total
    length of the output must not exceed 8 KB—but you must also make sure that all
    the transmission paths are compatible for such an amount of data. NRPE currently
    still needs to be adjusted in the source code ([8.5.2 Installation requirements](../Text/ch08s05.html#installation_requirements
    "8.5.2 Installation requirements")); the plugin **`check_by_ssh`** from the standard
    plugins inversion 1.4.10 ([Chapter 9](../Text/ch09.html "Chapter 9. Executing
    Plugins via SSH")) can deal with the 8 KB.
  prefs: []
  type: TYPE_NORMAL
- en: The format of the extended and muti-line outputs are described in [8.5.1 Multiple-line
    plugin output](../Text/ch08s05.html#multiple-line_plugin_output "8.5.1 Multiple-line
    plugin output") (page 193), and an example of the use of the extended format is
    provided by the plugin **`check_multi`** ([8.5 Summarizing Checks with check_multi](../Text/ch08s05.html
    "8.5 Summarizing Checks with check_multi") from page 191).
  prefs: []
  type: TYPE_NORMAL
- en: H.11 CGI
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The Nagios Web interface has also undergone some interesting changes. Some new
    parameters have been added to the configuration file **`cgi.cfg`** ([A.2 CGI Configuration
    in cgi.cfg](../Text/apas02.html "A.2 CGI Configuration in cgi.cfg"), page 606).
    **`lock_author_names`** prevents the user name, which is included if you set an
    acknowledgement or a comment on a host or service, from being changed. Instead
    the user name specified by the user when authenticating himself to the Web server
    is used. Each registered user is thus an authenticated user.
  prefs: []
  type: TYPE_NORMAL
- en: '**`escape_html_tags`** determines whether HTML formatting in the plugin output
    is used (value **`0`**) or whether Nagios removes it (value **`1`**). In order
    to link it with **`action_url`** ([16.4.1 Extended host information](../Text/ch16s04.html#extended_host_information
    "16.4.1 Extended host information")) and **`notes_url`** ([16.4.1 Extended host
    information](../Text/ch16s04.html#extended_host_information "16.4.1 Extended host
    information")), there is now an additional option to specify a target window,
    with **`action_url_target`** and **`notes_url_target`**.'
  prefs: []
  type: TYPE_NORMAL
- en: 'With the CGI program **`status.cgi`** ([16.2.1 Variations in status display:
    status.cgi](../Text/ch16s02.html#variations_in_status_display_colon_stat "16.2.1
    Variations in status display: status.cgi"), page 334) you can now select hard
    and soft states via **`hostprops`** and **`serviceprops`** as well. This is particularly
    useful when using NagVis ([Chapter 18](../Text/ch18.html "Chapter 18. NagVis"),
    page 389), since NagVis by default only displays hard error states.'
  prefs: []
  type: TYPE_NORMAL
- en: H.12 Miscellaneous
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: One of the improvements that does not fit into any of the above sections is
    the parameter **`use_timezone`** (page 606), with which you can set the time zone
    independently of the time zone set on the Nagios server. This is only necessary
    if several Nagios instances are running on a single machine.
  prefs: []
  type: TYPE_NORMAL
- en: The parameter **`additional_freslmess_latency`** (see [Appendix A](../Text/apa.html
    "Appendix A. An Overview of the Nagios Configuration Parameters")) delays freshness
    checks (see [13.4 Reacting to Out-of-Date Information of Passive Checks](../Text/ch13s04.html
    "13.4 Reacting to Out-of-Date Information of Passive Checks"), page 295), normally
    using a time period specified in seconds, in case Nagios has to wait too long
    for a result for passive checks.
  prefs: []
  type: TYPE_NORMAL
- en: The directives **`cfg_file`** and **`cfg_dir`** ([A.1 The Main Configuration
    File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    The Main Configuration File nagios.cfg")) can now also handle relative paths.
    The base directory is the directory containing the file **`nagios.cfg`**.
  prefs: []
  type: TYPE_NORMAL
- en: The parameter **`temp_path`** allows a temporary directory to be specified explicitly
    (in Nagios 2.x the temporary space consists of only a single file, defined in
    the parameter **`temp_file`**).
  prefs: []
  type: TYPE_NORMAL
- en: Nagios 3.0 now allows multiple-line instructions in all configuration files.
    An instruction that is continued on the following line must end with a backslash
    **`\`**.
  prefs: []
  type: TYPE_NORMAL
- en: H.13 Upgrade from Nagios 2.x to 3.0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If you already have a running Nagios-2.x environment, you can change over to
    Nagios 3.0 with little effort. The existing configuration will usually run unchanged.
  prefs: []
  type: TYPE_NORMAL
- en: 'Nagios 3.0 is very particular when testing, however. It is quite possible that
    a so far undiscovered error—one tolerated or ignored by Nagios 2.0—will prevent
    Nagios 3.0 from starting. It is therefore a good idea to test your configuration
    before upgrading. To do this, you run the installation as described in [1.2 Compiling
    Source Code](../Text/ch01s02.html "1.2 Compiling Source Code") in page 39 with
    **`configure`** and **`make all`**, but without running **`make install`**. You
    will obtain an executable Nagios-3.0 binary in the **`base`** subdirectory, which
    you can use to test the existing configuration from the source code directory:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE90]'
  prefs: []
  type: TYPE_PRE
- en: If Nagios finds an error here, this error will prevent the start of the new
    Nagios version if it is not eliminated. At some points Nagios 3.0 will give warnings
    and information about the new features, but these do not stand in the way of a
    restart.
  prefs: []
  type: TYPE_NORMAL
- en: Nevertheless, there are a few small details that you should attend to before
    Nagios 3.0 goes into operation. The parameter **`service_reaper_frequency`** is
    now called **`check_result_reaper_frequency`** ([A.1 The Main Configuration File
    nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1 The
    Main Configuration File nagios.cfg")); it is simply renamed in **`nagios.cfg.aggregate_status_updates`**
    is removed altogether, so it is commented out in **`nagios.cfg`**.
  prefs: []
  type: TYPE_NORMAL
- en: The macro **`$NOTIFICATIONNUMBER$`** was sensibly split up into a host- and
    a service-specific macro (**`$HOSTNOTIFICATIONNUMBER$`** and **`$SERVICEN0TI-FICATI0NNUMBER$`**).
    Commands and scripts that use the macro must be adjusted to ensure that they work
    correctly.
  prefs: []
  type: TYPE_NORMAL
- en: 'In order to retain the maintenance intervals and comments from the no longer
    used files specified in **`downtime_file`** and **`comment_file`** (in this book,
    **`comments.dat`** and **`downtime.dat`**), you must stop Nagios, save them, and
    then remove the Info block at the beginning from them, since this may occur only
    once in the new file, specified in **`retention_file`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE91]'
  prefs: []
  type: TYPE_PRE
- en: 'Then the contents of the two files are copied to the end of the retention file,
    which here in this book is the file **`/var/nagios/retention.dat`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE92]'
  prefs: []
  type: TYPE_PRE
- en: 'Now the three remaining installation steps are performed (see [1.2 Compiling
    Source Code](../Text/ch01s02.html "1.2 Compiling Source Code")):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE93]'
  prefs: []
  type: TYPE_PRE
