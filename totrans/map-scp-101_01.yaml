- en: Chapter 1. MAPPING BASICS
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages671943.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*X* marks the spot, right? That''s the old pirate saying. Have you ever wondered
    who made maps for the pirates? The pirates had to do it themselves. No wonder
    they were so cranky! If they''d only had today''s technology, the pirates could
    have used someone else''s map and only had to mark the *X* themselves, leaving
    the intricate coastline detail to the cartographer.'
  prefs: []
  type: TYPE_NORMAL
- en: Luckily, you live in the present day and have all sorts of mapping options.
    You can use Google Maps, Yahoo! Maps, and many others. And these maps make mapping
    easy; all you need are just a few lines of code to include a map on your web page.
    [Figure 1-1](ch01.html#local_search_site_yelp_uses_google_maps "Figure 1-1. Local
    search site Yelp uses Google Maps.") shows a page from Yelp, a restaurant review
    site and one of thousands of sites that use maps to mark locations.
  prefs: []
  type: TYPE_NORMAL
- en: '![Local search site Yelp uses Google Maps.](httpatomoreillycomsourcenostarchimages671947.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 1-1. Local search site Yelp uses Google Maps.
  prefs: []
  type: TYPE_NORMAL
- en: To embed a map, you need to use an API. An AP . . . what? API stands for *Application
    Programming Interface*, and it consists of a collection of functions that make
    creating maps easier. You'll still have to do some programming, but writing your
    code will be trivial compared to what you'd have to do if you had to do everything
    yourself. Sound familiar, matey?
  prefs: []
  type: TYPE_NORMAL
- en: 'The Mapping APIs: Google, Yahoo!, and Mapstraction'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As I mentioned, you can choose from a number of mapping API providers. The features
    and the style of the maps vary, though the APIs share a number of elements. This
    book will cover mapping tools from Google and Yahoo!, but most of the code examples
    will use a JavaScript library called Mapstraction, which is also an API, but different
    from the others. Mapstraction is not a mapping service itself; instead, it is
    a wrapper for other APIs. You write the code once, and it will work on Google
    Maps, Yahoo! Maps, and ten other providers.^([[1](#ftn.CHP-1-FN-1)])
  prefs: []
  type: TYPE_NORMAL
- en: Mapstraction doesn't always support every provider's features, but it covers
    those features the services share and more. For the majority of mapping projects,
    using Mapstraction makes sense. Every now and then, you'll come across an example
    that only works with one provider. In those cases, I will clearly indicate where
    the Mapstraction code ends and the proprietary code begins.
  prefs: []
  type: TYPE_NORMAL
- en: Using Mapstraction is about foresight. How much code will you need to rewrite
    if, for example, Google shuts down its Maps API? If that sounds far-fetched, then
    consider instead what might happen if your mapping provider starts showing annoying
    ads or another comes along that has maps with colors more suitable to your design.
    Mapstraction allows you to switch seamlessly between providers. So you write the
    code once, and it works everywhere.
  prefs: []
  type: TYPE_NORMAL
- en: Before you can begin plotting locations on a map, however, you need to understand
    mapping basics. One of the most important concepts is the coordinate system used
    to describe a point on the earth. Let's look at how that is done.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[1](#CHP-1-FN-1)]) CloudMade, FreeEarth, Map24, MapQuest, Microsoft, MultiMap,
    OpenLayers, OpenSpace, OpenStreetMap, and ViaMichelin
  prefs: []
  type: TYPE_NORMAL
- en: Describe a Point on the Earth
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Geographers have a difficult job, taking a round earth and giving it meaning
    on a flat map. For those with the skills, the job is an exercise in accepting
    imprecision. Because, despite what Columbus said, the earth is not round; it's
    not even a sphere. The earth is an ellipsoid, slightly wider than it is tall.
    We owe the astronomers and mathematicians who have worked hard over the past few
    hundred years to help us pinpoint a location as accurately as we can a great many
    "thank yous."
  prefs: []
  type: TYPE_NORMAL
- en: The most common way to describe a point on the earth is to use latitude and
    longitude coordinates. This system is used by GPS devices, every web mapping API
    provider, and this book. With it, we can convert a complicated ellipsoid into
    a standard coordinate frame like we used in algebra class to create graphs. A
    world map is shown in [Figure 1-2](ch01s02.html#world_map_with_grid_overlay "Figure 1-2. World
    map with grid overlay") with the axes overlaid.
  prefs: []
  type: TYPE_NORMAL
- en: 'The points we plot indicate locations on earth, with an error of only two centimeters
    (0.8 of an inch). Rather than calling the axes *x* and *y*, as we did in school,
    we call them latitude and longitude. We can express coordinate pairs in several
    ways:'
  prefs: []
  type: TYPE_NORMAL
- en: '| **45° 33′ 25″ N, 122° 31′ 55″ W** |'
  prefs: []
  type: TYPE_TB
- en: '| **45° 33.4′, −122° 31.9′ or 45d33.4m, −122d31.9m** |'
  prefs: []
  type: TYPE_TB
- en: '| **45.55713, −122.53194** |'
  prefs: []
  type: TYPE_TB
- en: As you might have guessed, these coordinate pairs are all roughly equal ways
    of expressing the same point. The units are degrees (°), minutes (′), and seconds
    (″). Each degree is split into 60 minutes, and each minute is then further diced
    into 60 seconds. The decimal representation, in the third example, is used by
    mapping providers and is the style you will see most in this book.
  prefs: []
  type: TYPE_NORMAL
- en: Like the coordinate frame we're all familiar with, each axis has a zero point,
    with values increasing in one direction and decreasing in the other direction.
    Therefore, latitudes and longitudes can have both positive and negative numbers.
  prefs: []
  type: TYPE_NORMAL
- en: '*Latitude* measures the vertical axis, which describes how far north or south
    a location is. The zero point for latitude is the equator. To the north, the values
    increase until reaching 90 degrees at the pole. South of the equator, latitude
    decreases, with −90 degrees being the other pole.'
  prefs: []
  type: TYPE_NORMAL
- en: '![World map with grid overlay](httpatomoreillycomsourcenostarchimages671949.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 1-2. World map with grid overlay
  prefs: []
  type: TYPE_NORMAL
- en: The horizontal axis measurement is called *longitude*. Longitude describes how
    far west or east a location is. The earth does not have a natural vertical equator,
    so scientists and politicians had to decide on a zero point. They chose the location
    of astronomer George Biddell Airy's telescope in Greenwich, London (the Royal
    Observatory), to be the *Prime Meridian*. To the east of this spot, longitudes
    increase to 180 degrees on the other side of the earth. Similarly, longitude decreases
    to −180 degrees to the west, meeting positive longitudes opposite the Prime Meridian
    (called the *antipodal* meridian).
  prefs: []
  type: TYPE_NORMAL
- en: Why does latitude stop at 90 degrees and longitude continue to 180 degrees?
    The horizontal axis does not have any poles, so picking a place to stop would
    be as arbitrary as the meridians. Also, latitude degrees are parallel to one another,
    whereas longitudinal lines become closer to each other at the poles. Points along
    a specific latitude are symmetrical. If you traced the hypothetical 100 degrees
    latitude halfway around the earth, you would arrive at 80 degrees latitude, so
    you might as well just call it that.
  prefs: []
  type: TYPE_NORMAL
- en: Now that you have a feel for how coordinates are used, let's look at the different
    ways they are expressed and how you can switch between them.
  prefs: []
  type: TYPE_NORMAL
- en: Convert Between Decimal and Degree Formats
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When I first introduced latitude and longitude points, I showed several examples.
    If you work with enough geographic data, you'll likely end up seeing each of those
    ways of expressing the same point. In this section, I'll show you how to convert
    between the two most common formats.
  prefs: []
  type: TYPE_NORMAL
- en: Mapping APIs accept latitude and longitude values as a pair of decimal numbers.
    For example, the No Starch Press office in San Francisco is situated at 37.7740486,
    −122.4101883\. What does that mean? First, finding the major degrees is easy—these
    are the numbers before the decimal, so 37 and −122 in this case.
  prefs: []
  type: TYPE_NORMAL
- en: The remaining decimals describe how close this value is to the next degree.
    A latitude of 37.7740486 is more than halfway between the 37th and 38th degree.
    A portion of a degree is expressed as minutes and seconds.
  prefs: []
  type: TYPE_NORMAL
- en: 'Multiply the decimal portion of the coordinates by 60 to get the number of
    minutes:'
  prefs: []
  type: TYPE_NORMAL
- en: '| **0.7740486 × 60 = 46.442916 minutes** |'
  prefs: []
  type: TYPE_TB
- en: '| **0.4101883 × 60 = 24.611298 minutes** |'
  prefs: []
  type: TYPE_TB
- en: 'Now we''re getting somewhere. The latitude is 37 degrees, 46 minutes. The longitude
    is −122 degrees, 24 minutes. However, the answer has a decimal portion. We need
    to repeat the previous step, multiplying these new decimals by 60 to determine
    the number of seconds:'
  prefs: []
  type: TYPE_NORMAL
- en: '| **0.442916 × 60 = 26.57496 seconds** |'
  prefs: []
  type: TYPE_TB
- en: '| **0.611298 × 60 = 36.67788 seconds** |'
  prefs: []
  type: TYPE_TB
- en: Again, we're left with a decimal portion. Unless we want to be extremely precise,
    we can just take the whole number at this point. The difference between 26.57496
    seconds and 26 seconds is one hundredth of a mile. Some people choose to leave
    a single digit after the decimal point. Then our measurement is precise within
    about five feet, which is almost certainly less than a pixel on a web map.
  prefs: []
  type: TYPE_NORMAL
- en: The final answer after converting from point 37.7740486, −122.4101883 to degree,
    minute, second format is 37° 46′ 26″ N, 122° 24′ 36″ W.
  prefs: []
  type: TYPE_NORMAL
- en: Note the directions, which show this location is in the northern and western
    hemispheres. Also, the longitude is no longer expressed as a negative because
    the location is west of the Prime Meridian.
  prefs: []
  type: TYPE_NORMAL
- en: Converting from degree, minute, second to decimal format is even easier. As
    before, converting the degree is easy, as it becomes the whole number portion
    to the left of the decimal. Now we just have to remember to use a negative number
    to indicate the southern and western hemispheres.
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, we convert the minutes portion into seconds (multiply by 60) and add
    that result to the existing seconds:'
  prefs: []
  type: TYPE_NORMAL
- en: '| **46 × 60 + 26 = 2,786 seconds latitude** |'
  prefs: []
  type: TYPE_TB
- en: '| **24 × 60 + 36 = 1,476 seconds longitude** |'
  prefs: []
  type: TYPE_TB
- en: 'Finally, divide each of those results by the number of seconds in one degree,
    which is 3,600 (60 × 60):'
  prefs: []
  type: TYPE_NORMAL
- en: '| **2,786 / 3600 = 0.77389** |'
  prefs: []
  type: TYPE_TB
- en: '| **1,476 / 3600 = 0.41000** |'
  prefs: []
  type: TYPE_TB
- en: The answer after converting point 37° 46′ 26″ N, 122° 24′ 36″ W to decimal format
    is 37.77389, −122.41000\. The answer is roughly the same as the decimal version
    the section started with. The difference is the rounding error, which isn't very
    significant for this purpose. You will discover more about precision in the next
    project.
  prefs: []
  type: TYPE_NORMAL
- en: Determine Precision of Decimal Coordinates
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The latitude and longitude format most commonly used expresses degrees as decimals.
    Mapping providers, and also most services, convert from degrees to decimals to
    provide location data.
  prefs: []
  type: TYPE_NORMAL
- en: 'You might remember a tricky little thing about decimals from learning real
    numbers in math class: they can go on forever. You have to decide how many digits
    to use, much like calculators only have room for a certain amount of numbers.
    At some point, decimals need to be chopped off.'
  prefs: []
  type: TYPE_NORMAL
- en: The number of decimals in latitude and longitude points varies by service. However,
    most services provide at least five digits after the decimal. As you can see in
    [Table 1-1](ch01s02.html#latitude_precision_by_number_of_decimals "Table 1-1. Latitude
    Precision by Number of Decimals"), five digits is enough to get within four feet
    of the location. In other words, for plotting points on a web map, five digits
    is plenty.
  prefs: []
  type: TYPE_NORMAL
- en: Table 1-1. Latitude Precision by Number of Decimals
  prefs: []
  type: TYPE_NORMAL
- en: '| Digits after decimal | Possible error |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| 1 | 7 miles (11 km) |'
  prefs: []
  type: TYPE_TB
- en: '| 2 | ¾ mile (1 km) |'
  prefs: []
  type: TYPE_TB
- en: '| 3 | 370 feet (110 meters) |'
  prefs: []
  type: TYPE_TB
- en: '| 4 | 37 feet (11 meters) |'
  prefs: []
  type: TYPE_TB
- en: '| 5 | 4 feet (1 meter) |'
  prefs: []
  type: TYPE_TB
- en: 'City-level coordinates often have as few as one digit after the decimal. Only
    using one digit gives a possible error of 7 miles, but the coordinates will still
    be within the bounds of most cities. For example, Yahoo!''s weather API (used
    in [#69: Create a Weather Map](ch10s02.html "#69: Create a Weather Map") in [#69:
    Create a Weather Map](ch10s02.html "#69: Create a Weather Map")) gives city coordinates
    to only two digits of precision, which reduces the error to less than one mile.'
  prefs: []
  type: TYPE_NORMAL
- en: Longitude precision is not as easy to calculate as latitude, because degrees
    of longitude are not parallel. At the equator, the latitude and longitude charts
    would be the same. As longitude lines near the poles, however, they come closer
    together. The good news is that the latitude error is the maximum that can exist
    for longitude, so, in most cases, the error is smaller for longitudes.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The latitude error also varies by about 1 km between the equator and the poles,
    but this error is a much smaller variation than with longitude.
  prefs: []
  type: TYPE_NORMAL
- en: 'You''ll learn more about the strange quirks of longitude in [#36: Calculate
    Distance Between Two Points](ch06.html#number_symble_36_colon_calculate_distanc
    "#36: Calculate Distance Between Two Points") in [#36: Calculate Distance Between
    Two Points](ch06.html#number_symble_36_colon_calculate_distanc "#36: Calculate
    Distance Between Two Points"), where I''ll show how to adjust for the different
    distances between degrees based on latitude.'
  prefs: []
  type: TYPE_NORMAL
- en: Create Your First Map
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: You are about to embark upon an education in neocartography, taking yourself
    from plain ol' web developer to a Geolocative Web Developer. We'll create a basic
    map in this section, and it will serve as a building block for future projects.
  prefs: []
  type: TYPE_NORMAL
- en: First, we'll use the Google Maps API to create a map centered on the No Starch
    Press offices in San Francisco. Then, I'll show you the changes necessary to create
    the same map using Yahoo!'s service. Finally, I'll show how nearly identical Mapstraction
    code can create both of those maps.
  prefs: []
  type: TYPE_NORMAL
- en: Create a Google Map
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Google is the 500 pound gorilla in many areas of the Web, and mapping is no
    exception. Most map developers choose the Google Maps API, if only because of
    its ubiquity. In addition to being everywhere, Google Maps is fast and stable.
  prefs: []
  type: TYPE_NORMAL
- en: Google Maps has been around since 2005\. That's not to say the Maps team isn't
    innovating. On the contrary, Google Maps is often the first to add new features
    to its API, such as driving directions and a 360-degree view of any address in
    many cities in the United States and select places across the globe.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s create a basic map using Google. Open a new HTML file and type the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: Save your file and load it in a browser. The result should look something like
    [Figure 1-3](ch01s03.html#a_basic_google_map "Figure 1-3. A basic Google Map"),
    with your Google Map centered on No Starch Press's neighborhood in San Francisco.
  prefs: []
  type: TYPE_NORMAL
- en: '![A basic Google Map](httpatomoreillycomsourcenostarchimages671951.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 1-3. A basic Google Map
  prefs: []
  type: TYPE_NORMAL
- en: As you can see, the HTML hooks are minimal. An empty `div` tag ❸ with an `id`
    attribute is all that's required. The JavaScript function `create_map()` takes
    over and makes calls to the API. This function can have any name you want. In
    many examples in this book, I'll use this same name.
  prefs: []
  type: TYPE_NORMAL
- en: Before creating the map, we'll need to set some options ❶. The minimum amount
    of information needed is a center (using a latitude/longitude pair), a zoom level
    and a map type. Then, we pass those options and reference the `div` tag's `id`
    to create a map ❷.
  prefs: []
  type: TYPE_NORMAL
- en: And just like that you've created your first Google Map. Read on to see how
    this map is different from Yahoo! and how you can use Mapstraction to write code
    once that will work with any mapping provider.
  prefs: []
  type: TYPE_NORMAL
- en: Create a Yahoo! Map
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Yahoo! released its mapping API around the same time as Google. Unfortunately,
    the first version was Flash-based and difficult to use. Google grabbed an early
    lead and Yahoo! has been playing catch-up ever since. Now Yahoo! has a JavaScript
    API with features similar to Google's.
  prefs: []
  type: TYPE_NORMAL
- en: 'You''ll need an API key from Yahoo! and a Yahoo! account to use its maps. To
    register an application, which gives you a key, visit this web page: [https://developer.yahoo.com/wsregapp/](https://developer.yahoo.com/wsregapp/).'
  prefs: []
  type: TYPE_NORMAL
- en: Select the option with no authentication because you will not be accessing Yahoo!
    user data. Fill out the rest of the form with information about your application,
    click the button, and you're set.
  prefs: []
  type: TYPE_NORMAL
- en: 'Once you get your API key, you''re ready to create a Yahoo! Map. To do that,
    start with the Google example in the previous section. Replace the call to Google''s
    JavaScript to instead include Yahoo!''s code (be sure to use your API key):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'Next, alter the contents of the `create_map` function like so:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: Save your file and load it in a browser. The result should look something like
    [Figure 1-4](ch01s03.html#a_basic_yahoo_exclamation_map "Figure 1-4. A basic Yahoo!
    Map"), with your Yahoo! Map centered on No Starch Press's neighborhood in San
    Francisco.
  prefs: []
  type: TYPE_NORMAL
- en: '![A basic Yahoo! Map](httpatomoreillycomsourcenostarchimages671953.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 1-4. A basic Yahoo! Map
  prefs: []
  type: TYPE_NORMAL
- en: The code is not that different from Google Maps. You create a new map by referencing
    the `div` tag's `id` ❶. And you give the map a center by using a latitude/longitude
    pair ❷. The biggest differences are in terms of syntax and order. With Yahoo,
    you create a map, then add options, such as the zoom level and center.
  prefs: []
  type: TYPE_NORMAL
- en: The concept behind the two maps is very similar. But these minor differences
    compound to become a big pain, however, if you need to switch from one to the
    other. That's why Mapstraction is so powerful, as you will see in the next section.
  prefs: []
  type: TYPE_NORMAL
- en: Create a Mapstraction Map
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Mapstraction is a little different from Google Maps and Yahoo! Maps. Mapstraction
    is an open source JavaScript library that ties into other mapping APIs. If you
    use Mapstraction, you can switch from one type of map to another with very little
    work, as opposed to rewriting your code completely.
  prefs: []
  type: TYPE_NORMAL
- en: Using Mapstraction limits your risk to changes being made to an API. For example,
    if your site's traffic takes you beyond the limit for your chosen provider, or
    the provider begins placing ads on the map, Mapstraction lets you switch providers
    quickly and inexpensively.
  prefs: []
  type: TYPE_NORMAL
- en: To use Mapstraction, you must first choose a provider. In this example, I'm
    using Mapstraction to create a Google Map.
  prefs: []
  type: TYPE_NORMAL
- en: 'Open a new HTML file and type the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: Just like you would for a normal Google Map, we include Google's JavaScript
    ❶. For this code to work, you also need to download the Mapstraction files. Go
    to [http://mapstraction.com/](http://mapstraction.com/), and follow the instructions
    to save the files in the same directory as your HTML file. Best practices would
    dictate that you keep JavaScript files in their own directory, separate from your
    HTML, but I'm simplifying things for this example.
  prefs: []
  type: TYPE_NORMAL
- en: The Mapstraction files you should have, at minimum, are *mxn.js*, *mxn.core.js*
    and *googlev3.core.js*. You may also have files for other providers, such as *yahoo.core.js*.
    The only one we need to reference in our HTML code is *mxn.js*, which loads the
    other files that it needs, including those that we pass it in the filename ❷.
    Then, in the `create_map` function, we let it know which type of map ❸ we are
    creating.
  prefs: []
  type: TYPE_NORMAL
- en: Once you have your Mapstraction map, save your HTML file and load it in a browser.
    The result should look exactly like the Google Map in [Figure 1-4](ch01s03.html#a_basic_yahoo_exclamation_map
    "Figure 1-4. A basic Yahoo! Map"). This Google Map, created via Mapstraction,
    should be centered on No Starch Press's neighborhood in San Francisco.
  prefs: []
  type: TYPE_NORMAL
- en: Use Yahoo! Maps with Mapstraction
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To get an idea of how powerful the Mapstraction library is, let's try using
    Yahoo! Maps instead of Google Maps. You only have to change a few bits in the
    code. And the best part is even if you have a lot of Mapstraction code, you will
    still only need to change this one line.
  prefs: []
  type: TYPE_NORMAL
- en: 'As when switching from a standard Google Map to a Yahoo! Map, you need to include
    Yahoo!''s JavaScript. Before moving on, ensure the following lines are in your
    file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: Note that rather than loading the Mapstraction JavaScript with Google support,
    we specified the Yahoo! version of Mapstraction ❶. Although the core of Mapstraction
    is provider agnostic, you need to tell it which of the providers you want to use.
    You also need to make sure you have *yahoo.core.js* in the same directory as *mxn.js*.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now let''s look at the Mapstraction code itself inside the `create_map` function:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: Here, the only difference between the Mapstraction map made with Google and
    this map is we've noted we're making a Yahoo! map ❷. That's it. No need to change
    the `setCenterAndZoom` or `LatLonPoint` functions. The syntax is the same because
    Mapstraction is wrapped around the providers.
  prefs: []
  type: TYPE_NORMAL
- en: Save and reload your file and what was once a Google Map should be replaced
    with a Yahoo! Map instead, exactly like [Figure 1-5](ch01s04.html#basic_map_shown_with_surrounding_tiles
    "Figure 1-5. Basic map shown with surrounding tiles"). It is the same Yahoo! Map,
    only this one was created through Mapstraction.
  prefs: []
  type: TYPE_NORMAL
- en: Mapstraction is like magic, only better. In fact, you don't even have to choose
    Google *or* Yahoo!. You could have both within the same map or one of each on
    a page.
  prefs: []
  type: TYPE_NORMAL
- en: Find the Underlying Map Tiles
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A web map's draggability might be its best attribute. I often find myself dragging
    a map just because I can. The feature also turns out to be a really good illusion.
  prefs: []
  type: TYPE_NORMAL
- en: What looks like one seamless map is actually many small tiles, placed next to
    each other. You might have noticed this in a moment of network lag, when a section
    of your map failed to load. Network lag is most likely to happen after you've
    changed the zoom level or if you quickly drag the map far from its original location.
  prefs: []
  type: TYPE_NORMAL
- en: Providers often attempt to avoid disrupting the illusion of seamlessness by
    preloading all the tiles that touch the tiles in your current area.
  prefs: []
  type: TYPE_NORMAL
- en: Each tile has a standard size of 256 pixels square. In the basic map example,
    six tiles are at least partially visible. If Google is the provider, it also loads
    additional surrounding tiles. [Figure 1-5](ch01s04.html#basic_map_shown_with_surrounding_tiles
    "Figure 1-5. Basic map shown with surrounding tiles") shows how the visible portion
    of the map corresponds to its tiles. In the original view, we only see slivers
    of the top two tiles.
  prefs: []
  type: TYPE_NORMAL
- en: '![Basic map shown with surrounding tiles](httpatomoreillycomsourcenostarchimages671955.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 1-5. Basic map shown with surrounding tiles
  prefs: []
  type: TYPE_NORMAL
- en: What happens when we change zoom levels? We need to download a completely new
    set of tiles. The details shown are different for each zoom level, and each tile
    now represents a different amount of the earth.
  prefs: []
  type: TYPE_NORMAL
- en: Due to copyright concerns, providers tend to make it difficult to access their
    tiles directly. You can, however, look at the tiles that are downloaded to your
    browser when you access a provider's maps. Doing this will give you a better idea
    of how the tile system works.
  prefs: []
  type: TYPE_NORMAL
- en: Though you can get at the files in a number of ways, I'll show you a very easy
    method using the Firefox browser and the Firebug developer add-on. You can find
    them at [http://www.getfirefox.com/](http://www.getfirefox.com/) and [http://www.getfirebug.com/](http://www.getfirebug.com/),
    respectively.
  prefs: []
  type: TYPE_NORMAL
- en: In Firefox, load an embedded map, such as the one in the basic map example.
    Click the Firebug icon in the lower-right corner, or choose **Firebug ▸ Open Firebug**
    from the Tools menu. In the Firebug panel, click the **Inspect** button, which
    allows you to see highlighted page elements. Hover your mouse over the center
    of the map, and a blue border should appear around a portion of the map. You have
    found a tile!
  prefs: []
  type: TYPE_NORMAL
- en: With a tile highlighted, click the mouse, and you will be taken to HTML code
    with an image tag, as shown in [Figure 1-6](ch01s04.html#use_firebug_to_find_tiles
    "Figure 1-6. Use Firebug to find tiles."). At first, this tag may seem confusing
    because you didn't add this image to your code. Unlike simply viewing source code
    in a browser, Firebug shows the page with the elements added by JavaScript. To
    create a map, your provider had to inject images as child elements of the map
    `div` tag.
  prefs: []
  type: TYPE_NORMAL
- en: In the `src` attribute of the image, you'll see the URL to the single tile that
    you highlighted with Firebug. You can copy that URL into a new window or tab to
    see only that tile, without including the context of its surrounding brethren.
    Also, you can doctor the parameters in the URL to view other tiles.
  prefs: []
  type: TYPE_NORMAL
- en: The earth is made up of thousands or millions of tiles, depending on the zoom
    level. Mapping providers refer to tiles based on a simple grid system. You can
    think of this as similar to a paper map, which helps you identify areas by referencing
    them based on a letter-number combination. For example, you might look in (K,
    18) to find Maple Street.
  prefs: []
  type: TYPE_NORMAL
- en: Tiles are called by their grid reference, too; only these are usually numbered
    in the thousands. For example, my San Francisco example might contain a tile that
    is at (5241, 3718). The grid is different for each zoom level, so that reference
    is an important third piece of information needed to call a particular tile. To
    call the tile to the right of the example tile, I would look for (5242, 3718)
    at the same zoom level. Only the first number changes because it represents the
    horizontal portion of the grid. Vertically, both tiles are in row 3718.
  prefs: []
  type: TYPE_NORMAL
- en: 'To recap, you''ll usually find three numbers in the tile URLs: the horizontal
    grid reference (often called *X*), the vertical grid reference (*Y*), and the
    zoom level.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Mapstraction provides a way to use whatever tiles you would like, regardless
    of the provider. Again, most providers don''t support direct access to the tiles.
    Many times you might find they use methods to prevent you from calling them. You
    could always create your own tiles. I show you how to do that and how to connect
    them to Mapstraction in [#26: Use Custom Tiles](ch04s11.html "#26: Use Custom
    Tiles") in [#26: Use Custom Tiles](ch04s11.html "#26: Use Custom Tiles").'
  prefs: []
  type: TYPE_NORMAL
- en: '![Use Firebug to find tiles.](httpatomoreillycomsourcenostarchimages671957.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 1-6. Use Firebug to find tiles.
  prefs: []
  type: TYPE_NORMAL
- en: Change the Map Size
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The initial map size is determined by CSS styles for the `div` tag. You can
    change the size of the map programmatically with Mapstraction, however.
  prefs: []
  type: TYPE_NORMAL
- en: 'Add the following line to the `create_map` function, or include it as a click
    event in a link (see [Appendix A](apa.html "Appendix A. JAVASCRIPT QUICK START")):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: When the `resizeTo` function is called, you pass a width and height. Mapstraction
    then immediately sets the size of the map to the desired pixels. Note the center
    of the map is not reset. If you shrink the map, you may need to recenter the map
    to keep your same center-point in view.
  prefs: []
  type: TYPE_NORMAL
- en: 'Also, a word of caution about shrinking your map: Depending on the provider
    you use, interface elements may begin to collide. Be sure to test to see how small
    a map you can get away with.'
  prefs: []
  type: TYPE_NORMAL
- en: Add Zoom and Other Controls
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: One of the best things about using maps on your website is that users can explore
    with them. They want to see what's nearby, look more closely at a particular location,
    or figure out where a spot is in relation to the city or country. The basic maps
    I've shown so far do not give users very much control.
  prefs: []
  type: TYPE_NORMAL
- en: Let's give the users an interface to click, so they can zoom and pan around
    the map. Mapstraction offers several ways to do this.
  prefs: []
  type: TYPE_NORMAL
- en: Small Controls
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Small controls are useful when your map isn't very big, such as when you stick
    it in a sidebar. Also, if you don't expect users to perform many zooms, you might
    prefer to keep the interface clean.
  prefs: []
  type: TYPE_NORMAL
- en: 'To add small controls to your map, add this line in your `create_map` function
    after you have set the `mapstraction` variable:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: Save and reload your file, and you should see a small set of buttons in the
    upper-left corner of your map. Exactly how the controls look will depend on which
    mapping provider you instruct Mapstraction to use. The map will likely contain
    plus and minus buttons for zooming and a collection of arrow buttons for panning.
  prefs: []
  type: TYPE_NORMAL
- en: Large Controls
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If your map is the focal point of your website or page, you probably want large
    controls. While small controls only let users zoom in or out one level at a time,
    with large controls you can skip to any zoom level.
  prefs: []
  type: TYPE_NORMAL
- en: 'Add this line to your `create_map` function:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: Save and reload your file. When using Google Maps, Mapstraction adds several
    other controls in addition to the larger zoom/pan tools. To see how small and
    large zoom/pan tools look, see [Figure 1-7](ch01s06.html#small_and_large_zoom_controls_in_google
    "Figure 1-7. Small and large zoom controls in Google Maps (top) and Yahoo! Maps
    (bottom)").
  prefs: []
  type: TYPE_NORMAL
- en: 'To only add the large versions of zoom/pan, try this function:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: Here, you pass an object (declared with curly braces) with a single option for
    large zoom controls.
  prefs: []
  type: TYPE_NORMAL
- en: '![Small and large zoom controls in Google Maps (top) and Yahoo! Maps (bottom)](httpatomoreillycomsourcenostarchimages671959.png.jpg)![Small
    and large zoom controls in Google Maps (top) and Yahoo! Maps (bottom)](httpatomoreillycomsourcenostarchimages671961.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 1-7. Small and large zoom controls in Google Maps (top) and Yahoo! Maps
    (bottom)
  prefs: []
  type: TYPE_NORMAL
- en: Map-Type Controls
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Mapping providers often let users choose which type of map to view. In addition
    to a normal map, a satellite view and a hybrid of normal and satellite view are
    common. Not every map provider has all of these views. For example, some use aerial
    photography instead of satellite or don't have photographic imagery at all.
  prefs: []
  type: TYPE_NORMAL
- en: 'Use this command to add a map-type control to your map, like the one in [Figure 1-8](ch01s06.html#map_type_controls_in_google_maps
    "Figure 1-8. Map type controls in Google Maps"), so users can choose how they
    want to see your map:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: Save and reload your file to see the buttons in the upper-right corner of your
    map (with most providers).
  prefs: []
  type: TYPE_NORMAL
- en: '![Map type controls in Google Maps](httpatomoreillycomsourcenostarchimages671963.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 1-8. Map type controls in Google Maps
  prefs: []
  type: TYPE_NORMAL
- en: Set Zoom Level
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now you've added some controls to your map, and users can change the zoom level.
    In most projects, you'll want to give users this power. Regardless, you need to
    set an initial zoom level, so the mapping provider knows what to show.
  prefs: []
  type: TYPE_NORMAL
- en: Zoom levels determine how much detail is shown. A map of the entire world cannot
    contain streets or parks. Showing country borders is about as complex as that
    map can get—even most cities are smaller than a pixel. When zoomed in to a city-level
    map, you'll see major streets, but perhaps not neighborhood features.
  prefs: []
  type: TYPE_NORMAL
- en: 'In the basic map, you set the center and the zoom at the same time. Mapstraction
    also has a function that only sets the zoom level, while keeping the center the
    same:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: As with the `setCenterAndZoom` function, the zoom level is communicated as an
    integer. In this example, I set a zoom level of 10, whereas I used 15 in the basic
    map. What do these numbers mean? Which one is zoomed in closer?
  prefs: []
  type: TYPE_NORMAL
- en: Mapstraction uses zoom levels 0–16, with the larger numbers corresponding to
    being more zoomed in—a greater level of detail. With satellite view, you may be
    able to zoom in even further. [Table 1-2](ch01s07.html#mapstraction_zoom_levels
    "Table 1-2. Mapstraction Zoom Levels") shows an approximate correspondence between
    zoom levels and the area usually shown. Naturally, the exact level is determined
    by the size of a country, state, or city.
  prefs: []
  type: TYPE_NORMAL
- en: Table 1-2. Mapstraction Zoom Levels
  prefs: []
  type: TYPE_NORMAL
- en: '| Geography description | Zoom level |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| World | 0 |'
  prefs: []
  type: TYPE_TB
- en: '| Country | 4 |'
  prefs: []
  type: TYPE_TB
- en: '| State | 7 |'
  prefs: []
  type: TYPE_TB
- en: '| City | 13 |'
  prefs: []
  type: TYPE_TB
- en: '| Street | 16 |'
  prefs: []
  type: TYPE_TB
- en: Another reason to appreciate Mapstraction is it accommodates the different ways
    mapping providers handle zoom levels. Yahoo!, for example, uses a reverse numbering
    system, where larger numbers mean the map is more zoomed out. MapQuest, on the
    other hand, counts the same as Mapstraction, but has fewer levels with minimal
    detail. Through its single interface, Mapstraction takes care of these discrepancies.
  prefs: []
  type: TYPE_NORMAL
- en: 'Just as you can set the zoom level, Mapstraction has a very similar command
    to retrieve the current zoom level:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'The integer returned is within the 0–16 Mapstraction range, converting from
    the provider''s zoom system, if necessary. You can use a combination of `setZoom`
    and `getZoom` to create your own controls, rather than sticking with the mapping
    provider''s defaults. [#23: Create Your Own Zoom Interface](ch04s08.html "#23:
    Create Your Own Zoom Interface") in [#23: Create Your Own Zoom Interface](ch04s08.html
    "#23: Create Your Own Zoom Interface") shows how to do this with step-by-step
    instructions.'
  prefs: []
  type: TYPE_NORMAL
- en: Set Map Type
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Most mapping providers offer three options for determining the look of maps.
    You can choose a simple map, which is the default, a satellite view, or a combination
    of the two. As I showed previously, you can let the user decide which map type
    to view by adding a control, usually to the upper-right corner of the map. The
    map type can also be set programmatically, which is what we'll do in this section.
  prefs: []
  type: TYPE_NORMAL
- en: 'You can set the map type at any time, though the most common situation is declaring
    something other than the default type when the map is loaded. For example, add
    this line to the `create_map` function of your basic map to show the satellite
    view layered with street information:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: The argument that the `setMapType` function accepts is just a simple integer,
    but as you can see, we passed it some other type of variable. Mapstraction has
    *constants*—special variables that are created to give more meaning than simple
    numbers—that make choosing a map type easy. Setting the map type to `HYBRID` makes
    more sense than remembering that you need to pass along the number 3 when you
    want both street and satellite views. [Table 1-3](ch01s08.html#mapstraction_map_types
    "Table 1-3. Mapstraction Map Types") shows all the map-type options and their
    corresponding numeric values.
  prefs: []
  type: TYPE_NORMAL
- en: Table 1-3. Mapstraction Map Types
  prefs: []
  type: TYPE_NORMAL
- en: '| Name | Value |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `Mapstraction.ROAD` | 1 |'
  prefs: []
  type: TYPE_TB
- en: '| `Mapstraction.SATELLITE` | 2 |'
  prefs: []
  type: TYPE_TB
- en: '| `Mapstraction.HYBRID` | 3 |'
  prefs: []
  type: TYPE_TB
- en: 'Map-type constants are also useful when retrieving the current map type from
    Mapstraction. Just as you can both *set* and *get* the zoom level, you can access
    the map type. Add this line sometime after you''ve created your map:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: 'Remember, the `setMapType` function accepts an integer value as an argument.
    The value returned from `getMapType` is 1, 2, or 3\. Again, referring to map types
    by the Mapstraction constants is much easier. For example, you can use a `switch...
    case` statement to perform different actions based on the map type:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: Replace the comments (the lines that start with two slashes) with the code you
    would want to use in the circumstances described. For example, you might want
    to remove driving directions from a map if only the satellite map is showing,
    because showing driving directions when no streets are visible makes less sense.
  prefs: []
  type: TYPE_NORMAL
- en: Recenter the Map
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If you're already displaying a map, then you gave it a center with the `setCenterAndZoom`
    function. You never know when users will drag the map away from your center. Knowing
    how to reset the center—and just the center—can be useful.
  prefs: []
  type: TYPE_NORMAL
- en: 'Add the following line to the `create_map` function, or include it as a click
    event in a link:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: 'Of course, snapping a map directly to a point can be jarring. Luckily, the
    user can pan to the new center point, as if he or she dragged the map there:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: Here we're passing an options object to the `setCenter` function. The curly
    braces declare an object in JavaScript with values set by `key:value` pairs. Mapstraction
    will look for whether `pan` exists. If `pan` is set to `true`, then the map will
    pan smoothly to the new point.
  prefs: []
  type: TYPE_NORMAL
- en: Retrieve the Center of the Map
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: When you load a new map, you need to give it a center. Then you give up control,
    as your users drag and pan that map to their heart's content. That's good, because
    maps are interactive. On the other hand, you may want to know the map's current
    center.
  prefs: []
  type: TYPE_NORMAL
- en: 'Mapstraction has a simple command to retrieve the map''s center:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: 'The variable created, `centerpoint`, holds the result from the call to `getCenter()`
    as a `LatLonPoint`, which is the way Mapstraction stores coordinates. Keeping
    coordinates in a variable is handy because you can turn around and pass that to
    other functions. Or you can access the latitude and longitude directly:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: Now, you can use those values to add a marker to your map, plot local results
    on a map, or for some other purpose.
  prefs: []
  type: TYPE_NORMAL
- en: Find Point Where User Clicked
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Out-of-the-box interactivity makes mapping APIs pretty special. Using built-in
    controls, users can drag and pan the map, zoom in, and change map types. Users
    can also click, but nothing will happen unless you help them out.
  prefs: []
  type: TYPE_NORMAL
- en: 'To find the point where a user clicks, you need to "listen" for the click event:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: When the user clicks anywhere within the map, an anonymous function is called
    with `clickpoint` as an argument. Similar to when you retrieve the center of a
    map, the variable is a `LatLonPoint`. This example uses a JavaScript alert to
    display the latitude and longitude of the point where the user clicked, as shown
    in [Figure 1-9](ch01s11.html#javascript_alert_showing_latitude_and_lo "Figure 1-9. JavaScript
    alert showing latitude and longitude of click point").
  prefs: []
  type: TYPE_NORMAL
- en: '![JavaScript alert showing latitude and longitude of click point](httpatomoreillycomsourcenostarchimages671965.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 1-9. JavaScript alert showing latitude and longitude of click point
  prefs: []
  type: TYPE_NORMAL
- en: Of course, you'll want to do something more useful than a JavaScript alert.
    For example, you could add a marker to your map at that point. As it happens,
    the next chapter shows you how to do that and more.
  prefs: []
  type: TYPE_NORMAL
