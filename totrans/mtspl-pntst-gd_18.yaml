- en: Appendix A. Configuring Your Target Machines
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The best way to learn to use the Metasploit Framework is by practicing — repeating
    a task until you fully understand how it is accomplished. This appendix explains
    how to set up a test environment to use with the examples in this book.
  prefs: []
  type: TYPE_NORMAL
- en: Installing and Setting Up the System
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The examples in this book use a combination of Back|Track, Ubuntu 9.04, Metasploitable,
    and Windows XP. Back|Track serves as our vehicle for exploitation, and the Ubuntu
    and Windows systems are our target systems.
  prefs: []
  type: TYPE_NORMAL
- en: First create an unpatched Windows XP Service Pack 2 installation to test the
    examples presented throughout this book. The Back|Track and Ubuntu 9.04 virtual
    machines can be run on a host machine running Windows, Mac OS X, or Linux on any
    VMware product, including Workstation, Server, Player, Fusion, or ESX.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Be careful with your Ubuntu and Windows XP virtual machines, because these
    systems are vulnerable and easy to exploit. Do not conduct any sensitive activities
    on these machines: If you can exploit them, anyone else can, too.'
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: If you don’t already have the free VMware Player for Windows and Linux, download
    and install it. If you’re using OS X, download the free 30-day trial of VMware
    Fusion. (If you’re running Windows, you can also use the free VMware Server edition.)
  prefs: []
  type: TYPE_NORMAL
- en: After you have installed VMware, double-click the *.vmx* file to use with VMware,
    or open the virtual machine files in VMware Player by choosing **File** ▸ **Open**
    and pointing to the folder that contains all the virtual machines and associated
    files. If you’re installing from an ISO disc image, create a new virtual machine
    and specify this ISO file as the CD-ROM device.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Download Back|Track from [http://www.backtrack-linux.org/](http://www.backtrack-linux.org/)
    and Ubuntu 9.04 from [http://www.vmware.com/appliances/directory/](http://www.vmware.com/appliances/directory/)
    by searching for Ubuntu 9.04\. Metasploitable can be downloaded from [http://blog.metasploit.com/2010/05/introducing-metasploitable.html](http://blog.metasploit.com/2010/05/introducing-metasploitable.html).
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: Booting Up the Linux Virtual Machines
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: After powering on either of the Linux virtual machines, you need to log in.
    The default credentials for both Linux environments are username *root* and password
    *toor*.
  prefs: []
  type: TYPE_NORMAL
- en: If you don’t have a DHCP server on your network, find your system’s address
    range and use the commands shown in the following listing. (Make sure that you
    replace your IP address with an unused one, and edit the network interface that
    you will be using. For more on manual network setup, see [http://www.yolinux.com/TUTORIALS/LinuxTutorialNetworking.html](http://www.yolinux.com/TUTORIALS/LinuxTutorialNetworking.html).)
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: After configuration is complete, your Linux environment should be ready for
    use. Do not update the Ubuntu installation, because this system should remain
    vulnerable.
  prefs: []
  type: TYPE_NORMAL
- en: Setting Up a Vulnerable Windows XP Installation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To run the examples in this book, you will need to install a licensed copy of
    Windows XP on a virtualization platform such as VMware. After you have completed
    the installation, log in as Administrator, open the Control Panel, switch to Classic
    View, and choose **Windows Firewall**. Select **Off** and click **OK**. (This
    may seem unrealistic, but this scenario is more common than you might imagine
    in large corporations.)
  prefs: []
  type: TYPE_NORMAL
- en: Next, open Automatic Updates and select **Turn off Automatic Updates**; then
    click **OK**. You don’t want Windows to patch vulnerabilities as you’re trying
    to learn how to exploit them.
  prefs: []
  type: TYPE_NORMAL
- en: Now configure your installation with a static IP address via the Network Connections
    Control Panel. While not required, doing this will save you from having to recheck
    the target address every time you launch an exploit.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring Your Web Server on Windows XP
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: To make things interesting and provide for a larger attack surface, we’ll enable
    some additional services.
  prefs: []
  type: TYPE_NORMAL
- en: In the Control Panel, select **Add or Remove Programs**, and then select **Add/Remove
    Windows Components**. You should be looking at the *Windows Components Wizard*.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the checkbox for **Internet Information Services (IIS)** and click **Details**.
    Then select the checkbox for **File Transfer Protocol (FTP) Service** and click
    **OK**. Conveniently enough, the FTP service allows anonymous connections by default.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Select the **Management and Monitoring Tools** checkbox and click **OK**. By
    default, this installs the Simple Network Management Protocol (SNMP) and Windows
    Management Interface (WMI) SNMP Provider.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click **Next** to complete the installation and reboot the machine for good
    measure.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The combination of these steps adds different services that we test throughout
    this book. The IIS server will allow you to run a website and can be downloaded
    from [http://www.secmaniac.com/files/nostarch1.zip](http://www.secmaniac.com/files/nostarch1.zip).
    The FTP service will allow you to perform FTP-based attacks against the Windows
    system, and the SNMP configuration will allow you to test auxiliary modules within
    Metasploit.
  prefs: []
  type: TYPE_NORMAL
- en: Building a SQL Server
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Many database modules within Metasploit and Fast-Track target Microsoft SQL
    Server, so you need to install SQL Server 2005 Express, available for free from
    Microsoft. As of this writing, you can locate the non–service pack version of
    SQL Server Express at [http://www.microsoft.com/](http://www.microsoft.com/).
    To install SQL Server Express, you will need to install Windows Installer 3.1
    and the .NET Framework 2.0\. You can find links to the resources on this page,
    and all other URLs referenced in this book, at [http://www.secmaniac.com/files/nostarch1.zip](http://www.secmaniac.com/files/nostarch1.zip).
  prefs: []
  type: TYPE_NORMAL
- en: Once you have the prerequisites installed, run the SQL Express installer and
    select all the defaults except for Authentication Mode. Select **Mixed Mode**,
    set a *sa* login password of *password1*, and then continue with the installation.
  prefs: []
  type: TYPE_NORMAL
- en: 'With the basic installation of SQL Server complete, you need to make a few
    more changes to make it accessible on your network:'
  prefs: []
  type: TYPE_NORMAL
- en: Select **Start** ▸ **All Programs** ▸ **Microsoft SQL Server 2005** ▸ **Configuration
    Tools**, and then select **SQL Server Configuration Manager**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When the Configuration Manager starts, select **SQL Server 2005 Services**,
    right-click **SQL Server (SQLEXPRESS)**, and select **Stop**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Expand SQL Server 2005 Network Configuration Manager and select **Protocols
    for SQLEXPRESS**, as shown in [Figure A-1](part0022.html#protocols_for_sqlexpress).![Protocols
    for SQLEXPRESS](../images/00063.jpeg)Figure A-1. Protocols for SQLEXPRESS
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Double-click **TCP/IP**, and on the Protocol tab, set **Enabled** to **Yes**
    and **Listen All** to **No**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Next, while still within the TCP/IP Properties dialog, select the IP Addresses
    tab and remove any entries under IPAll. Under IP1 and IP2, remove the values for
    TCP Dynamic Ports and set **Active** and **Enabled** for each of them to **Yes**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Finally, set the IP1 IP Address to match your static IP address set earlier,
    set the IP2 address to **127.0.0.1**, and set the TCP port for each of them to
    **1433**. Your settings should look similar to those shown in [Figure A-2](part0022.html#setting_sql_server_ip_addresses_in_the_t).
    Click **OK** when you are all set.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Next, you’ll need to enable the SQL Server Browser service:'
  prefs: []
  type: TYPE_NORMAL
- en: Select **SQL Server 2005 Services** and double-click **SQL Server Browser**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the Service tab, set the **Start Mode** to **Automatic**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![Setting SQL Server IP addresses in the TCP/IP Properties dialog](../images/00064.jpeg)Figure A-2. Setting
    SQL Server IP addresses in the TCP/IP Properties dialog'
  prefs: []
  type: TYPE_NORMAL
- en: By default, the SQL Server runs under the low-privilege Network Service account,
    which is a great default. However, it’s not entirely realistic for what we find
    deployed in the field, and often administrators change this rather than trying
    to troubleshoot permissions issues.
  prefs: []
  type: TYPE_NORMAL
- en: On most target systems, we have found that the SQL Server Browser service is
    running as an elevated SYSTEM-based account. Most systems have the SQL Server
    Service logged on as Local System, the default in older versions of Microsoft
    SQL Server (2000 and earlier). Therefore, you should change the account by double-clicking
    **SQL Server (SQLEXPRESS)** and setting **Log on as** to **Local System**. Click
    **OK** when you have finished. Then right-click **SQL Server (SQLEXPRESS)** and
    select **Start**. Do the same with SQL Server browser.
  prefs: []
  type: TYPE_NORMAL
- en: 'Finally, close the Configuration Manager and verify that everything is working
    properly by opening a command prompt and running **`netstat -ano |find "1433"`**
    and **`netstat -ano |find "1434"`**. Your IP addresses configured earlier should
    be listening on TCP port 1433 and UDP port 1434, as shown here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: Creating a Vulnerable Web Application
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: To use some of the more advanced features of Metasploit and external tools such
    as Fast-Track and the Social-Engineer Toolkit (SET), you will need a vulnerable
    web application to test against. To create the database and tables, download and
    install SQL Server Management Studio Express from the link provided at [http://www.nostarch.com/metasploit.htm](http://www.nostarch.com/metasploit.htm).
  prefs: []
  type: TYPE_NORMAL
- en: 'After the installation and a healthy reboot, do the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Start the application by choosing **Start** ▸ **All Programs** ▸ **Microsoft
    SQL Server 2005** ▸ **SQL Server Management Studio Express**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When prompted for credentials, select **SQL Server Authentication** from the
    Authentication drop-down, and log in using the username *sa* and the password
    *password1*.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: In Object Explorer, right-click **Databases** and select **New Database**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For the Database name, enter **WebApp** and click **OK**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Expand Databases and the WebApp database tree.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Right-click **Tables** and select **New Table**. Name your new table *users*
    with the column names and types shown in [Figure A-3](part0022.html#users_table_columns).![Users
    table columns](../images/00065.jpeg)Figure A-3. *Users* table columns
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Save the *users* table, and then right-click it and select **Open Table**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Populate the table with some sample data similar to that shown in [Figure A-4](part0022.html#populated_users_table),
    and then save your work.![Populated users table](../images/00066.jpeg)Figure A-4. Populated
    *users* table
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Expand the Security tree under Object Explorer, and then expand Logins.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Right-click **Logins** in the User Properties window and select **New Login**.
    In the Login-New window, click **Search**, enter **ASPNET**, and then click **Check
    Names**. The full username should automatically populate. Click **OK** to exit
    the user search.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Finally, while still in the User Properties window, select **User Mapping**,
    select the check box next to **WebApp**, select the **db_owner** role membership,
    and then click **OK**.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: That takes care of the entire configuration required on the SQL backend for
    the web application. Save and exit Management Studio.
  prefs: []
  type: TYPE_NORMAL
- en: 'All that remains is to create the website to interact with the database you
    created. Let’s do that now:'
  prefs: []
  type: TYPE_NORMAL
- en: Download the vulnerable web application from [http://www.nostarch.com/metasploit.htm](http://www.nostarch.com/metasploit.htm)
    and extract the contents of the archive to *C:\Inetpub\wwwroot\*.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Open your browser and point to *http://<youripaddress>/Default.aspx*. You should
    see a log-in form, as shown in [Figure A-5](part0022.html#sample_attack_website).
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter bogus credentials to verify that the SQL query is being executed properly.
    To test some basic SQL injection to identify whether the web application is functioning
    properly, enter a single quote (**`'`**) in the username field, and enter anything
    as the password (doesn’t matter). The application should produce a yellow page
    with a SQL-related error.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Click the back arrow on your browser and enter **OR 1=1--** and something (doesn’t
    matter) in the password field. You should see a “You have successfully logged
    on” message.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If you have gotten this far, everything is set up properly, and you are ready
    to plunge in.
  prefs: []
  type: TYPE_NORMAL
- en: '![Sample attack website](../images/00067.jpeg)Figure A-5. Sample attack website'
  prefs: []
  type: TYPE_NORMAL
- en: Updating Back|Track
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'As with any operating system, make sure you’re running the latest version of
    Back|Track and its tools. When logging into Back|Track (*root*/*toor*), issue
    the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: This sequence of commands will select all available updates within Back|Track.
    After you have updated Back|Track by entering **`y`** (for yes) when prompted
    to accept the SVN certificate, your system still needs some minor updates to Metasploit,
    Fast-Track, and the SET.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: In Back|Track, Metasploit is located at */opt/framework3/msf3/* ![](../images/00002.gif),
    so change to that directory prior to updating the Framework via subversion with
    **`msfupdate`** ![](../images/00004.gif).
  prefs: []
  type: TYPE_NORMAL
- en: Once Metasploit is updated, change to */pentest/exploits/set*`/` ![](../images/00005.gif)
    and run **`svn update`**. Lastly, change to */pentest/exploits/fasttrack*`/` ![](../images/00006.gif)
    and update Fast-Track.
  prefs: []
  type: TYPE_NORMAL
- en: You have now created and updated the testing environment that you will use as
    you work through the examples in this book.
  prefs: []
  type: TYPE_NORMAL
