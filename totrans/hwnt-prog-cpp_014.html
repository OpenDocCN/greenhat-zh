<html><head></head><body>

<div class="calibre21" id="calibre_pb_0"/><div class="calibre1" id="calibre_toc_18">
<a name="ch02" class="calibre6" id="ch02"/>
<div class="calibre1">
<h2 class="lot-title" id="calibre_pb_1"><a name="19" class="calibre16" id="19"/><a name="ch02lev1sec9" class="calibre16" id="ch02lev1sec9"/><span class="chapter-titlelabel">Program 12: </span>Hurry Up and Wait</h2><p class="b24-bookeditorial">The code on which this program is based was written by a senior system programmer at a company I worked at a long time ago.</p>
<p class="b24-bookeditorial">It was designed to send data over a serial line. Although the serial line was capable of doing 960 characters per second, we were lucky to get 300 characters a second.</p>
<p class="b24-bookeditorial">Why?</p>
<div class="calibre1">
<pre class="literallayout-normal">
  1 /************************************************
  2  * send_file -- Send a file to a remote link    *
  3  * (Stripped down for this example.)            *
  4  ************************************************/
  5 #include &lt;iostream&gt;
  6 #include &lt;fstream&gt;
  7 #include &lt;stdlib.h&gt;
  8
  9 // Size of a block
 10 const int BLOCK_SIZE = 256;
 11
 12 /************************************************
 13  * send_block -- Send a block to the output port*
 14  ************************************************/
 15 void send_block(
 16     std::istream &amp;in_file,   // The file to read
 17     std::ostream &amp;serial_out // The file to write
 18 )
 19 {
 20     int i;      // Character counter
 21
 22     for (i = 0; i &lt; BLOCK_SIZE; ++i) {
 23         int ch; // Character to copy
 24
 25         ch = in_file.get();
 26         serial_out.put(ch);
 27         serial_out.flush();
 28     }
 29 }
 30
 31 int main()
 32 {
 33     // The input file
 34     std::ifstream in_file("file.in");
 35
 36     // The output device (faked)
 37     std::ofstream out_file("/dev/null");
 38
 39     if (in_file.bad())
 40     {
 41         std::cerr &lt;&lt;
 42             "Error: Unable to open input file\n";
 43         exit (8);
 44     }
 45
 46     if (out_file.bad())
 47     {
 48         std::cerr &lt;&lt;
 49             "Error: Unable to open output file\n";
 50         exit (8);
 51     }
 52
 53     while (! in_file.eof())
 54     {
 55         // The original program output
 56         // a block header here
 57         send_block(in_file, out_file);
 58         // The original program output a block
 59         // trailer here. It also checked for
 60         // a response and resent the block
 61         // on error
 62     }
 63     return (0);
 64 }
</pre>
</div>
<p class="b24-bookeditorial">(Next <a href="LiB0120.html#319" target="_parent" class="calibre2">Hint 183</a>. <a href="LiB0121.html#563" target="_parent" class="calibre2">Answer 65</a>.)</p>
<div class="calibre1">
<table class="calibre3" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr class="calibre4">
<td class="bluecell"><span class="calibre22"><b class="calibre13"><img src="_1.gif" alt="Start Sidebar" border="0" class="calibre23"/></b></span></td>
</tr>
</table>
<p class="b24-bookeditorial">One system administrator makes a habit of announcing that an upgrade has been installed at least two weeks before he actually installs it. Typically there will be a rash of complaints such as, "My software just crashed and all due to your upgrade," on the day of the announcement. The administrator knows that it can't be the upgrade, since he hasn't really done it yet.</p>
<p class="b24-bookeditorial">When he does actually install the upgrade (which he does secretly), any complaints that then come in are probably legitimate.</p>
<p class="b24-bookeditorial">Ham radio operators use the previous trick, as well. They'll install an new radio tower and leave it disconnected for a few weeks. That gives the neighbors two weeks to complain of TV inference caused by the new antenna.</p>
<table class="calibre3" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr class="calibre4">
<td class="bluecell"><span class="calibre22"><b class="calibre13"><img src="_1.gif" alt="End Sidebar" border="0" class="calibre23"/></b></span></td>
</tr>
</table>
</div>
<table class="calibre3" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr class="calibre4">
<td height="16" class="calibre8"/>
</tr>
</table>
</div>
</div>



</body></html>