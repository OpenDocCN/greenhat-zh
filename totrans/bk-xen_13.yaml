- en: Chapter 13. XEN AND WINDOWS
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 13 章。XEN 和 Windows
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages333191.png.jpg)'
  id: totrans-1
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages333191.png.jpg)'
- en: In the last chapter we described Xen's hardware virtualization support and how
    to use it. Now that we have Xen operating with hardware virtualization, we can
    run unmodified operating systems, including Windows, that 800-pound gorilla of
    the computing world.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们描述了 Xen 的硬件虚拟化支持及其使用方法。现在，我们已经有了带有硬件虚拟化的 Xen，我们可以运行未经修改的操作系统，包括 Windows，这个计算世界中的
    800 磅巨兽。
- en: Why Run Windows Under Xen?
  id: totrans-3
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 为什么要在 Xen 下运行 Windows？
- en: Now, why exactly would you want to do this terrible thing? We could say, "because
    you can," and that's reason enough to do many things. But it might not be entirely
    satisfying—it sounds like a lot of work, after all.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，为什么你偏偏想要做这样一件糟糕的事情呢？我们可以说，“因为你可以做到”，这已经足够成为做许多事情的理由了。但可能并不完全令人满意——毕竟，这听起来像是一项艰巨的工作。
- en: Fortunately, reasons abound. Probably the best of these is the software—especially
    the server software, considering that Xen's strengths are in the server field.^([[79](#ftn.CHP-13-FNOTE-1)])
    Much of the Windows server software, like Exchange Server, has a giant installed
    base and would be difficult to replace. The same holds for the client software.
    Take, for example, Office, Outlook, Visual Studio—Microsoft continues to be a
    fact of life. Xen with VNC, SDL, or rdesktop allows you to run productivity software
    at acceptable speeds, with full, albeit unaccelerated, graphics support, all while
    retaining your comfortable Linux computing environment.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，理由很多。其中最好的可能是软件——尤其是服务器软件，考虑到 Xen 的优势在于服务器领域.^([[79](#ftn.CHP-13-FNOTE-1)])
    大多数 Windows 服务器软件，如 Exchange 服务器，拥有庞大的安装基础，替换起来会很困难。客户端软件也是如此。以 Office、Outlook、Visual
    Studio 为例——Microsoft 仍然是生活中不可或缺的一部分。使用 VNC、SDL 或 rdesktop 的 Xen 允许你在可接受的速率下运行生产力软件，同时提供完整的图形支持，尽管没有加速，而你仍然可以保留舒适的
    Linux 计算环境。
- en: Xen also gives you a way out from the old worry that the next security fix or
    driver update will leave the machine completely unbootable—it provides an equivalent
    to Microsoft's "system restore points" but under your own control, rather than
    the OS's. By running Windows in a virtual machine with an effective storage backend,
    you can snapshot it, roll back updates, and protect yourself from malware—all
    without involving the domU.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: Xen 还为你提供了一种摆脱旧担忧的方法，即下一个安全修复或驱动程序更新可能会使机器完全无法启动——它提供了类似于 Microsoft 的“系统还原点”的功能，但完全在你的控制之下，而不是操作系统。通过在具有有效存储后端的虚拟机中运行
    Windows，你可以快照它，回滚更新，并保护自己免受恶意软件的侵害——而无需涉及 domU。
- en: Security furnishes another reason to run Windows under Xen. Although it's cliche
    to say that Windows is insecure, the fact remains that virtualization, when properly
    used, can be an effective layer of isolation for any server, Windows, *nix, or
    otherwise. The fact that Windows is a popular target makes this reasoning even
    more compelling.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 安全性是运行 Windows 在 Xen 下的另一个原因。虽然常说 Windows 不安全是个陈词滥调，但事实仍然是，如果正确使用，虚拟化可以成为任何服务器（无论是
    Windows、*nix 还是其他）的有效隔离层。Windows 作为热门目标使得这种推理更加有说服力。
- en: It's also worth noting that Xen's design, which partitions drivers in isolated
    domains, at least contributes to security. An intrusion in the Windows domain,
    even if it manages to exploit driver code to interact with physical hardware,
    is unlikely to compromise other domains on the same hardware. This doesn't mean
    that Xen is inherently secure, but it does suggest that it might be possible to
    secure it. Work remains to be done, of course—indeed, a lot of the present work
    in QEMU is in precisely the area of validating emulated device access to improve
    security. But even as things are, Xen can help to reduce the exposure of Windows
    machines.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 还值得注意的是，Xen 的设计，通过在隔离域中分区驱动程序，至少有助于提高安全性。Windows 域的入侵，即使它设法利用驱动程序代码与物理硬件交互，也不太可能危害同一硬件上的其他域。这并不意味着
    Xen 本身就是安全的，但它确实表明，可能有可能使其变得安全。当然，还需要做很多工作——实际上，QEMU 当前的许多工作正是验证模拟设备访问以改善安全性的领域。但即便如此，Xen
    也能帮助减少 Windows 机器的暴露。
- en: Besides, it's easier to run Windows in a domU than you might suppose.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，运行 Windows 在 domU 中比你想象的要容易。
- en: '* * *'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[79](#CHP-13-FNOTE-1)]) At least in light of the ongoing commodification
    of the operating system, which really is at least part of what Xen is all about,
    isn't it?
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[79](#CHP-13-FNOTE-1)]) 至少从操作系统的持续商品化来看，这确实是 Xen 的核心之一，对吧？
- en: 'Windows on Xen: Prerequisites'
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Xen 下的 Windows：先决条件
- en: Before stepping into the brave new world of virtualized Windows, make sure that
    you've got a few things.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在进入虚拟化Windows的新世界之前，确保你已经准备好了一些东西。
- en: 'First, you''re going to need a box that does HVM. (See [Chapter 12](ch12.html
    "Chapter 12. HVM: BEYOND PARAVIRTUALIZATION") for details on what that is, how
    it works, and how to tell if you have it.) The box will also need enough free
    memory and storage for a Windows install—Xen can help to use resources more efficiently,
    but it''s not magic. For example, we suggest that a Xen box running Windows Server
    2003 domUs have 512MB of memory and about 10GB of hard drive space for each domU,
    plus 512MB and another 10GB for dom0\. You might want to consult Microsoft''s
    website for more specific system requirements or requirements for other Windows
    versions.'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，您需要一个支持HVM的盒子。（有关详细信息，请参阅[第12章](ch12.html "第12章。HVM：超越虚拟化")，了解它是什么，如何工作以及如何判断您是否有它。）该盒子还需要足够的空闲内存和存储空间来安装Windows——Xen可以帮助更有效地使用资源，但它不是魔法。例如，我们建议运行Windows
    Server 2003 domU的Xen盒子有512MB的内存和每个domU大约10GB的硬盘空间，加上512MB和额外的10GB用于dom0。您可能需要咨询Microsoft的网站以获取更具体的系统要求或其他Windows版本的要求。
- en: It might sound obvious, but you're also going to need a copy of Windows, with
    a license that allows virtualization. This copy of Windows should be reasonably
    new. We're going to focus on Windows XP Service Pack 2 and Windows Server 2003
    in this chapter—Vista's just too much hassle at this point. Windows NT and 9*x*,
    while they should in theory work, seem to crash during the install step. No one
    (us included) seems too interested in figuring out why this happens. Life is full
    of mysteries.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然听起来很明显，但您还需要一个Windows副本，该副本具有允许虚拟化的许可证。这个Windows副本应该相对较新。在本章中，我们将重点关注Windows
    XP Service Pack 2和Windows Server 2003——Vista在这个阶段太麻烦了。Windows NT和9*x*，虽然在理论上应该可以工作，但在安装步骤中似乎会崩溃。似乎没有人（包括我们）对找出这是为什么感兴趣。生活中充满了神秘。
- en: 'Windows on Xen: Installation'
  id: totrans-16
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Xen上的Windows：安装
- en: 'Windows is actually quite easy to get installed and running. The basic steps
    are exactly like any other Xen install, with some extra configuration:'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，在Xen上安装和运行Windows相当简单。基本步骤与任何其他Xen安装完全一样，只是有一些额外的配置：
- en: Get Windows install media and put it somewhere that Xen can find it.
  id: totrans-18
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取Windows安装介质并将其放置在Xen可以找到的地方。
- en: Make a config file.
  id: totrans-19
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个配置文件。
- en: Boot from the install media.
  id: totrans-20
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从安装介质启动。
- en: Install using the Windows installer.
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用Windows安装程序进行安装。
- en: Reboot from the emulated hard drive.
  id: totrans-22
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从模拟的硬盘重启。
- en: Install paravirtualized drivers.
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装虚拟化驱动程序。
- en: Use Windows.
  id: totrans-24
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用Windows。
- en: Easy, right? Let's get started.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 很简单，让我们开始吧。
- en: Installing Windows Manually
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 手动安装Windows
- en: 'The first thing to do is get a copy of Windows. In our case, we used a physical
    CD-ROM, which we put in the Xen server''s CD-ROM drive. For convenience, you can
    of course create an image from the CD and use it just like the physical disc:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 首先要做的事情是获取Windows的副本。在我们的例子中，我们使用了一个物理CD-ROM，并将其放入Xen服务器的CD-ROM驱动器中。为了方便，当然可以创建一个镜像并像物理光盘一样使用它：
- en: '[PRE0]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: (If you go that route, specify `file:/var/tmp/windows2k3.iso` instead of `phy:/dev/cdrom`
    in the following steps.)
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: （如果您选择这条路，在以下步骤中，请将`phy:/dev/cdrom`替换为`file:/var/tmp/windows2k3.iso`。）
- en: While you're at it, create the backing store in the usual way. Here we'll use
    a file-backed device, but you can use any storage backend that Xen knows about.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 同时，按照常规方式创建后端存储。在这里，我们将使用基于文件的设备，但您可以使用Xen知道的任何存储后端。
- en: '[PRE1]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Next, create a config file. Here''s a sample (pulled from [Chapter 12](ch12.html
    "Chapter 12. HVM: BEYOND PARAVIRTUALIZATION") with minor changes). We''ll save
    this as */etc/xen/falstaff*:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，创建一个配置文件。这里有一个示例（从[第12章](ch12.html "第12章。HVM：超越虚拟化")中提取，略有修改）。我们将将其保存为*/etc/xen/falstaff*：
- en: '[PRE2]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: This should be pretty familiar by now. Note that we're leaving ACPI and APIC
    at their default "off " values to avoid confusing the Windows installer. You'll
    want to point the entries in the `disk=` lines to the appropriate locations for
    your install, of course. You might also want to diverge from our configuration
    by setting `sdl=1` rather than `vnc`—SDL works only on the local X display but
    has the virtue of popping up automatically.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 到现在为止，这应该已经很熟悉了。注意，我们将ACPI和APIC保留在默认的“关闭”值，以避免混淆Windows安装程序。当然，您需要将`disk=`行中的条目指向安装的正确位置。您可能还希望通过设置`sdl=1`而不是`vnc`来偏离我们的配置——SDL仅在本地X显示上工作，但具有自动弹出的优点。
- en: 'Then create the machine as usual:'
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 然后按照常规方式创建机器：
- en: '[PRE3]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Start a VNC session so that you can talk to it, assuming you decided against
    SDL. Insert the correct host and display number—in this case we''re on the local
    machine, and this is the first VNC session running:'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 启动一个 VNC 会话，以便您可以与之通信，假设您决定不使用 SDL。输入正确的主机和显示号——在这种情况下，我们在本地机器上，这是第一个运行的 VNC
    会话：
- en: '[PRE4]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Now Windows Setup will start in its accustomed fashion. Install Windows as usual.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 现在 Windows 安装程序将以通常的方式启动。像往常一样安装 Windows。
- en: A Discussion of HALs
  id: totrans-40
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 关于 HAL 的讨论
- en: One problem that occasionally pops up at this stage involves the Windows HAL
    (hardware abstraction layer). Windows ships with a selection of possible DLLs
    to implement the abstraction layer, picking one of six choices during the install
    process. The correct HAL to use with the system is affected by the `acpi, apic`,
    and `vcpus` configuration directives, as indicated in [Table 13-1](ch13s03.html#hals_available_with_windows
    "Table 13-1. HALs Available with Windows").
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个阶段偶尔会出现的一个问题是涉及 Windows HAL（硬件抽象层）。Windows 随带了一系列可能的 DLL 来实现抽象层，在安装过程中选择六个选项之一。与系统一起使用的正确
    HAL 受 `acpi, apic` 和 `vcpus` 配置指令的影响，如 [表 13-1](ch13s03.html#hals_available_with_windows
    "表 13-1. Windows 可用的 HAL") 所示。
- en: Table 13-1. HALs Available with Windows
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 表 13-1. Windows 可用的 HAL
- en: '| OPTIONS | HAL | COMMENTS |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
  zh: '| 选项 | HAL | 备注 |'
- en: '| --- | --- | --- |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| `acpi=0,apic=0` | HAL.DLL | Standard PCNon-ACPI Programmable Interrupt Controller
    (PIC)Works with everything |'
  id: totrans-45
  prefs: []
  type: TYPE_TB
  zh: '| `acpi=0,apic=0` | HAL.DLL | 标准PC非ACPI可编程中断控制器（PIC）与所有设备兼容 |'
- en: '| `acpi=0,apic=1` | HALAPIC.DLL | MPS (Multiprocessor Specification)Uniprocessor
    PCNon-ACPI APIC uniprocessor HALUniprocessor onlyDoesn''t work with PIC machines
    |'
  id: totrans-46
  prefs: []
  type: TYPE_TB
  zh: '| `acpi=0,apic=1` | HALAPIC.DLL | MPS（多处理器规范）单处理器PC非ACPI APIC 单处理器 HAL仅适用于单处理器不与
    PIC 机器兼容 |'
- en: '| `acpi=0,apic=1` | HALMPS.DLL | Non-ACPI APIC multiprocessor HALDoes not work
    with ACPI machines |'
  id: totrans-47
  prefs: []
  type: TYPE_TB
  zh: '| `acpi=0,apic=1` | HALMPS.DLL | 非ACPI APIC 多处理器 HAL不与 ACPI 机器兼容 |'
- en: '| `acpi=1,apic=0` | HALACPI.DLL | Advanced Configuration and Power Interface
    (ACPI)ACPI PIC (not APIC) HALDo these even exist in hardware? |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
  zh: '| `acpi=1,apic=0` | HALACPI.DLL | 高级配置和电源接口（ACPI）ACPI PIC（非APIC）HAL这些在硬件中真的存在吗？
    |'
- en: '| `acpi=1,apic=1` | HALAACPI.DLL | ACPI Uniprocessor PCACPI APIC uniprocessor
    HALACPI onlyAPIC onlyUniprocessor only |'
  id: totrans-49
  prefs: []
  type: TYPE_TB
  zh: '| `acpi=1,apic=1` | HALAACPI.DLL | ACPI 单处理器 PC ACPI APIC 单处理器 HAL仅适用于 ACPI
    仅适用于 APIC 单处理器 |'
- en: '| `acpi=1,apic=1` | HALMACPI.DLL | ACPI Multiprocessor PCACPI APIC multiprocessor
    HAL |'
  id: totrans-50
  prefs: []
  type: TYPE_TB
  zh: '| `acpi=1,apic=1` | HALMACPI.DLL | ACPI 多处理器 PC ACPI APIC 多处理器 HAL |'
- en: The lucky winner becomes *$SYSTEMROOT\system32\HAL.DLL*.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的获胜者成为 *$SYSTEMROOT\system32\HAL.DLL*。
- en: The easy answer, therefore, is to use *HAL.DLL*, regardless of the values of
    ACPI and APIC. This should always work, but it might reduce performance. Microsoft
    also warns that such a configuration is unsupported.^([[80](#ftn.CHP-13-FNOTE-2)])
    We generally turn ACPI and APIC on so that Windows will install the ACPI APIC
    HAL, and it hasn't caused the machine to burst into flames yet.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，简单的答案是使用 *HAL.DLL*，无论 ACPI 和 APIC 的值如何。这应该总是有效，但它可能会降低性能。微软还警告说，这种配置不受支持.^([[80](#ftn.CHP-13-FNOTE-2)])
    我们通常打开 ACPI 和 APIC，以便 Windows 安装 ACPI APIC HAL，而且它还没有导致机器起火。
- en: With Windows XP, however, this sometimes doesn't work. Setting ACPI can cause
    the install process to fail, usually by hanging at Setup is Starting Windows.
    The easiest way to install Windows XP is to leave ACPI and APIC off during the
    initial boot from the CD-ROM and then turn them on before the first boot into
    graphical mode.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在 Windows XP 中，这有时不起作用。设置 ACPI 可能会导致安装过程失败，通常是在“正在启动 Windows”时挂起。安装 Windows
    XP 最简单的方法是在从 CD-ROM 初始启动时关闭 ACPI 和 APIC，然后在第一次进入图形模式之前打开它们。
- en: '[PRE5]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Then go through the initial format, copy, and so on. When the first phase of
    Windows Setup completes and the VM turns off, change the config file to read:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 然后进行初始格式化、复制等操作。当 Windows 安装的第一阶段完成并且虚拟机关闭后，将配置文件更改为读取：
- en: '[PRE6]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: This will cause Windows to install the correct HAL during its second-phase installation.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 这将导致 Windows 在其第二阶段安装时安装正确的 HAL。
- en: If you need to change the HAL later on—for example, if you decide to move from
    a uniprocessor to a multiprocessor configuration—we recommend reinstalling Windows.
    It's possible to change the HAL manually by overwriting the various driver files,
    but it's probably not a great idea.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您以后需要更改 HAL——例如，如果您决定从单处理器配置迁移到多处理器配置——我们建议重新安装 Windows。虽然可以通过覆盖各种驱动程序文件手动更改
    HAL，但这可能不是一个好主意。
- en: Installing Windows the Red Hat Way
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 以 Red Hat 方式安装 Windows
- en: Red Hat's `virt-manager` app can handle most of the trouble of setting up Windows
    for you. Just create a machine from the `virt-manager` GUI, select **Fully Virtualized**
    rather than Paravirtualized in the appropriate dialog, and indicate the location
    of Windows install media (either an ISO file or physical CD-ROM). Indicate whether
    you'd like to connect to the network using a virtual network or shared physical
    device (corresponding to networking via `virbr` and `xenbr`, respectively). Install
    Windows as normal, using Microsoft's install program.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: Red Hat的 `virt-manager` 应用可以处理设置Windows的大部分麻烦。只需从 `virt-manager` 图形用户界面创建一个机器，在适当的对话框中选择**完全虚拟化**而不是Para虚拟化，并指出Windows安装媒体的存放位置（可以是ISO文件或物理CD-ROM）。指出你是否希望使用虚拟网络或共享物理设备（分别对应通过
    `virbr` 和 `xenbr` 进行网络连接）连接到网络。使用Microsoft的安装程序按正常方式安装Windows。
- en: 'The configuration generated by `virt-manager` will look something like this:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '`virt-manager` 生成的配置看起来可能像这样：'
- en: '[PRE7]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Unfortunately, this doesn't get you quite to the end of the Windows install.
    For whatever reason, the emulated CD-ROM isn't presented to Windows after the
    first reboot in the install process, so Windows will complain that it can't find
    its files.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，这并不能让你完全完成Windows的安装。由于某种原因，在安装过程中的第一次重启后，模拟的CD-ROM不会被提供给Windows，因此Windows会抱怨找不到其文件。
- en: 'Red Hat''s documentation will tell you that Windows needs to format its virtual
    disk as a FAT or FAT32 partition so that you can copy the install files to it.
    While this approach will work, we prefer to avoid FAT32 in favor of NTFS. To get
    around this problem, we use the I/O emulator. Modify the `disk=` line to use QEMU''s
    I/O emulation as follows:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: Red Hat的文档会告诉你，Windows需要将其虚拟磁盘格式化为FAT或FAT32分区，以便你可以将其安装文件复制到其中。虽然这种方法可行，但我们更喜欢避免使用FAT32，而是使用NTFS。为了解决这个问题，我们使用I/O仿真器。修改
    `disk=` 行以使用QEMU的I/O仿真，如下所示：
- en: '[PRE8]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: (Put your definition for the first hard drive in the appropriate place, of course.)
    The second stanza specifies an ISO to use as a virtual CD-ROM drive, with hardware
    emulation provided by Xen's hardware emulation layer (inherited from QEMU). When
    you've made this change, the CD will appear to the domU as a QEMU emulated device,
    and you can proceed with the installation.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: （当然，将您对第一个硬盘的定义放在适当的位置。）第二个段落指定了一个ISO文件，用作虚拟CD-ROM驱动器，由Xen的硬件仿真层（从QEMU继承）提供硬件仿真。当你做出这个更改后，CD将作为QEMU仿真设备出现在domU上，然后你可以继续安装。
- en: '* * *'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[80](#CHP-13-FNOTE-2)]) So is everything else about running Windows under
    Xen, as far as we can tell.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[80](#CHP-13-FNOTE-2)]) 所以，就我们所知，在Xen下运行Windows的所有其他事情也是如此。
- en: Windows with the Virtual Framebuffer
  id: totrans-69
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 带有虚拟帧缓冲区的Windows
- en: '"What''s the best remote administration tool for Windows NT?"'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: “Windows NT的最佳远程管理工具是什么？”
- en: '"A car."'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: “一辆车。”
- en: —Anonymous, Usenet
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: —匿名，Usenet
- en: However you've gone about installing Windows, you'll almost certainly want to
    log in and use the system when it's running. That's where the virtual framebuffer
    comes in.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 无论你如何安装Windows，你几乎肯定想在它运行时登录并使用系统。这就是虚拟帧缓冲区发挥作用的地方。
- en: Xen's virtual framebuffer allows you to interact with the domU at all stages—from
    BIOS load, through the bootloader, to postsystem boot. It can be accessed through
    SDL on the local console or via VNC over the network. It's one of the neater features
    of HVM domUs, and it really helps to cement the illusion of a real machine.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: Xen的虚拟帧缓冲区允许你在所有阶段与domU交互——从BIOS加载，通过引导加载程序，到系统启动后。它可以通过本地控制台的SDL或通过网络上的VNC访问。这是HVM
    domU的整洁功能之一，并且它真的有助于巩固真实机器的错觉。
- en: Wonderful though the virtual framebuffer is, however, it's got some annoyances.
    Mouse tracking, for example, can be kind of iffy out of the box. Here are some
    ways to fix the most common problems that we've had with the VNC framebuffer.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然虚拟帧缓冲区很棒，但也有一些烦恼。例如，鼠标跟踪在默认情况下可能会有些不稳定。以下是一些解决我们在VNC帧缓冲区中遇到的最常见问题的方法。
- en: 'First, by default Xen''s built-in VNC server won''t listen on interfaces other
    than the loopback. To change this behavior, set `vnc-listen` in */etc/xen/xend-config.sxp*
    to listen on all interfaces:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，默认情况下，Xen内置的VNC服务器不会监听除了回环接口之外的其他接口。要改变这种行为，请在 */etc/xen/xend-config.sxp*
    中设置 `vnc-listen` 以监听所有接口：
- en: '[PRE9]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: You can also specify the IP address of the interface that you want the VNC server
    to listen on. Note that this will expose the machine's console over the network
    and should probably only be done on trusted networks.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以指定VNC服务器要监听的接口的IP地址。请注意，这将通过网络暴露机器的控制台，因此可能只应在受信任的网络上进行。
- en: One useful trick when working with the VNC framebuffer under Windows is to specify
    a tablet as the pointing device, rather than a mouse. This improves the mouse
    tracking by using absolute positioning.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 当在Windows下使用VNC帧缓冲区时，一个有用的技巧是将平板电脑指定为指向设备，而不是鼠标。这通过使用绝对定位来提高鼠标跟踪。
- en: '[PRE10]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: (The `usb=1` line isn't strictly necessary—it's turned on implicitly by `usbdevice=`.
    However, it's a useful reminder that Xen's USB emulation has been turned on.)
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: （`usb=1`这一行并不是绝对必要的——它被`usbdevice=`隐式地打开。然而，它是一个有用的提醒，说明Xen的USB仿真已经被打开。）
- en: 'One last minor annoyance: Sometimes the VNC mouse and keyboard interface just
    stops working (or else the display stops updating). Nine times out of ten, if
    you close and reopen the VNC session, it''ll come back.'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一个小烦恼：有时VNC的鼠标和键盘界面会突然停止工作（或者显示停止更新）。十有八九，如果你关闭并重新打开VNC会话，它就会恢复正常。
- en: 'In addition to Xen''s virtual framebuffer, you can handle access at the OS
    level—for example, by installing the VNC server under Windows or using Microsoft''s
    built-in RDP (Remote Desktop Protocol). These have the advantage of allowing the
    virtual machine to handle its own graphics tasks rather than involving an emulator
    in dom0\. RDP is also a higher-level, more efficient protocol than VNC, analogous
    to X in its handling of widgets and graphics primitives. We recommend using it
    if possible. As [Figure 13-1](ch13s04.html#here_we_see_two_domains_one_running_wind
    "Figure 13-1. Here we see two domains: one running Windows XP and being accessed
    through VNC; and one Windows Server 2003 domU being accessed through VNC, RDP
    from the Windows XP domain, and rdesktop from a Linux machine.") shows, VNC, RDP,
    and SDL can coexist, with multiple independent sessions on the same VM.'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 除了Xen的虚拟帧缓冲区之外，你还可以在操作系统级别处理访问——例如，通过在Windows下安装VNC服务器或使用微软内置的RDP（远程桌面协议）。这些的优点是允许虚拟机自己处理图形任务，而不是在dom0中涉及仿真器。RDP也是一个比VNC更高级、更高效的协议，类似于X在处理小部件和图形原语方面的处理。如果可能的话，我们建议使用它。如图13-1[所示](ch13s04.html#here_we_see_two_domains_one_running_wind
    "图13-1。在这里我们看到两个域：一个运行Windows XP并通过VNC访问；另一个Windows Server 2003 domU通过VNC访问，从Windows
    XP域通过RDP访问，以及从Linux机器通过rdesktop访问。")，VNC、RDP和SDL可以共存，在同一个虚拟机上可以有多个独立的会话。
- en: To enable RDP in administration mode, access **System Properties**, click the
    **Remote** tab, and check the box marked **Enable Remote Desktop**.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 要在管理模式下启用RDP，访问**系统属性**，点击**远程**选项卡，并勾选标记为**启用远程桌面**的复选框。
- en: '![Here we see two domains: one running Windows XP and being accessed through
    VNC; and one Windows Server 2003 domU being accessed through VNC, RDP from the
    Windows XP domain, and rdesktop from a Linux machine.](httpatomoreillycomsourcenostarchimages333245.png.jpg)'
  id: totrans-85
  prefs: []
  type: TYPE_IMG
  zh: '![在这里我们看到两个域：一个运行Windows XP并通过VNC访问；另一个Windows Server 2003 domU通过VNC访问，从Windows
    XP域通过RDP访问，以及从Linux机器通过rdesktop访问。](httpatomoreillycomsourcenostarchimages333245.png.jpg)'
- en: 'Figure 13-1. Here we see two domains: one running Windows XP and being accessed
    through VNC; and one Windows Server 2003 domU being accessed through VNC, RDP
    from the Windows XP domain, and rdesktop from a Linux machine.'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 图13-1。在这里我们看到两个域：一个运行Windows XP并通过VNC访问；另一个Windows Server 2003 domU通过VNC访问，从Windows
    XP域通过RDP访问，以及从Linux机器通过rdesktop访问。
- en: 'Windows XP and Windows Server 2003 include RDP clients. On other platforms,
    the open source rdesktop client allows you to access Windows machines from Unix-like
    operating systems (including Mac OS X). Simply run the following:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: Windows XP和Windows Server 2003包含了RDP客户端。在其他平台上，开源的rdesktop客户端允许你从类Unix操作系统（包括Mac
    OS X）访问Windows机器。只需运行以下命令：
- en: '[PRE11]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Et Voilà!
  id: totrans-89
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Et Voilà！
- en: Now you have Windows running. This would be a good time to make a backup of
    your clean Windows install so that you can conveniently reimage it when something
    goes wrong. Just create an LVM snapshot or file-based CoW device, as we outline
    in the [Chapter 4](ch04.html "Chapter 4. STORAGE WITH XEN"). It'll be good for
    your peace of mind.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，Windows已经运行起来了。这是一个备份干净Windows安装的好时机，这样当出现问题时你可以方便地重新映像。只需创建一个LVM快照或基于文件的CoW设备，就像我们在[第4章](ch04.html
    "第4章。XEN的存储")中概述的那样。这将有助于你的安心。
- en: When you've got a backup, you can do whatever it is you are accustomed to do
    with Windows. We would not presume to instruct you in this regard.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 当你有备份时，你可以做你习惯在Windows上做的事情。我们不会在这个方面指导你。
- en: There are, however, some things to keep in mind about this new Windows install.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，关于这个新的Windows安装，还有一些事情需要记住。
- en: Windows Activation
  id: totrans-93
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Windows激活
- en: Windows licenses and activations are tied to hardware unless you've got a volume
    license. Thus, it would be a good idea to decide on a hardware configuration ahead
    of time and keep it constant to avoid the computer demanding reactivation.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 除非你有批量许可证，否则Windows的许可证和激活与硬件绑定。因此，提前决定硬件配置并保持其不变是一个好主意，以避免计算机要求重新激活。
- en: In particular, specify a MAC address so that Xen doesn't randomly generate a
    new one on every reboot—this is the single most important value in Windows XP's
    hardware hash calculation. Other things to keep in mind are the memory amount
    and virtual CD-ROM.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 特别是，指定一个MAC地址，这样Xen就不会在每次重启时随机生成一个新的地址——这是Windows XP硬件哈希计算中最重要的单个值。其他需要注意的事项包括内存量和虚拟光盘。
- en: Graphics Cards
  id: totrans-96
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 显卡
- en: Another of the big caveats about Windows under Xen is that it still won't allow
    you to use 3D hardware—so the scenario of a desktop Linux box that runs games
    in a Windows domU is still purely in the realm of fantasy for now. As our discussion
    above has shown, the virtual Windows machine uses an emulated framebuffer via
    SDL or VNC. Neither of these modes supports any sort of acceleration.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: Xen下Windows的另一个重大限制是它仍然不允许你使用3D硬件——因此，在Windows domU中运行游戏的桌面Linux机器目前仍然纯粹是幻想。正如我们上面的讨论所显示的，虚拟Windows机器通过SDL或VNC使用模拟的帧缓冲区。这两种模式都不支持任何形式的加速。
- en: The problem with hardware access in HVM mode (this applies to any PCI device,
    not just graphics cards) is that there's no way to map the hardware's memory space
    into the memory of the guest—the guest has an additional layer of abstraction,
    translating a discontiguous block of physical memory into something that the unmodified
    domU operating system can use. Recently, chipsets have been incorporating an *IOMMU*,
    which is hardware that can do this translation job in a manner analogous to the
    processor's memory management unit (hence the name). Xen's support for Intel's
    IOMMU implementation, under the name of VT-d, is progressing, but it hasn't gotten
    to the point where it can make a graphics card usable by a Windows domU.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 在HVM模式下硬件访问的问题（这适用于任何PCI设备，而不仅仅是显卡）在于无法将硬件的内存空间映射到虚拟机的内存中——虚拟机有一个额外的抽象层，将不连续的物理内存块转换成未经修改的domU操作系统可以使用的东西。最近，芯片组已经开始集成*IOMMU*，这是一种可以以类似于处理器内存管理单元的方式进行这种转换的硬件（因此得名）。Xen对Intel的IOMMU实现的名为VT-d的支持正在进展中，但还没有达到可以使得显卡在Windows
    domU中可用的程度。
- en: VT-D SUPPORT
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: VT-D 支持
- en: If you're curious about whether your machine supports VT-d, you can run `xm
    dmesg | grep -i vt-d` in the dom0 to find out. A machine with VT-d will say something
    like *Intel VT-d has been enabled*. If you see this, congratulations! The next
    Xen version will likely include facilities to enable you to use this advanced
    feature.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想知道你的机器是否支持VT-d，你可以在dom0中运行`xm dmesg | grep -i vt-d`来查找。带有VT-d的机器会显示类似*Intel
    VT-d已启用*的信息。如果你看到这个信息，恭喜你！下一个Xen版本可能会包括启用此高级功能的功能。
- en: Another approach to graphics—one that wouldn't require replacement of all existing
    hardware—would be for the the graphics driver authors to implement the translation
    from domU addresses to machine addresses in driver software. Rumor has it that
    NVIDIA has a Xen-aware driver that could be assigned to an HVM domU and used for
    3D acceleration; however, it hasn't yet been released, so there's a good chance
    it doesn't actually exist.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种图形处理方法——不需要替换所有现有硬件的方法——是让图形驱动程序作者在驱动软件中实现从domU地址到机器地址的转换。据说NVIDIA有一个针对Xen的驱动程序，可以分配给HVM
    domU并用于3D加速；然而，它尚未发布，所以有很大可能它实际上并不存在。
- en: One other promising direction uses a virtual 3D graphics driver to forward OpenGL
    calls to the actual graphics hardware. There are a couple of Xen-based projects
    that use this principle, but they are Linux only at the moment. VMware has also
    done some work on a driver architecture that allows for 3D, which appears to take
    the same tack.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个有希望的途径是使用虚拟3D图形驱动程序将OpenGL调用转发到实际的图形硬件。有几个基于Xen的项目使用这个原理，但目前它们仅限于Linux。VMware也进行了一些关于允许3D的驱动程序架构的工作，这似乎采取了相同的策略。
- en: No finished products exist, that we know of, to allow hardware 3D support under
    Windows. Nonetheless, it's a much-requested feature, and it is being worked on.
    We wouldn't make it an essential part of any Xen deployment just yet, however.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 我们所知，尚无成品允许在Windows下支持硬件3D。尽管如此，这是一个被广泛请求的功能，并且正在被开发。然而，我们不会将其作为任何Xen部署的必要部分。
- en: Paravirtualized Drivers for Windows
  id: totrans-104
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Windows虚拟化驱动程序
- en: 'As we''ve already mentioned (several times), HVM is somewhat slower than paravirtualization.
    Partially this is because of the need to virtualize memory access; however, this
    overhead is minimal compared with emulated I/O and its attendant context switches.
    (See [Chapter 12](ch12.html "Chapter 12. HVM: BEYOND PARAVIRTUALIZATION") for
    mind-numbing detail.)'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们之前提到的（多次提到），HVM相对于虚拟化来说要慢一些。部分原因是需要虚拟化内存访问；然而，与模拟I/O及其伴随的上下文切换相比，这种开销是微不足道的。（有关令人难以置信的详细信息，请参阅[第12章](ch12.html
    "第12章。HVM：超越虚拟化")。）
- en: 'You can address many of the speed issues related to HVM by swapping the emulated
    devices for paravirtualized devices after the install process completes. These
    devices will improve I/O speeds dramatically; however, Windows driver support
    is lacking. There are two options: proprietary and expensive drivers, or free
    and unfinished ones.'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装过程完成后，您可以通过将模拟设备替换为虚拟化设备来解决许多与HVM相关的速度问题。这些设备将显著提高I/O速度；然而，Windows驱动程序支持不足。有两个选择：专有且昂贵的驱动程序，或者免费但未完成的驱动程序。
- en: Proprietary Windows PVM Drivers
  id: totrans-107
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 专有Windows PVM驱动程序
- en: 'Three companies have so far provided Windows drivers that take advantage of
    paravirtualization: XenSource, Virtual Iron, and Novell. All of these drivers
    are signed by Microsoft for trouble-free installation on Windows.'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，有三家公司提供了利用虚拟化的Windows驱动程序：XenSource、Virtual Iron和Novell。所有这些驱动程序都由微软签名，以确保在Windows上安装无故障。
- en: Citrix, wearing its XenSource hat, produces paravirtualized drivers for Windows
    as part of its Xen-based virtualization suite. These drivers work well, and you
    can test them for yourself by downloading the free version of the XenSource product.
    Unfortunately, these drivers don't work with the open source version of Xen.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: Citrix戴着XenSource的帽子，作为其基于Xen的虚拟化套件的一部分，为Windows生产虚拟化驱动程序。这些驱动程序运行良好，您可以通过下载XenSource产品的免费版本自行测试。不幸的是，这些驱动程序与Xen的开源版本不兼容。
- en: Virtual Iron ([http://virtualiron.com/](http://virtualiron.com/)) also provides
    paravirtualized drivers for Windows as part of its product. These drivers work
    with open source Xen, and Virtual Iron has been working on contributing changes
    to the Xen community. However, the drivers themselves are still closed source.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: Virtual Iron ([http://virtualiron.com/](http://virtualiron.com/)) 也为其产品提供Windows虚拟化驱动程序。这些驱动程序与开源Xen兼容，Virtual
    Iron一直在努力向Xen社区贡献更改。然而，这些驱动程序本身仍然是闭源的。
- en: Finally, Novell offers Windows PV drivers that work with open source Xen as
    an independent product. These drivers are quite expensive (to say the least)—they
    are so expensive that we haven't actually tried them. More information is at [http://www.novell.com/products/vmdriverpack/](http://www.novell.com/products/vmdriverpack/)
    if you're curious.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，Novell提供与开源Xen兼容的Windows PV驱动程序，作为独立产品。这些驱动程序相当昂贵（至少可以说）——它们如此昂贵，以至于我们实际上并没有尝试过。如果您好奇，更多信息请访问[http://www.novell.com/products/vmdriverpack/](http://www.novell.com/products/vmdriverpack/)。
- en: At this point, while all of these drivers (in our experience) function as advertised,
    none of them seem especially compelling to us. We're content to use Windows, with
    the HVM drivers, solely in light productivity tasks.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，尽管所有这些驱动程序（根据我们的经验）都按预期工作，但它们似乎对我们来说并没有特别吸引人。我们满足于仅使用Windows和HVM驱动程序进行轻量级生产力任务。
- en: GPL Windows Paravirtualized Drivers
  id: totrans-113
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: GPL Windows Paravirtualized Drivers
- en: There is one thing that you can try if you're sufficiently adventurous. GPL
    Windows PV drivers do exist. They are under active development, which is developer-speak
    for "don't use these for anything important." They work pretty well for us, but
    occasionally they do something surprising (usually unpleasant). These drivers
    try to improve performance by avoiding some of the inefficient device emulation
    and by using advanced techniques such as TCP Segmentation Offload, or TSO.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您足够大胆，可以尝试一件事情。确实存在GPL Windows PV驱动程序。它们正在积极开发中，这是开发者语言，意思是“不要将这些用于任何重要的事情。”它们在我们的使用中表现相当不错，但偶尔会做一些令人惊讶的事情（通常是令人不快的）。这些驱动程序试图通过避免一些低效的设备模拟，并使用高级技术，如TCP分段卸载（TSO）来提高性能。
- en: The GPL PV drivers are easy to install. First, we recommend checking the *xen-devel*
    archives to figure out which version is the latest. As of this writing, 0.8.8
    is the most current version, and it's available at [http://www.meadowcourt.org/WindowsXenPV-0.8.8.zip](http://www.meadowcourt.org/WindowsXenPV-0.8.8.zip).
    Unfortunately, there's no web page that lists releases, so you'll want to search
    the archives of the *xen-devel* mailing list to find out the most recent version.
    (Alternatively, you can check the current version using Mercurial—check the repository
    at [http://xenbits.xensource.com/ext/win-pvdrivers.hg](http://xenbits.xensource.com/ext/win-pvdrivers.hg).)
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: GPL PV 驱动程序的安装很简单。首先，我们建议检查 *xen-devel* 存档以确定哪个版本是最新的。截至本文撰写时，0.8.8 是最新版本，可在
    [http://www.meadowcourt.org/WindowsXenPV-0.8.8.zip](http://www.meadowcourt.org/WindowsXenPV-0.8.8.zip)
    获取。不幸的是，没有列出发布的网页，因此您需要搜索 *xen-devel* 邮件列表的存档以找到最新版本。（或者，您可以使用 Mercurial 检查当前版本——检查
    [http://xenbits.xensource.com/ext/win-pvdrivers.hg](http://xenbits.xensource.com/ext/win-pvdrivers.hg)
    上的存储库。）
- en: We opted to download the binary driver package directly within an HVM Windows
    XP Professional instance. It includes a fairly comprehensive set of installation
    instructions, but we'll go over what we did anyway, just for convenience.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 我们选择在 HVM Windows XP Professional 实例中直接下载二进制驱动程序包。它包括一套相当全面的安装说明，但我们仍然会过一遍我们做了什么，只是为了方便。
- en: First, unpack the drivers. We just dragged the appropriate folder to the desktop.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，解压驱动程序。我们只是将相应的文件夹拖到了桌面上。
- en: Next, run *install.bat*. Windows will complain several times about the drivers
    not being signed. Just click **OK**.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，运行 *install.bat*。Windows 会多次抱怨驱动程序未签名。只需点击 **确定**。
- en: When the install finishes, reboot to make sure that everything still works.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 安装完成后，重新启动以确保一切仍然正常工作。
- en: 'Assuming you rebooted successfully, you should now be able to access PV devices
    from Windows. Try creating a scratch device in the dom0, then running an `xm block-attach`
    command like the following (with appropriate names, as always):'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 假设您成功重启，现在您应该能够从 Windows 访问 PV 设备。尝试在 dom0 中创建一个临时设备，然后运行以下类似的 `xm block-attach`
    命令（始终使用适当的名称）：
- en: '[PRE12]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: This should cause Windows to notice a new device, use the correct driver, and
    present a blank disk, which we can then format, as shown in [Figure 13-2](ch13s06.html#adding_a_paravirtualized_disk_with_the_g
    "Figure 13-2. Adding a paravirtualized disk with the GPL PV drivers"). Similarly,
    you can attach a network device with the `xm network-attach` command.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该会导致 Windows 注意到一个新设备，使用正确的驱动程序，并显示一个空白磁盘，然后我们可以对其进行格式化，如图 [图 13-2](ch13s06.html#adding_a_paravirtualized_disk_with_the_g
    "图 13-2. 使用 GPL PV 驱动程序添加虚拟化磁盘") 所示。同样，您可以使用 `xm network-attach` 命令附加网络设备。
- en: Finally, you'll need to edit the *boot.ini* file to tell the GPL PV drivers
    to activate. (You might need to turn on Show Hidden Files and Folders and uncheck
    Hide Protected Operating System Files in Tools ► Folder Options to make *boot.ini*
    accessible.)
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，您需要编辑 *boot.ini* 文件来告诉 GPL PV 驱动程序激活。 （您可能需要打开“工具”>>“文件夹选项”中的“显示隐藏文件和文件夹”，并取消选中“隐藏受保护的操作系统文件”，以便使
    *boot.ini* 可访问。）
- en: '[PRE13]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Here we've modified the boot entry by putting `/gplpv` on the end to tell the
    GPL PV drivers to activate.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们通过在末尾添加 `/gplpv` 来修改引导条目，以告诉 GPL PV 驱动程序激活。
- en: '![Adding a paravirtualized disk with the GPL PV drivers](httpatomoreillycomsourcenostarchimages333247.png.jpg)'
  id: totrans-126
  prefs: []
  type: TYPE_IMG
  zh: '![使用 GPL PV 驱动程序添加虚拟化磁盘](httpatomoreillycomsourcenostarchimages333247.png.jpg)'
- en: Figure 13-2. Adding a paravirtualized disk with the GPL PV drivers
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 图 13-2. 使用 GPL PV 驱动程序添加虚拟化磁盘
- en: Now shut down the Windows install.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，关闭 Windows 安装。
- en: Reboot, select the **Windows XP Professional (PV Drivers)** entry from the boot
    menu, and you should have a full set of PV devices.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 重新启动，从引导菜单中选择 **Windows XP Professional (PV Drivers)** 条目，您应该有一套完整的 PV 设备。
- en: Ongoing Development
  id: totrans-130
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 持续开发
- en: Windows under Xen is still immature, but it's already developed far enough to
    be useful. Using Xen, you can consolidate Windows servers in a robust, manageable
    platform and run client software in a native environment on the desktop. You have
    a reasonable way of accessing the machine via the framebuffer or rdesktop, and
    finally you have PV drivers for reasonable speed.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Xen 下的 Windows 仍然不成熟，但它已经发展到足够有用的程度。使用 Xen，您可以在一个强大、可管理的平台上合并 Windows 服务器，并在桌面上以原生环境运行客户端软件。您有合理的方式通过帧缓冲区或
    rdesktop 访问机器，最后您有 PV 驱动程序以实现合理的速度。
- en: All in all, Xen is quite a good platform for Windows. Not perfect, but certainly
    usable.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 总的来说，Xen 是一个相当好的 Windows 平台。不完美，但确实可用。
