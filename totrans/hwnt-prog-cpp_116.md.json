["```\n  1 /************************************************\n  2  * flag -- Demonstrate the use of flag setting  *\n  3  *      and clearing.  This is a demonstration  *\n  4  *      program that does not run in real life. *\n  5  *      But it is a good example of a very tiny *\n  6  *      part of the code in a terminal driver.  *\n  7  ************************************************/\n  8 #include <cstdio>\n  9 #include <stdlib.h>\n 10 #include <pthread.h>\n 11\n 12\n 13 const char XOFF = 'S' - '@';// Turns off output\n 14 const char XON = '0' - '@'; // Turns on output\n 15\n 16 static int flags = 0; // State flags\n 17 //\n 18 // ^S in effect\n 19 const int STOP_OUTPUT = (1 << 0);\n 20\n 21 // CD is present\n 22 const int CD_SIGNAL   = (1 << 1);\n 23\n 24 /***********************************************\n 25  * read_ch -- read a single character.         *\n 26  *                                             *\n 27  * Returns the character read.                 *\n 28  ***********************************************/\n 29 static char read_ch(void)\n 30 {\n 31     // Dummy function\n 32     return ('x');\n 33 }\n 34\n 35 /************************************************\n 36  * write_ch -- write a character to the output  *\n 37  *              (Whatever that is.)             *\n 38  ************************************************/\n 39 static void write_ch(const char ch)\n 40 {\n 41     // Dummy function\n 42 }\n 43 /************************************************\n 44  * do_input -- handle the reading and           *\n 45  *      processing of characters.               *\n 46  ************************************************/\n 47 static void *do_input(void *)\n 48 {\n 49     while (1)\n 50     {\n 51         char ch;         // Character we just read\n 52\n 53         ch = read_ch();\n 54\n 55         switch (ch) {\n 56             case XOFF:\n 57                 flags |= STOP_OUTPUT;\n 58                 break;\n 59             case XON:\n 60                 flags &= ~STOP_OUTPUT;\n 61                 break;\n 62             default:\n 63                 write_ch(ch);\n 64                 break;\n 65         }\n 66     }\n 67 }\n 68\n 69 /************************************************\n 70  * wait_for_cd_change -- wait for the CD signal *\n 71  *      to change and return the value of the   *\n 72  *      signal.                                 *\n 73  ************************************************/\n 74 static int wait_for_cd_change(void)\n 75 {\n 76     // Dummy\n 77     return (1);\n 78 }\n 79 /***********************************************\n 80  * do_signals -- Monitor signals and set flags *\n 81  *      based on the signal changes.           *\n 82  ***********************************************/\n 83 void do_signals(void)\n 84 {\n 85     while (1) {\n 86         // The current cd level\n 87         int level = wait_for_cd_change();\n 88         if (level) {\n 89             flags |= CD_SIGNAL;\n 90         } else {\n 91             flags &= ~CD_SIGNAL;\n 92         }\n 93     }\n 94 }\n 95\n 96 int main()\n 97 {\n 98     int status; // Status of last system call\n 99\n100     // Information on the status thread\n101     pthread_t input_thread;\n102\n103     status = pthread_create(&input_thread,\n104                 NULL, do_input, NULL);\n105\n106     if (status != 0) {\n107         perror(\n108             \"ERROR: Thread create failed:\\n   \");\n109         exit (8);\n110     }\n111\n112     do_signals();\n113     return(o);\n114 }\n\n```"]