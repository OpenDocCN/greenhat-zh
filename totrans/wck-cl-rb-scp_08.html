<html><head></head><body>
  <div class="sgc-1" id="filepos648885"/>&#13;
&#13;
  <h1 class="calibre1" id="calibre_pb_402"><span class="calibre2"><a class="calibre7" shape="rect"/>Chapter 8. ARGUMENTS AND DOCUMENTATION</span></h1>&#13;
&#13;
  <div class="calibre3"><a class="calibre17" shape="rect"/><img alt="ARGUMENTS AND DOCUMENTATION" class="calibre23" src="../Images/00001.jpg"/></div>&#13;
&#13;
  <p class="calibre4">In this chapter, we will revisit some earlier scripts and tie them into a single, larger script. In doing so, we can abstract functions that are similar between each element. This abstraction not only saves space, it also results in larger chunks of reusable code.</p>&#13;
&#13;
  <p class="calibre4">To begin <a class="calibre17" shape="rect"/>consolidating the scripts, we are going to rely on a library that will tie in essential parts of the scripts and allow a user to access specific functions through the command line. The library is called <a class="calibre17" shape="rect"/>GetoptLong, because it gets options from the implied argument vector (or the command line). Many times, when a script is written, there may be more than one task available to the user. Instead of running the entire script, we can let the user pick and choose functions based on his or her needs. Not only will the library enable us to use command-line arguments to set up different cases, but it will also replace the "in-house" argument check used throughout the book.</p>&#13;
&#13;
  <p class="calibre4">Another tool that will complement GetoptLong is <a class="calibre17" shape="rect"/>RDoc. RDoc helps format our code's usage statements and <a class="calibre17" shape="rect"/>documentation. Specifically, RDoc will generate structured HTML documentation from Ruby source code (for more <a class="calibre17" shape="rect"/>information about <a class="calibre17" shape="rect"/>RDoc and to download the application, visit <a class="calibre6" href="http://rdoc.sourceforge.net/" shape="rect">http://rdoc.sourceforge.net/</a>)<a class="calibre17" shape="rect"/>. Another "in-house" chunk of code seen throughout the previous scripts were the usage statements—RDoc can replace this chunk of code and help us maintain consistency in our <a class="calibre17" shape="rect"/>documentation. These libraries will also give a professional appearance to the scripts by formatting the usage statements and output in a predictable, common way.</p>&#13;


  <div class="calibre3 calibre3 calibre3 calibre3">
    <h1 class="calibre1" id="calibre_pb_403"><span class="calibre2"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos651722"/>File Security</span></h1>
  </div>


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_404"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos652009"/>File Security</span></h2>&#13;
    </div>&#13;
&#13;
    <div class="calibre3">&#13;
      <div class="calibre3 calibre3 calibre3">&#13;
        <h3 class="calibre16" id="heading_id_2"><a class="calibre7" shape="rect"/>fileSecurity.rb</h3>&#13;
      </div>&#13;
&#13;
      <p class="calibre4">Two scripts that are prime for consolidation are the encryption and decryption scripts from <a class="calibre6" href="../Text/dummy_split_012.html#filepos91052" shape="rect">Chapter 1</a> ("#2 Encrypt a File" on <a class="calibre6" href="../Text/dummy_split_019.html#filepos107737" shape="rect">Hacking the Script</a> and "#3 Decrypt a File" on <a class="calibre6" href="../Text/dummy_split_026.html#filepos119276" shape="rect">Hacking the Script</a>). To recap what these scripts did, the encrypt script scrambled data into ciphertext, and the decrypt script decoded the ciphertext back into plaintext. Both scripts used the <a class="calibre17" shape="rect"/>Blowfish encryption algorithm and a password chosen by the user.<a class="calibre17" shape="rect"/></p>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_405"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos653329"/>The Code</span></h2>&#13;
    </div><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19"><img alt="" class="calibre23" src="../Images/00002.jpg"/> # == Synopsis<br class="calibre20"/>&#13;
        #<br class="calibre20"/>&#13;
        #  fileSecurity.rb: encrypts and decrypts files, demonstrates encryption algorithms<br class="calibre20"/>&#13;
        #<br class="calibre20"/>&#13;
        #<br class="calibre20"/>&#13;
        # == Usage<br class="calibre20"/>&#13;
        #<br class="calibre20"/>&#13;
        # encryption [OPTIONS] ... FILE<br class="calibre20"/>&#13;
        #<br class="calibre20"/>&#13;
        # -h, --help:<br class="calibre20"/>&#13;
        #    show help<br class="calibre20"/>&#13;
        #<br class="calibre20"/>&#13;
        # --encrypt key, -e key<br class="calibre20"/>&#13;
        #    encrypt file with password<br class="calibre20"/>&#13;
        #<br class="calibre20"/>&#13;
        # --decrypt key, -d key<br class="calibre20"/>&#13;
        #    decrypt file with password<br class="calibre20"/>&#13;
        #<br class="calibre20"/>&#13;
        # FILE: The file that you want to encrypt/decrypt<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
        require 'getoptlong'<br class="calibre20"/>&#13;
        require 'rdoc/ri/ri_paths'<br class="calibre20"/>&#13;
        require 'rdoc/usage'<br class="calibre20"/>&#13;
        require 'crypt/blowfish'<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
        def encrypt(file, pass)<br class="calibre20"/>&#13;
            c = "Encrypted_#{file}"<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
            if File.exists?(c)<br class="calibre20"/>&#13;
                puts "\nFile already exists."<br class="calibre20"/>&#13;
                exit<br class="calibre20"/>&#13;
            end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
                begin<br class="calibre20"/>&#13;
                # initialize the encryption method using the user input key<br class="calibre20"/>&#13;
                blowfish = Crypt::Blowfish.new(pass)<br class="calibre20"/>&#13;
                blowfish.encrypt_file(file.to_str, c)<br class="calibre20"/>&#13;
            # encrypt the file<br class="calibre20"/>&#13;
                puts "\nEncryption SUCCESS!"<br class="calibre20"/>&#13;
            rescue Exception =&gt; e<br class="calibre20"/>&#13;
                puts "An error occurred during encryption: \n #{e}"<br class="calibre20"/>&#13;
            end<br class="calibre20"/>&#13;
        end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
        def decrypt(file, pass)<br class="calibre20"/>&#13;
            p = "Decrypted_#{file}"<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
            if File.exists?(p)<br class="calibre20"/>&#13;
                puts "\nFile already exists."<br class="calibre20"/>&#13;
                exit<br class="calibre20"/>&#13;
            end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
            begin<br class="calibre20"/>&#13;
                # initialize the decryption method using the user input key<br class="calibre20"/>&#13;
                blowfish = Crypt::Blowfish.new(pass)<br class="calibre20"/>&#13;
                blowfish.decrypt_file(file.to_str, p)<br class="calibre20"/>&#13;
                # decrypt the file<br class="calibre20"/>&#13;
                puts "\nDecryption SUCCESS!"<br class="calibre20"/>&#13;
            rescue Exception =&gt; e<br class="calibre20"/>&#13;
                puts "An error occurred during decryption: \n #{e}"<br class="calibre20"/>&#13;
            end<br class="calibre20"/>&#13;
        end<br class="calibre20"/>&#13;
      <a class="calibre17" shape="rect"/><br class="calibre20"/>&#13;
      <a class="calibre17" shape="rect"/><br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00003.jpg"/> opts = GetoptLong.new(<br class="calibre20"/>&#13;
            [ '--help', '-h', GetoptLong::NO_ARGUMENT ],<br class="calibre20"/>&#13;
            [ '--encrypt', '-e', GetoptLong::REQUIRED_ARGUMENT ],<br class="calibre20"/>&#13;
            [ '--decrypt', '-d', GetoptLong::REQUIRED_ARGUMENT ]<br class="calibre20"/>&#13;
        )<br class="calibre20"/>&#13;
      <a class="calibre17" shape="rect"/><br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00004.jpg"/> unless ARGV[0]<br class="calibre20"/>&#13;
            puts "\nYou did not include a filename (try --help)"<br class="calibre20"/>&#13;
            exit<br class="calibre20"/>&#13;
        end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
        filename = ARGV[-1].chomp<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00005.jpg"/> opts.each do |opt, arg|<br class="calibre20"/>&#13;
            case opt<br class="calibre20"/>&#13;
            when '--help'<br class="calibre20"/>&#13;
                RDoc::usage<br class="calibre20"/>&#13;
            when '--encrypt'<br class="calibre20"/>&#13;
                encrypt(filename, arg)<br class="calibre20"/>&#13;
            when '--decrypt'<br class="calibre20"/>&#13;
                decrypt(filename, arg)<br class="calibre20"/>&#13;
            else<br class="calibre20"/>&#13;
                RDoc::usage<br class="calibre20"/>&#13;
            end<br class="calibre20"/>&#13;
        end</tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_406"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos657876"/>Running the Code</span></h2>
    </div>

    <p class="calibre4">This script runs with two command-line arguments: which operation to <a class="calibre17" shape="rect"/>perform (<code class="calibre19">encrypt</code> or <code class="calibre19">decrypt</code>) and the file to be manipulated.<a class="calibre17" shape="rect"/></p><a class="calibre17" shape="rect"/>

    <div class="calibre3">
      <span class="calibre18"><tt class="calibre19"><strong class="calibre22"><code class="calibre19">ruby fileSecurity.rb --encrypt <em class="italic"><code class="calibre19">superSecret.txt</code></em></code></strong><br class="calibre20"/>
      <strong class="calibre22"><code class="calibre19">ruby fileSecurity.rb --decrypt <em class="italic"><code class="calibre19">superSecret.txt</code></em></code></strong></tt></span>
    </div>
  </div>


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_407"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos658993"/>The Results</span></h2>&#13;
    </div><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19"><strong class="calibre22"><code class="calibre19">ruby fileSecurity.rb</code></strong><br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      You did not include a filename (try --help)<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <strong class="calibre22"><code class="calibre19">ruby fileSecurity.rb --help</code></strong><br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      Synopsis<br class="calibre20"/>&#13;
      --------<br class="calibre20"/>&#13;
       fileSecurity.rb: encrypts and decrypts files, demonstrates encryption algorithms<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      Usage<br class="calibre20"/>&#13;
      -----<br class="calibre20"/>&#13;
      encryption [OPTIONS] ... FILE<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      -h, --help<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          show help<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      --encrypt key, -e key<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
         encrypt file with password<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      --decrypt key, -d key<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
         decrypt file with password<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      FILE: The file that you want to encrypt/decrypt</tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_408"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos660109"/>How It Works</span></h2>
    </div>

    <p class="calibre4">The file is set up with two paths or <span><em class="italic">operations</em></span>. The first path of execution is the encryption routine. The second path is the decryption routine. If you need a refresher on how the encryption or decryption works, refer to pages <a class="calibre6" href="../Text/dummy_split_019.html#filepos107737" shape="rect">Hacking the Script</a> to <a class="calibre6" href="../Text/dummy_split_025.html#filepos115794" shape="rect">How It Works</a>. The script starts off very differently than any of the other scripts we've written so far; most noticeable is the large comment block at the beginning of the script<a class="calibre17" shape="rect"/> <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00002.jpg"/></span>. This section of code is actually used by the RDoc library to output relevant information about the script.<a class="calibre17" shape="rect"/></p>

    <p class="calibre4">You will also see reliance on a few more external libraries. The first new library required for operation is <a class="calibre17" shape="rect"/>GetoptLong. This library is responsible for handling all of the arguments within the script. Because we will combine two scripts, we will leverage GetoptLong to make argument parsing a snap. Next, we call <a class="calibre17" shape="rect"/>rdoc/ri/ri_paths and <a class="calibre17" shape="rect"/>rdoc/usage. These two libraries must be used together because rdoc/usage used by itself will generate errors on some systems due to dependencies. These libraries allow the proper <a class="calibre17" shape="rect"/>formatting when <code class="calibre19">--help</code> is an argument of the <a class="calibre17" shape="rect"/>script.</p>

    <p class="calibre4">The arguments are all defined in a <a class="calibre17" shape="rect"/>GetoptLong object called <code class="calibre19">opt</code>. Two major attributes <a class="calibre17" shape="rect"/>for each command-line option must be defined. The first attribute is an array of <a class="calibre17" shape="rect"/>string objects that contains the names of that particular option<a class="calibre17" shape="rect"/><a class="calibre17" shape="rect"/> <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00003.jpg"/></span>. You can use as many string objects as you'd like, and here I created two names for each option. The first is the full name, and the second is an abbreviation. The last piece of the <code class="calibre19">opt</code> object is the flag referring to the argument. The three options are listed below.</p><a class="calibre17" shape="rect"/>

    <div class="calibre3">
      <span class="calibre18"><tt class="calibre19">GetoptLong::NO_ARGUMENT<br class="calibre20"/>
      GetoptLong::REQUIRED_ARGUMENT<br class="calibre20"/>
      GetoptLong::REQUIRED_ARGUMENT</tt></span>
    </div>

    <p class="calibre4">In this script, I identified three possible command-line arguments: <code class="calibre19">help, encrypt</code>, and <code class="calibre19">decrypt</code>. The <code class="calibre19">encrypt</code> and <code class="calibre19">decrypt</code> options require an argument that will be the key used to encrypt or decrypt the specified file. You can get as creative as you want with the command-line arguments, but try not to confuse your users (or yourself three months from now). Now that the arguments are defined, we need to ensure that the user supplied an argument. If there aren't any arguments, then perhaps the user should visit the help section so that no files end up corrupted … or worse <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00004.jpg"/></span>. The filename used to either encrypt or decrypt the file will be the last argument of the script. We will also need a key when encrypting or decrypting the file, so the variable is initialized ahead of time.</p>

    <p class="calibre4">Now that <code class="calibre19">opt</code> is ready to start parsing, the command-line arguments are passed into a block where the option and argument are broken apart <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00005.jpg"/></span>. A simple <code class="calibre19">case</code> statement makes for a clean execution on the control block. If <code class="calibre19">opt</code> is <code class="calibre19">--help</code> then <code class="calibre19">Rdoc::usage</code> is called. If <code class="calibre19">opt</code> is <code class="calibre19">--encrypt</code> or <code class="calibre19">-decrypt</code>, then the file is encrypted or decrypted, respectively, with the key being the required argument. To finish the script, the <code class="calibre19">case</code> statement ends, and the script exits.</p>
  </div>

  <div class="mbppagebreak" id="calibre_pb_409"/>


  <div class="calibre3 calibre3 calibre3 calibre3" id="filepos665282">
    <h1 class="calibre1" id="calibre_pb_410"><span class="calibre2"><a class="calibre7" shape="rect"/>Web Scraper</span></h1>
  </div>


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_411"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos665768"/>Web Scraper</span></h2>&#13;
    </div>&#13;
&#13;
    <div class="calibre3">&#13;
      <div class="calibre3 calibre3 calibre3">&#13;
        <h3 class="calibre16" id="heading_id_2"><a class="calibre7" shape="rect"/>webScraper.rb</h3>&#13;
      </div>&#13;
&#13;
      <p class="calibre4">This version of the web scraper has the same functionality as the one found in <a class="calibre6" href="../Text/dummy_split_291.html#filepos559796" shape="rect">Chapter 7</a> (see "#44 Link Scrape" on <a class="calibre6" href="../Text/dummy_split_305.html#filepos581500" shape="rect">Link Scrape</a>, "#45 Image Scrape" on <a class="calibre6" href="../Text/dummy_split_310.html#filepos605751" shape="rect">How It Works</a>, and "#46 Scraper" on <a class="calibre6" href="../Text/dummy_split_318.html#filepos617953" shape="rect">Hacking the Script</a>). The difference between the script in <a class="calibre6" href="../Text/dummy_split_291.html#filepos559796" shape="rect">Chapter 7</a> and the one below is the addition of GetoptLong and RDoc. This version has the advantage of a standard help message, along with command-line arguments for the specific functions.<a class="calibre17" shape="rect"/><a class="calibre17" shape="rect"/><a class="calibre17" shape="rect"/><a class="calibre17" shape="rect"/></p>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_412"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos667283"/>The Code</span></h2>&#13;
    </div><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19"><img alt="" class="calibre23" src="../Images/00002.jpg"/> # == Synopsis<br class="calibre20"/>&#13;
        #<br class="calibre20"/>&#13;
        #  webScraper.rb: scrape specific information from websites<br class="calibre20"/>&#13;
        #<br class="calibre20"/>&#13;
        #<br class="calibre20"/>&#13;
        # == Usage<br class="calibre20"/>&#13;
        #<br class="calibre20"/>&#13;
        # <a class="calibre17" shape="rect"/>webScraper.rb [OPTIONS] ... URL<br class="calibre20"/>&#13;
        #<br class="calibre20"/>&#13;
        # -h, --help<br class="calibre20"/>&#13;
        #    show help<br class="calibre20"/>&#13;
        #<br class="calibre20"/>&#13;
        # --links , -l<br class="calibre20"/>&#13;
        #    scrape all of the links off a <a class="calibre17" shape="rect"/>web page<br class="calibre20"/>&#13;
        #<br class="calibre20"/>&#13;
        # --images, -i<br class="calibre20"/>&#13;
        #    scrape all of the images off a web page<br class="calibre20"/>&#13;
        #<br class="calibre20"/>&#13;
        # --page, -p<br class="calibre20"/>&#13;
        #    scrape the html code off a web page<br class="calibre20"/>&#13;
        #<br class="calibre20"/>&#13;
        # URL: The website that you want to scrape<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
        require 'getoptlong'<br class="calibre20"/>&#13;
        require 'rdoc/ri/ri_paths'<br class="calibre20"/>&#13;
        require 'rdoc/usage'<br class="calibre20"/>&#13;
        require 'rio'<br class="calibre20"/>&#13;
        require 'open-uri'<br class="calibre20"/>&#13;
        require 'uri'<br class="calibre20"/>&#13;
        require 'mechanize'<br class="calibre20"/>&#13;
        require 'pathname'<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
        def links(site)<br class="calibre20"/>&#13;
            links_file = File.open("links.txt","w+b")<br class="calibre20"/>&#13;
            agent = WWW::Mechanize.new<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
            begin<br class="calibre20"/>&#13;
                page = agent.get(site.strip)<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
                page.links.each do |l|<br class="calibre20"/>&#13;
                    if l.href[0..3] == "http"<br class="calibre20"/>&#13;
                        links_file.puts l.href<br class="calibre20"/>&#13;
                    elsif (l.href.split("")[0] == '/' and site.split("").last != '/') or<br class="calibre20"/>&#13;
                            (l.href.split("")[0] != '/' and site.split("").last == '/')<br class="calibre20"/>&#13;
                        links_file.puts "#{site}#{l.href}"<br class="calibre20"/>&#13;
                    elsif l.href.split("")[0] != '/' and site.split("").last != '/'<br class="calibre20"/>&#13;
                        links_file.puts "#{site}/#{l.href}"<br class="calibre20"/>&#13;
                    else<br class="calibre20"/>&#13;
                        links_file.puts l.href<br class="calibre20"/>&#13;
                    end<br class="calibre20"/>&#13;
                end<br class="calibre20"/>&#13;
            rescue =&gt; e<br class="calibre20"/>&#13;
                puts "An error occurred."<br class="calibre20"/>&#13;
                puts e<br class="calibre20"/>&#13;
            end<br class="calibre20"/>&#13;
            links_file.close<br class="calibre20"/>&#13;
        end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
        def images(site)<br class="calibre20"/>&#13;
            begin<br class="calibre20"/>&#13;
                open(site.strip, "User-Agent" =&gt; "Mozilla/4.0 (compatible; MSIE 5.5;<br class="calibre20"/>&#13;
        Windows 98)") do |source|<br class="calibre20"/>&#13;
                    source.each_line do |x|<br class="calibre20"/>&#13;
                        if x =~ /&lt;img src="(.+.[jpeg|gif])"\s+/<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
                            name = $1.split('"').first<br class="calibre20"/>&#13;
                            site = site + '/' unless site.split("").last == '/'<br class="calibre20"/>&#13;
                            name = site + name unless name[0..3] == "http"<br class="calibre20"/>&#13;
                            copy = name.split('/').last<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
                            File.open(copy, 'wb') do |f|<br class="calibre20"/>&#13;
                                f.write(open(name).read)<br class="calibre20"/>&#13;
                            end<br class="calibre20"/>&#13;
                        end<br class="calibre20"/>&#13;
                    end<br class="calibre20"/>&#13;
                end<br class="calibre20"/>&#13;
            rescue =&gt; e<br class="calibre20"/>&#13;
                puts "An error occurred, please try again."<br class="calibre20"/>&#13;
                puts e<br class="calibre20"/>&#13;
            end<br class="calibre20"/>&#13;
        end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
        def page(site)<br class="calibre20"/>&#13;
            rio(site) &gt; rio("#{URI.parse(site.strip).host}.html")<br class="calibre20"/>&#13;
        end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
        opts = GetoptLong.new(<br class="calibre20"/>&#13;
            [ '--help', '-h', GetoptLong::NO_ARGUMENT ],<br class="calibre20"/>&#13;
            [ '--links', '-l', GetoptLong::NO_ARGUMENT ],<br class="calibre20"/>&#13;
            [ '--images', '-i', GetoptLong::NO_ARGUMENT ],<br class="calibre20"/>&#13;
            [ '--page', '-p', GetoptLong::NO_ARGUMENT ]<br class="calibre20"/>&#13;
        )<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
        unless ARGV[0]<br class="calibre20"/>&#13;
            puts "\nYou did not include a URL (try --help)"<br class="calibre20"/>&#13;
            exit<br class="calibre20"/>&#13;
        end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
        url = ARGV[-1].chomp<br class="calibre20"/>&#13;
      <a class="calibre17" shape="rect"/><a class="calibre17" shape="rect"/><br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00003.jpg"/> opts.each do |opt, arg|<br class="calibre20"/>&#13;
            case opt<br class="calibre20"/>&#13;
            when '--help'<br class="calibre20"/>&#13;
                RDoc::usage<br class="calibre20"/>&#13;
            when '--links'<br class="calibre20"/>&#13;
                links(url)<br class="calibre20"/>&#13;
            when '--images'<br class="calibre20"/>&#13;
                images(url)<br class="calibre20"/>&#13;
            when '--page'<br class="calibre20"/>&#13;
                page(url)<br class="calibre20"/>&#13;
            else<br class="calibre20"/>&#13;
                RDoc::usage<br class="calibre20"/>&#13;
            end<br class="calibre20"/>&#13;
        end</tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_413"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos673703"/>Running the Code</span></h2>
    </div>

    <p class="calibre4">To run this <a class="calibre17" shape="rect"/>script, pick from four command-line options and supply the specific URL being targeted. None of the options require an argument.<a class="calibre17" shape="rect"/></p><a class="calibre17" shape="rect"/>

    <div class="calibre3">
      <span class="calibre18"><tt class="calibre19"><strong class="calibre22"><code class="calibre19">ruby webScraper.rb [--help|--links|--images|--page] <em class="italic"><code class="calibre19">http://url_to_scrape.com/</code></em></code></strong></tt></span>
    </div>
  </div>


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_414"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos674607"/>The Results</span></h2>&#13;
    </div><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19"><strong class="calibre22"><code class="calibre19">ruby webScraper.rb --help</code></strong><br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      Synopsis<br class="calibre20"/>&#13;
      --------<br class="calibre20"/>&#13;
       webScraper.rb: scrape specific <a class="calibre17" shape="rect"/>information from websites<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      Usage<br class="calibre20"/>&#13;
      -----<br class="calibre20"/>&#13;
      webScraper.rb [OPTIONS] ... URL<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      -h, --help:<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          show help<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      --links , -l:<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
         scrape all of the links off a web page<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      --images, -i:<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
         scrape all of the images off a web page<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      --page, -p:<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
         scrape the html code off a web page<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      URL: The website that you want to scrape</tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_415"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos675664"/>How It Works</span></h2>&#13;
    </div>&#13;
&#13;
    <p class="calibre4">This script is set up similar to the <span><em class="italic">fileSecurity.rb</em></span> script. The functionality is the same from the scripts in <a class="calibre6" href="../Text/dummy_split_291.html#filepos559796" shape="rect">Chapter 7</a>. To begin to provide appropriate usage and documentation for future users, the large <a class="calibre17" shape="rect"/>comment section at the head of the code is defined <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00002.jpg"/></span>. The only difference between this code and the previous scraping example is the control structure now used to direct the flow to the appropriate methods. The control structure is again a <code class="calibre19">case</code> statement looking for the specific arguments passed in by the user <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00003.jpg"/></span>. If you compare the original web scraping script (see "#49 File Security" on <a class="calibre6" href="../Text/dummy_split_338.html#filepos651722" shape="rect">File Security</a>) to the one above, you can see how much simpler controlling the flow of the program is with GetoptLong, and how neatly RDoc formats the usage statements. You can always use your own argument parser, but GetoptLong and RDoc add a more consistent and succinct approach. I won't go into the details of this <a class="calibre17" shape="rect"/>script, but I did want to give you a look at a different way to combine the scripts.<a class="calibre17" shape="rect"/></p>&#13;
  </div>&#13;
&#13;
  <div class="mbppagebreak" id="calibre_pb_416"/>&#13;


  <div class="calibre3 calibre3 calibre3 calibre3" id="filepos677421">
    <h1 class="calibre1" id="calibre_pb_417"><span class="calibre2"><a class="calibre7" shape="rect"/>Photo Utilities</span></h1>
  </div>


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_418"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos677911"/>Photo Utilities</span></h2>&#13;
    </div>&#13;
&#13;
    <div class="calibre3">&#13;
      <div class="calibre3 calibre3 calibre3">&#13;
        <h3 class="calibre16" id="heading_id_2"><a class="calibre7" shape="rect"/>photoUtility.rb</h3>&#13;
      </div>&#13;
&#13;
      <p class="calibre4">This script combines most of the scripts found in <a class="calibre6" href="../Text/dummy_split_156.html#filepos331926" shape="rect">Chapter 4</a> and presents them in one file. This could be converted into a customized picture library or used as presented below. Some of the reasons I chose to create this suite is the focus on photographic manipulations. Scripts with a commonality are good candidates <a class="calibre17" shape="rect"/>for consolidation and even warrant refactoring the code for easier maintainability. One of the advantages that I found most significant is having a lot of functionality all in one script. You can imagine how cumbersome it could be, having to hunt down multiple scripts to do the tasks included in this single Ruby script.<a class="calibre17" shape="rect"/><a class="calibre17" shape="rect"/><a class="calibre17" shape="rect"/></p>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_419"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos679395"/>The Code</span></h2>&#13;
    </div><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19"># == Synopsis<br class="calibre20"/>&#13;
      #<br class="calibre20"/>&#13;
      #  photoUtility.rb: manipulate images to resize, watermark, or make a <a class="calibre17" shape="rect"/>web photo album<br class="calibre20"/>&#13;
      #<br class="calibre20"/>&#13;
      #<br class="calibre20"/>&#13;
      # == Usage<br class="calibre20"/>&#13;
      #<br class="calibre20"/>&#13;
      # photoUtility.rb [OPTIONS] ... IMAGE<br class="calibre20"/>&#13;
      #<br class="calibre20"/>&#13;
      # -h, --help<br class="calibre20"/>&#13;
      #    show help<br class="calibre20"/>&#13;
      #<br class="calibre20"/>&#13;
      # --bw, -b<br class="calibre20"/>&#13;
      #    convert an image to black and white<br class="calibre20"/>&#13;
      #<br class="calibre20"/>&#13;
      # --gallery, -g<br class="calibre20"/>&#13;
      #    create a web photo album. Enter "temp" for IMAGE when using this option<br class="calibre20"/>&#13;
      #<br class="calibre20"/>&#13;
      # --info, -i<br class="calibre20"/>&#13;
      #    extract the photo information<br class="calibre20"/>&#13;
      #<br class="calibre20"/>&#13;
      # --resize size, -r size<br class="calibre20"/>&#13;
      #    resize a file to a specific dimension<br class="calibre20"/>&#13;
      #<br class="calibre20"/>&#13;
      # --watermark text, -w text<br class="calibre20"/>&#13;
      #    watermark an image with the text supplied<br class="calibre20"/>&#13;
      #<br class="calibre20"/>&#13;
      # IMAGE: The photo you want to manipulate</tt></span>&#13;
    </div>&#13;
&#13;
    <p class="calibre4">The section of code above is in the <a class="calibre17" shape="rect"/>standard RDoc format, so when we go to dust off a script from the shelf and can't remember how to use it, the <code class="calibre19">--help</code> option is always available.</p><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19">require 'getoptlong'<br class="calibre20"/>&#13;
      require 'rdoc/ri/ri_paths'<br class="calibre20"/>&#13;
      require 'rdoc/usage'<br class="calibre20"/>&#13;
      require 'RMagick'<br class="calibre20"/>&#13;
      require 'exifr'<br class="calibre20"/>&#13;
      require 'ftools'<br class="calibre20"/>&#13;
      include EXIFR<br class="calibre20"/>&#13;
      include Magick<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      def bw(file)<br class="calibre20"/>&#13;
          new_img = "bw_#{file}"<br class="calibre20"/>&#13;
          img = Image.read(file).first<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          img = img.quantize(256, GRAYColorspace)<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          if File.exists?(new_img)<br class="calibre20"/>&#13;
              puts "Could not write file, image name already exists."<br class="calibre20"/>&#13;
              exit<br class="calibre20"/>&#13;
          end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          img.write(new_img)<br class="calibre20"/>&#13;
      end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      def gallery()<br class="calibre20"/>&#13;
          <a class="calibre17" shape="rect"/>photos_row = 4<br class="calibre20"/>&#13;
          table_border = 1<br class="calibre20"/>&#13;
          html_rows = 1<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          # Make all the directories<br class="calibre20"/>&#13;
          File.makedirs("gallery/thumbs", "gallery/resize")<br class="calibre20"/>&#13;
          output = File.new("gallery/index.html","w+b")<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          output.puts &lt;&lt;EOF<br class="calibre20"/>&#13;
                  &lt;html&gt;<br class="calibre20"/>&#13;
                      &lt;head&gt;<br class="calibre20"/>&#13;
                          &lt;title&gt;My Photos&lt;/title&gt;<br class="calibre20"/>&#13;
                      &lt;/head&gt;<br class="calibre20"/>&#13;
                      &lt;body bgcolor="#d0d0d0"&gt;<br class="calibre20"/>&#13;
                          &lt;h1&gt;Welcome To My Photo Gallery&lt;/h1&gt;<br class="calibre20"/>&#13;
                          &lt;table border=#{table_border}&gt;<br class="calibre20"/>&#13;
      EOF<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          Dir['*.[Jj][Pp]*[Gg]'].each do |pic|<br class="calibre20"/>&#13;
              # create the thumbnail<br class="calibre20"/>&#13;
              thumb = Image.read(pic)[0]<br class="calibre20"/>&#13;
              thumb.change_geometry!('150x150') do |cols, rows, img|<br class="calibre20"/>&#13;
                  thumb.resize!(cols, rows)<br class="calibre20"/>&#13;
              end<br class="calibre20"/>&#13;
              if File.exists?("gallery/thumbs/th_#{pic}")<br class="calibre20"/>&#13;
                  puts "Could not write file th_#{pic}, thumbnail already exists.<br class="calibre20"/>&#13;
      Renaming to new_th_#{pic}"<br class="calibre20"/>&#13;
                  thumb.write "gallery/thumbs/new_th_#{pic}"<br class="calibre20"/>&#13;
              else<br class="calibre20"/>&#13;
                  # Write them to a separate folder if you wish to get organized...or<br class="calibre20"/>&#13;
                  # you could just sort by filename<br class="calibre20"/>&#13;
                  thumb.write "gallery/thumbs/th_#{pic}"<br class="calibre20"/>&#13;
              end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
              # resize the picture<br class="calibre20"/>&#13;
              resize = Image.read(pic)[0]<br class="calibre20"/>&#13;
              resize.change_geometry!('800x600') do |cols, rows, img|<br class="calibre20"/>&#13;
                  resize.resize!(cols, rows)<br class="calibre20"/>&#13;
              end<br class="calibre20"/>&#13;
              if File.exists?("gallery/resize/resize_#{pic}")<br class="calibre20"/>&#13;
                  puts "Could not write file resize_#{pic}, resized image already<br class="calibre20"/>&#13;
      exists.  Renaming to new_resize_#{pic}"<br class="calibre20"/>&#13;
                  resize.write("gallery/resize/new_resize_#{pic}")<br class="calibre20"/>&#13;
              else<br class="calibre20"/>&#13;
                  resize.write("gallery/resize/resize_#{pic}")<br class="calibre20"/>&#13;
              end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
              if html_rows % <a class="calibre17" shape="rect"/>photos_row == 1<br class="calibre20"/>&#13;
                  output.puts "\n&lt;tr&gt;"<br class="calibre20"/>&#13;
              end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
              output.puts &lt;&lt;EOF<br class="calibre20"/>&#13;
                          &lt;td&gt;&lt;a href="resize/resize_#{pic}/" title="#{pic}"<br class="calibre20"/>&#13;
      target="_blank"&gt;&lt;img src="thumbs/th_#{pic}" alt="#{pic}"/&gt;&lt;/a&gt;&lt;/td&gt;<br class="calibre20"/>&#13;
      EOF<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
              if html_rows % photos_row == 0<br class="calibre20"/>&#13;
                  output.puts "&lt;/tr&gt;"<br class="calibre20"/>&#13;
              end<br class="calibre20"/>&#13;
              html_rows+=1<br class="calibre20"/>&#13;
          end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          unless html_rows % photos_row == 1<br class="calibre20"/>&#13;
              output.puts "&lt;/tr&gt;"<br class="calibre20"/>&#13;
          end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          output.puts "&lt;/body&gt;\n&lt;/html&gt;"<br class="calibre20"/>&#13;
          output.puts "&lt;!-- Courtesy of No Starch Press: Wicked Cool Ruby Scripts --&gt;"<br class="calibre20"/>&#13;
          output.close<br class="calibre20"/>&#13;
      end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      def info(file)<br class="calibre20"/>&#13;
          info = JPEG.new(file)<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          File.open("info_#{File.basename(file)}.txt", "w") do |output|<br class="calibre20"/>&#13;
              output.puts info.exif.to_hash.map{ |k,v| "#{k}:  #{v}"}<br class="calibre20"/>&#13;
          end<br class="calibre20"/>&#13;
      end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      def resize(file, arg)<br class="calibre20"/>&#13;
          size = arg.chomp<br class="calibre20"/>&#13;
          img = Image.read(file).first<br class="calibre20"/>&#13;
          width = nil<br class="calibre20"/>&#13;
          height = nil<br class="calibre20"/>&#13;
          img.change_geometry!("#{size}x#{size}") do |cols, rows, img|<br class="calibre20"/>&#13;
              img.resize!(cols, rows)<br class="calibre20"/>&#13;
              width = cols<br class="calibre20"/>&#13;
              height = rows<br class="calibre20"/>&#13;
          end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          file_name = "#{width}x#{height}_#{file}"<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          if File.exists?(file_name)<br class="calibre20"/>&#13;
              puts "File already exists.  Unable to write file."<br class="calibre20"/>&#13;
              exit<br class="calibre20"/>&#13;
          end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          img.write(file_name)<br class="calibre20"/>&#13;
      end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      def watermark(file, arg)<br class="calibre20"/>&#13;
          text = arg.chomp<br class="calibre20"/>&#13;
          img = Image.read(file).first<br class="calibre20"/>&#13;
          new_img = "wm_#{file}"<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          if File.exists?(new_img)<br class="calibre20"/>&#13;
              puts "Image already exists.  Unable to create file."<br class="calibre20"/>&#13;
              exit<br class="calibre20"/>&#13;
          end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          watermark = Image.new(600, 50)<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          watermark_text = Draw.new<br class="calibre20"/>&#13;
          watermark_text.annotate(watermark, 0,0,0,0, text) do<br class="calibre20"/>&#13;
              watermark_text.gravity = CenterGravity<br class="calibre20"/>&#13;
              self.pointsize = 50<br class="calibre20"/>&#13;
              self.font_family = "Arial"<br class="calibre20"/>&#13;
              self.font_weight = BoldWeight<br class="calibre20"/>&#13;
              self.stroke = "none"<br class="calibre20"/>&#13;
          end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          watermark.rotate!(45)<br class="calibre20"/>&#13;
          watermark = watermark.shade(true, 310, 30)<br class="calibre20"/>&#13;
          img.composite!(watermark, SouthWestGravity, HardLightCompositeOp)<br class="calibre20"/>&#13;
      #Bottom-Left Marking<br class="calibre20"/>&#13;
          watermark.rotate!(-90)<br class="calibre20"/>&#13;
          img.composite!(watermark, NorthWestGravity, HardLightCompositeOp)<br class="calibre20"/>&#13;
      #Top-Left Marking<br class="calibre20"/>&#13;
          watermark.rotate!(90)<br class="calibre20"/>&#13;
          img.composite!(watermark, NorthEastGravity, HardLightCompositeOp)<br class="calibre20"/>&#13;
      #Top-Right Marking<br class="calibre20"/>&#13;
          watermark.rotate!(-90)<br class="calibre20"/>&#13;
          img.composite!(watermark, SouthEastGravity, HardLightCompositeOp)<br class="calibre20"/>&#13;
      #Bottom-Right Marking<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          puts "Writing #{new_img}"<br class="calibre20"/>&#13;
          img.write(new_img)<br class="calibre20"/>&#13;
      end</tt></span>&#13;
    </div>&#13;
&#13;
    <p class="calibre4">This marks the end of the methods that will be called in the <code class="calibre19">case</code> statement below. You can put the "guts" of the script into the <code class="calibre19">case</code> statement, but having methods to call each functionality will keep your code clean and easier to read and maintain.<a class="calibre17" shape="rect"/></p><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19"><img alt="" class="calibre23" src="../Images/00002.jpg"/> opts = GetoptLong.new(<br class="calibre20"/>&#13;
            [ '--help', '-h', GetoptLong::NO_ARGUMENT ],<br class="calibre20"/>&#13;
            [ '--black', '-b', GetoptLong::NO_ARGUMENT ],<br class="calibre20"/>&#13;
            [ '--gallery', '-g', GetoptLong::NO_ARGUMENT ],<br class="calibre20"/>&#13;
            [ '--info', '-i', GetoptLong::NO_ARGUMENT ],<br class="calibre20"/>&#13;
            [ '--resize', '-r', GetoptLong::REQUIRED_ARGUMENT ],<br class="calibre20"/>&#13;
            [ '--watermark', '-w', GetoptLong::REQUIRED_ARGUMENT ]<br class="calibre20"/>&#13;
        )<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
        filename = ARGV[-1].chomp<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
        opts.each do |opt, arg|<br class="calibre20"/>&#13;
            case opt<br class="calibre20"/>&#13;
            when '--help'<br class="calibre20"/>&#13;
                RDoc::usage<br class="calibre20"/>&#13;
            when '--black'<br class="calibre20"/>&#13;
                bw(filename)<br class="calibre20"/>&#13;
            when '--gallery'<br class="calibre20"/>&#13;
                gallery()<br class="calibre20"/>&#13;
            when '--info'<br class="calibre20"/>&#13;
                info(filename)<br class="calibre20"/>&#13;
            when '--resize'<br class="calibre20"/>&#13;
                resize(filename, arg)<br class="calibre20"/>&#13;
            when '--watermark'<br class="calibre20"/>&#13;
                watermark(filename, arg)<br class="calibre20"/>&#13;
            else<br class="calibre20"/>&#13;
                RDoc::usage<br class="calibre20"/>&#13;
            end<br class="calibre20"/>&#13;
        end</tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_420"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos690755"/>Running the Code</span></h2>
    </div>

    <p class="calibre4">To run this script, type:</p><a class="calibre17" shape="rect"/>

    <div class="calibre3">
      <span class="calibre18"><tt class="calibre19"><strong class="calibre22"><code class="calibre19">ruby <a class="calibre17" shape="rect"/>photoUtility.rb [<em class="italic"><code class="calibre19">--help|--bw|--gallery|--info|--resize size</code></em>|--watermark</code></strong><br class="calibre20"/>
      <strong class="calibre22"><code class="calibre19">text] <em class="italic"><code class="calibre19">MyGlamourShot.jpg</code></em></code></strong></tt></span>
    </div>

    <p class="calibre4">(Use any one of the options listed above. I used the <code class="calibre19">--help</code> option to generate the output in the results section.)</p>
  </div>


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_421"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos691882"/>The Results</span></h2>&#13;
    </div><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19">Synopsis<br class="calibre20"/>&#13;
      --------<br class="calibre20"/>&#13;
      photoUtility.rb: manipulate images to resize, watermark, or make a web photo album<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      Usage<br class="calibre20"/>&#13;
      -----<br class="calibre20"/>&#13;
      <a class="calibre17" shape="rect"/>photoUtility.rb [OPTIONS] ... IMAGE<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      -h, --help<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
          show help<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      --bw, -b<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
         convert an image to black and white<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      --gallery, -g<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
         create a web photo album. Enter "temp" for IMAGE when using this option<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      --info, -i<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
         extract the photo information<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      --resize size, -r size<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
         resize a file to a specific dimension<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      --watermark text, -w text<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
         watermark an image with the text supplied<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      IMAGE: The photo you want to manipulate</tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_422"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos693067"/>How It Works</span></h2>&#13;
    </div>&#13;
&#13;
    <p class="calibre4">This script works as the two previous scripts did, but hopefully you noticed the functionality that is incorporated into this script. The code is quite a bit longer than any of the previous scripts because we have used <a class="calibre17" shape="rect"/>GetoptLong to consolidate a lot of useful picture manipulation functions into one wicked cool script. The major difference is in the number of options available to the user. Each option is subsequently put into its own <a class="calibre17" shape="rect"/>when clause. The <code class="calibre19">case</code> statement is a great control statement because it reads nicely and can be more efficient to program and maintain than several <code class="calibre19">if</code>/<code class="calibre19">else</code> statements cumbersomely stacked on each other. The major functions of this script can be found by looking at the arguments section in the <code class="calibre19">opts</code> variable <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00002.jpg"/></span>. Options include a help message, converting an image to black and white, making a photo gallery, extracting the embedded information from the picture, resizing the image, and finally, placing a watermark on the image to protect the digital media. Quite a nice array of image tools at our disposal, all from this script. You'll also note that the scripts from <a class="calibre6" href="../Text/dummy_split_291.html#filepos559796" shape="rect">Chapter 7</a> have been slightly modified for proper execution.</p>&#13;
  </div>&#13;
&#13;
  <div class="mbppagebreak" id="calibre_pb_423"/>&#13;


  <div class="calibre3" id="filepos694809">
    <div class="calibre3 calibre3 calibre3">
      <h1 class="calibre1" id="calibre_pb_424"><span class="calibre2"><a class="calibre7" shape="rect"/>Conclusion</span></h1>
    </div>

    <p class="calibre4">As demonstrated in this chapter, whenever you have scripts that are similar in content, subject, or any other grouping that makes sense to you, consolidating the scripts into a "library" of sorts is a logical step. Instead of keeping up with many different files, you're looking at one. But, I would caution you not to get overzealous in consolidation or else you might catch a case of the "spaghetti-code syndrome," making code maintenance extremely frustrating, if not impossible. Good luck in your exploration of GetoptLong, RDoc, and script consolidation.<a class="calibre17" shape="rect"/></p>
  </div>

  <div class="mbppagebreak" id="calibre_pb_425"/>
</body></html>