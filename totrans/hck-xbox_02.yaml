- en: Chapter 2 -
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第二章 -
- en: Thinking Inside the Box
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在盒子里思考
- en: Reverse engineering can be thought of as a very challenging yet very rewarding
    game. To win, you need a bit of skill and a bit of luck. And like any game, to
    develop your skills you just need to play, play, play.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 反向工程可以被认为是一项极具挑战性但同样非常有益的游戏。要想获胜，你需要一点技巧和一点运气。就像任何游戏一样，为了提高你的技能，你只需要不断练习，不断练习，不断练习。
- en: The first step in building your skills as a hacker is to develop an intuition
    for the material. In the case of hardware, a good way to get a feel for things
    is to take the covers off of everything and try to figure out what all the components
    are, and what they might do. It is also helpful to order a paper catalog from
    a parts vendor such as Digi-Key, Jameco or Newark Electronics and just leaf through
    the pages in your spare time. At first, reading through a parts catalog may feel
    like reading a dictionary, but as you look at more and more circuit boards, you
    will gradually find that everything makes sense.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 作为黑客技能构建的第一步是培养对材料的直觉。在硬件方面，了解事物的一个好方法是取下所有设备的盖子，试图弄清楚所有组件是什么，以及它们可能做什么。从零件供应商如Digi-Key、Jameco或Newark
    Electronics订购纸质目录，并在空闲时间翻阅页面也是有帮助的。起初，阅读零件目录可能感觉就像阅读字典一样，但随着你看越来越多的电路板，你将逐渐发现一切都有意义。
- en: The next most powerful tool of the reverse engineer is pattern matching. All
    hardware engineers are constrained by the same laws of nature, and all hardware
    engineers use the same kinds of building blocks. Engineers also like to modularize
    and reuse existing designs. As a result, a single design motif can be found in
    many designs. Recognizing design motifs will enable you to determine the function
    of circuits even if you do not recognize a single part number. Likewise, one can
    go quite far in reverse engineering without any formal electrical engineering
    training.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 反向工程师的下一个最有力的工具是模式匹配。所有硬件工程师都受到相同自然法则的约束，所有硬件工程师都使用相同类型的构建模块。工程师们还喜欢模块化和重用现有设计。因此，单个设计模式可以在许多设计中找到。识别设计模式将使你能够在不识别单个零件编号的情况下确定电路的功能。同样，即使没有正式的电气工程培训，也可以在反向工程中走得很远。
- en: The final tool of the reverse engineer is experimentation. When intuition and
    pattern matching fail to reveal the secrets of a circuit, one must resort to probing
    and perturbing the system and trying to deduce function based on the observed
    responses. While experimentation may lead to hardware failure, one can take solace
    in the fact that most consumer hardware is designed to be probed and tested as
    a requirement for manufacturing. Furthermore, in the case of the Xbox, one can
    take some comfort in the fact that a new Xbox is relatively inexpensive. Buying
    two boxes up front and treating one as the “sacrificial” box helps remove the
    psychologicalbarrier one might otherwise have about performing aggressive experiments
    on the hardware.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 反向工程师的最终工具是实验。当直觉和模式匹配无法揭示电路的秘密时，就必须求助于探测和扰动系统，并试图根据观察到的响应推断功能。虽然实验可能会导致硬件损坏，但可以安慰自己，大多数消费级硬件在设计时都是为了满足制造要求而可以进行探测和测试的。此外，在Xbox的情况下，可以稍微安慰自己，因为新的Xbox相对便宜。提前购买两个盒子，将其中一个作为“牺牲品”使用，有助于消除可能对在硬件上进行激进实验的心理障碍。
- en: This chapter will introduce you to the basics of reverse engineering, with a
    focus on basic techniques, such as reading circuit boards to build an intuition,
    and some coverage of intermediate techniques such as pattern matching and recognizing
    basic design motifs.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将向您介绍反向工程的基础知识，重点关注基本技术，如通过阅读电路板来培养直觉，以及一些关于模式匹配和识别基本设计模式等中级技术的介绍。
- en: Reading a Circuit Board
  id: totrans-7
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 阅读电路板
- en: The first thing you see when you take the cover off of a typical electronic
    device is the circuit board. Typically colored green or tan, this multilayer sandwich
    of copper, glass fiber and epoxy contains an exact schematic netlist within its
    traces. In other words, by following the traces, one can determine exactly how
    every component is connected. The placement of components and the layout of the
    traces also contains clues that can bring insight into the designer’s thought
    process.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 当你取下典型电子设备的盖子时，首先看到的是电路板。通常呈绿色或棕色，这种多层铜、玻璃纤维和环氧树脂三明治包含在其走线中的精确原理图网络表。换句话说，通过跟随走线，可以确定每个组件是如何连接的。组件的放置和走线的布局也包含可以揭示设计师思维过程的线索。
- en: Circuit Board Basics
  id: totrans-9
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 电路板基础知识
- en: A typical circuit board consists of a few layers of patterned copper separated
    by thin sheets of fiberglass impregnated with epoxy. The color of a raw circuit
    board is whitish or tan with copper traces; however, almost all circuit boards
    are coated with a thin polymer called the *soldermask*that gives circuit boards
    their familiar green color. Molten solder does not adhere to the soldermask, so
    during production excess solder does not stick to the board and cause shorts.
    The soldermask has openings for connections to components. These openings typically
    have a silvery color from a thin plating of tin or solder that is applied to prevent
    the copper from oxidizing and to enhance solderability.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 一个典型的电路板由几层图案化的铜层组成，这些铜层被涂有环氧树脂的薄层玻璃纤维隔开。原始电路板的颜色是白色或浅棕色，带有铜迹；然而，几乎所有电路板都被涂上一层薄薄的聚合物，称为*阻焊层*，这使电路板呈现出熟悉的绿色。熔融的焊料不会粘附在阻焊层上，因此在生产过程中，多余的焊料不会粘附在板上造成短路。阻焊层有供组件连接的开口。这些开口通常呈现出银色，这是因为涂有薄层锡或焊料的镀层，这可以防止铜氧化并增强可焊性。
- en: On top of the soldermask is typically a layer of white lettering referred to
    as the *silkscreen*. Each component on a circuit board has an outline and a unique
    designator on the silkscreen layer. The designator enables people to quickly associate
    a component on a circuit board with a component on a schematic. You can use the
    designator to help guess the function of acomponent based on the component naming
    scheme. Table 2-1 summarizes the component naming scheme used in the Xbox.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在阻焊层之上通常有一层白色字母，被称为*丝网印刷层*。电路板上的每个组件在丝网印刷层上都有一个轮廓和唯一的标识符。这个标识符使得人们能够快速地将电路板上的组件与原理图上的组件关联起来。你可以使用这个标识符来帮助根据组件命名方案猜测组件的功能。表2-1总结了Xbox中使用的组件命名方案。
- en: Tip
  id: totrans-12
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 小贴士
- en: '![](../Images/index-51_1.png)The Xbox motherboard includes a handy coordinate
    system printed along the edges of the board in the silkscreen layer. On the component
    side of the board, the coordinates go from A through G on the sides, and from
    1 through 8 along the top and bottom. The reverse side of the board has coordinates
    M through V along the sides. Note that theletters I, O, Q, and S are skipped because
    they can be confused with the numbers 0, 1, and 5\. Component designators on the
    Xbox motherboard are encoded using this coordinate system; thus, J7D1, the LPC
    debug port, can be found on the top side at coordinates 7D. This book will frequently
    use this coordinate system along with the component designators to refer to specific
    components.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: '![Xbox主板](../Images/index-51_1.png)Xbox主板在丝网印刷层沿边缘印有一个方便的坐标系。在组件面，坐标从A到G沿侧面，从1到8沿顶部和底部。板的反面沿侧面有M到V的坐标。请注意，字母I、O、Q和S被跳过，因为它们可能与数字0、1和5混淆。Xbox主板上的组件标识符使用这个坐标系进行编码；因此，J7D1，即LPC调试端口，可以在顶部坐标7D处找到。这本书将经常使用这个坐标系以及组件标识符来指代特定的组件。'
- en: Connections between wiring layers are made by copper-filled holes called *vias*.
    Since the cost of a circuit board grows with the number of layers, most consumer
    electronic devices are designed to keep the number of layers to a minimum. Radio
    receivers and audio amplifiers will typically use single-sided boards, whereas
    the latest PC motherboards might have up to six oreight layers. The Xbox motherboard
    has four layers. The top two layers are dedicated to carrying information between
    chips, and the inner two layers are dedicated to delivering power. The Xbox motherboard
    will appear opaque at first glance because the inner power layers are basically
    solid sheets of copper. The good news for reverse engineering is that we can trace
    every connection on the Xbox motherboard through casual visual inspection because
    all of the signals layers are outside of the opaque power layers. The Xbox design
    contrasts with motherboards that bury two or four signal layers inside of the
    power layers. Buried signal layers can make signal tracing difficult. (Note that
    the decision to bury signals inside powerlayers is typically not driven by security,
    but rather by the physics of how electrical signals interact between circuit board
    layers.)
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 通过称为*过孔*的铜填充孔连接布线层。由于电路板的成本随着层数的增加而增长，大多数消费电子产品都设计成将层数保持在最低。收音机和音频放大器通常使用单面板，而最新的PC主板可能有六层或八层。Xbox主板有四层。最上面的两层专门用于在芯片之间传输信息，而内层的两层专门用于供电。Xbox主板乍一看会显得不透明，因为内层的供电层基本上是铜的实心板。对于逆向工程来说，好消息是我们可以通过简单的视觉检查追踪Xbox主板上的每个连接，因为所有信号层都在不透明的供电层之外。Xbox的设计与将两个或四个信号层埋在供电层内的主板形成对比。埋藏的信号层可能会使信号追踪变得困难。（请注意，将信号埋在供电层内的决定通常不是由安全性驱动的，而是由电信号如何在电路板层之间交互的物理特性决定的。）
- en: '| Designator | Component Type |'
  id: totrans-15
  prefs: []
  type: TYPE_TB
  zh: '| 设计符 | 组件类型 |'
- en: '| --- | --- |'
  id: totrans-16
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| C | Capacitor |'
  id: totrans-17
  prefs: []
  type: TYPE_TB
  zh: '| C | 电容 |'
- en: '| R | Resistor |'
  id: totrans-18
  prefs: []
  type: TYPE_TB
  zh: '| R | 电阻 |'
- en: '| U | Integrated Circuit or Transistor |'
  id: totrans-19
  prefs: []
  type: TYPE_TB
  zh: '| U | 集成电路或晶体管 |'
- en: '| L | Inductor |'
  id: totrans-20
  prefs: []
  type: TYPE_TB
  zh: '| L | 电感器 |'
- en: '| RP | Resistor Pack |'
  id: totrans-21
  prefs: []
  type: TYPE_TB
  zh: '| RP | 电阻器组 |'
- en: '| Q | Transistor |'
  id: totrans-22
  prefs: []
  type: TYPE_TB
  zh: '| Q | 晶体管 |'
- en: '| CR | Diode |'
  id: totrans-23
  prefs: []
  type: TYPE_TB
  zh: '| CR | 二极管 |'
- en: '| J | Connector or Jumper |'
  id: totrans-24
  prefs: []
  type: TYPE_TB
  zh: '| J | 连接器或跳线 |'
- en: '| RT | Resettable Fuse |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
  zh: '| RT | 可重置保险丝 |'
- en: '| Y | Crystal |'
  id: totrans-26
  prefs: []
  type: TYPE_TB
  zh: '| Y | 晶体 |'
- en: '**Table 2-1**: The Xbox component naming scheme.'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '**表2-1**：Xbox组件命名方案。'
- en: It’s fairly easy to trace a signal. Starting from the connection of the source
    component to the board, follow the copper trace. If the trace intersects with
    a circle, then there is a good chance that the signal continues on the opposite
    side of the board. If a trace ends and there is no connection to the other side
    of the board, there is a good chance that the trace is connected to one of the
    power planes.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 跟踪信号相当容易。从源组件与板子的连接开始，跟随铜迹。如果轨迹与一个圆相交，那么信号很可能在板的另一侧继续。如果一个轨迹结束且没有连接到板的另一侧，那么轨迹很可能连接到其中一个电源平面。
- en: '![](../Images/index-52_2.png)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/index-52_2.png)'
- en: '**Figure 2-1**: Cross-section of a typical circuit board.'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '**图2-1**：典型电路板的横截面。'
- en: Try it
  id: totrans-31
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 尝试一下
- en: '![](../Images/tools.png)'
  id: totrans-32
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/tools.png)'
- en: Try tracing some signals on the Xbox motherboard. On the Xbox motherboard, take
    a look at connector J8C1, the 40- pin IDE connector in sector 8C. Almost all of
    the signals from the IDE connector go to one chip, the MCPX, on the motherboard
    by way of some resistor packs. What might you be able to conclude about that chip?
    Notice how some of the traces coming from the IDE connector mean der back and
    forth. This is a technique used to try and ensure that all wires have the same
    length. See the sidebar on “Why do Circuit Board Traces Meander Everywhere?” for
    more explanation.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 尝试在Xbox主板上追踪一些信号。在Xbox主板上，看看连接器J8C1，位于8C区域的40针IDE连接器。IDE连接器几乎所有的信号都通过一些电阻器组连接到主板上的一个芯片MCPX。你能对那个芯片得出什么结论？注意，从IDE连接器出来的某些轨迹意味着来回移动。这是一种尝试确保所有电线长度相同的技巧。参见“为什么电路板轨迹到处都是蜿蜒曲折？”的侧边栏以获取更多解释。
- en: Components
  id: totrans-34
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 组件
- en: Now that you have a little bit of experience tracing back a signal, it is time
    to learn what some basic components look like. Components are classified as passive
    and active. Loosely speaking, passive components cannot amplify a signal, so they
    usually have just two leads. Sometimes multiple passive components are packaged
    together, so a single package of passive components will have multiple leads.
    Passive components include capacitors, resistors and inductors. The most common
    passive components on the Xbox motherboard are capacitors. Capacitors store energy
    as an electric charge; in the Xbox, they are primarily used to smooth out local
    power fluctuations from CMOS digital logic switching, and to suppress high frequency
    noise.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经有点经验追踪信号了，是时候学习一些基本元件的外观了。元件被分类为无源和有源。粗略地说，无源元件不能放大信号，所以它们通常只有两个引脚。有时多个无源元件会被封装在一起，所以一个无源元件的封装将会有多个引脚。无源元件包括电容器、电阻和电感。Xbox主板上的最常见无源元件是电容器。电容器以电荷的形式储存能量；在Xbox中，它们主要用于平滑CMOS数字逻辑开关产生的局部电源波动，并抑制高频噪声。
- en: '![](../Images/index-53_1.png)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/index-53_1.png)'
- en: '**Figure 2-2**: Typical passive components in an Xbox.'
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '**图2-2**：Xbox中的典型无源元件。'
- en: Why Do Circuit Board Traces Meander Everywhere?
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 为什么电路板上的走线到处蜿蜒？
- en: After looking at a few circuit boards, you will probably start noticing that
    the traces on the circuit board often times meander all over the place, sometimes
    going back andforth several times before connecting to their destination. This
    seems pointless when a straight trace would do the trick. However, rarely will
    you find a structure on a circuitboard that was placed as a flighty whim by the
    designer. It turns out that the speed of signals in most high-end electronic devices,
    about ¼ the speed of light, is slow compared to the time required for a signal
    to arrive at its destination. For example, a signal will only travel 3 inches
    on a circuit board during one clock cycle in a 1 GHz processor (one clock tick
    at 1 GHz is a duration of 1 billionth of a second, or one nanosecond). Thus, two
    signals starting from the same chip will arrive at their destination at quite
    different times if the trace lengths are very different. To combat this, designers
    will put extra bends into the shorter trace so that the effective length of the
    trace is the same as the longer one.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 在查看了几块电路板之后，你可能会开始注意到电路板上的走线往往四处蜿蜒，有时在连接到目的地之前来回几次。当一条直线走线就能解决问题时，这似乎是多余的。然而，你很少会在电路板上找到一个由设计师随意放置的结构。实际上，大多数高端电子设备中信号的传播速度，大约是光速的四分之一，与信号到达目的地的所需时间相比是慢的。例如，在一个1
    GHz处理器（1 GHz的每个时钟周期是一个十亿分之一秒的持续时间，即一纳秒）的一个时钟周期内，信号在电路板上只能传播3英寸。因此，如果走线长度差异很大，从同一芯片出发的两个信号将到达目的地的时间会有很大差异。为了解决这个问题，设计者会在较短的走线上添加额外的弯曲，使得走线的有效长度与较长的走线相同。
- en: Other large passive components found on the Xbox motherboard include inductors
    and resistors. The large wire-wound *toroidal* (donut-shaped) inductors found
    on the Xbox motherboard are all part of the power supply subsystem. Inductors
    store energy as magnetic flux. An inductor’s electrical properties are complementary
    to that of a capacitor. Combinations of inductors and capacitors with transistor
    switches in between are used to build very efficient power regulators. Most of
    the resistors on the Xbox motherboard are used either to absorb excess energy
    at the termination of signal traces, or to bias a wire to a particular logic level.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 在Xbox主板上发现的其它大型无源元件包括电感和电阻。Xbox主板上发现的粗线绕制的*环形*（甜甜圈形状）电感都是电源子系统的组成部分。电感以磁通的形式储存能量。电感的电气特性与电容互补。在电感与电容之间加入晶体管开关的组合被用来构建非常高效的电源调节器。Xbox主板上的大多数电阻要么用于吸收信号轨迹终端的过剩能量，要么用于将电线偏置到特定的逻辑电平。
- en: There are two ways you can identify a passive device on the Xbox motherboard.
    The first is by the shape of the package. Package shape recognition is feasible
    because there are so few basic varieties of passive parts. Figure 2-2 has some
    pictures of the capacitors, inductors, andresistors that you might see on an Xbox
    motherboard. The second method is to read the label next to the part on the motherboard
    and to infer the part’s function by the reference designator, using Table 2-1
    as a guide.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过两种方式在Xbox主板上识别被动组件。第一种是通过封装的形状。由于被动元件的基本种类很少，因此封装形状识别是可行的。图2-2展示了你可能在Xbox主板上看到的电容器、电感器和电阻器的图片。第二种方法是读取主板旁边组件的标签，并通过参考设计符推断组件的功能，以表2-1作为指南。
- en: Active components can amplify signals, and have three or more leads. The simplest
    active component is a transistor, with three and occasionally four leads (sometimes
    discrete “MOSFET” transistors have an explicit fourth “body” terminal). The most
    complicated active components are integrated circuits, such as CPU and memory
    chips, with hundreds, sometimes thousands, of leads. Integrated circuits come
    in a wide variety of packages, and sometimes the connections are hidden underneath
    the package, as is the case in the Ball Grid Array (BGA) package. The graphics
    chip, MCPX, and CPU on the Xbox motherboard use BGApackages. Figure 2-3 shows
    a cross section of a BGA device, revealing the hidden connections underneath.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 活性组件可以放大信号，并且有三个或更多引脚。最简单的活性组件是晶体管，有三个偶尔四个引脚（有时离散的“MOSFET”晶体管有一个明确的第四个“体”端子）。最复杂的活性组件是集成电路，如CPU和内存芯片，有数百甚至数千个引脚。集成电路有多种封装形式，有时连接隐藏在封装下面，就像球栅阵列（BGA）封装那样。Xbox主板上的图形芯片MCPX和CPU使用BGA封装。图2-3显示了BGA器件的横截面，揭示了下面的隐藏连接。
- en: '![](../Images/index-54_1.png)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/index-54_1.png)'
- en: '**Figure 2-3**: Cross sectional view of a BGA packaged part (GeForce2) mounted
    on a motherboard.'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: '**图2-3**：BGA封装部件（GeForce2）在主板上的横截面视图。'
- en: '**What Are All These Resistors and** **Capacitors Doing on a Digital** **Circuit
    Board?**'
  id: totrans-45
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '**这些电阻器和电容器在数字电路板上都起什么作用**？'
- en: A motif you will notice on many circuit boards is a preponderance of resistors
    and capacitors. Capacitors are everywhere because they help keep noise to a minimum
    andstabilize the power supply voltages. They are required because the copper planes
    used to distribute power have a small amount of resistance and inductance. These
    smallparasitics can cause big problems when a large amount of current is switched
    through the power supply. The exact placement and selection of capacitors is considered
    a bit of a black art. If you happen to knock off one of the tiny, sand-grain sized
    capacitors on a circuit board while working on it, chances are that you’ll be
    able to get away without replacing it. However, given a defect of this kind, the
    most likely problem you will encounter are intermittent reliability problems.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 你会在许多电路板上注意到的一个主题是电阻器和电容器的数量很多。电容器无处不在，因为它们有助于将噪声降至最低并稳定电源电压。它们是必需的，因为用于分配电源的铜平面有少量电阻和电感。当大量电流通过电源时，这些小的寄生参数可能会引起大问题。电容器的精确放置和选择被认为是一种有点像黑艺术的技巧。如果你在操作电路板时不小心碰掉了其中一个微小的、沙粒大小的电容器，你可能会设法不更换它就能解决问题。然而，考虑到这种类型的缺陷，你最可能遇到的问题是间歇性的可靠性问题。
- en: While capacitors are everywhere to provide local storage of energy for all the
    components, the resistors remove excess energy. Fast signals on a motherboard
    carry a lot of energy, and if the energy is not dissipated at the receiver in
    a controlled fashion with a resistor, the signal energy will reflect back to the
    transmitter and cause problems. The phenomenon is similar to that of sound in
    a gymnasium. When you speak in an empty gymnasium, there is an echo. If you speak
    too fast, people will be unable to understand you because the echo will start
    interfering with your speech. However, if you cover the gymnasium walls with foam,
    the echo will be absorbed by the foam and you can talk without interference from
    your echo.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然电容器无处不在，为所有组件提供局部能量存储，但电阻器则移除多余的能量。主板上的快速信号携带大量能量，如果能量没有被电阻器以受控的方式在接收端消耗，信号能量将反射回发射端并引起问题。这种现象与体育馆中的声音类似。当你在一个空荡荡的体育馆里说话时，会有回声。如果你说话太快，人们将无法理解你，因为回声会开始干扰你的说话。然而，如果你用泡沫覆盖体育馆的墙壁，回声将被泡沫吸收，你可以不受回声干扰地说话。
- en: Resistors are like the acoustic foam you would put on walls to damp out echoes,
    so that circuits can talk to each other at high speeds. Unlike most capacitors,
    if you happen toknock off one of these resistors while playing around, you will
    have to replace it in order for the circuit to work properly. These “termination
    resistors” are often packaged four oreight to a package, so they almost look like
    small integrated circuits. You can distinguish resistor packs from other components
    because they are shiny, slightly lumpy, have a white border, and they will have
    a reference designator prefix of “RP” near them. When tracing a signal through
    a resistor pack, it is fairly safe to assume that signals flow straight through,
    so that a connection on one side goes straight through to the pin immediately
    on the other side.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 电阻就像您会放在墙上以吸收回声的吸音泡沫，这样电路就可以以高速相互通信。与大多数电容器不同，如果您在玩耍时不小心敲掉这些电阻之一，您将不得不更换它才能使电路正常工作。这些“终止电阻”通常封装在四个或八个一包，所以它们看起来几乎像小型集成电路。您可以通过它们的光滑、略微凸起、白色边框以及它们附近有“RP”参考设计符前缀来区分电阻组件。在追踪通过电阻组件的信号时，可以相当安全地假设信号是直线流动的，因此一侧的连接会直接穿过到另一侧的引脚。
- en: Identifying the function of a particular integrated circuit is more challenging
    than identifying the function of a passive device. Functionally identical silicon
    can be purchased in a variety of packages that can look very different. In some
    cases, you can guess the function of a device by observing what the device is
    connected to or what it looks like, but the most reliable method is to read the
    part number off the chip and look it up on the web. (Typically, parts have some
    kind of logo or part number prefix that identifies the manufacturer, which you
    can use to find more data on the device by visiting the manufacturer’s website.)
    If you do not recognize the logo or the part number prefix, the services listed
    below can help you look up part functions.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 识别特定集成电路的功能比识别无源器件的功能更具挑战性。功能相同的硅可以购买成各种包装，外观可能非常不同。在某些情况下，您可以通过观察设备连接到什么或其外观来猜测设备的功能，但最可靠的方法是从芯片上读取部件编号并在网上查找。（通常，部件会有某种标志或部件编号前缀来标识制造商，您可以通过访问制造商的网站来找到更多关于该设备的数据。）如果您不认识标志或部件编号前缀，以下列出的服务可以帮助您查找部件功能。
- en: 1\. www.findchips.com can take a part number or pieces of a part number and
    search the inventories of many distributors for inventory matches. Most common
    parts will show up inFindChips, and the links provided will often lead you not
    only to a short description of the part, but also pricing and ordering information.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 1. www.findchips.com可以接受部件编号或部件编号的一部分，并搜索多个分销商的库存以找到匹配项。大多数常见部件都会在FindChips上显示，提供的链接通常会不仅包含部件的简短描述，还包括定价和订购信息。
- en: 2\. www.google.com indexes everything on the web, and part numbers are no exception.
    Google can also be used to help find manufacturer’s websites if you query on the
    letters in the logo plus a descriptive term such as “semiconductors.” At the manufacturer’s
    website, you will probably need to find the specialized part search engine buried
    in the website or go to the semiconductor products sub-page in order to do a part
    number lookup. The search function on the front page of a company’s website will
    sometimes find part numbers, but more often it indexes only useless corporate
    and marketing pages.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 2. www.google.com索引了网络上的所有内容，部件编号也不例外。如果您在标志字母加上描述性术语（如“半导体”）进行查询，Google还可以帮助您找到制造商的网站。在制造商的网站上，您可能需要找到隐藏在网站中的专用部件搜索引擎，或者访问半导体产品子页面来进行部件编号查找。公司网站首页上的搜索功能有时可以找到部件编号，但更常见的是它只索引无用的公司营销页面。
- en: 3\. If neither of these services gets you there, try stripping off some of the
    prefixes and suffixes on the part number. In our M29F080A example, querying just
    the part number 29F080 willbring you to the webpages of multiple manufacturers
    who make parts that are functionally compatible with the STMicroelectronics part.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 3. 如果上述服务都无法帮您找到所需部件，尝试去掉部件编号中的一些前缀和后缀。以我们的M29F080A为例，仅查询部件编号29F080，就能将您带到多个制造商的网页上，这些制造商生产的部件在功能上与意法半导体（STMicroelectronics）的部件兼容。
- en: '![figure_2-4](../Images/figure_2-4.png)'
  id: totrans-53
  prefs: []
  type: TYPE_IMG
  zh: '![figure_2-4](../Images/figure_2-4.png)'
- en: '**Figure 2-4**: Anatomy of a typical IC part number. The diagram is a cartoon
    of the chip at location U7D1 on the Xbox motherboard.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '**图2-4**：典型IC部件编号的解剖图。该图是Xbox主板U7D1位置芯片的卡通图。'
- en: Try It
  id: totrans-55
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 尝试一下
- en: '![](../Images/index-57_1.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![Xbox架构图](../Images/index-57_1.png)'
- en: '**Let’s try looking up an Xbox part number. Locate U7D1 on** **the Xbox motherboard.
    Figure 2-4 illustrates what you might** **find. The part number is typically the
    longest number on** **the chip, and it often starts with one or two alphabetic**
    **characters. Memory chips and processors also frequently** **have a speed grade
    or quality suffix after the part number.** **Additionally, almost all chips have
    a*date code*****. Date codes** **are usually a four digit number of the format
    YY-WW, where** **YY is the year the chip was manufactured, and WW is the** **workweek.
    In our example, our M29F080A part was manu****factured in the 41st week of 2001
    in Singapore, and it has a** **speed grade of 70N1\. The remaining number, 5881K,
    is a** **lot code whose meaning varies between manufacturers, but** **in general
    links a chip to a particular silicon wafer or sili****con wafer lot’s tracking
    number in the fabrication facility.**'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: '**让我们尝试查找一个Xbox部件编号。定位Xbox主板上的U7D1。图2-4展示了你可能会找到的内容。部件编号通常是芯片上最长的数字，通常以一到两个字母开头。内存芯片和处理器在部件编号后也经常有一个速度等级或质量后缀。此外，几乎所有芯片都有一个*日期代码*。日期代码**
    **通常是格式为YY-WW的四位数字，其中YY是芯片制造的年份，WW是工作周。在我们的例子中，我们的M29F080A部件是在2001年的第41周在新加坡制造的，并且有一个**
    **速度等级为70N1。剩余的数字5881K是一个** **批号，其含义因制造商而异，但通常将芯片与特定的硅晶圆或硅晶圆批次的跟踪号在制造设施中联系起来。**'
- en: '**The “ST” logo indicates the manufacturer of this chip is** **STMicroelectronics,
    and fortunately the website for this** **manufacturer can be quickly found through
    Google or by****guessing, as the URL for the company is simply** www.st.com**.**
    **Entering the part number M29F080A into the search field on** **the home page
    brings you directly to search results that** **include detailed datasheets and
    descriptions of this part** **— an 8 Mbit Uniform Block Single Supply FLASH ROM.**'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '**“ST”标志表示该芯片的制造商是** **STMicroelectronics**，幸运的是，通过Google搜索或猜测，可以快速找到该** **制造商的网站，因为公司的网址很简单**
    www.st.com**。** **将部件编号M29F080A输入主页上的搜索字段，可以直接进入包含该部件详细数据表和描述的搜索结果** **——这是一个8兆位的统一块单电源FLASH
    ROM。**'
- en: Test Points
  id: totrans-59
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 测试点
- en: Almost all circuit boards in consumer electronics feature structures designed
    to expedite the testing of the finished board in the factory. These “test points”
    exist to cope with the unfortunate reality of manufacturing defects. The Xbox
    is no exception when it comes to test points and manufacturing defects. The bottom
    of the Xbox motherboard is populated with hundreds of test points — tiny silvery
    circles — that allow a contact probe to access almost every interesting signal
    within the Xbox. These test points are a welcome gift to reverse engineers and
    to people who wish to modify their hardware, because they provide easy access
    to signals that might otherwise require a microscope and a steady hand.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 几乎所有消费电子产品的电路板都设计了结构，以加快在工厂中对成品板进行测试。这些“测试点”存在是为了应对制造缺陷的遗憾现实。Xbox在测试点和制造缺陷方面也不例外。Xbox主板的底部布满了数百个测试点——微小的银色圆圈——允许接触探头访问Xbox中几乎每一个有趣的信号。这些测试点对逆向工程师和希望修改硬件的人来说是一份受欢迎的礼物，因为它们提供了对可能需要显微镜和稳定手部操作的信号的轻松访问。
- en: A set of test points are probed all at once on the manufacturing line with a
    piece of equipment called a “bed of nails tester.” Aptly named, the bed of nails
    tester consists of hundreds of spring-loaded “pogo pin” structures. A motherboard
    is aligned to the testbed and clamped down with either mechanical plungers or
    a vacuum chuck. Similarly, you can use pogo-pins to make your own solderless modifications
    to an Xbox motherboard by leveraging the test points. You wil need to build your
    own circuit boards (see Appendix), but the result will be a board that you can
    install simply by screwing it down — *no soldering required!*
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 在制造线上，使用一种称为“钉床测试器”的设备一次性对所有测试点进行探测。这个名字很贴切，钉床测试器由数百个弹簧加载的“跳针”结构组成。将主板对准测试台并用机械冲头或真空夹具夹紧。同样，你可以利用测试点通过跳针对Xbox主板进行无焊点修改。你需要自己制作电路板（见附录），但结果将是一个只需拧紧螺丝即可安装的板子——*无需焊接！*
- en: Xbox Architecture
  id: totrans-62
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Xbox架构
- en: Before diving into the pattern matching examples, we will need a pattern reference.
    Let’s take this opportunity to study the Xbox internal architecture as the pattern
    reference, and eventually compare the Xbox architecture to a PC and to another
    video game console.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 在深入研究模式匹配示例之前，我们需要一个模式参考。让我们利用这个机会研究Xbox内部架构作为模式参考，并最终将Xbox架构与PC和另一款游戏机进行比较。
- en: High-Level Organization
  id: totrans-64
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 高级组织
- en: The Xbox has a Pentium-III class processor running at 733 MHz as its CPU. The
    “S-Spec” number on the CPU is closest to that of a Mobile Celeron. The CPU is
    connected via a standard P6 133 MHz Front Side Bus (FSB) to a graphics processing
    unit (GPU) and a northbridge combo chip called the NV2A by nVidia. Its closest
    PC relative is the nForce IGPchip by nVidia. Since the northbridge logic and the
    GPU are combined in a single chip, the CPU and graphics processors can share a
    common bank of memory. This is cal ed a “unified memory architecture” (UMA). Compared
    to a traditional split video/main memory architecture, a UMA costs less to build
    because it eliminates the dedicated video memory. However, UMA has lower performance
    in certain situations because it introduces memory access contention between the
    main processor and the graphics processor. In order to alleviate some of thiscontention,
    the system memory is frequently split into multiple banks. The nForce IGP, for
    example, splits the memory into two banks that can be independently accessed by
    both the GPU and the CPU through a switching network.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: Xbox的CPU是一款运行在733 MHz的Pentium-III级处理器。CPU上的“S-Spec”数字与移动赛扬的数字最为接近。CPU通过标准的P6
    133 MHz前端总线（FSB）连接到一个图形处理单元（GPU）和一个由nVidia称为NV2A的北桥组合芯片。它在PC上的最接近的相对者是nVidia的nForce
    IGP芯片。由于北桥逻辑和GPU集成在单个芯片中，CPU和图形处理器可以共享一个共同的内存池。这被称为“统一内存架构”（UMA）。与传统分割视频/主内存架构相比，UMA在构建成本上更低，因为它消除了专用的视频内存。然而，UMA在某些情况下性能较低，因为它在主处理器和图形处理器之间引入了内存访问竞争。为了缓解一些这种竞争，系统内存经常被分成多个银行。例如，nForce
    IGP将内存分成两个银行，这两个银行可以通过交换网络独立地由GPU和CPU访问。
- en: '![](../Images/index-58_1.png)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/index-58_1.png)'
- en: '**Figure 2-5**: High level architectural view of the Xbox.'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: '**图2-5**：Xbox的高级架构视图。'
- en: '![](../Images/index-59_1.png)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/index-59_1.png)'
- en: '**Figure 2-6**: Photograph of an Xbox motherboard with the major components
    labelled.'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: '**图2-6**：带有主要组件标签的Xbox主板的照片。'
- en: The GPU is connected to a kitchen-sink chip called the “MCPX” via a fast, narrow
    bus called a HyperTransport bus. The MCPX combines a southbridge chip plus almost
    all of the Xbox peripherals, including USB controllers, a legacy boot ROM interface,
    a Dolby digital audio processor, a mass storage IDE controller, an ethernet control
    er, and interfaces to system management functions.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: GPU通过一个称为HyperTransport的高速、窄总线连接到一个名为“MCPX”的厨房水槽芯片。MCPX集成了南桥芯片以及几乎所有Xbox的外设，包括USB控制器、传统的引导ROM接口、杜比数字音频处理器、IDE控制器、以太网控制器以及系统管理功能的接口。
- en: The connectivity of all the major blocks in an Xbox are illustrated in Figure
    2-5, and Figure 2-6 illustrates the location of these blocks on an actual Xbox
    motherboard.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: Xbox中所有主要模块的连接性如图2-5所示，图2-6展示了这些模块在实际Xbox主板上的位置。
- en: Functional Details
  id: totrans-72
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 功能细节
- en: The following sections present a cursory overview of the pieces that constitute
    the Xbox architecture. We pay particular attention to the details necessary for
    understanding how to reverse engineer the Xbox security mechanisms.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 以下章节简要概述了构成Xbox架构的各个部分。我们特别关注理解如何逆向工程Xbox安全机制所需的细节。
- en: CPU
  id: totrans-74
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: CPU
- en: The CPU (Central Processing Unit) is the computational heart of a conventional
    computer. The subject of CPU architecture deserves an entire book alone, so we
    will cover just the material required to understand how to reverse engineer the
    Xbox. In particular, we will investigate how to gain control of the Xbox CPU.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: CPU（中央处理单元）是传统计算机的计算核心。CPU架构是一个值得单独成书的话题，因此我们只涵盖理解如何逆向工程Xbox所需的内容。特别是，我们将探讨如何控制Xbox
    CPU。
- en: A CPU reads sequences of instructions stored in memory — programs — that tell
    the CPU to perform various computations or to make decisions based on available
    data. The instructions are stored in memory as numbers called *opcodes*. Opcodes
    take *operands* as arguments. Programmers use alphabetic mnemonics when writing
    low-level machine code so that they don’t have to remember hundreds of opcode
    numbers. For example, a kind of byte-wide subtraction instruction has the opcode
    0010.1000 (binary) or 0x28 (hexadecimal) and the mnemonic “SUB”. The requisite
    subtraction opcode varies depending upon the source andwidth of the subtraction
    data. Keeping track of all of the opcode to operand rules is overwhelming, so
    the process of translating mnemonics and operands to instruction numbers is accomplished
    with a program called an *assembler*. Likewise, the process of translating instruction
    numbers back into mnemonics is done with a disassembler. Significantly, most programs
    are not written in assembly language; a higher-level language, such as C, is typically
    employed. These high-level languages are translated into machine instructions
    using compilers. Automatic decompilation of machine instructions back into a high-level
    languagecan be difficult because the process of compilation — especially optimized
    compilation — discards much of the high-level structural information contained
    in the original source code.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: CPU读取存储在内存中的指令序列——程序——这些指令告诉CPU执行各种计算或基于可用数据进行决策。指令以称为*操作码*的数字形式存储在内存中。操作码以*操作数*作为参数。程序员在编写低级机器代码时使用字母表中的助记符，这样他们就不必记住数百个操作码数字。例如，一种字宽减法指令的操作码为0010.1000（二进制）或0x28（十六进制），助记符为“SUB”。所需的减法操作码取决于减数数据的源和宽度。跟踪所有操作码到操作数的规则是令人压倒性的，因此将助记符和操作数转换为指令编号的过程是通过一个称为*汇编器*的程序来完成的。同样，将指令编号转换回助记符的过程是通过反汇编器来完成的。值得注意的是，大多数程序不是用汇编语言编写的；通常使用高级语言，如C。这些高级语言使用编译器转换为机器指令。将机器指令自动反编译回高级语言可能很困难，因为编译过程——特别是优化编译——丢弃了原始源代码中包含的大部分高级结构信息。
- en: The processor keeps track of which instruction is being executed with an *instruction
    pointer*(IP). An IP is also referred to as a *program counter* (PC) in some contexts.
    IPs typically advance through a program one instruction at a time, unless a branch
    instruction is encountered. A branch instruction gives the program an opportunity
    to make a decision by inspecting data inside the CPU and jumping to a new location
    based on the outcome of the inspection. *Understanding the movement of the instruction
    pointer is a central part* *of reverse engineering an Xbox*. Being able to manipulate
    the IP is tantamount to having control of what the Xbox can and cannot do. The
    security measures implemented in the Xbox software architecture attempt to guarantee
    that the IP is always executing only Microsoft-approved codeby always cryptographically
    verifying a piece of code for authenticity before running it.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 处理器通过一个*指令指针*(IP)跟踪正在执行的指令。在某些情况下，IP也被称为*程序计数器*（PC）。IP通常一次前进一个指令，除非遇到分支指令。分支指令给程序提供了一个机会，通过检查CPU内部的数据并根据检查结果跳转到新位置来做出决策。*理解指令指针的移动是逆向工程Xbox的核心部分*。能够操纵IP等同于控制Xbox能做什么和不能做什么。Xbox软件架构中实施的安保措施试图保证IP始终只执行微软批准的代码，在运行之前总是通过密码学验证代码的真实性。
- en: Binary and Hexadecimal Numbers
  id: totrans-78
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 二进制和十六进制数
- en: 'Digital circuits use 1’s and 0’s to represent numbers. This binary, or “base-2”,
    notation is a reflection of the way electrical signals are used to represent numbers:
    two ranges of voltage levels are used to define one logic state or the other.
    It is possible to build electrical systems that represent information using more
    than two voltage levels, but only at the cost of power and complexity. Modern
    modems, for example, use multiple voltage levels and phase information to represent
    multiple bits of data in a single time unit.'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 数字电路使用1和0来表示数字。这种二进制，“基数-2”的表示法反映了电气信号用于表示数字的方式：使用两个电压范围来定义一个逻辑状态或另一个状态。可以构建使用超过两个电压级别来表示信息的电气系统，但这会以功率和复杂性的代价为代价。例如，现代调制解调器使用多个电压级别和相位信息来在单个时间单位内表示多个数据位。
- en: Number composition and arithmetic in binary follows the same rules as our familiar
    decimal (“base-10”) representation. In decimal, 0’s are used as placeholders to
    remember when a digit has overflowed. For example, 1 more than 9 leads to an overflow
    because there is no single digit bigger than 9\. Hence, the number 10 recordsthat
    we had one overflow of the right-most decimal location. Likewise, in binary, 1
    more than 1 is 10, since the largest single digit in binary is 1.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 二进制中的数字组成和算术遵循我们熟悉的十进制（“基-10”）表示法相同的规则。在十进制中，0 用作占位符，以记住何时一个数字溢出。例如，比 9 多 1
    的数字会导致溢出，因为没有比 9 大的单个数字。因此，数字 10 记录了最右边的十进制位置发生了一次溢出。同样，在二进制中，比 1 多 1 是 10，因为二进制中最大的单个数字是
    1。
- en: 'Thus, in decimal, the value of a four-digit decimal number d[4]d[3]d[2]d[1]
    can be broken down as:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，在十进制中，一个四位十进制数 d[4]d[3]d[2]d[1] 的值可以分解为：
- en: d[4] * 10³ + d[3] * 10² + d[2] * 10¹ + d[1] * 10⁰ = d[4] * 1000 + d[3] * 100
    + d[2] * 10 + d[1] * 1
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: d[4] * 10³ + d[3] * 10² + d[2] * 10¹ + d[1] * 10⁰ = d[4] * 1000 + d[3] * 100
    + d[2] * 10 + d[1] * 1
- en: 'Likewise, a four-digit binary number b[4]b[3]b [2]b[1] can be broken down as:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 同样，一个四位二进制数 b[4]b[3]b[2]b[1] 可以分解为：
- en: b[4] * 2³ + b[3] * 2² + b[2] * 2¹ + b[1] * 2⁰ = b[4] * 8 + b[3] * 4 + b[2] *
    2 + b[1] * 1
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: b[4] * 2³ + b[3] * 2² + b[2] * 2¹ + b[1] * 2⁰ = b[4] * 8 + b[3] * 4 + b[2] *
    2 + b[1] * 1
- en: For example, the number 1010 = 1*8 + 0*4 + 1*2 + 0*1 = 10 decimal.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，数字 1010 = 1*8 + 0*4 + 1*2 + 0*1 = 10 十进制。
- en: Keeping track of numbers in straight binary can become cumbersome quickly; for
    example, to represent decimal 968, you need ten binary digits. To save on screen
    space, binary numbers are converted to octal or hexadecimal. The octal format,
    or “base-8”, was popular in the early days of computers, but has since become
    a rarity. Hexadecimal, or “base-16”, is the de-facto numbering system. There are
    16 digits in hexadecimal, so the hex digits that correspond to decimal numbers
    10 through 15 are represented by the letters A through F. Table 2-2 summarizes
    the conversion betweenbinary, decimal, and hexadecimal for the first 16 positive
    integers.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 直接跟踪二进制中的数字会很快变得繁琐；例如，要表示十进制 968，你需要十个二进制位。为了节省屏幕空间，二进制数被转换为八进制或十六进制。八进制格式，或“基-8”，在计算机的早期阶段很受欢迎，但现在已经变得很少见。十六进制，或“基-16”，是事实上的数字系统。十六进制中有
    16 个数字，所以与十进制数字 10 到 15 对应的十六进制数字由字母 A 到 F 表示。表 2-2 总结了前 16 个正整数之间的二进制、十进制和十六进制转换。
- en: 'In order to differentiate hexadecimal from decimal numbers, many people use
    the C language convention where 0x[number] represents a hexadecimal number, and
    [number] is implicitly a decimal number. Binary numbers have no similar standard
    to draw from in C, so some people use the Verilog standard, [digits]’b[number],
    where [digits] is the number of digits in the binary number. The suffix “b” after
    a string of 1’s and 0’s, such as 1010.1100.1110b is also used to denote a binary
    number. Notice how a “.” was used to group the binary digits into sets of four;
    this assists in mentally translating the binary number into hexadecimal: 0xACE.'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 为了区分十六进制数和十进制数，许多人使用 C 语言约定，其中 0x[number] 表示一个十六进制数，而 [number] 默认是一个十进制数。在 C
    语言中没有类似的标准可以借鉴，因此有些人使用 Verilog 标准，[digits]’b[number]，其中 [digits] 是二进制数的位数。在一系列
    1 和 0 后的“b”后缀，例如 1010.1100.1110b，也用来表示二进制数。注意如何使用“.”将二进制位分组为四位的集合；这有助于将二进制数心理转换为十六进制：0xACE。
- en: '| Bin | Dec | Hex |  | Bin | Dec | Hex |'
  id: totrans-88
  prefs: []
  type: TYPE_TB
  zh: '| 二进制 | 十进制 | 十六进制 |  | 二进制 | 十进制 | 十六进制 |'
- en: '| 0000 | 0 | 0 |  | 1000 | 8 | 8 |'
  id: totrans-89
  prefs: []
  type: TYPE_TB
  zh: '| 0000 | 0 | 0 |  | 1000 | 8 | 8 |'
- en: '| 0001 | 1 | 1 |  | 1001 | 9 | 9 |'
  id: totrans-90
  prefs: []
  type: TYPE_TB
  zh: '| 0001 | 1 | 1 |  | 1001 | 9 | 9 |'
- en: '| 0010 | 2 | 2 |  | 1010 | 10 | A |'
  id: totrans-91
  prefs: []
  type: TYPE_TB
  zh: '| 0010 | 2 | 2 |  | 1010 | 10 | A |'
- en: '| 0011 | 3 | 3 |  | 1011 | 11 | B |'
  id: totrans-92
  prefs: []
  type: TYPE_TB
  zh: '| 0011 | 3 | 3 |  | 1011 | 11 | B |'
- en: '| 0100 | 4 | 4 |  | 1100 | 12 | C |'
  id: totrans-93
  prefs: []
  type: TYPE_TB
  zh: '| 0100 | 4 | 4 |  | 1100 | 12 | C |'
- en: '| 0101 | 5 | 5 |  | 1101 | 13 | D |'
  id: totrans-94
  prefs: []
  type: TYPE_TB
  zh: '| 0101 | 5 | 5 |  | 1101 | 13 | D |'
- en: '| 0110 | 6 | 6 |  | 1110 | 14 | E |'
  id: totrans-95
  prefs: []
  type: TYPE_TB
  zh: '| 0110 | 6 | 6 |  | 1110 | 14 | E |'
- en: '| 0111 | 7 | 7 |  | 1111 | 15 | F |'
  id: totrans-96
  prefs: []
  type: TYPE_TB
  zh: '| 0111 | 7 | 7 |  | 1111 | 15 | F |'
- en: '**Table 2-2**: Binary, decimal, and hexadecimal conversion table.'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: '**表 2-2**：二进制、十进制和十六进制转换表。'
- en: The heart of a CPU is a tiny, but very fast, memory called the register file.
    Multiple pieces of data can be written into and read out of a register file each
    processor clock cycle. Data from the register file is fed into an execution unit
    called the arithmetic logic unit (ALU). The functioncomputed by the ALU is controlled
    by instructions fetched from memory. Once the data has been processed by the ALU,
    it can either be written back into the register file, or stored into memory.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: CPU的核心是一个称为寄存器文件的小型但非常快速的内存。每个处理器时钟周期，可以写入和读取多个数据到寄存器文件。来自寄存器文件的数据被送入一个称为算术逻辑单元（ALU）的执行单元。ALU计算的功能由从内存中取出的指令控制。一旦数据被ALU处理，它既可以写回寄存器文件，也可以存储到内存中。
- en: One important performance feature of almost every modern CPU is a memory access
    accelerator called a *cache*. Caches are small, fast memories that store copies
    of data and instruction snippets that are likely to be used in the near future
    by the CPU core. Caches are slower than register files but faster than main memory;
    likewise, caches store more data than aregister file, but store less data than
    main memory.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 几乎每个现代CPU的一个重要性能特性是内存访问加速器，称为*缓存*。缓存是小型、快速的内存，存储CPU核心未来可能使用的数据和指令片段。缓存比寄存器文件慢，但比主内存快；同样，缓存存储的数据比寄存器文件多，但比主内存少。
- en: One important feature of the Xbox CPU cache to be aware of is that it is a writeback
    cache. Writeback caches allow copies of data stored inside the CPU to be out of
    sync with what exists in main memory. This timing difference can complicate attempts
    to trace CPU execution by observing external memory traffic alone. The cache memory
    can also be leveraged by security routines to hide intermediate computation results
    from someone observing the memory bus.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 需要注意的Xbox CPU缓存的一个重要特性是它是一个写回缓存。写回缓存允许CPU内部存储的数据副本与主内存中的数据不同步。这种时间差异可能会使仅通过观察外部内存流量来追踪CPU执行变得复杂。缓存内存还可以被安全例程利用，以隐藏中间计算结果，防止观察内存总线的人看到。
- en: '**Northbridges and Southbridges**'
  id: totrans-101
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '**北桥和南桥**'
- en: The terms Northbridge and Southbridge are vernacular specific to the PC architecture.
    They refer to the two basic support chips that are found in virtually every PC.
    A Northbridge chip connects the CPU to main memory as well as any high-performance
    expansion busses, such as AGP and PCI. A Southbridge chip hangs off of the Northbridge
    chip and contains all of the extra peripherals that are found in a typical PC
    — parallel, serial, USB, mouse, keyboard, IDE controllers, audio codecs, and more.
    Dividing the PC architecture into these three main modules — CPU, Northbridge
    and Southbridge — enables PC designers to mix and match different kinds of memory
    architectures with a diverse selection of processors and peripherals.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: Northbridge和Southbridge这两个术语是PC架构的行话。它们指的是几乎每个PC中都存在的两个基本支持芯片。北桥芯片将CPU连接到主内存以及任何高性能扩展总线，如AGP和PCI。南桥芯片挂在北桥芯片上，包含典型PC中发现的全部额外外围设备——并行、串行、USB、鼠标、键盘、IDE控制器、音频编解码器等。将PC架构分为这三个主要模块——CPU、北桥和南桥——使PC设计者能够混合搭配不同类型的内存架构与多样化的处理器和外围设备。
- en: The connection between the Northbridge and the Southbridge chipsets varies from
    chipset to chipset. In the case of the Xbox, a high performance, narrow parallel
    bus called HyperTransport is employed as the connection between the functional
    equivalent of the Northbridge and Southbridge chips. The bus is only 8 bits wide
    in each of two directions, but it is clocked at 200 MHz and data is sampled on
    each clock edge so the effective peak transfer rate is 400 Mbytes/second in each
    direction. A Northbridge chip is connected to a CPU via a bus called the Front
    Side Bus (FSB). In the case of the Xbox, the FSB is a 64-bit 133 MHz bus that
    uses AGTL+ logic levels.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 北桥和南桥芯片组之间的连接因芯片组而异。在Xbox的情况下，采用了一种高性能、窄并行总线，称为HyperTransport，作为北桥和南桥芯片功能等效部分的连接。总线在每个方向上只有8位宽，但以200
    MHz的频率运行，并且在每个时钟沿采样数据，因此每个方向的有效峰值传输率为400 Mbytes/second。北桥芯片通过一个称为前端总线（FSB）的总线连接到CPU。在Xbox的情况下，FSB是一个133
    MHz的64位总线，使用AGTL+逻辑电平。
- en: Knowing and understanding the kinds of connections between chips is crucial
    in reverse engineering because the kind of connection will dictate how difficult
    it is to intercept data going between various components. The details of the relatively
    easier bus to tap, the HyperTransport bus, are discussed in Chapter 8, “Reverse
    Engineering Xbox Security.”
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 在逆向工程中，了解和理解芯片之间连接的类型至关重要，因为连接类型将决定拦截各个组件之间传输的数据有多困难。关于相对容易接入的总线——HyperTransport总线——的细节将在第8章“逆向工程Xbox安全”中讨论。
- en: In the Xbox, the Southbridge is a chip designed by nVidia called the MCPX; it
    is a derivative of the nVidia nForce MCP Multimedia and Communications Processor.
    The Northbridge chip was also designed by nVidia, and it is called the NV2A GPU.
    Both the Northbridge and Southbridge chips were manufactured by TSMC (Taiwan Semiconductor
    Manufacturing Corporation). The NV2A combines both a GPU (Graphics Processing
    Unit) and the traditional memory and expansion bus controllers found in most Northbridge
    chips. As explained previously, combining the graphics processor and the Northbridge
    allows system designers to merge the graphics memory into main memory, at some
    performance penalty.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 在Xbox中，南桥芯片是由nVidia设计的，称为MCPX；它是nVidia nForce MCP多媒体和通信处理器的衍生产品。北桥芯片也是由nVidia设计的，称为NV2A
    GPU。北桥和南桥芯片都是由TSMC（台湾半导体制造公司）制造的。NV2A结合了GPU（图形处理单元）和大多数北桥芯片中发现的传统内存和扩展总线控制器。如前所述，将图形处理器和北桥结合在一起允许系统设计者将图形内存合并到主内存中，虽然会付出一些性能代价。
- en: '**RAM**'
  id: totrans-106
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '**RAM**'
- en: The Xbox motherboard employs 64 MB of DDR SDRAM for the main memory. DDR SDRAM
    stands for Double Data-Rate Synchronous Dynamic Random Access Memory. By combining
    synchronization and DDR techniques, the aggregate bandwidth of the Xbox main memoryachieves
    6.4 Gigabytes/second. A RAM is basically a table of information that is indexed
    by the CPU. Each location in RAM has a unique index number called its address,
    and as the name “random access” implies, there are no restrictions on the order
    of data access in a RAM.¹
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: Xbox主板使用64 MB的DDR SDRAM作为主内存。DDR SDRAM代表双数据速率同步动态随机存取存储器。通过结合同步和DDR技术，Xbox主内存的总带宽达到6.4吉字节/秒。RAM基本上是一个由CPU索引的信息表。RAM中的每个位置都有一个唯一的索引号，称为其地址，正如“随机访问”这个名字所暗示的，在RAM中对数据访问的顺序没有限制。¹
- en: The term “dynamic” is applied to RAM that has to be constantly refreshed in
    order to preserve the integrity of data. For example, the RAM used in the Xbox
    must have every location read out and written back about thirty times a second.
    The performance penalty is not as bad as it sounds, as special hardware is built
    into modern DRAM chips that help optimize the process.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: “动态”一词用于需要不断刷新以保持数据完整性的RAM。例如，Xbox中使用的RAM必须每秒大约读取和写入每个位置三十次。性能代价并没有听起来那么糟糕，因为现代DRAM芯片中内置了特殊硬件，有助于优化这个过程。
- en: The “synchronous” prefix means that inside the DRAM, the procedure for data
    access is broken down into a series of steps. Each of these steps are independent
    and can occur in parallel, so that multiple data requests can be in-flight simultaneously.
    An external timing signal, known as a clock, is used to synchronize the movement
    of data access requeststhrough the various steps inside the DRAM. As a result,
    data access requests flow through each step like water through a pipe, and this
    technique is also known as pipelining. Synchronous DRAMs have higher bandwidth
    throughput than their predecessors, because pipelining allows multiple requests
    to be processed at once. However, the time required from when an access is first
    issued to an SDRAM to when the data finally appears on the output —the access
    latency — is not improved by pipelining.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: “同步”前缀意味着在DRAM内部，数据访问的过程被分解成一系列步骤。这些步骤中的每一个都是独立的，并且可以并行发生，因此可以同时处理多个数据请求。一个称为时钟的外部时序信号用于同步数据访问请求在DRAM内部各个步骤中的移动。因此，数据访问请求就像水流过管道一样流经每个步骤，这种技术也被称为流水线。同步DRAM比其前辈具有更高的带宽吞吐量，因为流水线允许一次处理多个请求。然而，从首次向SDRAM发出访问请求到数据最终出现在输出端所需的时间——即访问延迟——并不会因为流水线而得到改善。
- en: The term “Double Data Rate” refers to the way synchronous data is transferred
    relative to the synchronizing clock. A clock waveform consists of a repeating
    pattern of high and low signals. In traditional systems, data is only transferred
    on the low-to-high transition of a clock waveform. In a DDR system, data is transferred
    on both the low-to-high and the high-to-low transitions. Thus, for the same clock
    frequency, twice the amount of data can be transferred. The performance mnemonic
    quoted by DDR SDRAM vendors, such as DDR266, refers to thetransfer rate, so the
    actual clock speed is one-half the performance mnemonic, or 133 MHz in this case.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: “双数据速率”这一术语指的是同步数据相对于同步时钟的传输方式。时钟波形由高和低信号的重复模式组成。在传统系统中，数据仅在时钟波形的低到高转换时传输。在DDR系统中，数据在低到高和高到低转换时都进行传输。因此，对于相同的时钟频率，可以传输两倍的数据量。DDR
    SDRAM供应商引用的DDR266等性能助记符指的是传输速率，因此实际的时钟速度是性能助记符的一半，在本例中为133 MHz。
- en: ROM
  id: totrans-111
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: ROM
- en: Every computer needs to have some kind of persistent or non-volatile memory
    for storing the start-up, or boot, program. The DDR SDRAM discussed above does
    not work for this application because all data in a DDR SDRAM is lost when the
    power is removed. Current versions of the Xbox use a FLASH ROM instead to store
    data that has to persist even when the power is turned off. ROM stands for Read-Only
    Memory, and FLASH refers to a specific style of storage element that is electronically
    reprogrammable. FLASH style memories are convenient in PCs because they can be
    reprogrammed by the end user to fix mistakes in theboot code. However, in the
    Xbox, FLASH ROM programming by the end user is purposely disabled. The write signal
    required for programming is disconnected by leaving out the jumper located on
    the back of the Xbox motherboard at component location R7R4 (see the sidebartitled
    “Enabling FLASH ROM Programming Hardware” for more information). In the case of
    the Xbox, the reprogrammability of FLASH is primarily leveraged as a convenience
    for Microsoft during development and production. It is quite likely that in a
    few months, the Xbox will use cheaper hard-wired “mask ROMs” once Microsoft believes
    it is ready to etch its boot program and kernel in stone (or silicon, as the case
    may be).
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 每台计算机都需要某种持久或非易失性存储器来存储启动程序或引导程序。上面讨论的DDR SDRAM不适用于此应用，因为当断电时，DDR SDRAM中的所有数据都会丢失。当前版本的Xbox使用闪存ROM来存储即使在断电时也需要持久的数据。ROM代表只读存储器，而FLASH指的是一种特定的可电子重新编程的存储元件。在PC中，FLASH风格存储器很方便，因为最终用户可以重新编程以修复引导代码中的错误。然而，在Xbox中，用户对闪存ROM的编程是故意禁用的。编程所需的写信号通过省略位于Xbox主板背面组件位置R7R4处的跳线来断开（有关更多信息，请参阅侧边栏标题为“启用FLASH
    ROM编程硬件”）。在Xbox的情况下，FLASH的可重新编程性主要被用作微软在开发和生产过程中的便利。很可能在几个月后，一旦微软认为其引导程序和内核已经准备好刻录成石（或硅，视情况而定），Xbox将使用更便宜的硬连线“掩模ROM”。
- en: The boot ROM is pivotal in reverse engineering any computer because it contains
    critical code that is responsible for initializing the whole system. In the case
    of the Xbox, the boot FLASH ROM plays an even more crucial role because it is
    partially responsible for implementing the tight software security system. The
    exact role of the FLASH ROM in the security system will be explained later, but
    the important thing to remember for now is that the FLASH ROM controls the initialization
    of the hardware in the Xbox and also contains the initial operating systemkernel
    image.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 引导ROM在逆向工程任何计算机中都起着至关重要的作用，因为它包含负责初始化整个系统的关键代码。在Xbox的情况下，引导闪存ROM扮演着更加关键的角色，因为它部分负责实施严格的软件安全系统。闪存ROM在安全系统中的确切作用将在稍后解释，但当前需要记住的重要一点是，闪存ROM控制Xbox中硬件的初始化，并包含初始操作系统内核映像。
- en: Enabling FLASH ROM Programming Hardware
  id: totrans-114
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 启用FLASH ROM编程硬件
- en: Patching the signal that was disconnected by Microsoft in order to prevent in-system
    FLASH ROM programming is a fairly simple procedure. The FLASH ROM write signal
    was disconnected by omitting a single resistor, component number R7R4, located
    on the bottom side of the Xbox motherboard at sector 7R. You can solder a piece
    of wirebetween the two silver pads of the resistor, or you could even simply bridge
    the pads with a large amount of solder. Note, even though FLASH ROM programming
    is enabled in the hardware by this patch, you still do not have a program that
    actually does the reprogramming. Running sucha program is a much greater challenge
    due to the cryptographic software security system put in place by Microsoft.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 为了防止在系统内进行 FLASH ROM 编程，微软断开了信号，修复这一问题的过程相对简单。FLASH ROM 写入信号是通过省略位于 Xbox 主板底部
    7R 区的单个电阻器，组件编号 R7R4，来断开的。您可以在电阻器的两个银色焊盘之间焊接一段电线，或者甚至可以用大量的焊锡直接连接这两个焊盘。请注意，尽管通过此修复已启用
    FLASH ROM 编程，但您仍然没有实际进行重新编程的程序。由于微软实施的加密软件安全系统，运行此类程序是一个更大的挑战。
- en: Odds and Ends
  id: totrans-116
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 些零碎事项
- en: The Xbox features a small 8-bit coprocessor called the System Management Controller
    (SMC). The SMC is a complete miniature computer with RAM, ROM, and a processor
    in a single package. The processor inside the SMC uses the PIC (Peripheral Interface
    Controller) architecture, originally developed at Harvard university around 1975
    and adapted by General Instruments for commercial sale. Arizona Microchip Technology
    (now called Microchip Technology, www.microchip.com) acquired the PIC product
    line in 1985 and has been selling it ever since. The SMC can be found in sector
    7B on the Xbox, and its reference designator is U7B2. The SMC monitors the power
    button on the front of the Xbox, so the SMC must run even when the CPU is turned
    off. As a result, the Xbox power supply has a low-current 3.3V “standby” power
    line that is always active when the Xbox is plugged in. The SMC is also responsible
    for controlling the lights around the power button on the Xbox, and it controls
    the DVD eject mechanism as wel . Final y, the SMC has a function that monitors
    the health of the CPU, and reboots the CPU in case it crashes. The SMC monitoring
    function must be disabled if youwish to run your own operating system on the Xbox.
    The SMC talks to the CPU via the MCPX through a 1-bit serial interface known as
    I2C.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: Xbox 拥有一个名为系统管理控制器（System Management Controller，简称 SMC）的小型 8 位协处理器。SMC 是一个完整的微型计算机，包含
    RAM、ROM 和处理器，全部封装在一个单一组件中。SMC 内部的处理器使用的是 PIC（外围接口控制器）架构，该架构最初于 1975 年在哈佛大学开发，并由通用仪器公司进行商业化改造。亚利桑那微芯片技术公司（现称为
    Microchip Technology，网址：www.microchip.com）于 1985 年收购了 PIC 产品线，并自此开始销售。SMC 可在 Xbox
    的 7B 区找到，其参考设计号为 U7B2。SMC 监控 Xbox 前面的电源按钮，因此即使 CPU 关闭，SMC 也必须运行。因此，Xbox 电源具有一个低电流的
    3.3V “待机”电源线，当 Xbox 连接电源时始终处于活跃状态。SMC 还负责控制 Xbox 电源按钮周围的灯光，并控制 DVD 弹出机制。最后，SMC
    还有一个监控 CPU 健康的功能，并在 CPU 崩溃时重启 CPU。如果您想在 Xbox 上运行自己的操作系统，必须禁用 SMC 监控功能。SMC 通过 MCPX
    通过一个称为 I2C 的 1 位串行接口与 CPU 通信。
- en: Another important feature of the Xbox is the LPC debug port. The LPC debug port
    is a 4-bit wide bus that runs at 33 MHz. LPC stands for “Low Pin Count,” and it
    was originally devised as a method for connecting a large number of slow legacy
    devices, such as keyboards, serial ports, parallel ports and boot ROMs, to the
    Southbridge chip via a simple intermediate translation chip. The debug port is
    provided on the Xbox presumably for manufacturing test purposes by Microsoft’s
    hardware contractor. When the Xbox nears its final stages in production, the LPC
    debug port is used to load a boot program that performs tests, diagnostics and
    burn-in on the Xbox motherboard. The LPC debug port is discussed in more detail
    in chapter 11, but the important thing to know for now is that one can force the
    Xbox to read its initial boot ROM image through the LPC debug port by connecting
    an LPC-compliant ROM device and shorting one of the data pins (D0) on the FLASH
    ROM to particular voltage (zero volts). This is perhaps the easiest method for
    forcing the Xbox to boot your own code — given that you know how to get around
    the secret boot code that secures the Xbox.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: Xbox的另一个重要特性是LPC调试端口。LPC调试端口是一个4位宽的33 MHz总线。LPC代表“低引脚计数”，它最初是为了通过一个简单的中间转换芯片将大量慢速的旧设备（如键盘、串行端口、并行端口和引导ROM）连接到南桥芯片而设计的。LPC调试端口可能是微软的硬件承包商为了制造测试目的而提供的。当Xbox接近生产最后阶段时，LPC调试端口用于在Xbox主板上加载一个执行测试、诊断和烧录的程序。LPC调试端口将在第11章中更详细地讨论，但你现在需要知道的重要事情是，可以通过连接一个符合LPC规范的ROM设备并短路FLASH
    ROM上的一个数据引脚（D0）到特定的电压（零伏特）来强制Xbox通过LPC调试端口读取其初始引导ROM映像。这可能是在知道如何绕过保护Xbox的保密引导代码的情况下强制Xbox启动你自己的代码的最简单方法。
- en: Pattern Matching
  id: totrans-119
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 模式匹配
- en: Now that we are familiar with the Xbox architecture, we have a reference point
    for perhaps one of the most powerful reverse engineering tools — pattern matching.
    Being able to make educated guesses about the function of various parts by simply
    observing their connectivity, placement and shape is the first step in becoming
    a crack reverse engineer. To demonstrate the power of pattern matching, we will
    compare the Xbox motherboard to a PC motherboard and to a Nintendo Gamecube motherboard.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经熟悉了Xbox架构，我们有一个参考点，可能是最强大的逆向工程工具之一——模式匹配。通过仅仅观察各个部分的连接性、位置和形状来对各种部件的功能做出有根据的猜测，是成为一名优秀的逆向工程师的第一步。为了展示模式匹配的力量，我们将比较Xbox主板与PC主板以及任天堂Gamecube主板。
- en: Learning a lot of patterns is the best way of becoming a good pattern matcher.
    I take apart every piece of equipment that I buy, and I pore over the circuit
    boards to try and learn what other designers know by “reading” the circuit board.
    Every circuit board tells a story about its design process; rarely will one encounter
    a peculiar circuit feature that does not have some intended purpose.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 学习大量模式是成为优秀模式匹配者的最佳方式。我拆解了我购买的每一件设备，并仔细研究电路板，试图通过“阅读”电路板来学习其他设计师知道的内容。每个电路板都讲述着其设计过程的故事；很少会遇到没有一些预定目的的奇特电路特性。
- en: Caution
  id: totrans-122
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 警告
- en: '![](../Images/index-66_1.png)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/index-66_1.png)'
- en: '**When taking apart any piece of electronic equipment, be sure to first unplug
    it and wait a minute for the charge on** **the large capacitors in the power supply
    to dissipate. Also** **be sure to use appropriate static electricity control mea****sures
    described in chapter 1!**'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '**在拆卸任何电子设备时，务必首先拔掉电源插头，并等待一分钟，以便电源中的大电容上的电荷消散。此外，务必使用第1章中描述的适当的静电控制措施！**'
- en: 'Comparison: Xbox Versus the PC'
  id: totrans-125
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 比较：Xbox与PC
- en: The similarity of an Xbox to a PC is a boon to hackers, since the PC platform
    is very wel documented. Every part in an Xbox has an analog in a typical PC, so
    almost any high-level question can be answered by just reading about a similar
    PC part. Thus, it pays to take a closer look at the similarities between the Xbox
    motherboard and a standard PC motherboard. Another benefit is that much of the
    information in this book will apply directly to PCs, so you can easily apply what
    you will learn from hacking the Xbox to a large number of situations.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: Xbox与PC的相似性对黑客来说是个福音，因为PC平台非常详细地记录了。Xbox中的每个部件在典型的PC中都有一个对应部分，因此几乎任何高级问题都可以通过阅读类似PC部件的资料来解答。因此，仔细研究Xbox主板与标准PC主板之间的相似性是有益的。另一个好处是，本书中的许多信息将直接适用于PC，因此你可以轻松地将从破解Xbox中学到的知识应用到大量情况中。
- en: The Xbox’s closest relatives are systems based on chipsets that use a unified
    memory architecture, such as nVidia’s nForce or Via Technology’s ProSavageDDR.
    The architectural diagram presented in the previous section was derived by reading
    the published specifications of the Xbox and material available on nVidia’s website
    about the nForce chipset. In this section, we will compare the Xbox to the Via
    Technology ProSavageDDR-based P4M266 motherboard. The Xbox is compared here with
    a non-nVidia chipset motherboard to emphasize the broad similarities of the Xbox
    to PCs.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: Xbox最接近的亲属是基于使用统一内存架构的芯片组系统，例如nVidia的nForce或Via Technology的ProSavageDDR。前一小节中展示的架构图是通过阅读Xbox的发布规范和nVidia网站上关于nForce芯片组的资料得出的。在本节中，我们将比较Xbox与基于Via
    Technology ProSavageDDR的P4M266主板。在这里，Xbox与非nVidia芯片组主板进行比较，以强调Xbox与PC的广泛相似性。
- en: Figure 2-7 shows a picture of a PC motherboard, the Via P4M266\. Even though
    the chipset is manufactured by a different vendor, the similarities between the
    P4M266 and the Xbox are striking. Almost all of the material covered in the previous
    section applies to this PC motherboard. The primary differences are a few miscellaneous
    ports and connectors, and the presence of PCI and AGP high-performance expansion
    ports. The Via P4M266 also lacks an explicit LPC debug connector, since all of
    the legacy peripherals are directly realized by an LPC multi-I/O chip.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 图2-7展示了一块PC主板的图片，即Via P4M266。尽管芯片组由不同的厂商制造，但P4M266与Xbox之间的相似性非常明显。前一小节中涵盖的所有内容几乎都适用于这块PC主板。主要的不同之处在于一些杂项端口和连接器，以及存在PCI和AGP高性能扩展端口。由于所有传统外围设备都直接由一个LPC多I/O芯片实现，因此Via
    P4M266缺少一个明确的LPC调试连接器。
- en: '![](../Images/index-67_1.png)'
  id: totrans-129
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/index-67_1.png)'
- en: '**Figure 2-7**: Via P4M266 motherboard with integrated graphics.'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '**图2-7**：带有集成图形的P4M266主板。'
- en: 'Contrast: Xbox Versus the Gamecube'
  id: totrans-131
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 对比：Xbox与Gamecube
- en: The Nintendo Gamecube interesting in comparison with the Xbox. The Gamecube
    is a machine designed for the same purpose as the Xbox — gaming — but with a very
    different design philosophy in mind. The Xbox and the Gamecube both use the same
    gross architecture — a CPU, a graphics coprocessor, some memory, and some support
    chips — but the similarities end there. The Gamecube design demonstrates an exacting
    attention to detail and cost. The Gamecube motherboard is small and simple, the
    component count is kept to a minimum, and the heat sinking and thermal design
    is very simple. The clean, straight layout of most of the PCB traces on the Gamecube
    motherboard reflects the fact that almost every IC is custom-designed specifically
    for the Gamecube. As a result, the Gamecube is a much more economical platform
    to build than the Xbox.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 任天堂Gamecube与Xbox相比非常有趣。Gamecube是一款与Xbox相同目的——游戏——设计的机器，但设计理念却大相径庭。Xbox和Gamecube都采用了相同的总体架构——一个CPU、一个图形协处理器、一些内存和一些支持芯片——但相似之处到此为止。Gamecube的设计体现了对细节和成本的严格要求。Gamecube的主板小巧简单，组件数量保持在最低限度，散热和热设计非常简单。Gamecube主板上的大部分PCB线路的整洁、直线布局反映了几乎每个IC都是专门为Gamecube定制的这一事实。因此，Gamecube是一个比Xbox更经济的构建平台。
- en: One can recognize the gross organization of the Gamecube by inferring each chip’s
    function from the basic marketing information Nintendo provides. Further details
    about the architecture of the Gamecube are difficult to infer, because it uses
    so many custom components that have no counterpart in a standard PC. By the pattern
    of the traces on the motherboard, one would be lead to believe that the large
    chip in the center of the board, the “Flipper” chip, is the equivalent of an integrated
    graphics Northbridge chip in a PC. This is almost correct. A key difference is
    that even though the Flipper chip combines both a memory controller and a graphics
    controller into a single package, the graphics function still has its own dedicatedmemory,
    built inside the same chip. This kind of organization al ows a very high performance
    memory to be used by the graphics engine, with the trade-off of the memory being
    a bit smaller than if off-chip memories were used. The smaller size of the on-chip
    memory is compensated in part by the use of extremely fast off-chip memory.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过从任天堂提供的基本营销信息中推断每个芯片的功能来识别Gamecube的整体组织结构。由于Gamecube使用了大量在标准PC中没有对应部件的定制组件，因此很难推断Gamecube的架构细节。根据主板上的走线模式，人们可能会认为位于主板中央的大芯片“Flipper”芯片相当于PC中集成图形北桥芯片。这几乎是正确的。一个关键的区别是，尽管Flipper芯片将内存控制器和图形控制器组合到一个单一封装中，但图形功能仍然有自己的专用内存，该内存建在同一芯片内部。这种组织结构允许图形引擎使用非常高性能的内存，但代价是内存的体积比使用片外内存要小。片上内存体积较小的问题部分通过使用极快的片外内存得到补偿。
- en: The Gamecube does not use DDR SDRAM like the Xbox; instead, it uses what is
    cal ed a 1-T SRAM. 1-T SRAMs are DRAM memories that emulate a very fast type of
    memory known as the Static RAM (SRAM). SRAMs have much lower random access latencies
    than DRAMs, and they also do not require each memory cell to be refreshed 30 times
    a second like DRAM does. The actual magic behind how DRAM can masquerade as fast
    SRAM is fairly complicated and is beyond the scope of this book, but you can find
    more information at the 1-T SRAM manufacturer’s website, www.mosys.com.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: Gamecube不像Xbox那样使用DDR SDRAM；相反，它使用一种称为1-T SRAM的内存。1-T SRAM是模拟一种称为静态RAM（SRAM）的非常快速内存类型的DRAM内存。SRAM的随机访问延迟比DRAM低得多，而且它们也不需要像DRAM那样每秒刷新30次每个内存单元。DRAM如何伪装成快速SRAM背后的实际魔法相当复杂，超出了本书的范围，但您可以在1-T
    SRAM制造商的网站上找到更多信息，网址为www.mosys.com。
- en: '![](../Images/index-69_1.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/index-69_1.png)'
- en: '**Figure 2-8**: Gamecube motherboard plus its power regulator card. The motherboard
    is about half the size of the Xbox motherboard.'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: '**图2-8**：Gamecube主板及其电源调节卡。主板的大小大约是Xbox主板的一半。'
- en: The Gamecube also has yet another piece of memory, known as ARAM, that is slower
    than the 1-T SRAM memory, and is used to store things like audio samples that
    do not require high-bandwidth accesses. Having a disparate memory architecture
    means that the Gamecube can squeeze a more consistent amount of performance out
    of each subsystem, something important in keeping frame lag to a minimum. The
    trade-off, however, is that the Gamecube can be more difficult to program, and
    mismanagement of the multiple pieces of memory can lead to performance problems.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: Gamecube还有另一块内存，称为ARAM，其速度比1-T SRAM慢，用于存储不需要高带宽访问的音频样本等。拥有不同的内存架构意味着Gamecube可以从每个子系统中获得更一致的性能，这对于将帧延迟保持在最低非常重要。然而，权衡的是，Gamecube可能更难编程，而且对多个内存部件的管理不当可能导致性能问题。
- en: Another important distinction between the Gamecube and the Xbox is that the
    Gamecube consumes much less power than an Xbox. Power consumption may seem unimportant
    at first, since both consoles are designed to be plugged into a wall outlet, but
    the Gamecube’s lowerpower envelope requires fewer heat transfer components and
    smaller power supplies to be used, saving on cost. Figure 2-8 includes a picture
    of the Gamecube power regulator for reference; the power regulator is a fraction
    of the volume of the Xbox power supply plus the local switching regulators on
    the Xbox motherboard.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: Gamecube与Xbox之间的另一个重要区别是，Gamecube的功耗比Xbox低得多。一开始，功耗可能看起来并不重要，因为这两款游戏机都设计成可以插入电源插座，但Gamecube较低的功耗需要更少的传热组件和更小的电源来使用，从而节省成本。图2-8包含了一张Gamecube电源调节器的图片供参考；电源调节器的体积只是Xbox电源供应器加上Xbox主板上的本地开关调节器体积的一小部分。
- en: To be fair, note that the Gamecube does have a small external AC to DC converter,
    while the Xbox takes wall power directly into the console. Furthermore, electronic
    components degrade much faster at elevated temperatures, as described by the rule
    of Arrhenius. For example, a 10degree Celsius operating temperature increase roughly
    doubles the failure rate of a component. As such, the Gamecube should be more
    reliable over the years than the Xbox since the Gamecube puts out less heat, and
    because its thermal management system is as good as, if not better, than the Xbox’s.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 公平地说，请注意，Gamecube确实有一个小型的外部交流电转直流电转换器，而Xbox则直接将市电接入游戏机。此外，电子元件在较高温度下会更快地退化，正如阿伦尼乌斯定律所描述的。例如，将工作温度提高10摄氏度大约可以将元件的故障率翻倍。因此，由于Gamecube产生的热量较少，并且其热管理系统与Xbox相当，甚至更好，所以Gamecube在多年后应该比Xbox更可靠。
- en: Finally, it is interesting to note that the Gamecube uses proprietary I/O interfaces
    everywhere. The game disk format is a mini-DVD format, and the DVD reader connects
    to the motherboard through a proprietary connector. Using a smaller DVD media
    allows Nintendo to reduce thelatency of data seeks, which means shorter game loading
    times. The game controllers and memory cards also use a proprietary signaling
    format. Everything in the Gamecube is somewhat similar to our familiar PC, but
    nothing was directly incorporated into the design unchanged.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，值得注意的是，Gamecube在各个地方都使用了专有的I/O接口。游戏光盘格式是一种迷你DVD格式，DVD读取器通过专有连接器连接到主板。使用较小的DVD媒体可以让任天堂减少数据查找的延迟，这意味着更短的加载游戏时间。游戏控制器和存储卡也使用专有信号格式。Gamecube中的所有东西在某种程度上都类似于我们熟悉的PC，但没有任何东西在设计上直接被采纳而不做任何改变。
- en: In addition to optimizing the manufacturability and cost of the Gamecube, the
    use of mostly proprietary chips and standards makes the console much more difficult
    to reverse engineer than the Xbox. For example, note that in Figure 2-8, there
    is no obvious ROM chip in the Gamecube. Thus, in order to even start looking at
    Gamecube code, one has to hunt down and extract a ROM hidden somewhere in one
    of the chips on the motherboard! This is one of the rare times where security
    through obscurity works. Even if there were no security at all on the Gamecube,
    the cost and effort of trying to burn your own code onto Nintendo’s custom DVD
    format is just not worth it for the individual enthusiast.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 除了优化Gamecube的制造性和成本外，主要使用专有芯片和标准使得该游戏机比Xbox更难以逆向工程。例如，注意在图2-8中，Gamecube中没有明显的ROM芯片。因此，为了开始查看Gamecube代码，必须在一个主板上某个芯片中搜寻并提取一个隐藏的ROM！这是少数几个通过隐蔽性实现安全性的情况之一。即使Gamecube上没有任何安全措施，尝试将自定义代码烧录到任天堂的DVD格式上的成本和努力对于个人爱好者来说也是不值得的。
- en: '* * *'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ¹ Actually, SDRAMs can have a few restrictions on memory access patterns (such
    as page modes and burst modes) for performance reasons. The “random” moniker is
    intended to differentiate RAMs from First-In, First-Out (FIFO) and Last-In, First-Out
    (LIFO) style memories where data is accessed using a strict set of ordering rules.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: ¹ 实际上，SDRAMs由于性能原因，对内存访问模式（如页面模式和突发模式）可能有一些限制。"随机"这个名称是为了区分RAMs和采用严格排序规则访问数据的先进先出（FIFO）和后进先出（LIFO）风格的存储器。
