- en: Chapter 18. Common Web Vulnerabilities
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Up until this point, we have paid little attention to the taxonomy of common
    web vulnerabilities. Gaining insight into the underlying mechanics of web applications
    is far more important than memorizing several thousand random and often unnecessary
    terms; nomenclature such as *improper restriction of operations within the bounds
    of a memory buffer* (Common Weakness Enumeration) or *insecure direct object references*
    (Open Web Application Security Project) finds no place in a reasonable conversation—and
    rightly so.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: Nevertheless, the industry has come up with a handful of reasonably precise
    phrases that security researchers use every day. Having thoroughly discussed the
    inner workings of the browser, it seems useful to recap and highlight the terminology
    the average reader is likely to see.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: Vulnerabilities Specific to Web Applications
  id: totrans-3
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The terms outlined in this section are unique to the technologies used on the
    Web and often have no immediate counterparts in the world of “traditional” application
    security.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
- en: '**Cross-site request forgery (XSRF, CSRF)**'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
- en: A vulnerability caused by the failure to verify that a particular state-changing
    HTTP request received by the server-side portion of the web application was initiated
    from the expected client-side origin. This flaw permits any third-party website
    loaded in the browser to perform actions on behalf of the victim.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
- en: '*See* [Chapter 4](ch04.html "Chapter 4. Hypertext Markup Language") *for a
    more detailed discussion of XSRF*.'
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Cross-site script inclusion (XSSI)**'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: A flaw caused by the failure to secure sensitive JSON-like responses against
    being loaded on third-party sites via *<script src=...>*. User-specific information
    in the response may be leaked to attackers.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
- en: '*See* [Chapter 6](ch06.html "Chapter 6. Browser-Side Scripts") *for an overview
    of the problem (and potential fixes)*.'
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Cross-site scripting (XSS)**'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: Insufficient input validation or output escaping can allow an attacker to plant
    his own HTML markup or scripts on a vulnerable site. The injected scripts will
    have access to the entirety of the targeted web application and, in many cases,
    to HTTP cookies stored by the client.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: The qualifier *reflected* refers to cases where the injected string is simply
    a result of incorrectly echoing back a portion of the request, whereas *stored*
    or *persistent* refers to a situation where the payload takes a more complex route.
    *DOM-based* may be used to denote that the vulnerability is triggered by the behavior
    of the client-side portion of the web app (i.e., JavaScript).
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: '*See* [Chapter 4](ch04.html "Chapter 4. Hypertext Markup Language") *for common
    XSS vectors in HTML documents*.'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*See* [Chapter 6](ch06.html "Chapter 6. Browser-Side Scripts") *for an overview
    of DOM-based XSS risks*.'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*See* [Chapter 13](ch13.html "Chapter 13. Content Recognition Mechanisms")
    *for XSS vectors associated with content sniffing*.'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*See* [Chapter 9](ch09.html "Chapter 9. Content Isolation Logic") *for a discussion
    of the normal security model for JS code*.'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Header injection (response splitting)**'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
- en: Insufficient escaping of newlines (or equivalent characters) in HTTP responses
    generated by the server-side portion of a web application. This behavior will
    typically lead to XSS, browser, or proxy cache poisoning and more.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: '*See* [Chapter 3](ch03.html "Chapter 3. Hypertext Transfer Protocol") *for
    a detailed discussion of the flaw*.'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Mixed content**'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
- en: A catch-all name for loading non-HTTPS subresources on HTTPS pages. In the case
    of scripts and applets, this behavior makes the application trivially vulnerable
    to active attackers, particularly on open wireless networks (at cafés, airports,
    and so on), and undoes almost all benefits of HTTPS. The consequences of mixed
    content bugs with stylesheets, fonts, images, or frames are usually also fairly
    serious but more constrained.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
- en: '*See* [Chapter 4](ch04.html "Chapter 4. Hypertext Markup Language") *and* [Chapter 8](ch08.html
    "Chapter 8. Content Rendering with Browser Plug-ins") *for content-specific precautions
    on HTTPS sites*.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*See* [Chapter 11](ch11.html "Chapter 11. Life Outside Same-Origin Rules")
    *for an overview of mixed-content handling rules*.'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Open redirection**'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: A term used to refer to applications that perform HTTP- or script-based requests
    to user-supplied URLs without constraining the possible destinations in any meaningful
    way. Open redirection is not advisable and may be exploitable in some scenarios,
    but it is typically not particularly dangerous by itself.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: '*See* [Chapter 10](ch10.html "Chapter 10. Origin Inheritance") *for cases where
    unconstrained redirection may lead to XSS*.'
  id: totrans-27
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Referer **leakage**
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
- en: Accidental disclosure of a sensitive URL by embedding an off-site subresource
    or providing an off-site link. Any security- or privacy-relevant data encoded
    in the URL of the parent document will be leaked in the *Referer* header, with
    the exception of the fragment identifier.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
- en: '*See* [Chapter 3](ch03.html "Chapter 3. Hypertext Transfer Protocol") *for
    an overview of the* Referer *logic*.'
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Problems to Keep in Mind in Web Application Design
  id: totrans-31
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The problems outlined in this section are an unavoidable circumstance of doing
    business on the Internet and must be properly accounted for when designing or
    implementing new web apps.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
- en: '**Cache poisoning**'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: The possibility of long-term pollution of the browser cache (or any interim
    proxies) with a fabricated, malicious version of the targeted web application.
    Encrypted web applications may be targeted due to response-splitting vulnerabilities.
    For nonencrypted traffic, active network attackers may be able to modify the responses
    received by the requestor, too.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
- en: '*See* [Chapter 3](ch03.html "Chapter 3. Hypertext Transfer Protocol") *for
    an overview of HTTP-caching behaviors*.'
  id: totrans-35
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Clickjacking**'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: The possibility of framing or otherwise decorating or obscuring a portion of
    another web application so that the victim, when interacting with the attacker’s
    site, is not aware that individual clicks or keystrokes are delivered to the other
    site, resulting in undesirable actions being taken on behalf of the user.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
- en: '*See* [Chapter 11](ch11.html "Chapter 11. Life Outside Same-Origin Rules")
    *for a discussion of clickjacking and related UI issues*.'
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Content and character set sniffing**'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
- en: Describes the possibility that the browser will ignore any authoritative content
    type or character set information provided by the server and interpret the returned
    document incorrectly.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
- en: '*See* [Chapter 13](ch13.html "Chapter 13. Content Recognition Mechanisms")
    *for a discussion of content-sniffing logic*.'
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*See* [Chapter 4](ch04.html "Chapter 4. Hypertext Markup Language") *and* [Chapter 8](ch08.html
    "Chapter 8. Content Rendering with Browser Plug-ins") *for scenarios where* Content-Type
    *data is ignored*.'
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Cookie forcing (or cookie injection)**'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
- en: The possibility of blindly injecting HTTP cookies into the context of an otherwise
    impenetrable web application due to issues in how the mechanism is designed and
    implemented in modern browsers. Cookie injection is of particular concern to HTTPS
    applications. (*Cookie stuffing* is a less common term referring specifically
    to maliciously deleting cookies belonging to another application by overflowing
    the cookie jar.)
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: '*See* [Chapter 9](ch09.html "Chapter 9. Content Isolation Logic") *for more
    information on cookie scoping*.'
  id: totrans-45
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*See* [Chapter 3](ch03.html "Chapter 3. Hypertext Transfer Protocol") *for
    a general discussion of the operation of HTTP cookies*.'
  id: totrans-46
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Denial-of-service (DoS) attacks**'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: A broad term denoting any opportunities for the attacker to bring down a browser
    or server or otherwise make the use of a particular targeted application significantly
    more difficult.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: '*See* [Chapter 14](ch14.html "Chapter 14. Dealing with Rogue Scripts") *for
    an overview of DoS considerations with JavaScript*.'
  id: totrans-49
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Framebusting**'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: The possibility of a framed page navigating the top-level document to a new
    URL without having to satisfy same-origin checks. The behavior may be exploited
    for phishing attacks or simply for petty mischief.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
- en: '*See* [Chapter 11](ch11.html "Chapter 11. Life Outside Same-Origin Rules")
    *for this and other frame navigation quirks*.'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**HTTP downgrade**'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
- en: The ability for active attackers to prevent the user from reaching an HTTPS
    version of a particular site or to downgrade an existing HTTPS session to HTTP.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: '*See* [Chapter 3](ch03.html "Chapter 3. Hypertext Transfer Protocol") *for
    an overview of HTTPS*.'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*See* [Chapter 16](ch16.html "Chapter 16. New and Upcoming Security Features")
    *for Strict Transport Security, a proposed solution to the problem*.'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Network fenceposts**'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: The prospect of websites on the Internet leveraging the browser to interact
    with destinations not directly accessible to the attacker, for example, with the
    systems on a victim’s internal network. Such attacks can be performed blindly,
    or (with the help of attacks such as DNS rebinding) the attacker may be able to
    see responses to all requests.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: '*See* [Chapter 12](ch12.html "Chapter 12. Other Security Boundaries") *for
    an overview of non-SOP boundaries in a browser*.'
  id: totrans-59
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '*See* [Chapter 15](ch15.html "Chapter 15. Extrinsic Site Privileges") *for
    Internet Explorer zone model, a potential approach to this risk*.'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Note
  id: totrans-61
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Beware non-buzzword bugs! Not all vulnerabilities have catchy names. Web developers
    should be wary of many other implementation and design issues that are outside
    the scope of this book but that can nevertheless bite hard. Examples include weak
    pseudo-random number generators (especially for session management purposes);
    insufficient authentication and authorization checks (in particular, overly trusting
    the browser-originating data); incorrect uses of cryptography (inventing one’s
    own algorithms is usually a no-no); and so on. For a remarkably detailed discussion
    of these and many other failure patterns, see *The Art of Software Security Assessment*
    by Dowd, McDonald, and Schuh (Addison-Wesley, 2006).
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: Common Problems Unique to Server-Side Code
  id: totrans-63
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The following issues are commonly encountered in the server-hosted portion of
    any web application and, by virtue of being tied to specific programming languages
    or software components, are unlikely to occur on the client side.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
- en: '**Buffer overflow**'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
- en: A condition where a program allows more information to be stored in a particular
    memory region than there is space to accommodate the incoming data, leading to
    the unexpected overwrite of other vital data structures. Buffer overflows happen
    chiefly in low-level programming languages, such as C or C++, and in these languages,
    they can be frequently leveraged to execute attacker-supplied code.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: '**Command injection (SQL, shell, PHP, and so on)**'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
- en: A problem where, due to insufficient input filtering or output escaping, attacker-controlled
    strings may be unintentionally processed as statements in an interpreted language
    used by the application. (In a distant sense, this is similar to XSS.) The consequences
    depend on the capabilities of the language, but in most cases, code execution
    is the eventual outcome.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: '**Directory traversal**'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
- en: A problem where, due to insufficient input filtering (most commonly, the failure
    to properly recognize and handle “../” segments in filenames), an application
    can be tricked into reading or writing files at arbitrary locations on the disk.
    Any consequences depend on additional constraints, but unconstrained file-writing
    bugs are usually easily exploitable to run attacker-supplied code.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
- en: '**File inclusion**'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
- en: If used without a qualifier or prefixed with *local (LFI)*, the term is largely
    synonymous with read-related directory traversal. *Remote file inclusion (RFI)*,
    on the other hand, is an alternative way to exploit file-inclusion vulnerabilities
    by specifying a URL rather than a valid file path. In some scripting languages,
    a single, common API opens local files and fetches remote URLs. In these cases,
    the ability to retrieve the file from an attacker-controlled server may offer
    substantial benefits, depending on how the data is subsequently processed.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 如果没有限定词或以 *local (LFI)* 为前缀使用，该术语在很大程度上等同于与读取相关的目录遍历。另一方面，*远程文件包含 (RFI)* 是一种通过指定
    URL 而不是有效文件路径来利用文件包含漏洞的替代方法。在某些脚本语言中，一个单一的、通用的 API 可以打开本地文件并获取远程 URL。在这些情况下，从攻击者控制的服务器检索文件的能力可能提供实质性的好处，具体取决于数据随后的处理方式。
- en: '**Format-string vulnerability**'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: '**格式化字符串漏洞**'
- en: A handful of commonly used library functions accept templates (“format strings”),
    followed by a set of parameters that the function is expected to insert into the
    template at predefined locations. Such an approach is particularly common in C
    (*printf(...)*, *syslog(...)*, and so on), but it is not limited to that language.
    Format-string vulnerabilities are caused by unintentionally permitting attackers
    to supply the template to one of these functions. Depending on the capabilities
    of the template system and the specifics of the language, this error may lead
    to anything from minor data leaks to code execution.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 一些常用的库函数接受模板（“格式字符串”），后跟一组函数预期将插入到模板中预定义位置的参数。这种做法在 C 语言中特别常见（如 *printf(...)*、*syslog(...)*
    等），但并不仅限于该语言。格式化字符串漏洞是由于无意中允许攻击者向这些函数之一提供模板而引起的。根据模板系统的功能和语言的特定情况，此错误可能导致从轻微的数据泄露到代码执行等各种后果。
- en: '**Integer overflow**'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '**整数溢出**'
- en: 'A vulnerability specific to languages with limited or no range checking. The
    flaw is caused by the developer failing to detect that an integer exceeded the
    maximum possible value and rolled back to zero, to a very large negative integer,
    or to some other hardware-specific and unexpected result. Depending on how the
    value is used, this may put the program in an inconsistent state or, worse, lead
    to the reading or writing of data at an incorrect memory location (which, in turn,
    may lend itself to code execution). Integer *underflow* is the opposite effect:
    crossing the minimum permissible value and rolling over to a very large positive
    integer.'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 一种特定于具有有限或无范围检查的语言的漏洞。缺陷是由于开发者未能检测到整数超过了最大可能值并回滚到零、一个非常大的负整数或某些其他硬件特定的意外结果。根据值的用途，这可能会使程序处于不一致的状态，或者更糟，导致在错误的内存位置读取或写入数据（这反过来又可能导致代码执行）。整数
    *下溢* 是相反的效果：超过最小允许值并回滚到一个非常大的正整数。
- en: '**Pointer management vulnerabilities**'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '**指针管理漏洞**'
- en: In languages that encourage or require the use of raw memory pointers (chiefly
    C and C++), it is possible to use pointers that are either uninitialized or no
    longer valid (“dangling”), leading to vulnerabilities such as *use after free*,
    *double free*, and many more. These vulnerabilities will corrupt the internal
    state of the program and usually allow an attacker to execute attacker-supplied
    code.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 在鼓励或要求使用原始内存指针的语言（主要是 C 和 C++）中，可以使用未初始化或不再有效的指针（“悬空”），导致诸如 *使用后释放*、*双重释放* 以及更多漏洞。这些漏洞将破坏程序的内部状态，通常允许攻击者执行攻击者提供的代码。
