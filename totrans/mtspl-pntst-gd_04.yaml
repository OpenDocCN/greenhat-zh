- en: Chapter 4. Vulnerability Scanning
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第4章. 漏洞扫描
- en: A *vulnerability scanner* is an automated program designed to look for weaknesses
    in computers, computer systems, networks, and applications. The program probes
    a system by sending data to it over a network and analyzing the responses received,
    in an effort to enumerate any vulnerabilities present on the target by using its
    vulnerability database as reference.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*漏洞扫描器*是一种自动化的程序，旨在寻找计算机、计算机系统、网络和应用程序中的弱点。程序通过向系统发送数据并通过网络分析收到的响应来探测系统，试图使用其漏洞数据库作为参考，列出目标上存在的任何漏洞。'
- en: Various operating systems tend to respond differently when sent particular network
    probes because of the different networking implementations in use. These unique
    responses serve as a fingerprint that the vulnerability scanner uses to determine
    the operating system version and even its patch level. A vulnerability scanner
    can also use a given set of user credentials to log into the remote system and
    enumerate the software and services to determine whether they are patched. With
    the results it obtains, the scanner presents a report outlining any vulnerabilities
    detected on the system. That report can be useful for both network administrators
    and penetration testers.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 不同的操作系统在接收到特定的网络探测时可能会做出不同的响应，这是因为使用了不同的网络实现。这些独特的响应作为指纹，漏洞扫描器使用它来确定操作系统版本甚至其补丁级别。漏洞扫描器还可以使用一组给定的用户凭据来登录远程系统，并枚举软件和服务以确定它们是否已打补丁。根据它获得的结果，扫描器会呈现一份报告，概述系统上检测到的任何漏洞。这份报告对网络管理员和渗透测试人员都很有用。
- en: Vulnerability scanners generally create a lot of traffic on a network and are
    therefore not typically used in a penetration test when one of the objectives
    is to remain undetected. If, however, you are running a penetration test and stealth
    is not an issue, a vulnerability scanner can save you from having to probe systems
    manually to determine their patch levels and vulnerabilities.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 漏洞扫描器通常会在网络上产生大量流量，因此在渗透测试中，如果目标之一是保持不被发现，通常不会使用漏洞扫描器。然而，如果你正在进行渗透测试，且隐蔽性不是问题，漏洞扫描器可以让你免于手动探测系统以确定其补丁级别和漏洞。
- en: Whether you use an automated scanner or do it manually, scanning is one of the
    most important steps in the penetration testing process; if done thoroughly, it
    will provide the best value to your client. In this chapter, we will discuss a
    number of vulnerability scanners and how they can be integrated within Metasploit.
    We’ll highlight some auxiliary modules in the Metasploit Framework that can locate
    specific vulnerabilities in remote systems.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 无论你是使用自动扫描器还是手动操作，扫描是渗透测试过程中最重要的步骤之一；如果做得彻底，将为你的客户提供最佳价值。在本章中，我们将讨论多种漏洞扫描器以及它们如何在Metasploit中集成。我们将突出Metasploit框架中的一些辅助模块，这些模块可以定位远程系统中的特定漏洞。
- en: The Basic Vulnerability Scan
  id: totrans-5
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 基本漏洞扫描
- en: Let’s look at how a scan works at the most basic level. In the following listing,
    we use *netcat* to grab a banner from the target 192.168.1.203\. *Banner grabbing*
    is the act of connecting to a remote network service and reading the service identification
    (banner) that is returned. Many network services such as web, file transfer, and
    mail servers return their banner either immediately upon connecting to them or
    in response to a specific command. Here we connect to a web server on TCP port
    80 and issue a `GET HTTP` request that allows us to look at the header information
    that the remote server returns in response to our request.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看扫描在最基本的层面上是如何工作的。在下面的列表中，我们使用*netcat*从目标192.168.1.203获取一个标志。*标志抓取*是指连接到远程网络服务并读取返回的服务标识（标志）的行为。许多网络服务，如Web、文件传输和邮件服务器，在连接到它们时立即返回它们的标志，或者是对特定命令的响应。在这里，我们连接到TCP端口80上的Web服务器，并发出一个`GET
    HTTP`请求，这允许我们查看远程服务器对我们请求的响应返回的头信息。
- en: '[PRE0]'
  id: totrans-7
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The information returned at ![](../images/00002.gif) tells us that the system
    running on port 80 is a Microsoft IIS 5.1–based web server. Armed with this information,
    we could use a vulnerability scanner, as shown in [Figure 4-1](part0008.html#vulnerability_scan_results_against_the_t),
    to determine whether this version of IIS has any vulnerabilities associated with
    it and whether this particular server has been patched.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在![图片](../images/00002.gif)返回的信息告诉我们，运行在80端口的系统是基于Microsoft IIS 5.1的Web服务器。有了这些信息，我们可以使用漏洞扫描器，如[图4-1](part0008.html#vulnerability_scan_results_against_the_t)所示，来确定这个版本的IIS是否有与之相关的漏洞，以及这个特定的服务器是否已经打上了补丁。
- en: 'Of course, in practice, it’s not that simple. Vulnerability scans often contain
    many *false positives* (reported vulnerability where none exists) and *false negatives*
    (failure to log a vulnerability where one exists) due to subtle differences in
    system and application configurations. In addition, the creators of vulnerability
    scanners have an incentive to report positives: The more “hits” a vulnerability
    scanner finds, the better it looks to a potential buyer. Vulnerability scanners
    are only as good as their vulnerabilities database, and they can easily be fooled
    by misleading banners or inconsistent configurations.'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，在实践中，事情并不那么简单。漏洞扫描通常包含许多 *误报*（报告了不存在漏洞的漏洞）和 *漏报*（未记录存在的漏洞），这是由于系统和应用程序配置的微妙差异造成的。此外，漏洞扫描器的制作者有报告正面的动机：漏洞扫描器找到的“命中”越多，对潜在买家来说看起来就越好。漏洞扫描器的质量取决于其漏洞数据库，它们很容易被误导性的横幅或不一致的配置所欺骗。
- en: Let’s take a look at some of the more useful vulnerability scanners, including
    NeXpose, Nessus, and some specialized scanners.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看看一些更有用的漏洞扫描器，包括 NeXpose、Nessus 和一些专用扫描器。
- en: '![Vulnerability scan results against the target web server](../images/00008.jpeg)Figure 4-1. Vulnerability
    scan results against the target web server'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: '![针对目标 Web 服务器的漏洞扫描结果](../images/00008.jpeg) 图 4-1. 针对目标 Web 服务器的漏洞扫描结果'
- en: Scanning with NeXpose
  id: totrans-12
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 NeXpose 扫描
- en: NeXpose is Rapid7’s vulnerability scanner that scans networks to identify the
    devices running on them and performs checks to identify security weaknesses in
    operating systems and applications. It then analyzes the scan data and processes
    it for inclusion in various reports.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: NeXpose 是 Rapid7 的漏洞扫描器，它扫描网络以识别其上运行的设备，并执行检查以识别操作系统和应用程序中的安全弱点。然后分析扫描数据并将其处理以包含在各种报告中。
- en: Rapid7 offers multiple versions of NeXpose, but we’ll use the Community edition
    because it’s free. If you plan to use NeXpose commercially, see the Rapid7 site
    ([http://www.rapid7.com/vulnerability-scanner.jsp](http://www.rapid7.com/vulnerability-scanner.jsp))
    for information on the various versions and their capabilities and pricing.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: Rapid7 提供了 NeXpose 的多个版本，但我们将使用社区版，因为它免费。如果您计划商业使用 NeXpose，请参阅 Rapid7 网站 ([http://www.rapid7.com/vulnerability-scanner.jsp](http://www.rapid7.com/vulnerability-scanner.jsp))
    了解各种版本及其功能、定价信息。
- en: Our target for scanning will be a default installation of Windows XP SP2 as
    configured in [Appendix A](part0022.html#configuring_your_target_machines). We
    will first perform a basic overt scan of our target and import the vulnerability
    scan results into Metasploit. We will close out this section by showing you how
    to run a NeXpose vulnerability scan directly from *msfconsole* rather than using
    the web-based GUI, eliminating the need to import a scan report.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的目标是扫描配置在 [附录 A](part0022.html#configuring_your_target_machines) 中的 Windows
    XP SP2 默认安装。我们首先将对目标执行基本的公开扫描，并将漏洞扫描结果导入 Metasploit。我们将通过向您展示如何直接从 *msfconsole*
    运行 NeXpose 漏洞扫描而不是使用基于网页的 GUI 来结束本节，从而消除导入扫描报告的需要。
- en: Configuration
  id: totrans-16
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置
- en: After installing NeXpose Community, open a web browser and navigate to *https://<youripaddress>:3780*.
    Accept the NeXpose self-signed certificate, and log in using the credentials you
    created during setup. You should next be presented with an interface similar to
    the one shown in [Figure 4-2](part0008.html#the_nexposeas_initial_home_screen).
    (You’ll find complete installation instructions for NeXpose at the Rapid7 website.)
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 NeXpose Community 后，打开网页浏览器并导航到 *https://<youripaddress>:3780*。接受 NeXpose
    自签名证书，并使用您在设置期间创建的凭据登录。接下来，您应该会看到一个类似于 [图 4-2](part0008.html#the_nexposeas_initial_home_screen)
    中所示的界面。（您可以在 Rapid7 网站上找到 NeXpose 的完整安装说明。）
- en: 'On the NeXpose main page, you will notice a number of tabs at the top of the
    interface:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在 NeXpose 主页上，您会在界面上方注意到几个选项卡：
- en: The Assets tab ![](../images/00002.gif) displays details of computers and other
    devices on your network after they have been scanned.
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 资产选项卡 ![](../images/00002.gif) 显示了扫描后您的网络中计算机和其他设备的详细信息。
- en: The Reports tab ![](../images/00004.gif) lists vulnerability scan reports after
    they have been generated.
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 报告选项卡 ![](../images/00004.gif) 列出了已生成的漏洞扫描报告。
- en: The Vulnerabilities tab ![](../images/00005.gif) gives you details on any vulnerabilities
    discovered during your scans.
  id: totrans-21
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 漏洞选项卡 ![](../images/00005.gif) 提供了您在扫描过程中发现的任何漏洞的详细信息。
- en: The Administration tab ![](../images/00006.gif) allows you to configure various
    options.
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 管理选项卡 ![](../images/00006.gif) 允许您配置各种选项。
- en: '![The NeXpose’s initial home screen](../images/00009.jpeg)Figure 4-2. The NeXpose’s
    initial home screen'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '![NeXpose的初始主页](../images/00009.jpeg)图4-2. NeXpose的初始主页'
- en: Buttons in the main body of the page let you perform common tasks such as creating
    a new site or setting up a new vulnerability scan.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 页面主体中的按钮允许您执行常见任务，例如创建新站点或设置新的漏洞扫描。
- en: The New Site Wizard
  id: totrans-25
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 新建站点向导
- en: Prior to running a vulnerability scan with NeXpose, you need to configure a
    *site* — a logical collection of devices such as a specific subnet, a collection
    of servers, or even a single workstation. These sites will then be scanned by
    NeXpose, and different scan types can be defined for a particular site.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用NeXpose运行漏洞扫描之前，您需要配置一个*站点*——一个逻辑设备集合，例如特定的子网、服务器集合，甚至单个工作站。然后，NeXpose将对这些站点进行扫描，并为特定站点定义不同的扫描类型。
- en: To create a site, click the **New Site** button on the NeXpose home page, enter
    a name for your site and a brief description, and then click **Next**.
  id: totrans-27
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要创建一个站点，请点击NeXpose主页上的**新建站点**按钮，输入站点的名称和简要描述，然后点击**下一步**。
- en: In the devices step, shown in [Figure 4-3](part0008.html#adding_a_device_to_the_new_nexpose_site),
    you have quite a bit of granularity in defining your targets. You can add a single
    IP address, address ranges, hostnames, and more. You can also declare devices,
    such as printers, to exclude from scans. (Printers frequently don’t take kindly
    to being scanned. We have seen instances in which a simple vulnerability scan
    caused more than one million pages of pure black to be placed in the queue to
    print!) Click **Next** when you have finished adding and excluding devices.
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在设备步骤中，如[图4-3](part0008.html#adding_a_device_to_the_new_nexpose_site)所示，您在定义目标方面有相当大的粒度。您可以添加单个IP地址、地址范围、主机名等。您还可以声明要排除扫描的设备，例如打印机。（打印机通常不喜欢被扫描。我们见过简单漏洞扫描导致超过一百万页纯黑色打印作业被放入打印队列的实例！）完成添加和排除设备后，点击**下一步**。
- en: At the scan setup step, you can choose from several different scan templates,
    such as Discovery Scan and Penetration test; select the scanning engine you want
    to use; or set up an automated scanning schedule. For purposes of this initial
    walk-through, keep the default selections and click **Next** to continue.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在扫描设置步骤中，您可以从几个不同的扫描模板中进行选择，例如发现扫描和渗透测试；选择您想要使用的扫描引擎；或设置自动扫描计划。为了进行这次初始演练，请保持默认选择并点击**下一步**继续。
- en: Add credentials for the site you want to scan, if you have them. Credentials
    can help create more accurate and complete results by performing in-depth enumeration
    of installed software and system policies on the target.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为您要扫描的站点添加凭据，如果您有的话。凭据可以通过对目标上安装的软件和系统策略进行深入枚举，帮助创建更准确和完整的结果。
- en: On the Credentials tab, click the **New Login** button, type a username and
    password for the IP address you want to scan, and then click **Test Login** to
    verify your credentials then save them.![Adding a device to the new NeXpose site](../images/00010.jpeg)Figure 4-3. Adding
    a device to the new NeXpose site
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在凭据标签页上，点击**新建登录**按钮，为要扫描的IP地址输入用户名和密码，然后点击**测试登录**以验证凭据然后保存它们。![将设备添加到新的NeXpose站点](../images/00010.jpeg)图4-3.
    将设备添加到新的NeXpose站点
- en: Last, click **Save** to complete the New Site wizard and return to the Home
    tab, which should list your newly added site, as shown in [Figure 4-4](part0008.html#the_home_tab_shows_the_newly_configured).![The
    Home tab shows the newly configured site.](../images/00011.jpeg)Figure 4-4. The
    Home tab shows the newly configured site.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，点击**保存**以完成新建站点向导并返回到主页标签，该标签应列出您新添加的站点，如[图4-4](part0008.html#the_home_tab_shows_the_newly_configured)所示。![主页标签显示新配置的站点。](../images/00011.jpeg)图4-4.
    主页标签显示新配置的站点。
- en: The New Manual Scan Wizard
  id: totrans-33
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 新建手动扫描向导
- en: 'With your new site configured, you are now set to configure your first scan:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 配置了新的站点后，您现在可以配置您的第一个扫描：
- en: Click the **New Manual Scan** button shown in [Figure 4-4](part0008.html#the_home_tab_shows_the_newly_configured).
    You should see the Start New Scan dialog shown in [Figure 4-5](part0008.html#the_nexpose_scan_configuration_dialog),
    which prompts you for the assets you want to scan or exclude. In this example,
    we are scanning our default Windows XP system.
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 点击[图4-4](part0008.html#the_home_tab_shows_the_newly_configured)中显示的**新建手动扫描**按钮。您应该看到[图4-5](part0008.html#the_nexpose_scan_configuration_dialog)中显示的“开始新扫描”对话框，该对话框提示您选择要扫描或排除的资产。在这个例子中，我们正在扫描我们的默认Windows
    XP系统。
- en: Double-check your target IP address to be sure that you’re not about to scan
    the wrong device or network inadvertently, and click the **Start Now** button
    to begin.![The NeXpose scan configuration dialog](../images/00012.jpeg)Figure 4-5. The
    NeXpose scan configuration dialog
  id: totrans-36
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 仔细检查您的目标IP地址，以确保您不是意外地扫描了错误的设备或网络，然后点击**立即开始**按钮开始扫描。![NeXpose扫描配置对话框](../images/00012.jpeg)图4-5.
    NeXpose扫描配置对话框
- en: NeXpose should dynamically refresh the page as the scan progresses. Wait until
    the status for both Scan Progress and Discovered Assets shows *Completed*, as
    shown in [Figure 4-6](part0008.html#the_completed_nexpose_scan_and_report). Under
    the Scan Progress section, you can see that our single scanned device has 268
    vulnerabilities detected, and under Discovered Assets, you are provided with more
    information about the target such as the device name and its operating system.
    Now click the **Reports** tab.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: NeXpose应随着扫描的进行动态刷新页面。等待扫描进度和发现资产的状态都显示为**完成**，如图[图4-6](part0008.html#the_completed_nexpose_scan_and_report)所示。在扫描进度部分，您可以看到我们的单个扫描设备检测到268个漏洞，在发现资产部分，您将获得有关目标（如设备名称和操作系统）的更多信息。现在点击**报告**标签页。
- en: '![The completed NeXpose scan and report](../images/00013.jpeg)Figure 4-6. The
    completed NeXpose scan and report'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: '![完成的NeXpose扫描和报告](../images/00013.jpeg)图4-6. 完成的NeXpose扫描和报告'
- en: The New Report Wizard
  id: totrans-39
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 新建报告向导
- en: If this is your first time running NeXpose and you have completed only one scan,
    the Reports tab should show that you have generated no reports.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 如果这是您第一次运行NeXpose并且您只完成了一次扫描，报告标签页应显示您尚未生成任何报告。
- en: Click **New Report**, as shown in [Figure 4-7](part0008.html#the_nexpose_reports_tab),
    to start the New Report wizard.![The NeXpose Reports tab](../images/00014.jpeg)Figure 4-7. The
    NeXpose Reports tab
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如[图4-7](part0008.html#the_nexpose_reports_tab)所示，点击**新建报告**以启动新建报告向导。![NeXpose报告标签页](../images/00014.jpeg)图4-7.
    NeXpose报告标签页
- en: Enter a friendly name, and then in the Report format field, select **NeXpose
    Simple XML Export**, as shown in [Figure 4-8](part0008.html#selecting_a_name_and_format_for_the_repo),
    so that you will be able to import the scan results into Metasploit. You can select
    from different report templates and configure the time zone if you happen to be
    conducting your pen test on the road. Click **Next** when you are ready to proceed.![Selecting
    a name and format for the report](../images/00015.jpeg)Figure 4-8. Selecting a
    name and format for the report
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入一个友好的名称，然后在报告格式字段中，选择**NeXpose简单XML导出**，如图[图4-8](part0008.html#selecting_a_name_and_format_for_the_repo)所示，以便您能够将扫描结果导入Metasploit。您可以从不同的报告模板中选择，并在必要时配置时区。准备好继续时，点击**下一步**。![选择报告的名称和格式](../images/00015.jpeg)图4-8.
    选择报告的名称和格式
- en: In the subsequent window, add the devices you want to be included in the report
    by clicking **Select Sites** to add your scanned target range, as shown in [Figure 4-9](part0008.html#selecting_the_site_for_inclusion_in_the).
    Then click **Save**.![Selecting the site for inclusion in the report](../images/00016.jpeg)Figure 4-9. Selecting
    the site for inclusion in the report
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在随后的窗口中，通过点击**选择站点**来添加您想要包含在报告中的设备，如图[图4-9](part0008.html#selecting_the_site_for_inclusion_in_the)所示。然后点击**保存**。![选择要包含在报告中的站点](../images/00016.jpeg)图4-9.
    选择要包含在报告中的站点
- en: In the Select Devices dialog, select the targets to include in your report and
    then click **Save**.
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在选择设备对话框中，选择要包含在报告中的目标，然后点击**保存**。
- en: Back in the Report Configuration wizard, click **Save** to accept the remaining
    defaults for the report. The Reports tab should now list the newly created report,
    as shown in [Figure 4-10](part0008.html#the_reports_tab_lists_your_reports). (Be
    sure to save the report file so that you can use it with the Framework.)![The
    Reports tab lists your reports.](../images/00017.jpeg)Figure 4-10. The Reports
    tab lists your reports.
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在报告配置向导中，点击**保存**以接受报告的其余默认设置。现在报告标签页应列出新创建的报告，如图[图4-10](part0008.html#the_reports_tab_lists_your_reports)所示。（请确保保存报告文件，以便您可以在框架中使用它。）![报告标签页列出您的报告](../images/00017.jpeg)图4-10.
    报告标签页列出您的报告。
- en: Importing Your Report into the Metasploit Framework
  id: totrans-46
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 将您的报告导入Metasploit框架
- en: Having completed a full vulnerability scan with NeXpose, you need to import
    the results into Metasploit. But before you do, you must create a new database
    from *msfconsole* by issuing `db_connect`. After creating that database you’ll
    import the NeXpose XML using the `db_import` command. Metasploit will automatically
    detect that the file is from NeXpose and import the scanned host. You can then
    verify that the import was successful by running the `db_hosts` command. (These
    steps are shown in the following listing.) As you can see at ![](../images/00002.gif),
    Metasploit knows about the 268 vulnerabilities that your scan picked up.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 使用NeXpose完成全面漏洞扫描后，您需要将结果导入Metasploit。但在导入之前，您必须通过执行`db_connect`命令从*msfconsole*创建一个新的数据库。创建该数据库后，您将使用`db_import`命令导入NeXpose
    XML。Metasploit将自动检测该文件来自NeXpose并导入扫描的主机。您可以通过运行`db_hosts`命令来验证导入是否成功。（以下列出这些步骤。）正如您在![](../images/00002.gif)中看到的，Metasploit知道您的扫描发现了268个漏洞。
- en: '[PRE1]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'To display the full details of the vulnerabilities imported into Metasploit,
    including Common Vulnerabilities and Exposures (CVE) numbers and other references,
    run the following:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 要显示导入到Metasploit中的漏洞的完整详细信息，包括通用漏洞和暴露（CVE）编号和其他参考，请运行以下命令：
- en: '[PRE2]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: As you can see, running an overt vulnerability scan with full credentials can
    provide an amazing amount of information — 268 vulnerabilities found in this case.
    But, of course, this has been a very noisy scan, likely to attract lots of attention.
    These types of vulnerability scans are best used in a pen test where being stealthy
    is not required.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，运行带有完整凭证的公开漏洞扫描可以提供大量信息——在这个例子中发现了268个漏洞。但当然，这是一个非常嘈杂的扫描，可能会吸引很多注意。这类漏洞扫描最好用于渗透测试，在这种情况下不需要隐蔽。
- en: Running NeXpose Within MSFconsole
  id: totrans-52
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在MSFconsole中运行NeXpose
- en: Running NeXpose from the web GUI is great for fine-tuning vulnerability scans
    and generating reports, but if you prefer to remain in *msfconsole*, you can still
    run full vulnerability scans with the NeXpose plug-in included in Metasploit.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Web GUI运行NeXpose非常适合微调漏洞扫描和生成报告，但如果您更喜欢保持在*msfconsole*中，您仍然可以使用Metasploit中包含的NeXpose插件运行完整的漏洞扫描。
- en: 'To demonstrate the difference in results between a credentialed and noncredentialed
    scan, we will run a scan from with Metasploit without specifying a username and
    password for the target system. Before you begin, delete any existing database
    with `db_destroy`, create a new database in Metasploit with `db_connect`, and
    then load the NeXpose plug-in with `load nexpose` as shown next:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 为了演示有凭证和无凭证扫描之间结果的不同，我们将从Metasploit运行一个扫描，而不指定目标系统的用户名和密码。在开始之前，使用`db_destroy`删除任何现有的数据库，使用`db_connect`在Metasploit中创建一个新的数据库，然后按照以下所示使用`load
    nexpose`加载NeXpose插件：
- en: '[PRE3]'
  id: totrans-55
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: With the NeXpose plug-in loaded, have a look at the commands loaded specifically
    for the vulnerability scanner by entering the **`help`** command. You should see
    a series of new commands at the top of the listing specific to running NeXpose.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 在加载了NeXpose插件后，通过输入**`help`**命令查看专门为漏洞扫描器加载的命令。你应该会在列表顶部看到一系列针对运行NeXpose的新命令。
- en: '[PRE4]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Before running your first scan from *msfconsole*, you will need to connect
    to your NeXpose installation. Enter **`nexpose_connect -h`** to display the usage
    required to connect; add your username, password, and host address; and accept
    the SSL certificate warning by adding `ok` to the end of the connect string:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 在从*msfconsole*运行您的第一次扫描之前，您需要连接到您的NeXpose安装。输入**`nexpose_connect -h`**以显示连接所需的用法；添加您的用户名、密码和主机地址；并通过在连接字符串末尾添加`ok`来接受SSL证书警告：
- en: '[PRE5]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Now enter **`nexpose_scan`** followed by the target IP address to initiate a
    scan, as shown next. In this example, we are scanning a single IP address, but
    you could also pass a range of hosts to the scanner (192.168.1.1-254) or a subnet
    in Classless Inter-Domain Routing (CIDR) notation (192.168.1.0/24).
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 现在输入**`nexpose_scan`**后跟目标IP地址以启动扫描，如下所示。在这个例子中，我们正在扫描单个IP地址，但您也可以向扫描器传递一组主机（192.168.1.1-254）或无类别域间路由（CIDR）表示法中的子网（192.168.1.0/24）。
- en: '[PRE6]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: After the NeXpose scan completes, the database you created earlier should contain
    the results of the vulnerability scan. To view the results, enter **`db_hosts`**,
    as shown next. (In this example, the output has been trimmed by filtering on the
    address column.)
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: NeXpose扫描完成后，您之前创建的数据库应包含漏洞扫描的结果。要查看结果，输入**`db_hosts`**，如下所示。（在这个例子中，输出已被地址列的过滤所裁剪。）
- en: '[PRE7]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'As you can see, NeXpose has discovered seven vulnerabilities. Run **`db_vulns`**
    to display the vulnerabilities found:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，NeXpose发现了七个漏洞。运行**`db_vulns`**以显示找到的漏洞：
- en: '[PRE8]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Although this scan has found significantly fewer than the 268 vulnerabilities
    discovered with our prior use of NeXpose through the GUI with credentials, you
    should have enough vulnerabilities here to get a great head start on exploiting
    the system.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管这次扫描发现的漏洞数量显著少于之前通过GUI使用凭据使用NeXpose发现的268个漏洞，但您应该有足够的漏洞来为系统利用打下良好的基础。
- en: Scanning with Nessus
  id: totrans-67
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用Nessus进行扫描
- en: The Nessus vulnerability scanner from Tenable Security ([http://www.tenable.com/](http://www.tenable.com/))
    is one of the most widely used vulnerability scanners. Metasploit’s Nessus plug-in
    lets you launch scans and pull information from Nessus scans via the console,
    but in the example that follows, we’ll import Nessus scan results independently.
    Using Nessus 4.4.1 with a free Home Feed, we’ll run this scan against the same
    target we’ll use throughout this chapter, with known credentials. In these early
    stages of a penetration test, the more tools you can use to fine-tune your future
    attacks, the better.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: Tenable Security的Nessus漏洞扫描器([http://www.tenable.com/](http://www.tenable.com/))是最广泛使用的漏洞扫描器之一。Metasploit的Nessus插件允许您通过控制台启动扫描并从Nessus扫描中提取信息，但在接下来的示例中，我们将独立导入Nessus扫描结果。使用Nessus
    4.4.1和免费的家庭订阅，我们将对本章中使用的相同目标进行扫描，使用已知的凭据。在渗透测试的早期阶段，您可以使用更多工具来微调未来的攻击，这将更有利。
- en: Nessus Configuration
  id: totrans-69
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Nessus配置
- en: After you have downloaded and installed Nessus, open your web browser and navigate
    to *https://<youripaddress>:8834*, accept the certificate warning, and log into
    Nessus using the credentials you created during installation. You should see the
    main Nessus window, as shown in [Figure 4-11](part0008.html#the_main_nessus_window).
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 在您下载并安装Nessus之后，打开您的网页浏览器并导航到 *https://<您的IP地址>:8834*，接受证书警告，并使用您在安装过程中创建的凭据登录Nessus。您应该会看到如图[图4-11](part0008.html#the_main_nessus_window)所示的Nessus主窗口。
- en: '![The main Nessus window](../images/00018.jpeg)Figure 4-11. The main Nessus
    window'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '![Nessus主窗口](../images/00018.jpeg)图4-11. Nessus主窗口'
- en: On login, you will see the Reports section, where any prior vulnerability scans
    should be listed. Along the top of the interface, you should see the Scans tab,
    where you can create and view scanning tasks; the Policies tab, where you configure
    Nessus to include various plug-ins you want to use in your scans; and the Users
    tab, where you can add user accounts to the Nessus server.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 登录后，您将看到报告部分，其中应列出任何先前的漏洞扫描。在界面的顶部，您应该看到扫描选项卡，您可以在其中创建和查看扫描任务；策略选项卡，您可以在其中配置Nessus以包含您在扫描中想要使用的各种插件；以及用户选项卡，您可以在其中向Nessus服务器添加用户账户。
- en: Creating a Nessus Scan Policy
  id: totrans-73
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 创建Nessus扫描策略
- en: Before beginning a scan, you first need to create a Nessus scan policy. On the
    Policies tab, click the green **Add** button to open the policy configuration
    window shown in [Figure 4-12](part0008.html#the_nessus_policies_configuration_window).
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始扫描之前，您首先需要创建一个Nessus扫描策略。在“策略”选项卡上，点击绿色的**添加**按钮以打开策略配置窗口，如图[图4-12](part0008.html#the_nessus_policies_configuration_window)所示。
- en: '![The Nessus Policies configuration window](../images/00019.jpeg)Figure 4-12. The
    Nessus Policies configuration window'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '![Nessus策略配置窗口](../images/00019.jpeg)图4-12. Nessus策略配置窗口'
- en: You’ll see many available options, all of which can be found in Nessus’s documentation.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 您将看到许多可用选项，所有这些都可以在Nessus的文档中找到。
- en: Enter a name for the scan, as shown in [Figure 4-13](part0008.html#the_nessus_general_settings).
    We will use the name *The_Works* in our example to have Nessus run all of its
    checks. Then click **Next**.
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为扫描输入一个名称，如图[图4-13](part0008.html#the_nessus_general_settings)所示。在我们的示例中，我们将使用名称*The_Works*，以便Nessus运行所有检查。然后点击**下一步**。
- en: As with the NeXpose scan conducted earlier, we will configure this scan to use
    Windows login credentials to get a more complete picture of the vulnerabilities
    present on the target system. Enter the login credentials for your target system
    and click **Next**.![The Nessus General settings](../images/00020.jpeg)Figure 4-13. The
    Nessus General settings
  id: totrans-78
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 与之前进行的NeXpose扫描一样，我们将配置此扫描使用Windows登录凭据以获取目标系统上存在的漏洞的更完整视图。输入您的目标系统的登录凭据并点击**下一步**。![Nessus常规设置](../images/00020.jpeg)图4-13. Nessus常规设置
- en: On the Plugins page, you can choose from a large variety of Nessus plug-ins
    for Windows, Linux, BSD, and more. If, during a scan, you know you are going to
    scan only Windows-based systems, for example, you could deselect many of these
    plug-ins for your first run-through; for now, click **Enable All** (shown in the
    lower-right corner of [Figure 4-14](part0008.html#selecting_nessus_scan_plug-ins))
    and then click **Next**.![Selecting Nessus scan plug-ins](../images/00021.jpeg)Figure 4-14. Selecting
    Nessus scan plug-ins
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在插件页面上，您可以从Windows、Linux、BSD等多种操作系统的大量Nessus插件中进行选择。例如，如果在扫描过程中您知道您将仅扫描基于Windows的系统，您可以在第一次运行时取消选择许多这些插件；现在，点击**启用所有**（如图[图4-14](part0008.html#selecting_nessus_scan_plug-ins)右下角所示）然后点击**下一步**。![选择Nessus扫描插件](../images/00021.jpeg)图4-14. 选择Nessus扫描插件
- en: The final step in setting up the new policy is the Preferences page. Here, you
    can direct Nessus not to scan fragile devices such as network printers, configure
    it to store results in an external database, provide login credentials, and more.
    When you are done with your selections, click **Submit** to save the new policy.
    Your newly added policy should be displayed under Policies, as shown in [Figure 4-15](part0008.html#the_newly_added_policy_in_nessus).
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置新策略的最后一步是偏好设置页面。在这里，您可以指示Nessus不要扫描如网络打印机等脆弱设备，配置它将结果存储在外部数据库中，提供登录凭证等。完成您的选择后，点击**提交**以保存新策略。您新添加的策略应显示在策略下，如图[图4-15](part0008.html#the_newly_added_policy_in_nessus)所示。
- en: '![The newly added policy in Nessus](../images/00022.jpeg)Figure 4-15. The newly
    added policy in Nessus'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '![Nessus中新添加的策略](../images/00022.jpeg)图4-15. Nessus中新添加的策略'
- en: Running a Nessus Scan
  id: totrans-82
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 运行Nessus扫描
- en: After you have created a scan policy, you are ready to configure a scan. Begin
    by selecting the **Scans** tab, and then click the **Add** button to open the
    scan configuration window. Most Nessus configuration is set in its scan policies,
    so when you’re setting up a scan, enter a name for the scan, choose a policy,
    and enter the scan targets, as shown in [Figure 4-16](part0008.html#configuring_a_nessus_scan).
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 在您创建了一个扫描策略之后，您就可以配置一个扫描了。首先选择**扫描**选项卡，然后点击**添加**按钮以打开扫描配置窗口。大多数Nessus配置都是在其扫描策略中设置的，因此在设置扫描时，输入扫描名称，选择策略，并输入扫描目标，如图[图4-16](part0008.html#configuring_a_nessus_scan)所示。
- en: '![Configuring a Nessus scan](../images/00023.jpeg)Figure 4-16. Configuring
    a Nessus scan'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: '![配置Nessus扫描](../images/00023.jpeg)图4-16. 配置Nessus扫描'
- en: In our example, we are scanning only one host, but you can also enter IP address
    ranges in CIDR notation or even upload a file containing the addresses of the
    targets you want to scan. When you are satisfied with the scan configuration,
    click **Launch Scan**.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们的示例中，我们只扫描了一个主机，但您也可以输入CIDR表示法的IP地址范围，甚至上传包含您想要扫描的目标地址的文件。当您对扫描配置满意时，点击**启动扫描**。
- en: Nessus Reports
  id: totrans-86
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Nessus报告
- en: After the scan is complete, it will no longer appear under Scans, and you should
    find a new entry under the Reports tab listing the name of the scan, its status,
    and when it was last updated. Select the report and click **Browse** to open a
    summary page of the scan that shows the severity levels of the vulnerabilities
    found, as shown in [Figure 4-17](part0008.html#our_nessus_scan_report_summary).
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 扫描完成后，它将不再显示在扫描下，您应该在报告选项卡下找到一个新条目，列出扫描的名称、状态和最后更新时间。选择报告并点击**浏览**以打开扫描的摘要页面，显示发现的漏洞的严重级别，如图[图4-17](part0008.html#our_nessus_scan_report_summary)所示。
- en: '![Our Nessus scan report summary](../images/00024.jpeg)Figure 4-17. Our Nessus
    scan report summary'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: '![我们的Nessus扫描报告摘要](../images/00024.jpeg)图4-17. 我们的Nessus扫描报告摘要'
- en: '* * *'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: Note
  id: totrans-90
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Bear in mind that because this scan was run with Windows credentials, Nessus
    will find many more vulnerabilities than it would with an anonymous scan.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，由于此扫描使用Windows凭证运行，Nessus将发现比匿名扫描更多的漏洞。
- en: '* * *'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: Importing Results into the Metasploit Framework
  id: totrans-93
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 将结果导入Metasploit框架
- en: Now let’s import our results into the Framework.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们将我们的结果导入框架。
- en: Click the **Download Report** button on the Reports tab to save the results
    to your hard drive. The default file format for Nessus reports, *.nessus*, can
    be parsed by Metasploit, so click **Submit** when prompted to select the default
    format.
  id: totrans-95
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在报告选项卡上点击**下载报告**按钮，将结果保存到您的硬盘上。Nessus报告的默认文件格式*.nessus*可以被Metasploit解析，因此当提示选择默认格式时，请点击**提交**。
- en: Load *msfconsole*, create a new database with `db_connect`, and import the Nessus
    results file by entering **`db_import`** followed by the report filename.
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 加载*msfconsole*，使用`db_connect`创建一个新的数据库，然后通过输入**`db_import`**后跟报告文件名来导入Nessus结果文件。
- en: '[PRE9]'
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: To verify that the scanned host and vulnerability data was imported properly,
    enter **`db_hosts`** as shown next. This should output a brief listing with the
    target IP address, the number of services detected, and the number of vulnerabilities
    found by Nessus.
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为了验证扫描的主机和漏洞数据是否已正确导入，请输入**`db_hosts`**，如下所示。这将输出一个简短的列表，包括目标IP地址、检测到的服务数量以及Nessus发现的漏洞数量。
- en: '[PRE10]'
  id: totrans-99
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'For a complete listing of the vulnerability data that was imported into Metasploit,
    enter **`db_vulns`** without any switches, as shown here:'
  id: totrans-100
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要查看导入到Metasploit中的漏洞数据完整列表，请输入**`db_vulns`**，无需任何开关，如下所示：
- en: '[PRE11]'
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: At the end of your pen test, having these references available can be of great
    assistance when you’re writing the report for your client.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的渗透测试结束时，拥有这些参考资料可以在为客户编写报告时提供很大帮助。
- en: Scanning with Nessus from Within Metasploit
  id: totrans-103
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在Metasploit内部使用Nessus进行扫描
- en: During those times when you don’t feel like leaving the comfort of the command
    line, you can use the Nessus Bridge plug-in ([http://blog.zate.org/nessus-plugin-dev/](http://blog.zate.org/nessus-plugin-dev/))
    by Zate within Metasploit. The Nessus Bridge allows you to control Nessus completely
    through the Metasploit Framework, run scans, interpret results, and launch attacks
    based on the vulnerabilities identified through Nessus.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 在你不想离开命令行舒适区的时候，你可以在Metasploit中使用Zate的Nessus Bridge插件([http://blog.zate.org/nessus-plugin-dev/](http://blog.zate.org/nessus-plugin-dev/))。Nessus
    Bridge允许你完全通过Metasploit框架控制Nessus，运行扫描，解释结果，并根据Nessus识别的漏洞发起攻击。
- en: As in the preceding examples, first destroy the existing database with the **`db_destroy`**
    command and create a new one using **`db_connect`**.
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 与前面的示例一样，首先使用**`db_destroy`**命令销毁现有的数据库，然后使用**`db_connect`**创建一个新的数据库。
- en: 'Load the Nessus plug-in by running **`load nessus`**, as shown here:'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过运行**`load nessus`**来加载Nessus插件，如下所示：
- en: '[PRE12]'
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Running the command `nessus_help` will display all of the commands that the
    plug-in supports. The Bridge undergoes regular development and updates, so it
    is a good idea to check the help output periodically to see what new features,
    if any, have been added.
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行`nessus_help`命令将显示插件支持的所有命令。Bridge插件定期进行开发和更新，因此定期检查帮助输出以查看是否添加了新功能是个好主意。
- en: 'Before starting a scan with the Bridge, you first need to authenticate to your
    Nessus server using **`nessus_connect`**, as shown here:'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在使用Bridge开始扫描之前，你首先需要使用**`nessus_connect`**进行身份验证，如下所示：
- en: '[PRE13]'
  id: totrans-110
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'As with the GUI version of Nessus, you need to initiate a scan using a defined
    policy by its policy ID number. To list the available scan policies on the server,
    use **`nessus_policy_list`**:'
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 与Nessus的GUI版本一样，你需要通过其策略ID号启动一个使用定义策略的扫描。要列出服务器上可用的扫描策略，请使用**`nessus_policy_list`**：
- en: '[PRE14]'
  id: totrans-112
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Take note of the policy ID you want to use for your scan, and then launch a
    new scan with **`nessus_scan_new`** followed by the policy number, a name for
    your scan, and your target IP address as shown next:'
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 注意你想要用于扫描的策略ID，然后使用**`nessus_scan_new`**后跟策略编号、扫描名称和你的目标IP地址来启动一个新的扫描，如下所示：
- en: '[PRE15]'
  id: totrans-114
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: While your scan is in progress, you can see its status by running the **`nessus_scan_status`**
    command. When this command’s output responds with “No Scans Running,” as shown
    next, you will know that your scan has completed.
  id: totrans-115
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当你的扫描正在进行时，你可以通过运行**`nessus_scan_status`**命令来查看其状态。当此命令的输出响应为“没有正在运行的扫描”，如下所示时，你知道你的扫描已经完成。
- en: '[PRE16]'
  id: totrans-116
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: After the scan has completed, you can list the available scan reports with the
    `nessus_report_list` command. Identify the ID of the report you want to import
    and enter **`nessus_report_get`** to download the report and import it into the
    Metasploit database automatically.
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 扫描完成后，你可以使用`nessus_report_list`命令列出可用的扫描报告。识别你想要导入的报告的ID，然后输入**`nessus_report_get`**以自动下载报告并将其导入到Metasploit数据库中。
- en: '[PRE17]'
  id: totrans-118
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Finally, as with the other import functions demonstrated in this chapter, you
    can use `db_hosts` to verify that the scan data was imported successfully:'
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 最后，就像本章中演示的其他导入功能一样，你可以使用`db_hosts`来验证扫描数据是否已成功导入：
- en: '[PRE18]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Now that you’ve seen the variation in scan results from two different products,
    you should have a better sense of the merit in using more than one tool for your
    scanning needs. It is still up to the penetration tester to interpret the results
    from these automated tools and turn them into actionable data.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经看到了来自两种不同产品的扫描结果变化，您应该对使用多个工具来满足您的扫描需求的优势有了更好的认识。解读这些自动化工具的结果并将其转化为可操作数据，这仍然取决于渗透测试人员。
- en: Specialty Vulnerability Scanners
  id: totrans-122
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 专业漏洞扫描器
- en: Although many commercial vulnerability scanners are available on the market,
    you are not limited to them. When you want to run a scan for a specific vulnerability
    across a network, Metasploit’s many auxiliary modules can help you accomplish
    such tasks.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然市场上有很多商业漏洞扫描器，但您并不局限于它们。当您想要在网络上对特定漏洞进行扫描时，Metasploit 的许多辅助模块可以帮助您完成此类任务。
- en: The following Metasploit modules are just a few examples of the many useful
    auxiliary scanning modules included in the Framework. Take advantage of your lab
    to probe and explore as many of them as you can.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 以下 Metasploit 模块只是 Framework 中包含的许多有用辅助扫描模块的几个示例。利用您的实验室来探测和探索尽可能多的它们。
- en: Validating SMB Logins
  id: totrans-125
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 验证 SMB 登录
- en: To check the validity of a username and password combination, use the SMB Login
    Check Scanner to connect to a range of hosts. As you might expect, this scan is
    loud and noticeable, and each login attempt will show up in the event logs of
    *every* Windows box it encounters.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 要检查用户名和密码组合的有效性，请使用 SMB 登录检查扫描器连接到一系列主机。正如您所预期的，这种扫描很响亮且引人注目，并且每次登录尝试都会出现在它遇到的每个
    Windows 机器的事件日志中。
- en: After selecting the *smb_login* module with `use`, you can run `show_options`
    to see the settings listed under the Required column. Metasploit allows you to
    specify a username and password combination, a username and password list, or
    a combination of either. In the next example, `RHOSTS` is set to a small range
    of IP addresses and a username and password are configured for Metasploit to try
    against all addresses.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用 `use` 选择 *smb_login* 模块后，您可以通过运行 `show_options` 来查看在必需列下列出的设置。Metasploit
    允许您指定用户名和密码组合、用户名和密码列表，或两者的组合。在下一个示例中，`RHOSTS` 被设置为一系列 IP 地址，并为 Metasploit 配置了用户名和密码，以便尝试所有地址。
- en: '[PRE19]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: You can see a successful login with user *Administrator* and a password of *s3cr3t*
    at ![](../images/00002.gif). Because workstations are all cloned from one image
    and deployed through the enterprise in many corporate environments, the administrator
    password may well be the same on all of them, granting you access to every workstation
    on the network.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在 ![](../images/00002.gif) 中看到一个成功的登录，用户名为 *Administrator*，密码为 *s3cr3t*。由于工作站都是从同一个镜像克隆而来，并在许多企业环境中通过企业部署，管理员密码可能所有工作站上都是相同的，这使您能够访问网络上的每个工作站。
- en: Scanning for Open VNC Authentication
  id: totrans-130
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 扫描开放 VNC 认证
- en: Virtual network computing (VNC) provides graphical access to remote systems
    in a way that’s similar to Microsoft’s Remote Desktop. VNC installations are common
    throughout corporations, because they provide a GUI-based view of server and workstation
    desktops. VNC is frequently installed to meet a temporary need and then completely
    forgotten and left unpatched, creating a major potential vulnerability. Metasploit’s
    built-in VNC Authentication None scanner searches a range of IP addresses for
    VNC servers that do not have a password configured (that support “None” authentication,
    meaning a blank password). Usually, this scan will turn up nothing of value, but
    a good penetration tester leaves no stone unturned when looking for ways access
    a target system.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 虚拟网络计算（VNC）以类似于微软远程桌面（Remote Desktop）的方式提供对远程系统的图形访问。VNC 安装在许多公司中很常见，因为它们提供了基于
    GUI 的服务器和工作站桌面的视图。VNC 通常被安装来满足临时需求，然后完全被遗忘且未打补丁，从而创建了一个重大的潜在漏洞。Metasploit 内置的
    VNC 认证无密码扫描器在一系列 IP 地址范围内搜索未配置密码（支持“无”认证，即空密码）的 VNC 服务器。通常，这种扫描不会发现有价值的东西，但一个好的渗透测试人员会在寻找访问目标系统的方法时，不放过任何细节。
- en: '* * *'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: Note
  id: totrans-133
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Recent VNC servers do not allow blank passwords. To set one up in your lab for
    testing, use older VNC servers such as RealVNC 4.1.1.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 近期 VNC 服务器不允许使用空密码。为了在您的实验室中设置一个用于测试的环境，请使用较旧的 VNC 服务器，例如 RealVNC 4.1.1。
- en: '* * *'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: 'The VNC scanner, like most Metasploit auxiliary modules, is easy to configure
    and run. The only required configuration for `vnc_none_auth` is to supply it with
    an IP or a range of IPs to scan. Simply select the module, define your `RHOSTS`
    and `THREADS`, if desired, and run it, as shown next:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: VNC 扫描器，就像大多数 Metasploit 辅助模块一样，易于配置和运行。`vnc_none_auth` 所需的唯一配置是提供要扫描的 IP 或
    IP 范围。只需选择模块，定义你的 `RHOSTS` 和 `THREADS`（如果需要），然后运行它，如下所示：
- en: '[PRE20]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: If you get lucky and Metasploit finds a VNC server with no authentication ![](../images/00002.gif),
    you can use Back|Track’s *vncviewer* to connect to the target machine without
    a password, as shown in [Figure 4-18](part0008.html#connecting_to_vnc_with_no_authentication).
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你运气好，Metasploit 找到了一个没有认证的 VNC 服务器 ![没有认证连接 VNC 的 vncviewer](../images/00002.gif)，你可以使用
    Back|Track 的 *vncviewer* 连接到目标机器，无需密码，如图 [图 4-18](part0008.html#connecting_to_vnc_with_no_authentication)
    所示。
- en: '![Connecting to VNC with no authentication using vncviewer](../images/00025.jpeg)Figure 4-18. Connecting
    to VNC with no authentication using *vncviewer*'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '![使用 vncviewer 没有认证连接到 VNC](../images/00025.jpeg) 图 4-18. 使用 *vncviewer* 没有认证连接到
    VNC'
- en: If you think a VNC scan is likely to be a waste of time and that you’ll never
    find systems with open VNC servers enabled, think again. During a large penetration
    test, which included thousands of systems, one of the authors noticed that one
    of those systems had an open VNC server.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你认为 VNC 扫描可能浪费时间，而且你永远找不到启用了开放 VNC 服务器的系统，那么再想想。在一次大规模的渗透测试中，涉及数千个系统，其中一位作者注意到其中一个系统有一个开放的
    VNC 服务器。
- en: 'While the author was in the system documenting his finding, he noticed activity
    on the system. This was overnight on a system that was unlikely to have an authorized
    user on it. While not always considered a best practice, the author pretended
    to be another unauthorized intruder and engaged the intruder in conversation via
    Notepad. The intruder was not very bright and told the author that he was scanning
    large blocks of systems for open VNC servers. Here is a segment of the conversation:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 当作者在系统中记录他的发现时，他注意到系统上有活动。这是在一个不太可能有授权用户在上的系统上，在夜间发生的。虽然这并不总是被认为是一种最佳实践，但作者假装成另一个未授权的入侵者，并通过记事本与入侵者进行对话。入侵者不太聪明，告诉作者他在扫描大量系统以寻找开放的
    VNC 服务器。以下是对话的一段节选：
- en: '*Author:* You in the us? or out of country? I know some people in denmark.*Attacker:*
    I’m from Norway actually, hehe, I have relatives in Denmark.*Author:* You hang
    in any boards? like I used to like some but they have been going away*Attacker:*
    I mostly hang in some programming boards, but not much else. Have you been into
    hacking for a long time or what? What’s your age btw? I’m 22.*Author:* I have
    been on this for like fun for around a year or so. Still in school. 16\. Just
    something to do.*Attacker:* Haven’t been there. I too mostly do this for fun,
    just trying to see what I can do, test my skills. I wrote the “VNC finder” myself
    btw, I have found a lot of servers, but this is the only one where I could actually
    have some fun*Author:* Wow. What did you write it in? Can I dl it? Do you have
    a handle?*Attacker:* It’s written in a language called PureBasic, but it’s kinda
    not ready for release yet, it’s only for my own use. But maybe I can share it
    anyway, I could upload the code somewhere and let you compile it. That is if you
    can find some PureBasic compiler on some warez site :P*Author:* Thats cool. you
    can put it in that pastebin site from irc. That lets you anon post I have not
    done purebasic before. just python and perl*Attacker:* Let me see, I’ll look for
    that pastebin site and upload it, just give me some minutes, I’ll be around.'
  id: totrans-142
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: '*作者:* 你在美国吗？还是在国外？我知道一些人在丹麦。*攻击者:* 实际上我来自挪威，嘿嘿，我在丹麦有亲戚。*作者:* 你在什么论坛上活跃？我以前喜欢一些，但现在它们都消失了。*攻击者:*
    我主要在一些编程论坛上活跃，但其他方面不多。你从事黑客活动很长时间了吗？你多大了？我 22 岁。*作者:* 我大概一年左右只是为了好玩而从事这个。还在上学。16
    岁。只是做点事情。*攻击者:* 我还没有去过。我也主要是为了好玩，只是想看看我能做什么，测试我的技能。顺便说一句，我自己写了“VNC 查找器”，我找到了很多服务器，但这是唯一一个我能真正玩得起来的。*作者:*
    哇。你用它写的什么语言？我能下载吗？你有昵称吗？*攻击者:* 它是用一种叫做 PureBasic 的语言编写的，但还不适合发布，它只是供我自己使用。但也许我可以分享，我可以上传代码到某个地方，让你编译。如果你能在某个破解网站上找到
    PureBasic 编译器的话 :P*作者:* 那太酷了。你可以把它放在那个来自 irc 的 pastebin 网站上。那让你可以匿名发布。我以前没有做过
    PureBasic，只做过 python 和 perl。*攻击者:* 让我看看，我会去找那个 pastebin 网站，上传它，给我几分钟，我会在那儿的。'
- en: The attacker then gave the author a link to a pastebin page with the full source
    for the custom VNC scanner he was using.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 攻击者随后给了作者一个链接，指向一个包含他使用的自定义 VNC 扫描器完整源代码的 pastebin 页面。
- en: Scanning for Open X11 Servers
  id: totrans-144
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 扫描开放 X11 服务器
- en: Metasploit’s built-in *open_x11* scanner is similar to the *vnc_auth* scanner,
    in that it scours a range of hosts for X11 servers that allow users to connect
    with-out authentication. Although X11 servers aren’t widely used today, lots of
    archaic boxes out there are still running old, unpatched, and forgotten operating
    systems. As you’ve seen in the preceding two examples, legacy systems are often
    the most vulnerable systems on a network.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: Metasploit 内置的 *open_x11* 扫描器与 *vnc_auth* 扫描器类似，因为它会扫描一系列主机以寻找允许用户无需身份验证即可连接的
    X11 服务器。尽管 X11 服务器今天并不广泛使用，但许多过时的机器仍在运行旧版、未修补和被遗忘的操作系统。正如您在前两个示例中看到的，遗留系统通常是网络中最易受攻击的系统。
- en: 'To run the *open_x11* scanner, simply configure as you would most other auxiliary
    modules by setting the `RHOSTS` and, optionally, the `THREADS` values. A session
    is shown next. Notice at IP address 192.168.1.23 that the scanner has found an
    open X server. This is a serious vulnerability because it allows an attacker to
    gain unauthenticated access to the system: The X system handles the GUI including
    the mouse and keyboard.'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 要运行 *open_x11* 扫描器，只需像配置大多数其他辅助模块一样设置 `RHOSTS` 和可选的 `THREADS` 值。下面是一个会话示例。注意在
    IP 地址 192.168.1.23，扫描器发现了一个开放的 X 服务器。这是一个严重的漏洞，因为它允许攻击者未经身份验证地访问系统：X 系统处理 GUI
    包括鼠标和键盘。
- en: '[PRE21]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'To see what an attacker could do with a vulnerability like this, start keystroke
    logging using Back|Track’s *xspy* tool, like so:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 为了了解攻击者如何利用这种漏洞，可以使用 Back|Track 的 *xspy* 工具开始按键记录，如下所示：
- en: '[PRE22]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: The *xspy* tool remotely sniffs the X server’s keyboard session and has captured
    a user running SSH to log in as root on a remote system. Vulnerabilities such
    as this can be rare, but when you find them they are extremely valuable.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: '*xspy* 工具远程嗅探 X 服务器的键盘会话，并捕获了一个用户使用 SSH 登录到远程系统以作为 root 用户。这样的漏洞可能很少见，但当你找到它们时，它们非常有价值。'
- en: Using Scan Results for Autopwning
  id: totrans-151
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用扫描结果进行自动攻击
- en: Let’s take a quick diversion into exploitation. Metasploit’s Autopwn tool automatically
    targets and exploits a system using an open port or using the results of a vulnerability
    scan export. You can use Autopwn to harness the results of most vulnerability
    scanners, including NeXpose, Nessus, and OpenVAS.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们快速了解一下利用。Metasploit 的 Autopwn 工具会自动针对并利用一个系统，使用开放的端口或使用漏洞扫描导出的结果。您可以使用 Autopwn
    利用大多数漏洞扫描器的结果，包括 NeXpose、Nessus 和 OpenVAS。
- en: For example, here’s how we could use a Nessus results import to target a system
    and autopwn it. Create a new database with `db_connect` and use `db_import` to
    import the scan report. In the next example, we run `db_autopwn` with a series
    of switches to launch attacks against all targets (`e`), show all matching modules
    (`t`), use a reverse shell payload (`r`), select exploit modules based on vulnerability
    (`x`), and also select based on open ports (`p`). Once `db_autopwn` launches,
    Metasploit begins launching exploits at the targets. Successful exploits return
    a shell to the attacking machine.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，以下是我们可以如何使用 Nessus 结果导入来针对一个系统并自动攻击它的方法。使用 `db_connect` 创建一个新的数据库，并使用 `db_import`
    导入扫描报告。在下一个示例中，我们使用一系列开关运行 `db_autopwn` 以对所有目标发起攻击（`e`），显示所有匹配的模块（`t`），使用反向 shell
    有效载荷（`r`），根据漏洞选择利用模块（`x`），并基于开放端口选择（`p`）。一旦 `db_autopwn` 启动，Metasploit 就开始对目标发起攻击。成功的攻击将返回攻击机器的
    shell。
- en: '[PRE23]'
  id: totrans-154
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Based on these scans, Autopwn launched 72 exploits ![](../images/00002.gif)
    and one was successful, as shown at ![](../images/00004.gif). This exploit allows
    us full access to the machine with a Meterpreter console that will be discussed
    in far more depth in [Chapter 6](part0010.html#meterpreter).
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 基于这些扫描，Autopwn 启动了 72 个利用，其中一个是成功的，如图所示 ![../images/00002.gif]。这个利用允许我们通过 Meterpreter
    控制台完全访问机器，该控制台将在第 6 章中更深入地讨论。[第 6 章](part0010.html#meterpreter)。
- en: '* * *'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: Note
  id: totrans-157
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'One big caveat to remember when using Autopwn: If you’re going in with your
    Autopwn guns blazing, the target system can crash or lose stability. Autopwn has
    useful features not covered here, such as the ability to select only exploits
    that have an “Excellent” ranking, meaning it is very unlikely they will crash
    the remote system or service. For more information on its usage, enter **`db_autopwn
    -h`**.'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Autopwn 时需要注意的一个大前提：如果你带着 Autopwn 的枪支猛烈开火，目标系统可能会崩溃或失去稳定性。Autopwn 有一些有用的功能在这里没有涵盖，例如选择只有“优秀”评分的利用，这意味着它们不太可能使远程系统或服务崩溃。有关其使用的更多信息，请输入
    **`db_autopwn -h`**。
- en: '* * *'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
