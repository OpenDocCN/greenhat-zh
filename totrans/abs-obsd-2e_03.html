<html><head></head><body><section class="chapter" epub:type="chapter" id="installation_walk-through" title="Chapter&#xA0;3.&#xA0;Installation Walk-Through"><div class="titlepage"><div><div><h2 class="title">Chapter 3. Installation Walk-Through</h2></div></div></div><div class="epigraph" epub:type="epigraph"><div class="literallayout"><p><span class="emphasis"><em>Straightforward questions.</em></span><br/>
<span class="emphasis"><em>Will you take the default prompts?</em></span><br/>
<span class="emphasis"><em>Think before you choose.</em></span></p></div></div><p><a class="indexterm" id="idx0107"/><a class="indexterm" id="idx1047"/><a class="indexterm" id="idx1602"/><a class="indexterm" id="idx1636"/><span class="inlinemediaobject"><a id="inline_id00004"/><img alt="" src="httpatomoreillycomsourcenostarchimages1616079.png"/></span> Armed with your OpenBSD software and a computer with supported hardware, you are now ready to start an actual installation. This chapter takes you through a full installation on amd64 and i386 systems via CD and FTP, booting from a CD or floppy disk.</p><p>In this chapter, I assume that you’re dedicating your computer to OpenBSD. You can install multiple operating systems on a single computer, of course, but that’s a less common use case. If you want to install multiple operating systems on your computer, follow the instructions in the OpenBSD FAQ. (When installing multiple operating systems on a single computer, it’s easy to accidentally damage one of those operating systems, so proceed with caution.)</p><p>Before you begin OpenBSD installation, make sure the data on your machine is backed up! When you dedicate your machine to OpenBSD, you’ll overwrite the entire hard drive.</p><div class="sect1" title="Hardware Setup"><div class="titlepage"><div><div><h2 class="title" id="hardware_setup" style="clear: both">Hardware Setup</h2></div></div></div><p><a class="indexterm" id="idx0141"/><a class="indexterm" id="idx0163"/><a class="indexterm" id="idx0236"/><a class="indexterm" id="idx0874"/><a class="indexterm" id="idx0951"/><a class="indexterm" id="idx1051"/><a class="indexterm" id="idx1052"/><a class="indexterm" id="idx1058"/><a class="indexterm" id="idx1624"/>Before you begin, verify that OpenBSD supports your hardware. You’ll find the supported hardware list for the most recent version of OpenBSD on the platform-specific pages of the OpenBSD website (<span class="emphasis"><em><a class="ulink" href="http://www.OpenBSD.org/i386.html" target="_top">http://www.OpenBSD.org/i386.html</a></em></span> for i386 and <span class="emphasis"><em><a class="ulink" href="http://www.OpenBSD.org/amd64.html" target="_top">http://www.OpenBSD.org/amd64.html</a></em></span> for amd64), listing hardware that has been verified to work by the OpenBSD team.</p><p>If you find that your hardware isn’t listed, it might still run OpenBSD. In fact, a lot of unsupported hardware will run OpenBSD perfectly, but not all hardware has been tested, simply because the OpenBSD team doesn’t have access to all hardware ever manufactured. If you’re worried about a particular device, search the mailing list archives to see if it’s supported.</p><p>The hardware compatibility lists frequently identify devices by chipset, not by vendor or model. The chipset is the actual hardware name, not the model name, which can cause a bit of confusion because, after all, when you buy a computer, the network card is frequently listed as a “gigabit Ethernet,” not as an “Intel PRO/1000MT Dual Port Server Adapter model PWLA8492MT.” To make matters worse, many vendors use identical hardware under a separate brand or model name or use different hardware under the same brand or model name. For example, Linksys sold many different network card models under the model name EtherLink. (Fortunately, this issue mostly applies to the lower end of the market, and OpenBSD almost always supports these older chipsets.)</p><p>Even if you’re not sure that you hardware is supported, you can still try installing OpenBSD to see what happens. The boot messages will offer a lot of information about the hardware you have.</p></div><div class="sect1" title="BIOS Configuration"><div class="titlepage"><div><div><h2 class="title" id="bios_configuration" style="clear: both">BIOS Configuration</h2></div></div></div><p>Be sure to evaluate your system’s Basic Input/Output System (BIOS) before installing OpenBSD. Because every BIOS differs, I can’t offer exact instructions on configuring yours. Your best bet is to consult your motherboard’s manual or the Internet.</p><p>Also, if your BIOS needs updating, take care of that before installing OpenBSD. Finally, check the boot device order, and be sure that it makes sense for how you plan to install your system.</p><p>With your hardware set up, get the boot media.</p></div><div class="sect1" title="Making Boot Media"><div class="titlepage"><div><div><h2 class="title" id="making_boot_media" style="clear: both">Making Boot Media</h2></div></div></div><p>We’ll cover booting the OpenBSD installer from a CD or floppy disk. Generally, booting via CD is preferable because all amd64 systems can boot from CD, as can most functioning i386 systems. We’ll start by making floppies for installation on old i386 hardware and then move on to CDs. While installing from USB and into virtual systems is possible, neither is supported. We’ll cover both of those installation types later in the book, in <a class="xref" href="ch23.html" title="Chapter 23. Customizing OpenBSD">Chapter 23</a>.</p><div class="sect2" title="Making Boot Floppies"><div class="titlepage"><div><div><h3 class="title" id="making_boot_floppies">Making Boot Floppies</h3></div></div></div><p><a class="indexterm" id="idx0049"/><a class="indexterm" id="idx0165"/><a class="indexterm" id="idx0374"/><a class="indexterm" id="idx0436"/><a class="indexterm" id="idx0875"/><a class="indexterm" id="idx0876"/><a class="indexterm" id="idx0877"/><a class="indexterm" id="idx0999"/><a class="indexterm" id="idx1054"/><a class="indexterm" id="idx2495"/>You need to make boot floppies only if your hardware does not boot from CD, or if you have a floppy but not a CD drive. The OpenBSD boot floppies contain a very limited subset of OpenBSD—just enough to recognize your hardware, format your disk, and download and extract the file sets. In addition to the floppies themselves, you’ll also need a working Internet connection via Ethernet.<sup>[<a class="footnote" epub:type="noteref" href="#ftn.id346326" id="id346326">8</a>]</sup> Because the full kernel is larger than a single floppy can hold, OpenBSD provides three floppy images for i386 hardware, each targeting a specific type of hardware. Each image name includes the release number. For example, the floppy images for release 5.3 are named <span class="emphasis"><em>floppy53.fs</em></span>, <span class="emphasis"><em>floppyB53.fs</em></span>, and <span class="emphasis"><em>floppyC53.fs</em></span>. Download the image that most closely describes your system, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p title="floppyXX.fs"><span class="title"><strong><span class="bolditalic">floppyXX.fs</span></strong></span>. This is the image for the most common i386 hardware. It will boot the average workstation or low-end server.</p></li><li class="listitem" style="list-style-type: none"><p title="floppyBXX.fs"><span class="title"><strong><span class="bolditalic">floppyBXX.fs</span></strong></span>. This image includes drivers for gigabit Ethernet cards, SCSI, and RAID. It’s meant for higher-end i386 servers.</p></li><li class="listitem" style="list-style-type: none"><p title="floppyCXX.fs"><span class="title"><strong><span class="bolditalic">floppyCXX.fs</span></strong></span>. This image supports PCMCIA and CardBus. It’s meant for laptops.</p></li></ul></div><p>OpenBSD provides only one floppy image for amd64 hardware: <span class="emphasis"><em>floppyXX.fs</em></span>. (The amd64 platform doesn’t carry around 20 years of legacy drivers as baggage, so everything fits on a single disk.) Be sure to use the floppy image found in the amd64 directory. The amd64 image uses the same name as the standard i386 floppy.</p><p>Once you have the appropriate image file, you must copy it onto a floppy disk. You cannot use basic filesystem-level copying, such as Windows drag-and-drop, because the image files include not only files but also a filesystem. You must use appropriate tools to copy the images to a floppy.</p><div class="sect3" title="Creating Floppies on Unix-like Systems"><div class="titlepage"><div><div><h4 class="title" id="creating_floppies_on_unix-like_systems">Creating Floppies on Unix-like Systems</h4></div></div></div><p>If you’re already running a Unix-like system, create your floppy with <code class="literal">dd(1)</code>. You’ll need to know your floppy drive’s device name, which is probably <span class="emphasis"><em>/dev/fd0</em></span>, <span class="emphasis"><em>/dev/floppy</em></span>, <span class="emphasis"><em>/dev/rfd0</em></span>, or <span class="emphasis"><em>/dev/rsd0</em></span> (for USB floppy drives). Once you know the device name, tell <code class="literal">dd</code> to copy the image to that disk device with a command like this:</p><a id="I_programlisting3_id429098"/><pre class="programlisting"># dd if=<span class="emphasis"><em>filename</em></span> of=<span class="emphasis"><em>full-path-to-floppy-device</em></span></pre><p>For example, to create a disk from image <span class="emphasis"><em>floppyB52.fs</em></span> with the floppy device name <span class="emphasis"><em>/dev/fd0c</em></span>, enter the following:</p><a id="I_programlisting3_id429119"/><pre class="programlisting"># <span class="strong"><strong>dd if=floppyB52.fs of=/dev/fd0c</strong></span></pre><p><a class="indexterm" id="idx0164"/><a class="indexterm" id="idx0219"/><a class="indexterm" id="idx0231"/><a class="indexterm" id="idx0232"/><a class="indexterm" id="idx0234"/><a class="indexterm" id="idx0237"/><a class="indexterm" id="idx0240"/><a class="indexterm" id="idx0299"/><a class="indexterm" id="idx0457"/><a class="indexterm" id="idx1053"/><a class="indexterm" id="idx1063"/><a class="indexterm" id="idx1368"/><a class="indexterm" id="idx1369"/><a class="indexterm" id="idx1560"/><a class="indexterm" id="idx1565"/><a class="indexterm" id="idx1612"/><a class="indexterm" id="idx1751"/><a class="indexterm" id="idx2659"/>If <code class="literal">dd</code> gives you an error immediately or exits silently without writing to the floppy disk, try specifying a different floppy disk device.</p></div><div class="sect3" title="Creating Floppies on Microsoft Systems"><div class="titlepage"><div><div><h4 class="title" id="creating_floppies_on_microsoft_systems">Creating Floppies on Microsoft Systems</h4></div></div></div><p>If you need to create a floppy on a descendant of Windows NT (including all modern Windows desktop operating systems), you’ll need an image-writing program. In the <span class="emphasis"><em>tools</em></span> directory of your OpenBSD release, you’ll find a program named <span class="emphasis"><em>ntrw.exe</em></span>. This program copies disk images to a disk. Download the program, open a command prompt, navigate to the folder containing <span class="emphasis"><em>ntrw.exe</em></span>, put your blank floppy in the drive, and run this command:</p><a id="I_programlisting3_id429311"/><pre class="programlisting">C:&gt; <span class="strong"><strong>ntrw floppyB53.fs a:</strong></span></pre><p>If you get a permissions error, you might need to run your command prompt as Administrator. If the command still fails, chances are good that you’re using the bad floppy disk you tucked away in a drawer 15 years ago. Try another one.</p></div></div><div class="sect2" title="Making Boot CDs"><div class="titlepage"><div><div><h3 class="title" id="making_boot_cds">Making Boot CDs</h3></div></div></div><p>OpenBSD provides three ISO images for i386 and two for amd64, as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p title="cdXX.iso"><span class="title"><strong><span class="bolditalic">cdXX.iso</span></strong></span>. This image contains the kernel and installer, but no file sets. It’s used to boot a system into the minimal state where the installer can run. Once the system has booted, it fetches the file sets over the network.</p></li><li class="listitem" style="list-style-type: none"><p title="installXX.iso"><span class="title"><strong><span class="bolditalic">installXX.iso</span></strong></span>. This image contains everything in the <span class="emphasis"><em>cdXX.iso</em></span> image, as well as the file sets. Use it to install this version of OpenBSD on multiple systems.</p></li><li class="listitem" style="list-style-type: none"><p title="cdemuXX.iso"><span class="title"><strong><span class="bolditalic">cdemuXX.iso</span></strong></span>. Some older i386 systems have a BIOS that makes CD drives emulate floppy drives. If you have a system like this, use <span class="emphasis"><em>cdemuXX.iso</em></span>. If you’re unsure whether you need this image, you don’t. If you’ve ever owned one of these CD drives, you’ve probably replaced it by now. If you haven’t, maybe you should.</p></li></ul></div><div class="note" title="Note"><h3 class="title"><a id="ch03note01"/>Note</h3><p>Remember that you can save yourself the trouble of selecting an ISO by buying an official CD set, which will Just Work and will also contain precompiled packages.</p></div><p>The process of getting the ISO onto a physical disk varies widely from operating system to operating system. On a Microsoft Windows system, right-click the ISO and select <span class="strong"><strong>Burn to Disc</strong></span>. Unix-like systems use several different programs, such as <code class="literal">burncd</code> and <code class="literal">cdrecord</code>. Different Linux versions have innumerable ISO-burning front ends integrated into their desktop environments. Check online for instructions on burning a CD on your particular operating system.</p></div></div><div class="sect1" title="Installing OpenBSD"><div class="titlepage"><div><div><h2 class="title" id="installing_openbsd" style="clear: both">Installing OpenBSD</h2></div></div></div><p><a class="indexterm" id="idx0173"/><a class="indexterm" id="idx0433"/><a class="indexterm" id="idx1060"/><a class="indexterm" id="idx1084"/><a class="indexterm" id="idx2127"/><a class="indexterm" id="idx2128"/>Once you boot from your chosen media, you should see something like this:</p><a id="I_programlisting3_id429486"/><pre class="programlisting">&gt; OpenBSD/amd64 BOOT 3.18
boot&gt;</pre><p>If you need to interrupt the boot process for any reason, you can do so at this point. We’ll discuss how to interrupt the boot process in <a class="xref" href="ch05.html" title="Chapter 5. The Boot Process">Chapter 5</a>, and reasons for doing so throughout the book.</p><p>If you wait five seconds, OpenBSD should boot. The kernel will then introduce itself and begin identifying your hardware.</p><a id="I_programlisting3_id429504"/><pre class="programlisting">  booting <span class="strong"><strong>1</strong></span>cd0a:/5.3/amd64/bsd.rd: 2986868+913996+2861496+0+504624 [89+318288+205653]=0xb6f578
  entry point at 0x1001e0 [7205c766, 34000004, 24448b12, 1608a304]
  Copyright (c) 1982, 1986, 1989, 1991, 1993
      The Regents of the University of California.  All rights reserved.
  Copyright (c) 1995-2012 OpenBSD. All rights reserved.  http://www.OpenBSD.org
<span class="strong"><strong>2</strong></span> OpenBSD 5.3 (RAMDISK_CD) #23: Sun Feb 12 09:45:07 MST 2012
    deraadt@amd64.openbsd.org:/usr/src/sys/arch/amd64/compile/RAMDISK_CD
  real mem = 1072627712 (1022MB)
  avail mem = 1032290304 (984MB)
  …</pre><p>In this output, you can tell at <span class="strong"><strong>1</strong></span> from which device the system is booting—CD drive 0 in this case. Next, you see the copyright information, followed by the directory in which your kernel was compiled at <span class="strong"><strong>2</strong></span>. You can see that this is an OpenBSD snapshot kernel, compiled by user <code class="literal">deraadt</code> on host <span class="emphasis"><em>amd64.openbsd.org</em></span>.</p><p>At this point, OpenBSD should probe your hardware and display the results as it attaches device drivers.</p><div class="sect2" title="Running the Installation Program"><div class="titlepage"><div><div><h3 class="title" id="running_the_installation_program">Running the Installation Program</h3></div></div></div><p>Once the boot messages pass, you should see the following text:</p><a id="I_programlisting3_id429569"/><pre class="programlisting">Welcome to the OpenBSD/amd64 5.3 installation program.
(I)nstall, (U)pgrade or (S)hell? <span class="strong"><strong>i</strong></span></pre><p>As you can see, there are three options: Install, Upgrade, and Shell. The OpenBSD installer is a shell script that calls programs to download files, format disks, and otherwise prepare your system. It might not be pretty, but it is extremely fast and, in educated hands, extremely powerful.</p><p>The Shell option will drop you into an OpenBSD command line, where you have access to the commands on the installation disk. These minimal commands might suffice to repair a damaged system. We’ll examine the Upgrade option in <a class="xref" href="ch20.html" title="Chapter 20. Upgrading">Chapter 20</a>.</p><p><a class="indexterm" id="idx0383"/><a class="indexterm" id="idx0444"/><a class="indexterm" id="idx0987"/><a class="indexterm" id="idx1487"/><a class="indexterm" id="idx2246"/><a class="indexterm" id="idx2612"/><a class="indexterm" id="idx2625"/>Enter <span class="strong"><strong><code class="literal">i</code></strong></span> to choose Install. You should see a welcome message and a few basic instructions:</p><a id="I_programlisting3_id429660"/><pre class="programlisting">  At any prompt except password prompts you can escape to a shell by
  typing '!'. Default answers are shown in []'s and are selected by
  pressing RETURN.  You can exit this program at any time by pressing
  Control-C, but this can leave your system in an inconsistent state.
<span class="strong"><strong>1</strong></span> Terminal type? [vt220]
<span class="strong"><strong>2</strong></span> System hostname? (short form, e.g. 'foo') <span class="strong"><strong>caddis</strong></span></pre><p>The installer shows default answers in square brackets. To use the default, just press <span class="smallcaps">ENTER</span>.</p><p>If your system has a standard keyboard and monitor, OpenBSD will use it as the standard VT220 terminal, as shown at <span class="strong"><strong>1</strong></span>. If you have an unusual terminal connected to your system, you’re probably an old geezer who knows exactly what terminal type it is. If you’re a young kid using some ancient, unidentified, dust-covered terminal found in a disused laboratory at the back of an abandoned fireworks factory because you thought it would be nifty, stop now and get a standard monitor and keyboard. While OpenBSD probably supports that antediluvian console, this is not the time to try it.</p><p>Next, the installer should prompt you for the system’s short hostname at <span class="strong"><strong>2</strong></span>, which will be a single word to identify your system. This particular computer is named <code class="literal">caddis</code>; you can name yours whatever you like.</p><p>Now to configure the network:</p><a id="I_programlisting3_id429726"/><pre class="programlisting"><span class="strong"><strong>1</strong></span> Available network interfaces are: em0 em1 vlan0.
<span class="strong"><strong>2</strong></span> Which one do you wish to configure? (or 'done') [em0]
<span class="strong"><strong>3</strong></span> IPv4 address for em0? (or 'dhcp' or 'none') [dhcp] <span class="strong"><strong>192.0.2.85</strong></span>
<span class="strong"><strong>4</strong></span> Netmask? [255.255.255.0] <span class="strong"><strong>255.255.255.128</strong></span>
<span class="strong"><strong>5</strong></span> IPv6 address for em0? (or 'rtsol' or 'none') [none]
  Available network interfaces are: em0 em1 vlan0.
<span class="strong"><strong>6</strong></span> Which one do you wish to configure? (or 'done') [done]
<span class="strong"><strong>7</strong></span> Default IPv4 route? (IPv4 address, 'dhcp' or 'none') <span class="strong"><strong>192.0.2.1</strong></span>
  add net default: gateway 192.0.2.1
<span class="strong"><strong>8</strong></span> DNS domain name? (e.g. 'bar.com') [my.domain] <span class="strong"><strong>blackhelicopters.org</strong></span>
<span class="strong"><strong>9</strong></span> DNS nameservers? (IP address list or 'none') [none] <span class="strong"><strong>192.0.2.2 192.0.2.10</strong></span></pre><p>At <span class="strong"><strong>1</strong></span>, the installer lists the network interfaces it recognizes on your machine. It has found three: <code class="literal">em0</code>, <code class="literal">em1</code>, and <code class="literal">vlan0</code>. The first two, <code class="literal">em0</code> and <code class="literal">em1</code>, are network cards. I chose <code class="literal">em0</code> at <span class="strong"><strong>2</strong></span>, the installer’s default, by pressing <span class="smallcaps">ENTER</span>. Avoid configuring a virtual local area network (VLAN) during installation if possible, especially on your first installation. If you need a VLAN to connect to the Internet, see <a class="xref" href="ch12.html" title="Chapter 12. Connecting to the Network">Chapter 12</a>.</p><p>When asked at <span class="strong"><strong>3</strong></span> if you want to give a static IP address, you can choose to use DHCP by pressing <span class="smallcaps">ENTER</span>. I chose to enter a static address because I’ll be using this machine as a server. (If you don’t need a static address, you can just let DHCP automatically assign you an IP address.)</p><p><a class="indexterm" id="idx0006"/><a class="indexterm" id="idx0793"/><a class="indexterm" id="idx1059"/><a class="indexterm" id="idx1114"/><a class="indexterm" id="idx1418"/><a class="indexterm" id="idx1468"/><a class="indexterm" id="idx1476"/><a class="indexterm" id="idx1485"/><a class="indexterm" id="idx1883"/>When you use a static address, you must also enter a netmask at <span class="strong"><strong>4</strong></span> and (if desired) an IPv6 address at <span class="strong"><strong>5</strong></span>. Now, having configured one network card, OpenBSD asks at <span class="strong"><strong>6</strong></span> if you’ve finished configuring the network. If you wanted the installer to walk you through configuring the second network card, you would enter <code class="literal">em1</code> instead of accepting the default of <code class="literal">done</code>.</p><p>If you assign a static IP address, you must also configure a static route if you want to access the Internet, as shown at <span class="strong"><strong>7</strong></span>. Similarly, you need to tell your host its domain name at <span class="strong"><strong>8</strong></span> and the IP address of at least one name server at <span class="strong"><strong>9</strong></span>.</p><p>At this point, you should be on your local network. If you can’t access the network, you probably entered something incorrectly. If nothing else, you can use an exclamation point (<code class="literal">!</code>) to interrupt the installation and get a shell prompt. (<a class="xref" href="ch12.html" title="Chapter 12. Connecting to the Network">Chapter 12</a> discusses OpenBSD’s network configuration in greater depth.)</p></div><div class="sect2" title="Multiple Network Cards"><div class="titlepage"><div><div><h3 class="title" id="multiple_network_cards">Multiple Network Cards</h3></div></div></div><p>Our example server has multiple network interfaces. I chose to configure interface <code class="literal">em0</code> because that machine was in front of me, and if I chose the wrong network card, I could move the cable. But what if you don’t have physical access to your machine? If you had two different network cards (say, an Intel and a 3Com), you would have a better idea which card is which, but having two identical cards leaves you guessing which card has a cable plugged into which network.</p><p>Luckily, the OpenBSD installer lets you escape to a command prompt to do a little investigating. How is this useful here? Network interfaces that are plugged in will tell you what kind of connection they have, and disconnected or otherwise failed interfaces will report that they have no media. Here’s how you can interrupt the installer to identify the live interface:</p><a id="I_programlisting3_id430049"/><pre class="programlisting">  Available network interfaces are: em0 em1 vlan0.
<span class="strong"><strong>1</strong></span> Which one do you wish to configure? (or 'done') [em0] <span class="strong"><strong>!</strong></span>
  Type 'exit' to return to install.
<span class="strong"><strong>2</strong></span> # <span class="strong"><strong>ifconfig</strong></span>
  lo0: flags=8008&lt;LOOPBACK,MULTICAST&gt; mtu 33152
  em0: flags=8802&lt;BROADCAST,SIMPLEX,MULTICAST&gt; mtu 1500
        lladdr 00:0c:29:aa:09:21
<span class="strong"><strong>3</strong></span>       media: Ethernet autoselect (1000baseT full-duplex,master)
        status: unknown
  em1: flags=8802&lt;BROADCAST,SIMPLEX,MULTICAST&gt; mtu 1500
        lladdr 00:0c:29:aa:09:2b
<span class="strong"><strong>4</strong></span>       media: Ethernet autoselect (none)
        status: unknown
  vlan0: flags=0&lt;&gt; mtu 1500
        lladdr 00:00:00:00:00:00</pre><p>Rather than choosing an interface, escape to a command prompt at <span class="strong"><strong>1</strong></span> by entering an exclamation point (<code class="literal">!</code>). Then ask OpenBSD at <span class="strong"><strong>2</strong></span> to tell you about its network interfaces by running <code class="literal">ifconfig</code>. You can see interfaces <code class="literal">em0</code> and <code class="literal">em1</code> in the output. While <code class="literal">em0</code> reports at <span class="strong"><strong>3</strong></span> that it’s running 1000baseT at full-duplex, at <span class="strong"><strong>4</strong></span> you can see that <code class="literal">em1</code> has a media type of <code class="literal">none</code>. Interface <code class="literal">em0</code> is plugged in, so that’s the interface I want to configure. Enter <span class="strong"><strong><code class="literal">exit</code></strong></span> to return to the installer, and proceed to configure card <code class="literal">em0</code>.</p></div><div class="sect2" title="Setting Up Services and the First User"><div class="titlepage"><div><div><h3 class="title" id="setting_up_services_and_the_first_user">Setting Up Services and the First User</h3></div></div></div><p><a class="indexterm" id="idx0924"/><a class="indexterm" id="idx1062"/><a class="indexterm" id="idx1508"/><a class="indexterm" id="idx1555"/><a class="indexterm" id="idx1733"/><a class="indexterm" id="idx1984"/><a class="indexterm" id="idx2094"/><a class="indexterm" id="idx2216"/><a class="indexterm" id="idx2668"/><a class="indexterm" id="idx2676"/><a class="indexterm" id="idx2683"/>The installer should now ask you to configure some basic system parameters:</p><a id="I_programlisting3_id430276"/><pre class="programlisting"><span class="strong"><strong>1</strong></span> Password for root account? (will not echo)
  Password for root account? (again)
<span class="strong"><strong>2</strong></span> Start sshd(8) by default? [yes]
<span class="strong"><strong>3</strong></span> Start ntpd(8) by default? [no] <span class="strong"><strong>yes</strong></span>
  NTP server? (hostname or 'default') [default]
<span class="strong"><strong>4</strong></span> Do you expect to run the X Window System? [yes]
<span class="strong"><strong>5</strong></span> Do you want the X Window System to be started by xdm(1)? [no]
<span class="strong"><strong>6</strong></span> Change the default console to com0? [no]</pre><p>At <span class="strong"><strong>1</strong></span>, enter your root password twice. If the passwords don’t match, the installer will make you do it over until they do.</p><p>You can enable the Secure Shell (SSH) daemon at <span class="strong"><strong>2</strong></span> so that you can remotely connect to this machine immediately after installation. If you enable SSH but do not create a user later in the installation, you can SSH to the machine as root. This is a Very Bad Idea when using password authentication and will let intruders more easily compromise your server. If you enable <code class="literal">sshd</code> here, be absolutely certain to create a user during the installation process! If you don’t, at least disable SSH logins by the root account immediately after installing OpenBSD, as discussed in <a class="xref" href="ch04.html" title="Chapter 4. Post-Install Setup">Chapter 4</a>.</p><p>Correct time is important on a network. I usually enable the Network Time Protocol (NTP) daemon <code class="literal">ntpd(8)</code> during the installation process, as shown at <span class="strong"><strong>3</strong></span>. OpenBSD chooses a set of publicly accessible time servers by default, but you can specify a local time server if you have one available.</p><p>Now tell the installer at <span class="strong"><strong>4</strong></span> if you intend to run X Windows. X requires that software be permitted fairly broad access into the kernel. If the installer detects a graphic console, it defaults to permitting X. If you don’t need a graphic console, disable X access.</p><p>If you’re running X, you might also want the X display manager <code class="literal">xdm(1)</code>. At <span class="strong"><strong>5</strong></span>, tell the installer if you want <code class="literal">xdm</code>. By default, OpenBSD doesn’t start <code class="literal">xdm</code> when it boots; you’re generally better off installing OpenBSD on your system than configuring X, so I’ve accepted the default of <code class="literal">no</code> here.</p><p>If you want this system to use a serial port as the console, you can set that during the installation at <span class="strong"><strong>6</strong></span>. I discuss serial consoles in <a class="xref" href="ch05.html" title="Chapter 5. The Boot Process">Chapter 5</a>.</p><div class="note" title="Note"><h3 class="title"><a id="ch03note02"/>Note</h3><p>For the basic system parameters, I’ve used the default for all but one. Enabling time service certainly isn’t mandatory—I could easily enable <code class="literal">ntpd</code> after installation instead. I could have also told the installer to disable X, but I can change that after installation as well.</p></div><p><a class="indexterm" id="idx0140"/><a class="indexterm" id="idx0260"/><a class="indexterm" id="idx0296"/><a class="indexterm" id="idx1061"/><a class="indexterm" id="idx2215"/><a class="indexterm" id="idx2426"/><a class="indexterm" id="idx2555"/><a class="indexterm" id="idx2579"/>Now to set up your first user.</p><a id="I_programlisting3_id430504"/><pre class="programlisting">Setup a user? (enter a lower-case loginname, or 'no') [no] <span class="strong"><strong>mwlucas</strong></span>
Full user name for mwlucas? [mwlucas] <span class="strong"><strong>Michael W Lucas</strong></span>
Password for mwlucas account? (will not echo)
Password for mwlucas account? (again)
Since you set up a user, disable sshd(8) logins to root? [yes]</pre><p>My usual user account name is <code class="literal">mwlucas</code>. Here, I enter that username, along with a real name entry. The installer creates this account and gives it permission to use the root password (see <a class="xref" href="ch06.html" title="Chapter 6. User Management">Chapter 6</a>). You should be prompted twice for the user’s password.</p><div class="note" title="Note"><h3 class="title"><a id="ch03note03"/>Note</h3><p>You’re offered a chance to disable root logins over SSH. Use this default. The root account should never be permitted to log in via SSH, unless using public key authentication, and even then, those logins should be restricted. For the reasons to avoid root logins over SSH, do an Internet search for “Hail Mary Cloud.”</p></div></div><div class="sect2" title="Setting the Time Zone"><div class="titlepage"><div><div><h3 class="title" id="setting_the_time_zone-id00001">Setting the Time Zone</h3></div></div></div><p>Set your time zone during installation. If you have Internet access when you install OpenBSD, the installer should try to determine your time zone. OpenBSD assumes that the BIOS clock is set in Coordinated Universal Time (UTC). If the BIOS clock is set in some other time zone, you’ll need to correct the system time after installation.</p><p>I’m in Detroit, Michigan. If you’re familiar with US geography, you might think that I need US Eastern Time, but my state has its own time zone.</p><a id="I_programlisting3_id430568"/><pre class="programlisting"><span class="strong"><strong>1</strong></span> What timezone are you in? ('?' for list) [US/Eastern] <span class="strong"><strong>?</strong></span>
  Africa/      Chile/       GB-Eire      Israel       NZ-CHAT      UCT
  America/     Cuba         GMT          Jamaica      Navajo       US/
  Antarctica/  EET          GMT+0        Japan        PRC          UTC
  Arctic/      EST          GMT-0        Kwajalein    PST8PDT      Universal
  Asia/        EST5EDT      GMT0         Libya        Pacific/     W-SU
  Atlantic/    Egypt        Greenwich    MET          Poland       WET
  Australia/   Eire         HST          MST          Portugal     Zulu
  Brazil/      Etc/         Hongkong     MST7MDT      ROC          posix/
  CET          Europe/      Iceland      Mexico/      ROK          posixrules
  CST6CDT      Factory      Indian/      Mideast/     Singapore    right/
  Canada/      GB           Iran         NZ           Turkey
<span class="strong"><strong>2</strong></span> What timezone are you in? ('?' for list) [US/Eastern] <span class="strong"><strong>US</strong></span>
<span class="strong"><strong>3</strong></span> What sub-timezone of 'US' are you in? ('?' for list) <span class="strong"><strong>?</strong></span>
  Alaska          Central         Hawaii          Mountain        Samoa
  Aleutian        East-Indiana    Indiana-Starke  Pacific
  Arizona         Eastern         Michigan        Pacific-New
<span class="strong"><strong>4</strong></span> What timezone are you in? ('?' for list) [US/Eastern] <span class="strong"><strong>US/Michigan</strong></span></pre><p><a class="indexterm" id="idx0461"/><a class="indexterm" id="idx1056"/><a class="indexterm" id="idx1334"/><a class="indexterm" id="idx1693"/><a class="indexterm" id="idx1708"/><a class="indexterm" id="idx1981"/>I don’t recall my exact time zone, but I know it isn’t plain old US Eastern Time. I enter a question mark (<span class="strong"><strong><code class="literal">?</code></strong></span>) at <span class="strong"><strong>1</strong></span> to see the available options. I don’t recognize any of the time zones listed at <span class="strong"><strong>2</strong></span> as correct for my city, but I know I’m in a US time zone, so I enter <span class="strong"><strong><code class="literal">US</code></strong></span>. I don’t know what my choices of sub-time zones are, so I enter a question mark (<span class="strong"><strong><code class="literal">?</code></strong></span>) at <span class="strong"><strong>3</strong></span> to see the US time zones. And there’s Michigan! At <span class="strong"><strong>4</strong></span>, I enter the full time zone name.<sup>[<a class="footnote" epub:type="noteref" href="#ftn.id320931" id="id320931">9</a>]</sup></p></div><div class="sect2" title="Setting Up the Disk"><div class="titlepage"><div><div><h3 class="title" id="setting_up_the_disk">Setting Up the Disk</h3></div></div></div><p>As noted earlier, in a dedicated installation, the installer erases all data on the drive. Unlike most other operating system installers, the OpenBSD installer doesn’t warn you about this; it assumes that you understand the implications of repartitioning your hard drive.</p><p>For this first installation, we’ll use OpenBSD’s default partitioning scheme. (We’ll discuss custom partitioning later in this chapter.) Our demo server has a single disk. We’ll first create an MBR partition on this disk and then add OpenBSD partitions.</p><a id="I_programlisting3_id430757"/><pre class="programlisting">Available disks are: sd0.
Which one is the root disk? (or 'done') [sd0]
Use DUIDs rather than device names in fstab? [yes]</pre><p>The installer tells us that it sees one disk, device <code class="literal">sd0</code>. The installer must know which disk will hold the root partition. (With only a single disk this seems superfluous, but it becomes important if you system has we’ll see an example with multiple disks, as discussed in <a class="xref" href="ch03.html#custom_disk_layout" title="Custom Disk Layout">Custom Disk Layout</a>.) When you have only one disk, OpenBSD assumes that you’ll use it. It also asks if you want to use the disk’s DUID in the filesystem table rather than the device name. For reasons we’ll discuss in <a class="xref" href="ch08.html" title="Chapter 8. Disks and Filesystems">Chapter 8</a>, always answer <span class="strong"><strong><code class="literal">yes</code></strong></span> to this.</p><p>The installer will now show you the MBR partition table.</p><a id="I_programlisting3_id430794"/><pre class="programlisting">Disk: sd0       geometry: 6527/ 255/ 63 [ 104857600 Sectors]
Offset: 0       Signature: 0xAA55
            Starting         Ending         LBA Info:
 #: id      C   H   S -      C   H   S [       start:        size ]
------------------------------------------------------------------------------
 0: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
 1: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
 2: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
 3: 00      0   0   0 -      0   0   0 [           0:           0 ] unused
Use (W)hole disk, use the (O)penBSD area, or (E)dit the MBR? [whole]
Setting OpenBSD MBR partition to whole sd0…done.</pre><p><a class="indexterm" id="idx0829"/><a class="indexterm" id="idx1057"/>The first line shows the detected hard drive geometry. This particular drive has 6527 cylinders, 255 heads, and 63 sectors per cylinder. If you compare this to the label on the physical drive, it almost certainly won’t match (because hard drives lie). But note that this translated geometry has exactly the same number of sectors as shown in the hard drive documentation.</p><p>Beneath this line, you see the existing MBR partition table. The partitions are all zeroed out, which means that this drive has no partitions. We want only OpenBSD on this machine, so take the default and let OpenBSD swallow the whole drive.</p><p>Now it’s time to consider your OpenBSD partitions.</p><a id="I_programlisting3_id430836"/><pre class="programlisting">  The auto-allocated layout for sd0 is:
    #              size           offset  fstype [fsize bsize cpg]
<span class="strong"><strong>1</strong></span>   a:             1.0G               64  4.2BSD   2048 16384    1 # /
    b:             1.2G          2097216    swap
    c:            50.0G                0  unused
    d:             3.6G          4716480  4.2BSD   2048 16384    1 # /tmp
    e:             5.7G         12176320  4.2BSD   2048 16384    1 # /var
    f:             2.0G         24063040  4.2BSD   2048 16384    1 # /usr
    g:             1.0G         28257344  4.2BSD   2048 16384    1 # /usr/X11R6
    h:             6.3G         30354496  4.2BSD   2048 16384    1 # /usr/local
    i:             1.9G         43566400  4.2BSD   2048 16384    1 # /usr/src
    j:             2.0G         47467072  4.2BSD   2048 16384    1 # /usr/obj
    k:            25.4G         51661376  4.2BSD   2048 16384    1 # /home
<span class="strong"><strong>2</strong></span> Use (A)uto layout, (E)dit auto layout, or create (C)ustom layout? [a]
<span class="strong"><strong>3</strong></span> /dev/rsd0a: 1024.0MB in 2097152 sectors of 512 bytes
  6 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
  …</pre><p>Our first partition at <span class="strong"><strong>1</strong></span> is <code class="literal">a</code>, which occupies 1GB and will be used as the root partition (<span class="emphasis"><em>/</em></span>). On the installed system, this will be known as partition <code class="literal">sd0a</code>. Look down the list to see all of the standard partitions discussed in <a class="xref" href="ch02.html" title="Chapter 2. Installation Preparations">Chapter 2</a>.</p><p>We could do custom disk partitioning at this point, but for our first installation, we’ll use the defaults, as shown at <span class="strong"><strong>2</strong></span>. The installer should then label the disk and <span class="strong"><strong>3</strong></span> create filesystems on all the partitions.</p></div><div class="sect2" title="Choosing File Sets"><div class="titlepage"><div><div><h3 class="title" id="choosing_file_sets-id00001">Choosing File Sets</h3></div></div></div><p>Now that you have allocated disk space, let’s put the operating system onto the disk. The installer starts by asking some basic questions about how to get the sets.</p><a id="I_programlisting3_id430925"/><pre class="programlisting">Let's install the sets!
Location of sets? (cd disk ftp http or 'done') [cd] <span class="strong"><strong>1</strong></span> <span class="strong"><strong>ftp</strong></span>
HTTP/FTP proxy URL? (e.g. 'http://proxy:8080', or 'none') [none]
Server? (hostname, list#, 'done' or '?') [ftp5.usa.openbsd.org] <span class="strong"><strong>2</strong></span> <span class="strong"><strong>ftp.lambdaserver.com</strong></span>
Server directory? [pub/OpenBSD/5.3/amd64]
Login? [anonymous]</pre><p>Although I booted this system off a CD, I’m going to install the file sets via <span class="strong"><strong>1</strong></span> FTP. If my network needed to use a proxy to access the Internet, I would tell the installer.</p><p><a class="indexterm" id="idx0863"/><a class="indexterm" id="idx0902"/>While the installer will choose an FTP server for you at <span class="strong"><strong>2</strong></span>, you can specify an FTP server that you know is close or fast. If you’re installing a snapshot, give the file path to the desired snapshot on the FTP server. Finally, if this FTP server requires a username and password, enter it here.</p><p>At this point, the installer should log in to the FTP server, find all available file sets, and display them for your approval.</p><a id="I_programlisting3_id430996"/><pre class="programlisting">Select sets by entering a set name, a file name pattern or 'all'. De-select
sets by prepending a '-' to the set name, name pattern or 'all'. Selected
sets are labelled '[X]'.
    [X] bsd           [X] etc53.tgz     [X] xbase53.tgz   [X] xserv53.tgz
    [X] bsd.rd        [X] comp53.tgz    [X] xetc53.tgz
    [X] bsd.mp        [X] man53.tgz     [X] xshare53.tgz
    [X] base53.tgz    [X] game53.tgz    [X] xfont53.tgz
Set name(s)? (or 'abort' or 'done') [done]</pre><p>I suggest you install everything, but you can choose to remove one or more sets.</p><p>For example, suppose you are building a firewall machine. Firewalls traditionally don’t have compilers, documentation, or X. You can remove file sets by entering a minus sign (<code class="literal">-</code>) and the name of the file set.</p><a id="I_programlisting3_id431016"/><pre class="programlisting">Set name(s)? (or 'abort' or 'done') [done] <span class="strong"><strong>1</strong></span> <span class="strong"><strong>-comp53.tgz -man53.tgz</strong></span>
    [X] bsd           [X] etc53.tgz     [X] xbase53.tgz   [X] xserv53.tgz
    [X] bsd.rd        [ ] comp53.tgz    [X] xetc53.tgz
    [X] bsd.mp        [ ] man53.tgz     [X] xshare53.tgz
    [X] base53.tgz    [X] game53.tgz    [X] xfont53.tgz
Set name(s)? (or 'abort' or 'done') [done]</pre><p>This example removes the compiler and manual file sets at <span class="strong"><strong>1</strong></span>. You can see that they’re no longer selected in the list of file sets.</p><p>You can also use wildcards when selecting file sets. For example, here’s how to remove all file sets beginning with an <code class="literal">x</code>:</p><a id="I_programlisting3_id431053"/><pre class="programlisting">Set name(s)? (or 'abort' or 'done') [done] <span class="strong"><strong>-x*</strong></span>
    [X] bsd           [X] etc53.tgz     [ ] xbase53.tgz   [ ] xserv53.tgz
    [X] bsd.rd        [ ] comp53.tgz    [ ] xetc53.tgz
    [X] bsd.mp        [ ] man53.tgz     [ ] xshare53.tgz
    [X] base53.tgz    [X] game53.tgz    [ ] xfont53.tgz
Set name(s)? (or 'abort' or 'done') [done]</pre><p>If you change your mind, you can add file sets back in by entering a plus (<code class="literal">+</code>) sign and the file set name. Here, I add back everything by using a wildcard (<code class="literal">*</code>):</p><a id="I_programlisting3_id431078"/><pre class="programlisting">Set name(s)? (or 'abort' or 'done') [done] <span class="strong"><strong>*</strong></span>
    [X] bsd           [X] etc53.tgz     [X] xbase53.tgz   [X] xserv53.tgz
    [X] bsd.rd        [X] comp53.tgz    [X] xetc53.tgz
    [X] bsd.mp        [X] man53.tgz     [X] xshare53.tgz
    [X] base53.tgz    [X] game53.tgz    [X] xfont53.tgz
Set name(s)? (or 'abort' or 'done') [done]</pre><p><a class="indexterm" id="idx0462"/><a class="indexterm" id="idx1055"/><a class="indexterm" id="idx1694"/><a class="indexterm" id="idx1934"/><a class="indexterm" id="idx1983"/>Once you’re ready, press <span class="smallcaps">ENTER</span> to install the default or selected file sets.</p><p>After the installer unpacks all of the file sets on the hard drive, it will ask if you have more file sets to install.</p><a id="I_programlisting3_id431152"/><pre class="programlisting">Location of sets? (cd disk ftp http or 'done') [done]</pre><p>If you have any custom file sets, you could install them at this point.</p></div><div class="sect2" title="Finishing the Installation"><div class="titlepage"><div><div><h3 class="title" id="finishing_the_installation">Finishing the Installation</h3></div></div></div><p>After unpacking the file sets, the installer cleans up after itself and tells you it’s finished with this message:</p><a id="I_programlisting3_id431172"/><pre class="programlisting">CONGRATULATIONS! Your OpenBSD install has been successfully completed!
To boot the new system, enter 'reboot' at the command prompt.
When you login to your new system the first time, please read your mail
using the 'mail' command.</pre><p>Do as you’re told and enter <span class="strong"><strong><code class="literal">reboot</code></strong></span>, and then remove the CD if necessary. If you’re content with a default installation, you can skip to <a class="xref" href="ch04.html" title="Chapter 4. Post-Install Setup">Chapter 4</a> now.</p></div></div><div class="sect1" title="Custom Disk Layout"><div class="titlepage"><div><div><h2 class="title" id="custom_disk_layout" style="clear: both">Custom Disk Layout</h2></div></div></div><p>If you have multiple hard disks in a system, or if you want a different partition layout than the default, you must manually edit your disk layout.</p><p>The installer partitions one disk at a time, and you can’t easily bounce between multiple disks. To successfully use multiple disks, decide on your partitioning scheme <span class="emphasis"><em>before</em></span> you start the installation, and write down exactly which partitions you want on which disks as specifically as possible.</p><p>My system has two 50GB hard disks. I plan to divide the disks like this:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: none"><p title="Disk 1"><span class="title"><strong><span class="strong"><strong>Disk 1</strong></span></strong></span>. 1GB <span class="emphasis"><em>/</em></span>, 1.2GB swap, 5GB <span class="emphasis"><em>/tmp</em></span>, 1GB <span class="emphasis"><em>/usr/X11R6</em></span>, 2GB <span class="emphasis"><em>/usr/src</em></span>, 2GB <span class="emphasis"><em>/usr/obj</em></span>, and everything else <span class="emphasis"><em>/home</em></span></p></li><li class="listitem" style="list-style-type: none"><p title="Disk 2"><span class="title"><strong><span class="strong"><strong>Disk 2</strong></span></strong></span>. 1GB <span class="emphasis"><em>/altroot</em></span>, 1.2GB swap, 6GB <span class="emphasis"><em>/var</em></span>, 10GB <span class="emphasis"><em>/usr/local</em></span>, and everything else <span class="emphasis"><em>/var/postgresql</em></span></p></li></ul></div><p>This layout includes all of the standard OpenBSD partitions, plus a few additions: I’ve increased some partition sizes above the installer-generated defaults, and I’ve added an extra swap partition on the second hard drive. OpenBSD doesn’t include a separate <span class="emphasis"><em>/var/postgresql</em></span> partition, but I’ve added one because I want my database data on its own partition. (We’ll discuss the <span class="emphasis"><em>/altroot</em></span> partition in <a class="xref" href="ch09.html" title="Chapter 9. More Filesystems">Chapter 9</a>.)</p><p>The installer runs as usual until you get to the disk portion.</p><a id="I_programlisting3_id431315"/><pre class="programlisting">Available disks are: sd0 sd1.
Which one is the root disk? (or 'done') [sd0]</pre><p>By default, the installer puts the root partition on the first hard drive, <code class="literal">sd0</code>. I’ll use this disk for the root partition and use the entire disk for OpenBSD.</p><p><a class="indexterm" id="idx0009"/><a class="indexterm" id="idx0465"/><a class="indexterm" id="idx0472"/><a class="indexterm" id="idx0480"/><a class="indexterm" id="idx0482"/><a class="indexterm" id="idx1344"/><a class="indexterm" id="idx1648"/><a class="indexterm" id="idx1702"/><a class="indexterm" id="idx1866"/><a class="indexterm" id="idx1882"/>The installer then presents a list of automatically generated disklabel partitions. We don’t want to use these partitions; we want to create our own from scratch.</p><a id="I_programlisting3_id431414"/><pre class="programlisting">Use (A)uto layout, (E)dit auto layout, or create (C)ustom layout? [a] <span class="strong"><strong>c</strong></span></pre><p>We want a custom layout, so enter <span class="strong"><strong><code class="literal">c</code></strong></span>.</p><p>The installer should now drop us to the <code class="literal">disklabel(8)</code> command prompt, indicated here by the <code class="literal">&gt;</code> symbol:</p><a id="I_programlisting3_id431444"/><pre class="programlisting">You will now create an OpenBSD disklabel inside the OpenBSD MBR
partition. The disklabel defines how OpenBSD splits up the MBR partition
into OpenBSD partitions in which filesystems and swap space are created.
You must provide each filesystem's mountpoint in this program.
The offsets used in the disklabel are ABSOLUTE, i.e. relative to the
start of the disk, NOT the start of the OpenBSD MBR partition.
Label editor (enter '?' for help at any prompt)
<span class="strong"><strong>&gt;</strong></span></pre><p>We can now use the interactive disklabel editor to create OpenBSD partitions within the MBR partition, as discussed in the following sections.</p><div class="sect2" title="Viewing Disklabels"><div class="titlepage"><div><div><h3 class="title" id="viewing_disklabels">Viewing Disklabels</h3></div></div></div><p>The <code class="literal">p</code> command prints the partition’s existing disklabel:</p><a id="I_programlisting3_id431478"/><pre class="programlisting">&gt; <span class="strong"><strong>p</strong></span>
OpenBSD area: 64-104856255; size: 104856191; free: 32
#                size           offset  fstype [fsize bsize  cpg]
  a:          2104448               64  4.2BSD   2048 16384    1
  b:          2506143          2104512    swap                  
  c:        104857600                0  unused
  d:         10490432          4610656  4.2BSD   2048 16384    1
…
&gt;</pre><p>This is exactly the same information discussed in <a class="xref" href="ch02.html#understanding_disklabels" title="Understanding Disklabels">Understanding Disklabels</a>. This hard drive previously had an OpenBSD installation, and the disklabel has those old partitions.</p><p>To display partition sizes in megabytes, enter <span class="strong"><strong><code class="literal">p m</code></strong></span>:</p><a id="I_programlisting3_id431512"/><pre class="programlisting">&gt; <span class="strong"><strong>p m</strong></span>
OpenBSD area: 64-104856255; size: 51199.3M; free: 0.0M
#                size           offset  fstype [fsize bsize  cpg]
  a:          1027.6M               64  4.2BSD   2048 16384    1
  b:          1223.7M          2104512    swap                  
  c:         51200.0M                0  unused
  d:          5122.3M          4610656  4.2BSD   2048 16384    1
…</pre><p><a class="indexterm" id="idx0356"/><a class="indexterm" id="idx0400"/><a class="indexterm" id="idx0466"/><a class="indexterm" id="idx0479"/><a class="indexterm" id="idx0559"/><a class="indexterm" id="idx0560"/><a class="indexterm" id="idx0919"/><a class="indexterm" id="idx1699"/><a class="indexterm" id="idx1701"/><a class="indexterm" id="idx1957"/><a class="indexterm" id="idx2707"/>You can also display partition sizes in gigabytes by entering <span class="strong"><strong><code class="literal">p g</code></strong></span>:</p><a id="I_programlisting3_id431623"/><pre class="programlisting">&gt; <span class="strong"><strong>p g</strong></span>
OpenBSD area: 64-104856255; size: 50.0G; free: 0.0G
#                size           offset  fstype [fsize bsize  cpg]
  a:             1.0G               64  4.2BSD   2048 16384    1
  b:             1.2G          2104512    swap                   
  c:            50.0G                0  unused
  d:             5.0G          4610656  4.2BSD   2048 16384    1
…</pre><p>Choose the unit of measurement best suited to your disk.</p></div><div class="sect2" title="Deleting Partitions"><div class="titlepage"><div><div><h3 class="title" id="deleting_partitions">Deleting Partitions</h3></div></div></div><p>Use the <code class="literal">d</code> command to delete partitions:</p><a id="I_programlisting3_id431656"/><pre class="programlisting">&gt; <span class="strong"><strong>d</strong></span>
partition to delete: [] <span class="strong"><strong>a</strong></span>
&gt;</pre><p>That’s it. Tell <code class="literal">disklabel</code> to delete a partition on this disk, give it the partition letter, and it’s gone. But beware: <code class="literal">disklabel</code> won’t ask you to verify your choice, so be sure to choose the correct partition.</p></div><div class="sect2" title="Erasing Existing Disklabels"><div class="titlepage"><div><div><h3 class="title" id="erasing_existing_disklabels">Erasing Existing Disklabels</h3></div></div></div><p>You could manually delete all partitions, but it’s much easier to zero out the existing disklabel with the <code class="literal">z</code> command:</p><a id="I_programlisting3_id431702"/><pre class="programlisting">&gt; <span class="strong"><strong>z</strong></span>
&gt; <span class="strong"><strong>p</strong></span>
OpenBSD area: 64-104856255; size: 104856191; free: 104856191
#                size           offset  fstype [fsize bsize  cpg]
  c:        104857600                0  unused
&gt;</pre><p>Here, we tell <code class="literal">disklabel</code> to erase the partition table with <span class="strong"><strong><code class="literal">z</code></strong></span>, and then print the partition table with <span class="strong"><strong><code class="literal">p</code></strong></span>. The output should be an empty disklabel, because the <code class="literal">c</code> disklabel partition represents the entire MBR partition. We can now create our desired partitions.</p></div><div class="sect2" title="Creating Disklabel Partitions"><div class="titlepage"><div><div><h3 class="title" id="creating_disklabel_partitions-id00001">Creating Disklabel Partitions</h3></div></div></div><p>This first disk needs the following partitions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>1GB <span class="emphasis"><em>/</em></span> (root)</p></li><li class="listitem"><p>1.2GB swap</p></li><li class="listitem"><p>5GB <span class="emphasis"><em>/tmp</em></span></p></li><li class="listitem"><p>1GB <span class="emphasis"><em>/usr/X11R6</em></span></p></li><li class="listitem"><p>2GB <span class="emphasis"><em>/usr/src</em></span></p></li><li class="listitem"><p>2GB <span class="emphasis"><em>/usr/obj</em></span></p></li><li class="listitem"><p>Everything else <span class="emphasis"><em>/home</em></span></p></li></ul></div><p><a class="indexterm" id="idx0015"/><a class="indexterm" id="idx0017"/><a class="indexterm" id="idx1391"/><a class="indexterm" id="idx1569"/><a class="indexterm" id="idx1698"/><a class="indexterm" id="idx1715"/><a class="indexterm" id="idx2280"/>By default, <code class="literal">disklabel</code> creates partitions in order. You can manually create partitions in any order you want, but you’ll need to track sectors and cylinders in order to figure out where each partition should begin and end. I <span class="emphasis"><em>strongly</em></span> recommend creating partitions in order and letting <code class="literal">disklabel</code> do the math.</p><p>Use the <code class="literal">a</code> command to create a partition beginning with <span class="emphasis"><em>/</em></span>:</p><a id="I_programlisting3_id431900"/><pre class="programlisting">  &gt; <span class="strong"><strong>a</strong></span>
<span class="strong"><strong>1</strong></span> partition: [a]
<span class="strong"><strong>2</strong></span> offset: [64]
<span class="strong"><strong>3</strong></span> size: [104856191] <span class="strong"><strong>1g</strong></span>
<span class="strong"><strong>4</strong></span> Rounding size to cylinder (16065 sectors): 2104451
<span class="strong"><strong>5</strong></span> FS type: [4.2BSD]
<span class="strong"><strong>6</strong></span> mount point: [none] <span class="strong"><strong>/</strong></span>
<span class="strong"><strong>7</strong></span> Rounding size to bsize (32 sectors): 2104448
  &gt;</pre><p>By default, at <span class="strong"><strong>1</strong></span>, <code class="literal">disklabel</code> offers the next free letter for your new partition. The first partition on the disk is <code class="literal">a</code>. Press <span class="smallcaps">ENTER</span> to accept it.</p><p>The offset for a disklabel partition is the number of sectors from the beginning of the disk where the partition starts, not from the beginning of the MBR partition, which is the actual beginning of the disk. The first 63 sectors of a disk, numbers 0 through 62, contain the MBR. We could use sector 63, but OpenBSD starts on sector 64 to better align with memory cells in solid-state disks. At <span class="strong"><strong>2</strong></span>, you can see that <code class="literal">disklabel</code> offers 64 as the default offset.</p><p>The size at <span class="strong"><strong>3</strong></span> is the number of sectors the partition uses. By default, <code class="literal">disklabel</code> offers all the remaining space on the disk, but I want a 1GB root partition. I could do the math to figure out how many sectors are in a gigabyte, but I’m lazy, so I use an abbreviation instead. The <code class="literal">disklabel</code> command recognizes the following abbreviations for sizes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">b</code> for bytes</p></li><li class="listitem"><p><code class="literal">c</code> for cylinders</p></li><li class="listitem"><p><code class="literal">k</code> for kilobytes</p></li><li class="listitem"><p><code class="literal">m</code> for megabytes</p></li><li class="listitem"><p><code class="literal">g</code> for gigabytes</p></li></ul></div><p>All partitions must end on a cylinder boundary, so <code class="literal">disklabel</code> figures out the closest boundary and, at <span class="strong"><strong>4</strong></span>, sizes my root partition to match. My root partition will be pretty close to 1GB.</p><p>The <code class="literal">FS type</code> at <span class="strong"><strong>5</strong></span> shows the filesystem used on this partition. For an OpenBSD disk, every data partition needs type <code class="literal">4.2BSD</code>. Your swap partition will be of type <code class="literal">swap</code>.</p><p>The mount point at <span class="strong"><strong>6</strong></span> is where you want this partition mounted. By default, <code class="literal">disklabel</code> doesn’t assign a mount point because it can’t guess what you want. Enter the partition’s mount point.</p><p><a class="indexterm" id="idx0481"/><a class="indexterm" id="idx0484"/><a class="indexterm" id="idx0485"/><a class="indexterm" id="idx0844"/><a class="indexterm" id="idx0974"/><a class="indexterm" id="idx1867"/><a class="indexterm" id="idx1899"/><a class="indexterm" id="idx2663"/>Partitions must end on a cylinder boundary, but should end with a whole block for the filesystem. The <code class="literal">disklabel</code> command <span class="strong"><strong>7</strong></span> adjusts the partition size again, based on the standard block size of the filesystem.</p><p>Our next partition is swap space.</p><a id="I_programlisting3_id432195"/><pre class="programlisting">  &gt; <span class="strong"><strong>a</strong></span>
<span class="strong"><strong>1</strong></span> partition: [b]
<span class="strong"><strong>2</strong></span> offset: [2104512]
<span class="strong"><strong>3</strong></span> size: [102751743] <span class="strong"><strong>1.2g</strong></span>
<span class="strong"><strong>4</strong></span> Rounding size to cylinder (16065 sectors): 2506143
<span class="strong"><strong>5</strong></span> FS type: [swap]
  &gt;</pre><p>The <code class="literal">disklabel</code> command assumes at <span class="strong"><strong>1</strong></span> that you’re using the next partition letter, <code class="literal">b</code>. It automatically calculates the offset at <span class="strong"><strong>2</strong></span>, which is the next free sector after the previous partition. I use decimal fractions at <span class="strong"><strong>3</strong></span> to set the size (I could alternatively enter <code class="literal">1200m</code>). The size at <span class="strong"><strong>4</strong></span> is rounded to the nearest cylinder boundary. Finally, <code class="literal">disklabel</code> knows that partition <code class="literal">b</code> is traditionally swap space, so it offers <span class="strong"><strong>5</strong></span> that as the default. Swap space doesn’t need a mount point, and it doesn’t have a block size.</p><p>We can create the remaining partitions in the same way. Creating the last partition, <span class="emphasis"><em>/home</em></span>, is even easier:</p><a id="I_programlisting3_id432306"/><pre class="programlisting">  &gt; <span class="strong"><strong>a</strong></span>
  partition: [h]
  offset: [25575456]
<span class="strong"><strong>1</strong></span> size: [79280799]
  FS type: [4.2BSD]
  mount point: [none] <span class="strong"><strong>/home</strong></span>
  Rounding size to bsize (32 sectors): 79280768
  &gt;</pre><p>As you can see at <span class="strong"><strong>1</strong></span>, we don’t need to track how much empty disk space remains, because <code class="literal">disklabel</code> does that for us. Press <span class="smallcaps">ENTER</span> to swallow it all. Now is your chance to leave empty space on your disk.</p><p>Now that you’ve created all your partitions, print the disklabel (with the <code class="literal">p</code> command, as described earlier in the chapter) to double-check your work.</p></div><div class="sect2" title="Writing the New Disklabel"><div class="titlepage"><div><div><h3 class="title" id="writing_the_new_disklabel">Writing the New Disklabel</h3></div></div></div><p>When you’re satisfied with your partition scheme, enter <span class="strong"><strong><code class="literal">q</code></strong></span> to write your disklabel to disk:</p><a id="I_programlisting3_id432373"/><pre class="programlisting">&gt; <span class="strong"><strong>q</strong></span>
Write new label?: [y] <span class="strong"><strong>y</strong></span>
/dev/rsd0a: 1027.6MB in 2104448 sectors of 512 bytes
…</pre><p><code class="literal">disklabel</code> gives you one last chance to change your mind. Once you write a new disklabel, recovering any data on the disk becomes extremely difficult, so be sure you backed up any vital data on this disk before starting the installation. (This is a good time to make sure that you didn’t microwave your backup.)</p></div><div class="sect2" title="Adding More Disks"><div class="titlepage"><div><div><h3 class="title" id="adding_more_disks">Adding More Disks</h3></div></div></div><p><a class="indexterm" id="idx0458"/><a class="indexterm" id="idx0476"/><a class="indexterm" id="idx0534"/><a class="indexterm" id="idx0944"/>After you partition your first disk, the installer offers you a chance to partition any other hard drives:</p><a id="I_programlisting3_id432446"/><pre class="programlisting">Available disks are: sd1.
Which one do you wish to initialize? (or 'done') [done] <span class="strong"><strong>sd1</strong></span></pre><p>The default is to not partition any other disks. If you choose another disk, you’ll need to create MBR partitions and then disklabel partitions.</p><p>Once all of your hard drives have been formatted, you’ll return to installing the file sets.</p></div></div><div class="sect1" title="Advanced Disklabel Commands"><div class="titlepage"><div><div><h2 class="title" id="advanced_disklabel_commands" style="clear: both">Advanced Disklabel Commands</h2></div></div></div><p>While the basic commands should suffice to partition your disk, <code class="literal">disklabel</code> supports a variety of advanced commands. We’ll look at a few of them now.</p><div class="sect2" title="Changing Basic Drive Parameters"><div class="titlepage"><div><div><h3 class="title" id="changing_basic_drive_parameters">Changing Basic Drive Parameters</h3></div></div></div><p>Remember all that stuff at the top of the disklabel that shows the drive’s basic physical characteristics? You can change all that, but it’s almost never necessary. In fact, if you think doing this is a good way to solve a problem, you’re probably on the wrong track.</p><p>If you enter <code class="literal">e</code>, <code class="literal">disklabel</code> walks you through each entry on the upper part of the disklabel. The existing values are presented as defaults, allowing you to quickly walk through the variables until you reach the one you want to change:</p><a id="I_programlisting3_id432506"/><pre class="programlisting">&gt; <span class="strong"><strong>e</strong></span>
Changing device parameters for /dev/rsd2c:
disk type: [SCSI]
label name: [Samsung HVX8812]
sectors/track: [63]
…</pre><p>Edit this information at your own risk because you can render your disk unbootable or your partitions unusable by changing it! Changing the drive’s physical description means you’re lying to your computer, and computers go ballistic when you lie to them about their hardware.</p></div><div class="sect2" title="Modifying Existing Partitions"><div class="titlepage"><div><div><h3 class="title" id="modifying_existing_partitions">Modifying Existing Partitions</h3></div></div></div><p><a class="indexterm" id="idx0473"/><a class="indexterm" id="idx0474"/><a class="indexterm" id="idx0801"/><a class="indexterm" id="idx0962"/><a class="indexterm" id="idx1251"/><a class="indexterm" id="idx1310"/><a class="indexterm" id="idx1714"/><a class="indexterm" id="idx2667"/>The <code class="literal">m</code> command modifies existing partitions. The <code class="literal">disklabel</code> tool walks you through each of the values you entered when creating the disk, offering your original values as defaults and allowing you to change them. But most of the time, it’s easier to just delete the partition and re-create it.</p></div><div class="sect2" title="Entering Expert Mode"><div class="titlepage"><div><div><h3 class="title" id="entering_expert_mode">Entering Expert Mode</h3></div></div></div><p>Expert mode gives the advanced user access to some rarely used options in <code class="literal">disklabel</code>. Most people don’t need these and find them simply clutter. (It’s not as if <code class="literal">disklabel</code> isn’t complicated enough already.)</p><p>To access expert mode, use the <code class="literal">X</code> command. You won’t immediately see all of the options available, but entering other commands will produce more options and more output.</p></div><div class="sect2" title="Getting More Help"><div class="titlepage"><div><div><h3 class="title" id="getting_more_help">Getting More Help</h3></div></div></div><p>You can enter a single question mark (<code class="literal">?</code>) at the <code class="literal">disklabel</code> prompt for a brief list of all available commands. If you want more detailed help, the <code class="literal">M</code> command displays the <code class="literal">disklabel(8)</code> man page.</p><p>You’ve now installed OpenBSD. Let’s see what to do next.</p></div></div><div class="footnotes" epub:type="footnotes"><br/><hr style="width: 100; align: left;"/><div class="footnote" epub:type="footnote" id="ftn.id346326"><p><sup>[<a class="para" href="#id346326">8</a>] </sup>Yes, some of us have half-suppressed memories of i386 hardware that couldn’t boot OpenBSD from a CD, but would let you fetch the install sets from one once you had it boot from a floppy. But seriously, if your hardware is that aged and picky, please save yourself some pain. Go back to the dumpster you found that computer in. Find something more recent.</p></div><div class="footnote" epub:type="footnote" id="ftn.id320931"><p><sup>[<a class="para" href="#id320931">9</a>] </sup>Of course, the US/Michigan time zone applies only to the four counties on the west end of the Upper Peninsula. But accepting the default wouldn’t let me illustrate this, and if I have to make something up, it might as well be vaguely plausible.</p></div></div></section></body></html>