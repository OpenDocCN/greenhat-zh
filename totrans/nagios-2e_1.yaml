- en: Part I. From Source Code to a Running Installation
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第一部分。从源代码到运行安装
- en: Chapter 1. Installation
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 1 章。安装
- en: The simplest method of installation is for you to install the Nagios packages
    that are supplied with the distribution you are using. Nagios 2.x is by now extremely
    mature and is therefore a component of most distributions. The paths of individual
    directories in those packages maintained by Linux distributors are usually different
    from the default specified in the source package, and thus from the paths used
    in this book.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 最简单的安装方法是安装您所使用发行版提供的 Nagios 软件包。Nagios 2.x 现在已经非常成熟，因此成为大多数发行版的一个组件。Linux 发行商维护的这些软件包中各个目录的路径通常与源软件包中指定的默认路径不同，因此也与本书中使用的路径不同。
- en: Nagios 3.0 is relatively new; it is recommended here that you "get your hands
    dirty" by compiling and installing the software yourself. The following installation
    guide also applies to Nagios 2.x, and any differences between versions 2.x and
    3.0 are mentioned explicitly in the text.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 3.0 相对较新；在此建议您通过编译和安装软件来“亲自动手”。以下安装指南也适用于 Nagios 2.x，版本 2.x 和 3.0 之间的任何差异都会在文本中明确说明。
- en: If you compile your own software, you have control over the directory structures
    and a number of other parameters. A Nagios system compiled in this way also provides
    an almost complete main configuration file, in which, initially, nothing has to
    be changed. But it should be mentioned here that compiling Nagios yourself might
    involve a laborious search for the necessary development packages, depending on
    what is already installed on the computer.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您编译自己的软件，您将控制目录结构和许多其他参数。以这种方式编译的 Nagios 系统也提供了一个几乎完整的主配置文件，其中最初不需要进行任何更改。但应指出，如果您自己编译
    Nagios，可能会涉及对必要的开发包进行繁琐的搜索，具体取决于计算机上已经安装的内容。
- en: 1.1 Preparations
  id: totrans-5
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1.1 准备工作
- en: 'For compiling Nagios itself you require **`gcc`**, **`make`**, **`autoconf`**,
    and **`automake`**. Required libraries are **`libgd`**^([[9](#ftn.CHP-1-FN-1)])
    and **`openssl`**^([[10](#ftn.CHP-1-FN-2)]). The development packages for these
    must also be installed (depending on the distribution, with either the ending
    **`-dev`** or **`-devel`**): **`libssl-dev`**, **`libgd-dev`**, **`libc6-dev`**.'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 为了编译 Nagios 本身，您需要 **`gcc`**、**`make`**、**`autoconf`** 和 **`automake`**。所需的库是
    **`libgd`**^([[9](#ftn.CHP-1-FN-1)]) 和 **`openssl`**^([[10](#ftn.CHP-1-FN-2)**)。这些库的开发包也必须安装（根据发行版的不同，可能以
    **`-dev`** 或 **`-devel`** 结尾）：**`libssl-dev`**、**`libgd-dev`**、**`libc6-dev`**。
- en: With Debian and Ubuntu you prepare by using **`apt-get install`** to install
    the packages **`apache2`**, **`build-essential`**, and **`libgd2-dev`**. In Open-SUSE
    you install **`apache2`** via YAST2, along with all C/C++ development libraries,
    as well as the package **`gd`**. In Fedora you run the command **`yum install`**
    on the command line and enter the packages **`httpd`**, **`gcc`**, **`glibc`**,
    **`glibc-common`**, **`gd`**, and **`gd-devel`** as arguments.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Debian 和 Ubuntu，您可以通过使用 **`apt-get install`** 来安装软件包 **`apache2`**、**`build-essential`**
    和 **`libgd2-dev`**。在 Open-SUSE 中，您可以通过 YAST2 安装 **`apache2`**，以及所有 C/C++ 开发库，以及软件包
    **`gd`**。在 Fedora 中，您在命令行上运行 **`yum install`** 命令，并将软件包 **`httpd`**、**`gcc`**、**`glibc`**、**`glibc-common`**、**`gd`**
    和 **`gd-devel`** 作为参数输入。
- en: 'For the plugins it is recommended that you also install the following packages:
    **`ntpdate`**^([[11](#ftn.CHP-1-FN-3)]) (possibly contained in the package **`ntp`**
    or **`xntp`**), **`snmp`**,^([[12](#ftn.CHP-1-FN-4)]) **`smbclient`**^([[13](#ftn.CHP-1-FN-5)])
    (possibly a component of the package **`samba-client`**), the **`libldap2`** library,
    and the relevant development package **`libldap2-dev`**^([[14](#ftn.CHP-1-FN-6)])
    (depending on the distribution, the appropriate packages are also called **`openldap2-client`**
    and **`openldap2-devel`**). You will also need to install the client and developer
    packages for the database used (e.g., **`postgresql-client`** and **`postgresql-dev(el)`**).'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 对于插件，建议您还安装以下软件包：**`ntpdate`**^([[11](#ftn.CHP-1-FN-3)])（可能包含在软件包 **`ntp`**
    或 **`xntp`** 中），**`snmp`**，^([[12](#ftn.CHP-1-FN-4)**) **`smbclient`**^([[13](#ftn.CHP-1-FN-5)**)（可能是软件包
    **`samba-client`** 的一个组件），**`libldap2`** 库，以及相关的开发包 **`libldap2-dev`**^([[14](#ftn.CHP-1-FN-6)**)（根据发行版的不同，适当的软件包也称为
    **`openldap2-client`** 和 **`openldap2-devel`**）。您还需要安装用于数据库的客户端和开发包（例如，**`postgresql-client`**
    和 **`postgresql-dev(el)`**）。
- en: 1.1.1 Determining and setting up the required users
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.1.1 确定和设置所需的用户
- en: 'Prior to compiling and installing, use the command **`groupadd`** to set up
    the groups necessary for operation. Groups **`nagios`** and **`nagcmd`** are set
    up with **`groupadd`**, and the user **`nagios`**, who is assigned to these groups
    and with whose permissions the Nagios server runs is set up with **`useradd`**:'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在编译和安装之前，使用命令**`groupadd`**设置操作所需的组。使用**`groupadd`**设置**`nagios`**和**`nagcmd`**组，并使用**`useradd`**设置分配给这些组并使用其权限运行的**`nagios`**用户：
- en: '[PRE0]'
  id: totrans-11
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Instead of the user (9000) and group IDs (9000 or 9001) used here, any other
    available IDs may be used. The primary group **`nagios`** of the user **`nagios`**
    should remain reserved exclusively for this user.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 除了这里使用的用户（9000）和组ID（9000或9001）之外，还可以使用任何其他可用的ID。用户**`nagios`**的主要组**`nagios`**应仅为此用户保留。
- en: 'The CGI scripts are run by Nagios under the user ID of the user with whose
    permissions the Apache Web server runs. In order for this user to access certain
    protected areas of Nagios, an additional group is required, the so-called *Nagios
    Command Group* **`nagcmd`**. Only the Web user and the user **`nagios`** should
    belong to this group. The Web user can be determined from the Apache configuration
    file. In Debian/Ubuntu this is located at **`/etc/apache2/apache2.conf`**; in
    Fedora it is at **`/etc/httpd/httpd.conf`**:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios在运行CGI脚本时使用的是与Apache Web服务器运行权限相同的用户ID。为了使此用户能够访问Nagios的某些受保护区域，需要一个额外的组，即所谓的*Nagios命令组**`nagcmd`**。只有Web用户和用户**`nagios`**应属于此组。Web用户可以从Apache配置文件中确定。在Debian/Ubuntu中，它位于**`/etc/apache2/apache2.conf`**；在Fedora中位于**`/etc/httpd/httpd.conf`**：
- en: '[PRE1]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The user determined in this way (in Debian/Ubuntu **`www-data`**, in Open-SUSE
    **`www-run`**, and in Fedora **`httpd`**) is additionally assigned to the group
    **`nagcmd`**, shown here using the example for Debian/Ubuntu:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 以这种方式确定的用户（在Debian/Ubuntu中为**`www-data`**，在Open-SUSE中为**`www-run`**，在Fedora中为**`httpd`**）还分配到**`nagcmd`**组，以下以Debian/Ubuntu为例：
- en: '[PRE2]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: In the example, the Web user is called **`www-data`**. The command **`usermod`**
    (this changes the data for an existing user account) also includes the Web user
    in the **`nagcmd`** group thanks to the **`-G`** option, by manipulating the corresponding
    entry in the file **`/etc/group`**.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 在示例中，Web用户被称为**`www-data`**。命令**`usermod`**（此命令更改现有用户账户的数据）也通过**`-G`**选项将Web用户包含在**`nagcmd`**组中，这是通过操作文件**`/etc/group`**中的相应条目实现的。
- en: 'In addition, the directory specified as the home directory of the user **`nagios`**,
    **`/usr/local/nagios`**, the configuration directory **`/etc/nagios`**, and the
    directory **`/var/nagios`**, which records variable data while Nagios is running,
    are set up manually and are assigned to the user **`nagios`** and to the group
    of the same name:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，指定为用户**`nagios`**主目录的目录**`/usr/local/nagios`**、配置目录**`/etc/nagios`**以及Nagios运行时记录变量数据的目录**`/var/nagios`**都是手动设置的，并分配给用户**`nagios`**和同名的组：
- en: '[PRE3]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '* * *'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[9](#CHP-1-FN-1)]) [http://www.boutell.com/gd/](http://www.boutell.com/gd/)
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[9](#CHP-1-FN-1)]) [http://www.boutell.com/gd/](http://www.boutell.com/gd/)
- en: ^([[10](#CHP-1-FN-2)]) [http://www.openssl.org/](http://www.openssl.org/) Depending
    on the distribution, the required RPM and Debian packages are sometimes named
    differently. Here you need to refer to the search help in the corresponding distribution.
    For Debian, the homepage will be of help. For example, if a **`configure`** instruction
    complains of a missing **`gd.h`** file, you can search specifically at [http://www.debian.org/distrib/packages](http://www.debian.org/distrib/packages)
    for the contents of packages. The search will then come up with all packages that
    contain the file **`gd.h`**.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[10](#CHP-1-FN-2)]) [http://www.openssl.org/](http://www.openssl.org/) 根据发行版的不同，所需的RPM和Debian软件包有时有不同的名称。在这里，您需要参考相应发行版的搜索帮助。对于Debian，主页将有所帮助。例如，如果**`configure`**指令抱怨缺少**`gd.h`**文件，您可以在[http://www.debian.org/distrib/packages](http://www.debian.org/distrib/packages)中专门搜索软件包的内容。搜索结果将显示包含文件**`gd.h`**的所有软件包。
- en: ^([[11](#CHP-1-FN-3)]) [http://ntp.isc.org/bin/view/Main/SoftwareDownloads](http://ntp.isc.org/bin/view/Main/SoftwareDownloads)
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[11](#CHP-1-FN-3)]) [http://ntp.isc.org/bin/view/Main/SoftwareDownloads](http://ntp.isc.org/bin/view/Main/SoftwareDownloads)
- en: ^([[12](#CHP-1-FN-4)]) [http://net-snmp.sourceforge.net/](http://net-snmp.sourceforge.net/)
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[12](#CHP-1-FN-4)]) [http://net-snmp.sourceforge.net/](http://net-snmp.sourceforge.net/)
- en: ^([[13](#CHP-1-FN-5)]) [http://samba.org/samba/](http://samba.org/samba/)
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[13](#CHP-1-FN-5)]) [http://samba.org/samba/](http://samba.org/samba/)
- en: ^([[14](#CHP-1-FN-6)]) [http://www.openldap.org/](http://www.openldap.org/)
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[14](#CHP-1-FN-6)]) [http://www.openldap.org/](http://www.openldap.org/)
- en: 1.2 Compiling Source Code
  id: totrans-27
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1.2 编译源代码
- en: 'The Nagios source code is available for download on the project page.^([[15](#ftn.CHP-1-FN-7)])
    The installation description below is for version 3.0, which is provided by the
    developers as a tarball. A Nagios 2.x installation runs in an almost identical
    manner:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 源代码可在项目页面上下载.^([[15](#ftn.CHP-1-FN-7)]) 下面的安装说明适用于版本 3.0，该版本由开发者以 tarball
    形式提供。Nagios 2.x 的安装几乎以相同的方式进行：
- en: '[PRE4]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'The three commands unpack the source code into the directory created for this
    purpose, **`/usr/local/src`**. A subdirectory called **`nagios-3.0`** is also
    created, containing the Nagios sources. To prepare these for compilation, enter
    the parameter deviating from the default value when running the **`configure`**
    command. [Table 1-1](../Text/ch01s02.html#installation_parameters_for_nagios "Table 1-1. Installation
    parameters for Nagios") lists the most important parameters:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 三个命令将源代码解压缩到为此目的创建的目录中，**`/usr/local/src`**。还创建了一个名为 **`nagios-3.0`** 的子目录，其中包含
    Nagios 源代码。为了准备编译，在运行 **`configure`** 命令时输入偏离默认值的参数。[表 1-1](../Text/ch01s02.html#installation_parameters_for_nagios
    "表 1-1. Nagios 的安装参数") 列出了最重要的参数：
- en: '[PRE5]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The values chosen here ensure that the installation routine selects the directories
    used in the book and sets all parameters correctly when generating the main configuration
    file. This simplifies fine tuning of the configuration considerably. If you want
    to use the Embedded Perl Interpreter to accelerate the execution of Perl scripts,
    then you also need the two switches **`--with-perlcache and --enable-embedded-perl`**.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 这里选择的值确保安装程序选择书中使用的目录，并在生成主配置文件时设置所有参数正确。这大大简化了配置的微调。如果您想使用内置 Perl 解释器来加速 Perl
    脚本的执行，那么您还需要两个开关 **`--with-perlcache`** 和 **`--enable-embedded-perl`**。
- en: In Nagios 3.0 you can leave out **`--with-perlcache`**, as it is enabled automatically
    by **`--enable-embedded-perl`**. You can find more on the Embedded Perl Interpreter
    in [Appendix G](../Text/apg.html "Appendix G. The Embedded Perl Interpreter"),
    page 669.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Nagios 3.0 中，您可以省略 **`--with-perlcache`**，因为它由 **`--enable-embedded-perl`**
    自动启用。您可以在 [附录 G](../Text/apg.html "附录 G. 内置 Perl 解释器")，第 669 页找到更多关于内置 Perl 解释器的信息。
- en: Table 1-1. Installation parameters for Nagios
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 表 1-1. Nagios 的安装参数
- en: '| Property | Value | configure Option |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| 属性 | 值 | 配置选项 |'
- en: '| --- | --- | --- |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| Root directory | **`/usr/local/nagios`** | **`--prefix`** |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| 根目录 | **`/usr/local/nagios`** | **`--prefix`** |'
- en: '| Configuration directory | **`/etc/nagios`** | **`--sysconfdir`** |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| 配置目录 | **`/etc/nagios`** | **`--sysconfdir`** |'
- en: '| Directory for variable data | **`/var/nagios`** | **`--localstatedir`** |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| 变量数据目录 | **`/var/nagios`** | **`--localstatedir`** |'
- en: '| Nagios user (UserID) | **`nagios (9000)`** | **`--with-nagios-user`** |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '| Nagios 用户（用户ID） | **`nagios (9000)`** | **`--with-nagios-user`** |'
- en: '| Nagios group (GroupID) | **`nagios (9000)`** | **`--with-nagios-group`**
    |'
  id: totrans-41
  prefs: []
  type: TYPE_TB
  zh: '| Nagios 组（组ID） | **`nagios (9000)`** | **`--with-nagios-group`** |'
- en: '| Nagios Command Group (GroupID) | **`nagcmd (9001)`** | **`--with-command-group`**
    |'
  id: totrans-42
  prefs: []
  type: TYPE_TB
  zh: '| Nagios 命令组（组ID） | **`nagcmd (9001)`** | **`--with-command-group`** |'
- en: '**`If --prefix`** is not specified, Nagios installs itself in the **`/usr/local/nagios`**
    directory. We recommend that you stick to this directory.^([[16](#ftn.CHP-1-FN-8)])'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: '**`If --prefix`** 未指定，Nagios 将自身安装在 **`/usr/local/nagios`** 目录下。我们建议您坚持使用此目录.^([[16](#ftn.CHP-1-FN-8)])'
- en: The system normally stores its configuration files in the directory **`etc`**
    beneath its root directory. In general it is better to store these in the **`/etc`**
    hierarchy however. Here we use **`/etc/nagios`**.^([[17](#ftn.CHP-1-FN-9)])
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 系统通常将其配置文件存储在其根目录下的 **`etc`** 目录中。通常，将这些文件存储在 **`/etc`** 层次结构中会更好。在这里，我们使用 **`/etc/nagios`**.^([[17](#ftn.CHP-1-FN-9)])
- en: Variable data such as the log file and the status file are by default stored
    in the directory **`/usr/local/nagios/var`**. This is in the **`/usr`** hierarchy
    which should only contain programs and other read-only files, not writable ones.
    In order to ensure that this is the case, we use **`/var/nagios`**.^([[18](#ftn.CHP-1-FN-10)])
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，变量数据（如日志文件和状态文件）存储在 **`/usr/local/nagios/var`** 目录中。这位于 **`/usr`** 层次结构中，其中应只包含程序和其他只读文件，而不是可写文件。为了确保这一点，我们使用
    **`/var/nagios`**.^([[18](#ftn.CHP-1-FN-10)])
- en: Irrespective of these changes, in most cases **`configure`** does not run through
    faultlessly the very first time, since one package or another is missing. For
    required libraries such as **`libgd`**, Nagios almost always demands the relevant
    developer package with the header files (here, **`libgd-dev`** or **`libgd-devel`**).
    Depending on the distribution, their names will end in **`-devel`** or **`-dev`**.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 不论这些变化如何，在大多数情况下，**`configure`** 并非第一次运行就毫无故障，因为总会有某个包缺失。对于像 **`libgd`** 这样的必需库，Nagios
    几乎总是要求相关的开发者包，包括头文件（在这里，**`libgd-dev`** 或 **`libgd-devel`**）。根据发行版的不同，它们的名称将以
    **`-devel`** 或 **`-dev`** 结尾。
- en: 'After all the tests have been run through, **`configure`** presents a summary
    of all the important configuration parameters:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在所有测试运行完毕后，**`configure`** 会显示所有重要的配置参数的摘要：
- en: '[PRE6]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: In Nagios 2.x the lines **`Check result directory`**, **`Apache conf.d directory`**,
    and **`Mail program`** are missing.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Nagios 2.x 中，缺少 **`Check result directory`**、**`Apache conf.d directory`**
    和 **`Mail program`** 这几行。
- en: If a **`yes`** is written after the item **`Embedded Perl`**, the Embedded Perl
    Interpreter is enabled. The *Event Broker* provides an interface for extensions
    that can be loaded as additional modules while the system is running.^([[19](#ftn.CHP-1-FN-11)])
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在 **`Embedded Perl`** 项后面写有 **`yes`**，则启用嵌入式 Perl 解释器。*事件代理* 提供了一个接口，用于加载作为附加模块的扩展，而系统正在运行.^([[19](#ftn.CHP-1-FN-11)])
- en: If you are satisfied with the result, **`make`** starts the actual compilation
    and then installs the software:^([[20](#ftn.CHP-1-FN-12)])
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你对结果满意，**`make`** 将开始实际的编译并安装软件:^([[20](#ftn.CHP-1-FN-12)])
- en: '[PRE7]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The command **`make all`** compiles all the relevant programs, which are then
    copied to the appropriate directories, together with CGI scripts and documentation,
    by **`make install`**. Apart from **`/etc/nagios`** and **`/var/nagios`**, further
    directories are created under **`/usr/local/nagios`**, which are summarized in
    [Table 1-2](../Text/ch01s02.html#nagios_directories_under_solidus_usr_sol "Table 1-2. Nagios
    directories under /usr/local/nagios").
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 命令 **`make all`** 编译所有相关程序，然后通过 **`make install`** 将它们以及 CGI 脚本和文档复制到相应的目录中。除了
    **`/etc/nagios`** 和 **`/var/nagios`**，在 **`/usr/local/nagios`** 下还会创建其他目录，这些目录在
    [表 1-2](../Text/ch01s02.html#nagios_directories_under_solidus_usr_sol "表 1-2.
    Nagios 目录在 /usr/local/nagios 下") 中进行了总结。
- en: Table 1-2. Nagios directories under `/usr/local/nagios`
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 表 1-2. `/usr/local/nagios` 下的 Nagios 目录
- en: '| Directory | Contents |'
  id: totrans-55
  prefs: []
  type: TYPE_TB
  zh: '| 目录 | 内容 |'
- en: '| --- | --- |'
  id: totrans-56
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| **`./bin`** | Executable Nagios main program |'
  id: totrans-57
  prefs: []
  type: TYPE_TB
  zh: '| **`./bin`** | 可执行的 Nagios 主程序 |'
- en: '| **`./libexec`** | Plugins |'
  id: totrans-58
  prefs: []
  type: TYPE_TB
  zh: '| **`./libexec`** | 插件 |'
- en: '| **`./sbin`** | CGI scripts |'
  id: totrans-59
  prefs: []
  type: TYPE_TB
  zh: '| **`./sbin`** | CGI 脚本 |'
- en: '| **`./share`** | Documentation, HTML files for the Web interface |'
  id: totrans-60
  prefs: []
  type: TYPE_TB
  zh: '| **`./share`** | 文档，Web 界面的 HTML 文件 |'
- en: The command **`make install-commandmode`** generates the directory that is required
    for later usage of the *command file mechanism* (see [13.1 The Interface for External
    Commands](../Text/ch13.html#the_interface_for_external_commands "13.1 The Interface
    for External Commands"), page 292) onwards. This step is optional, depending on
    the intended use, but since it is easy to forget later on, it is better to take
    precautions now. The final **`make install-config`** creates the example configuration,
    which will be used in [Chapter 2](../Text/ch02.html "Chapter 2. Nagios Configuration"),
    page 53.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 命令 **`make install-commandmode`** 生成用于后续使用 *命令文件机制* 所需的目录（参见 [13.1 外部命令的接口](../Text/ch13.html#the_interface_for_external_commands
    "13.1 外部命令的接口")，第 292 页）。这一步是可选的，取决于预期用途，但由于稍后容易忘记，因此最好现在就采取预防措施。最后的 **`make install-config`**
    创建示例配置，该配置将在 [第 2 章](../Text/ch02.html "第 2 章. Nagios 配置") 中使用，第 53 页。
- en: '* * *'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[15](#CHP-1-FN-7)]) [http://www.nagios.org/](http://www.nagios.org/)
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[15](#CHP-1-FN-7)]) [http://www.nagios.org/](http://www.nagios.org/)
- en: ^([[16](#CHP-1-FN-8)]) In accordance with the *Filesystem Hierarchy Standard*
    FHS, version 2.3, or local programs loaded by the administrator should be installed
    in **`/usr/local`**
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[16](#CHP-1-FN-8)]) 根据 *文件系统层次结构标准* FHS，版本 2.3，或管理员加载的本地程序应安装在 **`/usr/local`**
- en: ^([[17](#CHP-1-FN-9)]) This is not entirely compatible with FHS 2.3, which would
    prefer to have the configuration files in **`/etc/local/nagios`**.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[17](#CHP-1-FN-9)]) 这与 FHS 2.3 并不完全兼容，FHS 2.3 更希望配置文件位于 **`/etc/local/nagios`**。
- en: ^([[18](#CHP-1-FN-10)]) This also does not quite match the requirements of the
    FHS 2.3\. But since Nagios makes no differentiation between spool, cache, and
    status information, an FHS-true reproduction is not possible to achieve in a simple
    manner.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[18](#CHP-1-FN-10)]) 这也不完全符合FHS 2.3的要求。但由于Nagios在spool、cache和状态信息之间没有区别，因此以简单的方式实现FHS-true的复制是不可能的。
- en: ^([[19](#CHP-1-FN-11)]) At the time of going to press there were not yet any
    external extensions, which is why the Event Broker is currently only of interest
    to developers.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[19](#CHP-1-FN-11)]) 在印刷时，还没有任何外部扩展，这就是为什么事件代理目前只对开发者有吸引力。
- en: '^([[20](#CHP-1-FN-12)]) Caution is needed when updating from Nagios 2.x to
    Nagios 3.0: Here you should first back up the existing configuration, initially
    run only **`make all`**, and carefully read [H.13 Upgrade from Nagios 2.x to 3.0](../Text/aphs13.html
    "H.13 Upgrade from Nagios 2.x to 3.0") in page 693\. In Nagios 3.0 a **`make install-config`**
    command overwrites existing files!'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[20](#CHP-1-FN-12)]) 从Nagios 2.x更新到Nagios 3.0时需要小心：这里你应该首先备份现有的配置，最初只运行 **`make
    all`**，并仔细阅读第693页的[H.13 从Nagios 2.x升级到3.0](../Text/aphs13.html "H.13 从Nagios 2.x升级到3.0")。在Nagios
    3.0中，**`make install-config`** 命令会覆盖现有文件！
- en: 1.3 Starting Nagios Automatically
  id: totrans-69
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1.3 自动启动Nagios
- en: 'The command **`make install-init`** installs a suitable init script for the
    system start. Here **`make`** automatically tries to detect the correct path,
    which for most Linux distributions is **`/etc/init.d`**. Depending on your system,
    this may not be correct, which is why you should check it. In order for Nagios
    to start automatically when the system is booted, symbolic links are created in
    the **`/etc/rc?.d`** directories. With Debian and Ubuntu using System-V-Init,
    the included system script **`update-rc.d`** performs this task:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 命令 **`make install-init`** 为系统启动安装合适的初始化脚本。这里 **`make`** 会自动尝试检测正确的路径，对于大多数Linux发行版是
    **`/etc/init.d`**。根据你的系统，这可能不正确，因此你应该检查它。为了使Nagios在系统启动时自动启动，会在 **`/etc/rc?.d`**
    目录中创建符号链接。对于使用System-V-Init的Debian和Ubuntu，内置的系统脚本 **`update-rc.d`** 执行此任务：
- en: '[PRE8]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'This command creates symlinks beginning with the prefix **`S99`** to the directories
    **`rc2.d`** to **`rc5.d`**, so that Nagios starts automatically when changing
    to runlevels 2 to 5\. In addition it ensures that **`K99`** symlinks in the directories
    **`rc0.d`**, **`rc1.d`**, and **`rc6.d`** are responsible for stopping Nagios
    when the system is shut down and rebooted, as well as when it changes to maintenance
    mode. This corresponds to the following command-line commands:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令创建以 **`S99`** 为前缀的符号链接到目录 **`rc2.d`** 到 **`rc5.d`**，以便在切换到运行级别2到5时Nagios能够自动启动。此外，它还确保在目录
    **`rc0.d`**、**`rc1.d`** 和 **`rc6.d`** 中的 **`K99`** 符号链接在系统关闭和重启以及切换到维护模式时负责停止Nagios。这对应以下命令行命令：
- en: '[PRE9]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'For OpenSUSE the required symlinks are created using the script **`insserv`**:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 对于OpenSUSE，所需的符号链接是通过脚本 **`insserv`** 创建的：
- en: '[PRE10]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Fedora users perform this task with **`chkconfig`**:'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: Fedora用户使用 **`chkconfig`** 执行此任务：
- en: '[PRE11]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 1.4 Installing and Testing Plugins
  id: totrans-78
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1.4 安装和测试插件
- en: What is now still missing are the plugins. They must be downloaded separately
    from [http://www.nagios.org/](http://www.nagios.org/) and installed. As independent
    programs, they are subject to a different versioning system than Nagios. The current
    version at the time of going to press was version 1.4.11, but you can, for example,
    also use plugins from earlier version if you don't mind doing without the most
    recent features. Although the plugins are distributed in a common source distribution,
    they are independent of one another, so that you can replace one version of an
    individual plugin with another one at any time, or with one you have written yourself.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 目前仍然缺少的是插件。它们必须从 [http://www.nagios.org/](http://www.nagios.org/) 独立下载并安装。作为独立程序，它们的版本控制系统与Nagios不同。在印刷时，当前版本是1.4.11，但如果你不介意没有最新功能，也可以使用早期版本的插件。
- en: 1.4.1 Installation
  id: totrans-80
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.4.1 安装
- en: 'The installation of the plugin sources takes place, like the Nagios ones, in
    the directory **`/usr/local`**:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 插件源代码的安装，就像Nagios一样，发生在目录 **`/usr/local`** 中：
- en: '[PRE12]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: When running the **`configure`** command you should specify the same non-default
    values as for the server, which here are the configuration directory (**`/etc/nagios`**)
    and the directory intended for the data saved by Nagios (**`/var/nagios`**). Since
    the Nagios plugins are not maintained by the same people as Nagios itself, you
    should always check in advance, with **`./configure --help`**, whether the **`configure`**
    options for Nagios and the plugins really match or deviate from one another.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 当运行**`configure`**命令时，您应该指定与服务器相同的非默认值，这里是指配置目录（**`/etc/nagios`**）和Nagios保存数据的目录（**`/var/nagios`**）。由于Nagios插件不是由与Nagios本身相同的人维护的，您应该始终提前检查，使用**`./configure
    --help`**，以确定Nagios和插件的**`configure`**选项是否真正匹配或有所偏差。
- en: The switch **`--enable-perl-modules`** is only needed if you intend to install
    the Perl module **`Nagios::Plugin`**—for example, if you are using it to program
    your own plugins in Perl. You can read more on this in [24.2 The Perl Module Nagios::Plugin](../Text/ch24s02.html
    "24.2 The Perl Module Nagios::Plugin"), page 560.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 只有当您打算安装Perl模块**`Nagios::Plugin`**时，才需要**`--enable-perl-modules`**开关——例如，如果您正在使用它用Perl编写自己的插件。您可以在[24.2
    The Perl Module Nagios::Plugin](../Text/ch24s02.html "24.2 The Perl Module Nagios::Plugin")中了解更多信息，第560页。
- en: 'It is possible that a series of **`WARNING`**s may appear in the output of
    the **`configure`** command, something like this:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 可能会在**`configure`**命令的输出中出现一系列**`WARNING`**警告，类似于以下内容：
- en: '[PRE13]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: If you are not using Radius, you need not have qualms about ignoring the corresponding
    error messages. Otherwise you should install the missing packages and repeat the
    **`configure`** procedure. The quite frequently required SNMP functionality is
    missing a Perl module in this example. This may be installed either in the form
    of the distribution package or via the online CPAN archive:^([[21](#ftn.CHP-1-FN-13)])
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您不使用Radius，您不必担心忽略相应的错误信息。否则，您应该安装缺失的包并重复**`configure`**过程。在这个例子中，经常需要的SNMP功能缺失了一个Perl模块。这个模块可以通过发行版包或通过在线CPAN存档安装：^([[21](#ftn.CHP-1-FN-13)])
- en: '[PRE14]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: If you are running the CPAN procedure for the first time, it will guide you
    interactively through a self-explanatory setup, and you can answer nearly all
    of the questions with the default option.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您是第一次运行CPAN程序，它将交互式地引导您完成一个自解释的设置，您可以用默认选项回答几乎所有的问题。
- en: Running **`make`** in the directory **`nagios-plugins-1.4.11`** will compile
    all plugins. Afterwards you have the opportunity to perform tests, with **`make
    check`**. Because these tests have not been particularly carefully programmed,
    you will often see many error messages that have more to do with the test itself
    than with the plugin. If you still want to try it, then the **`Cache`** Perl module
    must also be installed. Regardless of whether you use **`make check`**, you should
    manually check the most important plugins after the installation.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在**`nagios-plugins-1.4.11`**目录中运行**`make`**将编译所有插件。之后，您有机会执行测试，使用**`make check`**。由于这些测试并没有被特别仔细地编程，您经常会看到许多错误信息，这些信息更多地与测试本身有关，而不是与插件有关。如果您仍然想尝试，那么还必须安装**`Cache`**Perl模块。无论您是否使用**`make
    check`**，您都应该在安装后手动检查最重要的插件。
- en: The command **`make install`** finally anchors the plugins in the subdirectory
    **`libexec`** (which in our case is **`/usr/local/nagios/libexec`**). However,
    not all of them are installed through this command. The source directory **`contrib`**
    contains a number of plugins that **`make install`** does not install automatically.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 命令**`make install`**最终将插件固定在子目录**`libexec`**（在我们的例子中是**`/usr/local/nagios/libexec`**）。然而，并非所有插件都是通过此命令安装的。源目录**`contrib`**包含了一些**`make
    install`**不会自动安装的插件。
- en: Most plugins in this directory are shell or Perl scripts. Where needed, these
    are simply copied to the plugin directory **`/usr/local/nagios/libexec`**. The
    few C programs first must be compiled, which in some cases may be no laughing
    matter, since a corresponding makefile, and often even a description of the required
    libraries, can be missing. If a simple **`make`** is not sufficient, as in the
    case of
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 此目录中的大多数插件是shell或Perl脚本。在需要时，这些脚本会简单地复制到插件目录**`/usr/local/nagios/libexec`**。少数C程序首先必须编译，在某些情况下，这可能不是一件轻松的事情，因为可能缺少相应的makefile，甚至缺少所需库的描述。如果简单的**`make`**不足以解决问题，就像在以下情况中：
- en: '[PRE15]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: then it is best to look for help in the mailing list **`nagiosplug-help`**.^([[23](#ftn.CHP-1-FN-15)])
    The compiled program must also be copied to the plugin directory.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，最好在 **`nagiosplug-help`** 邮件列表中寻求帮助.^([[23](#ftn.CHP-1-FN-15)]) 编译后的程序也必须复制到插件目录中。
- en: 1.4.2 Plugin test
  id: totrans-95
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.4.2 插件测试
- en: Because plugins are independent programs, they can already be used manually
    for test purposes right now—before the installation of Nagios has been completed.
    In any case you should check the **`check_icmp`** plugin, which plays an essential
    role. It checks whether another computer can be reached via **`ping`**, and it
    is the only plugin to be used both as a service check and a host check. If it
    is not working correctly, Nagios will not work correctly either, since the system
    cannot perform any service checks as long as it categorizes a host as "down."
    [6.2 Reachability Test with Ping](../Text/ch06s02.html "6.2 Reachability Test
    with Ping"), 108, describes **`check_icmp`** in detail, which is why there is
    only short introduction here describing its manual use.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 因为插件是独立的程序，所以现在就可以手动用于测试目的——在Nagios安装完成之前。无论如何，你应该检查 **`check_icmp`** 插件，它起着至关重要的作用。它检查是否可以通过
    **`ping`** 访问另一台计算机，并且是唯一既可以用作服务检查也可以用作主机检查的插件。如果它不能正常工作，Nagios也无法正常工作，因为只要系统将主机分类为“down”，就无法执行任何服务检查。[6.2
    使用Ping进行可达性测试](../Text/ch06s02.html "6.2 使用Ping进行可达性测试"), 108，详细介绍了 **`check_icmp`**，这就是为什么这里只简要介绍其手动使用方法。
- en: 'In order for the plugin to function correctly it must, like the **`/bin/ping`**
    program, be run as the user **`root`**. This is done by providing it with the
    *SUID bit*.With current plugin versions, **`make install`** sets this automatically.
    One way this can be seen is in the fact that the sources contain an additional
    directory, **`plugins-root`**. With older plugin versions you have to do this
    manually:'
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使插件能够正确运行，它必须像 **`/bin/ping`** 程序一样，以 **`root`** 用户身份运行。这是通过提供 *SUID位* 来实现的。在当前插件版本中，**`make
    install`** 会自动设置这个位。一种可以观察到这一点的方式是，源代码中包含一个额外的目录，**`plugins-root`**。在较旧版本的插件中，你必须手动完成这项操作：
- en: '[PRE16]'
  id: totrans-98
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Brief instructions for the plugin are given with the **`-h`** option:^([[24](#ftn.CHP-1-FN-16)])
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 **`-h`** 选项可以提供插件的简要说明:^([[24](#ftn.CHP-1-FN-16)])
- en: '[PRE17]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'For a simple test it is sufficient to specify an IP address (it is immaterial
    whether you prefix the **`-H`** flag or not):'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 对于简单的测试，指定一个IP地址就足够了（是否使用 **`-H`** 标志无关紧要）：
- en: '[PRE18]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'The output appears as a single line, which has been line-wrapped here for the
    printed version: with zero percent package loss (**`lost 0%`**), the test has
    been passed. Nagios uses only the first 300 bytes of the output line. If the plugin
    provides more information, this is cut off.'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 输出显示为单行，这里为了打印版本而进行了换行：在零百分比的数据包丢失（**`丢失 0%`**）的情况下，测试已经通过。Nagios只使用输出行的前300个字节。如果插件提供了更多信息，这些信息将被截断。
- en: If you would like to test other plugins, we refer you to [Chapter 6](../Text/ch06.html
    "Chapter 6. Plugins for Network Services") and [Chapter 7](../Text/ch07.html "Chapter 7. Testing
    Local Resources"), which describe the most important plugins in detail. All (reasonably
    well-programmed) plugins provide somewhat more detailed instructions with the
    **`--help`** option.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想测试其他插件，我们建议你参考[第6章](../Text/ch06.html "第6章。网络服务插件")和[第7章](../Text/ch07.html
    "第7章。本地资源测试")，它们详细介绍了最重要的插件。所有（合理编写的）插件都提供了带有 **`--help`** 选项的更详细的说明。
- en: '* * *'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[21](#CHP-1-FN-13)]) The *Comprehensive Perl Archive Network* at [http://www.cpan.org/](http://www.cpan.org/)
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[21](#CHP-1-FN-13)]) [http://www.cpan.org/](http://www.cpan.org/) 的 *Comprehensive
    Perl Archive Network*
- en: ^([[22](#CHP-1-FN-14)]) With **`check_cluster`**, hosts and services of a cluster
    can be monitored. Here you usually want to be notified if all nodes or redundant
    services provided fail at the same time. If one specific service fails on the
    other hand, this is not critical, as long as other hosts in the cluster provide
    this service.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[22](#CHP-1-FN-14)]) 使用 **`check_cluster`**，可以监控集群的主机和服务的状态。在这里，通常希望在所有节点或冗余服务同时失败时收到通知。另一方面，如果某个特定服务失败，这不算是关键问题，只要集群中的其他主机提供这项服务即可。
- en: ^([[23](#CHP-1-FN-15)]) [http://lists.sourceforge.net/lists/listinfo/nagiosplug-help](http://lists.sourceforge.net/lists/listinfo/nagiosplug-help)
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[23](#CHP-1-FN-15)]) [http://lists.sourceforge.net/lists/listinfo/nagiosplug-help](http://lists.sourceforge.net/lists/listinfo/nagiosplug-help)
- en: ^([[24](#CHP-1-FN-16)]) The listed options are explained in detail in [6.2 Reachability
    Test with Ping](../Text/ch06s02.html "6.2 Reachability Test with Ping") from page
    108.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[24](#CHP-1-FN-16)]) 列出的选项在[6.2 使用Ping进行可达性测试](../Text/ch06s02.html "6.2
    使用Ping进行可达性测试")中详细解释，从第108页开始。
- en: 1.5 Configuration of the Web Interface
  id: totrans-110
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 1.5 配置Web界面
- en: In order for the Web front end of Nagios to function, the Web server must know
    the CGI directory and the main Web directory. The following description applies
    to both Apache 1.3, Apache 2.0, and 2.2.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使Nagios的Web前端能够运行，Web服务器必须知道CGI目录和主要Web目录。以下描述适用于Apache 1.3、Apache 2.0和2.2。
- en: 1.5.1 Setting up Apache
  id: totrans-112
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.5.1 设置Apache
- en: 'As long as you have not added a different address for the front end, through
    the **`configure`** script with **`-with-cgiurl`**, Nagios expects the CGI programs
    at the URL **`/nagios/cgi-bin`** (actual directory: **`/usr/local/na-gios/sbin`**)
    as well as the remaining HTML files below **`/nagios`** (actual directory: **`/usr/local/nagios/share`**).
    Nagios 3.0 includes its own **`make`** target for the Web interface, which configures
    the directories and sets corresponding aliases for the two URLs:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 只要您没有通过**`configure`**脚本使用**`-with-cgiurl`**添加前端的不同地址，Nagios就会期望在URL**`/nagios/cgi-bin`**（实际目录：**`/usr/local/na-gios/sbin`**）以及**`/nagios`**以下的所有HTML文件（实际目录：**`/usr/local/nagios/share`**）中找到CGI程序。Nagios
    3.0包括用于Web界面的自己的**`make`**目标，它配置目录并设置两个URL的相应别名：
- en: '[PRE19]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'This command installs the file **`nagios.conf`** in the configuration directory
    of Apache. In Debian/Ubuntu and OpenSUSE it is named **`/etc/apache2/`** **`conf.d`**,
    or in Fedora **`/etc/httpd/conf.d`**. It looks like this:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 此命令将文件**`nagios.conf`**安装到Apache的配置目录中。在Debian/Ubuntu和OpenSUSE中，它命名为**`/etc/apache2/`**
    **`conf.d`**，或在Fedora中为**`/etc/httpd/conf.d`**。它看起来是这样的：
- en: '[PRE20]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: In Nagios 2.x you have to set up the file by hand.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 在Nagios 2.x版本中，您必须手动设置文件。
- en: 'The directive **`ScriptAlias`** ensures that Apache accesses the Nagios CGI
    directory when calling a URL such as [http://nagios-server/nagios/cgi-bin](http://nagios-server/nagios/cgi-bin),
    irrespective of where the Apache CGI directories may be located. **`Options ExcecCGI`**
    ensures that the Web server accepts all the scripts located there as CGI. **`Order`**
    and **`Allow`** initially allow unrestricted access here to the Web server. If
    you want to restrict access, the sequence of the **`Order`** arguments is altered:'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 指令**`ScriptAlias`**确保当调用类似[http://nagios-server/nagios/cgi-bin](http://nagios-server/nagios/cgi-bin)的URL时，Apache访问Nagios
    CGI目录，而不论Apache CGI目录可能位于何处。**`Options ExcecCGI`**确保Web服务器接受那里放置的所有脚本。**`Order`**和**`Allow`**最初允许Web服务器无限制地访问这里。如果您想限制访问，则改变**`Order`**参数的顺序：
- en: '[PRE21]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: This example ensures that only clients from the network **`192.0.2.0/24 (/24`**
    stands for the subnet mask **`255.255.255.0`**) and **`localhost`** gain access
    to the directory specified. The three **`Auth*`**- and the **`Require`** directives
    ensure authenticated access; more on user authentication in [1.5.3 User authentication](../Text/ch01s05.html#user_authentication
    "1.5.3 User authentication") in page 49.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 此示例确保只有来自网络**`192.0.2.0/24 (/24`**代表子网掩码**`255.255.255.0`**)和**`localhost`**的客户端可以访问指定的目录。三个**`Auth*`**和**`Require`**指令确保了经过身份验证的访问；有关用户身份验证的更多信息，请参见[1.5.3
    用户身份验证](../Text/ch01s05.html#user_authentication "1.5.3 用户身份验证")，第49页。
- en: 'The section for the Nagios documents directory **`/usr/local/nagios/share`**
    is constructed in a similar fashion: the directive **`Alias`** allows the directory
    beneath the URL [http://nagios-server/nagios](http://nagios-server/nagios) to
    be addressed, independently of where the Apache-**`DocumentRoot`** is located.'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios文档目录**`/usr/local/nagios/share`**的设置方式类似：指令**`Alias`**允许通过URL [http://nagios-server/nagios](http://nagios-server/nagios)访问目录，而不管Apache-**`DocumentRoot`**位于何处。
- en: The directives **`Order`** and **`Allow`** (and also **`Deny`**, if needed)
    are set in identical manner to the CGI section. Authentication is not absolutely
    essential in the documentation sphere, but it is certainly useful if you want
    to install extensions such as PNP there (see [19.6 Smooth Plotting with PNP](../Text/ch19s06.html
    "19.6 Smooth Plotting with PNP"), page 446).
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 指令**`Order`**和**`Allow`**（如果需要，还包括**`Deny`**）的设置方式与CGI部分相同。在文档领域，身份验证并非绝对必要，但如果您想在其中安装扩展，如PNP，那么它肯定是有用的（参见[19.6
    使用PNP进行平滑绘图](../Text/ch19s06.html "19.6 使用PNP进行平滑绘图")，第446页）。
- en: The command
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 命令
- en: '[PRE22]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: loads the new configuration. If everything has worked out correctly, the Nagios
    main page appears in the Web browser under [http://nagios-server/nagios](http://nagios-server/nagios).
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 加载新的配置。如果一切正常，Nagios主页面将在Web浏览器中的[http://nagios-server/nagios](http://nagios-server/nagios)下显示。
- en: 1.5.2 SELinux
  id: totrans-126
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.5.2 SELinux
- en: 'Just a few distributions—in particular, Fedora—enable the *Security Enhanced
    Linux* (SELinux) by default. When enabled and appropriately configured, this allows
    services such as the Apache Web server access only to files and directories explicitly
    mentioned. The directories **`/usr/local/nagios/bin`** and **`/usr/local/nagios/share`**
    used by Nagios are not among these. The consequence: SELinux first refuses Apache
    access until this is allowed via the configuration. The command **`getenforce`**
    shows whether the *Enforcing Mode*, in which SELinux enforces the strict observance
    of the configured access rights, is switched on. This can be switched off with
    the command'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 只有少数发行版——特别是Fedora——默认启用*安全增强型Linux* (SELinux)。当启用并适当配置时，这允许诸如Apache Web服务器之类的服务仅访问明确提到的文件和目录。Nagios使用的目录**`/usr/local/nagios/bin`**和**`/usr/local/nagios/share`**并不包含在内。结果是：SELinux首先拒绝Apache访问，直到通过配置允许为止。命令**`getenforce`**显示*执行模式*是否开启，在这种模式下，SELinux强制执行配置的访问权限的严格遵守。这可以通过命令关闭。
- en: '[PRE23]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: To retain this status at the next system start, the settings in **`/etc/selinux/config`**
    are changed. Rather than switching off the Enforcing Mode, though, it is better
    to configure the required accesses specifically. This does require some understanding
    of how SELinux works, and some general Linux experience -knowledge that would
    go beyond the scope of this book. For those who want to get to grips more intensively
    with the subject, further information can be found in the Wiki of the Nagios community,^([[25](#ftn.CHP-1-FN-17)])
    including a link to a concrete guide.^([[26](#ftn.CHP-1-FN-18)])
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 要在下次系统启动时保持此状态，需要更改**`/etc/selinux/config`**中的设置。然而，与其关闭执行模式，不如更好地配置所需的访问权限。这确实需要一些了解SELinux如何工作的知识，以及一些通用的Linux经验——这些知识将超出本书的范围。对于那些想要更深入地掌握这个主题的人来说，可以在Nagios社区Wiki中找到更多信息，包括一个具体的指南链接^([[25](#ftn.CHP-1-FN-17)])。
- en: 1.5.3 User authentication
  id: totrans-130
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 1.5.3 用户身份验证
- en: In the state in which it is delivered, Nagios allows only authenticated users
    access to the CGI directory. This means that users not "logged in" have no way
    to see anything other than the homepage and the documentation. They are blocked
    off from access to other functions.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 在交付时的状态中，Nagios只允许经过身份验证的用户访问CGI目录。这意味着未“登录”的用户除了主页和文档外无法看到任何内容。他们被阻止访问其他功能。
- en: 'There is a good reason for this: apart from status queries and other display
    functions, Nagios has the ability to send commands via the Web interface. The
    interface for external commands is used for this purpose ([13.1 The Interface
    for External Commands](../Text/ch13.html#the_interface_for_external_commands "13.1
    The Interface for External Commands"), page 292). If this is active, checks can
    be switched on and off via the Web browser, for example, and Nagios can even be
    restarted. Only authorized users should be in a position to do this. Besides,
    general security considerations would indicate that the huge volume of information
    provided by Nagios should only be made available to trustworthy persons.'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 有一个很好的理由：除了状态查询和其他显示功能外，Nagios还有通过Web界面发送命令的能力。外部命令的接口用于此目的（[13.1 外部命令接口](../Text/ch13.html#the_interface_for_external_commands
    "13.1 外部命令接口"), 第292页）。如果此功能激活，可以通过Web浏览器切换检查，例如，Nagios甚至可以重新启动。只有授权用户应该能够这样做。此外，一般的考虑安全因素表明，Nagios提供的大量信息应该只对可信赖的人开放。
- en: 'First of all, the parameter **`use_authenticationin`** the CGI configuration
    file **`cgi.cfg`** ^([[27](#ftn.CHP-1-FN-19)]) of Nagios must be set to 1:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，Nagios的CGI配置文件**`cgi.cfg`**中的参数**`use_authenticationin`**必须设置为1^([[27](#ftn.CHP-1-FN-19)])：
- en: '[PRE24]'
  id: totrans-134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'This is the default during installation. The simplest authentication form provided
    by Apache is the file-based **`Basic`** authentication, which is already enabled
    in the configuration file:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装过程中，这是默认设置。Apache提供的最简单的身份验证形式是基于文件的**`Basic`**身份验证，这在配置文件中已经启用：
- en: '[PRE25]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '**`AuthName`** is an information field that the browser displays if the Web
    server requests authentication. **`AuthType Basic`** stands for simple authentication,
    in which the password is transmitted without encryption, as long as no SSL connection
    is used. It is best to save the password file—here **`htpasswd.users`**—in the
    Nagios configuration directory **`/etc/nagios`**. The final parameter, **`require
    valid-user`**, means that all authenticated users have access (there are no restrictions
    for specific groups; only the user-password pair must be valid).'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '**`AuthName`**是一个信息字段，当Web服务器请求身份验证时，浏览器会显示它。**`AuthType Basic`**表示简单身份验证，其中密码在没有加密的情况下传输，只要不使用SSL连接。最好将密码文件——这里指**`htpasswd.users`**——保存在Nagios配置目录**`/etc/nagios`**中。最后一个参数**`require
    valid-user`**意味着所有经过身份验证的用户都有访问权限（没有对特定组的限制；只需用户密码对有效即可）。'
- en: The (freely selectable) name of the password file will be specified here so
    that it displays what type of password file is involved. It is generated with
    the **`htpasswd2`** program, included in Apache. (In Apache 1.3 and some other
    distributions, the program is called **`htpasswd`**.) Running
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 这里将指定（可自由选择的）密码文件名称，以便显示涉及哪种类型的密码文件。它由Apache中包含的**`htpasswd2`**程序生成。（在Apache
    1.3和一些其他发行版中，该程序称为**`htpasswd`**。）运行
- en: '[PRE26]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'generates a new password file with a password for the user **`nagios`**. Its
    format is relatively simple:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 为用户**`nagios`**生成一个新的密码文件。其格式相对简单：
- en: '[PRE27]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Each line contains a user-password pair, separated by a colon.^([[28](#ftn.CHP-1-FN-20)])
    If you want to add other users, you should ensure that you omit the **`-c`** (*create*)
    option. Otherwise **`htpasswd(2)`** will recreate the file and delete the old
    contents:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 每行包含一个用户密码对，由冒号分隔.^([[28](#ftn.CHP-1-FN-20)）如果您想添加其他用户，应确保省略**`-c`**（*创建*）选项。否则**`htpasswd(2)`**将重新创建文件并删除旧内容：
- en: '[PRE28]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'The user name cannot be chosen freely but must match the name of a contact
    person (see [2.7 Defining Addressees for Error Messages: contact](../Text/ch02s07.html
    "2.7 Defining Addressees for Error Messages: contact"), page 70). Only the Web
    user (depending on your distro, **`www-data`**, **`www-run`** oder **`httpd`**,
    see [1.1.1 Determining and setting up the required users](../Text/ch01.html#determining_and_setting_up_the_required
    "1.1.1 Determining and setting up the required users")) can access the generated
    **`htpasswd.users`** file, and it should be protected from access by anyone else:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 用户名不能随意选择，而必须与联系人姓名匹配（参见[2.7 定义错误消息的收件人：联系人](../Text/ch02s07.html "2.7 定义错误消息的收件人：联系人")，第70页）。只有网络用户（根据您的发行版，可能是**`www-data`**、**`www-run`**或**`httpd`**，参见[1.1.1
    确定和设置所需用户](../Text/ch01.html#determining_and_setting_up_the_required "1.1.1 确定和设置所需用户"))可以访问生成的**`htpasswd.users`**文件，并且应该保护它不被其他人访问：
- en: '[PRE29]'
  id: totrans-145
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: In combination with its own modules and those of third parties, Apache allows
    a series of other authentication methods. These include authentication via an
    LDAP directory, via Pluggable Authentication Modules (PAM),^([[29](#ftn.CHP-1-FN-21)])
    or using SMB via a Windows server. Here we refer you to the relevant literature
    and the highly detailed documentation on the Apache homepage.^([[30](#ftn.CHP-1-FN-22)])
    A quite advanced example, in which a user already authenticated by Kerberos does
    not have to authenticate himself again, is described in [Appendix E](../Text/ape.html
    "Appendix E. Single Sign-On for the Nagios Web Interface") in page 637.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 结合其自身模块和第三方模块，Apache允许一系列其他身份验证方法。这些包括通过LDAP目录、通过可插拔身份验证模块（PAM）^([[29](#ftn.CHP-1-FN-21)])或通过Windows服务器使用SMB进行身份验证。这里我们推荐您查阅相关文献和Apache主页上的高度详细文档.^([[30](#ftn.CHP-1-FN-22)）一个相当高级的例子，其中已经通过Kerberos认证的用户不需要再次进行认证，在[附录E](../Text/ape.html
    "附录E. Nagios Web界面的单点登录")的第637页中描述。
- en: 'Even though configuration of the Web interface is now finished, at the moment
    only the documentation is properly displayed: Nagios itself must first be correspondingly
    adjusted—as described in detail in the following chapter—before it can be used
    for monitoring data made available in this way.'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管Web界面的配置现在已经完成，但此时只有文档被正确显示：Nagios本身必须首先进行相应的调整——正如以下章节中详细描述的那样——然后才能用于监控以这种方式提供的数据。
- en: '* * *'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[25](#CHP-1-FN-17)]) Search [http://www.nagioscommunity.org/wiki/](http://www.nagioscommunity.org/wiki/)
    for the keyword **`SELinux`**.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[25](#CHP-1-FN-17)]) 在[http://www.nagioscommunity.org/wiki/](http://www.nagioscommunity.org/wiki/)搜索关键字**`SELinux`**。
- en: ^([[26](#CHP-1-FN-18)]) [http://www.rickwargo.com/2006/10/29/fc6-selinux-and-nagios/](http://www.rickwargo.com/2006/10/29/fc6-selinux-and-nagios/)
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[26](#CHP-1-FN-18)]) [http://www.rickwargo.com/2006/10/29/fc6-selinux-and-nagios/](http://www.rickwargo.com/2006/10/29/fc6-selinux-and-nagios/)
- en: ^([[27](#CHP-1-FN-19)]) More on this in [2.13 CGI Configuration in cgi.cfg](../Text/ch02s13.html
    "2.13 CGI Configuration in cgi.cfg") from page 77.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[27](#CHP-1-FN-19)]) 更多信息请参阅第 77 页的 [2.13 cgi.cfg 中的 CGI 配置](../Text/ch02s13.html
    "2.13 cgi.cfg 中的 CGI 配置")。
- en: ^([[28](#CHP-1-FN-20)]) To be precise, the second position does not contain
    the password itself, but rather its hash value.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[28](#CHP-1-FN-20)]) 严格来说，第二个位置不包含密码本身，而是其哈希值。
- en: ^([[29](#CHP-1-FN-21)]) The "Pluggable Authentication Modules" now control authentication
    in all Linux distributions, so that you can also use existing user accounts here.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[29](#CHP-1-FN-21)]) “可插拔认证模块”现在控制着所有Linux发行版的认证，因此你也可以在这里使用现有的用户账户。
- en: ^([[30](#CHP-1-FN-22)]) [http://httpd.apache.org/](http://httpd.apache.org/)
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[30](#CHP-1-FN-22)]) [http://httpd.apache.org/](http://httpd.apache.org/)
- en: Chapter 2. Nagios Configuration
  id: totrans-155
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第二章. Nagios 配置
- en: Although the Nagios configuration can become quite large, you only need to handle
    a small part of this to get a system up and running. Luckily many parameters in
    Nagios are already set to sensible default settings. So this chapter will be concerned
    primarily with the most basic and frequently used parameters, which is quite sufficient
    for an initial configuration.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管Nagios配置可能会变得相当庞大，但你只需要处理其中的一小部分，就可以让系统启动并运行。幸运的是，Nagios中的许多参数已经设置为合理的默认设置。因此，本章将主要关注最基本的和最常用的参数，这对于初始配置来说已经足够了。
- en: 'Further details on the configuration are provided by the chapters on individual
    Nagios features: in [Chapter 6](../Text/ch06.html "Chapter 6. Plugins for Network
    Services") in network plugins (page 105), there are many examples on the configuration
    of services. All parameters of the Nagios messaging system are explained in detail
    in [Chapter 12](../Text/ch12.html "Chapter 12. The Nagios Notification System"),
    page 265, and the parameters for controlling the Web interface are described in
    [Chapter 16](../Text/ch16.html "Chapter 16. The Classical Web Interface"), page
    327\. In addition to this, Nagios includes its own extensive documentation (**`/usr/local/nagios/share/docs`**),
    which can also be reached from the Web interface. This can always be recommended
    as a useful source for further information, which is why each of the sections
    below refer to the corresponding location in the original documentation.'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 关于配置的更多详细信息可以在各个Nagios功能章节中找到：在网络插件中，[第 6 章](../Text/ch06.html "第 6 章. 网络服务插件")（第
    105 页）提供了许多服务配置的示例。Nagios消息系统的所有参数都在[第 12 章](../Text/ch12.html "第 12 章. Nagios
    通知系统")（第 265 页）中详细解释，控制Web界面的参数在[第 16 章](../Text/ch16.html "第 16 章. 经典Web界面")（第
    327 页）中描述。此外，Nagios还包括其自己的详尽文档（**`/usr/local/nagios/share/docs`**），这也可以从Web界面访问。这始终可以作为获取进一步信息的有用来源，因此下面的每个部分都引用了原始文档中的相应位置。
- en: 'The installation routine in **`make install-config`** (see [1.2 Compiling Source
    Code](../Text/ch01s02.html "1.2 Compiling Source Code") in page 39) stores examples
    of individual configuration files in the directory **`/etc/nagios`**. But be careful:
    whereas the names of the example files in Nagios 2.0 ended in **`-sample`** (so
    that a possible update does not overwrite the files required for production),
    this is no longer the case in the current Nagios 2.x versions and in Nagios 3.0\.
    Existing files are overwritten here. Admittedly, **`make install`** does rename
    existing files: thus **`nagios.cfg`** is turned into **`nagios.cfg˜`**. But this
    only happens once. After running **`make install`** one more time, the original
    contents of the file are deleted once and for all. For this reason it is essential
    that you back up the existing configuration *prior to* running **`make install-config`**.'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 安装程序在 **`make install-config`**（参见第 39 页的 [1.2 编译源代码](../Text/ch01s02.html "1.2
    编译源代码")）中，将单个配置文件的示例存储在目录 **`/etc/nagios`** 中。但请注意：Nagios 2.0 中示例文件的名字以 **`-sample`**
    结尾（这样在更新时不会覆盖生产所需的文件），但在当前的Nagios 2.x版本和Nagios 3.0中不再是这样。在这里，现有文件会被覆盖。诚然，**`make
    install`** 会重命名现有文件：因此 **`nagios.cfg`** 被转换为 **`nagios.cfg˜`**。但这只会发生一次。运行 **`make
    install`** 一次后，文件的原内容就会被永久删除。因此，在运行 **`make install-config`** 之前备份现有配置是至关重要的。
- en: 'After this command, the directory **`/etc/nagios`** of Nagios 3.0 contains
    the three main configuration files: **`nagios.cfg`**, **`cgi.cfg`**, and **`resource.cfg`**.
    Object definitions end up in other files in the subdirectory **`objects`**:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 在此命令之后，Nagios 3.0 的目录**`/etc/nagios`**包含三个主要配置文件：**`nagios.cfg`**、**`cgi.cfg`**和**`resource.cfg`**。对象定义最终位于子目录**`objects`**中的其他文件中：
- en: '[PRE30]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Nagios 2.10 uses fewer files; objects are defined only in the files **`localhost.cfg`**
    and **`commands.cfg`**:'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 2.10 使用更少的文件；对象仅在文件**`localhost.cfg`**和**`commands.cfg`**中定义：
- en: '[PRE31]'
  id: totrans-162
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: All subsequent work should be carried out as the user **`nagios`**. If you are
    editing files as the superuser, you must ensure yourself that the contents of
    directory **`/etc/nagios`** afterwards belong to the user **`nagios`** again.
    With the exception of the file **`resource.cfg`**—this may contain passwords,
    which is why only the owner **`nagios`** should have the read permission set—
    all other files may be readable for all.
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 所有后续工作都应作为用户**`nagios`**执行。如果你以超级用户身份编辑文件，你必须确保目录**`/etc/nagios`**的内容在之后再次属于用户**`nagios`**。除了文件**`resource.cfg`**——它可能包含密码，因此只有所有者**`nagios`**应该设置读取权限——所有其他文件都可以被所有人读取。
- en: 2.1 The Main Configuration File **`nagios.cfg`**
  id: totrans-164
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.1 主配置文件**`nagios.cfg`**
- en: The central configuration takes place in **`nagios.cfg`**. Instead of storing
    all configuration options there, it makes links to other configuration files (with
    the exception of the CGI configuration).
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 中心配置发生在**`nagios.cfg`**中。它不是将所有配置选项存储在那里，而是链接到其他配置文件（CGI 配置除外）。
- en: Those who compile and install Nagios themselves have the advantage that at first
    they do not even need to adjust **`nagios.cfg`**, since all paths are already
    correctly set.^([[32](#ftn.CHP-2-FN-2)]) And that's as much as you need to do.
    Nevertheless one small modification is recommended, which helps to maintain a
    clear picture and considerably simplifies configuration where larger networks
    are involved.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 对于自己编译和安装 Nagios 的用户来说，一个优点是，一开始他们甚至不需要调整**`nagios.cfg`**，因为所有路径都已经正确设置。[^[[32](#ftn.CHP-2-FN-2)])
    这就是你需要做的全部。尽管如此，建议进行一个小修改，这有助于保持清晰的画面，并在涉及大型网络时大大简化配置。
- en: 'The parameter concerned is **`cfg_file`**, which integrates files with object
    definitions (see [2.2 Objects—an Overview](../Text/ch02s02.html "2.2 Objects—an
    Overview") through [2.10 Defining a Time Period with timeperiod](../Text/ch02s10.html
    "2.10 Defining a Time Period with timeperiod") in page 59). The file **`nagios.cfg`**,
    included in the Nagios 3.0 package, contains the following entries:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 相关的参数是**`cfg_file`**，它集成了具有对象定义的文件（见第 59 页的 [2.2 对象——概述](../Text/ch02s02.html
    "2.2 对象——概述") 到 [2.10 使用 timeperiod 定义时间周期](../Text/ch02s10.html "2.10 使用 timeperiod
    定义时间周期")）。包含在 Nagios 3.0 软件包中的文件**`nagios.cfg`**包含以下条目：
- en: '[PRE32]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Nagios 2.x gathers all example object files into just two configuration files:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 2.x 将所有示例对象文件汇集到仅有的两个配置文件中：
- en: '[PRE33]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'As an alternative to **`cfg_file`**, you can also use the parameter **`cfg_dir`**:
    this requests that you specify the name of a directory from which Nagios should
    integrate all configuration files ending in **`.cfg`** (files with other extensions
    are simply ignored). This also works recursively; Nagios thus evaluates all **`*.cfg`**
    files from all subdirectories. With the parameter **`cfg_dir`** you therefore
    only need to specify a signal directory, instead of calling all configuration
    files, with **`cfg_file`**, individually. The only restriction: these must be
    configuration files that describe objects. The configuration files **`cgi.cfg`**
    and **`resource.cfg`** are excluded from this, which is why, like the main configuration
    file **`nagios.cfg`**, they remain in the main directory **`/etc/nagios`**.'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 作为**`cfg_file`**的替代方案，你也可以使用参数**`cfg_dir`**：这要求你指定一个目录的名称，Nagios 应从该目录中集成所有以**`.cfg`**结尾的配置文件（具有其他扩展名的文件将被简单地忽略）。这也适用于递归；因此，Nagios
    会评估所有子目录中的所有**`*.cfg`**文件。因此，使用**`cfg_dir`**参数，你只需要指定一个信号目录，而不是像使用**`cfg_file`**一样，单独调用所有配置文件。唯一的限制是：这些必须是描述对象的配置文件。配置文件**`cgi.cfg`**和**`resource.cfg`**不包括在内，这就是为什么，像主配置文件**`nagios.cfg`**一样，它们仍然保留在主目录**`/etc/nagios`**中。
- en: Simple structure
  id: totrans-172
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 简单结构
- en: Simple structure
  id: totrans-173
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 简单结构
- en: 'For the object-specific configuration, it is best to create a directory called
    **`/etc/nagios/mysite`**, then remove all **`cfg_file`** directives in **`nagios.cfg`**
    (or comment them out with a **`#`** at the beginning of the line) and replace
    them with the following:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 对于特定对象的配置，最好创建一个名为 **`/etc/nagios/mysite`** 的目录，然后在 **`nagios.cfg`** 中删除所有 **`cfg_file`**
    指令（或在行首用 **`#`** 注释它们），并替换为以下内容：
- en: '[PRE34]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'The contents of the directory **`/etc/nagios`** will be version-independent
    and look like this:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 目录 **`/etc/nagios`** 的内容将是版本无关的，如下所示：
- en: '[PRE35]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: The main directory **`/etc/nagios`** contains only three configuration files
    and the password file for protected Web access. Whether you collect all objects
    of the same type in one separate file, that is all host definitions in **`hosts.cfg`**,
    all services in **`services.cfg`**, and so on, or divide these into separate files,
    is left to the individual.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 主要目录 **`/etc/nagios`** 只包含三个配置文件和受保护Web访问的密码文件。是否将相同类型的所有对象收集在一个单独的文件中，即所有主机定义在
    **`hosts.cfg`** 中，所有服务在 **`services.cfg`** 中，等等，或者将这些对象分割到单独的文件中，由个人自行决定。
- en: In this example, only the top directory **`mysite`** needs to be integrated
    with **`cfg_dir`** in **`nagios.cfg`**. This forms the basis for our initial configuration.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 在此示例中，只需要将顶层目录 **`mysite`** 与 **`nagios.cfg`** 中的 **`cfg_dir`** 集成。这构成了我们初始配置的基础。
- en: A larger location
  id: totrans-180
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 一个更大的位置
- en: 'For larger installations, you should divide the object definitions into individual
    files (creating a separate file with the host definition for each host, for instance)
    and group these in subdirectories according to sensible criteria, as in the following
    example:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 对于较大的安装，您应该将对象定义分割到单独的文件中（例如，为每个主机创建一个包含主机定义的单独文件），并根据合理的标准将这些文件分组到子目录中，如下例所示：
- en: '[PRE36]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'This example arranges the objects according to the operating system (**`linux`**,
    **`windows`**, and **`router`**). Each of these system directories has two further
    subdirectories: **`hosts`** and **`services`**.'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 此示例根据操作系统（**`linux`**、**`windows`** 和 **`router`**）排列对象。这些系统目录中的每个目录都有两个更进一步的子目录：**`hosts`**
    和 **`services`**。
- en: Each of the individual host objects are described in a separate file (for example
    **`linux01.cfg`**). These can easily be copied if you want to create other host
    objects with similar properties. You can copy services in a similar manner.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 每个单独的主机对象都在一个单独的文件中描述（例如 **`linux01.cfg`**）。如果您想创建具有相似属性的其他主机对象，可以轻松地复制这些文件。您也可以以类似的方式复制服务。
- en: The other object definitions are placed either directly in the directory **`my-site`**,
    as in the simple structure in [Simple structure](../Text/ch02.html#simple_structure
    "Simple structure"), or you can create subdirectories, as described in more detail
    in the next section.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 其他对象定义可以直接放置在目录 **`my-site`** 中，如 [简单结构](../Text/ch02.html#simple_structure
    "Simple structure") 中的简单结构所示，或者您可以创建子目录，如下一节更详细地描述的那样。
- en: 'In **`nagios.cfg`** the object definitions are again bound with a single directive:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 在 **`nagios.cfg`** 中，对象定义再次与单个指令绑定：
- en: '[PRE37]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: Large installations with several different locations
  id: totrans-188
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 具有多个不同位置的较大安装
- en: 'For large installations, it is better to split up host and service objects
    according to location. Even for the remaining objects, we recommend that you split
    them up into individual files and group these into subdirectories:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 对于大型安装，最好根据位置将主机和服务对象分割开来。即使对于剩余的对象，我们也建议您将它们分割到单独的文件中，并将这些文件分组到子目录中：
- en: '[PRE38]'
  id: totrans-190
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: In this example, the directory **`global`** gathers together all the objects
    that that do not themselves define a check (that is, everything that is not a
    host or service object). This is where the subdirectories **`commands`**, **`contacts`**,
    **`templates`**, and **`timeperiods`** are located, each of which contain the
    files for the object categories of the same name. For many command objects, individual
    files are easier to handle than one huge text file.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 在此示例中，目录 **`global`** 收集了所有不定义检查的对象（即，所有不是主机或服务对象的东西）。这是 **`commands`**、**`contacts`**、**`templates`**
    和 **`timeperiods`** 子目录所在的位置，每个子目录都包含同名对象类别的文件。对于许多命令对象，单独的文件比一个大文本文件更容易处理。
- en: 'If the contact objects are also stored in individual files, it is easy to disable
    a contact: the file extension is simply changed from **`.cfg`** to **`.cfx`**
    and then a reload is performed. Nagios ignores all files in object directories
    that do not end in **`.cfg`**. The overlying directories **`global`** and **`sites`**
    are bound into **`nagios.cfg`**:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 如果联系人对象也存储在单独的文件中，禁用联系人就很容易：只需将文件扩展名从 **`.cfg`** 更改为 **`.cfx`**，然后执行重新加载。Nagios
    忽略对象目录中所有不以 **`.cfg`** 结尾的文件。上层目录 **`global`** 和 **`sites`** 被绑定到 **`nagios.cfg`**：
- en: '[PRE39]'
  id: totrans-193
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: Setting the European date format
  id: totrans-194
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 设置欧洲日期格式
- en: 'The date specifications in Nagios appear by default in the American format
    **``*`MM-DD -YYYY`*``**:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 中的日期规范默认以美国格式显示 **``*`MM-DD -YYYY`*``**：
- en: '[PRE40]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'If you prefer something else, e.g., the European date format, it is recommended
    that you change the parameter **`date_format`** in **`nagios.cfg`** right from
    the start. The value **`iso8601`** ensures that Nagios date specifications are
    displayed in the ISO or DIN format **``*`YYYY-MM-DD HH-.MM: SS`*``**. [Table 2-1](../Text/ch02.html#possible_date_format
    "Table 2-1. Possible date format") lists the possible values for **`date_format`**.'
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: '如果你更喜欢其他格式，例如欧洲日期格式，建议你从一开始就更改 **`nagios.cfg`** 中的 **`date_format`** 参数。值 **`iso8601`**
    确保Nagios日期规范以 ISO 或 DIN 格式显示 **``*`YYYY-MM-DD HH-.MM: SS`*``**。 [表 2-1](../Text/ch02.html#possible_date_format
    "表 2-1. 可能的日期格式") 列出了 **`date_format`** 的可能值。'
- en: The other parameters in **`nagios.cfg`** are described in [A.1 The Main Configuration
    File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    The Main Configuration File nagios.cfg"); in the original documentation these
    can be found at [http://localhost/nagios/docs/configmain.html](http://localhost/nagios/docs/configmain.html)
    or **`/usr/local/nagios/share/docs/config-main.html`**."
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: '**`nagios.cfg`** 中的其他参数在 [A.1 主配置文件 nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件 nagios.cfg") 中描述；在原始文档中，这些可以在 [http://localhost/nagios/docs/configmain.html](http://localhost/nagios/docs/configmain.html)
    或 **`/usr/local/nagios/share/docs/config-main.html`** 中找到。'
- en: Table 2-1. Possible date format
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 表 2-1. 可能的日期格式
- en: '| Value | Representation |'
  id: totrans-200
  prefs: []
  type: TYPE_TB
  zh: '| 值 | 表示 |'
- en: '| --- | --- |'
  id: totrans-201
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| **`us`** | *MM-DD-YYYY HH:MM:SS* |'
  id: totrans-202
  prefs: []
  type: TYPE_TB
  zh: '| **`us`** | *MM-DD-YYYY HH:MM:SS* |'
- en: '| **`euro`** | *DD-MM-YYYY HH:MM:SS* |'
  id: totrans-203
  prefs: []
  type: TYPE_TB
  zh: '| **`euro`** | *DD-MM-YYYY HH:MM:SS* |'
- en: '| **`iso8601`** | *YYYY-MM-DD HH:MM:SS* |'
  id: totrans-204
  prefs: []
  type: TYPE_TB
  zh: '| **`iso8601`** | *YYYY-MM-DD HH:MM:SS* |'
- en: '| **`strict-iso8601`** | *YYYY-MM-DDTHH:MM:SS* |'
  id: totrans-205
  prefs: []
  type: TYPE_TB
  zh: '| **`strict-iso8601`** | *YYYY-MM-DDTHH:MM:SS* |'
- en: '* * *'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[31](#CHP-2-FN-1)]) [http://mama.indstate.edu/users/ice/tree/](http://mama.indstate.edu/users/ice/tree/)
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[31](#CHP-2-FN-1)]) [http://mama.indstate.edu/users/ice/tree/](http://mama.indstate.edu/users/ice/tree/)
- en: ^([[32](#CHP-2-FN-2)]) If Nagios is from a distribution package, it is worth
    checking at least the path details. In a well-maintained distribution these will
    also be matched to the Nagios directories used there.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[32](#CHP-2-FN-2)]) 如果 Nagios 来自发行版包，至少检查路径细节是值得的。在维护良好的发行版中，这些也将与那里使用的 Nagios
    目录相匹配。
- en: 2.2 Objects—an Overview
  id: totrans-209
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.2 对象——概述
- en: 'A Nagios object describes a specific unit: a host, a service, a contact, or
    the groups to which each belongs. Even commands are defined as objects. This definition
    has not come about by chance. Nagios is also able to inherit characteristics ([2.11
    Templates](../Text/ch02s11.html "2.11 Templates") from page 75).'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 对象描述了特定的单元：一个主机、一个服务、一个联系人或每个所属的组。甚至命令也被定义为对象。这种定义并非偶然。Nagios 还能够继承特性（[2.11
    模板](../Text/ch02s11.html "2.11 模板")，第 75 页）。
- en: 'Object definitions follow the following pattern:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 对象定义遵循以下模式：
- en: '[PRE41]'
  id: totrans-212
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Nagios has the following values for the **``*`object-type`*``**:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 有以下 **``*`object-type`*``** 的值：
- en: '**`host`**'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host`**'
- en: The host object describes one of the network nodes that are to be monitored.
    Nagios expects the IP address as a parameter here (or the *Fully Qualified Domain
    Name*) and the command that should define whether the host is alive (see [2.3
    Defining the Machines to Be Monitored, with host](../Text/ch02s03.html "2.3 Defining
    the Machines to Be Monitored, with host"), page 62). The host definition is re-referenced
    in the service definition.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 主对象描述了要监控的网络节点之一。Nagios 期望在这里使用 IP 地址作为参数（或 *完全限定域名*）以及定义主机是否存活的命令（参见 [2.3 定义要监控的机器，带主机](../Text/ch02s03.html
    "2.3 定义要监控的机器，带主机")，第 62 页）。主机定义在服务定义中重新引用。
- en: '**`hostgroup`**'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: '**`hostgroup`**'
- en: Several hosts can be combined into a group (see [2.4 Grouping Computers Together
    with hostgroup](../Text/ch02s04.html "2.4 Grouping Computers Together with hostgroup")
    in page 65). This simplifies configuration, since entire host groups instead of
    single hosts can be specified when defining services (the service will then exist
    for each member of the group). In addition, Nagios represents the hosts of a host
    group together in a table in the Web front end, which helps to increase clarity.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 可以将多个主机组合成一个组（参见[2.4 使用 hostgroup 组合计算机](../Text/ch02s04.html "2.4 使用 hostgroup
    组合计算机")，第 65 页）。这简化了配置过程，因为定义服务时可以指定整个主机组而不是单个主机（服务将为组中的每个成员存在）。此外，Nagios 在 Web
    前端将主机组的成员一起在表格中展示，这有助于提高清晰度。
- en: '**`service`**'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service`**'
- en: The individual services to be monitored are defined as service objects ([2.5
    Defining Services to Be Monitored with service](../Text/ch02s05.html "2.5 Defining
    Services to Be Monitored with service"), page 66). A service never exists independently
    of a host. So it is quite possible to have several services with the same name,
    as long as they belong to different hosts. The following code,
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 要监控的各个服务被定义为服务对象（参见[2.5 使用 service 定义要监控的服务](../Text/ch02s05.html "2.5 使用 service
    定义要监控的服务")，第 66 页）。服务永远不会独立于主机存在。因此，完全可能存在具有相同名称的多个服务，只要它们属于不同的主机。以下代码，
- en: '[PRE42]'
  id: totrans-220
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: describes two services that both have the same service name but belong to different
    hosts. So in the language of Nagios, a service is always a host-service pair.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 描述了两个具有相同服务名称但属于不同主机的服务。因此，在 Nagios 的语言中，一个服务始终是一个主机-服务对。
- en: '**`servicegroup`**'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: '**`servicegroup`**'
- en: As it does with host groups, Nagios combines several services and represents
    these in the Web front end as a unit with its own table (see [2.6 Grouping Services
    Together with servicegroup](../Text/ch02s06.html "2.6 Grouping Services Together
    with servicegroup"), page 69). Service groups are not absolutely essential, but
    help to improve clarity, and are also used in reporting.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 与主机组类似，Nagios 将多个服务组合在一起，并在 Web 前端以一个具有自己表格的单元来表示这些服务（参见[2.6 使用 servicegroup
    组合服务](../Text/ch02s06.html "2.6 使用 servicegroup 组合服务")，第 69 页）。服务组并非绝对必要，但有助于提高清晰度，并且在报告中也会用到。
- en: '**`contact`**'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: '**`contact`**'
- en: 'A person who is to be informed by Nagios of specific events (see [2.7 Defining
    Addressees for Error Messages: contact](../Text/ch02s07.html "2.7 Defining Addressees
    for Error Messages: contact"), page 70). Nagios uses contact objects to show to
    a user via the Web front end only those things for which the user is listed as
    a contact person. In the basic setting users do not get to see hosts and services
    for which they are not responsible.'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 通知 Nagios 特定事件的人（参见[2.7 定义错误消息的收件人：contact](../Text/ch02s07.html "2.7 定义错误消息的收件人：contact")，第
    70 页）。Nagios 使用联系对象通过 Web 前端向用户展示用户被列为联系人的人员的相关信息。在基本设置中，用户无法看到他们不负责的主机和服务的详细信息。
- en: '**`contactgroup`**'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: '**`contactgroup`**'
- en: 'Notification of events in hosts and services takes place via the contact group
    ([2.8 The Message Recipient: contactgroup](../Text/ch02s08.html "2.8 The Message
    Recipient: contactgroup"), page 72). A direct link between the host/service and
    a contact person is not possible.'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 主机和服务的通知事件通过联系组进行（参见[2.8 消息的接收者：contactgroup](../Text/ch02s08.html "2.8 消息的接收者：contactgroup")，第
    72 页）。主机/服务与联系人之间不可能直接建立联系。
- en: '**`timeperiod`**'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: '**`timeperiod`**'
- en: Describes a time period within which Nagios should inform contact groups ([2.10
    Defining a Time Period with timeperiod](../Text/ch02s10.html "2.10 Defining a
    Time Period with timeperiod"), page 74). Outside such a time slot, the system
    will not send any messages. The messaging chain can be fine-tuned via various
    *time periods*, depending on the host/service and contact/contact groups. More
    on this will be presented in [12.3 The Message Filter](../Text/ch12s03.html "12.3
    The Message Filter"), page 267.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 描述了 Nagios 应该通知联系组的时段（参见[2.10 使用 timeperiod 定义时段](../Text/ch02s10.html "2.10
    使用 timeperiod 定义时段")，第 74 页）。在此时段之外，系统不会发送任何消息。可以通过各种 *时段* 对消息链进行微调，具体取决于主机/服务以及联系人和联系组。更多内容将在[12.3
    消息过滤器](../Text/ch12s03.html "12.3 消息过滤器")中介绍，第 267 页。
- en: '**`command`**'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: '**`command`**'
- en: 'Nagios always calls external programs via command objects ([2.9 When Nagios
    Needs to Do Something: The command Object](../Text/ch02s09.html "2.9 When Nagios
    Needs to Do Something: The command Object"), page 72). Apart from plugins, messaging
    programs also include e-mail or SMS messaging applications.'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios总是通过命令对象调用外部程序（参见[2.9 当Nagios需要做某事时：命令对象](../Text/ch02s09.html "2.9 当Nagios需要做某事时：命令对象")，第72页）。除了插件外，消息程序还包括电子邮件或短信消息应用程序。
- en: '**`servicedependency`**'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: '**`servicedependency`**'
- en: This object type describes dependences between services. If, for example, an
    application does not function without a database, a corresponding dependency object
    will ensure that Nagios will represent the failed database as the primary problem
    instead of just announcing the nonfunctioning of the application (see [12.6 Accounting
    for Dependencies between Hosts and Services](../Text/ch12s06.html "12.6 Accounting
    for Dependencies between Hosts and Services"), page 285).
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 此对象类型描述了服务之间的依赖关系。例如，如果一个应用程序没有数据库就无法运行，相应的依赖对象将确保Nagios将失败的数据库视为主要问题，而不是仅仅宣布应用程序无法运行（参见[12.6
    主机和服务的依赖关系会计](../Text/ch12s06.html "12.6 主机和服务的依赖关系会计")，第285页）。
- en: '**`serviceescalation`**'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: '**`serviceescalation`**'
- en: 'Used to define proper escalation management: if a service is not available
    after a specific time period, Nagios informs a further or different circle of
    people. This can also be configured on multiple levels in any way you want (see
    [12.5 Escalation Management](../Text/ch12s05.html "12.5 Escalation Management")).'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 用于定义适当的升级管理：如果某个服务在特定时间段后不可用，Nagios会通知进一步或不同的人群。这也可以在任何你想要的多级上进行配置（参见[12.5 升级管理](../Text/ch12s05.html
    "12.5 升级管理")）。
- en: '**`hostdependency`**'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: '**`hostdependency`**'
- en: Like **`servicedependency`**, but for hosts.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 类似于**`servicedependency`**，但针对主机。
- en: '**`hostescalation`**'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: '**`hostescalation`**'
- en: Like **`serviceescalation`**, but for hosts.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 类似于**`serviceescalation`**，但针对主机。
- en: '**`hostextinfo`** (Nagios 2.x)'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: '**`hostextinfo`** (Nagios 2.x)'
- en: '*Extended Host Information* objects are optional and define a specific graphic
    and/or URL, which Nagios additionally integrates into its graphic output. The
    URL can refer to a Web page that provides additional information on the host (see
    [16.4 Additional Information on Hosts and Services](../Text/ch16s04.html "16.4
    Additional Information on Hosts and Services"), page 362).'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: '*扩展主机信息*对象是可选的，并定义了特定的图形和/或URL，Nagios会将其额外集成到其图形输出中。该URL可以指向提供主机额外信息的网页（参见[16.4
    主机和服务的附加信息](../Text/ch16s04.html "16.4 主机和服务的附加信息")，第362页）。'
- en: '**`hostextinfo`** This object is deprecated in Nagios 3.0, but it is still
    available. Nagios 3.0 integrated the object parameters into the host definition.'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: '**`hostextinfo`** 该对象在Nagios 3.0中已弃用，但仍然可用。Nagios 3.0将对象参数集成到了主机定义中。'
- en: '**`serviceextinfo`** (Nagios 2.x)'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: '**`serviceextinfo`** (Nagios 2.x)'
- en: '*Extended Service Information*, like *Extended Host Information*.'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: '*扩展服务信息*，类似于*扩展主机信息*。'
- en: Not all object types are absolutely essential; especially at the beginning.
    You easily can do without the **`*dependency`**, **`*escalation`**, and **`*extinfo`**
    objects, as well as the **`servicegroup`**. [Chapter 12](../Text/ch12.html "Chapter 12. The
    Nagios Notification System") looks at escalation and dependencies in detail. **`hostextinfo`**
    and **`serviceextinfo`** are used to provide a "more colorful" graphical representation,
    but they are not at all necessary for running Nagios. [16.4 Additional Information
    on Hosts and Services](../Text/ch16s04.html "16.4 Additional Information on Hosts
    and Services") from page 362 looks at this in more detail. The original documentation
    also provides more information.^([[33](#ftn.CHP-2-FN-3)])
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 并非所有对象类型都是绝对必要的；尤其是在开始时。你可以很容易地不使用**`*dependency`**、**`*escalation`**、**`*extinfo`**对象以及**`servicegroup`**。[第12章](../Text/ch12.html
    "第12章。Nagios通知系统")详细探讨了升级和依赖关系。**`hostextinfo`**和**`serviceextinfo`**用于提供“更丰富多彩”的图形表示，但它们对于运行Nagios并非绝对必要。[16.4
    主机和服务的附加信息](../Text/ch16s04.html "16.4 主机和服务的附加信息")从第362页更详细地探讨了这一点。原始文档还提供了更多信息。[33](#ftn.CHP-2-FN-3)]
- en: Notes on the object examples below
  id: totrans-246
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 以下对象示例的注意事项
- en: Notes on the object examples below
  id: totrans-247
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 以下对象示例的注意事项
- en: Although the following chapters describe individual object types in detail,
    only the mandatory parameters and those that are absolutely essential for meaningful
    operation are described there. Mandatory parameters here are always printed in
    **bold** type. The first (comment) line in each example lists the file in which
    the recorded object definition is to be stored. For the parameters marked with
    (*), there are some differences between Nagios 2.x and Nagios 3.0, each of which
    will be explained in more depth in the text.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然以下章节详细描述了各个对象类型，但只描述了必需的参数以及那些对有意义操作绝对必要的参数。这里的必需参数总是以**粗体**形式打印。每个示例的第一个（注释）行列出记录对象定义要存储的文件。对于标记为(*)的参数，Nagios
    2.x和Nagios 3.0之间存在一些差异，这些差异将在文本中更深入地解释。
- en: When you first start using Nagios, it is recommended that you restrict yourself
    to a minimal configuration with only one or two objects per object type, in order
    to keep potential sources of error to a minimum and to obtain a running system
    as quickly as possible. Afterwards extensions can be implemented very simply and
    quickly, especially if you incorporate the tips mentioned in [2.11 Templates](../Text/ch02s11.html
    "2.11 Templates") in templates (page 75).
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 当你首次开始使用Nagios时，建议你限制自己使用最小配置，每个对象类型只有一个或两个对象，以将潜在的错误来源降到最低，并尽可能快地获得一个运行系统。之后，扩展可以非常简单和快速地实现，特别是如果你在模板中包含了[2.11
    模板](../Text/ch02s11.html "2.11 模板"）中提到的提示（第75页）。
- en: Time details in general refer to time units. A time unit consists of 60 seconds
    by default. It can be set to a different value in the configuration file **`nagios.cfg`**,
    using the parameter **`interval_length`**. You should really change this parameter
    only if you know exactly what you are doing.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，时间细节指的是时间单位。默认情况下，一个时间单位由60秒组成。可以在配置文件**`nagios.cfg`**中使用参数**`interval_length`**将其设置为不同的值。只有当你确切知道自己在做什么时，才应该更改此参数。
- en: '* * *'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[33](#CHP-2-FN-3)]) [http://localhost/nagios/docs/objectdefinitions.html#hostextinfo](http://localhost/nagios/docs/objectdefinitions.html#hostextinfo)
    or **`#serviceextinfo`** (Nagios 3.0)
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[33](#CHP-2-FN-3)]) [http://localhost/nagios/docs/objectdefinitions.html#hostextinfo](http://localhost/nagios/docs/objectdefinitions.html#hostextinfo)
    或 **`#serviceextinfo`**（Nagios 3.0）
- en: '[http://localhost/nagios/docs/xodtemplate.html#hostextinfo](http://localhost/nagios/docs/xodtemplate.html#hostextinfo)
    or **`#ser-viceextinfo`** (Nagios 2.x); the files can be found locally in **`/usr/local/nagios/share/docs/`**.'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://localhost/nagios/docs/xodtemplate.html#hostextinfo](http://localhost/nagios/docs/xodtemplate.html#hostextinfo)
    或 **`#serviceextinfo`**（Nagios 2.x）；文件可以在本地**`/usr/local/nagios/share/docs/`**中找到。'
- en: 2.3 Defining the Machines to Be Monitored, with **`host`**
  id: totrans-254
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.3 使用**`host`**定义要监控的机器
- en: 'The host object is the central command post on which all host and service checks
    are based. It defines the machine to be monitored. The parameters printed in bold
    must be specified in all cases:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 主机对象是所有主机和服务检查的基础中央指挥所。它定义了要监控的机器。必须指定打印为粗体的所有参数：
- en: '[PRE43]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: '**`host_name`**'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_name`**'
- en: This parameter specifies the host name with which Nagios addresses the machine
    in services, host groups, and other objects. Only the special characters **`-`**
    and **`_`** are allowed.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数指定Nagios在服务、主机组和其它对象中使用的机器名称。只允许特殊字符**`-`**和**`_`**。
- en: '**`hostgroups`**'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: '**`hostgroups`**'
- en: This parameter allocates the host to a host group object, which must already
    be defined ([2.4 Grouping Computers Together with hostgroup](../Text/ch02s04.html
    "2.4 Grouping Computers Together with hostgroup"), page 65). A host group in the
    Web interface combines several hosts into a group (see [Figure 16-10](../Text/ch16s02.html#the_overview_output_style
    "Figure 16-10. The overview output style") in page 334). The second possibility
    of assigning a host to a host group, compatible with version 1.x, uses the **`members`**
    parameter in defining the host group itself. The two methods can also be combined.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数将主机分配给一个主机组对象，该对象必须已经定义（[2.4 使用hostgroup将计算机分组](../Text/ch02s04.html "2.4
    使用hostgroup将计算机分组"，第65页））。在Web界面中，主机组将几个主机组合成一个组（参见第334页的[图16-10](../Text/ch16s02.html#the_overview_output_style
    "图16-10. 概述输出样式")）。将主机分配给主机组的第二种可能性，与版本1.x兼容，使用在定义主机组本身时使用的**`members`**参数。两种方法也可以结合使用。
- en: '**`alias`**'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: '**`alias`**'
- en: This parameter contains a short description of the host, which Nagios displays
    at various locations as additional information. Ordinary text is allowed here.
    The parameter is no longer obligatory from Nagios 3.0\. If it is missing, the
    value from **`host_name`** is used.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数包含对主机的简短描述，Nagios会在多个位置将其作为附加信息显示。这里允许使用普通文本。从Nagios 3.0开始，该参数不再是必需的。如果缺失，将使用**`host_name`**的值。
- en: '**`address`**'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: '**`address`**'
- en: This specifies the IP address or the *Fully Qualified Domain Name* (FQDN) of
    the computer. If it is possible (i.e., for static IP addresses), you should use
    an IP address, since the resolution of a name to an IP address is always dependent
    on DNS working, which is not infallible.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 这指定了计算机的IP地址或*完全限定域名*（FQDN）。如果可能（即对于静态IP地址），你应该使用IP地址，因为将名称解析为IP地址始终依赖于DNS工作，而这并不总是可靠的。
- en: '**`check_command`**'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_command`**'
- en: This specifies the command with which Nagios checks, if necessary, to see whether
    the host is reachable. The parameter is optional. If it is omitted, Nagios will
    never carry out a host check! This can be useful for network components that are
    frequently switched off (for example, print servers).
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 这指定了Nagios在必要时用来检查主机是否可达的命令。该参数是可选的。如果省略，Nagios将永远不会执行主机检查！这对于经常关闭的网络组件（例如，打印机服务器）可能很有用。
- en: 'The command usually used for **`check_command`** is called **`check-host -alive`**,
    which is already predefined in the supplied file, **`checkcom-mands.cfg`** (see
    [2.9 When Nagios Needs to Do Something: The command Object](../Text/ch02s09.html
    "2.9 When Nagios Needs to Do Something: The command Object"), page 72). This makes
    use of either the plugin **`check_ping`** or the more modern **`check_icmp`**.
    Both plugins check the reachability of the host via the ICMP packets *ICMP Echo
    Request* and *Echo Reply*.'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 通常用于**`check_command`**的命令称为**`check-host -alive`**，它已在提供的文件**`checkcom-mands.cfg`**中预定义（见[2.9
    当Nagios需要做某事时：命令对象](../Text/ch02s09.html "2.9 当Nagios需要做某事时：命令对象")，第72页）。这使用了插件**`check_ping`**或更现代的**`check_icmp`**。这两个插件都通过ICMP数据包*ICMP
    Echo Request*和*Echo Reply*检查主机的可达性。
- en: '**`max_check_attempts`**'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: '**`max_check_attempts`**'
- en: This parameter determines how often Nagios should try to reach the computer
    if the first test has gone wrong. The value **`3`** in the example means that
    the test is repeated up to three times if it returns anything other than OK in
    the first test. As long as there are still repeat tests to be made, Nagios refers
    to this as a *soft state*. If the final test has been made, the system categorizes
    the state as *hard*. Nagios notifies the system administrator exclusively of hard
    states, and in the example, sends messages only if the third test also ends with
    an error or warning.
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数决定了Nagios在第一次测试失败后应多久尝试连接到计算机。示例中的值**`3`**表示，如果第一次测试返回的不是OK，则测试将重复进行最多三次。只要还有重复测试要进行，Nagios就将其称为*软状态*。如果最终进行了测试，系统将状态分类为*硬状态*。Nagios仅通知系统管理员硬状态，在示例中，只有在第三次测试也以错误或警告结束的情况下才会发送消息。
- en: '**`check_period`**'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_period`**'
- en: This specifies the time period in which the host should be monitored. Really,
    only "round the clock" makes sense—that is, **`24×7`**. A **`timeperiod`** object
    is involved here, the definition of which is described in more detail in [2.10
    Defining a Time Period with timeperiod](../Text/ch02s10.html "2.10 Defining a
    Time Period with timeperiod") in page 74\. It only makes sense to use a specification
    other than **`24×7`** if you want to explicitly suppress the host check at certain
    times.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 这指定了主机应该被监控的时间段。实际上，只有“全天候”才有意义——即**`24×7`**。这里涉及到一个**`timeperiod`**对象，其定义在[2.10
    使用timeperiod定义时间周期](../Text/ch02s10.html "2.10 使用timeperiod定义时间周期")的第74页有更详细的描述。除非你想在特定时间显式抑制主机检查，否则使用除**`24×7`**之外的其他指定是没有意义的。
- en: '**`contact_groups`**'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: '**`contact_groups`**'
- en: 'This specifies the receiver of messages which Nagios sends with respect to
    the hosts defined here, that is **`localadmin`**. [2.8 The Message Recipient:
    contactgroup](../Text/ch02s08.html "2.8 The Message Recipient: contactgroup")
    explains this more fully in page 72.'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 这指定了Nagios发送与在此定义的主机相关的消息的接收者，即**`localadmin`**。[2.8 消息接收者：contactgroup](../Text/ch02s08.html
    "2.8 消息接收者：contactgroup")在第72页对此有更全面的解释。
- en: '**`notification_interval`**'
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: '**`notification_interval`**'
- en: This specifies at what intervals Nagios should repeat notification of the continued
    existence of the state. 120 time units normally mean one message every 120 minutes,
    provided the error state continues.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 这指定了 Nagios 应该在什么时间间隔内重复通知状态的持续存在。120 个时间单位通常意味着每 120 分钟发送一条消息，前提是错误状态持续。
- en: '**`notification_period`**'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: '**`notification_period`**'
- en: 'This specifies at what time interval a message should be sent. A time period
    different from **`24×7`** could certainly be useful here. It is important to understand
    the difference here with **`check_period`**: if **`check_period`** excludes time
    periods, Nagios cannot even determine whether there is an error or not. But if
    the host is monitored round-the-clock and only the notification period is restricted
    by the parameter **`notification_period`**, Nagios will certainly log errors and
    also display them in the Web front end and in log evaluations. Outside the **`notification_period`**
    the system does not send any messages. A more detailed description of the notification
    system is given in [12.3 The Message Filter](../Text/ch12s03.html "12.3 The Message
    Filter"), page 267.'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 这指定了应该发送消息的时间间隔。与 **`check_period`** 不同的时间段在这里可能非常有用。理解这里的区别很重要：如果 **`check_period`**
    排除了时间段，Nagios 甚至无法确定是否存在错误。但如果主机全天候监控，并且仅通过参数 **`notification_period`** 限制通知时间段，Nagios
    一定会记录错误，并在 Web 前端和日志评估中显示它们。在 **`notification_period`** 之外，系统不会发送任何消息。有关通知系统的更详细描述，请参阅[12.3
    消息过滤器](../Text/ch12s03.html "12.3 消息过滤器")，第 267 页。
- en: '**`notification_options`**'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: '**`notification_options`**'
- en: 'This parameter describes the states about which Nagios should provide notification
    when they occur. Nagios knows the following states for computers:'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数描述了 Nagios 在状态发生时应提供通知的状态。Nagios 对于计算机知道以下状态：
- en: '| **`d`** | down |'
  id: totrans-280
  prefs: []
  type: TYPE_TB
  zh: '| **`d`** | 停机 |'
- en: '| **`u`** | unreachable (host is not reachable because a network node between
    Nagios and a host has failed and the actual state of the host cannot be determined)
    |'
  id: totrans-281
  prefs: []
  type: TYPE_TB
  zh: '| **`u`** | 不可达（由于 Nagios 和主机之间的网络节点失败，主机不可达，无法确定主机的实际状态） |'
- en: '| **`r`** | recovery (OK state after an error) |'
  id: totrans-282
  prefs: []
  type: TYPE_TB
  zh: '| **`r`** | 恢复（错误后的正常状态） |'
- en: '| **`f`** | flapping (state changes very quickly; more on this in [Appendix B](../Text/apb.html
    "Appendix B. Rapidly Alternating States: Flapping") from page 611). |'
  id: totrans-283
  prefs: []
  type: TYPE_TB
  zh: '| **`f`** | 振荡（状态变化非常快；有关更多信息，请参阅第 611 页的[附录 B](../Text/apb.html "附录 B. 快速交替状态：振荡")）。
    |'
- en: '| **`s`** | scheduled downtime (Nagios 3.0 provides information here on the
    start and end of a planned maintenance period, or in case a planned maintenance
    period is canceled. This option is not available for Nagios 2.x.) |'
  id: totrans-284
  prefs: []
  type: TYPE_TB
  zh: '| **`s`** | 计划停机时间（Nagios 3.0 提供有关计划维护期开始和结束的信息，或在计划维护期取消的情况下。此选项在 Nagios 2.x
    中不可用。） |'
- en: By specifying **`d`**, **`u`**, the system will send messages if the host is
    not on the network or not reachable over the network, but not if it can be reached
    again after an error state (recovery). If **`n`** (none) is used as the value,
    Nagios will normally not give any notification.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 通过指定 **`d`**、**`u`**，当主机不在网络上或通过网络不可达时，系统会发送消息，但如果在错误状态（恢复）之后可以再次到达，则不会发送消息。如果使用
    **`n`**（无）作为值，Nagios 通常不会发出任何通知。
- en: The form in which Nagios sends out a message depends on how the contact is defined.
    Irrespective of when you want to be notified, the Web interface always shows the
    current state, even if Nagios does not send a message, because the time period
    does not match or the system is still repeating the tests (the so-called soft
    state).
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 发送消息的形式取决于联系人的定义方式。无论您何时想要被通知，Web 界面总是显示当前状态，即使 Nagios 没有发送消息，因为时间段不匹配或系统仍在重复测试（所谓的软状态）。
- en: '**`parents`**'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: '**`parents`**'
- en: This allows the physical topology of the network to be taken into account. Here
    the router or the network component is given by which the host is reachable if
    it is not in direct contact in the same network segment. This can also be a switch
    between the Nagios server and the host. If Nagios does not reach the host because
    all parents (separated by commas) are down, then Nagios categorizes it as UNREACHABLE,
    but not as DOWN.
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 这允许考虑网络的物理拓扑。在这里，如果主机不在同一网络段中直接接触，则通过路由器或网络组件可以到达主机。这也可以是 Nagios 服务器和主机之间的交换机。如果
    Nagios 由于所有父节点（用逗号分隔）都停机而无法到达主机，则 Nagios 将其分类为 UNREACHABLE，而不是 DOWN。
- en: Further information is provided by the Nagios 3.0 online help under [http://localhost/nagios/docs//objectdefinitions.html#host](http://localhost/nagios/docs//objectdefinitions.html#host).^([[34](#ftn.CHP-2-FN-4)])
    In Nagios 2.x the file is called **`xodtemplate.html`** and can be found in the
    same directory. The differences between Nagios 2.x and Nagios 3.0 are described
    in [H.1.1 The host object](../Text/aph.html#the_host_object "H.1.1 The host object"),
    page 678.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 更多信息可以在Nagios 3.0在线帮助中找到，地址为[http://localhost/nagios/docs//objectdefinitions.html#host](http://localhost/nagios/docs//objectdefinitions.html#host).^([[34](#ftn.CHP-2-FN-4)])
    在Nagios 2.x中，该文件名为**`xodtemplate.html`**，位于同一目录下。Nagios 2.x和Nagios 3.0之间的差异在[H.1.1
    主机对象](../Text/aph.html#the_host_object "H.1.1 主机对象")中描述，第678页。
- en: '* * *'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[34](#CHP-2-FN-4)]) Locally in **`/usr/local/nagios/share/docs/objectdefinitions.html`**.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[34](#CHP-2-FN-4)]) 本地位于 **`/usr/local/nagios/share/docs/objectdefinitions.html`**。
- en: 2.4 Grouping Computers Together with **`hostgroup`**
  id: totrans-292
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.4 使用 **`hostgroup`** 将计算机分组
- en: A host group contains one or more computers so that they can be represented
    in the Web interface together (see [Figure 16-10](../Text/ch16s02.html#the_overview_output_style
    "Figure 16-10. The overview output style") in page 334)—in addition, certain objects
    (e.g., services) can be applied to an entire group of computers instead of having
    to define them individually for each host.
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 主机组包含一个或多个计算机，以便它们可以在Web界面中一起表示（参见第334页的[图16-10](../Text/ch16s02.html#the_overview_output_style
    "图16-10. 概述输出样式")）——此外，某些对象（例如，服务）可以应用于整个计算机组，而不是为每个主机单独定义它们。
- en: 'The **`hostgroup_name`** parameter specifies a unique name for the group, alias
    accepts a short description. The **`members`** parameter lists all hosts names
    belonging to the group, separated by commas:'
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: '**`hostgroup_name`** 参数指定了组的唯一名称，别名接受简短描述。**`members`** 参数列出了属于该组的所有主机名称，名称之间用逗号分隔：'
- en: '[PRE44]'
  id: totrans-295
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: If you specify to which group they belong in the host definition for individual
    member computers, with the parameter **`hostgroups`** ([2.3 Defining the Machines
    to Be Monitored, with host](../Text/ch02s03.html "2.3 Defining the Machines to
    Be Monitored, with host")), the **`members`** entry may be omitted from version
    2.0\. This means that you no longer have two search through all group definitions
    if you just want to delete a single host. The combined use—of **`members`** in
    the **`hostgroup`** object and at the same time, of **`hostgroups`** in the **`host`**
    object—is equally possible. A new host group in Nagios 3.0 is **`hostgroup_members`**,
    with which you can specify other host groups as members, and thus form hierarchies
    of host groups. This option is not available in Nagios 2.0.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在单个成员计算机的主机定义中指定它们所属的组，使用参数**`hostgroups`** ([2.3 使用主机定义要监控的机器](../Text/ch02s03.html
    "2.3 使用主机定义要监控的机器"))，则从版本2.0开始可以省略**`members`**条目。这意味着如果您只想删除单个主机，就不再需要搜索所有组定义。**`members`**在**`hostgroup`**对象中的使用和**`hostgroups`**在**`host`**对象中的同时使用是同样可能的。Nagios
    3.0中的新主机组是**`hostgroup_members`**，您可以使用它指定其他主机组作为成员，从而形成主机组的层次结构。此选项在Nagios 2.0中不可用。
- en: 2.5 Defining Services to Be Monitored with **`service`**
  id: totrans-297
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.5 使用 **`service`** 定义要监控的服务
- en: A service in Nagios always consists of the combination of a host and a service
    name. This combination must be unique. Service names, on the other hand, may occur
    many times, as long as they are combined with different hosts.
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios中的服务始终由主机和服务的组合组成。这种组合必须是唯一的。另一方面，服务名称可以多次出现，只要它们与不同的主机组合。
- en: 'The simplest service consists of a simple ping, which tests whether the relevant
    host is reachable, and which registers the response time and any packet loss that
    may occur:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 最简单的服务由简单的ping组成，该ping测试相关主机是否可达，并记录响应时间和可能发生的任何丢包：
- en: '[PRE45]'
  id: totrans-300
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: In contrast to a host check, which Nagios carries out only if it cannot reach
    any other service of the host, a ping service is carried out at regular intervals.
    Problems in the network can be detected relatively simply through response times
    and packet loss rates. The host check is less suitable for this purpose.
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 与Nagios仅在无法访问主机上的任何其他服务时才执行的主机检查相比，ping服务是定期执行的。可以通过响应时间和丢包率相对简单地检测到网络问题。主机检查不适用于此目的。
- en: '**`host_name`**'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_name`**'
- en: This refers to the name defined in the host object. Nagios also obtains the
    IP address of the computer via this. Instead of a single host name, you can also
    enter a comma-separated list of multiple hosts. As an alternative to **`host_name`**,
    it is also possible to use the parameter **`hostgroup_name`** to specify an entire
    host group instead of individual hosts. The service is then considered to be defined
    for each of the individual computers groups together in this way. Whether you
    make use of this optimization, or allocate your own service definitions to each
    computer individually, makes no difference to Nagios.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 这指的是在主机对象中定义的名称。Nagios也通过这种方式获取计算机的IP地址。除了单个主机名外，还可以输入由逗号分隔的多个主机列表。作为 **`host_name`**
    的替代，也可以使用参数 **`hostgroup_name`** 来指定整个主机组而不是单个主机。这样，服务就被认为是为以这种方式组合在一起的每个单独的计算机组定义的。您是否使用这种优化，或者为每台计算机分配自己的服务定义，对Nagios来说没有区别。
- en: '**`service_description`**'
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_description`**'
- en: 'This parameter defines the actual name of the service. Spaces, colons, and
    dashes may be included in the name. Nagios always addresses a service as a combination
    of host name (here: **`linux01`**) and service description (**`PING`**). This
    must be unique.'
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数定义了服务的实际名称。名称中可以包含空格、冒号和破折号。Nagios始终将服务视为主机名（此处为 **`linux01`**）和服务描述（**`PING`**）的组合。这必须是唯一的。
- en: '**`servicegroups`**'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: '**`servicegroups`**'
- en: assigns the service to a service group object that must already be defined ([2.6
    Grouping Services Together with servicegroup](../Text/ch02s06.html "2.6 Grouping
    Services Together with servicegroup"), page 69).
  id: totrans-307
  prefs: []
  type: TYPE_NORMAL
  zh: 将服务分配给必须已经定义的服务组对象（[2.6 使用servicegroup将服务分组在一起](../Text/ch02s06.html "2.6 使用servicegroup将服务分组在一起")，第69页）。
- en: '**`check_command`**'
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_command`**'
- en: 'This defines the command with which Nagios tests the service for functionality
    Arguments are passed on to the actual command, ie. **`check_ping`**, separated
    by exclamation marks. The definition of the **`check_ping`** command, predefined
    in the example files, is explained in [2.9 When Nagios Needs to Do Something:
    The command Object](../Text/ch02s09.html "2.9 When Nagios Needs to Do Something:
    The command Object") in page 72.'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 这定义了Nagios测试服务功能时使用的命令。参数通过感叹号传递给实际命令，例如 **`check_ping`**。在示例文件中预定义的 **`check_ping`**
    命令的定义在[2.9 当Nagios需要执行某些操作时：命令对象](../Text/ch02s09.html "2.9 当Nagios需要执行某些操作时：命令对象")的第72页中解释。
- en: 'In the example, the values for the warning limit (**`100 ms, 20%`**) and for
    the CRITICAL status (**`500 ms, 60%`**) are determined. You could compare this
    to a traffic light: the state OK (green) occurs if the response time remains under
    the warning limit of 100 milliseconds, and if none or less than 20 percent of
    packets have been lost. The WARNING state (yellow) occurs if the packet loss or
    response time lies above the defined warning limit, but still beneath the critical
    limit. Above the critical limit, Nagios issues a CRITICAL state (red). The return
    value of the plugin is described at the beginning of [Chapter 6](../Text/ch06.html
    "Chapter 6. Plugins for Network Services") (page 6), the underlying plugin **`check_icmp`**
    is introduced in detail in [6.2 Reachability Test with Ping](../Text/ch06s02.html
    "6.2 Reachability Test with Ping") from page 108.'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 在示例中，确定了警告限制的值（**`100 ms, 20%`**）和CRITICAL状态的值（**`500 ms, 60%`**）。您可以将其比作交通灯：如果响应时间保持在100毫秒的警告限制以下，并且没有或小于20%的数据包丢失，则状态为OK（绿色）。如果数据包丢失或响应时间超过定义的警告限制，但仍在临界限制以下，则状态为WARNING（黄色）。如果超过临界限制，Nagios将发出CRITICAL状态（红色）。插件返回值在[第6章](../Text/ch06.html
    "第6章。网络服务插件")（第6页）的开头描述，基础插件 **`check_icmp`** 在[6.2 使用Ping进行可达性测试](../Text/ch06s02.html
    "6.2 使用Ping进行可达性测试")的第108页中详细介绍。
- en: '**`max_check_attempts`**'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: '**`max_check_attempts`**'
- en: This specifies how often Nagios should repeat a test in order to verify and
    definitively accept an error state which has been discovered (or also the recovered
    functionality), that is, to recognize it as a *hard state*. In the transitional
    phase (for example from OK to CRITICAL) we speak of a *soft state*. Basic distinctions
    between soft and hard are only made by the Nagios notification system, which is
    why the two states are described in more detail in the context of this system
    ([Chapter 12](../Text/ch12.html "Chapter 12. The Nagios Notification System"),
    page 265). The difference has no influence in the representation in the Web interface.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 这指定了Nagios应该多久重复一次测试，以验证和最终接受已发现（或已恢复的功能）的错误状态，即将其识别为*硬状态*。在过渡阶段（例如从OK到CRITICAL），我们称之为*软状态*。软和硬之间的基本区别仅由Nagios通知系统做出，这就是为什么这两个状态在系统上下文中被更详细地描述（见[第12章](../Text/ch12.html
    "第12章. Nagios通知系统")，第265页）。这种差异对Web界面的表示没有影响。
- en: '**`normal_check_interval`**'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: '**`normal_check_interval**'
- en: This specifies at what interval Nagios should test the service when the system
    is in a stable condition—this can equally be an OK or an error state. In the example
    this is five time units, which is normally five minutes. In Nagios 3.0 the parameter
    may also be written as **`check_interval`**; as for the host definition, both
    forms are equivalent.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 这指定了当系统处于稳定状态时，Nagios应该以什么间隔测试服务——这可以同样是一个OK或错误状态。在示例中，这是五个时间单位，通常是五分钟。在Nagios
    3.0中，该参数也可以写成**`check_interval`**；与主机定义一样，两种形式是等效的。
- en: '**`retry_check_interval`**'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: '**`retry_check_interval`**'
- en: This describes the time interval between two tests when the state is in the
    process of changing (for example, from OK to WARNING), that is, when there is
    a soft state. In Nagios 3.0 the parameter may also be written as **`retry_interval`**;
    both forms are equivalent.
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 这描述了在状态正在变化的过程中（例如，从OK到WARNING），即存在软状态时，两次测试之间的时间间隔。在Nagios 3.0中，该参数也可以写成**`retry_interval`**；两种形式是等效的。
- en: As soon as Nagios has performed the number of tests specified in **`max_check_attempts`**,
    it checks the service again at intervals of **`normal_check_interval`**.
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦Nagios执行了在**`max_check_attempts`**中指定的测试次数，它就会以**`normal_check_interval`**的间隔再次检查服务。
- en: '**`check_period`**'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_period`**'
- en: This describes the time period in which the service is to be monitored. The
    entry represents a **`timeperiod`** object, the definition of which is described
    in more detail in [2.10 Defining a Time Period with timeperiod](../Text/ch02s10.html
    "2.10 Defining a Time Period with timeperiod") from page 74\. Here you should
    enter **`24×7`** for "round the clock" unless you want to explicitly stop the
    test from running at specific times (perhaps because of a scheduled maintenance
    slot). If the notification is to be prevented only at specific times, it is better
    to use the option **`notification_period`** or other filters of the Nagios notification
    system (see [Chapter 12](../Text/ch12.html "Chapter 12. The Nagios Notification
    System"), page 265).
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 这描述了服务需要被监控的时间段。条目代表一个**`timeperiod`**对象，其定义在[2.10 使用timeperiod定义时间周期](../Text/ch02s10.html
    "2.10 使用timeperiod定义时间周期")中详细描述，见第74页。在此处，你应该输入**`24×7`**表示“全天候”，除非你希望明确停止在特定时间运行测试（可能是因为计划中的维护时段）。如果只想在特定时间防止通知，则最好使用**`notification_period`**或其他Nagios通知系统的过滤器（见[第12章](../Text/ch12.html
    "第12章. Nagios通知系统")，第265页）。
- en: '**`notification_interval`**'
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: '**`notification_interval`**'
- en: This determines at what regular intervals Nagios repeats reports on error states.
    In the example, the system does this every 120 time units (normally minutes),
    as long as the error state continues. A value of **`0`** causes Nagios to announce
    the current state only once. Beginning with Nagios 3.0, **`notification_interval`**
    is no longer an obligatory parameter. If it is missing, the value is taken from
    the accompanying host definition.
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 这决定了Nagios在什么规律的时间间隔重复报告错误状态。在示例中，只要错误状态持续，系统就会每120个时间单位（通常是分钟）这样做。**`0`**的值会导致Nagios只宣布当前状态一次。从Nagios
    3.0开始，**`notification_interval`**不再是必选参数。如果它缺失，则值将从相关的主机定义中获取。
- en: '**`notification_period`**'
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: '**`notification_period`**'
- en: This describes the time period within which a notification should take place.
    This again involves a **`timeperiod`** object (see [2.10 Defining a Time Period
    with timeperiod](../Text/ch02s10.html "2.10 Defining a Time Period with timeperiod")).
    Here in the example, **`24×7`** is used, so notification is sent round the clock.
    A more detailed discussion of the **`notification_period`** parameter can be found
    in [12.3 The Message Filter](../Text/ch12s03.html "12.3 The Message Filter") from
    page 267\. Beginning with Nagios 3.0 this parameter is optional. If it is missing,
    the value is taken from the accompanying host definition.
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 这描述了通知应在其中发生的时间段。这又涉及到一个**`timeperiod`**对象（参见[2.10 使用timeperiod定义时间段](../Text/ch02s10.html
    "2.10 使用timeperiod定义时间段")）。在此示例中，**`24×7`**被使用，因此通知将全天发送。关于**`notification_period`**参数的更详细讨论可以在[12.3
    消息过滤器](../Text/ch12s03.html "12.3 消息过滤器")的第267页中找到。从Nagios 3.0开始，此参数是可选的。如果缺失，则值将从伴随的主机定义中获取。
- en: '**`notification_options`**'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: '**`notification_options`**'
- en: This determines which error states Nagios should report. Possible values which
    can be used here are the same states already described for host objects, i.e.,
    **`c`** (critical), **`w`** (warning), **`u`** (unknown), **`r`** (recovered),
    **`f`** (flapping), and (from Nagios 3.0) **`s`** (planned maintenance interval).
    Specifying **`c`**, **`r`** only informs the system when a service is in a CRITICAL
    state and if it subsequently recovers (RECOVERY).
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 这决定了Nagios应报告哪些错误状态。在此处可以使用与主机对象中已描述的相同状态，即**`c`**（严重），**`w`**（警告），**`u`**（未知），**`r`**（恢复），**`f`**（波动），以及（从Nagios
    3.0开始）**`s`**（计划维护间隔）。指定**`c`**，**`r`**仅当服务处于严重状态并随后恢复（恢复）时通知系统。
- en: If you use **`n`** (none) as the value, Nagios will normally not send any notification.
    The Web interface nevertheless shows the current states.
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 如果使用**`n`**（无）作为值，Nagios通常不会发送任何通知。但Web界面仍然显示当前状态。
- en: '**`contact_groups`**'
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: '**`contact_groups`**'
- en: Finally, this parameter defines the recipient group whose members should receive
    the notifications. Several groups can be entered as a comma-separated list. Beginning
    with Nagios 3.0 this parameter can be omitted. Then the value is taken from the
    accompanying host definition.
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，此参数定义了应接收通知的接收者组。可以输入多个组，用逗号分隔。从Nagios 3.0开始，此参数可以省略。然后值将从伴随的主机定义中获取。
- en: Further information can be found in the Nagios 3.0 online help at [http://localhost/nagios/docs/objectdefinitions.html#service](http://localhost/nagios/docs/objectdefinitions.html#service).^([[35](#ftn.CHP-2-FN-5)])
    For version 2.x the file is called **`xodtemplate.html`**. The differences between
    Nagios 2.x and Nagios 3.0 are described in [H.1.2 The service object](../Text/aph.html#the_service_object
    "H.1.2 The service object") from page 680.
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 更多信息可以在Nagios 3.0在线帮助中找到，请访问[http://localhost/nagios/docs/objectdefinitions.html#service](http://localhost/nagios/docs/objectdefinitions.html#service).^([[35](#ftn.CHP-2-FN-5)])
    对于2.x版本，文件名为**`xodtemplate.html`**。Nagios 2.x和Nagios 3.0之间的差异在[H.1.2 服务对象](../Text/aph.html#the_service_object
    "H.1.2 服务对象")的第680页中描述。
- en: '* * *'
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[35](#CHP-2-FN-5)]) The corresponding file is located after installation
    in the directory **`/usr/local/nagios/share/docs/`**.
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[35](#CHP-2-FN-5)]) 相应的文件在安装后位于目录**`/usr/local/nagios/share/docs/`**。
- en: 2.6 Grouping Services Together with **`servicegroup`**
  id: totrans-332
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.6 使用**`servicegroup`**组合服务
- en: Service groups, like host groups, combine several services into a group, so
    that they can be represented together in the Web front end. This increases clarity
    and simplifies certain evaluations, but it is optional, and is not recommended
    at the beginning, in order to keep configuration simple.
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 服务组，就像主机组一样，将多个服务组合成一个组，以便可以在Web前端一起表示。这增加了清晰度并简化了某些评估，但这是可选的，不建议在开始时使用，以保持配置简单。
- en: '[PRE46]'
  id: totrans-334
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: '**`servicegroup_name`** and **`alias`** have the same meanings as for the host
    group. It should be noted that the syntax is the same as for the **`members`**
    entry. Because a service in Nagios always consists of the combination of host
    and service names, both must always be listed in pairs. The computer comes first,
    and then the service:'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: '**`servicegroup_name`**和**`alias`**与主机组的含义相同。应注意的是，语法与**`members`**条目相同。因为Nagios中的服务始终由主机和服务的组合组成，所以两者必须始终成对列出。首先是计算机，然后是服务：'
- en: '[PRE47]'
  id: totrans-336
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: The **`members`** details can be omitted if the **`servicegroups`** parameter
    is used in the service definition ([2.5 Defining Services to Be Monitored with
    service](../Text/ch02s05.html "2.5 Defining Services to Be Monitored with service")).
    If you want, you can use the two possibilities in combination. As for the host
    groups, hierarchies can be formed from service groups from Nagios 3.0, using the
    parameter **`service-group_members`**.
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在服务定义中使用 **`servicegroups`** 参数，则可以省略 **`members`** 细节（[2.5 使用服务定义要监控的服务](../Text/ch02s05.html
    "2.5 使用服务定义要监控的服务")）。如果您愿意，可以将这两种可能性结合起来使用。至于宿主组，从Nagios 3.0开始，可以使用参数 **`service-group_members`**
    形成服务组层次结构。
- en: '2.7 Defining Addressees for Error Messages: **`contact`**'
  id: totrans-338
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.7 定义错误消息的接收者：**`contact`**
- en: 'A contact is basically a person to whom a message addressed via a contact group
    is sent:'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 联系人基本上是消息通过联系人组发送的接收者：
- en: '[PRE48]'
  id: totrans-340
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'The contact also plays a role during authentication: a user who logs in at
    the Web front end only gets to see the hosts and services for which that user
    is entered as the contact. The user for logging in to the Web interface must therefore
    be identical with the value of **`contact_name`** specified here. The first time
    it is used, the user **`nagios`** is sufficient.'
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 在认证过程中，联系人也扮演着角色：仅在Web前端登录的用户只能看到将联系人输入为该用户的宿主和服务。因此，登录Web界面的用户必须与这里指定的 **`contact_name`**
    值相同。第一次使用时，用户 **`nagios`** 就足够了。
- en: '**`contact_name`**'
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: '**`contact_name`**'
- en: This parameter defines the user name. It must match the corresponding user name
    in the password file **`htpasswd`**.
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数定义用户名。它必须与密码文件 **`htpasswd`** 中的对应用户名匹配。
- en: '**`alias`**'
  id: totrans-344
  prefs: []
  type: TYPE_NORMAL
  zh: '**`alias`**'
- en: This parameter describes the contact briefly. Spaces are allowed here.
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数简要描述联系人。这里允许使用空格。
- en: '**`host_notification_period`**'
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_notification_period`**'
- en: 'This defines the time period during which messages on the reachability of a
    computer can be sent. [12.3 The Message Filter](../Text/ch12s03.html "12.3 The
    Message Filter") (page 267) shows how the time period details can be sensibly
    combined in the different object types. At the beginning, the value **`24×7`**
    (that is: always) is certainly not a bad option.'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 此定义了在哪个时间段内可以发送关于计算机可达性的消息。 [12.3 消息过滤器](../Text/ch12s03.html "12.3 消息过滤器")（第267页）展示了如何在不同对象类型中合理地组合时间段细节。一开始，值
    **`24×7`**（即：总是）当然不是一个坏选项。
- en: '**`service_notification_period`**'
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_notification_period`**'
- en: 'This defines the time period in which Nagios sends notifications to the relevant
    user service. The entry takes effect as a filter: the generated message is simply
    discarded here if it is sent outside the specified time period. If no further
    message follows, the contact remains uninformed. You must therefore think about
    combining individual time periods in various different definitions. Dependencies
    are described extensively in [12.3 The Message Filter](../Text/ch12s03.html "12.3
    The Message Filter").'
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 此定义了Nagios向相关用户服务发送通知的时间段。条目作为过滤器生效：如果消息在指定时间段外发送，则简单地丢弃生成的消息。如果没有后续消息，联系人将保持不知情。因此，您必须考虑在各个不同的定义中组合个别时间段。依赖关系在
    [12.3 消息过滤器](../Text/ch12s03.html "12.3 消息过滤器") 中有详细描述。
- en: '**`host_notification_options`**'
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_notification_options`**'
- en: This defines what types of host messages the user should receive. The same options
    are used here as for the host parameter **`notification_options`** ([2.3 Defining
    the Machines to Be Monitored, with host](../Text/ch02s03.html "2.3 Defining the
    Machines to Be Monitored, with host")).
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 此定义了用户应接收哪些类型的宿主消息。这里使用的选项与宿主参数 **`notification_options`** 相同 ([2.3 定义要监控的机器，使用宿主](../Text/ch02s03.html
    "2.3 定义要监控的机器，使用宿主")).
- en: '**`service_notification_options`**'
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_notification_options`**'
- en: This parameter describes what types of service messages are received by the
    contact. The same five values are involved as for the **`notification_options`**
    parameter for service and host objects.
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数描述了联系人接收哪些类型的服务消息。涉及到的五个值与服务和宿主对象的 **`notification_options`** 参数相同。
- en: '**`service_notification_commands`**'
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_notification_commands`**'
- en: 'This parameter defines which commands (one or more) take charge of notification.
    They must be defined as the **`command`** object type (see [2.9 When Nagios Needs
    to Do Something: The command Object](../Text/ch02s09.html "2.9 When Nagios Needs
    to Do Something: The command Object")); basically any external programs can be
    integrated.'
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数定义了哪些命令（一个或多个）负责通知。它们必须定义为**`command`**对象类型（见[2.9 当Nagios需要做某事时：**`command`**对象](../Text/ch02s09.html
    "2.9 当Nagios需要做某事：**`command`**对象")）；基本上任何外部程序都可以集成。
- en: '**`host_notification_commands`**'
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_notification_commands`**'
- en: Like the **`service_notification_commands`** this parameter specifies which
    commands are to be carried out to send the notification, although here it concerns
    the reachability of computers.
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: 与**`service_notification_commands`**类似，此参数指定了发送通知时要执行哪些命令，尽管这里它关注的是计算机的可达性。
- en: '**`email`**'
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: '**`email`**'
- en: This specifies one or more e-mail addresses (separated by commas) to which a
    message should be sent. The notification command can evaluate this value (one
    example of this is the command **`notify-by-email`**^([[36](#ftn.CHP-2-FN-6)])).
  id: totrans-359
  prefs: []
  type: TYPE_NORMAL
  zh: 这指定了一个或多个应发送消息的电子邮件地址（以逗号分隔）。通知命令可以评估此值（此示例之一是命令**`notify-by-email`**^([[36](#ftn.CHP-2-FN-6)])）。
- en: '**`can_submit_commands`** (Nagios 3.0)'
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: '**`can_submit_commands`**（Nagios 3.0）'
- en: 'This controls whether the contact may execute commands via the Web interface.
    The value **`0`** forbids him from doing this. For Nagios 2.x, in general any
    contact may run commands via the Web interface (see [16.2.3 Interface for external
    commands: cmd.cgi](../Text/ch16s02.html#interface_for_external_commands_colon_c
    "16.2.3 Interface for external commands: cmd.cgi"), page 343). Beginning with
    Nagios 3.0, this parameter now also allows the definition of contacts with read-only
    permission.'
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 这控制了联系人是否可以通过Web界面执行命令。值**`0`**禁止他们这样做。对于Nagios 2.x，通常任何联系人都可以通过Web界面运行命令（见[16.2.3
    外部命令接口：cmd.cgi](../Text/ch16s02.html#interface_for_external_commands_colon_c "16.2.3
    外部命令接口：cmd.cgi")，第343页）。从Nagios 3.0开始，此参数现在还允许定义具有只读权限的联系人。
- en: Further information can be found in the Nagios 3.0 online help at [http://localhost/nagios/docs/objectdefinitions.html#contact](http://localhost/nagios/docs/objectdefinitions.html#contact).
    In Nagios 2.x the file is called **`xodtemplate.html`**. The differences between
    Nagios 2.x and Nagios 3.0 are described in [H.1.4 The contact object](../Text/aph.html#the_contact_object
    "H.1.4 The contact object"), page 681.
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: 更多信息可以在Nagios 3.0在线帮助中找到，网址为[http://localhost/nagios/docs/objectdefinitions.html#contact](http://localhost/nagios/docs/objectdefinitions.html#contact)。在Nagios
    2.x中，该文件称为**`xodtemplate.html`**。Nagios 2.x和Nagios 3.0之间的差异在[H.1.4 联系人对象](../Text/aph.html#the_contact_object
    "H.1.4 联系人对象")中描述，第681页。
- en: '* * *'
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[36](#CHP-2-FN-6)]) see [Table 12-1](../Text/ch12s04.html#macros_used_in_notify-by-email_and_host
    "Table 12-1. Macros used in notify-by-email and host-notify-by-email") in page
    277
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[36](#CHP-2-FN-6)]) 见[表12-1](../Text/ch12s04.html#macros_used_in_notify-by-email_and_host
    "表12-1. 在notify-by-email和host-notify-by-email中使用的宏")第277页
- en: '2.8 The Message Recipient: **`contactgroup`**'
  id: totrans-365
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.8 消息接收者：**`contactgroup**
- en: The **`contactgroup`** serves as the interface between the notification system
    and the individual contacts. Nagios never addresses individual contacts directly
    in various object definitions, but always goes through the contact group.
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: '**`contactgroup`**作为通知系统和单个联系人之间的接口。Nagios在各个对象定义中从不直接针对单个联系人，而是始终通过联系人组进行。'
- en: 'Here Nagios also expects a name (**`contactgroup_name`**) and a comment (**`alias`**),
    which reveals to visitors of the Web site what the purpose of the group is. For
    members (**`members`**) of the group, you can enter an individual contact or a
    comma-separated list of several contacts:'
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，Nagios还期望一个名称（**`contactgroup_name`**）和一个注释（**`alias`**），这向网站访客揭示了该组的目的。对于组的成员（**`members`**），您可以输入单个联系人或多个联系人的逗号分隔列表：
- en: '[PRE49]'
  id: totrans-368
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: The additional parameter **`contactgroup_members`** allows Nagios 3.0 to include
    further contact groups as members. In Nagios 2.x this parameter is not available.
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: 额外的参数**`contactgroup_members`**允许Nagios 3.0将其他联系人组作为成员包含在内。在Nagios 2.x中，此参数不可用。
- en: '2.9 When Nagios Needs to Do Something: The **`command`** Object'
  id: totrans-370
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.9 当Nagios需要做某事时：**`command`**对象
- en: Everything that Nagios does is defined in **`command`** objects. In the example
    file supplied, **`checkcommands.cfg`** defines a broad range of commands which
    only need to be included. To do this, you just copy the file to the subdirectory
    **`mysite`**:^([[37](#ftn.CHP-2-FN-7)])
  id: totrans-371
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 所做的每一件事都是由 **`command`** 对象定义的。在提供的示例文件中，**`checkcommands.cfg`** 定义了一系列需要包含的命令。为此，你只需将文件复制到子目录
    **`mysite`** 即可：^([[37](#ftn.CHP-2-FN-7)])
- en: '[PRE50]'
  id: totrans-372
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'The existing command **`check_ping`** illustrates the definition of this object
    type:'
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: 现有的命令 **`check_ping`** 说明了这种对象类型的定义：
- en: '[PRE51]'
  id: totrans-374
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: '**`check_ping`** is the name by which the command will later be called when
    defining a service. **`commard_line`** describes the command to be executed. Not
    only is the old plugin **`check_ping`** used here, but so is the more efficient
    **`check_icmp`**. The differences between the two are explained in more detail
    in [6.2 Reachability Test with Ping](../Text/ch06s02.html "6.2 Reachability Test
    with Ping") from page 108, but they use the same parameters to a large extent.'
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: '**`check_ping`** 是在定义服务时将使用的命令名称。**`command_line`** 描述了要执行的命令。这里不仅使用了旧的插件 **`check_ping`**，还使用了更高效的
    **`check_icmp`**。这两个之间的区别在[6.2 使用Ping进行可达性测试](../Text/ch06s02.html "6.2 使用Ping进行可达性测试")的第108页有更详细的解释，但它们在很大程度上使用相同的参数。'
- en: 'The identifiers used here, surrounded by dollar signs, are macros. Nagios recognizes
    three different types of macros: **`$USERx$`** macros (**``*`x`*``** may take
    on values between 1 and 32) define the file **`resource.cfg`**. The macro **`$USER1$`**,
    which contains the path to the plugin directory, belongs to this.'
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: 这里使用并由美元符号包围的标识符是宏。Nagios识别三种不同类型的宏：**`$USERx$`** 宏（`*x*` 可以取1到32之间的值）定义文件 **`resource.cfg`**。属于这一类的宏有包含插件目录路径的
    **`$USER1$`**。
- en: The second group of macros are arguments which can be passed on when a command
    is called. These include **`$ARG1$`** and **`$ARG2$`**.
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 第二组宏是在调用命令时可以传递的参数。这些包括 **`$ARG1$`** 和 **`$ARG2$`**。
- en: The third group defined by Nagios includes the macro **`$HOSTADDRESS$`**, which
    references the IP address of the host in the host definition (that is, the parameter
    **`address`**). This type of macro is documented in the online help at [http://localhost/nagios/docs/macros.html](http://localhost/nagios/docs/macros.html).
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios定义的第三组包括宏 **`$HOSTADDRESS$`**，它引用主机定义中的主机IP地址（即参数 **`address`**）。这种类型的宏在在线帮助[http://localhost/nagios/docs/macros.html](http://localhost/nagios/docs/macros.html)中有文档说明。
- en: If you call the service **`linux01`**, **`PING`**, defined in [2.4 Grouping
    Computers Together with hostgroup](../Text/ch02s04.html "2.4 Grouping Computers
    Together with hostgroup"), as a **`check_command`**
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你调用服务 **`linux01`**，在[2.4 使用hostgroup将计算机分组](../Text/ch02s04.html "2.4 使用hostgroup将计算机分组")中定义的
    **`PING`** 作为 **`check_command`**
- en: '[PRE52]'
  id: totrans-380
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: then **`100.0,20%`** will appear in **`$ARG1$`**, and **`500.0,60%`** in **`$ARG2$`**.
    To separate the command and the arguments to be passed on, the exclamation mark
    is used.
  id: totrans-381
  prefs: []
  type: TYPE_NORMAL
  zh: 那么 **`100.0,20%`** 将出现在 **`$ARG1$`** 中，而 **`500.0,60%`** 将出现在 **`$ARG2$`** 中。为了分隔命令和要传递的参数，使用感叹号。
- en: In theory, any programs at all can be started via the **`command_line`**, but
    Nagios expects a certain type of behavior here, particularly where the return
    value is concerned. For this reason, only Nagios plugins should be used (see [Chapter 6](../Text/ch06.html
    "Chapter 6. Plugins for Network Services") to [Chapter 9](../Text/ch09.html "Chapter 9. Executing
    Plugins via SSH")).
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: 理论上，可以通过 **`command_line`** 启动任何程序，但Nagios期望在这里有特定的行为，尤其是关于返回值。因此，应仅使用Nagios插件（参见[第6章](../Text/ch06.html
    "第6章. 网络服务插件")到[第9章](../Text/ch09.html "第9章. 通过SSH执行插件")）。
- en: '* * *'
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[37](#CHP-2-FN-7)]) In Nagios 2.0 the example file lies directly in the directory
    **`/etc/nagios`**.
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[37](#CHP-2-FN-7)]) 在Nagios 2.0中，示例文件位于目录 **`/etc/nagios`** 中。
- en: 2.10 Defining a Time Period with **`timeperiod`**
  id: totrans-385
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.10 使用 **`timeperiod`** 定义时间段
- en: '**`timeperiod`** objects describe time periods in which Nagios generates and/
    or sends notifications. The included example files (Nagios 3.0: **`objects/timeperiods.cfg`**;
    Nagios 2.x: **`localhost.cfg`**) contain a number of definitions that can simply
    be copied to your own **`timeperiods.cfg`** file.'
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: '**`timeperiod`** 对象描述了Nagios生成和/或发送通知的时间段。包含的示例文件（Nagios 3.0: **`objects/timeperiods.cfg`**；Nagios
    2.x: **`localhost.cfg`**) 包含了一些定义，可以直接复制到你的 **`timeperiods.cfg`** 文件中。'
- en: In this, the definition of **`24×7`** is stated as "Sundays to Saturdays, from
    0 to 24 hours in each case:"
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，**`24×7`** 的定义是“每周日到周六，每天从0点到24点：”
- en: '[PRE53]'
  id: totrans-388
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'The times of day on individual weekdays can also be "cobbled together" from
    time periods, separated by a comma:'
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: 单个工作日的时间也可以通过逗号分隔的时间段“拼凑”出来：
- en: '[PRE54]'
  id: totrans-390
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: If a day specification is omitted completely, the defined time period will not
    include this day in its entirety.
  id: totrans-391
  prefs: []
  type: TYPE_NORMAL
  zh: 如果完全省略了日指定，则定义的时间段将不包括该日。
- en: 'Nagios 3.0 allows periods for individual calendar days to be defined:'
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 3.0允许定义个别日历日的时间段：
- en: '[PRE55]'
  id: totrans-393
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'The first line names a fixed calendar day in the ISO format, the second line
    describes every 1st May. The details in the third line refer to the second Monday
    in May, and those of the fourth line, to the third Monday of each month. The details
    can also be combined, in the form **``*`from - to`*``**. A subsequent / acts as
    a separator: the sixth line describes every second day (**`/ 2`**) in the period
    from 24.12\. 2007 to 8.1\. 2008.'
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: 第一行以ISO格式命名固定的日历日，第二行描述每年的5月1日。第三行的细节指的是五月的第二个星期一，第四行的细节指的是每月的第三个星期一。细节也可以组合，形式为**``*`from
    - to`*``**。随后的/作为分隔符：第六行描述从2007年12月24日到2008年1月8日的每第二个工作日（**`/ 2`**）。
- en: '[H.1.5 Time definitions](../Text/aph.html#time_definitions "H.1.5 Time definitions"),
    page 682 is also devoted to the extended format of Nagios 3.0\. The complete documentation
    can be found in the Nagios 3.0 online help at [http://localhost/nagios/docs/objectdefinitions.html#contact](http://localhost/nagios/docs/objectdefinitions.html#contact).
    In Nagios 2.x the corresponding file is called **`xodtemplate.html`**.'
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: '[H.1.5 时间定义](../Text/aph.html#time_definitions "H.1.5 时间定义")，第682页也致力于Nagios
    3.0的扩展格式。完整的文档可以在Nagios 3.0在线帮助中找到，网址为[http://localhost/nagios/docs/objectdefinitions.html#contact](http://localhost/nagios/docs/objectdefinitions.html#contact)。在Nagios
    2.x中，相应的文件称为**`xodtemplate.html`**。'
- en: 2.11 Templates
  id: totrans-396
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.11 模板
- en: 'Nagios categorizes definitions as objects for a very good reason: their features
    can namely be inherited by other objects—a feature that can save a lot of time
    otherwise spent typing. You can define a so-called *template* and pass this on
    to other objects as a basis from which you only need to describe those details
    that are different.'
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios将定义分类为对象，这是有很好的理由的：它们的特性可以被其他对象继承——这是一个可以节省大量打字时间的特性。您可以定义一个所谓的**模板**，并将其传递给其他对象作为基础，您只需要描述那些不同的细节。
- en: 'This is best illustrated by an example (the parameters that are required for
    the use of templates are printed in bold):'
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: 这最好通过一个例子来说明（用于模板使用的必需参数以粗体打印）：
- en: '[PRE56]'
  id: totrans-399
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'With **`name`**, the template is first given a name so that it can be referenced
    later on. The following entry, **`register 0`**, prevents Nagios from trying to
    treat this template as a real host. In the example, the entries for the genuine
    host object are not sufficient; consequently Nagios would break off when reading
    the configuration file, with the error message that parameters are missing that
    are obligatory for such a definition, for example:'
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**`name`**，模板首先被赋予一个名称，以便稍后引用。接下来的条目**`register 0`**阻止Nagios尝试将此模板视为真实的主机。在示例中，真实主机对象的条目不足；因此，当读取配置文件时，Nagios会中断，错误信息指出缺少此类定义所必需的参数，例如：
- en: '[PRE57]'
  id: totrans-401
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: All the other parameters involve settings that are to apply to all definitions
    dependent on **`Generic-Host`**.
  id: totrans-402
  prefs: []
  type: TYPE_NORMAL
  zh: 所有其他参数涉及应用于所有依赖于**`Generic-Host`**的定义的设置。
- en: 'In the actual host definition—in the following example for **`linux03`** and
    **`linux04`**—the parameter **`use`** references the template and thus takes over
    the preset values:'
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: 在实际主机定义中——以下示例为**`linux03`**和**`linux04`**——参数**`use`**引用模板并因此继承预设值：
- en: '[PRE58]'
  id: totrans-404
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: In this way you only need to complete those entries that vary in any way between
    the two hosts.
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
  zh: 这样，您只需要完成那些在两个主机之间有差异的条目。
- en: But parameters may also appear in host definitions that have already been defined
    by the template. In this case the definition at the host has priority it overwrites
    the value from the template.
  id: totrans-406
  prefs: []
  type: TYPE_NORMAL
  zh: 但是，参数也可能出现在已经由模板定义的主机定义中。在这种情况下，主机的定义具有优先权，它覆盖了模板中的值。
- en: Templates created in this way can generally be used for all object types. Further
    information on their use can be found in the Nagios 3.0 online help at [http://localhost/nagios/docs//objectinheritance.html](http://localhost/nagios/docs//objectinheritance.html).^([[38](#ftn.CHP-2-FN-8)])
    In Nagios 2.x the file is called **`templaterecursion.html`**. The extended possibilities
    of Nagios 3.0, which only begin to play a role in more complex setups, are described
    by [H.1.8 Inheritance](../Text/aph.html#inheritance-id1 "H.1.8 Inheritance") from
    page 684.
  id: totrans-407
  prefs: []
  type: TYPE_NORMAL
  zh: 以这种方式创建的模板通常可以用于所有对象类型。有关它们的使用信息，请参阅 Nagios 3.0 在线帮助中的 [http://localhost/nagios/docs//objectinheritance.html](http://localhost/nagios/docs//objectinheritance.html).^([[38](#ftn.CHP-2-FN-8)])
    在 Nagios 2.x 中，该文件被称为 **`templaterecursion.html`**。Nagios 3.0 的扩展功能，这些功能仅在更复杂的设置中开始发挥作用，由
    [H.1.8 继承](../Text/aph.html#inheritance-id1 "H.1.8 继承") 从第 684 页描述。
- en: '* * *'
  id: totrans-408
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[38](#CHP-2-FN-8)]) Locally in **`/usr/local/nagios/share/docs//objectinheritance.html`**.
  id: totrans-409
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[38](#CHP-2-FN-8)]) 本地位于 **`/usr/local/nagios/share/docs//objectinheritance.html`**。
- en: 2.12 Configuration Aids for Those Too Lazy to Type
  id: totrans-410
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.12 为那些懒得输入的人提供的配置辅助
- en: 2.12.1 Defining services for several computers
  id: totrans-411
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2.12.1 为多台计算机定义服务
- en: 'You can simplify things a lot in the service definition by defining a service
    for several hosts, or even host groups, at the same time:'
  id: totrans-412
  prefs: []
  type: TYPE_NORMAL
  zh: 通过同时为多个主机或甚至主机组定义服务，您可以在服务定义中大大简化事情：
- en: '[PRE59]'
  id: totrans-413
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: Specifying several hosts, separated by commas, ensures that Nagios defines multiple
    services in parallel. You can go one step further by specifying the * character
    instead of individual computer aliases. This will assign this service to all hosts.
  id: totrans-414
  prefs: []
  type: TYPE_NORMAL
  zh: 通过逗号分隔的多个主机确保 Nagios 并行定义多个服务。您可以通过指定 * 字符而不是单个计算机别名来更进一步。这将把此服务分配给所有主机。
- en: 'A third possibility is an allocation in parallel via host groups:'
  id: totrans-415
  prefs: []
  type: TYPE_NORMAL
  zh: 第三种可能性是通过主机组并行分配：
- en: '[PRE60]'
  id: totrans-416
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: In this case the parameter **`hostgroup_name`** is used instead of the parameter
    **`host_name`**.
  id: totrans-417
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，使用 **`hostgroup_name`** 参数而不是 **`host_name`** 参数。
- en: 2.12.2 One host group for all computers
  id: totrans-418
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2.12.2 为所有计算机使用一个主机组
- en: 'The quickest way to describe a host group containing all defined computers
    is with the wild card **`*`**:'
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: 使用通配符 **`*`** 描述包含所有定义计算机的主机组是最快的方法：
- en: '[PRE61]'
  id: totrans-420
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 2.12.3 Other configuration aids
  id: totrans-421
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 2.12.3 其他配置辅助工具
- en: In practice, the definition of services covering multiple hosts, described in
    [2.11 Templates](../Text/ch02s11.html "2.11 Templates"), is by far the most important.
    But there are other configuration aids based on the escalation and dependency
    objects, introduced in [Informing different admins at different times](../Text/ch12s03.html#informing_different_admins_at_differen
    "Informing different admins at different times") (see [12.5 Escalation Management](../Text/ch12s05.html
    "12.5 Escalation Management") in page 282 and [12.6 Accounting for Dependencies
    between Hosts and Services](../Text/ch12s06.html "12.6 Accounting for Dependencies
    between Hosts and Services")12.6 in 285). There you can also use **`hostgroup_name`**
    instead of **`host_name`** (a list of host groups) or **`servicegroup_name`**
    instead of **`service_description`**. In addition you may set the value * for
    **`host_name`** and **`service_description`**, which covers all hosts or services.
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，[2.11 模板](../Text/ch02s11.html "2.11 模板") 中描述的覆盖多个主机的服务定义迄今为止是最重要的。但还有其他基于升级和依赖对象的配置辅助工具，这些工具在
    [在不同时间通知不同的管理员](../Text/ch12s03.html#informing_different_admins_at_differen "在不同时间通知不同的管理员")
    (参见第 282 页的 [12.5 升级管理](../Text/ch12s05.html "12.5 升级管理") 和第 285 页的 [12.6 主机和服务的依赖关系会计](../Text/ch12s06.html
    "12.6 主机和服务的依赖关系会计")12.6) 中介绍。在那里，您也可以使用 **`hostgroup_name`** 代替 **`host_name`**
    (主机组列表) 或 **`servicegroup_name`** 代替 **`service_description`**。此外，您还可以为 **`host_name`**
    和 **`service_description`** 设置 * 值，这涵盖了所有主机或服务。
- en: 2.13 CGI Configuration in **`cgi.cfg`**
  id: totrans-423
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.13 在 **`cgi.cfg`** 中的 CGI 配置
- en: 'In order for the Web front end to work correctly, Nagios needs the configuration
    file **`cgi.cfg`**. Nagios'' example file can initially be taken over one-to-one,
    since the paths contained in it were set correctly during installation:'
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使 Web 前端正常工作，Nagios 需要配置文件 **`cgi.cfg`**。Nagios 的示例文件最初可以逐个继承，因为安装期间其中包含的路径已经正确设置：
- en: '[PRE62]'
  id: totrans-425
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'Important: the file **`cgi.cfg`** must be located in the same directory as
    the file **`nagios.cfg`**, because the CGI programs have been compiled in this
    path permanently. If **`cgi.cfg`** is located in a different directory, the Web
    server must also be given an environment variable with the correct path, called
    **`NAGIOS_CGI_CONFIG`**. How this is set in the case of Apache is described in
    the corresponding online documentation.^([[39](#ftn.CHP-2-FN-9)])'
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: 重要：文件 **`cgi.cfg`** 必须位于与文件 **`nagios.cfg`** 相同的目录中，因为CGI程序已经永久编译在此路径。如果 **`cgi.cfg`**
    位于不同的目录，Web服务器也必须提供一个包含正确路径的环境变量，称为 **`NAGIOS_CGI_CONFIG`**。Apache中如何设置，请参阅相应的在线文档.^([[39](#ftn.CHP-2-FN-9)])
- en: 'Out of the box, several parameters are enabled in the CGI configuration file.
    What these are is revealed by the following **`egrep`** command, which excludes
    comments and empty lines:'
  id: totrans-427
  prefs: []
  type: TYPE_NORMAL
  zh: 默认情况下，CGI配置文件中启用了几个参数。这些参数是什么可以通过以下 **`egrep`** 命令揭示，该命令排除了注释和空行：
- en: '[PRE63]'
  id: totrans-428
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: '**`main_config_file`**'
  id: totrans-429
  prefs: []
  type: TYPE_NORMAL
  zh: '**`main_config_file`**'
- en: This parameter specifies the main configuration file.
  id: totrans-430
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数指定主配置文件。
- en: '**`physical_html_path`**'
  id: totrans-431
  prefs: []
  type: TYPE_NORMAL
  zh: '**`physical_html_path`**'
- en: This specifies the absolute path in the file tree to the directory in which
    the HTML documents—including online documentation, images, and CSS stylesheets—are
    located.
  id: totrans-432
  prefs: []
  type: TYPE_NORMAL
  zh: 这指定了文件树中包含HTML文档（包括在线文档、图像和CSS样式表）的目录的绝对路径。
- en: '**`url_html_path`**'
  id: totrans-433
  prefs: []
  type: TYPE_NORMAL
  zh: '**`url_html_path`**'
- en: This also describes the path to the Nagios HTML documents, but from the perspective
    of the Web server, not of the operating system.
  id: totrans-434
  prefs: []
  type: TYPE_NORMAL
  zh: 这也描述了Nagios HTML文档的路径，但是从Web服务器的角度，而不是操作系统的角度。
- en: '**`show_context_help`**'
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
  zh: '**`show_context_help`**'
- en: This option provides—as long as it is switched on (value **`1`**)—a context-dependent
    help if you move the mouse in the Web interface over individual links or buttons.
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: 此选项在开启（值 **`1`**）的情况下提供上下文相关的帮助，如果你在Web界面上将鼠标移至单个链接或按钮上。
- en: '**`use_authentication`**'
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_authentication`**'
- en: This option should always be switched on (value **`1`**). Nagios will then only
    allow access to authenticated users. The authentication itself is configured in
    a **`.htaccess`** file in the CGI directory (see [1.5 Configuration of the Web
    Interface](../Text/ch01s05.html "1.5 Configuration of the Web Interface") in page
    47). If this file is missing, and if **`use_authentication=1`**, then the CGI
    programs will refuse to work.
  id: totrans-438
  prefs: []
  type: TYPE_NORMAL
  zh: 此选项应始终开启（值 **`1`**）。Nagios将只允许认证用户访问。认证本身在CGI目录中的 **`.htaccess`** 文件中配置（请参阅第47页的[1.5
    Web界面的配置](../Text/ch01s05.html "1.5 Web界面的配置")）。如果此文件缺失，并且 **`use_authentication=1`**，则CGI程序将拒绝工作。
- en: '**`default_statusmap_layout`** and **`default_statuswrl_layout`**'
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: '**`default_statusmap_layout`** 和 **`default_statuswrl_layout`**'
- en: These two layout parameters describe forms of representation in the graphical
    illustration of network dependencies. Possible values are described in [A.2 CGI
    Configuration in cgi.cfg](../Text/apas02.html "A.2 CGI Configuration in cgi.cfg")
    in page 608.
  id: totrans-440
  prefs: []
  type: TYPE_NORMAL
  zh: 这两个布局参数描述了网络依赖性图形表示的形式。可能的值在第608页的[A.2 cgi.cfg中的CGI配置](../Text/apas02.html "A.2
    cgi.cfg中的CGI配置")中描述。
- en: '**`refresh_rate`**'
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: '**`refresh_rate`**'
- en: This specifies the timespan in seconds after which the browser is instructed
    to reload data from the Web server. In this way the display in the browser is
    always up-to-date.
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
  zh: 这指定了浏览器被指示从Web服务器重新加载数据的秒数间隔。这样，浏览器中的显示总是最新的。
- en: '**`authorized_for_all_services and authorized_for_all_hosts`**'
  id: totrans-443
  prefs: []
  type: TYPE_NORMAL
  zh: '**`authorized_for_all_services and authorized_for_all_hosts`**'
- en: 'In order for a specific user to be able to see all computers and services in
    the Web interface right from the beginning, without taking account of the allocation
    of hosts and services to the correct contact group, you should also activate the
    following two parameters in the file **`cgi.cfg`**:'
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使特定用户从一开始就能在Web界面上看到所有计算机和服务，而不考虑主机和服务的正确联系人组分配，您还应在文件 **`cgi.cfg`** 中激活以下两个参数：
- en: '[PRE64]'
  id: totrans-445
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: The Web user (and contact) **`nagios`** is now able to see all hosts and all
    services in the Web interface, even if he is not entered as the contact responsible
    for all hosts or services.
  id: totrans-446
  prefs: []
  type: TYPE_NORMAL
  zh: Web用户（和联系人）**`nagios`** 现在能够在Web界面上看到所有主机和所有服务，即使他没有被登记为所有主机或服务的联系人。
- en: A complete list of all parameters can be found in [A.2 CGI Configuration in
    cgi.cfg](../Text/apas02.html "A.2 CGI Configuration in cgi.cfg") in page 606.
  id: totrans-447
  prefs: []
  type: TYPE_NORMAL
  zh: 所有参数的完整列表可以在第606页的[A.2 cgi.cfg中的CGI配置](../Text/apas02.html "A.2 cgi.cfg中的CGI配置")中找到。
- en: '* * *'
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[39](#CHP-2-FN-9)]) [http://httpd.apache.org/docs-2.0/env.html](http://httpd.apache.org/docs-2.0/env.html)
  id: totrans-449
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[39](#CHP-2-FN-9)]) [http://httpd.apache.org/docs-2.0/env.html](http://httpd.apache.org/docs-2.0/env.html)
- en: 2.14 The Resources File **`resource.cfg`**
  id: totrans-450
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 2.14 资源文件 **`resource.cfg`**
- en: 'Nagios expects to find the definition of macros, concerning how they are used
    to create command objects ([2.9 When Nagios Needs to Do Something: The command
    Object](../Text/ch02s09.html "2.9 When Nagios Needs to Do Something: The command
    Object") from page 72), in the resources file **`resource.cfg`**. This can also
    be use as supplied.'
  id: totrans-451
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 期望在资源文件 **`resource.cfg`** 中找到宏的定义，关于它们如何用于创建命令对象（[2.9 当 Nagios 需要执行某些操作时：命令对象](../Text/ch02s09.html
    "2.9 当 Nagios 需要执行某些操作时：命令对象")，第 72 页），这也可以作为默认设置使用。
- en: The location where Nagios should search for this file is defined by the **`resource.cfg`**
    parameter in the main configuration file **`nagios.cfg`**. It makes sense here
    to use the same directory in which **`nagios.cfg`** is also located.
  id: totrans-452
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 应该在主配置文件 **`nagios.cfg`** 中的 **`resource.cfg`** 参数定义的位置搜索此文件。在这里使用与 **`nagios.cfg`**
    相同的目录是有意义的。
- en: 'In its "factory settings", **`resource.cfg`** defines only the **`$USER1$`**
    macro, which contains the path to the plugins:'
  id: totrans-453
  prefs: []
  type: TYPE_NORMAL
  zh: 在其“出厂设置”中，**`resource.cfg`** 仅定义了 **`$USER1$`** 宏，它包含插件的路径：
- en: '[PRE65]'
  id: totrans-454
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: 'In total, Nagios has provisions for 32 freely definable **`$USERx$`** macros,
    where **``*`x`*``** can be from 1 to 32\. These can be very useful in combination
    with passwords, for example: a password is defined via such a macro in the file
    **`resource.cfg`**, which may be read only by the user **`nagios`**. The defined
    macro is used in the actual service definitions, thus hiding the password from
    view of curious onlookers.'
  id: totrans-455
  prefs: []
  type: TYPE_NORMAL
  zh: 总的来说，Nagios 提供了 32 个可自由定义的 **`$USERx$`** 宏，其中 **``*`x`*``** 可以从 1 到 32。这些宏与密码结合使用时非常有用，例如：通过这样的宏在文件
    **`resource.cfg`** 中定义密码，该文件可能只能由用户 **`nagios`** 读取。定义的宏用于实际的服务定义中，从而隐藏密码，不让好奇的旁观者看到。
- en: Chapter 3. Startup
  id: totrans-456
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 3 章 启动
- en: Once Nagios and the plugins are installed, Apache is set up for the Web interface,
    and a minimal configuration is created as previously described, operation of the
    system can get under way. If you have not already done so, it is recommended that
    you first spend a bit of time on the test for the **`check_icmp`** plugin, described
    in [1.4 Installing and Testing Plugins](../Text/ch01s04.html "1.4 Installing and
    Testing Plugins") (page 43), to check the initial configuration.
  id: totrans-457
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦安装了 Nagios 和插件，Apache 已经设置了 Web 界面，并创建了一个最小配置，如之前所述，系统操作就可以开始了。如果你还没有这样做，建议你首先花一些时间测试
    **`check_icmp`** 插件，如 [1.4 安装和测试插件](../Text/ch01s04.html "1.4 安装和测试插件")（第 43 页）中所述，以检查初始配置。
- en: 3.1 Checking the Configuration
  id: totrans-458
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 3.1 检查配置
- en: 'The **`nagios`** program, which normally runs as a daemon and continually collects
    data, can also be used to test the configuration:'
  id: totrans-459
  prefs: []
  type: TYPE_NORMAL
  zh: 通常以守护进程运行并持续收集数据的 **`nagios`** 程序，也可以用来测试配置：
- en: '[PRE66]'
  id: totrans-460
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'Although warnings displayed here can in principle be ignored, this is not always
    what the inventor had in mind: perhaps you made a mistake in the configuration,
    and Nagios is ignoring a specific object, which you would actually like to use.'
  id: totrans-461
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这里显示的警告原则上可以忽略，但这并不总是发明者的初衷：也许你在配置中犯了一个错误，Nagios 正在忽略一个特定的对象，而你实际上想使用它。
- en: If you have not defined any service for a host, for instance, Nagios will issue
    a warning, as in the example above for **`eli-sw01`**. It is therefore recommended
    to define a "PING" service for every host, although this is not absolutely essential.
    Even if the same plugin, **`check_icmp`**, is used here as with the host check,
    this is not the same thing. The host check is satisfied with a single response
    packet—after all, it only wants to find out if the host "is alive". As a service
    check, **`check_icmp`** registers packet run times and loss rates, which can be
    used to draw conclusions, if necessary, concerning existing problems with a network
    card.
  id: totrans-462
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你没有为主机定义任何服务，例如，Nagios 将发出警告，如上面 **`eli-sw01`** 的示例所示。因此，建议为每个主机定义一个“PING”服务，尽管这不是绝对必要的。即使这里使用的插件
    **`check_icmp`** 与主机检查相同，但这并不是一回事。主机检查只需要一个响应数据包——毕竟，它只想知道主机“是否存活”。作为服务检查，**`check_icmp`**
    记录数据包运行时间和丢失率，如果需要，可以用来得出有关网卡现有问题的结论。
- en: 'In contrast to warnings, genuine **`errors`** must be eliminated, because Nagios
    will usually not start if the parser finds an error, as in the following example:'
  id: totrans-463
  prefs: []
  type: TYPE_NORMAL
  zh: 与警告不同，真正的**`错误`**必须消除，因为如果解析器发现错误，Nagios通常不会启动，如下面的例子所示：
- en: '[PRE67]'
  id: totrans-464
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: Here the configuration mistakenly contains a host called **`linux03`**, for
    which there is no definition. If you read through the error message carefully,
    you will quickly realize that the error can be found in the file **`/etc/nagios/mysite/services.cfg`**.
  id: totrans-465
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，配置错误地包含了一个名为**`linux03`**的宿主，对于这个宿主没有定义。如果你仔细阅读错误信息，你会很快意识到错误可以在文件**`/etc/nagios/mysite/services.cfg`**中找到。
- en: In the definition of independencies (*host* and *service dependencies*; see
    [12.6 Accounting for Dependencies between Hosts and Services](../Text/ch12s06.html
    "12.6 Accounting for Dependencies between Hosts and Services"), page 285) there
    is a fundamental risk that circular dependencies could be specified by mistake.
    Because Nagios cannot automatically resolve such dependencies, this is also checked
    before the start, and if necessary, an error is displayed.
  id: totrans-466
  prefs: []
  type: TYPE_NORMAL
  zh: 在独立性的定义中（*宿主*和*服务依赖性*；参见[12.6 宿主和服务之间依赖性的考虑](../Text/ch12s06.html "12.6 宿主和服务之间依赖性的考虑")，第285页）存在一个基本的风险，即可能会错误地指定循环依赖性。因为Nagios无法自动解决这样的依赖性，所以在启动之前也会进行检查，并在必要时显示错误。
- en: When using the **`parents`** parameter, it is also possible that two hosts may
    inadvertently serve mutually as "parents;" Nagios also tests this.
  id: totrans-467
  prefs: []
  type: TYPE_NORMAL
  zh: 当使用**`parents`**参数时，也可能出现两个宿主无意中相互作为“父宿主”的情况；Nagios也会测试这一点。
- en: 3.2 Getting Monitoring Started
  id: totrans-468
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 3.2 开始监控
- en: During the Nagios installation, the command
  id: totrans-469
  prefs: []
  type: TYPE_NORMAL
  zh: 在Nagios安装过程中，命令
- en: '[PRE68]'
  id: totrans-470
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: saves a startup script in the directory containing the boot-up scripts, usually
    **`/etc/init.d`**.
  id: totrans-471
  prefs: []
  type: TYPE_NORMAL
  zh: 在包含启动脚本的目录中保存启动脚本，通常是**`/etc/init.d`**。
- en: 3.2.1 Manual start
  id: totrans-472
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 3.2.1 手动启动
- en: 'If the configuration test ran without error, Nagios on Debian, Ubuntu, and
    OpenSuSE is first started manually with this script:'
  id: totrans-473
  prefs: []
  type: TYPE_NORMAL
  zh: 如果配置测试没有错误运行，Debian、Ubuntu和OpenSuSE上的Nagios首先使用此脚本手动启动：
- en: '[PRE69]'
  id: totrans-474
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: 'Fedora provides its own startup mechanism:'
  id: totrans-475
  prefs: []
  type: TYPE_NORMAL
  zh: Fedora提供自己的启动机制：
- en: '[PRE70]'
  id: totrans-476
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: If everything runs smoothly here (which can be checked by running the Web interface—see
    [3.3 Overview of the Web Interface](../Text/ch03s03.html "3.3 Overview of the
    Web Interface") in page 85), you only need to make sure that the script is executed
    at system start. The required steps, depending on the distribution, are described
    in [1.3 Starting Nagios Automatically](../Text/ch01s03.html "1.3 Starting Nagios
    Automatically") in page 43.
  id: totrans-477
  prefs: []
  type: TYPE_NORMAL
  zh: 如果这里一切顺利（可以通过运行Web界面进行检查——参见[3.3 Web界面概述](../Text/ch03s03.html "3.3 Web界面概述")，第85页），你只需确保脚本在系统启动时执行。根据发行版的不同，所需的步骤在[1.3
    自动启动Nagios](../Text/ch01s03.html "1.3 自动启动Nagios")，第43页中描述。
- en: 3.2.2 Making configuration changes come into effect
  id: totrans-478
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 3.2.2 使配置更改生效
- en: 'If configuration changes are made, it is not required, and not even recommended,
    that you restart Nagios each time. Instead, you just perform a reload:'
  id: totrans-479
  prefs: []
  type: TYPE_NORMAL
  zh: 如果进行配置更改，每次都不需要也不建议重新启动Nagios。相反，你只需执行重新加载：
- en: '[PRE71]'
  id: totrans-480
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: This causes Nagios to reread the configuration, end tests for hosts and services
    that no longer exist, and integrate new computers and services into the test.
    However, with each reload there is a renewed *scheduling* of checks, meaning that
    Nagios plans to carry out all tests afresh.
  id: totrans-481
  prefs: []
  type: TYPE_NORMAL
  zh: 这会导致Nagios重新读取配置，结束不再存在的宿主和服务的测试，并将新的计算机和服务集成到测试中。然而，每次重新加载都会重新安排检查计划，这意味着Nagios计划重新执行所有测试。
- en: 'To prevent all tests from being started simultaneously at bootup, Nagios performs
    a so-called *spreading*. Here the server spreads the start times of the tests
    over a configurable period.^([[40](#ftn.CHP-3-FN-1)]) Therefore, for a large number
    of services, it can take a while before Nagios continues the test for a specific
    service. For this reason you should never run reloads at short intervals: in the
    worst case, Nagios will not manage to perform some checks in the intervening period
    and will perform them only some time after the most recent reload.'
  id: totrans-482
  prefs: []
  type: TYPE_NORMAL
  zh: 为了防止所有测试在启动时同时开始，Nagios执行所谓的*分散*。在这里，服务器将测试的开始时间分散在可配置的期间内.^([[40](#ftn.CHP-3-FN-1)])
    因此，对于大量服务，Nagios在继续特定服务的测试之前可能需要一段时间。因此，你绝对不应该在短时间内运行重新加载：在最坏的情况下，Nagios可能无法在间隔期间执行某些检查，而只能在最近一次重新加载后一段时间内执行。
- en: Before being reloaded, the configuration is tested to eliminate any existing
    errors, as shown in [3.1 Checking the Configuration](../Text/ch03.html#checking_the_configuration
    "3.1 Checking the Configuration").
  id: totrans-483
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-484
  prefs: []
  type: TYPE_NORMAL
- en: ^([[40](#CHP-3-FN-1)]) The relevant configuration parameters are called **`max_host_check_spread`**
    and **`max_service_check_spread`**, see [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg"), page 599.
  id: totrans-485
  prefs: []
  type: TYPE_NORMAL
- en: 3.3 Overview of the Web Interface
  id: totrans-486
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If you call the URL [http://nagios-server/nagios](http://nagios-server/nagios)
    in the browser when the Nagios daemon is running, you will be taken to the welcome
    screen shown in [Figure 3-1](../Text/ch03s03.html#the_start_screen "Figure 3-1. The
    start screen").
  id: totrans-487
  prefs: []
  type: TYPE_NORMAL
- en: '![The start screen](../Images/tagoreillycom20081104nostarchimages223786.png.jpg)'
  id: totrans-488
  prefs: []
  type: TYPE_IMG
- en: Figure 3-1. The start screen
  id: totrans-489
  prefs: []
  type: TYPE_NORMAL
- en: The so-called "tactical overview" (**Tactical Overview**), which can be reached
    via the first **`monitoring`** link in the left menu bar, is shown in [Figure 3-2](../Text/ch03s03.html#quotation_mark_tactical_quotation_mark
    "Figure 3-2. "Tactical" overview of all systems and services to be monitored").
    It summarizes the status of all tested systems.
  id: totrans-490
  prefs: []
  type: TYPE_NORMAL
- en: 'Considerably more interesting in practice, however, is the display of the menu
    item **Service Problems** ([Figure 3-3](../Text/ch03s03.html#nagios_colon_summary_of_all_service
    "Figure 3-3. Nagios: summary of all service problems")). It documents the services
    that are currently causing problems, those that are not in the OK status, in the
    very sense for which Nagios was conceived: to inform the administrator precisely
    of any problems.'
  id: totrans-491
  prefs: []
  type: TYPE_NORMAL
- en: '!["Tactical" overview of all systems and services to be monitored](../Images/tagoreillycom20081104nostarchimages223788.png.jpg)'
  id: totrans-492
  prefs: []
  type: TYPE_IMG
- en: Figure 3-2. "Tactical" overview of all systems and services to be monitored
  id: totrans-493
  prefs: []
  type: TYPE_NORMAL
- en: '![Nagios: summary of all service problems](../Images/tagoreillycom20081104nostarchimages223790.png.jpg)'
  id: totrans-494
  prefs: []
  type: TYPE_IMG
- en: 'Figure 3-3. Nagios: summary of all service problems'
  id: totrans-495
  prefs: []
  type: TYPE_NORMAL
- en: The first column names the host involved. If this has a gray background, Nagios
    can reach the computer in principle. If the host is "down" this can be seen by
    the red background. For services, red stands for CRITICAL and yellow for WARNING.
  id: totrans-496
  prefs: []
  type: TYPE_NORMAL
- en: The second column provides the service name, the third column the status again,
    in plain text. Column four specifies the time of the last check. Column five is
    interesting—it shows how long the current status has been going on.
  id: totrans-497
  prefs: []
  type: TYPE_NORMAL
- en: 'The sixth column with the heading **Attempt** reveals how often Nagios has
    already performed the test (unsuccessfully): **`3/3`** means that the error status
    has been confirmed for the third time in succession, but that the test is only
    performed three times if there is an error (parameter **`max_check_attempts`**,
    see [2.3 Defining the Machines to Be Monitored, with host](../Text/ch02s03.html
    "2.3 Defining the Machines to Be Monitored, with host")).'
  id: totrans-498
  prefs: []
  type: TYPE_NORMAL
- en: 'Finally, the last column passes on the information from the plugin to the administrator,
    to whom it describes the current status in more detail. The above line in [Figure 3-3](../Text/ch03s03.html#nagios_colon_summary_of_all_service
    "Figure 3-3. Nagios: summary of all service problems") warns that only 21 percent
    of disk space is still available on drive D (service **`DISK_D`**) of the Windows
    server ELISAN01.'
  id: totrans-499
  prefs: []
  type: TYPE_NORMAL
  zh: '最后，最后一列将插件信息传递给管理员，管理员会详细描述当前状态。在[图3-3](../Text/ch03s03.html#nagios_colon_summary_of_all_service
    "图3-3. Nagios: 所有服务问题的摘要")中的上述行警告说，Windows服务器ELISAN01的D驱动器（服务**`DISK_D`**)上只剩下21%的磁盘空间。'
- en: '![An overview of all hosts (extract)](../Images/tagoreillycom20081104nostarchimages223792.png.jpg)'
  id: totrans-500
  prefs: []
  type: TYPE_IMG
  zh: '![An overview of all hosts (extract)](../Images/tagoreillycom20081104nostarchimages223792.png.jpg)'
- en: Figure 3-4. An overview of all hosts (extract)
  id: totrans-501
  prefs: []
  type: TYPE_NORMAL
  zh: 图3-4. 所有主机的概述 (摘录)
- en: The **`Host Detail`** ([Figure 3-4](../Text/ch03s03.html#an_overview_of_all_hosts_open_parenthesi
    "Figure 3-4. An overview of all hosts (extract)")) and **`Service Detail`** overviews
    provide an overview of all hosts and services. In practice you will be looking
    more precisely for information, either via a single host or on a host group or
    service group. The name in question is entered in the **Show Host** search field.
    [Figure 3-5](../Text/ch03s03.html#services_to_the_host_elix01_open_parent "Figure 3-5. Services
    to the host elix01 (extract)") shows this using the example of the **`elix01`**
    host.
  id: totrans-502
  prefs: []
  type: TYPE_NORMAL
  zh: '**`Host Detail`** ([图3-4](../Text/ch03s03.html#an_overview_of_all_hosts_open_parenthesi
    "图3-4. 所有主机的概述 (摘录)")) 和 **`Service Detail`** 概述提供了所有主机和服务的概述。在实际操作中，您将更精确地查找信息，无论是通过单个主机还是主机组或服务组。相关名称输入到**显示主机**搜索字段中。[图3-5](../Text/ch03s03.html#services_to_the_host_elix01_open_parent
    "图3-5. 对主机 elix01 的服务 (摘录)") 使用**`elix01`**主机作为示例展示了这一点。'
- en: Alternatively you can search for the names of host and service groups. An interesting
    variation here is to have a *status grid* output shown via the link **Hostgroup
    Grid**, which displays an overview of all hosts and their corresponding services,
    together with the status of these ([Figure 3-6](../Text/ch03s03.html#the_host_group_elilinux_in_the_grid_rep
    "Figure 3-6. The host group eliLINUX in the grid representation")). Through the
    color of the service (green/yellow/red), you can quickly see at a glance whether
    there are problems in the service group or host group that you are viewing.
  id: totrans-503
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，您可以搜索主机和服务组的名称。这里的一个有趣变化是，通过链接**Hostgroup Grid**显示的**状态网格**输出，它显示了所有主机及其对应服务的概述，以及这些服务的状态（[图3-6](../Text/ch03s03.html#the_host_group_elilinux_in_the_grid_rep
    "图3-6. 在网格表示中的主机组 eliLINUX")). 通过服务的颜色（绿色/黄色/红色），您可以一眼看出您正在查看的服务组或主机组中是否存在问题。
- en: '![Services to the host elix01 (extract)](../Images/tagoreillycom20081104nostarchimages223794.png.jpg)'
  id: totrans-504
  prefs: []
  type: TYPE_IMG
  zh: '![Services to the host elix01 (extract)](../Images/tagoreillycom20081104nostarchimages223794.png.jpg)'
- en: Figure 3-5. Services to the host `elix01` (extract)
  id: totrans-505
  prefs: []
  type: TYPE_NORMAL
  zh: 图3-5. 对主机 `elix01` 的服务 (摘录)
- en: '![The host group eliLINUX in the grid representation](../Images/tagoreillycom20081104nostarchimages223796.png.jpg)'
  id: totrans-506
  prefs: []
  type: TYPE_IMG
  zh: '![The host group eliLINUX in the grid representation](../Images/tagoreillycom20081104nostarchimages223796.png.jpg)'
- en: Figure 3-6. The host group `eliLINUX` in the grid representation
  id: totrans-507
  prefs: []
  type: TYPE_NORMAL
  zh: 图3-6. 在网格表示中的主机组 `eliLINUX`
