<html><head></head><body><div class="appendix" title="Appendix&#xA0;A.&#xA0;JAVASCRIPT QUICK START"><div class="titlepage"><div><div><h1 class="title"><a id="javascript_quick_start"/>Appendix A. JAVASCRIPT QUICK START</h1></div></div></div><div class="informalfigure"><div class="mediaobject"><a id="I_mediaobject_d1e14626"/><img src="httpatomoreillycomsourcenostarchimages671943.png.jpg" alt="image with no caption"/></div></div><p>All the mapping APIs covered in this book are based on JavaScript. To use them, you need to program JavaScript from your web page to interact with the maps. However, as you'll see in this appendix, it's a programming language that is easy to learn.<a id="IDX-APP-A-0142" class="indexterm"/><a id="IDX-APP-A-0143" class="indexterm"/><a id="IDX-APP-A-0144" class="indexterm"/></p><p>I'll cover a very basic approach to JavaScript—enough not to be confused by the examples elsewhere in the book. If you're looking to learn the complete ins and outs, pick up <span class="emphasis"><em>The Book of JavaScript</em></span> (thau!, No Starch Press, 2000).</p><div class="sect1" title="Where JavaScript Goes"><div class="titlepage"><div><div><h1 class="title"><a id="where_javascript_goes"/>Where JavaScript Goes</h1></div></div></div><p>JavaScript is added to HTML pages via the <code class="literal">&lt;script&gt;</code> tag. Sometimes code is placed between this tag and its closing tag. Other times, the tag calls to an external file from the attributes. I'll show both versions in this section.</p><p>Technically, you can put your <code class="literal">&lt;script&gt;</code> tag anywhere within an HTML document. For analytics services the bottom of a page may be optimal. JavaScript for widgets may need to be placed at the exact location where you want the widgets to appear. With the JavaScript you write, however, including it in the <code class="literal">&lt;head&gt;</code> of your document whenever possible makes sense from a standards compliance and best practice point of view.<a id="IDX-APP-A-0145" class="indexterm"/><a id="IDX-APP-A-0146" class="indexterm"/><a id="IDX-APP-A-0147" class="indexterm"/><a id="IDX-APP-A-0148" class="indexterm"/><a id="IDX-APP-A-0149" class="indexterm"/></p><p>Here's an example of some very basic JavaScript on an even more basic web page:</p><a id="I_programlisting_d1e14688"/><pre class="programlisting">&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;My Simple JavaScript Example&lt;/title&gt;
  &lt;script type="text/javascript"&gt;
    alert('Testing JavaScript');
  &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;h1&gt;Hello World&lt;/h1&gt;
  &lt;p&gt;Did you see the JavaScript alert?&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</pre><p>JavaScript code goes between the <code class="literal">&lt;script&gt;</code> tags. Here I've used <code class="literal">alert</code>, a JavaScript function that will create a message window in your web browser using the text inside the parentheses. Using an alert is a handy way to show simple examples and to debug, but moving beyond it is best for more complex scripts and for public-facing web pages.</p><div class="tip" title="Tip"><h3 class="title">Tip</h3><p>Want to send a special message to browsers without JavaScript? Include <code class="literal">&lt;noscript&gt;</code> tags and the browser will display any content within.</p></div><p>A <code class="literal">&lt;script&gt;</code> tag can include as many lines of JavaScript as you want, though too much can start to weigh down your HTML file, so most scripts that are more than a few lines are stored in external files. Consider the following, slightly altered example:</p><a id="I_programlisting_d1e14709"/><pre class="programlisting">&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;My External JavaScript Example&lt;/title&gt;
  &lt;script type="text/javascript" src="js/test.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;h1&gt;Hello World&lt;/h1&gt;
  &lt;p&gt;My JavaScript is stored in a file.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</pre><p>Here, I've loaded the JavaScript via the <code class="literal">src</code> attribute of the <code class="literal">&lt;script&gt;</code> tag, which is similar to the way images are referenced in HTML. By convention, the file has a <span class="emphasis"><em>.js</em></span> extension. Also, to keep things organized, most developers keep JavaScript files in a directory off the web root. In this example, I have used a directory named <code class="literal">js</code>.<a id="IDX-APP-A-0150" class="indexterm"/><a id="IDX-APP-A-0151" class="indexterm"/></p><p>The contents of the file are the same as when you include the JavaScript directly on the page. But you do not need the <code class="literal">&lt;script&gt;</code> tags. Continuing the previous example, <span class="emphasis"><em>test.js</em></span> would contain only a single line:</p><a id="I_programlisting_d1e14742"/><pre class="programlisting">alert('Testing JavaScript');</pre><p>Using this method has the distinct advantage that the script file is cached separately by the user's browser. If you use the same script on many pages, as the user navigates around your site, the script will only have been downloaded once.</p><p>As in the first example, this code runs as soon as it is loaded. To run code at different times, you'll need to use functions, described later in this appendix. But first, let's get a feel for other pieces of JavaScript syntax, such as variables, conditionals, and loops.<a id="IDX-APP-A-0152" class="indexterm"/><a id="IDX-APP-A-0153" class="indexterm"/></p></div></div>
<div class="sect1" title="Variables"><div class="titlepage"><div><div><h1 class="title"><a id="variables"/>Variables</h1></div></div></div><p>Variables store values that can be changed or accessed later. You can hold numbers, text, and more inside variables. In this section, I'll show some simple values, as well as more complex structures like arrays and objects.</p><p>First, you need to be able to identify variables. They look like ordinary words. Sometimes variables are more than one word, though they can't include spaces. Often the first time a variable is used it will be set to a value, for example:</p><a id="I_programlisting_d1e14763"/><pre class="programlisting">var age = 21;</pre><p>Here I have created a new variable using JavaScript's <code class="literal">var</code> keyword. This variable is called <code class="literal">age</code>, but you can use just about any name you want, as long as it isn't one of the words reserved by the language. Like most lines of JavaScript code, this one ends with a semicolon.</p><p>The equals sign declares that the variable on the left side will now be set to the value on the right side. In this case, I've used a literal number. You could also use text, another variable, or even a combination of other variables and literal values.</p><p>Here is an example using multiple variables, one dependent on the others:</p><a id="I_programlisting_d1e14777"/><pre class="programlisting">var cost_per_person = 3;
var num_people = 7;
var total_cost = cost_per_person * num_people;</pre><p>The <code class="literal">var</code> keyword should only be used the first time you reference a variable. In fact, you do not even need to use it at all, though if you don't, the variable is then assumed to be <span class="emphasis"><em>global</em></span>. <a class="xref" href="apas05.html#variable_scope" title="Variable Scope">Variable Scope</a> in <a class="xref" href="apas05.html#variable_scope" title="Variable Scope">Variable Scope</a> will explain what this means and why it's a good idea to declare your variables explicitly. You can even do so without creating a value:<a id="IDX-APP-A-0154" class="indexterm"/><a id="IDX-APP-A-0155" class="indexterm"/><a id="IDX-APP-A-0156" class="indexterm"/><a id="IDX-APP-A-0157" class="indexterm"/></p><a id="I_programlisting_d1e14806"/><pre class="programlisting">var tbd;</pre><p>When setting variables that hold text, you need to use quotes on each end of the value, for example:</p><a id="I_programlisting_d1e14811"/><pre class="programlisting">var name = 'Adam';</pre><p>You can use either single (<code class="literal">'</code>) or double (<code class="literal">"</code>) quotes to define your text literals, but you can't mix them. If you want to include the quote within your string, you need to escape it with a backslash.</p><a id="I_programlisting_d1e14821"/><pre class="programlisting">var name = 'Adam\'s apple';</pre><p>Another idiosyncrasy about text variables is covered in the next section.</p><div class="sect2" title="Arithmetic"><div class="titlepage"><div><div><h2 class="title"><a id="arithmetic"/>Arithmetic</h2></div></div></div><p>In the previous section, I showed an example that calculated the <code class="literal">total_cost</code> by multiplying one variable times another, using an asterisk (<code class="literal">*</code>) character.</p><p>The <code class="literal">+</code>, <code class="literal">−</code>, <code class="literal">*</code>, <code class="literal">/</code>, and <code class="literal">=</code> signs are your tools when it comes to changing variable values. We've already seen that <code class="literal">=</code> sets a variable as <span class="emphasis"><em>equal</em></span> to a value. Addition uses the plus sign, <code class="literal">+</code>. Subtraction uses the minus, <code class="literal">-</code>. Multiplication and division are accomplished by the asterisk, <code class="literal">*</code>, and slash, <code class="literal">/</code>, respectively.</p><p>Here's a more complex example:</p><a id="I_programlisting_d1e14874"/><pre class="programlisting">var num = 10 * 2 / 4 + 8; // num is 13</pre><p>The <span class="emphasis"><em>mathematical order of operations</em></span> is followed, which means multiplication and division is performed first and everything is calculated left to right. You can force ordering by enclosing some operations within parentheses:<a id="IDX-APP-A-0158" class="indexterm"/></p><a id="I_programlisting_d1e14884"/><pre class="programlisting">var num = 10 * (2 / 4 + 8); // num is 85</pre><p>To save you some typing, a few shorthand arithmetic conventions are shown in Table A-1. Use these when you need to alter a variable's value by some amount relative to its current value.</p><div class="table"><a id="arithmetic_shorthand"/><p class="title">Table A-1. Arithmetic Shorthand</p><div class="table-contents"><table summary="Arithmetic Shorthand" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Shorthand<a id="IDX-APP-A-0159" class="indexterm"/><a id="IDX-APP-A-0160" class="indexterm"/><a id="IDX-APP-A-0161" class="indexterm"/><a id="IDX-APP-A-0162" class="indexterm"/><a id="IDX-APP-A-0163" class="indexterm"/><a id="IDX-APP-A-0164" class="indexterm"/><a id="IDX-APP-A-0165" class="indexterm"/><a id="IDX-APP-A-0166" class="indexterm"/></p></th><th style="text-align: left" valign="bottom"><p>Long Version</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">num += 3;</code></p></td><td style="text-align: left" valign="top"><p><code class="literal">num = num + 3;</code></p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">num++;</code></p></td><td style="text-align: left" valign="top"><p><code class="literal">num = num + 1;</code></p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">num -= anothernum;</code></p></td><td style="text-align: left" valign="top"><p><code class="literal">num = num − anothernum;</code></p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">num--;</code></p></td><td style="text-align: left" valign="top"><p><code class="literal">num = num − 1;</code></p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">num *= 2;</code></p></td><td style="text-align: left" valign="top"><p><code class="literal">num = num * 2;</code></p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">num /= 4;</code></p></td><td style="text-align: left" valign="top"><p><code class="literal">num = num / 4;</code></p></td></tr></tbody></table></div></div><p>The plus sign, <code class="literal">+</code>, can also be used to <span class="emphasis"><em>concatenate</em></span>—add together—text strings, for example:</p><a id="I_programlisting_d1e14997"/><pre class="programlisting">var her = 'Eve';
var him = 'Adam';
var together = him + ' and ' + her;</pre><p>Three separate strings are all combined here. The first and last are the <code class="literal">him</code> and <code class="literal">her</code> variables. The middle one is a literal string, which begins and ends with a space. If you were to <code class="literal">alert</code> the <code class="literal">together</code> variable, it would read <span class="emphasis"><em>Adam and Eve</em></span>.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>You can also use the <code class="literal">+=</code> shorthand to concatenate strings. For example: <code class="literal">name += ' Smith'</code> will add the string to the end of the text in the <code class="literal">name</code> variable.</p></div></div><div class="sect2" title="Arrays"><div class="titlepage"><div><div><h2 class="title"><a id="arrays"/>Arrays</h2></div></div></div><p>So far I've covered two types of variables—numbers and text. Here I'll introduce a special kind of variable that holds multiple values. Or, put another way, it can contain an <span class="emphasis"><em>array</em></span> of values.</p><p>The values can be numbers, text, or a combination. You can also include other arrays or even objects (covered in the next section) within an array. Here is an example of an array declaration:</p><a id="I_programlisting_d1e15039"/><pre class="programlisting">var herbs = ['Parsley', 'Sage', 'Rosemary', 'Thyme'];</pre><p>The values are separated by commas. The list is surrounded by square brackets, <code class="literal">[</code> and <code class="literal">]</code>. The same brackets are used to access the individual values according to where they appear in the list. For example, to pull <code class="literal">Rosemary</code> from the <code class="literal">herbs</code> variable, you use the following:</p><a id="I_programlisting_d1e15055"/><pre class="programlisting">herbs[2]</pre><p>In JavaScript, as in most programming languages, array indexes begin at zero. Therefore, even though <code class="literal">Rosemary</code> is the third item in the list, you access it with number <code class="literal">2</code>.<a id="IDX-APP-A-0167" class="indexterm"/><a id="IDX-APP-A-0168" class="indexterm"/><a id="IDX-APP-A-0169" class="indexterm"/><a id="IDX-APP-A-0170" class="indexterm"/><a id="IDX-APP-A-0171" class="indexterm"/><a id="IDX-APP-A-0172" class="indexterm"/></p><p>To determine how many items are in a list, you use the <code class="literal">length</code> attribute:</p><a id="I_programlisting_d1e15092"/><pre class="programlisting">herbs.length</pre><p>In <a class="xref" href="apas04.html" title="Loops">Loops</a> in <a class="xref" href="apas04.html" title="Loops">Loops</a>, I'll show how to access each item in the array.</p></div><div class="sect2" title="Objects"><div class="titlepage"><div><div><h2 class="title"><a id="objects"/>Objects</h2></div></div></div><p>Like arrays, objects hold multiple values. The difference is that you can express more structured data than a simple list. To do this, objects contain key and value pairs. Keys are word-like labels, but values can be numbers, text, arrays, or other objects.<a id="IDX-APP-A-0173" class="indexterm"/></p><p>Here's a simple example representing a car:</p><a id="I_programlisting_d1e15112"/><pre class="programlisting">var car = {
  make: 'Ford', model: 'Mustang', year: 1965, color: 'red'
}</pre><p>To access the values within the object, you use dot notation:</p><a id="I_programlisting_d1e15116"/><pre class="programlisting">car.model</pre><p>Now that you have seen the different ways of expressing data in JavaScript, let's do something with it.</p></div></div>
<div class="sect1" title="Conditionals"><div class="titlepage"><div><div><h1 class="title"><a id="conditionals"/>Conditionals</h1></div></div></div><p>Conditionals help you compare variables to other values (including other variables). This comparison happens in a <span class="emphasis"><em>conditional statement</em></span>. Using conditionals is the basis of much programming, because they contain the logic that helps a computer "make decisions."<a id="IDX-APP-A-0174" class="indexterm"/></p><p>The most common conditional is an <code class="literal">if</code> statement. You use it to provide code that is only used in a situation where the condition is true, for example:</p><a id="I_programlisting_d1e15138"/><pre class="programlisting">if (num == 5) {
  // code to run if true
}</pre><p>The code inside the <code class="literal">{</code> and <code class="literal">}</code> braces will only run if the <code class="literal">num</code> variable is exactly <code class="literal">5</code>. The <code class="literal">==</code> operator is used to provide the <span class="emphasis"><em>equals</em></span> comparison—in contrast to the single equals, which is used to <span class="emphasis"><em>assign</em></span> a value.</p><p>You can use other comparison operators, as shown in Table A-2, for cases where you don't want the values to be exactly equal.</p><div class="table"><a id="conditional_operators"/><p class="title">Table A-2. Conditional Operators</p><div class="table-contents"><table summary="Conditional Operators" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Operator<a id="IDX-APP-A-0175" class="indexterm"/></p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">==</code></p></td><td style="text-align: left" valign="top"><p>Equal</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">!=</code></p></td><td style="text-align: left" valign="top"><p>Not equal</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">&gt;</code></p></td><td style="text-align: left" valign="top"><p>Greater than</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">&lt;</code></p></td><td style="text-align: left" valign="top"><p>Less than</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">&gt;=</code></p></td><td style="text-align: left" valign="top"><p>Greater than or equal</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">&lt;=</code></p></td><td style="text-align: left" valign="top"><p>Less than or equal</p></td></tr></tbody></table></div></div><p>If you want to do something else if the condition is false, you can include an <code class="literal">else</code> statement immediately after an <code class="literal">if</code>:</p><a id="I_programlisting_d1e15240"/><pre class="programlisting">if (num &gt; 0) {
  // code to run if true
}
else {
  // code to run if condition is false
}</pre><p>The code within the <code class="literal">{</code> and <code class="literal">}</code> after the <code class="literal">else</code> statement only runs if the condition in the <code class="literal">if</code> statement is not true. In this example, the <code class="literal">else</code> code runs when <code class="literal">num</code> is zero or less. The <code class="literal">if</code> code runs in the other case (where <code class="literal">num</code> is greater than zero). You won't encounter an occasion where both <code class="literal">if</code> and <code class="literal">else</code> code runs.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>An <code class="literal">else</code> statement cannot exist without an accompanying <code class="literal">if</code> statement. You can, however, have <code class="literal">if</code> statements without <code class="literal">else</code> statements.</p></div><p>You can also have an <code class="literal">if</code> statement without any operator. In those cases, the variable within the statement is called a <span class="emphasis"><em>boolean</em></span>, which is either <code class="literal">true</code> or <code class="literal">false</code>. Here's an example:</p><a id="I_programlisting_d1e15305"/><pre class="programlisting">var is_cool = true;
if (is_cool) {
  // code to run if true
}</pre><p>The <code class="literal">if (is_cool)</code> code is shorthand for the much longer <code class="literal">if (is_cool == true)</code>. You can also compare a variable to false in shorthand, using an exclamation point to mean "not," as in this example:</p><a id="I_programlisting_d1e15315"/><pre class="programlisting">if (!is_cool) {
  // code to run if <code class="literal">is_cool</code> is false
}</pre><p>Sometimes a non-boolean variable can be a conditional, too. In that case, <span class="emphasis"><em>empty</em></span> values are considered false. Empty values are <code class="literal">0</code> for numbers, <code class="literal">""</code> (empty string) for text, and <code class="literal">null</code> for objects. Also, any undefined variable is false.<a id="IDX-APP-A-0176" class="indexterm"/><a id="IDX-APP-A-0177" class="indexterm"/><a id="IDX-APP-A-0178" class="indexterm"/><a id="IDX-APP-A-0179" class="indexterm"/><a id="IDX-APP-A-0180" class="indexterm"/><a id="IDX-APP-A-0181" class="indexterm"/></p></div>
<div class="sect1" title="Loops"><div class="titlepage"><div><div><h1 class="title"><a id="loops"/>Loops</h1></div></div></div><p>Loops are like special conditionals that run the code over and over until the condition is no longer true. I will cover two types of loops in this section: <code class="literal">for</code> loops and <code class="literal">while</code> loops.<a id="IDX-APP-A-0182" class="indexterm"/></p><p>In most cases, a loop has a number to count how many times you have used the loop. Here's an example that runs 10 times:</p><a id="I_programlisting_d1e15375"/><pre class="programlisting">for (❶var i=0; ❷i &lt; 10; ❸i++) {
  // Code to run each time
}</pre><p>Three pieces are included inside the parentheses of the <code class="literal">for</code> statement. The initial value ❶, the condition under which the loop continues ❷, and the increment portion ❸. The first time through the loop, <code class="literal">i</code> is 0. Then 1 and so on, as long as <code class="literal">i</code> is <span class="emphasis"><em>less than</em></span> 10. When <code class="literal">i</code> equals 10, the loop stops. But since we started at 0, the loop will have run 10 times.</p><p>The same can be achieved with a <code class="literal">while</code> loop using the following code:</p><a id="I_programlisting_d1e15399"/><pre class="programlisting"><strong class="userinput"><code>var i=0</code></strong>;
while (<strong class="userinput"><code>i &lt; 10</code></strong>) {
  // Code to run each time
  <strong class="userinput"><code>i++</code></strong>;
}</pre><p>In fact, if you look at the segments of the code in bold, you'll notice they match with the three pieces of a <code class="literal">for</code> statement. This <code class="literal">while</code> loop is logically equivalent.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>When you know how many times a loop will run, using <code class="literal">for</code> is probably easiest. When you don't know in advance the number of iterations needed (such as when you're searching for a value), use <code class="literal">while</code>.</p></div><p>Remember the <code class="literal">herbs</code> variable from the array section? To refresh your memory, we declared it like so:</p><a id="I_programlisting_d1e15431"/><pre class="programlisting">var herbs = ['Parsley', 'Sage', 'Rosemary', 'Thyme'];</pre><p>Now let's use a loop to do something with each value in the array. Because we know the total number of <span class="emphasis"><em>iterations</em></span> (the length of the array), we'll use a <code class="literal">for</code> loop. Here's the code:<a id="IDX-APP-A-0183" class="indexterm"/><a id="IDX-APP-A-0184" class="indexterm"/><a id="IDX-APP-A-0185" class="indexterm"/></p><a id="I_programlisting_d1e15455"/><pre class="programlisting">var allherbs = '';
for (var i=0; i &lt; herbs.length; i++) {
  allherbs += herbs[i] + ' ';
}</pre><p>Each time through the loop, we tack the current herb (the one in the index determined by the number <code class="literal">i</code>) to the end of the <code class="literal">allherbs</code> string. At the end of the loop, this is what is stored in that variable:</p><a id="I_programlisting_d1e15465"/><pre class="programlisting">Parsley Sage Rosemary Thyme</pre><p>We've used a loop to concatenate the four values held in our array. This concept is used throughout the book, only not usually for adding strings together; instead, we use it to create hundreds of map markers in just a few lines or output all the results of a search.</p><p>Loops are an important tool in limiting the code you need to write. But functions are perhaps the best tool to achieve simple, reusable code. Read on to see what I mean.<a id="IDX-APP-A-0186" class="indexterm"/></p></div>
<div class="sect1" title="Functions"><div class="titlepage"><div><div><h1 class="title"><a id="functions"/>Functions</h1></div></div></div><p>If you're ready to upgrade your JavaScript programming abilities, writing functions is a good place to start. A function is a packaged-up piece of code for performing a particular operation. They can accept one or more variables and return a value if necessary. With functions, you can make your code more reusable and break your application into smaller pieces.</p><p>For a basic example, we'll create a function that outputs the greater of two numbers. This function already exists as <code class="literal">Math.max</code> (which can accept many values to compare), but it's still a good example. Here's the entire code for the function:</p><a id="I_programlisting_d1e15484"/><pre class="programlisting">function biggest(num, another) {
  if (num &gt; another) {
    return num;
  }
  else {
    return another;
  }
}</pre><p>Every function begins with the <code class="literal">function</code> declaration, followed by the name of the function. Then, within parentheses, you declare the parameters—variables—that your function will accept. In this case, we have two that I've named <code class="literal">num</code> and <code class="literal">another</code>.</p><p>The rest of the function, which resides inside <code class="literal">{</code> and <code class="literal">}</code> braces, should look familiar; it's just ordinary JavaScript code. When the function is called, you pass two variables, and the code runs based on that input. When you're ready to send a value back, you use the <code class="literal">return</code> statement to immediately exit the function and make its output equal to the variable (or literal value) you put after <code class="literal">return</code>.<a id="IDX-APP-A-0187" class="indexterm"/><a id="IDX-APP-A-0188" class="indexterm"/><a id="IDX-APP-A-0189" class="indexterm"/><a id="IDX-APP-A-0190" class="indexterm"/></p><p>I can probably explain it best with an example. Here's how you might call the new <code class="literal">biggest</code> function:</p><a id="I_programlisting_d1e15533"/><pre class="programlisting">var somenum = 7;
var bigone = biggest(somenum, 11); // After the biggest function, bigone is 11</pre><p>I've passed a variable (<code class="literal">somenum</code>) and a literal number to the function. I can use any combination of literal or variable values. And the names of my variables don't need to match those used within the function. They have different <span class="emphasis"><em>scope</em></span>, as I'll explain in the next section.</p><p>For normal boolean, number, and text variables, JavaScript makes a copy of the value and sends it to the function. That means if you make any changes to the values within the function, the original variables outside are unaffected. The same is not true of objects and arrays; in these cases you will be modifying the value of the original variable—even if the variable is not in the return.</p><p>At the very beginning of this section, I mentioned that a function does not need to take parameters. In these instances, the function needs empty parentheses. Here's a mapping-related example:</p><a id="I_programlisting_d1e15548"/><pre class="programlisting">function recenter_map() {
  mapstraction.setCenter(stored_center);
}</pre><p>This function would be used to set the map to a stored center point, as long as you have the variable in memory. I used a similar approach in <a class="xref" href="ch05s09.html" title="#34: Return to the Center When the Message Box Is Closed">#34: Return to the Center When the Message Box Is Closed</a> in <a class="xref" href="ch05s09.html" title="#34: Return to the Center When the Message Box Is Closed">#34: Return to the Center When the Message Box Is Closed</a>. The only way for it to work as shown is if <code class="literal">stored_center</code> is a global variable, visible from any JavaScript on the page.<a id="IDX-APP-A-0191" class="indexterm"/></p><div class="sect2" title="Variable Scope"><div class="titlepage"><div><div><h2 class="title"><a id="variable_scope"/>Variable Scope</h2></div></div></div><p>In the previous sections, I demonstrated how to create variables. I also explained that the <code class="literal">var</code> keyword, although optional, is recommended. The reason behind this advice has to do with a variable's visibility—or its scope.</p><p>If you use a variable without including the <code class="literal">var</code> statement, the variable will automatically be considered <span class="emphasis"><em>global</em></span>, as opposed to <span class="emphasis"><em>local</em></span>. Global variables can be seen from any JavaScript on the page, including other functions. You can also explicitly make a variable global by declaring it outside a function, usually at the beginning of your JavaScript section.</p><p>Consider this example:<a id="IDX-APP-A-0192" class="indexterm"/></p><a id="I_programlisting_d1e15586"/><pre class="programlisting">&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;JavaScript Variable Scope Example&lt;/title&gt;
    &lt;script type="text/javascript"&gt;
❶     var firstvar = 1; // explicit global variable
      function call_first() {
❷       secondvar = 2; // implicit global variable
❸       var thirdvar = 3; // local variable
        then_me();
        alert('First: ' + firstvar + '\nSecond: ' + secondvar
             + '\nThird: ' + thirdvar);
      }
      function then_me() {
❹       firstvar = 10;
❺       var secondvar = 20;
❻       thirdvar = 30; // implicit global variable
      }
    &lt;/script&gt;
  &lt;/head&gt;
  &lt;body onLoad="call_first()"&gt;
    ...
  &lt;/body&gt;
  &lt;/html&gt;</pre><p>What will the values of the three variables be when the JavaScript <code class="literal">alert</code> shows them? Let's walk through the code. When the page loads, we create a global variable ❶ and then we call the <code class="literal">call_first</code> function.</p><p>Within the first function, we set a variable's value without using the <code class="literal">var</code> keyword ❷, making the variable, implicitly, a global variable. The third variable ❸ we create is a local variable because the <code class="literal">var</code> keyword is used within a function.</p><p>With these three variables created in different ways, we then call our second function from within the first function. In this new function, we reset a global variable ❹, create a new local variable ❺, and create a new global variable ❻.</p><p>When we return to our spot in the first function, the only variable that has changed for this scope is <code class="literal">firstvar</code>. The <code class="literal">secondvar</code> variable within the <code class="literal">then_me</code> function is local, so it does not alter the global <code class="literal">secondvar</code>. And even though <code class="literal">then_me</code>'s <code class="literal">thirdvar</code> is global, that does not alter a local variable with the same name inside the <code class="literal">call_first</code> function.</p><div class="tip" title="Tip"><h3 class="title">Tip</h3><p>To make things easier on yourself, be clear and always use the <code class="literal">var</code> keyword to declare variables explicitly.</p><p>It's okay if it seems confusing. The good news is the process is logical, if you can follow it.</p></div></div><div class="sect2" title="Anonymous Functions"><div class="titlepage"><div><div><h2 class="title"><a id="anonymous_functions"/>Anonymous Functions</h2></div></div></div><p>A special kind of function gets used often in modern JavaScript, especially when reading in data (as you often do with maps). This function is called an anonymous function because it has no name. These functions are often passed as parameters to other functions.<a id="IDX-APP-A-0193" class="indexterm"/></p><p>Here's a very basic example:</p><a id="I_programlisting_d1e15648"/><pre class="programlisting">function start_here() {
    call_another(<strong class="userinput"><code>function() {</code></strong>
      <strong class="userinput"><code>alert('Anonymous function message!');</code></strong>
    <strong class="userinput"><code>}</code></strong>);
  }
  function call_another(❶fn) {
❷   fn();
  }</pre><p>The portion in bold is the anonymous function. It looks exactly like any other function, except a name is missing. Another strange thing is that here the function is slapped inside the parentheses of a call to another function, <code class="literal">call_another</code>. In that second function, we have one variable ❶, which holds the <span class="emphasis"><em>reference</em></span> to our anonymous function. Then we can call it with the name of the reference variable ❷.</p><p>Sure enough, if you load that up and call the <code class="literal">start_here</code> function, you'll see an alert message from your anonymous function—via the second function.</p><p>Here's an example of a more common use for an anonymous function, reading JSON in from a web service using jQuery:</p><a id="I_programlisting_d1e15674"/><pre class="programlisting">jQuery.getJSON(url, function(obj) {
  // Code to access the obj variable
});</pre><p>We're passing two values to jQuery's <code class="literal">getJSON</code> function. The first is the URL of the JSON we want to retrieve. The second is our anonymous function—this time with a variable being passed to it. When evaluating the JSON data (see <a class="xref" href="ch08s02.html" title="#53: Use JSON">#53: Use JSON</a> in <a class="xref" href="ch08s02.html" title="#53: Use JSON">#53: Use JSON</a>), jQuery puts it into a JavaScript object, which is then passed to our anonymous function.</p><p>Using anonymous functions is, in a way, shorthand. Here's a longer version of this jQuery example:<a id="IDX-APP-A-0194" class="indexterm"/><a id="IDX-APP-A-0195" class="indexterm"/></p><a id="I_programlisting_d1e15695"/><pre class="programlisting">jQuery.getJSON(url, get_results);
function get_results(obj) {
  // Code to access the obj variables
}</pre><p>Sure, you don't save <span class="emphasis"><em>that much</em></span> time typing, but your code is often more readable. Littering your JavaScript with single-purpose functions isn't very clean. But perhaps the best reason to understand anonymous functions is that you'll probably see many of them in other people's code—including in this book.<a id="IDX-APP-A-0196" class="indexterm"/><a id="IDX-APP-A-0197" class="indexterm"/><a id="IDX-APP-A-0198" class="indexterm"/><a id="IDX-APP-A-0199" class="indexterm"/></p><p>Anonymous functions should only be used in the situations where they're most useful, however. If you find yourself writing a lot of code in an anonymous function, you might make it a named function. Also, watch out for creating anonymous functions inside a long loop. You're essentially creating new functions every time through the loop, which is inefficient. And doing this is also counter to the purpose of functions: to write code once and run it many times.</p></div></div>
<div class="sect1" title="Using jQuery"><div class="titlepage"><div><div><h1 class="title"><a id="using_jquery"/>Using jQuery</h1></div></div></div><p>In several places in this book, I make use of the JavaScript framework, jQuery. jQuery simplifies common tasks and provides a single interface to actions that are implemented inconsistently in different browsers. Perhaps the most common use of jQuery, especially in this book, is reading in files or other data from web services. This section is meant to give a quick introduction to using jQuery.</p><p>Before you can use jQuery, you need to include it in your web page. You can do so by downloading the latest version at <a class="ulink" href="http://jquery.com/">http://jquery.com/</a> or by grabbing a Google-hosted version by adding the following to the <code class="literal">&lt;head&gt;</code> section of your HTML file:</p><a id="I_programlisting_d1e15733"/><pre class="programlisting">&lt;script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"&gt;&lt;/script&gt;</pre><p>One advantage to using the Google-hosted version is that many other sites do as well. That means when people come to your site, they may already have jQuery stored in their browser's cache. Even if they don't, they can download it quickly—currently the file is under 20KB.</p><p>Once you have included jQuery in your document, you can use its functions via two global variables: <code class="literal">jQuery</code> and its shorthand, <code class="literal">$</code>.</p><div class="sect2" title="Query Document Objects"><div class="titlepage"><div><div><h2 class="title"><a id="query_document_objects"/>Query Document Objects</h2></div></div></div><p>Among its many uses, jQuery is very good at quickly and easily extracting elements from your HTML page into JavaScript code. You can query by <code class="literal">id</code>, tag name, CSS class, or combinations of these factors. jQuery makes this task easier, so you can focus on what you want to do with those elements.</p><p>To grab a single piece of the page, such as the map <code class="literal">&lt;div&gt;</code>, you call it by its <code class="literal">id</code>. Much of jQuery's syntax is borrowed from CSS, which may look familiar. Here is how you would call an object with an <code class="literal">id</code> of <code class="literal">mymap</code>:</p><a id="I_programlisting_d1e15767"/><pre class="programlisting">var mapdiv = $('#mymap');</pre><p>Notice I'm using the dollar-sign shorthand. Then I add parentheses because <code class="literal">$</code> is a variable and a function (jQuery stretches the bounds of JavaScript in ways that you and I probably won't). Inside the function, we pass a string with the CSS we'd use to style the map div, <code class="literal">#mymap</code>.<a id="IDX-APP-A-0200" class="indexterm"/><a id="IDX-APP-A-0201" class="indexterm"/><a id="IDX-APP-A-0202" class="indexterm"/><a id="IDX-APP-A-0203" class="indexterm"/></p><p>You've now used your first jQuery function to query for a specific element. You can achieve the same result with JavaScript's standard <code class="literal">document.getElementById</code> function, but jQuery's method is faster to type. Plus, the result using <code class="literal">$</code> allows you to chain other jQuery functions, such as visual effects.</p><p>jQuery can also do more than just query individual elements; it can gather multiple elements in a single call. Here are a few examples:</p><a id="I_programlisting_d1e15805"/><pre class="programlisting">var imgs = $('img'); // all the images on a page
var allmaps = $('.map'); // every element with class="map"
var mapimgs = $('#mymap img'); // all images that are within #mymap element
var firstp = $('p:first'); // first paragraph on a page</pre><p>Each of these examples shows a different type of querying—and many more are possible. You can learn about what jQuery calls <span class="emphasis"><em>selectors</em></span> at <a class="ulink" href="http://api.jquery.com/category/selectors/">http://api.jquery.com/category/selectors/</a>.</p></div><div class="sect2" title="Insert and Hide Content"><div class="titlepage"><div><div><h2 class="title"><a id="insert_and_hide_content"/>Insert and Hide Content</h2></div></div></div><p>Once you have one or more elements from the page using jQuery, you'll want to do something to them. In this section, I'll show you a way to add or replace the content inside a page element. And I'll also demonstrate an effect that will hide the content, so later, you can make it reappear.</p><p>Let's say you want an element on your page where you can show the results of some calculation. You can add the element with HTML using something like this:</p><a id="I_programlisting_d1e15821"/><pre class="programlisting">&lt;div id="results"&gt;Results:&lt;/div&gt;</pre><p>When you're ready to add the results, you can use jQuery to find the element and then display the results. If you want to display the content of a variable called <code class="literal">total</code>, you could use this single line of jQuery:</p><a id="I_programlisting_d1e15828"/><pre class="programlisting">$('#results').html(total);</pre><p>This line will find the element on the page with the <code class="literal">id</code> of <code class="literal">results</code> and then replace its inner HTML with the value in the <code class="literal">total</code> variable. If you just want to add additional content to the element, use this line instead:</p><a id="I_programlisting_d1e15841"/><pre class="programlisting">$('#results').append(total);</pre><p>Now the results section will look something like this (if the <code class="literal">total</code> variable is <code class="literal">42</code>):<a id="IDX-APP-A-0204" class="indexterm"/><a id="IDX-APP-A-0205" class="indexterm"/><a id="IDX-APP-A-0206" class="indexterm"/><a id="IDX-APP-A-0207" class="indexterm"/></p><a id="I_programlisting_d1e15867"/><pre class="programlisting">Results: 42</pre><p>You've seen how to insert content, but what about making that same content disappear? For example, before adding the results, a page with just <code class="literal">Results:</code> without anything after it looks a bit funny. So when the page loads (you'll learn how in the next section), run the following code to hide the results element:</p><a id="I_programlisting_d1e15875"/><pre class="programlisting">$('#results').hide();</pre><p>And when you're ready to display the results to the user, include this code:</p><a id="I_programlisting_d1e15879"/><pre class="programlisting">$('#results').show();</pre><p>These two functions are simple (and very useful) examples of jQuery effects. Many more effects are listed on the jQuery website at <a class="ulink" href="http://api.jquery.com/category/effects/">http://api.jquery.com/category/effects/</a>.</p></div><div class="sect2" title="Use Browser Events"><div class="titlepage"><div><div><h2 class="title"><a id="use_browser_events"/>Use Browser Events</h2></div></div></div><p>Earlier in this book, I spent an entire chapter on events that happen on maps, such as clicking or dragging. You can also react to events anywhere in the browser, and jQuery makes reacting a simple process.</p><p>To respond to an event, you first need to be listening for it. When your page first loads, you register your intention to react to an event. You can do this by adding a JavaScript function to the <code class="literal">onload</code> attribute of your <code class="literal">&lt;body&gt;</code> tag. Or you can do this with a special jQuery event.</p><p>Although creating an event to register other events may seem counterintuitive, it works. Here's an example that waits until the page is ready:</p><a id="I_programlisting_d1e15900"/><pre class="programlisting">$(document).ready(register_events);</pre><p>Notice that the element we're querying for is a little different than in the past. Instead of a string inside the parentheses, we've inserted a standard JavaScript object, <code class="literal">document</code>. When enough of the page has loaded that the browser knows all the objects it contains, we call the <code class="literal">register_events</code> function. That function doesn't exist, however, so we need to write it. Or, instead, we could react to the same event with an anonymous function:</p><a id="I_programlisting_d1e15910"/><pre class="programlisting">$(document).ready(function() {
  // Code to register events
});</pre><p>As with most anonymous functions, you usually want to keep it to just a few lines. If you have many events to register, you are probably best served with a named function.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>A big difference exists between using your browser's <code class="literal">onload</code> attribute and jQuery's <code class="literal">ready</code> event. With <code class="literal">onload</code>, you wait until the entire page is loaded, including images and other external files. With <code class="literal">$(document).ready</code>, you can run code, such as registering events and hiding objects, the moment the browser is ready. Using jQuery here often translates to a better user experience.</p></div><p>Now that you've waited for the browser to be ready to register other events, let's register them. Here's the basic pattern for jQuery events:</p><a id="I_programlisting_d1e15931"/><pre class="programlisting">$(<em class="replaceable"><code>element</code></em>).<em class="replaceable"><code>event</code></em>(<em class="replaceable"><code>function</code></em>);</pre><p>The <em class="replaceable"><code>element</code></em> portion is usually a selector, such as an element's <code class="literal">id</code> (though it can also be any browser object, as shown in the <code class="literal">ready</code> example). The <em class="replaceable"><code>event</code></em> piece is the name of the function, as declared by jQuery. Finally, <em class="replaceable"><code>function</code></em> is the function reference, either an anonymous function or the name of the function to call.</p><p>Here's how you'd listen for a particular element to be clicked:</p><a id="I_programlisting_d1e15962"/><pre class="programlisting">$('#myid').click(function() {
  alert('Clicked on myid');
});</pre><p>If you're familiar with JavaScript events included in HTML, you might be wondering where the <code class="literal">on</code>, as in <code class="literal">onClick</code>, went. In jQuery, events are referenced with only the action.</p><p>You can also get additional information about the event. The information available may be a little different depending on the event. Here's how you find out where the user has double-clicked on a page:</p><a id="I_programlisting_d1e15974"/><pre class="programlisting">$(document).dblclick(function(❶e) {
  alert('Double-clicked at ' + ❷e.pageX + ', ' + ❸e.pageY);
});</pre><p>Instead of a <code class="literal">click</code> event, I used a <code class="literal">dblclick</code> event. Because we want more information about the event, I included an optional parameter ❶ to the anonymous function. Within the function, I can use that variable to get information, such as where the user clicked. This data comes in two pieces: the number of pixels from the left side of the page ❷ and the number from the top of the page ❸.</p><p>You can see a sampling of available events in Table A-3, along with the additional information that is passed in the optional parameter to each event.</p><div class="table"><a id="some_useful_jquery_events"/><p class="title">Table A-3. Some Useful jQuery Events</p><div class="table-contents"><table summary="Some Useful jQuery Events" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Event Name<a id="IDX-APP-A-0208" class="indexterm"/><a id="IDX-APP-A-0209" class="indexterm"/><a id="IDX-APP-A-0210" class="indexterm"/><a id="IDX-APP-A-0211" class="indexterm"/><a id="IDX-APP-A-0212" class="indexterm"/><a id="IDX-APP-A-0213" class="indexterm"/></p></th><th style="text-align: left" valign="bottom"><p>Objects Available</p></th><th style="text-align: left" valign="bottom"><p>Additional Information</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">click</code></p></td><td style="text-align: left" valign="top"><p>Any</p></td><td style="text-align: left" valign="top"><p>Page location: <code class="literal">pageX</code>, <code class="literal">pageY</code></p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">dblclick</code></p></td><td style="text-align: left" valign="top"><p>Any</p></td><td style="text-align: left" valign="top"><p>Page location: <code class="literal">pageX</code>, <code class="literal">pageY</code></p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">mousemove</code></p></td><td style="text-align: left" valign="top"><p>Any</p></td><td style="text-align: left" valign="top"><p>Page location: <code class="literal">pageX</code>, <code class="literal">pageY</code></p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">keydown</code></p></td><td style="text-align: left" valign="top"><p><code class="literal">document</code>, <code class="literal">window</code></p></td><td style="text-align: left" valign="top"><p>Key code: <code class="literal">which</code></p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">focus</code></p></td><td style="text-align: left" valign="top"><p>Form elements</p></td><td style=""> </td></tr></tbody></table></div></div><p>Events will make your web pages much more interactive, whether or not they contain maps. For a full list of events (and additional event information available), see jQuery's documentation at <a class="ulink" href="http://api.jquery.com/category/events/">http://api.jquery.com/category/events/</a>.</p></div><div class="sect2" title="Load Files and Data"><div class="titlepage"><div><div><h2 class="title"><a id="load_files_and_data"/>Load Files and Data</h2></div></div></div><p>If you want to interact with data outside of your current HTML file, jQuery has some excellent tools for doing these sorts of Ajax calls. Though Ajax is short for <span class="emphasis"><em>Asynchronous JavaScript And XML</em></span>, you can access any type of data with Ajax.</p><p>To load a file with jQuery, you use the <code class="literal">get</code> function. <code class="literal">get</code> needs at least two parameters: the URL you want to load and the function to which you want jQuery to send the results. Here's a simple example for loading a text file:</p><a id="I_programlisting_d1e16121"/><pre class="programlisting">$.get(❶"test.txt", function(txt) {
  alert(txt);
});</pre><p>The URL ❶ I provided is just the name of a file. In this case, the file is text, but it could be a bit of HTML code or another type of content. In <a class="xref" href="ch08.html#number_symble_52_colon_use_xml" title="#52: Use XML">#52: Use XML</a> in <a class="xref" href="ch08.html#number_symble_52_colon_use_xml" title="#52: Use XML">#52: Use XML</a>, I show how to parse XML results with the <code class="literal">get</code> function.</p><p>You aren't restricted to only loading simple files. You could include directory names or even a full URL. Whatever you load needs to be on the same domain that you are making the call on. For security reasons, browsers will not let you retrieve data from someone else's site, even if that data is meant to be public. You can get around this by loading the file server-side (as shown in <a class="xref" href="ch09s03.html" title="#61: Retrieve a Web Page">#61: Retrieve a Web Page</a> in <a class="xref" href="ch09s03.html" title="#61: Retrieve a Web Page">#61: Retrieve a Web Page</a>) and then accessing the local copy.</p><p>A special case exists that allows you to load data from another site. If the site provides JSON data and it allows you to specify a callback function in the URL, then you can load the data remotely using jQuery's <code class="literal">getJSON</code> function. Here's the basic structure:<a id="IDX-APP-A-0214" class="indexterm"/></p><a id="I_programlisting_d1e16146"/><pre class="programlisting">jQuery.getJSON(❷url, function(obj) {
  // Code to access the obj variable
});</pre><p>The URL you send to the <code class="literal">getJSON</code> function ❷ needs to contain a question mark in place of the name of a function. Then jQuery will create a function and call your anonymous function (or named function, if you choose) from its new function.</p><p>Another way <code class="literal">getJSON</code> is different from <code class="literal">get</code> is in the type of data passed in the parameters to your callback function. Rather than the plain text returned to the URL, jQuery passes you parsed JSON in the form of a JavaScript object.</p><p>You'll find a more complete example of <code class="literal">getJSON</code> in <a class="xref" href="ch08s02.html" title="#53: Use JSON">#53: Use JSON</a> in <a class="xref" href="ch08s02.html" title="#53: Use JSON">#53: Use JSON</a>. Also, you can see examples of the function used in a real project in several of the mashups in <a class="xref" href="ch10.html" title="Chapter 10. MASHUP PROJECTS">Chapter 10</a>.</p></div></div></body></html>