- en: Chapter 20. Upgrading
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第 20 章。升级
- en: '*The latest source code?*'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*最新的源代码？*'
- en: '*Fugu extraordinary!*'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '*鲑鱼非凡！*'
- en: '*Be brave and swallow.*'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '*勇敢地吞下。*'
- en: '![](httpatomoreillycomsourcenostarchimages1616079.png) Here’s an ugly truth:
    If upgrades are hard, sysadmins try their best to avoid them. And that can cause
    security problems. Operating system upgrades can cause software that has worked
    well for years to develop nervous tics or stop working altogether. Fixing add-on
    packages that don’t work on the new operating system version can require days
    of troubleshooting. Server upgrades can make even seasoned sysadmins wish that
    they had a simpler job, such as performing as a carnival sideshow, stuffing weasels
    into their trousers.'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '![图片](http://atomoreilly.com/source/nostarch/images/1616079.png) 这里有一个丑陋的事实：如果升级很困难，系统管理员会尽力避免它们。这可能会导致安全问题。操作系统升级可能会导致多年来一直运行良好的软件出现紧张的症状或完全停止工作。修复在新操作系统版本上不工作的附加包可能需要数天的故障排除。服务器升级甚至可能让经验丰富的系统管理员希望他们有一个更简单的工作，比如在嘉年华中担任小丑，把黄鼠狼塞进他们的裤子里。'
- en: While you can probably deal with a bit of odd behavior in a desktop after an
    upgrade, your servers and firewalls must behave exactly as expected. It’s common
    to delay upgrades until the system is so old that it can be replaced with a new
    machine running the new release, but that’s both terrible system administration
    practice and completely unacceptable security practice. Computers connected to
    the Internet must be patched, maintained, and upgraded, or an intruder will almost
    certainly compromise them.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然您可能在升级后可以处理桌面上的少量异常行为，但您的服务器和防火墙必须表现得完全符合预期。通常，人们会推迟升级，直到系统如此陈旧，以至于可以用运行新版本的全新机器替换，但这既是不良的系统管理实践，也是完全不可接受的安全实践。连接到互联网的计算机必须打补丁、维护和升级，否则入侵者几乎肯定会破坏它们。
- en: Fortunately, the OpenBSD upgrade process is simpler than those used by many
    other Unix-like operating systems. With proper preparation, you can upgrade OpenBSD
    with a minimum of difficulty.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，OpenBSD 的升级过程比许多其他类 Unix 操作系统使用的要简单。经过适当的准备，您可以轻松升级 OpenBSD。
- en: Why Upgrade?
  id: totrans-7
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 为什么升级？
- en: Because you don’t have a choice.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 因为您别无选择。
- en: Security researchers, programmers, and skilled intruders continuously discover
    new ways to penetrate previously secure systems. Although OpenBSD has suffered
    only two vulnerabilities in a default installation that permitted an intruder
    to compromise the system, that doesn’t mean that a two-year-old OpenBSD version
    is secure.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 安全研究人员、程序员和熟练的入侵者不断发现新的方法来渗透以前安全的系统。尽管 OpenBSD 在默认安装中只遭受了两个漏洞，允许入侵者破坏系统，但这并不意味着两年前的
    OpenBSD 版本就是安全的。
- en: The OpenBSD Project provides security updates for only the two most recent releases.
    For example, when OpenBSD 5.3 comes out, OpenBSD 5.1 will be “end-of-lifed” and
    lose support from developers. If someone figures out how to break into a default
    OpenBSD 5.1 installation after 5.3 comes out, the developers might not provide
    fixes. You might adjust new security patches to work on older versions of the
    code, but you will find that backporting fixes becomes increasingly difficult.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD 项目只为最近两个版本的 OpenBSD 提供安全更新。例如，当 OpenBSD 5.3 发布时，OpenBSD 5.1 将“停止支持”并失去开发者的支持。如果在
    5.3 发布后有人发现如何入侵默认的 OpenBSD 5.1 安装，开发者可能不会提供修复。您可能需要调整新的安全补丁以在旧版本的代码上工作，但您会发现回滚修复变得越来越困难。
- en: Software not enabled in the default installation can also have problems. For
    example, in November 2011, the OpenBSD Project released a patch for a problem
    in the included BIND `named(8)` name server. OpenBSD does not ship with `named`
    enabled, so this wasn’t a problem in the default installation, but it was certainly
    a security problem in a function that you might have chosen to enable.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 默认安装中未启用的软件也可能存在问题。例如，2011 年 11 月，OpenBSD 项目为包含的 BIND `named(8)` 命名服务器中的一个问题发布了补丁。OpenBSD
    并未默认启用 `named`，因此这并不是默认安装中的问题，但在您可能选择启用的一个功能中，这确实是一个安全问题。
- en: In order to protect your system, you must understand how to apply security patches,
    either by applying the patch or by upgrading the entire system. But before we
    get to the upgrade process itself, let’s look at your choices for OpenBSD versions.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 为了保护您的系统，您必须了解如何应用安全补丁，无论是通过应用补丁还是通过升级整个系统。但在我们讨论升级过程本身之前，让我们看看您在 OpenBSD 版本上的选择。
- en: OpenBSD Versions
  id: totrans-13
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: OpenBSD 版本
- en: 'Developers all over the world continually make minor changes to OpenBSD’s source
    code. If you download the source code in the morning and again in the afternoon,
    you’ll get two slightly different versions. In fact, at any given time, you can
    get a few different versions of OpenBSD: *-current*, *snapshots*, *releases*,
    and *-stable*.'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 全世界的开发者们持续不断地对 OpenBSD 的源代码进行细微的修改。如果你在早上下载源代码，然后在下午再次下载，你会得到两个略有不同的版本。实际上，在任意给定的时间，你都可以得到几个不同的
    OpenBSD 版本：*-current*、*snapshots*、*releases* 和 *-stable*。
- en: OpenBSD-current
  id: totrans-15
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: OpenBSD-current
- en: OpenBSD-current is the most recent development version of OpenBSD, containing
    code that is making its public debut. Developers test each other’s work and then
    get approval to commit code to the tree. Eventually, they must put their work
    out for the public to test, review, and debug.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD-current 是 OpenBSD 最新的开发版本，包含即将公开亮相的代码。开发者们测试彼此的工作，并获得批准将代码提交到树中。最终，他们必须将他们的工作公之于众，以便公众进行测试、审查和调试。
- en: OpenBSD-current is where the public can access the newest code. If a change
    would temporarily break web servers, games, database servers, or whatever is running
    on -current, but the change is for the long-term good, the change will go into
    -current. Those programs will probably work again before the next OpenBSD release,
    but there’s no requirement that every third-party program work perfectly at all
    times on -current.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD-current 是公众可以访问最新代码的地方。如果某个更改会暂时破坏运行在 *-current* 上的 Web 服务器、游戏、数据库服务器或其他任何东西，但这个更改是从长远来看是有益的，那么这个更改将会进入
    *-current*。这些程序可能在下一个 OpenBSD 发布之前再次工作，但并没有要求每个第三方程序在 *-current* 上始终完美运行。
- en: Note
  id: totrans-18
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The developers expect -current itself to work at all times, and they consider
    breaks serious problems. You might need to recompile Firefox, or the port maintainer
    might need to rewrite a makefile, but the core operating system is expected to
    run at all times.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 开发者期望 *-current* 本身始终能够工作，并且他们认为中断是严重的问题。你可能需要重新编译 Firefox，或者端口维护者可能需要重写一个 makefile，但核心操作系统预计始终能够运行。
- en: With these caveats, why would you possibly want to run -current? One excellent
    reason is to test the new OpenBSD in your environment. If today’s -current panics
    under certain conditions, but last week’s didn’t, the OpenBSD folks want to know
    that.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在这些注意事项下，你为什么可能想要运行 *-current* 呢？一个非常好的理由是在你的环境中测试新的 OpenBSD。如果今天的 *-current*
    在某些条件下会崩溃，但上周的没有，OpenBSD 的人希望知道这一点。
- en: (All the OpenBSD folks run -current on their laptops, and they run firewalls
    on -current.) If you can exercise -current in the real world, with a real workload,
    they want you to do so. Having real users run -current is the only way that OpenBSD
    can be tested before the official releases come out.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: （所有 OpenBSD 的人都在他们的笔记本电脑上运行 *-current*，并且他们在 *-current* 上运行防火墙。）如果你能在真实世界中，使用真实的工作负载来练习
    *-current*，他们希望你能这样做。让真实用户运行 *-current* 是 OpenBSD 在官方发布之前唯一能够被测试的方式。
- en: OpenBSD Snapshots
  id: totrans-22
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: OpenBSD 快照
- en: Every few days, the OpenBSD team uploads a release from the latest -current
    code to the mirror servers. This is an interim release called a *snapshot*, which
    is identified only by the date of its release. A snapshot is simply the state
    of -current at a particular time. While the developers try not to build a snapshot
    on a day that -current is notably fouled up, guess who’s in charge of the snapshot
    quality-assurance process. That’s you.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 每隔几天，OpenBSD 团队会将最新的 *-current* 代码上传到镜像服务器。这是一个中间版本，称为 *snapshot*，它仅通过其发布日期来识别。快照仅仅是
    *-current* 在特定时间的状态。虽然开发者们尽量避免在 *-current* 明显出现问题时构建快照，但谁负责快照的质量保证过程呢？那就是你。
- en: Snapshots are provided for installation and testing convenience. Installing
    and testing a snapshot is easier than building -current on your own. Also, if
    you can reproduce a bug on a specific snapshot, the developers know exactly which
    version of the code you are running. It’s much easier to identify a problem as
    appeared “in the July 15 2013 snapshot” than in a -current you built yourself
    from “code downloaded from server X at about 3:17 PM EST on July 15, 2013.”
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 提供快照是为了方便安装和测试。安装和测试快照比自行构建 *-current* 更容易。此外，如果你能在特定的快照上重现一个错误，开发者们就能确切地知道你正在运行哪个版本的代码。将问题识别为“出现在
    2013 年 7 月 15 日的快照中”比在从“2013 年 7 月 15 日下午 3:17 左右从服务器 X 下载的代码中构建的 -current”中更容易。
- en: Note
  id: totrans-25
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Snapshots can contain uncommitted code not in -current. The patches for the
    changes are not usually available.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 快照可能包含不在 *-current* 中的未提交代码。更改的补丁通常不可用。
- en: You can get snapshots installation media from any mirror site, in the */pub/OpenBSD/snapshots*
    directory. If you want to run -current, the recommended way to start is by installing
    the most recent snapshot you can get your hands on and upgrading from there.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以从任何镜像站点获取快照安装介质，在 */pub/OpenBSD/snapshots* 目录下。如果你想运行 -current，推荐的方式是安装你能得到的最新快照，并从那里升级。
- en: OpenBSD Releases
  id: totrans-28
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: OpenBSD 发布版本
- en: Every six months, the pace of OpenBSD development is deliberately slowed. Developers
    spend time polishing new features, and Theo makes increasingly forceful requests
    for beta testers of the newest snapshots. When the OpenBSD team is satisfied that
    the software is of adequate quality, the source code tree is tagged, and a high-quality
    snapshot is built. This snapshot is called a *release* and is issued a number
    like 5.2, 5.3, and so on. This is almost certainly what you installed on your
    first OpenBSD machine. A new release appears every May and November.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 每隔六个月，OpenBSD 的发展速度会故意放慢。开发者们会花时间打磨新特性，而Theo会越来越强烈地要求最新的快照测试者。当OpenBSD团队满意软件的质量足够时，源代码树会被标记，并构建一个高质量的快照。这个快照被称为*发布*，并会分配一个像5.2、5.3这样的编号。这几乎就是你第一次安装OpenBSD机器时所安装的版本。新的发布版本每年五月和十一月出现。
- en: OpenBSD numbers releases sequentially, starting with 2.0 and incrementing .1
    with every release. Unlike most software products, a .0 release has no special
    meaning. It’s just another spot along a long path—a milestone hit every five years.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD 按顺序编号发布版本，从 2.0 开始，每次发布增加 .1。与大多数软件产品不同，.0 版本没有特殊含义。它只是漫长道路上的另一个点——每五年达到的一个里程碑。
- en: The release is the best-supported version of OpenBSD. Everything is expected
    to work, and the development team stands behind its releases. If a serious security
    problem is discovered in a release, OpenBSD will release a patch, or *errata*,
    for it.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 发布是 OpenBSD 最受支持的版本。预期一切都能正常工作，开发团队会支持其发布版本。如果在发布中发现严重的安全问题，OpenBSD 将发布一个补丁，或
    *勘误表*。
- en: OpenBSD-stable
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: OpenBSD-stable
- en: OpenBSD-stable is an OpenBSD release with all errata and very minor patches
    included. The developers deliberately hold the number of changes to each -stable
    version to the absolute bare minimum. A stable version is referred to as its base
    release plus -stable, such as 5.4-stable, 5.5-stable, and so on.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD-stable 是一个包含所有勘误和非常小补丁的 OpenBSD 发布版本。开发者故意将每个 -stable 版本的变化数量保持在绝对最小。稳定版本被称为其基础发布加上
    -stable，例如 5.4-stable、5.5-stable 等等。
- en: What sort of changes are merged back into -stable? Security fixes and errata
    go in automatically. Other than security issues, any patches added to -stable
    must be simple, short, and obviously correct. Patches that dramatically affect
    a small number of users might go in. For example, if all systems with a specific
    network card panic at random intervals, a patch might go into -stable (accompanied
    by various developers asking why no one with that network card ran snapshots before
    the release).
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 什么样的更改会被合并回 -stable？安全修复和勘误会自动加入。除了安全问题外，添加到 -stable 的任何补丁都必须简单、简短且明显正确。可能包含那些对少数用户有重大影响的补丁。例如，如果所有具有特定网络卡的系统在随机间隔内崩溃，补丁可能会加入
    -stable（伴随着多位开发者询问为什么在发布之前没有人使用该网络卡的快照）。
- en: You won’t get new functions in -stable. It won’t come with any new device drivers
    or packet-filtering features. The API will not change. In general, -stable is
    expected to never get worse.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 你在 -stable 中不会得到新功能。它不会包含任何新的设备驱动程序或数据包过滤功能。API 不会改变。一般来说，-stable 预期永远不会变得更差。
- en: The only way to get OpenBSD-stable is to update the system from source.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 获取 OpenBSD-stable 的唯一方法是使用源代码更新系统。
- en: Which Version Should You Use?
  id: totrans-37
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 你应该使用哪个版本？
- en: OpenBSD’s release system combines the best features of open source development
    and commercial releases. Users have access to both the bleeding-edge experimental
    code and the stable, polished releases. Look at your requirements and choose your
    poison.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD 的发布系统结合了开源开发和商业发布的最佳特性。用户可以访问最前沿的实验性代码和稳定、完善的发布版本。根据你的需求选择你的版本。
- en: If you’re running OpenBSD in a production environment, either use a release
    with the applicable security errata or track -stable. The developers encourage
    more experienced users to use snapshots or -current, but that choice is up to
    you.
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你在一个生产环境中运行 OpenBSD，要么使用带有适用安全勘误表的发布版本，要么跟踪 -stable。开发者鼓励经验更丰富的用户使用快照或 -current，但这个选择取决于你。
- en: If you are evaluating OpenBSD for use in a production environment, install the
    version you intend to use.
  id: totrans-40
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你正在评估OpenBSD用于生产环境，请安装你打算使用的版本。
- en: If you’re just learning about Unix-like systems, or if you want a quiet OpenBSD
    experience, use a release and apply applicable errata.
  id: totrans-41
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你刚开始学习Unix-like系统，或者如果你想有一个安静的OpenBSD体验，请使用发布版并应用适用的勘误表。
- en: If you’re an operating system developer or experienced sysadmin, feel free to
    jump right in to -current or snapshots. You can either handle any problems you
    encounter or use those problems as an excuse to expand your knowledge. Many people
    find that they can use -current in production, if they do not need packages. These
    are usually more experienced users who want firewalls.
  id: totrans-42
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果你是一个操作系统开发者或经验丰富的系统管理员，可以直接跳到-current或快照。你可以处理你遇到的问题，或者利用这些问题来扩展你的知识。许多人发现，如果他们不需要软件包，他们可以在生产环境中使用-current。这些人通常是更有经验的用户，他们想要防火墙。
- en: Hobbyists can run anything they want!
  id: totrans-43
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 爱好者可以运行他们想要的任何东西！
- en: Remember the limitations of your chosen branch. A release is a good place to
    start, but you can gradually upgrade your system to -stable, and then to -current,
    as your understanding expands. Many developers started out as interested hobbyists.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 记住你选择分支的限制。发布版是一个良好的起点，但你可以在理解不断扩大的情况下逐步将系统升级到-stable，然后升级到-current。许多开发者最初是作为感兴趣的爱好者开始的。
- en: The OpenBSD Upgrade Process
  id: totrans-45
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: OpenBSD升级过程
- en: 'An OpenBSD upgrade has three distinct phases: installing the newer versions
    of the operating system files, updating the local configuration, and updating
    obsolete add-on software packages. Each is a separate part that requires independent
    handling.'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD的升级有三个不同的阶段：安装操作系统的较新版本文件、更新本地配置以及更新过时的附加软件包。每个都是一个独立的部分，需要独立处理。
- en: An upgrade requires installation media. The best upgrade media is the new release
    CD or an Internet mirror. You can also upgrade OpenBSD by building and installing
    the source code directly on the machine to be upgraded, but doing so is more difficult
    and risky than upgrading from the official release. Much of the information for
    upgrading from a network or CD applies to upgrading via source code.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 升级需要安装介质。最好的升级介质是新发布的CD或互联网镜像。你也可以通过在要升级的机器上直接构建和安装源代码来升级OpenBSD，但这比从官方发布版升级更困难、风险更高。从网络或CD升级的大部分信息也适用于通过源代码升级。
- en: Note
  id: totrans-48
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: OpenBSD supports upgrading only one major release at a time. You cannot upgrade
    directly from, say, 5.3 to 5.5; you must upgrade from 5.3 to 5.4, and then to
    5.5\. The more releases you need to upgrade through, the more reason to reinstall.
    You would spend more time serially upgrading three or four releases than you would
    reinstalling.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD一次只能升级一个主要版本。你不能直接从，比如说，5.3升级到5.5；你必须先从5.3升级到5.4，然后升级到5.5。你需要升级的版本越多，重新安装的理由就越多。你串行升级三个或四个版本所花费的时间，比你重新安装的时间还要多。
- en: Before upgrading, back up any data you actually care about. The upgrade process
    extracts new files over the existing operating system, and could overwrite something
    important. The installer generally works, but human beings are fallible. Back
    up!
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在升级之前，备份任何你真正关心的数据。升级过程会在现有操作系统上提取新文件，可能会覆盖某些重要内容。安装程序通常可以正常工作，但人类是会犯错的。备份！
- en: Following the Upgrade Guide
  id: totrans-51
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 按照升级指南操作
- en: As OpenBSD evolves, basic system features change. This wouldn’t be a big issue,
    except when interdependent changes create a chicken-and-egg or bootstrap problem.
    If you just blindly run the upgrade process and don’t handle any other required
    changes, you’ll find that your new system fails in unpredictable ways.^([[42](#ftn.id310014)])
    If you’re building the system from source, these problems might prevent the build
    from completing.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 随着OpenBSD的发展，基本系统功能会发生变化。这本来不是什么大问题，除非相互依赖的更改造成了鸡生蛋或自举问题。如果你只是盲目地运行升级过程而不处理任何其他必需的更改，你会发现你的新系统以不可预测的方式失败。[^[[42](#ftn.id310014)])
    如果你从源代码构建系统，这些问题可能会阻止构建完成。
- en: All of these potential problems should be solvable by anyone building the system
    from source, but it’s nice to have them documented. Conveniently, OpenBSD provides
    an *Upgrade Guide* for each release, documenting the steps needed to take a system
    from one release to the next.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些潜在问题都应该可以通过从源代码构建系统的人来解决，但将它们记录下来会更好。方便的是，OpenBSD为每个版本提供了一个*升级指南*，记录了将系统从一个版本升级到下一个版本所需的步骤。
- en: The *Upgrade Guide* is divided into chunks by the type of upgrade you are performing.
    The simplest upgrade is for people using official OpenBSD files, such as a network
    or CD upgrade. If you’re building from source, the instructions quickly grow in
    complexity. Follow the instructions in the order in which they appear. Most upgrade
    prerequisites are typical system administration tasks. The following are the most
    common requirements.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '*升级指南* 根据你执行的升级类型分成几个部分。最简单的升级是针对使用官方 OpenBSD 文件的人，例如网络或 CD 升级。如果你是从源代码构建，说明的复杂性会迅速增加。按照它们出现的顺序遵循说明。大多数升级先决条件是典型的系统管理任务。以下是最常见的要求。'
- en: Note
  id: totrans-55
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Instructions in the *Upgrade Guide* supersede anything I say in this chapter.
    I could just sprinkle the words “unless specified otherwise in the *Upgrade Guide*”
    in every paragraph for the rest of this section, but then my editor would slap
    me. The OpenBSD documentation is the final word in OpenBSD system administration,
    including the upgrade process.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *升级指南* 中的说明优先于本章中我所说的任何内容。我本可以在本节剩余部分每一段都加上“除非 *升级指南* 中另有说明”的字样，但那样我的编辑可能会责备我。OpenBSD
    文档是 OpenBSD 系统管理的最终权威，包括升级过程。
- en: Install Programs
  id: totrans-57
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 安装程序
- en: Especially when you are building from source, bootstrap tools such as `gcc(1)`
    and `perl(1)` might need to be built with the upgraded tool. When upgrading from
    source, you might need to install these bootstrap tools before beginning to compile
    the new version of OpenBSD. The *Upgrade Guide* notes these requirements.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 尤其是在从源代码构建时，像 `gcc(1)` 和 `perl(1)` 这样的引导工具可能需要使用升级后的工具来构建。在从源代码升级时，你可能需要在开始编译新版本的
    OpenBSD 之前安装这些引导工具。*升级指南* 记录了这些要求。
- en: If your attempt to build OpenBSD from source fails, reread the *Upgrade Guide*
    before troubleshooting. Starting from the closest available binary release or
    snapshot will probably solve your problem.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你尝试从源代码构建 OpenBSD 失败，在故障排除之前重新阅读 *升级指南*。从最近的可用二进制发布版或快照开始可能解决你的问题。
- en: Remove Programs and Files
  id: totrans-60
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 移除程序和文件
- en: OpenBSD removes programs from the base system when they become obsolete or dangerous,
    or when their functions are integrated into other programs. When you upgrade,
    you must manually remove these programs. This is necessary because old software
    left on an upgraded system can pose a security risk. Also, some files and directories
    might become superfluous in a new OpenBSD version. You can remove these programs,
    files, or directories once the upgrade is complete.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 当 OpenBSD 中的程序变得过时或危险，或者它们的函数集成到其他程序中时，OpenBSD 会从基本系统中移除这些程序。当你升级时，你必须手动移除这些程序。这是必要的，因为留在升级系统上的旧软件可能构成安全风险。此外，一些文件和目录在新版本的
    OpenBSD 中可能变得不再需要。升级完成后，你可以移除这些程序、文件或目录。
- en: Prepare Package Upgrades
  id: totrans-62
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 准备软件包升级
- en: When you upgrade OpenBSD, you must upgrade the installed packages as well, because
    you can’t reliably run packages built for old versions of OpenBSD on newer versions.
    (Doing so *might* work, but there’s no guarantee.) The *Upgrade Guide* includes
    notes on upgrading specific installed packages, and you should take some of those
    actions before beginning the upgrade.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 当你升级 OpenBSD 时，你必须升级已安装的软件包，因为你不能可靠地在新版本 OpenBSD 上运行为旧版本构建的软件包。（这样做 *可能* 会成功，但没有保证。）*升级指南*
    包含有关升级特定已安装软件包的说明，你应在开始升级之前采取其中的一些行动。
- en: For example, the *Upgrade Guide* for the newest OpenBSD version says that the
    PostgreSQL port had a major version upgrade. You must do a database dump and restore
    as part of the upgrade. The old version of PostgreSQL might not run well on the
    new OpenBSD, so perform the database dump before starting the system upgrade.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，最新版本的 *升级指南* 中提到 PostgreSQL 端口进行了主要版本升级。你必须作为升级的一部分进行数据库转储和恢复。旧版本的 PostgreSQL
    在新 OpenBSD 上可能运行不佳，因此在进行系统升级之前执行数据库转储。
- en: Your packages might not require any pre-upgrade work, but it’s much easier to
    check beforehand than to finish the operating system upgrade, and then need to
    fall back because you didn’t prepare some third-party package.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 你的软件包可能不需要任何预升级工作，但在升级操作系统之前进行检查要容易得多，而不是完成操作系统升级后需要回滚，因为你没有准备某些第三方软件包。
- en: System Configuration
  id: totrans-66
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 系统配置
- en: The preceding tasks are the most common requirements for upgrading, but you
    might need to change other system files before or after the upgrade process itself.
    Read the *Upgrade Guide*, or your programs might not run as expected.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的任务是最常见的升级需求，但在升级过程之前或之后，你可能需要更改其他系统文件。阅读 *升级指南*，否则你的程序可能无法按预期运行。
- en: Customizing Upgrades
  id: totrans-68
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 定制升级
- en: The upgrade script supports the *siteXX.tgz* file discussed in [Chapter 23](ch23.html
    "Chapter 23. Customizing OpenBSD"). If the file exists in the installation media,
    you can choose to install it during the upgrade.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 升级脚本支持 [第 23 章](ch23.html "第 23 章。定制 OpenBSD") 中讨论的 *siteXX.tgz* 文件。如果该文件存在于安装媒体中，你可以在升级期间选择安装它。
- en: You can also run a custom post-upgrade script as part of the upgrade. When the
    upgrade completes, the script checks for the file */upgrade.site*. If the upgrader
    finds this file, it executes this script as the last step of the upgrade. Copy
    */upgrade.site* to the system before starting the upgrade. [Chapter 23](ch23.html
    "Chapter 23. Customizing OpenBSD") discusses *upgrade.site* in more detail.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以在升级过程中运行一个自定义的后续脚本。当升级完成后，脚本会检查文件 */upgrade.site*。如果升级器找到这个文件，它将在升级的最后一步执行这个脚本。在开始升级之前，将
    */upgrade.site* 复制到系统中。[第 23 章](ch23.html "第 23 章。定制 OpenBSD")更详细地讨论了 *upgrade.site*。
- en: Upgrading from Official Media
  id: totrans-71
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 从官方媒体升级
- en: 'After reading the *Upgrade Guide*, get your installation media for the new
    version of OpenBSD and boot from it. If you plan to upgrade over a network, you
    should need only the new installation kernel *bsd.rd*. You can just grab this
    via FTP (or you could grab the entire directory along with it and run the upgrade
    from your local disk). Here, I grab the newest snapshot kernel from my root directory:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在阅读 *升级指南* 后，获取新版本 OpenBSD 的安装媒体并从中启动。如果你计划通过网络升级，你可能只需要新的安装内核 *bsd.rd*。你可以通过
    FTP 获取这个内核（或者你也可以获取整个目录并从本地磁盘运行升级）。这里，我从我的根目录获取最新的快照内核：
- en: '[PRE0]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: After you get the snapshot kernel, go to your console and boot into the new
    kernel.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 在你获取快照内核后，进入你的控制台并从新内核启动。
- en: '[PRE1]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Enter **`U`** to upgrade. The upgrade process looks much like the installation
    process covered in [Chapter 3](ch03.html "Chapter 3. Installation Walk-Through").
    Defaults appear inside square brackets. Accept the defaults by pressing ENTER.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 输入 **`U`** 以升级。升级过程看起来很像 [第 3 章](ch03.html "第 3 章。安装流程") 中覆盖的安装过程。默认值出现在方括号内。通过按
    ENTER 键接受默认值。
- en: '[PRE2]'
  id: totrans-77
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Always use the default terminal, unless you know exactly when you shouldn’t.
    Commodity hardware usually uses vt220, as shown here at **1**, but the default
    terminal is platform-specific.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 总是使用默认的终端，除非你知道确切不应该使用的时候。通用硬件通常使用 vt220，如这里所示在**1**，但默认终端是平台特定的。
- en: The upgrade needs to read your root partition to learn where to install files.
    It can’t conclusively identify your actual root disk **2** and partition **3**
    unless you tell it to do that.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 升级需要读取你的根分区以了解文件安装的位置。除非你告诉它这样做，否则它无法确定你的实际根磁盘**2**和分区**3**。
- en: The upgrade script will configure your network according to the existing settings
    that you should hope are correct. If you need to adjust the network at every boot,
    the upgrade script gives you a chance to reconfigure the network at **4**.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 升级脚本将根据你现有的设置配置你的网络，你应该希望这些设置是正确的。如果你需要在每次启动时调整网络，升级脚本会给你在**4**重新配置网络的机会。
- en: If you shut down the machine via `reboot` or `shutdown`, your filesystems should
    be clean. If you unceremoniously pulled the power plug because you were going
    to upgrade the machine and no longer cared about your filesystems, OpenBSD will
    notice and clean your filesystems. To deep-check clean filesystems, you can force
    running `fsck(8)` at **5**. The upgrade script preens clean filesystems to check
    for obvious errors before proceeding.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你通过 `reboot` 或 `shutdown` 关闭机器，你的文件系统应该是干净的。如果你因为打算升级机器而不再关心你的文件系统，粗鲁地拔掉电源插头，OpenBSD
    会注意到并清理你的文件系统。要深度检查干净的文件系统，你可以在**5**强制运行 `fsck(8)`。升级脚本在继续之前会清理干净的文件系统以检查明显的错误。
- en: Upgrading Over the Network
  id: totrans-82
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 通过网络升级
- en: 'The default upgrade method is CD. I want to do this upgrade over the network,
    so here’s how I continue:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 默认的升级方法是 CD。我想通过网络进行这次升级，所以我会这样做：
- en: '[PRE3]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: I choose `ftp` as the location of the sets at **1**. I don’t need to go through
    a proxy server to access the FTP server, so I leave that space blank at **2**.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 我选择 `ftp` 作为**1**处的集合位置。我不需要通过代理服务器访问 FTP 服务器，所以我在**2**处留空。
- en: The default OpenBSD FTP server is perfectly fine, but if you’ve identified a
    really fast mirror, you might use that. I use my preferred mirror site at **3**.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 默认的 OpenBSD FTP 服务器完全没问题，但如果你已经确定了一个非常快速的镜像，你可能会使用它。我在 **3** 使用我首选的镜像站点。
- en: Every *bsd.rd* installer knows the server directory to install from at **4**.
    I change the server directory only if I have set up a local mirror. Similarly,
    every OpenBSD mirror permits anonymous FTP. I change the username and enter a
    password only if I’m using a local mirror at **5**.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 每个 *bsd.rd* 安装程序都知道从 **4** 服务器目录安装。只有在我设置了本地镜像的情况下，我才会更改服务器目录。同样，每个 OpenBSD
    镜像都允许匿名 FTP。只有在我使用本地镜像时，我才会更改用户名并输入密码 **5**。
- en: Choosing File Sets
  id: totrans-88
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 选择文件集
- en: Next comes a chance to choose which sets to upgrade.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来是选择升级哪些集的机会。
- en: '[PRE4]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: You must upgrade every file set installed on your machine, or the machine will
    behave unpredictably. If you didn’t install some sets during your original installation,
    you don’t need to install them now. For most machines, I recommend installing
    all sets.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 你必须升级机器上安装的每个文件集，否则机器的行为将不可预测。如果你在原始安装期间没有安装某些集合，你现在不需要安装它们。对于大多数机器，我建议安装所有集合。
- en: Note
  id: totrans-92
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Notice that two sets are missing: *etcXX.tgz* and *xetcXX.tgz*. These files
    belong in */etc* and are legitimately edited by system administrators. The upgrade
    script cannot know if a file should be replaced, edited, or ignored. You must
    update */etc* yourself.'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，有两个集合丢失：*etcXX.tgz* 和 *xetcXX.tgz*。这些文件属于 */etc*，并且是系统管理员合法编辑的。升级脚本无法知道一个文件是否应该被替换、编辑或忽略。你必须自己更新
    */etc*。
- en: The upgrade script downloads and extracts the selected file sets, and then asks
    you to verify that you’re finished selecting file sets. If so, it remakes all
    your device nodes to fit with the new kernel.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 升级脚本会下载并提取选定的文件集，然后询问你是否已完成文件集的选择。如果是这样，它会重新创建所有设备节点以适应新的内核。
- en: At this point, you can reboot into your new OpenBSD userland except that userland
    might not work quite right because you haven’t updated */etc* yet.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 在此阶段，你可以重启到新的 OpenBSD 用户空间，但用户空间可能不会完全正常工作，因为你还没有更新 */etc*。
- en: Updating /etc
  id: totrans-96
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更新 /etc
- en: The */etc* directory contains system and program configuration information.
    When a program changes, its configuration file might also change. If you try to
    run a new program with an obsolete configuration file, the program will not run
    correctly.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: '*/etc* 目录包含系统和程序配置信息。当程序发生变化时，其配置文件也可能发生变化。如果你尝试使用过时的配置文件运行新程序，程序将无法正确运行。'
- en: You absolutely must update */etc* before running your system—arguably the most
    annoying part of an upgrade. No automated process can possible know how your system
    should behave. Only you can know that, which means that you must compare the contents
    of your existing */etc* to the same files in a new, stock */etc*. OpenBSD provides
    tools to make the process less annoying.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 你绝对必须在运行系统之前更新 */etc* —— 这可能是升级中最令人烦恼的部分。没有任何自动化过程能够知道你的系统应该如何表现。只有你知道这一点，这意味着你必须将现有
    */etc* 的内容与新的、库存 */etc* 中的相同文件进行比较。OpenBSD 提供了工具来使这个过程不那么令人烦恼。
- en: Before you begin, if your system performs complicated functions, such as a database
    or packet filtering, boot into single-user mode. (Although single-user mode is
    not strictly necessary, I’ve had software behave badly during a half-completed
    upgrade, so I now routinely update */etc* in single-user mode.)
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始之前，如果你的系统执行复杂的功能，如数据库或数据包过滤，请以单用户模式启动。尽管单用户模式并非绝对必要，但我曾在升级一半时遇到软件表现不佳的情况，所以我现在通常会以单用户模式更新
    */etc*。
- en: '[PRE5]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: While I’m a long-time `tcsh` user,^([[43](#ftn.id427066)]) I always use the
    default shell in single-user mode. If you want to use an alternate shell, it must
    be statically linked and available on the root partition.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然我一直是 `tcsh` 的长期用户，^([[43](#ftn.id427066)]) 但在单用户模式下，我总是使用默认的 shell。如果你想使用其他
    shell，它必须是静态链接的，并且必须在根分区上可用。
- en: Mounting Filesystems
  id: totrans-102
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 挂载文件系统
- en: Now mount all your filesystems. If you upgraded via the network, start the network
    now.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 现在挂载所有文件系统。如果你通过网络升级，现在启动网络。
- en: '[PRE6]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: I’ve hardly begun, and here’s a warning already. How fantastic! Perhaps this
    IPv6 error is from the upgrade, or maybe it’s a lingering misconfiguration I never
    noticed before. Either way, this is a good time to identify and fix the problem.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 我几乎还没开始，就已经收到一个警告了。多么神奇！也许这个 IPv6 错误来自升级，或者可能是之前从未注意到的遗留配置错误。无论如何，这是一个识别和解决问题的好时机。
- en: Verify that you’re on the network by pinging a couple of hosts.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 通过ping几个主机来验证你已连接到网络。
- en: You need the files *etcXX.tgz* and *xetcXX.tgz* for your new release. If you
    have the CD, the files are in the release directory. If not, fetch them over the
    network. (I always get these file sets from the same server I upgraded from, just
    to eliminate any chance of a difference in the files.)
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要*etcXX.tgz*和*xetcXX.tgz*文件来更新你的新版本。如果你有CD，这些文件在发布目录中。如果没有，可以从网络上获取它们。（我总是从升级时使用的同一个服务器获取这些文件集，以消除文件之间有任何差异的可能性。）
- en: '[PRE7]'
  id: totrans-108
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: You are now ready to update */etc*.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 你现在可以更新*/etc*了。
- en: Using sysmerge(8) to Compare /etc Files
  id: totrans-110
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用sysmerge(8)比较/etc文件
- en: The `sysmerge(8)` program compares your existing */etc* to the */etc* in the
    installation set, points out differences, and lets you replace your installed
    file with the new one, keep your file, or merge the two.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: '`sysmerge(8)`程序比较你的现有*/etc*与安装集中的*/etc*，指出差异，并允许你用新版本替换安装的文件，保留你的文件，或者合并两者。'
- en: Use `-s` to tell `sysmerge` where the new *etcXX.tgz* file is, and `-x` to point
    to the new *xetcXX.tgz*. I put both of these files in */tmp*.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`-s`告诉`sysmerge`新版本的*etcXX.tgz*文件的位置，使用`-x`指向新的*xetcXX.tgz*。我将这两个文件都放在*/tmp*目录下。
- en: '[PRE8]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '`sysmerge` will handle the easy changes itself, but leave you to take care
    of files that need your intervention.'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '`sysmerge`会自行处理简单的更改，但会留给你处理需要你干预的文件。'
- en: Easy sysmerge Updates
  id: totrans-115
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 简单的sysmerge更新
- en: 'If your system is only lightly modified, you should see something like this:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的系统只有轻微的修改，你应该会看到类似这样的情况：
- en: '[PRE9]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: I haven’t changed these files, so `sysmerge` automatically updates them for
    me.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 我没有修改这些文件，所以`sysmerge`会自动为我更新它们。
- en: '[PRE10]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: I didn’t have these files on my system, so `sysmerge` installs them for me.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 我系统上没有这些文件，所以`sysmerge`会为我安装它们。
- en: These examples are easy cases. In cases where you’ve edited an */etc* file,
    `sysmerge` will need your help.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 这些例子是简单的情况。在你编辑了*/etc*文件的情况下，`sysmerge`将需要你的帮助。
- en: sysmerge and Edited Files
  id: totrans-122
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: sysmerge和编辑过的文件
- en: Say you’ve edited a file, and the file version has changed. Does your local
    change reflect the update, does it conflict, or can the two coexist? `sysmerge`
    can’t tell if it should overwrite the installed file with a new version, leave
    it unchanged, or merge the two, so it displays the differences between the old
    and new files.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 假设你编辑了一个文件，文件版本已经改变。你的本地更改是否反映了更新，是否冲突，或者两者可以共存？`sysmerge`无法判断是否应该用新版本覆盖安装的文件，保持不变，或者合并两者，因此它会显示旧文件和新文件之间的差异。
- en: '[PRE11]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: If you’ve changed the file, `sysmerge` presents the differences between the
    old and new files with a few surrounding lines of context. In this example, the
    */etc/mail/aliases* file on my system is dated June 9 at **1**, and the new version
    is from October 23 at **2**. Lines that exist in the new version of the file but
    not in the installed one are prefaced with a plus sign (`+`). Lines that exist
    in the installed file but not in the new one are prefaced with a minus sign (`-`).
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你已经修改了文件，`sysmerge`会显示旧文件和新文件之间的差异，并附带一些上下文行。在这个例子中，我的系统上的*/etc/mail/aliases*文件日期是6月9日**1**，而新版本是10月23日**2**。新版本中存在但安装版本中不存在的行前面有一个加号（`+`）。安装版本中存在但新版本中不存在的行前面有一个减号（`-`）。
- en: This example shows that the OpenBSD version of this file changed from 1.36 at
    **3** to 1.37 at **4**. That’s not terribly surprising, and for system administration
    purposes, not a terribly vital piece of information. But the new version has a
    new alias, directing email addressed to the user `_iscsid` to */dev/null* at **5**.
    This could be important, so I want the new alias on my system.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 这个例子显示，OpenBSD版本的这个文件从1.36**3**变到了1.37**4**。这并不令人惊讶，对于系统管理目的来说，也不是一个特别重要的信息。但新版本有一个新的别名，将发送给用户`_iscsid`的电子邮件重定向到*/dev/null**5**。这可能是重要的，所以我希望在我的系统上使用新的别名。
- en: Next, we see a difference between the files, where I’ve forwarded email addressed
    to root to my personal email at **6**, but the new version of the file has no
    such redirection at **7**. I want the old version of this line but the new version
    of another line, and while I don’t particularly care about the OpenBSD version
    numbers, I would prefer the newer one. I could hand assemble an aliases file,
    but after `sysmerge` prints out the differences, it offers to help.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们注意到文件之间的差异，我在**6**处将发送给root的电子邮件转发到了我的个人邮箱，但文件的新版本在**7**处没有这样的重定向。我希望保留这一行的旧版本，但另一行的最新版本，尽管我对OpenBSD的版本号并不特别关心，但我更倾向于使用更新的版本。我可以手动汇编一个别名文件，但`sysmerge`在打印出差异后，会提供帮助。
- en: '[PRE12]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '`sysmerge` offers the following choices:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: '`sysmerge`提供了以下选项：'
- en: If I delete the temporary aliases file, `sysmerge` throws away the new file
    **1**. This is fine if my existing aliases file is adequate, but in this case,
    I want part of the new file.
  id: totrans-130
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果我删除临时的别名文件，`sysmerge`会丢弃新文件**1**。如果我的现有别名文件足够好，这没问题，但在这个情况下，我想要新文件的一部分。
- en: If I install the temporary aliases file, I overwrite my changes **2**. Unless
    I go back in and change the aliases file again, my custom mail forwarding will
    stop working. I don’t want this to happen.
  id: totrans-131
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果我安装临时的别名文件，我会覆盖我的更改**2**。除非我返回并再次更改别名文件，否则我的自定义邮件转发将停止工作。我不想发生这种情况。
- en: I can merge the old and new files **3**, choosing the best fit from each file,
    which is the option I’ll pick.
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我可以合并旧文件和新文件**3**，从每个文件中选择最佳匹配，这是我将会选择的选项。
- en: I could look at the differences again **4**. This has the advantage of putting
    off an actual decision.
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我可以再次查看差异**4**。这的优势是可以推迟实际的决定。
- en: To merge the old and new files, I enter **`m`**. Note that the merge function
    requires close attention to detail. A mistake here can make your system hang as
    it tries to go into multiuser mode.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 要合并旧文件和新文件，我输入**`m`**。请注意，合并功能需要密切关注细节。这里的错误可能会导致你的系统在尝试进入多用户模式时挂起。
- en: When you merge, `sysmerge` takes your input and builds a combined file. Lines
    that are identical in both versions are automatically added to the new file. When
    lines differ, `sysmerge` walks you through the differences and lets you choose
    a version.
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 当你合并时，`sysmerge`会接收你的输入并构建一个合并后的文件。两个版本中相同的行会自动添加到新文件中。当行不同时，`sysmerge`会引导你查看差异，并让你选择一个版本。
- en: The new version of the line appears on the right, and the installed version
    is on the left. Enter **`l`** or **`1`** to choose the version on the left side,
    or **`r`** or **`2`** to choose the version on the right.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 新版本行出现在右侧，已安装版本在左侧。输入**`l`**或**`1`**以选择左侧版本，或输入**`r`**或**`2`**以选择右侧版本。
- en: '[PRE13]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The version number has updated, though it’s in a comment, which won’t affect
    how the alias file updates. Still, as I’m merging the files anyway, I might as
    well get the new version number. I enter **`r`** to choose the version on the
    right.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 版本号已更新，尽管它在注释中，这不会影响别名文件的更新。不过，既然我正在合并文件，我最好也获取新的版本号。我输入**`r`**以选择右侧版本。
- en: '[PRE14]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: There is no equivalent to this line in the installed file, as this alias exists
    only in the new file. Again, I choose **`r`** to include this line in my file.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 已安装文件中没有与此行等效的行，因为这个别名只存在于新文件中。再次，我选择**`r`**将此行包含在我的文件中。
- en: '[PRE15]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Here, I want the entry from the installed file, on the left-hand side. I choose
    **`l`**.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我希望选择已安装文件中的条目，位于左侧。我选择**`l`**。
- en: Once I’ve gone through all of the entries, `sysmerge` offers me more choices.
    These include comparing the merged and installed files, comparing the merged and
    new files, starting over, viewing the merged file, redoing the merge, and installing
    the merged file.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我处理完所有条目，`sysmerge`会给我提供更多选择。这些包括比较合并和已安装文件，比较合并和新文件，重新开始，查看合并文件，重新合并，以及安装合并文件。
- en: '[PRE16]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: I did everything correctly, so I install the merged file (although I should
    probably view the merged file first, and then install it).
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 我一切都做得正确，所以我安装了合并文件（尽管我可能应该先查看合并文件，然后再安装它）。
- en: My biggest difficulty with `sysmerge` comes in differentiating my left and my
    right. Worse, the L key is on the right side, and the R key is on the left. (Go
    ahead now, laugh, but just wait until you mix that up.)
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 我在使用`sysmerge`时最大的困难在于区分我的左右。更糟糕的是，L键在右侧，R键在左侧。（现在你可以笑了，但等一下，你会弄混的。）
- en: Finishing sysmerge
  id: totrans-147
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 完成sysmerge
- en: When `sysmerge` finishes installing the files, it checks the permissions on
    the */etc* files, and tells you where to find the log and that the system might
    need a reboot. A purist might tell you that you don’t need to reboot, but usually
    you should go ahead and do it. Rebooting after changing core system files prevents
    a variety of problems, and rebooting as part of an upgrade isn’t unreasonable.
    You can wait to reboot until after you upgrade your packages, as long as everything
    works.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 当`sysmerge`完成文件安装后，它会检查*/etc*文件的权限，并告诉你在哪里找到日志，以及系统可能需要重启。一个纯粹主义者可能会告诉你不需要重启，但通常你应该继续重启。更改核心系统文件后重启可以防止各种问题，作为升级的一部分重启也是合理的。你可以在升级你的包之后等待重启，只要一切正常工作。
- en: '[PRE17]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: You now have an updated OpenBSD base system. Be aware that new or changed files
    can change system behavior, but usually you won’t notice. The *Upgrade Guide*
    usually notes any changes average users are likely to notice. Still, only you
    know what your system does and how you want it to behave.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在拥有了一个更新的 OpenBSD 基础系统。请注意，新文件或更改的文件可能会改变系统行为，但通常您不会注意到。*升级指南*通常会注明用户可能会注意到的任何更改。不过，只有您知道您的系统做什么以及您希望它如何表现。
- en: Upgrading your installed packages is a separate task.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 升级已安装的软件包是一个单独的任务。
- en: Updating Installed Packages
  id: totrans-152
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 更新已安装的软件包
- en: Packages run reliably only on the version of OpenBSD for which they’re compiled.
    If you’re using packages, then updating your third-party software is very easy.
    (If you build your own software from the ports collection, you can still update
    but it won’t be as easy.)
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 软件包只在编译它们的 OpenBSD 版本上可靠运行。如果您使用软件包，那么更新第三方软件非常容易。（如果您从 ports 收集中构建自己的软件，您仍然可以更新，但不会那么容易。）
- en: First, check the *Upgrade Guide* again. It describes any intrusive changes to
    major software. Take any actions it recommends before continuing.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，再次检查*升级指南*。它描述了任何对主要软件的侵入性更改。在继续之前，采取它推荐的任何行动。
- en: Updating the Package Repository
  id: totrans-155
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 更新软件包仓库
- en: Before upgrading your packages, check your `$PKG_PATH` environment variable.
    It almost certainly references the package directory for your previous version
    of OpenBSD.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 在升级软件包之前，检查您的 `$PKG_PATH` 环境变量。它几乎肯定引用了您之前 OpenBSD 版本的软件包目录。
- en: '[PRE18]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Find the package repository for your new version of OpenBSD. You can probably
    just update the release number in your shell’s dotfile, but go to the mirror site
    and make sure that the packages for that release are present.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 找到您新版本的 OpenBSD 的软件包仓库。您可能只需在 shell 的配置文件中更新版本号，但请访问镜像站点并确保该版本的软件包存在。
- en: If you upgrade from release to release, you can use the `uname(1)` command to
    set your `PKG_PATH` in your dotfile. For example, if *ftp11.usa.openbsd.org* is
    your favorite mirror site, use a line like this for `sh`-based dotfiles.
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您从发布版升级到发布版，您可以使用 `uname(1)` 命令在您的配置文件中设置 `PKG_PATH`。例如，如果 *ftp11.usa.openbsd.org*
    是您最喜欢的镜像站点，对于基于 `sh` 的配置文件，可以使用这样的行。
- en: '[PRE19]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Using the Upgrade Command
  id: totrans-161
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用升级命令
- en: To upgrade your installed packages, use `pkg_add` with the `-i` and `-u` flags.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 要升级已安装的软件包，请使用带有 `-i` 和 `-u` 标志的 `pkg_add`。
- en: '[PRE20]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: The `-i` flag tells `pkg_add` to work in interactive mode and ask you about
    any ambiguities. The `-u` flag means “update.”
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: '`-i` 标志告诉 `pkg_add` 以交互模式运行并询问您任何歧义。`-u` 标志表示“更新”。'
- en: This upgrader recurses through each of your add-on software packages and its
    dependencies, uninstalling the old version and installing the new. If you want
    to see more verbose and detailed messages about the package-updating process,
    add the `-v` flag.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 此升级器会递归地遍历您的每个附加软件包及其依赖项，卸载旧版本并安装新版本。如果您想看到关于软件包更新过程的更多详细消息，请添加 `-v` 标志。
- en: Package Options
  id: totrans-166
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 软件包选项
- en: If the dependencies for a package have changed and you now have multiple options,
    `pkg_add` presents your choices.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 如果软件包的依赖关系已更改，并且您现在有多种选择，`pkg_add` 会显示您的选择。
- en: '[PRE21]'
  id: totrans-168
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: The package `foomatic-db-engine` can use either `curl` or `wget`. Of the two,
    I prefer `wget`, so I enter `1`. Pressing ENTER tells `pkg_add` to use the default.
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 软件包 `foomatic-db-engine` 可以使用 `curl` 或 `wget`。在这两个中，我更喜欢 `wget`，所以我输入 `1`。按回车键告诉
    `pkg_add` 使用默认设置。
- en: Package Messages
  id: totrans-170
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 软件包消息
- en: Once all of the packages have been updated, `pkg_add` displays any messages
    from the upgraded packages.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦所有软件包都已更新，`pkg_add` 会显示升级软件包的任何消息。
- en: '[PRE22]'
  id: totrans-172
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Some of the installation instructions will tell you to clear out cached files
    from the older version of the software, as in this CUPS example.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 一些安装说明会告诉您清除旧版本软件的缓存文件，例如在这个 CUPS 示例中。
- en: '[PRE23]'
  id: totrans-174
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Other times, software might jump versions. For example, OpenBSD lets you install
    multiple versions of PHP, Python, and other scripting languages, but after upgrading,
    you must decide which is your preferred default.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 其他时候，软件可能会跳过版本。例如，OpenBSD 允许您安装多个版本的 PHP、Python 和其他脚本语言，但在升级后，您必须决定哪个是您首选的默认版本。
- en: '[PRE24]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: You may also need to change some system configuration after an upgrade.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 在升级后，您可能还需要更改一些系统配置。
- en: '[PRE25]'
  id: totrans-178
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: The package maintainers put these messages into the package for your benefit.
    Read them, and if you’re in doubt, follow their instructions.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 软件包维护者将这些消息放入软件包中供您使用。阅读它们，如果您有疑问，请遵循它们的说明。
- en: If all of your software is installed via packages, the upgrade process should
    be painless and transparent. I would like to tell you about all the problems and
    edge cases, except I’ve never been able to trigger any. Upgrading packages from
    the official release media just works. Packages built from the ports tree, however,
    are more complicated to upgrade, as I discuss in [Upgrading Ports](ch20.html#upgrading_ports
    "Upgrading Ports").
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您的所有软件都是通过软件包安装的，升级过程应该毫无痛苦且透明。我想告诉您所有的问题和边缘情况，但我从未能够触发任何。从官方发布介质升级软件包只需按正常操作即可。然而，从端口树构建的软件包升级更复杂，正如我在[升级端口](ch20.html#upgrading_ports
    "升级端口")中讨论的那样。
- en: Why Build Your Own OpenBSD?
  id: totrans-181
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 为什么要自己构建 OpenBSD？
- en: Building your own upgrade from OpenBSD’s source is intended only for advanced
    users and those interested in developing OpenBSD and advanced users. You must
    be comfortable reading and compiling source code, debugging problems, and restoring
    from backup before even trying to build OpenBSD from source. In OpenBSD’s earlier
    days, I found upgrading from source to be the easiest way to move forward, but
    now upgrading via snapshot is much easier and much less error-prone. If there’s
    any way you can use an official binary release to install what you’re looking
    for, do so.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 从 OpenBSD 的源代码构建自己的升级仅适用于高级用户和对开发 OpenBSD 以及高级用户感兴趣的人。您必须能够舒适地阅读和编译源代码，调试问题，并在尝试从源代码构建
    OpenBSD 之前从备份中恢复。在 OpenBSD 的早期，我发现从源代码升级是最简单的前进方式，但现在通过快照升级要容易得多，且错误更少。如果可能，您可以使用官方的二进制发布版来安装您所寻找的内容，请这样做。
- en: When you build OpenBSD from source, you are building the distribution sets that
    you installed via FTP or CD. The files might not be bundled up in distributions,
    but their contents will be the same. You still must merge your configuration files
    with `sysmerge`, and you will still need to update your installed software. The
    only thing building OpenBSD gets you is the latest version of the branch you’re
    following.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 当您从源代码构建 OpenBSD 时，您正在构建通过 FTP 或 CD 安装的分发集。文件可能没有捆绑成分发版，但它们的 内容将是相同的。您仍然必须使用
    `sysmerge` 合并您的配置文件，并且您仍然需要更新您已安装的软件。构建 OpenBSD 唯一能给您带来的就是您所跟踪的分支的最新版本。
- en: 'I know of three reasons to build your own OpenBSD from source: to get OpenBSD-stable,
    to get the latest OpenBSD-current, or to highly customize OpenBSD. OpenBSD-stable
    is available only as source code. No official installation media is available
    for -stable, so if you want to go from 5.4-release to 5.4-stable, you must build
    it from source. If you want the absolutely latest OpenBSD code—newer than the
    latest snapshot—you must build it. And if you want to highly customize OpenBSD,
    you must build it from source.'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 我知道有三个原因要从源代码构建自己的 OpenBSD：为了获得 OpenBSD-stable，为了获得最新的 OpenBSD-current，或者为了高度定制
    OpenBSD。OpenBSD-stable 只提供源代码。没有官方的安装介质可用于 -stable，因此如果您想从 5.4-release 升级到 5.4-stable，您必须从源代码构建它。如果您想要绝对最新的
    OpenBSD 代码——比最新的快照更新的代码——您必须构建它。如果您想高度定制 OpenBSD，您也必须从源代码构建它。
- en: Preparations for Building Your Own OpenBSD
  id: totrans-185
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 构建自己的 OpenBSD 的准备工作
- en: Building OpenBSD takes up about 4GB of disk, 2GB in */usr/src* and 2GB in */usr/obj*.
    OpenBSD creates these directories as separate partitions by default, but if you
    designed your own disk-partition scheme, make sure you have enough space.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 构建 OpenBSD 需要大约 4GB 的磁盘空间，其中 2GB 在 */usr/src* 中，2GB 在 */usr/obj* 中。OpenBSD 默认将这些目录作为单独的分区创建，但如果您设计了您自己的磁盘分区方案，请确保您有足够的空间。
- en: You must build on your target platform. Don’t try to cross-compile by, for example,
    building VAX binaries on an amd64 box. OpenBSD developers use cross-compiling
    to bring up a new hardware platform, but once the platform is up and running,
    all development happens on the native hardware. Code produced by cross-compiling
    might not be identical to code produced by the compiler running on the native
    platform.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 您必须在您的目标平台上构建。不要尝试通过，例如，在 amd64 硬件上构建 VAX 二进制文件来进行交叉编译。OpenBSD 开发者使用交叉编译来启动新的硬件平台，但一旦平台启动并运行，所有开发都在本地硬件上进行。通过交叉编译产生的代码可能与在本地平台上运行的编译器产生的代码不完全相同。
- en: Preparing the Base Operating System
  id: totrans-188
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 准备基础操作系统
- en: Your first step is to prepare the base operating system. You can build OpenBSD
    on only an OpenBSD installation similar to what you’re trying to build, which
    means you need to install the closest binary set to your target platform on your
    build machine. If you’re trying to build OpenBSD 5.4-stable, start by installing
    5.4-release on your build machine. If you’re trying to build the latest OpenBSD-current,
    upgrade your build machine to the newest snapshot first.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 你的第一步是准备基础操作系统。你只能在类似于你试图构建的OpenBSD安装上构建OpenBSD，这意味着你需要在你构建机器上安装最接近你的目标平台的二进制集。如果你试图构建OpenBSD
    5.4-stable，首先在你的构建机器上安装5.4-release。如果你试图构建最新的OpenBSD-current，首先升级你的构建机器到最新的快照。
- en: Why start from the closest available binary release? For one, that’s how the
    OpenBSD developers do it; the code is meant to be built from a very recent OpenBSD.
    Although the system changes only slowly, those changes can add up. OpenBSD-stable
    is built only on the OpenBSD release it’s based on, or on a -stable release following
    that base release.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 为什么从最近的二进制发布版开始呢？首先，这是OpenBSD开发者所做的方式；代码旨在从非常近期的OpenBSD构建。尽管系统变化缓慢，但这些变化可以累积。OpenBSD-stable仅基于其基于的OpenBSD发布版构建，或者基于该基础发布版之后的-stable发布版。
- en: Also, OpenBSD-current occasionally has “flag days,” where a critical system
    change makes building the source code difficult. These might be compiler or linker
    upgrades, library or kernel changes, or just about anything else. While the OpenBSD
    team documents what you need to do to get over these humps, those documents are
    more like notes for people who know what they’re doing than user-friendly instructions.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，OpenBSD-current偶尔会有“标志日”，其中关键系统变化使得构建源代码变得困难。这些可能包括编译器或链接器升级、库或内核更改，或者几乎任何其他事情。虽然OpenBSD团队记录了你需要做什么来克服这些障碍，但这些文档更像是对那些知道自己在做什么的人的笔记，而不是用户友好的说明。
- en: These flag days are announced on the OpenBSD mailing lists. You can try to follow
    those notes and build OpenBSD over these barriers, but when you get sick of beating
    your head against a flag-day change, upgrade to a snapshot to get over the hump.
    (Many OpenBSD developers also use snapshots to get over flag-day changes; inability
    to compile OpenBSD through a flag day is not a threat to your manhood or womanhood.)
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 这些标志日会在OpenBSD邮件列表上宣布。你可以尝试遵循这些笔记并在这些障碍上构建OpenBSD，但当你厌倦了与标志日更改对抗时，升级到快照以克服这些障碍。（许多OpenBSD开发者也使用快照来克服标志日更改；无法通过标志日编译OpenBSD并不是对你男性或女性身份的威胁。）
- en: Getting Source Code
  id: totrans-193
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 获取源代码
- en: Now get the OpenBSD source code. If you have already installed these files,
    and you need to upgrade to a more recent version, see [Updating Source Code](ch20.html#updating_source_code
    "Updating Source Code").
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 现在获取OpenBSD源代码。如果你已经安装了这些文件，并且需要升级到更近的版本，请参阅[更新源代码](ch20.html#updating_source_code
    "Updating Source Code")。
- en: 'For those installing the source code for the first time, the OpenBSD project
    provides recent code snapshots in four compressed tar files: the userland (*src.tar.gz*),
    kernel (*sys.tar.gz*), X Windows (*xenocara.tar.gz*), and ports (*ports.tar.gz*).
    All must be kept synchronized, which means that you cannot use a -current ports
    tree atop a -stable userland and kernel. Get the file that’s closest to what you
    want to build.'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 对于第一次安装源代码的人来说，OpenBSD项目提供了四个压缩tar文件中的最近代码快照：用户空间(*src.tar.gz*)、内核(*sys.tar.gz*)、X
    Windows(*xenocara.tar.gz*)和ports(*ports.tar.gz*)。所有这些都必须保持同步，这意味着你不能在-stable用户空间和内核之上使用-current
    ports树。获取最接近你想要构建的文件的版本。
- en: If you’re building -stable, you can grab all four files from the release directory
    of the binary you installed. For example, if you’re building OpenBSD 5.4-stable,
    you’ll find *src.tar.gz*, *sys.tar.gz*, *xenocara.tar.gz*, and *ports.tar.gz*
    on your CD or on an OpenBSD mirror under */pub/OpenBSD/5.4/*.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你正在构建-stable，你可以从你安装的二进制文件的发布目录中获取所有四个文件。例如，如果你正在构建OpenBSD 5.4-stable，你将在你的CD上或在OpenBSD镜像下的*/pub/OpenBSD/5.4/*中找到*src.tar.gz*、*sys.tar.gz*、*xenocara.tar.gz*和*ports.tar.gz*。
- en: If you’re building -current, you’re better off starting with a newer snapshot
    of the source code. On the OpenBSD mirror sites, under */pub/OpenBSD*, you’ll
    find recent copies of *src.tar.gz* and *sys.tar.gz*. Grab the most recent ones
    of those. You still need the *xenocara.tar.gz* and *ports.tar.gz* files from the
    most recent OpenBSD release, as those files are not updated as frequently.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你正在构建-current，你最好从源代码的新快照开始。在OpenBSD镜像站点上，在*/pub/OpenBSD*目录下，你可以找到*src.tar.gz*和*sys.tar.gz*的最近副本。获取这些中最新的。你仍然需要从最近的OpenBSD发布版中获取*xenocara.tar.gz*和*ports.tar.gz*文件，因为这些文件更新频率不高。
- en: 'Verify that the directories */usr/src*, */usr/obj*, */usr/xenocara*, */usr/xobj*,
    and */usr/ports* are empty. Then extract *src.tar.gz* and *sys.tar.gz* under */usr/src*,
    and Xenocara and *ports* directly under */usr*. Here, I’ve copied all the tarballs
    to my home directory:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 确认目录 */usr/src*、*/usr/obj*、*/usr/xenocara*、*/usr/xobj* 和 */usr/ports* 是空的。然后在
    */usr/src* 下提取 *src.tar.gz* 和 *sys.tar.gz*，在 */usr* 下直接提取 Xenocara 和 *ports*。在这里，我已经将所有的
    tarball 复制到了我的家目录中：
- en: '[PRE26]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: This gives you a known good base to start from. If you’re looking to build your
    own OpenBSD, you probably don’t want to build a version that’s available for installation
    now; you want to build a version that’s not available for installation. This means
    you want to update the source code to either -current or -stable.
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 这为你提供了一个已知良好的基础来开始。如果你想要构建自己的 OpenBSD，你可能不想构建一个现在可以安装的版本；你想要构建一个现在不可安装的版本。这意味着你想要将源代码更新到
    -current 或 -stable。
- en: Updating Source Code
  id: totrans-201
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 更新源代码
- en: OpenBSD uses Concurrent Versions System (CVS) for source code management. CVS
    is an older, somewhat traditional version control system. While many projects
    have moved from CVS to newer, shinier, and perhaps more glamorous systems, CVS
    meets the OpenBSD Project’s needs.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD 使用并发版本系统 (CVS) 进行源代码管理。CVS 是一个较老、有些传统的版本控制系统。虽然许多项目已经从 CVS 转移到更新、更亮、可能更迷人的系统，但
    CVS 满足了 OpenBSD 项目的需求。
- en: 'OpenBSD has a single central source-code repository: the master CVS server.
    Only developers and mirror sites have access to this server. When a developer
    wants to make new OpenBSD code available, he *commits* the changes to this central
    repository, and other developers can see his changes at this point.'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD 有一个单一的中央源代码仓库：主 CVS 服务器。只有开发者和镜像站点可以访问这个服务器。当开发者想要将新的 OpenBSD 代码提供给公众时，他会将更改
    *提交* 到这个中央仓库，其他开发者可以在此时看到他的更改。
- en: The master CVS server tracks all changes ever made to the OpenBSD source, as
    well as who made those changes. Mirror sites capture these changes and make them
    available to the users in a matter of hours. As a user, you can use CVS to update
    your local source code to the latest version from a mirror site.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 主 CVS 服务器跟踪了 OpenBSD 源代码的所有更改，以及谁进行了这些更改。镜像站点捕获这些更改，并在数小时内将这些更改提供给用户。作为用户，你可以使用
    CVS 将你的本地源代码更新到镜像站点上的最新版本。
- en: Source Code Repositories and Tags
  id: totrans-205
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 源代码仓库和标签
- en: OpenBSD’s source code is divided into *repositories*, or collections of code
    for particular subsystems. You need to download and synchronize only the collections
    that you want to use.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD 的源代码被划分为 *仓库*，即特定子系统的代码集合。你需要下载和同步你想要使用的集合。
- en: 'The OpenBSD CVS repository includes four collections: `src` (userland and kernel
    source), `ports` (the ports collection), `xenocara` (X Windows), `www` (the website),
    and the obsolete `X11` and `XF4` X Windows collections. While X11 and XF4 are
    still kept for historical purposes, you should never need to use that code. The
    `www` repository is of interest to the website editors and contributors. In order
    to build a recent OpenBSD, you must update your `src`, `ports`, and `xenocara`
    collections to the latest versions of your chosen branch.'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD 的 CVS 仓库包括四个集合：`src`（用户空间和内核源代码）、`ports`（ports 集合）、`xenocara`（X Windows）、`www`（网站）以及过时的
    `X11` 和 `XF4` X Windows 集合。虽然 X11 和 XF4 仍然保留以供历史参考，但你永远不需要使用那段代码。`www` 仓库对网站编辑者和贡献者感兴趣。为了构建一个最新的
    OpenBSD，你必须将你的 `src`、`ports` 和 `xenocara` 集合更新到你选择的分支的最新版本。
- en: A *tag* is a label for a particular version of a repository. OpenBSD uses tags
    to differentiate between -stable, -release, and -current. For example, the source
    code of every single OpenBSD release ever made includes the file */usr/src/etc/master.passwd*.
    But the version of *master.passwd* shipped with OpenBSD 2.0 differs wildly from
    that shipped with OpenBSD 5.3! CVS uses tags to differentiate the various versions
    of this and every other file. By using tags, you can ask CVS for the version of
    any file that shipped with any OpenBSD release.
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: '*标签* 是为仓库的特定版本指定的标签。OpenBSD 使用标签来区分 -stable、-release 和 -current。例如，OpenBSD
    所有的发布版本中的源代码都包含文件 */usr/src/etc/master.passwd*。但是，与 OpenBSD 2.0 一起提供的 *master.passwd*
    版本与 OpenBSD 5.3 一起提供的版本差异极大！CVS 使用标签来区分这个文件以及每个其他文件的各个版本。通过使用标签，你可以要求 CVS 提供任何
    OpenBSD 发布版本中包含的任何文件的版本。'
- en: 'The tag for any -stable version of OpenBSD is the string `OPENBSD` and the
    version number, separated by underscores. For example, the tag for OpenBSD 5.4
    is `OpenBSD_5_4`. Note the two underscores: there is no `OPENBSD_54` or `OPENBSD5_4`.
    If you use a tag that does not exist, rather than updating your local source code
    files, you’ll delete them. (While you should download the source code for a release,
    rather than updating to it via CVS, an OpenBSD release appends the string `_BASE`
    to the tag, as in `OPENBSD-5_4_BASE`.) That said, OpenBSD-current is special in
    that it has no tag and it includes the latest version of all source code in all
    repositories.'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD 任何 -stable 版本的标签是 `OPENBSD` 和版本号，由下划线分隔的字符串。例如，OpenBSD 5.4 的标签是 `OpenBSD_5_4`。注意两个下划线：没有
    `OPENBSD_54` 或 `OPENBSD5_4`。如果你使用一个不存在的标签，而不是更新你的本地源代码文件，你将删除它们。（虽然你应该下载发布版本的源代码，而不是通过
    CVS 更新，但 OpenBSD 发布版本会在标签后附加字符串 `_BASE`，例如 `OPENBSD-5_4_BASE`。）话虽如此，OpenBSD-current
    是特殊的，因为它没有标签，并且它包含了所有仓库中所有源代码的最新版本。
- en: All of the repositories are designed to be updated synchronously. If, for example,
    you update the source code repository to -current and leave your ports and Xenocara
    at their -release or -stable versions, your system will behave unpredictably.
    As with learning to juggle chainsaws, you’re welcome to try it, but don’t whine.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 所有仓库都设计为同步更新。例如，如果你将源代码仓库更新到 -current，但将 ports 和 Xenocara 保持在其 -release 或 -stable
    版本，你的系统可能会表现出不可预测的行为。就像学习使用链锯表演杂耍一样，你可以尝试，但请不要抱怨。
- en: CVS Mirrors
  id: totrans-211
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: CVS 镜像
- en: You can use anonymous CVS to update your source code to the latest version.
    Start by choosing a convenient anonymous CVS server from the list at *[http://www.OpenBSD.org/anoncvs.html](http://www.OpenBSD.org/anoncvs.html)*.
    There are mirrors all over the world, but choose one on your continent for better
    performance. (I use *anoncvs13.usa.openbsd.org*^([[44](#ftn.id444809)]) in my
    examples.)
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用匿名 CVS 将你的源代码更新到最新版本。首先，从 *[http://www.OpenBSD.org/anoncvs.html](http://www.OpenBSD.org/anoncvs.html)*
    上的列表中选择一个方便的匿名 CVS 服务器。世界上有多个镜像，但请选择你所在大陆上的一个，以获得更好的性能。（在我的例子中，我使用 *anoncvs13.usa.openbsd.org*^([[44](#ftn.id444809)]))。
- en: Tracking OpenBSD-current is slightly different than tracking OpenBSD-stable.
    We’ll start with -stable, and then see how -current differs.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 跟踪 OpenBSD-current 与跟踪 OpenBSD-stable 略有不同。我们将从 -stable 开始，然后看看 -current 有何不同。
- en: Updating to -stable
  id: totrans-214
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 更新到 -stable
- en: The first time you update your source code, you must specify the anonymous CVS
    server on the command line.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 第一次更新源代码时，你必须指定命令行上的匿名 CVS 服务器。
- en: '[PRE27]'
  id: totrans-216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: CVS is very picky about the order of its command-line arguments, and many flags
    are position-dependent. Don’t change the order of arguments unless you know what
    you’re doing.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: CVS 对其命令行参数的顺序非常挑剔，许多标志是位置相关的。除非你知道自己在做什么，否则不要改变参数的顺序。
- en: 'Substitute your preferred server and the release tag you want to get into this
    command. For example, to update my OpenBSD 5.1 source tree to the latest stable
    version from *anoncvs13.openbsd.org*, I would run the following:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 将你偏好的服务器和想要获取的版本标签替换到这个命令中。例如，要将我的 OpenBSD 5.1 源代码树更新到来自 *anoncvs13.openbsd.org*
    的最新稳定版本，我会运行以下命令：
- en: '[PRE28]'
  id: totrans-219
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Because OpenBSD runs CVS over SSH the first time you run `cvs`, it asks you
    to verify the CVS mirror’s host key. Compare the **1** key fingerprint given by
    your client to the fingerprint listed on the CVS mirror list. If they match, you’re
    talking to the actual CVS server. If the fingerprints don’t match, something is
    wrong, which could be a problem at the server, a skipped website update, or an
    actual security problem at the mirror. If the key fingerprints don’t match, choose
    a different CVS mirror. (SSH will cache this key, and future updates won’t ask
    you to verify the key unless it changes.)
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 因为 OpenBSD 首次运行 `cvs` 时通过 SSH 运行 CVS，它会要求你验证 CVS 镜像的主机密钥。将你的客户端给出的 **1** 个密钥指纹与
    CVS 镜像列表上列出的指纹进行比较。如果它们匹配，你就正在与实际的 CVS 服务器通信。如果指纹不匹配，可能存在问题，可能是服务器的问题、跳过的网站更新，或者镜像的实际安全问题。如果密钥指纹不匹配，请选择不同的
    CVS 镜像。（SSH 会缓存这个密钥，未来的更新除非密钥更改，否则不会要求你验证密钥。）
- en: 'There’s a pause when CVS starts comparing the source code on your disk to the
    source code on the server, and just about when you think that something has gone
    wrong, you’ll probably see actual source code updates, like this:'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 当 CVS 开始比较你磁盘上的源代码与服务器上的源代码时，会有一个暂停，当你认为出了问题的时候，你可能会看到实际的源代码更新，如下所示：
- en: '[PRE29]'
  id: totrans-222
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: This is complete CVS update output for updating OpenBSD 5.1 release to -stable.
    In all, there were seven changes. When the OpenBSD guys say “minimal changes in
    -stable,” they mean it.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 这是更新 OpenBSD 5.1 版本到 -stable 的完整 CVS 更新输出。总共进行了七次更改。当 OpenBSD 的人说“-stable 中最小化更改”时，他们确实是这么说的。
- en: Repeat this for */usr/ports* and */usr/xenocara*.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 对 */usr/ports* 和 */usr/xenocara* 重复此操作。
- en: '[PRE30]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: A source tree records the last server updated from, and on subsequent updates,
    you can drop the server from the command line. The source tree also knows which
    repository within the server it’s supposed to update from, so you don’t need to
    specify it.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 源代码树记录了最后更新的服务器，在后续更新中，您可以从命令行中省略服务器。源代码树还知道它应该从服务器中的哪个存储库更新，因此您不需要指定它。
- en: '[PRE31]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Run this same command any time you want the latest -stable source code.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 每次您想要获取最新的 -stable 源代码时，请运行此相同命令。
- en: Updating to -current
  id: totrans-229
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 更新到 -current
- en: The process for updating your source code to -current is much the same as updating
    to -stable, but the command line differs slightly. The first time you update your
    source tree, you must specify the server name.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 将您的源代码更新到 -current 的过程与更新到 -stable 类似，但命令行略有不同。第一次更新源代码树时，您必须指定服务器名称。
- en: '[PRE32]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'This `cvs` command gives you the latest -current source code. For example,
    if I want to update my source code from *anoncvs13.openbsd.org*, I run this:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 此 `cvs` 命令为您提供最新的 -current 源代码。例如，如果我想从 *anoncvs13.openbsd.org* 更新我的源代码，我会运行这个命令：
- en: '[PRE33]'
  id: totrans-233
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: You should get the SSH key fingerprint verification message, and see the same
    type of messages that you would get updating to -stable.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该收到 SSH 密钥指纹验证消息，并看到与更新到 -stable 时相同的类型消息。
- en: 'The first time you run CVS to update a specific set of source code, `cvs` records
    which server the source code came from. For subsequent updates to the latest -current
    source code, you can skip the server name and shorten the command, as follows:'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 第一次运行 CVS 更新特定源代码集时，`cvs` 会记录源代码来自哪个服务器。对于后续更新到最新 -current 源代码，您可以省略服务器名称并缩短命令，如下所示：
- en: '[PRE34]'
  id: totrans-236
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: Now you need to build the new source code into program code.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您需要将新源代码构建成程序代码。
- en: You build -stable and -current in the same way, but -current has more potential
    issues, so we’ll start by building -stable.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 您以相同的方式构建 -stable 和 -current，但 -current 有更多潜在问题，因此我们将首先构建 -stable。
- en: Building OpenBSD-stable
  id: totrans-239
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 构建 OpenBSD-stable
- en: Building OpenBSD-stable requires building and installing a new kernel, building
    and installing a new userland, and building and installing the new Xenocara.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 构建 OpenBSD-stable 需要构建和安装新的内核，构建和安装新的用户空间，以及构建和安装新的 Xenocara。
- en: Upgrading the Kernel
  id: totrans-241
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 升级内核
- en: 'Building an upgraded kernel is like building a custom kernel, as discussed
    in [Chapter 19](ch19.html "Chapter 19. Building Custom Kernels"). Basically, the
    process boils down to this:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 构建升级内核就像构建自定义内核，如第 19 章（ch19.html "第 19 章。构建自定义内核"）中所述。基本上，这个过程归结为以下几点：
- en: '[PRE35]'
  id: totrans-243
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: (If I planned to build OpenBSD regularly on this machine, I would script this.)
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: （如果我在这台机器上定期构建 OpenBSD，我会编写脚本。）
- en: Note
  id: totrans-245
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '[Chapter 19](ch19.html "Chapter 19. Building Custom Kernels") is full of warnings
    about difficulties compiling a custom kernel. These don’t apply to building the
    *GENERIC* kernel on -stable. Remember that -stable includes only security fixes
    and obviously correct small changes. ABI, API, configuration, and syntax changes
    are absolutely forbidden. If this kernel build fails, you probably corrupted your
    source tree somehow. Remove everything in */usr/src* and start over.'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: '[第 19 章](ch19.html "第 19 章。构建自定义内核") 中充满了关于编译自定义内核困难的警告。这些警告不适用于在 -stable 上构建
    *GENERIC* 内核。请记住，-stable 仅包含安全修复和显然正确的小改动。ABI、API、配置和语法更改绝对禁止。如果此内核构建失败，您可能以某种方式损坏了源代码树。请从
    */usr/src* 中删除所有内容并重新开始。'
- en: After building and installing the new kernel, reboot. You must run the new kernel
    to build the new userland.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 在构建和安装新内核后，重新启动。您必须运行新内核来构建新的用户空间。
- en: Building the Userland
  id: totrans-248
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 构建用户空间
- en: To build and install everything outside the kernel, remove any old builds and
    re-create the object directories. Also, make sure that the installed OpenBSD system
    has all of the necessary directories. Skipping this step will make the build fail
    and corrupt your source tree.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 要构建和安装内核外的所有内容，请删除任何旧构建并重新创建对象目录。同时，确保已安装的 OpenBSD 系统具有所有必要的目录。跳过此步骤将导致构建失败并损坏您的源代码树。
- en: '[PRE36]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: Now you can build and install the userland.
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，您可以构建和安装用户空间。
- en: '[PRE37]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: Building userland can take several days on an antique system, but should take
    only an hour or two on more modern hardware. When the process finishes, you should
    have the new userland installed on the local system.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 在旧式系统上构建用户空间可能需要几天时间，但在更现代的硬件上只需一两个小时。当过程完成后，您应该在本地系统上安装了新的用户空间。
- en: Note
  id: totrans-254
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Installing -stable simplifies the userland part of the upgrade. There’s no need
    to merge any new */etc/* files with `sysmerge` (but there’s no harm in running
    `sysmerge` either, just to check that your configuration is indeed valid), or
    to re-create your device nodes, as they won’t change. OpenBSD-stable contains
    very minor changes from the release on which it’s based.
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 -stable 简化了升级的用户空间部分。无需使用 `sysmerge` 合并任何新的 */etc/* 文件（但运行 `sysmerge` 也没有害处，只是为了检查您的配置确实有效），也不需要重新创建您的设备节点，因为它们不会改变。OpenBSD-stable
    包含了基于其发布的非常小的更改。
- en: Building Xenocara
  id: totrans-256
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 构建 Xenocara
- en: The X Window System might or might not change during -stable. If your CVS update
    shows no changes in -stable, you don’t need to rebuild it, but if any of the files
    in */usr/xenocara* have changed, you’re better off rebuilding X. The build process
    is completely routine for Xenocara-stable.
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: X Window 系统在 -stable 期间可能会改变，也可能不会改变。如果您的 CVS 更新显示 -stable 中没有变化，您不需要重新构建它，但如果
    */usr/xenocara* 中的任何文件已更改，您最好重新构建 X。对于 Xenocara-stable，构建过程完全是常规的。
- en: '[PRE38]'
  id: totrans-258
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: This builds and installs the new X on your system.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 这将在您的系统上构建和安装新的 X。
- en: Building a Release
  id: totrans-260
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 构建 Release
- en: This is all very nice if you want to upgrade only one machine. But what if you
    have several machines to upgrade to your custom OpenBSD build? You don’t want
    to go building -stable on your firewalls or your web server.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: '如果您只想升级一台机器，这一切都很不错。但如果您有多个机器要升级到您定制的 OpenBSD 构建，怎么办呢？您不想在防火墙或您的 Web 服务器上构建
    -stable。 '
- en: If you need to upgrade multiple machines, build your OpenBSD on one machine,
    and install that build on multiple machines by building your own *release*. This
    will take less time than you needed to build your upgrade and use under a gigabyte
    of disk space.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您需要升级多台机器，请在单台机器上构建您的 OpenBSD，并通过构建自己的 *release* 在多台机器上安装该构建。这将比您构建升级并使用所需的磁盘空间少得多。
- en: A release is what the OpenBSD Project puts on the mirror sites for you to install.
    It’s a few kernels, tarballs containing the userland files, the index file, and
    so on. Using these files, you can upgrade your other hosts just as you would perform
    the official media upgrade discussed earlier this chapter. Building a release
    is the easiest way to upgrade several OpenBSD hosts to identical versions.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 发布是 OpenBSD 项目放在镜像站点上供您安装的内容。它包含几个内核、包含用户空间文件的 tarball、索引文件等。使用这些文件，您可以像本章前面讨论的官方媒体升级一样升级您的其他主机。构建发布是升级多个
    OpenBSD 主机到相同版本的最简单方法。
- en: Before you can build a release, you must build both the base OpenBSD system
    and Xenocara. You could skip Xenocara if you don’t want any X on any of your hosts,
    but a surprising number of third-party programs need the X libraries. It’s easier
    to build X and not install it on selected hosts than to go back and rebuild the
    whole release because you didn’t build Xenocara the first time.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 在您构建 release 之前，您必须构建基础 OpenBSD 系统和 Xenocara。如果您不想在任何主机上安装任何 X，则可以跳过 Xenocara，但许多第三方程序需要
    X 库。构建 X 而不安装到选定的主机上比因为第一次没有构建 Xenocara 而重新构建整个 release 要容易得多。
- en: The release process installs OpenBSD in a temporary root directory and then
    bundles that installation into the release tarballs and related files. Next, it
    repeats the process with the X software. It assumes that you have the OpenBSD
    source code in */usr/src* and a completed build in */usr/obj*, as well as the
    Xenocara source in */usr/xenocara* and a completed build in */usr/xobj*. You can
    change the build process to get around these requirements, as documented in `release(8)`,
    but you should accept the defaults.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 发布过程在临时根目录中安装 OpenBSD，然后将该安装捆绑到发布 tarball 和相关文件中。接下来，它使用 X 软件重复此过程。它假设您在 */usr/src*
    中有 OpenBSD 源代码，在 */usr/obj* 中有一个完成的构建，以及 */usr/xenocara* 中的 Xenocara 源代码和 */usr/xobj*
    中的完成构建。您可以根据 `release(8)` 中的文档更改构建过程以绕过这些要求，但您应该接受默认设置。
- en: 'You’ll need to define three directories: one to store your release, one for
    your temporary OpenBSD root directory, and one for your temporary Xenocara root
    directory. You can reuse the temporary root directories, but I keep them for reference.
    I use */home/releasedir* as my release directory, */home/destdir* as my temporary
    OpenBSD root, and */home/xdestdir* as the Xenocara temporary root.'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要定义三个目录：一个用于存储您的发布版本，一个用于您的临时 OpenBSD 根目录，另一个用于您的临时 Xenocara 根目录。您可以重复使用临时根目录，但我保留它们以供参考。我使用
    */home/releasedir* 作为我的发布目录，*/home/destdir* 作为我的临时 OpenBSD 根目录，以及 */home/xdestdir*
    作为 Xenocara 的临时根目录。
- en: Warning
  id: totrans-267
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 警告
- en: You can use any partition with sufficient free space, except for */mnt* because
    the release process uses this partition. Similarly, building a release builds
    ISO and floppy images using the first `vnode` device, */dev/vnd0*. If you have
    any disk images mounted using that device (see [Chapter 9](ch09.html "Chapter 9. More
    Filesystems")), the release process will fail. If you must mount a disk image
    while building a release, use a `vnode` device other than */dev/vnd0*.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用任何有足够空闲空间的分区，除了 */mnt*，因为发布过程使用这个分区。同样，构建发布版本会使用第一个 `vnode` 设备，*/dev/vnd0*，来构建
    ISO 和软盘镜像。如果您使用该设备挂载了任何磁盘镜像（见[第 9 章](ch09.html "第 9 章。更多文件系统")），发布过程将失败。如果您在构建发布版本时必须挂载磁盘镜像，请使用除
    */dev/vnd0* 之外的其他 `vnode` 设备。
- en: 'The release process has three steps: bundling the base system, bundling Xenocara,
    and indexing the results.'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 发布过程有三个步骤：打包基础系统、打包 Xenocara 和索引结果。
- en: Bundling the Base System
  id: totrans-270
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 打包基础系统
- en: OpenBSD’s build system includes all of the glue that you need to build a release.
    First, do a `make build` of your new OpenBSD so that you’re running the same version
    you want to build a release for. Next, define the temporary OpenBSD root and the
    release directory in your environment as `$DESTDIR` and `$RELEASEDIR`, respectively.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD 的构建系统包括构建发布版本所需的所有粘合剂。首先，执行 `make build` 以运行您的新 OpenBSD，确保您正在运行您想要构建发布版本的相同版本。接下来，在您的环境中分别定义临时
    OpenBSD 根目录和发布目录为 `$DESTDIR` 和 `$RELEASEDIR`。
- en: Note
  id: totrans-272
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Verify that the temporary OpenBSD root and the release directories are empty
    before you start. While the release process can overwrite files from an old build,
    the directories might have obsolete files that you don’t want included in the
    new release.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 在您开始之前，请确保临时 OpenBSD 根目录和发布目录为空。虽然发布过程可以覆盖旧构建的文件，但目录可能包含您不希望包含在新发布中的过时文件。
- en: '[PRE39]'
  id: totrans-274
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: Once you have this ready, building the release involves only a few commands.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦准备好，构建发布版本只需要几个命令。
- en: '[PRE40]'
  id: totrans-276
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Take a look in your release directory. You should see the following items:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 查看您的发布目录。您应该看到以下项目：
- en: Three kernels (*bsd*, *bsd.mp*, and *bsd.rd*)
  id: totrans-278
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 三个内核（*bsd*、*bsd.mp* 和 *bsd.rd*）
- en: Three floppy boot images if you’re building for i386, or one if it’s for amd64
    (other architectures vary)
  id: totrans-279
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果您为 i386 构建则需要三个软盘引导镜像，如果是为 amd64 构建则只需要一个（其他架构有所不同）。
- en: Two ISO images
  id: totrans-280
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 两个 ISO 镜像
- en: Five file sets for the OpenBSD base system
  id: totrans-281
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 五个 OpenBSD 基础系统的文件集
- en: These files are functionally identical to those distributed by the OpenBSD project,
    except they’re based on your custom build.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 这些文件在功能上与 OpenBSD 项目分发的文件相同，但它们基于您的自定义构建。
- en: Once you’ve finished building releases, be sure to remove the `$RELEASEDIR`
    and `$DESTDIR` variables from your environment because they can mess up other
    software builds. You can’t successfully build Xenocara with them still set.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您完成构建发布版本，请务必从您的环境中删除 `$RELEASEDIR` 和 `$DESTDIR` 变量，因为它们可能会破坏其他软件的构建。如果您仍然设置这些变量，则无法成功构建
    Xenocara。
- en: Bundling Xenocara
  id: totrans-284
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 打包 Xenocara
- en: As with bundling the base system, you must first complete a Xenocara build.
    Confirm that your system has the same version of Xenocara installed that you want
    included in your release, and then set the `RELEASEDIR` and `DESTDIR` environment
    variables. `RELEASEDIR` should be identical to that used to bundle the base system,
    but `DESTDIR` should differ.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 与打包基础系统一样，您必须首先完成 Xenocara 的构建。确认您的系统已安装与您想要包含在发布版本中的相同版本的 Xenocara，然后设置 `RELEASEDIR`
    和 `DESTDIR` 环境变量。`RELEASEDIR` 应与用于打包基础系统的目录相同，但 `DESTDIR` 应该不同。
- en: Note
  id: totrans-286
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: You could reuse `DESTDIR`, but that will erase everything from your temporary
    base system installation. Leave those files around until you’re sure you have
    a solid release.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以重复使用 `DESTDIR`，但这将擦除您的临时基础系统安装中的所有内容。保留这些文件，直到您确信您有一个稳定的发布版本。
- en: '[PRE41]'
  id: totrans-288
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: Now go into the Xenocara source and bundle the release.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，进入 Xenocara 源代码并打包发布版本。
- en: '[PRE42]'
  id: totrans-290
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: Xenocara isn’t much smaller than the base system. It takes a while to bundle
    up, so this is a good time to go to lunch. When you get back, you should find
    five new files in your release directory, all tarballs beginning with *x*.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: Xenocara 并不比基本系统小多少。捆绑需要一段时间，所以这是一个去吃午饭的好时机。当你回来时，你应该在你的发布版目录中找到五个新文件，所有以 *x*
    开头的 tarball。
- en: Before you quit for the day, remove `RELEASEDIR` and `DESTDIR` from your environment.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 在你一天结束时，从你的环境中删除 `RELEASEDIR` 和 `DESTDIR`。
- en: Indexing the Release
  id: totrans-293
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 发布版的索引
- en: Copy your release to your local FTP or web server, and create an index of the
    contents. (Only HTTP installs and upgrades need an index file.) The OpenBSD installer
    and upgrade software will use this index during the installation.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 将你的发布版复制到你的本地 FTP 或网页服务器上，并创建内容索引。（只有 HTTP 安装和升级需要索引文件。）OpenBSD 安装程序和升级软件将在安装期间使用此索引。
- en: '[PRE43]'
  id: totrans-295
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: Make the web or FTP site accessible from the machines you want to upgrade.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 使你想要升级的机器可以访问网页或 FTP 站点。
- en: Using the Release
  id: totrans-297
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用发布版
- en: Upgrade or install using this release just as you would use an official release.
    Copy *bsd.rd* to a machine to be upgraded, and then boot into that kernel. When
    the installer asks where to get the file sets, give the location of your release.
    Extract and reboot!
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此发布版升级或安装，就像使用官方发布版一样。将 *bsd.rd* 复制到要升级的机器上，然后引导到该内核。当安装程序询问文件集的位置时，给出你发布版的位置。提取并重新引导！
- en: Building OpenBSD-current
  id: totrans-299
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 构建 OpenBSD-current
- en: Building OpenBSD-current is exactly like building -stable, except when it isn’t.
    OpenBSD-current can change wildly, and building it from source is considered an
    advanced activity. The only time I actually build -current is if I need to test
    some new functionality or a patch offered by an OpenBSD developer.
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 构建 OpenBSD-current 与构建 -stable 几乎相同，除非它不是。OpenBSD-current 可能会剧烈变化，从源代码构建它被认为是一项高级活动。我实际上构建
    -current 的唯一时间是如果需要测试一些 OpenBSD 开发者提供的新功能或补丁。
- en: The two big problems are the radical changes in -current and merging */etc*.
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 两个主要问题是 -current 中的激进变化和合并 */etc*。
- en: Following -current
  id: totrans-302
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 跟踪 -current
- en: When you follow -current, keep a close eye on OpenBSD’s changes by tracking
    the Following -current web page at *http://www.OpenBSD.org/faq/current.html*.
    This is where the OpenBSD developers list all of the changes likely to impact
    people trying to build -current. Not all changes apply to all systems, but any
    change listed that applies to your system requires special handling.
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 当你跟踪 -current 时，请密切关注 OpenBSD 的变化，通过访问 *http://www.OpenBSD.org/faq/current.html*
    上的 Following -current 网页。这是 OpenBSD 开发者列出所有可能影响尝试构建 -current 的人的变化的地方。并非所有变化都适用于所有系统，但任何列出的适用于你系统的变化都需要特殊处理。
- en: The entries are chronological, and include everything since the last release.
    Just concern yourself with entries dated on or after the date of the source code
    used to build your snapshot. For example, if you built a snapshot dated January
    30, and you want to build -current on the following February 5, check the web
    page for any entries between those two dates, inclusive. Earlier changes are already
    incorporated in the installed snapshot.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 条目是按时间顺序排列的，包括自上次发布以来的所有内容。只需关注日期在或晚于你用来构建快照的源代码日期的条目。例如，如果你构建了一个1月30日的快照，而你想在接下来的2月5日构建
    -current，检查这两个日期之间的网页上的任何条目，包括这两个日期。较早的变化已经包含在安装的快照中。
- en: Some changes will require your intervention before you even try to build the
    system. For example, if you have new unprivileged usernames, they will need to
    be in place before a `make build` can succeed—after all, a program owned by user
    `_fdisk` can’t be installed unless that user is in place.
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 一些变化在你尝试构建系统之前就需要你的干预。例如，如果你有新的非特权用户名，它们在 `make build` 成功之前必须就位——毕竟，由用户 `_fdisk`
    拥有的程序除非该用户就位否则无法安装。
- en: If you don’t understand an entry on this page, do not upgrade!
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你不懂这个页面上的某个条目，请不要升级！
- en: Merging /etc
  id: totrans-307
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 合并 /etc
- en: When you upgrade to a new -stable, you can be sure that the files in */etc/*
    haven’t changed. When you track -current, those critical system files might well
    change. Any critical changes are usually noted in the Following -current website,
    but it’s best to use `sysmerge(8)` to merge in all */etc* changes. You can give
    `sysmerge` the path to the system source instead of the *etc.tgz* file set.
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 当你升级到新的 -stable 时，你可以确信 */etc/* 中的文件没有变化。当你跟踪 -current 时，那些关键系统文件可能会发生变化。任何关键变化通常都会在
    Following -current 网站上注明，但最好使用 `sysmerge(8)` 合并所有 */etc* 的变化。你可以给 `sysmerge` 提供系统源路径而不是
    *etc.tgz* 文件集。
- en: '[PRE44]'
  id: totrans-309
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: See the section about `sysmerge` earlier in this chapter for detailed information.
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 有关`sysmerge`的详细信息，请参阅本章前面的相关部分。
- en: Upgrading Ports
  id: totrans-311
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 升级Ports
- en: If you use OpenBSD-provided packages, upgrading your system is as easy as running
    `pkg_add -ui`. If you built your third-party packages from source using the ports
    collection, however, there’s no easy way to upgrade. You must rebuild those packages.
    There is no automated way to do this, but the `make update` command in a port
    can rebuild a specific port.
  id: totrans-312
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用OpenBSD提供的软件包，升级系统就像运行`pkg_add -ui`一样简单。然而，如果你使用ports集合从源代码构建第三方软件包，那么升级就没有那么简单了。你必须重新构建这些软件包。没有自动化的方法来做这件事，但ports中的`make
    update`命令可以重新构建特定的ports。
- en: Presumably, you built your own packages because the OpenBSD-provided packages
    lacked some option or flavor you needed. In that case, you probably only needed
    to build one or two packages from source. All of the software required by that
    package could be installed from official OpenBSD sources. You should upgrade everything
    possible via packages and rebuild only what is strictly necessary.
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 很可能，你构建了自己的软件包，因为OpenBSD提供的软件包缺少了你需要的某些选项或版本。在这种情况下，你可能只需要从源代码构建一到两个软件包。该软件包所需的所有软件都可以从官方OpenBSD源安装。你应该通过软件包升级尽可能多的内容，并且只重新构建绝对必要的部分。
- en: Now that you can upgrade OpenBSD any way you want, let’s look at OpenBSD’s packet
    filter.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你可以用任何方式升级OpenBSD，让我们来看看OpenBSD的包过滤功能。
- en: '* * *'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[42](#id310014)]) Henning Brauer tells me that many upgrade failures aren’t
    really unpredictable; they’re merely “unsupported and untested” code paths. To
    most of us, that’s “unpredictable,” but you’re welcome to predict them yourself.
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[42](#id310014)]) Henning Brauer告诉我，许多升级失败并不是真的不可预测；它们只是“不受支持和未经测试”的代码路径。对我们大多数人来说，这就像是“不可预测”的，但你可以自己预测它们。
- en: ^([[43](#id427066)]) I know, I know, your shell is superior to mine. I was given
    tcsh as my first shell almost 30 years ago, and my fingers are too habituated
    to it to change. I’ll concede your superiority if you’ll stop telling me about
    it.
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[43](#id427066)]) 我知道，我知道，你的shell比我高级。我大约30年前就被分配了tcsh作为我的第一个shell，我的手指已经习惯了它，无法改变。如果你停止告诉我这一点，我会承认你的优越性。
- en: ^([[44](#id444809)]) Again, there is no *anoncvs13.usa.openbsd.org*. Find a
    server close to you. Stop blindly copying my examples. It’s like you think I know
    what I’m doing or something!
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[44](#id444809)]) 再次强调，没有*anoncvs13.usa.openbsd.org*。找一个离你近的服务器。别盲目地复制我的例子。好像你认为我知道自己在做什么似的！
