- en: Chapter 26\. PURE - FTPD SERVER 1.0.21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[HTTP://WWW.PUREFTPD.ORG](HTTP://WWW.PUREFTPD.ORG)'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 26.1\. SUMMARY
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: FTP (File Transfer Protocol) is used for transferring files between a server
    and a client system. According to RFC 959,^([[]](#CHP-26-1)) the four objectives
    of FTP are to promote the sharing of files, encourage use of remote computers,
    shield users from variations in file storage systems, and transfer data reliably
    and efficiently.
  prefs: []
  type: TYPE_NORMAL
- en: ^([]) J. Postel and J. Reynolds, "File Transfer Protocol (FTP)," Internet Engineering
    Task Force, [http://www.ietf.org/rfc/rfc959.txt](http://www.ietf.org/rfc/rfc959.txt).
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: FTP was first developed in 1971 by the US Department of Defense for use in its
    network at DARPA. It is regarded as one of the Internet's first protocols.
  prefs: []
  type: TYPE_NORMAL
- en: Pure-FTPd is an open source FTP server that conforms to the original FTP standards
    with some additional functionality. These include a virtual user system, SSL/TLS
    encryption support, bandwidth throttling, and upload/download ratios, to name
    a few. Pure-FTPd supports both virtual users and users that exist on system-level
    accounts. This guide will exclusively focus on the virtual user scheme as it offers
    a larger feature set.
  prefs: []
  type: TYPE_NORMAL
- en: Pure-FTPd is based on Troll-FTPd, originally written by Arnt Gulbrandsen in
    1995\. Active development of Troll-FTPd stagnated in the late '90s, prompting
    Frank Denis to create the Pure-FTPd project. Denis made some modifications to
    the Troll-FTPd code, wrote new documentation, and released Pure-FTPd in 2001\.
    A team of nine, led by Denis, continues development of the Pure-FTPd project.
  prefs: []
  type: TYPE_NORMAL
- en: 26.2\. RESOURCES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Pure-FTPd Documentation
  prefs: []
  type: TYPE_NORMAL
- en: '[http://www.pureftpd.org/project/pure-ftpd/doc](http://www.pureftpd.org/project/pure-ftpd/doc)'
  prefs: []
  type: TYPE_NORMAL
- en: RFC 959 - File Transfer Protocol
  prefs: []
  type: TYPE_NORMAL
- en: '[http://tools.ietf.org/html/rfc959](http://tools.ietf.org/html/rfc959)'
  prefs: []
  type: TYPE_NORMAL
- en: 26.3\. REQUIRED
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) FreeBSD 7.0-RELEASE
    (see "[FreeBSD 7.0](freebsd_7.0_split_000.html#freebsd_7.0)")'
  prefs: []
  type: TYPE_IMG
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) Updated ports
    collection (see "[FreeBSD Ports Collection](freebsd_ports_collection.html#freebsd_ports_collection)")'
  prefs: []
  type: TYPE_IMG
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) Internet
    connection'
  prefs: []
  type: TYPE_NORMAL
- en: 26.4\. OPTIONAL
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) OpenSSL with
    a signed SSL Certificate, if you wish to enable encryption of the FTP control
    channel (see "[OpenSSL 0.9.8g](openssl_0.9.8g.html#openssl_0.9.8g)")'
  prefs: []
  type: TYPE_IMG
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) Registered
    domain name'
  prefs: []
  type: TYPE_NORMAL
- en: 26.5\. PREPARATION
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Become the superuser.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: '***Note:*** This guide provides instructions for using the virtual user system
    to manage and control users. This system provides a larger feature set and allows
    administration of FTP accounts without affecting system accounts.'
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: 26.6\. INSTALL
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To begin the Pure-FTPd installation process, enter the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: A menu containing pure-ftpd options will appear. Leave these options at their
    defaults, then press [tab] to select OK and [enter] to continue.
  prefs: []
  type: TYPE_NORMAL
- en: 26.7\. CONFIGURE
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Once the installation process is complete, it's time to configure Pure-FTPd
    for use on your system.
  prefs: []
  type: TYPE_NORMAL
- en: Copy the sample configuration file named pure-ftpd.conf.sample to pure-ftpd.conf
    in /usr/local/etc. This file will be used to set configuration options.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Specify the location of the virtual users database. Scroll down to the `PureDB`
    statement (~126), uncomment it (remove the leading hash mark) and change the path
    to /usr/local/etc/pureftpd.pdb. The `PureDB` statement should appear as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'To make adding new virtual users easier, configure Pure-FTPd to automatically
    create a user''s home directory upon login (if it doesn''t already exist). Uncomment
    the `CreateHomeDir` statement (~336) to enable this feature. The `CreateHomeDir`
    statement should look like this:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Pure-FTPd is automatically compiled with SSL/TLS support. It is, however, disabled
    by default. If you do not wish to enable SSL/TLS encryption, save, exit, and skip
    to step 8.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 26.7.1\. Configuring SSL/TLS
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: An FTP session utilizes a control channel and a data channel. The control channel
    is responsible for handling the initial authentication, commands to the server,
    and the server's responses. The data channel is used to transmit data during file
    transfers.
  prefs: []
  type: TYPE_NORMAL
- en: Pure-FTPd, if configured with SSL/TLS, can provide encryption for the control
    channel, although information on the data channel is still transmitted "in the
    clear." For a higher level of security, look at other solutions like SFTP, which
    is part of OpenSSH.
  prefs: []
  type: TYPE_NORMAL
- en: 'NaN.  Uncomment the `TLS` declaration (~422) and specify 1 or 2\. There are
    two possible SSL/TLS configurations: The first (option 1) allows both unencrypted
    and encrypted connections to occur, while the second (option 2) allows only encrypted
    connections. The example below enables both encrypted and unencrypted connections:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: NaN.  Save and exit.
  prefs: []
  type: TYPE_NORMAL
- en: 'NaN.  Pure-FTPd needs your server certificate and key file combined into a
    single file to function properly. We will assume your certificates and private
    key reside in /usr/local/openssl/certs. The following commands will merge your
    server''s private key file with your server certificate file into a new file that
    Pure-FTPd can use:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** Replace the filenames above to match the naming conventions used
    when you created your server key and certificate files with OpenSSL (see "[OpenSSL
    0.9.8g](openssl_0.9.8g.html#openssl_0.9.8g)").'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[host.example.com-unencrypted-key.pem](http://host.example.com-unencrypted-key.pem)
    Your server''s unencrypted private key file'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[host.example.com-cert.pem](http://host.example.com-cert.pem) Your server''s
    public certificate file'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[/etc/ssl/private/pure-ftpd.pem](http:///etc/ssl/private/pure-ftpd.pem) Pure-FTPd
    looks for the SSL Certificate here'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 26.7.2\. Importing and Adding Users
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'NaN.  You may either import users with system-level accounts (those listed
    in /etc/master.passwd) en masse or create new users manually. To create users
    manually, skip to step 9\. To import users that already exist on your system into
    the virtual user database, enter these commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** This utility will only import accounts that have shell access.
    Accounts with their shell set to `*nologin*` will need to be added manually.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'NaN.  To add users to the Pure-FTPd virtual user database manually, we need
    to create a system-level account that will be associated with virtual users. Create
    a new user named vftp like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: We are now able to add users to the virtual users database using the commands
    below. Replace `*user*` with the username you want to create.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: To add additional users, simply repeat the commands above with a different user.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 26.7.3\. Configuring Anonymous FTP
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: We'll configure anonymous FTP access in the next step. If you do not wish to
    configure anonymous FTP, skip to "[Testing](testing-id16.html#testing-id16)".
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: '***Note:*** Take great care when running an anonymous FTP server. A single
    ill-configured option can compromise your system''s security.'
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: 'NaN.  Create a new system-level user named ftp like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: You may create a directory structure of your choice in /usr/home/ftp. To create
    directories that anonymous users can upload to, use a mode of 777 on the directory.
    For read-only access to files, use a mode of 444\. For read-only access to directories,
    use a mode of 555.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'For example, you could allow upload access to the directory /usr/home/ftp/upload.
    The following commands will make the home directory read only, create the upload
    directory, and give anonymous users write permissions there:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** Be sure to monitor the files in the /usr/home/ftp/upload directory,
    since you can be held responsible if users place illegal content there. Consult
    the pure-ftpd.conf file in /usr/local/etc for anonymous login-related options.
    Refer to "[chown](general.html#chown)" and "[chmod](general.html#chmod)" for details
    on setting file ownership and permissions.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 26.8\. TESTING
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In this section we'll perform some basic tests to confirm that Pure-FTPd functions
    properly.
  prefs: []
  type: TYPE_NORMAL
- en: 'Enter this command to start Pure-FTPd:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Initiate an FTP connection with this command (use your system''s hostname):'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'The login message should look like this:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Log in with a user account you created earlier and get a directory listing with
    the `ls` command. If the directory listing is successful, the test succeeds. Enter
    `**quit**` to exit the FTP session.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** In order to test TLS/SSL functionality, you''ll need a TLS/SSL-capable
    FTP client like Cyberduck for the Macintosh or FileZilla for Windows.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'If the test was successful, configure Pure-FTPd to start automatically at system
    startup. To do so, open etc/rc.conf:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'and add the following line:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Save, exit, and restart Pure-FTPd:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 26.9\. UTILITIES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Following is brief information on the pure-pw and pure-ftpwho utilities.
  prefs: []
  type: TYPE_NORMAL
- en: 26.9.1\. pure-pw
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: The pure-pw utility adds, deletes, modifies, and displays information about
    the Pure-FTPd virtual user database.
  prefs: []
  type: TYPE_NORMAL
- en: Command
  prefs: []
  type: TYPE_NORMAL
- en: '`pure-pw`'
  prefs: []
  type: TYPE_NORMAL
- en: Syntax
  prefs: []
  type: TYPE_NORMAL
- en: '`pure-pw` `*command*` `*user*` `-``*options*`'
  prefs: []
  type: TYPE_NORMAL
- en: Commands
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: Adds a virtual user to pureftpd.passwd file
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: Modifies a virtual user entry in pureftpd.passwd file
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: Deletes a virtual user
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: Changes a virtual user password
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: Displays details about the specified user
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: Displays a list of users in the pureftpd.passwd file
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: Exports the pureftpd.passwd file to the pureftpd.pdb database file; this command
    must be run after making any modifications to pureftpd.passwd
  prefs: []
  type: TYPE_NORMAL
- en: Options
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: System user ID
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs: []
  type: TYPE_PRE
- en: System group ID
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE26]'
  prefs: []
  type: TYPE_PRE
- en: Home directory
  prefs: []
  type: TYPE_NORMAL
- en: Examples
  prefs: []
  type: TYPE_NORMAL
- en: 'To delete a virtual user named jill from the virtual user database, enter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs: []
  type: TYPE_PRE
- en: 'To change the password of a virtual user named jack, enter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE28]'
  prefs: []
  type: TYPE_PRE
- en: 26.9.2\. pure-ftpwho
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: The pure-ftpwho utility monitors current FTP client sessions.
  prefs: []
  type: TYPE_NORMAL
- en: Command
  prefs: []
  type: TYPE_NORMAL
- en: '`pure-ftpwho`'
  prefs: []
  type: TYPE_NORMAL
- en: Syntax
  prefs: []
  type: TYPE_NORMAL
- en: '`pure-ftpwho -``*options*`'
  prefs: []
  type: TYPE_NORMAL
- en: Option
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE29]'
  prefs: []
  type: TYPE_PRE
- en: Verbose mode (adds local IP address, port, and transfer stats to output)
  prefs: []
  type: TYPE_NORMAL
- en: Example
  prefs: []
  type: TYPE_NORMAL
- en: 'To display the current FTP client sessions with transfer statistics, enter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE30]'
  prefs: []
  type: TYPE_PRE
- en: 26.10\. CONFIG FILES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: /usr/local/etc/pure-ftpd.conf
  prefs: []
  type: TYPE_NORMAL
- en: This is the primary configuration file. It contains options that the pure-config.pl
    script passes to the Pure-FTP daemon upon startup.
  prefs: []
  type: TYPE_NORMAL
- en: /usr/local/etc/pureftpd.passwd
  prefs: []
  type: TYPE_NORMAL
- en: This file contains usernames, hashed passwords, and directory information on
    virtual users.
  prefs: []
  type: TYPE_NORMAL
- en: .banner
  prefs: []
  type: TYPE_NORMAL
- en: This is a text file that is automatically displayed at login when put into a
    user's home directory.
  prefs: []
  type: TYPE_NORMAL
- en: .message
  prefs: []
  type: TYPE_NORMAL
- en: This text file is automatically displayed when a user enters its parent directory.
  prefs: []
  type: TYPE_NORMAL
- en: 26.11\. LOG FILES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: /var/log/xferlog
  prefs: []
  type: TYPE_NORMAL
- en: Stores FTP session information and error messages
  prefs: []
  type: TYPE_NORMAL
- en: /var/log/messages
  prefs: []
  type: TYPE_NORMAL
- en: Records error messages reported by Pure-FTPd
  prefs: []
  type: TYPE_NORMAL
- en: /var/log/debug.log
  prefs: []
  type: TYPE_NORMAL
- en: Stores a log of all client commands if the `VerboseLog` declaration is set to
    yes in pure-ftpd.conf
  prefs: []
  type: TYPE_NORMAL
- en: 26.12\. NOTES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'By default all user accounts are caged, or restricted, to their respective
    home directories. If you need to allow access to a specific directory outside
    a user''s home directory, symbolic links may be used. For example, say a webmaster,
    Michelle (username michelle), needs access to the /usr/local/www/apache22/data
    directory to upload web content. You can create a symbolic link to this directory
    like this:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE31]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Michelle will have the permissions of the associated userID and groupID you
    specified when you added her to the pureftpd.passwd file. You may need to change
    her associated userID and/or groupID with the pure-pw utility to allow appropriate
    read/write/execute access to the newly linked directory. (If so, you might change
    her user and group IDs to www.) You may also choose to change user or group ownership
    of files and directories to accommodate her existing userID and groupID.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** Be sure you understand file ownership and permissions prior to
    implementing a scheme like this, as it may have security implications.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: If your server is behind a firewall (such as a NAT router), problems may arise
    with clients trying to initiate connections because the Pure-FTP daemon tries
    to establish data connections on arbitrary ports when in active mode. If you encounter
    this, configure your FTP client to use passive mode.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Pure-FTPd contains dozens of other features not documented here. Consult the
    Pure-FTPd project webpage [http://www.pureftpd.org/project/pure-ftpd](http://www.pureftpd.org/project/pure-ftpd)
    or manual page for details. The following command displays Pure-FTPd''s man page:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE32]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
