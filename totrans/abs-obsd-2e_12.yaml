- en: Chapter 12. Connecting to the Network
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第 12 章。连接到网络
- en: '*My tunnel is now up.*'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*我的隧道现在已启动*。'
- en: '*I can do IPv6.*'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '*我可以做 IPv6*。'
- en: '*Me and three others.*'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '*我和其他三个人*。'
- en: '![](httpatomoreillycomsourcenostarchimages1616079.png) All that theory of IPv4
    and IPv6 is fine. Now let’s do something with it, and actually connect to a network.
    While dial-up connections work with OpenBSD, they’re not used much these days,
    so we’ll focus on Ethernet connections. Ethernet is the most common network type
    today, and the most common network interface on OpenBSD systems.'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '![图片](httpatomoreillycomsourcenostarchimages1616079.png) 所有的 IPv4 和 IPv6 理论都是好的。现在让我们实际操作一下，并连接到网络。虽然拨号连接与
    OpenBSD 一起工作，但它们现在不太使用了，所以我们重点关注以太网连接。以太网是当今最常见的网络类型，也是 OpenBSD 系统上最常见的网络接口。'
- en: Most people have IPv4 connectivity, but IPv6 is increasingly important. If you
    can’t get native IPv6 to your network, you can use a tunnel to reach IPv6 address
    space and provide IPv6 to your clients. I’ll cover acquiring and configuring such
    a tunnel in this chapter.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数人都有 IPv4 连接，但 IPv6 越来越重要。如果你无法将原生 IPv6 连接到你的网络，你可以使用隧道来访问 IPv6 地址空间，并为你的客户端提供
    IPv6。我将在本章中介绍如何获取和配置这样的隧道。
- en: Finally, OpenBSD can combine network connections into trunks or split them into
    virtual local area networks (VLANs). This chapter covers both approaches.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，OpenBSD 可以将网络连接组合成 trunk 或将它们拆分成虚拟局域网 (VLAN)。本章将介绍这两种方法。
- en: DNS Resolution
  id: totrans-7
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DNS 解析
- en: You’ll probably want to use hostnames rather than IP addresses, so that you’ll
    be able to browse to *[http://www.cnn.com/](http://www.cnn.com/)* instead of *[http://157.166.255.18](http://157.166.255.18)*.
    Unix-like systems use the *resolver* to accomplish this feat.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能想使用主机名而不是 IP 地址，这样你就可以浏览到 *[http://www.cnn.com/](http://www.cnn.com/)* 而不是
    *[http://157.166.255.18](http://157.166.255.18)*。类 Unix 系统使用 *resolver* 来完成这个功能。
- en: 'Most hosts use two tools to map between IP addresses and hostnames: the *hosts*
    file and DNS. (Different operating systems support additional name services, such
    as YP, LDAP, NIS, and so on, but dang near every system supports these two.)'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 大多数主机使用两个工具在 IP 地址和主机名之间进行映射：*hosts* 文件和 DNS。（不同的操作系统支持额外的名称服务，如 YP、LDAP、NIS
    等，但几乎每个系统都支持这两个。）
- en: The *hosts* file is a text file on the local machine that contains static IP
    address and hostname lists. DNS is a more dynamic service that reaches across
    the network to find information. You can specify DNS servers by IP address, but
    we’ll look at the *hosts* file in a little more detail.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: '*hosts* 文件是本地机器上的一个文本文件，其中包含静态 IP 地址和主机名列表。DNS 是一个更动态的服务，它跨越网络查找信息。你可以通过 IP
    地址指定 DNS 服务器，但我们将更详细地查看 *hosts* 文件。'
- en: What if you prefer IPv4 or IPv6 addresses? Or you want the *hosts* file to override
    DNS? Maybe you have a default domain that your queries should use. The resolver
    searches until it either finds the first answer or has exhausted its information
    sources, so these questions matter. Tell your resolver your needs in */etc/resolv.conf*.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你更喜欢 IPv4 或 IPv6 地址？或者你想让 *hosts* 文件覆盖 DNS？也许你有一个默认域名，你的查询应该使用。解析器会搜索，直到它找到第一个答案或者耗尽其信息来源，所以这些问题很重要。请在
    */etc/resolv.conf* 中告诉解析器你的需求。
- en: The /etc/resolv.conf File
  id: totrans-12
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: /etc/resolv.conf 文件
- en: You configure the resolver behavior in */etc/resolv.conf*. A system without
    */etc/resolv.conf* can find only hostnames listed in the *hosts* file. Because
    the *hosts* file starts off empty, that’s probably not what you want. Start by
    specifying domain names.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 你在 */etc/resolv.conf* 中配置解析器行为。没有 */etc/resolv.conf* 的系统只能找到 *hosts* 文件中列出的主机名。因为
    *hosts* 文件一开始是空的，这可能不是你想要的。首先指定域名。
- en: Default Search Domains
  id: totrans-14
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 默认搜索域名
- en: If you wanted to ping a host on a remote network, you might expect to need to
    specify the whole domain. Entering **`ping www.openbsd.org`** should work. But
    if you wanted to ping your company’s web server, it would make more sense to just
    type **`ping www`**. And you can, because OpenBSD allows you to specify default
    domains, so that when you type in a short hostname, it will try to find the proper
    host.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想要ping远程网络上的主机，你可能预计需要指定整个域名。输入 **`ping www.openbsd.org`** 应该可以工作。但如果你想要ping你公司的网站服务器，直接输入
    **`ping www`** 会更有意义。而且你可以这样做，因为 OpenBSD 允许你指定默认域名，这样当你输入一个简短的域名时，它会尝试找到正确的主机。
- en: 'For example, if you have only one local domain, you would list the domain keyword
    in */etc/resolv.conf* like this:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果你只有一个本地域名，你可以在 */etc/resolv.conf* 中这样列出域名关键字：
- en: '[PRE0]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Now, when I enter `ping ftp`, the resolver should get the IP address of the
    host *ftp.michaelwlucas.com*.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，当我输入 `ping ftp` 时，解析器应该获取主机 *ftp.michaelwlucas.com* 的 IP 地址。
- en: 'If you have more than one local domain, use the `search` keyword and a list
    of domains, like this:'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你有一个以上的本地域，请使用 `search` 关键字和域名列表，如下所示：
- en: '[PRE1]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: If I enter `ping ftp` now, the resolver should get the IP of the host *ftp.michaelwlucas.com*.
    Once the resolver learns that no such host exists, it will check for *ftp.openbsd.org*.
    Because that host exists, `ping` will start to work. The `search` keyword can
    have up to six domains, and can be no longer than 1024 characters.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我现在输入 `ping ftp`，解析器应该获取主机 *ftp.michaelwlucas.com* 的IP地址。一旦解析器了解到不存在这样的主机，它将检查
    *ftp.openbsd.org*。因为该主机存在，`ping` 将开始工作。`search` 关键字可以有最多六个域，并且不能超过1024个字符。
- en: Using Domain and Search
  id: totrans-22
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 使用域名和搜索
- en: 'You can only use either `domain` or `search`. If you use both, the last entry
    in the file wins. If you list multiple search or domain lines, the last one in
    the file takes effect. Here’s how not to do it:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 你只能使用 `domain` 或 `search`。如果你两者都使用，文件中的最后一个条目将获胜。如果你列出多个搜索或域名行，文件中的最后一行将生效。以下是如何不这样做的方法：
- en: '[PRE2]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: You might as well get rid of the two `search` statements. The resolver will
    never go through those domain lists; it will use only the `domain` list because
    it’s the last one.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 你不妨删除两个 `search` 语句。解析器永远不会遍历这些域名列表；它将仅使用 `domain` 列表，因为它是最新的。
- en: Name Servers
  id: totrans-26
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 域名服务器
- en: Now that the resolver knows which domains to check by default, tell it which
    name servers to use. List each name server on its own line, by IP address, in
    order of preference.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 现在解析器知道默认要检查哪些域，告诉它要使用哪些域名服务器。按IP地址顺序，每行列出每个域名服务器，每个域名服务器占一行。
- en: '[PRE3]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: You can list up to three name servers, by IP address. (Hostnames in a `nameserver`
    entry won’t work, for fairly obvious reasons.)
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以按IP地址列出最多三个域名服务器。（`nameserver` 条目中的主机名不会工作，原因很明显。）
- en: If your *resolv.conf* doesn’t list a name server, the resolver should check
    for a name server on the local machine.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的 *resolv.conf* 没有列出域名服务器，解析器应在本地机器上查找域名服务器。
- en: Lookup Order
  id: totrans-31
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 查找顺序
- en: You might get host information from DNS or from the *hosts* file. The resolver
    should stop once it finds an answer to a query. If you check the *hosts* file
    and then DNS, entries in the *hosts* file override the name server. If you check
    the name server before the *hosts* file, the *hosts* file is used only when no
    DNS record is available. Either approach has its uses, but by default, the resolver
    checks the *hosts* file, and then checks DNS. To reverse this, use the `lookup`
    keyword.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能从DNS或从 *hosts* 文件中获取主机信息。解析器应在找到查询答案后停止。如果你先检查 *hosts* 文件然后检查DNS，*hosts*
    文件中的条目将覆盖域名服务器。如果你在 *hosts* 文件之前检查域名服务器，*hosts* 文件仅在无DNS记录可用时使用。两种方法都有其用途，但默认情况下，解析器先检查
    *hosts* 文件，然后检查DNS。要反转此操作，请使用 `lookup` 关键字。
- en: '[PRE4]'
  id: totrans-33
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The `file` option represents */etc/hosts*, while due to a historical accident,
    `bind` represents DNS. (The first DNS server software was the Berkeley Internet
    Name Domain server, or BIND.)The reverse (`file bind`) is the default, so there’s
    no need to explicitly specify it.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '`file` 选项代表 */etc/hosts*，而由于历史原因，`bind` 代表DNS。（第一个DNS服务器软件是伯克利互联网名称域服务器，或BIND。）反向（`file
    bind`）是默认设置，因此不需要明确指定它。'
- en: Preferred IP Protocol
  id: totrans-35
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 优先IP协议
- en: The resolver defaults to searching for IPv4 records first, and then looking
    for IPv6 records. To reverse this, use the `family` keyword.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 解析器默认先搜索IPv4记录，然后查找IPv6记录。要反转此操作，请使用 `family` 关键字。
- en: '[PRE5]'
  id: totrans-37
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: Again, the reverse is the default, so there’s no need to use this keyword in
    that case.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 再次强调，反向是默认设置，因此在这种情况下不需要使用此关键字。
- en: The /etc/hosts File
  id: totrans-39
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: /etc/hosts 文件
- en: The */etc/hosts* file matches IP addresses to hostnames. While the *hosts* file
    is very simple, its contents are available only on the local machine. A *hosts*
    file is most useful on a small private network, such as in your home or test lab.
    You can also use a *hosts* file to override data from the DNS server, such as
    when you want to test a new system.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: '*/etc/hosts* 文件将IP地址与主机名匹配。虽然 *hosts* 文件非常简单，但其内容仅可在本地机器上访问。*hosts* 文件在小型私有网络中最有用，例如在你的家庭或测试实验室中。你也可以使用
    *hosts* 文件来覆盖DNS服务器中的数据，例如当你想测试新系统时。'
- en: Each line in */etc/hosts* represents one host. The first entry on each line
    is an IP address. The second is the fully qualified domain name of the host. Following
    these two entries, you can have an arbitrary number of aliases for that host.
    I often add comments at the end of the line, prefixed with a hash mark (`#`).
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: '*/etc/hosts* 文件中的每一行代表一个主机。每行的第一个条目是一个IP地址。第二个是主机的完全限定域名。在这两个条目之后，你可以为该主机有任意数量的别名。我经常在行末添加注释，以井号（`#`）开头。'
- en: 'There was a time when I had a small network at home with only four machines:
    the proxy/firewall, the wife’s desktop, my laptop, and the crash machine where
    I did stupid things. The *hosts* file looked like this:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 曾经有一段时间，我在家里有一个只有四台机器的小型网络：代理/防火墙、妻子的台式机、我的笔记本电脑和我在上面做愚蠢事情的崩溃机器。*hosts*文件看起来像这样：
- en: '[PRE6]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: The machine `nat.blackhelicopters.org` at **1** also had the names `firewall`
    and `gateway` at **2**. I added a note to remind myself at **3** not to run security
    scanners against my wife’s desktop. (The machine `crashbox` is also called `test`.)
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 在**1**处的机器`nat.blackhelicopters.org`也有`firewall`和`gateway`的名称**2**。我在**3**处添加了一个笔记提醒自己不要对我的妻子的台式机运行安全扫描器。（机器`crashbox`也被称为`test`。）
- en: Any machine with this *hosts* table could find any machine listed in the *hosts*
    table by name. For example, I could run `ping boss` or `ssh crashbox` and reach
    the desired machine.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 任何具有此*hosts*表的机器都可以通过名称找到*hosts*表中列出的任何机器。例如，我可以运行`ping boss`或`ssh crashbox`来访问目标机器。
- en: The *hosts* file works just fine for finding networked hosts, but whenever you
    add, remove, or change a machine, you must edit */etc/hosts* on every computer.
    And every time you change an IP address, you must edit */etc/hosts* on every machine.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: '*hosts*文件在查找网络主机方面工作得很好，但每次添加、删除或更改一台机器时，你都必须在每个计算机上编辑*/etc/hosts*。每次更改IP地址时，你都必须在每个机器上编辑*/etc/hosts*。'
- en: Note
  id: totrans-47
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Unfortunately, */etc/hosts* does not scale. When I got a fifth machine, I added
    an internal-only DNS server and emptied the *hosts* file on all of my systems.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，*/etc/hosts*无法扩展。当我得到第五台机器时，我添加了一个仅限内部使用的DNS服务器，并清空了我所有系统上的*hosts*文件。
- en: Resolver vs. Dynamic Configuration
  id: totrans-49
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 解析器与动态配置
- en: If your OpenBSD system roams between networks, like a laptop, you probably use
    DHCP to configure your network connection.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你的OpenBSD系统像笔记本电脑一样在多个网络之间移动，你可能使用DHCP来配置你的网络连接。
- en: DHCP overwrites */etc/resolv.conf* with the information for its network. This
    is appropriate for most users, but if you’re carrying an OpenBSD laptop, you’re
    not normal. You probably want some of your resolver configuration, such as your
    domain search list, to remain in effect no matter what network you’re on.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: DHCP会覆盖*/etc/resolv.conf*，用其网络的信息。这对于大多数用户来说是合适的，但如果你携带的是OpenBSD笔记本电脑，你就不是普通人。你可能希望你的解析器配置（如你的域名搜索列表）在无论你连接到哪个网络时都保持有效。
- en: OpenBSD supports permanent resolver configuration in the file */etc/resolv.conf.tail*.
    When OpenBSD’s DHCP client gets */etc/resolv.conf* information from the server,
    it writes to */etc/resolv.conf* and adds `/etc/resolv.conf.tail` to the end.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD支持在文件*/etc/resolv.conf.tail*中进行永久解析器配置。当OpenBSD的DHCP客户端从服务器获取*/etc/resolv.conf*信息时，它会写入*/etc/resolv.conf*并在末尾添加`/etc/resolv.conf.tail`。
- en: Remember how only the last `search` or `domain` keyword works? *resolv.conf.tail*
    takes advantage of that, allowing you to override your network administrator’s
    search order.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 记得只有最后一个`search`或`domain`关键字有效吗？*resolv.conf.tail*利用了这一点，允许你覆盖你的网络管理员的搜索顺序。
- en: Ethernet
  id: totrans-54
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 以太网
- en: Ethernet is a shared network, meaning that many different machines can connect
    to the same Ethernet and can communicate directly with each other. I’m going to
    assume that you’re using Ethernet as found in an average office or datacenter.
    Also, although Ethernet has been implemented over many different physical media,
    I’ll assume you’re working with CAT5 or better cable—today’s most popular choice.
    If you use some unusual media type, or your card supports multiple media, you
    might need to manually set your preferred media on your interface.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网是一个共享网络，意味着许多不同的机器可以连接到同一个以太网，并且可以直接相互通信。我将假设你使用的是在普通办公室或数据中心中找到的以太网。此外，尽管以太网已经在许多不同的物理媒体上实现，但我将假设你正在使用CAT5或更好的电缆——这是今天最受欢迎的选择。如果你使用一些不寻常的媒体类型，或者你的网卡支持多种媒体，你可能需要在你的接口上手动设置首选媒体。
- en: Protocol and Hardware
  id: totrans-56
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 协议和硬件
- en: Ethernet is a *broadcast protocol*, which means that every packet you transmit
    can be sent to every host on the network (although most Ethernet hardware limits
    recipients). Either your network card or your device driver separates the data
    intended for your computer from the data meant for other computers. A section
    of Ethernet where all hosts can communicate directly with all other hosts, without
    involving a router, is called a *collision domain* or *segment*.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网是一种*广播协议*，这意味着你发送的每个数据包都可以发送到网络上的每个主机（尽管大多数以太网硬件限制了接收者）。要么是你的网卡，要么是你的设备驱动程序将为你计算机打算接收的数据与其他计算机打算接收的数据分开。一个所有主机都可以直接与其他所有主机通信的以太网部分，而不涉及路由器，被称为*冲突域*或*段*。
- en: You connect Ethernet segments with *hubs*, which are hardware items that can
    physically connect many Ethernet hosts. Network hubs forward all received frames
    to all other network devices, and each host is responsible for filtering traffic.
    This is old-school Ethernet, which can be useful for debugging network issues.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用*hubs*连接以太网段，这些是硬件设备，可以物理连接多个以太网主机。网络集线器将所有接收到的帧转发到所有其他网络设备，每个主机负责过滤流量。这是老式的以太网，对于调试网络问题可能很有用。
- en: '*Switches* have largely supplanted hubs. Every Ethernet connection needs a
    unique identifier, called a *MAC address* (or sometimes an *Ethernet address*),
    which is a 48-bit number. Switches control the traffic sent to each host by filtering
    on the MAC and IP address of attached devices and (mostly) forwarding frames only
    to the devices they are meant for. Switching reduces the amount of traffic and
    load on each individual system by decreasing the amount of traffic each host must
    sort through.'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '*交换机*在很大程度上取代了集线器。每个以太网连接都需要一个唯一的标识符，称为*MAC地址*（有时也称为*以太网地址*），它是一个48位的数字。交换机通过过滤连接设备的MAC和IP地址来控制发送到每个主机的流量，并且（主要）只将帧转发到它们打算发送到的设备。交换机通过减少每个主机必须处理的流量量来减少每个系统的流量和负载。'
- en: On i386 and amd64 hardware, the MAC address is a property of the card. On some
    other platforms, such as SPARC, the MAC address is a property of the server itself.
    Both IPv4 and IPv6 use the MAC address to find other hosts on the local network.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 在i386和amd64硬件上，MAC地址是卡的一个属性。在某些其他平台上，例如SPARC，MAC地址是服务器本身的属性。IPv4和IPv6都使用MAC地址在本地网络上找到其他主机。
- en: IPv4 and ARP
  id: totrans-61
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: IPv4和ARP
- en: When a system needs to transmit data to another IP-based host on the local Ethernet,
    it first broadcasts an Ethernet request asking, “Which MAC address is responsible
    for this IP address?” If a host responds, further data for that IP is transmitted
    to that MAC address. This process is handled by ARP.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 当一个系统需要向本地以太网上的另一个基于IP的主机传输数据时，它首先广播一个以太网请求，询问：“哪个MAC地址负责这个IP地址？”如果有一个主机响应，则将针对该IP的进一步数据传输到该MAC地址。这个过程由ARP处理。
- en: Use `arp(8)` to view your system’s ARP table, which is the list of hosts that
    your system knows. Enter `arp -a` to show all of the MAC addresses and IPv4 hostnames
    your computer knows.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`arp(8)`查看您系统的ARP表，这是您系统所知的宿主机的列表。输入`arp -a`以显示您的计算机所知的所有MAC地址和IPv4主机名。
- en: '[PRE7]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Here, you see the three hosts on my Ethernet network that this host has communicated
    with. I have more hosts, but because this machine hasn’t spoken with them lately,
    they aren’t in the local ARP table.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，您可以看到与我以太网网络上的这个主机通信的三个主机。我还有更多的主机，但由于这台机器最近没有与它们交谈，它们不在本地ARP表中。
- en: If a MAC address shows up as `incomplete`, your machine has attempted to communicate
    with this host but cannot get its MAC address. In this example, I’ve tried to
    send data to the host `salmon`, but my computer can’t reach it. (Turning `salmon`
    back on would help.)
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 如果MAC地址显示为`incomplete`，则表示您的计算机已尝试与此主机通信，但无法获取其MAC地址。在这个例子中，我尝试向主机`salmom`发送数据，但我的计算机无法到达它。（重新开启`salmom`可能会有帮助。）
- en: IPv6 and Neighbor Discovery
  id: totrans-67
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: IPv6和邻居发现
- en: IPv6 hosts also use MAC addresses to find each other through ND, an IPv6 protocol
    introduced in the previous chapter. Interrogate your ND cache with `ndp(8)`. The
    command-line flags used for `ndp` are intentionally similar to those for `arp`.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: IPv6主机也使用MAC地址通过ND（在上一章中引入的IPv6协议）找到彼此。使用`ndp(8)`查询您的ND缓存。`ndp`使用的命令行标志故意与`arp`的类似。
- en: '[PRE8]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Like the ARP cache, the ND cache shows an IPv6 address, a physical address,
    the interface, and other details for each host. You’ll see more ND entries than
    ARP entries because all of the link local addresses show up in the ND cache.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 与ARP缓存一样，ND缓存显示了每个主机的IPv6地址、物理地址、接口和其他详细信息。您将看到的ND条目比ARP条目多，因为所有链路本地地址都显示在ND缓存中。
- en: If you try to reach a host that is directly attached to your local network and
    it doesn’t respond, check the ND cache. If an ND cache entry shows up as `(incomplete)`,
    as with ARP, there’s some sort of basic connectivity issue.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您尝试连接到直接连接到您本地网络的主机，但它没有响应，请检查ND缓存。如果ND缓存条目显示为`(incomplete)`，就像ARP一样，存在某种基本的连接问题。
- en: Speed and Duplex
  id: totrans-72
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 速度和双工
- en: Ethernet supports a variety of speeds. The slowest speed you’re likely to find
    today is 10 megabits per second (Mbps), but it’s quickly disappearing. Most people
    use either 10/100Mbps or 1 gigabit per second (Gbps), although you’ll see 10Gbps,
    40Gbps, and 100Gbps Ethernet emerging.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 以太网支持多种速度。您今天可能找到的最慢速度是每秒 10 兆比特（Mbps），但它正在迅速消失。大多数人使用 10/100Mbps 或每秒 1 千兆位（Gbps），尽管您会看到
    10Gbps、40Gbps 和 100Gbps 以太网的出现。
- en: The hosts and switch it’s connected to on your network must agree on the speed
    of their connection. If the OpenBSD host thinks that it’s connected at 100Mbps,
    but the switch thinks that the connection is 1Gbps, the connection will be flaky.
    While *autonegotiation* usually makes both sides agree on common settings (and
    is absolutely required for gigabit connections), you can manually set duplex and
    speed for 10/100Mbps connections. Although some switch vendors are notorious for
    poor autonegotiation, you should let your Ethernet configure itself whenever possible.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 您的网络上的主机和与之连接的交换机必须就其连接速度达成一致。如果 OpenBSD 主机认为它连接在 100Mbps，但交换机认为连接是 1Gbps，连接将会不稳定。虽然
    *自动协商* 通常会使双方就共同设置达成一致（并且对于千兆连接来说是绝对必要的），但您可以为 10/100Mbps 连接手动设置双工和速度。尽管一些交换机厂商因自动协商不佳而臭名昭著，但只要可能，您应该让以太网自行配置。
- en: '*Duplex* determines if a card can both transmit and receive data simultaneously.
    A *half-duplex* connection means that the Ethernet card is either transmitting
    or receiving at a given instant; it cannot do both. A *full-duplex* connection
    can both send and receive simultaneously. As with connection speed, if the switch
    and host disagree on the duplex setting, the connection will be flaky. Gigabit
    Ethernet connections involve much more than speed and duplex, and they *must*
    be autonegotiated.'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: '*双工* 决定了一张卡是否可以同时发送和接收数据。*半双工* 连接意味着在某一时刻，以太网卡要么在发送要么在接收；它不能同时进行。*全双工* 连接可以同时发送和接收。就像连接速度一样，如果交换机和主机在双工设置上不一致，连接将会不稳定。千兆以太网连接涉及的内容远不止速度和双工，它们*必须*进行自动协商。'
- en: Just because a device says that it can use the protocol defined as 10/100Mbps
    Ethernet doesn’t mean that it can use that protocol with any speed. Also, a card
    labeled “1Gbps” might not actually pass a gigabit per second. Some network cards
    will pass their stated amount of traffic, while others will stagger and stumble
    at a few percent of that. Switch quality varies widely, too.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 仅因为一个设备声称它可以使用定义为 10/100Mbps 以太网的协议，并不意味着它可以以任何速度使用该协议。此外，标有“1Gbps”的卡实际上可能无法每秒传输千兆位。一些网卡会传输其声明的流量，而其他网卡则会在该流量的几百分比处犹豫不决。交换机的质量也参差不齐。
- en: This may make more sense if you think of an Ethernet’s stated speed as a language.
    For example, I could claim that I speak Russian and German, but I stopped studying
    foreign languages in 1985\. When I went to Germany in 2007, I managed about three
    words a minute—with the aid of a translation card and phrase book. If I were an
    Ethernet card, the manufacturer would claim I spoke German and Russian, and ship
    me to Siberia.^([[33](#ftn.id309258)])
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您将以太网声明的速度视为一种语言，这可能更有意义。例如，我可以声称我会说俄语和德语，但我从 1985 年起就停止学习外语了。当我 2007 年去德国时，我每分钟只能管理大约三个单词——借助翻译卡和短语书。如果我是以太网卡，制造商会声称我会说德语和俄语，并将我运往西伯利亚。[^([33](#ftn.id309258))]
- en: Get decent hardware. Don’t ask on the OpenBSD mailing list, though. Someone
    has asked about hardware recommendations in the past few months. Check the archives.
    The advice hasn’t changed.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 获取合适的硬件。不过，不要在 OpenBSD 邮件列表上询问。过去几个月有人询问过硬件推荐。检查存档。建议没有变化。
- en: Configuring Ethernet
  id: totrans-79
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 配置以太网
- en: When configuring Ethernet for client computers, if your IPv4 network offers
    DHCP, you should be able to plug right in. If you’re using IPv6, you should be
    able to attach the cable and let autoconfiguration take over.
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 当为客户端计算机配置以太网时，如果您的 IPv4 网络提供 DHCP，您应该可以直接连接。如果您使用 IPv6，您应该可以连接电缆并让自动配置接管。
- en: 'If a particular machine will be a server, a static IP address probably makes
    more sense. Before assigning a static address, you’ll need the following:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一台特定的机器将作为服务器，静态 IP 地址可能更有意义。在分配静态地址之前，您需要以下信息：
- en: An IP address (IPv4, IPv6 or both)
  id: totrans-82
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一个 IP 地址（IPv4、IPv6 或两者兼有）
- en: The netmask/prefix length(s)
  id: totrans-83
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 子网掩码/前缀长度
- en: The IP address(es) of the default gateway
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 默认网关的 IP 地址
- en: Armed with this information, attach your system to the network and keep reading.
    I’ll first discuss using `ifconfig(8)` and `route(8)` to perform changes manually,
    and then review how to set these automatically at boot. In any case, you must
    configure the resolver as discussed at the beginning of this chapter.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 带着这些信息，将您的系统连接到网络并继续阅读。我首先将讨论如何使用 `ifconfig(8)` 和 `route(8)` 手动执行更改，然后回顾如何在启动时自动设置这些更改。无论如何，您必须配置解析器，如本章开头所述。
- en: Using ifconfig(8)
  id: totrans-86
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用 ifconfig(8)
- en: If you installed OpenBSD over a network, your Ethernet connection should already
    be working, but it might not be set up exactly the way you like. To manage your
    network interfaces, use the `ifconfig(8)` tool.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您通过网络安装了 OpenBSD，您的以太网连接应该已经工作，但可能不会按照您喜欢的确切方式设置。要管理您的网络接口，请使用 `ifconfig(8)`
    工具。
- en: Let’s look at your Ethernet card and see what it has to say. Start by asking
    your system about all of the interfaces it has installed, by running `ifconfig`.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来看看您的以太网卡，看看它有什么要说的。首先，通过运行 `ifconfig` 来询问您的系统安装了哪些接口。
- en: 'All OpenBSD systems have three logical interfaces out of the box: `lo0`, `enc0`,
    and `pflog0`. The `lo0` interface is the loopback interface, referring to the
    local machine. The `enc0` interface is an encapsulation interface, intended for
    IPsec traffic. Finally, `pflog0` is for logging PF traffic, as discussed in [Chapter 22](ch22.html
    "Chapter 22. Advanced PF"). The rest of the interfaces are physical ones.'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 所有 OpenBSD 系统默认都有三个逻辑接口：`lo0`、`enc0` 和 `pflog0`。`lo0` 接口是回环接口，指的是本地机器。`enc0`
    接口是一个封装接口，用于 IPsec 流量。最后，`pflog0` 用于记录 PF 流量，如 [第 22 章](ch22.html "第 22 章。高级 PF")
    中所述。其余的接口都是物理接口。
- en: 'Unlike some operating systems, OpenBSD network interfaces are named after the
    device driver of the underlying hardware. Here’s a sample list:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 与一些操作系统不同，OpenBSD 网络接口的命名是根据底层硬件的设备驱动程序来命名的。以下是一个示例列表：
- en: '[PRE9]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: The interface `fxp0` uses the `fxp(4)` device driver, which the man page says
    is an Intel EtherExpress PRO 10/100 card. As you can see at **1**, the interface
    is up, meaning that it’s active and ready to use. The `lladdr` is the link local
    address, or the MAC address of the card. This card is in the `egress` group. OpenBSD
    uses interface groups in several places, including the packet filter, as discussed
    in [Chapter 22](ch22.html "Chapter 22. Advanced PF").
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 接口 `fxp0` 使用的是 `fxp(4)` 设备驱动程序，根据手册页的说明，这是一张英特尔 EtherExpress PRO 10/100 网卡。如
    **1** 所示，接口处于激活状态，意味着它是活跃的并且准备就绪。`lladdr` 是链路本地地址，或网卡的 MAC 地址。这张网卡位于 `egress`
    组中。OpenBSD 在多个地方使用接口组，包括在 [第 22 章](ch22.html "第 22 章。高级 PF") 中讨论的包过滤器。
- en: To see the type of physical media underlying the connection, check the `media`
    line. This particular connection runs at 100Mbps full-duplex. The connection is
    active, as shown at **2**; the physical layer has not only been configured, but
    it also has a link light and is ready to go. The connection has been assigned
    an IPv4 address and netmask, as shown at **3**. You can see on the two lines that
    follow that both an IPv6 address and a link local IPv6 address have been assigned.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看连接下层的物理媒体类型，请检查 `media` 行。这个特定的连接以 100Mbps 全双工运行。连接处于活动状态，如 **2** 所示；物理层不仅已配置，而且还有一个链路指示灯，准备就绪。连接已分配了
    IPv4 地址和子网掩码，如 **3** 所示。您可以在接下来的两行中看到，已分配了 IPv6 地址和链路本地 IPv6 地址。
- en: Use `ifconfig` to assign, change, or remove IP addresses from a network interface.
    The OpenBSD installer offers to configure your network cards at boot, but if you
    didn’t configure all of your interfaces during installation, or if you add or
    remove network interfaces after installation, you will need to do so manually.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `ifconfig` 为网络接口分配、更改或删除 IP 地址。OpenBSD 安装程序在启动时提供配置网络卡的服务，但如果您在安装过程中没有配置所有接口，或者安装后添加或删除了网络接口，您将需要手动进行。
- en: Adding an IP Address
  id: totrans-95
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 添加 IP 地址
- en: To add an IP address for IPv4, start with the interface’s assigned IP address
    and netmask.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 要为 IPv4 添加 IP 地址，从接口分配的 IP 地址和子网掩码开始。
- en: '[PRE10]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'For example, if your network card is `fxp0`, your IP address is 192.0.2.55,
    and the netmask is 255.255.255.128, you would run this:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，如果您的网卡是 `fxp0`，IP 地址是 192.0.2.55，子网掩码是 255.255.255.128，您将运行以下命令：
- en: '[PRE11]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'Specify the netmask in dotted-quad notation, hexadecimal, or even slash notation,
    like this:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 使用点分十进制、十六进制或甚至斜杠表示法指定子网掩码，如下所示：
- en: '[PRE12]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: You don’t need to specify a netmask separately if you use a slash.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用斜杠，不需要单独指定子网掩码。
- en: 'Adding an IP address with IPv6 is a little different. Specify the address,
    a slash, and the prefix length, but don’t try to add a separate netmask; just
    use the slash that’s part of the address. Here’s an example:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 使用IPv6添加IP地址略有不同。指定地址，一个斜杠，以及前缀长度，但不要尝试添加单独的子网掩码；只需使用地址部分中的斜杠。以下是一个示例：
- en: '[PRE13]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: Removing IP Addresses
  id: totrans-105
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 移除IP地址
- en: If you need to remove an IP address from an interface, use the `delete` option
    of `ifconfig` for both IPv4 and IPv6 addresses.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您需要从一个接口中移除IP地址，请使用`ifconfig`的`delete`选项来删除IPv4和IPv6地址。
- en: '[PRE14]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: The effect is immediate, so be sure you don’t lock yourself out of the system
    by removing all of its reachable IP addresses, or by removing the only address
    your SSH daemon is attached to. (In certain rare cases, existing connections to
    deleted addresses might continue to work, but they probably won’t, so don’t count
    on it.)
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 效果是立即的，所以请确保不要通过移除所有可到达的IP地址或移除SSH守护进程所附加的唯一地址而将自己锁定在系统之外。（在某些罕见的情况下，对已删除地址的现有连接可能会继续工作，但它们很可能不会，所以不要寄希望于此。）
- en: Multiple IP Addresses on One Ethernet Card
  id: totrans-109
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 一张以太网卡上的多个IP地址
- en: One network interface can respond to requests for multiple IP addresses, which
    is important because a server might support hundreds or thousands of domains and
    need an IP address for each. (This isn’t so important for plain websites, but
    it can be important for SSL-based websites and protocols that rely on reverse
    DNS.)
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 一个网络接口可以响应多个IP地址的请求，这对于服务器可能支持数百或数千个域名并且需要为每个域名分配IP地址来说非常重要。（对于普通网站来说，这并不那么重要，但对于基于SSL的网站和依赖于反向DNS的协议来说，这可能是重要的。）
- en: To add extra IP addresses to an interface, use *IP aliases*. IP aliases tell
    a network card to “answer requests for this IP address as well as your own.” To
    add aliased IP addresses, use `ifconfig` with the keyword `alias` after the interface
    name to tell `ifconfig` this is an alias. Be sure to always use a netmask of 255.255.255.255,
    or /32, for alias addresses.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 要向接口添加额外的IP地址，请使用*IP别名*。IP别名告诉网络卡“同时回答对这个IP地址以及您自己的请求。”要添加别名IP地址，请使用`ifconfig`并在接口名称后使用关键字`alias`来告诉`ifconfig`这是一个别名。请确保始终为别名地址使用子网掩码255.255.255.255或/32。
- en: '[PRE15]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: The interface listed here has a main IP address of 192.0.2.226 and an alias
    IP address of 192.0.2.230.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 这里列出的接口有一个主IP地址192.0.2.226和一个别名IP地址192.0.2.230。
- en: 'When working with IPv6, add the `inet6` keyword, like this:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 当处理IPv6时，添加`inet6`关键字，如下所示：
- en: '[PRE16]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: It’s important to realize that all outgoing connections on a host with one network
    connection use the host’s primary IP address. For example, you might have 2000
    IP addresses bound to one interface, but when you `ssh` out, the connection comes
    from the primary address. Remember this when writing firewall rules and access
    control lists, because while some programs have an option to set a different source
    IP address, they’re the exception.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 重要的是要认识到，一个网络连接的主机上的所有出站连接都使用主IP地址。例如，您可能有一个接口绑定有2000个IP地址，但当你`ssh`出去时，连接来自主地址。在编写防火墙规则和访问控制列表时请记住这一点，因为虽然一些程序有设置不同源IP地址的选项，但它们是例外。
- en: The OpenBSD kernel doesn’t really differentiate between the primary IP addresses
    and aliases—it just keeps a list of IP addresses—but it will use the first address
    on its list as the source address unless told otherwise. If a host has multiple
    network connections, the source address of outgoing connections is the main IP
    address of the network interface on which packets leave the system.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD内核实际上并不区分主IP地址和别名——它只是保留一个IP地址列表——但它将使用列表中的第一个地址作为源地址，除非被告知否则。如果一个主机有多个网络连接，那么出站连接的源地址是数据包离开系统的网络接口的主IP地址。
- en: To remove an alias, use the `delete` option of `ifconfig` and give the IP address,
    without the netmask.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 要删除别名，请使用`ifconfig`的`delete`选项并给出IP地址，无需给出子网掩码。
- en: '[PRE17]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: For IPv6, use `inet6 delete` instead.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 对于IPv6，使用`inet6 delete`。
- en: '[PRE18]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Note
  id: totrans-122
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If you delete the main IP address on an interface, the first alias becomes the
    main IP address. If you have no IP address aliases remaining and you remove the
    interface’s main IP address, that interface stops passing IP traffic.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您删除了接口上的主IP地址，第一个别名将成为主IP地址。如果您没有剩余的IP地址别名，并且您移除了接口的主IP地址，那么该接口将停止传递IP流量。
- en: Configuring Default Routes
  id: totrans-124
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置默认路由
- en: Use `route(8)` to configure the default route for each protocol.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`route(8)`为每个协议配置默认路由。
- en: '[PRE19]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: An IPv6 default route is almost identical, but you must add the `-inet6` modifier.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: IPv6默认路由几乎相同，但您必须添加`-inet6`修饰符。
- en: '[PRE20]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: Once you add IP addresses and default routes to your host, you should be able
    to reach the rest of your network and the Internet. Now let’s see how to make
    those changes across reboots.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您为主机添加了IP地址和默认路由，您就应该能够访问您的整个网络和互联网。现在让我们看看如何在重新启动之间进行这些更改。
- en: Using Dynamic Configuration
  id: totrans-130
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用动态配置
- en: To have OpenBSD get an IPv4 address from a DHCP server, run `dhclient(8)` and
    give it the name of the interface you want to configure.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 要让OpenBSD从DHCP服务器获取IPv4地址，运行`dhclient(8)`并给它您想要配置的接口名称。
- en: '[PRE21]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '`dhclient` gets an IP address, overwrites */etc/resolv.conf*, and configures
    the default route.'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: '`dhclient`获取IP地址，覆盖`/etc/resolv.conf`，并配置默认路由。'
- en: For IPv6, run `rtsol(8)` instead.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 对于IPv6，运行`rtsol(8)`代替。
- en: '[PRE22]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Remember that IPv6 autoconfiguration will not configure your resolver. You’ll
    need to piggyback off your IPv4 DNS servers or manually configure */etc/resolv.conf*.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 记住，IPv6自动配置不会配置您的解析器。您需要从IPv4 DNS服务器那里获取帮助，或者手动配置`/etc/resolv.conf`。
- en: Configuring the Network at Boot
  id: totrans-137
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 启动时配置网络
- en: While `ifconfig(8)` is fine for changes on the fly, your system should configure
    its interfaces correctly at boot, including any aliases on the interface, any
    routes added when the interface comes up, and so on.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然`ifconfig(8)`可以用于即时更改，但您的系统应在启动时正确配置其接口，包括接口上的任何别名、接口启动时添加的任何路由等。
- en: Each interface has a configuration file, */etc/hostname.interfacename*, generically
    called *hostname.if*. The `fxp0` interface on my desktop uses a configuration
    file */etc/hostname.fxp0*, my wireless interface `wpi0` uses */etc/hostname.wpi0*,
    and so on. At boot, OpenBSD’s */etc/netstart* script reads all of the *hostname.if*
    files and, if it finds a matching physical interface or can create a matching
    logical interface, it configures the interface accordingly.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 每个接口都有一个配置文件，`/etc/hostname.interfacename`，通常称为`hostname.if`。我的台式机上的`fxp0`接口使用配置文件`/etc/hostname.fxp0`，无线接口`wpi0`使用`/etc/hostname.wpi0`，依此类推。在启动时，OpenBSD的`/etc/netstart`脚本读取所有的`hostname.if`文件，如果找到匹配的物理接口或可以创建匹配的逻辑接口，它将相应地配置接口。
- en: 'To configure an interface’s IPv4 address, enter a line in *hostname.if* in
    this format:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 要配置接口的IPv4地址，在`hostname.if`中输入以下格式的行：
- en: '[PRE23]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: The broadcast address and options are optional. To use options but not specify
    a broadcast address, use `NONE` for the broadcast address. You can also use a
    slash for the netmask instead of the decimal equivalent.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 广播地址和选项是可选的。要使用选项但不指定广播地址，请将广播地址设置为`NONE`。您还可以使用斜线代替十进制等价的子网掩码。
- en: 'Similarly, add an IPv6 address with the following:'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 类似地，添加IPv6地址如下：
- en: '[PRE24]'
  id: totrans-144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'To give `fxp0` the IPv4 address of 192.0.2.226 255.255.255.240 and the IPv6
    address of 2001:db8:0:12::2/64 at boot, use the following in */etc/hostname.fxp0*:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 要在启动时为`fxp0`分配IPv4地址192.0.2.226 255.255.255.240和IPv6地址2001:db8:0:12::2/64，请在`/etc/hostname.fxp0`中使用以下命令：
- en: '[PRE25]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Here, I also define an interface description that will show up in `ifconfig`
    output.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我还定义了一个将在`ifconfig`输出中显示的接口描述。
- en: To create an IP address alias at boot, use the `alias` keyword in *hostname.if*.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 要在启动时创建IP地址别名，请在`hostname.if`中使用`alias`关键字。
- en: '[PRE26]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: To run a command when the interface comes up, put an exclamation point in front
    of the command. Any commands run must be available on the root partition (for
    example, in */bin* or */sbin*). This feature is most commonly used for routing,
    but you could use other commands as well.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 要在接口启动时运行命令，请在命令前加上感叹号。必须运行的所有命令都必须在根分区上可用（例如，在`/bin`或`/sbin`中）。此功能最常用于路由，但您也可以使用其他命令。
- en: '[PRE27]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: To configure an interface dynamically, via DHCP (IPv4) or `rtsol` (IPv6), put
    the string `dhcp` or `rtsol` on a line by itself.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 要动态配置接口，通过DHCP（IPv4）或`rtsol`（IPv6），将字符串`dhcp`或`rtsol`单独放在一行上。
- en: '[PRE28]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Anything that’s not formatted as shown here is passed unedited to `ifconfig(8)`.
    For example, to run a specific `ifconfig` command, put the arguments on their
    own line in *hostname.if*.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 任何未按此处所示格式化的内容都将未经编辑传递给`ifconfig(8)`。例如，要运行特定的`ifconfig`命令，请在`hostname.if`中将参数单独放在一行上。
- en: '[PRE29]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: If you simply want to activate a card, but not configure it, use the word `up`
    on a line by itself to activate the interface.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您只想激活一张卡，但不配置它，请在单独的一行上使用单词`up`来激活接口。
- en: '[PRE30]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'And remember, you can test *hostname.if* changes with */etc/netstart*, specifying
    an interface name if appropriate, like so:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 并且记住，您可以使用`/etc/netstart`测试`hostname.if`更改，如果适当，指定接口名称，如下所示：
- en: '[PRE31]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Not including the interface name reconfigures all interfaces on the system.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 如果不包括接口名称，则重新配置系统上的所有接口。
- en: Trunking
  id: totrans-161
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 通道化
- en: Servers can have redundant hard drives, power supplies, and so on. OpenBSD supports
    redundant network connections by combining multiple Ethernet links into a single
    virtual link, or *trunk*. You might also know of this as *link aggregation*, *network
    adapter teaming*, or *bonding*.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 服务器可以有冗余硬盘、电源等。OpenBSD 通过将多个以太网链路组合成一个单独的虚拟链路或 *trunk* 来支持冗余网络连接。你可能也知道这被称为
    *链路聚合*、*网络适配器团队协作* 或 *绑定*。
- en: Note
  id: totrans-163
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Cisco people know of *trunks* as Ethernet links that support multiple concurrent
    VLANs. Most vendors, including OpenBSD, don’t use the word *trunk* in that way.
    OpenBSD supports sending multiple VLANs over a single link outside the `trunk(4)`
    functionality.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 思科人员将 *trunks* 理解为支持多个并发 VLAN 的以太网链路。大多数厂商，包括 OpenBSD，都不那样使用 *trunk* 这个词。OpenBSD
    支持在 `trunk(4)` 功能之外，通过单个链路发送多个 VLAN。
- en: Link Aggregation Protocols
  id: totrans-165
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 链路聚合协议
- en: To use multiple physical links as a single large link, you need a way to distribute
    traffic between the links. OpenBSD supports five different ways to distribute
    frames between trunk members, though not all will work in all environments. For
    a complete list see `trunk(4)`, but the protocols I recommend for real-world use
    are Link Aggregation Control Protocol (LACP), roundrobin, and failover. LACP is
    the industry standard for link aggregation. The physical interfaces are bonded
    into a single virtual interface with roughly the same bandwidth as the sum of
    the individual interfaces. LACP is very fault-tolerant, and just about every high-end
    managed switch should support it. If your switch supports LACP, use it, but you
    must configure LACP on the switch ports before this kind of trunk will pass traffic.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 要将多个物理链路作为单个大链路使用，你需要一种方法来在链路之间分配流量。OpenBSD 支持五种不同的方法在 trunk 成员之间分配帧，尽管并非所有方法都适用于所有环境。要获取完整列表，请参阅
    `trunk(4)`，但我推荐的适用于实际使用的协议是链路聚合控制协议 (LACP)、roundrobin 和故障转移。LACP 是链路聚合的行业标准。物理接口被绑定成一个具有与各个接口总和大致相同带宽的单个虚拟接口。LACP
    非常容错，几乎所有高端管理交换机都应该支持它。如果你的交换机支持 LACP，请使用它，但必须在这种类型的 trunk 传输流量之前在交换机端口上配置 LACP。
- en: In the roundrobin method, OpenBSD sends frames across the trunk’s active connections
    using a roundrobin scheduler. The trunk accepts incoming packets on any port,
    and a roundrobin scheduler rotates between the trunk connections, with error and
    edge handling added on top. Roundrobin trunks don’t need any special switch configuration;
    they just need two ports in the same VLAN.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 在 roundrobin 方法中，OpenBSD 使用 roundrobin 调度器通过 trunk 的活动连接发送帧。trunk 在任何端口上接受传入的包，并且
    roundrobin 调度器在 trunk 连接之间轮换，同时添加错误和边缘处理。roundrobin trunk 不需要任何特殊的交换机配置；只需要在同一
    VLAN 中的两个端口即可。
- en: In the case of failover, OpenBSD sends and receives all traffic over the first
    port in the trunk, and if that port fails, it switches to another active port.
    The failover method doesn’t give you any additional bandwidth, but requires absolutely
    no support from the switch, and it even works on old-fashioned hubs.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 在故障转移的情况下，OpenBSD 通过 trunk 的第一个端口发送和接收所有流量，如果该端口失败，则切换到另一个活动端口。故障转移方法不会给你提供额外的带宽，但绝对不需要交换机的支持，甚至可以在老式的集线器上工作。
- en: Trunk Configuration
  id: totrans-169
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: trunk 配置
- en: As an example, let’s configure ports `em0` and `em1` into failover trunk `trunk0`.
    The underlying ports have never been configured before, so begin by activating
    these interfaces without any configuration.
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，让我们将端口 `em0` 和 `em1` 配置为故障转移 trunk `trunk0`。底层端口之前从未配置过，因此首先在不进行任何配置的情况下激活这些接口。
- en: '[PRE32]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Now create the failover trunk with `ifconfig(8)` and add these ports to it to
    make the `trunk0` interface usable.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 现在创建故障转移 trunk，使用 `ifconfig(8)` 并将这些端口添加到其中，以使 `trunk0` 接口可用。
- en: '[PRE33]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: You could do this all in one long `ifconfig` command, but I find simpler, shorter
    commands easier to understand when learning.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以将所有这些都在一个长的 `ifconfig` 命令中完成，但我发现当学习时，更简单、更短的命令更容易理解。
- en: Assign the interface an IP address just as you would a physical interface, and
    add a default gateway to your system.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 就像为物理接口分配 IP 地址一样，为接口分配 IP 地址，并添加默认网关到你的系统中。
- en: '[PRE34]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: You should now have a failover trunk attached to your local network. To configure
    another trunk protocol, just specify the desired trunk protocol when you create
    the trunk. You’ll find a complete list of trunk protocols in `trunk(4)`.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 你现在应该有一个附加到本地网络的故障转移 trunk。要配置另一个 trunk 协议，只需在创建 trunk 时指定所需的 trunk 协议。你可以在
    `trunk(4)` 中找到完整的 trunk 协议列表。
- en: Trunks at Boot
  id: totrans-178
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 启动时的 trunk
- en: 'Configure your trunk in */etc/hostname.if*. For example, suppose you need to
    edit *hostname.em0*, *hostname.em1*, and *hostname.trunk0*. Both of the *em* files
    contain only a single word:'
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 在*/etc/hostname.if*中配置您的trunk。例如，假设您需要编辑*hostname.em0*、*hostname.em1*和*hostname.trunk0*。这两个*em*文件只包含一个单词：
- en: '[PRE35]'
  id: totrans-180
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: This activates the interfaces, but does no configuration.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 这激活了接口，但没有进行配置。
- en: '*hostname.trunk0* is more complicated.'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: '*hostname.trunk0*更为复杂。'
- en: '[PRE36]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: You can put all of these entries in a single line, just as you can configure
    the trunk with a single `ifconfig` command, but again, I find multiple lines easier
    to read and understand.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以将所有这些条目放在一行中，就像您可以使用单个`ifconfig`命令配置 trunk 一样，但再次强调，我发现多行更容易阅读和理解。
- en: Your trunk should now start at boot.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 您的trunk现在应该在启动时开始工作。
- en: 'Note that trunks do not necessarily need to consist of interfaces that use
    the same type of physical medium. If you’re feeling adventurous, you could try
    to replicate what some OpenBSD developers and users have been known to do: Trunk
    together a wired and a wireless network interface, and have all your connections
    survive (graceful failover, remember?) when you yank the plug out of your Ethernet
    port, or if you plug yourself back in and take your access point down for maintenance.'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，trunk不一定需要由使用相同类型物理介质的接口组成。如果您喜欢冒险，您可以尝试复制一些OpenBSD的开发者和用户已知的行为：将有线和无线网络接口连接起来作为trunk，当您从以太网端口拔掉插头，或者当您重新插入并关闭接入点进行维护时，所有连接都能正常工作（记住，要实现优雅的故障转移？）。
- en: VLANs
  id: totrans-187
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: VLANs
- en: VLANs are a way to get multiple Ethernet segments on a single piece of wire.
    You’ll sometimes see this referred to as *802.1q*, *tagging*, or a combination
    of these terms.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: VLANs是一种在单根线缆上实现多个以太网段的方法。您有时会看到它被称为*802.1q*、*标记*或这些术语的组合。
- en: In OpenBSD terms, one wire can carry multiple networks, and by configuring an
    additional interface, you can talk to those additional networks as if they had
    their own private wire. The wire can still carry only so much data, however, so
    all VLANs and the regular network (or *native VLAN*) that share the wire share
    the same pool of bandwidth.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 在OpenBSD术语中，一根线缆可以承载多个网络，通过配置额外的接口，您可以像它们有自己的专用线缆一样与这些额外的网络通信。然而，线缆仍然只能承载一定量的数据，所以所有共享线缆的VLAN和常规网络（或*原生VLAN*）共享相同的带宽池。
- en: VLAN frames that arrive at your network card are like regular Ethernet frames,
    with an additional header before the Ethernet frame that says “This is part of
    VLAN number such-and-such.” Each VLAN is identified by a number. VLAN number 1
    is usually the native VLAN—the VLAN that arrives without any tagging whatsoever.
    For convenience, I’ll use the word “tagged” to describe how the VLAN is delivered
    to your host.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 到达您的网络卡的VLAN帧就像常规的以太网帧一样，在以太网帧之前有一个额外的头部信息，表明“这是VLAN编号如此这般的部分。”每个VLAN都有一个编号。VLAN编号1通常是原生VLAN——没有任何标记到达的VLAN。为了方便，我将使用“标记”这个词来描述VLAN是如何发送到您的主机的。
- en: How would you use VLANs in OpenBSD? Perhaps you have a network divided into
    multiple Ethernet segments, such as outside the firewall, server area, and desktop
    clients. Or you might have one OpenBSD host that needs direct access to all of
    these segments. You could route all of these networks over a single physical wire.
    You might eventually hit bandwidth problems, but if you’re pushing more than 1Gpbs
    through your server, you can afford a second network card.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 您如何在OpenBSD中使用VLANs？也许您的网络被划分为多个以太网段，例如防火墙外、服务器区域和桌面客户端。或者，您可能有一个需要直接访问所有这些段落的OpenBSD主机。您可以将所有这些网络通过一根物理线缆进行路由。您可能会遇到带宽问题，但如果您通过服务器推送超过1Gbps的数据，您可以考虑添加第二块网络卡。
- en: Configuring Switches
  id: totrans-192
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置交换机
- en: You must configure your switch to send the VLANs to your OpenBSD box as 802.1q
    or tagged, depending on the switch’s syntax. Cisco uses *802.1q*, HP’s Procurve
    switches use *tagged*, and other vendors use whatever their prejudices dictate.
    There are dozens of different syntaxes to do this, so I won’t give a specific
    example. If the switch can’t send tagged VLANs to your server, you cannot use
    VLANs.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 您必须配置您的交换机将VLANs以802.1q或标记的形式发送到您的OpenBSD盒子上，具体取决于交换机的语法。思科使用*802.1q*，惠普的Procurve交换机使用*标记*，其他厂商则根据他们的偏见使用不同的方式。为此有数十种不同的语法，所以我不提供具体的示例。如果交换机不能将标记的VLAN发送到您的服务器，您将无法使用VLAN。
- en: Configuring VLAN Devices
  id: totrans-194
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置VLAN设备
- en: OpenBSD creates `vlan(4)` interfaces upon request. To create the device, you
    need to know which physical device you want to attach the VLAN to and the number
    of the VLAN you’re expecting.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD 在请求时会创建 `vlan(4)` 接口。要创建设备，你需要知道你想将 VLAN 连接到哪个物理设备以及你期望的 VLAN 号码。
- en: Create the `vlan` interface with `ifconfig`.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 `ifconfig` 创建 `vlan` 接口。
- en: '[PRE37]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: I number my `vlan` interfaces after the VLAN number they’re used for. (You could
    create interface `vlan0` and attach it to VLAN 3, but that’s too confusing for
    my feeble brain.) If you don’t specify the VLAN number, OpenBSD assigns the VLAN
    number from the number on the interface.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 我按照所使用的 VLAN 号码来编号我的 `vlan` 接口。（你可以创建接口 `vlan0` 并将其连接到 VLAN 3，但这对我那脆弱的大脑来说太复杂了。）如果你没有指定
    VLAN 号码，OpenBSD 会从接口上的号码分配 VLAN 号码。
- en: For example, here I create interface `vlan3` and use it to access VLAN 3 over
    interface `fxp0`.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，这里我创建了一个接口 `vlan3` 并使用它通过接口 `fxp0` 访问 VLAN 3。
- en: '[PRE38]'
  id: totrans-200
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'That’s really all there is to it. Now you can use `ifconfig` to display your
    new interface:'
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是全部内容。现在你可以使用 `ifconfig` 来显示你的新接口：
- en: '[PRE39]'
  id: totrans-202
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: This looks exactly like any physical interface, and from your point of view,
    it is. You can add IP addresses just as you would to any other interface, assign
    routes, and get on with your life.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 它看起来就像任何物理接口一样，从你的角度来看，它确实是。你可以像对其他任何接口一样添加 IP 地址，分配路由，然后继续你的生活。
- en: Configuring VLANs at Boot
  id: totrans-204
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 启动时配置 VLAN
- en: 'To configure a VLAN interface at boot time, create a *hostname.if* file for
    it. For example, here’s the contents of a */etc/hostname.vlan3* that creates the
    `vlan3` interface demonstrated in the previous section, assigns it to VLAN 3,
    and configures it automatically for both IPv4 and IPv6:'
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 要在启动时配置 VLAN 接口，为它创建一个 *hostname.if* 文件。例如，以下是一个 */etc/hostname.vlan3* 文件的内容，它创建了前一个部分中演示的
    `vlan3` 接口，将其分配给 VLAN 3，并自动配置 IPv4 和 IPv6：
- en: '[PRE40]'
  id: totrans-206
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: OpenBSD should find this file at boot and create the interface according to
    your commands.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: OpenBSD 应该在启动时找到这个文件，并根据你的命令创建接口。
- en: IPv6 Over Tunnels
  id: totrans-208
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 通过隧道使用 IPv6
- en: Let’s say you’ve taken my badgering to heart and decided to experiment with
    IPv6, but your ISP doesn’t offer IPv6\. How can you play with IPv6 when all you
    get is an IPv4 feed?
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 假设你已经认真考虑了我的建议，并决定尝试使用 IPv6，但你的 ISP 不提供 IPv6。当你只能得到 IPv4 提供的内容时，如何玩转 IPv6 呢？
- en: Many companies offer a free IPv6 tunnel service, where they will route you through
    an IPv6 tunnel over IPv4\. They will even give you an IPv6 /64 at no charge, so
    you can configure your home network for IPv6.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 许多公司提供免费的 IPv6 隧道服务，他们会通过 IPv4 隧道将你路由到 IPv6。他们甚至免费提供 IPv6 /64，这样你就可以为你的家庭网络配置
    IPv6。
- en: While I generally avoid recommending vendors in this book, I do recommend Hurricane
    Electric’s IPv6 tunnel service at *[http://www.tunnelbroker.net/](http://www.tunnelbroker.net/)*.
    Its web interface is intuitive, and it even provides configurations for OpenBSD
    clients.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然我通常避免在本书中推荐供应商，但我确实推荐Hurricane Electric的IPv6隧道服务，网址为*[http://www.tunnelbroker.net/](http://www.tunnelbroker.net/)*。它的Web界面直观，甚至为OpenBSD客户端提供配置。
- en: You should now have some understanding of managing IPv4 and IPv6 on OpenBSD.
    While your brain is recovering from all this stuff, we’ll turn to the topic of
    managing add-on software in OpenBSD.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 你现在应该对在 OpenBSD 上管理 IPv4 和 IPv6 有了一些了解。当你的大脑从所有这些信息中恢复过来时，我们将转向 OpenBSD 中管理附加软件的主题。
- en: '* * *'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[33](#id309258)]) Many people offer to ship me to Siberia. But they all forget
    to include a return ticket. Strange.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[33](#id309258)]) 许多人提出要把我送到西伯利亚。但他们都忘记包括一张返回票。奇怪。
