["```\n  1 /***********************************************\n  2  * Starts two threads                          *\n  3  *                                             *\n  4  *      1) Reads data from /dev/input and puts *\n  5  *              it into a buffer.              *\n  6  *                                             *\n  7  *      2) Takes data from the buffer and      *\n  8  *              writes the data to /dev/output.*\n  9  ***********************************************/\n 10 #include <cstdio>\n 11 #include <stdlib.h>\n 12 #include <pthread.h>\n 13 #include <unistd.h>\n 14 #include <sys/fcntl.h>\n 15\n 16 static const int BUF_SIZE = 1024;      // Buffer size\n 17 static char buffer[BUF_SIZE];          // The data buffer\n 18\n 19 // Pointer to end of buffer\n 20 static char *end_ptr = buffer + BUF_SIZE;\n 21\n 22 // Next character read goes here\n 23 static char *in_ptr = buffer;\n 24\n 25 // Next character written comes from here\n 26 static char *out_ptr = buffer;\n 27\n 28 static int count = 0;           // Number of characters in the buffer\n 29\n 30 /***********************************************\n 31 * reader -- Read data and put it in the global *\n 32 *      variable buffer.   When data is         *\n 33 *      installed the variable count is         *\n 34 *      increment and the buffer pointer        *\n 35 *      advanced.                               *\n 36 ************************************************/\n 37 static void *reader(void *) {\n 38     // File we are reading\n 39     int in_fd = open(\"/dev/input\", 0_RDONLY);\n 40\n 41     while (1) {\n 42         char ch; // Character we just got\n 43\n 44         while (count >= BUF_SIZE)\n 45             sleep(1);\n 46\n 47         read(in_fd, &ch, 1);\n 48\n 49         ++count;\n 50         *in_ptr = ch;\n 51         ++in_ptr;\n 52\n 53         if (in_ptr == end_ptr)\n 54             in_ptr = buffer;\n 55     }\n 56 }\n 57\n 58 /***********************************************\n 59  * writer -- Write data from the buffer to     *\n 60  *      the output device.   Gets the data     *\n 61  *      from the global buffer. Global variable*\n 62  *      count is decrement for each character  *\n 63  *      taken from the buffer and the buffer   *\n 64  *      pointer advanced.                      *\n 65  ***********************************************/\n 66 static void writer(void)\n 67 {\n 68     // Device to write to\n 69     int out_fd = open(\"/dev/output\", 0_RDONLY);\n 70\n 71     while (1) {\n 72         char ch;        // Character to transfer\n 73\n 74         while (count <= 0)\n 75             sleep(1);\n 76\n 77         ch = *out_ptr;\n 78\n 79         --count;\n 80         ++out_ptr;\n 81\n 82         if (out_ptr == end_ptr)\n 83             out_ptr = buffer;\n 84\n 85         write(out_fd, &ch, 1);\n 86    }\n 87 }\n 88\n 89 int main() {\n 90     int status; /* Status of last system call */\n 91\n 92     /* Information on the status thread */\n 93     pthread_t reader_thread;\n 94\n 95     status = pthread_create(&reader_hread, NULL, reader, NULL);\n 96\n 97     if (status != 0) {\n 98         perror(\"ERROR: Thread create failed:\\n       \");\n 99         exit (8);\n100    }\n101\n102    writer();\n103    return (0);\n104 }\n\n```"]