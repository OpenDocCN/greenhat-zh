<html><head></head><body>

<div class="calibre21" id="calibre_pb_0"/><div class="calibre1" id="calibre_toc_93">
<a name="ch07" class="calibre6" id="ch07"/>
<div class="calibre1">
<h2 class="lot-title" id="calibre_pb_1"><a name="96" class="calibre16" id="96"/><a name="ch07lev1sec2" class="calibre16" id="ch07lev1sec2"/><span class="chapter-titlelabel">Program 82: </span>The Case of the Disappearing Array</h2><p class="b24-bookeditorial">We have a simple array class and an even simpler test routine. Yet somehow memory gets corrupted.</p>
<div class="calibre1">
<pre class="literallayout-normal">
  1 /*************************************************
  2  * var_array -- Test variable length array       *
  3  *      class.                                   *
  4  *************************************************/
  5 #include &lt;memory.h&gt;
  6
  7 /*************************************************
  8  * var_array -- Variable length array            *
  9  *                                               *
 10  * Member functions:                             *
 11  *      operator [] -- Return a reference to     *
 12  *              the item in the array.           *
 13  *************************************************/
 14
 15 class var_array
 16 {
 17     private:
 18         int *data;      // The data
 19         const int size; // The size of the data
 20     public:
 21         // Create the var_array
 22         var_array(const int _size):
 23             size(_size)
 24         {
 25             data = new int[size];
 26             memset(data, '\0',
 27                     size * sizeof(int));
 28         }
 29         // Destroy the var_array
 30         ~var_array(void) {
 31             delete []data;
 32         }
 33     public:
 34         // Get an item in the array
 35         int &amp;operator [] (
 36             // Index into the array
 37             const unsigned index
 38         )
 39         {
 40             return (data[index]);
 41         }
 42 };
 43
 44 /************************************************
 45  * store_it -- Store data in the var_array      *
 46  ************************************************/
 47 static void store_it(
 48     // Array to use for storage
 49     var_array test_array
 50 )
 51 {
 52     test_array[1] = 1;
 53     test_array[3] = 3;
 54     test_array[5] = 5;
 55     test_array[7] = 7;
 56 }
 57 int main()
 58 {
 59     var_array test_array(30);
 60
 61     store_it(test_array);
 62     return (0);
 63 }
</pre>
</div>
<p class="b24-bookeditorial">(Next <a href="LiB0120.html#325" target="_parent" class="calibre2">Hint 189</a>. <a href="LiB0121.html#557" target="_parent" class="calibre2">Answer 59</a>.)</p>
<div class="calibre1">
<a name="97" class="calibre6" id="97"/><a name="ch07usb01" class="calibre6" id="ch07usb01"/>
<table class="calibre3" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr class="calibre4">
<td class="bluecell"><span class="calibre22"><b class="calibre13"><img src="_1.gif" alt="Start Sidebar" border="0" class="calibre23"/></b></span></td>
</tr>
</table>
<span><b class="calibre13">
<div class="calibre28" style="text-align:center">Oualline's Law of Documentation</div>
</b></span>
<p class="b24-bookeditorial">90 percent of the time, the documentation will be lost. Of the remaining 10 percent, 9 percent of the time it will be for an earlier version of the program and therefore completely useless. The 1 percent of the time you have the documentation and the correct revision of the documentation, it will be written in Japanese.</p>
<p class="b24-bookeditorial">I told this joke to a fellow working at Motorola and he laughed for a few minutes, then pulled out his manual to Hitachi FORTRAN, written in Japanese.</p>
<table class="calibre3" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr class="calibre4">
<td class="bluecell"><span class="calibre22"><b class="calibre13"><img src="_1.gif" alt="End Sidebar" border="0" class="calibre23"/></b></span></td>
</tr>
</table>
</div>
<table class="calibre3" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr class="calibre4">
<td height="16" class="calibre8"/>
</tr>
</table>
</div>
</div>



</body></html>