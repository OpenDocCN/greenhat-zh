<html><head></head><body>

<div class="calibre1"><div class="calibre1"><a name="samba_3.0.28" class="calibre8" id="samba_3.0.28"/>
<div class="calibre24" id="calibre_pb_0"/><h2 id="title-ID0ETVAO" class="docPrefaceTitle">Chapter 27. SAMBA 3.0.28</h2>
<h4 class="calibre32"><a class="calibre2" target="_blank" href="HTTP://WWW.SAMBA.ORG">HTTP://WWW.SAMBA.ORG</a></h4>
<a name="summary-id26" class="calibre8" id="summary-id26"/>
<h3 class="docSection1Title" id="-100000">27.1. SUMMARY</h3>
<p class="docText1"><a name="Samba is" class="calibre8" id="Samba is"/>Samba is an open source implementation of the <span class="docEmphasis1">SMB (Server Message Block)</span> and <span class="docEmphasis1"><a name="File System" class="calibre8" id="File System"/>CIFS (Common Internet File System)</span><a name="files and" class="calibre8" id="files and"/> protocols, which are used for sharing files and printers over a Microsoft network. Samba was created to provide Windows-compatible file and printer sharing services with UNIX-like systems.<a name="IDX-CHP-27-0401" class="calibre8" id="IDX-CHP-27-0401"/><a name="IDX-CHP-27-0402" class="calibre8" id="IDX-CHP-27-0402"/><a name="IDX-CHP-27-0403" class="calibre8" id="IDX-CHP-27-0403"/><a name="IDX-CHP-27-0404" class="calibre8" id="IDX-CHP-27-0404"/><a name="IDX-CHP-27-0405" class="calibre8" id="IDX-CHP-27-0405"/><a name="IDX-CHP-27-0406" class="calibre8" id="IDX-CHP-27-0406"/><a name="IDX-CHP-27-0407" class="calibre8" id="IDX-CHP-27-0407"/><a name="IDX-CHP-27-0408" class="calibre8" id="IDX-CHP-27-0408"/></p>
<p class="docText1"><a name="originally developed" class="calibre8" id="originally developed"/>SMB was originally developed to run atop the NetBIOS (Network Basic Input/Output System) protocol. However, because NetBIOS was conceived for small networks, it lacked routing capabilities, which limited SMB to local area networks. In 1996, Microsoft modified SMB so that it would not rely on NetBIOS, and renamed it Common Internet File System (CIFS). With the release of Windows 2000, SMB/CIFS was able to run atop TCP/IP.<a name="IDX-CHP-27-0409" class="calibre8" id="IDX-CHP-27-0409"/></p>
<p class="docText1"><a name="just like" class="calibre8" id="just like"/>Samba shares appear just like other shared folders in a Windows network. Access privileges can be cascaded over the normal Unix file permissions, and configurable restrictions based on login may be implemented as well. Unix users may also mount and access shares with the Samba client, which is similar to an FTP client. Samba consists of two daemons, namely smbd and nmbd. The SMB daemon handles file and print services as well as authentication. The NMB daemon handles name resolution and file browsing capability.</p>
<p class="docText1"><a name="early " class="calibre8" id="early "/>Dr. Barry Feigenbaum of IBM developed the SMB protocol in the early '80s as a solution for building small local area networks. Microsoft later built on the original SMB foundation and became the dominant user of the technology. Andrew Tridgell developed Samba in 1992 by reverse-engineering the SMB protocol to fit his needs. The Samba project is now a multi-national team and continues to develop new features.</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="resources-id26" class="calibre8" id="resources-id26"/>
<h3 class="docSection1Title" id="-100000">27.2. RESOURCES</h3>
<p class="docText1"><span class="b"><a name="Samba Documentation" class="calibre8" id="Samba Documentation"/>Samba Documentation</span></p>
<p class="docText1"><a class="calibre2" target="_blank" href="http://samba.org/samba/docs">http://samba.org/samba/docs</a></p>
<p class="docText1"><span class="b"><a name="Message Block" class="calibre8" id="Message Block"/>The Server Message Block Protocol</span></p>
<p class="docText1"><a class="calibre2" target="_blank" href="http://ubiqx.org/cifs/SMB.html">http://ubiqx.org/cifs/SMB.html</a></p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="required-id26" class="calibre8" id="required-id26"/>
<h3 class="docSection1Title" id="-100000">27.3. REQUIRED</h3>
<p class="docText1"><img border="0" id="" src="N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg" alt="" class="calibre33"/><a name="FreeBSD " class="calibre8" id="FreeBSD "/> FreeBSD 7.0-RELEASE (see "<a class="calibre2" href="freebsd_7.0_split_000.html#freebsd_7.0">FreeBSD 7.0</a>")</p>
<p class="docText1"><img border="0" id="" src="N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg" alt="" class="calibre33"/><a name="collection " class="calibre8" id="collection "/> Updated ports collection (see "<a class="calibre2" href="freebsd_ports_collection.html#freebsd_ports_collection">FreeBSD Ports Collection</a>")</p>
<p class="docText1"><img border="0" id="" src="N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg" alt="" class="calibre33"/> Internet connection</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="optional-id15" class="calibre8" id="optional-id15"/>
<h3 class="docSection1Title" id="-100000">27.4. OPTIONAL</h3>
<p class="docText1"><img border="0" id="" src="N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg" alt="" class="calibre33"/><a name="for printer" class="calibre8" id="for printer"/> CUPS, for printer sharing capability (see "<a class="calibre2" href="cups_print_server_1.3.3.html#cups_print_server_1.3.3">CUPS Print Server 1.3.3</a>")<a name="IDX-CHP-27-0410" class="calibre8" id="IDX-CHP-27-0410"/><a name="IDX-CHP-27-0411" class="calibre8" id="IDX-CHP-27-0411"/></p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="preparation-id26" class="calibre8" id="preparation-id26"/>
<h3 class="docSection1Title" id="-100000">27.5. PREPARATION</h3>
<p class="docText1"><a name="Become the" class="calibre8" id="Become the"/>Become the superuser.</p>
<p class="docText1"><a name="should exist" class="calibre8" id="should exist"/>System accounts should exist for users you want to allow access to Samba. If they don't exist, add them now with the <tt class="calibre20">adduser</tt> command. (See <a class="calibre2" href="managing_user_accounts.html#managing_user_accounts">Appendix C</a> for details on the <tt class="calibre20">adduser</tt> command.)</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="install-id26" class="calibre8" id="install-id26"/>
<h3 class="docSection1Title" id="-100000">27.6. INSTALL</h3>
<p class="docText1"><a name="To begin" class="calibre8" id="To begin"/>To begin the Samba installation process, enter the following commands:</p>
<pre class="calibre30"># <b class="calibre28">cd /usr/ports/net/samba3</b>
# <b class="calibre28">make config ; make install clean</b>
# <b class="calibre28">rehash</b></pre>
<p class="docText1"><a name="should appear" class="calibre8" id="should appear"/>A menu should appear with the available options for samba. Highlight <span class="b">LDAP</span><a name="the other" class="calibre8" id="the other"/> and press [spacebar] to deselect it. Leave the other options at their defaults by pressing [tab] to select <span class="b">OK</span><a name="to continue" class="calibre8" id="to continue"/> and then [enter] to continue.</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="configure-id26" class="calibre8" id="configure-id26"/>
<h3 class="docSection1Title" id="-100000">27.7. CONFIGURE</h3>
<p class="docText1"><a name="Once the" class="calibre8" id="Once the"/>Once the installation process completes, it is time to configure Samba for use on your system.</p>
<div class="calibre34"><ol class="docList" type="1"><li class="calibre16"><div class="calibre35"><p class="docText1">Change the <span class="docEmphasis1">smb.conf</span><a name="the" class="calibre8" id="the"/> file in the <span class="docEmphasis1">/usr/local/etc</span><a name="the file" class="calibre8" id="the file"/> directory to suit your system. First, open the file:</p><pre class="calibre30"># <b class="calibre28">ee /usr/local/etc/smb.conf</b></pre>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="to the" class="calibre8" id="to the"/>Scroll down to the <tt class="calibre20">workgroup</tt> declaration (~26) and replace <tt class="calibre20">MYGROUP</tt><a name="name that" class="calibre8" id="name that"/> with a workgroup name that matches your client systems. This line would appear as follows if you used a workgroup named <tt class="calibre20">EXAMPLE</tt>:</p><pre class="calibre30">workgroup = EXAMPLE</pre><br class="calibre1"/>
<hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> You can determine the workgroup name of a Windows PC by right-clicking My Computer and then selecting <span class="docEmphBoldItalic">Properties</span>. The workgroup name will be shown in the Name tab. You can also enter <tt class="calibre20"><i class="docEmphasis1">net config workstation</i></tt> at the command prompt to retrieve the workgroup name.</span><hr size="1" noshade="noshade" class="calibre27"/></div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Scroll down to the <tt class="calibre20">server string</tt> declaration (~29) and replace <tt class="calibre20">Samba Server</tt><a name="line should" class="calibre8" id="line should"/> with a name you would like to assign the server. The line should appear as follows:</p><pre class="calibre30">server string = <tt class="calibre20"><i class="docEmphasis1">Example FileServer</i></tt></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Scroll down to the <tt class="calibre20">hosts allow</tt><a name="to the" class="calibre8" id="to the"/> statement (~41). Samba will allow access to the IP addresses entered here. To allow connections from all clients, leave this line unmodified. To enable SMB connections on the local network, list <tt class="calibre20">192.168.1.</tt> (leaving the last octet blank means any addresses from .01 to .255) and <tt class="calibre20">127.</tt><a name="example below" class="calibre8" id="example below"/> (this means any address beginning with 127. is allowed), as shown in the example below. Be sure to uncomment this line by removing the semicolon (<tt class="calibre20">;</tt><a name="The line" class="calibre8" id="The line"/>) at the beginning of the line. The line should appear as follows:</p><pre class="calibre30">hosts allow = 192.168.1. 127.</pre><br class="calibre1"/>
<hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> You may enter full IP addresses here to limit connections to a specific client IP, separating each IP with a space, comma, or tab.</span><hr size="1" noshade="noshade" class="calibre27"/></div></li></ol></div>
<a name="configuring_shares" class="calibre8" id="configuring_shares"/>
<h4 id="title-ID0EX1AO" class="docSection1Title">27.7.1. Configuring Shares</h4>
<p class="docText1"><a name="be shared" class="calibre8" id="be shared"/>Now we'll create definitions that specify how directories will be shared. There are a variety of different configurations possible, but for now just create a simple share using one of these examples.<a name="IDX-CHP-27-0412" class="calibre8" id="IDX-CHP-27-0412"/></p>
<p class="docText1"><span class="b"><a name="Public Shares" class="calibre8" id="Public Shares"/>Public Shares</span></p>
<p class="docText1"><a name="example is" class="calibre8" id="example is"/>The following example is a share that allows all users to log into, read, delete, create, and modify files. This type of share is useful for users who wish to share files without restrictions. To implement this type of share, add the lines below to the end of the <span class="docEmphasis1">smb.conf</span><a name="name and" class="calibre8" id="name and"/> file. (You may substitute a different share name and path.)</p>
<div class="calibre1">
              Code View:</div><pre class="calibre30">[<tt class="calibre20"><i class="docEmphasis1">public</i></tt>]                       /* name of the share */
comment = Public Files         /* a short description of the share */
path = <tt class="calibre20"><i class="docEmphasis1">/usr/home/samba/</i></tt>public  /* path of shared directory */
public = yes                   /* password is not required to connect */
read only = no                 /* users may create, modify, and delete files */

					  </pre><br class="calibre1"/>
<p class="docText1"><span class="b">Private Shares</span></p>
<p class="docText1"><a name="following configuration" class="calibre8" id="following configuration"/>With the following configuration, only the users john and jane are allowed access. The files each user creates will have owner permissions of <tt class="calibre20">read</tt>, <tt class="calibre20">write</tt>, and <tt class="calibre20">execute</tt><a name="world permissions" class="calibre8" id="world permissions"/>. The group and world permissions will be read-only by default. This type of share is useful for sharing within small groups of people who wish to retain control of their files. To implement this type of share, add the lines below to the end of <span class="docEmphasis1">smb.conf</span> (substituting your choice of share name, path, and list of valid users).</p>
<div class="calibre1">
              Code View:</div><pre class="calibre30">[<tt class="calibre20"><i class="docEmphasis1">private</i></tt>]                       /* name of the share */
comment = Private Files         /* a short description of the share */
path = <tt class="calibre20"><i class="docEmphasis1">/usr/home/samba/</i></tt>private  /* path of shared directory */
valid users = <tt class="calibre20"><i class="docEmphasis1">john jane</i></tt>         /* users allowed to access this share */
public = no                     /* password required to access this share */
writable = yes                  /* users may create, modify, and delete */
                                /* files they own */

					  </pre><br class="calibre1"/>
<p class="docText1"><span class="b">Read-Only Shares</span></p>
<p class="docText1"><a name="a password" class="calibre8" id="a password"/>The configuration below allows everyone read-only access to the share without a password. Only users on the write list can create, modify, and delete files they own in the share. This type of share is useful to publish files for public access while giving authors or administrators the ability to retain control of their content. To implement this type of share, add the lines below to the end of <span class="docEmphasis1">smb.conf</span><a name="and list" class="calibre8" id="and list"/>, substituting your choice of share name, path, and list of users with write access.</p>
<div class="calibre1">
              Code View:</div><pre class="calibre30">[<tt class="calibre20"><i class="docEmphasis1">readonly</i></tt>]                        /* name of share */
comment = <tt class="calibre20"><i class="docEmphasis1">Read Only Shares</i></tt>        /* a short description of the share */
path = <tt class="calibre20"><i class="docEmphasis1">/usr/home/samba/</i></tt>readonly   /* path of shared directory */
public = yes                      /* password is not required to connect */
write list = <tt class="calibre20"><i class="docEmphasis1">bert ernie</i></tt>           /* users allowed write access */
writable = yes                    /* write list users may create, modify, */
                                  /* and delete files they own */

					  </pre><br class="calibre1"/>
<p class="docText1"><span class="b">Printers</span></p>
<p class="docText1"><a name="to authenticated" class="calibre8" id="to authenticated"/>By default, all configured printers in CUPS are shared and available to authenticated users. If you need to apply access restrictions to printers, please see "<a class="calibre2" href="notes.html#notes">Notes</a>" .</p>
<p class="docText1"><span class="b">Finishing</span></p>
<p class="docText1"><a name="your shares" class="calibre8" id="your shares"/>When you are satisfied with your shares configuration, save and exit.</p>
<p class="docText1">Test the <span class="docEmphasis1">smb.conf</span> file for syntax errors:</p>
<pre class="calibre30"># <b class="calibre28">testparm</b></pre><br class="calibre1"/>
<p class="docText1"><a name="them if" class="calibre8" id="them if"/>Examine the output for any errors and correct them if necessary. Make sure the paths you specified in your share definitions exist. If they don't, create them now.</p>
<a name="setting_share_permissions" class="calibre8" id="setting_share_permissions"/>
<h4 id="title-ID0ED5AO" class="docSection1Title">27.7.2. Setting Share Permissions</h4>
<p class="docText1"><a name="The sections" class="calibre8" id="The sections"/>The sections below correspond to the example share configurations mentioned previously. For example, if you created a public share in the last section, proceed to "Public Share Permissions." When you have completed setting permissions for your configured shares, proceed to "<a class="calibre2" href="testing-id17.html#testing-id17">Testing</a>".<a name="IDX-CHP-27-0413" class="calibre8" id="IDX-CHP-27-0413"/></p>
<p class="docText1"><span class="b">Public Share Permissions</span></p>
<p class="docText1"><a name="will be" class="calibre8" id="will be"/>If you will be hosting a public share, you will need to set the permissions on the public share directory to mode <tt class="calibre20">777</tt><a name="users the" class="calibre8" id="users the"/> in order to allow all users the ability to create, modify, and delete files. For example, the command below would set the required permissions on the <span class="docEmphasis1">/usr/home/samba/public</span> directory:</p>
<pre class="calibre30"># <b class="calibre28">chmod 777 /usr/home/samba/public</b></pre><br class="calibre1"/>
<p class="docText1"><span class="b">Private Share Permissions</span></p>
<p class="docText1"><a name="will be" class="calibre8" id="will be"/>If you will be hosting a private share, you will need to set the permissions on the private share directory to mode <tt class="calibre20">770</tt><a name="root and" class="calibre8" id="root and"/>. This will allow root and the members of the group full access to the directory (we will also create the group).</p>
<p class="docText1"><a name="this directory" class="calibre8" id="this directory"/>Because we want only the users we specify to access this directory, we need to create a new group and add them as members. As an example, we'll create a group called smbprivate with the users john and jane as members.</p>
<p class="docText1"><a name="the group" class="calibre8" id="the group"/>The following commands will create the group smbprivate, change the <span class="docEmphasis1">/usr/home/samba/private</span><a name="any group" class="calibre8" id="any group"/> directory's ownership to this new group, and set the correct permissions. (You can use any group name you like.)</p>
<pre class="calibre30"># <b class="calibre28">pw groupadd smbprivate -M john,jane</b>
# <b class="calibre28">chgrp smbprivate /usr/home/samba/private</b>
# <b class="calibre28">chmod 770 /usr/home/samba/private</b></pre><br class="calibre1"/>
<p class="docText1"><a name="path as" class="calibre8" id="path as"/>Substitute your own usernames, group name, and path as appropriate.</p>
<p class="docText1"><span class="b">Read-Only Share Permissions</span></p>
<p class="docText1"><a name="need to" class="calibre8" id="need to"/>If you will be hosting a read-only share, you will need to set the permissions on the read-only share directory to mode <tt class="calibre20">770</tt><a name="This will" class="calibre8" id="This will"/>. This will allow root and the members of the group full access to the directory.</p>
<p class="docText1"><a name="want only" class="calibre8" id="want only"/>Because we want only the users we specified in the write list to access this directory, we need to create a new group and add these users as members. As an example, we will create a new group called smbreadonly with users bert and ernie as members.</p>
<p class="docText1"><a name="the group" class="calibre8" id="the group"/>The following commands will create the group, change the <span class="docEmphasis1">/usr/home/samba/private</span><a name="this new" class="calibre8" id="this new"/> directory's ownership to this new group, and set the correct permissions.</p>
<pre class="calibre30"># <b class="calibre28">pw groupadd</b> <span class="docEmphBoldItalic">smbreadonly</span> <b class="calibre28">-M</b> <span class="docEmphBoldItalic">bert</span><b class="calibre28">,</b><span class="docEmphBoldItalic">ernie</span>
# <b class="calibre28">chgrp</b> <span class="docEmphBoldItalic">smbreadonly /usr/home/samba/readonly</span>
# <b class="calibre28">chmod 770</b> <span class="docEmphBoldItalic">/usr/home/samba/readonly</span></pre><br class="calibre1"/>
<p class="docText1"><a name="group name" class="calibre8" id="group name"/>Substitute your own usernames, group name, and path as appropriate.</p>
<a name="adding_users" class="calibre8" id="adding_users"/>
<h4 id="title-ID0EOBBO" class="docSection1Title">27.7.3. Adding Users</h4>
<p class="docText1"><a name="wish to" class="calibre8" id="wish to"/>Create Samba user accounts and passwords for the users you wish to allow Samba access. The usernames you specify should match those of their existing system accounts. To set up a new user, use the <tt class="calibre20">smbpasswd</tt> command (replacing <tt class="calibre20"><i class="docEmphasis1">username</i></tt><a name="to create" class="calibre8" id="to create"/> with the username you wish to create):</p>
<pre class="calibre30"># <b class="calibre28">smbpasswd -a</b> <span class="docEmphBoldItalic">username</span></pre><br class="calibre1"/>
<p class="docText1">After entering a password, you should see:</p>
<pre class="calibre30">Added user <tt class="calibre20"><i class="docEmphasis1">username</i></tt></pre><br class="calibre1"/>
<p class="docText1">Repeat this for any other users you'd like to add.</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="testing-id17" class="calibre8" id="testing-id17"/>
<h3 class="docSection1Title" id="-100000">27.8. TESTING</h3>
<p class="docText1"><a name="In this" class="calibre8" id="In this"/>In this section, we'll perform some basic tests to confirm that Samba answers SMB/CIFS requests properly.<a name="IDX-CHP-27-0414" class="calibre8" id="IDX-CHP-27-0414"/></p>
<div class="calibre34"><ol class="docList" type="1"><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="command to" class="calibre8" id="command to"/>Enter this command to start the SMB daemon for testing:</p><pre class="calibre30"># <b class="calibre28">/usr/local/etc/rc.d/samba onestart</b></pre>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="Samba is" class="calibre8" id="Samba is"/>To list the available shares Samba is hosting, use the following command:</p><pre class="calibre30"># <b class="calibre28">smbclient -U</b> <span class="docEmphBoldItalic">username</span> <b class="calibre28">-L localhost</b></pre><br class="calibre1"/>
<p class="docText1">Replace <tt class="calibre20"><i class="docEmphasis1">username</i></tt><a name="valid Samba" class="calibre8" id="valid Samba"/> with a valid Samba user. After entering the user's password, you should see the list of shares you configured earlier.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="and browse" class="calibre8" id="and browse"/>To log in and browse a share, enter:</p><pre class="calibre30"># <b class="calibre28">smbclient -U</b> <span class="docEmphBoldItalic">username</span> <b class="calibre28">//localhost/</b><span class="docEmphBoldItalic">sharename</span></pre><br class="calibre1"/>
<p class="docText1">Once login is complete, you should see an <tt class="calibre20">smb: \&gt;</tt><a name="as" class="calibre8" id="as"/> prompt. You may then navigate the share with common Unix commands, such as <tt class="calibre20">cd</tt> and <tt class="calibre20">ls</tt>. Enter <tt class="calibre20"><b class="calibre28">quit</b></tt> to exit.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="the Samba" class="calibre8" id="the Samba"/>If the tests were successful, configure the Samba server to start automatically at boot time. Open <span class="docEmphasis1">/etc/rc.conf</span>:</p><pre class="calibre30"># <b class="calibre28">ee /etc/rc.conf</b></pre><br class="calibre1"/>
<p class="docText1">and then add the following line:</p><pre class="calibre30">samba_enable="YES"</pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Save, exit, and restart Samba:</p><pre class="calibre30"># <b class="calibre28">/usr/local/etc/rc.d/samba restart</b>
# <b class="calibre28">/usr/local/etc/rc.d/samba status</b></pre><br class="calibre1"/>
<hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> You can run the <tt class="calibre20"><i class="docEmphasis1">status</i></tt> command for confirmation that the Samba service started.</span><hr size="1" noshade="noshade" class="calibre27"/></div></li></ol></div>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="utilities-id9" class="calibre8" id="utilities-id9"/>
<h3 class="docSection1Title" id="-100000">27.9. UTILITIES</h3>
<p class="docText1"><a name="Following is" class="calibre8" id="Following is"/>Following is brief information on the smbpasswd and pdbedit utilities, which are used to maintain user passwords and policies. This section also covers SWAT, an alternative interface for Samba administration.<a name="IDX-CHP-27-0415" class="calibre8" id="IDX-CHP-27-0415"/></p>
<a name="smbpasswd" class="calibre8" id="smbpasswd"/>
<h4 id="title-ID0ECZAO" class="docSection1Title">27.9.1. smbpasswd</h4>
<p class="docText1"><a name="manages users" class="calibre8" id="manages users"/>This utility manages users' Samba passwords.</p>
<dl class="docList1">
<dt class="calibre1"><p class="calibre23"><span class="docPubcolor"><span class="b">Command</span></span></p></dt>
<dd class="calibre36"><p class="docText1"><tt class="calibre20">smbpasswd</tt></p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"><span class="b">Syntax</span></span></p></dt>
<dd class="calibre36"><p class="docText1"><tt class="calibre20">smbpasswd -</tt><tt class="calibre20"><i class="docEmphasis1">options username</i></tt></p></dd>
</dl>
<p class="docText1"><span class="b">Options</span></p>
<dl class="docList1">
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">-a</pre></p></dt>
<dd class="calibre36"><p class="docText1"><a name="Samba password" class="calibre8" id="Samba password"/>Adds a user to the Samba password file</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">-x</pre></p></dt>
<dd class="calibre36"><p class="docText1"><a name="user from" class="calibre8" id="user from"/>Deletes a user from the Samba password file</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">-d</pre></p></dt>
<dd class="calibre36"><p class="docText1">Disables a user</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">-e</pre></p></dt>
<dd class="calibre36"><p class="docText1"><a name="if previously" class="calibre8" id="if previously"/>Enables a user if previously disabled</p></dd>
</dl>
<p class="docText1"><span class="b">Examples</span></p>
<p class="docText1">To add the user jake to the Samba password file, enter:</p>
<pre class="calibre30"># <b class="calibre28">smbpasswd -a jake</b></pre><br class="calibre1"/>
<p class="docText1">To disable the user webster, enter:</p>
<pre class="calibre30"># <b class="calibre28">smbpasswd -d webster</b></pre><br class="calibre1"/>
<hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> If a user has shell access to your server, he may change his password by entering <tt class="calibre20"><i class="docEmphasis1">smbpasswd</i></tt> with no arguments.</span><hr size="1" noshade="noshade" class="calibre27"/>
<a name="pdbedit" class="calibre8" id="pdbedit"/>
<h4 id="title-ID0EM3AO" class="docSection1Title">27.9.2. pdbedit</h4>
<p class="docText1"><a name="usable by" class="calibre8" id="usable by"/>This utility manages users in the Samba user database. It is usable by root only.</p>
<a name="IDX-CHP-27-0416" class="calibre8" id="IDX-CHP-27-0416"/><dl class="docList1">
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"><span class="b">Command</span></span></p></dt>
<dd class="calibre36"><p class="docText1"><tt class="calibre20">pdbedit</tt><a name="IDX-CHP-27-0416" class="calibre8" id="IDX-CHP-27-0416"/></p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"><span class="b">Syntax</span></span></p></dt>
<dd class="calibre36"><p class="docText1"><tt class="calibre20">pdbedit -</tt><tt class="calibre20"><i class="docEmphasis1">option</i></tt> <tt class="calibre20"><i class="docEmphasis1">argument</i></tt></p></dd>
</dl>
<p class="docText1"><span class="b">Options</span></p>
<dl class="docList1">
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">-a</pre></p></dt>
<dd class="calibre36"><p class="docText1">Adds a user</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">-u</pre></p></dt>
<dd class="calibre36"><p class="docText1">Specifies user to manage</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">-f</pre></p></dt>
<dd class="calibre36"><p class="docText1">Specifies user's full name</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">-v</pre></p></dt>
<dd class="calibre36"><p class="docText1">Verbose listing format</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">-L</pre></p></dt>
<dd class="calibre36"><p class="docText1">Lists all users in the database</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">-x</pre></p></dt>
<dd class="calibre36"><p class="docText1">Deletes a user</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">-P</pre></p></dt>
<dd class="calibre36"><p class="docText1"><a name="Valid arguments" class="calibre8" id="Valid arguments"/>Displays account policy and current value. Valid arguments include:</p>
<p class="calibre23"><table cellspacing="0" border="1" width="100%" class="calibre9"><colgroup span="2" class="calibre40"><col class="calibre41"/><col class="calibre41"/></colgroup><thead class="calibre42"/><tr class="calibre4"><td class="docTableCell" valign="top"><tt class="calibre20">minimum password age</tt></td><td class="docTableCell" valign="top"><tt class="calibre20">bad lockout attempt</tt></td></tr><tr class="calibre4"><td class="docTableCell" valign="top"><tt class="calibre20">maximum password age</tt></td><td class="docTableCell" valign="top"><tt class="calibre20">reset count minutes</tt></td></tr><tr class="calibre4"><td class="docTableCell" valign="top"><tt class="calibre20">min password length</tt></td><td class="docTableCell" valign="top"><tt class="calibre20">disconnect time</tt></td></tr><tr class="calibre4"><td class="docTableCell" valign="top"><tt class="calibre20">password history</tt></td><td class="docTableCell" valign="top"><tt class="calibre20">user must logon to change password</tt></td></tr><tr class="calibre4"><td class="docTableCell" valign="top"><tt class="calibre20">lockout duration</tt></td><td class="docTableCell" valign="top"><tt class="calibre20">refuse machine password change</tt></td></tr></table></p><br class="calibre1"/>
</dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">-C</pre></p></dt>
<dd class="calibre36"><p class="docText1">Changes account policy value</p></dd>
</dl>
<p class="docText1"><span class="b">Examples</span></p>
<p class="docText1"><a name="with the" class="calibre8" id="with the"/>To add a user John Doe to the Samba database with the username john, enter:</p>
<pre class="calibre30"># <b class="calibre28">pdbedit -a -u john -f "John Doe"</b></pre><br class="calibre1"/>
<p class="docText1"><a name="the database" class="calibre8" id="the database"/>To list all users in the database verbosely, enter:</p>
<pre class="calibre30"># <b class="calibre28">pdbedit -L -v</b></pre><br class="calibre1"/>
<p class="docText1">To display the minimum password length account policy, enter:</p>
<pre class="calibre30"># <b class="calibre28">pdbedit -P "min password length"</b></pre><br class="calibre1"/>
<p class="docText1">To change the minimum password length to 8, enter:</p>
<pre class="calibre30"># <b class="calibre28">pdbedit -P "min password length" -C 8</b></pre><br class="calibre1"/>
<p class="docText1">See pdbedit's man page for more options:</p>
<pre class="calibre30"># <b class="calibre28">man pdbedit</b></pre><br class="calibre1"/>
<a name="enabling_swat" class="calibre8" id="enabling_swat"/>
<h4 id="title-ID0EHEBO" class="docSection1Title">27.9.3. Enabling SWAT</h4>
<p class="docText1"><a name="Samba administration" class="calibre8" id="Samba administration"/>SWAT (Samba Web Administration Tool) provides an easy-to-use alternative interface for Samba administration. SWAT is run from FreeBSD's built-in Internet super-server (inetd). To enable SWAT, follow these steps.<a name="IDX-CHP-27-0417" class="calibre8" id="IDX-CHP-27-0417"/><a name="IDX-CHP-27-0418" class="calibre8" id="IDX-CHP-27-0418"/></p>
<div class="calibre34"><ol class="docList" type="1"><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="Open" class="calibre8" id="Open"/>Open <span class="docEmphasis1">inetd.conf</span>:</p><pre class="calibre30"># <b class="calibre28">ee /etc/inetd.conf</b></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Uncomment the <tt class="calibre20">swat</tt><a name="should appear" class="calibre8" id="should appear"/> declaration (~120). It should appear now as follows:</p><pre class="calibre30">swat  stream  tcp  nowait/400  root  /usr/local/sbin/swat  swat</pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Save and exit.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="run at" class="calibre8" id="run at"/>Unless you've specifically configured inetd to run at boot time, enter the following to start the service:</p><pre class="calibre30"># <b class="calibre28">/etc/rc.d/inetd onestart</b></pre><br class="calibre1"/>
<p class="docText1"><a name="the SWAT" class="calibre8" id="the SWAT"/>To access the SWAT interface, navigate to <a class="calibre2" target="_blank" href="http://host.example.com:901">http://host.example.com:901</a><a name="browser " class="calibre8" id="browser "/> with a web browser (substitute your server's hostname). Log in as root to access the administrative functions.</p><hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> Be aware that your login and password are transmitted in the clear. If you cannot ensure the security of your network, do not use this utility. Use a secure solution like manual configuration via SSH or a browser, like Lynx (see "<a class="calibre2" href="lynx_2.8.6.html#lynx_2.8.6">Lynx 2.8.6</a>"), on the server console. Do not use this utility from outside your network unless you have taken steps to encrypt the transmission of your root password using something like a secure VPN tunnel.</span><hr size="1" noshade="noshade" class="calibre27"/></div></li></ol></div>
<p class="docText1"><a name="inetd as" class="calibre8" id="inetd as"/>Once configuration of Samba with SWAT is complete, you may terminate inetd as follows:</p>
<pre class="calibre30"># <b class="calibre28">/etc/rc.d/inetd stop</b></pre><br class="calibre1"/>
<p class="docText1"><a name="boot time" class="calibre8" id="boot time"/>To start inetd automatically at boot time, add the following line to <span class="docEmphasis1">/etc/rc.conf</span> :</p>
<pre class="calibre30">inetd_enable="YES"</pre><br class="calibre1"/>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="config_files-id26" class="calibre8" id="config_files-id26"/>
<h3 class="docSection1Title" id="-100000">27.10. CONFIG FILES</h3>
<p class="docText1"><span class="b">/usr/local/etc/smb.conf</span><a name="IDX-CHP-27-0419" class="calibre8" id="IDX-CHP-27-0419"/><a name="IDX-CHP-27-0420" class="calibre8" id="IDX-CHP-27-0420"/><a name="IDX-CHP-27-0421" class="calibre8" id="IDX-CHP-27-0421"/></p>
<p class="docText1"><a name="The main" class="calibre8" id="The main"/>The main configuration file for Samba</p>
<p class="docText1"><span class="b">/usr/local/etc/samba/smbpasswd</span></p>
<p class="docText1"><a name="encrypted password" class="calibre8" id="encrypted password"/>The Samba encrypted password file; it is created by the smbpasswd utility and contains usernames and hashed passwords for SMB users</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="log_files-id15" class="calibre8" id="log_files-id15"/>
<h3 class="docSection1Title" id="-100000">27.11. LOG FILES</h3>
<p class="docText1"><span class="b">/var/log/samba</span></p>
<p class="docText1"><a name="Contains log" class="calibre8" id="Contains log"/>Contains log files for Samba activity and hosts that have connected to a Samba share</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="notes-id20" class="calibre8" id="notes-id20"/>
<h3 class="docSection1Title" id="-100000">27.12. NOTES</h3>
<ul class="calibre15"><li class="calibre16"><p class="docText1"><a name="If you" class="calibre8" id="If you"/>If you have CUPS installed and configured without access restrictions, all authenticated Samba users will have permission to print to any installed printer. To restrict printing privileges to specific users, you must modify <span class="docEmphasis1">/etc/smb.conf</span>. First, open <span class="docEmphasis1">smb.conf</span> :<a name="IDX-CHP-27-0422" class="calibre8" id="IDX-CHP-27-0422"/><a name="IDX-CHP-27-0423" class="calibre8" id="IDX-CHP-27-0423"/></p><pre class="calibre30"># <b class="calibre28">ee /usr/local/etc/smb.conf</b></pre>
<p class="docText1"><a name="the bottom" class="calibre8" id="the bottom"/>Scroll to the bottom of <span class="docEmphasis1">smb.conf</span> using [ctrl-U] and add the following lines:</p><pre class="calibre30">[printers] valid users = username</pre><br class="calibre1"/>
<p class="docText1">Replace <tt class="calibre20"><i class="docEmphasis1">username</i></tt><a name="want to" class="calibre8" id="want to"/> with the username(s) of the person(s) you want to allow print privileges (separate multiple users with spaces).</p><p class="docText1">Save, exit, and restart Samba:</p><pre class="calibre30"># <b class="calibre28">/usr/local/etc/rc.d/samba restart</b></pre><br class="calibre1"/>
</li><li class="calibre16"><p class="docText1"><a name="configured CUPS" class="calibre8" id="configured CUPS"/>If you configured CUPS printing without access restrictions, consider disabling IPP (Internet Printing Protocol) since you are trying to restrict printing access to specific users. To prevent CUPS from accepting direct IPP print requests, edit the <span class="docEmphasis1">cupsd.conf</span> file. First, open <span class="docEmphasis1">cupsd.conf</span>:</p><pre class="calibre30"># <b class="calibre28">ee /usr/local/etc/cups/cupsd.conf</b></pre><br class="calibre1"/>
<p class="docText1"><a name="the bottom" class="calibre8" id="the bottom"/>Scroll down to the bottom of the <span class="docEmphasis1">cupsd.conf</span> file using [ctrl-U] and add the following lines:</p><pre class="calibre30">&lt;Location /printers&gt;
Order Deny,Allow
Deny From All
Allow From 127.0.0.1
&lt;/Location&gt;</pre><br class="calibre1"/>
<p class="docText1"><a name="printing requests" class="calibre8" id="printing requests"/>This directive will cause CUPS to reject all direct IPP printing requests and instead accept only Samba-relayed print jobs.</p><p class="docText1">Save, exit, and restart CUPS:</p><pre class="calibre30"># <b class="calibre28">/usr/local/etc/rc.d/cupsd restart</b></pre><br class="calibre1"/>
</li><li class="calibre16"><p class="docText1"><a name="a delay" class="calibre8" id="a delay"/>Windows XP SP2 systems may experience a delay when selecting a Samba printer in some applications or when attempting to access printer properties. This may be resolved by removing Windows registry entries that refer to the Samba hosted printer. The locations of the registry entries are as follows:</p><p class="docText1">HKEY_CURRENT_USER\Printers\DevModePerUser</p><p class="docText1">HKEY_CURRENT_USER\Printers\DevModes2</p><p class="docText1">Delete <span class="docEmphasis1">\\ samba_server_name \ printer_name</span>.</p><hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> Use caution when modifying the Windows registry.</span><hr size="1" noshade="noshade" class="calibre27"/></li></ul>
</div></div>

</body></html>