<html><head></head><body>

<div class="calibre1"><div class="calibre1"><a name="postfix_smtp_server_2.5.1" class="calibre8" id="postfix_smtp_server_2.5.1"/>
<div class="calibre24" id="calibre_pb_0"/><h2 id="title-ID0EBKAO" class="docPrefaceTitle">Chapter 24. POSTFIX SMTP SERVER 2.5.1</h2>
<h4 class="calibre32"><a class="calibre2" target="_blank" href="HTTP://WWW.POSTFIX.ORG">HTTP://WWW.POSTFIX.ORG</a></h4>
<a name="summary-id23" class="calibre8" id="summary-id23"/>
<h3 class="docSection1Title" id="-100000">24.1. SUMMARY</h3>
<p class="docText1"><a name="Postfix is" class="calibre8" id="Postfix is"/>Postfix is an open source mail transfer agent (MTA). An <span class="docEmphasis1">MTA</span><a name="for routing" class="calibre8" id="for routing"/> is used for routing and delivering email on the Internet. Postfix was originally developed as an alternative to the widely deployed Sendmail MTA. Like Sendmail, Postfix operates using SMTP. An emphasis on security was placed on its development in response to Sendmail's history of security-related problems.<a name="IDX-CHP-24-0343" class="calibre8" id="IDX-CHP-24-0343"/><a name="IDX-CHP-24-0344" class="calibre8" id="IDX-CHP-24-0344"/><a name="IDX-CHP-24-0345" class="calibre8" id="IDX-CHP-24-0345"/><a name="IDX-CHP-24-0346" class="calibre8" id="IDX-CHP-24-0346"/><a name="IDX-CHP-24-0347" class="calibre8" id="IDX-CHP-24-0347"/><a name="IDX-CHP-24-0348" class="calibre8" id="IDX-CHP-24-0348"/><a name="IDX-CHP-24-0349" class="calibre8" id="IDX-CHP-24-0349"/><a name="IDX-CHP-24-0350" class="calibre8" id="IDX-CHP-24-0350"/></p>
<p class="docText1"><a name="for secure" class="calibre8" id="for secure"/>Postfix supports SASL and TLS for secure connections, as well as the Maildir mailbox format (adopted from the Qmail MTA). Postfix is the default MTA for several Linux distributions, NetBSD, and the latest incarnations of Apple's Mac OS X.<a name="IDX-CHP-24-0351" class="calibre8" id="IDX-CHP-24-0351"/><a name="IDX-CHP-24-0352" class="calibre8" id="IDX-CHP-24-0352"/></p>
<p class="docText1"><a name="computer security" class="calibre8" id="computer security"/>Wietse Venema, a computer security specialist and IBM researcher, wrote Postfix in 1998. IBM released Venema's software (then named IBM Secure Mailer) as open source, in hopes that it would become widely adopted to create a faster and more secure email infrastructure. This release helped IBM develop its open source strategy, which was gaining popularity at the time.<a name="IDX-CHP-24-0353" class="calibre8" id="IDX-CHP-24-0353"/></p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="resources-id23" class="calibre8" id="resources-id23"/>
<h3 class="docSection1Title" id="-100000">24.2. RESOURCES</h3>
<p class="docText1"><span class="b"><a name="Postfix Documentation" class="calibre8" id="Postfix Documentation"/>Postfix Documentation</span></p>
<p class="docText1"><a class="calibre2" target="_blank" href="http://www.postfix.org/documentation.html">http://www.postfix.org/documentation.html</a></p>
<p class="docText1"><span class="b"><a name="Mail Transfer" class="calibre8" id="Mail Transfer"/>RFC 2821 - Simple Mail Transfer Protocol</span></p>
<p class="docText1"><a class="calibre2" target="_blank" href="http://tools.ietf.org/html/rfc2821">http://tools.ietf.org/html/rfc2821</a></p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="required-id23" class="calibre8" id="required-id23"/>
<h3 class="docSection1Title" id="-100000">24.3. REQUIRED</h3>
<p class="docText1"><img border="0" id="" src="N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg" alt="" class="calibre33"/><a name="FreeBSD " class="calibre8" id="FreeBSD "/> FreeBSD 7.0-RELEASE (see "<a class="calibre2" href="freebsd_7.0_split_000.html#freebsd_7.0">FreeBSD 7.0</a>")</p>
<p class="docText1"><img border="0" id="" src="N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg" alt="" class="calibre33"/><a name="collection " class="calibre8" id="collection "/> Updated ports collection (see "<a class="calibre2" href="freebsd_ports_collection.html#freebsd_ports_collection">FreeBSD Ports Collection</a>")</p>
<p class="docText1"><img border="0" id="" src="N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg" alt="" class="calibre33"/> Internet connection</p>
<p class="docText1"><img border="0" id="" src="N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg" alt="" class="calibre33"/> Registered domain name</p>
<p class="docText1"><img border="0" id="" src="N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg" alt="" class="calibre33"/><a name="MX " class="calibre8" id="MX "/> Administrative access to your domain's DNS MX (DNS Mail Exchanger) records</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="optional-id13" class="calibre8" id="optional-id13"/>
<h3 class="docSection1Title" id="-100000">24.4. OPTIONAL</h3>
<p class="docText1"><img border="0" id="" src="N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg" alt="" class="calibre33"/><a name="Cyrus SASL" class="calibre8" id="Cyrus SASL"/> Cyrus SASL2 (see "<a class="calibre2" href="cyrus_sasl_2.1.22.html#cyrus_sasl_2.1.22">Cyrus SASL 2.1.22</a>")</p>
<p class="docText1"><img border="0" id="" src="N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg" alt="" class="calibre33"/><a name="a signed" class="calibre8" id="a signed"/> OpenSSL with a signed SSL Certificate (see "<a class="calibre2" href="openssl_0.9.8g.html#openssl_0.9.8g">OpenSSL 0.9.8g</a>")</p>
<hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> SASL and SSL are used together to create a secure email relay. SASL allows users to relay email if they authenticate successfully. SSL encrypts the authentication transaction and data transfer.</span><hr size="1" noshade="noshade" class="calibre27"/>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="preparation-id23" class="calibre8" id="preparation-id23"/>
<h3 class="docSection1Title" id="-100000">24.5. PREPARATION</h3>
<p class="docText1"><a name="To enable" class="calibre8" id="To enable"/>To enable TLS/SSL and/or SASL with Postfix, be sure that they are installed before proceeding with the Postfix installation.<a name="IDX-CHP-24-0354" class="calibre8" id="IDX-CHP-24-0354"/></p>
<hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> Write down the FQDN of the outgoing SMTP server for your Internet service provider. It usually looks like <a class="calibre2" target="_blank" href="http://smtp.ispname.com">smtp.ispname.com</a>.</span><hr size="1" noshade="noshade" class="calibre27"/>
<p class="docText1">Become the superuser.</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="install-id23" class="calibre8" id="install-id23"/>
<h3 class="docSection1Title" id="-100000">24.6. INSTALL</h3>
<div class="calibre34"><ol class="docList" type="1"><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="To begin" class="calibre8" id="To begin"/>To begin the Postfix installation process, enter the following commands:</p><pre class="calibre30"># <b class="calibre28">cd /usr/ports/mail/postfix</b>
# <b class="calibre28">make config ; make install clean</b>
# <b class="calibre28">rehash</b></pre>
<p class="docText1"><a name="will appear" class="calibre8" id="will appear"/>A menu will appear asking you to select options for Postfix. If you are planning to use TLS/SSL and/or SASL2, select each by using the arrow keys to highlight the option and press [spacebar] to check the box. Once you have selected the options you wish to install, press the [tab] key to highlight <span class="b">OK</span> and then press [enter].</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="to add" class="calibre8" id="to add"/>During installation, you will be asked to add the user postfix to the group mail. Enter <span class="b">Y</span><a name="this and" class="calibre8" id="this and"/> to accept this and continue installation.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="you would" class="calibre8" id="you would"/>When asked if you would like to activate Postfix in <span class="docEmphasis1">/etc/mail/mailer.conf</span>, enter <span class="b">Y</span>. This will create the Postfix-specific <span class="docEmphasis1">mailer.conf</span> in <span class="docEmphasis1">/etc/mail</span>.</p></div></li></ol></div>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="configure-id23" class="calibre8" id="configure-id23"/>
<h3 class="docSection1Title" id="-100000">24.7. CONFIGURE</h3>
<p class="docText1"><a name="Once the" class="calibre8" id="Once the"/>Once the installation process is complete, it's time to configure Postfix for use on your system.</p>
<div class="calibre34"><ol class="docList" type="1"><li class="calibre16"><div class="calibre35"><p class="docText1">Edit the <span class="docEmphasis1">main.cf</span><a name="in" class="calibre8" id="in"/> file located in <span class="docEmphasis1">/usr/local/etc/postfix</span>. First, open <span class="docEmphasis1">main.cf</span> with Easy Editor:</p><pre class="calibre30"># <b class="calibre28">ee /usr/local/etc/postfix/main.cf</b></pre>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="second of" class="calibre8" id="second of"/>Scroll down and uncomment the second of the three <tt class="calibre20">mydestination</tt><a name="removing the" class="calibre8" id="removing the"/> statements (~162) by removing the preceding hash mark. The line should now appear as follows:</p><pre class="calibre30">mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain</pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Comment out the <tt class="calibre20">mynetworks_style</tt><a name="allow relay" class="calibre8" id="allow relay"/> declaration (~247). This will allow relay access to clients without authentication as long as they reside on your local network (subnet). Do not modify this line if your local subnet is untrusted or you wish to enforce authentication of all clients. The line should appear as follows if subnet relay access is allowed:</p><pre class="calibre30"><b class="calibre28">#</b>mynetworks_style = host</pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="does not" class="calibre8" id="does not"/>If your ISP blocks port 25, proceed to step 5; if it does not, skip to step 6. (See "<a class="calibre2" href="notes.html#notes">Notes</a>" for instructions on detecting port 25 blockages.)</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Scroll down to the <tt class="calibre20">relayhost</tt><a name="Replace" class="calibre8" id="Replace"/> declaration (~311) and specify your ISP's SMTP server. Replace <tt class="calibre20"><i class="docEmphasis1">mailserver.isp.tld</i></tt><a name="appear like" class="calibre8" id="appear like"/> with your ISP's server address and uncomment this line. The line should appear like this:</p><pre class="calibre30">relayhost = [<tt class="calibre20"><i class="docEmphasis1">mailserver.isp.tld</i></tt>]</pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Uncomment the <tt class="calibre20">home_mailbox</tt><a name="to Maildir" class="calibre8" id="to Maildir"/> declaration (~415) to enable mail delivery to Maildir. The line should now appear as follows:</p><pre class="calibre30">home_mailbox = Maildir/</pre><br class="calibre1"/>
<p class="docText1"><a name="SSL encryption" class="calibre8" id="SSL encryption"/>If you don't want to set up SASL with SSL encryption, save, exit, and skip to step 12. To enable SASL with SSL encryption, continue.<a name="IDX-CHP-24-0355" class="calibre8" id="IDX-CHP-24-0355"/></p></div></li></ol></div>
<a name="enabling_sasl_with_ssl_encryption" class="calibre8" id="enabling_sasl_with_ssl_encryption"/>
<h4 id="title-ID0EGPAO" class="docSection1Title">24.7.1. Enabling SASL with SSL Encryption</h4>
<div class="calibre34"><ol class="docList" type="1" start="continues"><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="Scroll down" class="calibre8" id="Scroll down"/>Scroll down to the bottom of the <span class="docEmphasis1">main.cf</span><a name="using Easy" class="calibre8" id="using Easy"/> file (press [ctrl-U] if you're using Easy Editor) and add the following lines to enable Cyrus SASL2:</p><pre class="calibre30">smtp_sasl_auth_enable = yes
smtpd_sasl_auth_enable = yes
smtpd_sasl_security_options = noanonymous
smtpd_sasl_local_domain = $mydomain
broken_sasl_auth_clients = yes
smtp_sasl_password_maps = hash:/usr/local/etc/sasldb2
smtpd_recipient_restrictions =
   permit_sasl_authenticated
   permit_mynetworks
   reject_unauth_destination</pre><br class="calibre1"/>
<hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> Postfix configuration statements that span multiple lines require preceding whitespace as shown in the last three lines above.</span><hr size="1" noshade="noshade" class="calibre27"/></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="configuration statements" class="calibre8" id="configuration statements"/>Adding the next set of configuration statements to <span class="docEmphasis1">main.cf</span><a name="You can" class="calibre8" id="You can"/> will enable TLS/SSL encryption. You can separate these lines from the SASL directives with a blank line to make it easier to differentiate SASL2 options from the TLS/SSL options.</p><hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> The naming conventions used here are consistent with the OpenSSL guide in this book. Replace items in italics as appropriate to your system.</span><hr size="1" noshade="noshade" class="calibre27"/><pre class="calibre30">smtp_tls_CAfile = <tt class="calibre20"><i class="docEmphasis1">/usr/local/openssl/certs/example.com-CAcert.pem</i></tt>
smtp_tls_cert_file = <tt class="calibre20"><i class="docEmphasis1">/usr/local/openssl/certs/host.example.com-cert.pem</i></tt>
smtp_tls_key_file =
  <tt class="calibre20"><i class="docEmphasis1">/usr/local/openssl/certs/host.example.com-unencrypted-key.pem</i></tt>
smtp_tls_session_cache_database = btree:/var/run/smtp_tls_session_cache
smtp_tls_security_level = may
smtpd_tls_CAfile = <tt class="calibre20"><i class="docEmphasis1">/usr/local/openssl/certs/example.com-CAcert.pem</i></tt>
smtpd_tls_cert_file = <tt class="calibre20"><i class="docEmphasis1">/usr/local/openssl/certs/host.example.com-cert.pem</i></tt>
smtpd_tls_key_file =
  <tt class="calibre20"><i class="docEmphasis1">/usr/local/openssl/certs/host.example.com-unencrypted-key.pem</i></tt>
smtpd_tls_session_cache_database = btree:/var/run/smtpd_tls_session_cache
smtpd_tls_received_header = yes
smtpd_tls_security_level = may
tls_random_source = dev:/dev/urandom
smtpd_tls_auth_only = yes</pre><br class="calibre1"/>
<p class="docText1"><a name="above are" class="calibre8" id="above are"/>The files used above are:</p><p class="docText1"><a class="calibre2" target="_blank" href="http://example.com-CAcert.pem">example.com-CAcert.pem</a> Certificate Authority Root Certificate</p><p class="docText1"><a class="calibre2" target="_blank" href="http://host.example.com-cert.pem">host.example.com-cert.pem</a> Server Certificate</p><p class="docText1"><a class="calibre2" target="_blank" href="http://host.example.com-unencrypted-key.pem">host.example.com-unencrypted-key.pem</a> Server Private Key</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Save and exit.</p><p class="docText1"><a name="relay email" class="calibre8" id="relay email"/>Assuming all goes well, you've now created a secure means to remotely relay email by enabling SASL with SSL. That said, if your users will be sending email from remote locations, they may be subject to ISP-enforced SMTP port 25 blockages (see "<a class="calibre2" href="notes.html#notes">Notes</a><a name="outbound mail" class="calibre8" id="outbound mail"/>") that prevent them from sending outbound mail on the default port. To address this, we'll enable the SMTP submission port 587, via which users can securely submit email to your server.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Modify the <span class="docEmphasis1">master.cf</span> file located in <span class="docEmphasis1">/usr/local/etc/postfix</span> to enable the submission port. Open the file:</p><pre class="calibre30"># <b class="calibre28">ee /usr/local/etc/postfix/master.cf</b></pre><br class="calibre1"/>
<p class="docText1">and uncomment the following four lines (~12):</p><pre class="calibre30">submission inet n       -       n       -       -       smtpd
  -o smtpd_enforce_tls=yes
  -o smtpd_sasl_auth_enable=yes
  -o smtpd_client_restrictions=permit_sasl_authenticated,reject</pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Save and exit.</p></div></li></ol></div>
<a name="finishing_the_configuration" class="calibre8" id="finishing_the_configuration"/>
<h4 id="title-ID0ETSAO" class="docSection1Title">24.7.2. Finishing the Configuration</h4>
<p class="docText1"><a name="configuration with" class="calibre8" id="configuration with"/>Whether you enabled SASL with SSL encryption or not, finish the configuration with the following steps.</p>
<div class="calibre34"><ol class="docList" type="1" start="continues"><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="the root" class="calibre8" id="the root"/>To forward email addressed to the root user, you need to edit a file named <span class="docEmphasis1">aliases</span> located in the <span class="docEmphasis1">/etc/mail</span> directory. Open this file with Easy Editor:</p><pre class="calibre30"># <b class="calibre28">ee /etc/mail/aliases</b></pre><br class="calibre1"/>
<p class="docText1"><a name="address of" class="calibre8" id="address of"/>Scroll down (~19), uncomment this line, and enter the email address of the system administrator. The root account's email will be forwarded to this email address. The line should appear as follows, with the correct email address in place of <a class="calibre2" href="mailto:username@example.com.html">username@example.com</a>:</p><pre class="calibre30">root: <tt class="calibre20"><i class="docEmphasis1">username@example.com</i></tt></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="Save and" class="calibre8" id="Save and"/>Save and exit.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1">To update <span class="docEmphasis1">aliases.db</span><a name="changes made" class="calibre8" id="changes made"/> with the changes made to the <span class="docEmphasis1">aliases</span> file, enter the following command:</p><pre class="calibre30"># <b class="calibre28">newaliases</b></pre><br class="calibre1"/>
</div></li></ol></div>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="testing-id14" class="calibre8" id="testing-id14"/>
<h3 class="docSection1Title" id="-100000">24.8. TESTING</h3>
<p class="docText1"><a name="In this" class="calibre8" id="In this"/>In this section, we'll perform some basic tests to confirm that Postfix answers SMTP commands properly.<a name="IDX-CHP-24-0356" class="calibre8" id="IDX-CHP-24-0356"/></p>
<div class="calibre34"><ol class="docList" type="1"><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="to start" class="calibre8" id="to start"/>Configure Postfix to start automatically at boot time, rather than the Sendmail MTA, by editing the <span class="docEmphasis1">rc.conf</span> file located in <span class="docEmphasis1">/etc</span>. First, open <span class="docEmphasis1">rc.conf</span>:</p><pre class="calibre30"># <b class="calibre28">ee /etc/rc.conf</b></pre>
<p class="docText1"><a name="lines to" class="calibre8" id="lines to"/>and then add the following lines to automatically start Postfix at boot time:</p><pre class="calibre30">postfix_enable="YES"
sendmail_enable="NO"
sendmail_submit_enable="NO"
sendmail_outbound_enable="NO"
sendmail_msp_queue_enable="NO"</pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Save and exit.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="file named" class="calibre8" id="file named"/>Create a file named <span class="docEmphasis1">periodic.conf</span> in <span class="docEmphasis1">/etc</span><a name="lines to" class="calibre8" id="lines to"/> and add four lines to it. Since Postfix is replacing Sendmail as the MTA, we can remove unnecessary instructions from the daily-run script that pertains to Sendmail. Create and open <span class="docEmphasis1">/etc/periodic.conf</span>:</p><pre class="calibre30"># <span class="b">ee /etc/periodic.conf</span></pre><br class="calibre1"/>
<p class="docText1">and then add these lines to the empty file:</p><pre class="calibre30">daily_clean_hoststat_enable="NO"
daily_status_mail_rejects_enable="NO"
daily_status_include_submit_mailq="NO"
daily_submit_queuerun="NO"</pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Save and exit.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Enter these commands to stop Sendmail and start Postfix for testing:</p><pre class="calibre30"># <b class="calibre28">killall sendmail</b>
# <b class="calibre28">/usr/local/etc/rc.d/postfix start</b></pre><br class="calibre1"/>
</div></li></ol></div>
<a name="sending_mail" class="calibre8" id="sending_mail"/>
<h4 id="title-ID0EEPAO" class="docSection1Title">24.8.1. Sending Mail</h4>
<p class="docText1"><a name="telnet to" class="calibre8" id="telnet to"/>To check that Postfix is running and handling mail requests, we'll use telnet to send SMTP commands and send a test message.</p>
<div class="calibre34"><ol class="docList" type="1" start="continues"><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="initiate a" class="calibre8" id="initiate a"/>Use the following command to initiate a connection to Postfix using telnet:</p><pre class="calibre30"># <b class="calibre28">telnet localhost 25 </b>

Connected to localhost.
Escape character is '^]'.
220 <i class="docEmphasis1">host.example.com </i> ESMTP Postfix</pre><br class="calibre1"/>
<p class="docText1">Your hostname should appear instead of <a class="calibre2" href="mailto:host.example.com.html">host.example.com</a>.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Create the test email message. You can replace <a class="calibre2" href="mailto:test@example.com.html">test@example.com</a><a name="purposes of" class="calibre8" id="purposes of"/> with any email address; it doesn't need to be valid for the purposes of testing.</p><pre class="calibre30"><b class="calibre28">mail from:</b> <span class="docEmphBoldItalic">test@example.com</span>

250 Ok</pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Specify the email recipient, replacing <a class="calibre2" href="mailto:user@example.com.html">user@example.com</a><a name="that you" class="calibre8" id="that you"/> with an external email account that you can access, preferably via webmail. Enter each line as shown below and then end the test message by entering a period (<tt class="calibre20"><b class="calibre28">.</b></tt>) on a blank line:</p><pre class="calibre30"><b class="calibre28">rcpt to:</b> <span class="docEmphBoldItalic">user@example.com</span>

250 Ok
<b class="calibre28">data</b>

354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;

<b class="calibre28">Subject: test message</b><b class="calibre28">This is a test message</b>
<b class="calibre28">.</b></pre><br class="calibre1"/>
<p class="docText1"><a name="italicized ID" class="calibre8" id="italicized ID"/>You should see output similar to the following (the italicized ID tag will be different in your output):</p><pre class="calibre30">250 Ok: queued as <tt class="calibre20"><i class="docEmphasis1">1242EC119</i></tt></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="Close the" class="calibre8" id="Close the"/>Close the connection:</p><pre class="calibre30"><b class="calibre28">quit</b></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="recipient email" class="calibre8" id="recipient email"/>Check the recipient email account to see if the message was successfully sent. If you did not set up SASL and SSL, skip to "<a class="calibre2" href="#receiving_mail">Receiving Mail</a>".</p></div></li></ol></div>
<a name="testing_sasl_over_ssl" class="calibre8" id="testing_sasl_over_ssl"/>
<h4 id="title-ID0EASAO" class="docSection1Title">24.8.2. Testing SASL over SSL</h4>
<p class="docText1"><a name="SASL and" class="calibre8" id="SASL and"/>If you configured Postfix with SASL and SSL support, you can initiate an SSL connection and authenticate with SASL.</p>
<div class="calibre34"><ol class="docList" type="1" start="continues"><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="username and" class="calibre8" id="username and"/>Encode the username and password of the user account that you wish to test into Base-64 format. Enter the following command to encode your username and password, replacing the italic items as appropriate:</p><pre class="calibre30"># <b class="calibre28">perl -MMIME::Base64 -e 'print encode_base64("\0 </b><span class="docEmphBoldItalic">username</span><b class="calibre28">\0 </b><span class="docEmphBoldItalic">password</span><b class="calibre28">")' </b>
<i class="docEmphasis1">AHVzZXJuYW1lAHBhc3N3b3Jk </i></pre><br class="calibre1"/>
<p class="docText1"><a name="write this" class="calibre8" id="write this"/>Be sure to write this string down exactly as it appears in your output; you will need to enter it in a moment.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="SMTP server" class="calibre8" id="SMTP server"/>The next command will start an SSL-encrypted connection to the Postfix SMTP server:</p><pre class="calibre30"># <b class="calibre28">openssl s_client -starttls smtp -crlf -connect localhost:25</b>

CONNECTED(00000003)...
...SSL-Session:
    Protocol  : TLSv1
    Cipher    : DHE-RSA-AES256-SHA
    Session-ID: 3886C410C971913F87CA439B92FA7ED67CFFEE7D3...
    Session-ID-ctx:
    Master-Key: B9F96FB08D2E7C86B2454C7553F0F84D1C2DD3B3...
    Key-Arg   : None
    Start Time: 1196074152
    Timeout   : 300 (sec)
    Verify return code: 19 (self signed certificate in certificate chain)
---
250 DSN</pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="the encoded" class="calibre8" id="the encoded"/>Authenticate to the server using the encoded username and password that you created previously:</p><pre class="calibre30"><b class="calibre28">AUTH PLAIN</b> <span class="docEmphBoldItalic">AHVzZXJuYW1lAHBhc3N3b3Jk</span></pre><br class="calibre1"/>
<p class="docText1">If authentication is successful, you should see this:</p><pre class="calibre30">235 2.0.0 Authentication successful</pre><br class="calibre1"/>
<p class="docText1"><a name="in " class="calibre8" id="in "/>At this point, you can send a test email as shown in "<a class="calibre2" href="#sending_mail">Sending Mail</a>".</p></div></li></ol></div>
<a name="receiving_mail" class="calibre8" id="receiving_mail"/>
<h4 id="title-ID0EAUAO" class="docSection1Title">24.8.3. Receiving Mail</h4>
<p class="docText1"><a name="to receive" class="calibre8" id="to receive"/>Now we'll test the Postfix server's ability to receive email. Be sure your domain's primary DNS MX record points to the IP address of your server (your domain registrar should have details about how to do this). If you have a NAT router, be sure that port 25 is forwarded to your server or this test won't succeed.</p>
<div class="calibre34"><ol class="docList" type="1" start="continues"><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="account " class="calibre8" id="account "/>Send a test message from an external email account (for instance, a Gmail or Yahoo! account) to a valid user account (other than root) on your server.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="Change to" class="calibre8" id="Change to"/>Change to the user's mail directory with the following command (replacing <tt class="calibre20"><i class="docEmphasis1">username</i></tt><a name="username you" class="calibre8" id="username you"/> with the username you sent the email to on your server):</p><pre class="calibre30"># <b class="calibre28">cd /usr/home/</b><span class="docEmphBoldItalic">username</span><b class="calibre28">/Maildir/new</b>
# <b class="calibre28">more *</b></pre><br class="calibre1"/>
<p class="docText1"><a name="of your" class="calibre8" id="of your"/>You should see the contents of your test email.</p></div></li></ol></div>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="utilities-id7" class="calibre8" id="utilities-id7"/>
<h3 class="docSection1Title" id="-100000">24.9. UTILITIES</h3>
<p class="docText1"><a name="Following is" class="calibre8" id="Following is"/>Following is brief information on the postfix startup script and the postqueue utility.<a name="IDX-CHP-24-0357" class="calibre8" id="IDX-CHP-24-0357"/></p>
<a name="postfix" class="calibre8" id="postfix"/>
<h4 id="title-ID0ERNAO" class="docSection1Title">24.9.1. postfix</h4>
<p class="docText1"><a name="is used" class="calibre8" id="is used"/>This script is used to control the Postfix daemon.</p>
<dl class="docList1">
<dt class="calibre1"><p class="calibre23"><span class="docPubcolor"><span class="b">Command</span></span></p></dt>
<dd class="calibre36"><p class="docText1"><tt class="calibre20">/usr/local/etc/rc.d/postfix</tt></p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"><span class="b">Syntax</span></span></p></dt>
<dd class="calibre36"><p class="docText1"><tt class="calibre20">/usr/local/etc/rc.d/postfix</tt> <tt class="calibre20"><i class="docEmphasis1">option</i></tt></p></dd>
</dl>
<p class="docText1"><span class="b">Options</span></p>
<dl class="docList1">
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">start</pre></p></dt>
<dd class="calibre36"><p class="docText1">Starts the Postfix mail system</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">stop</pre></p></dt>
<dd class="calibre36"><p class="docText1">Stops the Postfix mail system</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">reload</pre></p></dt>
<dd class="calibre36"><p class="docText1"><a name="and rereads" class="calibre8" id="and rereads"/>Restarts the Postfix mail system and rereads configuration files</p></dd>
</dl>
<p class="docText1"><span class="b">Example</span></p>
<p class="docText1"><a name="the Postfix" class="calibre8" id="the Postfix"/>To stop the Postfix mail system, enter the following command at the command prompt:</p>
<pre class="calibre30"># <b class="calibre28">/usr/local/etc/rc.d/postfix stop</b></pre><br class="calibre1"/>
<a name="postqueue" class="calibre8" id="postqueue"/>
<h4 id="title-ID0EEQAO" class="docSection1Title">24.9.2. postqueue</h4>
<p class="docText1"><a name="useful for" class="calibre8" id="useful for"/>This utility is useful for checking Postfix's mail queue.</p>
<a name="IDX-CHP-24-0358" class="calibre8" id="IDX-CHP-24-0358"/><dl class="docList1">
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"><span class="b">Command</span></span></p></dt>
<dd class="calibre36"><p class="docText1"><tt class="calibre20">postqueue</tt><a name="IDX-CHP-24-0358" class="calibre8" id="IDX-CHP-24-0358"/></p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"><span class="b">Syntax</span></span></p></dt>
<dd class="calibre36"><p class="docText1"><tt class="calibre20">postqueue -</tt><tt class="calibre20"><i class="docEmphasis1">option</i></tt></p></dd>
</dl>
<p class="docText1"><span class="b">Options</span></p>
<dl class="docList1">
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">-f</pre></p></dt>
<dd class="calibre36"><p class="docText1">Instructs Postfix to flush/deliver mail that is in the queue</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">-p</pre></p></dt>
<dd class="calibre36"><p class="docText1">Displays the contents of the Postfix queue</p></dd>
</dl>
<p class="docText1"><span class="b">Example</span></p>
<p class="docText1"><a name="following command" class="calibre8" id="following command"/>To display the contents of the Postfix mail queue, enter the following command at the command prompt:</p>
<pre class="calibre30"># <b class="calibre28">postqueue -p</b></pre><br class="calibre1"/>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="config_files-id23" class="calibre8" id="config_files-id23"/>
<h3 class="docSection1Title" id="-100000">24.10. CONFIG FILES</h3>
<p class="docText1"><span class="b">/usr/local/etc/postfix/main.cf</span><a name="IDX-CHP-24-0359" class="calibre8" id="IDX-CHP-24-0359"/><a name="IDX-CHP-24-0360" class="calibre8" id="IDX-CHP-24-0360"/><a name="IDX-CHP-24-0361" class="calibre8" id="IDX-CHP-24-0361"/><a name="IDX-CHP-24-0362" class="calibre8" id="IDX-CHP-24-0362"/></p>
<p class="docText1"><a name="Contains most" class="calibre8" id="Contains most"/>Contains most of the commonly used configuration options.</p>
<p class="docText1"><span class="b">/usr/local/etc/postfix/master.cf</span></p>
<p class="docText1"><a name="configuration options" class="calibre8" id="configuration options"/>Contains the configuration options for the Postfix master process. It also controls how Postfix interacts with other third-party software (filters and so on).</p>
<p class="docText1"><span class="b">/etc/mail/aliases</span><a name="IDX-CHP-24-0363" class="calibre8" id="IDX-CHP-24-0363"/></p>
<p class="docText1"><a name="on mail" class="calibre8" id="on mail"/>A text representation of rules on mail redirections. The <tt class="calibre20">newaliases</tt><a name="this file" class="calibre8" id="this file"/> command converts this file into a database file named <span class="docEmphasis1">aliases.db</span> for use with Postfix; <span class="docEmphasis1">aliases.db</span> is stored in <span class="docEmphasis1">/etc</span>.</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="log_files-id12" class="calibre8" id="log_files-id12"/>
<h3 class="docSection1Title" id="-100000">24.11. LOG FILES</h3>
<p class="docText1"><span class="b">/var/log/maillog</span></p>
<p class="docText1"><a name="General log" class="calibre8" id="General log"/>General log of email activity</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="notes-id17" class="calibre8" id="notes-id17"/>
<h3 class="docSection1Title" id="-100000">24.12. NOTES</h3>
<ul class="calibre15"><li class="calibre16"><p class="docText1"><span class="b"><a name="Port " class="calibre8" id="Port "/>Port 25</span><a name="attempt to" class="calibre8" id="attempt to"/> In an attempt to fight spam coming from their users, most major Internet providers block outgoing traffic on port 25 except to their own SMTP server. To see if your ISP blocks port 25, enter the following command:</p><pre class="calibre30"># <b class="calibre28">telnet smtp.stanford.edu 25</b>

Trying 171.67.22.28...
Connected to smtp1.stanford.edu.
Escape character is '^]'.
220 smtp1.stanford.edu ESMTP Postfix
# <b class="calibre28">quit</b></pre>
<p class="docText1"><a name="should see" class="calibre8" id="should see"/>If port 25 is not blocked, you should see the output listed above. If you get a message like this:</p><pre class="calibre30">Trying <tt class="calibre20"><i class="docEmphasis1">xx</i></tt>.<tt class="calibre20"><i class="docEmphasis1">xx</i></tt>.<tt class="calibre20"><i class="docEmphasis1">xx</i></tt>.<tt class="calibre20"><i class="docEmphasis1">xx</i></tt>...</pre><br class="calibre1"/>
<p class="docText1"><a name="to hang" class="calibre8" id="to hang"/>that seems to hang, port 25 is probably blocked. Press [ctrl-C] to abort and return to the prompt.</p></li><li class="calibre16"><p class="docText1"><a name="on the" class="calibre8" id="on the"/>Postfix sends email on the Internet using SMTP. Email clients (Outlook, Thunderbird, Apple's Mail, Eudora, and so on) will need another protocol to receive messages from your email server, namely IMAP or POP3. Consult for details on installation/configuration.</p></li><li class="calibre16"><p class="docText1"><a name="You may" class="calibre8" id="You may"/>The default size limit for incoming email messages is 10,240,000 bytes (10.2MB). You may change this size limit by adding <tt class="calibre20">"message_size_limit =</tt> <tt class="calibre20"><i class="docEmphasis1">xxx</i></tt><tt class="calibre20">"</tt> (replace a numerical value for <tt class="calibre20"><i class="docEmphasis1">xxx</i></tt><a name="the" class="calibre8" id="the"/> in bytes) to the end of the <span class="docEmphasis1">main.cf</span> file in <span class="docEmphasis1">/usr/local/etc/postfix</span>. The following commands will append this statement to <span class="docEmphasis1">main.cf</span> and restart Postfix (replace <tt class="calibre20"><i class="docEmphasis1">xxx</i></tt> with a numerical value in bytes; for instance, to set a 25MB limit, use <tt class="calibre20">25000000</tt>):</p><pre class="calibre30"># <b class="calibre28">cd /usr/local/etc/postfix</b>
# <b class="calibre28">cp main.cf main.cf.old</b>
# <b class="calibre28">echo "message_size_limit =</b> <span class="docEmphBoldItalic">xxx</span><b class="calibre28">" &gt;&gt; main.cf</b>
# <b class="calibre28">/usr/local/etc/rc.d/postfix reload</b></pre><br class="calibre1"/>
<hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> If you change the message size limit to a value larger than 51200000, you will need to add the <span class="docEmphasis1">mailbox_size_limit</span> statement and ensure it is larger than the <span class="docEmphasis1">message_size_limit</span> setting. Here's what these two statements would look like if you wanted a message size limit of 100MB:<a name="IDX-CHP-24-0364" class="calibre8" id="IDX-CHP-24-0364"/></span><hr size="1" noshade="noshade" class="calibre27"/><pre class="calibre30">mailbox_size_limit = 101000000
message_size_limit = 100000000</pre><br class="calibre1"/>
</li></ul>
</div></div>

</body></html>