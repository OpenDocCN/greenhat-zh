<html><head></head><body><div class="chapter" title="Chapter&#xA0;13.&#xA0;Configuring Linux for Best Audio Quality"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_linux_for_best_audio_quality"/>Chapter 13. Configuring Linux for Best Audio Quality</h1></div></div></div><div class="informalfigure"><div class="mediaobject"><a id="I_mediaobject13_d1e17858"/><img src="httpatomoreillycomsourcenostarchimages797347.png.jpg" alt="image with no caption"/></div></div><p>Linux audio is rather messy yet powerful. This chapter is a guide to
    getting everything working correctly for high-end audio production. Linux
    is a wonderful multimedia platform: It is stable, it is flexible, and if
    you use a lightweight graphical environment, you’ll get better performance
    out of modest hardware. Although Linux audio has some rough edges, it is
    advancing rapidly, and it has its own universe of sophisticated audio
    software.<a id="IDX-CHP-13-0001" class="indexterm"/></p><p>You can use whatever Linux distribution you want, because you can
    customize any Linux distribution to serve as your recording studio,
    depending on what hoops you’re willing to jump through. The most important
    things you need, aside from Audacity and other audio software
    applications, are a real-time preemptible kernel for lowest latency and a
    few system configuration tweaks. You can configure and tune your favorite
    Linux distribution, or you can use one of specialized Linux distributions
    for multimedia production that takes care of the details for you.</p><p>I used Ubuntu while writing this book because it was the first
    distribution to bundle the FFADO drivers for FireWire recording
    interfaces. (I have the excellent Focusrite Saffire Pro 26 I/O for
    multichannel recording.) FireWire recording interfaces are great
    performers, but they present some special driver problems, so if you don’t
    have one, don’t worry about finding a distribution that includes FFADO.
    You can always add it later anyway.<a id="IDX-CHP-13-0002" class="indexterm"/><a id="IDX-CHP-13-0003" class="indexterm"/><a id="IDX-CHP-13-0004" class="indexterm"/><a id="IDX-CHP-13-0005" class="indexterm"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p>The most important step is careful selection of your audio
      interface. Choose one that is well-supported on Linux. Life is too short
      to waste on something that doesn’t want to work right. Visit the ALSA
      Sound Card Matrix (<a class="ulink" href="http://www.alsa-project.org/main/index.php/Matrix:Main">http://www.alsa-project.org/main/index.php/Matrix:Main</a>)
      to find supported sound cards. Also check out <a class="xref" href="apa.html" title="Appendix A. Audio Hardware">Appendix A</a> for hardware information.</p></div><div class="sect1" title="Using Distributions with Real-Time Kernels"><div class="titlepage"><div><div><h1 class="title"><a id="using_distributions_with_real-time_kerne"/>Using Distributions with Real-Time Kernels</h1></div></div></div><p>If your particular Linux distribution packages a
      <span class="emphasis"><em>real-time kernel</em></span>, that takes care of the biggest
      hurdle. What is a real-time kernel? This is a kernel where
      <span class="emphasis"><em>real-time scheduling</em></span> and <span class="emphasis"><em>real-time
      preemption</em></span> are configured to favor audio recording for the
      lowest possible latency. Latency is inherent in computers because modern
      CPUs use <span class="emphasis"><em>preemptive multitasking</em></span>; they perform one
      task at a time but switch back and forth between tasks so rapidly that
      they appear to be performing multiple tasks at once. Multicore CPUs
      smooth out this switching, but they still need help from the Linux
      kernel.<a id="IDX-CHP-13-0006" class="indexterm"/></p><p>Because the Linux kernel continues to develop at warp speed, some
      folks are saying that a special real-time kernel really isn’t necessary
      anymore because real-time features are integrated into the mainline
      kernel. You can get by without one if you strip your Linux system down
      to the essentials needed for audio production and use a modern multicore
      PC, gigabytes of RAM, and fast hard drives. I’ll stick with real-time
      kernels for now, because they behave a little differently from
      general-purpose kernels.</p><p>Real-time preemption controls how tasks interrupt each other to
      get the CPU time they need. It’s like a classroom of kids trying to get
      the teacher’s attention, and the teacher can deal with only one at a
      time. A multicore CPU is like having more teachers. Interrupts are
      typically milliseconds in duration, which doesn’t matter when we’re
      typing a letter or editing a photograph but is enough to introduce
      defects into a recording. So, we can configure Linux to give the highest
      scheduling priority to audio functions.</p><p>There are latencies inherent in the inner workings of the kernel
      itself, which in modern kernels have become very small. So, it is
      possible to tune a Linux kernel for very low-latency audio recording,
      down to less than 10 milliseconds. Anything less than 20 is
      excellent.</p><p>Fedora and CentOS users should use Planet CCRMA packages (<a class="ulink" href="http://ccrma.stanford.edu/planetccrma/software/planetccrma.html">http://ccrma.stanford.edu/planetccrma/software/planetccrma.html</a>).
      Planet CCRMA (pronounced “karma”) is a special collection of RPMs for
      Fedora and CentOS that includes a real-time kernel, all kinds of audio
      software, and up-to-date audio drivers. Just add the Planet CCRMA
      repositories to your system and then use Yum to install, update, and
      remove packages the usual way.<a id="IDX-CHP-13-0007" class="indexterm"/></p><p>Arch Linux is a superior audio production platform, and it has its
      own special audio repository, ArchAudio. Red Hat, Mandriva, and openSUSE
      all package real-time kernels.<a id="IDX-CHP-13-0008" class="indexterm"/></p><p>Ubuntu (and Kubuntu, Xubuntu, and all the rest of the family)
      provides a real-time kernel and related kernel modules; the bare minimum
      you need to get started with Audacity are these packages:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>audacity</em></span></p></li><li class="listitem"><p><span class="emphasis"><em>linux-rt</em></span></p></li></ul></div><p>Once you have an rt kernel installed, add all human users who are
      going to be using Audacity to the <span class="emphasis"><em>audio</em></span> group (in
      the <span class="emphasis"><em>/etc/group</em></span> file). Then add these lines to
      <span class="emphasis"><em>/etc/security/limits.conf</em></span>:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><strong class="userinput"><code>@audio - rtprio
          99</code></strong></p></li><li class="listitem"><p><strong class="userinput"><code>@audio - memlock
          3000000</code></strong></p></li></ul></div><p>The first line gives all members of the audio group the highest
      scheduling priority. The second value controls how memory is
      used.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><code class="literal">rtprio</code> (real-time priority)
          values range from 0 to 99, with 99 being the most favorable
          priority. This is the very front of the line.</p></li><li class="listitem"><p><code class="literal">memlock</code> determines how much
          RAM the audio group locks up for itself, in kilobytes, and prevents
          it from writing to the much slower swap file. My system has 4GB RAM,
          so I set a limit of 3GB, or 3,000,000KB. Some how-tos say to set
          this to <span class="emphasis"><em>unlimited</em></span>. This is a bit controversial,
          because it seems like common sense to leave some for system
          processes and nonaudio applications. A value of unlimited could also
          result in out-of-memory errors and interrupt your audio session.
          Some users report that setting any memlock value makes no
          difference.</p></li></ul></div><p>Many how-tos also say to add one more line: <code class="literal">@audio - nice -19</code>. This isn’t necessary
      because the rtprio function takes care of scheduling priority. It
      doesn’t hurt anything to try it for yourself.</p><p>Then reboot to your new kernel. Note that if you are already
      running your rt kernel, all you need to do to activate your new group
      membership and changes to <span class="emphasis"><em>limits.conf</em></span> is to log out
      and then log back in. Then verify your audio group membership:</p><a id="I_programlisting13_d1e17991"/><pre class="programlisting">$ groups
carla adm disk dialout cdrom audio plugdev lpadmin admin</pre><p>Verify that your rt kernel is running:</p><a id="I_programlisting13_d1e17995"/><pre class="programlisting">$ uname -r
2.6.32-24-rt</pre><p>The <code class="literal">rt</code> tells you this is a
      real-time kernel; this example is from Ubuntu 10.04. You should also
      keep a stock kernel installed. Using a different kernel is as easy as
      rebooting and choosing it from your boot menu. It will also help with
      troubleshooting, because you can try tasks that are giving you problems
      with different kernels to see whether they behave differently.<a id="IDX-CHP-13-0009" class="indexterm"/></p><div class="sect2" title="Specialized Multimedia Linux Distributions"><div class="titlepage"><div><div><h2 class="title"><a id="specialized_multimedia_linux_distributio"/>Specialized Multimedia Linux Distributions</h2></div></div></div><p>There are several complete Linux distributions that are
        customized for audio and multimedia production. Some of them run from
        a CD, DVD, or USB stick, with a hard drive installation option. You
        should still verify audio group membership,
        <span class="emphasis"><em>/etc/security/limits.conf</em></span> settings, and a
        real-time kernel like we talked about in the previous section.</p><p>Here is a sampling of specialized multimedia Linux
        distributions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>64 Studio (<a class="ulink" href="http://www.64studio.com/">http://www.64studio.com/</a>)<a id="IDX-CHP-13-0010" class="indexterm"/></p></li><li class="listitem"><p>Ubuntu Studio (<a class="ulink" href="http://www.ubuntustudio.org/">http://www.ubuntustudio.org/</a>)<a id="IDX-CHP-13-0011" class="indexterm"/></p></li><li class="listitem"><p>dyne:bolic (<a class="ulink" href="http://www.dynebolic.org/">http://www.dynebolic.org/</a>)<a id="IDX-CHP-13-0012" class="indexterm"/></p></li><li class="listitem"><p>pure:dyne (<a class="ulink" href="http://www.puredyne.org/">http://www.puredyne.org/</a>)</p></li><li class="listitem"><p>Musix (<a class="ulink" href="http://www.musix.org.ar/en/">http://www.musix.org.ar/en/</a>)</p></li></ul></div><div class="sect3" title="64 Studio"><div class="titlepage"><div><div><h3 class="title"><a id="studio"/>64 Studio</h3></div></div></div><p>64 Studio is a Debian-based distribution for all digital
          content creation, and it includes a huge assortment of audio, video,
          graphics, and publishing software. It supports both 32- and 64-bit
          architectures and runs on a wide range of PC hardware. The
          maintainers aim for stability rather than bleeding edge, so they
          issue updates conservatively. 64 Studio also builds and supports
          products such as the Trinity Indamixx digital audio workstation and
          the Lionstracs Mediastation.</p></div><div class="sect3" title="Ubuntu Studio"><div class="titlepage"><div><div><h3 class="title"><a id="ubuntu_studio"/>Ubuntu Studio</h3></div></div></div><p>Ubuntu Studio is akin to 64 Studio in having nearly every
          Linux multimedia application there is, except that it is based on
          Ubuntu, which in turn is derived from Debian. Ubuntu is more than
          warmed-over Debian; the Ubuntu development teams maintain its own
          patches and customizations. Ubuntu Studio uses more up-to-date
          packages than 64 Studio, so you get newer software releases and
          perhaps newer bugs. As with all things Ubuntu, there is a large and
          enthusiastic user base and good community support.</p><p>You can also add Ubuntu Studio packages to a regular Ubuntu
          system. Run <strong class="userinput"><code>$ apt-cache search
          ubuntustudio</code></strong> to see your options. The
          <span class="emphasis"><em>ubuntustudio-audio</em></span> and
          <span class="emphasis"><em>ubuntustudio-audio-plugins</em></span> metapackages should
          give you everything you need for audio production, with one
          important exception: The linux-rt kernel is not included, so you
          will have to install it separately.</p></div><div class="sect3" title="dyne:bolic"><div class="titlepage"><div><div><h3 class="title"><a id="dyne_colon_bolic"/>dyne:bolic</h3></div></div></div><p>dyne:bolic is a unique software project. dyne:bolic is not
          based on any other Linux distribution but is built from scratch from
          source code. That’s just the beginning—dyne:bolic operates in its
          own creative ways. It uses only Free software as defined by the Free
          Software Foundation. This is good news for users who want a system
          unencumbered by proprietary software. It runs from a CD and is
          optimized both for speed and low hardware requirements, requiring at
          a minimum a Pentium II 400 MHz computer or an Xbox game console. You
          can use it with either a Linux or Windows PC, you can save your data
          to a USB stick or local hard drive, and it has a hard drive
          installation option. Customization is not as simple as using Yum or
          Apt to install new software packages because you have to build a new
          CD image. It comes with good documentation and a friendly user
          community.<a id="IDX-CHP-13-0013" class="indexterm"/><a id="IDX-CHP-13-0014" class="indexterm"/><a id="IDX-CHP-13-0015" class="indexterm"/><a id="IDX-CHP-13-0016" class="indexterm"/></p><p>dyne:bolic is Rasta (<a class="ulink" href="http://www.rastasoft.org/">http://www.rastasoft.org/</a>) software. Jaromil, the
          main dyne:bolic developer, says this:</p><div class="blockquote"><blockquote class="blockquote"><p>But remember there is no Peace without Justice. This
            software is about Resistance in a babylon world which tries to
            control more and more the way we communicate and we share
            informations and knowledge. This software is for all those who
            cannot afford to have the latest expensive hardware to speak out
            their words of consciousness and good will. This software has a
            full range of applications for the production and not only the
            fruition of information, it’s a full multimedia studio and has
            nothing to envy to other proprietary systems, because freedom and
            share of knowledge are solid principles for evolution and that’s
            where this software comes from.</p></blockquote></div></div><div class="sect3" title="pure:dyne"><div class="titlepage"><div><div><h3 class="title"><a id="pure_colon_dyne"/>pure:dyne</h3></div></div></div><p>pure:dyne was initially based on dyne:bolic but has evolved
          into a blend of Ubuntu and Debian. It runs from CD, DVD, USB stick,
          or a hard drive installation. It is more up-to-date than dyne:bolic
          and is optimized for modern i686 processors, though it will also run
          on older hardware. It is designed to be user-customizable and comes
          with tools to create customized images.<a id="IDX-CHP-13-0017" class="indexterm"/></p></div><div class="sect3" title="Musix"><div class="titlepage"><div><div><h3 class="title"><a id="musix"/>Musix</h3></div></div></div><p>Musix is Debian based, for 32-bit systems. It comes on a live
          CD or live DVD, and it also has a hard drive installation option.
          Musix is also a 100 percent free operating system. It provides a
          lightweight desktop environment based on IceWM and the wonderful Rox
          filer, so it is suitable for modest hardware.<a id="IDX-CHP-13-0018" class="indexterm"/></p></div></div></div></div>
<div class="sect1" title="Building a Real-Time Kernel"><div class="titlepage"><div><div><h1 class="title"><a id="building_a_real-time_kernel"/>Building a Real-Time Kernel</h1></div></div></div><p>If you don’t want to use a multimedia Linux distribution and your
      favorite distro does not package a real-time kernel, you can build your
      own. A complete kernel-building how-to would be a whole chapter by
      itself, so I’m not going to try to stuff one into this chapter. You can
      easily find good how-tos; look for instructions specific to your
      distribution.<a id="IDX-CHP-13-0019" class="indexterm"/></p><p>You’ll need a proper build environment installed, kernel sources,
      and a copy of the configuration file for your current kernel. Once those
      are in place, you need the rt patch, which you can get from the
      mothership of the Linux kernel, <a class="ulink" href="http://www.kernel.org/">http://www.kernel.org/</a>. Go to the rt wiki at (<a class="ulink" href="http://rt.wiki.kernel.org/index.php/Main_Page">http://rt.wiki.kernel.org/index.php/Main_Page</a>), and look
      for the “CONFIG_PREEMPT_RT Patch” download. It must have the same
      version number as your kernel sources. Once you have that, apply it to
      your kernel sources.<a id="IDX-CHP-13-0020" class="indexterm"/><a id="IDX-CHP-13-0021" class="indexterm"/><a id="IDX-CHP-13-0022" class="indexterm"/></p><p>In your kernel makefile, set <code class="literal">EXTRAVERSION</code> equal to a value that tells you
      this is a real-time kernel, such as <code class="literal">EXTRAVERSION = -rt</code>. Then if your kernel
      version is 2.6.33.1, for example, your new kernel name will be
      linux-2.6.33.1-rt.</p><p>Now you are ready to configure your new kernel. Start with your
      existing kernel configuration and run the <strong class="userinput"><code>make oldconfig</code></strong> command; you don’t need to
      start from scratch just to enable real-time preemption. Review your
      kernel configuration and enable Processor type and features &gt;
      Preemption Mode (Complete Preemption (Real-Time)), and Processor type
      and features &gt; Timer frequency (1000 Hz).</p><p>Then finish configuration, and compile and install your new
      kernel. That should be all there is to it, but review the rt wiki to
      make sure, because Linux kernel development is a fast-moving target.
      Keep your old stock kernel installed as well. You can have as many
      kernels as you want on your system, and if anything goes wrong, you’ll
      have a good kernel to boot to.</p></div>
<div class="sect1" title="Latency Is Not That Scary"><div class="titlepage"><div><div><h1 class="title"><a id="latency_is_not_that_scary"/>Latency Is Not That Scary</h1></div></div></div><p>Latency is not the great bugaboo that it is sometimes made out to
      be. One way to handle latency is to throw horsepower at it. A modern
      multicore CPU, gigabytes of RAM, and fast hard drives can make latency
      almost disappear.</p><p>If that is not an option, it helps to understand when latency
      really is a problem and when it isn’t. It matters when you are
      overdubbing. And even here Audacity helps with that, because it has a
      configurable latency correction in the <span class="strong"><strong>Edit</strong></span> &gt; <span class="strong"><strong>Preferences</strong></span> &gt; <span class="strong"><strong>Recording</strong></span> dialog. (See <a class="xref" href="ch12.html" title="Chapter 12. Fix-its and Cleanups">Chapter 12</a> to learn how to measure and correct
      for latency.) It matters when you are playing a software synthesizer or
      playing any instrument through special effects plug-ins on your
      computer: When you press a key or strum a string, you want music to come
      out, not lag. It matters when you are monitoring a recording session,
      because you don’t want what you hear to be out of sync.<a id="IDX-CHP-13-0023" class="indexterm"/></p><p>In the <span class="strong"><strong>Edit</strong></span> &gt; <span class="strong"><strong>Preferences</strong></span> &gt; <span class="strong"><strong>Recording</strong></span> dialog, there is a setting that
      affects latency called “Audio to buffer.” Smaller buffers equal lower
      latency, but if they are too small for your CPU to handle, you’ll get
      dropouts.</p><p>Latency doesn’t matter so much during mixing or during
      multichannel recording where everything is plugged into a good recording
      interface that has a direct path to Audacity with no detours. It is more
      important to have a stable setup that doesn’t crash in the middle of a
      recording session. If you can live with higher latencies in exchange for
      stability, that is a good trade. It’s no good pushing latency levels
      down to the point of instability.</p><p>Interrupts are less of a problem when you run a clean system with
      everything turned off except what you need for audio production. (See
      <a class="xref" href="ch13s10.html" title="Linux System Tweaks">Linux System Tweaks</a> in <a class="xref" href="ch13s10.html" title="Linux System Tweaks">Linux System Tweaks</a>.)</p><p>JACK, the Jack Audio Connection Kit, has its own configuration
      options for latency and buffer size, which you can read all about in
      <a class="xref" href="ch13s08.html" title="Using JACK with Audacity">Using JACK with Audacity</a> in <a class="xref" href="ch13s08.html" title="Using JACK with Audacity">Using JACK with Audacity</a>.<a id="IDX-CHP-13-0024" class="indexterm"/><a id="IDX-CHP-13-0025" class="indexterm"/><a id="IDX-CHP-13-0026" class="indexterm"/><a id="IDX-CHP-13-0027" class="indexterm"/><a id="IDX-CHP-13-0028" class="indexterm"/><a id="IDX-CHP-13-0029" class="indexterm"/></p></div>
<div class="sect1" title="Sorting Out Linux Audio"><div class="titlepage"><div><div><h1 class="title"><a id="sorting_out_linux_audio"/>Sorting Out Linux Audio</h1></div></div></div><p>In this book we use Audacity with ALSA and JACK. No PulseAudio,
      OSS, aRts, ESD, or whatever else might be lurking in the
      weeds.<a id="IDX-CHP-13-0030" class="indexterm"/></p><p>The Linux audio landscape has been complicated for some years,
      with multiple subsystems and overlapping functionality, and now it is
      going through some significant changes. There is not a single Linux
      audio API that developers can target, but rather they must deal with a
      herd of audio servers and subsystems: the Open Sound System (OSS), the
      Advanced Linux Sound Architecture (ALSA), the Enlightened Sound Daemon
      (ESD) on Gnome, the analog Real time synthesizer (aRts) for KDE2/3,
      Phonon for KDE4, PulseAudio, and the JACK Audio Connection
      Kit.<a id="IDX-CHP-13-0031" class="indexterm"/><a id="IDX-CHP-13-0032" class="indexterm"/><a id="IDX-CHP-13-0033" class="indexterm"/><a id="IDX-CHP-13-0034" class="indexterm"/></p><p>ESD and aRts are entering retirement, so that thins the herd a
      bit, leaving PulseAudio (which runs on any Unix-type operating system),
      Phonon (KDE4) for controlling playback, and JACK for professional audio
      production. ALSA provides a common driver base for all of these that
      interacts directly with audio hardware, and it also provides a useful
      set of user tools, such as a mixer, device discovery, a simple player
      and recorder, and a speaker tester. PulseAudio is finding its way into
      many Linux distributions, such as Ubuntu and Fedora, and it looks like
      it will become the dominant desktop audio server.</p><p>PulseAudio is a sound daemon, while Phonon is a multimedia API
      supporting multiple audio frameworks, including PulseAudio. PulseAudio
      and Phonon provide playback mixers and routers and networked sound. Many
      Linux applications do not have audio device choosers. For example, the
      Firefox web browser only uses the default audio device. PulseAudio and
      Phonon let you control which audio device Firefox uses. I prefer to turn
      PulseAudio off when I’m using Audacity; <a class="xref" href="ch13s09.html" title="Turning PulseAudio and Phonon Off">Turning PulseAudio and Phonon Off</a> in <a class="xref" href="ch13s09.html" title="Turning PulseAudio and Phonon Off">Turning PulseAudio and Phonon Off</a> tells you how to do
      this.</p><p>What about OSS? Some folks prefer it, and you’re welcome to give
      it a try. ALSA is better supported in Linux, and it includes OSS
      emulation for applications that want OSS.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>The Adobe Flash Player music player is buggy and unreliable. For
        example, Pandora Radio, the wonderful online music broadcaster, relies
        entirely on Flash. It is a great service, and I am happy to be a paid
        subscriber. But Flash Player is an ongoing source of trouble. It loses
        its connection to the audio system periodically, and it doesn’t like
        changes in device routing, such as when changing from computer
        speakers to an external sound system. When it flakes out, it takes a
        either a browser refresh or a restart to get it going again. If you
        need an audio source for testing, you should look for something
        else.<a id="IDX-CHP-13-0035" class="indexterm"/></p></div><p>JACK is a professional-quality, low-latency (meaning it adds no
      latency to your sound chain) sound server for connecting audio hardware
      to audio production software. JACK does not run standalone but requires
      <span class="emphasis"><em>alsa-base</em></span>. JACK supports multiple audio backends:
      OSS; FFADO (formerly Freebob) for using FireWire recording interfaces on
      Linux; PortAudio, which is a simple cross-platform audio API; and
      CoreAudio, the Mac OS X audio API. Audacity uses PortAudio.<a id="IDX-CHP-13-0036" class="indexterm"/><a id="IDX-CHP-13-0037" class="indexterm"/><a id="IDX-CHP-13-0038" class="indexterm"/><a id="IDX-CHP-13-0039" class="indexterm"/><a id="IDX-CHP-13-0040" class="indexterm"/></p><p>Let’s clear up some common confusions regarding PulseAudio and
      JACK. They address two different types of usage: PulseAudio is a device
      chooser and audio stream router for playback and recording, while JACK
      is an audio router for high-end audio production. JACK lets you route
      the output of multiple audio applications pretty much any way you want,
      so you can combine different synths and capture audio streams in various
      ways for recording. Pulse is CPU-intensive and creates too much latency
      for overdubbing and other latency-sensitive tasks, though both issues
      are improving as Pulse matures. It works fine for making simple
      recordings, and Audacity and JACK both support Pulse. You need the
      pulseaudio-module-jack plug-in for JACK support, which should be in your
      distro repositories.</p><p>When do you use JACK? You don’t need it when your recording
      interface handles all the connections you need for your recording
      session. If everything plugs into a single recording interface, just
      point Audacity to it, and you’re good to go. Though even here JACK can
      help by giving you flexible routing options, letting you mix the audio
      streams in different ways and making performance adjustments.</p><p>You need JACK when you are using a FireWire recording interface.
      You need it when you want to incorporate software audio applications
      into your Audacity recording session. (JACK has great MIDI support,
      though Audacity does not support MIDI.) A simple example that we’ll go
      into in detail (in <a class="xref" href="ch13s08.html" title="Using JACK with Audacity">Using JACK with Audacity</a> in <a class="xref" href="ch13s08.html" title="Using JACK with Audacity">Using JACK with Audacity</a>) is adding the excellent Hydrogen
      software drum machine to an Audacity recording session. If you want to
      use Hydrogen to create a drum track in Audacity, you need JACK to
      connect the two.</p></div>
<div class="sect1" title="Using ALSA"><div class="titlepage"><div><div><h1 class="title"><a id="using_alsa"/>Using ALSA</h1></div></div></div><p>ALSA has two parts: the low-level base that supplies sound card
      drivers and interacts directly with audio hardware and a higher-level
      interface that contains the userland tools.
      <span class="emphasis"><em>alsa-base</em></span> and its dependencies should already be
      present, but you may need to install <span class="emphasis"><em>alsa-utils</em></span> to
      get the userland tools. <span class="emphasis"><em>alsa-utils</em></span> gives you
      <code class="literal">alsamixer, aplay, speaker-test,
      arecord</code>, and number of sound files for testing your
      speakers.</p><p>Open a terminal and type in <strong class="userinput"><code>alsamixer</code></strong> to open the mixer console, shown
      in <a class="xref" href="ch13s05.html#using_alsamixer_to_configure_onboard_sur" title="Figure 13-1. Using alsamixer to configure onboard surround sound. On my system, all of the modules must be active—Surround, Center, LFE, and Side—for stereo sound to work, even though their volume controls have no effect.">Figure 13-1</a>. ALSA
      runs in the console via an ncurses interface, which means it is
      completely keyboard controlled and does not require an X server. The
      top-left caption tells you a lot of useful information: your sound card
      and chipset, which set of functions you’re viewing, and the values for
      the highlighted setting. Use the arrow keys to navigate back and forth.
      There are three views: Playback, Capture, and All. Press the <span class="keycap">tab</span> key to toggle between them. Pressing the
      <span class="keycap">esc</span> key closes <code class="literal">alsamixer</code>.</p><div class="figure"><a id="using_alsamixer_to_configure_onboard_sur"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject13_d1e18338"/><img src="httpatomoreillycomsourcenostarchimages797851.png.jpg" alt="Using alsamixer to configure onboard surround sound. On my system, all of the modules must be active—Surround, Center, LFE, and Side—for stereo sound to work, even though their volume controls have no effect."/></div></div><p class="title">Figure 13-1. Using <code class="literal">alsamixer</code> to configure
        onboard surround sound. On my system, all of the modules must be
        active—Surround, Center, LFE, and Side—for stereo sound to work, even
        though their volume controls have no effect.</p></div><p>Press the F2 key to see detailed information on all your detected
      audio devices, as in <a class="xref" href="ch13s05.html#alsamixer_queries_the_solidus_proc_files" title="Figure 13-2. alsamixer queries the /proc filesystem to show detailed information on your audio devices.">Figure 13-2</a>. Note that they
      are numbered from zero. Use the arrow keys to scroll up and down, and
      press the <span class="keycap">return</span> key to close the
      information window.</p><div class="figure"><a id="alsamixer_queries_the_solidus_proc_files"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject13_d1e18358"/><img src="httpatomoreillycomsourcenostarchimages797853.png.jpg" alt="alsamixer queries the /proc filesystem to show detailed information on your audio devices."/></div></div><p class="title">Figure 13-2. <code class="literal">alsamixer</code> queries the
        <span class="emphasis"><em>/proc</em></span> filesystem to show detailed information on
        your audio devices.</p></div><p><a class="xref" href="ch13s05.html#the_alsamixer_playback_screen_controls_m" title="Figure 13-3. The alsamixer playback screen controls muting and volume on playback devices.">Figure 13-3</a> shows
      the Playback configuration screen.<a id="IDX-CHP-13-0041" class="indexterm"/></p><div class="figure"><a id="the_alsamixer_playback_screen_controls_m"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject13_d1e18377"/><img src="httpatomoreillycomsourcenostarchimages797855.png.jpg" alt="The alsamixer playback screen controls muting and volume on playback devices."/></div></div><p class="title">Figure 13-3. The <code class="literal">alsamixer</code> playback
        screen controls muting and volume on playback devices.</p></div><div class="sect2" title="Setting Recording and Playback Levels in alsamixer"><div class="titlepage"><div><div><h2 class="title"><a id="setting_recording_and_playback_levels_in"/>Setting Recording and Playback Levels in alsamixer</h2></div></div></div><p><code class="literal">alsamixer</code> only displays
        functions that your sound card is capable of performing. Here are the
        basic <code class="literal">alsamixer</code> commands:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The little boxes with MM in the playback menu mean those
            functions are muted, or disabled. Toggle the M key to mute/unmute,
            and the MM turns to 00.</p></li><li class="listitem"><p>00 means zero volume, so use the up- and down-arrow keys to
            adjust it. <span class="keycap">page up</span> increases
            volume by 5, <span class="keycap">page down</span> decreases
            volume by 5, and <span class="keycap">end</span> sets the
            volume to 0.</p></li><li class="listitem"><p>When there are two channels on one slider, you can adjust
            each one independently. Q increases the left channel, and Z
            decreases it. E increases the right channel, and C decreases
            it.</p></li><li class="listitem"><p>In the Capture screen, press the spacebar to select the
            active recording (Capture) device. There may be more than two
            options, so press it several times to see what your choices
            are.</p></li><li class="listitem"><p>Press the F1 key to see a Help menu. F2 displays your
            <span class="emphasis"><em>/proc</em></span> information, which shows you what is
            actually detected and working, as well as device addresses.</p></li></ul></div><p>Sometimes you will experience static or too-low volume that is
        caused by having unnecessary functions enabled. For example, the
        Playback screen for my ATI onboard sound shows a front mic volume
        control. When this is enabled, it causes static. When I’m using
        headphones, the Headphone control needs to be turned on, but changing
        the volume level has little effect, and I need to use both the Master
        and PCM volume controls. The Master volume control is not needed for
        the speakers, but the Headphone control is. Trial and error is about
        the only way to figure these things out, and lower-end sound cards are
        more troublesome and quirky than the better-quality ones.<a id="IDX-CHP-13-0042" class="indexterm"/><a id="IDX-CHP-13-0043" class="indexterm"/></p></div><div class="sect2" title="Master vs. PCM"><div class="titlepage"><div><div><h2 class="title"><a id="master_vs._pcm"/>Master vs. PCM</h2></div></div></div><p>There is often confusion over Master and PCM playback settings.
        You usually need both Master and PCM to enable playback, though
        sometimes only the PCM slider has any effect. If the Master slider has
        no effect, this means either there is no hardware volume control built
        into your sound card or your sound card driver is lacking this
        functionality. Master is the master volume control, and PCM stands for
        <span class="emphasis"><em>pulse code modulation</em></span>. Remember <a class="xref" href="ch01s13.html" title="Audio File Formats and Quality Settings">Audio File Formats and Quality Settings</a> in <a class="xref" href="ch01s12.html" title="Final Mixdown">Final Mixdown</a>, where we learned about converting analog
        signals to digital representations? ALSA’s definition of PCM sorts it
        out for us:</p><div class="blockquote"><blockquote class="blockquote"><p>Although abbreviation PCM stands for “pulse code modulation,”
          we are understanding it as general digital audio processing with
          volume samples generated in continuous time periods.</p></blockquote></div><p>So think of ALSA’s PCM channel as a virtual sound card.</p></div><div class="sect2" title="Multiple Sound Cards"><div class="titlepage"><div><div><h2 class="title"><a id="multiple_sound_cards"/>Multiple Sound Cards</h2></div></div></div><p>If you have more than one audio interface, <code class="literal">alsamixer</code> numbers them from zero. For
        example, I have both onboard sound and the M-Audio MobilePre connected
        to a USB port. The MobilePre is #1, so to control it, I need to open
        <code class="literal">alsamixer</code> with this command:</p><a id="I_programlisting13_d1e18460"/><pre class="programlisting">$ alsamixer -c1</pre><p><code class="literal">-c1</code> means “card number 1.”
        How do you know what your card numbers are? One way is to query
        <span class="emphasis"><em>/proc</em></span>:</p><a id="I_programlisting13_d1e18469"/><pre class="programlisting">$ cat /proc/asound/cards

 0 SB             : HDA-Intel - HDA ATI SB
                      HDA ATI SB at 0xf9ff4000 irq 16
 1 MobilePre      : USB-Audio - MobilePre
                      M Audio MobilePre at usb-0000:00:12.1-1, full speed</pre><p>Another way is to press F2 in <code class="literal">alsamixer</code> (<a class="xref" href="ch13s05.html#alsamixer_queries_the_solidus_proc_files" title="Figure 13-2. alsamixer queries the /proc filesystem to show detailed information on your audio devices.">Figure 13-2</a>).</p></div><div class="sect2" title="Adjusting Volume Levels"><div class="titlepage"><div><div><h2 class="title"><a id="adjusting_volume_levels"/>Adjusting Volume Levels</h2></div></div></div><p>When you’re adjusting recording and playback settings in
        Audacity, you can have <code class="literal">alsamixer</code>
        open at the same time, as <a class="xref" href="ch13s05.html#the_alsamixer_capture_window_controls_de" title="Figure 13-4. The alsamixer Capture window controls device selection and volume on recording devices. Here it is tiled with Audacity for controlling the recording volume level.">Figure 13-4</a> shows. It’s a
        fast way to tweak volume settings and to find out what the <code class="literal">alsamixer</code> settings actually control. In this
        example, a bit of trial and error showed me that the Mic Boost and the
        first Capture slider controlled the microphone recording volume and
        that this sound card has a real stereo microphone input with two
        channels. (Remember, the Q and Z keys raise and lower the volume on
        the left channel, and E and C control the right channel.)<a id="IDX-CHP-13-0044" class="indexterm"/></p><div class="figure"><a id="the_alsamixer_capture_window_controls_de"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject13_d1e18503"/><img src="httpatomoreillycomsourcenostarchimages797857.png.jpg" alt="The alsamixer Capture window controls device selection and volume on recording devices. Here it is tiled with Audacity for controlling the recording volume level."/></div></div><p class="title">Figure 13-4. The <code class="literal">alsamixer</code> Capture
          window controls device selection and volume on recording devices.
          Here it is tiled with Audacity for controlling the recording volume
          level.</p></div><p>Even in a simple setup like this, there are multiple recording
        level controls, both in ALSA and Audacity. Keep <code class="literal">alsamixer</code> open for adjustments during
        recording.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>If you need a good excuse to splurge on a dual-monitor setup,
          audio production is a great reason. You can have Audacity, JACK, and
          alsamixer on one screen and your other audio applications (like
          Hydrogen, other synths, special effects) on the second screen. Nice
          and tidy, and you don’t have to keep moving things out of the
          way.</p></div></div></div>
<div class="sect1" title="Hardware Testing with alsa-utils"><div class="titlepage"><div><div><h1 class="title"><a id="hardware_testing_with_alsa-utils"/>Hardware Testing with alsa-utils</h1></div></div></div><p><span class="emphasis"><em>alsa-utils</em></span> includes some good commands to
      help you troubleshoot and test your hardware. Keep <code class="literal">alsamixer</code> open to the sound card you are
      testing so you can quickly try different settings. The most common cause
      of no sound is because it is muted in <code class="literal">alsamixer</code>.<a id="IDX-CHP-13-0045" class="indexterm"/><a id="IDX-CHP-13-0046" class="indexterm"/><a id="IDX-CHP-13-0047" class="indexterm"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p>If you are running the JACK audio server, turn it off for these
        tests because these commands may not work when JACK is running. It is
        best to keep tests as simple as possible in any case.</p></div><p>This is a quick and annoying way to verify that your default sound
      card and speakers work. It should generate some white noise:</p><a id="I_programlisting13_d1e18546"/><pre class="programlisting">$ cat /dev/urandom &gt; /dev/dsp</pre><p><span class="keycap">ctrl</span>-C stops it. A nicer way is
      to use <code class="literal">aplay</code> to play a WAV file of
      your choosing, like this:</p><a id="I_programlisting13_d1e18555"/><pre class="programlisting">$ aplay -t wav violin-summit.wav</pre><p><code class="literal">-t</code> means “file type,” and your
      choices are <code class="literal">voc</code>, <code class="literal">wav</code>, <code class="literal">raw</code>,
      and <code class="literal">au</code>. <code class="literal">wav</code> is the default.</p><p>To see the PCM structure and a nice ASCII VU (volume units) meter,
      try this:</p><a id="I_programlisting13_d1e18578"/><pre class="programlisting">$ aplay -vv -t wav -V stereo violin-summit.wav
Playing WAVE 'violin-summit.wav' : Signed 16 bit Little Endian, Rate 44100 Hz, Stereo
Plug PCM: Soft volume PCM
Control: PCM Playback Volume
min_dB: -51
max_dB: 0
resolution: 256
Its setup is:
  stream : PLAYBACK
  access : RW_INTERLEAVED
  format : S16_LE
  subformat : STD
  channels : 2
  rate : 44100
  exact rate : 44100 (44100/1)
  msbits : 16
  buffer_size : 16384
  period_size : 4096
  period_time : 92879
  tstamp_mode : NONE
  period_step : 1
  avail_min : 4096
  period_event : 0
  start_threshold : 16384
  stop_threshold : 16384
  silence_threshold: 0
  silence_size : 0
  boundary : 4611686018427387904
        +############### 46%|48%################+</pre><p><code class="literal">-V stereo</code> means “display stereo
      VU meter,” which is represented by the hash marks. These represent the
      RMS volume levels (root mean square, or average volume over time), and
      the percentage values are the peaks. You can see that this is a stereo
      CD-quality file, or 2-channel 16 bits at 44.1 kHz.<a id="IDX-CHP-13-0048" class="indexterm"/></p><p>What if you have more than one sound card? Use <code class="literal">aplay -l</code> to display the raw ALSA device
      information for all of your audio interfaces:</p><a id="I_programlisting13_d1e18595"/><pre class="programlisting">$ aplay -l
**** List of PLAYBACK Hardware Devices ****
card 0: SB [HDA ATI SB], device 0: VT1708S Analog VT1708S Analog
  Subdevices: 2/2
  Subdevice #0: subdevice #0
  Subdevice #1: subdevice #1
card 0: SB HDA ATI SB, device 1: VT1708S Digital VT1708S Digital
  Subdevices: 1/1
  Subdevice #0: subdevice #0
card 1: MobilePre MobilePre, device 0: USB Audio USB Audio
  Subdevices: 0/1
  Subdevice #0: subdevice #0</pre><p>ALSA devices are named in the format
      <span class="emphasis"><em>interface:card,device</em></span>. Sound cards are numbered
      from zero. An ALSA interface is a PCM playback or recording device, a
      MIDI device, or a control device such as a mixer. The <code class="literal">hw</code> interface talks directly to the kernel, so
      this is the most direct way to test your audio hardware. This example
      sends a WAV file to the first ALSA interface, the ATI SB onboard sound
      chipset at <code class="literal">hw:0,0</code>:</p><a id="I_programlisting13_d1e18608"/><pre class="programlisting">$ aplay -vv -t wav -D hw:0,0 angeline-the-baker.wav</pre><p>Sometimes you’ll see an error message like this: <code class="literal">Warning: rate is not accurate (requested = 44100Hz, got
      = 48000Hz) please, try the plug plugin.</code> This means use
      <code class="literal">plughw</code> in place of <code class="literal">hw</code>:</p><a id="I_programlisting13_d1e18621"/><pre class="programlisting">$ aplay -vv -t wav -D plughw:0,0 angeline-the-baker.wav</pre><p><code class="literal">hw</code> makes no conversions of any
      kind—think of it as your literal playback device. It can do only what
      the hardware supports, so some audio files might sound weird or not play
      at all. <code class="literal">plughw</code> is a special ALSA
      plug-in that is like <code class="literal">hw</code> with extra
      powers; it can perform whatever conversions are necessary to play your
      files. <code class="literal">aplay</code> supports only <code class="literal">voc</code>, <code class="literal">wav</code>,
      <code class="literal">raw</code>, or <code class="literal">au</code>, so you might as well stick with
      WAVs.</p><p>This example plays a file on the second ALSA device, which in the
      example is the MobilePre:<a id="IDX-CHP-13-0049" class="indexterm"/></p><a id="I_programlisting13_d1e18654"/><pre class="programlisting">$ aplay -vv -t wav -D hw:1,0 angeline-the-baker.wav</pre><p>If there were a third audio interface, it would be <code class="literal">hw:2,0</code>.</p><div class="sect2" title="Testing Speakers"><div class="titlepage"><div><div><h2 class="title"><a id="testing_speakers"/>Testing Speakers</h2></div></div></div><p>The <code class="literal">speaker-test</code> command
        helps you determine whether your speakers are connected in the correct
        order. This example tests two-channel stereo:<a id="IDX-CHP-13-0050" class="indexterm"/><a id="IDX-CHP-13-0051" class="indexterm"/></p><a id="I_programlisting13_d1e18677"/><pre class="programlisting">$ speaker-test -t wav -D hw:0,0 -c2 -l1

speaker-test 1.0.20

Playback device is hw:0,0
Stream parameters are 48000Hz, S16_LE, 2 channels
WAV file(s)
Rate set to 48000Hz (requested 48000Hz)
Buffer size range from 64 to 16384
Period size range from 32 to 8192
Using max buffer size 16384
Periods = 4
was set period_size = 4096
was set buffer_size = 16384
 0 - Front Left
 1 - Front Right
Time per period = 2.732753</pre><p>You should hear a pleasant woman’s voice say, “Front left, front
        right.” <code class="literal">-c2</code> means two channels, and
        <code class="literal">-l1</code> means run the test once.</p><p>This chipset supports 5:1 surround sound, so you can test this
        too:</p><a id="I_programlisting13_d1e18689"/><pre class="programlisting">$ speaker-test -t wav -D hw:0,0 -c6 -l1

speaker-test 1.0.20

Playback device is hw:0,0
Stream parameters are 48000Hz, S16_LE, 6 channels
Rate set to 48000Hz (requested 48000Hz)
Buffer size range from 6 to 5461
Period size range from 3 to 2730
Using max buffer size 5460
Periods = 4
was set period_size = 1365
was set buffer_size = 5460

 0 - Front Left
 4 - Center
 1 - Front Right
 3 - Rear Right
 2 - Rear Left
 5 - LFE
Time per period = 17.801733</pre><p>You can test a single speaker with the <code class="literal">-s</code> option, like this example that tests the
        center speaker channel:</p><a id="I_programlisting13_d1e18696"/><pre class="programlisting">$ speaker-test -t wav -D hw:0,0 -c6 -s5 -l1

speaker-test 1.0.20

Playback device is hw:0,0
Stream parameters are 48000Hz, S16_LE, 6 channels
WAV file(s)
Rate set to 48000Hz (requested 48000Hz)
Buffer size range from 6 to 5461
Period size range from 3 to 2730
Using max buffer size 5460
Periods = 4
was set period_size = 1365
was set buffer_size = 5460
  - Center</pre><p>Notice the clever gotcha: The <code class="literal">speaker-test</code> output numbers the speakers
        from zero, but for the <code class="literal">-s</code> option,
        you have to start from 1.</p><p><code class="literal">-t wav</code> uses the included
        default WAV testing file; you might also try <code class="literal">pink</code>, which generates pink noise, and
        <code class="literal">sine</code>, which sounds like the sine
        wave tones from way back in the olden days of TV test screens. (Now
        they use infomercials. I miss the test screens.) You may specify
        different frequencies (in Hz) to use with the <code class="literal">sine</code> option, like this example that tests
        the subwoofer with a nice low 45 Hz tone:</p><a id="I_programlisting13_d1e18719"/><pre class="programlisting">$ speaker-test -t sine -f 45 -D hw:0,0 -c6 -s6</pre><p>LFE means low frequency effects channel or low frequency
        emitter. This is the channel that handles low-pitched sounds ranging
        from 3 to 200 Hz. This is not the same as the physical port that you
        plug a subwoofer into, because the LFE signal can be routed to any
        speaker or speakers that support it.</p></div><div class="sect2" title="Testing Recording"><div class="titlepage"><div><div><h2 class="title"><a id="testing_recording"/>Testing Recording</h2></div></div></div><p><code class="literal">aplay</code> has a companion
        command, <code class="literal">arecord</code>. Remember to check
        <code class="literal">alsamixer</code> for the correct settings,
        such as capture device and volume controls. If your computer has both
        front and rear microphone ports, <code class="literal">alsamixer</code> should have an option to select
        the correct one. In this example, two audio devices are
        detected:<a id="IDX-CHP-13-0052" class="indexterm"/><a id="IDX-CHP-13-0053" class="indexterm"/><a id="IDX-CHP-13-0054" class="indexterm"/></p><a id="I_programlisting13_d1e18754"/><pre class="programlisting">$ arecord -l
**** List of CAPTURE Hardware Devices ****
card 0: SB HDA ATI SB, device 0: VT1708S Analog VT1708S Analog
  Subdevices: 2/2
  Subdevice #0: subdevice #0
  Subdevice #1: subdevice #1
card 1: MobilePre MobilePre, device 0: USB Audio USB Audio
  Subdevices: 1/1
  Subdevice #0: subdevice #0</pre><p>This example makes a test recording with the MobilePre:</p><a id="I_programlisting13_d1e18758"/><pre class="programlisting">$ arecord -vv -fcd -V stereo -D hw:1,0 test.wav
Recording WAVE 'test.wav' : Signed 16 bit Little Endian, Rate 44100 Hz, Stereo
Hardware PCM card 1 'MobilePre' device 0 subdevice 0
Its setup is:
  stream       : CAPTURE
  access       : RW_INTERLEAVED
  format       : S16_LE
  subformat    : STD
  channels     : 2
  rate         : 44100
  exact rate   : 44100 (44100/1)
  msbits       : 16
  buffer_size  : 22050
  period_size  : 5513
  period_time  : 125011
  tstamp_mode  : NONE
  period_step  : 1
  avail_min    : 5513
  period_event : 0
  start_threshold  : 1
  stop_threshold   : 22050
  silence_threshold: 0
  silence_size : 0
  boundary     : 6206523236469964800
  appl_ptr     : 0
  hw_ptr       : 0
                   +############## 43%|34%###########+</pre><p><span class="keycap">ctrl</span>-C stops recording.
        <code class="literal">-fcd</code> means CD-quality, which is
        2-channel 16-bit at 44.1 kHz. <code class="literal">aplay</code>
        plays back the test recording:<a id="IDX-CHP-13-0055" class="indexterm"/></p><a id="I_programlisting13_d1e18773"/><pre class="programlisting">$ aplay -vv -t wav -V stereo -D hw:1,0 test.wav</pre></div><div class="sect2" title="ALSA Applications"><div class="titlepage"><div><div><h2 class="title"><a id="alsa_applications"/>ALSA Applications</h2></div></div></div><p>ALSA creates a number of virtual interfaces for your sound card
        called <span class="emphasis"><em>applications</em></span>. You can view these with
        <code class="literal">aplay</code>:<a id="IDX-CHP-13-0056" class="indexterm"/></p><a id="I_programlisting13_d1e18791"/><pre class="programlisting">$ aplay -L
default:CARD=SB
    HDA ATI SB, VT1708S Analog
    Default Audio Device
front:CARD=SB,DEV=0
    HDA ATI SB, VT1708S Analog
    Front speakers
surround40:CARD=SB,DEV=0
    HDA ATI SB, VT1708S Analog
    4.0 Surround output to Front and Rear speakers
surround41:CARD=SB,DEV=0
    HDA ATI SB, VT1708S Analog
    4.1 Surround output to Front, Rear and Subwoofer speakers
surround50:CARD=SB,DEV=0
    HDA ATI SB, VT1708S Analog
    5.0 Surround output to Front, Center and Rear speakers
surround51:CARD=SB,DEV=0
    HDA ATI SB, VT1708S Analog
    5.1 Surround output to Front, Center, Rear and Subwoofer speakers
surround71:CARD=SB,DEV=0
    HDA ATI SB, VT1708S Analog
    7.1 Surround output to Front, Center, Side, Rear and Woofer speakers
iec958:CARD=SB,DEV=0
    HDA ATI SB, VT1708S Digital
    IEC958 (S/PDIF) Digital Audio Output
null
    Discard all samples (playback) or generate zero samples (capture)</pre><p>That’s a lot of applications! In ordinary use, these don’t
        matter to the user, or to applications that send sound streams to
        ALSA, because everything is handled behind the scenes. You can test
        these the same way you tested the <code class="literal">hw</code> interfaces:</p><a id="I_programlisting13_d1e18798"/><pre class="programlisting">$ speaker-test -t wav -D default:CARD=SB -c2 -l1

$ speaker-test -t wav -D surround71:CARD=SB,DEV=0 -c8 -l1

$ aplay -vv -D surround51:CARD=SB,DEV=0 madbanjos.wav</pre><p>On my system, <code class="literal">aplay</code> returned
        an identical set of applications for the MobilePre even though it
        doesn’t support surround sound but only two-channel stereo. So, this
        works:<a id="IDX-CHP-13-0057" class="indexterm"/><a id="IDX-CHP-13-0058" class="indexterm"/></p><a id="I_programlisting13_d1e18813"/><pre class="programlisting">$ speaker-test -t wav -D front:CARD=MobilePre,DEV=0 -c2 -l1</pre><p>But this doesn’t:</p><a id="I_programlisting13_d1e18817"/><pre class="programlisting">$ speaker-test -t wav -D surround51:CARD=MobilePre,DEV=0 -c6 -l1
Stream parameters are 48000Hz, S16_LE, 6 channels
WAV file(s)
Broken configuration for playback: no configurations available: Invalid argument
Setting of hwparams failed: Invalid argument</pre></div></div>
<div class="sect1" title="Querying Your Sound Card"><div class="titlepage"><div><div><h1 class="title"><a id="querying_your_sound_card"/>Querying Your Sound Card</h1></div></div></div><p>How do you know what abilities your sound card has, what bit
      depths and sample rates it supports, and how many channels? If you have
      no manual, you can query the <span class="emphasis"><em>/proc</em></span> filesystem to
      find out. Audio devices are in <span class="emphasis"><em>/proc/asound</em></span>. You
      can browse this directory in any file manager or from the command line.
      For example, on my system <span class="emphasis"><em>/proc/asound/card0</em></span> is the
      onboard ATI chipset. Reading
      <span class="emphasis"><em>/proc/asound/card0/codec#0</em></span> spits out a lot of
      information, and this snippet shows that this chipset supports high
      sampling rates and bit depths:</p><a id="I_programlisting13_d1e18836"/><pre class="programlisting">$ less /proc/asound/card0/codec#0
    rates [0x5e0]: 44100 48000 88200 96000 192000
    bits [0xe]: 16 20 24</pre><p>The MobilePre looks like this:</p><a id="I_programlisting13_d1e18840"/><pre class="programlisting">$ less /proc/asound/card1/stream0
M Audio MobilePre at usb-0000:00:12.1-1, full speed : USB Audio

Playback:
  Status: Stop
  Interface 1
    Altset 1
    Format: 0x2 (16 bits)
    Channels: 2
    Endpoint: 3 OUT (ADAPTIVE)
    Rates: 8000, 9600, 11025, 12000, 16000, 22050, 24000, 32000, 44100, 48000


Capture:
  Status: Stop
  Interface 2
    Altset 1
    Format: 0x2 (16 bits)
    Channels: 2
    Endpoint: 5 IN (SYNC)
    Rates: 8000, 9600, 11025, 12000, 16000, 22050, 24000, 32000, 44100, 48000</pre><p>How did I know which <span class="emphasis"><em>/proc</em></span> files to read? I
      tried ’em all. Do not try to edit <span class="emphasis"><em>/proc</em></span> files.
      <span class="emphasis"><em>/proc</em></span> is a pseudo-filesystem that exists only in
      memory, showing the current state of the kernel and operating
      system.<a id="IDX-CHP-13-0059" class="indexterm"/><a id="IDX-CHP-13-0060" class="indexterm"/></p></div>
<div class="sect1" title="Using JACK with Audacity"><div class="titlepage"><div><div><h1 class="title"><a id="using_jack_with_audacity"/>Using JACK with Audacity</h1></div></div></div><p>The JACK Audio Connection Kit is a marvelous creation. Its
      original creator was Paul Davis, and now Mr. Davis and a team of
      developers support JACK. It is a professional-quality, low-latency sound
      server for Linux and any POSIX-compliant operating system such as Mac OS
      X, Solaris, AIX, HP-UX, and IRIX. Currently it runs well on Linux, Mac
      OS X, and FreeBSD.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>Phonon (in KDE4) doesn’t get in the way when you’re using
        Audacity, but Pulse-Audio often does, so see <a class="xref" href="ch13s09.html" title="Turning PulseAudio and Phonon Off">Turning PulseAudio and Phonon Off</a> in <a class="xref" href="ch13s09.html" title="Turning PulseAudio and Phonon Off">Turning PulseAudio and Phonon Off</a> to learn how to disable
        it.</p></div><p>JACK acts like a switchboard to route audio signals between your
      audio hardware and software without adding latency. JACK can interface
      with only one sound card at a time, but it can interface with any number
      of software audio production applications, as long as they are
      JACK-aware. If you have a hardware device that controls all of your
      audio sources, then you don’t need JACK. For example, in my little
      studio, my MobilePre can handle up to 4 inputs, and the Saffire Pro can
      handle as many as 26. If everything I want to record plugs into one of
      those, I don’t need JACK. But suppose I want to use Hydrogen, the
      software drum kit for Linux? This is an excellent, fun drum synthesizer
      that is in most distro repositories, and it comes with a batch of demos
      so I can immediately start playing with it. How do I connect Hydrogen to
      Audacity? This is where JACK comes in.</p><p>The order in which you start your various applications is
      important. First get everything running and connected with JACK, and
      then Audacity always starts last. It seems we should be able to open
      Audacity after JACK is running, connect it to JACK, and then run
      whatever else we want. Sometimes this works because JACK updates new
      connections dynamically. But Audacity can be finicky, so I get
      everything else going first. Usually everything works fine on the first
      try, but sometimes Audacity throws out an error message about having the
      wrong sound device or some other unhappiness. Closing and reopening it
      usually takes care of this.</p><p>Let’s use the MobilePre, since it is easy and simple. It has two
      microphones connected for vocal and a guitar, and then we’ll add a nice
      drum track. First close all other audio applications, and then start
      JACK. JACK can run from the command line or the Qjackctl graphical
      interface. We’ll use Qjackctl, which should appear in your system menu
      as JACK Control (<a class="xref" href="ch13s08.html#qjackctl_comma_the_graphical_jack_contro" title="Figure 13-5. Qjackctl, the graphical JACK controller">Figure 13-5</a>).<a id="IDX-CHP-13-0061" class="indexterm"/><a id="IDX-CHP-13-0062" class="indexterm"/></p><div class="figure"><a id="qjackctl_comma_the_graphical_jack_contro"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject13_d1e18894"/><img src="httpatomoreillycomsourcenostarchimages797859.png.jpg" alt="Qjackctl, the graphical JACK controller"/></div></div><p class="title">Figure 13-5. Qjackctl, the graphical JACK controller</p></div><p>If JACK starts up when you open Qjackctl, stop it, and then click
      the Setup button. You’ll see a configuration dialog like <a class="xref" href="ch13s08.html#selecting_your_audio_devices_and_configu" title="Figure 13-6. Selecting your audio devices and configuring JACK in the Qjackctl Setup dialog">Figure 13-6</a>.</p><div class="figure"><a id="selecting_your_audio_devices_and_configu"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject13_d1e18906"/><img src="httpatomoreillycomsourcenostarchimages797861.png.jpg" alt="Selecting your audio devices and configuring JACK in the Qjackctl Setup dialog"/></div></div><p class="title">Figure 13-6. Selecting your audio devices and configuring JACK in the
        Qjackctl Setup dialog</p></div><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Check Realtime in the Parameters column if you are using a
          real-time kernel. Otherwise, don’t check it.</p></li><li class="listitem"><p>If there is a monitoring port on your recording interface,
          check H/W Monitor to enable it. Leave everything else in the first
          column unchecked.</p></li><li class="listitem"><p>In the next column, leave Priority at (default).</p></li><li class="listitem"><p>Leave Frames/Period at the default of 1024.</p></li><li class="listitem"><p>Set your sample rate and make sure it agrees with Audacity,
          Hydrogen, and any other audio software you are running. It must be a
          rate that your recording interface supports.<a id="IDX-CHP-13-0063" class="indexterm"/><a id="IDX-CHP-13-0064" class="indexterm"/></p></li><li class="listitem"><p>Periods/Buffer defaults to 2; leave it there for now.</p></li><li class="listitem"><p>Leave Port Maximum and Timeout at their defaults of 256 and
          500, respectively.</p></li><li class="listitem"><p>In the third column, choose “alsa” as the driver.</p></li><li class="listitem"><p>Choose your input and output devices; click the little arrows
          to the right to display all of your sound devices.</p></li><li class="listitem"><p>Set the numbers of input and output channels, which are
          whatever your audio interface supports. The MobilePre has two
          channels for both input and output.</p></li><li class="listitem"><p>Click <span class="strong"><strong>OK</strong></span>, and then click
          the <span class="strong"><strong>Start</strong></span> button. It is normal to
          see a few xruns at startup. Click the Messages and Status buttons to
          display everything you need to know about your JACK session, both
          good and bad.</p></li></ol></div><p>Now start up Hydrogen. <a class="xref" href="ch13s08.html#the_excellent_hydrogen_drum_synthesizer" title="Figure 13-7. The excellent Hydrogen drum synthesizer">Figure 13-7</a> shows what Hydrogen
      looks like.</p><div class="figure"><a id="the_excellent_hydrogen_drum_synthesizer"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject13_d1e18965"/><img src="httpatomoreillycomsourcenostarchimages797863.png.jpg" alt="The excellent Hydrogen drum synthesizer"/></div></div><p class="title">Figure 13-7. The excellent Hydrogen drum synthesizer</p></div><p>Hydrogen, like so many good Linux synths, lets you select which
      audio interface to use and which audio backend. Go into <span class="strong"><strong>Tools</strong></span> &gt; <span class="strong"><strong>Preferences</strong></span> &gt; <span class="strong"><strong>Audio
      System</strong></span> and select JACK. Make sure that the Connect to Default
      Output Pair option is not checked (<a class="xref" href="ch13s08.html#configuring_hydrogen_to_use_jack" title="Figure 13-8. Configuring Hydrogen to use JACK">Figure 13-8</a>).<a id="IDX-CHP-13-0065" class="indexterm"/></p><p>Now go to <span class="strong"><strong>Project</strong></span> &gt;
      <span class="strong"><strong>Open Demo</strong></span> and select a demo to play.
      Click the <span class="strong"><strong>Loop Song</strong></span> button (to the
      right of the Fast Forward button) to keep it going while you’re
      testing.</p><p>Next, click the <span class="strong"><strong>Connect</strong></span> button
      in Qjackctl. <a class="xref" href="ch13s08.html#jack_and_hydrogen_are_running_comma_and" title="Figure 13-9. JACK and Hydrogen are running, and the Connections window shows that Hydrogen is connected to your audio interface’s playback ports.">Figure 13-9</a>
      is the result. The System clients are the MobilePre channels; System
      clients always represent your audio interface, and of course Hydrogen is
      labeled as Hydrogen. You should hear a drum track on the playback device
      selected in JACK. If you don’t, connect the two Hydrogen out ports to
      two System playback ports. You will see lines connecting them.</p><p>Configure your playback device in JACK’s Setup dialog, whether
      it’s headphones, external speakers, or something else.</p><div class="figure"><a id="configuring_hydrogen_to_use_jack"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject13_d1e19011"/><img src="httpatomoreillycomsourcenostarchimages797865.png.jpg" alt="Configuring Hydrogen to use JACK"/></div></div><p class="title">Figure 13-8. Configuring Hydrogen to use JACK</p></div><div class="figure"><a id="jack_and_hydrogen_are_running_comma_and"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject13_d1e19019"/><img src="httpatomoreillycomsourcenostarchimages797867.png.jpg" alt="JACK and Hydrogen are running, and the Connections window shows that Hydrogen is connected to your audio interface’s playback ports."/></div></div><p class="title">Figure 13-9. JACK and Hydrogen are running, and the Connections window shows
        that Hydrogen is connected to your audio interface’s playback
        ports.</p></div><p>Now open Audacity. Configure Audacity to use JACK Audio Connection
      Kit: Hydrogen as the recording device and press the Record button. You
      should see something like <a class="xref" href="ch13s08.html#audacity_is_recording_the_hydrogen_drum" title="Figure 13-10. Audacity is recording the Hydrogen drum track, thanks to JACK.">Figure 13-10</a>.</p><div class="figure"><a id="audacity_is_recording_the_hydrogen_drum"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject13_d1e19031"/><img src="httpatomoreillycomsourcenostarchimages797869.png.jpg" alt="Audacity is recording the Hydrogen drum track, thanks to JACK."/></div></div><p class="title">Figure 13-10. Audacity is recording the Hydrogen drum track, thanks to
        JACK.</p></div><p>Voilà! Audacity is recording Hydrogen! The JACK Connections window
      now displays two new PortAudio clients, which are the Audacity recording
      inputs (<a class="xref" href="ch13s08.html#jack_connects_hydrogen_and_the_mobilepre" title="Figure 13-11. JACK connects Hydrogen and the MobilePre to Audacity. Audacity is represented by the two PortAudio clients. In this example, Hydrogen is being recorded through the two PortAudio clients and simultaneously playing back through the two system playback ports.">Figure 13-11</a>).<a id="IDX-CHP-13-0066" class="indexterm"/><a id="IDX-CHP-13-0067" class="indexterm"/><a id="IDX-CHP-13-0068" class="indexterm"/></p><div class="figure"><a id="jack_connects_hydrogen_and_the_mobilepre"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject13_d1e19056"/><img src="httpatomoreillycomsourcenostarchimages797871.png.jpg" alt="JACK connects Hydrogen and the MobilePre to Audacity. Audacity is represented by the two PortAudio clients. In this example, Hydrogen is being recorded through the two PortAudio clients and simultaneously playing back through the two system playback ports."/></div></div><p class="title">Figure 13-11. JACK connects Hydrogen and the MobilePre to Audacity. Audacity
        is represented by the two PortAudio clients. In this example, Hydrogen
        is being recorded through the two PortAudio clients and simultaneously
        playing back through the two system playback ports.</p></div><p>Usually the Connections window opens with the necessary
      connections in place and dynamically creates new ones on demand. If it
      doesn’t or you want to change them, just click a Readable Client, then
      click a Writable Client, and then click the Connect button (or
      Disconnect). You can create multiple connections to each client.</p><p>The MobilePre is a two-channel recording interface that supports
      up to four inputs, so when I record something through the microphones,
      it goes into the same two-channel stereo track as the Hydrogen drum
      track.</p><p>In some of the older versions of Audacity and JACK, the recording
      device selection was not consistent. Sometimes selecting JACK Audio
      Connection Kit: System worked, and sometimes I had to use JACK Audio
      Connection Kit: &lt;something else&gt;, depending on what else I was
      using. So, you may have to try a bit of trial and error.</p><div class="sect2" title="Connecting a FireWire Recording Interface"><div class="titlepage"><div><div><h2 class="title"><a id="connecting_a_firewire_recording_interfac"/>Connecting a FireWire Recording Interface</h2></div></div></div><p><a class="xref" href="ch13s08.html#the_ffado-mixer_for_the_focusrite_saffir" title="Figure 13-12. The ffado-mixer for the Focusrite Saffire Pro I/O 26">Figure 13-12</a>
        shows a simple example of using the Saffire Pro with JACK and
        Audacity. You need the ffado driver for Linux (<a class="ulink" href="http://www.ffado.org/">http://www.ffado.org/</a>) to use a FireWire recording
        interface, a FireWire adapter on your computer, and the correct cable
        to connect your FireWire device. There are two different FireWire
        plugs, 4-pin and 6-pin, and you must have the one that matches your
        device.</p><div class="figure"><a id="the_ffado-mixer_for_the_focusrite_saffir"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject13_d1e19079"/><img src="httpatomoreillycomsourcenostarchimages797873.png.jpg" alt="The ffado-mixer for the Focusrite Saffire Pro I/O 26"/></div></div><p class="title">Figure 13-12. The ffado-mixer for the Focusrite Saffire Pro I/O 26</p></div><p>This is how I got the Saffire Pro working for this example.
        First I opened ffado-mixer, which comes with the ffado driver (<a class="xref" href="ch13s08.html#the_ffado-mixer_for_the_focusrite_saffir" title="Figure 13-12. The ffado-mixer for the Focusrite Saffire Pro I/O 26">Figure 13-12</a>).<a id="IDX-CHP-13-0069" class="indexterm"/></p><p>Then I started Qjackctl, opened the Setup dialog, changed the
        driver to “firewire,” and changed the Interface to hw:0. Then I opened
        Hydrogen, set it to use JACK as the audio backend, and then started a
        demo loop playing. The Saffire has headphone-monitoring ports, so I
        plugged headphones into the appropriate port and created connections
        in the JACK connector to route Hydrogen’s playback to the first two
        Saffire input ports, System playback_1 and playback_2.</p><p>Then I opened Audacity last of all. I made sure the sample rate
        was the same in ffado-mixer, JACK, and Audacity, and I configured
        Audacity to record four tracks, using the recording device JACK Audio
        Connection Kit: System.</p><p><a class="xref" href="ch13s08.html#everything_is_working_colon_hydrogen_is" title="Figure 13-13. Everything is working: Hydrogen is both recording and playing back. Two mics are plugged into the Saffire Pro and are recording from Capture 3 and 4 to PortAudio 16 and 17.">Figure 13-13</a> shows
        what this all looks like: There are four PortAudio clients, which
        means that four recording channels are open in Audacity. Hydrogen is
        using two of them, and I have two mics plugged into the Saffire Pro
        for recording on the other two.</p><div class="figure"><a id="everything_is_working_colon_hydrogen_is"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject13_d1e19103"/><img src="httpatomoreillycomsourcenostarchimages797875.png.jpg" alt="Everything is working: Hydrogen is both recording and playing back. Two mics are plugged into the Saffire Pro and are recording from Capture 3 and 4 to PortAudio 16 and 17."/></div></div><p class="title">Figure 13-13. Everything is working: Hydrogen is both recording and playing
          back. Two mics are plugged into the Saffire Pro and are recording
          from Capture 3 and 4 to PortAudio 16 and 17.</p></div><p><a class="xref" href="ch13s08.html#how_it_looks_in_audacity_colon_two_hydro" title="Figure 13-14. How it looks in Audacity: two Hydrogen tracks recording and two mic tracks">Figure 13-14</a>
        shows how the recording session looks in Audacity.<a id="IDX-CHP-13-0070" class="indexterm"/><a id="IDX-CHP-13-0071" class="indexterm"/></p><div class="figure"><a id="how_it_looks_in_audacity_colon_two_hydro"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject13_d1e19122"/><img src="httpatomoreillycomsourcenostarchimages797877.png.jpg" alt="How it looks in Audacity: two Hydrogen tracks recording and two mic tracks"/></div></div><p class="title">Figure 13-14. How it looks in Audacity: two Hydrogen tracks recording and
          two mic tracks</p></div></div><div class="sect2" title="Creating Persistent Configurations"><div class="titlepage"><div><div><h2 class="title"><a id="creating_persistent_configurations"/>Creating Persistent Configurations</h2></div></div></div><p>In the JACK Setup dialog, you can create and save multiple
        profiles. Make a configuration; then on the first tab enter a name for
        it in the Preset Name box, and then click <span class="strong"><strong>Save</strong></span>. To open a profile, click the drop-down
        arrow in the Preset Name box.</p><p>The Connections window only displays your current setup and does
        not save it, so you must use the Patchbay to create saved connections.
        Get everything hooked up the way you like in Connections, open the
        Patchbay, and then click the <span class="strong"><strong>New</strong></span>
        button. A little message will pop up and ask you if you want to save
        your current Connections configuration (<a class="xref" href="ch13s08.html#the_patchbay_asks_if_you_want_to_save_yo" title="Figure 13-15. The Patchbay asks if you want to save your current Connections configuration.">Figure 13-15</a>).</p><div class="figure"><a id="the_patchbay_asks_if_you_want_to_save_yo"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject13_d1e19145"/><img src="httpatomoreillycomsourcenostarchimages797879.png.jpg" alt="The Patchbay asks if you want to save your current Connections configuration."/></div></div><p class="title">Figure 13-15. The Patchbay asks if you want to save your current
          Connections configuration.</p></div><p>Click <span class="strong"><strong>Yes</strong></span>, and this will
        automatically duplicate the current settings in the Connections
        window. You can modify this or accept it as is and save it with the
        Save button, giving it a unique name (<a class="xref" href="ch13s08.html#you_can_edit_what_the_patchbay_captured" title="Figure 13-16. You can edit what the Patchbay captured for you or save it as is.">Figure 13-16</a>).<a id="IDX-CHP-13-0072" class="indexterm"/></p><div class="figure"><a id="you_can_edit_what_the_patchbay_captured"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject13_d1e19165"/><img src="httpatomoreillycomsourcenostarchimages797881.png.jpg" alt="You can edit what the Patchbay captured for you or save it as is."/></div></div><p class="title">Figure 13-16. You can edit what the Patchbay captured for you or save it as
          is.</p></div></div><div class="sect2" title="JACK Settings"><div class="titlepage"><div><div><h2 class="title"><a id="jack_settings"/>JACK Settings</h2></div></div></div><p>Let’s take a look at the settings in the Qjackctl Setup window
        in more detail.<a id="IDX-CHP-13-0073" class="indexterm"/></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>“Realtime” should be checked when you have a real-time
            kernel and unchecked when you do not.</p></li><li class="listitem"><p>Leave “No Memory Lock” unchecked when you have abundant RAM,
            but if you’re making do with a lower-end computer, try checking it
            if you get out-of-memory errors. This will prevent JACK from
            locking up memory for its exclusive use and freeing it for all
            processes that need it.</p></li><li class="listitem"><p>Checking “Unlock Memory” helps lower-end computers by
            reclaiming memory slurped up by graphics toolkits like Qt and GTK,
            especially if you are running VST plug-ins under WINE. Leave it
            unchecked if you are not experiencing problems.</p></li><li class="listitem"><p>Checking “Soft Mode” tells JACK to ignore xrun errors and
            keep running. Use this when you want JACK to keep running no
            matter what, for example during a live show. It’s better to track
            down and fix the problem, but it’s not always possible, and xruns
            don’t always translate into big defects in your recording.</p></li><li class="listitem"><p>You can check “Force 16-bit” when your audio interface
            supports only 16-bit recording. It’s not required because JACK
            uses 32-bit internally, and it tests 32-, 24-, and 16-bit settings
            for your input and output devices. If your interface supports only
            16 bits or you want to record at 16 bits, this will shush the
            routine error messages in the Messages window.</p></li><li class="listitem"><p>“H/W Monitor” and “H/W Meter” enable hardware monitoring and
            metering for devices with support for these functions. For
            example, the MobilePre has a zero-latency monitoring port, so this
            activates it. H/W Meter is for ALSA devices only, and few
            recording interfaces support this feature.</p></li><li class="listitem"><p>The default Priority is 10, and this maxes out at 89.
            Usually the default is fine. If you are running a real-time
            kernel, try setting it to 70 or greater to see whether it makes
            any difference.</p></li><li class="listitem"><p>Frames/Period controls your balance between lower latency
            and fewer errors. The default is a buffer of 1,024 frames per
            second sent from JACK to your sound card, and the lowest possible
            value that is supported by PC hardware is 64. For lower latency,
            you want a lower value. If you see a lot of xruns in the Messages
            window, then increase this to a higher number until you have no
            <span class="emphasis"><em>xruns</em></span>. An xrun is either a buffer overrun or
            an underrun, and xruns are audible as crackles and pops. On my
            system, JACK performs well at 128 frames, which results in very
            low latency. One audio frame is one sample times the number of
            channels, so a two-channel recording has two samples per frame. A
            <span class="emphasis"><em>period</em></span> is a CPU processing cycle, so a
            Frames/Period rate of 128 results in a buffer size of 128 samples
            per channel, for a total of 256 samples per period for two
            channels. To get the buffer size in bytes, multiply Frames/Period
            by Periods/Buffers by 4.</p></li><li class="listitem"><p>The Sample Rate setting must equal your Audacity sample rate
            and be supported by your recording interface. Higher sample rates
            put a heavier load on your CPU and may require higher values in
            Frames/Period and Periods/Buffers.</p></li><li class="listitem"><p>Periods/Buffers is an interesting bit of memory management.
            JACK divides the memory buffer into periods and transfers data in
            units of periods. The default is two periods per buffer. More
            periods equals higher latency and greater stability. Try different
            values in combination with Frames/Period to get latency down. For
            example, if it takes a high Frames/Period value to get xruns down,
            like 2,048, try increasing Periods/Buffers to 3 or 4, and try
            lowering Frames/Period.</p></li><li class="listitem"><p>Every input or output connection is a port. The default is
            256 ports, which is more than enough for most mortals, and you can
            have as many as 1,024.</p></li><li class="listitem"><p>Timeout controls how long JACK waits to kill an application
            during periods of heavy congestion. The default is 500
            milliseconds.</p></li><li class="listitem"><p>The driver is set to whatever driver your recording
            interface uses. Freebob is the old version of the FFADO driver for
            FireWire interfaces, so select “firewire” since Freebob is
            obsolete (unless you are running an old system with actual old
            Freebob drivers). “dummy” is a fake driver for testing
            JACK.<a id="IDX-CHP-13-0074" class="indexterm"/><a id="IDX-CHP-13-0075" class="indexterm"/></p></li><li class="listitem"><p>The Interface drop-down is active only when you select
            (default), meaning the ALSA default, for your Input and Output
            devices. Then you have a few extra choices such as
            <span class="emphasis"><em>/dev/dsp</em></span> and <span class="emphasis"><em>/dev/oss</em></span>.
            These are really not relevant in modern Linux systems, but JACK
            supports them if your system supports them.</p></li><li class="listitem"><p>Dither can make 16-bit recordings sound better; it is
            analogous to anti-aliasing fonts or dithering in graphical images.
            Don’t use dither for higher-bit depths because it is unnecessary,
            and they will sound worse. Think of it as blending the rough edges
            for a cleaner sound. Shaped dither is considered to be the best,
            but it is also the most CPU-intensive. Triangular is a good
            compromise between quality and CPU cost, and rectangular is
            lightweight and makes the smallest alterations. You don’t have to
            use dithering, but it doesn’t hurt to try it. Audacity also has
            dither, so be sure to use only one or the other.</p></li><li class="listitem"><p>On the Audio menu, you can choose Duplex, Capture Only, and
            Playback only. Usually Duplex works fine, but you can try the
            other settings to see whether there are any performance
            improvements.</p></li><li class="listitem"><p>Pick your Input and Output Devices from the drop-down menus
            (the little arrows on the right).</p></li><li class="listitem"><p>Input Latency and Output Latency are for increasing latency.
            You might want to fiddle with these to bring your Input and Output
            streams into synchronization, especially when overdubbing or
            applying special effects.</p></li></ul></div></div></div>
<div class="sect1" title="Turning PulseAudio and Phonon Off"><div class="titlepage"><div><div><h1 class="title"><a id="turning_pulseaudio_and_phonon_off"/>Turning PulseAudio and Phonon Off</h1></div></div></div><p>PulseAudio can be a stubborn little daemon. The man page says you
      can turn it off with the command <code class="literal">pulseaudio
      --kill</code>. But depending on your particular Linux distribution,
      it won’t stay killed; instead, it respawns itself. This is how it works
      on Ubuntu 10.04: It has a normal init script to start it at boot,
      <span class="emphasis"><em>/etc/rc2.d/S03pulseaudio</em></span>. But when you try
      controlling this the normal way, it doesn’t work, because running
      <code class="literal">/etc/init.d/pulseaudio stop</code> doesn’t
      stop it. Removing <span class="emphasis"><em>/etc/rc2.d/S03pulseaudio</em></span> doesn’t
      prevent it from starting at boot. Fortunately, I am even more stubborn
      and have figured out how to control stopping and starting Pulse. I don’t
      want to remove it; I want it to run when I want it to run. (If you want
      to remove Pulse, it shouldn’t hurt anything to do so.)</p><p>First look for a graphical control panel for Pulse with an option
      to disable it. This is missing from my Ubuntu 10.04 installation but
      present on Fedora and other distros. If your system has this, it might
      be all you need.</p><p>If there is no graphical control panel with an option to disable
      pulse, open <span class="emphasis"><em>/etc/pulse/client.conf</em></span>, change <code class="literal">autospawn = yes</code> to <strong class="userinput"><code>autospawn = no</code></strong>, and set <code class="literal">daemon-binary</code> to <strong class="userinput"><code>/bin/true</code></strong>. Make sure they are uncommented,
      like this:<a id="IDX-CHP-13-0076" class="indexterm"/></p><a id="I_programlisting13_d1e19296"/><pre class="programlisting">autospawn = no
daemon-binary = /bin/true</pre><p>Next, to stop it from starting at boot requires several steps.
      First remove the relevant <code class="literal">/etc/rc*.d/S*pulseaudio</code> link for your usual
      runlevel or rename it to a “kill” link. This prevents <code class="literal">init</code> from starting Pulse. On my system, that
      looks like this:</p><a id="I_programlisting13_d1e19306"/><pre class="programlisting"># mv /etc/rc2.d/S03pulseaudio /etc/rc2.d/K03pulseaudio</pre><p>How do you know your runlevel? Use the <strong class="userinput"><code>runlevel</code></strong> command:</p><a id="I_programlisting13_d1e19313"/><pre class="programlisting">$ runlevel
N 2</pre><p>That means runlevel 2, which is controlled by the links (which
      must be links to files in <span class="emphasis"><em>/etc/init.d</em></span>, not the
      files themselves!) in <span class="emphasis"><em>/etc/rc2.d/</em></span>. Your distro may
      have a nice graphical services manager, which is a good thing to
      use.</p><p>On Ubuntu 10.04, there is one more startup file to dispense with:
      <span class="emphasis"><em>/etc/X11/Xsession.d/70pulseaudio</em></span>. This starts Pulse
      when a Gnome session starts. Move this file to a different directory,
      like your home directory. Don’t delete it because you might want it
      again someday.</p><p>Other distros customize Pulse in different ways, so if these
      instructions don’t work, then look for help specific to your distro.
      There is no shortage of it because a lot of users are struggling with
      this. Another little trick, when you find scripts that start PulseAudio,
      is to change the binary that they call from
      <span class="emphasis"><em>/usr/bin/pulseaudio</em></span> to
      <span class="emphasis"><em>/bin/true</em></span>. This is a nice little executable whose
      only job is to “do nothing, successfully.” It keeps the scripts happy,
      and it’s a convenient placeholder if you ever want to change it
      back.</p><p>Now that you have purged all the startup scripts, how do you stop
      and start PulseAudio? It’s as easy as pie:</p><a id="I_programlisting13_d1e19339"/><pre class="programlisting">$ pulseaudio --kill
$ pulseaudio --start</pre><p>Phonon is a different kettle of clams. Phonon exists only on KDE4,
      and it is impossible to remove because virtually all of KDE4 depends on
      it. It is not necessary to stop or remove Phonon in any case, because it
      uses only a tiny bit of system resources and adds no latency to your
      audio chain. It does have one annoying habit—when a sound daemon like
      Pulse or JACK takes control of a sound card, Phonon freaks out and emits
      an error message about how that sound card is missing, and it wants to
      remove the sound card from its menus. Just click <span class="strong"><strong>Cancel</strong></span> to shush it.</p></div>
<div class="sect1" title="Linux System Tweaks"><div class="titlepage"><div><div><h1 class="title"><a id="linux_system_tweaks"/>Linux System Tweaks</h1></div></div></div><p>Linux is a pretty efficient operating system, so you don’t need to
      go to heroic lengths to make it get out of its own way. However, there
      are a few things you can do to ensure the best possible
      performance.<a id="IDX-CHP-13-0077" class="indexterm"/><a id="IDX-CHP-13-0078" class="indexterm"/><a id="IDX-CHP-13-0079" class="indexterm"/><a id="IDX-CHP-13-0080" class="indexterm"/><a id="IDX-CHP-13-0081" class="indexterm"/><a id="IDX-CHP-13-0082" class="indexterm"/></p><p>High-powered PC hardware is always good and is cheaper than
      high-end audio devices. My audio workstation has an AMD Phenom X3 2.4
      GHz CPU, 4GB of RAM, and a terabyte’s worth of SATA II hard drives.
      Those extra cores make a nice difference, because even though Audacity
      is not optimized for multicore processors, those extra cores mean
      faster, smoother multitasking. I also have an old laptop with a 1.4 GHz
      CPU, 1GB of RAM, and a slower hard drive. This handles up to
      four-channel 16/44.1 recording capably, but at higher bit depths or
      sampling rates it tends to stall. I consider a 1 GHz CPU and 512MB of
      RAM to be the bare minimum for music recording and editing. For podcasts
      and spoken-word recordings, you can go as low as 128MB RAM and a 500 MHz
      CPU.</p><p>Turn off your screensaver and all fancy video effects. All that
      CompizFusion bling is pretty, but it gets in the way of good audio. In
      fact, you should turn off everything that is not absolutely needed:
      Don’t run other applications, and turn off unnecessary services. There
      usually isn’t too much cruft; Bluetooth, wireless daemons on systems
      without wireless devices, and Wacom tablet daemons are the most common
      on-by-default services that most users don’t need.</p><p>Both KDE and GNOME are heavy-duty desktops that feast on CPU and
      memory, so you can slim your system down by using a lighter-weight
      graphical environment such as Xfce, IceWM, LXDE, Fluxbox, or any of the
      many other lightweight Linux graphical environments.<a id="IDX-CHP-13-0083" class="indexterm"/><a id="IDX-CHP-13-0084" class="indexterm"/><a id="IDX-CHP-13-0085" class="indexterm"/><a id="IDX-CHP-13-0086" class="indexterm"/><a id="IDX-CHP-13-0087" class="indexterm"/><a id="IDX-CHP-13-0088" class="indexterm"/></p><p>Video is the single most demanding system on your PC, so you might
      want to upgrade to a better video card. Many lower-end systems use
      shared system memory instead of a dedicated graphics processing unit
      (GPU). In other words, they use some of your system RAM to process
      video, and this is quite a bit slower because it places an extra load on
      your system RAM and CPU, both of which are considerably slower than a
      GPU. GPUs are so much faster that they are used to build clusters for
      very fast, very powerful, high-end scientific calculations.<a id="IDX-CHP-13-0089" class="indexterm"/></p><p>Depending on your distribution, you should have a good graphical
      system resources monitor so you can see where your system resources are
      being used. The good old-fashioned <code class="literal">top</code> command is still a useful tool for viewing
      active processes and how much system resources they are using. After
      starting <code class="literal">top</code>, press 1 to see all the
      cores in a multicore CPU:</p><a id="I_programlisting13_d1e19408"/><pre class="programlisting">$ top

Tasks: 232 total,   1 running, 231 sleeping,   0 stopped,   0 zombie
Cpu0  :  3.7%us,  0.7%sy,  0.0%ni, 95.7%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st
Cpu1  :  7.6%us,  0.7%sy,  0.0%ni, 90.1%id,  1.7%wa,  0.0%hi,  0.0%si,  0.0%st
Cpu2  :  0.0%us,  0.7%sy,  0.0%ni, 99.3%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st

Mem:   4056672k total,  1602700k used,  2453972k free,   171880k buffers
Swap:  7092636k total,        0k used,  7092636k free,   655412k cached

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
17132 alrac     20   0  663m  35m  22m S    8  0.9   0:27.99 audacity
 2208 root      20   0  181m  83m  14m S    3  2.1  32:02.89 Xorg
10683 alrac     20   0  620m 147m  28m S    1  3.7   4:37.10 firefox
 2763 alrac     20   0  212m  10m 8276 S    1  0.3   3:00.33 multiload-apple</pre><p>This shows that all is well. The summary at the top tells us many
      things: One process is running, and the rest, all 231 of ’em, are
      sleeping. Three CPU cores are chugging away.</p><p>All of these fields are explained in the nice man page, <code class="literal">man top</code>. Your version of <code class="literal">top</code> may display different fields, but it is
      still the same <code class="literal">top</code> command. The top
      section is the summary, and the bottom section is the task area.</p><p>CPU states (in the summary) are fun to examine in detail, but the
      main fields to keep an eye on are the <code class="literal">us</code>, or user field, which shows the load per
      CPU, and the <code class="literal">sy</code>, or system field,
      which shows the load from kernel processes. If you are seeing <code class="literal">sy</code> values greater than 10 percent
      consistently, you should track down the cause, because ordinarily it
      should be in the single digits.</p><p>The <code class="literal">Mem</code> and <code class="literal">Swap</code> fields tell you whether your physical RAM
      is sufficient. As long as <code class="literal">Swap</code> usage
      is zero and your <code class="literal">Mem</code> is not maxed
      out, that is ideal for audio processing, since RAM is many times faster
      than a swap file, which is on your hard disk.</p><p>Down in the task area, you see information on every process on
      your system. Again, don’t go crazy on the minute details, but look at
      the biggest users at the top. This quickly reveals who the CPU and
      memory hogs are. Web browsers can be awful hogs in this era of lardy,
      script- and Flash-heavy websites, so shut ’em down. Audio processing
      chews up a lot of CPU cycles, so that’s the main thing to keep an eye
      on. If you’re hitting greater than 75 percent consistently, think about
      upgrading your CPU. The Linux kernel and most CPUs don’t mind working
      that hard, but at that level you’re probably noticing slower
      performance.</p><p>You can tune your swap file size a bit for better performance. If
      you have 512MB of RAM or less, make your swap file size at least equal
      to your RAM size. If you have 1GB of RAM or more, make your swap file no
      larger than half your RAM. But don’t remove your swap file
      entirely—laptops need them for suspend and hibernate, and if you ever
      use up all of your physical memory, that swap file might save your
      recording session.</p><p>If you are using a PCI sound card, check your motherboard manual
      to find a slot that does not use shared interrupts. PCI-Express sound
      cards are great because PCI-E uses dedicated buses, rather than shared
      buses like the old PCI 2.0 standard. There are not a lot of PCI-E sound
      cards yet; the RME HDSPe MADI series, for one example, is first-rate and
      works in Linux.</p><p>Don’t use networked file shares, except for storing backups of
      your audio files, because they’re too slow.</p></div>
<div class="sect1" title="The Tangled History of Linux Audio"><div class="titlepage"><div><div><h1 class="title"><a id="the_tangled_history_of_linux_audio"/>The Tangled History of Linux Audio</h1></div></div></div><p>The original Linux audio subsystem was Sound Blaster 16, which
      “just happened” because SB16 sound cards had the best support and a nice
      API. Those of us who are old enough to remember i386 PCs might also
      remember that competing brands used SB16 emulation because it was the
      path of least resistance. This evolved into the Open Sound System (OSS),
      which is portable across all Unix and Unix-type operating systems. It
      still exists and is maintained, and it is often confused with the
      OSS-compatible module in ALSA.<a id="IDX-CHP-13-0090" class="indexterm"/><a id="IDX-CHP-13-0091" class="indexterm"/><a id="IDX-CHP-13-0092" class="indexterm"/><a id="IDX-CHP-13-0093" class="indexterm"/><a id="IDX-CHP-13-0094" class="indexterm"/><a id="IDX-CHP-13-0095" class="indexterm"/><a id="IDX-CHP-13-0096" class="indexterm"/><a id="IDX-CHP-13-0097" class="indexterm"/></p><p>OSS fell out of favor as sound cards got cheaper and depended more
      on software to handle mixing, instead of doing the mixing in hardware.
      And so ESD (Gnome) and aRts (KDE) were born; these took care of mixing
      before sending audio streams to OSS. However, this complicated matters
      because Linux developers now had three different sound systems to deal
      with. The Simple DirectMedia Layer (SDL) was then invented as a
      portability layer that could use any audio backend, but it has some
      limitations that prevent it from ascending the throne as the Great Linux
      Audio Uniter. Like everything else in life, it hasn’t gone away but is
      still used in some applications. You probably have it on your own
      systems.<a id="IDX-CHP-13-0098" class="indexterm"/><a id="IDX-CHP-13-0099" class="indexterm"/></p><p>Then OSS went closed source, and users had to pay money for it.
      That was the last straw for hardy Linux developers, who retaliated by
      inventing ALSA. So, that is how ALSA became the standard Linux audio
      subsystem. A good way to start a flame war is to ignite an OSS versus
      ALSA debate—a lot of folks still have strong passions on the
      subject.</p><p>OSS 4.<span class="emphasis"><em>x</em></span> became Free software again when it
      was released under the GPL for Linux in 2007, and now there are two
      versions: the GPL version and a commercial version that includes some
      non-Free drivers. Some users claim that their music sounds better with
      OSS and that it is simpler and better and easier to use. I think a lot
      of that is wishful thinking, but if you like OSS, I won’t think less of
      you.</p><p>I prefer plain old ALSA. It is the default in virtually all Linux
      systems, and it works. As always with Linux, do your homework before you
      buy to make sure you purchase well-supported hardware. The ALSA project
      has a supported sound cards matrix at <a class="ulink" href="http://www.alsa-project.org/main/index.php/Matrix:Main">http://www.alsa-project.org/main/index.php/Matrix:Main</a>.</p><p>ESD is the old Gnome and Enlightenment sound server, and it runs
      on top of ALSA. It can manage multiple sound streams and networked
      playback. PulseAudio has replaced ESD in GNOME.<a id="IDX-CHP-13-0100" class="indexterm"/></p><p>aRts also manages multiple streams and networked playback. Don’t
      use aRts because it increases latency beyond acceptable levels and
      because it is doomed—it has been unmaintained for some time now and is
      outdated. Phonon replaces aRts in KDE4. Phonon is not a sound server or
      an API but is intended to be a universal interface for all audio and
      video playback servers and subsystems. Phonon doesn’t get in the way, so
      you can leave it alone.</p><p>The future of desktop playback audio for Linux is cloudy.
      PulseAudio is poised to become the standard sound manager for desktop
      Linux, but some say there are still some deeper problems to resolve that
      Pulse can’t fix. So, don’t be surprised by anything.</p></div>
<div class="sect1" title="Sound Cards"><div class="titlepage"><div><div><h1 class="title"><a id="sound_cards"/>Sound Cards</h1></div></div></div><p>Please visit <a class="xref" href="apa.html" title="Appendix A. Audio Hardware">Appendix A</a> to learn about
      sound cards that are well supported on Linux, from low-budget to
      high-end. Remember, it is very important to shop carefully and purchase
      hardware that is well supported in Linux. There is a lot of great
      quality audio hardware that works in Linux—life is too short to waste on
      low-quality or poorly supported audio gear.</p></div></body></html>