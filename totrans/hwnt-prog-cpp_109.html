<html><head></head><body>

<div class="calibre21" id="calibre_pb_0"/><div class="calibre1" id="calibre_toc_122">
<a name="ch11" class="calibre6" id="ch11"/>
<div class="calibre1">
<h2 class="lot-title" id="calibre_pb_1"><a name="127" class="calibre16" id="127"/><a name="ch11lev1sec1" class="calibre16" id="ch11lev1sec1"/><span class="chapter-titlelabel">Program 106: </span>Taking Out the Trash</h2><p class="b24-bookeditorial">We have a memory-mapped input port pointed to by <span>in_port_ptr</span>. The device can buffer up to three characters. In order to initialize the device, we need to empty the buffer and clear out any old garbage. That's what this function is supposed to do. But sometimes it doesn't work. Why?</p>
<div class="calibre1">
<pre class="literallayout-normal">
  1 /***********************************************
  2  * clear port -- Clear the input port.         *
  3  ***********************************************/
  4 // Input register
  5 char *in_port_ptr  = (char *)0xFFFFFFE0;
  6
  7 // Output register
  8 char *out_port_ptr = (char *)0xFFFFFFE1;
  9
 10 /***********************************************
 11  * clear_input -- Clear the input device by    *
 12  *      reading enough characters to empty the *
 13  *      buffer. (It doesn't matter if we read  *
 14  *      extra, just so long as we read enough.)*
 15  ***********************************************/
 16 void clear_input(void)
 17 {
 18     char ch;    // Dummy character
 19
 20     ch = *in_port_ptr;  // Grab data
 21     ch = *in_port_ptr;  // Grab data
 22     ch = *in_port_ptr;  // Grab data
 23 }
</pre>
</div>
<p class="b24-bookeditorial">(Next <a href="LiB0120.html#265" target="_parent" class="calibre2">Hint 129</a>. <a href="LiB0121.html#507" target="_parent" class="calibre2">Answer 9</a>.)</p>
<div class="calibre1">
<table class="calibre3" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr class="calibre4">
<td class="bluecell"><span class="calibre22"><b class="calibre13"><img src="_1.gif" alt="Start Sidebar" border="0" class="calibre23"/></b></span></td>
</tr>
</table>
<p class="b24-bookeditorial">The First Rule of Program Optimization:</p>
<p class="b24-bookeditorial">Don't do it.</p>
<p class="b24-bookeditorial">The Second Rule of Program Optimization:</p>
<p class="b24-bookeditorial">Don't do it yet.</p>
<table class="calibre3" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr class="calibre4">
<td class="bluecell"><span class="calibre22"><b class="calibre13"><img src="_1.gif" alt="End Sidebar" border="0" class="calibre23"/></b></span></td>
</tr>
</table>
</div>
<table class="calibre3" border="0" cellspacing="0" cellpadding="0" width="100%">
<tr class="calibre4">
<td height="16" class="calibre8"/>
</tr>
</table>
</div>
</div>



</body></html>