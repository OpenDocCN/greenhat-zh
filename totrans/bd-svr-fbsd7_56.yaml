- en: Chapter 24\. POSTFIX SMTP SERVER 2.5.1
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 第24章。POSTFIX SMTP服务器 2.5.1
- en: '[HTTP://WWW.POSTFIX.ORG](HTTP://WWW.POSTFIX.ORG)'
  id: totrans-1
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: '[HTTP://WWW.POSTFIX.ORG](HTTP://WWW.POSTFIX.ORG)'
- en: 24.1\. SUMMARY
  id: totrans-2
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.1\. 摘要
- en: Postfix is an open source mail transfer agent (MTA). An MTA is used for routing
    and delivering email on the Internet. Postfix was originally developed as an alternative
    to the widely deployed Sendmail MTA. Like Sendmail, Postfix operates using SMTP.
    An emphasis on security was placed on its development in response to Sendmail's
    history of security-related problems.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: Postfix是一个开源的邮件传输代理（MTA）。MTA用于在互联网上路由和发送电子邮件。Postfix最初被开发为广泛部署的Sendmail MTA的替代品。像Sendmail一样，Postfix使用SMTP进行操作。在开发过程中，由于Sendmail历史上存在许多安全问题，因此特别强调了安全性。
- en: Postfix supports SASL and TLS for secure connections, as well as the Maildir
    mailbox format (adopted from the Qmail MTA). Postfix is the default MTA for several
    Linux distributions, NetBSD, and the latest incarnations of Apple's Mac OS X.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: Postfix支持SASL和TLS进行安全连接，以及Maildir邮箱格式（从Qmail MTA采用）。Postfix是多个Linux发行版、NetBSD以及苹果Mac
    OS X最新版本的默认MTA。
- en: Wietse Venema, a computer security specialist and IBM researcher, wrote Postfix
    in 1998\. IBM released Venema's software (then named IBM Secure Mailer) as open
    source, in hopes that it would become widely adopted to create a faster and more
    secure email infrastructure. This release helped IBM develop its open source strategy,
    which was gaining popularity at the time.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: Wietse Venema，一位计算机安全专家和IBM研究员，于1998年编写了Postfix。IBM将Venema的软件（当时名为IBM Secure
    Mailer）作为开源软件发布，希望它能够被广泛采用，以创建更快、更安全的电子邮件基础设施。这次发布帮助IBM发展其开源策略，该策略在当时正日益受到欢迎。
- en: 24.2\. RESOURCES
  id: totrans-6
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.2\. 资源
- en: Postfix Documentation
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: Postfix文档
- en: '[http://www.postfix.org/documentation.html](http://www.postfix.org/documentation.html)'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://www.postfix.org/documentation.html](http://www.postfix.org/documentation.html)'
- en: RFC 2821 - Simple Mail Transfer Protocol
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: RFC 2821 - 简单邮件传输协议
- en: '[http://tools.ietf.org/html/rfc2821](http://tools.ietf.org/html/rfc2821)'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: '[http://tools.ietf.org/html/rfc2821](http://tools.ietf.org/html/rfc2821)'
- en: 24.3\. REQUIRED
  id: totrans-11
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.3\. 必需
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) FreeBSD 7.0-RELEASE
    (see "[FreeBSD 7.0](freebsd_7.0_split_000.html#freebsd_7.0)")'
  id: totrans-12
  prefs: []
  type: TYPE_IMG
  zh: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) FreeBSD 7.0-RELEASE
    (参见 "[FreeBSD 7.0](freebsd_7.0_split_000.html#freebsd_7.0)")'
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) Updated ports
    collection (see "[FreeBSD Ports Collection](freebsd_ports_collection.html#freebsd_ports_collection)")'
  id: totrans-13
  prefs: []
  type: TYPE_IMG
  zh: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) 更新的端口集合（参见
    "[FreeBSD Ports Collection](freebsd_ports_collection.html#freebsd_ports_collection)")'
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) Internet
    connection'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) 互联网连接'
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) Registered
    domain name'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) 注册的域名'
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) Administrative
    access to your domain''s DNS MX (DNS Mail Exchanger) records'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) 对您域名DNS MX
    (DNS邮件交换) 记录的行政访问'
- en: 24.4\. OPTIONAL
  id: totrans-17
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.4\. 可选
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) Cyrus SASL2
    (see "[Cyrus SASL 2.1.22](cyrus_sasl_2.1.22.html#cyrus_sasl_2.1.22)")'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
  zh: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) Cyrus SASL2
    (参见 "[Cyrus SASL 2.1.22](cyrus_sasl_2.1.22.html#cyrus_sasl_2.1.22)")'
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) OpenSSL with
    a signed SSL Certificate (see "[OpenSSL 0.9.8g](openssl_0.9.8g.html#openssl_0.9.8g)")'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) 使用带有签名SSL证书的OpenSSL
    (参见 "[OpenSSL 0.9.8g](openssl_0.9.8g.html#openssl_0.9.8g)")'
- en: '* * *'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: '***Note:*** SASL and SSL are used together to create a secure email relay.
    SASL allows users to relay email if they authenticate successfully. SSL encrypts
    the authentication transaction and data transfer.'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: '***注意：*** SASL和SSL一起使用以创建安全的电子邮件中继。SASL允许用户在成功认证后中继电子邮件。SSL加密认证事务和数据传输。'
- en: '* * *'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: 24.5\. PREPARATION
  id: totrans-23
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.5\. 准备
- en: To enable TLS/SSL and/or SASL with Postfix, be sure that they are installed
    before proceeding with the Postfix installation.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 要启用Postfix的TLS/SSL和/或SASL，请确保在继续Postfix安装之前它们已经安装。
- en: '* * *'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: '***Note:*** Write down the FQDN of the outgoing SMTP server for your Internet
    service provider. It usually looks like [smtp.ispname.com](http://smtp.ispname.com).'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '***注意：*** 记录您互联网服务提供商的出站SMTP服务器的FQDN。它通常看起来像[smtp.ispname.com](http://smtp.ispname.com)。'
- en: '* * *'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: Become the superuser.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 成为超级用户。
- en: 24.6\. INSTALL
  id: totrans-29
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.6\. 安装
- en: 'To begin the Postfix installation process, enter the following commands:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要开始Postfix安装过程，请输入以下命令：
- en: '[PRE0]'
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: A menu will appear asking you to select options for Postfix. If you are planning
    to use TLS/SSL and/or SASL2, select each by using the arrow keys to highlight
    the option and press [spacebar] to check the box. Once you have selected the options
    you wish to install, press the [tab] key to highlight OK and then press [enter].
  id: totrans-32
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 将出现一个菜单，询问您选择 Postfix 的选项。如果您计划使用 TLS/SSL 和/或 SASL2，请使用箭头键突出显示选项，然后按 [空格键] 打勾。选择您希望安装的选项后，按
    [tab] 键突出显示“确定”，然后按 [enter] 键。
- en: During installation, you will be asked to add the user postfix to the group
    mail. Enter Y to accept this and continue installation.
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在安装过程中，您将被要求将用户 postfix 添加到组 mail。输入 Y 以接受此操作并继续安装。
- en: When asked if you would like to activate Postfix in /etc/mail/mailer.conf, enter
    Y. This will create the Postfix-specific mailer.conf in /etc/mail.
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当询问您是否希望在 /etc/mail/mailer.conf 中激活 Postfix 时，输入 Y。这将创建位于 /etc/mail 中的特定于 Postfix
    的 mailer.conf。
- en: 24.7\. CONFIGURE
  id: totrans-35
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.7. 配置
- en: Once the installation process is complete, it's time to configure Postfix for
    use on your system.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 安装过程完成后，是时候为您的系统配置 Postfix 了。
- en: 'Edit the main.cf file located in /usr/local/etc/postfix. First, open main.cf
    with Easy Editor:'
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 编辑位于 /usr/local/etc/postfix 的 main.cf 文件。首先，使用 Easy Editor 打开 main.cf：
- en: '[PRE1]'
  id: totrans-38
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Scroll down and uncomment the second of the three `mydestination` statements
    (~162) by removing the preceding hash mark. The line should now appear as follows:'
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 滚动并取消注释三个 `mydestination` 声明中的第二个（通过删除前面的井号）。该行现在应如下所示：
- en: '[PRE2]'
  id: totrans-40
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Comment out the `mynetworks_style` declaration (~247). This will allow relay
    access to clients without authentication as long as they reside on your local
    network (subnet). Do not modify this line if your local subnet is untrusted or
    you wish to enforce authentication of all clients. The line should appear as follows
    if subnet relay access is allowed:'
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 取消注释 `mynetworks_style` 声明 (~247)。这将允许本地网络（子网）中的客户端在没有身份验证的情况下进行中继访问。如果您的本地子网不受信任或您希望强制所有客户端的身份验证，请不要修改此行。如果允许子网中继访问，该行应如下所示：
- en: '[PRE3]'
  id: totrans-42
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: If your ISP blocks port 25, proceed to step 5; if it does not, skip to step
    6\. (See "[Notes](notes.html#notes)" for instructions on detecting port 25 blockages.)
  id: totrans-43
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您的 ISP 封锁端口 25，请继续到步骤 5；如果没有，请跳到步骤 6。（有关检测端口 25 封锁的说明，请参阅“[注意事项](notes.html#notes)”）
- en: 'Scroll down to the `relayhost` declaration (~311) and specify your ISP''s SMTP
    server. Replace `*mailserver.isp.tld*` with your ISP''s server address and uncomment
    this line. The line should appear like this:'
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 滚动到 `relayhost` 声明 (~311) 并指定您的 ISP 的 SMTP 服务器。将 `*mailserver.isp.tld*` 替换为您的
    ISP 服务器地址，并取消注释此行。该行应如下所示：
- en: '[PRE4]'
  id: totrans-45
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Uncomment the `home_mailbox` declaration (~415) to enable mail delivery to
    Maildir. The line should now appear as follows:'
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 取消注释 `home_mailbox` 声明 (~415) 以启用 Maildir 的邮件投递。该行现在应如下所示：
- en: '[PRE5]'
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: If you don't want to set up SASL with SSL encryption, save, exit, and skip to
    step 12\. To enable SASL with SSL encryption, continue.
  id: totrans-48
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果您不想使用 SSL 加密的 SASL 设置，请保存、退出并跳到步骤 12。要启用使用 SSL 加密的 SASL，请继续。
- en: 24.7.1\. Enabling SASL with SSL Encryption
  id: totrans-49
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.7.1. 启用使用 SSL 加密的 SASL
- en: 'NaN.  Scroll down to the bottom of the main.cf file (press [ctrl-U] if you''re
    using Easy Editor) and add the following lines to enable Cyrus SASL2:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: NaN. 滚动到 main.cf 文件的底部（如果您使用 Easy Editor，请按 [ctrl-U]）并添加以下行以启用 Cyrus SASL2：
- en: '[PRE6]'
  id: totrans-51
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '* * *'
  id: totrans-52
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: '***Note:*** Postfix configuration statements that span multiple lines require
    preceding whitespace as shown in the last three lines above.'
  id: totrans-53
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '***注意：*** Postfix 配置语句跨越多行时，需要像上面最后三行所示的前导空白。'
- en: '* * *'
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: NaN.  Adding the next set of configuration statements to main.cf will enable
    TLS/SSL encryption. You can separate these lines from the SASL directives with
    a blank line to make it easier to differentiate SASL2 options from the TLS/SSL
    options.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: NaN. 将下一组配置语句添加到 main.cf 中将启用 TLS/SSL 加密。您可以使用空白行将这些行与 SASL 指令分开，以便更容易区分 SASL2
    选项和 TLS/SSL 选项。
- en: '* * *'
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: '***Note:*** The naming conventions used here are consistent with the OpenSSL
    guide in this book. Replace items in italics as appropriate to your system.'
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '***注意：*** 这里使用的命名约定与本书中的 OpenSSL 指南一致。根据您的系统适当替换斜体中的项。'
- en: '* * *'
  id: totrans-58
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: '[PRE7]'
  id: totrans-59
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The files used above are:'
  id: totrans-60
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 上述使用的文件是：
- en: '[example.com-CAcert.pem](http://example.com-CAcert.pem) Certificate Authority
    Root Certificate'
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '[example.com-CAcert.pem](http://example.com-CAcert.pem) 证书颁发机构根证书'
- en: '[host.example.com-cert.pem](http://host.example.com-cert.pem) Server Certificate'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '[host.example.com-cert.pem](http://host.example.com-cert.pem) 服务器证书'
- en: '[host.example.com-unencrypted-key.pem](http://host.example.com-unencrypted-key.pem)
    Server Private Key'
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '[host.example.com-unencrypted-key.pem](http://host.example.com-unencrypted-key.pem)
    服务器私钥'
- en: NaN.  Save and exit.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: NaN.  保存并退出。
- en: Assuming all goes well, you've now created a secure means to remotely relay
    email by enabling SASL with SSL. That said, if your users will be sending email
    from remote locations, they may be subject to ISP-enforced SMTP port 25 blockages
    (see "[Notes](notes.html#notes)") that prevent them from sending outbound mail
    on the default port. To address this, we'll enable the SMTP submission port 587,
    via which users can securely submit email to your server.
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 假设一切顺利，您现在已通过启用带有 SSL 的 SASL 创建了一种安全的方式远程中继电子邮件。话虽如此，如果您的用户将从远程位置发送电子邮件，他们可能会受到
    ISP 强制的 SMTP 端口 25 封锁（见 "[注意事项](notes.html#notes)"），这阻止他们通过默认端口发送出站邮件。为了解决这个问题，我们将启用
    SMTP 提交端口 587，用户可以通过此端口安全地向您的服务器提交电子邮件。
- en: 'NaN.  Modify the master.cf file located in /usr/local/etc/postfix to enable
    the submission port. Open the file:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: NaN.  修改位于 /usr/local/etc/postfix 的 master.cf 文件以启用提交端口。打开该文件：
- en: '[PRE8]'
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'and uncomment the following four lines (~12):'
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 'and uncomment the following four lines (~12):'
- en: '[PRE9]'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: NaN.  Save and exit.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: NaN.  保存并退出。
- en: 24.7.2\. Finishing the Configuration
  id: totrans-71
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.7.2\. 完成配置
- en: Whether you enabled SASL with SSL encryption or not, finish the configuration
    with the following steps.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 无论您是否启用了带有 SSL 加密的 SASL，请按照以下步骤完成配置。
- en: 'NaN.  To forward email addressed to the root user, you need to edit a file
    named aliases located in the /etc/mail directory. Open this file with Easy Editor:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: NaN.  要将发送给 root 用户的电子邮件转发，您需要编辑位于 /etc/mail 目录中的 aliases 文件。使用 Easy Editor
    打开此文件：
- en: '[PRE10]'
  id: totrans-74
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Scroll down (~19), uncomment this line, and enter the email address of the
    system administrator. The root account''s email will be forwarded to this email
    address. The line should appear as follows, with the correct email address in
    place of [username@example.com](mailto:username@example.com.html):'
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 滚动到 (~19)，取消注释此行，并输入系统管理员的电子邮件地址。根账户的电子邮件将被转发到这个电子邮件地址。此行应如下所示，用正确的电子邮件地址替换
    [username@example.com](mailto:username@example.com.html)：
- en: '[PRE11]'
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: NaN.  Save and exit.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: NaN.  保存并退出。
- en: 'NaN.  To update aliases.db with the changes made to the aliases file, enter
    the following command:'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: NaN.  要更新 aliases.db 以反映对别名文件的更改，请输入以下命令：
- en: '[PRE12]'
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 24.8\. TESTING
  id: totrans-80
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.8\. 测试
- en: In this section, we'll perform some basic tests to confirm that Postfix answers
    SMTP commands properly.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将执行一些基本测试以确认 Postfix 正确响应 SMTP 命令。
- en: 'Configure Postfix to start automatically at boot time, rather than the Sendmail
    MTA, by editing the rc.conf file located in /etc. First, open rc.conf:'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过编辑位于 /etc 的 rc.conf 文件，将 Postfix 配置为在启动时自动启动，而不是 Sendmail MTA。首先，打开 rc.conf：
- en: '[PRE13]'
  id: totrans-83
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'and then add the following lines to automatically start Postfix at boot time:'
  id: totrans-84
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 然后添加以下行以在启动时自动启动 Postfix：
- en: '[PRE14]'
  id: totrans-85
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: Save and exit.
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存并退出。
- en: 'Create a file named periodic.conf in /etc and add four lines to it. Since Postfix
    is replacing Sendmail as the MTA, we can remove unnecessary instructions from
    the daily-run script that pertains to Sendmail. Create and open /etc/periodic.conf:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 /etc 中创建一个名为 periodic.conf 的文件，并向其中添加四行。由于 Postfix 正在取代 Sendmail 作为 MTA，我们可以从每日运行脚本中删除与
    Sendmail 相关的不必要指令。创建并打开 /etc/periodic.conf：
- en: '[PRE15]'
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'and then add these lines to the empty file:'
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 然后将以下行添加到空文件中：
- en: '[PRE16]'
  id: totrans-90
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Save and exit.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 保存并退出。
- en: 'Enter these commands to stop Sendmail and start Postfix for testing:'
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入以下命令以停止 Sendmail 并启动 Postfix 进行测试：
- en: '[PRE17]'
  id: totrans-93
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 24.8.1\. Sending Mail
  id: totrans-94
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.8.1\. 发送邮件
- en: To check that Postfix is running and handling mail requests, we'll use telnet
    to send SMTP commands and send a test message.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 要检查 Postfix 是否正在运行并处理邮件请求，我们将使用 telnet 发送 SMTP 命令并发送测试消息。
- en: 'NaN.  Use the following command to initiate a connection to Postfix using telnet:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: NaN.  使用以下命令通过 telnet 初始化与 Postfix 的连接：
- en: '[PRE18]'
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Your hostname should appear instead of [host.example.com](mailto:host.example.com.html).
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您的主机名应显示在 [host.example.com](mailto:host.example.com.html) 的位置。
- en: NaN.  Create the test email message. You can replace [test@example.com](mailto:test@example.com.html)
    with any email address; it doesn't need to be valid for the purposes of testing.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: NaN.  创建测试电子邮件消息。您可以将 [test@example.com](mailto:test@example.com.html) 替换为任何电子邮件地址；在测试目的上，它不需要是有效的。
- en: '[PRE19]'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'NaN.  Specify the email recipient, replacing [user@example.com](mailto:user@example.com.html)
    with an external email account that you can access, preferably via webmail. Enter
    each line as shown below and then end the test message by entering a period (`**.**`)
    on a blank line:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: NaN.  指定电子邮件收件人，将 [user@example.com](mailto:user@example.com.html) 替换为您可访问的外部电子邮件账户，最好通过网页邮箱。按照以下格式输入每一行，然后在测试消息的末尾输入一个空行（`**.**`）：
- en: '[PRE20]'
  id: totrans-102
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'You should see output similar to the following (the italicized ID tag will
    be different in your output):'
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您应该看到类似以下内容的输出（斜体化的 ID 标签在您的输出中将是不同的）：
- en: '[PRE21]'
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'NaN.  Close the connection:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: NaN. 关闭连接：
- en: '[PRE22]'
  id: totrans-106
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: NaN.  Check the recipient email account to see if the message was successfully
    sent. If you did not set up SASL and SSL, skip to "[Receiving Mail](#receiving_mail)".
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: NaN. 检查收件人电子邮件账户以查看消息是否成功发送。如果您没有设置 SASL 和 SSL，请跳转到 "[接收邮件](#receiving_mail)"。
- en: 24.8.2\. Testing SASL over SSL
  id: totrans-108
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.8.2\. 测试 SASL over SSL
- en: If you configured Postfix with SASL and SSL support, you can initiate an SSL
    connection and authenticate with SASL.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您已配置 Postfix 以支持 SASL 和 SSL，则可以启动 SSL 连接并使用 SASL 进行身份验证。
- en: 'NaN.  Encode the username and password of the user account that you wish to
    test into Base-64 format. Enter the following command to encode your username
    and password, replacing the italic items as appropriate:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: NaN. 将您要测试的用户账户的用户名和密码编码为 Base-64 格式。输入以下命令以编码您的用户名和密码，适当替换斜体项：
- en: '[PRE23]'
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Be sure to write this string down exactly as it appears in your output; you
    will need to enter it in a moment.
  id: totrans-112
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 请确保将此字符串准确地记录下来，您稍后需要输入它。
- en: 'NaN.  The next command will start an SSL-encrypted connection to the Postfix
    SMTP server:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: NaN. 下一个命令将启动到 Postfix SMTP 服务器的 SSL 加密连接：
- en: '[PRE24]'
  id: totrans-114
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'NaN.  Authenticate to the server using the encoded username and password that
    you created previously:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: NaN. 使用您之前创建的编码用户名和密码对服务器进行身份验证：
- en: '[PRE25]'
  id: totrans-116
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'If authentication is successful, you should see this:'
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果身份验证成功，您应该看到以下内容：
- en: '[PRE26]'
  id: totrans-118
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: At this point, you can send a test email as shown in "[Sending Mail](#sending_mail)".
  id: totrans-119
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在此阶段，您可以按照 "[发送邮件](#sending_mail)" 中的说明发送测试邮件。
- en: 24.8.3\. Receiving Mail
  id: totrans-120
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.8.3\. 接收邮件
- en: Now we'll test the Postfix server's ability to receive email. Be sure your domain's
    primary DNS MX record points to the IP address of your server (your domain registrar
    should have details about how to do this). If you have a NAT router, be sure that
    port 25 is forwarded to your server or this test won't succeed.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将测试 Postfix 服务器接收电子邮件的能力。请确保您的域的主 DNS MX 记录指向您的服务器 IP 地址（您的域名注册商应提供有关如何执行此操作的详细信息）。如果您有
    NAT 路由器，请确保端口 25 已转发到您的服务器，否则此测试将不会成功。
- en: NaN.  Send a test message from an external email account (for instance, a Gmail
    or Yahoo! account) to a valid user account (other than root) on your server.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: NaN. 从外部电子邮件账户（例如，Gmail 或 Yahoo! 账户）向您的服务器上的有效用户账户（除了 root）发送测试消息。
- en: 'NaN.  Change to the user''s mail directory with the following command (replacing
    `*username*` with the username you sent the email to on your server):'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 'NaN. 使用以下命令切换到用户的邮件目录（将 `*username*` 替换为您在服务器上发送邮件的目标用户名）:'
- en: '[PRE27]'
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: You should see the contents of your test email.
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您应该看到测试电子邮件的内容。
- en: 24.9\. UTILITIES
  id: totrans-126
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.9\. 工具
- en: Following is brief information on the postfix startup script and the postqueue
    utility.
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 以下是对 postfix 启动脚本和 postqueue 工具的简要信息。
- en: 24.9.1\. postfix
  id: totrans-128
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.9.1\. postfix
- en: This script is used to control the Postfix daemon.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 此脚本用于控制 Postfix 守护进程。
- en: Command
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 命令
- en: '`/usr/local/etc/rc.d/postfix`'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: '`/usr/local/etc/rc.d/postfix`'
- en: Syntax
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 语法
- en: '`/usr/local/etc/rc.d/postfix` `*option*`'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: '`/usr/local/etc/rc.d/postfix` `*选项*`'
- en: Options
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 选项
- en: '[PRE28]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Starts the Postfix mail system
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 启动 Postfix 邮件系统
- en: '[PRE29]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Stops the Postfix mail system
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 停止 Postfix 邮件系统
- en: '[PRE30]'
  id: totrans-139
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: Restarts the Postfix mail system and rereads configuration files
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 重新启动 Postfix 邮件系统并重新读取配置文件
- en: Example
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 示例
- en: 'To stop the Postfix mail system, enter the following command at the command
    prompt:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 要停止 Postfix 邮件系统，请在命令提示符下输入以下命令：
- en: '[PRE31]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 24.9.2\. postqueue
  id: totrans-144
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 24.9.2\. postqueue
- en: This utility is useful for checking Postfix's mail queue.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 此实用程序用于检查 Postfix 的邮件队列。
- en: Command
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 命令
- en: '`postqueue`'
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: '`postqueue`'
- en: Syntax
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 语法
- en: '`postqueue -``*option*`'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: '`postqueue -``*选项*`'
- en: Options
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 选项
- en: '[PRE32]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Instructs Postfix to flush/deliver mail that is in the queue
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 指示 Postfix 清空/投递队列中的邮件
- en: '[PRE33]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: Displays the contents of the Postfix queue
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 显示 Postfix 队列的内容
- en: Example
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 示例
- en: 'To display the contents of the Postfix mail queue, enter the following command
    at the command prompt:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 要显示 Postfix 邮件队列的内容，请在命令提示符下输入以下命令：
- en: '[PRE34]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 24.10\. CONFIG FILES
  id: totrans-158
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.10\. 配置文件
- en: /usr/local/etc/postfix/main.cf
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: /usr/local/etc/postfix/main.cf
- en: Contains most of the commonly used configuration options.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 包含大多数常用的配置选项。
- en: /usr/local/etc/postfix/master.cf
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: /usr/local/etc/postfix/master.cf
- en: Contains the configuration options for the Postfix master process. It also controls
    how Postfix interacts with other third-party software (filters and so on).
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 包含 Postfix 主进程的配置选项。它还控制 Postfix 如何与其他第三方软件（过滤器等）交互。
- en: /etc/mail/aliases
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: /etc/mail/aliases
- en: A text representation of rules on mail redirections. The `newaliases` command
    converts this file into a database file named aliases.db for use with Postfix;
    aliases.db is stored in /etc.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 邮件重定向规则的文本表示。`newaliases`命令将此文件转换为名为aliases.db的数据库文件，用于与Postfix一起使用；aliases.db存储在/etc中。
- en: 24.11\. LOG FILES
  id: totrans-165
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.11\. 日志文件
- en: /var/log/maillog
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: /var/log/maillog
- en: General log of email activity
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 邮件活动通用日志
- en: 24.12\. NOTES
  id: totrans-168
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 24.12\. 备注
- en: 'Port 25 In an attempt to fight spam coming from their users, most major Internet
    providers block outgoing traffic on port 25 except to their own SMTP server. To
    see if your ISP blocks port 25, enter the following command:'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 端口25为了防止用户发送垃圾邮件，大多数主要的互联网服务提供商除了自己的SMTP服务器外，都会阻止端口25的出站流量。为了查看您的ISP是否阻止了端口25，请输入以下命令：
- en: '[PRE35]'
  id: totrans-170
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'If port 25 is not blocked, you should see the output listed above. If you get
    a message like this:'
  id: totrans-171
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果端口25没有被阻止，您应该会看到上述输出。如果您收到如下信息：
- en: '[PRE36]'
  id: totrans-172
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: that seems to hang, port 25 is probably blocked. Press [ctrl-C] to abort and
    return to the prompt.
  id: totrans-173
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果看起来卡住了，端口25可能被阻止。按[ctrl-C]中断并返回提示符。
- en: Postfix sends email on the Internet using SMTP. Email clients (Outlook, Thunderbird,
    Apple's Mail, Eudora, and so on) will need another protocol to receive messages
    from your email server, namely IMAP or POP3\. Consult for details on installation/configuration.
  id: totrans-174
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Postfix使用SMTP在互联网上发送电子邮件。电子邮件客户端（Outlook、Thunderbird、Apple的Mail、Eudora等）需要另一个协议来从您的邮件服务器接收消息，即IMAP或POP3。有关安装/配置的详细信息，请咨询。
- en: 'The default size limit for incoming email messages is 10,240,000 bytes (10.2MB).
    You may change this size limit by adding `"message_size_limit =` `*xxx*``"` (replace
    a numerical value for `*xxx*` in bytes) to the end of the main.cf file in /usr/local/etc/postfix.
    The following commands will append this statement to main.cf and restart Postfix
    (replace `*xxx*` with a numerical value in bytes; for instance, to set a 25MB
    limit, use `25000000`):'
  id: totrans-175
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 默认的入站邮件消息大小限制为10,240,000字节（10.2MB）。您可以通过在/usr/local/etc/postfix中的main.cf文件末尾添加`"message_size_limit
    =` `*xxx*``"`（将`*xxx*`替换为字节数）来更改此大小限制。以下命令将此语句追加到main.cf并重新启动Postfix（将`*xxx*`替换为字节数；例如，要设置25MB的限制，请使用`25000000`）：
- en: '[PRE37]'
  id: totrans-176
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: '* * *'
  id: totrans-177
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: '***Note:*** If you change the message size limit to a value larger than 51200000,
    you will need to add the mailbox_size_limit statement and ensure it is larger
    than the message_size_limit setting. Here''s what these two statements would look
    like if you wanted a message size limit of 100MB:'
  id: totrans-178
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '***注意：*** 如果将消息大小限制更改为大于51200000的值，您需要添加`mailbox_size_limit`语句并确保它大于`message_size_limit`设置。如果您想要100MB的消息大小限制，这两个语句将如下所示：'
- en: '* * *'
  id: totrans-179
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: '[PRE38]'
  id: totrans-180
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
