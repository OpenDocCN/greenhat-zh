- en: Chapter 12. RubyGems and Rails Preparation
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 12 章。RubyGems 和 Rails 准备
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages686190.png.jpg)'
  id: totrans-1
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages686190.png.jpg)'
- en: In this chapter, we’ll discuss Ruby’s package-management system, RubyGems, as
    well as Ruby’s most prominent web development framework, Rails. These somewhat
    disparate subjects are lumped together because the “canonical” way to install
    Rails is with the RubyGems software. By the end of this chapter, you will be able
    to install Rails via RubyGems and understand the basic structure and purpose of
    the files that make up a Rails application.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将讨论 Ruby 的包管理系统 RubyGems，以及 Ruby 最突出的 Web 开发框架 Rails。这些相对独立的主题被放在一起，因为安装
    Rails 的“官方”方法是使用 RubyGems 软件。到本章结束时，您将能够通过 RubyGems 安装 Rails，并理解构成 Rails 应用程序的基本结构和目的的文件。
- en: RubyGems
  id: totrans-3
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: RubyGems
- en: Good operating systems have good package-management systems—software that can
    keep track of the other software needed or provided by that operating system and
    make sure everything stays up to date. Mac OS X has Software Update, Windows has
    Windows Update, and the various flavors of GNU/Linux have programs like RPM, YUM,
    and my favorite, APT. Good programming languages have similar programs that give
    programmers and other users access to vast libraries of software written in that
    language. Perl has the Comprehensive Perl Archive Network ([http://cpan.org](http://cpan.org)),
    Python has the Cheese Shop ([http://cheeseshop.python.org/pypi](http://cheeseshop.python.org/pypi)),
    and Ruby has RubyGems ([http://rubygems.org](http://rubygems.org)).
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 良好的操作系统都有良好的包管理系统——软件可以跟踪该操作系统所需或提供的其他软件，并确保一切保持最新。Mac OS X 有软件更新，Windows 有
    Windows 更新，而各种 GNU/Linux 版本有 RPM、YUM 和我最喜欢的 APT 等程序。良好的编程语言也有类似的程序，这些程序为程序员和其他用户提供访问用该语言编写的庞大软件库的途径。Perl
    有综合 Perl 存档网络 ([http://cpan.org](http://cpan.org))，Python 有 Cheese Shop ([http://cheeseshop.python.org/pypi](http://cheeseshop.python.org/pypi))，而
    Ruby 有 RubyGems ([http://rubygems.org](http://rubygems.org))。
- en: Note
  id: totrans-5
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*The most up-to-date RubyGems information is available at [http://docs.rubygems.org](http://docs.rubygems.org).
    This chapter is intended to give you a basic introduction and help you get Rails
    up and running. If you find your curiosity piqued about RubyGems (as I hope you
    will), I highly recommend making [http://docs.rubygems.org](http://docs.rubygems.org)
    one of your regular stops on the Web*.'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: '*最新的 RubyGems 信息可在 [http://docs.rubygems.org](http://docs.rubygems.org) 获取。本章旨在为您提供一个基本介绍，并帮助您启动
    Rails。如果您对 RubyGems 感到好奇（我希望您会），我强烈建议将 [http://docs.rubygems.org](http://docs.rubygems.org)
    设为您的常规网络访问之一*。'
- en: RubyGems has already become the de facto method of creating stand-alone Ruby
    software (especially libraries and programmer utilities) for use by others in
    the Ruby community. With this system, you can easily use other programmers’ software
    to make your job easier, and you can also share your own work, likely making some
    other programmer’s job easier. Each bundle of software that is packaged together
    as a single unit via RubyGems is called a *gem*, and users are able to manipulate
    such gems with the appropriately named `gem` command.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: RubyGems 已经成为创建独立 Ruby 软件的事实标准方法（尤其是库和程序员工具），供 Ruby 社区中的其他人使用。使用此系统，您可以轻松使用其他程序员的软件来简化您的工作，同时也可以分享您自己的工作，这可能会使其他程序员的某些工作变得更简单。通过
    RubyGems 将软件打包成一个单一单元的每个软件包称为 *gem*，用户可以使用名为 `gem` 的相应命令来操作这些 gem。
- en: Installing RubyGems
  id: totrans-8
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装 RubyGems
- en: You will want to browse to [http://rubyforge.org/frs/?group_id=126](http://rubyforge.org/frs/?group_id=126)
    to download the most recent version of RubyGems. Files are provided in both TGZ
    and Zip formats, as well as gem files (for updating after you already have RubyGems
    installed) and patch files. For this example, I’ve downloaded `rubygems-0.9.2.tgz`.
    Uncompress the downloaded file, and use the command `ruby setup.rb` to run the
    `setup.rb` program found inside the newly created directory. You’ll probably have
    to do this as the root user (if applicable to your operating system). You can
    type `gem -v` to see which version of RubyGems you now have installed on your
    system.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 您需要浏览到 [http://rubyforge.org/frs/?group_id=126](http://rubyforge.org/frs/?group_id=126)
    下载 RubyGems 的最新版本。文件提供 TGZ 和 Zip 格式，以及 gem 文件（用于在您已安装 RubyGems 后更新）和补丁文件。在此示例中，我已下载
    `rubygems-0.9.2.tgz`。解压缩下载的文件，并使用命令 `ruby setup.rb` 运行新创建目录中找到的 `setup.rb` 程序。您可能需要以
    root 用户身份执行此操作（如果适用于您的操作系统）。您可以通过输入 `gem -v` 来查看您现在系统上安装的 RubyGems 版本。
- en: Using RubyGems
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 RubyGems
- en: 'If you run `gem` with no arguments, it should return something similar to this:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您不带参数运行`gem`，它应该返回类似于以下内容：
- en: '[PRE0]'
  id: totrans-12
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Listing Installed and Installable Gems
  id: totrans-13
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 列出已安装和可安装的宝石
- en: 'By executing `gem list --local`, you can see which gems are already installed
    on your system. Here is the result of running `gem list --local` immediately after
    installing RubyGems on my machine:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 通过执行`gem list --local`，您可以看到哪些宝石已经安装到您的系统上。以下是我在机器上安装RubyGems后立即运行`gem list
    --local`的结果：
- en: '[PRE1]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The `sources` gem makes it possible for you to install other gems by maintaining
    retrieval information about them. We can query that information via `gem query
    --remote`, which outputs a very long list of available gems, shown here in highly
    truncated form:'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: '`sources`宝石使您能够通过维护有关它们的检索信息来安装其他宝石。我们可以通过`gem query --remote`查询这些信息，它输出一个非常长的可用宝石列表，这里以高度截断的形式显示：'
- en: '[PRE2]'
  id: totrans-17
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Installing Gems
  id: totrans-18
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安装宝石
- en: Each individual gem is installable via the command `gem install --remote` *`some_gem_name`*.
    As an example, let’s install the `rails` gem with `gem install --remote rails`.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 每个单独的宝石都可以通过命令`gem install --remote` *`some_gem_name`*进行安装。作为一个例子，让我们使用`gem
    install --remote rails`来安装`rails`宝石。
- en: '[PRE3]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: I answered `Y` to all requests for confirmation. You can see that the RubyGems
    system is intelligent enough to know which gems are required by other gems, and
    it will install your requested gem’s dependencies automatically. We now have a
    functioning Rails system, which we’ll explore in the next chapter.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 我对所有确认请求都回答了`Y`。您可以看到，RubyGems系统足够智能，足以知道哪些宝石需要其他宝石，并且它会自动安装您请求的宝石的依赖项。我们现在有一个功能齐全的Rails系统，我们将在下一章中对其进行探索。
- en: Note
  id: totrans-22
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*At the time of my installation, there were some minor warnings related to
    *`actionpack`*’s ri and RDoc documentation. They had no impact on the functioning
    of the code and may be out of date by the time you read this book, so I have omitted
    them from the output examples in this chapter*.'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '*在我安装的时候，有一些关于* `actionpack`*的ri和RDoc文档的轻微警告。它们对代码的功能没有影响，并且可能在您阅读这本书的时候已经过时了，所以我已经从本章的输出示例中省略了它们*。'
- en: Updating Gems
  id: totrans-24
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 更新宝石
- en: 'You can update gems already present on your system with the `gem update` command.
    A good precursor is to query whether any gems need updating with `gem outdated`.
    I ran this command on one of my systems that had some out-of-date gems and I got
    the following results:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用`gem update`命令更新系统上现有的宝石。一个好的先决条件是使用`gem outdated`查询是否有任何宝石需要更新。我在一个有一些过时宝石的系统上运行了这个命令，并得到了以下结果：
- en: '[PRE4]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Updating the gems with `gem update rails` (as root) produced this output:'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 使用`gem update rails`（作为root用户）更新宝石产生了以下输出：
- en: '[PRE5]'
  id: totrans-28
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: I specifically chose `rails` as the gem to be updated because it is a gem with
    many dependencies, as we learned when installing it for the first time. Therefore,
    updating it shows how dependencies are automatically updated along with the requested
    gem. Rails depends on Active Record (a software package that provides sophisticated
    database access tools), so updating the `rails` gem also automatically updates
    the `activerecord` gem, as you can see in the update session results above. All
    other `rails` dependencies are updated in a similar manner.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 我特意选择了`rails`作为要更新的宝石，因为它是一个具有许多依赖项的宝石，正如我们在第一次安装时所了解的那样。因此，更新它展示了如何自动更新请求的宝石及其依赖项。Rails依赖于Active
    Record（一个提供高级数据库访问工具的软件包），因此更新`rails`宝石也会自动更新`activerecord`宝石，如上图中更新会话结果所示。所有其他`rails`依赖项以类似的方式更新。
- en: Note
  id: totrans-30
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*After updating your gems, you probably want to execute *`rake rails:update`*
    within each of your Rails application directories. This ensures that any application
    files you have already generated will be updated to account for the change in
    gems, as well*.'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: '*在更新您的宝石之后，您可能希望在您的每个Rails应用程序目录中执行* `rake rails:update`*。这确保了您已经生成的任何应用程序文件都将更新以适应宝石的变化，同样也是如此*。'
- en: Learning More About RubyGems
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 了解更多关于RubyGems的信息
- en: You can always learn more about the `gem` command as it exists on your own machine
    with `gem help` and `gem help` *`some_specific_command`*. This information will
    always be up to date and specific to your system.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过在您的机器上使用`gem help`和`gem help` *`some_specific_command`*来随时了解更多关于`gem`命令的信息。这些信息将始终是最新的，并且针对您的系统。
- en: Rails Preparation
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Rails 准备
- en: You should now know enough about RubyGems to have used it to install Rails.
    The rest of this chapter will familiarize you enough with Rails that you can start
    creating a Rails application in the next chapter. This book introduces Rails (with
    a focus on general design philosophy, rather than an exhaustive list of the API),
    but it would be silly to think that a few chapters could give Rails the attention
    it deserves. The definitive text on Rails is *Agile Web Development with Rails*,
    now in its second edition, by Dave Thomas, David Heinemeier Hansson (creator of
    Rails), and others (Pragmatic Bookshelf, 2006). Other members of the Rails community
    also give high praise to *Ruby for Rails* by David Alan Black (Manning Publications,
    2006).
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你应该对RubyGems有了足够的了解，可以用来安装Rails。接下来的这一章将使你对Rails有足够的了解，以便你可以在下一章开始创建Rails应用程序。本书介绍了Rails（侧重于一般设计哲学，而不是API的详尽列表），但认为几章内容就能给予Rails应有的关注是愚蠢的。关于Rails的权威文本是Dave
    Thomas、David Heinemeier Hansson（Rails的创造者）和其他人合著的《Agile Web Development with Rails》，现在已出到第二版（Pragmatic
    Bookshelf，2006年）。Rails社区的成员也对David Alan Black的《Ruby for Rails》（Manning Publications，2006年）给予了高度评价。
- en: What Is Rails?
  id: totrans-36
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 什么是Rails？
- en: According to its website ([http://rubyonrails.org](http://rubyonrails.org)),
    Rails is “an open-source web framework that’s optimized for programmer happiness
    and sustainable productivity. It lets you write beautiful code by favoring convention
    over configuration.” The site describes it as “Web development that doesn’t hurt.”
    What does that mean?
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 根据其网站[http://rubyonrails.org](http://rubyonrails.org)的描述，Rails是“一个针对程序员幸福感和可持续生产力的优化开源Web框架。它通过优先考虑约定而非配置来让你编写优美的代码。”该网站将其描述为“不会伤害的Web开发。”这意味着什么？
- en: Since it optimizes for programmer happiness and focuses on the ability to write
    beautiful code, Rails is well within the design philosophy of Ruby itself. Rails
    picks sensible defaults for its behavior, and as long as you are willing to follow
    those conventions, your job as the programmer becomes relatively easy. Rails provides
    shortcuts and tools for you to generate a skeleton of a web application very quickly;
    it allows you to place each piece of code in a reasonable location within the
    directory structure that is appropriate to the job that code is expected to perform.
    This provides clean, well-ordered, reusable code that helps you develop an application
    quickly, efficiently, and painlessly.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 由于它优化了程序员的幸福感和专注于编写优美代码的能力，Rails完全符合Ruby本身的设计哲学。Rails为其行为选择了合理的默认值，只要你愿意遵循这些约定，你的程序员工作就会相对容易。Rails为你提供了快速生成Web应用程序骨架的快捷方式和工具；它允许你将每段代码放置在目录结构中合理的位置，该位置适合代码预期执行的任务。这为你提供了干净、有序、可重用的代码，帮助你快速、高效、无痛苦地开发应用程序。
- en: Other Options for Installing Rails
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安装Rails的其他选项
- en: Using RubyGems isn’t the only way to install Rails. There are several other
    options that you may want to use, for example, if you haven’t been following along
    with the text, or if you simply wish to install Rails via some other method. It
    should be noted, however, that installation as a gem is the recommended way to
    install Rails.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 使用RubyGems并不是安装Rails的唯一方式。还有其他几种你可能想要使用的选项，例如，如果你没有跟随文本，或者你只是希望通过其他方法安装Rails。然而，需要注意的是，作为gem的安装是推荐的方式。
- en: Via Operating System Package Manager
  id: totrans-41
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 通过操作系统包管理器
- en: 'Some operating systems’ package managers, such as APT, provide Rails as an
    installable package. For example, on my Ubuntu system, the command `apt-cache
    search rails` shows (among other packages) this result:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 一些操作系统的包管理器，例如APT，提供Rails作为可安装的包。例如，在我的Ubuntu系统中，命令`apt-cache search rails`显示（在其他包中）以下结果：
- en: '[PRE6]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: If you want to use Rails, but you don’t need the most recent bleeding-edge version,
    and you want to avoid installing RubyGems (for whatever reason), this option may
    work well for you.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想要使用Rails，但不需要最新的尖端版本，并且你想要避免安装RubyGems（无论出于什么原因），这个选项可能对你来说是个不错的选择。
- en: From Source
  id: totrans-45
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 从源代码安装
- en: As with any free or open source software, there is always the option to install
    from source. You can browse to [http://rubyonrails.org/down](http://rubyonrails.org/down)
    for the most recent recommended source tarball.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 就像任何免费或开源软件一样，总有从源代码安装的选项。你可以浏览到[http://rubyonrails.org/down](http://rubyonrails.org/down)获取最新推荐的源代码tarball。
- en: Pre-Packaged
  id: totrans-47
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 预包装
- en: There are also some pre-packaged versions of Rails available. For Windows, there
    is Instant Rails ([http://instantrails.rubyforge.org](http://instantrails.rubyforge.org)),
    and for Mac OS X, there’s Locomotive ([http://locomotive.sourceforge.net](http://locomotive.sourceforge.net)).
    Either of these pieces of software can get you up and running with Rails. Note
    that there may be subtle differences in configuration between these packages and
    the default Rails setup. Consulting the website for your chosen pre-packaged application
    is probably your best bet when encountering such a situation.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 还有一些预包装的Rails版本可用。对于Windows，有Instant Rails（[http://instantrails.rubyforge.org](http://instantrails.rubyforge.org)），对于Mac
    OS X，有Locomotive（[http://locomotive.sourceforge.net](http://locomotive.sourceforge.net)）。这两款软件都可以帮助您开始使用Rails。请注意，这些软件包与默认Rails设置之间可能存在细微的配置差异。在遇到这种情况时，咨询您选择的预包装应用程序的网站可能是您的最佳选择。
- en: Databases
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数据库
- en: Rails needs to have access to a database program to function properly. Generally,
    that database is MySQL ([http://mysql.com](http://mysql.com)), although other
    options are possible. If you’re installing via gems or through your operating
    system’s package manager, you should install MySQL. This is probably easiest to
    do through your operating system’s package manager. The pre-packaged Rails installers
    like Instant Rails and Locomotive generally come with their own pre-configured
    databases; however, for all subsequent examples, I’ll assume you installed Rails
    as a gem and you’re using MySQL.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: Rails需要访问数据库程序才能正常工作。通常，这个数据库是MySQL（[http://mysql.com](http://mysql.com)），尽管其他选项也是可能的。如果您通过gem安装或通过操作系统的包管理器安装，您应该安装MySQL。这可能是通过操作系统的包管理器完成的最简单的方法。预包装的Rails安装程序，如Instant
    Rails和Locomotive，通常包含自己的预配置数据库；然而，对于所有后续的例子，我将假设您已将Rails作为gem安装，并且您正在使用MySQL。
- en: The Structure of a Rails Application
  id: totrans-51
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Rails应用程序的结构
- en: Rails operates under a design philosophy (or *pattern*) for software called
    Model-View-Controller (MVC), developed by Norwegian computer scientist Trygve
    Reenskaug^([[35](#ftn.CHP-12-FNOTE-1)]) while he was working at Xerox PARC in
    the late 1970s. It was originally developed in relation to traditional graphical
    user interfaces (GUIs), but MVC has recently become very popular in web development.
    The basics of this pattern are as follows. The *Model* represents the data and
    is an object of some sort. The *View* is a way of presenting data, whether directly
    to a user or to some other computer, or as any other type of output. The *Controller*
    is the traffic cop or manager that keeps track of any requested actions, queries
    or manipulates the Model to get or update data, and gives the View whatever information
    it needs to format the data as necessary.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: Rails遵循一种名为模型-视图-控制器（MVC）的软件设计哲学（或模式），这是由挪威计算机科学家Trygve Reenskaug在20世纪70年代末在施乐帕克研究中心工作时开发的。它最初是与传统的图形用户界面（GUI）相关联而开发的，但MVC最近在Web开发中变得非常流行。这个模式的基本内容如下。*模型*代表数据，是某种类型的对象。*视图*是展示数据的方式，无论是直接向用户展示，还是向其他计算机展示，或者以任何其他类型的输出形式。*控制器*是交通警察或管理者，它跟踪任何请求的操作、查询或操作模型以获取或更新数据，并给视图提供所需的信息，以便按需格式化数据。
- en: Let’s consider an example to help explain this pattern. Back in our second currency
    conversion script ([#19 Currency Conversion, Advanced (currency_converter2.rb)](ch05s05.html
    "#19 Currency Conversion, Advanced (currency_converter2.rb)") on page 90), we
    used data retrieved from an RSS feed. In MVC terms, that data is the Model. That
    same data could have been presented (or Viewed) on a traditional HTML web page,
    as a plaintext file for download, or as a YAML file. In all of these different
    examples, the Model would stay the same and would be something like ExchangeRate
    or CurrencyUnit, depending on how the application was designed. The Controller
    would also be the same, and it would be responsible for retrieving the data from
    a server. We’d probably call it the Download Controller, since it would be used
    to download data from a server.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过一个例子来帮助解释这个模式。在我们的第二个货币转换脚本（[第19节 货币转换高级（currency_converter2.rb）](ch05s05.html
    "#19 货币转换高级（currency_converter2.rb）”）中，我们使用了从RSS源检索到的数据。在MVC术语中，这些数据是模型。同样的数据也可以在传统的HTML网页上展示（或查看），作为一个下载的纯文本文件，或者作为一个YAML文件。在这些不同的例子中，模型保持不变，可能是ExchangeRate或CurrencyUnit这样的对象，这取决于应用程序的设计。控制器也保持不变，它负责从服务器检索数据。我们可能会称之为下载控制器，因为它将用于从服务器下载数据。
- en: 'For the sake of argument, let’s say that we also wanted to present our Model
    in some completely different way, perhaps written down on paper. The written piece
    of paper would use a different Controller, one that deals with paper instead of
    servers. Perhaps we’d call it the Pencil Controller. The View would also be different
    in each of these examples: RSS, HTML, ASCII, WrittenOnAPieceOfPaper, and so on.
    These are all simply different ways of presenting the same data, which is the
    Model. For example, our Rails application in the next chapter has Views for both
    HTML and RSS display of photographs and related information.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 为了辩论的目的，让我们假设我们还想以某种完全不同的方式展示我们的模型，也许是在纸上写下来。这张纸将使用不同的控制器，一个处理纸张而不是服务器的控制器。也许我们可以称之为铅笔控制器。在这些示例中，视图也会有所不同：RSS、HTML、ASCII、写在一张纸上的，等等。这些都是简单地以不同的方式展示相同的数据，即模型。例如，我们下一章中的Rails应用程序具有用于HTML和RSS显示照片和相关信息的视图。
- en: Generating a Rails Application
  id: totrans-55
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 生成Rails应用程序
- en: 'You create a Rails application with the command `rails` *`application_name`*.
    If you execute `rails rails_sample_app` in a suitable workspace directory, you
    should see a very long output similar to the following truncated version:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以使用命令`rails` *`application_name`*创建Rails应用程序。如果您在合适的工作空间目录中执行`rails rails_sample_app`，您应该会看到一个非常长的输出，类似于以下截断版本：
- en: '[PRE7]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'A large number of directories and files are automatically created for you.
    We’ll briefly touch on the `app, doc, lib, log, public, script`, and `test` directories.
    The `app` directory contains the code you’ll write for your application: Models,
    Views, Controllers, and so on. The `doc` directory contains documentation. Nothing
    is initially created in the `lib` directory, but you’ll put generic library files
    (such as extensions that add new methods to existing classes) here. The `log`
    directory contains the application log files, which are split up for production,
    development, and testing. The `public` directory contains non-Ruby files that
    are viewed or used in a web browser, such as static HTML files, images, JavaScript
    files, CSS stylesheets, and the like. The `script` directory contains useful small
    programs meant to be run by the developer or administrator of the application.
    The `test` directory contains files that allow you to easily automate testing
    of the application.'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 会自动为您创建大量的目录和文件。我们将简要介绍`app, doc, lib, log, public, script`和`test`目录。`app`目录包含您为应用程序编写的代码：模型、视图、控制器等。`doc`目录包含文档。`lib`目录最初不创建任何内容，但您会在这里放置通用库文件（例如，向现有类添加新方法的扩展）。`log`目录包含应用程序日志文件，这些文件根据生产、开发和测试进行了分割。`public`目录包含在网页浏览器中查看或使用的非Ruby文件，例如静态HTML文件、图像、JavaScript文件、CSS样式表等。`script`目录包含供应用程序的开发者或管理员运行的有用的小程序。`test`目录包含允许您轻松自动化应用程序测试的文件。
- en: We’ll discuss what each of these files and directories does shortly, but first,
    let’s test our application to make sure it’s running properly.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将简要讨论这些文件和目录的作用，但首先，让我们测试我们的应用程序以确保它运行正常。
- en: Viewing Your Rails Application
  id: totrans-60
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 查看您的Rails应用程序
- en: 'Execute `cd rails_sample_app` to navigate to the newly created directory `rails_sample_app`,
    and execute the command `ruby script/server`. This starts Rails’ built-in webserver
    that it uses for development purposes. You should see output similar to the following:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 执行`cd rails_sample_app`以导航到新创建的目录`rails_sample_app`，然后执行命令`ruby script/server`。这将启动Rails内置的用于开发目的的web服务器。你应该会看到类似以下输出的内容：
- en: '[PRE8]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Your specifics may be different. The `pid` value will almost certainly be different,
    and your Ruby version may be a later one. Your webserver may also be something
    else, such as Mongrel, which is a newer webserver for Rails. (WEBrick is the older
    webserver that serves as a default fallback.) What is unlikely to be different
    is the port: 3000\. You can test your application by browsing to that port on
    your local machine (just point your favorite web browser to http://localhost:3000).
    [Figure 12-1](ch12s02.html#viewing_your_application_in_a_web_browse "Figure 12-1. Viewing
    your application in a web browser with the URL http://localhost:3000") shows what
    that URL looked like when I viewed it on my Ubuntu machine with the Epiphany web
    browser.'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 您的具体情况可能不同。`pid`值几乎肯定不同，您的Ruby版本可能是一个更新的版本。您的web服务器也可能不是WEBrick，而是一个像Mongrel这样的新web服务器（WEBrick是一个作为默认回退的较老web服务器）。不太可能不同的是端口：3000。您可以通过在本地机器上浏览该端口来测试您的应用程序（只需将您喜欢的网页浏览器指向http://localhost:3000）。[图12-1](ch12s02.html#viewing_your_application_in_a_web_browse
    "图12-1. 在网页浏览器中查看您的应用程序，URL为http://localhost:3000")显示了我在我的Ubuntu机器上使用Epiphany网页浏览器查看该URL时的样子。
- en: '![Viewing your application in a web browser with the URL http://localhost:3000](httpatomoreillycomsourcenostarchimages686170.png.jpg)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![在网页浏览器中查看您的应用程序，URL为http://localhost:3000](httpatomoreillycomsourcenostarchimages686170.png.jpg)'
- en: Figure 12-1. Viewing your application in a web browser with the URL http://localhost:3000
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 图12-1. 在网页浏览器中查看您的应用程序，URL为http://localhost:3000
- en: As you can see, this page provides useful information about how to set up your
    application as well as links to Rails-related information on the Web. Two points
    of particular interest are that the database connection is described in the YAML
    file `config/database.yml` and that `script/generate` is available to help you
    generate Models and Controllers.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 如您所见，此页面提供了有关如何设置您的应用程序的有用信息，以及指向Web上Rails相关信息的链接。两个特别感兴趣的是，数据库连接在YAML文件`config/database.yml`中描述，以及`script/generate`可用于帮助您生成模型和控制器。
- en: Basics for Generating Applications
  id: totrans-67
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 生成应用程序的基本知识
- en: 'Within the directory `rails_sample_app`, execute the command `ruby script/generate
    model ExchangeRate`, following our MVC example earlier. We’re telling Rails that
    we want to *generate* something, the thing we want to make is a *Model*, and the
    name of the Model is *ExchangeRate*. Here are the results:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在`rails_sample_app`目录中，执行命令`ruby script/generate model ExchangeRate`，遵循我们之前提到的MVC示例。我们告诉Rails我们想要*生成*一些东西，我们想要制作的东西是*模型*，模型的名称是*ExchangeRate*。以下是结果：
- en: '[PRE9]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'As well as some useful testing- and database-related files, this command created
    a Ruby file called `app/models/exchange_rate.rb`, the contents of which are the
    following:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 除了一些有用的测试和数据库相关文件外，此命令创建了一个名为`app/models/exchange_rate.rb`的Ruby文件，其内容如下：
- en: '[PRE10]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: There doesn’t seem to be a lot there, but appearances can be deceiving. The
    Model follows the Rails naming convention of using CamelCase for class names and
    multi_word_separated_lowercase for filenames. You’ll also notice that `ExchangeRate`
    is a child of something called `ActiveRecord::Base`. Active Record is the software
    that gives Rails its intuitive database interaction. It defines Models (which
    are classes) such that each instance represents a record in a database table.
    Not only that, but the name of the table is always the plural of the class. Therefore,
    the file `exchange_rate.rb` defines a class called `ExchangeRate`, each instance
    of which is stored in a database table called `exchanges_rates`. This all takes
    place under the hood—Rails does it for you automatically, and it is even smart
    enough to know that the plural of `person` is `people`, the plural of `baby` is
    `babies`, and so on.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 看起来似乎没有多少内容，但外表可能会欺骗人。模型遵循Rails的命名约定，即使用驼峰命名法（CamelCase）为类名和下划线分隔的多单词小写（multi_word_separated_lowercase）为文件名。您还会注意到`ExchangeRate`是`ActiveRecord::Base`的子类。Active
    Record是赋予Rails直观数据库交互功能的软件。它定义了模型（即类），每个实例代表数据库表中的一个记录。不仅如此，表的名称总是类的复数形式。因此，`exchange_rate.rb`文件定义了一个名为`ExchangeRate`的类，每个实例都存储在名为`exchanges_rates`的数据库表中。这一切都在幕后发生——Rails为您自动完成，甚至足够智能，知道`person`的复数是`people`，`baby`的复数是`babies`等等。
- en: Note
  id: totrans-73
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*Active Record provides what’s called object-relational mapping (ORM). ORM
    enables a specific instance of a class to represent a record in a database table.
    For those who are curious, each field in the table also represents an instance
    variable in the appropriate class. We’ll talk about this topic more in the next
    chapter*.'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: '*Active Record 提供了所谓的对象关系映射 (ORM)。ORM 允许类的特定实例在数据库表中表示一条记录。对于那些好奇的人来说，表中的每个字段也代表相应类中的一个实例变量。我们将在下一章中更详细地讨论这个话题*。'
- en: 'Our Model doesn’t do anything yet. We won’t start adding to Models until the
    next chapter, so let’s make a Controller with the command `ruby script/generate
    controller server_access rss html ascii yaml`, telling Rails that this time we
    want to generate a Controller and that it should have the Views `rss, html, ascii`,
    and `yaml`. Here are the results:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 我们的模式目前还没有做任何事情。我们不会在下一章开始添加到模型中，所以让我们使用命令 `ruby script/generate controller
    server_access rss html ascii yaml` 创建一个控制器，告诉 Rails 这次我们想要生成一个控制器，并且它应该有视图 `rss,
    html, ascii` 和 `yaml`。以下是结果：
- en: '[PRE11]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: This output is slightly more complicated. We see that we now have a Controller
    called `server_access_controller.rb` in `app/controllers/`, and we now have the
    files `rss.rhtml, html.rhtml, ascii.rhtml`, and `yaml.rhtml` inside `app/views/server_access/`.
    Let’s take a look at `app/controllers/server_access_controller.rb`.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 这个输出稍微复杂一些。我们看到现在我们在 `app/controllers/` 中有一个名为 `server_access_controller.rb`
    的控制器，现在在 `app/views/server_access/` 中有文件 `rss.rhtml, html.rhtml, ascii.rhtml`
    和 `yaml.rhtml`。让我们看看 `app/controllers/server_access_controller.rb`。
- en: '[PRE12]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: We now see another class definition, this time descended from `ApplicationController`,
    and several empty methods whose names match the names of our requested Views.
    Now point your browser at http://localhost:3000/server_access and see what’s there
    ([Figure 12-2](ch12s02.html#unknown_action "Figure 12-2. Unknown action")).
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在看到了另一个类定义，这次是从 `ApplicationController` 继承下来的，以及几个名称与请求的视图名称匹配的空方法。现在将您的浏览器指向
    http://localhost:3000/server_access，看看那里有什么 ([图 12-2](ch12s02.html#unknown_action
    "图 12-2. 未知操作")).
- en: '![Unknown action](httpatomoreillycomsourcenostarchimages686168.png.jpg)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![未知操作](httpatomoreillycomsourcenostarchimages686168.png.jpg)'
- en: Figure 12-2. Unknown action
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-2. 未知操作
- en: What happened? We browsed to the same top-level URL for our Rails application,
    this time adding the name of our new `server_access` Controller, and our application
    complained. Let’s try the URL http://localhost:3000/server_access/rss instead.
    My result is shown in [Figure 12-3](ch12s02.html#the_rss_views_default_result
    "Figure 12-3. The RSS View’s default result").
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 发生了什么？我们浏览到了我们的 Rails 应用程序相同的顶级 URL，这次添加了我们的新 `server_access` 控制器的名称，而我们的应用程序提出了抗议。让我们尝试使用
    URL http://localhost:3000/server_access/rss。我的结果是 [图 12-3](ch12s02.html#the_rss_views_default_result
    "图 12-3. RSS 视图的默认结果")。
- en: Then try using http://localhost:3000/server_access/ascii as the URL ([Figure 12-4](ch12s02.html#the_ascii_views_default_result
    "Figure 12-4. The ASCII View’s default result")).
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 然后尝试使用 http://localhost:3000/server_access/ascii 作为 URL ([图 12-4](ch12s02.html#the_ascii_views_default_result
    "图 12-4. ASCII 视图的默认结果")).
- en: '![The RSS View’s default result](httpatomoreillycomsourcenostarchimages686176.png.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![RSS 视图的默认结果](httpatomoreillycomsourcenostarchimages686176.png.jpg)'
- en: Figure 12-3. The RSS View’s default result
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-3. RSS 视图的默认结果
- en: '![The ASCII View’s default result](httpatomoreillycomsourcenostarchimages686158.png.jpg)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
  zh: '![ASCII 视图的默认结果](httpatomoreillycomsourcenostarchimages686158.png.jpg)'
- en: Figure 12-4. The ASCII View’s default result
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 图 12-4. ASCII 视图的默认结果
- en: In the latter two cases, Rails told us which file provides content for the URL
    requested. We browse to the top-level Rails application and provide the Controller
    name as the first directory and the View name as the next element in the URL.
    This means that in our first example (http://localhost:3000/server_access), we
    provided no View. How will Rails interpret that?
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 在后两种情况下，Rails 告诉我们哪个文件提供了请求的 URL 的内容。我们浏览到顶级 Rails 应用程序，并提供控制器名称作为第一个目录，并将视图名称作为
    URL 中的下一个元素。这意味着在我们的第一个示例（http://localhost:3000/server_access）中，我们没有提供视图。Rails
    将如何解释这一点？
- en: Similar to how the default HTML file in a directory is `index.html`, the default
    View used when none is explicitly provided is `index`. However, `ServerAccessController`
    does not have a method called `index`, so it complained. Don’t worry—we’ll create
    an `index` View in our sample application in the next chapter.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 类似于目录中的默认 HTML 文件是 `index.html`，当没有明确提供时使用的默认视图是 `index`。然而，`ServerAccessController`
    没有名为 `index` 的方法，因此它提出了抗议。别担心——我们将在下一章的示例应用程序中创建一个 `index` 视图。
- en: However, the URL http://localhost:3000/server_access/ascii used a View that
    we know we have, `ascii`, and its results told us to look inside `app/views/server_access/ascii.rhtml`.
    Let’s do so.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，URL http://localhost:3000/server_access/ascii 使用了我们已知存在的视图 `ascii`，其结果指示我们查看
    `app/views/server_access/ascii.rhtml` 文件。让我们这样做。
- en: '[PRE13]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: There’s just enough HTML content there to provide the visible information. The
    file informs us that the Controller name is the class, and the View name is the
    method, using the `#` sign to indicate that it’s an instance method (the `#` sign
    is often used in the Ruby community to distinguish an instance method from a class
    method). To write a real Rails application, we’ll start filling these empty classes,
    methods, and HTML stub files with real content, and we’ll also connect to a database
    to retrieve our information.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 这里仅包含足够的 HTML 内容，以提供可见信息。文件告诉我们控制器名称是类，视图名称是方法，使用 `#` 符号来表示这是一个实例方法（在 Ruby 社区中，`#`
    符号通常用于区分实例方法和类方法）。要编写真正的 Rails 应用程序，我们将开始填充这些空类、方法和 HTML 模板文件，并连接到数据库以检索我们的信息。
- en: Since our View files are .rhtml files, not just static .html files, we can use
    techniques similar to those we’ve already seen in the context of `mod_ruby` to
    put Ruby code directly into our .rhtml files.^([[36](#ftn.CHP-12-FNOTE-2)]) This
    will be crucial in the next chapter.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们的视图文件是 .rhtml 文件，而不仅仅是静态的 .html 文件，因此我们可以使用与我们在 `mod_ruby` 上下文中已经看到的类似的技术，将
    Ruby 代码直接放入我们的 .rhtml 文件中.^([[36](#ftn.CHP-12-FNOTE-2)]) 这将在下一章中变得至关重要。
- en: '* * *'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[35](#CHP-12-FNOTE-1)]) Dr. Reenskaug is online at [http://heim.ifi.uio.no/~trygver](http://heim.ifi.uio.no/~trygver).
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[35](#CHP-12-FNOTE-1)]) Reenskaug 博士正在线，请访问 [http://heim.ifi.uio.no/~trygver](http://heim.ifi.uio.no/~trygver)。
- en: ^([[36](#CHP-12-FNOTE-2)]) Technically, `mod_ruby` uses eRuby, while Rails uses
    erb; these are two different ways to embed Ruby code within markup, but they are
    very similar in practice.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[36](#CHP-12-FNOTE-2)]) 技术上，`mod_ruby` 使用 eRuby，而 Rails 使用 erb；它们是两种在标记中嵌入
    Ruby 代码的不同方法，但在实践中非常相似。
- en: Chapter Recap
  id: totrans-97
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 章节回顾
- en: What was new in this chapter?
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 本章有哪些新内容？
- en: Package management
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 软件包管理
- en: Installing RubyGems
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装 RubyGems
- en: Installing, updating, and querying specific gem package files
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装、更新和查询特定的 gem 软件包文件
- en: Rails basics
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Rails 基础
- en: Installing Rails
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装 Rails
- en: The MVC pattern
  id: totrans-104
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: MVC 模式
- en: ORM basics
  id: totrans-105
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: ORM 基础
- en: Viewing your first Rails application
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 查看您的第一个 Rails 应用程序
- en: Generating Models and Controllers
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 生成模型和控制器
- en: The `index` View used as the default View
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 作为默认视图使用的 `index` 视图
- en: Distinguishing instance methods from class methods with `#`
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用 `#` 区分实例方法和类方法
- en: HTML stub files for Views
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 视图用的 HTML 模板文件
- en: With just that information, you could create some interesting applications that
    do a variety of dynamic tasks. However, the real power of Rails stems from its
    ability to access a database and manipulate content. That will be the focus of
    our next and final chapter.
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 仅凭这些信息，你就可以创建一些执行各种动态任务的应用程序。然而，Rails 的真正力量来自于其访问数据库和操作内容的能力。这将是下一章和最后一章的重点。
