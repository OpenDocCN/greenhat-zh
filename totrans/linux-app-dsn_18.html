<html><head></head><body>
<div>&#13;
<p class="imgc"><a id="page325"/><img src="../images/349-1.jpg" alt=""/></p>&#13;
<p class="ch"><a id="app3"/><a href="toc.html#app3"><b>INSTALLING A FRAMEBUFFER DEVICE DRIVER</b></a></p>&#13;
<p class="imgc"><img src="../images/as.jpg" alt=""/></p>&#13;
<p class="nb">The Laddie CD was designed to work with as many video cards as possible. To accomplish this, it defaults to a framebuffer device driver for a widely adopted video standard and configures it for a low-resolution display with only eight bits per pixel. If this driver fails, the system then attempts to find a hardware-specific driver for your video card and loads that driver with its default configuration. This approach will provide a minimal, working framebuffer for most systems. However, if you would like to take better advantage of your particular hardware, you will need to take some additional steps.</p>&#13;
<p class="indent">In this appendix, we will cover the following topics:</p>&#13;
<ul>&#13;
<li>Finding framebuffer device drivers for your video card</li>&#13;
<li>Configuring the framebuffer device driver</li>&#13;
</ul>&#13;
<p class="secl"><a id="app3.1"/><a href="toc.html#app3.1"><b>Finding Framebuffer Device Drivers for Your Video Card</b></a></p>&#13;
<p class="noindent"><a id="page326"/>To find available device drivers for your video card, boot your PC with the Laddie CD.</p>&#13;
<p class="indent">If the Laddie CD succeeds in finding a driver for your video card, it will launch the Laddie framebuffer UI, shown in Figure C-1. Otherwise, it will display the message <i>The framebuffer (/dev/fb0) is unavailable</i> before the login prompt.</p>&#13;
<p class="imgc"><img src="../images/350-1.jpg" alt=""/></p>&#13;
<p class="cap"><i>Figure C-1: The Laddie framebuffer UI</i></p>&#13;
<p class="indent">For now, we’ll assume that a framebuffer driver loaded successfully. To determine which driver was loaded, first exit the framebuffer UI by pressing ESC. Then type the following at the command prompt:</p>&#13;
<p class="ex">laddie:~# dmesg | grep fb</p>&#13;
<p class="indent">The dmesg command displays the buffer of messages produced by the kernel since startup, and the grep command selects those that might have something to do with framebuffers.</p>&#13;
<p class="secs"><a id="app3.2"/><a href="toc.html#app3.2"><i><b>The vesafb Driver</b></i></a></p>&#13;
<p class="noindent">The Laddie CD first attempts to load the vesfab video driver, since this is the most likely candidate for an unknown graphics card. The vesafb driver supports an interface developed by the Video Electronics Standards Association (VESA) known as VESA BIOS Extensions (VBE). The driver relies on the BIOS and must therefore be configured at system startup. This means that the vesafb driver has to be compiled into the kernel, rather than be supplied as a separate module. The Laddie appliance configures the driver using a boot prompt command, which we will describe later.</p>&#13;
<p class="indent">Here is example output from one of our systems on which a vesafb driver installed successfully:</p>&#13;
<p class="imgl"><img src="../images/350-2.jpg" alt=""/></p>&#13;
<p class="imgl"><a id="page327"/><img src="../images/351-1.jpg" alt=""/></p>&#13;
<p class="secs"><a id="app3.3"/><a href="toc.html#app3.3"><i><b>Hardware-Specific Drivers</b></i></a></p>&#13;
<p class="noindent">If your system successfully loaded the vesafb driver, you will need to disable that driver at boot time in order to check for other drivers. To do this, reboot the Laddie CD. When you see the boot prompt, type <b>novesa</b> and press <small>ENTER</small>. If the framebuffer UI launches, that means the system found an appropriate driver. Exit the framebuffer UI, and type the command <b>dmesg | grep f</b> <b>b</b>. When we did this for one of our systems, the command produced the following:</p>&#13;
<p class="imgl"><img src="../images/351-2.jpg" alt=""/></p>&#13;
<p class="indent">Here we see that the vesafb driver failed to load, and a device-specific driver succeeded. The rivafb is a video driver for NVIDIA graphics cards.</p>&#13;
<p class="indent">You can also check which hardware-specific framebuffer driver your system loaded with the lsmod command. Execute the following at the console:</p>&#13;
<p class="ex">lsmod | grep fb</p>&#13;
<p class="indent">The lsmod command lists all the modules currently loaded by the kernel; framebuffer names typically include the letters <i>fb,</i> for example <i>nvidiafb, radeonfb, savagefb,</i> or <i>matroxfb_g450.</i> By the way, the lsmod command won’t work for the vesafb driver, since the vesafb driver isn’t a module—it’s compiled into the kernel.</p>&#13;
<p class="secs"><a id="app3.4"/><a href="toc.html#app3.4"><i><b>Drivers Not Included on the Laddie CD</b></i></a></p>&#13;
<p class="noindent">If the Laddie CD did not find a driver for your graphics card, it is possible that a newer kernel will support it. In this case, use the lspci command to identify your graphics card. If your card is AGP, PCI, or PCI-Express, this command will report it. The following is one of several lines produced when running the lspci command on one of our development machines.</p>&#13;
<p class="ex">01:00.0 VGA compatible controller: nVidia Corporation NV15 [GeForce2 GTS/Pro] (rev a4)</p>&#13;
<p class="indent">This output shows us that we have an NVIDIA VGA-compatible controller (VGA stands for <i>Video Graphics Array).</i> At this point, you may need to spend some time on the Internet finding a driver for your graphics card. Also keep in mind that Linux doesn’t support all graphics cards, so you may have to install a different card in order to use the Linux framebuffer.</p>&#13;
<p class="secl"><a id="app3.5"/><a href="toc.html#app3.5"><b>Configuring the Framebuffer Device Driver</b></a></p>&#13;
<p class="noindent"><a id="page328"/>Once you’ve found the right video driver for your hardware, you’ll need to configure it for your desired video mode.</p>&#13;
<p class="secs"><a id="app3.6"/><a href="toc.html#app3.6"><i><b>The vesafb Driver</b></i></a></p>&#13;
<p class="noindent">Since the vesafb driver relies on real-mode BIOS functions for initialization, it must be built into the kernel and configured at boot time. This configuration is specified at the kernel command line and may be provided at the boot prompt or in the bootloader’s configuration file. For the vesafb driver, the kernel command line should include the following:</p>&#13;
<p class="ex">video=vesafb <i>vga=&lt;Linux video mode&gt;</i></p>&#13;
<p class="indent">The <i>Linux video mode</i> is a number that specifies a particular resolution and number of bits per pixel. This number is formed by adding <i>0x200</i> to the video mode numbers specified by the VESA BIOS Extensions standard. These Linux video modes are summarized in Table C-1.</p>&#13;
<p class="tcap"><b>Table C-1:</b> Linux Video Mode Numbers</p>&#13;
<p class="imgc"><img src="../images/352-1.jpg" alt=""/></p>&#13;
<p class="seclas"><b>Choose an Appropriate Video Mode</b></p>&#13;
<p class="noindent">A typical VBE-compliant graphics card will not support all of these modes, so you may need to experiment to find one that works. The easiest way to do this is to specify</p>&#13;
<p class="ex">video=vesafb vga=ask</p>&#13;
<p class="noindent">at the Linux boot prompt. (If you are experimenting with the Laddie CD, the complete boot prompt line would be linux vga=ask.) The kernel initialization code will display a list of modes and ask for a mode number. You can ignore the ones it presents, since these are for text-only consoles.</p>&#13;
<p class="indent">Also, don’t bother to choose the scan option. At best, this will provide a longer list of text modes; at worst, it will hang the system and you will have to reboot. In fact, whenever you enter an unsupported number, the kernel responds immediately with <i>Unknown mode ID. Try again,</i> so it doesn’t take long to find one that works. When entering a mode, just provide the hex digits without the leading <i>0x.</i></p>&#13;
<p class="secls"><b>Update the Kernel Command Line</b></p>&#13;
<p class="noindent"><a id="page329"/>Once you have found a VBE video mode that works, you can update the kernel command line in your bootloader configuration file. In this case, you do need to use the leading <i>0x.</i> For example, the command</p>&#13;
<p class="ex">video=vesafb vga=0x311 3</p>&#13;
<p class="noindent">would be appropriate for a VBE-compatible video card that supports a resolution of 640 by 480 with 16 bits per pixel. The final <i>3</i> specifies runlevel 3 to prevent the X display manager from loading a separate video driver.</p>&#13;
<p class="seclas"><b>NOTE</b></p>&#13;
<p class="noindent"><i>The vesafb driver does accept optional parameters for features like efficient scrolling. See /usr/src/linux/Documentation/fb/vesafb.txt for details.</i></p>&#13;
<p class="secs"><a id="app3.7"/><a href="toc.html#app3.7"><i><b>Hardware-Specific Drivers</b></i></a></p>&#13;
<p class="noindent">If you booted the Laddie CD with the novesa option and if the system was able to find a hardware-specific video driver, it will have come up with default settings for the video mode.</p>&#13;
<p class="indent">In this section, we will describe how you can experiment with those settings using the Laddie CD, and then how you can select your preferred settings at boot time for your own system. These comments also apply to video drivers that the Laddie CD doesn’t support, though you will have to use your own system to experiment with them.</p>&#13;
<p class="secls"><b>Experiment with Different Video Modes</b></p>&#13;
<p class="noindent">Unlike the vesafb driver, non-VBE drivers can change modes after startup. To change video mode, use the fbset utility. This utility accesses the file /etc/fb.modes to associate mode names with geometry and timing parameters. For example, the command</p>&#13;
<p class="ex">fbset 640x480-60</p>&#13;
<p class="noindent">will find the geometry and timing parameters associated with the string 640x480-60 and use these to switch the framebuffer to a resolution of 640 by 480 at 60 Hz. If this command is successful, you will probably see the console screen change (e.g., to a larger font) as it switches to a different graphics mode.</p>&#13;
<p class="indent">If the fbset utility is not available on your distribution, you can download it from <a href="http://packages.debian.org/stable/admin/fbset">http://packages.debian.org/stable/admin/fbset</a>. If you install it yourself, be sure to install an appropriate fb.modes file in /etc. You can use one of the fb.modes files provided with the fbset package (which is what we did), but do so with caution, because incorrect timing values can damage some monitors.</p>&#13;
<p class="secls"><b>Select the Desired Video Mode at Startup</b></p>&#13;
<p class="noindent">The Laddie CD maintains hardware-specific video drivers as modules, but once you’ve found the appropriate framebuffer device driver for your system, you may want to build it into the kernel. This is not an option with the Laddie CD, of course, but if you rebuild the kernel for your own system, you will need to configure the driver at the kernel boot prompt. Many non-VBE framebuffer device drivers now support a common syntax for providing the video mode on the kernel command line. Following this syntax, the examplefb driver would be selected at boot time with the following command:</p>&#13;
<p class="ex">video=examplefb:1024x768-24@76</p>&#13;
<p class="indent"><a id="page330"/>This specifies a width of 1,024 pixels, a height of 768 pixels, 24 bits per pixel, and a refresh rate of 76 Hz.</p>&#13;
<p class="seclas"><b>NOTE</b></p>&#13;
<p class="noindent"><i>No timing information has been provided except for the refresh rate. The kernel includes a database of timing parameters (see the file /usr/src/linux/drivers/video/mo dedb. c for details) and will search for an entry that matches the provided resolution and refresh rate. If it fails to find a match, it will use a default video mode, and if that fails, it will attempt all modes in the database.</i></p>&#13;
<p class="indent">In general, the following format is used to specify the video mode:</p>&#13;
<p class="ex">&lt;xres&gt;x&lt;yres&gt;[M][R][-&lt;bpp&gt;][@&lt;refresh&gt;][i][m]</p>&#13;
<p class="indent">Here, an optional M requests the use of <i>VESA Coordinated Video Timings,</i> a systematic method for determining appropriate timings based on resolution, refresh rate, the type of monitor (CRT or digital display), and interlacing. The optional R specifies reduced blanking for digital displays. The optional i specifies an interlaced mode, and the optional m requests an additional 1.8 percent margin in the timing calculations.</p>&#13;
<p class="indent">Besides the common syntax outlined here, specific drivers may support other options, such as disabling acceleration. There is little commonality among drivers; you may need to consult your driver’s source code to find these options.</p>&#13;
<p class="secls"><b>Verify the Settings for Your Framebuffer Driver</b></p>&#13;
<p class="noindent">If you have successfully loaded a framebuffer driver and would like to learn more about its configuration, you can use the fbset -i command to report your framebuffer’s geometry, timings, and various other parameters.</p>&#13;
<p class="indent">To see configuration data on a loaded framebuffer driver, try using cat to examine the contents of /proc/fb and the files in the /sys/class/graphics/fb0 directory. Not all drivers update the /sys directory, but when they do, these files provide a convenient way to access framebuffer parameters such as bits_per_pixel and color_map.</p>&#13;
<p class="indent">For more information on the Linux framebuffer, see the (somewhat dated) HOWTO at <a href="http://tldp.org/HOWTO/Framebuffer-HOWTO.html">http://tldp.org/HOWTO/Framebuffer-HOWTO.html</a>. The VBE 3.0 specification is available at <a href="http://www.vesa.org/public/VBE/vbe3.pdf">http://www.vesa.org/public/VBE/vbe3.pdf.</a></p>&#13;
</div>&#13;
</body></html>