- en: Chapter 16\. OPENLDAP SERVER 2.3.38
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[HTTP://OPENLDAP.ORG](HTTP://OPENLDAP.ORG)'
  id: totrans-1
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 16.1\. SUMMARY
  id: totrans-2
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: LDAP (Lightweight Directory Access Protocol) is a TCP-based protocol used to
    access directory services. Directory services provide users with information about
    other users and resources within a network (usually in the form of address book
    entries). Entries are stored in a central database and accessed from an LDAP server
    (OpenLDAP, Windows Server Active Directory, etc.) via an LDAP-capable client (Microsoft
    Outlook, Mozilla Thunderbird, etc.).
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
- en: OpenLDAP complies with the X.500 series of directory services standards developed
    by the ITU-T (the standards division of the International Telecommunication Union).
    This provides LDAP interoperability between X.500-based applications.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
- en: 'As per the X.500 standard, LDAP entries are stored in a hierarchal format consisting
    of sets of attributes within directory entries:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-6
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: LDAP was created by Tim Howes, Steve Kille, and Wengyik Yeong in 1992\. It started
    as a project to provide directory services alongside the University of Michigan's
    email system.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
- en: A company named Net Boolean Inc. was formed to provide email services for businesses
    in early 1998\. Available commercial LDAP implementations were too expensive for
    this young company. Net Boolean created Boolean LDAP from open source LDAP software
    made available by the University of Michigan. Kurt Zeilenga of Net Boolean later
    founded the OpenLDAP Foundation and the project in August of 1998\. Current OpenLDAP
    development consists of a core team that includes founder Kurt Zeilenga, Howard
    Chu, and Pierangelo Masarati.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: 16.2\. RESOURCES
  id: totrans-9
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: OpenLDAP 2.3 Administrator's Guide
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: '[http://www.openldap.org/doc/admin23](http://www.openldap.org/doc/admin23)'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: RFC 4511 - Lightweight Directory Access Protocol
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: '[http://tools.ietf.org/html/rfc4511](http://tools.ietf.org/html/rfc4511)'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: 16.3\. REQUIRED
  id: totrans-14
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) FreeBSD 7.0-RELEASE
    (see "[FreeBSD 7.0](freebsd_7.0_split_000.html#freebsd_7.0)")'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Updated ports
    collection (see "[FreeBSD Ports Collection](freebsd_ports_collection.html#freebsd_ports_collection)")'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Internet
    connection'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: 16.4\. OPTIONAL
  id: totrans-18
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) OpenSSL with
    a signed SSL Certificate (see "[OpenSSL 0.9.8g](openssl_0.9.8g.html#openssl_0.9.8g)")'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Registered
    domain name'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
- en: 16.5\. PREPARATION
  id: totrans-21
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Become the superuser.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
- en: 16.6\. INSTALL
  id: totrans-23
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To begin the OpenLDAP installation process, enter the following commands:'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-25
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: A menu should appear displaying options for openldap-server. We will leave the
    options at their defaults; press [tab] to select OK and then press [enter] to
    continue the installation process.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: 16.7\. CONFIGURE
  id: totrans-27
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Once the installation process is complete, it's time to configure OpenLDAP for
    use on your system.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 安装过程完成后，是时候为您的系统配置OpenLDAP了。
- en: Set up an OpenLDAP root password. OpenLDAP stores the LDAP administrator's password
    in the main configuration file slapd.conf. OpenLDAP can read this password either
    as plaintext or as a hash. A hash obscures the password with an algorithm so it
    isn't in plain view. The commands below will create an SSHA (Salted Secure Hash
    Algorithm) hash of your root password for OpenLDAP and insert it into slapd.conf.
  id: totrans-29
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 设置OpenLDAP的根密码。OpenLDAP将LDAP管理员的密码存储在主配置文件slapd.conf中。OpenLDAP可以以明文或哈希的形式读取此密码。哈希通过算法将密码加密，使其不在明文中显示。以下命令将为OpenLDAP创建根密码的SSHA（加盐安全哈希算法）哈希，并将其插入到slapd.conf中。
- en: '[PRE2]'
  id: totrans-30
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'We''ll make a few more modifications to the slapd.conf file. Open slapd.conf:'
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们将对slapd.conf文件进行一些修改。打开slapd.conf：
- en: '[PRE3]'
  id: totrans-32
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Scroll down to the `suffix` declaration (~56). If your domain name is [example.com](http://example.com),
    enter `"dc=``*example*``,dc=``*com*``"`. Proceed to the next entry, `rootdn`,
    and enter the same information, leaving the `"cn=Manager"` segment alone. The
    two lines would appear as follows for a domain named [example.com](http://example.com):'
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 滚动到`suffix`声明（约56行）。如果您的域名是[example.com](http://example.com)，请输入`"dc=``*example*``,dc=``*com*``"`。继续到下一个条目`rootdn`，并输入相同的信息，保留`"cn=Manager"`部分不变。对于名为[example.com](http://example.com)的域名，这两行将如下所示：
- en: '[PRE4]'
  id: totrans-34
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Scroll down to the bottom of slapd.conf and add the following two lines:'
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 滚动到slapd.conf文件的底部并添加以下两行：
- en: '[PRE5]'
  id: totrans-36
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: These lines add support for the `COSINE` schema and the `inetOrgPerson` object
    class. `COSINE` and `inetOrgPerson` extend the core schema with attributes that
    are useful to organizations. Examples of additional attributes include employee
    numbers, room numbers, building names, and so on.
  id: totrans-37
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这些行添加了对`COSINE`模式和对`inetOrgPerson`对象类的支持。`COSINE`和`inetOrgPerson`通过添加对组织有用的属性扩展了核心模式。附加属性的示例包括员工编号、房间编号、建筑名称等。
- en: For information on the `COSINE` schema, see [http://tools.ietf.org/html/rfc4524](http://tools.ietf.org/html/rfc4524).
  id: totrans-38
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 关于`COSINE`模式的信息，请参阅[http://tools.ietf.org/html/rfc4524](http://tools.ietf.org/html/rfc4524)。
- en: For information on the `inetOrgPerson` object class, see [http://tools.ietf.org/html/rfc2798](http://tools.ietf.org/html/rfc2798).
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 关于`inetOrgPerson`对象类的信息，请参阅[http://tools.ietf.org/html/rfc2798](http://tools.ietf.org/html/rfc2798)。
- en: 'Add a simple access policy to keep the `userPassword` attribute from being
    displayed to other users. Add these lines to the bottom of slapd.conf:'
  id: totrans-40
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加一个简单的访问策略，以防止将`userPassword`属性显示给其他用户。将以下行添加到slapd.conf文件的底部：
- en: '[PRE6]'
  id: totrans-41
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Add another access policy for user information. Users should have write access
    to their own information and read-only access to other people''s information.
    Anonymous users should have no access. Requests from the localhost should have
    read access. The lines should appear as follows:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 添加另一个访问策略以获取用户信息。用户应有权写入自己的信息，并对其他人的信息具有只读访问权限。匿名用户应无权访问。来自本地主机的请求应具有读取权限。这些行应如下所示：
- en: '[PRE7]'
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: If you possess a signed SSL Certificate and wish to enable secure LDAP connections
    using SSL, continue. Otherwise skip to step 8\. The following declarations will
    tell the slapd program where to find your SSL Certificates.
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果您拥有已签名的SSL证书并希望启用使用SSL的安全LDAP连接，请继续。否则跳到步骤8。以下声明将告诉slapd程序在哪里找到您的SSL证书。
- en: 'Code View:'
  id: totrans-45
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 代码视图：
- en: '[PRE8]'
  id: totrans-46
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Remember to change the paths and filenames (in italics) to point to your server
    certificates and key file. Save and exit.
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 记得将路径和文件名（斜体）更改为指向您的服务器证书和密钥文件。保存并退出。
- en: 'OpenLDAP uses an embedded database called Berkeley DB to store its data. The
    command below will copy the example database configuration file DB_CONFIG.example
    to OpenLDAP''s database path:'
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: OpenLDAP使用一个名为Berkeley DB的嵌入式数据库来存储其数据。以下命令将示例数据库配置文件DB_CONFIG.example复制到OpenLDAP的数据库路径：
- en: '[PRE9]'
  id: totrans-49
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 16.8\. TESTING
  id: totrans-50
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 16.8\. 测试
- en: In this section, we'll perform some basic tests to confirm that OpenLDAP answers
    LDAP requests properly.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将执行一些基本测试，以确认OpenLDAP能够正确地响应LDAP请求。
- en: 'To start the LDAP server automatically at boot time, add these lines to the
    rc.conf file located in /etc. Open rc.conf:'
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 要在启动时自动启动LDAP服务器，请将以下行添加到位于`/etc`目录中的rc.conf文件中。打开rc.conf：
- en: '[PRE10]'
  id: totrans-53
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'If you did not choose to enable secure LDAP connections with SSL, add the following
    lines:'
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果您没有选择启用带有SSL的安全LDAP连接，请添加以下行：
- en: '[PRE11]'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'If you chose to enable secure LDAP connections with SSL, add the following
    lines:'
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 如果您选择启用带有SSL的安全LDAP连接，请添加以下行：
- en: '[PRE12]'
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Save and exit, then start the LDAP server:'
  id: totrans-58
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 保存并退出，然后启动LDAP服务器：
- en: '[PRE13]'
  id: totrans-59
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Create data to import into the LDAP database. The first import to the LDAP
    database will consist of the domain and manager entries. Change to a working directory
    of your choice. Create a file named domainmgr.ldif:'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Enter the following text into the blank file:'
  id: totrans-62
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'The LDAP abbreviations in use are:'
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-65
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: distinguished name
  id: totrans-66
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-67
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: domain component
  id: totrans-68
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: common name
  id: totrans-70
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE19]'
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: organization
  id: totrans-72
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Substitute your domain name appropriately (items in italics must reflect your
    domain). Do not change any other parts of this file. The ldapadd utility we are
    going to run next is very specific about the syntax of LDIF (LDAP Data Interchange
    Format) files. Ensure that there are no extra spaces after the last letter of
    each line. The single blank line between the domain and manager entries is necessary.
    Save and exit.
  id: totrans-73
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Add the entries of domainmgr.ldif to the LDAP database (substitute your domain
    name):'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE20]'
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: You will be prompted for the LDAP root password you created in step 1 of "[Configure](configure-id15.html#configure-id15)".
    If the command completes without any errors, continue; otherwise reopen domainmgr.ldif,
    check spelling and spacing, and run the command again.
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Create an organizational unit to hold user entries. Create a file named people.ldif:'
  id: totrans-77
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'Enter the following text into the blank file:'
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE22]'
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Again, substitute your domain name (shown in italics) and be careful with spelling
    and spacing. Save and exit.
  id: totrans-81
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Add the entries of people.ldif to the LDAP database (substitute your domain
    name):'
  id: totrans-82
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE23]'
  id: totrans-83
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Add a user to the LDAP database within the organizational unit you created.
    Create a file named user.ldif:'
  id: totrans-84
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE24]'
  id: totrans-85
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Enter the following text into the blank file:'
  id: totrans-86
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE25]'
  id: totrans-87
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Replace the items shown in italics with the appropriate data. Save and exit.
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Create a hashed password for this new user and append it to user.ldif:'
  id: totrans-89
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE26]'
  id: totrans-90
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Add the entries of user.ldif to the LDAP database (substitute your domain name):'
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE27]'
  id: totrans-92
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Check that all of the above entries made it into the LDAP database successfully
    (substitute your domain name):'
  id: totrans-93
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE28]'
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'You will be prompted for the manager password. Below is a sample of output
    from the `ldapsearch` command:'
  id: totrans-95
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE29]'
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: '[PRE30]'
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: '* * *'
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** When logging into the LDAP server from an LDAP client you may need
    to enter "Base DN," "Bind DN," password, and hostname. Here is what to enter for
    "Base DN" and "Bind DN" (replace the italicized items appropriately):'
  id: totrans-99
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE31]'
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 16.9\. CONFIG FILES
  id: totrans-102
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: /usr/local/etc/openldap/slapd.conf
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
- en: Main configuration file for slapd
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
- en: 16.10\. LOG FILES
  id: totrans-105
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: /var/log/debug.log
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
- en: Contains slapd logs
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
- en: 16.11\. NOTES
  id: totrans-108
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Since ldapadd is sensitive to syntax errors, adding entries to the LDAP database
    manually (as we did in the test section above) can be very inconvenient. Utilities
    exist that allow you to administer the LDAP database in a more efficient and user-friendly
    manner. phpLDAPadmin is a web-based LDAP browser designed to manage the LDAP database
    more intuitively. See "phpLDAPadmin 1.1.0" on page 153 for details.
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: OpenLDAP 2.3 accepts only LDAPv3 requests by default. Ensure that your LDAP
    client is set to LDAPv3 if given the option. If LDAPv2 is needed you may add `allow
    bind_v2` to /usr/local/etc/openldap/slapd.conf; see the manual page for slapd.conf
    for details (view this by typing `man slapd.conf` at the prompt).
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OpenLDAP 2.3 默认只接受 LDAPv3 请求。如果提供了选项，请确保您的 LDAP 客户端设置为 LDAPv3。如果需要 LDAPv2，您可以在
    /usr/local/etc/openldap/slapd.conf 中添加 `allow bind_v2`；有关 slapd.conf 的详细信息，请参阅手册页（在提示符下输入
    `man slapd.conf` 查看此信息）。
