- en: Chapter 16\. OPENLDAP SERVER 2.3.38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[HTTP://OPENLDAP.ORG](HTTP://OPENLDAP.ORG)'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 16.1\. SUMMARY
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: LDAP (Lightweight Directory Access Protocol) is a TCP-based protocol used to
    access directory services. Directory services provide users with information about
    other users and resources within a network (usually in the form of address book
    entries). Entries are stored in a central database and accessed from an LDAP server
    (OpenLDAP, Windows Server Active Directory, etc.) via an LDAP-capable client (Microsoft
    Outlook, Mozilla Thunderbird, etc.).
  prefs: []
  type: TYPE_NORMAL
- en: OpenLDAP complies with the X.500 series of directory services standards developed
    by the ITU-T (the standards division of the International Telecommunication Union).
    This provides LDAP interoperability between X.500-based applications.
  prefs: []
  type: TYPE_NORMAL
- en: 'As per the X.500 standard, LDAP entries are stored in a hierarchal format consisting
    of sets of attributes within directory entries:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: LDAP was created by Tim Howes, Steve Kille, and Wengyik Yeong in 1992\. It started
    as a project to provide directory services alongside the University of Michigan's
    email system.
  prefs: []
  type: TYPE_NORMAL
- en: A company named Net Boolean Inc. was formed to provide email services for businesses
    in early 1998\. Available commercial LDAP implementations were too expensive for
    this young company. Net Boolean created Boolean LDAP from open source LDAP software
    made available by the University of Michigan. Kurt Zeilenga of Net Boolean later
    founded the OpenLDAP Foundation and the project in August of 1998\. Current OpenLDAP
    development consists of a core team that includes founder Kurt Zeilenga, Howard
    Chu, and Pierangelo Masarati.
  prefs: []
  type: TYPE_NORMAL
- en: 16.2\. RESOURCES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: OpenLDAP 2.3 Administrator's Guide
  prefs: []
  type: TYPE_NORMAL
- en: '[http://www.openldap.org/doc/admin23](http://www.openldap.org/doc/admin23)'
  prefs: []
  type: TYPE_NORMAL
- en: RFC 4511 - Lightweight Directory Access Protocol
  prefs: []
  type: TYPE_NORMAL
- en: '[http://tools.ietf.org/html/rfc4511](http://tools.ietf.org/html/rfc4511)'
  prefs: []
  type: TYPE_NORMAL
- en: 16.3\. REQUIRED
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) FreeBSD 7.0-RELEASE
    (see "[FreeBSD 7.0](freebsd_7.0_split_000.html#freebsd_7.0)")'
  prefs: []
  type: TYPE_IMG
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Updated ports
    collection (see "[FreeBSD Ports Collection](freebsd_ports_collection.html#freebsd_ports_collection)")'
  prefs: []
  type: TYPE_IMG
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Internet
    connection'
  prefs: []
  type: TYPE_NORMAL
- en: 16.4\. OPTIONAL
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) OpenSSL with
    a signed SSL Certificate (see "[OpenSSL 0.9.8g](openssl_0.9.8g.html#openssl_0.9.8g)")'
  prefs: []
  type: TYPE_IMG
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Registered
    domain name'
  prefs: []
  type: TYPE_NORMAL
- en: 16.5\. PREPARATION
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Become the superuser.
  prefs: []
  type: TYPE_NORMAL
- en: 16.6\. INSTALL
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To begin the OpenLDAP installation process, enter the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: A menu should appear displaying options for openldap-server. We will leave the
    options at their defaults; press [tab] to select OK and then press [enter] to
    continue the installation process.
  prefs: []
  type: TYPE_NORMAL
- en: 16.7\. CONFIGURE
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Once the installation process is complete, it's time to configure OpenLDAP for
    use on your system.
  prefs: []
  type: TYPE_NORMAL
- en: Set up an OpenLDAP root password. OpenLDAP stores the LDAP administrator's password
    in the main configuration file slapd.conf. OpenLDAP can read this password either
    as plaintext or as a hash. A hash obscures the password with an algorithm so it
    isn't in plain view. The commands below will create an SSHA (Salted Secure Hash
    Algorithm) hash of your root password for OpenLDAP and insert it into slapd.conf.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'We''ll make a few more modifications to the slapd.conf file. Open slapd.conf:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Scroll down to the `suffix` declaration (~56). If your domain name is [example.com](http://example.com),
    enter `"dc=``*example*``,dc=``*com*``"`. Proceed to the next entry, `rootdn`,
    and enter the same information, leaving the `"cn=Manager"` segment alone. The
    two lines would appear as follows for a domain named [example.com](http://example.com):'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Scroll down to the bottom of slapd.conf and add the following two lines:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: These lines add support for the `COSINE` schema and the `inetOrgPerson` object
    class. `COSINE` and `inetOrgPerson` extend the core schema with attributes that
    are useful to organizations. Examples of additional attributes include employee
    numbers, room numbers, building names, and so on.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: For information on the `COSINE` schema, see [http://tools.ietf.org/html/rfc4524](http://tools.ietf.org/html/rfc4524).
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: For information on the `inetOrgPerson` object class, see [http://tools.ietf.org/html/rfc2798](http://tools.ietf.org/html/rfc2798).
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Add a simple access policy to keep the `userPassword` attribute from being
    displayed to other users. Add these lines to the bottom of slapd.conf:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Add another access policy for user information. Users should have write access
    to their own information and read-only access to other people''s information.
    Anonymous users should have no access. Requests from the localhost should have
    read access. The lines should appear as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: If you possess a signed SSL Certificate and wish to enable secure LDAP connections
    using SSL, continue. Otherwise skip to step 8\. The following declarations will
    tell the slapd program where to find your SSL Certificates.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Code View:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Remember to change the paths and filenames (in italics) to point to your server
    certificates and key file. Save and exit.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'OpenLDAP uses an embedded database called Berkeley DB to store its data. The
    command below will copy the example database configuration file DB_CONFIG.example
    to OpenLDAP''s database path:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 16.8\. TESTING
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In this section, we'll perform some basic tests to confirm that OpenLDAP answers
    LDAP requests properly.
  prefs: []
  type: TYPE_NORMAL
- en: 'To start the LDAP server automatically at boot time, add these lines to the
    rc.conf file located in /etc. Open rc.conf:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'If you did not choose to enable secure LDAP connections with SSL, add the following
    lines:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'If you chose to enable secure LDAP connections with SSL, add the following
    lines:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Save and exit, then start the LDAP server:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Create data to import into the LDAP database. The first import to the LDAP
    database will consist of the domain and manager entries. Change to a working directory
    of your choice. Create a file named domainmgr.ldif:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Enter the following text into the blank file:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'The LDAP abbreviations in use are:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: distinguished name
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: domain component
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: common name
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: organization
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Substitute your domain name appropriately (items in italics must reflect your
    domain). Do not change any other parts of this file. The ldapadd utility we are
    going to run next is very specific about the syntax of LDIF (LDAP Data Interchange
    Format) files. Ensure that there are no extra spaces after the last letter of
    each line. The single blank line between the domain and manager entries is necessary.
    Save and exit.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Add the entries of domainmgr.ldif to the LDAP database (substitute your domain
    name):'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: You will be prompted for the LDAP root password you created in step 1 of "[Configure](configure-id15.html#configure-id15)".
    If the command completes without any errors, continue; otherwise reopen domainmgr.ldif,
    check spelling and spacing, and run the command again.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Create an organizational unit to hold user entries. Create a file named people.ldif:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Enter the following text into the blank file:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Again, substitute your domain name (shown in italics) and be careful with spelling
    and spacing. Save and exit.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Add the entries of people.ldif to the LDAP database (substitute your domain
    name):'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Add a user to the LDAP database within the organizational unit you created.
    Create a file named user.ldif:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Enter the following text into the blank file:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Replace the items shown in italics with the appropriate data. Save and exit.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Create a hashed password for this new user and append it to user.ldif:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE26]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Add the entries of user.ldif to the LDAP database (substitute your domain name):'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Check that all of the above entries made it into the LDAP database successfully
    (substitute your domain name):'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE28]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'You will be prompted for the manager password. Below is a sample of output
    from the `ldapsearch` command:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE29]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '[PRE30]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** When logging into the LDAP server from an LDAP client you may need
    to enter "Base DN," "Bind DN," password, and hostname. Here is what to enter for
    "Base DN" and "Bind DN" (replace the italicized items appropriately):'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE31]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 16.9\. CONFIG FILES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: /usr/local/etc/openldap/slapd.conf
  prefs: []
  type: TYPE_NORMAL
- en: Main configuration file for slapd
  prefs: []
  type: TYPE_NORMAL
- en: 16.10\. LOG FILES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: /var/log/debug.log
  prefs: []
  type: TYPE_NORMAL
- en: Contains slapd logs
  prefs: []
  type: TYPE_NORMAL
- en: 16.11\. NOTES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Since ldapadd is sensitive to syntax errors, adding entries to the LDAP database
    manually (as we did in the test section above) can be very inconvenient. Utilities
    exist that allow you to administer the LDAP database in a more efficient and user-friendly
    manner. phpLDAPadmin is a web-based LDAP browser designed to manage the LDAP database
    more intuitively. See "phpLDAPadmin 1.1.0" on page 153 for details.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: OpenLDAP 2.3 accepts only LDAPv3 requests by default. Ensure that your LDAP
    client is set to LDAPv3 if given the option. If LDAPv2 is needed you may add `allow
    bind_v2` to /usr/local/etc/openldap/slapd.conf; see the manual page for slapd.conf
    for details (view this by typing `man slapd.conf` at the prompt).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
