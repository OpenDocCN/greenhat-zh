- en: Introduction
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 引言
- en: It's ten o'clock on Monday morning. The boss of the branch office is in a rage.
    He's been waiting for hours for an important e-mail, and it still hasn't arrived.
    It can only be the fault of the mail server; it's probably misbehaving yet again.
    But a quick check of the computer shows that no mails have got stuck in the queue
    there, and there's no mention either in the log file that a mail from the sender
    in question has arrived. So where's the problem?
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 周一早上十点钟。分支机构老板怒火中烧。他已经等了几个小时，等待一封重要的电子邮件，但它仍然没有到达。这一定是邮件服务器的错；它可能又出故障了。但快速检查电脑显示，那里没有邮件在队列中，日志文件中也没有提到相关发件人的邮件已到达。那么问题出在哪里？
- en: The central mail server of the company doesn't respond to a **`ping`**. That's
    probably the root of the problem. But the IT department at the company head office
    absolutely insists that it is not to blame. It also cannot ping the mail node
    of the branch office, but it maintains that the network at the head office is
    running smoothly, so the problem must lie with the network at the branch office.
    The search for the error continues...
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 公司的核心邮件服务器对**`ping`**无响应。这可能是问题的根源。但公司总部IT部门坚决否认责任。它也无法ping通分支机构的邮件节点，但它坚持认为总部网络运行正常，因此问题一定出在分支机构网络。错误搜索仍在继续...
- en: 'The humiliating result: the VPN connection to head office was down, and although
    the ISDN backup connection was working, no route to the head office (and thus
    to the central mail server) was defined in the backup router. A globally operating
    IT service provider was responsible for the network connections (VPN and ISDN)
    between branch and head office, for whom something like this "just doesn''t happen."
    The end result: many hours spent searching for the error, an irritated boss (the
    meeting for which the e-mail was urgently required has long since finished), and
    a sweating admin.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 令人羞愧的结果：连接到总部的VPN连接已中断，尽管ISDN备份连接正在工作，但在备份路由器中并未定义通往总部（以及中央邮件服务器）的路由。一个全球运营的IT服务提供商负责分支机构与总部之间的网络连接（VPN和ISDN），对于他们来说，类似的事情“根本就不会发生”。最终结果：花费数小时寻找错误，一个愤怒的老板（紧急需要的会议早已结束），以及一个满头大汗的管理员。
- en: With a properly configured Nagios system, the adminstrator would already have
    noticed the problem at eight in the morning and been able to isolate its cause
    within a few minutes. Instead of losing valuable time, the IT service provider
    would have been informed directly. The time then required to eliminate the error
    (in this case, half an hour) would have been sufficient to deliver the e-mail
    in time.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个正确配置的Nagios系统中，管理员会在早上八点就已经注意到问题，并在几分钟内就能找出其根源。这样一来，就不会浪费宝贵的时间，可以直接通知IT服务提供商。消除错误（在这个案例中，半小时）所需的时间足以及时发送电子邮件。
- en: 'A second example: somewhere in Germany, the hard drive on which the central
    Oracle database for a hospital stores its log files reaches full capacity Although
    this does not cause the "lights to go out" in the operating room, the database
    stops working and there is considerable disruption to work procedures: patients
    cannot be admitted, examination results cannot be saved, and reports cannot be
    documented until the problem has been fixed.'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个例子：在德国某地，存储医院中央Oracle数据库日志文件的那个硬盘已达到满容量。尽管这不会导致手术室“灯火管制”，但数据库停止工作，工作流程受到很大干扰：患者无法入院，检查结果无法保存，报告无法记录，直到问题得到解决。
- en: If the critical hard drive had been monitored with Nagios, the IT department
    would have been warned at an early stage. The problem would not even have occurred.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 如果关键的硬盘驱动器被Nagios监控，IT部门会在早期阶段收到警告。问题甚至可能根本就不会发生。
- en: With personnel resources becoming more and more scarce, no IT department can
    really afford to regularly check all systems manually. Networks that are growing
    more and more complex especially demand the need to be informed early on of disruptions
    that have occurred or of problems that are about to happen. Nagios, the Open Source
    tool for system and network monitoring, helps the administrator to detect problems
    before the phone rings off the hook.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 随着人力资源越来越稀缺，没有任何IT部门真的能负担得起定期手动检查所有系统。尤其是日益复杂的网络，特别需要提前了解已发生的故障或即将发生的问题。Nagios，一个开源的系统和网络监控工具，帮助管理员在电话铃响之前发现问题。
- en: The aim of the software is to inform administrators quickly about questionable
    (WARNING) or critical conditions (CRITICAL). What is regarded as "questionable"
    or "critical" is defined by the administrator in the configuration. A Web page
    summary then informs the administrator of normally working systems and services,
    which Nagios displays in green, of questionable conditions (yellow), and of critical
    situations (red). There is also the possibility of informing the administrators
    in charge—depending on specific services or systems—selectively by e-mail but
    also by paging services such as SMS.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 软件的目标是快速通知管理员有关可疑（警告）或关键条件（关键）。什么被视为“可疑”或“关键”由管理员在配置中定义。网页摘要随后通知管理员正常工作的系统和服务的状态，Nagios用绿色显示，可疑条件（黄色），以及关键情况（红色）。还有可能根据具体服务或系统选择性地通过电子邮件或通过诸如短信之类的呼叫服务通知管理员。
- en: By concentrating on stop light states (green, yellow, red), Nagios is distinct
    from network tools that display elapsed time graphically (for example in the load
    of a WAN interface or a CPU throughout an entire day) or that record and measure
    network traffic (how high was the proportion of HTTP on a particular interface?).
    Nagios is involved plainly and simply with the issue of whether everything is
    on a green light. The software does an excellent job in looking after this, not
    just in terms of the current status but also over long periods of time.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 通过专注于交通灯状态（绿色、黄色、红色），Nagios与显示已过时间图形（例如，在WAN接口的负载或整个一天的CPU）或记录和测量网络流量（特定接口上HTTP的比例有多高？）的网络工具不同。Nagios直接简单地处理是否一切正常的问题。软件在这方面做得很好，不仅限于当前状态，而且也涉及长期时间。
- en: The tests
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 测试
- en: When checking critical hosts and services, Nagios distinguishes between host
    and service checks. A *host check* tests a computer, called a *host* in Nagios
    slang, for reachability—as a rule, a simple **`ping`** is used. A *service check*
    selectively tests individual network services such as HTTP, SMTP, DNS, etc., but
    also running processes, CPU load, or log files. Host checks are performed by Nagios
    irregularly and only where required, for example if none of the services to be
    monitored can be reached on the host being monitored. As long as one service can
    be addressed there, then this is basically valid for the entire computer, so this
    test can be dropped.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 在检查关键主机和服务时，Nagios区分主机检查和服务检查。*主机检查*测试一台计算机，在Nagios术语中称为*主机*，以检查其可达性——通常使用简单的**`ping`**。*服务检查*选择性地测试单个网络服务，如HTTP、SMTP、DNS等，以及运行中的进程、CPU负载或日志文件。只要主机上有一个服务可以访问，那么这基本上对该计算机整体有效，因此可以省略这个测试。Nagios在不规则和必要时执行主机检查，例如，如果监控的主机上没有要监控的服务可以访问。
- en: The simplest test for network services consists of looking to see whether the
    relevant target port is open, and whether a service is listening there. But this
    does not necessarily mean that, for example, the SSH daemon really is running
    on TCP port 22\. Nagios therefore uses tests for many services that go several
    steps further. With SMTP, for example, the software also tests whether the mail
    server announces itself with a "220" output, the so-called *SMTP greeting*; and
    for a PostgreSQL database, it checks whether this will accept an SQL query.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 网络服务的最简单测试是查看相关目标端口是否开放，以及是否有服务在那里监听。但这并不一定意味着，例如，SSH守护进程确实正在TCP端口22上运行。因此，Nagios使用多种服务测试，这些测试要深入几步。例如，对于SMTP，软件还会测试邮件服务器是否通过“220”输出自我宣布，即所谓的*SMTP问候*；而对于PostgreSQL数据库，它会检查是否接受SQL查询。
- en: Nagios becomes especially interesting through the fact that it takes into account
    dependencies in the network topology (if it is configured to do so). If the target
    system can only be reached through a particular router that has just gone down,
    then Nagios reports that the target system is "unreachable" and does not bother
    to bombard it with further host and service checks. The software puts administrators
    in a position where they can more quickly detect the actual cause and rectify
    the situation.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios之所以特别有趣，是因为它考虑了网络拓扑中的依赖关系（如果配置了这样做的话）。如果目标系统只能通过一个刚刚宕机的特定路由器访问，那么Nagios会报告目标系统“不可达”，并且不会进一步对其进行主机和服务检查。软件使管理员能够更快地发现实际原因并纠正情况。
- en: The suppliers of information
  id: totrans-14
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 信息供应商
- en: The great strength of Nagios—even in comparison with other network monitoring
    tools—lies in its modular structure. The Nagios core does not contain one single
    test. Instead it uses external programs for service and host checks, which are
    known as *plugins*. The basic equipment already contains a number of standard
    plugins for the most important application cases. Special requests that go beyond
    these are answered—provided that you have basic programming knowledge—by plugins
    that you can write yourself. Before investing time in developing these, however,
    it is first worth taking a look on the Internet and browsing through the relevant
    mailing lists,^([[2](#ftn.PREFACE-FN-2)]) as there is lively activity in this
    area. Ready-to-use plugins are available, especially in The Nagios Exchange platform,
    [http://www.nagiosexchange.org/](http://www.nagiosexchange.org/).
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios的强大之处——即使在与其他网络监控工具的比较中——也在于其模块化结构。Nagios核心不包含单个测试。相反，它使用外部程序进行服务和主机检查，这些程序被称为*插件*。基本设备已经包含了一些标准插件，用于最重要的应用场景。超出这些范围的特殊需求，如果你具备基本的编程知识，可以通过编写自己的插件来满足。然而，在投入时间开发这些插件之前，首先值得在网上浏览相关邮件列表，^([[2](#ftn.PREFACE-FN-2)])
    因为在这个领域有活跃的活动。可用的插件很多，尤其是在Nagios Exchange平台，[http://www.nagiosexchange.org/](http://www.nagiosexchange.org/)。
- en: 'A plugin is a simple program—often just a shell script (Bash, Perl, etc.)—that
    gives out one of the four possible conditions: OK, WARNING, CRITICAL, or (with
    operating errors, for example) UNKNOWN.'
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 插件是一个简单的程序——通常是shell脚本（Bash、Perl等）——它提供四种可能的状态之一：OK、WARNING、CRITICAL或（例如，在操作错误的情况下）UNKNOWN。
- en: 'This means that in principle Nagios can test everything that can be measured
    or counted electronically: the temperature and humidity in the server room, the
    amount of rainfall, the presence of persons in a certain room at a time when nobody
    should enter it. There are no limits to this, provided that you can find a way
    of providing measurement data or events as information that can be evaluated by
    computer (for example, with a temperature and humidity sensor, an infrared sensor,
    etc.). Apart from the standard plugins, this book accordingly introduces further
    freely available plugins, such as the use of a plugin to query a temperature and
    humidity sensor in [Chapter 21](../Text/ch21.html "Chapter 21. Monitoring Room
    Temperature and Humidity") from page 505.'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 这意味着在原则上，Nagios可以测试所有可以电子测量或计数的对象：服务器室中的温度和湿度、降雨量、在不应有人进入的某个房间中的人员存在。只要你能找到一种方法提供可以由计算机评估的测量数据或事件作为信息（例如，使用温度和湿度传感器、红外传感器等），就没有限制。除了标准插件外，本书还相应地介绍了其他免费可用的插件，例如在第21章（[Chapter 21](../Text/ch21.html
    "Chapter 21. Monitoring Room Temperature and Humidity")）中，从第505页介绍如何使用插件查询温度和湿度传感器。
- en: '* * *'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[2](#PREFACE-FN-2)]) [http://www.nagios.org/support/mailinglists.php](http://www.nagios.org/support/mailinglists.php)
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[2](#PREFACE-FN-2)]) [http://www.nagios.org/support/mailinglists.php](http://www.nagios.org/support/mailinglists.php)
- en: Keeping admins up-to-date
  id: totrans-20
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 保持管理员信息更新
- en: Nagios possesses a sophisticated notification system. On the sender side (that
    is, with the host or service check) you can configure when each group of persons—the
    so-called *contact groups*—are informed about which conditions or events (failure,
    recovery, warnings, etc.). On the receiver side you can also define on multiple
    levels what is to be done with a corresponding message—for example whether the
    system should forward it, depending on the time of day, or discard the message.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios拥有一个复杂的通知系统。在发送方（即，与主机或服务检查）方面，你可以配置何时通知每个人员组——所谓的*联系人组*——关于哪些条件或事件（故障、恢复、警告等）。在接收方，你还可以在多个级别上定义对相应消息的处理方式——例如，根据一天中的时间，系统是否应该转发它，或者丢弃该消息。
- en: If a specific service is to be monitored seven days a week round the clock,
    this does not mean that the administrator in charge will never be able to take
    a break. For example, you can instruct Nagios to notify the person only from Monday
    to Friday between 8am and 5pm, every two hours at the most. If the administrator
    in charge is not able to solve the problem within a specified period of time,
    eight hours for example, then the head of department responsible should receive
    a message. This process is known as *escalation management*. The corresponding
    configuration is explained in [Chapter 12](../Text/ch12.html "Chapter 12. The
    Nagios Notification System") from page 282.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一个特定服务需要每周七天全天候监控，这并不意味着负责的管理员永远不会休息。例如，您可以指示 Nagios 只在周一至周五上午8点至下午5点之间，每隔两小时通知相关人员。如果负责的管理员在指定的时间内无法解决问题，例如八小时，那么部门负责人应该收到消息。这个过程被称为*升级管理*。相应的配置在[第12章](../Text/ch12.html
    "第12章. Nagios 通知系统"，第282页)中有解释。
- en: Nagios can also make use of freely configurable, external programs for notifications,
    so that you can integrate any system you like, from e-mail to SMS, to a voice
    server that the administrator calls up and receives a voice message concerning
    the error.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 还可以利用自由配置的外部程序进行通知，这样您就可以集成任何喜欢的系统，从电子邮件到短信，甚至是一个管理员可以调用并接收有关错误语音消息的语音服务器。
- en: With its Web interface ([Chapter 16](../Text/ch16.html "Chapter 16. The Classical
    Web Interface") from page 327, Nagios provides the administrator with a wide range
    of information, clearly arranged according to the issues involved. Whether the
    admin needs a summary of the overall situation, a display of problematic services
    and hosts and the causes of network outages, or the status of entire groups of
    hosts or services, Nagios provides an individually structured information page
    for nearly every purpose.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 通过其 Web 接口（[第16章](../Text/ch16.html "第16章. 经典 Web 接口"，第327页），Nagios 为管理员提供了一系列广泛的信息，根据涉及的问题清晰排列。无论是管理员需要整体情况的摘要，还是显示有问题的服务和主机以及网络中断的原因，或者整个主机或服务组的状况，Nagios
    几乎为每个目的都提供了一个结构化的信息页面。
- en: Through the Web front end, an administrator can inform colleagues upon accepting
    a particular problem so that they can concentrate on other issues that have not
    yet been addressed. Information already obtained can be stored as comments on
    hosts and services.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 通过 Web 前端，管理员可以在接受特定问题后通知同事，以便他们可以专注于尚未解决的问题。已经获得的信息可以存储为主机和服务的注释。
- en: By reviewing past events, the Web interface can reveal problems that occurred
    in a selected time interval, who was informed of the problems, and which hosts
    and/or services were affected. Nagios can be configured to recognize scheduled
    downtimes and to prevent false alarms from going off during these periods.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 通过审查过去的事件，Web 接口可以揭示在选定的时间间隔内发生的问题，谁被告知了这些问题，以及哪些主机和/或服务受到影响。Nagios 可以配置为识别计划内的停机时间，并防止在这些期间发出误报。
- en: Taking in information from outside
  id: totrans-27
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从外部获取信息
- en: 'For tests, notifications, and so on, Nagios makes use of external programs,
    but the reverse is also possible: through a separate interface (see [13.1 The
    Interface for External Commands](../Text/ch13.html#the_interface_for_external_commands
    "13.1 The Interface for External Commands") from page 292), independent programs
    can send status information and commands to Nagios. The Web interface makes widespread
    use of this possibility, which allows the administrator to send interactive commands
    to Nagios. But a backup program unknown to Nagios can also transmit a success
    or failure to Nagios, as well as to a syslog daemon. The possibilities are limitless.
    Thanks to this interface, Nagios allows distributed monitoring. This involves
    several decentralized Nagios installations sending their test results to a central
    instance, which then helps to maintain an overview of the situation from a central
    location.'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 对于测试、通知等，Nagios 会使用外部程序，但反过来也是可能的：通过一个单独的接口（见[13.1 外部命令接口](../Text/ch13.html#the_interface_for_external_commands
    "13.1 外部命令接口"，第292页）），独立的程序可以向 Nagios 发送状态信息和命令。Web 接口广泛使用这种可能性，允许管理员向 Nagios
    发送交互式命令。但一个 Nagios 所不知的备份程序也可以向 Nagios 以及一个系统日志守护进程传输成功或失败信息。可能性是无限的。多亏了这个接口，Nagios
    允许分布式监控。这涉及到几个分散的 Nagios 安装将它们的测试结果发送到一个中央实例，然后从这个中央位置帮助维持对情况的总体了解。
- en: Other tools for network monitoring
  id: totrans-29
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 其他网络监控工具
- en: 'Nagios is not the only tool for monitoring systems and networks. The most well-known
    "competitor," perhaps on an equal footing, is *Big Brother* (BB). Despite a number
    of differences, its Web interface serves the same purpose as that of Nagios: displaying
    to the administrator what is in the "green area" and what is not.'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios不是监控系统和网络的唯一工具。最著名的“竞争对手”，也许可以与Nagios平起平坐，是*Big Brother*（BB）。尽管存在许多差异，但其Web界面与Nagios的界面具有相同的目的：向管理员显示“绿色区域”和“非绿色区域”的内容。
- en: 'The reason why the author uses Nagios instead of Big Brother lies in the license
    for Big Brother, on the BB homepage^([[3](#ftn.PREFACE-FN-3)]) called *Better
    Than Free License*: the product continues to be commercially developed and distributed.
    If you use BB and earn money with it, you must buy the software. The fact that
    the software, including the source code, may not be passed on or modified, except
    with the explicit permission of the vendor, means that it cannot be reconciled
    with the criteria for Open Source licenses. This means that Linux distributors
    have their hands tied.'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 作者使用Nagios而不是Big Brother的原因在于Big Brother的许可证，在BB主页上称为*Better Than Free License*：该产品继续进行商业开发和分发。如果你使用BB并通过它赚钱，你必须购买该软件。软件，包括源代码，可能无法传递或修改，除非得到供应商的明确许可，这意味着它与开源许可证的标准不相符。这意味着Linux发行商的手脚被束缚了。
- en: 'For the graphical display of certain measured values over a period of time,
    such as the load on a network interface, CPU load, or the number of mails per
    minute, there are other tools that perform this task better than Nagios. The original
    tool is certainly the *Multi Router Traffic Grapher* MRTG,^([[4](#ftn.PREFACE-FN-4)])
    which, despite growing competition, still enjoys great popularity. A relatively
    young, but very powerful alternative is called Cacti^([[5](#ftn.PREFACE-FN-5)]):
    this has a larger range of applications, can be configured via Web interface,
    and avoids the restrictions in MRTG, which can only display two measured values
    at the same time and cannot display any negative values. Another interesting new
    alternative is Munin.^([[6](#ftn.PREFACE-FN-6)])'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 对于在一段时间内显示某些测量值，如网络接口的负载、CPU负载或每分钟的邮件数量，有其他工具比Nagios做得更好。原始工具无疑是*多路由器流量图生成器*
    MRTG，^([[4](#ftn.PREFACE-FN-4)]），尽管面临越来越多的竞争，但它仍然非常受欢迎。一个相对较新但非常强大的替代品是Cacti^([[5](#ftn.PREFACE-FN-5)]）：它具有更广泛的应用范围，可以通过Web界面进行配置，并避免了MRTG的限制，MRTG只能同时显示两个测量值，并且不能显示任何负值。另一个有趣的新替代品是Munin.^([[6](#ftn.PREFACE-FN-6)])
- en: Nagios itself can also display performance data graphically, using extensions
    ([Chapter 19](../Text/ch19.html "Chapter 19. Graphic Display of Performance Data")
    from page 403). In many cases this is sufficient, but for very dedicated requirements,
    the use of Nagios in tandem with a graphic representation tool such as MRTG or
    Cacti is recommended.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios本身也可以使用扩展（第19章[图形显示性能数据](../Text/ch19.html "第19章。图形显示性能数据"，第403页））以图形方式显示性能数据。在许多情况下，这已经足够了，但对于非常专门的需求，建议使用Nagios与图形表示工具（如MRTG或Cacti）结合使用。
- en: '* * *'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[3](#PREFACE-FN-3)]) [http://www.bb4.org/](http://www.bb4.org/)
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[3](#PREFACE-FN-3)]) [http://www.bb4.org/](http://www.bb4.org/)
- en: ^([[4](#PREFACE-FN-4)]) [http://www.mrtg.org/](http://www.mrtg.org/)
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[4](#PREFACE-FN-4)]) [http://www.mrtg.org/](http://www.mrtg.org/)
- en: ^([[5](#PREFACE-FN-5)]) [http://www.cacti.net/](http://www.cacti.net/)
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[5](#PREFACE-FN-5)]) [http://www.cacti.net/](http://www.cacti.net/)
- en: ^([[6](#PREFACE-FN-6)]) [http://munin.projects.linpro.no/](http://munin.projects.linpro.no/)
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[6](#PREFACE-FN-6)]) [http://munin.projects.linpro.no/](http://munin.projects.linpro.no/)
- en: About This Book
  id: totrans-39
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 关于本书
- en: This book is directed at network administrators who want to find out about the
    condition of their systems and networks using an Open Source tool. It describes
    the Nagios versions 2.x and 3.0\. The plugins, on the other hand, lead their own
    lives, are to a great extent independent of Nagios, and are therefore not restricted
    to a particular version.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 本书面向希望使用开源工具了解其系统和网络状况的网络管理员。它描述了Nagios的2.x和3.0版本。另一方面，插件有自己的生活，在很大程度上独立于Nagios，因此不受特定版本的限制。
- en: Even though this book is based upon using Linux as the operating system for
    the Nagios computer, this is not a requirement. Most descriptions also apply to
    other Unix systems,^([[7](#ftn.PREFACE-FN-7)]) only system-specific details such
    as start scripts need to be adjusted accordingly. Nagios currently does not officially
    work under Windows, however.^([[8](#ftn.PREFACE-FN-8)])
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管本书基于使用Linux作为Nagios计算机的操作系统，但这并不是一个必要条件。大多数描述也适用于其他Unix系统，^([[7](#ftn.PREFACE-FN-7)])只需要相应地调整系统特定的细节，例如启动脚本。然而，Nagios目前尚未在Windows上官方运行.^([[8](#ftn.PREFACE-FN-8)])
- en: The first part of this book deals with getting Nagios up and running with a
    simple configuration, albeit one that is sufficient for many uses, as quickly
    as possible. This is why [Chapter 1](../Text/ch01.html "Chapter 1. Installation")
    through [Chapter 3](../Text/ch03.html "Chapter 3. Startup") do not have detailed
    descriptions and treatments of all options and features. These are examined in
    the second part of the book.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 本书的第一部分主要介绍如何以最简单的方式快速配置Nagios，尽管这种配置对于许多用途来说已经足够，但仍然需要尽快完成。这就是为什么从[第1章](../Text/ch01.html
    "第1章。安装")到[第3章](../Text/ch03.html "第3章。启动")没有对所有选项和功能进行详细描述和处理。这些内容将在书的第二部分进行探讨。
- en: '[Chapter 4](../Text/ch04.html "Chapter 4. Nagios Basics") looks at the details
    of service and host checks, and in particular introduces their dependency on network
    topologies.'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: '[第4章](../Text/ch04.html "第4章。Nagios基础")探讨了服务和主机检查的细节，特别是介绍了它们对网络拓扑的依赖性。'
- en: The options available to Nagios for implementing service checks and obtaining
    their results is described in [Chapter 5](../Text/ch05.html "Chapter 5. Service
    Checks and How They Are Performed").
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: '[第5章](../Text/ch05.html "第5章。服务检查及其执行方式")描述了Nagios实现服务检查和获取其结果的可选方案。'
- en: This is followed by the presentation of individual standard plugins and a number
    of additional, freely obtainable plugins. [Chapter 6](../Text/ch06.html "Chapter 6. Plugins
    for Network Services") takes a look at the plugins that inspect the services of
    a network protocol directly from the Nagios host, while [Chapter 7](../Text/ch07.html
    "Chapter 7. Testing Local Resources") summarizes plugins that need to be installed
    on the machine that is being monitored, and for which Nagios needs additional
    utilities to get them running. Several auxiliary plugins, which do not perform
    any tests themselves, but manipulate already established results, are introduced
    in [Chapter 8](../Text/ch08.html "Chapter 8. Plugins for Special Tasks").
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，本书将介绍个别标准插件以及一些额外可免费获取的插件。[第6章](../Text/ch06.html "第6章。网络服务插件")探讨了直接从Nagios主机检查网络协议服务的插件，而[第7章](../Text/ch07.html
    "第7章。测试本地资源")总结了需要在被监控机器上安装的插件，并且Nagios需要额外的工具来使它们运行。在第[8章](../Text/ch08.html
    "第8章。特殊任务插件")中介绍了几个辅助插件，这些插件本身不执行任何测试，但会操纵已经建立的结果。
- en: Two utilities that Nagios requires to run local plugins on remote hosts are
    introduced in the two subsequent chapters. [Chapter 9](../Text/ch09.html "Chapter 9. Executing
    Plugins via SSH") describes SSH, while [Chapter 10](../Text/ch10.html "Chapter 10. The
    Nagios Remote Plugin Executor (NRPE)") introduces a daemon developed specifically
    for Nagios.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的两个章节中，介绍了Nagios运行远程主机上的本地插件所需的两个工具。[第9章](../Text/ch09.html "第9章。通过SSH执行插件")描述了SSH，而[第10章](../Text/ch10.html
    "第10章。Nagios远程插件执行器（NRPE）")介绍了一个专门为Nagios开发的守护进程。
- en: Wherever networks are being monitored, SNMP also needs to be implemented. [Chapter 11](../Text/ch11.html
    "Chapter 11. Collecting Information Relevant for Monitoring with SNMP") not only
    describes SNMP-capable plugins but also examines the protocol and the SNMP world
    itself in detail, providing the background knowledge needed for this.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 无论在何处监控网络，都需要实现SNMP。[第11章](../Text/ch11.html "第11章。使用SNMP收集与监控相关的信息")不仅描述了具有SNMP功能的插件，而且还详细探讨了协议和SNMP世界本身，提供了进行此操作所需的相关背景知识。
- en: The Nagios notification system is introduced [Chapter 12](../Text/ch12.html
    "Chapter 12. The Nagios Notification System"), which also deals with notification
    using SMS, escalation management, and taking account of dependencies.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '[第12章](../Text/ch12.html "第12章。Nagios通知系统")介绍了Nagios通知系统，同时也涉及了使用短信进行通知、升级管理以及考虑依赖关系。'
- en: The interface for external commands is discussed in [Chapter 13](../Text/ch13.html
    "Chapter 13. Passive Tests with the External Command File"). This forms the basis
    of other Nagios mechanisms, such as the Nagios Service Check Acceptor (NSCA),
    a client-server mechanism for transmitting passive test results, covered in [Chapter 14](../Text/ch14.html
    "Chapter 14. The Nagios Service Check Acceptor (NSCA)"). The use of this is shown
    in two concrete examples—integrating **`syslog-ng`** and processing SNMP traps.
    NSCA is also a requirement for distributed monitoring, discussed in [Chapter 15](../Text/ch15.html
    "Chapter 15. Distributed Monitoring").
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 外部命令的接口在[第13章](../Text/ch13.html "第13章。使用外部命令文件进行被动测试")中进行了讨论。这构成了其他Nagios机制的基础，例如Nagios服务检查接受器（NSCA），一种用于传输被动测试结果的客户端-服务器机制，在第14章[第14章。Nagios服务检查接受器（NSCA）](../Text/ch14.html
    "第14章。Nagios服务检查接受器（NSCA）")中进行了介绍。这种用法在两个具体示例中得到了展示——集成**`syslog-ng`**和处理SNMP陷阱。NSCA也是分布式监控的要求，在第15章[第15章。分布式监控](../Text/ch15.html
    "第15章。分布式监控")中进行了讨论。
- en: The third part of the book is devoted to how the extracted information can be
    represented graphically. [Chapter 16](../Text/ch16.html "Chapter 16. The Classical
    Web Interface") explains how this works and how it is set up in detail, supported
    by some useful screenshots. It also explains a series of parameters, for which
    there are otherwise no documentation at all, except in the source code.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 书的第三部分致力于如何将提取的信息以图形方式表示。第16章[第16章。经典Web界面](../Text/ch16.html "第16章。经典Web界面")详细解释了这是如何工作的以及如何设置，并辅以一些有用的截图。它还解释了一系列参数，这些参数在其他地方几乎没有文档，除了在源代码中。
- en: Nagios can be expanded by adding external applications. The NDOUtils enable
    database-driven storage of all Nagios objects and are described in [Chapter 17](../Text/ch17.html
    "Chapter 17. Flexible Web Interface with the NDOUtils"). Connection to a database,
    using the addon described in [Chapter 18](../Text/ch18.html "Chapter 18. NagVis"),
    enables you to build a Web interface that can be configured far beyond the basic
    range of Nagios.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 通过添加外部应用程序，可以扩展Nagios。NDOUtils允许将所有Nagios对象以数据库驱动的方式存储，并在第17章[第17章。使用NDOUtils的灵活Web界面](../Text/ch17.html
    "第17章。使用NDOUtils的灵活Web界面")中进行了描述。使用第18章[第18章。NagVis](../Text/ch18.html "第18章。NagVis")中描述的附加组件连接到数据库，您就可以构建一个可以配置远超Nagios基本范围的Web界面。
- en: Although in its operation, Nagios concentrates primarily on stoplight signals
    (red-yellow-green), there are ways of evaluating and representing the performance
    data provided by plugins, which are described in detail in [Chapter 19](../Text/ch19.html
    "Chapter 19. Graphic Display of Performance Data").
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管在操作中，Nagios主要关注交通信号灯信号（红-黄-绿），但有一些方法可以评估和表示插件提供的性能数据，这些方法在第19章[第19章。性能数据的图形显示](../Text/ch19.html
    "第19章。性能数据的图形显示")中进行了详细描述。
- en: The fourth part of this book is dedicated to special applications. Networks
    are rarely homogeneous—that is, equipped only with Linux and other Unix-based
    operating systems. For this reason, [Chapter 20](../Text/ch20.html "Chapter 20. Monitoring
    Windows Servers") demonstrates what utilities can be used to integrate and monitor
    Windows systems.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 本书第四部分致力于特殊应用。网络很少是同质的——也就是说，只配备了Linux和其他基于Unix的操作系统。因此，第20章[第20章。监控Windows服务器](../Text/ch20.html
    "第20章。监控Windows服务器")展示了可以用来集成和监控Windows系统的工具。
- en: '[Chapter 21](../Text/ch21.html "Chapter 21. Monitoring Room Temperature and
    Humidity") uses the example of a low-cost hardware sensor to show how room temperature
    and humidity can be monitored simply, yet effectively.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 第21章[第21章。监控室温和湿度](../Text/ch21.html "第21章。监控室温和湿度")使用低成本硬件传感器的例子来展示如何简单而有效地监控室温和湿度。
- en: Nagios can also monitor proprietary commercial software, as long as mechanisms
    are available which can query states of the system integrated into a plugin. In
    [Chapter 22](../Text/ch22.html "Chapter 22. Monitoring SAP Systems"), this is
    described using an SAP-R/3 system.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 只要插件中存在可以查询集成到插件中的系统状态的机制，Nagios也可以监控专有商业软件。在第22章[第22章。监控SAP系统](../Text/ch22.html
    "第22章。监控SAP系统")中，这是使用SAP-R/3系统进行描述的。
- en: Whereas event processing is only briefly outlined in [Chapter 14](../Text/ch14.html
    "Chapter 14. The Nagios Service Check Acceptor (NSCA)"), [Chapter 23](../Text/ch23.html
    "Chapter 23. Processing Events with the EventDB") presents a database-supported
    approach that provides more options for selecting and processing events, including
    interlinking with Nagios.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管事件处理在第14章[第14章。Nagios服务检查接受器（NSCA）](../Text/ch14.html "第14章。Nagios服务检查接受器（NSCA）")中只是简要概述，但在第23章[第23章。使用EventDB处理事件](../Text/ch23.html
    "第23章。使用EventDB处理事件")中介绍了一种数据库支持的方法，它提供了更多选择来选择和处理事件，包括与Nagios的互连。
- en: Building your own plugins is the subject of the fifth part of this book. [Chapter 24](../Text/ch24.html
    "Chapter 24. Writing Your Own Plugins") looks at the general requirements for
    a standard plugin, while [Chapter 25](../Text/ch25.html "Chapter 25. Determining
    File and Directory Sizes") uses a step-by-step example of how to write your own
    plugins that are fit for publishing. [Chapter 26](../Text/ch26.html "Chapter 26. Monitoring
    Oracle with the Instant Client") takes an example of the Instant Client of Oracle
    to demonstrate how to build your own plugins based on programs not really intended
    for this purpose.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 本书第五部分探讨了构建自己的插件。第24章[编写自己的插件](../Text/ch24.html "第24章. 编写自己的插件")探讨了标准插件的一般要求，而第25章[确定文件和目录大小](../Text/ch25.html
    "第25章. 确定文件和目录大小")则通过一个逐步示例展示了如何编写适合发布的自己的插件。[第26章](../Text/ch26.html "第26章. 使用即时客户端监控Oracle")以Oracle的即时客户端为例，演示了如何基于并非真正为此目的而设计的程序构建自己的插件。
- en: '[Appendix A](../Text/apa.html "Appendix A. An Overview of the Nagios Configuration
    Parameters") introduces all the parameters of the two central configuration files
    **`nagios.cfg`** and **`cgi.cfg`**, while [Appendix B](../Text/apb.html "Appendix B. Rapidly
    Alternating States: Flapping") and [Appendix C](../Text/apc.html "Appendix C. Event
    Handlers") are devoted to some useful but somewhat exotic features.'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '[附录A](../Text/apa.html "附录A. Nagios配置参数概述")介绍了两个核心配置文件**`nagios.cfg`**和**`cgi.cfg`**的所有参数，而[附录B](../Text/apb.html
    "附录B. 快速交替状态：摆动状态")和[附录C](../Text/apc.html "附录C. 事件处理器")则专注于一些有用但相对罕见的特性。'
- en: A separate appendix ([Appendix D](../Text/apd.html "Appendix D. Macros")) is
    devoted to *macros*, which allow flexibility in configuration.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 专门的附录[附录D](../Text/apd.html "附录D. 宏")专注于*宏*，它允许在配置中具有灵活性。
- en: '[Appendix E](../Text/ape.html "Appendix E. Single Sign-On for the Nagios Web
    Interface") wanders slightly away from the core topic of Nagios and demonstrates
    how single sign-on scenarios can also be used for authentication in the Nagios
    Web interface.'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: '[附录E](../Text/ape.html "附录E. Nagios Web界面的单点登录")略有偏离Nagios的核心主题，并演示了单点登录场景也可以用于Nagios
    Web界面的认证。'
- en: The larger the environment, the more important it is to have a powerful and
    quick-reacting Nagios system. [Appendix F](../Text/apf.html "Appendix F. Tips
    on Optimizing Performance") offers a series suggestions on this, while [Appendix G](../Text/apg.html
    "Appendix G. The Embedded Perl Interpreter") is dedicated to a specific tool,
    the Perl interpreter integrated into Nagios.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 环境越大，拥有一个强大且反应迅速的Nagios系统就越重要。[附录F](../Text/apf.html "附录F. 优化性能的技巧")提供了一系列建议，而[附录G](../Text/apg.html
    "附录G. 集成到Nagios中的Perl解释器")则专注于一个特定的工具，即集成到Nagios中的Perl解释器。
- en: Finally, [Appendix H](../Text/aph.html "Appendix H. What's New in Nagios 3.0?")
    briefly summarizes all the changes made since Nagios 2.x
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，[附录H](../Text/aph.html "附录H. Nagios 3.0的新特性")简要总结了自Nagios 2.x以来所做的所有更改。
- en: '* * *'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[7](#PREFACE-FN-7)]) For example, *BSD, HP-UX, AIX, and Solaris; the author
    does not know of any Nagios versions running under MacOS X.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[7](#PREFACE-FN-7)]) 例如，*BSD、HP-UX、AIX和Solaris；作者不知道有任何Nagios版本在MacOS X上运行。
- en: ^([[8](#PREFACE-FN-8)]) There are, however, rumors about Nagios running in Cygwin
    environments.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[8](#PREFACE-FN-8)]) 然而，关于Nagios在Cygwin环境中运行的传闻。
- en: Further notes on the book
  id: totrans-66
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 关于本书的进一步说明
- en: At the time of going to press, Nagios 3.0 is close to completion. By the time
    this book reaches the market, there could well be some modifications. Relevant
    notes, as well as corrections, in case some errors have slipped into the book,
    can be found at [http://linux.swobspace.net/books/nagios/](http://linux.swobspace.net/books/nagios/).
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书付印时，Nagios 3.0即将完成。到本书上市时，可能会有一些修改。有关修改的笔记，以及可能出现的错误，可以在[http://linux.swobspace.net/books/nagios/](http://linux.swobspace.net/books/nagios/)找到。
- en: Note of Thanks
  id: totrans-68
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 感谢信
- en: Many people have contributed to the success of this book. My thanks go first
    of all to Dr. Markus Wirtz, who initiated this book with his comment, "Why don't
    you write a Nagios book, then?!", when he refused to accept my Nagios activities
    as an excuse for delays in writing another book. A very special thanks goes to
    Patricia Jung, who, as the technical editor for the German language version, overhauled
    the manuscript and pestered me with thousands of questions—which was a good thing
    for the completeness of the book, and which has ultimately made it easier for
    the reader to understand.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 许多人为本书的成功做出了贡献。首先我要感谢Dr. Markus Wirtz，是他以评论“那你为什么不写一本Nagios的书呢？！”来启动这本书，当时他拒绝接受我的Nagios活动作为推迟写另一本书的借口。特别感谢Patricia
    Jung，作为德语版的技术编辑，她彻底重写了手稿，并不断地用成千上万的问题来打扰我——这对书的完整性是有好处的，并且最终使读者更容易理解。
- en: 'The book would not be possible, of course, without all the tools it describes.
    Very special thanks go to Ethan Galstad, who as author, developer and maintainer
    has made Nagios what it is today: an awesome, incredibly useful and helpful tool
    that also fulfills high-level requirements, and one that can rely on a very large—and
    above all very active— community. Also many thanks to Ton Voon, representing all
    members of the *Nagios Plugins Development Team*, who, together with his colleagues,
    manages the development of Nagios plugins.'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，没有书中描述的所有工具，这本书也是不可能完成的。特别感谢Ethan Galstad，作为作者、开发者和维护者，他使Nagios成为今天的样子：一个令人敬畏的、极其有用和有帮助的工具，它也满足了高级要求，并且可以依赖一个非常庞大——更重要的是非常活跃——的社区。还要感谢Ton
    Voon，他代表所有*Nagios插件开发团队*的成员，他与同事们一起管理Nagios插件的开发。
- en: 'My thanks also go to those who have not only developed the Nagios-related software
    introduced in this book, but have also helped to polish and improve the book with
    their proofreading and feedback: Matthias Flacke (of **`check_multi`** fame),
    Jörg Linge (PNP), and Steffen Waitz, who proofread the first edition, Hendrik
    Bäcker (**`npcd`**), Lars Michelsen, Michael Luebben (NagVis), Gerhard Laußer
    (**`check_logfiles`**), and the employees of NETWAYS GmbH (NagiosGrapher, EventDB,
    the exchange platform, NagiosExchange).'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 我也要感谢那些不仅开发了本书中介绍的所有Nagios相关软件，还通过校对和反馈帮助润色和改进本书的人：Matthias Flacke（以**`check_multi`**闻名），Jörg
    Linge（PNP），以及Steffen Waitz，他校对了第一版，Hendrik Bäcker（**`npcd`**），Lars Michelsen，Michael
    Luebben（NagVis），Gerhard Laußer（**`check_logfiles`**），以及NETWAYS GmbH的员工（NagiosGrapher，EventDB，交流平台，NagiosExchange）。
- en: It is not possible for me to name all the individuals who have contributed in
    one way or another to the success of Nagios. I would therefore like to thank everybody
    who actively supports the Nagios community, whether this is through free software
    or through involvement in forums and mailing lists. Where would Nagios be without
    its users?
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 我无法列出所有以某种方式为Nagios成功做出贡献的个人。因此，我要感谢所有积极支持Nagios社区的人，无论是通过免费软件还是通过参与论坛和邮件列表。没有用户，Nagios会是什么样子？
