<html><head></head><body>

<div class="calibre1"><div class="calibre1"><a name="spamassassin_3.2.4" class="calibre8" id="spamassassin_3.2.4"/>
<div class="calibre24" id="calibre_pb_0"/><h2 id="title-ID0EVZAO" class="docPrefaceTitle">Chapter 28. SPAMASSASSIN 3.2.4</h2>
<h4 class="calibre32"><a class="calibre2" target="_blank" href="HTTP://SPAMASSASSIN.APACHE.ORG">HTTP://SPAMASSASSIN.APACHE.ORG</a></h4>
<a name="summary-id27" class="calibre8" id="summary-id27"/>
<h3 class="docSection1Title" id="-100000">28.1. SUMMARY</h3>
<p class="docText1"><a name="SpamAssassin is" class="calibre8" id="SpamAssassin is"/>SpamAssassin is a highly effective open source email classifier. It is designed to examine email using a diverse set of tests to determine if a message is spam. Messages are scored using keywords, historical data (e.g., Bayesian filtering), and fingerprinting methods (e.g., Vipul's Razor and DCC databases) to maximize effectiveness by leveraging the benefits of each type of test. SpamAssassin stores the results of these tests in each email's header. Mail Delivery Agents (MDA) like Procmail (see "<a class="calibre2" href="procmail_3.22.html#procmail_3.22">Procmail 3.22</a><a name="these headers" class="calibre8" id="these headers"/>") can use these headers to route or perform further processing of the message.<a name="IDX-CHP-28-0424" class="calibre8" id="IDX-CHP-28-0424"/><a name="IDX-CHP-28-0425" class="calibre8" id="IDX-CHP-28-0425"/><a name="IDX-CHP-28-0426" class="calibre8" id="IDX-CHP-28-0426"/><a name="IDX-CHP-28-0427" class="calibre8" id="IDX-CHP-28-0427"/><a name="IDX-CHP-28-0428" class="calibre8" id="IDX-CHP-28-0428"/><a name="IDX-CHP-28-0429" class="calibre8" id="IDX-CHP-28-0429"/><a name="IDX-CHP-28-0430" class="calibre8" id="IDX-CHP-28-0430"/></p>
<p class="docText1"><a name="daemon or" class="calibre8" id="daemon or"/>Typically, SpamAssassin is invoked as a daemon or background process. A mail transfer agent like Postfix is configured to pipe email through SpamAssassin for analysis. If a message is determined to be spam, SpamAssassin can be configured to modify the message in a number of ways. By default, spam is re-encoded as an attachment and the body of the message displays the list of tests that triggered the positive result. Spam and <span class="docEmphasis1">ham</span><a name="delivered to" class="calibre8" id="delivered to"/> (legitimate email) are then delivered to users' mailboxes.</p>
<p class="docText1"><a name="packages incorporate" class="calibre8" id="packages incorporate"/>Many commercially available anti-spam packages incorporate SpamAssassin in their products. These include SpamKiller by McAfee, Kerio MailServer by Kerio, and SmarterMail by SmarterTools.</p>
<p class="docText1"><a name="is based" class="calibre8" id="is based"/>SpamAssassin was written in 2001 by Justin Mason, an Irish software developer. It is based on filter.plx, a spam filter written in Perl by Mark Jeftovic in 1997. Justin contributed patches to Jeftovic's filter.plx and later decided to rewrite the code (also in Perl) from scratch. This recode became SpamAssassin and is now a project of the Apache Software Foundation. Mason currently directs SpamAssassin development as a vice president of the Apache Software Foundation.</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="resources-id27" class="calibre8" id="resources-id27"/>
<h3 class="docSection1Title" id="-100000">28.2. RESOURCES</h3>
<p class="docText1"><span class="b"><a name="Official SpamAssassin" class="calibre8" id="Official SpamAssassin"/>Official SpamAssassin Documentation</span></p>
<p class="docText1"><a class="calibre2" target="_blank" href="http://spamassassin.apache.org/doc.html">http://spamassassin.apache.org/doc.html</a></p>
<p class="docText1"><span class="b"><a name="Descriptions and" class="calibre8" id="Descriptions and"/>SpamAssassin Test Descriptions and Scores</span></p>
<p class="docText1"><a class="calibre2" target="_blank" href="http://spamassassin.apache.org/tests_3_2_x.html">http://spamassassin.apache.org/tests_3_2_x.html</a></p>
<p class="docText1"><span class="b">SpamAssassin Rules Emporium</span></p>
<p class="docText1"><a class="calibre2" target="_blank" href="http://www.rulesemporium.com">http://www.rulesemporium.com</a></p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="required-id27" class="calibre8" id="required-id27"/>
<h3 class="docSection1Title" id="-100000">28.3. REQUIRED</h3>
<p class="docText1"><img border="0" id="" src="N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg" alt="" class="calibre33"/><a name="FreeBSD " class="calibre8" id="FreeBSD "/> FreeBSD 7.0-RELEASE (see "<a class="calibre2" href="freebsd_7.0_split_000.html#freebsd_7.0">FreeBSD 7.0</a>")</p>
<p class="docText1"><img border="0" id="" src="N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg" alt="" class="calibre33"/><a name="collection " class="calibre8" id="collection "/> Updated ports collection (see "<a class="calibre2" href="freebsd_ports_collection.html#freebsd_ports_collection">FreeBSD Ports Collection</a>")</p>
<p class="docText1"><img border="0" id="" src="N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg" alt="" class="calibre33"/> Postfix SMTP server (see "<a class="calibre2" href="postfix_smtp_server_2.5.1.html#postfix_smtp_server_2.5.1">Postfix SMTP Server 2.5.1</a>")</p>
<p class="docText1"><img border="0" id="" src="N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg" alt="" class="calibre33"/> Internet connection</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="preparation-id27" class="calibre8" id="preparation-id27"/>
<h3 class="docSection1Title" id="-100000">28.4. PREPARATION</h3>
<p class="docText1"><a name="Become the" class="calibre8" id="Become the"/>Become the superuser.<a name="IDX-CHP-28-0431" class="calibre8" id="IDX-CHP-28-0431"/><a name="IDX-CHP-28-0432" class="calibre8" id="IDX-CHP-28-0432"/><a name="IDX-CHP-28-0433" class="calibre8" id="IDX-CHP-28-0433"/></p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="install-id27" class="calibre8" id="install-id27"/>
<h3 class="docSection1Title" id="-100000">28.5. INSTALL</h3>
<p class="docText1"><a name="Install SpamAssassin" class="calibre8" id="Install SpamAssassin"/>Install SpamAssassin and support for DCC tests.</p>
<hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> <span class="docEmphasis1">DCC (Distributed Checksum Clearinghouse)</span> is a method of sharing centralized email fingerprints with a community similar to Vipul's Razor and Pyzor. It is protected by a patent owned by Commtouch Software Ltd. and is free to use for non-commercial applications. If you agree to the terms of the license, you may install DCC as detailed below; if not, omit <tt class="calibre20"><i class="docEmphasis1">-D WITH_DCC</i></tt> in step 1. The license agreement can be found at <a class="calibre2" target="_blank" href="http://www.rhyolite.com/anti-spam/dcc">http://www.rhyolite.com/anti-spam/dcc</a>.<a name="IDX-CHP-28-0434" class="calibre8" id="IDX-CHP-28-0434"/></span><hr size="1" noshade="noshade" class="calibre27"/>
<div class="calibre34"><ol class="docList" type="1"><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="following commands" class="calibre8" id="following commands"/>Enter the following commands to begin the installation of SpamAssassin:</p><pre class="calibre30"># <b class="calibre28">cd /usr/ports/mail/p5-Mail-SpamAssassin</b>
# <b class="calibre28">make config ; make -D WITH_DCC install clean</b>
# <b class="calibre28">rehash</b></pre>
<p class="docText1"><a name="should appear" class="calibre8" id="should appear"/>A menu with options for p5-Mail-SpamAssassin should appear. Scroll down to DKIM and press [spacebar] to enable DomainKeys support. Continue down to SPF_QUERY and press [spacebar] to enable SPF query support as well. We'll leave the other options at their defaults. Press [tab] to select <span class="b">OK</span><a name="press " class="calibre8" id="press "/> and then press [enter] to begin the build process.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="commands to" class="calibre8" id="commands to"/>Enter the following commands to install support for DCC tests:</p><pre class="calibre30"># <b class="calibre28">cd /usr/ports/mail/dcc-dccd</b>
# <b class="calibre28">make config ; make -D WITHOUT_SENDMAIL install clean</b>
# <b class="calibre28">rehash</b></pre><br class="calibre1"/>
</div></li></ol></div>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="configure-id27" class="calibre8" id="configure-id27"/>
<h3 class="docSection1Title" id="-100000">28.6. CONFIGURE</h3>
<p class="docText1"><a name="Once the" class="calibre8" id="Once the"/>Once the installation process completes, it is time to configure SpamAssassin for use on your system.</p>
<div class="calibre34"><ol class="docList" type="1"><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="two community" class="calibre8" id="two community"/>Set up two community-based email fingerprinting tests, Vipul's Razor and DCC. These spam identification systems vary slightly, but both rely on community input to keep their databases current as spam evolves. Vipul's Razor and DCC employ a web-of-trust scheme to give more weight to clients that accurately report spam.</p><p class="docText1"><a name="create the" class="calibre8" id="create the"/>To set up Vipul's Razor reporting capabilities, create the default configuration file and directory structure and register an identity with the Razor Nomination Servers as follows (substitute your domain name for <a class="calibre2" target="_blank" href="http://example.com">example.com</a>):</p><pre class="calibre30"># <b class="calibre28">razor-admin -home=/var/spool/spamd/.razor -create</b>
# <b class="calibre28">razor-admin -home=/var/spool/spamd/.razor\</b>
? <b class="calibre28">-register -user=postmaster@</b><span class="docEmphBoldItalic">example.com</span>
# <b class="calibre28">chown -R spamd /var/spool/spamd/.razor</b></pre>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="configuration file" class="calibre8" id="configuration file"/>Create SpamAssassin's primary configuration file, <span class="docEmphasis1">local.cf</span>:</p><pre class="calibre30"># <b class="calibre28">cd /usr/local/etc/mail/spamassassin</b>
# <b class="calibre28">ee local.cf</b></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="lines " class="calibre8" id="lines "/>Add the following lines (replace the italicized items with values that match your network):</p><pre class="calibre30">trusted_networks <tt class="calibre20"><i class="docEmphasis1">192.168.1. 209.85.146.176/29 204.13.250.97</i></tt>
internal_networks <tt class="calibre20"><i class="docEmphasis1">192.168.1.11 204.13.250.97</i></tt>
bayes_file_mode 0770
dns_available yes
razor_config /var/spool/spamd/.razor/razor-agent.conf
add_header all DCC _DCCB_ _DCCR_
add_header ham SCL 1
add_header spam SCL 9</pre><br class="calibre1"/>
<p class="docText1"><tt class="calibre20">trusted_networks</tt><a name="relay spam" class="calibre8" id="relay spam"/> specifies an IP or range of IPs for systems that don't relay spam. In other words, you are confident that these computers aren't compromised and the people using them aren't spammers. In the example above you are vouching for your internal network of 192.168.1.<span class="docEmphasis1">xxx</span><a name="the backup" class="calibre8" id="the backup"/>, 209.85.146.176-182 (Gmail's outbound mail servers), and 204.13.250.97 (this could be the backup mail server/exchanger for your domain). These IPs will be exempt from DNS blacklist checks.</p><p class="docText1"><tt class="calibre20">internal_networks</tt><a name="handle mail" class="calibre8" id="handle mail"/> specifies an IP or range of IPs for systems that handle mail for your domain. In general, you should specify your domain's mail servers/exchangers here. In the example above we are saying that 192.168.1.11 and 204.13.250.97 handle mail delivery for our domain. All values of <tt class="calibre20">internal_networks</tt><a name="the" class="calibre8" id="the"/> must also be present in the <tt class="calibre20">trusted_networks</tt> statement.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Save, exit, and test for configuration file syntax errors:</p><pre class="calibre30"># <b class="calibre28">spamassassin --lint</b></pre><br class="calibre1"/>
<p class="docText1"><a name="be displayed" class="calibre8" id="be displayed"/>If your configuration file parsed successfully, no message will be displayed.</p><hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> For further information on the <span class="docEmphasis1">local.cf</span> file, enter:</span><hr size="1" noshade="noshade" class="calibre27"/><pre class="calibre30"># <b class="calibre28">perldoc Mail::SpamAssassin::Conf</b></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="Create a" class="calibre8" id="Create a"/>Create a short script to be called by Postfix when new email arrives. This script will send the email to SpamAssassin for analysis and then redirect the result back into the mail system for delivery. Create the script:</p><pre class="calibre30"># <b class="calibre28">cd /usr/local/bin</b>
# <b class="calibre28">touch spamd.sh</b>
# <b class="calibre28">chmod 555 spamd.sh</b>
# <b class="calibre28">ee spamd.sh</b></pre><br class="calibre1"/>
<p class="docText1"><a name="these lines" class="calibre8" id="these lines"/>and add these lines:</p><pre class="calibre30">#! /bin/sh
/usr/local/bin/spamc | /usr/sbin/sendmail -i "$@"</pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="email messages" class="calibre8" id="email messages"/>Configure Postfix to pipe new email messages through the script you just created. First, open the Postfix configuration file, <span class="docEmphasis1">master.cf</span>:</p><pre class="calibre30"># <b class="calibre28">ee /usr/local/etc/postfix/master.cf</b></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="and find" class="calibre8" id="and find"/>Scroll down and find the <tt class="calibre20">smtp</tt><a name="new line" class="calibre8" id="new line"/> declaration (~9). Create a new line under the <tt class="calibre20">smtp</tt> declaration and add a <tt class="calibre20">content_filter</tt> statement. The <tt class="calibre20">smtp</tt> declaration should look like this:</p><pre class="calibre30">smtp      inet  n       -       n       -       -       smtpd
<b class="calibre28">  -o content_filter=spamd:</b></pre><br class="calibre1"/>
<hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> Be sure to leave at least one space at the beginning of the second line as shown or Postfix will not parse the file correctly.</span><hr size="1" noshade="noshade" class="calibre27"/></div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Add a <tt class="calibre20">spamd</tt> declaration to tell Postfix to call on the <span class="docEmphasis1">spamd.sh</span><a name="of" class="calibre8" id="of"/> script so SpamAssassin can process the message. Scroll to the bottom of <span class="docEmphasis1">master.cf</span> and add these two lines:</p><pre class="calibre30">spamd      unix    -       n       n       -       -       pipe
  flags=Rq user=spamd argv=/usr/local/bin/spamd.sh
  -f ${sender} -- ${recipient}</pre><br class="calibre1"/>
<hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> Again, be sure to leave at least one space at the beginning of the second and third lines so Postfix will parse the file correctly.</span><hr size="1" noshade="noshade" class="calibre27"/></div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Save, exit, and reload the Postfix configuration files:</p><pre class="calibre30"># <b class="calibre28">postfix reload</b></pre><br class="calibre1"/>
</div></li></ol></div>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="testing-id18" class="calibre8" id="testing-id18"/>
<h3 class="docSection1Title" id="-100000">28.7. TESTING</h3>
<p class="docText1"><a name="In this" class="calibre8" id="In this"/>In this section, we'll perform some basic tests to confirm that SpamAssassin is being called by Postfix and processing messages correctly.<a name="IDX-CHP-28-0435" class="calibre8" id="IDX-CHP-28-0435"/><a name="IDX-CHP-28-0436" class="calibre8" id="IDX-CHP-28-0436"/></p>
<div class="calibre34"><ol class="docList" type="1"><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="to start" class="calibre8" id="to start"/>Configure SpamAssassin to start automatically at system startup. Open <span class="docEmphasis1">rc.conf</span>:</p><pre class="calibre30"># <b class="calibre28">ee /etc/rc.conf</b></pre>
<p class="docText1">and add the following lines:</p><pre class="calibre30">spamd_enable="YES"
spamd_flags="-u spamd -H /var/spool/spamd"</pre><br class="calibre1"/>
<p class="docText1">Save and exit.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="it will" class="calibre8" id="it will"/>Start the SpamAssassin daemon so it will answer requests submitted by Postfix:</p><pre class="calibre30"># <b class="calibre28">/usr/local/etc/rc.d/sa-spamd start</b></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="test spam" class="calibre8" id="test spam"/>Send a test spam message into the mail system. First, open a telnet connection:</p><pre class="calibre30"># <b class="calibre28">telnet localhost 25 </b>

Connected to localhost.
Escape character is '^]'.
220 <i class="docEmphasis1">host.example.com </i> ESMTP Postfix</pre><br class="calibre1"/>
<hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> Your hostname should appear instead of <a class="calibre2" target="_blank" href="http://host.example.com">host.example.com</a>.</span><hr size="1" noshade="noshade" class="calibre27"/><p class="docText1"><a name="your domain" class="calibre8" id="your domain"/>Enter the following (substituting your domain for <a class="calibre2" target="_blank" href="http://example.com">example.com</a>):</p><pre class="calibre30"><b class="calibre28">mail from: test@</b><span class="docEmphBoldItalic">example.com</span>
250 Ok
<b class="calibre28">rcpt to: spamd@</b><span class="docEmphBoldItalic">example.com</span>
250 Ok</pre><br class="calibre1"/>
<p class="docText1">Then enter the following lines as shown, pressing [enter] after each line.</p><hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> The long string below is known as the <span class="docEmphasis1">GTUBE (Generic Test for Unsolicited Bulk Email)</span>. It will cause SpamAssassin to flag the message as spam.<a name="IDX-CHP-28-0437" class="calibre8" id="IDX-CHP-28-0437"/></span><hr size="1" noshade="noshade" class="calibre27"/><pre class="calibre30"><b class="calibre28">data </b>
354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
<b class="calibre28">Subject: This is Spam </b>
<b class="calibre28">XJS*C4JDBQADN1.NSBN3*2IDNEN*GTUBE-STANDARD-ANTI-UBE-TEST-EMAIL*C.34X </b>
<b class="calibre28">. </b>
250 Ok: queued as <i class="docEmphasis1">1242EC119 </i></pre><br class="calibre1"/>
<hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> The italicized ID tag will be different in your output.</span><hr size="1" noshade="noshade" class="calibre27"/><p class="docText1">Finally, close the connection:</p><pre class="calibre30"><b class="calibre28">quit</b></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Display the contents of spamd's mailbox:</p><pre class="calibre30"># <b class="calibre28">cd /var/spool/spamd/Maildir/new</b>
# <b class="calibre28">cat * | more</b></pre><br class="calibre1"/>
</div></li></ol></div>
<p class="docText1"><a name="to this" class="calibre8" id="to this"/>If SpamAssassin processed the message successfully, you should see output similar to this:</p>
<div class="calibre1">
              Code View:</div><pre class="calibre30">Return-Path: &lt;test@example.com&gt;
X-Original-To: spamd@example.com
Delivered-To: spamd@example.com
Received: by host.example.com (Postfix, from userid 58)
        id 590631171D; Sat, 01 Mar 2008 12:00:04 -0700 (PDT)
Received: from localhost by host.example.com
        with SpamAssassin (version 3.2.4);
        Sat, 01 Mar 2008 12:00:04 -0700
From: test@example.com
To: undisclosed-recipients:;
Subject: This is Spam
Date: Sat, 01 Mar 2008 11:59:37 -0700 (PDT)
Message-Id: &lt;20070630185947.811351171B@host.example.com&gt;
<tt class="calibre20"><i class="docEmphasis1">X-Spam-DCC:  host.example.com 1049; Body=many Fuz1=many</i></tt>
<tt class="calibre20"><i class="docEmphasis1">X-Spam-Flag: YES</i></tt>
<tt class="calibre20"><i class="docEmphasis1">X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-03-01) on host.example.com</i></tt>
<tt class="calibre20"><i class="docEmphasis1">X-Spam-Level: **************************************************</i></tt>
<tt class="calibre20"><i class="docEmphasis1">X-Spam-Status: Yes, score=1007.0 required=5.0
tests=ALL_TRUSTED,AWL,DCC_CHECK,
DIGEST_MULTIPLE,DKIM_POLICY_SIGNSOME,DNS_FROM_AHBL_RHSBL,DNS_FROM_RFC_DSN,
DNS_FROM_SECURITYSAGE,GTUBE,RAZOR2_CF_RANGE_51_100,RAZOR2_CF_RANGE_E4_51_100,</i></tt>
<tt class="calibre20"><i class="docEmphasis1">RAZOR2_CHECK autolearn=no version=3.2.4</i></tt>
MIME-Version: 1.0

					  </pre><br class="calibre1"/>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="utilities-id10" class="calibre8" id="utilities-id10"/>
<h3 class="docSection1Title" id="-100000">28.8. UTILITIES</h3>
<p class="docText1"><a name="Following is" class="calibre8" id="Following is"/>Following is brief information on the <tt class="calibre20">sa-update</tt> and <tt class="calibre20">sa-learn</tt> commands.<a name="IDX-CHP-28-0438" class="calibre8" id="IDX-CHP-28-0438"/></p>
<a name="sa-update" class="calibre8" id="sa-update"/>
<h4 id="title-ID0E63AO" class="docSection1Title">28.8.1. SA-UPDATE</h4>
<p class="docText1"><a name="downloads and" class="calibre8" id="downloads and"/>This utility downloads and installs updates and/or custom rules for SpamAssassin.</p>
<dl class="docList1">
<dt class="calibre1"><p class="calibre23"><span class="docPubcolor"><span class="b">Command</span></span></p></dt>
<dd class="calibre36"><p class="docText1"><tt class="calibre20">sa-update</tt></p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"><span class="b">Syntax</span></span></p></dt>
<dd class="calibre36"><p class="docText1"><tt class="calibre20">sa-update</tt> <tt class="calibre20"><i class="docEmphasis1">options</i></tt></p></dd>
</dl>
<p class="docText1"><span class="b">Options</span></p>
<dl class="docList1">
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">--channel</pre></p></dt>
<dd class="calibre36"><p class="docText1"><a name="specified channel" class="calibre8" id="specified channel"/>Retrieve rule updates from a specified channel.</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">--nogpg</pre></p></dt>
<dd class="calibre36"><p class="docText1"><a name="use GPG" class="calibre8" id="use GPG"/>Do not use GPG (GNU Privacy Guard) to ensure authenticity.</p></dd>
</dl>
<p class="docText1"><span class="b">Examples</span></p>
<p class="docText1">To update SpamAssassin's default ruleset:</p>
<pre class="calibre30"># <b class="calibre28">sa-update</b>
# <b class="calibre28">/usr/local/etc/rc.d/sa-spamd restart</b></pre><br class="calibre1"/>
<p class="docText1"><a name="ruleset that" class="calibre8" id="ruleset that"/>To install a ruleset that specializes in catching adult-oriented spam:</p>
<pre class="calibre30"># <b class="calibre28">sa-update</b>
# <b class="calibre28">sa-update --channel</b> <span class="docEmphBoldItalic">70_sare_adult.cf.sare.sa-update.dostech.net</span> <b class="calibre28">--nogpg</b>
# <b class="calibre28">/usr/local/etc/rc.d/sa-spamd restart</b></pre><br class="calibre1"/>
<p class="docText1">The channel in italics is from:</p>
<p class="docText1"><span class="b">List of channels</span></p>
<p class="docText1"><a class="calibre2" target="_blank" href="http://wiki.apache.org/spamassassin/SareChannels">http://wiki.apache.org/spamassassin/SareChannels</a></p>
<p class="docText1"><span class="b">Channel information</span></p>
<p class="docText1"><a class="calibre2" target="_blank" href="http://www.rulesemporium.com/rules.htm">http://www.rulesemporium.com/rules.htm</a></p>
<a name="sa-learn" class="calibre8" id="sa-learn"/>
<h4 id="title-ID0EOABO" class="docSection1Title">28.8.2. sa-learn</h4>
<p class="docText1"><a name="and ham" class="calibre8" id="and ham"/>This utility helps the Bayesian classifier learn characteristics of spam and ham. Bayesian classification is based on word probabilities and can be highly effective if trained properly.</p>
<a name="IDX-CHP-28-0439" class="calibre8" id="IDX-CHP-28-0439"/><dl class="docList1">
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"><span class="b">Command</span></span></p></dt>
<dd class="calibre36"><p class="docText1"><tt class="calibre20">sa-learn</tt><a name="IDX-CHP-28-0439" class="calibre8" id="IDX-CHP-28-0439"/></p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"><span class="b">Syntax</span></span></p></dt>
<dd class="calibre36"><p class="docText1"><tt class="calibre20">sa-learn</tt> <tt class="calibre20"><i class="docEmphasis1">options</i></tt> <tt class="calibre20"><i class="docEmphasis1">file</i></tt></p></dd>
</dl>
<p class="docText1"><span class="b">Options</span></p>
<dl class="docList1">
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">--ham</pre></p></dt>
<dd class="calibre36"><p class="docText1">Learn messages as ham (not spam).</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">--spam</pre></p></dt>
<dd class="calibre36"><p class="docText1">Learn messages as spam.</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">--dbpath</pre></p></dt>
<dd class="calibre36"><p class="docText1"><a name="Bayes database" class="calibre8" id="Bayes database"/>Specify the location of the Bayes database files.</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">--progress</pre></p></dt>
<dd class="calibre36"><p class="docText1">Show progress using a progress bar.</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">--dump</pre></p></dt>
<dd class="calibre36"><p class="docText1">Display contents of the Bayes database.</p></dd>
</dl>
<p class="docText1"><span class="b">Examples</span></p>
<p class="docText1"><a name="are spam" class="calibre8" id="are spam"/>To teach SpamAssassin that all messages in the current directory are spam:</p>
<pre class="calibre30"># <b class="calibre28">sa-learn --spam * --progress --dbpath /var/spool/spamd/.spamassassin</b></pre><br class="calibre1"/>
<p class="docText1"><a name="messages in" class="calibre8" id="messages in"/>To teach SpamAssassin that all messages in the <span class="docEmphasis1">/usr/home/john/Maildir/cur</span> directory are ham:</p>
<pre class="calibre30"># <b class="calibre28">sa-learn --ham /usr/home/john/Maildir/cur --progress \</b>?
<b class="calibre28">--dbpath /var/spool/spamd/.spamassassin</b></pre><br class="calibre1"/>
<p class="docText1">To show a content summary of the Bayes database:</p>
<pre class="calibre30"># <b class="calibre28">sa-learn --dump magic --dbpath /var/spool/spamd/.spamassassin</b></pre><br class="calibre1"/>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="config_files-id27" class="calibre8" id="config_files-id27"/>
<h3 class="docSection1Title" id="-100000">28.9. CONFIG FILES</h3>
<p class="docText1"><a name="Use the" class="calibre8" id="Use the"/>Use the following files to customize SpamAssassin's configuration:<a name="IDX-CHP-28-0440" class="calibre8" id="IDX-CHP-28-0440"/></p>
<p class="docText1"><span class="b">/usr/local/etc/mail/spamassassin/local.cf</span></p>
<p class="docText1">SpamAssassin's main configuration file</p>
<p class="docText1"><span class="b">/usr/local/etc/mail/spamassassin/init.pre</span></p>
<p class="docText1"><a name="file for" class="calibre8" id="file for"/>The plug-in configuration file for 3.0.<span class="docEmphasis1">x</span> releases</p>
<p class="docText1"><span class="b">/usr/local/etc/mail/spamassassin/v310.pre</span></p>
<p class="docText1">The plug-in configuration file for the 3.1.0 release</p>
<p class="docText1"><span class="b">/usr/local/etc/mail/spamassassin/v312.pre</span></p>
<p class="docText1">The plug-in configuration file for the 3.1.2 release</p>
<p class="docText1"><span class="b">/usr/local/etc/mail/spamassassin/v320.pre</span></p>
<p class="docText1">The plug-in configuration file for the 3.2.0 release</p>
<p class="docText1"><a name="when SpamAssassin" class="calibre8" id="when SpamAssassin"/>The plug-in configuration files are loaded when SpamAssassin's spamd daemon is loaded. Each file contains plug-ins that were specifically added at the time of each respective release.</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="log_file" class="calibre8" id="log_file"/>
<h3 class="docSection1Title" id="-100000">28.10. LOG FILE</h3>
<p class="docText1"><span class="b">/var/log/maillog</span><a name="IDX-CHP-28-0441" class="calibre8" id="IDX-CHP-28-0441"/><a name="IDX-CHP-28-0442" class="calibre8" id="IDX-CHP-28-0442"/></p>
<p class="docText1"><a name="Contains a" class="calibre8" id="Contains a"/>Contains a log of activity and status information for SpamAssassin's spamd daemon</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="notes-id21" class="calibre8" id="notes-id21"/>
<h3 class="docSection1Title" id="-100000">28.11. NOTES</h3>
<ul class="calibre15"><li class="calibre16"><p class="docText1"><span class="b"><a name="Using a" class="calibre8" id="Using a"/>Using a Mail Delivery Agent</span><a name="both spam" class="calibre8" id="both spam"/> SpamAssassin delivers both spam and ham to users' default mailboxes; it cannot apply rules to spam. To set rules for handling email that is flagged as spam, use a tool like Procmail (see ) to process messages once they have been tagged by SpamAssassin.<a name="IDX-CHP-28-0443" class="calibre8" id="IDX-CHP-28-0443"/></p></li><li class="calibre16"><p class="docText1"><span class="b">Whitelisting</span><a name="or domains" class="calibre8" id="or domains"/> If there are certain senders or domains that you want to effectively exempt from SpamAssassin's array of tests, you can add their email addresses or domains to the system whitelist. SpamAssassin will accept whitelist declarations in <span class="docEmphasis1">local.cf</span> in <span class="docEmphasis1">/usr/local/etc/mail/spamassassin</span> or <span class="docEmphasis1">user_prefs</span> in <span class="docEmphasis1">/var/spool/spamd/.spamassassin</span><a name="entries in" class="calibre8" id="entries in"/>. Keeping whitelist entries in <span class="docEmphasis1">user_prefs</span><a name="it keeps" class="calibre8" id="it keeps"/> is preferable because it keeps them separate from the primary configuration settings.<a name="IDX-CHP-28-0444" class="calibre8" id="IDX-CHP-28-0444"/></p><p class="docText1">To demonstrate, we'll add whitelist entries for <a class="calibre2" href="mailto:vip@example.com.html">vip@example.com</a> and anyone from <a class="calibre2" target="_blank" href="http://gmail.com">gmail.com</a> to the <span class="docEmphasis1">user_prefs</span> file. Open <span class="docEmphasis1">user_prefs</span>:</p><pre class="calibre30"># <b class="calibre28">cd /var/spool/spamd/.spamassassin</b>
# <b class="calibre28">touch user_prefs</b>
# <b class="calibre28">chown spamd:spamd user_prefs</b>
# <b class="calibre28">chmod 440 user_prefs</b>
# <b class="calibre28">ee user_prefs</b></pre>
<p class="docText1">and add the following lines:</p><pre class="calibre30">whitelist_from vip@example.com
whitelist_auth *@gmail.com</pre><br class="calibre1"/>
<p class="docText1">The <tt class="calibre20">whitelist_from</tt><a name="that claims" class="calibre8" id="that claims"/> statement subtracts 100 points from the spam score on all email that claims to be from <a class="calibre2" href="mailto:vip@example.com.html">vip@example.com</a>.</p><p class="docText1">The <tt class="calibre20">whitelist_auth</tt><a name="spam score" class="calibre8" id="spam score"/> statement subtracts 100 points from the spam score on all email verified by SPF, DomainKeys, or DKIM from any <a class="calibre2" target="_blank" href="http://gmail.com">gmail.com</a> email address.</p><p class="docText1"><a name="their email" class="calibre8" id="their email"/>If you can confirm that senders employ SPF, DomainKeys, or DKIM on their email systems, use <tt class="calibre20">whitelist_auth</tt> instead of <tt class="calibre20">whitelist_from</tt>.</p></li><li class="calibre16"><p class="docText1"><span class="b">Reporting Spam to Vipul's Razor</span><a name="a Razor" class="calibre8" id="a Razor"/> You can report messages to a Razor Nomination Server with the razor-report utility. Reporting spam to the Razor system helps the community better recognize the ever-changing types of spam in circulation. If you have a folder with known spam messages you can submit them to the Razor servers like so (replace the italicized path with a path to your spam directory):</p><pre class="calibre30"># <b class="calibre28">cat</b> <span class="docEmphBoldItalic">/usr/home/john/Maildir/.Junk/cur/*</span>
<b class="calibre28">| razor-report \</b>
? <b class="calibre28">-home=/var/spool/spamd/.razor</b></pre><br class="calibre1"/>
</li><li class="calibre16"><p class="docText1"><span class="b">Bayesian Classification Tests</span><a name="email until" class="calibre8" id="email until"/> Bayesian classification tests will not run on incoming email until 200 spam and 200 ham messages have been recorded in the database. The Bayes system will automatically learn spam and ham messages over time. If you have an existing collection of spam and ham, use the sa-learn utility to speed up this process. See "<a class="calibre2" href="utilities-id10.html#sa-learn">sa-learn</a><a name="for examples" class="calibre8" id="for examples"/>" for examples.</p></li></ul>
</div></div>

</body></html>