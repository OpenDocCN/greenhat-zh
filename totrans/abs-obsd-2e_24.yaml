- en: Appendix A. Afterword
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 附录A. 后记
- en: '*Failure’s bad enough;*'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: '*失败已经够糟糕的了；*'
- en: '*add the human element*'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: '*再加上人为因素*'
- en: '*and things really suck.*'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: '*事情真的很糟糕。*'
- en: Back around 2000, my employer’s main business was designing web applications,
    but once those applications were built, our clients would turn around and ask,
    “Where should we host this?” That’s where I came in, building and running a small
    but professional-grade datacenter for custom applications.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 大约在2000年左右，我的雇主的主要业务是设计网络应用程序，但一旦这些应用程序建成，我们的客户就会转过来问，“我们应该在哪里托管这个？”这就是我的工作，为定制应用程序构建和运行一个小型但专业级的数据中心。
- en: As with any new business, our hosting operation needed to make the most of existing
    resources. Hardware was strictly limited to cast-off equipment from the web developers,
    and we used only software that was free. The only major expense was a big-name
    commercial firewall, purchased for marketing rather than technical reasons.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 就像任何新的商业一样，我们的托管业务需要充分利用现有资源。硬件严格限制为来自网络开发者的废弃设备，我们只使用免费软件。唯一的主要开支是一台知名的商业防火墙，购买的原因更多是出于营销而非技术。
- en: With a whole mess of open source software, we built a reliable network management
    system that provided our clients with more insight into their equipment than their
    in-house people could offer. The clients paid for their own hardware, and so had
    fancy high-end rackmount servers with their chosen applications, platforms, and
    operating systems. As the business grew, we upgraded the hardware (it’s nice to
    have disk drives that are less than five years old), but we saw no need to replace
    the software.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 使用大量开源软件，我们构建了一个可靠的网络管理系统，为我们客户提供比他们内部人员所能提供的更多设备洞察。客户支付自己的硬件费用，因此拥有他们选择的、配备有应用程序、平台和操作系统的昂贵高端机架服务器。随着业务的增长，我们升级了硬件（拥有五年以下的硬盘驱动器真是太好了），但我们没有看到更换软件的必要。
- en: One Monday morning, a customer who had expected to use very little bandwidth
    found that he had sufficient requests to devour twice the bandwidth we had for
    the entire datacenter. This affected every customer. If your $9.95 per month web
    page is slow, you have little to complain about; if your $50,000 per month web
    application is slow, you pick up the phone and scream until the problem stops.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 一周一早，一位预期使用很少带宽的客户发现，他的请求足以消耗掉整个数据中心带宽的两倍。这影响了每一位客户。如果你的每月9.95美元的网页运行缓慢，你没什么好抱怨的；如果你的每月50,000美元的网络应用程序运行缓慢，你会拿起电话大喊大叫，直到问题解决。
- en: To make life worse, my grandmother had died only a couple days before. Visitation
    was on Tuesday, and the funeral was Wednesday morning. I handed the problem to
    a minion and said, “Here, do something about this.” I knew the network could manage
    bandwidth at many points. The web servers themselves, the load balancer in front
    of them, the commercial firewall, and even the router claimed to have traffic-management
    capacity.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 更糟糕的是，我的祖母几天前去世了。参观是在星期二，葬礼是在星期三早上。我把问题交给了一个小弟，说，“这里，处理一下这个问题。”我知道网络可以在许多点管理带宽。网络服务器本身、它们前面的负载均衡器、商用防火墙，甚至路由器都声称有流量管理能力。
- en: Tuesday, after visitation, my cell phone voicemail was full. Our version of
    Internet Information Server (IIS) could manage bandwidth—in 8MB increments, and
    only if the content was static HTML and JPEG files. With several web servers behind
    the load balancer, that fell somewhere between useless and laughable. The load
    balancer *would* support traffic shaping, if we bought the new feature set. If
    we plopped down a credit card, we could have that feature set installed by next
    Sunday. Our big-name commercial firewall also had traffic-shaping features available,
    *if* we upgraded our service level and paid an additional (and quite hefty) fee
    for the feature set. That left the router, which I had previously investigated
    and found would support traffic shaping with only an IOS upgrade.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 星期二，在参观之后，我的手机语音信箱满了。我们版本的互联网信息服务器（IIS）可以管理带宽——以8MB的增量，但仅限于静态HTML和JPEG文件。在负载均衡器后面的几个网络服务器，这几乎是无用且可笑的。如果购买新的功能集，负载均衡器*会*支持流量整形。如果我们放下信用卡，我们可以在下周日之前安装那个功能集。我们知名的商用防火墙也提供了流量整形功能，*如果*我们升级我们的服务级别并支付额外的（相当可观的）费用来获取该功能集。这留下了路由器，我之前已经调查过，发现只需升级IOS即可支持流量整形。
- en: I was on the phone until midnight Tuesday night, making arrangements to do an
    emergency router IOS upgrade on Wednesday night. I had planned to go to the funeral
    Wednesday morning, give a eulogy, go home and take a nap, and arrive at work at
    midnight ready to rock.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 我一直打电话到周二晚上午夜，安排在周三晚上进行紧急路由器IOS升级。我计划周三早上参加葬礼，发表悼词，回家小睡一会儿，然后在午夜到达工作地点，准备迎接挑战。
- en: Unfortunately, the funeral was more dramatic than I had expected, and I showed
    up at work at midnight sleepless, bleary-eyed, and upright only courtesy of the
    twin blessings of caffeine and adrenaline. In my email, I found a note that several
    big clients had threatened to leave unless the problems were resolved by Thursday
    morning. If I hadn’t already been stressed out, the prospect of choosing a minion
    to lay off would have done the trick. (I work hard training my minions, and prefer
    not to replace them once they are beaten into shape.)
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 不幸的是，葬礼比我预期的更戏剧化，我是在毫无睡意、眼睛模糊、身体笔直的情况下，仅靠咖啡因和肾上腺素的共同恩赐才到达办公室的。在我的电子邮件中，我发现一条笔记，几个大客户威胁说，除非问题在周四早上解决，否则他们将离开。如果我没有已经压力很大，选择一个下属解雇的可能性就会让我崩溃。（我努力训练我的下属，一旦他们被打造成型，我就不愿意替换他们。）
- en: Still, only a simple router flash upgrade and some basic configuration stood
    between me and relief. What could possibly go wrong?
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，只有简单的路由器固件升级和一些基本配置就介于我和解脱之间。可能出什么问题呢？
- en: The upgrade went smoothly, but the router behaved oddly when I enabled traffic
    shaping. Over the next few hours, I discovered that the router didn’t have enough
    memory to simultaneously support all of our BGP feeds and the traffic-shaping
    functionality. Worse, it wouldn’t accept more memory. At about 6:00 AM, I finally
    got an admission from the router vendor that it could not help me.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 升级过程顺利，但当我启用流量整形功能时，路由器表现异常。在接下来的几个小时里，我发现路由器没有足够的内存同时支持所有的BGP数据流和流量整形功能。更糟糕的是，它不接受更多的内存。大约早上6:00，我终于从路由器供应商那里得到了承认，他们无法帮助我。
- en: I hung up the phone. The first client who had threatened departure would be
    checking in at 7:30 AM. I had slept 4 hours of the last 48, and had spent most
    of that time under fiendish levels of emotional stress. I had already emptied
    my stash of quarters for the soda machine, and had pillaged my coworkers’ desks
    for more change. The caffeine and adrenaline that had gotten me to the office
    had long since worn off, and further doses of each merely slowed my collapse.
    We had support contracts on every piece of equipment, and they were all useless.
    All the hours of work I had put in, and my team before me, left me with absolutely
    nothing.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 我挂断了电话。第一个威胁要离开的客户将在早上7:30到达。我在过去的48小时内只睡了4个小时，大部分时间都在承受着恶魔般的情绪压力。我已经用完了自动售货机里的所有零钱，还从同事的桌子上搜刮了更多的零钱。让我到达办公室的咖啡因和肾上腺素早已消耗殆尽，而更多的剂量只是减缓了我的崩溃。我们每台设备都有支持合同，但它们都毫无用处。我投入的所有时间和我之前的团队，让我一无所获。
- en: I made myself sit still for two minutes simply focusing on breathing, making
    my head stop sliding around loose on my shoulders, and ignoring the loud ticking
    of the clock. What could be done in 90 minutes—no, now only 88?
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 我让自己坐了静默两分钟，仅仅专注于呼吸，让我的头不再在我肩膀上滑动，并忽略时钟的巨大滴答声。90分钟内能做什么——不，现在只有88分钟了？
- en: I really had one only option. If it didn’t work, I would either lay off someone
    or file for unemployment.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 我真的只有一个选择。如果它不起作用，我就会解雇某人或者申请失业救济。
- en: At 6:05 AM, I started downloading the OpenBSD install floppy image, and then
    I grabbed a spare desktop machine, selecting it from among many similar machines
    by virtue of it being on top of the pile. The next few minutes, I alternated between
    hitting the few required installation commands and dismantling every unused machine
    unlucky enough to be in reach to find two decent network cards.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 早上6:05，我开始下载OpenBSD安装软盘镜像，然后我抓起一台备用台式机，由于它正好在最上面，我就从众多类似的机器中选择了它。接下来的几分钟，我交替进行着敲击几个必要的安装命令和拆解那些不幸够得着的、未使用的机器，以找到两张不错的网卡。
- en: By 6:33 AM, I had two Intel EtherExpress cards in my hands and a virgin OpenBSD
    system. I logged in long enough to shut down the system so I could wrench the
    case off, slam the cards into place, and boot again. Even early versions of PF
    included all sorts of nifty filtering abilities, all of which I ignored in favor
    of the newly released traffic-shaping functions. By 6:37 AM, I was wheeling a
    cart with a monitor, keyboard, and my new traffic shaper over to the rack.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 到早上6:33，我手里拿着两张Intel EtherExpress卡和一个全新的OpenBSD系统。我登录了足够长的时间来关闭系统，这样我就可以拧下机箱，把卡插好，然后重新启动。即使是PF的早期版本也包含了各种巧妙的过滤功能，但我都忽略了，转而选择了新发布的流量整形功能。到早上6:37，我推着一辆装有显示器、键盘和我的新流量整形器的车，把它推到架子上。
- en: Then things got hard. I didn’t have a spare switch that could handle our Internet
    bandwidth. The router rack was jammed to overflowing, leaving me no place to put
    the new shaper. I lost almost half an hour finding a crossover cable, and when
    I discovered one, it was only two feet long. The router, of course, was mounted
    in the top of the rack. About 7:10 AM, I discovered that if I put the desktop
    PC on end, set it on an empty shipping box, and put the box on the cart, the cable
    *just* reached the router. I stacked everything so it would reach, and began rewiring
    the network and reconfiguring subnets.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 然后事情变得困难起来。我没有一个额外的交换机可以处理我们的互联网带宽。路由器架子上已经挤满了东西，没有地方放置新的整形器。我花了差不多半小时才找到一根交叉线缆，而且找到的线缆只有两英尺长。当然，路由器是安装在架子顶部的。大约早上7:10，我发现如果我把台式电脑竖放，放在一个空的运输箱上，然后把箱子放在车上，线缆刚好可以够到路由器。我把所有东西堆起来，确保它们可以到达，然后开始重新布线和重新配置子网。
- en: I vaguely recall my manager coming in about 7:15 AM, asking with taut calmness
    if he could help. If I remember correctly, as I typed madly at the router console,
    I said, “Yes. Go away.”
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 我模糊地记得我的经理大约在7:15进来，带着紧张而平静的语气问他是否可以帮忙。如果我记得正确的话，当我疯狂地在路由器控制台打字时，我说，“是的。走开。”
- en: At 7:28 AM, we had an OpenBSD traffic shaper between the hosting area and our
    router. All the client applications were reachable from the Internet. I collapsed
    in my chair and stared blankly at the wall.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 早上7:28，我们在托管区域和我们的路由器之间有一个OpenBSD流量整形器。所有客户端应用都可以从互联网访问。我瘫坐在椅子上，茫然地盯着墙壁。
- en: While everything seemed to work, the proof would be in what happened as our
    offending site started its daily business. I watched with growing tension as that
    client’s network traffic climbed toward the red line that indicated trouble. The
    traffic grew to just short of the danger line, and then flatlined. Other clients
    called, happy that their service was restored to its usual quality. One client
    complained that his site was still slow, but it turned out that bandwidth problem
    had masked a problem with his application. The client said that his website now
    ran even slower than before, to which we offered to provide more bandwidth if
    they would agree to pay for it.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然一切似乎都在正常工作，但真正的证明将在于我们受影响的网站开始其日常业务时会发生什么。我紧张地看着那个客户端的网络流量逐渐逼近表示问题的红线。流量增长到接近危险线，然后突然停止。其他客户端打电话来，很高兴他们的服务恢复了正常质量。有一个客户抱怨他的网站仍然很慢，但后来发现带宽问题掩盖了他应用程序的问题。客户说，他的网站现在运行得甚至比以前还要慢，我们提出如果他们同意付费，我们可以提供更多的带宽。
- en: Shortly afterward, I had two new routers and new DS3s. The racks were again
    clean. The decrepit desktop machine was replaced by two OpenBSD boxes in a live-failover
    configuration, protecting our big-name commercial firewall as well as shaping
    traffic. And I now stock crossover cables in a variety of lengths.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 稍后，我有了两个新的路由器和新的DS3。架子再次变得干净。那台破旧的台式机被两个配置为实时故障转移的OpenBSD盒子所取代，保护了我们的大名商业防火墙以及流量整形。现在，我储备了各种长度的交叉线缆。
- en: If I had started with OpenBSD, I would have had a much better night.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我从OpenBSD开始，我会有一个更好的夜晚。
