<html><head></head><body>
<div>&#13;
<p class="imgc"><a id="page243"/><img src="../images/267-1.jpg" alt=""/></p>&#13;
<p class="ch"><a id="chapter14"/><a href="toc.html#chapter14"><b>DESIGNING AN SNMP MIB</b></a></p>&#13;
<p class="imgc"><img src="../images/as.jpg" alt=""/></p>&#13;
<p class="nb">If you read the previous chapter, you already have some idea of why you may need an SNMP interface and how it can be useful. In this chapter and the next, you’ll see how the information specific to an appliance can be added to this interface. Like the web, LCD, and CLI interfaces, the SNMP interface will also be based on the information available from RTA tables within the Laddie application itself.</p>&#13;
<p class="indent">This chapter is concerned primarily with the design of the MIB and creation of a valid MIB file. The topics covered here are:</p>&#13;
<ul>&#13;
<li>Applying for an enterprise number</li>&#13;
<li>Designing the MIB</li>&#13;
<li>Creating the MIB file</li>&#13;
<li>Validating the MIB</li>&#13;
</ul>&#13;
<p class="indent">You will learn how to implement the agent in the next chapter.</p>&#13;
<p class="secl"><a id="chapter14.1"/><a href="toc.html#chapter14.1"><b>Our Goal</b></a></p>&#13;
<p class="noindent"><a id="page244"/>In Chapter 5 you saw several of the Laddie application’s user interfaces to the ZONE structure: framebuffer, CLI, and web. Here’s the ZONE struct from the Laddie source:</p>&#13;
<p class="imgl"><img src="../images/268-1.jpg" alt=""/></p>&#13;
<p class="indent">Figure 14-1 shows how this looked in the RTA table editor.</p>&#13;
<p class="imgc"><img src="../images/268-2.jpg" alt=""/></p>&#13;
<p class="cap"><i>Figure 14-1: The ZONE struct in the RTA table editor</i></p>&#13;
<p class="indent">Jumping ahead a bit, this is how the same information will look in our SNMP interface when we’re done designing and implementing our MIB.</p>&#13;
<p class="imgl"><img src="../images/268-3.jpg" alt=""/></p>&#13;
<p class="indent">Our task in this chapter and the next is to show you how to go from the ZONE struct to the above SNMP interface, step by step. When we are done, you should understand how to do the same thing in your own application, doing a fair amount of cutting and pasting from this MIB.</p>&#13;
<p class="indent"><a id="page245"/>You may have noticed that we did not include the <i>id</i>, <i>edge</i>, and <i>input</i> columns in our SNMP view of this table. This was not an oversight. It is up to the MIB designer (or any interface designer, for that matter) to decide what makes sense in light of the intended use of the interface. In our case, we decided that the <i>edge</i> and <i>input</i> information was too hardware specific to be necessary in this interface. The <i>id</i> column is not returned by our SNMP agent, but will be used as an index into the alarm table whenever access to a specific row is necessary.</p>&#13;
<p class="secl"><a id="chapter14.2"/><a href="toc.html#chapter14.2"><b>Your Enterprise Number</b></a></p>&#13;
<p class="noindent">Now that your interest is piqued, we’ll build suspense by taking a little detour for those of you actually in the process of starting a small company to sell your appliance. You may remember the brief discussion about enterprise numbers in the last chapter when we were identifying a printer using SNMP. Every MIB needs to be anchored to the overall namespace, and if you are designing a private MIB, you need an enterprise number of your own. These are assigned by IANA (Internet Assigned Numbers Authority). Each company or organization only needs one enterprise number because IANA grants you the authority to manage the tree beneath your number.</p>&#13;
<p class="indent">Obtaining an enterprise number from IANA may take awhile, so you should get the ball rolling early. Once you apply, IANA will tell you to expect the process to take about a month. You can design and implement your MIB while IANA is processing your request.</p>&#13;
<p class="indent">The process itself is pretty easy. Just use your favorite web browser to navigate to the IANA website (<a href="http://www.iana.org/">http://www.iana.org</a>) and click <b>Application Forms</b> in the menu. On the next page, select <b>Private Enterprise Numbers (SNMP)</b>. You’ll be presented with an online form to fill out.</p>&#13;
<p class="indent">At the bottom of the web page, there’s a link to the current list of registered numbers. You might want to check it out just to see who’s on the list. You’ll notice some pretty recognizable names near the beginning; these companies have been in the SNMP game since the beginning. IBM’s number is 2. Cisco has 9. Hewlett Packard has 11. You can scroll down to the bottom to see what the current high number is. You might also recognize the entry at number 23528. It is the start of the subtree where we will anchor the Laddie MIB we will develop in this chapter.</p>&#13;
<p class="indent">When you start your application, you will be asked to provide the following information:</p>&#13;
<ul>&#13;
<li>Your company or organization name</li>&#13;
<li>The company’s address</li>&#13;
<li>The company’s phone number</li>&#13;
<li>The name of the contact person</li>&#13;
<li>The contact person’s address</li>&#13;
<li>The contact person’s phone number</li>&#13;
<li>The contact person’s email address</li>&#13;
<li>A fax number</li>&#13;
</ul>&#13;
<p class="indent"><a id="page246"/>As you may have noticed when looking at the current list, only the enterprise number, company name, contact person’s name, and contact’s email address are listed online. It’s a good idea to use something other than your general email address here, since it’s likely that spambots will harvest it. It’s handy to have a separate address for this purpose, something generic you can forward to whomever is responsible for your SNMP work in the future.</p>&#13;
<p class="indent">Just enter your information in the form and click the <b>Submit Application</b> button.</p>&#13;
<p class="secl"><a id="chapter14.3"/><a href="toc.html#chapter14.3"><b>The MIB Files</b></a></p>&#13;
<p class="noindent">IANA grants you the authority to manage your own subtree, but it’s up to you to do a good job of it. Plan for success and don’t think of this appliance as the end of the line—leave room for expansion. You might want to define your enterprise number in a separate file where you can put information common to all your MIBs. (By the way, reading other people’s MIBs is a very good idea. You’ll find out what is common usage and you may pick up styles you find attractive along the way.)</p>&#13;
<p class="indent">Here are the two files we’ll be creating in this chapter:</p>&#13;
<p class="noindent1"><b>LADDIE-GROUP-SMI.txt</b></p>&#13;
<p class="bl">This is the file where we’ll define the Laddie Group enterprise number and our product identification OIDs.<sup>1</sup></p>&#13;
<p class="noindent1"><b>LAD-MIB.txt</b></p>&#13;
<p class="bl">This file will hold the Laddie product MIB. This MIB will be anchored under an OID defined in the LADDIE-GROUP-SMI.txt file.</p>&#13;
<p class="indent1">We’ll run these files through a utility supplied by Net-SNMP to produce skeleton code for our MIB implementation. You’ll also want these files on any system that will be running the management applications (snmpget, snmpset, snmpwalk, and so on) or interpreting traps and informs.</p>&#13;
<p class="indent">The network management system you are using will define where you place these files. The Net-SNMP management applications tend to want them in the directory /usr/local/share/snmp/mibs, though you can modify this, and it’s subject to the preferences of the OS distribution you are using. For our appliance we will place them in /opt/snmp/share/snmp/mibs.</p>&#13;
<p class="secl"><a id="chapter14.4"/><a href="toc.html#chapter14.4"><b>LADDIE-GROUP-SMI</b></a></p>&#13;
<p class="noindent">This is the file that describes the top-level structure we will be using to organize our Laddie enterprise subtree. It holds our enterprise number and product identification OID. This file is small, so let’s look at the whole thing and then discuss its structure. (The address, phone number, and fax number are bogus to protect Bob’s privacy, but you’ll get the general idea.)</p>&#13;
<p class="imgl"><a id="page247"/><img src="../images/271-1.jpg" alt=""/></p>&#13;
<p class="indent">Now let’s go through this file again in more detail. We’ll show you a section of the MIB file first and then discuss it. The best way to read this is to scan the MIB text briefly, then read the description while referring to the MIB text.</p>&#13;
<p class="ex">LADDIE-GROUP-SMI DEFINITIONS ::= BEGIN</p>&#13;
<p class="indent"><a id="page248"/>This line gives the MIB a name and tells the reader (human or program) that this is the beginning of our definitions for this MIB. Look for a matching END at the bottom of the file to tell the reader when all definitions are complete.</p>&#13;
<p class="imgl"><img src="../images/272-1.jpg" alt=""/></p>&#13;
<p class="indent">The IMPORTS section is like the #include section in a C program—it tells where to find the terms used in this MIB but not defined here. We included <img src="../images/1.jpg" alt=""/> the MODULE-IDENTITY macro and <img src="../images/2.jpg" alt=""/> the enterprises for use below.</p>&#13;
<p class="indent">Next, we defined the laddieGroup module:</p>&#13;
<p class="imgl"><img src="../images/272-2.jpg" alt=""/></p>&#13;
<p class="indent">The funny-looking string in the LAST-UPDATED and REVISION lines is a time stamp specifying the year, month, day, hour, and minute of the last change or revision. The <i>Z</i> stands for GMT (Greenwich Mean Time), sometimes called <i>Zulu Time.</i> The hours and minutes are generally zeros, because no one really cares what hour and minute a revision was made. The <img src="../images/1.jpg" alt=""/> number “200702220000Z” means February 22, 2007. With separators, it would look like this: 2007-02-22 00:00.</p>&#13;
<p class="imgl"><img src="../images/272-3.jpg" alt=""/></p>&#13;
<p class="indent"><a id="page249"/>This is where we’ll anchor the LAD-MIB we’ll be defining in the next section.</p>&#13;
<p class="ex">-- Products are registered here:<br/>laddieProducts OBJECT IDENTIFIER ::= { laddieGroup 2 }<br/>laddieAppliance OBJECT IDENTIFIER ::= { laddieProducts 1 }</p>&#13;
<p class="indent">The laddieProducts section is where we defined the OIDs that identify our products (or entire product lines, if you’re thinking really big). We have defined an OID for our Laddie appliance here, and we’ll be setting sysObjectID in MIB-2<sup>2</sup> to this value on our appliances. This will allow someone polling the box with an SNMP utility like snmpget to determine that this box is a Laddie appliance. Large corporations may put the OIDs that identify all their products into a single file. Cisco, for example, has a CISCO-PRODUCTS file where it gathers all these OIDs. For now, Laddie only has a single product OID, so we won’t go to this trouble.</p>&#13;
<p class="ex">END</p>&#13;
<p class="indent">Here’s that END we were looking for. This is the end of the LADDIE-SMI-MIB.txt file and wraps up our discussion of it.</p>&#13;
<p class="secl"><a id="chapter14.5"/><a href="toc.html#chapter14.5"><b>Creating the LAD-MIB</b></a></p>&#13;
<p class="noindent">In this section, we’ll create our appliance MIB. Refer to the illustration of the LAD-MIB structure in Figure 14-2 for a better idea of how the MIB components interrelate. It may be helpful to refer to this picture as you follow along with the development of the MIB file.</p>&#13;
<p class="indent">The LAD-MIB is divided into three main sections:</p>&#13;
<ul>&#13;
<li><span class="bb">ladTraps, containing definitions of traps</span></li>&#13;
<li><span class="bb">ladTrapInfo, containing definitions of information objects sent in traps</span></li>&#13;
<li><span class="bb">ladSystem, containing definitions of pollable objects</span></li>&#13;
</ul>&#13;
<p class="indent">Let’s start the detailed walk-through. Again, we’ll be showing one or more lines followed by a discussion of what we’ve shown.</p>&#13;
<p class="indent">We’ll start with the BEGIN statement and the definition of our MIB name:</p>&#13;
<p class="ex">LAD-MIB DEFINITIONS ::= BEGIN</p>&#13;
<p class="indent">Hopefully this looks familiar. If not, take another look at the beginning of the LADDIE-GROUP-SMI.txt file. The BEGIN line says we are starting the definition of the LAD-MIB, which is the name we gave the MIB for our appliance.</p>&#13;
<p class="imgc"><a id="page250"/><img src="../images/274-1.jpg" alt=""/></p>&#13;
<p class="cap"><i>Figure 14-2: LAD-MIB Structure</i></p>&#13;
<p class="indent">Next, we’ll import the externally defined types and macros that we will be using from other files:</p>&#13;
<p class="imgl"><img src="../images/274-2.jpg" alt=""/></p>&#13;
<p class="indent">The first set comes from <img src="../images/1.jpg" alt=""/> SNMPv2-SMI just like in the LADDIE-GROUP-SMI.txt file we covered in the previous section.</p>&#13;
<p class="indent">The next set comes from <img src="../images/2.jpg" alt=""/> SNMPv2-TC. The letters <i>TC</i> stand for <i>textual conventions.</i> SNMPv2-TC is basically a file that defines new, commonly used object types.</p>&#13;
<p class="indent">The <img src="../images/3.jpg" alt=""/> laddieMgmt OID from the LADDIE-GROUP-SMI.txt file will be our starting point in the overall namespace for our appliance MIB. We’ll use laddieMgmt as our link to the overall namespace by defining the module in this group below laddieMgmt in the code portion of the “Module Definition” section next.</p>&#13;
<p class="indent"><a id="page251"/>The SNMPv2-SMI and SNMPv2-TC MIB definitions are supplied with the Net-SNMP package. When you installed Net-SNMP on your system in the Chapter 13, these files were probably put into either /usr/share/snmp/mibs or /usr/local/share/snmp/mibs. Look for the files SNMPv2-SMI.txt and SNMPv2-TC.txt there.</p>&#13;
<p class="secs"><a id="chapter14.6"/><a href="toc.html#chapter14.6"><i><b>Module Definition</b></i></a></p>&#13;
<p class="noindent">We start by defining a module, ladProject, to contain our appliance MIB. This is where we put the copyright, revision history, contact information, and a general description of what the module contains.</p>&#13;
<p class="imgl"><img src="../images/275-1.jpg" alt=""/></p>&#13;
<p class="indent">The MODULE-IDENTITY section is like one long sentence. The first and last lines, taken together, say that ladProject is a module defined directly below <img src="../images/3.jpg" alt=""/> laddieMgmt in the namespace and that its OID is laddieMgmt.1. Here’s the OID in numeric form:</p>&#13;
<p class="ex">.1.3.6.1.4.1.3382.1</p>&#13;
<p class="indent">The rest of the MODULE-IDENTITY section should be fairly clear after our discussion of the LADDIE-SMI in the previous section. You may notice that we have two REVISION clauses listed at lines <img src="../images/1.jpg" alt=""/> and  <img src="../images/2.jpg" alt=""/>. If you make changes to your MIB in the future, you will need to add revision clauses to explain what you did. The convention is to keep revision clauses in reverse-chronological order (that is, the most recent change appears at the top). This does not mean you should feel free to make any changes you want to your MIB; you will just be creating confusion for your customers if you change anything (names, OIDs, and so on) that is already defined in your MIB. You may, however, find it necessary to enhance your MIB with new information required by customer demand or to help manage new features you’ll be adding to your appliance. You may add new structure, but do not change existing structure!</p>&#13;
<p class="indent"><a id="page252"/>Clearly your LAST-UPDATED time stamp will match that of your most recent revision clause, as ours does above.</p>&#13;
<p class="indent">The next set of lines defines the sections we will be fleshing out later:</p>&#13;
<p class="imgl"><img src="../images/276-1.jpg" alt=""/></p>&#13;
<p class="indent">Putting all of the section heading OIDs together at the top, as we have done here, is a stylistic choice we feel can help communicate the structure of the rest of the MIB. We’re making it clear that there will be a section for defining traps, one for system information (where we will be putting our Alarm Table), and another section for the non-pollable information we will only send along with traps.</p>&#13;
<p class="indent">Numbering in SNMP usually begins with 1, not zero, but you may have noticed that we gave <img src="../images/1.jpg" alt=""/> the ladTraps section above the OID of ladProject.0. Our reason for doing this dates back to the early days of SNMPv2 (SNMP version 2), when compatibility with SNMPv1 (SNMP version 1) was being crafted. For more details, you may want to read <i>RFC 1908: Coexistence between Version 1 and Version 2 of the Internet-Standard Network Management Framework.</i></p>&#13;
<p class="indent">We’ll continue our review of our MIB with the ladSystem section and leave the traps for later. That will allow us to immediately follow our discussion of the trap with the ladTrapInfo section.</p>&#13;
<p class="ex">-- LAD System Information<br/>ladSystemScalars OBJECT IDENTIFIER ::= { ladSystem 1 }<br/>ladSystemTables OBJECT IDENTIFIER ::= { ladSystem 2 }</p>&#13;
<p class="indent">Here we further subdivide the ladSystem section into a section for scalars and another for tables. <i>Scalars</i> are just objects that are not columns in tables. Experience has taught us to keep scalars and tables separate to avoid having scalars sprinkled around between tables as the MIB evolves over time.</p>&#13;
<p class="secs"><a id="chapter14.7"/><a href="toc.html#chapter14.7"><i><b>Version and Number of Zones</b></i></a></p>&#13;
<p class="noindent"><a id="page253"/>Next, we’ll define some scalars in our ladSystemScalars section.</p>&#13;
<p class="imgl"><img src="../images/277-1.jpg" alt=""/></p>&#13;
<p class="indent">Here we have defined two objects (note the OBJECT-TYPE keyword): ladVersion and ladNumberOfZones. The SYNTAX clause tells us that ladVersion is a DisplayString, meaning it is represented as a string of displayable (printable) characters, and ladNumberOfZones is a 32-bit integer with values ranging from 1 through 128. If you refer back to our IMPORT section at the start of this MIB, you will see that both of these syntaxes were imported from SNMPv2-TC, the textual conventions file.</p>&#13;
<p class="indent">The MAX-ACCESS clause tells us that each of these objects is read-only. Some objects we will encounter later in this MIB will have read-write, not-accessible, or accessible-for-notify access. <i>Read-write</i> just means you can read the object’s value as well as write a new value. You can’t read or write objects defined as <i>not-accessible</i>, but you might use one as an index into a table. <i>Accessible-for-notify</i> is how we define information sent with a trap but that otherwise is not pollable.</p>&#13;
<p class="indent">One point to keep in mind here is that the MAX-ACCESS clause defines <i>maximum</i> access, not <i>actual</i> access. You will never be able to write an object that has max-access read-only, but you may not be able to write to an object whose max-access is read-write, either. The ability to write to the object may be restricted by other factors. For example, in Net-SNMP, you may not write to any object that has a value set in the snmpd.conf file, regardless of what the MAX-ACCESS clause indicates in the MIB file.</p>&#13;
<p class="indent"><a id="page254"/>The STATUS clause indicates that both objects are current, that is, they are are valid objects in this version of the MIB. To remove an object from a MIB, you would make its status deprecated. This is a brand new MIB, so nothing is deprecated.</p>&#13;
<p class="indent">The DESCRIPTION clause is intended specifically for the human reader of the MIB, rather than a computer program. It should contain a brief description of the object. It might also contain possible uses of the value and any caveats the reader may need to know.</p>&#13;
<p class="indent">The last line of each section defines the OID. The ::= means <i>is defined as.</i> Each OID is described as appending to a previous OID. The ladNumberOfZones object’s OID is the same as ladSystemScalars with a <i>2</i> appended to the end. Its whole numeric OID looks like this:</p>&#13;
<p class="ex">.1.3.6.1.4.1.23528.1.1.1.1.2</p>&#13;
<p class="indent">The first six numbers in this string are from standard MIBs and can be read like this:</p>&#13;
<p class="ex">.iso(1).org(3).dod(6).internet(1).private(4).enterprises(1)</p>&#13;
<p class="indent">The next number is where IANA gave us our own enterprise number, 23528. So after enterprises, the rest of the OID continues</p>&#13;
<p class="ex">laddieGroup.laddieMgmt.ladProject.ladSystem.ladSystemScalars.ladNumberOfZones</p>&#13;
<p class="indent">See Figure 14-3 for the correspondence between each number in the OID and its descriptive name.</p>&#13;
<p class="imgc"><img src="../images/278-1.jpg" alt=""/></p>&#13;
<p class="cap"><i>Figure 14-3: OID for ladNumberOfZones</i></p>&#13;
<p class="secs"><a id="chapter14.8"/><a href="toc.html#chapter14.8"><i><b>The Alarm Table</b></i></a></p>&#13;
<p class="noindent"><a id="page255"/>Now for the core of our MIB: the Alarm Table. This is the table we displayed at the beginning of this chapter, showing the zones and alarm states. Here is how we define this table in our MIB:</p>&#13;
<p class="imgl"><img src="../images/279-1.jpg" alt=""/></p>&#13;
<p class="indent">Notice that we have three blocks of definition above: ladAlarmTable, ladAlarmEntry, and LadAlarmEntry. SNMP requires that all object names begin with a lowercase letter (hence, ladAlarmTable, ladAlarmEntry). However, LadAlarmEntry is not an object, but rather a definition of the syntax of the table entry. It is common practice to define the <i>syntax</i> of a table with the same name as the table entry, but starting with an uppercase letter (<i>l</i>adAlarmEntry versus <i>L</i>adAlarmEntry). The syntax of ladAlarmTableEntry is a sequence (list or array) of other object types which are the columns in the table.</p>&#13;
<p class="indent">After the definition of the table entry syntax, we’ll list the detailed definitions of each of the columns listed in the SEQUENCE clause:</p>&#13;
<p class="imgl"><img src="../images/279-2.jpg" alt=""/></p>&#13;
<p class="imgl"><a id="page256"/><img src="../images/280-1.jpg" alt=""/></p>&#13;
<p class="indent"><a id="page257"/>The MAX-ACCESS clause in each of these objects defines how it may be used. We have made ladAlarmZoneId not-accessible because we will only be using it to index into the table to read or write the other values. Notice that ladAlarmEnable, ladAlarmLatching, and ladAlarmState are read-write, but ladAlarmZoneName is read-only. We wanted to be able to use SNMP commands to enable or disable alarms, change whether or not they latch, and clear alarms by setting their state to false. We felt, however, that changing the name of a zone is a static configuration that should be done through another interface, like the web interface or the CLI. The ladAlarmCount is a history of the number of times the alarm has triggered, so we have made this read-only.</p>&#13;
<p class="indent">There is nothing mandatory about the MAX-ACCESS choices we have made here. You might well disagree with some of these choices and design your MIB differently. Look at the SNMP display of the Zone structure in the section “Our Goal” on page 244. Had we defined our ladAlarmZoneId as readable, you would see the row number at the start of each row right before the zone name. We also could have defined the count field as writable so you could reset it to zero periodically; this would allow you to see how many times the alarm has triggered over a period without having to save the old value and subtract it from the new one. These choices belong to the designer.</p>&#13;
<p class="secs"><a id="chapter14.9"/><a href="toc.html#chapter14.9"><i><b>The Traps</b></i></a></p>&#13;
<p class="noindent">Now let’s leave the Alarm Table and move on to our traps:</p>&#13;
<p class="imgl"><img src="../images/281-1.jpg" alt=""/></p>&#13;
<p class="indent">We have included two traps: one to raise a red flag when an intrusion has been detected and the other to let you know when everything has returned to normal. These look a lot like the OBJECT-TYPE definitions above, but we use NOTIFICATION-TYPE for traps.</p>&#13;
<p class="indent"><a id="page258"/>The OBJECTS clause in the ladAlarm trap definition tells what other information will accompany the trap. This is often called the varbind list, for <i>var</i>iable <i>bind</i>ings. These variables, which explain why the trap was sent, are bound to the trap when it is sent.</p>&#13;
<p class="imgl"><img src="../images/282-1.jpg" alt=""/></p>&#13;
<p class="indent">These are the definitions of the objects in our varbind list. The MAX-ACCESS of these is set to accessible-for-notify, meaning they cannot be polled; they merely define the objects for the benefit of the trap receiver. These objects only have meaning when attached to a trap.</p>&#13;
<p class="indent">Early SNMP documents (RFCs) were created with concern for keeping SNMP traffic to a minimum to prevent burdening networks with extra traffic. Traps were intended just to draw attention to a possible problem; you were supposed to poll the device for specifics about what was wrong. Today, however, some network administrators use trap logs as a history of what’s been happening on the device. They want all pertinent information sent with the trap and logged by the trap-receiving software.</p>&#13;
<p class="indent">You’ll also want to take care that your device doesn’t become too chatty with its traps. Laddie is unlikely to have this problem, but if you are building an appliance intended to sit on a major corporate, ISP, or carrier network, you had better consider this. If you check for error conditions every minute and generate a trap each time some measure is over an acceptable threshold, an appliance that notices an error on Friday night will be able to send about 3,500 traps by Monday morning, all reporting the same problem. Any other problem from a different device will be lost in the jabber. You may want to just report the problem once when it is first noticed, then send another trap to indicate when the problem is corrected.</p>&#13;
<p class="indent">The argument in favor of sending lots of traps is that SNMP is unreliable by design. It uses UDP packets to report problems with the assumption that any problem of importance will be noticed more than once, so the loss of a single trap will not be a problem. If you can’t be sure your trap was received, you had better keep sending it until someone notices, right? Well, that’s one approach. Another is just to use informs instead of traps. <i>Informs</i> became available with SNMPv2 and are essentially traps with some built-in reliability. Informs expect a confirmation message from the receiver and will retry some number of times if they don’t see the confirm. If this isn’t good enough for you, then you might want to consider some reduced frequency schedule for resending your trap if your device has not received some attention.</p>&#13;
<p class="ex">END</p>&#13;
<p class="indent"><a id="page259"/>Last but not least, there’s the END marker that signals the end of the MIB.</p>&#13;
<p class="secl"><a id="chapter14.10"/><a href="toc.html#chapter14.10"><b>Validating Your MIB</b></a></p>&#13;
<p class="noindent">Now that the MIB has been written, we need to test it for validity. The MIB must be not only human-readable, but machine parse-able. The syntax of a MIB must be as correct as the syntax of a computer program, or the applications using the MIB will be unable to interpret it. Lucky for us, multiple free MIB validators are available online. All you need is a browser and your MIB files. There’s always the risk that any online resources discussed here may be unavailable by the time you read this book, but the one we will be using here is on the SimpleWeb website, shown in Figure 14-4. You can find it at <a href="http://wwwsnmp.cs.utwente.nl/ietf/mibs/validate">http://wwwsnmp.cs.utwente.nl/ietf/mibs/validate</a>. It has been around since 1997 and is run by the Universiteit Twente in the Netherlands.</p>&#13;
<p class="imgc"><img src="../images/283-1.jpg" alt=""/></p>&#13;
<p class="cap"><i>Figure 14-4: The SimpleWeb MIB validator</i></p>&#13;
<p class="indent">Another free validator we have used is the one provided by Muonics at <a href="http://www.muonics.com/Tools/smicheck.php">http://www.muonics.com/Tools/smicheck.php</a>.</p>&#13;
<p class="indent">Make sure you do not skip the validation step! If you don’t get the syntax of your MIB exactly right, nothing will work for you from here on.</p>&#13;
<p class="secl"><a id="chapter14.11"/><a href="toc.html#chapter14.11"><b>Summary</b></a></p>&#13;
<p class="noindent"><a id="page260"/>In this chapter you have seen how to apply for an enterprise number, develop an MIB, and validate that MIB. The hard part is trying to design the MIB structure to accommodate future changes. Our task for Laddie has been fairly simple because our whole MIB revolves around a simple RTA table, and the MIB is unlikely to evolve much over time. A designer working on a MIB for a real appliance doesn’t have it so easy. We suggest thinking about the basic types of information you may need to have, regardless of what direction your product takes in the future. For example, you may have:</p>&#13;
<ul>&#13;
<li>Configuration information</li>&#13;
<li>Statistics</li>&#13;
<li>Historical information</li>&#13;
<li>Miscellaneous run-time states</li>&#13;
<li>Performance measures</li>&#13;
<li>Usage levels</li>&#13;
<li>Service or resource saturation levels</li>&#13;
</ul>&#13;
<p class="indent">This may guide you in structuring your MIB to make your life easier as future demands are made on you and your MIB.</p>&#13;
<p class="noindent1">__________________</p>&#13;
<p class="foot"><sup>1</sup> OIDs used to identify products are returned as the value of sysObjectId in MIB-2.</p>&#13;
<p class="foot"><sup>2</sup> You can find sysObjectID defined in the SNMPv2-MIB.txt file, which is included with the Net-SNMP package.</p>&#13;
</div>&#13;
</body></html>