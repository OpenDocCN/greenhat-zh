<html><head></head><body><div class="chapter" title="Chapter&#xA0;18.&#xA0;Common Web Vulnerabilities"><div class="titlepage"><div><div><h1 class="title"><a id="common_web_vulnerabilities"/>Chapter 18. Common Web Vulnerabilities</h1></div></div></div><p>Up until this point, we have paid little attention to the taxonomy of common web vulnerabilities. Gaining insight into the underlying mechanics of web applications is far more important than memorizing several thousand random and often unnecessary terms; nomenclature such as <span class="emphasis"><em>improper restriction of operations within the bounds of a memory buffer</em></span> (Common Weakness Enumeration) or <span class="emphasis"><em>insecure direct object references</em></span> (Open Web Application Security Project) finds no place in a reasonable conversation—and rightly so.</p><p>Nevertheless, the industry has come up with a handful of reasonably precise phrases that security researchers use every day. Having thoroughly discussed the inner workings of the browser, it seems useful to recap and highlight the terminology the average reader is likely to see.</p><div class="sect1" title="Vulnerabilities Specific to Web Applications"><div class="titlepage"><div><div><h1 class="title"><a id="vulnerabilities_specific_to_web_applicat"/>Vulnerabilities Specific to Web Applications</h1></div></div></div><p>The terms outlined in this section are unique to the technologies used on the Web and often have no immediate counterparts in the world of “traditional” application security.<a class="indexterm" id="IDX-CHP-18-0001"/><a class="indexterm" id="IDX-CHP-18-0002"/><a class="indexterm" id="IDX-CHP-18-0003"/><a class="indexterm" id="IDX-CHP-18-0004"/><a class="indexterm" id="IDX-CHP-18-0005"/><a class="indexterm" id="IDX-CHP-18-0006"/><a class="indexterm" id="IDX-CHP-18-0007"/><a class="indexterm" id="IDX-CHP-18-0008"/><a class="indexterm" id="IDX-CHP-18-0009"/></p><div class="variablelist"><dl><dt><span class="term"><span class="strong"><strong>Cross-site request forgery (XSRF, CSRF)</strong></span></span></dt><dd><p>A vulnerability caused by the failure to verify that a particular state-changing HTTP request received by the server-side portion of the web application was initiated from the expected client-side origin. This flaw permits any third-party website loaded in the browser to perform actions on behalf of the victim.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch04.html" title="Chapter 4. Hypertext Markup Language">Chapter 4</a> <span class="emphasis"><em>for a more detailed discussion of XSRF</em></span>.</p></li></ul></div></dd><dt><span class="term"><span class="strong"><strong>Cross-site script inclusion (XSSI)</strong></span></span></dt><dd><p>A flaw caused by the failure to secure sensitive JSON-like responses against being loaded on third-party sites via <span class="emphasis"><em>&lt;script src=...&gt;</em></span>. User-specific information in the response may be leaked to attackers.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch06.html" title="Chapter 6. Browser-Side Scripts">Chapter 6</a> <span class="emphasis"><em>for an overview of the problem (and potential fixes)</em></span>.</p></li></ul></div></dd><dt><span class="term"><span class="strong"><strong>Cross-site scripting (XSS)</strong></span></span></dt><dd><p>Insufficient input validation or output escaping can allow an attacker to plant his own HTML markup or scripts on a vulnerable site. The injected scripts will have access to the entirety of the targeted web application and, in many cases, to HTTP cookies stored by the client.</p><p>The qualifier <span class="emphasis"><em>reflected</em></span> refers to cases where the injected string is simply a result of incorrectly echoing back a portion of the request, whereas <span class="emphasis"><em>stored</em></span> or <span class="emphasis"><em>persistent</em></span> refers to a situation where the payload takes a more complex route. <span class="emphasis"><em>DOM-based</em></span> may be used to denote that the vulnerability is triggered by the behavior of the client-side portion of the web app (i.e., JavaScript).</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch04.html" title="Chapter 4. Hypertext Markup Language">Chapter 4</a> <span class="emphasis"><em>for common XSS vectors in HTML documents</em></span>.</p></li><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch06.html" title="Chapter 6. Browser-Side Scripts">Chapter 6</a> <span class="emphasis"><em>for an overview of DOM-based XSS risks</em></span>.</p></li><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch13.html" title="Chapter 13. Content Recognition Mechanisms">Chapter 13</a> <span class="emphasis"><em>for XSS vectors associated with content sniffing</em></span>.</p></li><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch09.html" title="Chapter 9. Content Isolation Logic">Chapter 9</a> <span class="emphasis"><em>for a discussion of the normal security model for JS code</em></span>.</p></li></ul></div></dd><dt><span class="term"><span class="strong"><strong>Header injection (response splitting)</strong></span></span></dt><dd><p>Insufficient escaping of newlines (or equivalent characters) in HTTP responses generated by the server-side portion of a web application. This behavior will typically lead to XSS, browser, or proxy cache poisoning and more.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch03.html" title="Chapter 3. Hypertext Transfer Protocol">Chapter 3</a> <span class="emphasis"><em>for a detailed discussion of the flaw</em></span>.</p></li></ul></div></dd><dt><span class="term"><span class="strong"><strong>Mixed content</strong></span></span></dt><dd><p>A catch-all name for loading non-HTTPS subresources on HTTPS pages. In the case of scripts and applets, this behavior makes the application trivially vulnerable to active attackers, particularly on open wireless networks (at cafés, airports, and so on), and undoes almost all benefits of HTTPS. The consequences of mixed content bugs with stylesheets, fonts, images, or frames are usually also fairly serious but more constrained.<a class="indexterm" id="IDX-CHP-18-0010"/><a class="indexterm" id="IDX-CHP-18-0011"/><a class="indexterm" id="IDX-CHP-18-0012"/></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch04.html" title="Chapter 4. Hypertext Markup Language">Chapter 4</a> <span class="emphasis"><em>and</em></span> <a class="xref" href="ch08.html" title="Chapter 8. Content Rendering with Browser Plug-ins">Chapter 8</a> <span class="emphasis"><em>for content-specific precautions on HTTPS sites</em></span>.</p></li><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch11.html" title="Chapter 11. Life Outside Same-Origin Rules">Chapter 11</a> <span class="emphasis"><em>for an overview of mixed-content handling rules</em></span>.</p></li></ul></div></dd><dt><span class="term"><span class="strong"><strong>Open redirection</strong></span></span></dt><dd><p>A term used to refer to applications that perform HTTP- or script-based requests to user-supplied URLs without constraining the possible destinations in any meaningful way. Open redirection is not advisable and may be exploitable in some scenarios, but it is typically not particularly dangerous by itself.<a class="indexterm" id="IDX-CHP-18-0013"/></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch10.html" title="Chapter 10. Origin Inheritance">Chapter 10</a> <span class="emphasis"><em>for cases where unconstrained redirection may lead to XSS</em></span>.</p></li></ul></div></dd><dt><span class="term"><span class="bolditalic">Referer</span> <span class="strong"><strong>leakage</strong></span></span></dt><dd><p>Accidental disclosure of a sensitive URL by embedding an off-site subresource or providing an off-site link. Any security- or privacy-relevant data encoded in the URL of the parent document will be leaked in the <span class="emphasis"><em>Referer</em></span> header, with the exception of the fragment identifier.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch03.html" title="Chapter 3. Hypertext Transfer Protocol">Chapter 3</a> <span class="emphasis"><em>for an overview of the</em></span> Referer <span class="emphasis"><em>logic</em></span>.</p></li></ul></div></dd></dl></div></div></div>
<div class="sect1" title="Problems to Keep in Mind in Web Application Design"><div class="titlepage"><div><div><h1 class="title"><a id="problems_to_keep_in_mind_in_web_applicat"/>Problems to Keep in Mind in Web Application Design</h1></div></div></div><p>The problems outlined in this section are an unavoidable circumstance of doing business on the Internet and must be properly accounted for when designing or implementing new web apps.</p><div class="variablelist"><dl><dt><span class="term"><span class="strong"><strong>Cache poisoning</strong></span></span></dt><dd><p>The possibility of long-term pollution of the browser cache (or any interim proxies) with a fabricated, malicious version of the targeted web application. Encrypted web applications may be targeted due to response-splitting vulnerabilities. For nonencrypted traffic, active network attackers may be able to modify the responses received by the requestor, too.<a class="indexterm" id="IDX-CHP-18-0014"/></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch03.html" title="Chapter 3. Hypertext Transfer Protocol">Chapter 3</a> <span class="emphasis"><em>for an overview of HTTP-caching behaviors</em></span>.</p></li></ul></div></dd><dt><span class="term"><span class="strong"><strong>Clickjacking</strong></span></span></dt><dd><p>The possibility of framing or otherwise decorating or obscuring a portion of another web application so that the victim, when interacting with the attacker’s site, is not aware that individual clicks or keystrokes are delivered to the other site, resulting in undesirable actions being taken on behalf of the user.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch11.html" title="Chapter 11. Life Outside Same-Origin Rules">Chapter 11</a> <span class="emphasis"><em>for a discussion of clickjacking and related UI issues</em></span>.<a class="indexterm" id="IDX-CHP-18-0015"/></p></li></ul></div></dd><dt><span class="term"><span class="strong"><strong>Content and character set sniffing</strong></span></span></dt><dd><p>Describes the possibility that the browser will ignore any authoritative content type or character set information provided by the server and interpret the returned document incorrectly.<a class="indexterm" id="IDX-CHP-18-0016"/><a class="indexterm" id="IDX-CHP-18-0017"/><a class="indexterm" id="IDX-CHP-18-0018"/><a class="indexterm" id="IDX-CHP-18-0019"/><a class="indexterm" id="IDX-CHP-18-0020"/><a class="indexterm" id="IDX-CHP-18-0021"/><a class="indexterm" id="IDX-CHP-18-0022"/></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch13.html" title="Chapter 13. Content Recognition Mechanisms">Chapter 13</a> <span class="emphasis"><em>for a discussion of content-sniffing logic</em></span>.<a class="indexterm" id="IDX-CHP-18-0023"/></p></li><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch04.html" title="Chapter 4. Hypertext Markup Language">Chapter 4</a> <span class="emphasis"><em>and</em></span> <a class="xref" href="ch08.html" title="Chapter 8. Content Rendering with Browser Plug-ins">Chapter 8</a> <span class="emphasis"><em>for scenarios where</em></span> Content-Type <span class="emphasis"><em>data is ignored</em></span>.</p></li></ul></div></dd><dt><span class="term"><span class="strong"><strong>Cookie forcing (or cookie injection)</strong></span></span></dt><dd><p>The possibility of blindly injecting HTTP cookies into the context of an otherwise impenetrable web application due to issues in how the mechanism is designed and implemented in modern browsers. Cookie injection is of particular concern to HTTPS applications. (<span class="emphasis"><em>Cookie stuffing</em></span> is a less common term referring specifically to maliciously deleting cookies belonging to another application by overflowing the cookie jar.)<a class="indexterm" id="IDX-CHP-18-0024"/></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch09.html" title="Chapter 9. Content Isolation Logic">Chapter 9</a> <span class="emphasis"><em>for more information on cookie scoping</em></span>.</p></li><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch03.html" title="Chapter 3. Hypertext Transfer Protocol">Chapter 3</a> <span class="emphasis"><em>for a general discussion of the operation of HTTP cookies</em></span>.</p></li></ul></div></dd><dt><span class="term"><span class="strong"><strong>Denial-of-service (DoS) attacks</strong></span></span></dt><dd><p>A broad term denoting any opportunities for the attacker to bring down a browser or server or otherwise make the use of a particular targeted application significantly more difficult.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch14.html" title="Chapter 14. Dealing with Rogue Scripts">Chapter 14</a> <span class="emphasis"><em>for an overview of DoS considerations with JavaScript</em></span>.</p></li></ul></div></dd><dt><span class="term"><span class="strong"><strong>Framebusting</strong></span></span></dt><dd><p>The possibility of a framed page navigating the top-level document to a new URL without having to satisfy same-origin checks. The behavior may be exploited for phishing attacks or simply for petty mischief.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch11.html" title="Chapter 11. Life Outside Same-Origin Rules">Chapter 11</a> <span class="emphasis"><em>for this and other frame navigation quirks</em></span>.</p></li></ul></div></dd><dt><span class="term"><span class="strong"><strong>HTTP downgrade</strong></span></span></dt><dd><p>The ability for active attackers to prevent the user from reaching an HTTPS version of a particular site or to downgrade an existing HTTPS session to HTTP.<a class="indexterm" id="IDX-CHP-18-0025"/></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch03.html" title="Chapter 3. Hypertext Transfer Protocol">Chapter 3</a> <span class="emphasis"><em>for an overview of HTTPS</em></span>.</p></li><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch16.html" title="Chapter 16. New and Upcoming Security Features">Chapter 16</a> <span class="emphasis"><em>for Strict Transport Security, a proposed solution to the problem</em></span>.</p></li></ul></div></dd><dt><span class="term"><span class="strong"><strong>Network fenceposts</strong></span></span></dt><dd><p>The prospect of websites on the Internet leveraging the browser to interact with destinations not directly accessible to the attacker, for example, with the systems on a victim’s internal network. Such attacks can be performed blindly, or (with the help of attacks such as DNS rebinding) the attacker may be able to see responses to all requests.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch12.html" title="Chapter 12. Other Security Boundaries">Chapter 12</a> <span class="emphasis"><em>for an overview of non-SOP boundaries in a browser</em></span>.</p></li><li class="listitem"><p><span class="emphasis"><em>See</em></span> <a class="xref" href="ch15.html" title="Chapter 15. Extrinsic Site Privileges">Chapter 15</a> <span class="emphasis"><em>for Internet Explorer zone model, a potential approach to this risk</em></span>.</p></li></ul></div></dd></dl></div><div class="note" title="Note"><h3 class="title">Note</h3><p><span class="bolditalic">Beware non-buzzword bugs!</span> Not all vulnerabilities have catchy names. Web developers should be wary of many other implementation and design issues that are outside the scope of this book but that can nevertheless bite hard. Examples include weak pseudo-random number generators (especially for session management purposes); insufficient authentication and authorization checks (in particular, overly trusting the browser-originating data); incorrect uses of cryptography (inventing one’s own algorithms is usually a no-no); and so on. For a remarkably detailed discussion of these and many other failure patterns, see <span class="emphasis"><em>The Art of Software Security Assessment</em></span> by Dowd, McDonald, and Schuh (Addison-Wesley, 2006).<a class="indexterm" id="IDX-CHP-18-0026"/><a class="indexterm" id="IDX-CHP-18-0027"/><a class="indexterm" id="IDX-CHP-18-0028"/><a class="indexterm" id="IDX-CHP-18-0029"/><a class="indexterm" id="IDX-CHP-18-0030"/><a class="indexterm" id="IDX-CHP-18-0031"/></p></div></div>
<div class="sect1" title="Common Problems Unique to Server-Side Code"><div class="titlepage"><div><div><h1 class="title"><a id="common_problems_unique_to_server-side_co"/>Common Problems Unique to Server-Side Code</h1></div></div></div><p>The following issues are commonly encountered in the server-hosted portion of any web application and, by virtue of being tied to specific programming languages or software components, are unlikely to occur on the client side.</p><div class="variablelist"><dl><dt><span class="term"><span class="strong"><strong>Buffer overflow</strong></span></span></dt><dd><p>A condition where a program allows more information to be stored in a particular memory region than there is space to accommodate the incoming data, leading to the unexpected overwrite of other vital data structures. Buffer overflows happen chiefly in low-level programming languages, such as C or C++, and in these languages, they can be frequently leveraged to execute attacker-supplied code.<a class="indexterm" id="IDX-CHP-18-0032"/></p></dd><dt><span class="term"><span class="strong"><strong>Command injection (SQL, shell, PHP, and so on)</strong></span></span></dt><dd><p>A problem where, due to insufficient input filtering or output escaping, attacker-controlled strings may be unintentionally processed as statements in an interpreted language used by the application. (In a distant sense, this is similar to XSS.) The consequences depend on the capabilities of the language, but in most cases, code execution is the eventual outcome.</p></dd><dt><span class="term"><span class="strong"><strong>Directory traversal</strong></span></span></dt><dd><p>A problem where, due to insufficient input filtering (most commonly, the failure to properly recognize and handle “../” segments in filenames), an application can be tricked into reading or writing files at arbitrary locations on the disk. Any consequences depend on additional constraints, but unconstrained file-writing bugs are usually easily exploitable to run attacker-supplied code.</p></dd><dt><span class="term"><span class="strong"><strong>File inclusion</strong></span></span></dt><dd><p>If used without a qualifier or prefixed with <span class="emphasis"><em>local (LFI)</em></span>, the term is largely synonymous with read-related directory traversal. <span class="emphasis"><em>Remote file inclusion (RFI)</em></span>, on the other hand, is an alternative way to exploit file-inclusion vulnerabilities by specifying a URL rather than a valid file path. In some scripting languages, a single, common API opens local files and fetches remote URLs. In these cases, the ability to retrieve the file from an attacker-controlled server may offer substantial benefits, depending on how the data is subsequently processed.<a class="indexterm" id="IDX-CHP-18-0033"/><a class="indexterm" id="IDX-CHP-18-0034"/><a class="indexterm" id="IDX-CHP-18-0035"/></p></dd><dt><span class="term"><span class="strong"><strong>Format-string vulnerability</strong></span></span></dt><dd><p>A handful of commonly used library functions accept templates (“format strings”), followed by a set of parameters that the function is expected to insert into the template at predefined locations. Such an approach is particularly common in C (<span class="emphasis"><em>printf(...)</em></span>, <span class="emphasis"><em>syslog(...)</em></span>, and so on), but it is not limited to that language. Format-string vulnerabilities are caused by unintentionally permitting attackers to supply the template to one of these functions. Depending on the capabilities of the template system and the specifics of the language, this error may lead to anything from minor data leaks to code execution.<a class="indexterm" id="IDX-CHP-18-0036"/><a class="indexterm" id="IDX-CHP-18-0037"/><a class="indexterm" id="IDX-CHP-18-0038"/></p></dd><dt><span class="term"><span class="strong"><strong>Integer overflow</strong></span></span></dt><dd><p>A vulnerability specific to languages with limited or no range checking. The flaw is caused by the developer failing to detect that an integer exceeded the maximum possible value and rolled back to zero, to a very large negative integer, or to some other hardware-specific and unexpected result. Depending on how the value is used, this may put the program in an inconsistent state or, worse, lead to the reading or writing of data at an incorrect memory location (which, in turn, may lend itself to code execution). Integer <span class="emphasis"><em>underflow</em></span> is the opposite effect: crossing the minimum permissible value and rolling over to a very large positive integer.</p></dd><dt><span class="term"><span class="strong"><strong>Pointer management vulnerabilities</strong></span></span></dt><dd><p>In languages that encourage or require the use of raw memory pointers (chiefly C and C++), it is possible to use pointers that are either uninitialized or no longer valid (“dangling”), leading to vulnerabilities such as <span class="emphasis"><em>use after free</em></span>, <span class="emphasis"><em>double free</em></span>, and many more. These vulnerabilities will corrupt the internal state of the program and usually allow an attacker to execute attacker-supplied code.<a class="indexterm" id="IDX-CHP-18-0039"/></p></dd></dl></div></div></body></html>