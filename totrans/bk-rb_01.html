<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Strings, Numbers, Classes, and Objects"><div class="titlepage"><div><div><h1 class="title"><a id="strings_comma_numbers_comma_classes_comm"/>Chapter 1. Strings, Numbers, Classes, and Objects</h1></div></div></div><div class="informalfigure"><a id="image_no_caption-id1"/><div class="mediaobject"><a id="I_mediaobject1_d1e423"/><img src="httpatomoreillycomsourcenostarchimages860138.png.jpg" alt="image with no caption"/></div></div><p>The first thing to know about Ruby is that it’s easy to use. To prove this, let’s look at the code of the traditional “Hello world” program:</p><p><span class="emphasis"><em>1helloworld.rb</em></span></p><a id="I_programlisting1_d1e433"/><pre class="programlisting">puts 'hello world'</pre><p>That’s it in its entirety. The program contains one method, <code class="literal">puts</code>, and one string, “hello world.” It doesn’t have any headers or class definitions, and it doesn’t have any import sections or “main” functions. This really is as simple as it gets. Load the code, <span class="emphasis"><em>1helloworld.rb</em></span>, and try it.<a id="IDX-CHP-1-0001" class="indexterm"/></p><div class="sect1" title="Getting and Putting Input"><div class="titlepage"><div><div><h1 class="title"><a id="getting_and_putting_input"/>Getting and Putting Input</h1></div></div></div><p>Having “put” a string to the output (here, a command window), the obvious next step is to “get” a string. As you might guess, the Ruby method for this is <code class="literal">gets</code>. The <span class="emphasis"><em>2helloname.rb</em></span> program prompts the user for his or her name—let’s suppose it’s Fred—and then displays a greeting: “Hello Fred.” Here is the code:<a id="IDX-CHP-1-0002" class="indexterm"/><a id="IDX-CHP-1-0003" class="indexterm"/><a id="IDX-CHP-1-0004" class="indexterm"/><a id="IDX-CHP-1-0005" class="indexterm"/><a id="IDX-CHP-1-0006" class="indexterm"/></p><p><span class="emphasis"><em>2helloname.rb</em></span></p><a id="I_programlisting1_d1e483"/><pre class="programlisting">print( 'Enter your name: ' )
name = gets()
puts( "Hello #{name}" )</pre><p>Although this is still very simple, a few important details need to be explained. First, notice that I’ve used <code class="literal">print</code> rather than <code class="literal">puts</code> to display the prompt. This is because <code class="literal">puts</code> adds a line feed at the end of the printed string, whereas <code class="literal">print</code> does not; in this case, I want the cursor to remain on the same line as the prompt.<a id="IDX-CHP-1-0007" class="indexterm"/></p><p>On the next line, I use <code class="literal">gets()</code> to read in a string when the user presses <span class="keycap">enter</span>. This string is assigned to the variable <code class="literal">name</code>. I have not predeclared this variable, nor have I specified its type. In Ruby, you can create variables as and when you need them, and the interpreter “infers” their types. In the example, I have assigned a string to <code class="literal">name</code> so Ruby knows that the type of the <code class="literal">name</code> variable must be a string.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>Ruby is case sensitive. A variable called <code class="literal">myvar</code> is different from one called <code class="literal">myVar</code>. A variable such as <code class="literal">name</code> in the sample project must begin with a lowercase character. If it begins with an uppercase character, Ruby will treat it as a constant. I’ll have more to say on constants in <a class="xref" href="ch06.html" title="Chapter 6. Conditional Statements">Chapter 6</a>.</p></div><p>Incidentally, the parentheses following <code class="literal">gets()</code> are optional, as are the parentheses enclosing the strings after <code class="literal">print</code> and <code class="literal">puts</code>; the code would run just the same if you removed them. However, parentheses can help resolve ambiguities, and in some cases, the interpreter will warn you if you omit them.<a id="IDX-CHP-1-0008" class="indexterm"/><a id="IDX-CHP-1-0009" class="indexterm"/></p></div></div>
<div class="sect1" title="Strings and Embedded Evaluation"><div class="titlepage"><div><div><h1 class="title"><a id="strings_and_embedded_evaluation"/>Strings and Embedded Evaluation</h1></div></div></div><p>The last line in the sample code is rather interesting:</p><a id="I_programlisting1_d1e561"/><pre class="programlisting">puts( "Hello #{name}" )</pre><p>Here the <code class="literal">name</code> variable is embedded into the string. You do this by placing the variable between two curly brackets preceded by a <span class="emphasis"><em>hash mark</em></span> (or “number” or “pound” character), as in <code class="literal">#{}</code>. This kind of <span class="emphasis"><em>embedded</em></span> evaluation works only with strings delimited by double quotes. If you were to try this with a string delimited by single quotes, the variable would not be evaluated, and the string <code class="literal">'Hello #{name}'</code> would be displayed exactly as entered.</p><p>You can also embed nonprinting characters such as newlines (<code class="literal">"\n"</code>) and tabs (<code class="literal">"\t"</code>), and you can even embed bits of program code and mathematical expressions. For instance, let’s assume you have a method called <code class="literal">showname</code> that returns the string “Fred.” The following string would, in the process of evaluation, call the <code class="literal">showname</code> method and display “Hello Fred”:<a id="IDX-CHP-1-0010" class="indexterm"/><a id="IDX-CHP-1-0011" class="indexterm"/></p><a id="I_programlisting1_d1e602"/><pre class="programlisting">puts "Hello #{showname}"</pre><p>See whether you can figure out what would be displayed by the following:</p><p><span class="emphasis"><em>3string_eval.rb</em></span></p><a id="I_programlisting1_d1e609"/><pre class="programlisting">puts( "\n\t#{(1 + 2) * 3}\nGoodbye" )</pre><p>Now run the <span class="emphasis"><em>3string_eval.rb</em></span> program to see whether you are right.</p></div>
<div class="sect1" title="Numbers"><div class="titlepage"><div><div><h1 class="title"><a id="numbers"/>Numbers</h1></div></div></div><p>Numbers are just as easy to use as strings. For example, let’s suppose you want to calculate the selling price or grand total of some item based on its pretax value or subtotal. To do this, you would need to multiply the subtotal by the applicable tax rate and add the result to the value of the subtotal. Assuming the subtotal to be $100 and the tax rate to be 17.5 percent, this Ruby program does the calculation and displays the result:<a id="IDX-CHP-1-0012" class="indexterm"/></p><p><span class="emphasis"><em>4calctax.rb</em></span></p><a id="I_programlisting1_d1e627"/><pre class="programlisting">subtotal = 100.00
taxrate = 0.175
tax = subtotal * taxrate
puts "Tax on $#{subtotal} is $#{tax}, so grand total is $#{subtotal+tax}"</pre><p>Obviously, this program would be more useful if it could perform calculations on a variety of subtotals rather than calculating the same value time after time! Here is a simple calculator that prompts the user to enter a subtotal:</p><a id="I_programlisting1_d1e631"/><pre class="programlisting">taxrate = 0.175
print "Enter price (ex tax): "
s = gets
subtotal = s.to_f
tax = subtotal * taxrate
puts "Tax on $#{subtotal} is $#{tax}, so grand total is $#{subtotal+tax}"</pre><p>Here <code class="literal">s.to_f</code> is a method of the String class. It attempts to convert the string to a floating-point number. For example, the string <code class="literal">"145.45"</code> would be converted to the floating-point number 145.45. If the string cannot be converted, 0.0 is returned. For instance, <code class="literal">"Hello world".to_f</code> would return 0.0.</p></div>
<div class="sect1" title="Comments"><div class="titlepage"><div><div><h1 class="title"><a id="comments"/>Comments</h1></div></div></div><p>Many of the source code examples that come with this book are documented with comments that are ignored by the Ruby interpreter. You can place a comment after the hash mark (<code class="literal">#</code>). The text on a line following this character is all treated as a comment:<a id="IDX-CHP-1-0013" class="indexterm"/><a id="IDX-CHP-1-0014" class="indexterm"/><a id="IDX-CHP-1-0015" class="indexterm"/><a id="IDX-CHP-1-0016" class="indexterm"/><a id="IDX-CHP-1-0017" class="indexterm"/><a id="IDX-CHP-1-0018" class="indexterm"/><a id="IDX-CHP-1-0019" class="indexterm"/></p><a id="I_programlisting1_d1e677"/><pre class="programlisting"># this is a comment
puts( "hello" ) # this is also a comment</pre><p>If you want to comment out multiple lines of text, you can place <code class="literal">=begin</code> at the start and <code class="literal">=end</code> at the end (both <code class="literal">=begin</code> and <code class="literal">=end</code> must be flush with the left margin):<a id="IDX-CHP-1-0020" class="indexterm"/><a id="IDX-CHP-1-0021" class="indexterm"/><a id="IDX-CHP-1-0022" class="indexterm"/><a id="IDX-CHP-1-0023" class="indexterm"/></p><a id="I_programlisting1_d1e706"/><pre class="programlisting">=begin
 This is a
 multiline
 comment
=end</pre></div>
<div class="sect1" title="Testing a Condition: if..then"><div class="titlepage"><div><div><h1 class="title"><a id="testing_a_condition_colon_if..then"/>Testing a Condition: if..then</h1></div></div></div><p>The problem with the simple tax calculator code shown earlier is that it accepts negative subtotals and calculates negative tax on them—a situation upon which the government is unlikely to look favorably! I therefore need to check for negative numbers and, when found, set them to zero. This is my new version of the code:</p><p><span class="emphasis"><em>5taxcalculator.rb</em></span></p><a id="I_programlisting1_d1e716"/><pre class="programlisting">taxrate = 0.175
print "Enter price (ex tax): "
s = gets
subtotal = s.to_f

if (subtotal &lt; 0.0)  then
  subtotal = 0.0
end

tax = subtotal * taxrate
puts "Tax on $#{subtotal} is $#{tax}, so grand total is $#{subtotal+tax}"</pre><p>The Ruby <code class="literal">if</code> test is similar to an <code class="literal">if</code> test in other programming languages. Note, however, that the parentheses are once again optional, as is the keyword <code class="literal">then</code>. However, if you were to write the following, with no line break after the test condition, the <code class="literal">then</code> would be obligatory:</p><a id="I_programlisting1_d1e732"/><pre class="programlisting">if (subtotal &lt; 0.0) then subtotal = 0.0 end</pre><p>Putting everything on one line like this adds nothing to the clarity of the code, which is why I tend to avoid it. My long familiarity with Pascal instinctively makes me want to add a <code class="literal">then</code> after the <code class="literal">if</code> condition, but because this really is not required, you may look upon this as a willful eccentricity of mine. The <code class="literal">end</code> keyword that terminates the <code class="literal">if</code> block is <span class="emphasis"><em>not</em></span> optional. If you forget to add it, your code will not run.<a id="IDX-CHP-1-0024" class="indexterm"/><a id="IDX-CHP-1-0025" class="indexterm"/><a id="IDX-CHP-1-0026" class="indexterm"/><a id="IDX-CHP-1-0027" class="indexterm"/><a id="IDX-CHP-1-0028" class="indexterm"/></p></div>
<div class="sect1" title="Local and Global Variables"><div class="titlepage"><div><div><h1 class="title"><a id="local_and_global_variables"/>Local and Global Variables</h1></div></div></div><p>In the previous example, I assigned values to variables such as <code class="literal">subtotal</code>, <code class="literal">tax</code>, and <code class="literal">taxrate</code>. Variables such as these that begin with a lowercase character are called <span class="emphasis"><em>local variables</em></span>. This means they exist only within a specific part of a program—in other words, they are restricted to a well-defined scope. Here is an example:<a id="IDX-CHP-1-0029" class="indexterm"/><a id="IDX-CHP-1-0030" class="indexterm"/></p><p><span class="emphasis"><em>variables.rb</em></span></p><a id="I_programlisting1_d1e800"/><pre class="programlisting">localvar = "hello"
$globalvar = "goodbye"

def amethod
    localvar = 10
    puts( localvar )
    puts( $globalvar )
end

def anotherMethod
    localvar = 500
    $globalvar = "bonjour"
    puts( localvar )
    puts( $globalvar )
end</pre><p>In the previous code, there are two functions (or <span class="emphasis"><em>methods</em></span>), <code class="literal">amethod</code> and <code class="literal">anotherMethod</code>, each of which is declared using the keyword <code class="literal">def</code> and contains code up to the keyword <code class="literal">end</code>. There are three local variables called <code class="literal">localvar</code>. One is assigned the value <code class="literal">"hello"</code> within the “main scope” of the program; two others are assigned integers within the scope of two separate methods. Since each local variable has a different scope, the assignments have no effect on the other local variables with the same name in different scopes. You can verify this by calling the methods in turn. The following examples show output in comments followed by the <code class="literal">=&gt;</code> characters. In this book, output or returned values will often be indicated in this way:<a id="IDX-CHP-1-0031" class="indexterm"/></p><a id="I_programlisting1_d1e832"/><pre class="programlisting">amethod           #=&gt; localvar = 10
anotherMethod     #=&gt; localvar = 500
amethod           #=&gt; localvar = 10
puts( localvar )  #=&gt; localvar = "hello"</pre><p>On the other hand, a <span class="emphasis"><em>global variable</em></span>—one that begins with the dollar sign character (<code class="literal">$</code>)—has global scope. When an assignment is made to a global variable inside a method, that affects the value of that variable elsewhere in the program too:<a id="IDX-CHP-1-0032" class="indexterm"/><a id="IDX-CHP-1-0033" class="indexterm"/></p><a id="I_programlisting1_d1e848"/><pre class="programlisting">amethod            #=&gt;  $globalvar = "goodbye"
anotherMethod      #=&gt;  $globalvar = "bonjour"
amethod            #=&gt;  $globalvar = "bonjour"
puts( $globalvar ) #=&gt;  $globalvar = "bonjour"</pre></div>
<div class="sect1" title="Classes and Objects"><div class="titlepage"><div><div><h1 class="title"><a id="classes_and_objects"/>Classes and Objects</h1></div></div></div><p>Instead of going through all the rest of Ruby’s syntax—its types, loops, modules, and so on—let’s move rapidly on and look at how to create classes and objects. (But fear not, we’ll return to those other topics soon.)<a id="IDX-CHP-1-0034" class="indexterm"/><a id="IDX-CHP-1-0035" class="indexterm"/></p><div class="sidebar"><a id="basic_terminology_colon_classes_comma_ob"/><p class="title">Basic Terminology: Classes, Objects, and Methods</p><p>A class is the blueprint for an object. It defines the data an object contains and the way it behaves. Many different objects can be created from a single class. So, you might have one Cat <span class="emphasis"><em>class</em></span> but three cat <span class="emphasis"><em>objects</em></span>: tiddles, cuddles, and flossy. A <span class="emphasis"><em>method</em></span> is like a function or subroutine that is defined inside the class.</p></div><p>It may seem like no big deal to say that Ruby is object-oriented. Aren’t all languages these days? Well, up to a point. Most modern “object-oriented” languages (Java, C++, C#, Object Pascal, and so on) have a greater or lesser degree of object-oriented programming (OOP) features. Ruby, on the other hand, is obsessively object-oriented. In fact, unless you have programmed in Smalltalk or Eiffel (languages that are even more obsessive than Ruby about objects), it is likely to be the most object-oriented language you have ever used. Every chunk of data—from a simple number or string to something more complicated like a file or a module—is treated as an object. And almost everything you do with an object is done by a method. Even operators such as plus (<code class="literal">+</code>) and minus (<code class="literal">−</code>) are methods. Consider the following:<a id="IDX-CHP-1-0036" class="indexterm"/><a id="IDX-CHP-1-0037" class="indexterm"/></p><a id="I_programlisting1_d1e889"/><pre class="programlisting">x = 1 + 2</pre><p>Here <code class="literal">+</code> is a method of the Fixnum (Integer) object 1. The value 2 is sent to this method; the result, 3, is returned, and this is assigned to the object x. Incidentally, the assignment operator (<code class="literal">=</code>) is one of the rare exceptions to the rule that “everything you do with an object is done by a method.” The assignment operator is a special built-in “thingummy” (this is not the formal terminology, I hasten to add), and it is not a method of anything.</p><p>Now you’ll see how to create objects of your own. As in most other OOP languages, a Ruby object is defined by a class. The class is like a blueprint from which individual objects are constructed. For example, this class defines a dog:</p><p><span class="emphasis"><em>6dogs.rb</em></span></p><a id="I_programlisting1_d1e904"/><pre class="programlisting">class Dog
    def set_name( aName )
       @myname = aName
    end
end</pre><p>Note that the class definition begins with the keyword <code class="literal">class</code> (all lowercase) and the name of the class itself, which must begin with an uppercase letter. The class contains a method called <code class="literal">set_name</code>. This takes an incoming argument, <code class="literal">aName</code>. The body of the method assigns the value of <code class="literal">aName</code> to a variable called <code class="literal">@myname</code>.</p><div class="sect2" title="Instance Variables"><div class="titlepage"><div><div><h2 class="title"><a id="instance_variables"/>Instance Variables</h2></div></div></div><p>Variables beginning with the at sign (<code class="literal">@</code>) are <span class="emphasis"><em>instance variables</em></span>, which means they belong to individual objects (or <span class="emphasis"><em>instances</em></span>) of the class. It is not necessary to predeclare instance variables. I can create instances of the Dog class (that is, “dog objects”) by calling the <code class="literal">new</code> method. Here I am creating two dog objects (note that although class names begin with uppercase letters, object names begin with lowercase letters):<a id="IDX-CHP-1-0038" class="indexterm"/><a id="IDX-CHP-1-0039" class="indexterm"/></p><a id="I_programlisting1_d1e948"/><pre class="programlisting">mydog = Dog.new
yourdog = Dog.new</pre><p>At the moment, these two dogs have no names. So, the next thing I do is call the <code class="literal">set_name</code> method to give them names:</p><a id="I_programlisting1_d1e955"/><pre class="programlisting">mydog.set_name( 'Fido' )
yourdog.set_name( 'Bonzo' )</pre></div><div class="sect2" title="Retrieving Data from an Object"><div class="titlepage"><div><div><h2 class="title"><a id="retrieving_data_from_an_object"/>Retrieving Data from an Object</h2></div></div></div><p>Having given each dog a name, I need to have some way to find out their names later. How should I do this? I can’t poke around inside an object to get at the <code class="literal">@name</code> variable, since the internal details of each object are known only to the object itself. This is a fundamental principle of “pure” object orientation: The data inside each object is private. There are precisely defined ways into each object (for example, the method <code class="literal">set_name</code>) and precisely defined ways out. Only the object itself can mess around with its internal state; the outside world cannot. This is called <span class="emphasis"><em>data hiding</em></span>, and it is part of the principle of <span class="emphasis"><em>encapsulation</em></span>.</p><div class="sidebar"><a id="encapsulation"/><p class="title">Encapsulation</p><p><span class="emphasis"><em>Encapsulation</em></span> describes the fact that an object contains both its own data and the methods required to manipulate that data. Some object-oriented languages encourage or enforce <span class="emphasis"><em>data hiding</em></span> so that the data encapsulated within an object cannot be accessed by code outside that object. In Ruby, data hiding is not quite as rigorously enforced as it initially appears. You can use some very dirty tricks to mess around inside an object, but to keep things simple, I’ll silently pass over these features of the language for now.<a id="IDX-CHP-1-0040" class="indexterm"/><a id="IDX-CHP-1-0041" class="indexterm"/><a id="IDX-CHP-1-0042" class="indexterm"/></p></div><p>Since you need each dog to know its own name, let’s provide the Dog class with a <code class="literal">get_name</code> method:</p><a id="I_programlisting1_d1e1001"/><pre class="programlisting">def get_name
    return @myname
end</pre><p>The <code class="literal">return</code> keyword here is optional. When it is omitted, Ruby methods will return the last expression evaluated. However, for the sake of clarity—and to avoid unexpected results from methods more complex than this one—I will make a habit of explicitly returning any values that I plan to use.</p><p>Finally, let’s give the dog some behavior by asking it to talk. Here is the finished class definition:</p><a id="I_programlisting1_d1e1010"/><pre class="programlisting">class Dog
    def set_name( aName )
       @myname = aName
    end

    def get_name
       return @myname
    end

    def talk
       return 'woof!'
    end
end</pre><p>Now, you can create a dog, name it, display its name, and ask it to talk:</p><a id="I_programlisting1_d1e1014"/><pre class="programlisting">mydog = Dog.new
mydog.set_name( 'Fido' )
puts(mydog.get_name)
puts(mydog.talk)</pre><p>I’ve written an expanded version of this code in the <span class="emphasis"><em>6dogs.rb</em></span> program. This also contains a Cat class that is similar to the Dog class except that its <code class="literal">talk</code> method, naturally enough, returns a <span class="emphasis"><em>meow</em></span> instead of a <span class="emphasis"><em>woof</em></span>.</p><div class="sidebar"><a id="what_happens_when_a_variable_is_unassign"/><p class="title">What Happens When a Variable Is Unassigned?</p><p>Oops! It seems that this program contains an error. The object named <code class="literal">someotherdog</code> never has a value assigned to its <code class="literal">@name variable</code> since its <code class="literal">set_name()</code> method is never called. This means the following code, which attempts to print its name, cannot succeed:<a id="IDX-CHP-1-0043" class="indexterm"/></p><a id="I_programlisting1_d1e1048"/><pre class="programlisting">puts(someotherdog.get_name)</pre><p>Fortunately, Ruby doesn’t blow up when you try to display this dog’s name. Instead, it just prints “nil.” You’ll shortly look at a simple way of making sure that errors like this don’t happen again.</p></div></div><div class="sect2" title="Messages, Methods, and Polymorphism"><div class="titlepage"><div><div><h2 class="title"><a id="messages_comma_methods_comma_and_polymor"/>Messages, Methods, and Polymorphism</h2></div></div></div><p>This cats and dogs example, incidentally, is based on a classic Smalltalk demo program that illustrates how the same “message” (such as <code class="literal">talk</code>) can be sent to different objects (such as cats and dogs), and each different object responds differently to the same message with its own special method (here the <code class="literal">talk</code> method). The ability to have different classes containing methods with the same name goes by the fancy object-oriented name of <span class="emphasis"><em>polymorphism</em></span>.<a id="IDX-CHP-1-0044" class="indexterm"/><a id="IDX-CHP-1-0045" class="indexterm"/><a id="IDX-CHP-1-0046" class="indexterm"/></p><p>When you run a program such as <span class="emphasis"><em>6dogs.rb</em></span>, the code is executed in sequence. The code of the classes themselves is not executed until instances of those classes (that is, objects) are created by the code at the bottom of the program. You will see that I frequently mix class definitions with “free-standing” bits of code that execute when the program is run. This may not be the way you would want to write a major application, but for just trying things, it is extremely convenient.</p><div class="sidebar"><a id="free-standing_bits_of_code_question"/><p class="title">Free-Standing Bits of Code?</p><p>If Ruby is really an object-oriented language, you may think it’s odd that you can enter “free-floating” methods. In fact, when you run a program, Ruby creates a main object, and any code that appears inside your main code unit—that is, the main Ruby code file you have loaded and run—is actually running inside that object. You can easily verify this by creating a new source file and adding the following code:<a id="IDX-CHP-1-0047" class="indexterm"/></p><a id="I_programlisting1_d1e1088"/><pre class="programlisting">puts self
puts self.class</pre><p>When you run this program, you’ll see the following output:</p><a id="I_programlisting1_d1e1092"/><pre class="programlisting">main
Object</pre></div><p>One obvious defect of this program is that the two classes, Cat and Dog, are highly repetitious. It would make more sense to have one class, Animal, that has <code class="literal">get_name</code> and <code class="literal">set_name</code> methods and two descendant classes, Cat and Dog, that contain only the behavior specific to that species of animal (woofing or meowing). We’ll find out how to do this in the next chapter.<a id="IDX-CHP-1-0048" class="indexterm"/></p></div><div class="sect2" title="Constructors: new and initialize"><div class="titlepage"><div><div><h2 class="title"><a id="constructors_colon_new_and_initialize"/>Constructors: new and initialize</h2></div></div></div><p>Let’s take a look at another example of a user-defined class. Load <span class="emphasis"><em>7treasure.rb</em></span>. This is an adventure game in the making. It contains two classes, Thing and Treasure. The Thing class is similar to the Cat and Dog classes from the previous program—except that it doesn’t woof or meow, that is.</p><p><span class="emphasis"><em>7treasure.rb</em></span></p><a id="I_programlisting1_d1e1116"/><pre class="programlisting">class Thing
    def set_name( aName )
        @name = aName
    end

    def get_name
        return @name
    end
end

class Treasure
      def initialize( aName, aDescription )
        @name         = aName
        @description  = aDescription
      end

      def to_s # override default to_s method
       "The #{@name} Treasure is #{@description}\n"
      end
end

thing1 = Thing.new
thing1.set_name( "A lovely Thing" )
puts thing1.get_name

t1 = Treasure.new("Sword", "an Elvish weapon forged of gold")
t2 = Treasure.new("Ring", "a magic ring of great power")
puts t1.to_s
puts t2.to_s
# The inspect method lets you look inside an object
puts "Inspecting 1st treasure: #{t1.inspect}"</pre><p>The Treasure class doesn’t have <code class="literal">get_name</code> and <code class="literal">set_name</code> methods. Instead, it contains a method named <code class="literal">initialize</code>, which takes two arguments. Those two values are then assigned to the <code class="literal">@name</code> and <code class="literal">@description</code> variables. When a class contains a method named <code class="literal">initialize</code>, it will be called automatically when an object is created using the <code class="literal">new</code> method. This makes it a convenient place to set the values of an object’s instance variables.<a id="IDX-CHP-1-0049" class="indexterm"/><a id="IDX-CHP-1-0050" class="indexterm"/><a id="IDX-CHP-1-0051" class="indexterm"/><a id="IDX-CHP-1-0052" class="indexterm"/></p><p>This has two clear benefits over setting each instance variable using methods such <code class="literal">set_name</code>. First, a complex class may contain numerous instance variables, and you can set the values of all of them with the single <code class="literal">initialize</code> method rather than with many separate “set” methods; second, if the variables are all automatically initialized at the time of object creation, you will never end up with an “empty” variable (like the “nil” value returned when you tried to display the name of someotherdog in the previous program).<a id="IDX-CHP-1-0053" class="indexterm"/><a id="IDX-CHP-1-0054" class="indexterm"/><a id="IDX-CHP-1-0055" class="indexterm"/></p><p>Finally, I have created a method called <code class="literal">to_s</code>, which returns a string representation of a Treasure object. The method name, <code class="literal">to_s</code>, is not arbitrary—the same method name is used throughout the standard Ruby object hierarchy. In fact, the <code class="literal">to_s</code> method is defined for the Object class itself, which is the ultimate ancestor of all other classes in Ruby (with the exception of the BasicObject class, which you’ll look at more closely in the next chapter). By redefining the <code class="literal">to_s</code> method, I have added new behavior that is more appropriate to the Treasure class than the default method. In other words, I have <span class="emphasis"><em>overridden</em></span> its <code class="literal">to_s</code> method.</p><p>Since the <code class="literal">new</code> method creates an object, it can be thought of as the object’s <span class="emphasis"><em>constructor</em></span>. A constructor is a method that allocates memory for an object and then executes the <code class="literal">initialize</code> method, if it exists, to assign any specified values to the new object’s internal variables. You should not normally implement your own version of the <code class="literal">new</code> method. Instead, when you want to perform any “setup” actions, do so in the <code class="literal">initialize</code> method.</p><div class="sidebar"><a id="garbage_collection"/><p class="title">Garbage Collection</p><p>In many languages (such as C++ and Delphi for Win32), it is the programmer’s responsibility to destroy any object that has been created when it is no longer required. In other words, objects are given <span class="emphasis"><em>destructors</em></span> as well as constructors. This isn’t necessary in Ruby, since a built-in <span class="emphasis"><em>garbage collector</em></span> automatically destroys objects and reclaims the memory they used when they are no longer referenced in your program.<a id="IDX-CHP-1-0056" class="indexterm"/></p></div></div><div class="sect2" title="Inspecting Objects"><div class="titlepage"><div><div><h2 class="title"><a id="inspecting_objects"/>Inspecting Objects</h2></div></div></div><p>Notice that in the <span class="emphasis"><em>7treasure.rb</em></span> program I “looked inside” the Treasure object t1 using the <code class="literal">inspect</code> method:<a id="IDX-CHP-1-0057" class="indexterm"/></p><a id="I_programlisting1_d1e1243"/><pre class="programlisting">puts "Inspecting 1st treasure: #{t1.inspect}"</pre><p>The <code class="literal">inspect</code> method is defined for all Ruby objects. It returns a string containing a human-readable representation of the object. In the present case, it displays something like this:</p><a id="I_programlisting1_d1e1250"/><pre class="programlisting">#&lt;Treasure:0x28962f8 @description="an Elvish weapon forged of gold", @name="Sword"&gt;</pre><p>This begins with the class name, Treasure. This is followed by a number, which may be different from the number shown earlier—this is Ruby’s internal identification code for this particular object. Next the names and values of the object’s variables are shown.</p><p>Ruby also provides the <code class="literal">p</code> method as a shortcut to inspect objects and print their details, like this:</p><a id="I_programlisting1_d1e1259"/><pre class="programlisting">p( anobject )</pre><p>where <code class="literal">anobject</code> can be any type of Ruby object. For example, let’s suppose you create the following three objects: a string, a number, and a Treasure object:<a id="IDX-CHP-1-0058" class="indexterm"/></p><p><span class="emphasis"><em>p.rb</em></span></p><a id="I_programlisting1_d1e1272"/><pre class="programlisting">class Treasure
    def initialize( aName, aDescription )
      @name         = aName
      @description  = aDescription
    end

    def to_s # override default to_s method
         "The #{@name} Treasure is #{@description}\n"
    end
end

a = "hello"
b = 123
c = Treasure.new( "ring", "a glittery gold thing" )</pre><p>Now you can use <code class="literal">p</code> to display those objects:</p><a id="I_programlisting1_d1e1280"/><pre class="programlisting">p( a )
p( b )
p( c )</pre><p>This is what Ruby displays:</p><a id="I_programlisting1_d1e1284"/><pre class="programlisting">"hello"
123
#&lt;Treasure:0x3489c4 @name="ring", @description="a glittery gold thing"&gt;</pre><p>To see how you can use <code class="literal">to_s</code> with a variety of objects and test how a Treasure object would be converted to a string in the absence of an overridden <code class="literal">to_s</code> method, try the <span class="emphasis"><em>8to_s.rb</em></span> program.</p><p><span class="emphasis"><em>8to_s.rb</em></span></p><a id="I_programlisting1_d1e1300"/><pre class="programlisting">puts(Class.to_s)        #=&gt; Class
puts(Object.to_s)       #=&gt; Object
puts(String.to_s)       #=&gt; String
puts(100.to_s)          #=&gt; 100
puts(Treasure.to_s)     #=&gt; Treasure</pre><p>As you will see, classes such as Class, Object, String, and Treasure simply return their names when the <code class="literal">to_s</code> method is called. An object, such as the Treasure object t, returns its identifier—which is the same identifier returned by the <code class="literal">inspect</code> method:<a id="IDX-CHP-1-0059" class="indexterm"/><a id="IDX-CHP-1-0060" class="indexterm"/></p><a id="I_programlisting1_d1e1318"/><pre class="programlisting">t = Treasure.new( "Sword", "A lovely Elvish weapon" )
puts(t.to_s)
    #=&gt; #&lt;Treasure:0x3308100&gt;
puts(t.inspect)
    #=&gt; #&lt;Treasure:0x3308100 @name="Sword", @description="A lovely Elvish weapon"&gt;</pre><p>Although the <span class="emphasis"><em>7treasure.rb</em></span> program may lay the foundations for a game containing a variety of different object types, its code is still repetitive. After all, why have a Thing class that contains a name and a Treasure class that also contains a name? It would make more sense to regard a Treasure as a “type of” Thing. In a complete game, other objects such as Rooms and Weapons might be yet other types of Thing. It is clearly time to start working on a proper class hierarchy, which is what you will do in the next chapter.</p></div></div></body></html>