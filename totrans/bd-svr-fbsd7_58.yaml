- en: Chapter 25\. PROCMAIL 3.22
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[HTTP://WWW.PROCMAIL.ORG](HTTP://WWW.PROCMAIL.ORG)'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 25.1\. SUMMARY
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Procmail is a mail filter, or Mail Delivery Agent (MDA), that is used to process
    incoming email in accordance with a set of specified rules or actions. These actions
    can include forwarding email to a different address, routing flagged spam messages
    into a Junk folder, sending auto-reply messages, and so forth. Processing can
    be applied to all incoming messages, or limited to messages that contain certain
    tags or strings.
  prefs: []
  type: TYPE_NORMAL
- en: Setting up Procmail rules can be challenging for new users. The "[Resources](resources.html#resources)"
    section lists sites that host numerous examples and recipes to help with configuration.
    This guide will provide details on using Procmail to divert flagged spam into
    a separate Junk folder.
  prefs: []
  type: TYPE_NORMAL
- en: Procmail was originally created by Stephen R. van den Berg in 1990\. In 1998,
    Philip Guenther became Procmail's maintainer; he continues to lead development
    efforts.
  prefs: []
  type: TYPE_NORMAL
- en: 25.2\. RESOURCES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Procmail Documentation Project
  prefs: []
  type: TYPE_NORMAL
- en: '[http://pm-doc.sourceforge.net](http://pm-doc.sourceforge.net)'
  prefs: []
  type: TYPE_NORMAL
- en: Procmail FAQ (Era Eriksson)
  prefs: []
  type: TYPE_NORMAL
- en: '[http://partmaps.org/era/procmail/mini-faq.html](http://partmaps.org/era/procmail/mini-faq.html)'
  prefs: []
  type: TYPE_NORMAL
- en: 25.3\. REQUIRED
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) FreeBSD 7.0-RELEASE
    (see "[FreeBSD 7.0](freebsd_7.0_split_000.html#freebsd_7.0)")'
  prefs: []
  type: TYPE_IMG
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) Updated ports
    collection (see "[FreeBSD Ports Collection](freebsd_ports_collection.html#freebsd_ports_collection)")'
  prefs: []
  type: TYPE_IMG
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) Postfix SMTP
    server (see "[Postfix SMTP Server 2.5.1](postfix_smtp_server_2.5.1.html#postfix_smtp_server_2.5.1)")'
  prefs: []
  type: TYPE_IMG
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) SpamAssassin
    (see "[SpamAssassin 3.2.4](spamassassin_3.2.4.html#spamassassin_3.2.4)")'
  prefs: []
  type: TYPE_IMG
- en: '![](N2QyLy9jZ3QvODFzcGVtaTlnNTRmOTk1N2kzMWFyczMvZzAwcC5uVQ--.jpg) Internet
    connection'
  prefs: []
  type: TYPE_NORMAL
- en: 25.4\. PREPARATION
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Become the superuser.
  prefs: []
  type: TYPE_NORMAL
- en: 25.5\. INSTALL
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To begin the Procmail installation process, enter the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: The installation process will pause to allow you to add directories to the test-lock
    routines. We'll accept the default, so press [enter] to continue.
  prefs: []
  type: TYPE_NORMAL
- en: 25.6\. CONFIGURE
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Once the installation is complete, it is time to configure Procmail for use
    on your system.
  prefs: []
  type: TYPE_NORMAL
- en: 'Create a global configuration file (i.e., one that affects all users) to route
    email flagged as spam by SpamAssassin to a subfolder of each user''s inbox, called
    Junk:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Add the following lines:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Save and exit.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Add a line to Postfix''s main.cf file to specify Procmail as the Local Mail
    Delivery Agent. Open main.cf:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Scroll to the bottom of main.cf using [ctrl-U] and add this line:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Save, exit, and reload Postfix''s configuration:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 25.7\. TESTING
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In this section, we'll perform tests to confirm that Procmail delivers mail
    to users' mailboxes correctly.
  prefs: []
  type: TYPE_NORMAL
- en: 'Send a test spam message into the mail system. First, open a telnet connection:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** Your hostname should appear instead of [host.example.com](http://host.example.com).'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Enter the following (substituting your domain for [example.com](http://example.com)):'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** You can specify a different recipient if you like. The spamd account
    will be present on your system if you used the SpamAssassin guide in this book.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Next, enter the following lines as shown, pressing [enter] after each line.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** The long string is known as the GTUBE (Generic Test for Unsolicited
    Bulk Email). It will cause SpamAssassin to flag the message as spam.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** The italicized ID tag will be different in your output.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Finally, close the connection:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Give the mail system a minute to process the message, then examine the Procmail
    log file in the recipient''s home directory:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'If Procmail processed the message successfully, you should see output similar
    to this:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 25.8\. CONFIG FILES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: /usr/local/etc/procmailrc
  prefs: []
  type: TYPE_NORMAL
- en: The global Procmail configuration file. This file also contains recipes for
    processing mail messages.
  prefs: []
  type: TYPE_NORMAL
- en: /usr/home/username/.procmailrc
  prefs: []
  type: TYPE_NORMAL
- en: User-specific Procmail configuration file. The recipes in this file are processed
    after processing the recipes in /usr/local/etc/procmailrc. By default, environment
    variables from /usr/local/etc/procmailrc carry over to this file and should not
    be specified again. All folders are relative to the user's Maildir folder.
  prefs: []
  type: TYPE_NORMAL
- en: 25.9\. LOG FILES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: /usr/home/username/proc.log
  prefs: []
  type: TYPE_NORMAL
- en: Contains a log of messages processed by Procmail for username
  prefs: []
  type: TYPE_NORMAL
- en: /var/log/maillog
  prefs: []
  type: TYPE_NORMAL
- en: General log of email activity
  prefs: []
  type: TYPE_NORMAL
- en: 25.10\. NOTES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'For examples of Procmail recipes, see the procmailex manual page:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
