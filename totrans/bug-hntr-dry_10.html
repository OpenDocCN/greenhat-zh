<html><head></head><body><div class="appendix" title="Appendix&#xA0;B.&#xA0;Debugging"><div class="titlepage"><div><div><h1 class="title"><a id="debugging"/>Appendix B. Debugging</h1></div></div></div><p>This appendix contains information about debuggers and the debugging process.<a id="IDX-APP-B-0068" class="indexterm"/><a id="IDX-APP-B-0069" class="indexterm"/><a id="IDX-APP-B-0070" class="indexterm"/></p><div class="sect1" title="B.1 The Solaris Modular Debugger (mdb)"><div class="titlepage"><div><div><h1 class="title"><a id="b.1_the_solaris_modular_debugger_open_pa"/>B.1 The Solaris Modular Debugger (mdb)</h1></div></div></div><p>The following tables list some useful commands of the Solaris Modular Debugger (mdb). For a complete list of available commands, see the <span class="emphasis"><em>Solaris Modular Debugger Guide</em></span>.<sup>[<a href="apbs05.html#ftn.APP-B-FN-1" class="footnoteref">91</a>]</sup></p><div class="sect2" title="Starting and Stopping mdb"><div class="titlepage"><div><div><h2 class="title"><a id="starting_and_stopping_mdb"/>Starting and Stopping mdb</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">mdb</code> <em class="replaceable"><code>program</code></em></p></td><td style="text-align: left" valign="top"><p>Starts mdb with <em class="replaceable"><code>program</code></em> to debug.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">mdb</code> <em class="replaceable"><code>unix.&lt;n&gt; vmcore.&lt;n&gt;</code></em></p></td><td style="text-align: left" valign="top"><p>Runs mdb on a kernel crash dump (<em class="replaceable"><code>unix.&lt;n&gt;</code></em> and <em class="replaceable"><code>vmcore.&lt;n&gt;</code></em> can typically be found in the directory <em class="replaceable"><code>/var/crash/&lt;hostname&gt;</code></em>).</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">$q</code></p></td><td style="text-align: left" valign="top"><p>Exits the debugger.</p></td></tr></tbody></table></div></div><div class="sect2" title="General Commands"><div class="titlepage"><div><div><h2 class="title"><a id="general_commands"/>General Commands</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">::run</code> <em class="replaceable"><code>arguments</code></em></p></td><td style="text-align: left" valign="top"><p>Runs the program with the given <em class="replaceable"><code>arguments</code></em>. If the target is currently running or it is a corefile, mdb will restart the program if possible.</p></td></tr></tbody></table></div></div><div class="sect2" title="Breakpoints"><div class="titlepage"><div><div><h2 class="title"><a id="breakpoints"/>Breakpoints</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><em class="replaceable"><code>address</code></em><code class="literal">::bp</code></p></td><td style="text-align: left" valign="top"><p>Sets a new breakpoint at the <em class="replaceable"><code>address</code></em> of the breakpoint location that is specified in the command.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">$b</code></p></td><td style="text-align: left" valign="top"><p>Lists information about existing breakpoints.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">::delete</code> <em class="replaceable"><code>number</code></em></p></td><td style="text-align: left" valign="top"><p>Removes previously set breakpoints specified by their <em class="replaceable"><code>number</code></em>.</p></td></tr></tbody></table></div></div><div class="sect2" title="Running the Debuggee"><div class="titlepage"><div><div><h2 class="title"><a id="running_the_debuggee"/>Running the Debuggee</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">:s</code></p></td><td style="text-align: left" valign="top"><p>Executes a single instruction. Will step into subfunctions.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">:e</code></p></td><td style="text-align: left" valign="top"><p>Executes a single instruction. Will not enter subfunctions.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">:c</code></p></td><td style="text-align: left" valign="top"><p>Resumes execution.</p></td></tr></tbody></table></div></div><div class="sect2" title="Examining Data"><div class="titlepage"><div><div><h2 class="title"><a id="examining_data"/>Examining Data</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><em class="replaceable"><code>address</code></em>,<em class="replaceable"><code>count format</code></em></p></td><td style="text-align: left" valign="top"><p>Prints the specified number of objects (<em class="replaceable"><code>count</code></em>) found at <em class="replaceable"><code>address</code></em> in the specified <em class="replaceable"><code>format</code></em>; example formats include B (hexadecimal, 1-byte), X (hexadecimal, 4-byte), S (string).</p></td></tr></tbody></table></div></div><div class="sect2" title="Information Commands"><div class="titlepage"><div><div><h2 class="title"><a id="information_commands"/>Information Commands</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">$r</code></p></td><td style="text-align: left" valign="top"><p>Lists registers and their contents.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">$c</code></p></td><td style="text-align: left" valign="top"><p>Prints a backtrace of all stack frames.</p></td></tr><tr><td style="text-align: left" valign="top"><p><em class="replaceable"><code>address</code></em><code class="literal">::dis</code></p></td><td style="text-align: left" valign="top"><p>Dumps a range of memory around <em class="replaceable"><code>address</code></em> as machine instructions.</p></td></tr></tbody></table></div></div><div class="sect2" title="Other Commands"><div class="titlepage"><div><div><h2 class="title"><a id="other_commands"/>Other Commands</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">::status</code></p></td><td style="text-align: left" valign="top"><p>Prints a summary of information related to the current target.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">::msgbuf</code></p></td><td style="text-align: left" valign="top"><p>Displays the message buffer, including all console messages up to a kernel panic.<a id="IDX-APP-B-0071" class="indexterm"/></p></td></tr></tbody></table></div></div></div></div>
<div class="sect1" title="B.2 The Windows Debugger (WinDbg)"><div class="titlepage"><div><div><h1 class="title"><a id="b.2_the_windows_debugger_open_parenthesi"/>B.2 The Windows Debugger (WinDbg)</h1></div></div></div><p>The following tables list some useful debugger commands of WinDbg. For a complete list of available commands, see Mario Hewardt and Daniel Pravat’s <span class="emphasis"><em>Advanced Windows Debugging</em></span> (Addison-Wesley Professional, 2007) or the documentation that comes with WinDbg.<a id="IDX-APP-B-0072" class="indexterm"/><a id="IDX-APP-B-0073" class="indexterm"/></p><div class="sect2" title="Starting and Stopping a Debugging Session"><div class="titlepage"><div><div><h2 class="title"><a id="starting_and_stopping_a_debugging_sessio"/>Starting and Stopping a Debugging Session</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">File</code> ▸ <code class="literal">Open Executable...</code></p></td><td style="text-align: left" valign="top"><p>Click <span class="strong"><strong>Open Executable</strong></span> on the File menu to start a new user-mode process and debug it.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">File</code> ▸ <code class="literal">Attach to a Process...</code></p></td><td style="text-align: left" valign="top"><p>Click <span class="strong"><strong>Attach to a Process</strong></span> on the File menu to debug a user-mode application that is currently running.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">q</code></p></td><td style="text-align: left" valign="top"><p>Ends the debugging session.</p></td></tr></tbody></table></div></div><div class="sect2" title="General Commands"><div class="titlepage"><div><div><h2 class="title"><a id="general_commands-id1"/>General Commands</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">g</code></p></td><td style="text-align: left" valign="top"><p>Begins or resumes execution on the target.</p></td></tr></tbody></table></div></div><div class="sect2" title="Breakpoints"><div class="titlepage"><div><div><h2 class="title"><a id="breakpoints-id1"/>Breakpoints</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">bp</code> <em class="replaceable"><code>address</code></em></p></td><td style="text-align: left" valign="top"><p>Sets a new breakpoint at the <em class="replaceable"><code>address</code></em> of the breakpoint location that is specified in the command.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">bl</code></p></td><td style="text-align: left" valign="top"><p>Lists information about existing breakpoints.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">bc</code> <em class="replaceable"><code>breakpoint ID</code></em></p></td><td style="text-align: left" valign="top"><p>Removes previously set breakpoints specified by their <em class="replaceable"><code>breakpoint ID</code></em>.</p></td></tr></tbody></table></div></div><div class="sect2" title="Running the Debuggee"><div class="titlepage"><div><div><h2 class="title"><a id="running_the_debuggee-id1"/>Running the Debuggee</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">t</code></p></td><td style="text-align: left" valign="top"><p>Executes a single instruction or source line and, optionally, displays the resulting values of all registers and flags. Will step into subfunctions.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">p</code></p></td><td style="text-align: left" valign="top"><p>Executes a single instruction or source line and, optionally, displays the resulting values of all registers and flags. Will not enter subfunctions.</p></td></tr></tbody></table></div></div><div class="sect2" title="Examining Data"><div class="titlepage"><div><div><h2 class="title"><a id="examining_data-id1"/>Examining Data</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">dd</code> <em class="replaceable"><code>address</code></em></p></td><td style="text-align: left" valign="top"><p>Displays the contents of <em class="replaceable"><code>address</code></em> as double-word values (4 bytes).</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">du</code> <em class="replaceable"><code>address</code></em></p></td><td style="text-align: left" valign="top"><p>Displays the contents of <em class="replaceable"><code>address</code></em> as unicode characters.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">dt</code></p></td><td style="text-align: left" valign="top"><p>Displays information about a local variable, global variable, or data type, including structures and unions.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">poi(</code><em class="replaceable"><code>address</code></em><code class="literal">)</code></p></td><td style="text-align: left" valign="top"><p>Returns pointer-sized data from the specified <em class="replaceable"><code>address</code></em>. Depending on the architecture the pointer size is 32 bits or 64 bits.</p></td></tr></tbody></table></div></div><div class="sect2" title="Information Commands"><div class="titlepage"><div><div><h2 class="title"><a id="information_commands-id1"/>Information Commands</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command<a id="IDX-APP-B-0074" class="indexterm"/></p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">r</code></p></td><td style="text-align: left" valign="top"><p>Lists registers and their contents.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">kb</code></p></td><td style="text-align: left" valign="top"><p>Prints a backtrace of all stack frames.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">u</code> <em class="replaceable"><code>address</code></em></p></td><td style="text-align: left" valign="top"><p>Dumps a range of memory around <em class="replaceable"><code>address</code></em> as machine instructions.</p></td></tr></tbody></table></div></div><div class="sect2" title="Other Commands"><div class="titlepage"><div><div><h2 class="title"><a id="other_commands-id1"/>Other Commands</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">!analyze -v</code></p></td><td style="text-align: left" valign="top"><p>This debugger extension displays a lot of useful information about an exception or bug check.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">!drvobj</code> <em class="replaceable"><code>DRIVER_OBJECT</code></em></p></td><td style="text-align: left" valign="top"><p>This debugger extension displays detailed information about a <em class="replaceable"><code>DRIVER_OBJECT</code></em>.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">.sympath</code></p></td><td style="text-align: left" valign="top"><p>This command changes the default path of the debugger for symbol search.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">.reload</code></p></td><td style="text-align: left" valign="top"><p>This command deletes all symbol information and reloads these symbols as needed.</p></td></tr></tbody></table></div></div></div>
<div class="sect1" title="B.3 Windows Kernel Debugging"><div class="titlepage"><div><div><h1 class="title"><a id="b.3_windows_kernel_debugging"/>B.3 Windows Kernel Debugging</h1></div></div></div><p>In order to analyze the vulnerability described in <a class="xref" href="ch06.html" title="Chapter 6. One Kernel to Rule Them All">Chapter 6</a>, I needed a way to debug the Windows kernel. I set up a debugging environment with VMware<sup>[<a href="apbs05.html#ftn.APP-B-FN-2" class="footnoteref">92</a>]</sup> and WinDbg<sup>[<a href="apbs05.html#ftn.APP-B-FN-3" class="footnoteref">93</a>]</sup> by following these steps:<a id="IDX-APP-B-0075" class="indexterm"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p><span class="emphasis"><em>Throughout this section, I used the following software versions: VMware Workstation 6.5.2 and WinDbg 6.10.3.233</em></span>.</p></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Step 1: Configure the VMware guest system for remote kernel debugging.<a id="IDX-APP-B-0076" class="indexterm"/></p></li><li class="listitem"><p>Step 2: Adjust the <span class="emphasis"><em>boot.ini</em></span> of the guest system.</p></li><li class="listitem"><p>Step 3: Configure WinDbg on the VMware host for Windows kernel debugging.</p></li></ul></div><div class="sect2" title="Step 1: Configure the VMware Guest System for Remote Kernel Debugging"><div class="titlepage"><div><div><h2 class="title"><a id="step_1_colon_configure_the_vmware_guest"/>Step 1: Configure the VMware Guest System for Remote Kernel Debugging</h2></div></div></div><p>After I installed a Windows XP SP3 VMware guest system, I powered it off and chose <span class="strong"><strong>Edit Virtual Machine Settings</strong></span> from the Commands section of VMware. I then clicked the <span class="strong"><strong>Add</strong></span> button to add a new serial port and chose the configuration settings shown in <a class="xref" href="apbs03.html#output_to_named_pipe" title="Figure B-1. Output to named pipe">Figure B-1</a> and <a class="xref" href="apbs03.html#named_pipe_configuration" title="Figure B-2. Named pipe configuration">Figure B-2</a>.</p><div class="figure"><a id="output_to_named_pipe"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e11208"/><img src="httpatomoreillycomsourcenostarchimages939345.png.jpg" alt="Output to named pipe"/></div></div><p class="title">Figure B-1. Output to named pipe</p></div><div class="figure"><a id="named_pipe_configuration"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e11216"/><img src="httpatomoreillycomsourcenostarchimages939347.png.jpg" alt="Named pipe configuration"/></div></div><p class="title">Figure B-2. Named pipe configuration</p></div><p>After the new serial port was successfully added, I selected the Yield CPU on poll checkbox of the “I/O mode” section, as shown in <a class="xref" href="apbs03.html#configuration_settings_for_the_new_seria" title="Figure B-3. Configuration settings for the new serial port">Figure B-3</a>.</p><div class="figure"><a id="configuration_settings_for_the_new_seria"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e11228"/><img src="httpatomoreillycomsourcenostarchimages939349.png.jpg" alt="Configuration settings for the new serial port"/></div></div><p class="title">Figure B-3. Configuration settings for the new serial port</p></div></div><div class="sect2" title="Step 2: Adjust the boot.ini of the Guest System"><div class="titlepage"><div><div><h2 class="title"><a id="step_2_colon_adjust_the_boot.ini_of_the"/>Step 2: Adjust the boot.ini of the Guest System</h2></div></div></div><p>I then powered up the VMware guest system and edited the <span class="emphasis"><em>boot.ini</em></span> file of Windows XP to contain the following entries (the bold one enabled kernel debugging):</p><a id="I_programlisting_d1e11241"/><pre class="programlisting">[boot loader]
timeout=30
default=multi(0)disk(0)rdisk(0)partition(1)\WINDOWS
[operating systems]
multi(0)disk(0)rdisk(0)partition(1)\WINDOWS="Microsoft Windows XP
 Professional" /noexecute=optin /fastdetect
<strong class="userinput"><code>multi(0)disk(0)rdisk(0)partition(1)\WINDOWS="Microsoft</code></strong>
 <strong class="userinput"><code>Windows XP Professional - Debug" /fastdetect /debugport=com1</code></strong></pre><p>I then rebooted the guest system and chose the new entry <span class="strong"><strong>Microsoft Windows XP Professional – Debug [debugger enabled]</strong></span> from the boot menu to start the system, as shown in <a class="xref" href="apbs03.html#new_boot_menu_option" title="Figure B-4. New boot menu option">Figure B-4</a>.</p><div class="figure"><a id="new_boot_menu_option"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e11258"/><img src="httpatomoreillycomsourcenostarchimages939351.png.jpg" alt="New boot menu option"/></div></div><p class="title">Figure B-4. New boot menu option</p></div></div><div class="sect2" title="Step 3: Configure WinDbg on the VMware Host for Windows Kernel Debugging"><div class="titlepage"><div><div><h2 class="title"><a id="step_3_colon_configure_windbg_on_the_vmw"/>Step 3: Configure WinDbg on the VMware Host for Windows Kernel Debugging</h2></div></div></div><p>The only thing left was to configure WinDbg on the VMware host so that it attached to the kernel of the VMware guest system using a pipe. To do this, I created a batch file with the content shown in <a class="xref" href="apbs03.html#windbg_batch_file_for_kernel_debugging" title="Figure B-5. WinDbg batch file for kernel debugging">Figure B-5</a>.</p><div class="figure"><a id="windbg_batch_file_for_kernel_debugging"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e11273"/><img src="httpatomoreillycomsourcenostarchimages939353.png.jpg" alt="WinDbg batch file for kernel debugging"/></div></div><p class="title">Figure B-5. WinDbg batch file for kernel debugging</p></div><p>I then double-clicked the batch file to attach WinDbg on the VMware host to the kernel of the VMware Windows XP guest system, as shown in <a class="xref" href="apbs03.html#attaching_the_kernel_debugger_open_paren" title="Figure B-6. Attaching the kernel debugger (WinDbg)">Figure B-6</a>.<a id="IDX-APP-B-0077" class="indexterm"/><a id="IDX-APP-B-0078" class="indexterm"/></p><div class="figure"><a id="attaching_the_kernel_debugger_open_paren"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e11291"/><img src="httpatomoreillycomsourcenostarchimages939355.png.jpg" alt="Attaching the kernel debugger (WinDbg)"/></div></div><p class="title">Figure B-6. Attaching the kernel debugger (WinDbg)</p></div></div></div>
<div class="sect1" title="B.4 The GNU Debugger (gdb)"><div class="titlepage"><div><div><h1 class="title"><a id="b.4_the_gnu_debugger_open_parenthesis_gd"/>B.4 The GNU Debugger (gdb)</h1></div></div></div><p>The following tables list some useful commands of the GNU Debugger (gdb). For a complete list of available commands, see the gdb online documentation.<sup>[<a href="apbs05.html#ftn.APP-B-FN-4" class="footnoteref">94</a>]</sup><a id="IDX-APP-B-0079" class="indexterm"/></p><div class="sect2" title="Starting and Stopping gdb"><div class="titlepage"><div><div><h2 class="title"><a id="starting_and_stopping_gdb"/>Starting and Stopping gdb</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">gdb</code> <em class="replaceable"><code>program</code></em></p></td><td style="text-align: left" valign="top"><p>Starts gdb with <em class="replaceable"><code>program</code></em> to debug.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">quit</code></p></td><td style="text-align: left" valign="top"><p>Exits the debugger.</p></td></tr></tbody></table></div></div><div class="sect2" title="General Commands"><div class="titlepage"><div><div><h2 class="title"><a id="general_commands-id2"/>General Commands</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">run</code> <em class="replaceable"><code>arguments</code></em></p></td><td style="text-align: left" valign="top"><p>Starts debugged program (with <em class="replaceable"><code>arguments</code></em>).</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">attach</code> <em class="replaceable"><code>processID</code></em></p></td><td style="text-align: left" valign="top"><p>Attaches the debugger to the running process with <em class="replaceable"><code>processID</code></em>.</p></td></tr></tbody></table></div></div><div class="sect2" title="Breakpoints"><div class="titlepage"><div><div><h2 class="title"><a id="breakpoints-id2"/>Breakpoints</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">break &lt;</code><em class="replaceable"><code>file</code></em><code class="literal">:&gt; function</code></p></td><td style="text-align: left" valign="top"><p>Sets a breakpoint at the beginning of the specified <em class="replaceable"><code>function</code></em> (in <em class="replaceable"><code>file</code></em>).</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">break &lt;</code><em class="replaceable"><code>file</code></em><code class="literal">:&gt; line number</code></p></td><td style="text-align: left" valign="top"><p>Sets a breakpoint at the start of the code for that <em class="replaceable"><code>line number</code></em> (in <em class="replaceable"><code>file</code></em>).</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">break *</code><em class="replaceable"><code>address</code></em></p></td><td style="text-align: left" valign="top"><p>Sets a breakpoint at the specified <em class="replaceable"><code>address</code></em>.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">info breakpoints</code></p></td><td style="text-align: left" valign="top"><p>Lists information about existing breakpoints.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">delete</code> <em class="replaceable"><code>number</code></em></p></td><td style="text-align: left" valign="top"><p>Removes previously set breakpoints specified by their <em class="replaceable"><code>number</code></em>.</p></td></tr></tbody></table></div></div><div class="sect2" title="Running the Debuggee"><div class="titlepage"><div><div><h2 class="title"><a id="running_the_debuggee-id2"/>Running the Debuggee</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">stepi</code></p></td><td style="text-align: left" valign="top"><p>Executes one machine instruction. Will step into subfunctions.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">nexti</code></p></td><td style="text-align: left" valign="top"><p>Executes one machine instruction. Will not enter subfunctions.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">continue</code></p></td><td style="text-align: left" valign="top"><p>Resumes execution.</p></td></tr></tbody></table></div></div><div class="sect2" title="Examining Data"><div class="titlepage"><div><div><h2 class="title"><a id="examining_data-id2"/>Examining Data</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">x/</code><em class="replaceable"><code>CountFormatSize address</code></em></p></td><td style="text-align: left" valign="top"><p>Prints the specified number of objects (<em class="replaceable"><code>Count</code></em>) of the specified <em class="replaceable"><code>Size</code></em> according to the <em class="replaceable"><code>Format</code></em> at <em class="replaceable"><code>address</code></em>.</p>
<p>Size: <code class="literal">b</code> (byte), <code class="literal">h</code> (halfword), <code class="literal">w</code> (word), <code class="literal">g</code> (giant, 8 bytes).</p>
<p>Format: <code class="literal">o</code> (octal), <code class="literal">x</code> (hexadecimal), <code class="literal">d</code> (decimal), <code class="literal">u</code> (unsigned decimal), <code class="literal">t</code> (binary), <code class="literal">f</code> (float), <code class="literal">a</code> (address), <code class="literal">i</code> (instruction), <code class="literal">c</code> (char), <code class="literal">s</code> (string).</p></td></tr></tbody></table></div></div><div class="sect2" title="Information Commands"><div class="titlepage"><div><div><h2 class="title"><a id="information_commands-id2"/>Information Commands</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command</p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">info registers</code></p></td><td style="text-align: left" valign="top"><p>Lists registers and their contents.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">backtrace</code></p></td><td style="text-align: left" valign="top"><p>Prints a backtrace of all stack frames.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">disassemble</code> <em class="replaceable"><code>address</code></em></p></td><td style="text-align: left" valign="top"><p>Dumps a range of memory around <em class="replaceable"><code>address</code></em> as machine instructions.</p></td></tr></tbody></table></div></div><div class="sect2" title="Other Commands"><div class="titlepage"><div><div><h2 class="title"><a id="other_commands-id2"/>Other Commands</h2></div></div></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Command<a id="IDX-APP-B-0080" class="indexterm"/><a id="IDX-APP-B-0081" class="indexterm"/><a id="IDX-APP-B-0082" class="indexterm"/><a id="IDX-APP-B-0083" class="indexterm"/><a id="IDX-APP-B-0084" class="indexterm"/></p></th><th style="text-align: left" valign="bottom"><p>Description</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">set disassembly-flavor</code> <em class="replaceable"><code>intel</code></em><code class="literal">|</code><em class="replaceable"><code>att</code></em><a id="IDX-APP-B-0085" class="indexterm"/></p></td><td style="text-align: left" valign="top"><p>Sets the disassembly flavor to Intel or AT&amp;T assembly syntax. Default is AT&amp;T syntax.<a id="IDX-APP-B-0086" class="indexterm"/><a id="IDX-APP-B-0087" class="indexterm"/></p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">shell</code> <em class="replaceable"><code>command</code></em></p></td><td style="text-align: left" valign="top"><p>Executes a shell <em class="replaceable"><code>command</code></em>.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">set variable *(</code><em class="replaceable"><code>address</code></em><code class="literal">)=</code><em class="replaceable"><code>value</code></em></p></td><td style="text-align: left" valign="top"><p>Stores <em class="replaceable"><code>value</code></em> at the memory location specified by <em class="replaceable"><code>address</code></em>.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">source</code> <em class="replaceable"><code>file</code></em></p></td><td style="text-align: left" valign="top"><p>Reads debugger commands from a <em class="replaceable"><code>file</code></em>.</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">set follow-fork-mode</code> <em class="replaceable"><code>parent</code></em><code class="literal">|</code><em class="replaceable"><code>child</code></em></p></td><td style="text-align: left" valign="top"><p>Tells the debugger to follow the <em class="replaceable"><code>child</code></em> or <em class="replaceable"><code>parent</code></em> process.</p></td></tr></tbody></table></div></div></div>
<div class="sect1" title="B.5 Using Linux as a Mac OS X Kernel-Debugging Host"><div class="titlepage"><div><div><h1 class="title"><a id="b.5_using_linux_as_a_mac_os_x_kernel-deb"/>B.5 Using Linux as a Mac OS X Kernel-Debugging Host</h1></div></div></div><p>In this section, I will detail the steps I performed to prepare a Linux system as a debugging host for the Mac OS X kernel:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Step 1: Install an ancient Red Hat 7.3 Linux operating system.<a id="IDX-APP-B-0088" class="indexterm"/></p></li><li class="listitem"><p>Step 2: Get the necessary software packages.</p></li><li class="listitem"><p>Step 3: Build Apple’s debugger on the Linux host.<a id="IDX-APP-B-0089" class="indexterm"/></p></li><li class="listitem"><p>Step 4: Prepare the debugging environment.</p></li></ul></div><div class="sect2" title="Step 1: Install an Ancient Red Hat 7.3 Linux Operating System"><div class="titlepage"><div><div><h2 class="title"><a id="step_1_colon_install_an_ancient_red_hat"/>Step 1: Install an Ancient Red Hat 7.3 Linux Operating System</h2></div></div></div><p>Because Apple’s GNU Debugger (gdb) version that I used needs a GNU C Compiler (gcc) less than version 3 to build correctly, I downloaded and installed an ancient Red Hat 7.3 Linux system.<sup>[<a href="apbs05.html#ftn.APP-B-FN-5" class="footnoteref">95</a>]</sup> To install the Red Hat system, I chose the installation type Custom. When I was asked to select the packages to install (Package Group Selection), I chose only the packages Network Support and Software Development, as well as OpenSSH server from the individual package selection. These packages include all the necessary development tools and libraries to build Apple’s gdb under Linux. During the installation, I added an unprivileged user called <code class="literal">tk</code> with a home directory under <span class="emphasis"><em>/home/tk</em></span>.</p></div><div class="sect2" title="Step 2: Get the Necessary Software Packages"><div class="titlepage"><div><div><h2 class="title"><a id="step_2_colon_get_the_necessary_software"/>Step 2: Get the Necessary Software Packages</h2></div></div></div><p>After I had successfully installed the Linux host, I downloaded the following software packages:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Source code of Apple’s custom gdb version.<sup>[<a href="apbs05.html#ftn.APP-B-FN-6" class="footnoteref">96</a>]</sup></p></li><li class="listitem"><p>Standard gdb source code from GNU.<sup>[<a href="apbs05.html#ftn.APP-B-FN-7" class="footnoteref">97</a>]</sup></p></li><li class="listitem"><p>A patch for Apple’s gdb to compile under Linux.<sup>[<a href="apbs05.html#ftn.APP-B-FN-8" class="footnoteref">98</a>]</sup></p></li><li class="listitem"><p>The appropriate source code version of the XNU kernel. I prepared the Linux debugging host to research the kernel bug described in <a class="xref" href="ch07.html" title="Chapter 7. A Bug Older Than 4.4BSD">Chapter 7</a>, so I downloaded the XNU version 792.13.8.<sup>[<a href="apbs05.html#ftn.APP-B-FN-9" class="footnoteref">99</a>]</sup><a id="IDX-APP-B-0090" class="indexterm"/></p></li><li class="listitem"><p>The appropriate version of Apple’s Kernel Debug Kit. I found the bug explored in <a class="xref" href="ch07.html" title="Chapter 7. A Bug Older Than 4.4BSD">Chapter 7</a> on Mac OS X 10.4.8, so I downloaded the corresponding Kernel Debug Kit version 10.4.8 (<span class="emphasis"><em>Kernel_Debug_Kit_10.4.8_8L2127.dmg</em></span>).<a id="IDX-APP-B-0091" class="indexterm"/></p></li></ul></div></div><div class="sect2" title="Step 3: Build Apple’s Debugger on the Linux Host"><div class="titlepage"><div><div><h2 class="title"><a id="step_3_colon_build_appleas_debugger_on_t"/>Step 3: Build Apple’s Debugger on the Linux Host</h2></div></div></div><p>After I downloaded the necessary software packages onto the Linux host, I unpacked the two versions of gdb:</p><a id="I_programlisting_d1e11863"/><pre class="programlisting">linux$ <strong class="userinput"><code>tar xvzf gdb-292.tar.gz</code></strong>
linux$ <strong class="userinput"><code>tar xvzf gdb-5.3.tar.gz</code></strong></pre><p>Then I replaced the <span class="emphasis"><em>mmalloc</em></span> directory of Apple’s source tree with the one from GNU gdb:</p><a id="I_programlisting_d1e11875"/><pre class="programlisting">linux$ <strong class="userinput"><code>mv gdb-292/src/mmalloc gdb-292/src/old_mmalloc</code></strong>
linux$ <strong class="userinput"><code>cp -R gdb-5.3/mmalloc gdb-292/src/</code></strong></pre><p>I applied the patch to Apple’s gdb version:</p><a id="I_programlisting_d1e11884"/><pre class="programlisting">linux$ <strong class="userinput"><code>cd gdb-292/src/</code></strong>
linux$ <strong class="userinput"><code>patch -p2 &lt; ../../osx_gdb.patch</code></strong>
patching file gdb/doc/stabs.texinfo
patching file gdb/fix-and-continue.c
patching file gdb/mach-defs.h
patching file gdb/macosx/macosx-nat-dyld.h
patching file gdb/mi/mi-cmd-stack.c</pre><p>I used the following commands to build the necessary libraries:</p><a id="I_programlisting_d1e11894"/><pre class="programlisting">linux$ <strong class="userinput"><code>su</code></strong>
Password:

linux# <strong class="userinput"><code>pwd</code></strong>
/home/tk/gdb-292/src

linux# <strong class="userinput"><code>cd readline</code></strong>
linux# <strong class="userinput"><code>./configure; make</code></strong>

linux# <strong class="userinput"><code>cd ../bfd</code></strong>
linux# <strong class="userinput"><code>./configure --target=i386-apple-darwin</code></strong>
 <strong class="userinput"><code>--program-suffix=_osx; make;</code></strong>                      → <strong class="userinput"><code>make install</code></strong>

linux# <strong class="userinput"><code>cd ../mmalloc</code></strong>
linux# <strong class="userinput"><code>./configure; make; make install</code></strong>

linux# <strong class="userinput"><code>cd ../intl</code></strong>
linux# <strong class="userinput"><code>./configure; make; make install</code></strong>

linux# <strong class="userinput"><code>cd ../libiberty</code></strong>
linux# <strong class="userinput"><code>./configure; make; make install</code></strong>

linux# <strong class="userinput"><code>cd ../opcodes</code></strong>
linux# <strong class="userinput"><code>./configure --target=i386-apple-darwin --program</code></strong>
<strong class="userinput"><code>-suffix=_osx; make;</code></strong>                      → <strong class="userinput"><code>make install</code></strong></pre><p>To build the debugger itself, I needed to copy some header files from the XNU kernel source code to the <span class="emphasis"><em>include</em></span> directory of the Linux host:</p><a id="I_programlisting_d1e11957"/><pre class="programlisting">linux# <strong class="userinput"><code>cd /home/tk</code></strong>
linux# <strong class="userinput"><code>tar -zxvf xnu-792.13.8.tar.gz</code></strong>
linux# <strong class="userinput"><code>cp -R xnu-792.13.8/osfmk/i386/ /usr/include/</code></strong>
linux# <strong class="userinput"><code>cp -R xnu-792.13.8/bsd/i386/ /usr/include/</code></strong>
cp: overwrite `/usr/include/i386/Makefile'? <strong class="userinput"><code>y</code></strong>
cp: overwrite `/usr/include/i386/endian.h'? <strong class="userinput"><code>y</code></strong>
cp: overwrite `/usr/include/i386/exec.h'? <strong class="userinput"><code>y</code></strong>
cp: overwrite `/usr/include/i386/setjmp.h'? <strong class="userinput"><code>y</code></strong>
linux# <strong class="userinput"><code>cp -R xnu-792.13.8/osfmk/mach /usr/include/</code></strong></pre><p>I then commented some typedefs in the new <span class="emphasis"><em>_types.h</em></span> file to avoid compile-time conflicts (see line 39, lines 43 to 49, and lines 78 to 81):</p><a id="I_programlisting_d1e11992"/><pre class="programlisting">linux# <strong class="userinput"><code>vi +38 /usr/include/i386/_types.h</code></strong>
[..]
     38 #ifdef __GNUC__
     <strong class="userinput"><code>39 // typedef __signed char           __int8_t;</code></strong>
     40 #else   /* !__GNUC__ */
     41 typedef char                    __int8_t;
     42 #endif  /* !__GNUC__ */
     <strong class="userinput"><code>43 // typedef unsigned char           __uint8_t;</code></strong>
     <strong class="userinput"><code>44 // typedef short                   __int16_t;</code></strong>
     <strong class="userinput"><code>45 // typedef unsigned short          __uint16_t;</code></strong>
     <strong class="userinput"><code>46 // typedef int                     __int32_t;</code></strong>
     <strong class="userinput"><code>47 // typedef unsigned int            __uint32_t;</code></strong>
     <strong class="userinput"><code>48 // typedef long long               __int64_t;</code></strong>
     <strong class="userinput"><code>49 // typedef unsigned long long      __uint64_t;</code></strong>
     ..
     <strong class="userinput"><code>78 //typedef union {</code></strong>
     <strong class="userinput"><code>79 //      char            __mbstate8[128];</code></strong>
     <strong class="userinput"><code>80 //      long long       _mbstateL;                      /* for alignment */</code></strong>
     <strong class="userinput"><code>81 //} __mbstate_t;</code></strong>
[..]</pre><p>I added a new <code class="literal">include</code> to the file <span class="emphasis"><em>/home/tk/gdb-292/src/gdb/macosx/i386-macosx-tdep.c</em></span> (see line 24):</p><a id="I_programlisting_d1e12043"/><pre class="programlisting">linux# <strong class="userinput"><code>vi +24 /home/tk/gdb-292/src/gdb/macosx/i386-macosx-tdep.c</code></strong>
[..]
     <strong class="userinput"><code>24 #include &lt;string.h&gt;</code></strong>
     25 #include "defs.h"
     26 #include "frame.h"
     27 #include "inferior.h"
[..]</pre><p>Finally, I compiled the debugger with the following commands:</p><a id="I_programlisting_d1e12053"/><pre class="programlisting">linux# <strong class="userinput"><code>cd gdb-292/src/gdb/</code></strong>
linux# <strong class="userinput"><code>./configure --target=i386-apple-darwin --program-suffix=_osx --disable-gdbtk</code></strong>
linux# <strong class="userinput"><code>make; make install</code></strong></pre><p>After the compilation completed, I ran the new debugger as root so that the necessary directories could be created under <span class="emphasis"><em>/usr/local/bin/</em></span>:</p><a id="I_programlisting_d1e12068"/><pre class="programlisting">linux# <strong class="userinput"><code>cd /home/tk</code></strong>
linux# <strong class="userinput"><code>gdb_osx -q</code></strong>
(gdb) <strong class="userinput"><code>quit</code></strong></pre><p>After that, the debugger was ready.</p></div><div class="sect2" title="Step 4: Prepare the Debugging Environment"><div class="titlepage"><div><div><h2 class="title"><a id="step_4_colon_prepare_the_debugging_envir"/>Step 4: Prepare the Debugging Environment</h2></div></div></div><p>I unpacked the downloaded Kernel Debug Kit disk image file (dmg) under Mac OS X, transferred the files per <code class="literal">scp</code> to the Linux host, and named the directory <span class="emphasis"><em>KernelDebugKit_10.4.8</em></span>. I also copied the XNU source code into the search path of the debugger:</p><a id="I_programlisting_d1e12091"/><pre class="programlisting">linux# <strong class="userinput"><code>mkdir /SourceCache</code></strong>
linux# <strong class="userinput"><code>mkdir /SourceCache/xnu</code></strong>
linux# <strong class="userinput"><code>mv xnu-792.13.8 /SourceCache/xnu/</code></strong></pre><p>In <a class="xref" href="ch07.html" title="Chapter 7. A Bug Older Than 4.4BSD">Chapter 7</a>, I described how the newly built kernel debugger can be used to connect to a Mac OS X machine.</p></div><div class="sect2" title="Notes"><div class="titlepage"><div><div><h2 class="title"><a id="notes-id9"/>Notes</h2></div></div></div><p><sup>[<a id="APP-B-FN-1" href="#ftn.APP-B-FN-1" class="footnote">91</a>]</sup></p><p><sup>[<a id="APP-B-FN-2" href="#ftn.APP-B-FN-2" class="footnote">92</a>]</sup></p><p><sup>[<a id="APP-B-FN-3" href="#ftn.APP-B-FN-3" class="footnote">93</a>]</sup></p><p><sup>[<a id="APP-B-FN-4" href="#ftn.APP-B-FN-4" class="footnote">94</a>]</sup></p><p><sup>[<a id="APP-B-FN-5" href="#ftn.APP-B-FN-5" class="footnote">95</a>]</sup></p><p><sup>[<a id="APP-B-FN-6" href="#ftn.APP-B-FN-6" class="footnote">96</a>]</sup></p><p><sup>[<a id="APP-B-FN-7" href="#ftn.APP-B-FN-7" class="footnote">97</a>]</sup></p><p><sup>[<a id="APP-B-FN-8" href="#ftn.APP-B-FN-8" class="footnote">98</a>]</sup></p><p><sup>[<a id="APP-B-FN-9" href="#ftn.APP-B-FN-9" class="footnote">99</a>]</sup></p></div><div class="footnotes"><br/><hr/><div class="footnote"><p><sup>[<a id="ftn.APP-B-FN-1" href="#APP-B-FN-1" class="para">91</a>] </sup>See the <span class="emphasis"><em>Solaris Modular Debugger Guide</em></span> at <a class="ulink" href="http://dlc.sun.com/osol/docs/content/MODDEBUG/moddebug.html">http://dlc.sun.com/osol/docs/content/MODDEBUG/moddebug.html</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-B-FN-2" href="#APP-B-FN-2" class="para">92</a>] </sup>See <a class="ulink" href="http://www.vmware.com/">http://www.vmware.com/</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-B-FN-3" href="#APP-B-FN-3" class="para">93</a>] </sup>See <a class="ulink" href="http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx">http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-B-FN-4" href="#APP-B-FN-4" class="para">94</a>] </sup>See <a class="ulink" href="http://www.gnu.org/software/gdb/documentation/">http://www.gnu.org/software/gdb/documentation/</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-B-FN-5" href="#APP-B-FN-5" class="para">95</a>] </sup>There are still a few download mirror sites available where you can get the Red Hat 7.3 ISO images. Here are a few, as of this writing: <a class="ulink" href="http://ftp-stud.hs-esslingen.de/Mirrors/archive.download.redhat.com/redhat/linux/7.3/de/iso/i386/">http://ftp-stud.hs-esslingen.de/Mirrors/archive.download.redhat.com/redhat/linux/7.3/de/iso/i386/</a>, <a class="ulink" href="http://mirror.fraunhofer.de/archive.download.redhat.com/redhat/linux/7.3/en/iso/i386/">http://mirror.fraunhofer.de/archive.download.redhat.com/redhat/linux/7.3/en/iso/i386/</a>, and <a class="ulink" href="http://mirror.cs.wisc.edu/pub/mirrors/linux/archive.download.redhat.com/redhat/linux/7.3/en/iso/i386/">http://mirror.cs.wisc.edu/pub/mirrors/linux/archive.download.redhat.com/redhat/linux/7.3/en/iso/i386/</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-B-FN-6" href="#APP-B-FN-6" class="para">96</a>] </sup>Apple’s custom gdb version can be downloaded at <a class="ulink" href="http://www.opensource.apple.com/tarballs/gdb/gdb-292.tar.gz">http://www.opensource.apple.com/tarballs/gdb/gdb-292.tar.gz</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-B-FN-7" href="#APP-B-FN-7" class="para">97</a>] </sup>The standard gdb version from GNU can be downloaded at <a class="ulink" href="http://ftp.gnu.org/pub/gnu/gdb/gdb-5.3.tar.gz">http://ftp.gnu.org/pub/gnu/gdb/gdb-5.3.tar.gz</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-B-FN-8" href="#APP-B-FN-8" class="para">98</a>] </sup>The patch for Apple’s GNU debugger is available at <a class="ulink" href="http://www.trapkit.de/books/bhd/osx_gdb.patch">http://www.trapkit.de/books/bhd/osx_gdb.patch</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.APP-B-FN-9" href="#APP-B-FN-9" class="para">99</a>] </sup>The XNU version 792.13.8 can be downloaded at <a class="ulink" href="http://www.opensource.apple.com/tarballs/xnu/xnu-792.13.8.tar.gz">http://www.opensource.apple.com/tarballs/xnu/xnu-792.13.8.tar.gz</a>.</p></div></div></div></body></html>