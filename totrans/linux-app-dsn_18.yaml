- en: '![](../images/349-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '[**INSTALLING A FRAMEBUFFER DEVICE DRIVER**](toc.html#app3)'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/as.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The Laddie CD was designed to work with as many video cards as possible. To
    accomplish this, it defaults to a framebuffer device driver for a widely adopted
    video standard and configures it for a low-resolution display with only eight
    bits per pixel. If this driver fails, the system then attempts to find a hardware-specific
    driver for your video card and loads that driver with its default configuration.
    This approach will provide a minimal, working framebuffer for most systems. However,
    if you would like to take better advantage of your particular hardware, you will
    need to take some additional steps.
  prefs: []
  type: TYPE_NORMAL
- en: 'In this appendix, we will cover the following topics:'
  prefs: []
  type: TYPE_NORMAL
- en: Finding framebuffer device drivers for your video card
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Configuring the framebuffer device driver
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[**Finding Framebuffer Device Drivers for Your Video Card**](toc.html#app3.1)'
  prefs: []
  type: TYPE_NORMAL
- en: To find available device drivers for your video card, boot your PC with the
    Laddie CD.
  prefs: []
  type: TYPE_NORMAL
- en: If the Laddie CD succeeds in finding a driver for your video card, it will launch
    the Laddie framebuffer UI, shown in Figure C-1\. Otherwise, it will display the
    message *The framebuffer (/dev/fb0) is unavailable* before the login prompt.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/350-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure C-1: The Laddie framebuffer UI*'
  prefs: []
  type: TYPE_NORMAL
- en: 'For now, we’ll assume that a framebuffer driver loaded successfully. To determine
    which driver was loaded, first exit the framebuffer UI by pressing ESC. Then type
    the following at the command prompt:'
  prefs: []
  type: TYPE_NORMAL
- en: laddie:~# dmesg | grep fb
  prefs: []
  type: TYPE_NORMAL
- en: The dmesg command displays the buffer of messages produced by the kernel since
    startup, and the grep command selects those that might have something to do with
    framebuffers.
  prefs: []
  type: TYPE_NORMAL
- en: '[***The vesafb Driver***](toc.html#app3.2)'
  prefs: []
  type: TYPE_NORMAL
- en: The Laddie CD first attempts to load the vesfab video driver, since this is
    the most likely candidate for an unknown graphics card. The vesafb driver supports
    an interface developed by the Video Electronics Standards Association (VESA) known
    as VESA BIOS Extensions (VBE). The driver relies on the BIOS and must therefore
    be configured at system startup. This means that the vesafb driver has to be compiled
    into the kernel, rather than be supplied as a separate module. The Laddie appliance
    configures the driver using a boot prompt command, which we will describe later.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is example output from one of our systems on which a vesafb driver installed
    successfully:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/350-2.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '![](../images/351-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '[***Hardware-Specific Drivers***](toc.html#app3.3)'
  prefs: []
  type: TYPE_NORMAL
- en: 'If your system successfully loaded the vesafb driver, you will need to disable
    that driver at boot time in order to check for other drivers. To do this, reboot
    the Laddie CD. When you see the boot prompt, type **novesa** and press ENTER.
    If the framebuffer UI launches, that means the system found an appropriate driver.
    Exit the framebuffer UI, and type the command **dmesg | grep f** **b**. When we
    did this for one of our systems, the command produced the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/351-2.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Here we see that the vesafb driver failed to load, and a device-specific driver
    succeeded. The rivafb is a video driver for NVIDIA graphics cards.
  prefs: []
  type: TYPE_NORMAL
- en: 'You can also check which hardware-specific framebuffer driver your system loaded
    with the lsmod command. Execute the following at the console:'
  prefs: []
  type: TYPE_NORMAL
- en: lsmod | grep fb
  prefs: []
  type: TYPE_NORMAL
- en: The lsmod command lists all the modules currently loaded by the kernel; framebuffer
    names typically include the letters *fb,* for example *nvidiafb, radeonfb, savagefb,*
    or *matroxfb_g450.* By the way, the lsmod command won’t work for the vesafb driver,
    since the vesafb driver isn’t a module—it’s compiled into the kernel.
  prefs: []
  type: TYPE_NORMAL
- en: '[***Drivers Not Included on the Laddie CD***](toc.html#app3.4)'
  prefs: []
  type: TYPE_NORMAL
- en: If the Laddie CD did not find a driver for your graphics card, it is possible
    that a newer kernel will support it. In this case, use the lspci command to identify
    your graphics card. If your card is AGP, PCI, or PCI-Express, this command will
    report it. The following is one of several lines produced when running the lspci
    command on one of our development machines.
  prefs: []
  type: TYPE_NORMAL
- en: '01:00.0 VGA compatible controller: nVidia Corporation NV15 [GeForce2 GTS/Pro]
    (rev a4)'
  prefs: []
  type: TYPE_NORMAL
- en: This output shows us that we have an NVIDIA VGA-compatible controller (VGA stands
    for *Video Graphics Array).* At this point, you may need to spend some time on
    the Internet finding a driver for your graphics card. Also keep in mind that Linux
    doesn’t support all graphics cards, so you may have to install a different card
    in order to use the Linux framebuffer.
  prefs: []
  type: TYPE_NORMAL
- en: '[**Configuring the Framebuffer Device Driver**](toc.html#app3.5)'
  prefs: []
  type: TYPE_NORMAL
- en: Once you’ve found the right video driver for your hardware, you’ll need to configure
    it for your desired video mode.
  prefs: []
  type: TYPE_NORMAL
- en: '[***The vesafb Driver***](toc.html#app3.6)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Since the vesafb driver relies on real-mode BIOS functions for initialization,
    it must be built into the kernel and configured at boot time. This configuration
    is specified at the kernel command line and may be provided at the boot prompt
    or in the bootloader’s configuration file. For the vesafb driver, the kernel command
    line should include the following:'
  prefs: []
  type: TYPE_NORMAL
- en: video=vesafb *vga=<Linux video mode>*
  prefs: []
  type: TYPE_NORMAL
- en: The *Linux video mode* is a number that specifies a particular resolution and
    number of bits per pixel. This number is formed by adding *0x200* to the video
    mode numbers specified by the VESA BIOS Extensions standard. These Linux video
    modes are summarized in Table C-1.
  prefs: []
  type: TYPE_NORMAL
- en: '**Table C-1:** Linux Video Mode Numbers'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/352-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '**Choose an Appropriate Video Mode**'
  prefs: []
  type: TYPE_NORMAL
- en: A typical VBE-compliant graphics card will not support all of these modes, so
    you may need to experiment to find one that works. The easiest way to do this
    is to specify
  prefs: []
  type: TYPE_NORMAL
- en: video=vesafb vga=ask
  prefs: []
  type: TYPE_NORMAL
- en: at the Linux boot prompt. (If you are experimenting with the Laddie CD, the
    complete boot prompt line would be linux vga=ask.) The kernel initialization code
    will display a list of modes and ask for a mode number. You can ignore the ones
    it presents, since these are for text-only consoles.
  prefs: []
  type: TYPE_NORMAL
- en: Also, don’t bother to choose the scan option. At best, this will provide a longer
    list of text modes; at worst, it will hang the system and you will have to reboot.
    In fact, whenever you enter an unsupported number, the kernel responds immediately
    with *Unknown mode ID. Try again,* so it doesn’t take long to find one that works.
    When entering a mode, just provide the hex digits without the leading *0x.*
  prefs: []
  type: TYPE_NORMAL
- en: '**Update the Kernel Command Line**'
  prefs: []
  type: TYPE_NORMAL
- en: Once you have found a VBE video mode that works, you can update the kernel command
    line in your bootloader configuration file. In this case, you do need to use the
    leading *0x.* For example, the command
  prefs: []
  type: TYPE_NORMAL
- en: video=vesafb vga=0x311 3
  prefs: []
  type: TYPE_NORMAL
- en: would be appropriate for a VBE-compatible video card that supports a resolution
    of 640 by 480 with 16 bits per pixel. The final *3* specifies runlevel 3 to prevent
    the X display manager from loading a separate video driver.
  prefs: []
  type: TYPE_NORMAL
- en: '**NOTE**'
  prefs: []
  type: TYPE_NORMAL
- en: '*The vesafb driver does accept optional parameters for features like efficient
    scrolling. See /usr/src/linux/Documentation/fb/vesafb.txt for details.*'
  prefs: []
  type: TYPE_NORMAL
- en: '[***Hardware-Specific Drivers***](toc.html#app3.7)'
  prefs: []
  type: TYPE_NORMAL
- en: If you booted the Laddie CD with the novesa option and if the system was able
    to find a hardware-specific video driver, it will have come up with default settings
    for the video mode.
  prefs: []
  type: TYPE_NORMAL
- en: In this section, we will describe how you can experiment with those settings
    using the Laddie CD, and then how you can select your preferred settings at boot
    time for your own system. These comments also apply to video drivers that the
    Laddie CD doesn’t support, though you will have to use your own system to experiment
    with them.
  prefs: []
  type: TYPE_NORMAL
- en: '**Experiment with Different Video Modes**'
  prefs: []
  type: TYPE_NORMAL
- en: Unlike the vesafb driver, non-VBE drivers can change modes after startup. To
    change video mode, use the fbset utility. This utility accesses the file /etc/fb.modes
    to associate mode names with geometry and timing parameters. For example, the
    command
  prefs: []
  type: TYPE_NORMAL
- en: fbset 640x480-60
  prefs: []
  type: TYPE_NORMAL
- en: will find the geometry and timing parameters associated with the string 640x480-60
    and use these to switch the framebuffer to a resolution of 640 by 480 at 60 Hz.
    If this command is successful, you will probably see the console screen change
    (e.g., to a larger font) as it switches to a different graphics mode.
  prefs: []
  type: TYPE_NORMAL
- en: If the fbset utility is not available on your distribution, you can download
    it from [http://packages.debian.org/stable/admin/fbset](http://packages.debian.org/stable/admin/fbset).
    If you install it yourself, be sure to install an appropriate fb.modes file in
    /etc. You can use one of the fb.modes files provided with the fbset package (which
    is what we did), but do so with caution, because incorrect timing values can damage
    some monitors.
  prefs: []
  type: TYPE_NORMAL
- en: '**Select the Desired Video Mode at Startup**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The Laddie CD maintains hardware-specific video drivers as modules, but once
    you’ve found the appropriate framebuffer device driver for your system, you may
    want to build it into the kernel. This is not an option with the Laddie CD, of
    course, but if you rebuild the kernel for your own system, you will need to configure
    the driver at the kernel boot prompt. Many non-VBE framebuffer device drivers
    now support a common syntax for providing the video mode on the kernel command
    line. Following this syntax, the examplefb driver would be selected at boot time
    with the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: video=examplefb:1024x768-24@76
  prefs: []
  type: TYPE_NORMAL
- en: This specifies a width of 1,024 pixels, a height of 768 pixels, 24 bits per
    pixel, and a refresh rate of 76 Hz.
  prefs: []
  type: TYPE_NORMAL
- en: '**NOTE**'
  prefs: []
  type: TYPE_NORMAL
- en: '*No timing information has been provided except for the refresh rate. The kernel
    includes a database of timing parameters (see the file /usr/src/linux/drivers/video/mo
    dedb. c for details) and will search for an entry that matches the provided resolution
    and refresh rate. If it fails to find a match, it will use a default video mode,
    and if that fails, it will attempt all modes in the database.*'
  prefs: []
  type: TYPE_NORMAL
- en: 'In general, the following format is used to specify the video mode:'
  prefs: []
  type: TYPE_NORMAL
- en: <xres>x<yres>[M][R][-<bpp>][@<refresh>][i][m]
  prefs: []
  type: TYPE_NORMAL
- en: Here, an optional M requests the use of *VESA Coordinated Video Timings,* a
    systematic method for determining appropriate timings based on resolution, refresh
    rate, the type of monitor (CRT or digital display), and interlacing. The optional
    R specifies reduced blanking for digital displays. The optional i specifies an
    interlaced mode, and the optional m requests an additional 1.8 percent margin
    in the timing calculations.
  prefs: []
  type: TYPE_NORMAL
- en: Besides the common syntax outlined here, specific drivers may support other
    options, such as disabling acceleration. There is little commonality among drivers;
    you may need to consult your driver’s source code to find these options.
  prefs: []
  type: TYPE_NORMAL
- en: '**Verify the Settings for Your Framebuffer Driver**'
  prefs: []
  type: TYPE_NORMAL
- en: If you have successfully loaded a framebuffer driver and would like to learn
    more about its configuration, you can use the fbset -i command to report your
    framebuffer’s geometry, timings, and various other parameters.
  prefs: []
  type: TYPE_NORMAL
- en: To see configuration data on a loaded framebuffer driver, try using cat to examine
    the contents of /proc/fb and the files in the /sys/class/graphics/fb0 directory.
    Not all drivers update the /sys directory, but when they do, these files provide
    a convenient way to access framebuffer parameters such as bits_per_pixel and color_map.
  prefs: []
  type: TYPE_NORMAL
- en: For more information on the Linux framebuffer, see the (somewhat dated) HOWTO
    at [http://tldp.org/HOWTO/Framebuffer-HOWTO.html](http://tldp.org/HOWTO/Framebuffer-HOWTO.html).
    The VBE 3.0 specification is available at [http://www.vesa.org/public/VBE/vbe3.pdf.](http://www.vesa.org/public/VBE/vbe3.pdf)
  prefs: []
  type: TYPE_NORMAL
