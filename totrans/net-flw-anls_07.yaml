- en: Chapter 7. FLOWVIEWER
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages651574.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Almost everybody likes pretty pictures of network traffic. FlowScan and CUFlow
    graph common, expected traffic types in a user-friendly manner. Your network is
    anything but common or expected, however. In addition to CUFlow, you'll also need
    a more customizable analysis tool, whether because you need a one-time report,
    insight into traffic that you never expected to see, or a close-up view of last
    year's traffic. As you'll learn in this chapter, the FlowViewer suite ([http://ensight.eos.nasa.gov/FlowViewer/](http://ensight.eos.nasa.gov/FlowViewer/))
    is one such customizable tool that can quickly create and access web-based reports.
  prefs: []
  type: TYPE_NORMAL
- en: 'FlowViewer includes three separate components: FlowViewer, FlowTracker, and
    FlowGrapher. *FlowViewer* is a web interface for `flow-print` and `flow-nfilter`
    that, once you''ve defined filters in a web form, will print out the matching
    flows. *FlowGrapher* lets you graph subsets of data on an ad hoc basis. *FlowTracker*
    is a simple way to build and view RRDs, much like CUFlow, but it lets you filter
    graphed traffic very specifically. If you want to continuously track HTTPS and
    telnet traffic to and from your enterprise resource planning (ERP) system, FlowTracker
    is your friend. As a whole, these three tools offer a great deal of visibility
    into the network.'
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: FlowViewer has an extensive manual that includes more detail than I've been
    able to fit into one chapter. See the FlowViewer manual for more in-depth information.
  prefs: []
  type: TYPE_NORMAL
- en: FlowTracker and FlowGrapher vs. CUFlow
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If FlowTracker, FlowGrapher, and CUFlow have similar functions, why not use
    only one or the other? Primarily for reasons of ease of use.
  prefs: []
  type: TYPE_NORMAL
- en: CUFlow is easily understood. You can give your customers access to a CUFlow
    graph, and with minimal explanation they can interpret the results fairly accurately.
    Your most feeble-brained co-worker can understand CUFlow output. But at the same
    time, this ease of understanding costs you flexibility. The user gets only the
    features and reports configured by the network administrator, and older reports
    suffer from RRD database compression, as discussed in [Chapter 6](ch06.html "Chapter 6. PERL,
    FLOWSCAN, AND CFLOW.PM").
  prefs: []
  type: TYPE_NORMAL
- en: 'On the other hand, FlowViewer''s graphing and tracking functions are more powerful
    than those of CUFlow but also more confusing. Reports are almost infinitely customizable,
    adjustable, and configurable, and this broad feature set means that you really
    need to know what you''re doing in order to get useful information. Also, FlowViewer
    has no concept of a read-only user: Anyone who can access your FlowViewer website
    gets full access to all of its features. FlowViewer is meant for network administrators,
    not general users.'
  prefs: []
  type: TYPE_NORMAL
- en: FlowViewer Security
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'As mentioned, anyone who can access FlowViewer can see everything about your
    internal network. A skilled intruder would find this irresistible. Others will
    just annoy you: Unskilled visitors, such as your help-desk staff, will probably
    misinterpret FlowViewer''s results and make you spend time explaining why they''re
    wrong. For this reason, I strongly recommend password protecting the FlowViewer
    website and restricting the IP addresses permitted to access the server. Using
    HTTPS, even with a self-signed certificate, will protect your user credentials
    and data in transit.'
  prefs: []
  type: TYPE_NORMAL
- en: FlowViewer's default install also uses a world-writable directory to store reports.
    This is a security risk, particularly on a multiuser system. If you're using a
    shared system as your analysis workstation, you must restrict permissions more
    tightly than FlowViewer's defaults.
  prefs: []
  type: TYPE_NORMAL
- en: Installing FlowViewer
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: If possible, install FlowViewer from a package provided by your OS vendor. If
    your vendor doesn't provide a FlowViewer package, you'll need to install by hand,
    of course.
  prefs: []
  type: TYPE_NORMAL
- en: Prerequisites
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Install the following software packages before installing FlowViewer, all of
    which should be available as packages for most operating systems:'
  prefs: []
  type: TYPE_NORMAL
- en: Web server, such as any recent Apache
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Perl
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: RRDtool ([http://oss.oetiker.ch/rrdtool/](http://oss.oetiker.ch/rrdtool/)) with
    Perl shared module support
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: GD Graphics Library ([http://www.boutell.com/gd/](http://www.boutell.com/gd/))
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The gd::graph Perl module
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The GDBM Perl module (might be packaged as GDBM_File)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: You'll also need to know the system user who runs your web pages. This is probably
    a user named *www*, *http*, or *www-data*. If your web server is running, enter
    **`ps -axe`** or **`ps -axj`** to get the name of the user running the server.
  prefs: []
  type: TYPE_NORMAL
- en: FlowViewer Installation Process
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: To install FlowViewer, first download the latest version of FlowViewer from
    [http://ensight.eos.nasa.gov/FlowViewer/](http://ensight.eos.nasa.gov/FlowViewer/).
    The compressed installation file includes a FlowViewer directory with several
    files containing the entire package. Untar it in a directory under your web server.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now configure your web server to permit CGI execution in that directory. For
    example, here''s how to configure Apache to support FlowViewer in the directory
    */usr/local/www/flowviewer*:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: The alias definition at ❶ maps the web location [http://servername/FlowViewer/](http://servername/FlowViewer/)
    to the local directory */usr/local/www/flowviewer/*. Then, at ❷ you assign specific
    permissions to the FlowViewer directory, permitting CGI execution and client access.
    Finally, restart Apache.
  prefs: []
  type: TYPE_NORMAL
- en: That's it for installation. The more difficult part of FlowViewer is configuration.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring FlowViewer
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'All the tools in the FlowViewer suite use the *FlowViewer_Configuration.pm*
    configuration file. Although this file contains many settings, only a few are
    required for proper operation; the others allow you to tweak the application''s
    appearance and the behavior of FlowTracker''s RRD files. If you''re interested
    in settings not discussed here, see FlowViewer''s extensive manual. I''ll cover
    only the settings needed to make FlowViewer work. (Some operating system packages
    set these for you as part of their install process.) Without further ado, here
    are the settings that you''ll need to make:'
  prefs: []
  type: TYPE_NORMAL
- en: The `$ENV{PATH}` variable includes only the paths for system commands that FlowViewer
    requires. On almost all systems, you should leave this alone. You do not need
    to have flow-tools and RRDtool in these directories; they have their own path
    variables that you'll set later.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The `$FlowViewer_server` variable tells FlowViewer the hostname of your website.
    For example, to make my test collector visible at [https://netflow.blackhelicopters.org/](https://netflow.blackhelicopters.org/),
    I set `$FlowViewer_server` to `netflow.blackhelicopters.org`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The `$FlowViewer_service` variable helps FlowViewer construct web pages. Set
    this to either `http` or `https`, as appropriate for your website.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Directories and Site Paths
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: FlowViewer stores files on the web server, and all file storage directories
    must be writable by the web server user. Create these directories, and change
    their ownership to the web server user. (Unwritable directories are a common cause
    of FlowViewer problems.)
  prefs: []
  type: TYPE_NORMAL
- en: Most directory variables also have a "short" version that defines where a web
    browser can find that directory on the server. FlowViewer uses this short name
    to create links to generated content. I'll walk you through examples when you
    set the first few variables.
  prefs: []
  type: TYPE_NORMAL
- en: SEARCH-AND-REPLACE CONFIGURATION
  prefs: []
  type: TYPE_NORMAL
- en: The default *FlowViewer_Configuration.pm* assumes that Apache's *DocumentRoot*
    directory is */htp/htdocs* and that the CGI directory where FlowViewer is installed
    is */htp/cgi-bin*. You might do a simple search and replace on these values, replacing
    them with the correct *DocumentRoot* and *FlowViewer* installation directories
    for your environment. In all of the following examples, my website root directory
    is */var/www/ssl*, and FlowViewer is installed in */usr/local/www/flowviewer*.
    You must create all the directories you tell FlowViewer to use.
  prefs: []
  type: TYPE_NORMAL
- en: '`$reports_directory` tells FlowViewer where to store reports, and `$reports_short`
    gives the location on the website where a client would find the *$reports* directory.
    The report directory must be under Apache''s *DocumentRoot* or another directory
    accessible to Apache. Here, I''ve created a *FlowViewer* directory in my *DocumentRoot*:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: FlowViewer stores generated graphs in *$graphs_directory*, and `$graphs_short`
    defines the location on the website where a client would find *$graphs_directory*.
    Like *$reports_directory*, *$graphs_directory* must be accessible on the website.
    I use the directory */var/www/ssl/FlowGrapher*.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: The FlowTracker tool stores files in *$tracker_directory*, which is accessible
    on the website as *$tracker_short*. I use the directory */var/www/ssl/FlowTracker*.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'The `$cgi_bin_directory` variable points to the directory that contains the
    FlowViewer software. You could choose to copy this to your web server''s regular
    CGI executable directory, but I suggest installing FlowViewer in its own directory
    and then configuring your web server to run CGI scripts in that directory. For
    example, as you can see here, my FlowViewer install is in */usr/local/www/flowviewer*,
    and I configured the web server to offer this as [http://servername/flowviewer](http://servername/flowviewer):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'FlowViewer saves temporary files in *$work_directory*, which is accessible
    on the web server as *$work_short*. Here I''m using */var/www/ssl/FlowWorking*:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: Reports and filters saved for later are stored in *$save_directory*, which is
    accessible to web clients as *$save_short*. Create */var/www/ssl/FlowViewer_Saves*
    for this.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: The remaining directories do not have "short" variables for their path on the
    website. FlowViewer uses them for internal tracking or to find key software, and
    the client should never access them directly.
  prefs: []
  type: TYPE_NORMAL
- en: When a user asks FlowViewer to resolve the names of IP addresses, it caches
    the results in *$names_directory*. For example, I put my names cache in */usr/local/www/flowviewer/names*.
    Remember, any cached DNS data slowly becomes obsolete as hosts change IP addresses.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: FlowTracker stores the filters it uses to create trackers in *$filter_directory*
    and stores the RRD files in *$rrdtool_directory*.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The *$flow_bin_directory* directory is where flow-tools is installed. This is
    usually something like */usr/local/bin* or */usr/local/flow-tools/bin*.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Similarly, *rrdtool_bin_directory* is where RRDtool is installed, which is usually
    */usr/local/bin* or */usr/local/rrdtool/bin*.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Here''s how they look in the configuration:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: Website Setup
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The next four values set some basic properties in FlowViewer''s web interface:'
  prefs: []
  type: TYPE_NORMAL
- en: FlowTracker automatically generates a web page listing all trackers currently
    running. The default file is *index.html* in *$tracker_directory*. Change this
    by setting `$actives_webpage` to the desired filename.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The autogenerated tracker page lists your organization name as the value of
    `$trackings_title`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To put your company logo next to the FlowViewer graphic at the top of each page,
    create a logo file 86 pixels high, and copy it to *$reports_directory*.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Then assign `$user_logo` the filename. The logo will link to a website defined
    in `$user_hyperlink`.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'They''ll look like this in the configuration:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: Devices and Exporters
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In [Chapter 2](ch02.html "Chapter 2. COLLECTORS AND SENSORS"), you decided to
    use either a single collector that accepted flow records from all your sensors
    or a separate collector for each sensor. FlowViewer can support either configuration,
    but you must tell it which one it's using.
  prefs: []
  type: TYPE_NORMAL
- en: The simplest scenario is a single sensor and a single collector when you expect
    to never have more, but I don't recommend making this assumption. Networks change
    over time, and your FlowViewer install should accommodate that change. If you
    insist that you'll have only one collector and one sensor, though, see the FlowViewer
    manual for information on changing `$no_devices_or_exporters`.
  prefs: []
  type: TYPE_NORMAL
- en: One Collector per Sensor
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In [Chapter 2](ch02.html "Chapter 2. COLLECTORS AND SENSORS"), I recommended
    setting up one collector per sensor. Your flow data would go into a directory
    such as */var/db/flows*, with a subdirectory for each device. You'd wind up with
    directories such as */var/db/flows/router1* for the sensor router1, */var/db/flows/router2*
    for the sensor router2, and so on.
  prefs: []
  type: TYPE_NORMAL
- en: For this setup, assign the flow data root directory to `$flow_data_directory`.
    In my setup, `$flow_data_directory` is */var/db/flows*. Now assign the variable
    `@devices` the list of directory names that represent sensors. For example, my
    network has the sensors router1, router2, and router3\. I would assign the following
    values to `@devices`. (FlowViewer offers everything in `@devices` as an option
    in a drop-down menu.)
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: One Collector for All Sensors
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'If all your sensors send their data to a single collector, don''t set `@devices`
    or `$flow_data_directory`. Instead, set `$exporter_directory` to the location
    of your consolidated flow data. If you ran a single collector and all your data
    went into */var/db/flows*, set `$exporter_directory` to */var/db/flows*. Also,
    uncomment `@exporters`, and set it to the list of sensors in the collector, listing
    exporters by IP address and hostname, as shown here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: FlowViewer is now configured and ready for use. Point your web browser to *FlowViewer.cgi*
    to see its initial screen.
  prefs: []
  type: TYPE_NORMAL
- en: Troubleshooting the FlowViewer Suite
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: FlowViewer has many setup options, and you'll probably make mistakes during
    your first install. I strongly recommend keeping a terminal window open and running
    `tail -f` on your web server error log to display errors as they occur. In my
    experience, the most common errors are incorrect directory variables and directory
    permissions.
  prefs: []
  type: TYPE_NORMAL
- en: Watch the error log as you use FlowViewer, and correct errors as they appear.
    Follow these procedures, and within a few moments of testing, you should have
    a correctly working FlowViewer install.
  prefs: []
  type: TYPE_NORMAL
- en: Using FlowViewer
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Once properly installed, FlowViewer should look something like [Figure 7-1](ch07s05.html#default_flowviewer_interface
    "Figure 7-1. Default FlowViewer interface").
  prefs: []
  type: TYPE_NORMAL
- en: '![Default FlowViewer interface](httpatomoreillycomsourcenostarchimages651590.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7-1. Default FlowViewer interface
  prefs: []
  type: TYPE_NORMAL
- en: The upper part of the screen, Filter Criteria, controls traffic selection. This
    is essentially an interface to `flow-nfilter` that lets you choose exactly which
    flows you want to examine. FlowGrapher and FlowTracker share most of FlowViewer's
    filter interface. The lower part of the screen, Reporting Parameters, controls
    the display of results. You can run reports on traffic or just view the matching
    flows.
  prefs: []
  type: TYPE_NORMAL
- en: In the following sections, I'll cover how to use the filtering interface first
    and then the viewing options.
  prefs: []
  type: TYPE_NORMAL
- en: Filtering Flows with FlowViewer
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Each field you modify in the Filter Criteria section is fed to `flow-nfilter`.
    Most fields accept multiple entries, separated by commas. You can also negate
    an entry by prefixing it with a minus sign. (If you have general questions on
    filtering flows, see [Chapter 4](ch04.html "Chapter 4. FILTERING FLOWS").)
  prefs: []
  type: TYPE_NORMAL
- en: Device
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you have multiple sensors, you must first select the device that provides
    the data you want to examine. This drop-down menu is taken directly from the devices
    or exporters list you configured for FlowViewer, and it's the only field that
    requires you to enter anything.
  prefs: []
  type: TYPE_NORMAL
- en: Next Hop IP
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: This is the IP address where the sensor sends traffic. Remember that only hardware
    flow sensors, such as routers and switches, include next-hop address information
    in flows. Software flow sensors do not have access to this information.
  prefs: []
  type: TYPE_NORMAL
- en: Start and End Date and Time
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Here you set the time you're interested in. Times are in 24-hour-clock format.
    FlowViewer defaults to offering the most recent complete hour. See [Include Flow
    If](ch07s05.html#include_flow_if "Include Flow If") in [Include Flow If](ch07s05.html#include_flow_if
    "Include Flow If") for a discussion on how FlowViewer handles flows that cross
    the start or end times.
  prefs: []
  type: TYPE_NORMAL
- en: TOS Field, TCP Flag, and Protocol
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: FlowViewer's Type of Service (DSCP) and TCP flags filtering accepts both decimal
    values (16) and hexadecimals (0x10).
  prefs: []
  type: TYPE_NORMAL
- en: You can enter the IP protocol either by name (TCP, UDP, and so on) or by number
    (6, 17, and so on).
  prefs: []
  type: TYPE_NORMAL
- en: Source and Dest IP
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You can report on either a single address, a hostname, multiple comma-separated
    addresses, or networks with a netmask in prefix length (slash) notation. For example,
    to report on traffic from the network 192.0.2.0 with a netmask of 255.255.255.128,
    you would enter **192.0.2.0/25**.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Be very careful when using hostnames for network analysis. Some hosts have multiple
    IP addresses. In this case, you're better off using actual IP addresses to reduce
    ambiguity.
  prefs: []
  type: TYPE_NORMAL
- en: Source and Dest Interface
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you think you know how your traffic flowed, you can filter by source or destination
    interface. When you do, remember that interfaces are numbered by index number,
    which you can get from SNMP. You can add interface names to FlowViewer, as I'll
    discuss at the end of this chapter.
  prefs: []
  type: TYPE_NORMAL
- en: I most often use FlowViewer when analyzing problems and outages. When doing
    so, I recommend against filtering by interface because traffic flowing incorrectly
    is a common cause of problems and outages, and filtering by interface can filter
    away the problem traffic.
  prefs: []
  type: TYPE_NORMAL
- en: Source and Dest Port and AS
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: FlowViewer can filter by TCP or UDP port. You can also encode ICMP types and
    codes as a port, as discussed in [ICMP Types and Codes and Flow Records](ch03s04.html
    "ICMP Types and Codes and Flow Records") in [ICMP Types and Codes and Flow Records](ch03s04.html
    "ICMP Types and Codes and Flow Records"), and use that to filter ICMP flows. Further,
    if your sensor exports BGP information, you can filter by source and destination
    AS number.
  prefs: []
  type: TYPE_NORMAL
- en: Reporting Parameters
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: FlowViewer can provide either statistical reports or printed reports. Both types
    of reports share the remaining optional settings. I'll cover the options first
    and then discuss the two types of reports. You can run one report at a time, but
    if you select both a statistics report and a printed report, FlowViewer will return
    an error.
  prefs: []
  type: TYPE_NORMAL
- en: Include Flow If
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: This setting determines how FlowViewer selects flows to report on. The default,
    Any Part in Specified Time Span, includes a flow record if any part of the flow
    is within the time you specify. For example, if you're interested in flow data
    from 9 to 10, your raw data might include a flow that starts at 8:59:30 and ends
    at 9:01:30 and also one that starts at 9:59:59 and ends at 10:05:59, with part
    of these flows trailing off either end of your chosen time window.
  prefs: []
  type: TYPE_NORMAL
- en: Most of the time, the default setting gives the best view of traffic during
    your chosen time. When using the default setting, these flows will be included
    in the filtered data. On the other hand, the End Time in Specified Time Span setting
    chops off anything that trails past the closing window. Specifically, in this
    example, the flow that starts at 9:59:59 and ends at 10:05:59 would not be included
    in the selected data. The Start Time in Specified Time Span setting slices off
    the flow that begins at 8:59:30, and the Entirely in Specified Time Span setting
    excludes both of those trailing flows.
  prefs: []
  type: TYPE_NORMAL
- en: Sort Field, Resolve Addresses, and Oct Conv, and Sampling Multip
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Like `flow-report`, FlowViewer can sort its output on any field with the output
    columns numbered starting from 1\. To sort by a particular field, give the number
    of the column you want to sort by in the Sort Field space.
  prefs: []
  type: TYPE_NORMAL
- en: Some reports can replace IP addresses with hostnames, but, by default, FlowViewer
    resolves names. To make FlowViewer show only IP addresses, change Resolve Addresses
    to **N**. Similarly, FlowViewer by default displays large octet counts as kilobytes,
    megabytes, or gigabytes instead of raw counts of millions or billions of bytes.
    To see raw byte counts, set Oct. Conv to **N**. (Displaying results as kilobytes,
    megabytes, or gigabytes won't affect sorting; FlowViewer is smart enough to sort
    different units correctly.)
  prefs: []
  type: TYPE_NORMAL
- en: If your sensors sample traffic, you know that the traffic levels shown in your
    reports are only a fraction of your real traffic. FlowViewer will multiply its
    results by the number you enter in Sampling Multip to approximate your real-world
    traffic.
  prefs: []
  type: TYPE_NORMAL
- en: Pie Charts
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: FlowViewer's statistical reports can generate pie charts of their results, but
    pie charts are not useful for FlowViewer reports; they're like making a pie chart
    of the phone book. For statistical reports, you can choose to include an "other"
    catchall category in your graph. Try both ways to see which generates the most
    useful graph in your environment.
  prefs: []
  type: TYPE_NORMAL
- en: Cutoffs
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you have a busy router, even a well-filtered report might include hundreds
    of thousands of flows. In such case, cutoffs prove useful because they tell FlowViewer
    when to stop printing results. You can cut off reports either by the number of
    lines of output or by the number of octets.
  prefs: []
  type: TYPE_NORMAL
- en: If you really want to have all that data, consider running the report from the
    command line and saving the results to a file for later analysis.
  prefs: []
  type: TYPE_NORMAL
- en: Printed Reports
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: FlowViewer's printed reports are a web interface of `flow-print`. [Table 7-1](ch07s05.html#printed_reports_and_flow-print_formats
    "Table 7-1. Printed Reports and flow-print Formats") maps FlowViewer's printed
    reports to `flow-print` formats. [Chapter 3](ch03.html "Chapter 3. VIEWING FLOWS")
    covers the various print formats in detail.
  prefs: []
  type: TYPE_NORMAL
- en: Table 7-1. Printed Reports and flow-print Formats
  prefs: []
  type: TYPE_NORMAL
- en: '| Printed Report | flow-print Format |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| Flow Times | `-f 1` |'
  prefs: []
  type: TYPE_TB
- en: '| AS Numbers | `-f 4` |'
  prefs: []
  type: TYPE_TB
- en: '| 132 Columns | `-f 5` |'
  prefs: []
  type: TYPE_TB
- en: '| 1 Line with Tags | `-f 9` |'
  prefs: []
  type: TYPE_TB
- en: '| AS Aggregation | `-f 10` |'
  prefs: []
  type: TYPE_TB
- en: '| Protocol Port Aggregation | `-f 11` |'
  prefs: []
  type: TYPE_TB
- en: '| Source Prefix Aggregation | `-f 12` |'
  prefs: []
  type: TYPE_TB
- en: '| Destination Prefix Aggregation | `-f 13` |'
  prefs: []
  type: TYPE_TB
- en: '| Prefix Aggregation | `-f 14` |'
  prefs: []
  type: TYPE_TB
- en: '| Full (Catalyst) | `-f 24` |'
  prefs: []
  type: TYPE_TB
- en: Note that not all reports will produce output. For example, if your flow data
    does not include BGP information and you run a BGP-based report, you'll get an
    empty report.
  prefs: []
  type: TYPE_NORMAL
- en: Statistics Reports
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: FlowViewer's statistics reports are based on `flow-stat`, the predecessor to
    `flow-report`. `flow-stat` is much less flexible than `flow-report`, but some
    of its reports are more suitable for a web application. Most `flow-stat` analyses
    are available as subsets of `flow-report` output formats, as listed in [Table 7-2](ch07s05.html#flowviewer_statistics_reports_and_corres
    "Table 7-2. FlowViewer Statistics Reports and Corresponding flow-reports").
  prefs: []
  type: TYPE_NORMAL
- en: Table 7-2. FlowViewer Statistics Reports and Corresponding flow-reports
  prefs: []
  type: TYPE_NORMAL
- en: '| Statistics Report | flow-report |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| Summary | summary (default) |'
  prefs: []
  type: TYPE_TB
- en: '| UDP/TCP Destination Port | ip-destination-port |'
  prefs: []
  type: TYPE_TB
- en: '| UDP/TCP Source Port | ip-source-port |'
  prefs: []
  type: TYPE_TB
- en: '| UDP/TCP Port | ip-port |'
  prefs: []
  type: TYPE_TB
- en: '| Destination IP | ip-destination-address |'
  prefs: []
  type: TYPE_TB
- en: '| Source IP | ip-source-address |'
  prefs: []
  type: TYPE_TB
- en: '| Source/Destination IP | ip-source/destination-address |'
  prefs: []
  type: TYPE_TB
- en: '| Source or Destination IP | ip-address |'
  prefs: []
  type: TYPE_TB
- en: '| IP Protocol | ip-protocol |'
  prefs: []
  type: TYPE_TB
- en: '| Input Interface | input-interface |'
  prefs: []
  type: TYPE_TB
- en: '| Output Interface | output-interface |'
  prefs: []
  type: TYPE_TB
- en: '| Input/Output Interface | input/output-interface |'
  prefs: []
  type: TYPE_TB
- en: '| Source AS | source-as |'
  prefs: []
  type: TYPE_TB
- en: '| Destination AS | destination-as |'
  prefs: []
  type: TYPE_TB
- en: '| Source/Destination AS | source/destination-as |'
  prefs: []
  type: TYPE_TB
- en: '| IP ToS | ip-tos |'
  prefs: []
  type: TYPE_TB
- en: '| Source Prefix | like ip-source-address with ip-source-address-format set
    to prefix-len |'
  prefs: []
  type: TYPE_TB
- en: '| Destination Prefix | like ip-destination-address with ip-destination-address-format
    set to prefix-len |'
  prefs: []
  type: TYPE_TB
- en: '| Source/Destination Prefix | like ip-source/destination-address with both
    ip-source-address-format and ip-destination-address-format set to prefix-len |'
  prefs: []
  type: TYPE_TB
- en: '| Exporter IP | ip-exporter-address |'
  prefs: []
  type: TYPE_TB
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you need a report not offered here, use `flow-report` instead.
  prefs: []
  type: TYPE_NORMAL
- en: FlowGrapher
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: FlowGrapher creates graphs of arbitrary flow data. Select the FlowGrapher text
    from the logo at the top of the FlowViewer page to get to FlowGrapher.
  prefs: []
  type: TYPE_NORMAL
- en: FlowGrapher Settings
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The top part of the FlowGrapher page lets you define packet filters as narrowly
    as necessary. FlowGrapher filters are identical to the FlowViewer filter definitions
    listed in [Figure 7-1](ch07s05.html#default_flowviewer_interface "Figure 7-1. Default
    FlowViewer interface"), so I won't over them again, but the bottom of the FlowGrapher
    page offers new graphing options, as shown in [Figure 7-2](ch07s06.html#flowgrapher_options
    "Figure 7-2. FlowGrapher options").
  prefs: []
  type: TYPE_NORMAL
- en: '![FlowGrapher options](httpatomoreillycomsourcenostarchimages651592.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7-2. FlowGrapher options
  prefs: []
  type: TYPE_NORMAL
- en: Include Flow if, Resolve Addresses, and Sampling Multiplier work the same way
    as the equivalent fields in FlowViewer. The options unique to FlowGrapher—Detail
    Lines, Graph Width, and Sample Time—determine how your graph is charted, its appearance,
    and how any related data is presented.
  prefs: []
  type: TYPE_NORMAL
- en: Detail Lines
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: FlowGrapher prints the first few lines of `flow-print` output for the selected
    flow files beneath the graph. This list lets you verify that the graph includes
    the flows you think should be included by your filter.
  prefs: []
  type: TYPE_NORMAL
- en: Graph Width
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The default FlowGrapher image is 600 pixels wide, but graphs that cover more
    than a couple of hours must be wider in order to show necessary detail. The Graph
    Width setting multiplies the width of a graph by the selected number. For example,
    choosing **3** creates a graph 1,800 pixels wide.
  prefs: []
  type: TYPE_NORMAL
- en: Sample Time
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: FlowGrapher computes bandwidth in "buckets" of time in order to smooth the data
    and present a more realistic graph. (You'll see why this is important in [Chapter 8](ch08.html
    "Chapter 8. AD HOC FLOW VISUALIZATION").) The default bucket size of five seconds
    is reasonable for almost all environments. A larger bucket size will decrease
    the size of bandwidth spikes and might be more realistic if most of your traffic
    consists of long-lived flows.
  prefs: []
  type: TYPE_NORMAL
- en: Graph Type
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You can choose either Bits/second (the default), Flows/second, or Packet/second
    graphs. Most of the time you'll want Bits/second, but if your environment has
    large numbers of small packets, you might find the Packets/second graph useful.
    Flows/second is mostly useful to determine whether you have more or less activity
    than usual.
  prefs: []
  type: TYPE_NORMAL
- en: FlowGrapher Output
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[Figure 7-3](ch07s06.html#sample_traffic_graph "Figure 7-3. Sample traffic
    graph") shows a traffic graph for my server, without the logo or the sample `flow-print`
    output.'
  prefs: []
  type: TYPE_NORMAL
- en: '![Sample traffic graph](httpatomoreillycomsourcenostarchimages651594.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7-3. Sample traffic graph
  prefs: []
  type: TYPE_NORMAL
- en: Notice how FlowGrapher prints the selected filter criteria above the graph.
    This information lets you easily re-create the graph with slightly different conditions
    and reminds you what you tried to graph when you return to an image later.
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: To create a traffic graph that's beyond FlowGrapher's capacity, see [Chapter 8](ch08.html
    "Chapter 8. AD HOC FLOW VISUALIZATION").
  prefs: []
  type: TYPE_NORMAL
- en: FlowTracker
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: FlowTracker generates RRD-based graphs of flow data on an ongoing basis, much
    like FlowScan and CUFlow. Each graph you create is called a *tracker*. One tracker
    graphs either inbound or outbound traffic, but not both. FlowTracker is much more
    flexible than FlowScan, but that flexibility also makes it unsuitable for customers
    or management to access directly.
  prefs: []
  type: TYPE_NORMAL
- en: FlowTracker Processes
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Like FlowScan, FlowTracker creates RRD files from `flow-capture` files as they're
    created. Rather than moving flow files, however, FlowTracker uses two processes
    to watch the `flow-capture` directories for changes and to read each new flow
    file as it's closed. If these processes stop, FlowTracker will not update RRDs
    for new flows or create new graphs.
  prefs: []
  type: TYPE_NORMAL
- en: 'Start the `FlowTracker_Collector` and `FlowTracker_Grapher` processes when
    the system boots. The included `flowcap` script might work for your operating
    system, but if not you can start them as shown here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: Start these processes after the network is initialized. Have your network management
    system monitor these processes and either send an alarm or automatically restart
    them if they fail.
  prefs: []
  type: TYPE_NORMAL
- en: FlowTracker Settings
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: FlowTracker offers the same filtering options as FlowViewer and FlowGrapher,
    without the option to select the time you want to cover. (FlowTracker continuously
    processes flow data, so time-based filtering doesn't make sense.) FlowTracker
    creates graphs based on the filters you define, just like FlowGrapher and FlowViewer.
  prefs: []
  type: TYPE_NORMAL
- en: '[Figure 7-4](ch07s07.html#flowtracker_options "Figure 7-4. FlowTracker options")
    shows the FlowTracker-specific configuration options.'
  prefs: []
  type: TYPE_NORMAL
- en: '![FlowTracker options](httpatomoreillycomsourcenostarchimages651596.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7-4. FlowTracker options
  prefs: []
  type: TYPE_NORMAL
- en: Once you've entered your desired settings, click **Establish Tracking** to start
    your tracker.
  prefs: []
  type: TYPE_NORMAL
- en: Tracking Set Label
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Tracking Set Label is the tracker's name. You should name trackers by the host,
    network, or traffic name and by the direction the traffic is going, such as "Server
    1 Web traffic inbound" or "Server 2 outbound." The text you enter here will appear
    as a link to the actual tracker on the main FlowTracker page.
  prefs: []
  type: TYPE_NORMAL
- en: Tracking Type
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: FlowTracker can aggregate individual trackers into a "group tracker." I'll cover
    group trackers later; for now, all of your trackers should be Individual.
  prefs: []
  type: TYPE_NORMAL
- en: Sampling Multiplier
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Like other parts of FlowViewer, FlowTracker can apply a sampling multiplier
    to approximate correct traffic levels in your graph.
  prefs: []
  type: TYPE_NORMAL
- en: Alert Threshold
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: As a continuously running process, FlowTracker can monitor total traffic levels
    and send an alarm if traffic exceeds a certain level. To set an alarm at a number
    of bits per second, enter that number here. (Note that your server must have a
    properly configured mail system to send alarms.)
  prefs: []
  type: TYPE_NORMAL
- en: Alert Frequency
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Generating an alarm every time the traffic exceeds your critical level can be
    annoying if your traffic load bounces back and forth across that level. Use Alert
    Frequency to tell FlowTracker to send an alarm each time traffic exceeds the critical
    limit, only once per day, or to disable emailed alerts entirely.
  prefs: []
  type: TYPE_NORMAL
- en: Alert Destination
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: This is the email address that receives alerts.
  prefs: []
  type: TYPE_NORMAL
- en: General Comment
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Any notes or comments here will appear on the finished graph.
  prefs: []
  type: TYPE_NORMAL
- en: Viewing Trackers
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Trackers that you've already created will appear at the bottom of the FlowTracker
    page. [Figure 7-5](ch07s07.html#flowtracker_individual_trackings "Figure 7-5. FlowTracker
    individual trackings") shows four trackers, inbound and outbound for two machines.
  prefs: []
  type: TYPE_NORMAL
- en: '![FlowTracker individual trackings](httpatomoreillycomsourcenostarchimages651598.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7-5. FlowTracker individual trackings
  prefs: []
  type: TYPE_NORMAL
- en: To view a tracker, click its name. Trackers include views of the last 24 hours,
    7 days, 4 weeks, 12 months, and 3 years. Each graph looks much like FlowGrapher
    output, so I won't reproduce those graphs here.
  prefs: []
  type: TYPE_NORMAL
- en: You can edit trackers to update filters or correct mistakes. To do so, click
    the **Revise** link next to a tracker in order to populate a FlowTracker page
    with the tracker's original settings, and then make the desired changes. You can
    also add a note to be displayed on the graphs to show when a tracker was changed.
  prefs: []
  type: TYPE_NORMAL
- en: Archiving a tracker tells FlowTracker to stop processing the current flows for
    this particular tracker, while continuing to update other trackers. It retains
    the archived tracker's configuration and graphs. Archiving lets you retain historical
    information without wasting computing power and lets you easily reactivate the
    tracker if needed.
  prefs: []
  type: TYPE_NORMAL
- en: Finally, you can also entirely remove a tracker by clicking the link. This deletes
    all graphs and the associated databases.
  prefs: []
  type: TYPE_NORMAL
- en: Group Trackers
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: FlowTracker lets you combine individual trackers into group trackers to give
    you a unified view of different types of traffic. For example, in [Figure 7-5](ch07s07.html#flowtracker_individual_trackings
    "Figure 7-5. FlowTracker individual trackings") you can see separate inbound and
    outbound trackers for two servers. To view a server's inbound and outbound traffic
    simultaneously, you need to use a group tracker.
  prefs: []
  type: TYPE_NORMAL
- en: To create a group tracker, name the tracker, and select a tracking type of **Group**.
    Next, when you click **Establish Tracking**, FlowTracker will open a separate
    page to define your group tracker, as shown in [Figure 7-6](ch07s07.html#basic_flowtracker_setup
    "Figure 7-6. Basic FlowTracker setup").
  prefs: []
  type: TYPE_NORMAL
- en: '![Basic FlowTracker setup](httpatomoreillycomsourcenostarchimages651600.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7-6. Basic FlowTracker setup
  prefs: []
  type: TYPE_NORMAL
- en: The sample graph shown at the top of [Figure 7-6](ch07s07.html#basic_flowtracker_setup
    "Figure 7-6. Basic FlowTracker setup") is not based on actual data but will show
    you how your color choices will look on an actual graph.
  prefs: []
  type: TYPE_NORMAL
- en: Further down in the figure are the critical components. Here you can choose
    individual trackers to include in your group tracker or choose to have the tracker
    appear above or below the x-axis. I try to consistently put inbound trackers above
    the x-axis and outbound trackers below in order to minimize confusion. Switch
    these if you prefer; just pick a standard and stick with it.
  prefs: []
  type: TYPE_NORMAL
- en: You can assign colors to each tracker in your graph. The Auto choices choose
    colors in the same color family. I recommend using one Auto color for all inbound
    trackers and a different Auto color for all outbound trackers.
  prefs: []
  type: TYPE_NORMAL
- en: Once you've added an individual tracker to your group tracker, click **Add this
    Component**. Then, immediately beneath this option, you'll see a list of all the
    individual trackers in this group tracker. For example, [Figure 7-7](ch07s07.html#group_tracker_components
    "Figure 7-7. Group tracker components") displays this group tracker after I've
    added both the inbound and outbound trackers for both individual servers.
  prefs: []
  type: TYPE_NORMAL
- en: '![Group tracker components](httpatomoreillycomsourcenostarchimages651602.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 7-7. Group tracker components
  prefs: []
  type: TYPE_NORMAL
- en: Both the torch and bewilderbeast servers will now appear in this one tracker.
    The inbound trackers will appear above the x-axis, as shown by the long horizontal
    line. The color name appears in the chosen color (which doesn't appear in this
    black-and-white figure, of course). If you don't like the color, change it with
    the New Color drop-down.
  prefs: []
  type: TYPE_NORMAL
- en: Use the Move drop-down on the far right to rearrange the server order, and then
    click **Adjust the Group** to apply your changes. I recommend having servers in
    the same order on both the inbound and outbound sides of the tracker.
  prefs: []
  type: TYPE_NORMAL
- en: Once you've configured your group tracker, click **Done** at the bottom of the
    page to create the tracker. You can revise, archive, and remove your group tracker
    as with an individual tracker.
  prefs: []
  type: TYPE_NORMAL
- en: ADDITIONAL RRD SOFTWARE
  prefs: []
  type: TYPE_NORMAL
- en: Different tools have different presentations and focus. If you find that FlowTracker
    isn't quite right for your long-term tracking needs, take a look at Webview Netflow
    Reporter, at [http://wvnetflow.sourceforge.net/](http://wvnetflow.sourceforge.net/).
  prefs: []
  type: TYPE_NORMAL
- en: Interface Names and FlowViewer
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Flows manage interfaces by index number, but humans use the interface name.
    If you tell FlowViewer the name associated with each interface number, it'll offer
    those names as an option in the web interface. If you create the file *NamedInterfaces_Devices*
    in the *FlowViewer* directory, FlowViewer will populate the Interface Names drop-down
    in the filter section of all three tools with information from the file.
  prefs: []
  type: TYPE_NORMAL
- en: 'Each line in the *NamedInterfaces_Devices* file contains three entries:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'For example, my main router''s gigabit uplink is at SNMP index 5\. The entry
    for this interface might look like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: Entering interface information for all your exporters into FlowViewer will save
    you trouble in the future and simplify problem solving. Rather than having to
    look up the number for the interface you're interested in, you can just select
    it from the menu.
  prefs: []
  type: TYPE_NORMAL
- en: FlowTracker, FlowViewer, and FlowGrapher will let you visualize most common
    situations, but they don't solve everything. In the next chapter, you'll see how
    to graph data when FlowGrapher isn't powerful or flexible enough.
  prefs: []
  type: TYPE_NORMAL
