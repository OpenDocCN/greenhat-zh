<html><head></head><body>
  <h1><span class="chapter">Chapter 2 -</span><br/>
  Thinking Inside the Box</h1>

  <p>Reverse engineering can be thought of as a very challenging yet very rewarding game. To win, you need a bit of skill and a bit of luck. And like any game, to develop your skills you just need to play, play, play.</p>

  <p>The first step in building your skills as a hacker is to develop an intuition for the material. In the case of hardware, a good way to get a feel for <span>things is to take the covers off of everything and try to figure out what all the components are, and what they might do. It is also helpful to order a</span> <span>paper catalog from a parts vendor such as Digi-Key, Jameco or Newark</span> <span>Electronics and just leaf through the pages in your spare time. At first,</span> <span>reading through a parts catalog may feel like reading a dictionary, but as</span> <span>you look at more and more circuit boards, you will gradually find that</span> <span>everything makes sense.</span></p>

  <p>The next most powerful tool of the reverse engineer is pattern matching. <span>All hardware engineers are constrained by the same laws of nature, and</span> <span>all hardware engineers use the same kinds of building blocks. Engineers</span> <span>also like to modularize and reuse existing designs. As a result, a single</span> <span>design motif can be found in many designs. Recognizing design motifs</span> <span>will enable you to determine the function of circuits even if you do not</span> <span>recognize a single part number. Likewise, one can go quite far in reverse</span> <span>engineering without any formal electrical engineering training.</span></p>

  <p>The final tool of the reverse engineer is experimentation. When intuition <span>and pattern matching fail to reveal the secrets of a circuit, one must resort to probing and perturbing the system and trying to deduce function based on the observed responses. While experimentation may lead to hardware</span> <span>failure, one can take solace in the fact that most consumer hardware is</span> <span>designed to be probed and tested as a requirement for manufacturing.</span> <span>Furthermore, in the case of the Xbox, one can take some comfort in the</span> <span>fact that a new Xbox is relatively inexpensive. Buying two boxes up front</span> <span>and treating one as the “sacrificial” box helps remove the psychological</span><span>barrier one might otherwise have about performing aggressive experi</span><span>ments on the hardware.</span></p>

  <p>This chapter will introduce you to the basics of reverse engineering, with <span>a focus on basic techniques, such as reading circuit boards to build an</span> <span>intuition, and some coverage of intermediate techniques such as pattern</span> <span>matching and recognizing basic design motifs.</span></p>

  <h2 class="calibre1" id="sigil_toc_id_16">Reading a Circuit Board</h2>

  <p>The first thing you see when you take the cover off of a typical electronic device is the circuit board. Typically colored green or tan, this multilayer sandwich of copper, glass fiber and epoxy contains an exact schematic netlist within its traces. In other words, by following the traces, one can determine exactly how every component is connected. The placement of <span>components and the layout of the traces also contains clues that can bring</span> <span>insight into the designer’s thought process.</span></p>

  <h3 class="calibre1" id="sigil_toc_id_17">Circuit Board Basics</h3>

  <p>A typical circuit board consists of a few layers of patterned copper <span>separated by thin sheets of fiberglass impregnated with epoxy. The color</span> <span>of a raw circuit board is whitish or tan with copper traces; however,</span> <span>almost all circuit boards are coated with a thin polymer called the</span> <i class="calibre4">soldermask</i><span>that gives circuit boards their familiar green color. Molten solder does not adhere to the soldermask, so during production excess</span> <span>solder does not stick to the board and cause shorts. The soldermask has</span> <span>openings for connections to components. These openings typically have a</span> <span>silvery color from a thin plating of tin or solder that is applied to prevent the copper from oxidizing and to enhance solderability.</span></p>

  <p>On top of the soldermask is typically a layer of white lettering referred to as the <i class="calibre4">silkscreen</i>. Each component on a circuit board has an outline and a unique designator on the silkscreen layer. The designator enables people to quickly associate a component on a circuit board with a component on <span>a schematic. You can use the designator to help guess the function of a</span><span>component based on the component naming scheme. Table 2-1 summa</span><span>rizes the component naming scheme used in the Xbox.</span></p>

  <p><span><br/></span></p>

  <div class="note">
    <h3 class="sigil_not_in_toc">Tip</h3><img alt="" class="calibre2 note" src="../Images/index-51_1.png" style="height: auto; width: auto; float: left; margin-right: 20px; margin-bottom: 20px;"/><span style="font-size: 1em; font-weight: bold;">The Xbox motherboard includes a handy coordinate system printed along the edges of the board in the silkscreen layer. On the component side of the board, the coordinates go from A through G on the sides, and from 1 through 8 along the top and bottom. The reverse side of the board has coordinates M through V along the sides. Note that theletters I, O, Q, and S are skipped because they can be confused with the numbers 0, 1, and 5. Component designators on the Xbox motherboard are encoded using this coordinate system; thus, J7D1, the LPC debug port, can be found on the top side at coordinates 7D. This book will frequently use this coordinate system along with the component designators to refer to specific components.</span>
  </div>

  <p>Connections between wiring layers are made by copper-filled holes called <i class="calibre4">vias</i>. <span>Since the cost of a circuit board grows with the number of layers, most</span> <span>consumer electronic devices are designed to keep the number of layers to a</span> <span>minimum. Radio receivers and audio amplifiers will typically use single-</span><span>sided boards, whereas the latest PC motherboards might have up to six or</span><span>eight layers. The Xbox motherboard has four layers. The top two layers are</span> <span>dedicated to carrying information between chips, and the inner two layers are dedicated to delivering power. The Xbox motherboard will appear opaque</span> <span>at first glance because the inner power layers are basically solid sheets of copper. The good news for reverse engineering is that we can trace every</span> <span>connection on the Xbox motherboard through casual visual inspection</span> <span>because all of the signals layers are outside of the opaque power layers. The Xbox design contrasts with motherboards that bury two or four signal</span> <span>layers inside of the power layers. Buried signal layers can make signal</span> <span>tracing difficult. (Note that the decision to bury signals inside power</span><span>layers is typically not driven by security, but rather by the physics of how electrical signals interact between circuit board layers.)</span></p>

  <table>
    <thead>
      <tr>
        <th>
          <p>Designator</p>
        </th>

        <th>
          <p>Component Type</p>
        </th>
      </tr>
    </thead>

    <tbody>
      <tr>
        <td>
          <p>C</p>
        </td>

        <td>
          <p>Capacitor</p>
        </td>
      </tr>

      <tr>
        <td>
          <p>R</p>
        </td>

        <td>
          <p>Resistor</p>
        </td>
      </tr>

      <tr>
        <td>
          <p>U</p>
        </td>

        <td>
          <p>Integrated Circuit or Transistor</p>
        </td>
      </tr>

      <tr>
        <td>
          <p>L</p>
        </td>

        <td>
          <p>Inductor</p>
        </td>
      </tr>

      <tr>
        <td>
          <p>RP</p>
        </td>

        <td>
          <p>Resistor Pack</p>
        </td>
      </tr>

      <tr>
        <td>
          <p>Q</p>
        </td>

        <td>
          <p>Transistor</p>
        </td>
      </tr>

      <tr>
        <td>
          <p>CR</p>
        </td>

        <td>
          <p>Diode</p>
        </td>
      </tr>

      <tr>
        <td>
          <p>J</p>
        </td>

        <td>
          <p>Connector or Jumper</p>
        </td>
      </tr>

      <tr>
        <td>
          <p>RT</p>
        </td>

        <td>
          <p>Resettable Fuse</p>
        </td>
      </tr>

      <tr>
        <td>
          <p>Y</p>
        </td>

        <td>
          <p>Crystal</p>
        </td>
      </tr>
    </tbody>
  </table>

  <p class="calibre1 caption"><b class="calibre3">Table 2-1</b>: The Xbox component naming scheme.</p>

  <p class="calibre1 caption"><span style="font-style: normal;">It’s fairly easy to trace a signal. Starting from the connection of the source component to the board, follow the copper trace. If the trace intersects with a circle, then there is a good chance that the signal continues on the opposite side of the board. If a trace ends and there is no connection to</span> <span style="font-size: 1em; font-style: normal;">the other side of the board, there is a good chance that the trace is</span> <span style="font-size: 1em; font-style: normal;">connected to one of the power planes.</span><br/></p>

  <p><br/></p>

  <p><img alt="" class="calibre2" src="../Images/index-52_2.png" style="height: auto; width: auto;"/></p>

  <p class="calibre1 caption"><b class="calibre3">Figure 2-1</b>: Cross-section of a typical circuit board.<br/></p>

  <div class="note">
    <h3 class="sigil_not_in_toc">Try it</h3><img alt="" src="../Images/tools.png"/>

    <p>Try tracing some signals on the Xbox motherboard. On the Xbox motherboard, take a look at connector J8C1, the 40- pin IDE connector in sector 8C. Almost all of the signals from the IDE connector go to one chip, the MCPX, on the motherboard by way of some resistor packs. What might you be able to conclude about that chip? Notice how some of the traces coming from the IDE connector mean der back and forth. This is a technique used to try and ensure that all wires have the same length. See the sidebar on “Why do Circuit Board Traces Meander Everywhere?” for more explanation.</p>
  </div>

  <h3 id="sigil_toc_id_18">Components</h3>

  <p>Now that you have a little bit of experience tracing back a signal, it is time to learn what some basic components look like. <span>Components are classified as passive and active. Loosely speaking,</span> <span>passive components cannot amplify a signal, so they usually have just two</span> <span>leads. Sometimes multiple passive components are packaged together, so</span> <span>a single package of passive components will have multiple leads. Passive</span> <span>components include capacitors, resistors and inductors. The most</span> <span>common passive components on the Xbox motherboard are capacitors.</span> <span>Capacitors store energy as an electric charge; in the Xbox, they are</span> <span>primarily used to smooth out local power fluctuations from CMOS</span> <span>digital logic switching, and to suppress high frequency noise.</span></p>

  <p><img alt="" class="calibre2" src="../Images/index-53_1.png" style="height: auto; width: auto;"/></p>

  <p class="calibre1 caption"><b class="calibre3">Figure 2-2</b><span>: Typical passive components in an Xbox.</span><br/></p>

  <p class="calibre1 caption"><span><br/></span></p>

  <div class="infobox">
    <h2 class="sigil_not_in_toc">Why Do Circuit Board Traces Meander Everywhere?</h2>

    <p class="calibre1">After looking at a few circuit boards, you will probably start <span>noticing that the traces on the circuit board often times</span> <span>meander all over the place, sometimes going back and</span><span>forth several times before connecting to their destination.</span> <span>This seems pointless when a straight trace would do the</span> <span>trick. However, rarely will you find a structure on a circuit</span><span>board that was placed as a flighty whim by the designer. It</span> <span>turns out that the speed of signals in most high-end elec</span><span>tronic devices, about ¼ the speed of light, is slow com</span><span>pared to the time required for a signal to arrive at its desti</span><span>nation. For example, a signal will only travel 3 inches on a</span> <span>circuit board during one clock cycle in a 1 GHz processor</span> <span>(one clock tick at 1 GHz is a duration of 1 billionth of a</span> <span>second, or one nanosecond). Thus, two signals starting from</span> <span>the same chip will arrive at their destination at quite differ</span><span>ent times if the trace lengths are very different. To combat</span> <span>this, designers will put extra bends into the shorter trace so</span> <span>that the effective length of the trace is the same as the</span> <span>longer one.</span></p>
  </div>

  <p>Other large passive components found on the Xbox motherboard <span>include inductors and resistors. The large wire-wound</span> <i class="calibre4">toroidal</i> <span>(donut-shaped) inductors found on the Xbox motherboard are all part of the</span> <span>power supply subsystem. Inductors store energy as magnetic flux. An</span> <span>inductor’s electrical properties are complementary to that of a capacitor.</span> <span>Combinations of inductors and capacitors with transistor switches in</span> <span>between are used to build very efficient power regulators. Most of the</span> <span>resistors on the Xbox motherboard are used either to absorb excess</span> <span>energy at the termination of signal traces, or to bias a wire to a particular logic level.</span></p>

  <p>There are two ways you can identify a passive device on the Xbox <span>motherboard. The first is by the shape of the package. Package shape</span> <span>recognition is feasible because there are so few basic varieties of passive parts. Figure 2-2 has some pictures of the capacitors, inductors, and</span><span>resistors that you might see on an Xbox motherboard. The second</span> <span>method is to read the label next to the part on the motherboard and to</span> <span>infer the part’s function by the reference designator, using Table 2-1 as a guide.</span></p>

  <p>Active components can amplify signals, and have three or more leads. The <span>simplest active component is a transistor, with three and occasionally four leads (sometimes discrete “MOSFET” transistors have an explicit fourth</span> <span>“body” terminal). The most complicated active components are inte</span><span>grated circuits, such as CPU and memory chips, with hundreds, some</span><span>times thousands, of leads. Integrated circuits come in a wide variety of</span> <span>packages, and sometimes the connections are hidden underneath the</span> <span>package, as is the case in the Ball Grid Array (BGA) package. The</span> <span>graphics chip, MCPX, and CPU on the Xbox motherboard use BGA</span><span>packages. Figure 2-3 shows a cross section of a BGA device, revealing</span> <span>the hidden connections underneath.</span></p>

  <p><img alt="" class="calibre2" src="../Images/index-54_1.png" style="height: auto; width: auto;"/></p>

  <p class="calibre1 caption"><b class="calibre3">Figure 2-3</b><span>: Cross sectional view of a BGA packaged part (GeForce2) mounted on a motherboard.</span><br/></p>

  <p><br/></p>

  <div class="infobox">
    <h2 class="calibre1 sigil_not_in_toc"><b class="calibre3">What Are All These Resistors and</b> <b class="calibre3">Capacitors Doing on a Digital</b> <b class="calibre3">Circuit Board?</b></h2>

    <p class="calibre1" style="margin: 1em 0px;">A motif you will notice on many circuit boards is a prepon<span>derance of resistors and capacitors. Capacitors are every</span><span>where because they help keep noise to a minimum and</span><span>stabilize the power supply voltages. They are required be</span><span>cause the copper planes used to distribute power have a</span> <span>small amount of resistance and inductance. These small</span><span>parasitics can cause big problems when a large amount</span> <span>of current is switched through the power supply. The exact</span> <span>placement and selection of capacitors is considered a bit</span> <span>of a black art. If you happen to knock off one of the tiny,</span> <span>sand-grain sized capacitors on a circuit board while work</span><span>ing on it, chances are that you’ll be able to get away</span> <span>without replacing it. However, given a defect of this kind,</span> <span>the most likely problem you will encounter are intermittent</span> <span>reliability problems.</span></p>

    <p class="calibre1" style="margin: 1em 0px;">While capacitors are everywhere to provide local storage <span>of energy for all the components, the resistors remove ex</span><span>cess energy. Fast signals on a motherboard carry a lot of</span> <span>energy, and if the energy is not dissipated at the receiver in</span> <span>a controlled fashion with a resistor, the signal energy will</span> <span>reflect back to the transmitter and cause problems. The</span> <span>phenomenon is similar to that of sound in a gymnasium.</span> <span>When you speak in an empty gymnasium, there is an echo.</span> <span>If you speak too fast, people will be unable to understand</span> <span>you because the echo will start interfering with your speech.</span> <span>However, if you cover the gymnasium walls with foam, the</span> <span>echo will be absorbed by the foam and you can talk with</span><span>out interference from your echo.</span></p>

    <p class="calibre1" style="margin: 1em 0px;">Resistors are like the acoustic foam you would put on walls <span>to damp out echoes, so that circuits can talk to each other</span> <span>at high speeds. Unlike most capacitors, if you happen to</span><span>knock off one of these resistors while playing around, you will</span> <span>have to replace it in order for the circuit to work properly.</span> <span>These “termination resistors” are often packaged four or</span><span>eight to a package, so they almost look like small inte</span><span>grated circuits. You can distinguish resistor packs from other</span> <span>components because they are shiny, slightly lumpy, have a</span> <span>white border, and they will have a reference designator</span> <span>prefix of “RP” near them. When tracing a signal through a</span> <span>resistor pack, it is fairly safe to assume that signals flow straight</span> <span>through, so that a connection on one side goes straight</span> <span>through to the pin immediately on the other side.</span></p>
  </div>

  <p><span><br/></span></p>

  <p><span>Identifying the function of a particular integrated circuit is more challenging than identifying the function of a passive device. Functionally</span> <span>identical silicon can be purchased in a variety of packages that can look</span> <span>very different. In some cases, you can guess the function of a device by</span> <span>observing what the device is connected to or what it looks like, but the</span> <span>most reliable method is to read the part number off the chip and look it</span> <span>up on the web. (Typically, parts have some kind of logo or part number</span> <span>prefix that identifies the manufacturer, which you can use to find more</span> <span>data on the device by visiting the manufacturer’s website.) If you do not</span> <span>recognize the logo or the part number prefix, the services listed below</span> <span>can help you look up part functions.</span></p>

  <p>1. www.findchips.com can take a part number or pieces of a part <span>number and search the inventories of many distributors for</span> <span>inventory matches. Most common parts will show up in</span><span>FindChips, and the links provided will often lead you not only to</span> <span>a short description of the part, but also pricing and ordering</span> <span>information.</span></p>

  <p>2. www.google.com indexes everything on the web, and part num<span>bers are no exception. Google can also be used to help find</span> <span>manufacturer’s websites if you query on the letters in the logo plus a</span> <span>descriptive term such as “semiconductors.” At the manufacturer’s</span> <span>website, you will probably need to find the specialized part search</span> <span>engine buried in the website or go to the semiconductor products</span> <span>sub-page in order to do a part number lookup. The search function</span> <span>on the front page of a company’s website will sometimes find part</span> <span>numbers, but more often it indexes only useless corporate and</span> <span>marketing pages.</span></p>

  <p>3. If neither of these services gets you there, try stripping off some <span>of the prefixes and suffixes on the part number. In our</span> <span>M29F080A example, querying just the part number 29F080 will</span><span>bring you to the webpages of multiple manufacturers who make</span> <span>parts that are functionally compatible with the STMicroelectronics</span> <span>part.</span></p>

  <p><img alt="figure_2-4" src="../Images/figure_2-4.png" style="width: 587.6875px;"/><br/></p>

  <p class="calibre1 caption"><b class="calibre3">Figure 2-4</b>: Anatomy of a typical IC part number. The diagram is a cartoon of the chip at location U7D1 on the Xbox motherboard.</p>

  <div class="note">
    <h3 class="sigil_not_in_toc">Try It</h3><img alt="" class="calibre2 note" src="../Images/index-57_1.png"/>

    <p><b class="calibre3">Let’s try looking up an Xbox part number. Locate U7D1 on</b> <b class="calibre3">the Xbox motherboard. Figure 2-4 illustrates what you might</b> <b class="calibre3">find. The part number is typically the longest number on</b> <b class="calibre3">the chip, and it often starts with one or two alphabetic</b> <b class="calibre3">characters. Memory chips and processors also frequently</b> <b class="calibre3">have a speed grade or quality suffix after the part number.</b> <b class="calibre3">Additionally, almost all chips have a<i class="calibre4">date code</i></b><b class="calibre3">. Date codes</b> <b class="calibre3">are usually a four digit number of the format YY-WW, where</b> <b class="calibre3">YY is the year the chip was manufactured, and WW is the</b> <b class="calibre3">workweek. In our example, our M29F080A part was manu</b><b class="calibre3">factured in the 41st week of 2001 in Singapore, and it has a</b> <b class="calibre3">speed grade of 70N1. The remaining number, 5881K, is a</b> <b class="calibre3">lot code whose meaning varies between manufacturers, but</b> <b class="calibre3">in general links a chip to a particular silicon wafer or sili</b><b class="calibre3">con wafer lot’s tracking number in the fabrication facility.</b></p>

    <p><b class="calibre3">The “ST” logo indicates the manufacturer of this chip is</b> <b class="calibre3">STMicroelectronics, and fortunately the website for this</b> <b class="calibre3">manufacturer can be quickly found through Google or by</b><b class="calibre3">guessing, as the URL for the company is simply</b> <span>www.st.com</span><b class="calibre3">.</b> <b class="calibre3">Entering the part number M29F080A into the search field on</b> <b class="calibre3">the home page brings you directly to search results that</b> <b class="calibre3">include detailed datasheets and descriptions of this part</b> <b class="calibre3">— an 8 Mbit Uniform Block Single Supply FLASH ROM.</b></p>
  </div>

  <h3 id="sigil_toc_id_19">Test Points</h3>

  <p>Almost all circuit boards in consumer electronics feature structures designed to expedite the testing of the finished board in the factory. These “test points” exist to cope with the unfortunate reality of manufacturing defects. <span>The Xbox is no exception when it comes to test points and manufacturing</span> <span>defects. The bottom of the Xbox motherboard is populated with hundreds</span> <span>of test points — tiny silvery circles — that allow a contact probe to</span> <span>access almost every interesting signal within the Xbox. These test points</span> <span>are a welcome gift to reverse engineers and to people who wish to</span> <span>modify their hardware, because they provide easy access to signals that</span> <span>might otherwise require a microscope and a steady hand.</span></p>

  <p><span>A set of test points are probed all at once on the manufacturing line with a piece of equipment called a “bed of nails tester.” Aptly named, the bed</span> <span>of nails tester consists of hundreds of spring-loaded “pogo pin”</span> <span>structures. A motherboard is aligned to the testbed and clamped down</span> <span>with either mechanical plungers or a vacuum chuck. Similarly, you can use</span> <span>pogo-pins to make your own solderless modifications to an Xbox</span> <span>motherboard by leveraging the test points. You wil need to build your</span> <span>own circuit boards (see Appendix), but the result will be a board that you</span> <span>can install simply by screwing it down —</span> <i class="calibre4">no soldering required!</i></p>

  <h2 id="sigil_toc_id_20">Xbox Architecture</h2>

  <p>Before diving into the pattern matching examples, we will need a pattern <span>reference. Let’s take this opportunity to study the Xbox internal architec</span><span>ture as the pattern reference, and eventually compare the Xbox architecture to a PC and to another video game console.</span></p>

  <h3 id="sigil_toc_id_21">High-Level Organization</h3>

  <p>The Xbox has a Pentium-III class processor running at 733 MHz as its <span>CPU. The “S-Spec” number on the CPU is closest to that of a Mobile</span> <span>Celeron. The CPU is connected via a standard P6 133 MHz Front Side Bus</span> <span>(FSB) to a graphics processing unit (GPU) and a northbridge combo</span> <span>chip called the NV2A by nVidia. Its closest PC relative is the nForce IGP</span><span>chip by nVidia. Since the northbridge logic and the GPU are combined</span> <span>in a single chip, the CPU and graphics processors can share a common</span> <span>bank of memory. This is cal ed a “unified memory architecture” (UMA).</span> <span>Compared to a traditional split video/main memory architecture, a</span> <span>UMA costs less to build because it eliminates the dedicated video</span> <span>memory. However, UMA has lower performance in certain situations</span> <span>because it introduces memory access contention between the main</span> <span>processor and the graphics processor. In order to alleviate some of this</span><span>contention, the system memory is frequently split into multiple banks.</span> <span>The nForce IGP, for example, splits the memory into two banks that can</span> <span>be independently accessed by both the GPU and the CPU through a</span> <span>switching network.</span></p>

  <p><img alt="" class="calibre2" src="../Images/index-58_1.png" style="height: auto; width: auto;"/><span><br/></span></p>

  <p class="calibre1 caption"><b class="calibre3">Figure 2-5</b>: High level architectural view of the Xbox.</p>

  <p><img alt="" class="calibre2" src="../Images/index-59_1.png" style="height: auto; width: auto;"/></p>

  <p class="calibre1 caption"><b class="calibre3">Figure 2-6</b><span>: Photograph of an Xbox motherboard with the major components labelled.</span><br/></p>

  <p>The GPU is connected to a kitchen-sink chip called the “MCPX” via a <span>fast, narrow bus called a HyperTransport bus. The MCPX combines a</span> <span>southbridge chip plus almost all of the Xbox peripherals, including USB</span> <span>controllers, a legacy boot ROM interface, a Dolby digital audio processor, a mass storage IDE controller, an ethernet control er, and interfaces to system management functions.</span></p>

  <p><span>The connectivity of all the major blocks in an Xbox are illustrated in</span> <span>Figure 2-5, and Figure 2-6 illustrates the location of these blocks on an</span> <span>actual Xbox motherboard.</span></p>

  <h3 id="sigil_toc_id_22">Functional Details</h3>

  <p>The following sections present a cursory overview of the pieces that <span>constitute the Xbox architecture. We pay particular attention to the</span> <span>details necessary for understanding how to reverse engineer the Xbox</span> <span>security mechanisms.</span></p>

  <h4 id="sigil_toc_id_23">CPU</h4>

  <p>The CPU (Central Processing Unit) is the computational heart of a conven<span>tional computer. The subject of CPU architecture deserves an entire book</span> <span>alone, so we will cover just the material required to understand how to</span> <span>reverse engineer the Xbox. In particular, we will investigate how to gain</span> <span>control of the Xbox CPU.</span></p>

  <p>A CPU reads sequences of instructions stored in memory — programs <span>— that tell the CPU to perform various computations or to make</span> <span>decisions based on available data. The instructions are stored in memory</span> <span>as numbers called</span> <i class="calibre4">opcodes</i><span>. Opcodes take</span> <i class="calibre4">operands</i> <span>as arguments. Programmers use alphabetic mnemonics when writing low-level machine code so that they don’t have to remember hundreds of opcode numbers. For</span> <span>example, a kind of byte-wide subtraction instruction has the opcode</span> <span>0010.1000 (binary) or 0x28 (hexadecimal) and the mnemonic “SUB”.</span> <span>The requisite subtraction opcode varies depending upon the source and</span><span>width of the subtraction data. Keeping track of all of the opcode to</span> <span>operand rules is overwhelming, so the process of translating mnemonics</span> <span>and operands to instruction numbers is accomplished with a program</span> <span>called an</span> <i class="calibre4">assembler</i><span>. Likewise, the process of translating instruction numbers back into mnemonics is done with a disassembler. Significantly,</span> <span>most programs are not written in assembly language; a higher-level</span> <span>language, such as C, is typically employed. These high-level languages are</span> <span>translated into machine instructions using compilers. Automatic</span> <span>decompilation of machine instructions back into a high-level language</span><span>can be difficult because the process of compilation — especially opti</span><span>mized compilation — discards much of the high-level structural infor</span><span>mation contained in the original source code.</span></p>

  <p><span>The processor keeps track of which instruction is being executed with an</span> <i class="calibre4">instruction pointer</i><span>(IP). An IP is also referred to as a</span> <i class="calibre4">program counter</i> <span>(PC) in some contexts. IPs typically advance through a program one instruction at a time, unless a branch instruction is encountered. A branch instruction gives the program an opportunity to make a decision by inspecting data inside the CPU and jumping to a new location based on the outcome of the inspection.</span> <i class="calibre4">Understanding the movement of the instruction pointer is a central part</i> <i class="calibre4">of reverse engineering an Xbox</i><span>. Being able to manipulate the IP is tantamount to having control of what the Xbox can and cannot do. The security measures implemented in the Xbox software architecture attempt to</span> <span>guarantee that the IP is always executing only Microsoft-approved code</span><span>by always cryptographically verifying a piece of code for authenticity</span> <span>before running it.</span></p>

  <div class="infobox">
    <h2 class="calibre1 sigil_not_in_toc">Binary and Hexadecimal Numbers</h2>

    <p class="calibre1" style="margin: 1em 0px;">Digital circuits use 1’s and 0’s to represent numbers. This binary, or <span>“base-2”, notation is a reflection of the way electrical signals are</span> <span>used to represent numbers: two ranges of voltage levels are used</span> <span>to define one logic state or the other. It is possible to build electrical</span> <span>systems that represent information using more than two voltage</span> <span>levels, but only at the cost of power and complexity. Modern mo</span><span>dems, for example, use multiple voltage levels and phase informa</span><span>tion to represent multiple bits of data in a single time unit.</span></p>

    <p class="calibre1" style="margin: 1em 0px;">Number composition and arithmetic in binary follows the same <span>rules as our familiar decimal (“base-10”) representation. In decimal,</span> <span>0’s are used as placeholders to remember when a digit has over</span><span>flowed. For example, 1 more than 9 leads to an overflow because</span> <span>there is no single digit bigger than 9. Hence, the number 10 records</span><span>that we had one overflow of the right-most decimal location. Like</span><span>wise, in binary, 1 more than 1 is 10, since the largest single digit in</span> <span>binary is 1.</span></p>

    <p>Thus, in decimal, the value of a four-digit decimal number d<sub>4</sub>d<sub>3</sub>d<sub>2</sub>d<sub>1</sub> can be broken down as:</p>

    <p>d<sub>4</sub> * 10<sup>3</sup> + d<sub>3</sub> * 10<sup>2</sup> + d<sub>2</sub> * 10<sup>1</sup> + d<sub>1</sub> * 10<sup>0</sup> = d<sub>4</sub> * 1000 + d<sub>3</sub> * 100 + d<sub>2</sub> * 10 + d<sub>1</sub> * 1</p>

    <p>Likewise, a four-digit binary number b<sub>4</sub>b<sub>3</sub>b <sub>2</sub>b<sub>1</sub> can be broken down as:</p>

    <p>b<sub>4</sub> * 2<sup>3</sup> + b<sub>3</sub> * 2<sup>2</sup> + b<sub>2</sub> * 2<sup>1</sup> + b<sub>1</sub> * 2<sup>0</sup> = b<sub>4</sub> * 8 + b<sub>3</sub> * 4 + b<sub>2</sub> * 2 + b<sub>1</sub> * 1</p>

    <p>For example, the number 1010 = 1*8 + 0*4 + 1*2 + 0*1 = 10 decimal.</p>

    <p class="calibre1" style="margin: 1em 0px;">Keeping track of numbers in straight binary can become cumber<span>some quickly; for example, to represent decimal 968, you need ten</span> <span>binary digits. To save on screen space, binary numbers are con</span><span>verted to octal or hexadecimal. The octal format, or “base-8”, was</span> <span>popular in the early days of computers, but has since become a</span> <span>rarity. Hexadecimal, or “base-16”, is the de-facto numbering sys</span><span>tem. There are 16 digits in hexadecimal, so the hex digits that corre</span><span>spond to decimal numbers 10 through 15 are represented by the</span> <span>letters A through F. Table 2-2 summarizes the conversion between</span><span>binary, decimal, and hexadecimal for the first 16 positive integers.</span></p>

    <p class="calibre1" style="margin: 1em 0px;">In order to differentiate hexadecimal from decimal numbers, many <span>people use the C language convention where 0x[number] represents a</span> <span>hexadecimal number, and [number] is implicitly a decimal number. Bi</span><span>nary numbers have no similar standard to draw from in C, so some</span> <span>people use the Verilog standard, [digits]’b[number], where [digits] is the</span> <span>number of digits in the binary number. The suffix “b” after a string of 1’s and 0’s, such as 1010.1100.1110b is also used to denote a binary number.</span> <span>Notice how a “.” was used to group the binary digits into sets of four;</span> <span>this assists in mentally translating the binary number into hexadeci</span><span>mal: 0xACE.</span></p>
  </div>

  <div class="infobox" style="border: 1px dotted black; margin: 10px; padding: 10px; font-size: 14px;">
    <table style="border-collapse: collapse;">
      <tbody>
        <tr>
          <th style="border: 1px solid black; padding-right: 5px; padding-left: 5px; background-color: rgb(204, 204, 204);">Bin</th>

          <th style="border: 1px solid black; padding-right: 5px; padding-left: 5px; background-color: rgb(204, 204, 204);">Dec</th>

          <th style="border: 1px solid black; padding-right: 5px; padding-left: 5px; background-color: rgb(204, 204, 204);">Hex</th>

          <th style="border: 1px solid black; padding-right: 5px; padding-left: 5px; background-color: rgb(204, 204, 204);"/>

          <th style="border: 1px solid black; padding-right: 5px; padding-left: 5px; background-color: rgb(204, 204, 204);">Bin</th>

          <th style="border: 1px solid black; padding-right: 5px; padding-left: 5px; background-color: rgb(204, 204, 204);">Dec</th>

          <th style="border: 1px solid black; padding-right: 5px; padding-left: 5px; background-color: rgb(204, 204, 204);">Hex</th>
        </tr>

        <tr>
          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">0000</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">0</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">0</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;"/>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">1000</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">8</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">8</td>
        </tr>

        <tr>
          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">0001</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">1</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">1</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;"/>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">1001</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">9</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">9</td>
        </tr>

        <tr>
          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">0010</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">2</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">2</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;"/>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">1010</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">10</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">A</td>
        </tr>

        <tr>
          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">0011</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">3</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">3</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;"/>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">1011</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">11</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">B</td>
        </tr>

        <tr>
          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">0100</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">4</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">4</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;"/>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">1100</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">12</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">C</td>
        </tr>

        <tr>
          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">0101</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">5</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">5</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;"/>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">1101</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">13</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">D</td>
        </tr>

        <tr>
          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">0110</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">6</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">6</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;"/>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">1110</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">14</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">E</td>
        </tr>

        <tr>
          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">0111</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">7</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">7</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;"/>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">1111</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">15</td>

          <td style="border: 1px solid black; padding-right: 5px; padding-left: 5px;">F</td>
        </tr>
      </tbody>
    </table>
  </div>

  <p class="calibre1 caption"><b class="calibre3">Table 2-2</b>: Binary, decimal, and hexadecimal conversion table.</p>

  <p>The heart of a CPU is a tiny, but very fast, memory called the register file. <span>Multiple pieces of data can be written into and read out of a register file each processor clock cycle. Data from the register file is fed into an</span> <span>execution unit called the arithmetic logic unit (ALU). The function</span><span>computed by the ALU is controlled by instructions fetched from</span> <span>memory. Once the data has been processed by the ALU, it can either be</span> <span>written back into the register file, or stored into memory.</span></p>

  <p>One important performance feature of almost every modern CPU is a <span>memory access accelerator called a</span> <i class="calibre4">cache</i><span>. Caches are small, fast memories that store copies of data and instruction snippets that are likely to be used in the near future by the CPU core. Caches are slower than register</span> <span>files but faster than main memory; likewise, caches store more data than a</span><span>register file, but store less data than main memory.</span></p>

  <p>One important feature of the Xbox CPU cache to be aware of is that it is <span>a writeback cache. Writeback caches allow copies of data stored inside</span> <span>the CPU to be out of sync with what exists in main memory. This timing</span> <span>difference can complicate attempts to trace CPU execution by observing</span> <span>external memory traffic alone. The cache memory can also be leveraged</span> <span>by security routines to hide intermediate computation results from</span> <span>someone observing the memory bus.</span></p>

  <h4 class="calibre1" id="sigil_toc_id_24"><b class="calibre3">Northbridges and Southbridges</b></h4>

  <p>The terms Northbridge and Southbridge are vernacular specific to the <span>PC architecture. They refer to the two basic support chips that are found</span> <span>in virtually every PC. A Northbridge chip connects the CPU to main</span> <span>memory as well as any high-performance expansion busses, such as AGP</span> <span>and PCI. A Southbridge chip hangs off of the Northbridge chip and</span> <span>contains all of the extra peripherals that are found in a typical PC —</span> <span>parallel, serial, USB, mouse, keyboard, IDE controllers, audio codecs,</span> <span>and more. Dividing the PC architecture into these three main modules —</span> <span>CPU, Northbridge and Southbridge — enables PC designers to mix and</span> <span>match different kinds of memory architectures with a diverse selection of</span> <span>processors and peripherals.</span></p>

  <p>The connection between the Northbridge and the Southbridge chipsets <span>varies from chipset to chipset. In the case of the Xbox, a high perfor</span><span>mance, narrow parallel bus called HyperTransport is employed as the</span> <span>connection between the functional equivalent of the Northbridge and</span> <span>Southbridge chips. The bus is only 8 bits wide in each of two directions,</span> <span>but it is clocked at 200 MHz and data is sampled on each clock edge so</span> <span>the effective peak transfer rate is 400 Mbytes/second in each direction. A</span> <span>Northbridge chip is connected to a CPU via a bus called the Front Side</span> <span>Bus (FSB). In the case of the Xbox, the FSB is a 64-bit 133 MHz bus that</span> <span>uses AGTL+ logic levels.</span></p>

  <p>Knowing and understanding the kinds of connections between chips is <span>crucial in reverse engineering because the kind of connection will dictate how difficult it is to intercept data going between various components.</span> <span>The details of the relatively easier bus to tap, the HyperTransport bus, are discussed in Chapter 8, “Reverse Engineering Xbox Security.”</span></p>

  <p><span>In the Xbox, the Southbridge is a chip designed by nVidia called the</span> <span>MCPX; it is a derivative of the nVidia nForce MCP Multimedia and</span> <span>Communications Processor. The Northbridge chip was also designed by</span> <span>nVidia, and it is called the NV2A GPU. Both the Northbridge and</span> <span>Southbridge chips were manufactured by TSMC (Taiwan Semiconductor</span> <span>Manufacturing Corporation). The NV2A combines both a GPU (Graph</span><span>ics Processing Unit) and the traditional memory and expansion bus</span> <span>controllers found in most Northbridge chips. As explained previously,</span> <span>combining the graphics processor and the Northbridge allows system</span> <span>designers to merge the graphics memory into main memory, at some</span> <span>performance penalty.</span></p>

  <h4 class="calibre1" id="sigil_toc_id_25"><b class="calibre3">RAM</b></h4>

  <p>The Xbox motherboard employs 64 MB of DDR SDRAM for the main <span>memory. DDR SDRAM stands for Double Data-Rate Synchronous</span> <span>Dynamic Random Access Memory. By combining synchronization and</span> <span>DDR techniques, the aggregate bandwidth of the Xbox main memory</span><span>achieves 6.4 Gigabytes/second.</span> <span>A RAM is basically a table of information that is indexed by the CPU.</span> <span>Each location in RAM has a unique index number called its address, and</span> <span>as the name “random access” implies, there are no restrictions on the</span> <span>order of data access in a RAM.<sup>1</sup></span></p>

  <p>The term “dynamic” is applied to RAM that has to be constantly <span>refreshed in order to preserve the integrity of data. For example, the</span> <span>RAM used in the Xbox must have every location read out and written</span> <span>back about thirty times a second. The performance penalty is not as bad</span> <span>as it sounds, as special hardware is built into modern DRAM chips that</span> <span>help optimize the process.</span></p>

  <p>The “synchronous” prefix means that inside the DRAM, the procedure <span>for data access is broken down into a series of steps. Each of these steps are independent and can occur in parallel, so that multiple data requests</span> <span>can be in-flight simultaneously. An external timing signal, known as a</span> <span>clock, is used to synchronize the movement of data access requests</span><span>through the various steps inside the DRAM. As a result, data access</span> <span>requests flow through each step like water through a pipe, and this</span> <span>technique is also known as pipelining. Synchronous DRAMs have higher</span> <span>bandwidth throughput than their predecessors, because pipelining allows</span> <span>multiple requests to be processed at once. However, the time required</span> <span>from when an access is first issued to an SDRAM to when the data finally</span> <span>appears on the output —the access latency — is not improved by</span> <span>pipelining.</span></p>

  <p>The term “Double Data Rate” refers to the way synchronous data is <span>transferred relative to the synchronizing clock. A clock waveform</span> <span>consists of a repeating pattern of high and low signals. In traditional</span> <span>systems, data is only transferred on the low-to-high transition of a clock waveform. In a DDR system, data is transferred on both the low-to-high</span> <span>and the high-to-low transitions. Thus, for the same clock frequency, twice</span> <span>the amount of data can be transferred. The performance mnemonic</span> <span>quoted by DDR SDRAM vendors, such as DDR266, refers to the</span><span>transfer rate, so the actual clock speed is one-half the performance</span> <span>mnemonic, or 133 MHz in this case.</span></p>

  <h4 id="sigil_toc_id_26">ROM</h4>

  <p>Every computer needs to have some kind of persistent or non-volatile <span>memory for storing the start-up, or boot, program. The DDR SDRAM</span> <span>discussed above does not work for this application because all data in a</span> <span>DDR SDRAM is lost when the power is removed. Current versions of</span> <span>the Xbox use a FLASH ROM instead to store data that has to persist</span> <span>even when the power is turned off. ROM stands for Read-Only Memory,</span> <span>and FLASH refers to a specific style of storage element that is electroni</span><span>cally reprogrammable. FLASH style memories are convenient in PCs</span> <span>because they can be reprogrammed by the end user to fix mistakes in the</span><span>boot code. However, in the Xbox, FLASH ROM programming by the</span> <span>end user is purposely disabled. The write signal required for program</span><span>ming is disconnected by leaving out the jumper located on the back of</span> <span>the Xbox motherboard at component location R7R4 (see the sidebar</span><span>titled “Enabling FLASH ROM Programming Hardware” for more</span> <span>information). In the case of the Xbox, the reprogrammability of FLASH</span> <span>is primarily leveraged as a convenience for Microsoft during develop</span><span>ment and production. It is quite likely that in a few months, the Xbox will</span> <span>use cheaper hard-wired “mask ROMs” once Microsoft believes it is ready</span> <span>to etch its boot program and kernel in stone (or silicon, as the case may</span> <span>be).</span></p>

  <p><span>The boot ROM is pivotal in reverse engineering any computer because it</span> <span>contains critical code that is responsible for initializing the whole system.</span> <span>In the case of the Xbox, the boot FLASH ROM plays an even more</span> <span>crucial role because it is partially responsible for implementing the tight software security system. The exact role of the FLASH ROM in the</span> <span>security system will be explained later, but the important thing to</span> <span>remember for now is that the FLASH ROM controls the initialization of</span> <span>the hardware in the Xbox and also contains the initial operating system</span><span>kernel image.</span></p>

  <div class="infobox">
    <h2 id="sigil_toc_id_27">Enabling FLASH ROM Programming Hardware</h2>

    <p class="calibre1" style="margin: 1em 0px;">Patching the signal that was disconnected by Microsoft in <span>order to prevent in-system FLASH ROM programming is a</span> <span>fairly simple procedure. The FLASH ROM write signal was</span> <span>disconnected by omitting a single resistor, component num</span><span>ber R7R4, located on the bottom side of the Xbox</span> <span>motherboard at sector 7R. You can solder a piece of wire</span><span>between the two silver pads of the resistor, or you could</span> <span>even simply bridge the pads with a large amount of solder.</span> <span>Note, even though FLASH ROM programming is enabled in</span> <span>the hardware by this patch, you still do not have a pro</span><span>gram that actually does the reprogramming. Running such</span><span>a program is a much greater challenge due to the crypto</span><span>graphic software security system put in place by Microsoft.</span></p>
  </div>

  <h4 id="sigil_toc_id_28">Odds and Ends</h4>

  <p>The Xbox features a small 8-bit coprocessor called the System Manage<span>ment Controller (SMC). The SMC is a complete miniature computer with</span> <span>RAM, ROM, and a processor in a single package. The processor inside</span> <span>the SMC uses the PIC (Peripheral Interface Controller) architecture,</span> <span>originally developed at Harvard university around 1975 and adapted by</span> <span>General Instruments for commercial sale. Arizona Microchip Technology</span> <span>(now called Microchip Technology, www.microchip.com) acquired the</span> <span>PIC product line in 1985 and has been selling it ever since. The SMC can</span> <span>be found in sector 7B on the Xbox, and its reference designator is U7B2.</span> <span>The SMC monitors the power button on the front of the Xbox, so the</span> <span>SMC must run even when the CPU is turned off. As a result, the Xbox</span> <span>power supply has a low-current 3.3V “standby” power line that is always</span> <span>active when the Xbox is plugged in. The SMC is also responsible for</span> <span>controlling the lights around the power button on the Xbox, and it</span> <span>controls the DVD eject mechanism as wel . Final y, the SMC has a</span> <span>function that monitors the health of the CPU, and reboots the CPU in</span> <span>case it crashes. The SMC monitoring function must be disabled if you</span><span>wish to run your own operating system on the Xbox. The SMC talks to</span> <span>the CPU via the MCPX through a 1-bit serial interface known as I2C.</span></p>

  <p><span>Another important feature of the Xbox is the LPC debug port. The LPC</span> <span>debug port is a 4-bit wide bus that runs at 33 MHz. LPC stands for</span> <span>“Low Pin Count,” and it was originally devised as a method for connect</span><span>ing a large number of slow legacy devices, such as keyboards, serial ports, parallel ports and boot ROMs, to the Southbridge chip via a simple</span> <span>intermediate translation chip. The debug port is provided on the Xbox</span> <span>presumably for manufacturing test purposes by Microsoft’s hardware</span> <span>contractor. When the Xbox nears its final stages in production, the LPC</span> <span>debug port is used to load a boot program that performs tests, diagnos</span><span>tics and burn-in on the Xbox motherboard. The LPC debug port is</span> <span>discussed in more detail in chapter 11, but the important thing to know</span> <span>for now is that one can force the Xbox to read its initial boot ROM</span> <span>image through the LPC debug port by connecting an LPC-compliant</span> <span>ROM device and shorting one of the data pins (D0) on the FLASH</span> <span>ROM to particular voltage (zero volts). This is perhaps the easiest</span> <span>method for forcing the Xbox to boot your own code — given that you</span> <span>know how to get around the secret boot code that secures the Xbox.</span></p>

  <h2 class="calibre1" id="sigil_toc_id_29">Pattern Matching</h2>

  <p>Now that we are familiar with the Xbox architecture, we have a reference <span>point for perhaps one of the most powerful reverse engineering tools —</span> <span>pattern matching. Being able to make educated guesses about the</span> <span>function of various parts by simply observing their connectivity, place</span><span>ment and shape is the first step in becoming a crack reverse engineer. To</span> <span>demonstrate the power of pattern matching, we will compare the Xbox</span> <span>motherboard to a PC motherboard and to a Nintendo Gamecube</span> <span>motherboard.</span></p>

  <p>Learning a lot of patterns is the best way of becoming a good pattern <span>matcher. I take apart every piece of equipment that I buy, and I pore over the circuit boards to try and learn what other designers know by “reading” the circuit board. Every circuit board tells a story about its design process; rarely will one encounter a peculiar circuit feature that does not have some intended purpose.</span></p>

  <div class="note">
    <h3 class="sigil_not_in_toc">Caution</h3><img alt="" class="calibre2 note" src="../Images/index-66_1.png" style="height: auto; width: auto; float: left; margin-right: 20px; margin-bottom: 20px;"/>

    <p><b class="calibre3">When taking apart any piece of electronic equipment, be sure to first unplug it and wait a minute for the charge on</b> <b class="calibre3">the large capacitors in the power supply to dissipate. Also</b> <b class="calibre3">be sure to use appropriate static electricity control mea</b><b class="calibre3">sures described in chapter 1!</b></p>
  </div>

  <h3 id="sigil_toc_id_30">Comparison: Xbox Versus the PC</h3>

  <p>The similarity of an Xbox to a PC is a boon to hackers, since the PC <span>platform is very wel documented. Every part in an Xbox has an analog</span> <span>in a typical PC, so almost any high-level question can be answered by just</span> <span>reading about a similar PC part. Thus, it pays to take a closer look at the similarities between the Xbox motherboard and a standard PC</span> <span>motherboard. Another benefit is that much of the information in this</span> <span>book will apply directly to PCs, so you can easily apply what you will</span> <span>learn from hacking the Xbox to a large number of situations.</span></p>

  <p>The Xbox’s closest relatives are systems based on chipsets that use a <span>unified memory architecture, such as nVidia’s nForce or Via</span> <span>Technology’s ProSavageDDR. The architectural diagram presented in the</span> <span>previous section was derived by reading the published specifications of</span> <span>the Xbox and material available on nVidia’s website about the nForce</span> <span>chipset. In this section, we will compare the Xbox to the Via Technology</span> <span>ProSavageDDR-based P4M266 motherboard. The Xbox is compared</span> <span>here with a non-nVidia chipset motherboard to emphasize the broad</span> <span>similarities of the Xbox to PCs.</span></p>

  <p>Figure 2-7 shows a picture of a PC motherboard, the Via P4M266. Even <span>though the chipset is manufactured by a different vendor, the similarities</span> <span>between the P4M266 and the Xbox are striking. Almost all of the</span> <span>material covered in the previous section applies to this PC motherboard.</span> <span>The primary differences are a few miscellaneous ports and connectors,</span> <span>and the presence of PCI and AGP high-performance expansion ports.</span> <span>The Via P4M266 also lacks an explicit LPC debug connector, since all of</span> <span>the legacy peripherals are directly realized by an LPC multi-I/O chip.</span></p>

  <p><img alt="" class="calibre2" src="../Images/index-67_1.png" style="height: auto; width: auto;"/><br/></p>

  <p class="calibre1 caption"><b class="calibre3">Figure 2-7</b>: Via P4M266 motherboard with integrated graphics.</p>

  <h3 id="sigil_toc_id_31">Contrast: Xbox Versus the Gamecube</h3>

  <p>The Nintendo Gamecube interesting in comparison with the Xbox. The <span>Gamecube is a machine designed for the same purpose as the Xbox —</span> <span>gaming — but with a very different design philosophy in mind. The</span> <span>Xbox and the Gamecube both use the same gross architecture — a CPU,</span> <span>a graphics coprocessor, some memory, and some support chips — but</span> <span>the similarities end there. The Gamecube design demonstrates an</span> <span>exacting attention to detail and cost. The Gamecube motherboard is</span> <span>small and simple, the component count is kept to a minimum, and the</span> <span>heat sinking and thermal design is very simple. The clean, straight layout</span> <span>of most of the PCB traces on the Gamecube motherboard reflects the</span> <span>fact that almost every IC is custom-designed specifically for the</span> <span>Gamecube. As a result, the Gamecube is a much more economical</span> <span>platform to build than the Xbox.</span></p>

  <p>One can recognize the gross organization of the Gamecube by inferring each <span>chip’s function from the basic marketing information Nintendo provides.</span> <span>Further details about the architecture of the Gamecube are difficult to</span> <span>infer, because it uses so many custom components that have no counterpart</span> <span>in a standard PC. By the pattern of the traces on the motherboard, one</span> <span>would be lead to believe that the large chip in the center of the board, the</span> <span>“Flipper” chip, is the equivalent of an integrated graphics Northbridge chip in a PC. This is almost correct. A key difference is that even though the</span> <span>Flipper chip combines both a memory controller and a graphics controller</span> <span>into a single package, the graphics function still has its own dedicated</span><span>memory, built inside the same chip. This kind of organization al ows a very high performance memory to be used by the graphics engine, with the trade-off of the memory being a bit smaller than if off-chip memories were used.</span> <span>The smaller size of the on-chip memory is compensated in part by the use</span> <span>of extremely fast off-chip memory.</span></p>

  <p>The Gamecube does not use DDR SDRAM like the Xbox; instead, it <span>uses what is cal ed a 1-T SRAM. 1-T SRAMs are DRAM memories that</span> <span>emulate a very fast type of memory known as the Static RAM (SRAM).</span> <span>SRAMs have much lower random access latencies than DRAMs, and they</span> <span>also do not require each memory cell to be refreshed 30 times a second like DRAM does. The actual magic behind how DRAM can masquerade as fast</span> <span>SRAM is fairly complicated and is beyond the scope of this book, but you</span> <span>can find more information at the 1-T SRAM manufacturer’s website,</span> <span>www.mosys.com.</span></p>

  <p><img alt="" class="calibre2" src="../Images/index-69_1.png" style="height: auto; width: auto;"/></p>

  <p class="calibre1 caption"><b class="calibre3">Figure 2-8</b>: Gamecube motherboard plus its power regulator card. The <span>motherboard is about half the size of the Xbox motherboard.</span></p>

  <p>The Gamecube also has yet another piece of memory, known as ARAM, <span>that is slower than the 1-T SRAM memory, and is used to store things like</span> <span>audio samples that do not require high-bandwidth accesses. Having a</span> <span>disparate memory architecture means that the Gamecube can squeeze a</span> <span>more consistent amount of performance out of each subsystem, some</span><span>thing important in keeping frame lag to a minimum. The trade-off,</span> <span>however, is that the Gamecube can be more difficult to program, and</span> <span>mismanagement of the multiple pieces of memory can lead to performance</span> <span>problems.</span></p>

  <p>Another important distinction between the Gamecube and the Xbox is <span>that the Gamecube consumes much less power than an Xbox. Power</span> <span>consumption may seem unimportant at first, since both consoles are</span> <span>designed to be plugged into a wall outlet, but the Gamecube’s lower</span><span>power envelope requires fewer heat transfer components and smaller</span> <span>power supplies to be used, saving on cost. Figure 2-8 includes a picture</span> <span>of the Gamecube power regulator for reference; the power regulator is a</span> <span>fraction of the volume of the Xbox power supply plus the local switch</span><span>ing regulators on the Xbox motherboard.</span></p>

  <p>To be fair, note that the Gamecube does have a small external AC to DC <span>converter, while the Xbox takes wall power directly into the console.</span> <span>Furthermore, electronic components degrade much faster at elevated</span> <span>temperatures, as described by the rule of Arrhenius. For example, a 10</span><span>degree Celsius operating temperature increase roughly doubles the failure</span> <span>rate of a component. As such, the Gamecube should be more reliable</span> <span>over the years than the Xbox since the Gamecube puts out less heat, and</span> <span>because its thermal management system is as good as, if not better, than</span> <span>the Xbox’s.</span></p>

  <p>Finally, it is interesting to note that the Gamecube uses proprietary I/O <span>interfaces everywhere. The game disk format is a mini-DVD format, and</span> <span>the DVD reader connects to the motherboard through a proprietary</span> <span>connector. Using a smaller DVD media allows Nintendo to reduce the</span><span>latency of data seeks, which means shorter game loading times. The game</span> <span>controllers and memory cards also use a proprietary signaling format.</span> <span>Everything in the Gamecube is somewhat similar to our familiar PC, but</span> <span>nothing was directly incorporated into the design unchanged.</span></p>

  <p>In addition to optimizing the manufacturability and cost of the Gamecube, <span>the use of mostly proprietary chips and standards makes the console much</span> <span>more difficult to reverse engineer than the Xbox. For example, note that in Figure 2-8, there is no obvious ROM chip in the Gamecube. Thus, in order</span> <span>to even start looking at Gamecube code, one has to hunt down and extract a</span> <span>ROM hidden somewhere in one of the chips on the motherboard! This is</span> <span>one of the rare times where security through obscurity works. Even if there were no security at all on the Gamecube, the cost and effort of trying to</span> <span>burn your own code onto Nintendo’s custom DVD format is just not</span> <span>worth it for the individual enthusiast.</span></p>
  <hr class="sigil_split_marker"/>

  <p><span><sup>1</sup> Actually, SDRAMs can have a few restrictions on memory access</span> <span>patterns (such as page modes and burst modes) for performance</span> <span>reasons. The “random” moniker is intended to differentiate RAMs</span> <span>from First-In, First-Out (FIFO) and Last-In, First-Out (LIFO) style</span> <span>memories where data is accessed using a strict set of ordering</span> <span>rules.</span><span><br/></span></p>
</body></html>