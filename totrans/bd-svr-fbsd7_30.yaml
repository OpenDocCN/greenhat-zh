- en: Chapter 11\. ISC DHCP SERVER 3.0.5
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[HTTP://WWW.ISC.ORG/SW/DHCP](HTTP://WWW.ISC.ORG/SW/DHCP)'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 11.1\. SUMMARY
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: DHCP (Dynamic Host Configuration Protocol) provides network clients with an
    automated method of obtaining the configuration parameters necessary to communicate
    with other systems in an IP (Internet Protocol) based network. The parameters
    a DHCP server commonly provides to clients include IP address assignments, DNS
    server addresses, and default routers or gateway addresses.
  prefs: []
  type: TYPE_NORMAL
- en: When a client system first joins a network using DHCP, it broadcasts a request
    to the local network for configuration information. The DHCP server then answers
    this request with the parameters set in the DHCP server configuration file. The
    client system applies this assigned configuration to its network interface in
    order to communicate with the network.
  prefs: []
  type: TYPE_NORMAL
- en: 'DHCP servers generally assign IP addresses in one of two ways: statically or
    dynamically. The static method allocates an IP address to a client based on the
    client''s hardware MAC (Media Access Control) address. This IP address will not
    change. A dynamic IP address assignment is a leased address. The DHCP server assigns
    these addresses from a pool or range set by the administrator. Dynamic IP addresses
    are returned to the pool when a client disconnects from the network. If the same
    client rejoins the network, it may be assigned a different IP address if the previously
    assigned address is unavailable.'
  prefs: []
  type: TYPE_NORMAL
- en: DHCP first appeared in October 1993 as a replacement for BOOTP (Bootstrap Protocol).
    Version 1 of ISC's DHCP server was released by Ted Lemon in December 1997\. ISC's
    DHCP implementation remains one of the most popular and robust open source DHCP
    solutions.
  prefs: []
  type: TYPE_NORMAL
- en: 11.2\. RESOURCES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Ted Lemon's Paper on the ISC DHCP Distribution (dated 1998)
  prefs: []
  type: TYPE_NORMAL
- en: '[http://www.isc.org/sw/dhcp/dhcp-freenix.php](http://www.isc.org/sw/dhcp/dhcp-freenix.php)'
  prefs: []
  type: TYPE_NORMAL
- en: ISC DHCP Version 3 README
  prefs: []
  type: TYPE_NORMAL
- en: http://www.isc.org/sw/dhcp/dhcpv3-README.php
  prefs: []
  type: TYPE_NORMAL
- en: RFC 1541 - Dynamic Host Configuration Protocol
  prefs: []
  type: TYPE_NORMAL
- en: http://tools.ietf.org/html/rfc1541
  prefs: []
  type: TYPE_NORMAL
- en: The FreeBSD Handbook
  prefs: []
  type: TYPE_NORMAL
- en: '[http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/network-dhcp.html](http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/network-dhcp.html)'
  prefs: []
  type: TYPE_NORMAL
- en: 11.3\. REQUIRED
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) FreeBSD 7.0-RELEASE
    (see "[FreeBSD 7.0](freebsd_7.0_split_000.html#freebsd_7.0)")'
  prefs: []
  type: TYPE_IMG
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Updated ports
    collection (see "[FreeBSD Ports Collection](freebsd_ports_collection.html#freebsd_ports_collection)")'
  prefs: []
  type: TYPE_IMG
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Internet
    connection'
  prefs: []
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Your ISP''s
    DNS server addresses'
  prefs: []
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) IP address
    of your router or default gateway; to find this information:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 11.4\. OPTIONAL
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Authoritative
    BIND DNS server, if you wish to enable dynamic DNS updates (see "[ISC BIND DNS
    Server 9.4.2](isc_bind_dns_server_9.4.2.html#isc_bind_dns_server_9.4.2)")'
  prefs: []
  type: TYPE_IMG
- en: 11.5\. PREPARATION
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: If you plan on running your own DNS server, install and configure it prior to
    starting this guide. Become the superuser.
  prefs: []
  type: TYPE_NORMAL
- en: 11.6\. INSTALL
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To begin the ISC DHCP server installation process, enter the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: A menu of options will appear. Leave these options at their defaults (unless
    you have a specific need to change them), press [tab] to highlight OK, and then
    press [enter].
  prefs: []
  type: TYPE_NORMAL
- en: 11.7\. CONFIGURE
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Once the installation process is complete, it's time to configure DHCP for use
    on your system.
  prefs: []
  type: TYPE_NORMAL
- en: 'We need to copy the default configuration file dhcpd.conf.sample to a new file
    named dhcpd.conf. Then we''ll open it and customize the DHCP server''s configuration.
    Enter the following commands to make the copy and open the file for editing:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Scroll down to the `domain-name` option and replace [example.org](http://example.org)
    with your domain name. Replace [ns1.example.org](http://ns1.example.org) and [ns2.example.org](http://ns2.example.org)
    with the IP addresses of the DNS servers you''d like the DHCP server to assign
    to clients. You may use your own DNS server IPs here, or those of your ISP. The
    two lines (~7) would appear as follows if your domain name was [example.com](http://example.com)
    and your DNS server IPs were `*192.168.1.11*` and `*61.32.24.84*`:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Scroll down and uncomment the `authoritative` directive by removing the leading
    hash mark (`#`) to make the DHCP server authoritative. The line (~15) should look
    like this:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** Make sure no other DHCP server is on the network. Most routers
    have a built-in DHCP server; disable it before starting "[Testing](testing-id7.html#testing-id7)".'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Scroll down to the `ddns-update-style` option and change `ad-hoc` to `none`
    to disable dynamic DNS updates. To enable dynamic DNS updates, change this to
    `interim` (you must have a local BIND DNS server with dynamic DNS updates configured
    for this to work). The line (~18) should look like this if dynamic DNS updates
    are enabled:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Scroll down to the second subnet declaration (~32). You should see the following:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'These lines specify the IP address subnet, netmask, range, and routers that
    will be assigned to DHCP clients. Modify these lines to fit your desired network
    setup. As an example, we will use the `subnet` `*192.168.1.0*` and `netmask` `*255.255.255.0*`.
    We''ll set the DHCP IP `range` from `*192.168.1.12*` to `*192.168.1.62*`. We will
    assume the router''s (default gateway) IP address is `*192.168.1.1*`. After modifying
    the lines above, we now have the following:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: By default, the dhcpd.conf file contains numerous lines of examples that should
    be commented out or removed. For simplicity, remove all subsequent lines following
    the subnet declaration mentioned above.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The next two sections are optional. The first explains how to set static IP
    addresses so certain DHCP clients will always receive the same IP address; the
    second enables dynamic DNS updates. In order for the latter to work, ensure the
    BIND DNS server is configured for dynamic DNS updates. See "ISC BINDDNS Server
    9.4.2" on page 73 for details. You may skip to the appropriate section or save,
    exit, and proceed to "See [Testing](testing-id7.html#testing-id7)" if you do not
    wish to configure either of these options.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 11.7.1\. Static IP Assignments
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: This section shows how to assign a static IP address to a DHCP client. This
    is useful for devices like network-attached printers.
  prefs: []
  type: TYPE_NORMAL
- en: To assign a static (or fixed) IP address assignment to a host (computer) via
    DHCP, obtain its hardware MAC address. The MAC address can be obtained a number
    of different ways. On FreeBSD and Macintosh OS X systems, use the `ifconfig` command
    (on Macintosh, launch the Terminal program and type `**ifconfig**` at the prompt).
    The MAC address of each interface will follow the `ether` statement. On a Windows
    system, use the command `ipconfig /all` at the command prompt; the MAC address
    of each respective interface will be listed following `Physical Address`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Add the following lines to the end of the dhcpd.conf file. Replace [desktop01.example.com](http://desktop01.example.com)
    with the target system''s hostname, its MAC address, and the IP address you wish
    to assign. The static IP declaration should appear like this:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** The `fixed-address` can also be an FQDN if you have an authoritative
    DNS server with an appropriate entry in the zone''s DNS lookup file. Do not assign
    IP addresses that fall within the range of IPs used for dynamically assigned IPs.
    In the sample configuration above, the declared range is from 192.168.1.12 to
    192.168.1.62; thus 192.168.1.10 would be acceptable while 192.168.1.13 would not.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: You may add multiple static IP address assignments using the same format as
    above. To enable dynamic DNS updates, proceed to the next section; otherwise save,
    exit, and skip to "[Testing](testing-id7.html#testing-id7)".
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 11.7.2\. Dynamic DNS Updates
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: This section shows how to enable dynamic DNS updates with the ISC BIND DNS server.
  prefs: []
  type: TYPE_NORMAL
- en: 'Copy the contents of the rndc.key file into the dhcpd.conf file. This will
    allow the DHCP daemon to encrypt communications with the DNS server when updates
    are necessary. The following commands will append the contents of rndc.key to
    dhcpd.conf, assuming the rndc.key file is in its default location:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Add two zone declarations to the bottom of the dhcpd.conf file. If dhcpd.conf
    isn''t already open, type:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Scroll down to the bottom of the dhcpd.conf file using [ctrl-U] and add the
    following lines:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Replace [example.com](http://example.com). and `*1.168.192.in-addr.arpa.*` with
    the names of your forward and reverse lookup zone files. The IP addresses above
    should point to your BIND DNS server (you may use 127.0.0.1 if your DNS server
    exists on the same computer). If you did not create a reverse lookup zone file,
    then simply omit the reverse zone declaration.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Add the following line to dhcpd.conf if you set up any static IP assignments.
    This will allow DHCP to update DNS with static assignments.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Save and exit.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 11.8\. TESTING
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In this section, we'll perform some basic tests to confirm that the DHCP server
    answers DHCP requests properly.
  prefs: []
  type: TYPE_NORMAL
- en: If you have an existing DHCP server on your network, disable it before proceeding.
    Most consumer NAT routers have one built in and turned on by default. The following
    command will start the DHCP server in debug mode; this allows you to see DHCP
    messages in real time.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Power on and connect a client system to the network and watch for a `DHCPREQUEST`
    followed by a `DHCPACK`. You should see real-time DHCP requests and acknowledgments.
    If a client system is already running, you can force a DHCP renewal by rebooting.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Because the `DHCPREQUEST` and `DHCPACK` responses contain both assigned IPs
    and MAC addresses, you should be able to verify static IP assignments, if you
    configured any. To quit this mode, press [ctrl-C].
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'If you enabled dynamic DNS updates, try using the `host` command to resolve
    client IP addresses with their hostnames. Assuming a computer named `*desktop01*`
    is not declared in a DNS zone file previously, you could use the following command
    to resolve its IP address:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: If you get a `host not found` message, verify you have renewed that computer's
    DHCP lease by rebooting it or forcing a renewal with the operating system specific
    utility. Also, check the messages log file (located in /var/log) for errors from
    named or dhcpd when troubleshooting.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Configure the DHCP server to start automatically at boot time. To do this,
    open the rc.conf file in /etc:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'and add the following line:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Save, exit, and start DHCP with this command:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 11.9\. CONFIG FILES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: /usr/local/etc/dhcpd.conf
  prefs: []
  type: TYPE_NORMAL
- en: Main configuration file for dhcpd
  prefs: []
  type: TYPE_NORMAL
- en: 11.10\. LOG FILES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: /var/db/dhcpd.leases
  prefs: []
  type: TYPE_NORMAL
- en: A database of leases dhcpd has issued
  prefs: []
  type: TYPE_NORMAL
- en: /var/log/messages
  prefs: []
  type: TYPE_NORMAL
- en: Contains error and status messages from the dhcpd daemon
  prefs: []
  type: TYPE_NORMAL
