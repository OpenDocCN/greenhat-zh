<html><head></head><body><section class="chapter" epub:type="chapter" id="post-install_setup" title="Chapter&#xA0;4.&#xA0;Post-Install Setup"><div class="titlepage"><div><div><h2 class="title">Chapter 4. Post-Install Setup</h2></div></div></div><div class="epigraph" epub:type="epigraph"><div class="literallayout"><p><span class="emphasis"><em>Installation first,</em></span><br/>
<span class="emphasis"><em>now configure the software.</em></span><br/>
<span class="emphasis"><em>Server is ready.</em></span></p></div></div><p><a class="indexterm" id="idx0038"/><a class="indexterm" id="idx0286"/><a class="indexterm" id="idx1936"/><a class="indexterm" id="idx1994"/><a class="indexterm" id="idx2109"/><a class="indexterm" id="idx2406"/><span class="inlinemediaobject"><a id="inline_id00005"/><img alt="" src="httpatomoreillycomsourcenostarchimages1616079.png"/></span> You’ve installed OpenBSD and rebooted into a bare-bones system. Of course, a minimal Unix-like system is actually pretty boring. While it makes for a powerful foundation, it doesn’t actually <span class="emphasis"><em>do</em></span> much of anything.</p><p>To get you started, this chapter covers some of the basic steps you should take after installing OpenBSD to establish a firm platform for later work. We’ll jump right into basic tasks such as correcting the time zone, setting a default gateway, and setting an email alias for the root account.</p><p>But a bit of forewarning: You can change a surprising amount of OpenBSD’s configuration when the system is up and running. You can reconfigure the hostname, network configuration, and time and date, as well as stop, start, or reset daemons as you see fit. But just because you can doesn’t mean that you should.</p><p>While playing arbitrarily with a desktop or laptop machine might be fine, if you’re running a server, you should test your configuration by rebooting. Make sure that the system boots exactly as desired before adding services. If you find that OpenBSD boots fine but you must poke the network card before it works, fix that before proceeding.</p><div class="note" title="Note"><h3 class="title"><a id="ch04note01"/>Note</h3><p><a class="indexterm" id="idx0209"/><a class="indexterm" id="idx1727"/><a class="indexterm" id="idx1986"/><a class="indexterm" id="idx2111"/><a class="indexterm" id="idx2121"/><a class="indexterm" id="idx2318"/>The <code class="literal">afterboot(8)</code> man page has up-to-date advice for systems administrators who have just installed their first OpenBSD system. Much of this advice overlaps material that we’ll cover in this book (in a much more exciting fashion, I’m sure), while some of it applies only to specific use cases. Read the <code class="literal">afterboot</code> documentation on your system for the very latest information.</p></div><p>All of the tasks in this chapter must be performed as root. We’ll discuss creating additional users in <a class="xref" href="ch06.html" title="Chapter 6. User Management">Chapter 6</a> and ways to avoid using the root account in <a class="xref" href="ch07.html" title="Chapter 7. Root, and How to Avoid It">Chapter 7</a>, but you don’t need to do that on a newly installed system. Configure the system properly before you start letting people log on, or you’ll wish you had.<sup>[<a class="footnote" epub:type="noteref" href="#ftn.id485404" id="id485404">10</a>]</sup></p><div class="sect1" title="First Steps"><div class="titlepage"><div><div><h2 class="title" id="first_steps" style="clear: both">First Steps</h2></div></div></div><p>The first two things you should do after installing a new system are check for any operating system patches or errata and change the root administrative password. These steps are critical, so don’t skip them.</p><div class="sect2" title="Checking the System Errata"><div class="titlepage"><div><div><h3 class="title" id="checking_the_system_errata">Checking the System Errata</h3></div></div></div><p>Believe it or not, OpenBSD isn’t perfect. Releases sometimes have bugs. Some of these are serious problems; others not so much.</p><p>When the OpenBSD team learns of a serious problem with a release, it issues an errata list, and whenever you build a new server, you should check the errata list at <span class="emphasis"><em><a class="ulink" href="http://www.OpenBSD.org/errata.html" target="_top">http://www.OpenBSD.org/errata.html</a></em></span>. Critical errata are also announced on <span class="emphasis"><em>security-announce@OpenBSD.org</em></span>, so if you’re on that mailing list, you’ll get notifications of new errata. You’ll also see errata notices on <span class="emphasis"><em><a class="ulink" href="http://www.undeadly.org/" target="_top">http://www.undeadly.org/</a></em></span>.</p><p>Errata won’t always affect your use case. For example, as I write this, OpenBSD 5.0 has one errata notice: a problem in the BIND name server. If this server won’t run BIND, don’t worry about this errata. If you’re building a name server, however, you need this information before going into production.</p><p>If you’re in doubt, correct your system as recommended in the errata, which may require building one or more parts of OpenBSD from source. (I’ll discuss errata and building OpenBSD at length in <a class="xref" href="ch20.html" title="Chapter 20. Upgrading">Chapter 20</a>.)</p></div><div class="sect2" title="Setting the Root Password"><div class="titlepage"><div><div><h3 class="title" id="setting_the_root_password">Setting the Root Password</h3></div></div></div><p>You needed to choose a root password during installation. To change it, use the <code class="literal">passwd(1)</code> command. Of course, you must be root to change root’s password.</p></div></div><div class="sect1" title="Software Configuration"><div class="titlepage"><div><div><h2 class="title" id="software_configuration" style="clear: both">Software Configuration</h2></div></div></div><p><a class="indexterm" id="idx0638"/><a class="indexterm" id="idx0706"/><a class="indexterm" id="idx0710"/><a class="indexterm" id="idx0711"/><a class="indexterm" id="idx0713"/><a class="indexterm" id="idx1031"/><a class="indexterm" id="idx1559"/><a class="indexterm" id="idx2122"/><a class="indexterm" id="idx2129"/><a class="indexterm" id="idx2180"/>When the OpenBSD kernel finishes its initial system setup and hands control of the system over to userland, <code class="literal">init(8)</code> runs the shell script <span class="emphasis"><em>/etc/rc</em></span>. This script starts all of the programs integrated with the system and performs general system configuration, such as configuring network interfaces and starting server software. To enable, disable, or otherwise configure integrated software, modify the files <span class="emphasis"><em>/etc/rc.conf</em></span> and <span class="emphasis"><em>/etc/rc.conf.local</em></span>. (I’ll cover the OpenBSD boot process in detail in <a class="xref" href="ch05.html" title="Chapter 5. The Boot Process">Chapter 5</a>, but for now, this section will get you started.)</p><p>The files <span class="emphasis"><em>rc.conf</em></span> and <span class="emphasis"><em>rc.conf.local</em></span> contain shell script variable assignments that control what <span class="emphasis"><em>/etc/rc</em></span> runs and the command-line options for the various programs. Keep in mind that any entries in <span class="emphasis"><em>rc.conf.local</em></span> override <span class="emphasis"><em>rc.conf</em></span> statements. Most variable assignments have three legitimate values: an uppercase <code class="literal">NO</code>, command-line flags in quotation marks (<code class="literal">"-D"</code>), or double quotes (<code class="literal">""</code>), which are equivalent to empty. Each variable looks something like this entry from <span class="emphasis"><em>rc.conf</em></span>:</p><a id="I_programlisting4_id433142"/><pre class="programlisting">ntpd_flags=NO           # for normal use: ""</pre><p>The variable <code class="literal">ntpd_flags</code> controls the command-line flags that <span class="emphasis"><em>/etc/rc</em></span> uses when starting <code class="literal">ntpd(8)</code>.</p><p>A <code class="literal">NO</code> disables this particular piece of functionality. In the preceding example, the NTP daemon <code class="literal">ntpd(8)</code> is disabled.</p><p>If the variable is empty, <span class="emphasis"><em>/etc/rc</em></span> starts the program without any command-line arguments. For example, this <code class="literal">ntpd_flags</code> entry means that <code class="literal">ntpd</code> is to be started without any arguments.</p><a id="I_programlisting4_id433189"/><pre class="programlisting">ntpd_flags=""</pre><p>Anything within quotes is used as a command-line argument to the program. (If a program has typical default flags, they’ll usually appear in <span class="emphasis"><em>rc.conf</em></span>.) The following example assigns the variable <code class="literal">ntpd_flags</code> the value <code class="literal">-s</code>. When the system boots, rather than running <code class="literal">ntpd</code>, it will run <code class="literal">ntpd -s</code>:</p><a id="I_programlisting4_id433217"/><pre class="programlisting">ntpd_flags=<span class="strong"><strong>"-s"</strong></span></pre><p>Some variables have additional possible values. For example, the PF packet filter (see <a class="xref" href="ch21.html" title="Chapter 21. Packet Filtering">Chapter 21</a>) is enabled with a <code class="literal">YES</code>. To enable the NFS automounter daemon, you’ll need to use a path to the master map. (If you don’t know what the automounter is, that’s fine—not many do these days.) Just realize that weird values for <span class="emphasis"><em>rc.conf</em></span> variables do exist. You’ll see these values listed in <span class="emphasis"><em>rc.conf</em></span>.</p><div class="note" title="Note"><h3 class="title"><a id="ch04note02"/>Note</h3><p>OpenBSD defaults appear in <span class="emphasis"><em>/etc/rc.conf</em></span>, but do not edit this file! This is a core system file, and will be replaced during an upgrade. Put your local changes in <span class="emphasis"><em>/etc/rc.conf.local</em></span>. Entries in <span class="emphasis"><em>rc.conf.local</em></span> will override the defaults in <span class="emphasis"><em>rc.conf</em></span>.</p></div></div><div class="sect1" title="Time and Date"><div class="titlepage"><div><div><h2 class="title" id="time_and_date" style="clear: both">Time and Date</h2></div></div></div><p><a class="indexterm" id="idx0370"/><a class="indexterm" id="idx0371"/><a class="indexterm" id="idx0682"/><a class="indexterm" id="idx1556"/><a class="indexterm" id="idx1630"/><a class="indexterm" id="idx1850"/><a class="indexterm" id="idx2071"/><a class="indexterm" id="idx2123"/><a class="indexterm" id="idx2423"/><a class="indexterm" id="idx2427"/><a class="indexterm" id="idx2569"/>Correct system time is not only a convenience, but also a security issue, because many attacks rely on changing the system clock. However, if your system clock is wrong to start with, you won’t notice a change. Without coherent time across all your servers, you’ll never be able to correlate your logs when troubleshooting. What’s the solution? Fix your time settings before you do anything else. Correcting the time requires both setting a time zone and the clock.</p><div class="sect2" title="Setting the Time Zone"><div class="titlepage"><div><div><h3 class="title" id="setting_the_time_zone-id00002">Setting the Time Zone</h3></div></div></div><p>The installer tries really hard to guess your time zone, using geolocation tricks and a script at the OpenBSD website. If these didn’t work for you, or if you weren’t on the Internet when you installed OpenBSD, or if your company policy says that all servers will run in time zone <span class="emphasis"><em>X</em></span>, fix your time zone before anyone notices.</p><p>The directory <span class="emphasis"><em>/usr/share/zoneinfo</em></span> contains all of the time zones, as well as several subdirectories for countries or continents with various time zones. For example, Western Siberia runs on Omsk time (found in the file <span class="emphasis"><em>/usr/share/zoneinfo/Asia/Omsk</em></span>). Presumably, you have some idea of your local time zone and where it might be filed.</p><p>To set the system time zone, create a symbolic link to it from <span class="emphasis"><em>/etc/localtime</em></span>. Use <code class="literal">date(1)</code> to make sure that the time zone has been set correctly:</p><a id="I_programlisting4_id433409"/><pre class="programlisting"># <span class="strong"><strong>ln -fs /usr/share/zoneinfo/Asia/Omsk /etc/localtime</strong></span>
# <span class="strong"><strong>date</strong></span>
Thu Mar 14 06:02:56 OMST 2013</pre><p>OpenBSD also supports POSIX time zones found in <span class="emphasis"><em>/usr/share/zoneinfo/Etc</em></span>. POSIX time zones have their own rules. Do not use them unless you are absolutely sure you understand them. (Hint: You don’t.)</p></div><div class="sect2" title="Setting the Date and Time"><div class="titlepage"><div><div><h3 class="title" id="setting_the_date_and_time">Setting the Date and Time</h3></div></div></div><p>Now that you have set a time zone, set the correct time and date. OpenBSD includes OpenNTPD, a BSD-licensed simplified NTP daemon. If at all possible, use <code class="literal">ntpd(8)</code> to manage the time. If you can’t access NTP servers (say, if you’re on a private network without them), set up your own. And if you can’t set up time servers, set the system time manually.</p><div class="sect3" title="Setting the Time with ntpd(8)"><div class="titlepage"><div><div><h4 class="title" id="setting_the_time_with_ntpd8">Setting the Time with ntpd(8)</h4></div></div></div><p>Configure OpenNTPD in <span class="emphasis"><em>/etc/ntpd.conf</em></span>. The syntax should be familiar to you if you’ve managed any other NTP daemon.</p><p>For basic time, you need time servers, ideally three or more. If you don’t have local time servers, use publicly accessible time servers, such as the hosts available at <span class="emphasis"><em><a class="ulink" href="http://pool.ntp.org/" target="_top">http://pool.ntp.org/</a></em></span>.</p><p><a class="indexterm" id="idx0372"/><a class="indexterm" id="idx0670"/><a class="indexterm" id="idx0986"/><a class="indexterm" id="idx2112"/><a class="indexterm" id="idx2229"/>List your servers in <span class="emphasis"><em>/etc/ntpd.conf</em></span>:</p><a id="I_programlisting4_id433533"/><pre class="programlisting">servers pool.ntp.org</pre><p>Then enable <code class="literal">ntpd</code> in <span class="emphasis"><em>/etc/rc.conf.local</em></span>:</p><a id="I_programlisting4_id433548"/><pre class="programlisting">ntpd_flags=</pre><p>By default, <code class="literal">ntpd</code> slowly adjusts system time by skewing the system clock. If the system time is a few seconds off, slow adjustment will usually suffice, but if it’s off by minutes or more, have <code class="literal">ntpd</code> correct the system time on startup and then adjust the time as needed. To enable time correction at startup, use the <code class="literal">-s</code> flag:</p><a id="I_programlisting4_id433569"/><pre class="programlisting">ntpd_flags="-s"</pre><p>Time skews most badly on heavily used hardware, lousy hardware, and virtual machines.</p></div><div class="sect3" title="Setting the Date Manually"><div class="titlepage"><div><div><h4 class="title" id="setting_the_date_manually">Setting the Date Manually</h4></div></div></div><p>To set the date and time manually, use <code class="literal">date(1)</code>. First, make sure that you know the current year, month, day of the month, and time (in 24-hour format). Then set the date and time using this format:</p><a id="I_programlisting4_id433594"/><pre class="programlisting"># date <span class="emphasis"><em>YYYYmmDDhhMM</em></span></pre><p>For example, to set the date to February 3, 2013 and the time to 1:17 <span class="smallcaps">PM</span>, run this:</p><a id="I_programlisting4_id433610"/><pre class="programlisting"># <span class="strong"><strong>date 201302031317</strong></span>
Sun Feb  3 13:17:00 GMT 2013</pre><p>That said, <code class="literal">date(1)</code> will not correct your clock on an ongoing basis, and on some hardware with poor clocks, the time will slowly skew. A virtual machine on heavily loaded hardware will almost certainly lose time. Use NTP to deal with that.</p></div></div></div><div class="sect1" title="Hostname"><div class="titlepage"><div><div><h2 class="title" id="hostname" style="clear: both">Hostname</h2></div></div></div><p>Set the system’s hostname in <span class="emphasis"><em>/etc/myname</em></span>. My test system is called <span class="emphasis"><em>caddis.blackhelicopters.org</em></span>.</p><a id="I_programlisting4_id433652"/><pre class="programlisting">$ <span class="strong"><strong>cat /etc/myname</strong></span>
caddis.blackhelicopters.org</pre><p>To change the hostname, edit <span class="emphasis"><em>/etc/myname</em></span>. The new hostname takes effect after the next reboot.</p><p><a class="indexterm" id="idx0673"/><a class="indexterm" id="idx0790"/><a class="indexterm" id="idx0983"/><a class="indexterm" id="idx1008"/><a class="indexterm" id="idx1486"/><a class="indexterm" id="idx1514"/><a class="indexterm" id="idx1517"/><a class="indexterm" id="idx2116"/><a class="indexterm" id="idx2119"/>To change the hostname until the next boot, use <code class="literal">hostname -s</code> and the new hostname, like this:</p><a id="I_programlisting4_id433751"/><pre class="programlisting"># <span class="strong"><strong>hostname -s treble.blackhelicopters.org</strong></span>
# <span class="strong"><strong>hostname</strong></span>
treble.blackhelicopters.org</pre><p>You can edit <span class="emphasis"><em>/etc/myname</em></span> and run <code class="literal">hostname -s</code> to make a change take effect immediately and persist after the next boot.</p></div><div class="sect1" title="Networking"><div class="titlepage"><div><div><h2 class="title" id="networking" style="clear: both">Networking</h2></div></div></div><p>If you installed OpenBSD over the Internet, at least one Ethernet card should be configured and working. But if you installed from CD, you didn’t need to configure the network to install OpenBSD. If you installed OpenBSD on one network and want to move the machine to another network, you’ll need to reconfigure the network on your system.</p><p>I cover network principles in <a class="xref" href="ch11.html" title="Chapter 11. Overview of TCP/IP">Chapter 11</a> and configuration in <a class="xref" href="ch12.html" title="Chapter 12. Connecting to the Network">Chapter 12</a>, but this brief entry will attach valid network addresses to your system, install a default route, and get DNS resolution working. If you’re not sure what to do here, don’t do anything until you read the later chapters.</p><p>To make network changes take effect, you can either reboot or run the network startup script <span class="emphasis"><em>/etc/netstart</em></span>, like this:</p><a id="I_programlisting4_id433819"/><pre class="programlisting"># <span class="strong"><strong>sh /etc/netstart</strong></span></pre><p>To configure only one interface, give the interface’s name as an argument:</p><a id="I_programlisting4_id433831"/><pre class="programlisting"># <span class="strong"><strong>sh /etc/netstart em0</strong></span></pre><p>Again, if your system is a server, reboot before you declare the server ready for production.</p><div class="sect2" title="Configuring Ethernet Interfaces"><div class="titlepage"><div><div><h3 class="title" id="configuring_ethernet_interfaces">Configuring Ethernet Interfaces</h3></div></div></div><p>For a complete list of network interfaces recognized by your host, run <code class="literal">ifconfig(8)</code>. You should see a bunch of entries, like this:</p><a id="I_programlisting4_id433862"/><pre class="programlisting"><span class="strong"><strong>1</strong></span> em0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
          lladdr 00:0c:29:d2:37:be
          priority: 0
          groups: egress
          media: Ethernet autoselect (1000baseT full-duplex,master)
          status: active
<span class="strong"><strong>2</strong></span>         inet 192.0.2.36 netmask 0xffffffe0 broadcast 192.0.2.63
          inet6 fe80::20c:29ff:fed2:37be%em0 prefixlen 64 scopeid 0x1</pre><p><a class="indexterm" id="idx0550"/><a class="indexterm" id="idx0763"/><a class="indexterm" id="idx0789"/><a class="indexterm" id="idx1009"/><a class="indexterm" id="idx1092"/><a class="indexterm" id="idx1110"/><a class="indexterm" id="idx1117"/><a class="indexterm" id="idx1201"/><a class="indexterm" id="idx1791"/><a class="indexterm" id="idx2243"/>Every OpenBSD system comes with the default interfaces <code class="literal">lo0</code> (loopback), <code class="literal">enc0</code> (encapsulating interface), and <code class="literal">pflog0</code> (PF logging, discussed in <a class="xref" href="ch21.html" title="Chapter 21. Packet Filtering">Chapter 21</a>). These are virtual interfaces that don’t actually attach your system to the local Ethernet. Other interfaces will be physical network ports, like the Ethernet interface <code class="literal">em0</code> at <span class="strong"><strong>1</strong></span>.</p><p>Every Ethernet card has its own configuration file, <span class="emphasis"><em>/etc/hostname</em></span> .interfacename. The <code class="literal">em0</code> interface in the example is configured in the file <span class="emphasis"><em>/etc/hostname.em0</em></span>. If the file doesn’t exist, create it.</p><p>At <span class="strong"><strong>2</strong></span>, you see the IP address. The format of static IP addresses depends on the IP version in use.</p><div class="sect3" title="Static IP Addresses"><div class="titlepage"><div><div><h4 class="title" id="static_ip_addresses">Static IP Addresses</h4></div></div></div><p>For IP version 4 (IPv4) addresses, the common format is as follows:</p><a id="I_programlisting4_id434027"/><pre class="programlisting">inet <span class="emphasis"><em>ipaddress netmask broadcastaddress options</em></span></pre><p>This format includes these elements:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The <code class="literal">inet</code> keyword indicates this is an IPv4 address.</p></li><li class="listitem"><p>The IP address (<span class="emphasis"><em><code class="literal">ipaddress</code></em></span>) appears in standard dotted-quad notation.</p></li><li class="listitem"><p>The <span class="emphasis"><em><code class="literal">netmask</code></em></span> can appear in dotted-quad format (255.255.255.224) or in hexadecimal (0xffffffe0).</p></li><li class="listitem"><p>The broadcast address (<span class="emphasis"><em><code class="literal">broadcastaddress</code></em></span>) gives you the option to hardcode the broadcast address on this network. If you leave this blank or use the word <code class="literal">NONE</code>, OpenBSD computes the correct broadcast address from the IP address and netmask given earlier. If you use <code class="literal">ifconfig(8)</code> options, you must use the word <code class="literal">NONE</code> to provide spacing. (You can also provide the netmask in “slash” notation directly after the IP address, as in <code class="literal">192.0.2.2/24</code>.)</p></li><li class="listitem"><p>The <span class="emphasis"><em><code class="literal">options</code></em></span> space is where you should put any specific <code class="literal">ifconfig(8)</code> commands needed for this interface, like hardcoded speed or duplex. (See <a class="xref" href="ch11.html" title="Chapter 11. Overview of TCP/IP">Chapter 11</a> and <a class="xref" href="ch12.html" title="Chapter 12. Connecting to the Network">Chapter 12</a> for examples, and the <code class="literal">hostname.if(5)</code> man page for the full details.)</p></li></ul></div><p>When working with IP version 6 (IPv6) addresses, the format is as follows:</p><a id="I_programlisting4_id434129"/><pre class="programlisting">inet6 <span class="emphasis"><em>address prefixlength options</em></span></pre><p>This format includes these elements:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The <code class="literal">inet6</code> keyword tells the system that this is an IPv6 address.</p></li><li class="listitem"><p>The <span class="emphasis"><em><code class="literal">address</code></em></span> space is for the IPv6 address, without a prefix length.</p></li><li class="listitem"><p>The prefix length (<span class="emphasis"><em><code class="literal">prefixlength</code></em></span>) appears separately, without a slash.</p></li><li class="listitem"><p>As with IPv4, you can use <code class="literal">ifconfig(8)</code> <span class="emphasis"><em><code class="literal">options</code></em></span> as needed.</p></li></ul></div><p><a class="indexterm" id="idx0385"/><a class="indexterm" id="idx0533"/><a class="indexterm" id="idx0910"/><a class="indexterm" id="idx1515"/><a class="indexterm" id="idx1516"/><a class="indexterm" id="idx2117"/><a class="indexterm" id="idx2118"/>Even a very simple configuration will get a machine on the network. The following configures <code class="literal">em0</code> with the IPv4 address 192.0.2.2 and netmask 255.255.255.224. It also has the IPv6 address of 2001:DB8:7700::2/64.</p><a id="I_programlisting4_id434255"/><pre class="programlisting">$ <span class="strong"><strong>cat /etc/hostname.em0</strong></span>
inet 192.0.2.2 255.255.255.224
inet6 2001:DB8::2 64</pre><p>Anything that doesn’t follow these IPv4 and IPv6 formats is passed directly to <code class="literal">ifconfig</code>. However, if you don’t know if a particular configuration will work, try it at the command line first.</p></div><div class="sect3" title="Dynamic Configuration"><div class="titlepage"><div><div><h4 class="title" id="dynamic_configuration">Dynamic Configuration</h4></div></div></div><p>When performing dynamic configuration, if the machine is an IPv4 DHCP client, use the string <code class="literal">dhcp</code> in <span class="emphasis"><em>hostname.if</em></span>. For IPv6 autoconfiguration, use the string <code class="literal">rtsol</code>, by itself on a single line, to tell OpenBSD to use the <code class="literal">rtsol(8)</code> IPv6 autoconfiguration program.</p><a id="I_programlisting4_id434302"/><pre class="programlisting">$ <span class="strong"><strong>cat /etc/hostname.em0</strong></span>
dhcp
rtsol</pre><p>In order for IPv6 autoconfiguration to work, you must disable IPv6 routing with these two entries in <span class="emphasis"><em>/etc/sysctl.conf</em></span>:</p><a id="I_programlisting4_id434319"/><pre class="programlisting">net.inet6.ip6.forwarding=0
net.inet6.ip6.accept_rtadv=1</pre><p>These values already exist in <span class="emphasis"><em>/etc/sysctl.conf</em></span>, but they’re commented out.</p></div></div><div class="sect2" title="Setting a Default Gateway"><div class="titlepage"><div><div><h3 class="title" id="setting_a_default_gateway">Setting a Default Gateway</h3></div></div></div><p>To set either the IPv4 or IPv6 default gateway, place the gateway IP address on a single line in <span class="emphasis"><em>/etc/mygate</em></span>, with no other entries in the file. You can configure default gateways for both protocols, each on its own line. The change should take place on your next reboot, or use <code class="literal">route(8)</code> to manually change the default gateway. The following sets both an IPv4 and an IPv6 default gateway.</p><a id="I_programlisting4_id434353"/><pre class="programlisting">192.0.2.1
2001:DB8::1</pre><p>Dynamic configuration requires setting a default route. If your <span class="emphasis"><em>/etc/hostname.if</em></span> file contains a dynamic configuration statement, <span class="emphasis"><em>/etc/mygate</em></span> will not be used for that IP protocol.</p></div><div class="sect2" title="Setting Name Service Servers"><div class="titlepage"><div><div><h3 class="title" id="setting_name_service_servers">Setting Name Service Servers</h3></div></div></div><p><a class="indexterm" id="idx0504"/><a class="indexterm" id="idx0517"/><a class="indexterm" id="idx0543"/><a class="indexterm" id="idx0650"/><a class="indexterm" id="idx1267"/><a class="indexterm" id="idx1277"/><a class="indexterm" id="idx1425"/><a class="indexterm" id="idx1518"/><a class="indexterm" id="idx1520"/><a class="indexterm" id="idx1937"/><a class="indexterm" id="idx1992"/><a class="indexterm" id="idx2115"/><a class="indexterm" id="idx2120"/><a class="indexterm" id="idx2252"/><a class="indexterm" id="idx2356"/>If you want to contact other machines by hostname, you need to set Domain Name Service (DNS) servers.</p><p><a class="xref" href="ch12.html" title="Chapter 12. Connecting to the Network">Chapter 12</a> covers DNS resolution in detail, but <span class="emphasis"><em>/etc/resolv.conf</em></span> contains the basic client settings. Its first line defines the local domain with the <code class="literal">domain</code> keyword and a domain name. Name servers appear on subsequent lines, defined with the keyword <code class="literal">nameserver</code> and an IP address, as shown here:</p><a id="I_programlisting4_id434511"/><pre class="programlisting">domain blackhelicopters.org
nameserver 192.0.2.1
nameserver 192.0.2.3</pre></div></div><div class="sect1" title="Mail Aliases and Status Mail"><div class="titlepage"><div><div><h2 class="title" id="mail_aliases_and_status_mail" style="clear: both">Mail Aliases and Status Mail</h2></div></div></div><p>Every OpenBSD system runs maintenance tasks daily, weekly, and monthly, and sends email messages with the results to the local root account. I discuss these maintenance jobs in <a class="xref" href="ch15.html" title="Chapter 15. System Maintenance">Chapter 15</a>. If you have more than a couple of servers, you should probably forward these email messages to a single central account.</p><p>The OpenBSD system redirects email messages addressed to local users to other users or remote email addresses, as configured in <span class="emphasis"><em>/etc/mail/aliases</em></span>. Here are a few entries:</p><a id="I_programlisting4_id434544"/><pre class="programlisting">…
# Basic system aliases -- these MUST be present
MAILER-DAEMON: postmaster
postmaster: root
…</pre><p>The original recipient appears on the left, followed by a colon, and a list of people to forward the messages to. If you have multiple recipients separate them with commas. Mail addressed to MAILER-DAEMON on the local system is forwarded to the postmaster account, which, in turn, is forwarded to the root account.</p><p>You should create an alias for root, directing mail sent to root to your systems administration team:</p><a id="I_programlisting4_id434559"/><pre class="programlisting">root: mwlucas@bigcompany.com, sysadminstaff@bigcompany.com</pre><p>After changing <span class="emphasis"><em>/etc/mail/aliases</em></span>, run <code class="literal">newaliases(8)</code> to update email forwarding.</p></div><div class="sect1" title="Keyboard Mapping"><div class="titlepage"><div><div><h2 class="title" id="keyboard_mapping" style="clear: both">Keyboard Mapping</h2></div></div></div><p><a class="indexterm" id="idx0304"/><a class="indexterm" id="idx0530"/><a class="indexterm" id="idx0632"/><a class="indexterm" id="idx1049"/><a class="indexterm" id="idx1133"/><a class="indexterm" id="idx1165"/><a class="indexterm" id="idx1638"/><a class="indexterm" id="idx1825"/><a class="indexterm" id="idx1843"/><a class="indexterm" id="idx1847"/><a class="indexterm" id="idx2113"/><a class="indexterm" id="idx2114"/><a class="indexterm" id="idx2197"/><a class="indexterm" id="idx2514"/><a class="indexterm" id="idx2563"/>OpenBSD tries to guess your correct keyboard mapping. USB keyboards have mechanisms to declare their country code. If autodetection doesn’t work, you can change the keyboard layout with <code class="literal">kbd(8)</code>, and set it at boot with <span class="emphasis"><em>/etc/kbdtype</em></span>.</p><p>Before touching the keyboard layout, use <code class="literal">kbd</code> to find your current keyboard map. <code class="literal">kbd -l</code> lists the more than 100 keyboard encodings OpenBSD supports. Browse the list for your supported keyboard layout, or use <code class="literal">grep</code> to reduce the list. I’m a Dvorak user, so I search for it like this:</p><a id="I_programlisting4_id434729"/><pre class="programlisting"># kbd -l | grep dvorak
fr.dvorak
us.dvorak
…</pre><p>My preferred layout is <code class="literal">us.dvorak</code>. I enter <span class="strong"><strong><code class="literal">us.dvorak</code></strong></span> in <span class="emphasis"><em>/etc/kbdtype</em></span>, and after my next reboot, the console should use the Dvorak layout.</p><p>To set the keymap immediately to Dvorak, I could use <code class="literal">kbd</code>:</p><a id="I_programlisting4_id434760"/><pre class="programlisting"># <span class="strong"><strong>kbd us.dvorak</strong></span>
kbd: keyboard mapping set to us.dvorak</pre><p>Read more about changing the console in <a class="xref" href="ch17.html" title="Chapter 17. Desktop OpenBSD">Chapter 17</a>.</p></div><div class="sect1" title="Installing Ports and Source Code"><div class="titlepage"><div><div><h2 class="title" id="installing_ports_and_source_code" style="clear: both">Installing Ports and Source Code</h2></div></div></div><p>If you intend to build your own OpenBSD releases or heavily customize OpenBSD, you’ll need the operating system source code (see <a class="xref" href="ch18.html" title="Chapter 18. Kernel Configuration">Chapter 18</a>, <a class="xref" href="ch19.html" title="Chapter 19. Building Custom Kernels">Chapter 19</a>, and <a class="xref" href="ch20.html" title="Chapter 20. Upgrading">Chapter 20</a>). If you intend to build your own packages (covered in <a class="xref" href="ch13.html" title="Chapter 13. Software Management">Chapter 13</a>), you’ll need the ports tree. Both the ports tree and the system source code are specific to an OpenBSD release, and if you need them, install them when you install the system.</p><p>The ports tree is the compressed file <span class="emphasis"><em>ports.tar.gz</em></span> in the release directory where you stored OpenBSD—either on the mirror site or the CD. All architectures share one ports tree. Download this file to your home directory and extract it in <span class="emphasis"><em>/usr</em></span>.</p><a id="I_programlisting4_id434826"/><pre class="programlisting"># <span class="strong"><strong>cd /usr/</strong></span>
# <span class="strong"><strong>tar -xzvf $HOME/ports.tar.gz</strong></span></pre><p>This extracts the ports tree to <span class="emphasis"><em>/usr/ports</em></span>.</p><p>The system source code is found in three files in the release directory: the kernel source code <span class="emphasis"><em>sys.tar.gz</em></span> (see <a class="xref" href="ch19.html" title="Chapter 19. Building Custom Kernels">Chapter 19</a>), userland source code <span class="emphasis"><em>src.tar.gz</em></span> (see <a class="xref" href="ch20.html" title="Chapter 20. Upgrading">Chapter 20</a>), and the Xenocara <span class="emphasis"><em>xenocara.tar.gz</em></span> (see <a class="xref" href="ch20.html" title="Chapter 20. Upgrading">Chapter 20</a>). Extract Xenocara to <span class="emphasis"><em>/usr</em></span>, and the others to <span class="emphasis"><em>/usr/src</em></span>.</p></div><div class="sect1" title="Booting to a Graphic Console"><div class="titlepage"><div><div><h2 class="title" id="booting_to_a_graphic_console" style="clear: both">Booting to a Graphic Console</h2></div></div></div><p><a class="indexterm" id="idx0172"/><a class="indexterm" id="idx0925"/><a class="indexterm" id="idx2110"/><a class="indexterm" id="idx2680"/><a class="indexterm" id="idx2684"/>OpenBSD boots into a text console by default. To boot into an X-based graphic console, use the <code class="literal">xdm(1)</code> command in <span class="emphasis"><em>/etc/rc.conf.local</em></span>. The default <code class="literal">xdm</code> setting is <code class="literal">NO</code>, so by changing it to empty quotes you enable it.</p><a id="I_programlisting4_id434954"/><pre class="programlisting">xdm_flags=""</pre><p>If you need a more complicated <code class="literal">xdm</code> setup, put any command-line arguments inside the quotes.</p></div><div class="sect1" title="Onward!"><div class="titlepage"><div><div><h2 class="title" id="onward" style="clear: both">Onward!</h2></div></div></div><p>Armed with the information in this chapter, you should be able to get your system on your local network and make it at least minimally comfortable to work with. Next, let’s take a look at the OpenBSD boot process.</p></div><div class="footnotes" epub:type="footnotes"><br/><hr style="width: 100; align: left;"/><div class="footnote" epub:type="footnote" id="ftn.id485404"><p><sup>[<a class="para" href="#id485404">10</a>] </sup>Saying “Sorry about the timestamps errors in your vital data, but I hadn’t set the system clock yet” is roughly equivalent to saying “I don’t care about you or your data.” If you feel that way, I’m not going to argue, but at least have the confidence to tell the user what you really think.</p></div></div></section></body></html>