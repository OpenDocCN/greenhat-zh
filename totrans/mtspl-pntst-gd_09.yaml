- en: Chapter 9. Metasploit Auxiliary Modules
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When most people think of Metasploit, exploits come to mind. Exploits are cool,
    exploits get you shell, and exploits get all the attention. But sometimes you
    need something more than that. By definition, a Metasploit module that is not
    an exploit is an *auxiliary module*, which leaves a lot to the imagination.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: In addition to providing valuable reconnaissance tools such as port scanners
    and service fingerprinters, auxiliary modules such as *ssh_login* can take a known
    list of usernames and passwords and then attempt to log in via brute force across
    an entire target network. Also included in the auxiliary modules are various protocol
    fuzzers such as *ftp_pre_post*, *http_get_uri_long*, *smtp_fuzzer*, *ssh_version_corrupt*,
    and more. You can launch these fuzzers at a target service in hopes of finding
    your own vulnerabilities to exploit.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: Just because auxiliary modules don’t have a payload, don’t think you won’t use
    them. But before we dive into their myriad uses, here’s an overview to help you
    see what we are dealing with.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-4
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: As you can see in the preceding listing, modules are installed within the */modules/auxiliary*
    directory ![](../images/00002.gif) of the Framework, and within that, sorted based
    on the functions they provide. Should you want to create your own module or edit
    an existing one to suit a specific purpose, you will find them in their corresponding
    directories. For instance, if you need to develop a fuzzer module to hunt your
    own bugs, you will find some pre-existing modules in the */fuzzers* directory.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
- en: To list all the available auxiliary modules within Metasploit, simply issue
    the **`show auxiliary`** command ![](../images/00002.gif) within *msfconsole*.
    If you compare the preceding directory listing with the module names displayed
    in *msfconsole*, you will notice that the naming of the modules depends on the
    underlying directory structure, as shown below.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-7
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: As you can see in this trimmed output, the auxiliary modules are organized by
    category. At your disposal are the DNS enumeration module, Wi-Fi fuzzers, and
    even a module to locate and abuse the Trojan backdoor that was included on Energizer
    USB battery chargers.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: Using an auxiliary module is similar to using any exploit within the Framework
    — simply issue the `use` command followed by the module name. For example, to
    use the *webdav_scanner* module (explored in [Auxiliary Modules in Use](part0013.html#auxiliary_modules_in_use)
    in [Auxiliary Modules in Use](part0013.html#auxiliary_modules_in_use)), you would
    run `use scanner/http/webdav_scanner` as shown below.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-11
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In auxiliary modules, the basic options are slightly different with an `RHOSTS`
    option to target multiple machines and a `THREADS` value to fine-tune the speed
    of your scanning.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Here we issue the `use` command ![](../images/00002.gif) for the module of interest.
    We can then get a full dump of information from the system using the `info` command
    ![](../images/00004.gif), as well as a list of the various available options.
    Within the options, we see that the only required option without a default is
    `RHOSTS` ![](../images/00005.gif), which can take a single IP address, list, range,
    or CIDR notation.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们发出`use`命令 ![](../images/00002.gif) 来使用感兴趣的模块。然后，我们可以使用`info`命令 ![](../images/00004.gif)
    从系统中获取完整的信息，以及各种可用选项的列表。在选项中，我们看到唯一一个没有默认值的必需选项是`RHOSTS` ![](../images/00005.gif)，它可以接受单个IP地址、列表、范围或CIDR表示法。
- en: The other options mostly vary depending on the auxiliary module being used.
    For instance, the `THREADS` ![](../images/00006.gif) option allows multiple threads
    to be launched as part of a scan, which speeds things up exponentially.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 其他选项主要取决于所使用的辅助模块。例如，`THREADS` ![](../images/00006.gif)选项允许在扫描过程中启动多个线程，这可以指数级地加快速度。
- en: Auxiliary Modules in Use
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 正在使用的辅助模块
- en: Auxiliary modules are exciting because they can be used in so many ways for
    so many things. If you can’t find the perfect auxiliary module, it’s easy to modify
    one to suit your specific needs.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 辅助模块非常吸引人，因为它们可以用多种方式用于许多事情。如果你找不到完美的辅助模块，很容易修改一个来满足你的特定需求。
- en: Consider a common example. Say you are conducting a remote penetration test,
    and upon scanning the network, you identify a number of web servers and not much
    else. Your attack surface is limited at this point, and you have to work with
    what is available to you. Your auxiliary *scanner/http* modules will now prove
    extremely helpful as you look for low-hanging fruit against which you can launch
    an exploit. To search for all available HTTP scanners, run **`search scanner/http`**
    as shown here.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑一个常见的例子。比如说，你正在进行远程渗透测试，在扫描网络后，你识别出了一些Web服务器以及其他不多的事物。此时你的攻击面有限，你必须利用你所拥有的资源。你的辅助*scanner/http*模块现在将证明在寻找容易攻击的目标时极为有用。要搜索所有可用的HTTP扫描器，运行**`search
    scanner/http`**，如下所示。
- en: '[PRE3]'
  id: totrans-20
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: There are a lot of options here, so let’s identify some likely candidates in
    that list. Notice that there are the options for identifying the *robots.txt*
    ![](../images/00002.gif) file from various servers, numerous ways to interact
    with WebDAV ![](../images/00004.gif), tools to identify servers with writable
    file access ![](../images/00005.gif), and many other special-purpose modules.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 这里有许多选项，所以让我们在那份列表中识别一些可能的候选者。请注意，有从各种服务器识别*robots.txt* ![](../images/00002.gif)文件的选项，多种与WebDAV
    ![](../images/00004.gif)交互的方式，以及识别具有可写文件访问权限的服务器的工具，还有许多其他特殊用途的模块。
- en: You can see immediately that there are modules that you can use for subsequent
    exploration. Older versions of Microsoft IIS had a vulnerability in their WebDAV
    implementations that allowed for remote exploitation, so you could first run a
    scan against your targets in hopes of finding a server with WebDAV enabled, as
    follows.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以立即看到一些可以用于后续探索的模块。Microsoft IIS的旧版本在其WebDAV实现中存在一个漏洞，允许远程利用，因此你可以首先对你的目标运行扫描，希望找到启用了WebDAV的服务器，如下所示。
- en: '[PRE4]'
  id: totrans-23
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: As you can see in this example, a number of HTTP servers have been scanned in
    the search for WebDAV ![](../images/00002.gif), and only one happens to have Web-DAV
    enabled ![](../images/00004.gif). This module has quickly identified a specific
    system against which you can launch further attacks.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 正如这个例子所示，在寻找WebDAV ![](../images/00002.gif)的过程中已经扫描了多个HTTP服务器，而只有一个恰好启用了Web-DAV
    ![](../images/00004.gif)。该模块迅速识别了一个特定的系统，你可以针对它发起进一步的攻击。
- en: '* * *'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: Note
  id: totrans-26
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Auxiliary module functionality goes far beyond scanning. As you will see in
    [Chapter 14](part0018.html#creating_your_own_exploits) auxiliary modules also
    work great as fuzzers with a little modification. A number of denial-of-service
    modules are also available for Wi-Fi (including *dos/wifi/deauth*), which can
    prove quite disruptive when used properly.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 辅助模块的功能远不止扫描。正如你将在[第14章](part0018.html#creating_your_own_exploits)中看到的那样，辅助模块经过一些修改后也可以作为fuzzers使用。还有一些针对Wi-Fi（包括*dos/wifi/deauth*）的拒绝服务模块也可用，如果正确使用，可能会造成相当大的破坏。
- en: '* * *'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: Anatomy of an Auxiliary Module
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 辅助模块的解剖结构
- en: Let’s look at the makeup of an auxiliary module in a fun little example not
    currently in the Metasploit repository (because it does not pertain to penetration
    testing). This example will demonstrate how easy it is to off-load a great deal
    of programming to the Framework, allowing us to focus on the specifics of a module.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
- en: Chris Gates wrote an auxiliary module for the Framework that gave his Twitter
    followers the impression that he had somehow invented a device that allowed him
    to travel at the speed of light. It makes a great example of the code reuse available
    in Metasploit. (You can access the source of the script at [http://carnal0wnage.googlecode.com/](http://carnal0wnage.googlecode.com/).)
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-32
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: We’ve placed the module in our auxiliary directory ![](../images/00002.gif)
    so that it will be available for use by Metasploit. But before we use this module,
    let’s look at the actual script and break down the components so we can see exactly
    what the module contains.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-34
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: The module begins with the first two lines importing the auxiliary class ![](../images/00002.gif).
    Next it makes the HTTP client functions available for use ![](../images/00004.gif)
    within the script.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-36
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Within the initialization constructor ![](../images/00002.gif) we define much
    of the information ![](../images/00004.gif) that is reported back when issuing
    the `info` command in *msfconsole*. We can see where the various options are defined
    ![](../images/00005.gif) and whether they are required. So far, all are pretty
    direct and their purposes are clear. Still, we have yet to see any actual logic
    being performed. That comes next.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-38
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Now we reach the actual logic of the script — what happens when `run` is called
    within the module. Initially the provided options are set to local variable names
    ![](../images/00002.gif) along with defining various other objects. An object
    is then created by calling the *send_request_cgi* method ![](../images/00004.gif)
    imported into the script from *lib/msf/core/exploit/http.rb* and defined as “Connects
    to the server, creates a request, sends the request, reads the response.” This
    method takes various parameters that make up the call to the actual server, as
    shown here.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: After this object is created, the results are printed ![](../images/00002.gif).
    If anything goes wrong, logic exists for catching any errors ![](../images/00004.gif)
    and reporting them to the user. All of this logic is simple and is just a matter
    of plugging various parameters into existing functions of the Framework. This
    is a great example of the power of the Framework, because it allows us to concentrate
    only on the information needed to address our goal. There is no reason to reproduce
    any of the standard functions such as error handling, connection management, and
    so on.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
- en: Let’s see this module in action. If you don’t remember the full path to the
    module within the Metasploit directory structure, search for it like so.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: In the prior example, we search for “foursquare” ![](../images/00002.gif), issue
    the `use` command ![](../images/00004.gif) to select the auxiliary module, and
    display the information ![](../images/00005.gif) for the selected module. Based
    on the options presented above, we need to configure a few of them first.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-45
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: In order to run this module successfully, we need a valid set of Foursquare
    credentials to do the check-in. We first define the VenueID that we find online
    with a bit of Googling ![](../images/00002.gif), and then we set our Foursquare
    credentials ![](../images/00004.gif) and run the module. We get a successful result
    with the Foursquare service confirming our check-in and giving us five points
    ![](../images/00005.gif).
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: In this case, we have submitted a request to “check in” at Union Station in
    Washington, DC, on the Foursquare service (see [Figure 9-1](part0013.html#a_successful_check-in_at_union_station)).
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: '![A successful check-in at Union Station](../images/00038.jpeg)Figure 9-1. A
    successful check-in at Union Station'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: When we check the Foursquare website, we see a successful result. Modules like
    these demonstrate that Metasploit allows us to implement nearly anything we can
    programmatically imagine.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
- en: Going Forward
  id: totrans-50
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As you have seen, auxiliary modules can have a wide range of uses. The infrastructure
    provided by the Metasploit Framework can produce a wide array of tools in a very
    short time. Using Metasploit’s auxiliary modules, you can scan an IP address range
    to determine which hosts are alive and which services are running on each host.
    You can then leverage this information to determine vulnerable services, such
    as in the WebDAV example, or even log in via brute force on a remote server.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
- en: Although you can easily create custom auxiliary modules, don’t discount the
    existing auxiliary modules in the Framework. These modules may be the exact one-off
    tool you need.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: The auxiliary modules provide a wide range of potential additional avenues.
    For a web application, the auxiliary modules offer more than 40 additional checks
    or attacks that you can perform. In some instances, you may want to brute force
    a web server to see which servers are listing directories. Or you may want to
    scan the web server to see if it can act as an open proxy and relay traffic out
    to the Internet. Regardless of your needs, the auxiliary modules can provide additional
    enumeration information, attack vectors, or vulnerabilities.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
