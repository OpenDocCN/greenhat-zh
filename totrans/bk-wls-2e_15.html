<html><head></head><body><div class="chapter" xml:lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="virtual_private_networks-id001"/>Chapter 15. VIRTUAL PRIVATE NETWORKS</h1></div></div></div><div class="mediaobject"><a id="I_mediaobject15_d1e16286"/><img alt="VIRTUAL PRIVATE NETWORKS" src="tagoreillycom20090210nostarchimages255004.png.jpg"/></div><p>The security tools in the Wi-Fi specification are not good enough to protect data transmitted through a wireless network. What's the fix? A virtual private network (VPN) can add another effective form of security to data that moves from a wireless network client to a host that can be located anywhere with a network connection.</p><p>A VPN uses a <span class="emphasis"><em>data tunnel</em></span> to connect two points on a network through an encrypted channel. The end points can be a single network client and a network server, a pair of client computers or other devices, or the gateways to a pair of LANs. Data that passes through a public network such as the Internet is completely isolated from other network traffic. It uses login and password authentication to restrict access to authorized users; it encrypts the data to make it unintelligible to intruders who intercept it; and it uses data authentication to maintain the integrity of each data packet and to assure that all data originates with legitimate network clients.<a class="indexterm" id="idx-CHP-15-1594"/></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note-30"/>Note</h3><p><span class="emphasis"><em>VPN functions occur at the IP or network layer of the ISO model. Therefore, they can operate on top of the Wi-Fi or other wireless protocols, which operate at the physical layer. VPNs can also pass data across a network connection that includes more than one physical medium (for example, a wireless link that passes data onward to a wired Ethernet network). In other words, a VPN is an end-to-end service; it doesn't matter whether data uses a wireless link, an Ethernet cable, an ordinary telephone line, or some combination of those and other transmission media. This adds another level of security to (or provides an alternative to) WEP or WPA encryption, which only applies to the wireless portion of the network</em></span>.<a class="indexterm" id="idx-CHP-15-1595"/><a class="indexterm" id="idx-CHP-15-1596"/></p></div><p>In a traditional VPN, a remote user can log in to a distant LAN and obtain all the same network services that are available to <a class="indexterm" id="idx-CHP-15-1597"/>local clients. VPNs are commonly used to extend corporate networks to branch offices and to connect users to the LAN from home or from off-site locations such as a client or customer's office.</p><p>A connection through a VPN server presents the same appearance to the rest of the network as a client device connected directly to the LAN. The only difference is that the data from the VPN passes through a VPN driver and a public network instead of moving directly from the network adapter to the LAN. <a class="xref" href="ch15.html#a_remote_network_can_connect_to_a_lan_th" title="Figure 15-1. A remote network can connect to a LAN through a VPN.">Figure 15-1</a> shows a typical VPN connection to a <a class="indexterm" id="idx-CHP-15-1598"/>remote network.</p><div class="figure"><a id="a_remote_network_can_connect_to_a_lan_th"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e16335"/><img alt="A remote network can connect to a LAN through a VPN." src="tagoreillycom20090210nostarchimages254669.png.jpg"/></div></div><p class="title"><b>Figure 15-1. A remote network can connect to a LAN through a VPN.</b></p></div><br class="figure-break"/><p>All of the same security benefits also apply to a short-range VPN that tunnels through a wireless link and a longer-range VPN that starts on a wireless network and relays the data to a remote server. These are two different uses for a VPN: a <span class="emphasis"><em>local</em></span> VPN that only extends across the wireless portion of a network between the client devices and the access point and an <span class="emphasis"><em>extended network</em></span> that carries VPN-encoded data beyond the access points to a VPN server through a public network, such as the Internet or a dial-up telephone connection.<a class="indexterm" id="idx-CHP-15-1599"/></p><p>An extended network is a traditional VPN that happens to originate from a wireless network client. The same VPN can also support connections that don't include a wireless segment and logins from public wireless services, such as the ones at airports or coffee shops. This is the conventional way to use a VPN.</p><p><a class="indexterm" id="idx-CHP-15-1600"/>Local, short-range VPNs are interesting to people who operate wireless <a class="indexterm" id="idx-CHP-15-1601"/>networks because they add another layer of security to wireless links. Because the data moving between wireless clients and the network access point is encrypted (using an algorithm that is more secure than WPA encryption), it is unintelligible to any third party who might be monitoring the radio signal; because the VPN server at the access point won't accept data links from wireless clients that are not using the correct VPN drivers and passwords, an intruder can't break into the network by associating a rogue client with the access point.</p><p>The goal of a wireless VPN is to protect the wireless link between the clients and the access point and to lock out unauthorized users. Therefore,<a class="indexterm" id="idx-CHP-15-1602"/> the isolated and encrypted data can only move across a single room rather than hundreds or thousands of miles. Of course, the access point might also relay VPN-encoded data onward through the Internet to a network host in another location.</p><p><a class="xref" href="ch15.html#a_vpn_provides_a_secure_connection_betwe" title="Figure 15-2. A VPN provides a secure connection between a wireless network and an Internet gateway or a local LAN.">Figure 15-2</a> shows a <a class="indexterm" id="idx-CHP-15-1603"/>wireless connection to a VPN. The VPN server is located between the wireless access point and the host LAN, so all of the packets that move through the wireless portion of the network are encoded. For clarity, the diagram shows the VPN server as a separate component, but the most practical way to add VPN security to a wireless LAN is to use a router or gateway that incorporates VPN support. <a class="indexterm" id="idx-CHP-15-1604"/>VPN-enabled routers are available from several vendors, including Cisco, NETGEAR, and TRENDnet.</p><div class="figure"><a id="a_vpn_provides_a_secure_connection_betwe"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e16387"/><img alt="A VPN provides a secure connection between a wireless network and an Internet gateway or a local LAN." src="tagoreillycom20090210nostarchimages254442.png.jpg"/></div></div><p class="title"><b>Figure 15-2. A VPN provides a secure connection between a wireless network and an Internet gateway or a local LAN.</b></p></div><br class="figure-break"/><div class="sect1" xml:lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="vpn_methods"/>VPN Methods</h1></div></div></div><p>A VPN moves data through one or more intermediate networks to a destination on another network. The VPN's tunneling client encapsulates the existing data packets or frames by adding a new header with the routing information that instructs them how to reach the end point of the VPN. The transmission path through the intermediate networks is called a tunnel. At the other end of the tunnel, the VPN server removes the tunneling header and forwards the data to the destination specified by the next layer of headers. The exact form of the tunnel doesn't make any difference to the data because the data treats the tunnel as a point-to-point connection.<a class="indexterm" id="idx-CHP-15-1605"/></p><p>The tunneling headers can take several forms. The methods used most widely in VPNs are <a class="indexterm" id="idx-CHP-15-1606"/>Point-to-Point Tunneling Protocol (PPTP), <a class="indexterm" id="idx-CHP-15-1607"/>Layer Two Tunneling Protocol (<a class="indexterm" id="idx-CHP-15-1608"/>L2TP), and <a class="indexterm" id="idx-CHP-15-1609"/>IP Security (IPsec) mode. <a class="indexterm" id="idx-CHP-15-1610"/>PPTP and L2TP can move data through IP, IPX, and NetBEUI networks; <a class="indexterm" id="idx-CHP-15-1611"/>IPsec is limited to IP networks. Both the client and the server must use the same protocol.</p><p>In PPTP and L2TP, the client and server must configure the tunnel for each transmission before they begin to exchange data. The configuration parameters include the route through the intermediate network and the encryption and compression specifications. When the transmission is complete, the client and server terminate the connection and close the tunnel. Unfortunately, several data security analysts have identified significant flaws in PPTP that can allow intruders to break into a VPN based on PPTP and sniff passwords, decode encryption, read data, or inflict damage to a network server. Therefore, PPTP headers are not secure and should not be used.</p><p>In an IPsec network link, the client and server must establish the tunnel through the intermediate networks in a separate transaction before they begin to exchange data.</p><p>Both L2TP and IPsec offer specific advantages and disadvantages, but they're both good enough to create a secure link between a wireless network client and an access point. The differences among the three are technical rather than practical. You can find an excellent explanation of the internal operation of all three protocols in Microsoft's white paper entitled <span class="emphasis"><em>Virtual Private Networking in Windows 2000: An Overview</em></span>, which is available online at <a class="ulink" href="http://www.microsoft.com/windows2000/docs/VPNoverview.doc">http://www.microsoft.com/windows2000/docs/VPNoverview.doc</a> (but remember that the flaws in PPTP networks were identified after that white paper was written).<a class="indexterm" id="idx-CHP-15-1612"/></p></div></div>
<div class="sect1" xml:lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="vpn_servers"/>VPN Servers</h1></div></div></div><p>A VPN server (or host) can be part of a Unix or Windows server, or it can be built into a stand-alone network router or gateway. If your network already uses a separate computer as a dedicated server, you can use that computer as the VPN server. A separate piece of hardware might be a better choice if your network does not already have a full-blown network server.<a class="indexterm" id="idx-CHP-15-1613"/></p><p>Dozens of VPN equipment makers offer routers, gateways, and other products that support one or more of the VPN protocols. Each of these products has a different feature set, so it's essential to test the specific combination of client and server that you intend to use on your own network before you commit to them. The <a class="indexterm" id="idx-CHP-15-1614"/>Virtual Private Network Consortium (VPNC) is moving toward a set of interoperability tests and certification standards (much like the Wi-Fi standards for wireless Ethernet equipment). The <a class="indexterm" id="idx-CHP-15-1615"/>VPNC website, <a class="ulink" href="http://www.vpnc.org">http://www.vpnc.org</a>, lists the products that have passed the interoperability tests, and it also provides links to sources of information about a long list of VPN products.</p><div class="sect2" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_a_windows_server_for_a_wirel"/>Configuring a Windows Server for a Wireless VPN</h2></div></div></div><p>If you're committed to using a <a class="indexterm" id="idx-CHP-15-1616"/>Windows server, you can use either L2TP or IPsec with Windows Server 2003 or Windows Server 2008; if your server runs the older Windows NT Server 4.0 or Windows 2000 Server software, you're limited to L2TP (or the seriously flawed PPTP). The server also requires two network interface cards: one connected to the wired LAN or the Internet gateway and the other connected to the wireless network. The interface card that is connected to the wireless port normally connects directly to the wireless access point's Ethernet port. The exact process of installing an L2TP host on a Windows server is slightly different in each version of Windows, but the general steps are the same. For specific information about configuring a particular operating system, consult the online Help screens and Microsoft's Resource Kit and other online documentation for your server's operating system. The following sections describe the configuration steps in general terms.<a class="indexterm" id="idx-CHP-15-1617"/></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="note-31"/>Note</h3><p><span class="emphasis"><em>For more information about deploying and using VPNs with Microsoft servers, see the Microsoft TechNet articles linked from</em></span> <a class="ulink" href="http://technet.microsoft.com/en-us/network/bb545442.aspx">http://technet.microsoft.com/en-us/network/bb545442.aspx</a>.<a class="indexterm" id="idx-CHP-15-1618"/></p></div><div class="sect3" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="configure_the_connection_to_the_wired_ne"/>Configure the Connection to the Wired Network</h3></div></div></div><p>The link to the LAN or other network is a dedicated connection through a network adapter. The network connection profile for this connection must include the IP address and subnet mask assigned to this connection and the default gateway address assigned to the network gateway.</p></div><div class="sect3" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="configure_the_vpn_connection"/>Configure the VPN Connection</h3></div></div></div><p>The VPN connection is usually an Ethernet link to one or more access points. The connection profile on the server for the VPN connection must include the IP address and subnet mask assigned to this port and the addresses of the DNS and WINS name <a class="indexterm" id="idx-CHP-15-1619"/>servers used by this network.</p></div><div class="sect3" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="configure_the_remote_access_server_as_a_"/>Configure the Remote Access Server as a Router</h3></div></div></div><p>The server must use either static routes or routing protocols that make each wireless client reachable from the wired network.</p></div><div class="sect3" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="enable_and_configure_the_server_for_l2tp"/>Enable and Configure the Server for L2TP Clients</h3></div></div></div><p><a class="indexterm" id="idx-CHP-15-1620"/>Windows uses <a class="indexterm" id="idx-CHP-15-1621"/>Remote Access Service (<a class="indexterm" id="idx-CHP-15-1622"/>RAS) and Point-to-Point Protocol (PPP) to establish <a class="indexterm" id="idx-CHP-15-1623"/>VPN connections. The Routing and Remote Access service enables RAS. A VPN connection requires these RAS configuration options:<a class="indexterm" id="idx-CHP-15-1624"/></p><table border="0" class="simplelist" summary="Simple list"><tr><td><span class="strong"><strong>Authentication Method</strong></span> Encrypted PPTP connections use the <a class="indexterm" id="idx-CHP-15-1625"/>MS-CHAP or <a class="indexterm" id="idx-CHP-15-1626"/>EAP-TLS authentication methods.</td></tr><tr><td><span class="strong"><strong>Authentication Provider</strong></span> Either Windows 2000 security or an external RADIUS server can verify network clients.</td></tr><tr><td><span class="strong"><strong>IP Routing</strong></span> IP Routing and IP-based remote access must be active. If the wired network acts as a DHCP server for the wireless clients, DHCP must be active.</td></tr></table></div><div class="sect3" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="configure_l2tp_ports"/>Configure L2TP Ports</h3></div></div></div><p>Set each L2TP port to accept remote access.</p></div><div class="sect3" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="configure_network_filters"/>Configure Network Filters</h3></div></div></div><p><a class="indexterm" id="idx-CHP-15-1627"/>Input and <a class="indexterm" id="idx-CHP-15-1628"/>output filters keep the remote access server from sending and receiving data that does not originate at a <a class="indexterm" id="idx-CHP-15-1629"/>VPN client. These filters will reject data to or from unauthorized users, so those intruders will not be able to obtain an Internet connection (or a connection to the wired LAN) through the wireless network.<a class="indexterm" id="idx-CHP-15-1630"/></p></div><div class="sect3" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="configure_remote_access_policies"/>Configure Remote Access Policies</h3></div></div></div><p>The remote access permission for each wireless client must be set to allow access to the RAS server. The port type must be set to the correct VPN protocol (e.g., PPTP or L2TP), and the profile for each connection must include the type of encryption in use. In Windows, the three encryption strength options are:</p><table border="0" class="simplelist" summary="Simple list"><tr><td><span class="strong"><strong>Basic</strong></span> Uses a 40-bit encryption key</td></tr><tr><td><span class="strong"><strong>Strong</strong></span> Uses a 56-bit encryption key</td></tr><tr><td><span class="strong"><strong>Strongest</strong></span> Uses a 128-bit encryption key</td></tr></table></div></div><div class="sect2" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="vpn_servers_for_unix"/>VPN Servers for Unix</h2></div></div></div><p>All of the BSD variations (including FreeBSD, NetBSD, OpenBSD, and Mac OS X) include an IPsec VPN client and server as part of the release package.<a class="indexterm" id="idx-CHP-15-1631"/></p><p>Linux <a class="indexterm" id="idx-CHP-15-1632"/>FreeS/WAN is the most popular implementation of IPsec for Linux. Go to <a class="ulink" href="http://www.freeswan.org">http://www.freeswan.org</a> for downloads, documentation, and access to the community of FreeS/WAN users.</p><p><a class="indexterm" id="idx-CHP-15-1633"/>OpenVPN is an SSL-based VPN solution for Linux, BSD, OS X, and Windows. It is easy to configure and offers both routed VPN (traffic to specific destinations is sent through the <a class="indexterm" id="idx-CHP-15-1634"/>VPN) and tunneled virtual interfaces (emulating a physical layer Ethernet device, which can <a class="indexterm" id="idx-CHP-15-1635"/>pass non-IP traffic through the VPN). <a class="indexterm" id="idx-CHP-15-1636"/>OpenVPN can be found at <a class="ulink" href="http://openvpn.net">http://openvpn.net</a>.</p><p>If you are using a Linux firewall, you might want to consider <a class="indexterm" id="idx-CHP-15-1637"/>VPN Masquerade. Linux uses the IP Masquerade function in the Linux kernel to share a single connection to the Internet among multiple clients. VPN Masquerade is the section of IP Masquerade that supports IPsec clients. The HOWTO <a class="indexterm" id="idx-CHP-15-1638"/>for Linux VPN Masquerade is at <a class="ulink" href="http://tldp.org/HOWTO/VPN-Masquerade-HOWTO.html">http://tldp.org/HOWTO/VPN-Masquerade-HOWTO.html</a>.</p></div><div class="sect2" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="network_hardware_with_built-in_vpn_suppo"/>Network Hardware with Built-in VPN Support</h2></div></div></div><p>A dedicated computer running Linux or one of the BSD versions of Unix can be an inexpensive VPN server; if you're using a Windows server <a class="indexterm" id="idx-CHP-15-1639"/>for other purposes, it can also provide VPN support at little or no additional cost. But a full-size network server is often a bigger and more complicated solution to a relatively simple problem. They're not always the best choice. Many switches, routers, gateways, and firewall devices also include VPN support. Cisco, 3COM, Intel, and many other manufacturers make VPN products that are often easier to install and maintain than a separate computer.<a class="indexterm" id="idx-CHP-15-1640"/></p><p>In a wireless network, the VPN server does not need all the same bells and whistles as a server in a larger corporate network. As <a class="xref" href="ch15s02.html#a_network_router_can_also_act_as_a_vpn_s" title="Figure 15-3. A network router can also act as a VPN server for a wireless network.">Figure 15-3</a> shows, a router located between the wireless access point and the wired portion of an enterprise network can easily double as a VPN server. In a home network, the VPN server can operate between the access point and a DSL or cable modem.</p><div class="figure"><a id="a_network_router_can_also_act_as_a_vpn_s"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e16682"/><img alt="A network router can also act as a VPN server for a wireless network." src="tagoreillycom20090210nostarchimages253997.png.jpg"/></div></div><p class="title"><b>Figure 15-3. A network router can also act as a VPN server for a wireless network.</b></p></div><br class="figure-break"/><p>Stand-alone VPN client hardware that sits between the computer and the network is also available, but it's not as practical in a wireless network because the wireless network adapter is almost always plugged directly into the computer itself.<a class="indexterm" id="I_indexterm15_d1e16689"/></p></div></div>
<div class="sect1" xml:lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="vpn_client_software"/>VPN Client Software</h1></div></div></div><p>A wireless client connects to a VPN server through its wireless Ethernet link to the network access point, which the operating system sees as a LAN connection. To set up a VPN tunnel through that connection, you must install the tunneling protocol as a network service.<a class="indexterm" id="idx-CHP-15-1641"/></p><div class="sect2" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="configuring_windows_for_vpn"/>Configuring Windows for VPN</h2></div></div></div><p>Windows XP and Vista include support for VPNs, but it's not part of the default installation, so the first step in setting up a VPN client is to install the protocol.<a class="indexterm" id="idx-CHP-15-1642"/><a class="indexterm" id="idx-CHP-15-1643"/></p><p>In Windows XP and Windows Vista, a wizard makes the whole process easy. In XP, follow these steps to set up a VPN connection:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>From the Control Panel, open <span class="strong"><strong>Network Connections</strong></span>.<a class="indexterm" id="idx-CHP-15-1644"/></p></li><li class="listitem"><p>Double-click the <span class="strong"><strong>New Connection Wizard</strong></span> icon.<a class="indexterm" id="idx-CHP-15-1645"/></p></li><li class="listitem"><p>When the Network Connection Type window shown in <a class="xref" href="ch15s03.html#the_option_for_creating_a_vpn_link_speci" title="Figure 15-4. The option for creating a VPN link specifies connecting to a workplace network, but it also applies to a wireless VPN.">Figure 15-4</a> appears, choose the <span class="strong"><strong>Connect to the network at my workplace</strong></span> option.</p><div class="figure"><a id="the_option_for_creating_a_vpn_link_speci"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e16753"/><img alt="The option for creating a VPN link specifies connecting to a workplace network, but it also applies to a wireless VPN." src="tagoreillycom20090210nostarchimages254435.png.jpg"/></div></div><p class="title"><b>Figure 15-4. The option for creating a VPN link specifies connecting to a workplace network, but it also applies to a wireless VPN.</b></p></div><br class="figure-break"/></li><li class="listitem"><p>In the Network Connection window (shown in <a class="xref" href="ch15s03.html#select_the_virtual_private_network_conne" title="Figure 15-5. Select the Virtual private network connection option to create a VPN connection.">Figure 15-5</a>), choose the <span class="strong"><strong>Virtual private network connection</strong></span> option and click the <span class="strong"><strong>Next</strong></span> button.</p></li><li class="listitem"><p>In the Connection Name window, type a name for the Wireless VPN connection. This name will appear on desktop shortcuts to this connection. Click the <span class="strong"><strong>Next</strong></span> button.<a class="indexterm" id="idx-CHP-15-1646"/></p><div class="figure"><a id="select_the_virtual_private_network_conne"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e16785"/><img alt="Select the Virtual private network connection option to create a VPN connection." src="tagoreillycom20090210nostarchimages254575.png.jpg"/></div></div><p class="title"><b>Figure 15-5. Select the Virtual private network connection option to create a VPN connection.</b></p></div><br class="figure-break"/></li><li class="listitem"><p>In the Public Network window (shown in <a class="xref" href="ch15s03.html#in_a_wireless_network_the_vpn_does_not_r" title="Figure 15-6. In a wireless network, the VPN does not require a dial-up connection.">Figure 15-6</a>), choose the <span class="strong"><strong>Do not dial the initial connection</strong></span> option because you don't need to connect through a telephone line. Click the <span class="strong"><strong>Next</strong></span> button.<a class="indexterm" id="idx-CHP-15-1647"/></p><div class="figure"><a id="in_a_wireless_network_the_vpn_does_not_r"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e16807"/><img alt="In a wireless network, the VPN does not require a dial-up connection." src="tagoreillycom20090210nostarchimages254332.png.jpg"/></div></div><p class="title"><b>Figure 15-6. In a wireless network, the VPN does not require a dial-up connection.</b></p></div><br class="figure-break"/></li><li class="listitem"><p>In the VPN Server Selection window shown in <a class="xref" href="ch15s03.html#the_host_name_or_ip_address_identifies_t" title="Figure 15-7. The Host Name or IP Address identifies the VPN server at the other end of the wireless link.">Figure 15-7</a>, type the IP address of the VPN server.<a class="indexterm" id="idx-CHP-15-1648"/></p><div class="figure"><a id="the_host_name_or_ip_address_identifies_t"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e16827"/><img alt="The Host Name or IP Address identifies the VPN server at the other end of the wireless link." src="tagoreillycom20090210nostarchimages254057.png.jpg"/></div></div><p class="title"><b>Figure 15-7. The Host Name or IP Address identifies the VPN server at the other end of the wireless link.</b></p></div><br class="figure-break"/></li><li class="listitem"><p>Click the <span class="strong"><strong>Next</strong></span> button and then the <span class="strong"><strong>Finish</strong></span> button to complete the wizard.</p></li></ol></div><p>In Vista, follow these steps:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Open the <span class="strong"><strong>Control Panel</strong></span>.</p></li><li class="listitem"><p>Open the <span class="strong"><strong>Network and Sharing Center</strong></span>.</p></li><li class="listitem"><p>In the list of Tasks on the left side of the Network and Sharing Center shown in <a class="xref" href="ch15s03.html#use_the_set_up_a_connection_or_network_o" title="Figure 15-8. Use the Set up a connection or network option to create a VPN link.">Figure 15-8</a>, choose the <span class="strong"><strong>Set up a connection or network</strong></span> option. A Choose a Connection Option window will open.</p></li><li class="listitem"><p>Choose the <span class="strong"><strong>Connect to a workplace</strong></span> option and click the <span class="strong"><strong>Next</strong></span> button. The wizard will ask if you want to use an existing connection.</p></li><li class="listitem"><p>Choose the <span class="strong"><strong>No, create a new connection</strong></span> option. The wizard will ask if you want to use a VPN or a dial-up connection.<a class="indexterm" id="idx-CHP-15-1649"/><a class="indexterm" id="idx-CHP-15-1650"/><a class="indexterm" id="I_indexterm15_d1e16889"/><a class="indexterm" id="I_indexterm15_d1e16892"/></p><div class="figure"><a id="use_the_set_up_a_connection_or_network_o"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e16900"/><img alt="Use the Set up a connection or network option to create a VPN link." src="tagoreillycom20090210nostarchimages254757.png.jpg"/></div></div><p class="title"><b>Figure 15-8. Use the Set up a connection or network option to create a VPN link.</b></p></div><br class="figure-break"/></li><li class="listitem"><p>Choose the <span class="strong"><strong>Internet connection (VPN)</strong></span> option. The wizard will ask for details in the screen shown in <a class="xref" href="ch15s03.html#use_this_screen_to_configure_your_vpn" title="Figure 15-9. Use this screen to configure your VPN.">Figure 15-9</a>.</p><div class="figure"><a id="use_this_screen_to_configure_your_vpn"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e16916"/><img alt="Use this screen to configure your VPN." src="tagoreillycom20090210nostarchimages254187.png.jpg"/></div></div><p class="title"><b>Figure 15-9. Use this screen to configure your VPN.</b></p></div><br class="figure-break"/></li><li class="listitem"><p>Type the VPN server's address provided by the network manager in the Internet Address field. This can be either a numeric address or a name.</p></li><li class="listitem"><p>Type the name you want to use on your own computer for this VPN <a class="indexterm" id="idx-CHP-15-1651"/>connection in the Destination Name field.</p></li><li class="listitem"><p>If you want to test the connection, click the Next button. If you don't want to connect, select the Don't connect now option and click Next. The wizard will ask for your name and password.</p></li><li class="listitem"><p>Type the name and password you use for this VPN account. If you want your computer to automatically send your password, turn on the <span class="strong"><strong>Remember this password</strong></span> option. Click the <span class="strong"><strong>Create</strong></span> button to establish the VPN connection and close the wizard.</p></li></ol></div><p>To create a shortcut to a VPN on your desktop in Windows, follow these steps:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>In XP, open the Control Panel and choose <span class="strong"><strong>Network Connections</strong></span>. In Vista, open the Control Panel, choose the <span class="strong"><strong>Network and Sharing Center</strong></span>, and select <span class="strong"><strong>Manage Network Connections</strong></span> from the list of Tasks.</p></li><li class="listitem"><p>From the Network Connections window, right-click the icon or listing for the VPN and choose <span class="strong"><strong>Create Shortcut</strong></span> from the pop-up menu.</p></li><li class="listitem"><p>A pop-up window will ask if you want to place the shortcut on the desktop. Click the <span class="strong"><strong>Yes</strong></span> button. A shortcut will appear on the desktop.</p></li></ol></div></div><div class="sect2" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="the_microsoft_l2tpipsec_vpn_client"/>The Microsoft L2TP/IPsec VPN Client</h2></div></div></div><p><a class="indexterm" id="idx-CHP-15-1652"/>Microsoft includes a <a class="indexterm" id="idx-CHP-15-1653"/>client for Layer Two Tunneling Protocol (L2TP) connections with Internet Protocol security (IPsec) in Windows 2000, Windows XP, and Windows Vista. A similar client program <a class="indexterm" id="idx-CHP-15-1654"/>for Windows 98, Windows Me, and Windows NT Workstation 4.0 is available for free download from <a class="ulink" href="http://download.microsoft.com/download/win98/Install/1.0/W9XNT4Me/EN-US/msl2tp.exe">http://download.microsoft.com/download/win98/Install/1.0/W9XNT4Me/EN-US/msl2tp.exe</a>.<a class="indexterm" id="idx-CHP-15-1655"/><a class="indexterm" id="idx-CHP-15-1656"/><a class="indexterm" id="idx-CHP-15-1657"/></p></div><div class="sect2" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="making_the_connection_in_windows"/>Making the Connection in Windows</h2></div></div></div><p>When the VPN connection profile is in place, it's easy to connect a Windows client to the host LAN or the Internet through the wireless VPN link: Just double-click the icon for the connection profile. Windows will ask for a login and password and then make the connection.<a class="indexterm" id="idx-CHP-15-1658"/></p><p>If your wireless connection is the method you use most often to connect to the Internet, you can make it the <a class="indexterm" id="idx-CHP-15-1659"/>default connection, which will open whenever you run a network application such as a web browser or email client program. To make the VPN profile the default, follow these steps:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Open the <span class="strong"><strong>Internet Properties</strong></span> window from the Control Panel.</p></li><li class="listitem"><p>Select the <span class="strong"><strong>Connections</strong></span> tab.</p></li><li class="listitem"><p>In the Dial-Up Settings section, select the VPN <a class="indexterm" id="idx-CHP-15-1660"/>connection profile from the list and click the <span class="strong"><strong>Set Default</strong></span> button.<a class="indexterm" id="idx-CHP-15-1661"/></p></li><li class="listitem"><p>Click the <span class="strong"><strong>Settings</strong></span> button. In the Dial-Up Settings section, type your login and password on the VPN server.</p></li><li class="listitem"><p>Choose the <span class="strong"><strong>Dial whenever a network connection is not present</strong></span> option.<a class="indexterm" id="idx-CHP-15-1662"/></p></li></ol></div></div><div class="sect2" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="windows_xp_options"/>Windows XP Options</h2></div></div></div><p>Windows XP and Windows Vista offer many <a class="indexterm" id="idx-CHP-15-1663"/>VPN options that were not available in earlier versions of Windows. To set these options, follow these steps:<a class="indexterm" id="idx-CHP-15-1664"/></p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Open the <span class="strong"><strong>Network Connections</strong></span> window from the Control Panel. If you have a shortcut to your VPN connection on the desktop, you can skip this step.</p></li><li class="listitem"><p>Double-click the VPN icon. A <a class="indexterm" id="idx-CHP-15-1665"/>Connect VPN to Internet window like the one in <a class="xref" href="ch15s03.html#use_the_connect_vpn_to_internet_window_t" title="Figure 15-10. Use the Connect VPN to Internet window to configure a VPN in Windows XP.">Figure 15-10</a> will appear.</p><div class="figure"><a id="use_the_connect_vpn_to_internet_window_t"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e17111"/><img alt="Use the Connect VPN to Internet window to configure a VPN in Windows XP." src="tagoreillycom20090210nostarchimages254893.png.jpg"/></div></div><p class="title"><b>Figure 15-10. Use the Connect VPN to Internet window to configure a VPN in Windows XP.</b></p></div><br class="figure-break"/></li><li class="listitem"><p>Click the <span class="strong"><strong>Properties</strong></span> button. The Properties window for your VPN <a class="indexterm" id="idx-CHP-15-1666"/>client will appear. <a class="xref" href="ch15s03.html#the_general_tab_controls_the_destination" title="Figure 15-11. The General tab controls the destination of a VPN connection.">Figure 15-11</a> shows the General tab of the VPN to Internet Properties window.<a class="indexterm" id="idx-CHP-15-1667"/></p><div class="figure"><a id="the_general_tab_controls_the_destination"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e17136"/><img alt="The General tab controls the destination of a VPN connection." src="tagoreillycom20090210nostarchimages254661.png.jpg"/></div></div><p class="title"><b>Figure 15-11. The General tab controls the destination of a VPN connection.</b></p></div><br class="figure-break"/></li><li class="listitem"><p>The IP address of the VPN server should already be visible in the Host Name or IP Address of Destination field. The <span class="strong"><strong>Dial another connection first</strong></span> option should be disabled. Click the <span class="strong"><strong>Networking</strong></span> tab to view the dialog box shown in <a class="xref" href="ch15s03.html#the_networking_tab_controls_the_vpns_net" title="Figure 15-12. The Networking tab controls the VPN's network configuration options.">Figure 15-12</a>.<a class="indexterm" id="idx-CHP-15-1668"/><a class="indexterm" id="idx-CHP-15-1669"/></p><div class="figure"><a id="the_networking_tab_controls_the_vpns_net"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e17165"/><img alt="The Networking tab controls the VPN's network configuration options." src="tagoreillycom20090210nostarchimages254728.png.jpg"/></div></div><p class="title"><b>Figure 15-12. The Networking tab controls the VPN's network configuration options.</b></p></div><br class="figure-break"/></li><li class="listitem"><p>Choose the type of <a class="indexterm" id="idx-CHP-15-1670"/>VPN server your network will use from the Type of VPN menu. If you don't know the VPN type, choose the Automatic option.<a class="indexterm" id="idx-CHP-15-1671"/></p></li><li class="listitem"><p>Select Internet Protocol (TCP/IP) or Internet Protocol Version 4 from the list of connection items, and click the <span class="strong"><strong>Properties</strong></span> button to change the network settings, including the use of a DHCP server or manual settings <a class="indexterm" id="idx-CHP-15-1672"/>for IP address and DNS.</p></li><li class="listitem"><p>Click the <span class="strong"><strong>Advanced</strong></span> tab to open the dialog box shown in <a class="xref" href="ch15s03.html#the_advanced_tab_controls_the_use_of_a_f" title="Figure 15-13. The Advanced tab controls the use of a firewall on the VPN.">Figure 15-13</a>. If your network is not already protected by a firewall, select the Internet connection firewall option. This will protect the wireless <a class="indexterm" id="idx-CHP-15-1673"/>client from attacks coming through the Internet.<a class="indexterm" id="idx-CHP-15-1674"/></p><div class="figure"><a id="the_advanced_tab_controls_the_use_of_a_f"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e17220"/><img alt="The Advanced tab controls the use of a firewall on the VPN." src="tagoreillycom20090210nostarchimages254720.png.jpg"/></div></div><p class="title"><b>Figure 15-13. The Advanced tab controls the use of a firewall on the VPN.</b></p></div><br class="figure-break"/></li></ol></div><p>The Options and Security tabs in the VPN to Internet Properties window control connection options that normally don't change from the default settings. Network managers who want to change the security settings should instruct their users how to configure these options to comply with the network's specific requirements.<a class="indexterm" id="idx-CHP-15-1675"/></p></div><div class="sect2" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="vpn_clients_for_unix"/>VPN Clients for Unix</h2></div></div></div><p>Using a VPN client on a computer running Unix is more complicated than running a VPN from a <a class="indexterm" id="idx-CHP-15-1676"/>Windows machine because the client is not integrated into the kernel. Therefore, you must find a client program that works with the version of Unix <span class="emphasis"><em>and</em></span> the VPN protocol you are trying to use. No single program offers a universal VPN client, and some combinations, such as PPTP on BSD Unix versions, don't seem to exist at all.<a class="indexterm" id="idx-CHP-15-1677"/><a class="indexterm" id="I_indexterm15_d1e17251"/><a class="indexterm" id="I_indexterm15_d1e17256"/></p><div class="sect3" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="ipsec_clients"/>IPsec Clients</h3></div></div></div><p>Linux users can choose from several IPsec implementations:<a class="indexterm" id="idx-CHP-15-1678"/></p><table border="0" class="simplelist" summary="Simple list"><tr><td><span class="strong"><strong>FreeS/WAN</strong></span> <a class="ulink" href="http://www.freeswan.org">http://www.freeswan.org</a></td></tr><tr><td><span class="strong"><strong>pipsec</strong></span> <a class="ulink" href="http://perso.enst.fr/~beyssac/pipsec">http://perso.enst.fr/~beyssac/pipsec</a></td></tr><tr><td><span class="strong"><strong>NIST Cerberus</strong></span> <a class="ulink" href="http://w3.antd.nist.gov/tools/cerberus">http://w3.antd.nist.gov/tools/cerberus</a></td></tr></table><p>IPsec is included in the OpenBSD distribution. You can find a tutorial that explains how to use it at <a class="ulink" href="http://www2.papamike.ca:8082/tutorials/pub/obsd_ipsec.html">http://www2.papamike.ca:8082/tutorials/pub/obsd_ipsec.html</a>.<a class="indexterm" id="idx-CHP-15-1679"/><a class="indexterm" id="idx-CHP-15-1680"/><a class="indexterm" id="idx-CHP-15-1681"/></p><p>The IPsec implementation <a class="indexterm" id="idx-CHP-15-1682"/>for FreeBSD is at <a class="ulink" href="http://www.r4k.net/ipsec">http://www.r4k.net/ipsec</a>.</p><p>For information about NetBSD IPsec, take a look at <a class="ulink" href="http://www.netbsd.org/Documentation/network/ipsec">http://www.netbsd.org/Documentation/network/ipsec</a>.</p></div></div></div>
<div class="sect1" xml:lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="using_a_wireless_vpn"/>Using a Wireless VPN</h1></div></div></div><p>When you design a VPN to protect the data on your network as it passes through the wireless link, it's important to understand exactly where the end points of the VPN tunnel are located. If the VPN only tunnels through the wireless link, as shown in <a class="xref" href="ch15s04.html#a_wireless_vpn_with_the_server_at_the_ac" title="Figure 15-14. A wireless VPN with the server at the access point protects data through the wireless link, but it does not extend the network.">Figure 15-14</a>, the network will look exactly the same as it does <a class="indexterm" id="idx-CHP-15-1683"/>without a VPN.<a class="indexterm" id="idx-CHP-15-1684"/></p><div class="figure"><a id="a_wireless_vpn_with_the_server_at_the_ac"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e17337"/><img alt="A wireless VPN with the server at the access point protects data through the wireless link, but it does not extend the network." src="tagoreillycom20090210nostarchimages254824.png.jpg"/></div></div><p class="title"><b>Figure 15-14. A wireless VPN with the server at the access point protects data through the wireless link, but it does not extend the network.</b></p></div><br class="figure-break"/><p>If the VPN extends beyond the wireless access points to pass through a wide area network (such as the Internet), like the one in <a class="xref" href="ch15s04.html#a_vpn_can_include_both_the_wireless_link" title="Figure 15-15. A VPN can include both the wireless link and an intercity connection through the Internet to a corporate network.">Figure 15-15</a>, the <a class="indexterm" id="idx-CHP-15-1685"/>wireless network client can appear to be part of a LAN in another building or halfway across the continent.<a class="indexterm" id="I_indexterm15_d1e17352"/></p><p>So how far should your wireless VPN extend? It depends on what you want the network to accomplish. If your wireless network is in place to support laptop and other portable computers at your office, factory, or campus, it makes sense to place the server between the network of access points and the connection to your corporate LAN. This will protect your <a class="indexterm" id="idx-CHP-15-1686"/>wireless users' data and keep unauthorized users off the network, but it won't affect the other users whose computers connect to the LAN through cables.</p><div class="figure"><a id="a_vpn_can_include_both_the_wireless_link"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e17368"/><img alt="A VPN can include both the wireless link and an intercity connection through the Internet to a corporate network." src="tagoreillycom20090210nostarchimages254923.png.jpg"/></div></div><p class="title"><b>Figure 15-15. A VPN can include both the wireless link and an intercity connection through the Internet to a corporate network.</b></p></div><br class="figure-break"/><p>At home or in a small business network, the access points probably connect to an Internet gateway router that provides Internet access to all the computers in the office or the house. If the access point and the gateway are separate devices, you can place the VPN server between the two. If the access point and gateway are combined in the same box, you'll either have to use VPN clients on all your computers, including the desktop machines that are hardwired to the gateway, and place the client between the gateway and the Internet modem like the network in <a class="xref" href="ch15s04.html#in_a_small_lan_you_can_use_vpn_clients_o" title="Figure 15-16. In a small LAN, you can use VPN clients on every computer.">Figure 15-16</a>, or you'll have to ignore the wired Ethernet ports on the gateway and add a new hub or switch between the VPN server and the Internet modem, as shown in <a class="xref" href="ch15s04.html#in_this_network_the_vpn_only_protects_th" title="Figure 15-17. In this network, the VPN only protects the wireless links.">Figure 15-17</a>.</p><div class="figure"><a id="in_a_small_lan_you_can_use_vpn_clients_o"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e17382"/><img alt="In a small LAN, you can use VPN clients on every computer." src="tagoreillycom20090210nostarchimages254326.png.jpg"/></div></div><p class="title"><b>Figure 15-16. In a small LAN, you can use VPN clients on every computer.</b></p></div><br class="figure-break"/><div class="figure"><a id="in_this_network_the_vpn_only_protects_th"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e17390"/><img alt="In this network, the VPN only protects the wireless links." src="tagoreillycom20090210nostarchimages254656.png.jpg"/></div></div><p class="title"><b>Figure 15-17. In this network, the VPN only protects the wireless links.</b></p></div><br class="figure-break"/><div class="sect2" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="making_the_connection"/>Making the Connection</h2></div></div></div><p>If you use the wireless LAN <a class="indexterm" id="idx-CHP-15-1687"/>with VPN protection most of the time, you should make the VPN profile your <a class="indexterm" id="idx-CHP-15-1688"/>default connection. Whenever you run a network application, the computer will try to connect through the VPN unless you open a different connection (such as a dial-up telephone line) first.<a class="indexterm" id="idx-CHP-15-1689"/></p><p>To set a connection profile as the default in Windows, open the <span class="strong"><strong>Network Connections</strong></span> window. Right-click the icon for the profile you want to choose, and select the <span class="strong"><strong>Set as default</strong></span> option from the menu.</p><p>To connect to a VPN that isn't your default, double-click the icon for the VPN's connection profile. You will see a login window like the one in <a class="xref" href="ch15s04.html#a_vpn_connection_normally_requires_a_log" title="Figure 15-18. A VPN connection normally requires a login name and password.">Figure 15-18</a>. Type your name and password, and click the <span class="strong"><strong>Connect</strong></span> button. If the VPN server recognizes your account, it will set up the connection.</p><div class="figure"><a id="a_vpn_connection_normally_requires_a_log"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject15_d1e17433"/><img alt="A VPN connection normally requires a login name and password." src="tagoreillycom20090210nostarchimages254147.png.jpg"/></div></div><p class="title"><b>Figure 15-18. A VPN connection normally requires a login name and password.</b></p></div><br class="figure-break"/></div><div class="sect2" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="bypassing_the_vpn"/>Bypassing the VPN</h2></div></div></div><p>Even though you normally use a VPN to protect your wireless data, you might sometimes want to send data in the clear <a class="indexterm" id="idx-CHP-15-1690"/>without using the VPN. For example, you might use a local VPN at your own office or at home between your computer and your Internet gateway router, but when you use the same computer at an airport or a coffee shop, or some other location that isn't protected by a VPN, you can use the same computer and network adapter to connect directly to the Internet.<a class="indexterm" id="idx-CHP-15-1691"/></p><p>If you're a network manager, you might occasionally have to change your Wi-Fi network's internal settings. The configuration programs that control the Wi-Fi network's operating channel, SSID, and other options are web-based utilities that originate on the access point. Because the access point is inside the VPN tunnel, it is not possible to send commands to the access point <a class="indexterm" id="idx-CHP-15-1692"/>through the VPN. It's important to remember that you can use a VPN when you need it and bypass it when you want to make a direct connection.</p></div><div class="sect2" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="using_a_vpn_through_a_public_network"/>Using a VPN Through a Public Network</h2></div></div></div><p>When you connect your laptop to your corporate LAN through a public network at an airport or in a conference center, or if you're using a broadband wireless service, you can connect through their network to the Internet and onward to your corporate VPN server. Because you will have to log in to the public network before you initiate the VPN connection, you should create a separate <span class="emphasis"><em>VPN via Public Network</em></span> connection profile in addition to the one you use from your own office. The profile should point to your corporate VPN server, but it should not be your default connection.<a class="indexterm" id="idx-CHP-15-1693"/></p><p>To connect through a public network on a computer running Windows, follow these steps:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Turn on the computer with the <a class="indexterm" id="idx-CHP-15-1694"/>wireless network adapter in place.</p></li><li class="listitem"><p>Use your wireless configuration utility to select the public network you want to use.</p></li><li class="listitem"><p>Start Internet Explorer, Netscape Navigator, or some other web browser. You will see the public network's login screen.</p></li><li class="listitem"><p>If the computer doesn't do it automatically, enter your account name and password. The public network will acknowledge your login.</p></li><li class="listitem"><p>Minimize the browser window and open the <span class="strong"><strong>Network Connections</strong></span> window or find the VPN shortcut on your desktop.</p></li><li class="listitem"><p>Double-click the icon for your VPN via Public Network profile. The computer will connect through the Internet to your corporate LAN.</p></li><li class="listitem"><p>Enter the login and password for your corporate network.</p></li></ol></div><p>If this procedure doesn't work for your VPN, ask your network manager for help.</p><p>VPNs are an important part of many networks' security plans for off-site users. When a VPN is up and running, it's also an extremely convenient way to connect to your LAN. With just a few keystrokes or mouse clicks, you can establish the same access to your network resources from anywhere with Internet access that you can get from your own office. If any Internet technique can eliminate the apparent distance between you and your LAN, your office, and your colleagues, a VPN is that technique.</p></div></div></body></html>