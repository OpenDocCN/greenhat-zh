<html><head></head><body>
  <h1><span class="chapter">Appendix E -</span><br/>
  Debugging: Hints and Tips</h1>

  <h2 id="sigil_toc_id_154"><b class="calibre3">Don’t Panic!</b></h2>

  <p>Developing your debugging skills is as important, if not more important, <span style="font-size: 1em;">than developing your design skills. The most important single piece of</span> <span style="font-size: 1em;">advice is to never panic: randomly tweaking and changing things will</span> <span style="font-size: 1em;">introduce more uncertainty and bugs than it will fix.</span></p>

  <p>Debugging is simple when given total visibility into a system and total <span style="font-size: 1em;">knowledge of the expected state of a properly working system. Simply</span> <span style="font-size: 1em;">comparing the observed state against the expected state wil elucidate what went wrong. Unfortunately, the world rarely works this way. Chips are black boxes, and the only visibility into the internal state of the chip is through its pins. Many signals are also too difficult to directly measure or record. Also, the specifications provided by manufacturers are often vague or difficult to interpret. Thus, the real art of debugging is in tracing a set of symptoms to a root cause despite a lack of visibility and total system knowledge.</span></p>

  <h3 id="sigil_toc_id_155"><b class="calibre3">Understand the System</b></h3>

  <p>Trying to debug a system without first understanding what you are trying to debug is like trying to read a Japanese comic without any knowledge of <span style="font-size: 1em;">Japanese. You can figure out at a superficial level who is the bad guy and</span> <span style="font-size: 1em;">who is the good guy, but you get really lost as to exactly what the floating cat has to do with all of it. In order to fully understand the plot, you need a Japanese dictionary and a lot of time and patience. Similarly, basic electronics principles and intuition will get you to the point where you know roughly</span> <span style="font-size: 1em;">what to expect, but enlightenment only comes after you have read the</span> <span style="font-size: 1em;">component data sheets. The more you understand about a system, the</span> <span style="font-size: 1em;">easier it wil be to figure out why things went wrong. Keep notes as you read more about the system, and think to yourself about ways problems might</span> <span style="font-size: 1em;">express themselves if something did go wrong. It also helps to have seen</span> <span style="font-size: 1em;">other systems that are similar to the one you are trying to fix, and it helps to have an understanding of the theory of operation.</span></p>

  <h3 id="sigil_toc_id_156"><b class="calibre3">Observe Symptoms</b></h3>

  <p>Bugs manifest themselves through symptoms, and it is up to you to <span style="font-size: 1em;">deduce the root cause by observing several symptoms and deducing the</span> <span style="font-size: 1em;">culprit. A blank screen on a TV that should be showing the video output of</span> <span style="font-size: 1em;">your console is an example of a symptom. There are many reasons why</span> <span style="font-size: 1em;">your TV screen could be blank, such as a broken video cable, a broken TV, a broken video connector, a broken video source, blank media in the video</span> <span style="font-size: 1em;">source, or even lack of power to the system. As a general rule, you should</span> <span style="font-size: 1em;">observe at least two, preferably three, symptoms that are consistent with a cause before concluding that you have found the root cause. Keep in mind</span> <span style="font-size: 1em;">that the most telling symptoms are often not outwardly obvious, and will</span> <span style="font-size: 1em;">require a measurement or an experiment to find them. In the example of</span> <span style="font-size: 1em;">our blank TV screen, our measurements are as simple as seeing if the power</span> <span style="font-size: 1em;">light on the TV turns on, or if sound comes out of the TV without the</span> <span style="font-size: 1em;">video.</span></p>

  <p>The basic strategy for debugging is to start with an obvious symptom and <span style="font-size: 1em;">isolate various parts of the system to determine which part is the immediate cause of the symptom. An immediate cause is defined as something that</span> <span style="font-size: 1em;">directly impacts the observed symptom. Immediate causes for video failure</span> <span style="font-size: 1em;">on a TV are lack of a signal to the TV, a broken TV, or lack of power; non-immediate causes would be a hardware failure in your video source or the</span> <span style="font-size: 1em;">phase of the moon. In other words, given symptom A, think of all the</span> <span style="font-size: 1em;">possible immediate causes X, Y, and Z, and then test each to determine</span> <span style="font-size: 1em;">which is the actual cause. Once you have isolated the problem, think about</span> <span style="font-size: 1em;">what might have caused it to fail and repeat the process until you have</span> <span style="font-size: 1em;">discovered the</span> <i class="calibre4" style="font-size: 1em;">root cause</i><span style="font-size: 1em;">.</span></p>

  <p>Isolating the cause of bugs can be facilitated by the use of known good <span style="font-size: 1em;">references. In our example, you can eliminate the TV as a source of failure by feeding it a signal from a known good DVD player. In order for a known</span> <span style="font-size: 1em;">good reference experiment to be valid, you must keep everything constant</span> <span style="font-size: 1em;">except for the piece you are replacing with the reference. Plugging the good DVD player into a different input from the consoles’ on the TV will only</span> <span style="font-size: 1em;">tell us that the display part of the TV works. The path from the console</span> <span style="font-size: 1em;">input to the TV is not tested. A proper execution of the experiment would</span> <span style="font-size: 1em;">plug the DVD player into the video input used by the console.</span></p>

  <p><span style="font-size: 1em;">This kind of paranoia or inherent mistrust of the system becomes very</span> <span style="font-size: 1em;">important when tracing down subtle hardware bugs. Do not take any</span> <span style="font-size: 1em;">factor for granted that could affect the system you are observing, and n</span><span style="font-size: 1em;">ever, ever ignore an inexplicable or inconsistent behavior, even if it is</span> <span style="font-size: 1em;">intermittent. For example, sometimes a system will work properly or</span> <span style="font-size: 1em;">break if you touch a certain location on the circuit board or wave your</span> <span style="font-size: 1em;">hand near a certain area; sometimes a system will demonstrate different</span> <span style="font-size: 1em;">behavior for a brief moment after power-on. It is tempting to write off</span> <span style="font-size: 1em;">such observations as anomalies or trivial occurrences, but the fact is that they did happen and there must be an explanation. One specific example</span> <span style="font-size: 1em;">is touching a circuit board and observing a change in the state of the</span> <span style="font-size: 1em;">system. Where did you touch? How did you touch it? Are your hands</span> <span style="font-size: 1em;">sweaty or dry? When you touch a circuit board, your body acts like a</span> <span style="font-size: 1em;">small capacitance and a large resistance. This can slightly slow down</span> <span style="font-size: 1em;">signals or discharge high-impedance nodes such as an unconnected digital</span> <span style="font-size: 1em;">input. If you pressed firmly on the board, you could be flexing the board</span> <span style="font-size: 1em;">in such a way that changes the electrical properties of a cracked trace or a bad solder joint.</span></p>

  <p><span style="font-size: 1em;">There are some symptoms that are often times incorrectly interpreted as</span> <span style="font-size: 1em;">causes. A burned-out trace or a damaged component is usually a symptom</span> <span style="font-size: 1em;">and not a cause of the problem. In other words, a malfunction elsewhere in</span> <span style="font-size: 1em;">the circuit is usually responsible for the failure of a component. Spontaneous component failure is a relatively rare occurrence. Suppose you are</span> <span style="font-size: 1em;">debugging a broken stereo. You smell something burning coming from the</span> <span style="font-size: 1em;">stereo, and you see a large resistor that is blackened from overheating.</span> <span style="font-size: 1em;">Chances are that if you just replace that resistor, the replacement will just burn out again. The real cause might be a shorted transistor or a damaged</span> <span style="font-size: 1em;">power supply circuit, but these do not manifest themselves as obviously as</span> <span style="font-size: 1em;">the burned out resistor.</span></p>

  <p>Another potent observation technique is comparison against a known good <span style="font-size: 1em;">system. If you are trying to debug a broken device, find a working one and</span> <span style="font-size: 1em;">compare voltages and other operational characteristics between the two. If</span> <span style="font-size: 1em;">you are trying to debug your own home-brew system, construct a simula</span><span style="font-size: 1em;">tion of the circuit if possible, or find a circuit with a similar design. You can use these known good systems to quickly isolate anomalous behavior.</span> <span style="font-size: 1em;">Furthermore, you can induce failures in the known good sample in a</span> <span style="font-size: 1em;">controlled fashion to check if you have really found the root cause of the</span> <span style="font-size: 1em;">problem. This technique is particularly applicable to simulated systems.</span></p>

  <h2 id="sigil_toc_id_157"><b class="calibre3">Common Bugs</b></h2>

  <p>The most common source of hardware bugs in home-brew projects are <span style="font-size: 1em;">poor solder joints and improperly installed polarized components, such as</span> <span style="font-size: 1em;">capacitors, diodes, ICs, and connectors. Also, connectors are particularly</span> <span style="font-size: 1em;">notorious sources of failures because they are subjected to the most</span> <span style="font-size: 1em;">physical abuse and it is typically difficult to determine if a connector is in good condition through visual inspection alone. The following is a list of common bugs, ranked loosely in descending order of popularity.</span></p>

  <ol>
    <li><b>Bad solder joint.</b> This includes cold solder joints, bridges, and forgotten joints. Careful visual inspection can catch many instances of bad joints. The solder between all joints should appear to be smooth and shiny, and the solder should exhibit a wet-looking meniscus over circuit board pads and component leads. Pictures of good and bad solder joints can be found in Appendix B: Soldering Techniques. Poor solder joints can also be quickly identified on many surface mount packages by gently dragging a stiff wire, such as the tip of a tweezer or a paperclip, over the pins along the length of the package. Poorly connected pins will bend slightly. Flexing the board can also help reveal poor solder joints. In other cases, you may have to use an ohmmeter to verify the quality of a solder joint. (If you had a messy experience soldering your components, clean the board with a mild solvent such as Isopropyl Alcohol using a cotton swab before inspection.) Finally, remember that seeing is believing: use a magnifying lens to help your inspections. A medium-power microscope is preferred, but any mounted magnifying lens (like those found on drafter’s lamps) or a ring loupe like the kind used by jewelers will help enormously.</li>

    <li><b>Improper component values.</b> An improper component value can happen when a similar looking but different valued component is accidentally mounted on the circuit board. This is especially problematic with surface mount passives, which are often unlabeled or obscurely labeled. Keep in mind that the only way to properly test a component’s value is to remove it from the board and then test it. Populating boards with wrong components can be avoided by being very careful and methodical about storing your components in clearly labeled bags or boxes during assembly.</li>

    <li><b>Bad connectors.</b> This includes connectors that have been installed backwards, or worse yet, designed with the wrong pin assignments. Pay attention to where pin 1 is, and the numbering system used by the connector. Some connectors use a zig-zag pin numbering system, while others use a circular pin numbering system. Wire-to-board connectors are also difficult to build by hand. Inspect all points where wires interface with connector contacts for poor crimps, excess insulation, or bad solder joints. In the worst case, use a voltmeter to verify the continuity of the connector.</li>

    <li><b>Configuration oversights as a result of not reading the data sheet.</b> Complex chips frequently support multiple operating modes that are selected by strapping a set of pins to high or low logic levels. Chips also frequently require external resistors to load or bias a pin for proper operation. Sometimes networks of capacitors, resistors and inductors are required by chips as well to stabilize internal functions. Keep in mind that unused inputs often require termination to a fixed voltage for proper operation, so do not ignore parts of a data sheet just because you do not use certain functions.</li>

    <li><b>Design problem or implementation problem.</b> Sometimes the bug is caused by an outright design error, or by a translation problem between a correct schematic and the board layout. Translation problems are frequently caused by typos when specifying the names of schematic nets, or by implicit power names on schematic symbols. Implicit power names are frequently used on digital components as a matter of convenience, but can cause significant problems in designs that use multiple power supply voltages. These kinds of problems can be caught before going to layout with a heuristic netlist checking program, as described in Appendix C. High speed design rule violations represent another kind of implementation problem. Circuits that operate at high frequencies (25+ MHz) or have fast edge rates (&lt; 5 ns) require special attention to electrical impedance and transmission line termination.</li>

    <li><b>Power supply is out of specification.</b> Test power supply voltages as close to the point of use as possible, as wires can reduce the actual delivered voltage. In some cases, there is nothing wrong with the circuit and the power supply is just incapable of providing enough juice to run your design. Also check for variations of the power supply voltage with time. Excess noise on a power supply can cause problems, and systems that use large amounts of high speed CMOS logic can have very demanding shifts in current consumption that can lead to short dips and spikes in the power supply voltage.</li>

    <li><b>Broken or damaged PC board traces.</b> This can be a problem if you hand-assembled a board and you were having troubles attaching a component. Excess heat during assembly can cause traces to lift off of the circuit board. Also, know your board vendor. Some board vendors (especially quick-turn discount prototype vendors) will not perform a full netlist electrical test of your circuit board. Look for over-etched traces that have thinned out of tolerance, and also check that every via hole has a silvery annulus around the hole. Sometimes the drill bits are misaligned or angled during board drilling, and the mis-drilled hole will end up breaking electrical connections.</li>

    <li><b>Latch-up or power-sequencing problem.</b> Latch-up is a potentially disastrous phenomenon where a parasitic short is created between power and ground within a chip’s substrate. Latch-up is triggered by injecting current into the substrate. This can happen in mixed-voltage systems where input voltages are applied that are higher than a chip’s power supply voltage. In many cases, latch-up is accompanied by chip overheating that can lead to permanent chip damage. A recommended practice when powering up a system for the first time is to use an ammeter to monitor how much current the system is drawing, and touch all the components to see if any are getting excessively hot. If a component has gone into latch-up, you will typically observe excess current consumption on the order of hundreds of milliamps.</li>

    <li><b>Thermal problem.</b> This is a problem primarily with linear voltage regulators and high power digital circuitry. Verify that all high power components are properly heat sinked, and that the heat sinks are properly isolated when they contact an electrically active part of the chip package.</li>

    <li><b>Unintentional short to bare copper.</b> This is a problem with connectors and chips that have exposed regions of metal on their undersides that can short across exposed regions of the board, such as vias. This is also a problem around areas where screws are used to hold a board in place. The head of a metal screw can inadvertently come in contact with a via that has been placed too close to the screw hole.</li>

    <li><b>Contamination of the board.</b> This problem is caused by solder flux residue or other process residue on the board causing low-current leakage paths. Some flux residues have a non-negligible (less than one mega-ohm) resistance and this can cause problems with high-impedance circuits, such as slow time constant R-C networks.</li>

    <li><b>Faulty test equipment.</b> This is especially a problem if you use second-hand or old test equipment. Test probes develop kinks and calibration faults over time, so sometimes the crummy signal you are seeing on the oscilloscope is actually a result of a bad test probe or a poor choice of probe ground. Calibrate your test equipment to a known good signal to eliminate test equipment problems.</li>

    <li>The least likely problem is a <b>bad chip or a faulty component.</b> Component manufacturers go to great lengths to ensure that the parts shipped to you are functional. Typical failure rates are measured in the single-digit parts per million for simple to moderately complex parts. Frequently, we like to imagine that the cause of our problem is a bad chip from the manufacturer, but that is almost never the case. Usually, if a bad part is found, the part was damaged either by a processing problem (rough handling or assembly issues) or a design problem elsewhere in the circuit that induces the observed failure.</li>
  </ol>

  <h2 id="sigil_toc_id_158"><b class="calibre3">Recovering from a Lifted Trace or Pad</b></h2>

  <p>The lifting or tearing of the copper traces on a circuit board is a common <span style="font-size: 1em;">problem encountered by people trying to install after-market modifications</span> <span style="font-size: 1em;">using flying wires. This delamination of the copper foil traces is usually</span> <span style="font-size: 1em;">caused by excessive heat from the soldering iron. Another common cause is</span> <span style="font-size: 1em;">pulling on the attached modification wire, as one might do while stripping</span> <span style="font-size: 1em;">the insulation off the end of a wire, after it has been soldered to the</span> <span style="font-size: 1em;">circuit board. Fortunately, it is usually fairly easy to recover from this</span> <span style="font-size: 1em;">problem.</span></p>

  <div class="note">
    <h3 class="sigil_not_in_toc">Tip</h3>

    <p><img alt="" class="note" src="../Images/index-271_1.png" style="height: auto; width: auto;"/></p>

    <p><b class="calibre3">The best solution is prevention. Do not use an over-pow</b><b class="calibre3" style="font-size: 1em;">ered soldering iron for working on circuit boards. A tem</b><b class="calibre3" style="font-size: 1em;">perature-controlled iron is preferred, but an inexpensive</b> <b class="calibre3" style="font-size: 1em;">low-wattage (15 watts) iron will also work. Also, if the sol</b><b class="calibre3" style="font-size: 1em;">der does not seem to be sticking to the board, stop apply</b><b class="calibre3" style="font-size: 1em;">ing heat. Instead, put a touch of flux on the board and the</b> <b class="calibre3" style="font-size: 1em;">wire, and clean the soldering iron tip with tip conditioner</b> <b class="calibre3" style="font-size: 1em;">or a sponge dampened with distilled water (tap water con</b><b class="calibre3" style="font-size: 1em;">tains chemicals that can degrade soldering iron tips). This</b> <b class="calibre3" style="font-size: 1em;">will enhance solderability so you do not need to apply as</b> <b class="calibre3" style="font-size: 1em;">much heat or force to make the connection.</b></p>
  </div>

  <p class="after-note">The first thing to do when you see a trace or pad lifting off of the circuit board is to STOP! Do not aggravate the problem further; the worst thing <span style="font-size: 1em;">you can do is cause the entire trace to peel back by continuing to pull on</span> the wire. Remove the wire, if it is still connected, by barely touching the soldering iron to the joint and letting the wire fall off. Figure E-1 <span style="font-size: 1em;">illustrates such a disaster scene.</span></p>

  <p style="font-size: medium;"><img alt="" class="calibre2" src="../Images/index-271_2.png" style="font-size: 1em;"/><br/></p>

  <p class="caption"><b class="calibre3" style="font-size: 1em;">Figure E-1</b><span style="font-size: 1em;">: Left, arrow points to the original pad that is being soldered. Right, pad has been torn off through excess heat and force.</span><br/></p>

  <p><span style="font-size: 1em;">The strategy for recovering from a broken trace is to remove the soldermask, fix the trace with a jumper wire, and find an alternate point for soldering by following the trace to a nearby component or via.</span><br/></p>

  <p>Removing the soldermask reveals the underlying copper traces. A short <span style="font-size: 1em;">jumper wire can be soldered to these bared traces to fix the discontinuity</span> <span style="font-size: 1em;">caused by the torn trace. The bare region also serves as a convenient starting point for using a continuity meter to find an alternate point for affixing the jumper wire. Remove the soldermask using either a fine-grit (200 or finer) sandpaper, or by scraping the surface with a sharp hobbyists knife. When</span> <span style="font-size: 1em;">removing the soldermask, be careful not to catch pieces of the broken trace and further tear the trace of the board. Once the soldermask has been</span> <span style="font-size: 1em;">removed, clean the region with a gentle solvent, such as rubbing alcohol,</span> <span style="font-size: 1em;">using a cotton swab. Then, apply a very thin layer of soldering flux to the region and rub a clean soldering iron tip along the exposed traces. Small</span> <span style="font-size: 1em;">amounts of solder sticking to the iron’s tip will wick onto the circuitboard and coat the traces, preventing oxidation of the bare copper. If the iron’s tip is too clean, apply a drop of solder to it and lightly wipe the tip off on a wet sponge and try again. Do not attempt to tin the exposed traces with a ball of molten solder on the tip. Excess solder will be deposited that can lead to</span> <span style="font-size: 1em;">shorts. (Note that the soldering flux is essential for getting a uniform, thin coating of solder on the traces. Do not skip the application of the solder flux.) Figure E-2 illustrates what the traces will look like before and after the tinning process.</span></p>

  <p><img alt="" class="calibre2" src="../Images/index-272_1.png" style="height: auto; width: auto;"/></p>

  <p class="caption"><b class="calibre3">Figure E-2</b>: Left, region after soldermask has been removed with fine-grit sandpaper. Right, region after it has been tinned (reconditioned for soldering).</p>

  <p><span style="font-size: 1em;">At this point, you may want to use a continuity meter to determine an</span> <span style="font-size: 1em;">alternate point for attaching your modification wire. Most voltmeters come</span> <span style="font-size: 1em;">with an audible continuity meter function. When selected, a tone is emitted from the voltmeter whenever the resistance between the probes is very low.</span><br/></p>

  <p><span style="font-size: 1em;">Vias and component leads both make good alternate attachment points.</span> <span style="font-size: 1em;">If you decide to use a via, you must scrape the solder mask off and</span> <span style="font-size: 1em;">condition the via prior to attaching the modification wire. Figure E-3</span> <span style="font-size: 1em;">illustrates using a continuity meter to find an alternate soldering point. K</span><span style="font-size: 1em;">eep in mind that sometimes you will have to trace through several vias</span> <span style="font-size: 1em;">to find the best alternate attachment point.</span></p>

  <p style="font-size: medium;"><img alt="" class="calibre2" src="../Images/index-272_2.png"/></p>

  <p class="caption" style="font-size: medium;"><b class="calibre3">Figure E-3</b>: Using a continuity meter to find an alternate attachment point. In this case, R7R10 turns out to be a good alternate.</p>

  <p>The next step is to attach a short jumper wire across the broken trace. Apply a touch more soldering flux over the region of the broken trace. Cut a piece of fine wire (about 30-gauge) that is about the length of the gap in question. Place the wire over the gap, using the stickiness of the soldering flux to aid the placement process. Hold the wire in place with a pair of <span style="font-size: 1em;">tweezers, and apply heat with the soldering iron until both sides have</span> <span style="font-size: 1em;">bonded to the edges of the broken trace. Verify that the wire is in place by gently pushing on it with the tweezers; the wire should not move. Also</span> <span style="font-size: 1em;">inspect for shorts to neighboring traces using your continuity meter. If a</span> <span style="font-size: 1em;">short is discovered, simply heat the jumper until it falls off the board and try again. Figure E-4 illustrates what the repaired trace looks like.</span></p>

  <p>Finally, attach the modification wire to the alternate soldering point that was discovered previously using the continuity meter.</p>

  <p><img alt="" class="calibre2" src="../Images/index-273_1.png"/><br/></p>

  <p class="caption"><b class="calibre3">Figure E-4</b>: Left, a jumper has been installed over the damaged trace. Right, the modification wire has been successfully attached to the alternate soldering point.</p>
</body></html>