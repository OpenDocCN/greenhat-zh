<html><head></head><body><div class="chapter" title="Chapter&#xA0;7.&#xA0;FLOWVIEWER"><div class="titlepage"><div><div><h1 class="title"><a id="flowviewer"/>Chapter 7. FLOWVIEWER</h1></div></div></div><div class="informalfigure"><div class="mediaobject"><a id="I_mediaobject7_d1e12122"/><img alt="image with no caption" src="httpatomoreillycomsourcenostarchimages651574.png.jpg"/></div></div><p>Almost everybody likes pretty pictures of network traffic. FlowScan and CUFlow graph common, expected traffic types in a user-friendly manner. Your network is anything but common or expected, however. In addition to CUFlow, you'll also need a more customizable analysis tool, whether because you need a one-time report, insight into traffic that you never expected to see, or a close-up view of last year's traffic. As you'll learn in this chapter, the FlowViewer suite (<a class="ulink" href="http://ensight.eos.nasa.gov/FlowViewer/">http://ensight.eos.nasa.gov/FlowViewer/</a>) is one such customizable tool that can quickly create and access web-based reports.<a class="indexterm" id="IDX-CHP-7-0001"/><a class="indexterm" id="IDX-CHP-7-0002"/><a class="indexterm" id="IDX-CHP-7-0003"/></p><p>FlowViewer includes three separate components: FlowViewer, FlowTracker, and FlowGrapher. <span class="emphasis"><em>FlowViewer</em></span> is a web interface for <code class="literal">flow-print</code> and <code class="literal">flow-nfilter</code> that, once you've defined filters in a web form, will print out the matching flows. <span class="emphasis"><em>FlowGrapher</em></span> lets you graph subsets of data on an ad hoc basis. <span class="emphasis"><em>FlowTracker</em></span> is a simple way to build and view RRDs, much like CUFlow, but it lets you filter graphed traffic very specifically. If you want to continuously track HTTPS and telnet traffic to and from your enterprise resource planning (ERP) system, FlowTracker is your friend. As a whole, these three tools offer a great deal of visibility into the network.<a class="indexterm" id="IDX-CHP-7-0004"/><a class="indexterm" id="IDX-CHP-7-0005"/><a class="indexterm" id="IDX-CHP-7-0006"/><a class="indexterm" id="IDX-CHP-7-0007"/><a class="indexterm" id="IDX-CHP-7-0008"/><a class="indexterm" id="IDX-CHP-7-0009"/><a class="indexterm" id="IDX-CHP-7-0010"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p>FlowViewer has an extensive manual that includes more detail than I've been able to fit into one chapter. See the FlowViewer manual for more in-depth information.<a class="indexterm" id="IDX-CHP-7-0011"/><a class="indexterm" id="IDX-CHP-7-0012"/></p></div><div class="sect1" title="FlowTracker and FlowGrapher vs. CUFlow"><div class="titlepage"><div><div><h1 class="title"><a id="flowtracker_and_flowgrapher_vs._cuflow"/>FlowTracker and FlowGrapher vs. CUFlow</h1></div></div></div><p>If FlowTracker, FlowGrapher, and CUFlow have similar functions, why not use only one or the other? Primarily for reasons of ease of use.</p><p>CUFlow is easily understood. You can give your customers access to a CUFlow graph, and with minimal explanation they can interpret the results fairly accurately. Your most feeble-brained co-worker can understand CUFlow output. But at the same time, this ease of understanding costs you flexibility. The user gets only the features and reports configured by the network administrator, and older reports suffer from RRD database compression, as discussed in <a class="xref" href="ch06.html" title="Chapter 6. PERL, FLOWSCAN, AND CFLOW.PM">Chapter 6</a>.</p><p>On the other hand, FlowViewer's graphing and tracking functions are more powerful than those of CUFlow but also more confusing. Reports are almost infinitely customizable, adjustable, and configurable, and this broad feature set means that you really need to know what you're doing in order to get useful information. Also, FlowViewer has no concept of a read-only user: Anyone who can access your FlowViewer website gets full access to all of its features. FlowViewer is meant for network administrators, not general users.</p></div></div>
<div class="sect1" title="FlowViewer Security"><div class="titlepage"><div><div><h1 class="title"><a id="flowviewer_security"/>FlowViewer Security</h1></div></div></div><p>As mentioned, anyone who can access FlowViewer can see everything about your internal network. A skilled intruder would find this irresistible. Others will just annoy you: Unskilled visitors, such as your help-desk staff, will probably misinterpret FlowViewer's results and make you spend time explaining why they're wrong. For this reason, I strongly recommend password protecting the FlowViewer website and restricting the IP addresses permitted to access the server. Using HTTPS, even with a self-signed certificate, will protect your user credentials and data in transit.</p><p>FlowViewer's default install also uses a world-writable directory to store reports. This is a security risk, particularly on a multiuser system. If you're using a shared system as your analysis workstation, you must restrict permissions more tightly than FlowViewer's defaults.<a class="indexterm" id="IDX-CHP-7-0013"/><a class="indexterm" id="IDX-CHP-7-0014"/></p></div>
<div class="sect1" title="Installing FlowViewer"><div class="titlepage"><div><div><h1 class="title"><a id="installing_flowviewer"/>Installing FlowViewer</h1></div></div></div><p>If possible, install FlowViewer from a package provided by your OS vendor. If your vendor doesn't provide a FlowViewer package, you'll need to install by hand, of course.</p><div class="sect2" title="Prerequisites"><div class="titlepage"><div><div><h2 class="title"><a id="prerequisites"/>Prerequisites</h2></div></div></div><p>Install the following software packages before installing FlowViewer, all of which should be available as packages for most operating systems:<a class="indexterm" id="IDX-CHP-7-0015"/><a class="indexterm" id="IDX-CHP-7-0016"/><a class="indexterm" id="IDX-CHP-7-0017"/><a class="indexterm" id="IDX-CHP-7-0018"/><a class="indexterm" id="IDX-CHP-7-0019"/><a class="indexterm" id="IDX-CHP-7-0020"/><a class="indexterm" id="IDX-CHP-7-0021"/></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Web server, such as any recent Apache<a class="indexterm" id="IDX-CHP-7-0022"/></p></li><li class="listitem"><p>Perl</p></li><li class="listitem"><p>RRDtool (<a class="ulink" href="http://oss.oetiker.ch/rrdtool/">http://oss.oetiker.ch/rrdtool/</a>) with Perl shared module support<a class="indexterm" id="IDX-CHP-7-0023"/></p></li><li class="listitem"><p>GD Graphics Library (<a class="ulink" href="http://www.boutell.com/gd/">http://www.boutell.com/gd/</a>)<a class="indexterm" id="IDX-CHP-7-0024"/></p></li><li class="listitem"><p>The gd::graph Perl module<a class="indexterm" id="IDX-CHP-7-0025"/></p></li><li class="listitem"><p>The GDBM Perl module (might be packaged as GDBM_File)<a class="indexterm" id="IDX-CHP-7-0026"/></p></li></ul></div><p>You'll also need to know the system user who runs your web pages. This is probably a user named <span class="emphasis"><em>www</em></span>, <span class="emphasis"><em>http</em></span>, or <span class="emphasis"><em>www-data</em></span>. If your web server is running, enter <strong class="userinput"><code>ps -axe</code></strong> or <strong class="userinput"><code>ps -axj</code></strong> to get the name of the user running the server.</p></div><div class="sect2" title="FlowViewer Installation Process"><div class="titlepage"><div><div><h2 class="title"><a id="flowviewer_installation_process"/>FlowViewer Installation Process</h2></div></div></div><p>To install FlowViewer, first download the latest version of FlowViewer from <a class="ulink" href="http://ensight.eos.nasa.gov/FlowViewer/">http://ensight.eos.nasa.gov/FlowViewer/</a>. The compressed installation file includes a FlowViewer directory with several files containing the entire package. Untar it in a directory under your web server.</p><p>Now configure your web server to permit CGI execution in that directory. For example, here's how to configure Apache to support FlowViewer in the directory <span class="emphasis"><em>/usr/local/www/flowviewer</em></span>:</p><a id="I_programlisting7_d1e12334"/><pre class="programlisting">❶ <strong class="userinput"><code>Alias /FlowViewer/ /usr/local/www/flowviewer/</code></strong>
❷ <strong class="userinput"><code>&lt;Directory /usr/local/www/flowviewer/&gt;</code></strong>
    <strong class="userinput"><code>Options +ExecCGI</code></strong>
    <strong class="userinput"><code>AddHandler cgi-script .cgi</code></strong>
    <strong class="userinput"><code>Order allow,deny</code></strong>
    <strong class="userinput"><code>Allow from all</code></strong>
 <strong class="userinput"><code>&lt;/Directory&gt;</code></strong></pre><p>The alias definition at ❶ maps the web location <a class="ulink" href="http://servername/FlowViewer/">http://servername/FlowViewer/</a> to the local directory <span class="emphasis"><em>/usr/local/www/flowviewer/</em></span>. Then, at ❷ you assign specific permissions to the FlowViewer directory, permitting CGI execution and client access. Finally, restart Apache.</p><p>That's it for installation. The more difficult part of FlowViewer is configuration.</p></div></div>
<div class="sect1" title="Configuring FlowViewer"><div class="titlepage"><div><div><h1 class="title"><a id="configuring_flowviewer"/>Configuring FlowViewer</h1></div></div></div><p>All the tools in the FlowViewer suite use the <span class="emphasis"><em>FlowViewer_Configuration.pm</em></span> configuration file. Although this file contains many settings, only a few are required for proper operation; the others allow you to tweak the application's appearance and the behavior of FlowTracker's RRD files. If you're interested in settings not discussed here, see FlowViewer's extensive manual. I'll cover only the settings needed to make FlowViewer work. (Some operating system packages set these for you as part of their install process.) Without further ado, here are the settings that you'll need to make:<a class="indexterm" id="IDX-CHP-7-0027"/><a class="indexterm" id="IDX-CHP-7-0028"/><a class="indexterm" id="IDX-CHP-7-0029"/><a class="indexterm" id="IDX-CHP-7-0030"/><a class="indexterm" id="IDX-CHP-7-0031"/><a class="indexterm" id="IDX-CHP-7-0032"/><a class="indexterm" id="IDX-CHP-7-0033"/><a class="indexterm" id="IDX-CHP-7-0034"/><a class="indexterm" id="IDX-CHP-7-0035"/><a class="indexterm" id="IDX-CHP-7-0036"/></p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The <code class="literal">$ENV{PATH}</code> variable includes only the paths for system commands that FlowViewer requires. On almost all systems, you should leave this alone. You do not need to have flow-tools and RRDtool in these directories; they have their own path variables that you'll set later.</p></li><li class="listitem"><p>The <code class="literal">$FlowViewer_server</code> variable tells FlowViewer the hostname of your website. For example, to make my test collector visible at <a class="ulink" href="https://netflow.blackhelicopters.org/">https://netflow.blackhelicopters.org/</a>, I set <code class="literal">$FlowViewer_server</code> to <code class="literal">netflow.blackhelicopters.org</code>.</p></li><li class="listitem"><p>The <code class="literal">$FlowViewer_service</code> variable helps FlowViewer construct web pages. Set this to either <code class="literal">http</code> or <code class="literal">https</code>, as appropriate for your website.</p></li></ul></div><div class="sect2" title="Directories and Site Paths"><div class="titlepage"><div><div><h2 class="title"><a id="directories_and_site_paths"/>Directories and Site Paths</h2></div></div></div><p>FlowViewer stores files on the web server, and all file storage directories must be writable by the web server user. Create these directories, and change their ownership to the web server user. (Unwritable directories are a common cause of FlowViewer problems.)</p><p>Most directory variables also have a "short" version that defines where a web browser can find that directory on the server. FlowViewer uses this short name to create links to generated content. I'll walk you through examples when you set the first few variables.</p><div class="sidebar"><a id="search-and-replace_configuration"/><p class="title">SEARCH-AND-REPLACE CONFIGURATION</p><p>The default <span class="emphasis"><em>FlowViewer_Configuration.pm</em></span> assumes that Apache's <span class="emphasis"><em>DocumentRoot</em></span> directory is <span class="emphasis"><em>/htp/htdocs</em></span> and that the CGI directory where FlowViewer is installed is <span class="emphasis"><em>/htp/cgi-bin</em></span>. You might do a simple search and replace on these values, replacing them with the correct <span class="emphasis"><em>DocumentRoot</em></span> and <span class="emphasis"><em>FlowViewer</em></span> installation directories for your environment. In all of the following examples, my website root directory is <span class="emphasis"><em>/var/www/ssl</em></span>, and FlowViewer is installed in <span class="emphasis"><em>/usr/local/www/flowviewer</em></span>. You must create all the directories you tell FlowViewer to use.</p></div><p><code class="literal">$reports_directory</code> tells FlowViewer where to store reports, and <code class="literal">$reports_short</code> gives the location on the website where a client would find the <span class="emphasis"><em>$reports</em></span> directory. The report directory must be under Apache's <span class="emphasis"><em>DocumentRoot</em></span> or another directory accessible to Apache. Here, I've created a <span class="emphasis"><em>FlowViewer</em></span> directory in my <span class="emphasis"><em>DocumentRoot</em></span>:</p><a id="I_programlisting7_d1e12504"/><pre class="programlisting">$reports_directory       = "/var/www/ssl/FlowViewer";
$reports_short           = "/FlowViewer";</pre><p>FlowViewer stores generated graphs in <span class="emphasis"><em>$graphs_directory</em></span>, and <code class="literal">$graphs_short</code> defines the location on the website where a client would find <span class="emphasis"><em>$graphs_directory</em></span>. Like <span class="emphasis"><em>$reports_directory</em></span>, <span class="emphasis"><em>$graphs_directory</em></span> must be accessible on the website. I use the directory <span class="emphasis"><em>/var/www/ssl/FlowGrapher</em></span>.<a class="indexterm" id="IDX-CHP-7-0037"/><a class="indexterm" id="IDX-CHP-7-0038"/><a class="indexterm" id="IDX-CHP-7-0039"/><a class="indexterm" id="IDX-CHP-7-0040"/></p><a id="I_programlisting7_d1e12541"/><pre class="programlisting">$graphs_directory = "/var/www/ssl/FlowGrapher";
$graphs_short = "/FlowGrapher";</pre><p>The FlowTracker tool stores files in <span class="emphasis"><em>$tracker_directory</em></span>, which is accessible on the website as <span class="emphasis"><em>$tracker_short</em></span>. I use the directory <span class="emphasis"><em>/var/www/ssl/FlowTracker</em></span>.<a class="indexterm" id="IDX-CHP-7-0041"/></p><a id="I_programlisting7_d1e12557"/><pre class="programlisting">$tracker_directory = "/var/www/ssl/FlowTracker";
$tracker_short = "/FlowTracker";</pre><p>The <code class="literal">$cgi_bin_directory</code> variable points to the directory that contains the FlowViewer software. You could choose to copy this to your web server's regular CGI executable directory, but I suggest installing FlowViewer in its own directory and then configuring your web server to run CGI scripts in that directory. For example, as you can see here, my FlowViewer install is in <span class="emphasis"><em>/usr/local/www/flowviewer</em></span>, and I configured the web server to offer this as <a class="ulink" href="http://servername/flowviewer">http://servername/flowviewer</a>:</p><a id="I_programlisting7_d1e12570"/><pre class="programlisting">$cgi_bin_directory = "/usr/local/www/flowviewer";
$cgi_bin_short = "/flowviewer";</pre><p>FlowViewer saves temporary files in <span class="emphasis"><em>$work_directory</em></span>, which is accessible on the web server as <span class="emphasis"><em>$work_short</em></span>. Here I'm using <span class="emphasis"><em>/var/www/ssl/FlowWorking</em></span>:</p><a id="I_programlisting7_d1e12583"/><pre class="programlisting">$work_directory = "/var/www/ssl/FlowWorking";
$work_short = "/FlowWorking";</pre><p>Reports and filters saved for later are stored in <span class="emphasis"><em>$save_directory</em></span>, which is accessible to web clients as <span class="emphasis"><em>$save_short</em></span>. Create <span class="emphasis"><em>/var/www/ssl/FlowViewer_Saves</em></span> for this.</p><a id="I_programlisting7_d1e12596"/><pre class="programlisting">$save_directory = "/var/www/ssl/FlowViewer";
$save_short = "/FlowViewer_Saves";</pre><p>The remaining directories do not have "short" variables for their path on the website. FlowViewer uses them for internal tracking or to find key software, and the client should never access them directly.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>When a user asks FlowViewer to resolve the names of IP addresses, it caches the results in <span class="emphasis"><em>$names_directory</em></span>. For example, I put my names cache in <span class="emphasis"><em>/usr/local/www/flowviewer/names</em></span>. Remember, any cached DNS data slowly becomes obsolete as hosts change IP addresses.<a class="indexterm" id="IDX-CHP-7-0042"/></p></li><li class="listitem"><p>FlowTracker stores the filters it uses to create trackers in <span class="emphasis"><em>$filter_directory</em></span> and stores the RRD files in <span class="emphasis"><em>$rrdtool_directory</em></span>.<a class="indexterm" id="IDX-CHP-7-0043"/><a class="indexterm" id="IDX-CHP-7-0044"/><a class="indexterm" id="IDX-CHP-7-0045"/><a class="indexterm" id="IDX-CHP-7-0046"/><a class="indexterm" id="IDX-CHP-7-0047"/><a class="indexterm" id="IDX-CHP-7-0048"/><a class="indexterm" id="IDX-CHP-7-0049"/><a class="indexterm" id="IDX-CHP-7-0050"/><a class="indexterm" id="IDX-CHP-7-0051"/></p></li><li class="listitem"><p>The <span class="emphasis"><em>$flow_bin_directory</em></span> directory is where flow-tools is installed. This is usually something like <span class="emphasis"><em>/usr/local/bin</em></span> or <span class="emphasis"><em>/usr/local/flow-tools/bin</em></span>.<a class="indexterm" id="IDX-CHP-7-0052"/></p></li><li class="listitem"><p>Similarly, <span class="emphasis"><em>rrdtool_bin_directory</em></span> is where RRDtool is installed, which is usually <span class="emphasis"><em>/usr/local/bin</em></span> or <span class="emphasis"><em>/usr/local/rrdtool/bin</em></span>.<a class="indexterm" id="IDX-CHP-7-0053"/></p></li></ul></div><p>Here's how they look in the configuration:</p><a id="I_programlisting7_d1e12692"/><pre class="programlisting">$names_directory         = "/usr/local/www/flowviewer/names";
$filter_directory        = "/usr/local/www/flowviewer/FlowTracker_
Files/FlowTracker_Filters";
$rrdtool_directory       = "/usr/local/www/flowviewer/FlowTracker
_Files/FlowTracker_RRDtool";
$flow_bin_directory      = "/usr/local/bin";
$rrdtool_bin_directory   = "/usr/local/bin";</pre></div><div class="sect2" title="Website Setup"><div class="titlepage"><div><div><h2 class="title"><a id="website_setup"/>Website Setup</h2></div></div></div><p>The next four values set some basic properties in FlowViewer's web interface:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>FlowTracker automatically generates a web page listing all trackers currently running. The default file is <span class="emphasis"><em>index.html</em></span> in <span class="emphasis"><em>$tracker_directory</em></span>. Change this by setting <code class="literal">$actives_webpage</code> to the desired filename.</p></li><li class="listitem"><p>The autogenerated tracker page lists your organization name as the value of <code class="literal">$trackings_title</code>.</p></li><li class="listitem"><p>To put your company logo next to the FlowViewer graphic at the top of each page, create a logo file 86 pixels high, and copy it to <span class="emphasis"><em>$reports_directory</em></span>.<a class="indexterm" id="IDX-CHP-7-0054"/></p></li><li class="listitem"><p>Then assign <code class="literal">$user_logo</code> the filename. The logo will link to a website defined in <code class="literal">$user_hyperlink</code>.<a class="indexterm" id="IDX-CHP-7-0055"/></p></li></ul></div><p>They'll look like this in the configuration:</p><a id="I_programlisting7_d1e12741"/><pre class="programlisting">$actives_webpage         = "index.html";
$trackings_title         = "Lucas LLC";
$user_logo               = "myfirm.jpg";
$user_hyperlink          = "http://www.michaelwlucas.com/";</pre></div><div class="sect2" title="Devices and Exporters"><div class="titlepage"><div><div><h2 class="title"><a id="devices_and_exporters"/>Devices and Exporters</h2></div></div></div><p>In <a class="xref" href="ch02.html" title="Chapter 2. COLLECTORS AND SENSORS">Chapter 2</a>, you decided to use either a single collector that accepted flow records from all your sensors or a separate collector for each sensor. FlowViewer can support either configuration, but you must tell it which one it's using.</p><p>The simplest scenario is a single sensor and a single collector when you expect to never have more, but I don't recommend making this assumption. Networks change over time, and your FlowViewer install should accommodate that change. If you insist that you'll have only one collector and one sensor, though, see the FlowViewer manual for information on changing <code class="literal">$no_devices_or_exporters</code>.<a class="indexterm" id="IDX-CHP-7-0056"/><a class="indexterm" id="IDX-CHP-7-0057"/><a class="indexterm" id="IDX-CHP-7-0058"/><a class="indexterm" id="IDX-CHP-7-0059"/><a class="indexterm" id="IDX-CHP-7-0060"/><a class="indexterm" id="IDX-CHP-7-0061"/></p><div class="sect3" title="One Collector per Sensor"><div class="titlepage"><div><div><h3 class="title"><a id="one_collector_per_sensor"/>One Collector per Sensor</h3></div></div></div><p>In <a class="xref" href="ch02.html" title="Chapter 2. COLLECTORS AND SENSORS">Chapter 2</a>, I recommended setting up one collector per sensor. Your flow data would go into a directory such as <span class="emphasis"><em>/var/db/flows</em></span>, with a subdirectory for each device. You'd wind up with directories such as <span class="emphasis"><em>/var/db/flows/router1</em></span> for the sensor router1, <span class="emphasis"><em>/var/db/flows/router2</em></span> for the sensor router2, and so on.<a class="indexterm" id="IDX-CHP-7-0062"/></p><p>For this setup, assign the flow data root directory to <code class="literal">$flow_data_directory</code>. In my setup, <code class="literal">$flow_data_directory</code> is <span class="emphasis"><em>/var/db/flows</em></span>. Now assign the variable <code class="literal">@devices</code> the list of directory names that represent sensors. For example, my network has the sensors router1, router2, and router3. I would assign the following values to <code class="literal">@devices</code>. (FlowViewer offers everything in <code class="literal">@devices</code> as an option in a drop-down menu.)<a class="indexterm" id="IDX-CHP-7-0063"/><a class="indexterm" id="IDX-CHP-7-0064"/></p><a id="I_programlisting7_d1e12827"/><pre class="programlisting">$flow_data_directory     = "/var/db/flows";
@devices=("router1","router2","router3");</pre></div><div class="sect3" title="One Collector for All Sensors"><div class="titlepage"><div><div><h3 class="title"><a id="one_collector_for_all_sensors"/>One Collector for All Sensors</h3></div></div></div><p>If all your sensors send their data to a single collector, don't set <code class="literal">@devices</code> or <code class="literal">$flow_data_directory</code>. Instead, set <code class="literal">$exporter_directory</code> to the location of your consolidated flow data. If you ran a single collector and all your data went into <span class="emphasis"><em>/var/db/flows</em></span>, set <code class="literal">$exporter_directory</code> to <span class="emphasis"><em>/var/db/flows</em></span>. Also, uncomment <code class="literal">@exporters</code>, and set it to the list of sensors in the collector, listing exporters by IP address and hostname, as shown here:<a class="indexterm" id="IDX-CHP-7-0065"/><a class="indexterm" id="IDX-CHP-7-0066"/></p><a id="I_programlisting7_d1e12862"/><pre class="programlisting">$exporter_directory      = "/var/db/flows";
@exporters = ("192.0.2.1:router1","192.0.2.2:router2","192.0.2.3:router3");</pre><p>FlowViewer is now configured and ready for use. Point your web browser to <span class="emphasis"><em>FlowViewer.cgi</em></span> to see its initial screen.</p></div></div><div class="sect2" title="Troubleshooting the FlowViewer Suite"><div class="titlepage"><div><div><h2 class="title"><a id="troubleshooting_the_flowviewer_suite"/>Troubleshooting the FlowViewer Suite</h2></div></div></div><p>FlowViewer has many setup options, and you'll probably make mistakes during your first install. I strongly recommend keeping a terminal window open and running <code class="literal">tail -f</code> on your web server error log to display errors as they occur. In my experience, the most common errors are incorrect directory variables and directory permissions.</p><p>Watch the error log as you use FlowViewer, and correct errors as they appear. Follow these procedures, and within a few moments of testing, you should have a correctly working FlowViewer install.</p></div></div>
<div class="sect1" title="Using FlowViewer"><div class="titlepage"><div><div><h1 class="title"><a id="using_flowviewer"/>Using FlowViewer</h1></div></div></div><p>Once properly installed, FlowViewer should look something like <a class="xref" href="ch07s05.html#default_flowviewer_interface" title="Figure 7-1. Default FlowViewer interface">Figure 7-1</a>.<a class="indexterm" id="IDX-CHP-7-0067"/><a class="indexterm" id="IDX-CHP-7-0068"/><a class="indexterm" id="IDX-CHP-7-0069"/><a class="indexterm" id="IDX-CHP-7-0070"/><a class="indexterm" id="IDX-CHP-7-0071"/></p><div class="figure"><a id="default_flowviewer_interface"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject7_d1e12912"/><img alt="Default FlowViewer interface" src="httpatomoreillycomsourcenostarchimages651590.png.jpg"/></div></div><p class="title">Figure 7-1. Default FlowViewer interface</p></div><p>The upper part of the screen, Filter Criteria, controls traffic selection. This is essentially an interface to <code class="literal">flow-nfilter</code> that lets you choose exactly which flows you want to examine. FlowGrapher and FlowTracker share most of FlowViewer's filter interface. The lower part of the screen, Reporting Parameters, controls the display of results. You can run reports on traffic or just view the matching flows.<a class="indexterm" id="IDX-CHP-7-0072"/></p><p>In the following sections, I'll cover how to use the filtering interface first and then the viewing options.</p><div class="sect2" title="Filtering Flows with FlowViewer"><div class="titlepage"><div><div><h2 class="title"><a id="filtering_flows_with_flowviewer"/>Filtering Flows with FlowViewer</h2></div></div></div><p>Each field you modify in the Filter Criteria section is fed to <code class="literal">flow-nfilter</code>. Most fields accept multiple entries, separated by commas. You can also negate an entry by prefixing it with a minus sign. (If you have general questions on filtering flows, see <a class="xref" href="ch04.html" title="Chapter 4. FILTERING FLOWS">Chapter 4</a>.)<a class="indexterm" id="IDX-CHP-7-0073"/></p><div class="sect3" title="Device"><div class="titlepage"><div><div><h3 class="title"><a id="device"/>Device</h3></div></div></div><p>If you have multiple sensors, you must first select the device that provides the data you want to examine. This drop-down menu is taken directly from the devices or exporters list you configured for FlowViewer, and it's the only field that requires you to enter anything.</p></div><div class="sect3" title="Next Hop IP"><div class="titlepage"><div><div><h3 class="title"><a id="next_hop_ip"/>Next Hop IP</h3></div></div></div><p>This is the IP address where the sensor sends traffic. Remember that only hardware flow sensors, such as routers and switches, include next-hop address information in flows. Software flow sensors do not have access to this information.</p></div><div class="sect3" title="Start and End Date and Time"><div class="titlepage"><div><div><h3 class="title"><a id="start_and_end_date_and_time"/>Start and End Date and Time</h3></div></div></div><p>Here you set the time you're interested in. Times are in 24-hour-clock format. FlowViewer defaults to offering the most recent complete hour. See <a class="xref" href="ch07s05.html#include_flow_if" title="Include Flow If">Include Flow If</a> in <a class="xref" href="ch07s05.html#include_flow_if" title="Include Flow If">Include Flow If</a> for a discussion on how FlowViewer handles flows that cross the start or end times.<a class="indexterm" id="IDX-CHP-7-0074"/><a class="indexterm" id="IDX-CHP-7-0075"/><a class="indexterm" id="IDX-CHP-7-0076"/><a class="indexterm" id="IDX-CHP-7-0077"/><a class="indexterm" id="IDX-CHP-7-0078"/><a class="indexterm" id="IDX-CHP-7-0079"/><a class="indexterm" id="IDX-CHP-7-0080"/><a class="indexterm" id="IDX-CHP-7-0081"/><a class="indexterm" id="IDX-CHP-7-0082"/><a class="indexterm" id="IDX-CHP-7-0083"/></p></div><div class="sect3" title="TOS Field, TCP Flag, and Protocol"><div class="titlepage"><div><div><h3 class="title"><a id="tos_field_comma_tcp_flag_comma_and_proto"/>TOS Field, TCP Flag, and Protocol</h3></div></div></div><p>FlowViewer's Type of Service (DSCP) and TCP flags filtering accepts both decimal values (16) and hexadecimals (0x10).<a class="indexterm" id="IDX-CHP-7-0084"/></p><p>You can enter the IP protocol either by name (TCP, UDP, and so on) or by number (6, 17, and so on).</p></div><div class="sect3" title="Source and Dest IP"><div class="titlepage"><div><div><h3 class="title"><a id="source_and_dest_ip"/>Source and Dest IP</h3></div></div></div><p>You can report on either a single address, a hostname, multiple comma-separated addresses, or networks with a netmask in prefix length (slash) notation. For example, to report on traffic from the network 192.0.2.0 with a netmask of 255.255.255.128, you would enter <span class="strong"><strong>192.0.2.0/25</strong></span>.</p><div class="note" title="Note"><h3 class="title">Note</h3><p>Be very careful when using hostnames for network analysis. Some hosts have multiple IP addresses. In this case, you're better off using actual IP addresses to reduce ambiguity.</p></div></div><div class="sect3" title="Source and Dest Interface"><div class="titlepage"><div><div><h3 class="title"><a id="source_and_dest_interface"/>Source and Dest Interface</h3></div></div></div><p>If you think you know how your traffic flowed, you can filter by source or destination interface. When you do, remember that interfaces are numbered by index number, which you can get from SNMP. You can add interface names to FlowViewer, as I'll discuss at the end of this chapter.</p><p>I most often use FlowViewer when analyzing problems and outages. When doing so, I recommend against filtering by interface because traffic flowing incorrectly is a common cause of problems and outages, and filtering by interface can filter away the problem traffic.</p></div><div class="sect3" title="Source and Dest Port and AS"><div class="titlepage"><div><div><h3 class="title"><a id="source_and_dest_port_and_as"/>Source and Dest Port and AS</h3></div></div></div><p>FlowViewer can filter by TCP or UDP port. You can also encode ICMP types and codes as a port, as discussed in <a class="xref" href="ch03s04.html" title="ICMP Types and Codes and Flow Records">ICMP Types and Codes and Flow Records</a> in <a class="xref" href="ch03s04.html" title="ICMP Types and Codes and Flow Records">ICMP Types and Codes and Flow Records</a>, and use that to filter ICMP flows. Further, if your sensor exports BGP information, you can filter by source and destination AS number.</p></div></div><div class="sect2" title="Reporting Parameters"><div class="titlepage"><div><div><h2 class="title"><a id="reporting_parameters"/>Reporting Parameters</h2></div></div></div><p>FlowViewer can provide either statistical reports or printed reports. Both types of reports share the remaining optional settings. I'll cover the options first and then discuss the two types of reports. You can run one report at a time, but if you select both a statistics report and a printed report, FlowViewer will return an error.</p><div class="sect3" title="Include Flow If"><div class="titlepage"><div><div><h3 class="title"><a id="include_flow_if"/>Include Flow If</h3></div></div></div><p>This setting determines how FlowViewer selects flows to report on. The default, Any Part in Specified Time Span, includes a flow record if any part of the flow is within the time you specify. For example, if you're interested in flow data from 9 to 10, your raw data might include a flow that starts at 8:59:30 and ends at 9:01:30 and also one that starts at 9:59:59 and ends at 10:05:59, with part of these flows trailing off either end of your chosen time window.<a class="indexterm" id="IDX-CHP-7-0085"/><a class="indexterm" id="IDX-CHP-7-0086"/><a class="indexterm" id="IDX-CHP-7-0087"/><a class="indexterm" id="IDX-CHP-7-0088"/><a class="indexterm" id="IDX-CHP-7-0089"/><a class="indexterm" id="IDX-CHP-7-0090"/></p><p>Most of the time, the default setting gives the best view of traffic during your chosen time. When using the default setting, these flows will be included in the filtered data. On the other hand, the End Time in Specified Time Span setting chops off anything that trails past the closing window. Specifically, in this example, the flow that starts at 9:59:59 and ends at 10:05:59 would not be included in the selected data. The Start Time in Specified Time Span setting slices off the flow that begins at 8:59:30, and the Entirely in Specified Time Span setting excludes both of those trailing flows.</p></div><div class="sect3" title="Sort Field, Resolve Addresses, and Oct Conv, and Sampling Multip"><div class="titlepage"><div><div><h3 class="title"><a id="sort_field_comma_resolve_addresses_comma"/>Sort Field, Resolve Addresses, and Oct Conv, and Sampling Multip</h3></div></div></div><p>Like <code class="literal">flow-report</code>, FlowViewer can sort its output on any field with the output columns numbered starting from 1. To sort by a particular field, give the number of the column you want to sort by in the Sort Field space.</p><p>Some reports can replace IP addresses with hostnames, but, by default, FlowViewer resolves names. To make FlowViewer show only IP addresses, change Resolve Addresses to <span class="strong"><strong>N</strong></span>. Similarly, FlowViewer by default displays large octet counts as kilobytes, megabytes, or gigabytes instead of raw counts of millions or billions of bytes. To see raw byte counts, set Oct. Conv to <span class="strong"><strong>N</strong></span>. (Displaying results as kilobytes, megabytes, or gigabytes won't affect sorting; FlowViewer is smart enough to sort different units correctly.)<a class="indexterm" id="IDX-CHP-7-0091"/></p><p>If your sensors sample traffic, you know that the traffic levels shown in your reports are only a fraction of your real traffic. FlowViewer will multiply its results by the number you enter in Sampling Multip to approximate your real-world traffic.</p></div><div class="sect3" title="Pie Charts"><div class="titlepage"><div><div><h3 class="title"><a id="pie_charts"/>Pie Charts</h3></div></div></div><p>FlowViewer's statistical reports can generate pie charts of their results, but pie charts are not useful for FlowViewer reports; they're like making a pie chart of the phone book. For statistical reports, you can choose to include an "other" catchall category in your graph. Try both ways to see which generates the most useful graph in your environment.</p></div><div class="sect3" title="Cutoffs"><div class="titlepage"><div><div><h3 class="title"><a id="cutoffs"/>Cutoffs</h3></div></div></div><p>If you have a busy router, even a well-filtered report might include hundreds of thousands of flows. In such case, cutoffs prove useful because they tell FlowViewer when to stop printing results. You can cut off reports either by the number of lines of output or by the number of octets.</p><p>If you really want to have all that data, consider running the report from the command line and saving the results to a file for later analysis.</p></div></div><div class="sect2" title="Printed Reports"><div class="titlepage"><div><div><h2 class="title"><a id="printed_reports"/>Printed Reports</h2></div></div></div><p>FlowViewer's printed reports are a web interface of <code class="literal">flow-print</code>. <a class="xref" href="ch07s05.html#printed_reports_and_flow-print_formats" title="Table 7-1. Printed Reports and flow-print Formats">Table 7-1</a> maps FlowViewer's printed reports to <code class="literal">flow-print</code> formats. <a class="xref" href="ch03.html" title="Chapter 3. VIEWING FLOWS">Chapter 3</a> covers the various print formats in detail.<a class="indexterm" id="IDX-CHP-7-0092"/><a class="indexterm" id="IDX-CHP-7-0093"/><a class="indexterm" id="IDX-CHP-7-0094"/><a class="indexterm" id="IDX-CHP-7-0095"/><a class="indexterm" id="IDX-CHP-7-0096"/></p><div class="table"><a id="printed_reports_and_flow-print_formats"/><p class="title">Table 7-1. Printed Reports and flow-print Formats</p><div class="table-contents"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; " summary="Printed Reports and flow-print Formats"><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Printed Report</p></th><th style="text-align: left" valign="bottom"><p>flow-print Format</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p>Flow Times</p></td><td style="text-align: left" valign="top"><p><code class="literal">-f 1</code></p></td></tr><tr><td style="text-align: left" valign="top"><p>AS Numbers</p></td><td style="text-align: left" valign="top"><p><code class="literal">-f 4</code></p></td></tr><tr><td style="text-align: left" valign="top"><p>132 Columns</p></td><td style="text-align: left" valign="top"><p><code class="literal">-f 5</code></p></td></tr><tr><td style="text-align: left" valign="top"><p>1 Line with Tags</p></td><td style="text-align: left" valign="top"><p><code class="literal">-f 9</code></p></td></tr><tr><td style="text-align: left" valign="top"><p>AS Aggregation</p></td><td style="text-align: left" valign="top"><p><code class="literal">-f 10</code></p></td></tr><tr><td style="text-align: left" valign="top"><p>Protocol Port Aggregation</p></td><td style="text-align: left" valign="top"><p><code class="literal">-f 11</code></p></td></tr><tr><td style="text-align: left" valign="top"><p>Source Prefix Aggregation</p></td><td style="text-align: left" valign="top"><p><code class="literal">-f 12</code></p></td></tr><tr><td style="text-align: left" valign="top"><p>Destination Prefix Aggregation</p></td><td style="text-align: left" valign="top"><p><code class="literal">-f 13</code></p></td></tr><tr><td style="text-align: left" valign="top"><p>Prefix Aggregation</p></td><td style="text-align: left" valign="top"><p><code class="literal">-f 14</code></p></td></tr><tr><td style="text-align: left" valign="top"><p>Full (Catalyst)</p></td><td style="text-align: left" valign="top"><p><code class="literal">-f 24</code></p></td></tr></tbody></table></div></div><p>Note that not all reports will produce output. For example, if your flow data does not include BGP information and you run a BGP-based report, you'll get an empty report.</p></div><div class="sect2" title="Statistics Reports"><div class="titlepage"><div><div><h2 class="title"><a id="statistics_reports"/>Statistics Reports</h2></div></div></div><p>FlowViewer's statistics reports are based on <code class="literal">flow-stat</code>, the predecessor to <code class="literal">flow-report</code>. <code class="literal">flow-stat</code> is much less flexible than <code class="literal">flow-report</code>, but some of its reports are more suitable for a web application. Most <code class="literal">flow-stat</code> analyses are available as subsets of <code class="literal">flow-report</code> output formats, as listed in <a class="xref" href="ch07s05.html#flowviewer_statistics_reports_and_corres" title="Table 7-2. FlowViewer Statistics Reports and Corresponding flow-reports">Table 7-2</a>.<a class="indexterm" id="IDX-CHP-7-0097"/><a class="indexterm" id="IDX-CHP-7-0098"/></p><div class="table"><a id="flowviewer_statistics_reports_and_corres"/><p class="title">Table 7-2. FlowViewer Statistics Reports and Corresponding flow-reports</p><div class="table-contents"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; " summary="FlowViewer Statistics Reports and Corresponding flow-reports"><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Statistics Report</p></th><th style="text-align: left" valign="bottom"><p>flow-report</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p>Summary</p></td><td style="text-align: left" valign="top"><p>summary (default)</p></td></tr><tr><td style="text-align: left" valign="top"><p>UDP/TCP Destination Port</p></td><td style="text-align: left" valign="top"><p>ip-destination-port</p></td></tr><tr><td style="text-align: left" valign="top"><p>UDP/TCP Source Port</p></td><td style="text-align: left" valign="top"><p>ip-source-port</p></td></tr><tr><td style="text-align: left" valign="top"><p>UDP/TCP Port</p></td><td style="text-align: left" valign="top"><p>ip-port</p></td></tr><tr><td style="text-align: left" valign="top"><p>Destination IP</p></td><td style="text-align: left" valign="top"><p>ip-destination-address</p></td></tr><tr><td style="text-align: left" valign="top"><p>Source IP</p></td><td style="text-align: left" valign="top"><p>ip-source-address</p></td></tr><tr><td style="text-align: left" valign="top"><p>Source/Destination IP</p></td><td style="text-align: left" valign="top"><p>ip-source/destination-address</p></td></tr><tr><td style="text-align: left" valign="top"><p>Source or Destination IP</p></td><td style="text-align: left" valign="top"><p>ip-address</p></td></tr><tr><td style="text-align: left" valign="top"><p>IP Protocol</p></td><td style="text-align: left" valign="top"><p>ip-protocol</p></td></tr><tr><td style="text-align: left" valign="top"><p>Input Interface</p></td><td style="text-align: left" valign="top"><p>input-interface</p></td></tr><tr><td style="text-align: left" valign="top"><p>Output Interface</p></td><td style="text-align: left" valign="top"><p>output-interface</p></td></tr><tr><td style="text-align: left" valign="top"><p>Input/Output Interface</p></td><td style="text-align: left" valign="top"><p>input/output-interface</p></td></tr><tr><td style="text-align: left" valign="top"><p>Source AS<a class="indexterm" id="IDX-CHP-7-0099"/></p></td><td style="text-align: left" valign="top"><p>source-as</p></td></tr><tr><td style="text-align: left" valign="top"><p>Destination AS</p></td><td style="text-align: left" valign="top"><p>destination-as</p></td></tr><tr><td style="text-align: left" valign="top"><p>Source/Destination AS</p></td><td style="text-align: left" valign="top"><p>source/destination-as</p></td></tr><tr><td style="text-align: left" valign="top"><p>IP ToS</p></td><td style="text-align: left" valign="top"><p>ip-tos</p></td></tr><tr><td style="text-align: left" valign="top"><p>Source Prefix</p></td><td style="text-align: left" valign="top"><p>like ip-source-address with ip-source-address-format set to prefix-len</p></td></tr><tr><td style="text-align: left" valign="top"><p>Destination Prefix</p></td><td style="text-align: left" valign="top"><p>like ip-destination-address with ip-destination-address-format set to prefix-len</p></td></tr><tr><td style="text-align: left" valign="top"><p>Source/Destination Prefix</p></td><td style="text-align: left" valign="top"><p>like ip-source/destination-address with both ip-source-address-format and ip-destination-address-format set to prefix-len</p></td></tr><tr><td style="text-align: left" valign="top"><p>Exporter IP</p></td><td style="text-align: left" valign="top"><p>ip-exporter-address</p></td></tr></tbody></table></div></div><div class="note" title="Note"><h3 class="title">Note</h3><p>If you need a report not offered here, use <code class="literal">flow-report</code> instead.</p></div></div></div>
<div class="sect1" title="FlowGrapher"><div class="titlepage"><div><div><h1 class="title"><a id="flowgrapher"/>FlowGrapher</h1></div></div></div><p>FlowGrapher creates graphs of arbitrary flow data. Select the FlowGrapher text from the logo at the top of the FlowViewer page to get to FlowGrapher.<a class="indexterm" id="IDX-CHP-7-0100"/></p><div class="sect2" title="FlowGrapher Settings"><div class="titlepage"><div><div><h2 class="title"><a id="flowgrapher_settings"/>FlowGrapher Settings</h2></div></div></div><p>The top part of the FlowGrapher page lets you define packet filters as narrowly as necessary. FlowGrapher filters are identical to the FlowViewer filter definitions listed in <a class="xref" href="ch07s05.html#default_flowviewer_interface" title="Figure 7-1. Default FlowViewer interface">Figure 7-1</a>, so I won't over them again, but the bottom of the FlowGrapher page offers new graphing options, as shown in <a class="xref" href="ch07s06.html#flowgrapher_options" title="Figure 7-2. FlowGrapher options">Figure 7-2</a>.</p><div class="figure"><a id="flowgrapher_options"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject7_d1e13465"/><img alt="FlowGrapher options" src="httpatomoreillycomsourcenostarchimages651592.png.jpg"/></div></div><p class="title">Figure 7-2. FlowGrapher options</p></div><p>Include Flow if, Resolve Addresses, and Sampling Multiplier work the same way as the equivalent fields in FlowViewer. The options unique to FlowGrapher—Detail Lines, Graph Width, and Sample Time—determine how your graph is charted, its appearance, and how any related data is presented.</p><div class="sect3" title="Detail Lines"><div class="titlepage"><div><div><h3 class="title"><a id="detail_lines"/>Detail Lines</h3></div></div></div><p>FlowGrapher prints the first few lines of <code class="literal">flow-print</code> output for the selected flow files beneath the graph. This list lets you verify that the graph includes the flows you think should be included by your filter.</p></div><div class="sect3" title="Graph Width"><div class="titlepage"><div><div><h3 class="title"><a id="graph_width"/>Graph Width</h3></div></div></div><p>The default FlowGrapher image is 600 pixels wide, but graphs that cover more than a couple of hours must be wider in order to show necessary detail. The Graph Width setting multiplies the width of a graph by the selected number. For example, choosing <span class="strong"><strong>3</strong></span> creates a graph 1,800 pixels wide.<a class="indexterm" id="IDX-CHP-7-0101"/><a class="indexterm" id="IDX-CHP-7-0102"/><a class="indexterm" id="IDX-CHP-7-0103"/></p></div><div class="sect3" title="Sample Time"><div class="titlepage"><div><div><h3 class="title"><a id="sample_time"/>Sample Time</h3></div></div></div><p>FlowGrapher computes bandwidth in "buckets" of time in order to smooth the data and present a more realistic graph. (You'll see why this is important in <a class="xref" href="ch08.html" title="Chapter 8. AD HOC FLOW VISUALIZATION">Chapter 8</a>.) The default bucket size of five seconds is reasonable for almost all environments. A larger bucket size will decrease the size of bandwidth spikes and might be more realistic if most of your traffic consists of long-lived flows.</p></div><div class="sect3" title="Graph Type"><div class="titlepage"><div><div><h3 class="title"><a id="graph_type"/>Graph Type</h3></div></div></div><p>You can choose either Bits/second (the default), Flows/second, or Packet/second graphs. Most of the time you'll want Bits/second, but if your environment has large numbers of small packets, you might find the Packets/second graph useful. Flows/second is mostly useful to determine whether you have more or less activity than usual.</p></div></div><div class="sect2" title="FlowGrapher Output"><div class="titlepage"><div><div><h2 class="title"><a id="flowgrapher_output"/>FlowGrapher Output</h2></div></div></div><p><a class="xref" href="ch07s06.html#sample_traffic_graph" title="Figure 7-3. Sample traffic graph">Figure 7-3</a> shows a traffic graph for my server, without the logo or the sample <code class="literal">flow-print</code> output.<a class="indexterm" id="IDX-CHP-7-0104"/></p><div class="figure"><a id="sample_traffic_graph"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject7_d1e13528"/><img alt="Sample traffic graph" src="httpatomoreillycomsourcenostarchimages651594.png.jpg"/></div></div><p class="title">Figure 7-3. Sample traffic graph</p></div><p>Notice how FlowGrapher prints the selected filter criteria above the graph. This information lets you easily re-create the graph with slightly different conditions and reminds you what you tried to graph when you return to an image later.<a class="indexterm" id="IDX-CHP-7-0105"/><a class="indexterm" id="IDX-CHP-7-0106"/><a class="indexterm" id="IDX-CHP-7-0107"/><a class="indexterm" id="IDX-CHP-7-0108"/><a class="indexterm" id="IDX-CHP-7-0109"/><a class="indexterm" id="IDX-CHP-7-0110"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p>To create a traffic graph that's beyond FlowGrapher's capacity, see <a class="xref" href="ch08.html" title="Chapter 8. AD HOC FLOW VISUALIZATION">Chapter 8</a>.</p></div></div></div>
<div class="sect1" title="FlowTracker"><div class="titlepage"><div><div><h1 class="title"><a id="flowtracker"/>FlowTracker</h1></div></div></div><p>FlowTracker generates RRD-based graphs of flow data on an ongoing basis, much like FlowScan and CUFlow. Each graph you create is called a <span class="emphasis"><em>tracker</em></span>. One tracker graphs either inbound or outbound traffic, but not both. FlowTracker is much more flexible than FlowScan, but that flexibility also makes it unsuitable for customers or management to access directly.<a class="indexterm" id="IDX-CHP-7-0111"/></p><div class="sect2" title="FlowTracker Processes"><div class="titlepage"><div><div><h2 class="title"><a id="flowtracker_processes"/>FlowTracker Processes</h2></div></div></div><p>Like FlowScan, FlowTracker creates RRD files from <code class="literal">flow-capture</code> files as they're created. Rather than moving flow files, however, FlowTracker uses two processes to watch the <code class="literal">flow-capture</code> directories for changes and to read each new flow file as it's closed. If these processes stop, FlowTracker will not update RRDs for new flows or create new graphs.<a class="indexterm" id="IDX-CHP-7-0112"/></p><p>Start the <code class="literal">FlowTracker_Collector</code> and <code class="literal">FlowTracker_Grapher</code> processes when the system boots. The included <code class="literal">flowcap</code> script might work for your operating system, but if not you can start them as shown here:</p><a id="I_programlisting7_d1e13601"/><pre class="programlisting">#!/bin/sh
PERL5LIB=/usr/local/www/flowviewer/ /usr/local/www/flowviewer/FlowTracker_Collector &amp;
PERL5LIB=/usr/local/www/flowviewer/ /usr/local/www/flowviewer/FlowTracker_Grapher &amp;</pre><p>Start these processes after the network is initialized. Have your network management system monitor these processes and either send an alarm or automatically restart them if they fail.</p></div><div class="sect2" title="FlowTracker Settings"><div class="titlepage"><div><div><h2 class="title"><a id="flowtracker_settings"/>FlowTracker Settings</h2></div></div></div><p>FlowTracker offers the same filtering options as FlowViewer and FlowGrapher, without the option to select the time you want to cover. (FlowTracker continuously processes flow data, so time-based filtering doesn't make sense.) FlowTracker creates graphs based on the filters you define, just like FlowGrapher and FlowViewer.</p><p><a class="xref" href="ch07s07.html#flowtracker_options" title="Figure 7-4. FlowTracker options">Figure 7-4</a> shows the FlowTracker-specific configuration options.</p><div class="figure"><a id="flowtracker_options"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject7_d1e13616"/><img alt="FlowTracker options" src="httpatomoreillycomsourcenostarchimages651596.png.jpg"/></div></div><p class="title">Figure 7-4. FlowTracker options</p></div><p>Once you've entered your desired settings, click <span class="strong"><strong>Establish Tracking</strong></span> to start your tracker.<a class="indexterm" id="IDX-CHP-7-0113"/><a class="indexterm" id="IDX-CHP-7-0114"/><a class="indexterm" id="IDX-CHP-7-0115"/><a class="indexterm" id="IDX-CHP-7-0116"/><a class="indexterm" id="IDX-CHP-7-0117"/><a class="indexterm" id="IDX-CHP-7-0118"/><a class="indexterm" id="IDX-CHP-7-0119"/><a class="indexterm" id="IDX-CHP-7-0120"/><a class="indexterm" id="IDX-CHP-7-0121"/></p><div class="sect3" title="Tracking Set Label"><div class="titlepage"><div><div><h3 class="title"><a id="tracking_set_label"/>Tracking Set Label</h3></div></div></div><p>Tracking Set Label is the tracker's name. You should name trackers by the host, network, or traffic name and by the direction the traffic is going, such as "Server 1 Web traffic inbound" or "Server 2 outbound." The text you enter here will appear as a link to the actual tracker on the main FlowTracker page.</p></div><div class="sect3" title="Tracking Type"><div class="titlepage"><div><div><h3 class="title"><a id="tracking_type"/>Tracking Type</h3></div></div></div><p>FlowTracker can aggregate individual trackers into a "group tracker." I'll cover group trackers later; for now, all of your trackers should be Individual.</p></div><div class="sect3" title="Sampling Multiplier"><div class="titlepage"><div><div><h3 class="title"><a id="sampling_multiplier"/>Sampling Multiplier</h3></div></div></div><p>Like other parts of FlowViewer, FlowTracker can apply a sampling multiplier to approximate correct traffic levels in your graph.</p></div><div class="sect3" title="Alert Threshold"><div class="titlepage"><div><div><h3 class="title"><a id="alert_threshold"/>Alert Threshold</h3></div></div></div><p>As a continuously running process, FlowTracker can monitor total traffic levels and send an alarm if traffic exceeds a certain level. To set an alarm at a number of bits per second, enter that number here. (Note that your server must have a properly configured mail system to send alarms.)</p></div><div class="sect3" title="Alert Frequency"><div class="titlepage"><div><div><h3 class="title"><a id="alert_frequency"/>Alert Frequency</h3></div></div></div><p>Generating an alarm every time the traffic exceeds your critical level can be annoying if your traffic load bounces back and forth across that level. Use Alert Frequency to tell FlowTracker to send an alarm each time traffic exceeds the critical limit, only once per day, or to disable emailed alerts entirely.</p></div><div class="sect3" title="Alert Destination"><div class="titlepage"><div><div><h3 class="title"><a id="alert_destination"/>Alert Destination</h3></div></div></div><p>This is the email address that receives alerts.</p></div><div class="sect3" title="General Comment"><div class="titlepage"><div><div><h3 class="title"><a id="general_comment"/>General Comment</h3></div></div></div><p>Any notes or comments here will appear on the finished graph.</p></div></div><div class="sect2" title="Viewing Trackers"><div class="titlepage"><div><div><h2 class="title"><a id="viewing_trackers"/>Viewing Trackers</h2></div></div></div><p>Trackers that you've already created will appear at the bottom of the FlowTracker page. <a class="xref" href="ch07s07.html#flowtracker_individual_trackings" title="Figure 7-5. FlowTracker individual trackings">Figure 7-5</a> shows four trackers, inbound and outbound for two machines.</p><div class="figure"><a id="flowtracker_individual_trackings"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject7_d1e13704"/><img alt="FlowTracker individual trackings" src="httpatomoreillycomsourcenostarchimages651598.png.jpg"/></div></div><p class="title">Figure 7-5. FlowTracker individual trackings</p></div><p>To view a tracker, click its name. Trackers include views of the last 24 hours, 7 days, 4 weeks, 12 months, and 3 years. Each graph looks much like FlowGrapher output, so I won't reproduce those graphs here.<a class="indexterm" id="IDX-CHP-7-0122"/></p><p>You can edit trackers to update filters or correct mistakes. To do so, click the <span class="strong"><strong>Revise</strong></span> link next to a tracker in order to populate a FlowTracker page with the tracker's original settings, and then make the desired changes. You can also add a note to be displayed on the graphs to show when a tracker was changed.</p><p>Archiving a tracker tells FlowTracker to stop processing the current flows for this particular tracker, while continuing to update other trackers. It retains the archived tracker's configuration and graphs. Archiving lets you retain historical information without wasting computing power and lets you easily reactivate the tracker if needed.</p><p>Finally, you can also entirely remove a tracker by clicking the link. This deletes all graphs and the associated databases.</p></div><div class="sect2" title="Group Trackers"><div class="titlepage"><div><div><h2 class="title"><a id="group_trackers"/>Group Trackers</h2></div></div></div><p>FlowTracker lets you combine individual trackers into group trackers to give you a unified view of different types of traffic. For example, in <a class="xref" href="ch07s07.html#flowtracker_individual_trackings" title="Figure 7-5. FlowTracker individual trackings">Figure 7-5</a> you can see separate inbound and outbound trackers for two servers. To view a server's inbound and outbound traffic simultaneously, you need to use a group tracker.<a class="indexterm" id="IDX-CHP-7-0123"/><a class="indexterm" id="IDX-CHP-7-0124"/></p><p>To create a group tracker, name the tracker, and select a tracking type of <span class="strong"><strong>Group</strong></span>. Next, when you click <span class="strong"><strong>Establish Tracking</strong></span>, FlowTracker will open a separate page to define your group tracker, as shown in <a class="xref" href="ch07s07.html#basic_flowtracker_setup" title="Figure 7-6. Basic FlowTracker setup">Figure 7-6</a>.</p><div class="figure"><a id="basic_flowtracker_setup"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject7_d1e13751"/><img alt="Basic FlowTracker setup" src="httpatomoreillycomsourcenostarchimages651600.png.jpg"/></div></div><p class="title">Figure 7-6. Basic FlowTracker setup</p></div><p>The sample graph shown at the top of <a class="xref" href="ch07s07.html#basic_flowtracker_setup" title="Figure 7-6. Basic FlowTracker setup">Figure 7-6</a> is not based on actual data but will show you how your color choices will look on an actual graph.</p><p>Further down in the figure are the critical components. Here you can choose individual trackers to include in your group tracker or choose to have the tracker appear above or below the x-axis. I try to consistently put inbound trackers above the x-axis and outbound trackers below in order to minimize confusion. Switch these if you prefer; just pick a standard and stick with it.<a class="indexterm" id="IDX-CHP-7-0125"/></p><p>You can assign colors to each tracker in your graph. The Auto choices choose colors in the same color family. I recommend using one Auto color for all inbound trackers and a different Auto color for all outbound trackers.</p><p>Once you've added an individual tracker to your group tracker, click <span class="strong"><strong>Add this Component</strong></span>. Then, immediately beneath this option, you'll see a list of all the individual trackers in this group tracker. For example, <a class="xref" href="ch07s07.html#group_tracker_components" title="Figure 7-7. Group tracker components">Figure 7-7</a> displays this group tracker after I've added both the inbound and outbound trackers for both individual servers.</p><div class="figure"><a id="group_tracker_components"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject7_d1e13777"/><img alt="Group tracker components" src="httpatomoreillycomsourcenostarchimages651602.png.jpg"/></div></div><p class="title">Figure 7-7. Group tracker components</p></div><p>Both the torch and bewilderbeast servers will now appear in this one tracker. The inbound trackers will appear above the x-axis, as shown by the long horizontal line. The color name appears in the chosen color (which doesn't appear in this black-and-white figure, of course). If you don't like the color, change it with the New Color drop-down.</p><p>Use the Move drop-down on the far right to rearrange the server order, and then click <span class="strong"><strong>Adjust the Group</strong></span> to apply your changes. I recommend having servers in the same order on both the inbound and outbound sides of the tracker.</p><p>Once you've configured your group tracker, click <span class="strong"><strong>Done</strong></span> at the bottom of the page to create the tracker. You can revise, archive, and remove your group tracker as with an individual tracker.</p><div class="sidebar"><a id="additional_rrd_software"/><p class="title">ADDITIONAL RRD SOFTWARE</p><p>Different tools have different presentations and focus. If you find that FlowTracker isn't quite right for your long-term tracking needs, take a look at Webview Netflow Reporter, at <a class="ulink" href="http://wvnetflow.sourceforge.net/">http://wvnetflow.sourceforge.net/</a>.<a class="indexterm" id="IDX-CHP-7-0126"/></p></div></div></div>
<div class="sect1" title="Interface Names and FlowViewer"><div class="titlepage"><div><div><h1 class="title"><a id="interface_names_and_flowviewer"/>Interface Names and FlowViewer</h1></div></div></div><p>Flows manage interfaces by index number, but humans use the interface name. If you tell FlowViewer the name associated with each interface number, it'll offer those names as an option in the web interface. If you create the file <span class="emphasis"><em>NamedInterfaces_Devices</em></span> in the <span class="emphasis"><em>FlowViewer</em></span> directory, FlowViewer will populate the Interface Names drop-down in the filter section of all three tools with information from the file.<a class="indexterm" id="IDX-CHP-7-0127"/></p><p>Each line in the <span class="emphasis"><em>NamedInterfaces_Devices</em></span> file contains three entries:</p><a id="I_programlisting7_d1e13826"/><pre class="programlisting">exporter name:SNMP index:human-friendly name</pre><p>For example, my main router's gigabit uplink is at SNMP index 5. The entry for this interface might look like this:</p><a id="I_programlisting7_d1e13830"/><pre class="programlisting">core-4:5:Gigabit Ethernet 1/0 - uplink</pre><p>Entering interface information for all your exporters into FlowViewer will save you trouble in the future and simplify problem solving. Rather than having to look up the number for the interface you're interested in, you can just select it from the menu.</p><p>FlowTracker, FlowViewer, and FlowGrapher will let you visualize most common situations, but they don't solve everything. In the next chapter, you'll see how to graph data when FlowGrapher isn't powerful or flexible enough.</p></div></body></html>