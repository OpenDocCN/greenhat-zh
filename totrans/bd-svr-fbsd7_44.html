<html><head></head><body>

<div class="calibre1"><div class="calibre1"><a name="openssl_0.9.8g" class="calibre8" id="openssl_0.9.8g"/>
<div class="calibre24" id="calibre_pb_0"/><h2 id="title-ID0EEXPM" class="docPrefaceTitle">Chapter 18. OPENSSL 0.9.8G</h2>
<h4 class="calibre32"><a class="calibre2" target="_blank" href="HTTP://WWW.OPENSSL.ORG">HTTP://WWW.OPENSSL.ORG</a></h4>
<a name="summary-id17" class="calibre8" id="summary-id17"/>
<h3 class="docSection1Title" id="-100000">18.1. SUMMARY</h3>
<p class="docText1"><a name="OpenSSL is" class="calibre8" id="OpenSSL is"/>OpenSSL is an open source toolkit and cryptographic library that implements the SSL (Secure Sockets Layer) and TLS (Transport Layer Security) protocols. OpenSSL is an independent project managed by various volunteers from around the world. In short, OpenSSL provides cryptography tools for securing network connections.<a name="IDX-CHP-18-0274" class="calibre8" id="IDX-CHP-18-0274"/><a name="IDX-CHP-18-0275" class="calibre8" id="IDX-CHP-18-0275"/><a name="IDX-CHP-18-0276" class="calibre8" id="IDX-CHP-18-0276"/><a name="IDX-CHP-18-0277" class="calibre8" id="IDX-CHP-18-0277"/><a name="IDX-CHP-18-0278" class="calibre8" id="IDX-CHP-18-0278"/><a name="IDX-CHP-18-0279" class="calibre8" id="IDX-CHP-18-0279"/><a name="IDX-CHP-18-0280" class="calibre8" id="IDX-CHP-18-0280"/></p>
<p class="docText1"><a name="SSL implementation" class="calibre8" id="SSL implementation"/>A common SSL implementation is to secure web pages with HTTPS (HyperText Transfer Protocol secured with encryption). An HTTPS handshake consists of the following steps:<a name="IDX-CHP-18-0281" class="calibre8" id="IDX-CHP-18-0281"/></p>
<div class="calibre34"><ol class="docList" type="1"><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="web server" class="calibre8" id="web server"/>An HTTP client (web browser) sends a web server an HTTPS request.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="responds by" class="calibre8" id="responds by"/>The server responds by sending the client its SSL Certificate containing its public key, domain name, and issuing certificate authority.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="a challenge" class="calibre8" id="a challenge"/>The client sends a challenge message encrypted using the server's public SSL key.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="SSL key" class="calibre8" id="SSL key"/>The server decrypts this message with its private SSL key.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="back to" class="calibre8" id="back to"/>The server finally sends the decrypted message back to the client.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="begin to" class="calibre8" id="begin to"/>If the client receives the correct message, the two parties can begin to exchange information securely, assuming the issuing certificate authority is trusted by the client.</p></div></li></ol></div>
<p class="docText1"><a name="certificate signing" class="calibre8" id="certificate signing"/>OpenSSL provides the tools needed to create certificate signing requests, private server keys, and self-signed certificates. When coupled with a recognized certificate authority, trusted server certificates can be produced for use with TCP protocols like HTTP, SMTP, IMAP, and so on.</p>
<p class="docText1"><a name="based on" class="calibre8" id="based on"/>OpenSSL is based on the SSLeay library originally developed by Eric A. Young and Tim J. Hudson. SSLeay was an open source implementation of Netscape's Secure Socket Layer protocol, which was used in the Netscape Secure Server and Navigator browser in the mid-1990s.<a name="IDX-CHP-18-0282" class="calibre8" id="IDX-CHP-18-0282"/></p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="resources-id17" class="calibre8" id="resources-id17"/>
<h3 class="docSection1Title" id="-100000">18.2. RESOURCES</h3>
<p class="docText1"><span class="b"><a name="OpenSSL Manual" class="calibre8" id="OpenSSL Manual"/>OpenSSL Manual Pages</span></p>
<p class="docText1"><a class="calibre2" target="_blank" href="http://www.openssl.org/docs">http://www.openssl.org/docs</a></p>
<p class="docText1"><span class="b"><a name="Frequently Asked" class="calibre8" id="Frequently Asked"/>SSL Certificate Frequently Asked Questions</span></p>
<p class="docText1"><a class="calibre2" target="_blank" href="http://www.verisign.com/ssl/ssl-information-center/faq/ssl-basics.html">http://www.verisign.com/ssl/ssl-information-center/faq/ssl-basics.html</a></p>
<p class="docText1"><span class="b">RFC 2246 - The TLS Protocol</span></p>
<p class="docText1"><a class="calibre2" target="_blank" href="http://tools.ietf.org/html/rfc2246">http://tools.ietf.org/html/rfc2246</a></p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="required-id17" class="calibre8" id="required-id17"/>
<h3 class="docSection1Title" id="-100000">18.3. REQUIRED</h3>
<p class="docText1"><img border="0" id="" src="OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg" alt="" class="calibre33"/><a name="FreeBSD " class="calibre8" id="FreeBSD "/> FreeBSD 7.0-RELEASE (see "<a class="calibre2" href="freebsd_7.0_split_000.html#freebsd_7.0">FreeBSD 7.0</a>")<a name="IDX-CHP-18-0283" class="calibre8" id="IDX-CHP-18-0283"/><a name="IDX-CHP-18-0284" class="calibre8" id="IDX-CHP-18-0284"/></p>
<p class="docText1"><img border="0" id="" src="OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg" alt="" class="calibre33"/><a name="collection " class="calibre8" id="collection "/> Updated ports collection (see "<a class="calibre2" href="freebsd_ports_collection.html#freebsd_ports_collection">FreeBSD Ports Collection</a>")</p>
<p class="docText1"><img border="0" id="" src="OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg" alt="" class="calibre33"/> Internet connection</p>
<p class="docText1"><img border="0" id="" src="OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg" alt="" class="calibre33"/> Registered domain name</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="optional-id8" class="calibre8" id="optional-id8"/>
<h3 class="docSection1Title" id="-100000">18.4. OPTIONAL</h3>
<p class="docText1"><img border="0" id="" src="OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg" alt="" class="calibre33"/><a name="Trusted SSL" class="calibre8" id="Trusted SSL"/> Trusted SSL certificate authority (CA) such as GeoTrust, Thawte, Verisign, and so on, if you wish to create industry-trusted SSL Certificates</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="preparation-id17" class="calibre8" id="preparation-id17"/>
<h3 class="docSection1Title" id="-100000">18.5. PREPARATION</h3>
<p class="docText1"><a name="Become the" class="calibre8" id="Become the"/>Become the superuser. This guide assumes that the default search path for root (the superuser) has been changed as outlined in "<a class="calibre2" href="freebsd_7.0_split_000.html#freebsd_7.0">FreeBSD 7.0</a><a name="make this" class="calibre8" id="make this"/>". If you didn't make this modification, specify the full path when executing OpenSSL commands (<span class="docEmphasis1">/usr/local/bin/openssl</span> ).</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="install-id17" class="calibre8" id="install-id17"/>
<h3 class="docSection1Title" id="-100000">18.6. INSTALL</h3>
<p class="docText1"><a name="OpenSSL " class="calibre8" id="OpenSSL "/>OpenSSL 0.9.8e is part of the standard FreeBSD 7.0 distribution. In this guide, we will install an updated version of OpenSSL from the ports collection.</p>
<pre class="calibre30"># <b class="calibre28">cd /usr/ports/security/openssl</b>
# <b class="calibre28">cp Makefile Makefile.old</b>
# <b class="calibre28">echo EXTRACONFIGURE+=no-idea &gt;&gt; Makefile</b>
# <b class="calibre28">make install clean</b>
# <b class="calibre28">rehash</b></pre>
<hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> The second and third commands above prevent the compilation of the license-restricted IDEA encryption algorithm. This is important for the proper functioning of other third-party applications.</span><hr size="1" noshade="noshade" class="calibre27"/>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="configure-id17" class="calibre8" id="configure-id17"/>
<h3 class="docSection1Title" id="-100000">18.7. CONFIGURE</h3>
<p class="docText1"><a name="Once the" class="calibre8" id="Once the"/>Once the installation process is complete, it's time to configure OpenSSL for use on your system.</p>
<div class="calibre34"><ol class="docList" type="1"><li class="calibre16"><div class="calibre35"><p class="docText1">The line <tt class="calibre20">"WITH_OPENSSL_PORT = YES"</tt><a name="be added" class="calibre8" id="be added"/> needs to be added to the <span class="docEmphasis1">make.conf</span> file in <span class="docEmphasis1">/etc</span><a name="built in" class="calibre8" id="built in"/>. This will ensure that ports built in the future are linked to the newer version of OpenSSL. The following commands will add the appropriate line to <span class="docEmphasis1">make.conf</span>.</p><pre class="calibre30"># <b class="calibre28">cp /etc/make.conf /etc/make.conf.old</b>
# <b class="calibre28">echo "WITH_OPENSSL_PORT=YES" &gt;&gt; /etc/make.conf</b></pre>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="old" class="calibre8" id="old"/>Rename the old <span class="docEmphasis1">openssl.cnf</span><a name="it harder" class="calibre8" id="it harder"/> file to make it harder to inadvertently use the old version of OpenSSL when creating certificates. Then copy the sample OpenSSL configuration file to a working copy:</p><pre class="calibre30"># <b class="calibre28">mv /etc/ssl/openssl.cnf /etc/ssl/openssl.cnf.old</b>
# <b class="calibre28">cd /usr/local/openssl</b>
# <b class="calibre28">cp openssl.cnf.sample openssl.cnf</b></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1">You can modify <span class="docEmphasis1">openssl.cnf</span><a name="To verify" class="calibre8" id="To verify"/> to fit your needs, but the defaults are usually sufficient. To verify that the new version is functioning, use the following command:</p><pre class="calibre30"># <b class="calibre28">openssl</b> <b class="calibre28">version</b>
OpenSSL 0.9.8g 19 Oct 2007</pre><br class="calibre1"/>
<p class="docText1"><a name="new version" class="calibre8" id="new version"/>A version later than 0.9.8e signifies that the new version is installed correctly. If the version information still indicates 0.9.8e, you probably haven't modified your default path. This is acceptable as long as you remember to specify the full path to the new version of OpenSSL when using the command-line tool (<span class="docEmphasis1">/usr/local/bin/openssl</span>).</p></div></li></ol></div>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="ssl_certificates-id1" class="calibre8" id="ssl_certificates-id1"/>
<h3 class="docSection1Title" id="-100000">18.8. SSL CERTIFICATES</h3>
<p class="docText1"><a name="In this" class="calibre8" id="In this"/>In this section, SSL Certificates will be created using the <span class="docEmphasis1">CA.pl</span><a name="installed by" class="calibre8" id="installed by"/> script (a Perl script) installed by the OpenSSL port.<a name="IDX-CHP-18-0285" class="calibre8" id="IDX-CHP-18-0285"/></p>
<p class="docText1"><a name="an official" class="calibre8" id="an official"/>If you intend to have an official certificate authority sign your SSL Certificate, proceed to "Generate a Certificate Request for CA Submission." If you want to create a self-signed SSL Certificate, skip to "<a class="calibre2" href="#create_a_self-signed_ssl_certificate">Create a Self-Signed SSL Certificate</a>".</p>
<a name="generate_a_certificate_request" class="calibre8" id="generate_a_certificate_request"/>
<h4 id="title-ID0ET1PM" class="docSection1Title">18.8.1. Generate a Certificate Request for CA Submission</h4>
<p class="docText1"><a name="have an" class="calibre8" id="have an"/>You can have an official certificate authority sign your SSL Certificate by sending a request. Most certificate authorities charge a fee for this service. See "<a class="calibre2" href="notes.html#notes">Notes</a><a name="about the" class="calibre8" id="about the"/>" for more information about the certificate signing process.</p>
<div class="calibre34"><ol class="docList" type="1"><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="in order" class="calibre8" id="in order"/>Certificate authorities will need a certificate request file in order to produce a valid SSL Certificate for your server. We will use the <span class="docEmphasis1">CA.pl</span><a name="certificate request" class="calibre8" id="certificate request"/> script included with OpenSSL to create a certificate request. Let's use the <span class="docEmphasis1">/usr/local/openssl/certs</span><a name="script to" class="calibre8" id="script to"/> directory as your working directory. The command below will copy the script to the working directory:</p><pre class="calibre30"># <b class="calibre28">cd /usr/local/openssl</b>
# <b class="calibre28">cp misc/CA.pl certs</b></pre>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="request using" class="calibre8" id="request using"/>Run the script to create the certificate request using the following commands:</p><pre class="calibre30"># <b class="calibre28">cd /usr/local/openssl/certs</b>
# <b class="calibre28">setenv OPENSSL /usr/local/bin/openssl</b>
# <b class="calibre28">./CA.pl -newreq</b></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="be asked" class="calibre8" id="be asked"/>You will be asked to enter a PEM passphrase. Type one of your choosing. Be sure to remember this passphrase because you will need it later. Fill in the rest of the fields as you would like them to be shown when the public views your certificate. Make sure you enter your hostname in the Common Name prompt or the server certificate will not be valid. (If you were creating an SSL Certificate for a server with the hostname <a class="calibre2" target="_blank" href="http://host.example.com">host.example.com</a><a name="you would" class="calibre8" id="you would"/>, you would enter the Common Name <a class="calibre2" target="_blank" href="http://host.example.com">host.example.com</a>.)</p><hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> You may specify wildcard values in the Common Name field. For example, you could enter <a class="calibre2" target="_blank" href="http://*.example.com">*.example.com</a> as the common name to create an SSL Certificate that would cover any subdomain of <a class="calibre2" target="_blank" href="http://example.com">example.com</a> like <a class="calibre2" target="_blank" href="http://www.example.com">www.example.com</a>, <a class="calibre2" target="_blank" href="http://mail.example.com">mail.example.com</a>, and so on. Be aware that if you do specify a wildcard like <a class="calibre2" target="_blank" href="http://*.example.com">*.example.com</a>, it won't be valid if you're trying to create a certificate for the root domain, <a class="calibre2" target="_blank" href="http://example.com">example.com</a>.</span><hr size="1" noshade="noshade" class="calibre27"/><p class="docText1"><a name="an email" class="calibre8" id="an email"/>After entering an email address, you will be prompted for a challenge password. Just press [enter] twice; the challenge password and company name are optional. You will be returned to the command prompt.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Running the <span class="docEmphasis1">CA.pl</span><a name="created file" class="calibre8" id="created file"/> script gives you a newly created file named <span class="docEmphasis1">newkey.pem</span><a name="your encrypted" class="calibre8" id="your encrypted"/>, which contains your encrypted private server key. To make identification easier, we'll copy this file to <a class="calibre2" target="_blank" href="http://host.example.com-encrypted-key.pem">host.example.com-encrypted-key.pem</a><a name="commands to" class="calibre8" id="commands to"/>. Use the following commands to copy this file (replace <a class="calibre2" target="_blank" href="http://host.example.com">host.example.com</a> with your actual Common Name):</p><pre class="calibre30"># <b class="calibre28">cp newkey.pem</b> <span class="docEmphBoldItalic">host.example.com</span><b class="calibre28">-encrypted-key.pem</b></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="named" class="calibre8" id="named"/>You will also have a newly created file named <span class="docEmphasis1">newreq.pem</span><a name="this file" class="calibre8" id="this file"/> that contains your certificate request. You can submit this file to a certificate authority for signing. For clarity, we'll copy this file to <a class="calibre2" target="_blank" href="http://host.example.com-req.pem">host.example.com-req.pem</a>. Use the following command to copy this file (replace <a class="calibre2" target="_blank" href="http://host.example.com">host.example.com</a> with your actual Common Name):</p><pre class="calibre30"># <b class="calibre28">cp newreq.pem</b> <span class="docEmphBoldItalic">host.example.com</span><b class="calibre28">-req.pem</b></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1">The <a class="calibre2" target="_blank" href="http://host.example.com-encrypted-key.pem">host.example.com-encrypted-key.pem</a><a name="important for" class="calibre8" id="important for"/> file is encrypted with the password you entered earlier. It is important for you to remember this password. You will need to enter it when an SSL application uses it. If this file is going to be used on an unattended server, it may be a good idea to decrypt the file so that daemons are able to load it without user intervention. To remove the encryption and make the unencrypted file readable only to root, use the following commands (replace <a class="calibre2" target="_blank" href="http://host.example.com">host.example.com</a> with your server's hostname):</p><pre class="calibre30"># <b class="calibre28">openssl rsa -in</b> <span class="docEmphBoldItalic">host.example.com</span><b class="calibre28">-encrypted-key.pem\</b>
? <b class="calibre28">-out</b> <span class="docEmphBoldItalic">host.example.com</span><b class="calibre28">-unencrypted-key.pem</b>
# <b class="calibre28">chmod 400</b> <span class="docEmphBoldItalic">host.example.com</span><b class="calibre28">-unencrypted-key.pem</b></pre><br class="calibre1"/>
<p class="docText1"><a name="be the" class="calibre8" id="be the"/>It is important that the root user be the only user to have access to this file. Lack of strict permissions as set above can jeopardize the security of your server certificate.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="certificate authority" class="calibre8" id="certificate authority"/>After the certificate authority signs your certificate request, copy it to the <span class="docEmphasis1">/usr/local/openssl/certs</span><a name="directory and" class="calibre8" id="directory and"/> directory and name it <a class="calibre2" target="_blank" href="http://server.example.com-cert.pem">server.example.com-cert.pem</a><a name="you see" class="calibre8" id="you see"/> or whatever you see fit. Some server applications (Apache HTTP Server, Postfix, etc.) need your certificate authority's root certificate file as well. Most root certificate files are downloadable from the certificate authority's website. Save this file in <span class="docEmphasis1">/usr/local/openssl/certs</span> as <a class="calibre2" target="_blank" href="http://example.com">example.com</a>-<span class="docEmphasis1">CAcert.pem</span>, or using any name you prefer.</p></div></li></ol></div>
<a name="create_a_self-signed_ssl_certificate" class="calibre8" id="create_a_self-signed_ssl_certificate"/>
<h4 id="title-ID0ENAAO" class="docSection1Title">18.8.2. Create a Self-Signed SSL Certificate</h4>
<p class="docText1"><a name="SSL Certificate" class="calibre8" id="SSL Certificate"/>There are times when an SSL Certificate signed by an official certificate authority is not practical or affordable. In these cases, you may want to create and sign your own SSL Certificates by creating your own certificate authority. The easiest way to accomplish this is by using the included certificate authority script (<span class="docEmphasis1">CA.pl</span><a name="the process" class="calibre8" id="the process"/> ) to automate the process as much as possible. Be advised that creating your own certificates will cause an Untrusted Certificate dialog box to appear on client applications (web browsers, email clients, etc.). You can install your server's certificate file on client systems to avoid this warning.<a name="IDX-CHP-18-0286" class="calibre8" id="IDX-CHP-18-0286"/></p>
<div class="calibre34"><ol class="docList" type="1"><li class="calibre16"><div class="calibre35"><p class="docText1">Let's use the <span class="docEmphasis1">/usr/local/openssl/certs</span><a name="working directory" class="calibre8" id="working directory"/> directory as your working directory. We'll also extend the default certificate signing length of 365 days to 1,095 days (3 years). The commands below will copy the script to the working directory and set OpenSSL to create certificates that are good for 3 years:</p><pre class="calibre30"># <b class="calibre28">cd /usr/local/openssl</b>
# <b class="calibre28">cp misc/CA.pl certs</b>
# <b class="calibre28">sed -I .old 's/365/1095/' openssl.cnf</b></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="like this" class="calibre8" id="like this"/>Run the script to create the certificate authority like this:</p><pre class="calibre30"># <b class="calibre28">cd /usr/local/openssl/certs</b>
# <b class="calibre28">setenv OPENSSL /usr/local/bin/openssl</b>
# <b class="calibre28">./CA.pl -newca</b></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="enter a" class="calibre8" id="enter a"/>The first prompt will ask you to enter a CA certificate filename. Since you are creating a new one, just press [enter].</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="one of" class="calibre8" id="one of"/>The second prompt will ask you for a PEM passphrase. Type one of your choosing. Be sure to remember this passphrase because you will need it later. Fill in the rest of the fields as you would like them to be shown when the public views your certificate. The Common Name field can be your company name or something descriptive; it is effectively the name of your certificate. After entering an email address, you will be prompted for a challenge password. Just press [enter] twice; the challenge password and company name are optional. Lastly, you will be prompted to enter a passphrase for <span class="docEmphasis1">./demoCA/private/cakey.pem</span><a name="the beginning" class="calibre8" id="the beginning"/>. Enter the PEM passphrase you chose at the beginning of this step.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="certificate request" class="calibre8" id="certificate request"/>Generate a certificate request with the following command:</p><pre class="calibre30"># <b class="calibre28">./CA.pl -newreq</b></pre><br class="calibre1"/>
<p class="docText1"><a name="You will" class="calibre8" id="You will"/>You will be asked for a passphrase; use the same one you used earlier for simplicity. Enter all of the same information you supplied earlier. Make sure you enter your hostname in the Common Name prompt or the server certificate will not be valid. (If you were creating an SSL Certificate for the website <a class="calibre2" target="_blank" href="https://host.example.com">https://host.example.com</a><a name="enter the" class="calibre8" id="enter the"/>, you would enter the Common Name <span class="docEmphasis1">host</span> <a class="calibre2" target="_blank" href="http://.example.com">.example.com</a>.)</p><hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> You may specify wildcard values in the Common Name field as well. For example, you could enter <a class="calibre2" target="_blank" href="http://*.example.com">*.example.com</a> as the common name to create an SSL Certificate that would cover any subdomain of <a class="calibre2" target="_blank" href="http://example.com">example.com</a> like <a class="calibre2" target="_blank" href="http://www.example.com">www.example.com</a>, <a class="calibre2" target="_blank" href="http://server.example.com">server.example.com</a>, and so on. Be aware that if you do specify a wildcard like <a class="calibre2" target="_blank" href="http://*.example.com">*.example.com</a>, it won't be valid if you're trying to create a certificate for the root domain <a class="calibre2" target="_blank" href="http://example.com">example.com</a>.</span><hr size="1" noshade="noshade" class="calibre27"/><p class="docText1"><a name="will be" class="calibre8" id="will be"/>After entering an email address, you will be prompted for a challenge password. Just press [enter] twice; the challenge password and company name are optional. You will be returned to the command prompt. Don't change the filename of the newly created <span class="docEmphasis1">newreq.pem</span><a name="will be" class="calibre8" id="will be"/> file; the script will be looking for it later.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="certificate from" class="calibre8" id="certificate from"/>Create the signed certificate from the request and certificate authority files you just created. Use the following command to begin the certificate signing process:</p><pre class="calibre30"># <b class="calibre28">./CA.pl -signreq</b></pre><br class="calibre1"/>
<p class="docText1">Enter the password you chose earlier. Answer <span class="b">Yes</span><a name="signed SSL" class="calibre8" id="signed SSL"/> at the next two prompts to create a signed SSL Certificate. The signed SSL Certificate is in the current working directory and named <span class="docEmphasis1">newcert.pem</span><a name="the current" class="calibre8" id="the current"/>. The private key file is also in the current directory and named <span class="docEmphasis1">newkey.pem</span>. The certificate authority and private key certificates reside in the <span class="docEmphasis1">demoCA</span> directory and are named <span class="docEmphasis1">cacert.pem</span> and <span class="docEmphasis1">cakey.pem</span><a name="of them" class="calibre8" id="of them"/> respectively. To make all of these files easily identifiable we'll make copies of them using the following convention: <span class="docEmphasis1">commonName-filetype.pem</span><a name="the" class="calibre8" id="the"/>. The following commands copy all certificates into the <span class="docEmphasis1">/usr/local/openssl/certs</span> directory (replace <a class="calibre2" target="_blank" href="http://host.example.com">host.example.com</a> with your server's hostname).</p><pre class="calibre30"># <b class="calibre28">cp newcert.pem</b> <span class="docEmphBoldItalic">host.example.com</span><b class="calibre28">-cert.pem</b>
# <b class="calibre28">cp newkey.pem</b> <span class="docEmphBoldItalic">host.example.com</span><b class="calibre28">-encrypted-key.pem</b>
# <b class="calibre28">cp demoCA/cacert.pem ./</b><span class="docEmphBoldItalic">example.com-</span><b class="calibre28">CAcert.pem</b>
# <b class="calibre28">cp demoCA/private/cakey.pem ./</b><span class="docEmphBoldItalic">example.com</span><b class="calibre28">-encrypted-CAkey.pem</b></pre><br class="calibre1"/>
<p class="docText1"><a name="two lines" class="calibre8" id="two lines"/>The last two lines don't include the server name <span class="docEmphasis1">host</span><a name="because the" class="calibre8" id="because the"/> because the certificate authority files are not specific to any one system; think of a certificate authority as a parent entity.</p><br class="calibre1"/><div class="calibre25" style="text-align:center">
<img border="0" id="" src="OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjRnMA--.jpg" alt="" class="calibre38"/>
</div><br class="calibre1"/><p class="docText1">The <a class="calibre2" target="_blank" href="http://host.example.com">host.example.com</a>-<span class="docEmphasis1">encrypted-key.pem</span><a name="encrypted with" class="calibre8" id="encrypted with"/> file is encrypted with the password you entered earlier. It is important for you to remember this password. You will need to enter it when an SSL application uses it. If this file is going to be used on an unattended server, it may be a good idea to decrypt this file so that daemons are able to load it without user intervention. To remove the encryption and make the unencrypted file readable only to root, use the following commands, replacing <a class="calibre2" target="_blank" href="http://host.example.com">host.example.com</a> with your domain name:</p><pre class="calibre30"># <b class="calibre28">openssl rsa -in</b> <span class="docEmphBoldItalic">host.example.com</span><b class="calibre28">-encrypted-key.pem\</b>
? <b class="calibre28">-out</b> <span class="docEmphBoldItalic">host.example.com</span><b class="calibre28">-unencrypted-key.pem</b>
# <b class="calibre28">chmod 400</b> <span class="docEmphBoldItalic">host.example.com</span><b class="calibre28">-unencrypted-key.pem</b></pre><br class="calibre1"/>
<p class="docText1"><a name="root user" class="calibre8" id="root user"/>It is important that the root user be the only user to have access to this file (the commands above accomplish this). Lack of strict permissions as set above can risk the security of your server certificate.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="important to" class="calibre8" id="important to"/>It is important to export the CA certificate or <span class="docEmphasis1">root certificate</span> (<a class="calibre2" target="_blank" href="http://example.com">example.com</a>-<span class="docEmphasis1">CAcert.pem</span><a name="in step" class="calibre8" id="in step"/>) that was created in step 2 (page 131) so it can be installed on systems that will utilize your SSL Certificate. This is necessary to eliminate the appearance of Untrusted Root SSL Certificate Warning messages. These messages appear to warn the end user that there is a potential problem with the SSL Certificate. It is more difficult to detect an actual hijacked SSL session if this unnecessary warning isn't eliminated. Most client systems (Windows XP and Mac OS X) recognize SSL Certificate files encoded in DER (Distinguished Encoding Rules) binary format. To convert your PEM (Privacy Enhanced Mail) text based certificate to the DER format, type the following command:</p><pre class="calibre30"># <b class="calibre28">openssl x509 -in</b> <span class="docEmphBoldItalic">example.com</span><b class="calibre28">-CAcert.pem -inform PEM\</b>
? <b class="calibre28">-out</b> <span class="docEmphBoldItalic">example.com</span><b class="calibre28">-CAcert.cer -outform DER</b></pre><br class="calibre1"/>
<p class="docText1"><a name="email with" class="calibre8" id="email with"/>You can send your DER encoded certificate via email with this command:</p><pre class="calibre30"># <b class="calibre28">uuencode</b> <span class="docEmphBoldItalic">example.com</span><b class="calibre28">-CAcert.cer</b> <span class="docEmphBoldItalic">example.com</span><b class="calibre28">-CAcert.cer\</b> ? <b class="calibre28">| mail -s "</b>
<span class="docEmphBoldItalic">Subject</span><b class="calibre28">"</b> <span class="docEmphasis1">user@example.com</span></pre><br class="calibre1"/>
<p class="docText1">Substitute your filenames appropriately (the second instance of <a class="calibre2" target="_blank" href="http://example.com">example.com</a>-<span class="docEmphasis1">CAcert.cer</span><a name="would like" class="calibre8" id="would like"/> can be replaced with a filename you would like the recipient to see) and replace <tt class="calibre20"><i class="docEmphasis1">Subject</i></tt> with an appropriate email subject line. <a class="calibre2" href="mailto:user@example.com.html">user@example.com</a> can be any valid email address.</p></div></li></ol></div>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="config_files-id17" class="calibre8" id="config_files-id17"/>
<h3 class="docSection1Title" id="-100000">18.9. CONFIG FILES</h3>
<p class="docText1">/usr/local/openssl/openssl.cnf<a name="IDX-CHP-18-0287" class="calibre8" id="IDX-CHP-18-0287"/></p>
<p class="docText1"><a name="Contains defaults" class="calibre8" id="Contains defaults"/>Contains defaults for the OpenSSL command-line tool</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="notes-id13" class="calibre8" id="notes-id13"/>
<h3 class="docSection1Title" id="-100000">18.10. NOTES</h3>
<ul class="calibre15"><li class="calibre16"><p class="docText1"><a name="Certificate authorities" class="calibre8" id="Certificate authorities"/>Certificate authorities that sign SSL Certificates usually charge a variable fee. Be advised that if you self-sign your SSL Certificate, client programs will display a dialog to users explaining that the certificate is not in the trusted root database. This can confuse users who aren't familiar with the technology. If a small number of known users will be accessing your server with SSL, you can give each user a copy of your server's root certificate to install into their client application to eliminate this warning message (see step 7 on page 133).</p></li><li class="calibre16"><p class="docText1"><a name="a certificate" class="calibre8" id="a certificate"/>CAcert is a certificate authority that issues free SSL Certificates. If you are new to SSL Certificates, the site is a good place to learn about the SSL Certificate signing process. You can create a certificate signing request as outlined in this guide and have it signed by CAcert. Certificates signed by CAcert have limited support; most web browsers do not include its root certificate in their database of trusted CAs. CAcert's root certificate is, however, included in FreeBSD and several Linux distributions. Visit CAcert on the Web at <a class="calibre2" target="_blank" href="http://cacert.org">http://cacert.org</a>.</p></li><li class="calibre16"><p class="docText1"><a name="Certificates and" class="calibre8" id="Certificates and"/>If you are creating self-signed SSL Certificates and wish to create another one (e.g., if you are adding an additional server to your network), start at step 5 on page 132. (Remember to assign a Common Name consistent with your server's hostname.)</p></li></ul>
</div></div>

</body></html>