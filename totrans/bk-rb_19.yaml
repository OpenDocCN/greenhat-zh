- en: Chapter 19. Ruby on Rails
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 19 章。Ruby on Rails
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages860138.png.jpg)'
  id: totrans-1
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages860138.png.jpg)'
- en: Rails has become so closely connected with Ruby that it is now quite commonplace
    for people to talk about programming “in” Ruby on Rails as though “Ruby on Rails”
    were the name of the programming language.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: Rails 已经与 Ruby 结合得如此紧密，以至于现在人们谈论编程“在” Ruby on Rails 时，好像“Ruby on Rails”就是编程语言的名字。
- en: In fact, Rails is a framework—a set of tools and code libraries—that can be
    used in cahoots with Ruby. It gives you the ability to develop database-driven
    websites that respond to user interaction. For example, users might enter and
    save data on one page and search for data on other pages. This makes Rails suitable
    for creating dynamic websites that generate web pages “on the fly” rather than
    loading up static, predesigned pages. Typical applications include collaborative
    sites such as online communities, multi-author books or wikis, shopping sites,
    discussion forums, and blogs.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，Rails 是一个框架——一组工具和代码库，可以与 Ruby 一起使用。它使您能够开发响应用户交互的数据库驱动型网站。例如，用户可以在一个页面上输入和保存数据，在其他页面上搜索数据。这使得
    Rails 适合创建动态网站，这些网站可以“即时”生成网页，而不是加载静态、预先设计的页面。典型应用包括协作网站，如在线社区、多作者书籍或维基百科、购物网站、讨论论坛和博客。
- en: I’ll provide a hands-on guide to creating a blog shortly. First, though, let’s
    take a closer look at the nitty-gritty details of the Rails framework.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 我将很快提供创建博客的实战指南。首先，让我们更详细地了解一下 Rails 框架的细节。
- en: Note
  id: totrans-5
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: This chapter will give you a taste of developing in Ruby on Rails. Bear in mind,
    however, that Rails is a big and complex framework, and I will cover only the
    fundamental features. At the time of writing, Rails 3 is the latest version, but
    Rails 2 is still widely used; therefore, both versions are covered in this chapter.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将为您展示在 Ruby on Rails 中开发的感觉。然而，请注意，Rails 是一个庞大且复杂的框架，我只会介绍其基本功能。在撰写本文时，Rails
    3 是最新版本，但 Rails 2 仍然被广泛使用；因此，本章将涵盖这两个版本。
- en: Installing Rails
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装 Rails
- en: Rails is not a standard part of Ruby, so you may need to install it as a separate
    operation. Note that Ruby and Rails ship as standard with some operating systems,
    such as Mac OS X. There is, however, no guarantee that these are the latest versions,
    and you may want to update the default installation manually.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: Rails 不是 Ruby 的标准部分，因此您可能需要将其作为单独的操作安装。请注意，Ruby 和 Rails 在某些操作系统（如 Mac OS X）中作为标准软件提供，但无法保证这些是最新版本，您可能需要手动更新默认安装。
- en: Do It Yourself . . .
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: DIY ...
- en: There are various ways in which Rails can be installed. The easiest way is to
    use an all-in-one installer (some alternatives are described in this chapter).
    However, you may also install Rails and the tools it requires one at a time. Rails
    may be installed using the Ruby Gems “package manager.” As long as you are connected
    to the Internet, Ruby Gems will go online to find and install the latest version
    of Rails.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 安装 Rails 有多种方式。最简单的方法是使用一站式安装程序（本章中描述了一些替代方案）。然而，您也可以逐个安装 Rails 和它所需的工具。Rails
    可以使用 Ruby Gems “软件包管理器”进行安装。只要您连接到互联网，Ruby Gems 就会在线查找并安装 Rails 的最新版本。
- en: Note
  id: totrans-11
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: For Ruby Gems documentation, go to [http://docs.rubygems.org/](http://docs.rubygems.org/).
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取 Ruby Gems 文档，请访问 [http://docs.rubygems.org/](http://docs.rubygems.org/)。
- en: 'At the command prompt, enter the following:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 在命令提示符下，输入以下内容：
- en: '[PRE0]'
  id: totrans-14
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'If, instead of installing the latest version, you want to install a specific
    version of Rails, you should append `--version=` followed by the appropriate version
    number when entering the previous command. For example, to install Rails 2.3.8,
    enter the following:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您不想安装最新版本，而是想安装特定版本的 Rails，您应该在输入上一条命令时附加 `--version=` 后跟适当的版本号。例如，要安装 Rails
    2.3.8，请输入以下内容：
- en: '[PRE1]'
  id: totrans-16
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Alternatively, you can download and install Rails from the Ruby on Rails website,
    [http://www.rubyonrails.org/](http://www.rubyonrails.org/). Most Rails applications
    require a database, which you will need to install as a separate operation. Many
    people use either SQLite or the free MySQL database server. MySQL is the more
    powerful of the two systems and is used on many professional websites. However,
    many people find SQLite simpler to use for local development of Ruby applications.
    Installation of SQLite varies according to which operating system is being used.
    SQLite3 is pre-installed on Mac OS X Leopard.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，你可以从 Ruby on Rails 网站 [http://www.rubyonrails.org/](http://www.rubyonrails.org/)
    下载并安装 Rails。大多数 Rails 应用程序都需要一个数据库，你将需要单独安装它。许多人使用 SQLite 或免费的 MySQL 数据库服务器。MySQL
    是这两个系统中功能更强大的一个，被许多专业网站使用。然而，许多人发现 SQLite 对于 Ruby 应用的本地开发来说更容易使用。SQLite 的安装根据所使用的操作系统而有所不同。SQLite3
    预安装在 Mac OS X Leopard 上。
- en: 'Installation of SQLite3 can be notably tricky on Windows. You should begin
    by running this command at the command line:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Windows 上安装 SQLite3 可能相当棘手。你应该首先在命令行中运行以下命令：
- en: '[PRE2]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Pay close attention to the message that is displayed when this executes. This
    tells you which version of the SQLite3 DLL you need to install and the web address
    from which you can download it. This DLL is a requirement. Failure to install
    it will mean that SQLite3 will not be available for use with Rails. This message
    will state something like this:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 仔细注意执行时显示的消息。这会告诉你需要安装哪个版本的 SQLite3 DLL 以及你可以从中下载它的网址。这个 DLL 是必需的。如果没有安装它，SQLite3
    将无法与 Rails 一起使用。此消息将类似于以下内容：
- en: '[PRE3]'
  id: totrans-21
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Be sure to follow the instructions, download the correct DLL, and copy it into
    the *\bin* directory beneath your Ruby installation.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 一定要按照说明操作，下载正确的 DLL，并将其复制到 Ruby 安装下的 *\bin* 目录中。
- en: 'Refer to the SQLite site for more information on SQLite: [http://www.sqlite.org/docs.html](http://www.sqlite.org/docs.html).
    You can find installation help on MySQL in [Appendix B](apb.html "Appendix B. Installing
    MySQL for Ruby on Rails") of this book. Many other database servers can also be
    used including Microsoft SQL Server, PostgresSQL, and Oracle.'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 请参考 SQLite 网站，获取有关 SQLite 的更多信息：[http://www.sqlite.org/docs.html](http://www.sqlite.org/docs.html).
    你可以在本书的附录 B（apb.html "附录 B. 为 Ruby on Rails 安装 MySQL"）中找到有关 MySQL 安装的说明。还可以使用许多其他数据库服务器，包括
    Microsoft SQL Server、PostgreSQL 和 Oracle。
- en: Note
  id: totrans-24
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If you plan to install or update Rails from scratch or if you need to update
    the version pre-installed with your operating system, you should refer to Rails
    Guides website at [http://guides.rubyonrails.org/getting_started.html](http://guides.rubyonrails.org/getting_started.html).
    These guides provide detailed OS-specific information relating to Rails 3\. Several
    Rails wikis also provide information on supporting older versions of Rails—for
    example, [http://en.wikibooks.org/wiki/Ruby_on_Rails](http://en.wikibooks.org/wiki/Ruby_on_Rails).
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你计划从头开始安装或更新 Rails，或者如果你需要更新操作系统预先安装的版本，你应该参考 Rails 指南网站：[http://guides.rubyonrails.org/getting_started.html](http://guides.rubyonrails.org/getting_started.html).
    这些指南提供了有关 Rails 3 的详细操作系统特定信息。几个 Rails 维基也提供了有关支持旧版 Rails 的信息——例如，[http://en.wikibooks.org/wiki/Ruby_on_Rails](http://en.wikibooks.org/wiki/Ruby_on_Rails)。
- en: Or Use an “All-in-One” Installer
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 或者使用“一体化”安装程序
- en: 'Various all-in-one Ruby and Rails setup programs are available. These include
    the Bitnami RubyStack installers for Windows, Linux, and Mac: [http://www.bitnami.org/stack/rubystack/](http://www.bitnami.org/stack/rubystack/).
    Windows users can also use the Rails installer from RubyForge: [http://www.rubyforge.org/frs/?group_id=167](http://www.rubyforge.org/frs/?group_id=167).
    These installers provide their own installation guides.'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 可用的各种 Ruby 和 Rails 一体化设置程序包括针对 Windows、Linux 和 Mac 的 Bitnami RubyStack 安装程序：[http://www.bitnami.org/stack/rubystack/](http://www.bitnami.org/stack/rubystack/).
    Windows 用户还可以使用来自 RubyForge 的 Rails 安装程序：[http://www.rubyforge.org/frs/?group_id=167](http://www.rubyforge.org/frs/?group_id=167).
    这些安装程序提供了它们自己的安装指南。
- en: Model-View-Controller
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 模型-视图-控制器
- en: 'A Rails application is divided into three main areas: the Model, the View,
    and the Controller. Put simply, the Model is the data part—the database and any
    programmatic operations (such as calculations) that are done upon that data. The
    View is what the end user sees; in Rails terms, that generally means the web pages
    that appear in the browser. The Controller is the programming logic—the “glue”
    that joins the Model to the View.'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: Rails应用分为三个主要区域：模型、视图和控制器。简单来说，模型是数据部分——数据库以及在该数据上执行的所有程序性操作（如计算）。视图是最终用户看到的内容；在Rails术语中，这通常意味着浏览器中出现的网页。控制器是编程逻辑——将模型与视图连接在一起的“胶水”。
- en: The Model-View-Controller methodology is used in various forms by all kinds
    of programming languages and frameworks. It is more fully described in [Digging
    Deeper](ch19s10.html#digging_deeper-id18 "Digging Deeper") in [Digging Deeper](ch19s10.html#digging_deeper-id18
    "Digging Deeper"). For the sake of brevity, I will henceforward call it MVC.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 模型-视图-控制器（MVC）方法被各种编程语言和框架以各种形式使用。它在[深入挖掘](ch19s10.html#digging_deeper-id18
    "深入挖掘")中的[深入挖掘](ch19s10.html#digging_deeper-id18 "深入挖掘")部分有更详细的描述。为了简洁起见，我将从此称其为MVC。
- en: A First Ruby on Rails Application
  id: totrans-31
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第一个Ruby on Rails应用
- en: Without more ado, let’s start programming with Rails. I’ll assume you have Rails
    installed, along with a web server. I happen to be using the WEBrick server, which
    is installed as standard with Rails, but you may use some other server such as
    Apache, LightTPD, or Mongrel. You can find more information on web servers in
    [Appendix D](apd.html "Appendix D. Ruby and Rails Development Software").
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 不再赘述，让我们开始用Rails编程。我将假设你已经安装了Rails，以及一个网络服务器。我恰好使用的是WEBrick服务器，它是随Rails标准安装的，但你也可以使用其他服务器，如Apache、LightTPD或Mongrel。你可以在[附录D](apd.html
    "附录D. Ruby和Rails开发软件")中找到有关网络服务器的更多信息。
- en: Note
  id: totrans-33
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: A web server is a program that delivers data, such as web pages, using the Hypertext
    Transfer Protocol (HTTP). You don’t need to understand how this works. You just
    need to be aware that you need a web server for use with Rails.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 一个网络服务器是一个使用超文本传输协议（HTTP）提供数据（如网页）的程序。你不需要理解它是如何工作的。你只需要知道，你需要一个网络服务器来与Rails一起使用。
- en: This chapter assumes you are using only the “raw” Rails development tools—programs
    that are executed from the command line—plus, at the very least, a text editor
    and a web browser; as a consequence, you will find that you frequently have to
    enter commands at the system prompt. If you are using an integrated development
    environment for Rails, you will probably be able to accomplish these tasks much
    more easily using the tools provided by the IDE.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 本章假设你只使用“原始”Rails开发工具——从命令行执行的程序——以及至少一个文本编辑器和网络浏览器；因此，你会发现你经常需要在系统提示符下输入命令。如果你使用的是Rails的集成开发环境，你可能会发现使用IDE提供的工具可以更容易地完成这些任务。
- en: 'Unlike the source code examples supplied for the other chapters in this book,
    the sample code for the Ruby on Rails applications in this chapter is not complete
    and “ready to run.” There are three reasons for this:'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 与本书其他章节提供的源代码示例不同，本章中Ruby on Rails应用的示例代码并不完整，也不是“可直接运行”的。这有三个原因：
- en: Each Rails application comprises a great many files and folders, most of which
    are autogenerated by Rails, so it would be pointless to distribute them separately.
  id: totrans-37
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每个Rails应用都包含大量文件和文件夹，其中大部分是由Rails自动生成的，因此分别分发它们是没有意义的。
- en: I would also have to supply the data for each database, and you would have to
    import it prior to using it. Importing databases is often more difficult than
    creating your own.
  id: totrans-38
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我还必须为每个数据库提供数据，你必须在使用之前导入它。导入数据库通常比创建自己的数据库更困难。
- en: Not only is it simpler to create Rails applications yourself, but doing so will
    also help you understand how Rails works. I have, however, supplied some sample
    files—component parts of a complete application—with which you can compare your
    own code in case you run into problems.
  id: totrans-39
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 不仅自己创建Rails应用更简单，而且这样做也有助于你理解Rails是如何工作的。然而，我已经提供了一些示例文件——一个完整应用的组成部分——你可以用它们来比较你的代码，以防你遇到问题。
- en: Create a Rails Application
  id: totrans-40
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建一个Rails应用
- en: For the sake of simplicity, this first application will not use a database at
    all. This will let you explore the View and the Controller without having to worry
    about the complexities of the Model.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 为了简化，这个第一个应用将完全不使用数据库。这将让你在不必担心模型复杂性的情况下探索视图和控制器。
- en: 'To begin, open a system prompt (on Windows, select the Start menu, and enter
    **`cmd`** into the Run or Search box). Navigate to a directory into which you
    intend to place your Rails applications. Let’s assume this is *C:\railsapps*.
    Check that Rails is installed and that its home directory is on the system path.
    To do this, enter the following:'
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，打开系统提示符（在 Windows 中，选择开始菜单，并在运行或搜索框中输入 **`cmd`**）。导航到你打算放置 Rails 应用程序的目录。让我们假设这是
    *C:\railsapps*。检查 Rails 是否已安装，并且其主目录是否在系统路径上。为此，请输入以下内容：
- en: '[PRE4]'
  id: totrans-43
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: If all is well, you should now see a screenful of help about using the `rails`
    command. If you don’t see this, there is a problem with your Rails installation
    that you need to fix before continuing. Refer to [Installing Rails](ch19.html#installing_rails
    "Installing Rails") in [Installing Rails](ch19.html#installing_rails "Installing
    Rails").
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一切顺利，你现在应该能看到关于使用 `rails` 命令的帮助信息的一屏内容。如果你没有看到这个，那么你的 Rails 安装可能存在问题，你需要修复它才能继续。请参考[安装
    Rails](ch19.html#installing_rails "安装 Rails")中的[安装 Rails](ch19.html#installing_rails
    "安装 Rails")。
- en: Note
  id: totrans-45
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: When there are any differences in the commands or code for Rails 2 and Rails
    3, these will be indicated in the text with the Rails version number—Rails 2 or
    Rails 3—in the margin next to the example.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 当 Rails 2 和 Rails 3 的命令或代码存在差异时，文本中会在示例旁边用 Rails 版本号（Rails 2 或 Rails 3）来指明。
- en: 'Assuming Rails is working, you can now create an application. Enter this:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 假设 Rails 正在运行，你现在可以创建一个应用程序。输入以下命令：
- en: '*Rails 3*'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 3*'
- en: '[PRE5]'
  id: totrans-49
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '*Rails 2*'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 2*'
- en: '[PRE6]'
  id: totrans-51
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'After a bit of whirring of your hard disk, you should see a list of the files
    that Rails has just created (the actual list is quite long, and some of the items
    created are different in Rails 2 and Rails 3):'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的硬盘嗡嗡作响了一段时间后，你应该会看到 Rails 刚刚创建的文件列表（实际的列表相当长，并且 Rails 2 和 Rails 3 中创建的一些项是不同的）：
- en: '[PRE7]'
  id: totrans-53
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Take a look at these files using your computer’s file manager. Beneath the
    directory in which you ran the Rails command (*\helloworld*), you will see that
    several new directories have been created: *\app*, *\config*, *\db*, and so on.
    Some of these have subdirectories. The *\app* directory, for example, contains
    *\controllers*, *\helpers*, *\models*, and *\views*. The *\views* directory itself
    contains a subdirectory, *\layouts*.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 使用你的计算机文件管理器查看这些文件。在运行 Rails 命令的目录（*\helloworld*）下，你会看到已经创建了几个新的目录：*\app*，*\config*，*\db*
    等等。其中一些有子目录。例如，*\app* 目录包含 *\controllers*，*\helpers*，*\models* 和 *\views*。*\views*
    目录本身还包含一个子目录，*\layouts*。
- en: The directory structure in a Rails application is far from random; the directories
    (or *folders*) and the names of the files they contain define the relationships
    between the various parts of the application. The idea behind this is that by
    adopting a well-defined file-and-folder structure, you can avoid the necessity
    of writing lots of configuration files to link the various bits of the application
    together. There is a simplified guide to the default directory structure of Rails
    in [Digging Deeper](ch19s10.html#digging_deeper-id18 "Digging Deeper") in [Digging
    Deeper](ch19s10.html#digging_deeper-id18 "Digging Deeper").
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: Rails 应用程序的目录结构远非随机；目录（或*文件夹*）以及它们包含的文件名称定义了应用程序各个部分之间的关系。背后的想法是，通过采用一个定义良好的文件和文件夹结构，你可以避免编写大量的配置文件来连接应用程序的各个部分。Rails
    默认目录结构的简化指南可以在[深入挖掘](ch19s10.html#digging_deeper-id18 "深入挖掘")中的[深入挖掘](ch19s10.html#digging_deeper-id18
    "深入挖掘")找到。
- en: 'Now, at the system prompt, change the directory to the top-level folder (*\helloworld*)
    of your newly generated Rails application. Assuming you are still in the *C:\railsapps*
    directory and you named the Rails application *helloworld*, as suggested earlier,
    you would (on Windows) enter this command to change to that directory:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，在系统提示符下，将目录更改为新创建的 Rails 应用程序的最高级文件夹（*\helloworld*）。假设你仍然在 *C:\railsapps*
    目录中，并且你将 Rails 应用程序命名为 *helloworld*，如之前建议的，你会在 Windows 中输入以下命令来切换到该目录：
- en: '[PRE8]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Now run the server. If (like me) you are using WEBrick, you should enter the
    following:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 现在运行服务器。如果你（像我一样）使用 WEBrick，你应该输入以下命令：
- en: '*Rails 3*'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 3*'
- en: '[PRE9]'
  id: totrans-60
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '*Rails 2*'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 2*'
- en: '[PRE10]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'Note that servers other than WEBrick may be started in different ways, and
    if the previous does not work, you will need to consult the server’s documentation.
    You should now see something similar to the following:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，除了 WEBrick 之外的服务器可能以不同的方式启动，如果前面的方法不起作用，你需要查阅服务器的文档。你现在应该看到以下类似的内容：
- en: '[PRE11]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Problems?
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 问题？
- en: 'If, instead of seeing a message confirming that the server has started, you
    see error messages, check that you have entered the server command exactly as
    shown for the version of Rails being used, and check that it is run from within
    the appropriate directory: *\helloworld*.'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您没有看到确认服务器已启动的消息，而是看到错误消息，请检查您是否已按照所使用的 Rails 版本准确输入了服务器命令，并检查它是否在适当的目录中运行：*\helloworld*。
- en: 'If you still have problems, it is possible that the default port (3000) is
    already in use—for example, if you already have an Apache server installed on
    the same PC. In that case, try some other value such as `3003`, placing this number
    after `-p` when you run the script:'
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您仍然有问题，可能是默认端口（3000）已经被占用——例如，如果您在同一台 PC 上已经安装了 Apache 服务器。在这种情况下，尝试使用其他值，例如
    `3003`，在运行脚本时将此数字放在 `-p` 之后：
- en: '[PRE12]'
  id: totrans-68
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '[PRE13]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: If you see error messages that include the text `no such file to load -- sqlite3`,
    be sure you have correctly installed SQLite3 as explained in [Installing Rails](ch19.html#installing_rails
    "Installing Rails") in [Installing Rails](ch19.html#installing_rails "Installing
    Rails"). If you are attempting to use MySQL and the error message includes the
    text `no such file to load–mysql`, refer to [Appendix B](apb.html "Appendix B. Installing
    MySQL for Ruby on Rails").
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您看到包含文本 `no such file to load -- sqlite3` 的错误消息，请确保您已正确安装 SQLite3，如 [安装 Rails](ch19.html#installing_rails
    "安装 Rails") 中所述。如果您正在尝试使用 MySQL，并且错误消息包含文本 `no such file to load–mysql`，请参阅 [附录
    B](apb.html "附录 B. 为 Ruby on Rails 安装 MySQL")。
- en: '*Rails 3*'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 3*'
- en: '*Rails 2*'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 2*'
- en: 'Now fire up a web browser. Enter the host name, followed by a colon and the
    port number, into its address bar. The host name should (normally) be *localhost*,
    and the port number should match the one used when starting the server, or else
    it defaults to 3000\. Here is an example:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，打开一个网页浏览器。将主机名和冒号以及端口号输入其地址栏中。主机名应该是（通常）*localhost*，端口号应该与启动服务器时使用的端口号匹配，否则默认为
    3000。以下是一个示例：
- en: '[PRE14]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: The browser should now display a page welcoming you aboard Rails. If not, verify
    that your server is running on the port specified in the URL.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 浏览器现在应该显示一个欢迎您加入 Rails 的页面。如果没有，请确认您的服务器正在运行在 URL 中指定的端口上。
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages860169.png.jpg)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages860169.png.jpg)'
- en: Create a Controller
  id: totrans-77
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建控制器
- en: As mentioned earlier, a Controller is where much of your Ruby code will live.
    It is the part of the application that sits between the View (what appears in
    the browser) and the Model (what happens to the data). Because this is a “Hello
    world” application, let’s create a Controller to say “hello.” In the spirit of
    originality, I’ll call this the *SayHello* controller. Once again, you can create
    this by running a script at the system prompt. You will need to open another command
    window in the directory from which you previously ran the server script (for example,
    *C:\railsapps\helloworld*). You can’t reuse your existing command window because
    the server is running in that one, and you would need to close it down to get
    back to the prompt—and that would stop your Rails application from working!
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，控制器是您大部分 Ruby 代码存放的地方。它是应用程序中位于视图（浏览器中显示的内容）和模型（数据发生的事情）之间的部分。因为这是一个“Hello
    world”应用程序，让我们创建一个控制器来显示“hello”。本着原创精神，我将称之为 *SayHello* 控制器。再次提醒，您可以通过在系统提示符下运行脚本来创建它。您需要打开另一个命令窗口，该窗口位于您之前运行服务器脚本的目录中（例如，*C:\railsapps\helloworld*）。您不能重复使用现有的命令窗口，因为服务器正在该窗口中运行，您需要关闭它才能回到提示符——这将停止您的
    Rails 应用程序工作！
- en: 'At the prompt, enter this (be sure to use the capitalization of `SayHello`
    as shown):'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 在提示符下，输入以下内容（请确保使用与 `SayHello` 显示的相同的大小写）：
- en: '*Rails 3*'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 3*'
- en: '[PRE15]'
  id: totrans-81
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '*Rails 2*'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 2*'
- en: '[PRE16]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'After a few moments, you will be informed that various files and directories
    have been created, including the following:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 几分钟后，您将被告知已创建各种文件和目录，包括以下内容：
- en: '[PRE17]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Note
  id: totrans-86
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: The `generate controller` script also creates the file *application_controller.rb*
    in Rails 3 or *application.rb* in Rails 2, which is the controller for the entire
    application, plus a folder, */views/say_hello*, which you will make use of shortly.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: '`generate controller` 脚本还在 Rails 3 中创建了 *application_controller.rb* 文件，或在 Rails
    2 中创建了 *application.rb* 文件，这是整个应用程序的控制器，还有一个文件夹，*/views/say_hello*，您将很快使用到它。'
- en: Notice how Rails has parsed the name `SayHello` into two lowercase words, `say`
    and `hello`, separated by an underscore, and it has used this name as the first
    part of the generated Ruby files such as `say_hello_controller.rb`. This is just
    one example of the “configuration by convention” approach that Rails uses.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 注意 Rails 如何将名称 `SayHello` 解析为两个由下划线分隔的小写单词 `say` 和 `hello`，并使用此名称作为生成 Ruby 文件（如
    `say_hello_controller.rb`）的第一部分。这只是 Rails 使用“约定配置”方法的一个例子。
- en: 'Locate the controller file *say_hello_controller.rb*, which has been created
    in *\helloworld\app\controllers*. Open this file in a text editor. This empty
    method has been autogenerated:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 定位控制器文件 *say_hello_controller.rb*，该文件已创建在 *\helloworld\app\controllers* 中。在文本编辑器中打开此文件。此空方法已被自动生成：
- en: '[PRE18]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Inside this class you can write some code to be executed when a certain page
    is displayed. Edit the class definition to match the following:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个类中，你可以编写一些代码，当显示某个页面时执行。编辑类定义以匹配以下内容：
- en: '[PRE19]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'This now contains two methods, `index` and `bye`. Each method contains a single
    line of code. In spite of the fact that I have omitted parentheses (a parentheses-light
    style of coding is favored by many Rails developers), you can probably deduce
    that `render` is a method that takes a hash as an argument; the hash itself contains
    a key-value pair comprising a symbol and a string. For parentheses-lovers, the
    `index` method can be rewritten like this:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 现在包含两个方法，`index` 和 `bye`。每个方法包含一行代码。尽管我省略了括号（许多 Rails 开发者喜欢轻量级的括号风格），但你可能推断出
    `render` 是一个接受哈希作为参数的方法；该哈希本身包含一个由符号和字符串组成的键值对。对于喜欢括号的开发者，`index` 方法可以重写如下：
- en: '[PRE20]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'And there you have your first real Rails application. To try it, you need to
    go back to the web browser and enter the full “address” of the two functions you
    just wrote. But first you may need to restart your server. Just press ctrl-C in
    the command window where the server is running. When the server exits, restart
    by entering the following:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 有了你的第一个真正的 Rails 应用程序。要尝试它，你需要回到网页浏览器并输入你刚刚编写的两个函数的完整“地址”。但在做之前，你可能需要重新启动服务器。只需在运行服务器的命令窗口中按
    ctrl-C。当服务器退出后，通过输入以下内容重新启动：
- en: '*Rails 3*'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 3*'
- en: '[PRE21]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '*Rails 2*'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 2*'
- en: '[PRE22]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'There’s just one more thing you have to do in Rails 3\. You need to tell it
    how to find a “route” specified by an address entered into web browser. This step
    is not required for Rails 2\. In Rails 3, open the *routes.rb* file in your *helloworld\config\*
    folder. Now edit it to match the following (or simply uncomment the line of code
    that you’ll find at the bottom of the file):'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Rails 3 中，你还需要做一件事。你需要告诉 Rails 如何通过在网页浏览器中输入的地址找到“路由”。这一步在 Rails 2 中不是必需的。在
    Rails 3 中，打开 *helloworld\config\* 文件夹中的 *routes.rb* 文件。现在编辑它以匹配以下内容（或者简单地取消注释文件底部的代码行）：
- en: '[PRE23]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'You are now ready to test the application. To do so, you just need to enter
    an address to access a controller method. The address takes the form of the host
    and port (the same as you entered previously—for example, *http://localhost:3000*),
    plus the name of the controller (*/say_hello*) and finally the name of a specific
    method (*/index* or */bye*). Try entering these, as shown next, into your browser’s
    address field, once again ensuring that you are using the appropriate port number
    if it is not 3000:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 你现在可以测试应用程序了。为此，你只需输入一个地址来访问控制器方法。地址的格式为主机和端口（与之前输入的相同——例如，*http://localhost:3000*），然后是控制器的名称（*/say_hello*），最后是特定方法的名称（*/index*
    或 */bye*）。尝试将这些内容，如以下所示，输入到浏览器的地址栏中，同时确保如果你不是使用 3000 端口，请使用正确的端口号：
- en: '[PRE24]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Your browser should display “Hello world” and “Bye bye” respectively for each
    address. If all is working at this point, you can bathe in the warm glow of having
    created your first Ruby on Rails application. If however, you are seeing MySQL
    database errors, read [Can’t Find the Database?](apbs04.html "Can’t Find the Database?")
    in [Configuring MySQL](apbs03.html "Configuring MySQL") and fix the problem before
    continuing.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 你的浏览器应该分别显示“Hello world”和“Bye bye”对应于每个地址。如果到目前为止一切正常，你可以沉浸在你创建了第一个 Ruby on
    Rails 应用程序的温暖光辉中。然而，如果你看到 MySQL 数据库错误，请阅读 [找不到数据库？](apbs04.html "找不到数据库？") 在 [配置
    MySQL](apbs03.html "配置 MySQL") 中，并在继续之前修复问题。
- en: 'Incidentally, Rails uses the `index` method as a default so you can use the
    index view as your home page and omit that part of the URL when entering the address
    into the browser:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 顺便提一下，Rails 使用 `index` 方法作为默认值，因此你可以使用 index 视图作为你的主页，并在将地址输入到浏览器时省略该部分：
- en: '[PRE25]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Anatomy of a Simple Rails Application
  id: totrans-107
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 简单 Rails 应用的解剖
- en: 'Before moving on, let’s take a closer look at the class that you have created
    in this application. Rails has named the class by appending *Controller* to the
    name you specified when running the controller generator script (`HelloWorld`),
    and it has made it a descendant of the ApplicationController class:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 在继续之前，让我们仔细看看你在本应用中创建的类。Rails通过在运行控制器生成脚本时指定的名称后添加`*Controller*`来命名这个类（`HelloWorld`），并且使其成为`ApplicationController`类的后代：
- en: '[PRE26]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'But what exactly is the ApplicationController class? You may recall that I
    mentioned that the `generate controller` script you ran earlier silently created
    a file called *application_controller.rb* (Rails 3) or *application.rb* (Rails
    2) inside the */app/controllers* folder. This file is the application controller,
    and if you open it, you will see that it contains a class called as follows:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 但`ApplicationController`类究竟是什么呢？你可能还记得，我提到你之前运行的`generate controller`脚本默默地创建了一个名为`*application_controller.rb*`（Rails
    3）或`*application.rb*`（Rails 2）的文件，位于`/app/controllers`文件夹内。这个文件就是应用控制器，如果你打开它，你会看到它包含一个名为以下内容的类：
- en: '[PRE27]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: So, the SayHelloController class descends from the ApplicationController class
    that itself descends from the Base class in the `ActionController` module. You
    can prove this by climbing back through the hierarchy and asking each class to
    display itself. This, incidentally, also gives you the chance to try doing some
    real Ruby programming in the SayHelloController class.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，`SayHelloController`类继承自`ApplicationController`类，而`ApplicationController`类本身又是`ActionController`模块中`Base`类的后代。你可以通过回溯层次结构并要求每个类显示自己来证明这一点。顺便说一句，这也给你提供了一个机会，在`SayHelloController`类中尝试做一些真正的Ruby编程。
- en: 'Just edit the contents of *say_hello_controller.rb* file to match the following
    (or copy and paste the code from the *sayhello1.rb* file in the code archive for
    this chapter):'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 只需编辑`say_hello_controller.rb`文件的内容，使其与以下内容匹配（或者从本章代码存档中的`*sayhello1.rb*`文件复制粘贴代码）：
- en: '*sayhello1.rb*'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '`*sayhello1.rb*`'
- en: '[PRE28]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'To see the result, enter this address into your browser (once again, change
    the port number if necessary):'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 要查看结果，请将以下地址输入到你的浏览器中（再次提醒，如果需要，请更改端口号）：
- en: '[PRE29]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Your web browser should now display the following (in Rails 3):'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 你的网络浏览器现在应该显示以下内容（在Rails 3中）：
- en: '[PRE30]'
  id: totrans-119
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'In Rails 2 it will display the following:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 在Rails 2中，它将显示以下内容：
- en: '[PRE31]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: Don’t worry about the actual class ancestry; the internal implementation details
    of the Rails framework are not of immediate interest. The important thing to understand
    is that a controller is a real Ruby object that inherits behavior from the ApplicationController
    class and its ancestors. Any Rails controller class you write or that is autogenerated
    by running scripts can contain normal Ruby code, just like all the other classes
    you’ve written in previous chapters. Within a controller, you can use all the
    usual Ruby classes such as strings and hashes.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 不要担心实际的类继承关系；Rails框架的内部实现细节并不立即引起兴趣。重要的是要理解，控制器是一个真正的Ruby对象，它从`ApplicationController`类及其祖先那里继承行为。你编写的任何Rails控制器类，或者通过运行脚本自动生成的控制器类，都可以包含正常的Ruby代码，就像你在前几章中编写的所有其他类一样。在控制器内部，你可以使用所有常见的Ruby类，如字符串和散列。
- en: 'But bear in mind that the end result needs to be displayed in a web page. This
    has certain consequences. For example, instead of putting linefeeds (`"\n"`) into
    strings, you should use HTML paragraph (`<P>`) or break (`<br />`) tags, and it
    is only permissible to call `render` once each time a page is displayed, which
    explains why I’ve constructed a string in the course of calling the method recursively
    and then passed this to the `render` method right at the end:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 但请记住，最终结果需要在网页上显示。这带来了一些后果。例如，不要在字符串中放入换行符（`"\n"`），而应使用HTML段落（`<P>`）或换行（`<br
    />`）标签，并且每次页面显示时只能调用一次`render`方法，这也解释了为什么我在递归调用方法的过程中构建了一个字符串，然后在最后直接将这个字符串传递给`render`方法：
- en: '[PRE32]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: The Generate Controller Script Summarized
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 生成控制器脚本的总结
- en: Before moving on, let’s consolidate the fundamental details of running the Rails
    `generate controller` script and learn a few extra tricks you can use when creating
    views. Each time a new controller is generated, it creates a Ruby code file in
    the *app/controllers* directory, with a name matching the name you entered but
    all in lowercase, with any noninitial capitals that you specified being preceded
    by an underscore and *_controller* appended. So, if you entered *SayHello*, the
    controller file will be called *say_hello_controller.rb*. The controller will
    contain a class definition such as `SayHelloController`. You may subsequently
    add to this class some “view methods” such as `index` and `bye`. Alternatively,
    you may use the `generate` script to create one or more empty view methods automatically
    by including those view names when you execute the script.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 在继续之前，让我们总结一下运行 Rails `generate controller` 脚本的基本细节，并学习一些在创建视图时可以使用的额外技巧。每次生成新的控制器时，它都会在
    *app/controllers* 目录中创建一个 Ruby 代码文件，文件名与输入的名称匹配，但全部小写，任何非首字母大写的名称前面都带有下划线，并且附加了
    *_controller*。所以，如果你输入了 *SayHello*，控制器文件将被命名为 *say_hello_controller.rb*。控制器将包含一个类定义，例如
    `SayHelloController`。你可以随后向这个类添加一些“视图方法”，例如 `index` 和 `bye`。或者，你可以使用 `generate`
    脚本在执行脚本时通过包含那些视图名称来自动创建一个或多个空的视图方法。
- en: 'For example, you could run this script:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，你可以运行以下脚本：
- en: '*Rails 3*'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 3*'
- en: '[PRE33]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: '*Rails 2*'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 2*'
- en: '[PRE34]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Rails will now create the file *say_hello_controller.rb*, containing this code:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: Rails 现在将创建名为 *say_hello_controller.rb* 的文件，其中包含以下代码：
- en: '[PRE35]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: Whether or not you specify views, a folder in the */views* directory is created
    with a name matching the controller (*views/say_hello*). In fact, the script also
    creates a few other files including some more Ruby files in the */helpers* folder,
    but in our simple application you can ignore these files.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 无论你是否指定了视图，都会在 */views* 目录下创建一个与控制器名称匹配的文件夹（*views/say_hello*）。实际上，脚本还会创建一些其他文件，包括
    */helpers* 文件夹中的更多 Ruby 文件，但在我们的简单应用程序中，你可以忽略这些文件。
- en: 'If you specified view names when running the controller script, some files
    with matching names and the extension *.html.erb* will be added to the appropriate
    view folder. For instance, if you entered the following command:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在运行控制器脚本时指定了视图名称，将添加一些与名称匹配且扩展名为 *.html.erb* 的文件到相应的视图文件夹中。例如，如果你输入了以下命令：
- en: '[PRE36]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'the */views/say_hello* directory should now contain a file called *xxx.html.erb*.
    If, on the other hand, you entered the following:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: '*/views/say_hello* 目录现在应该包含一个名为 *xxx.html.erb* 的文件。另一方面，如果你输入了以下命令：'
- en: '[PRE37]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'the *views/blather* directory should now contain three files: *xxx.html.erb*,
    *bye.html.erb*, and *snibbit.html.erb*.'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '*/views/blather* 目录现在应该包含三个文件：*xxx.html.erb*、*bye.html.erb* 和 *snibbit.html.erb*。'
- en: Create a View
  id: totrans-140
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建视图
- en: It would be possible to create an entire application by coding everything inside
    a Controller and doing all the formatting inside view methods. However, you would
    soon end up with some pretty ugly web pages. To apply more formatting, you need
    to create a View that more accurately defines the layout of a web page.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 你完全可以在控制器内部编写所有代码，并在视图方法内部进行所有格式化来创建整个应用程序。然而，你很快就会得到一些相当丑陋的网页。要应用更多格式化，你需要创建一个更精确定义网页布局的视图。
- en: You can think of a View as an HTML page that will be displayed when someone
    logs onto a specific web address—in which case, the name of the View forms the
    final part of the address as in the previous examples where the */index* and */bye*
    parts of the URL took you to views that displayed data supplied by the `index`
    and `bye` methods in the Controller.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以将视图想象成一个当有人登录到特定网址时将显示的 HTML 页面——在这种情况下，视图的名称构成了地址的最后一部分，就像之前的例子中 */index*
    和 */bye* 部分将你带到显示控制器中 `index` 和 `bye` 方法提供的数据的视图一样。
- en: You can create HTML view “templates” that match these web addresses and the
    corresponding method names. Using an HTML (or plaintext) editor, create a file
    named *index.html.erb* in the *\app\views\say_hello* directory, if such a template
    does not already exist. Remember, as explained previously (in [The Generate Controller
    Script Summarized](ch19s07.html "The Generate Controller Script Summarized") in
    [The Generate Controller Script Summarized](ch19s07.html "The Generate Controller
    Script Summarized")), you can optionally autocreate one or more view templates
    when you initially generate the Controller.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以创建与这些网页地址和相应方法名称匹配的 HTML 视图“模板”。使用 HTML（或纯文本）编辑器，在 *\app\views\say_hello*
    目录中创建一个名为 *index.html.erb* 的文件，如果该模板尚未存在。记住，如前所述（在 [The Generate Controller Script
    Summarized](ch19s07.html "The Generate Controller Script Summarized") 中），在最初生成控制器时，你可以选择自动创建一个或多个视图模板。
- en: Now that you have a view template, you can edit it in order to control the way
    data is displayed in the web page. That means you won’t need to display plain,
    unformatted text using the `render` method in the Controller from now on. But,
    with the View being out of the Controller’s control (so to speak), how can the
    Controller pass data to the View? In turns out that it can do this by assigning
    data to an instance variable.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你有了视图模板，你可以编辑它来控制网页中数据的显示方式。这意味着你将不再需要使用控制器中的 `render` 方法来显示未经格式化的文本。但是，由于视图不再受控制器控制（或者说，是这样），控制器如何将数据传递给视图呢？结果是，它可以通过将数据分配给实例变量来实现这一点。
- en: 'Edit the code in *say_hello_controller.rb* (or delete it and paste in the code
    from the file *sayhello2.rb*, supplied in the source code archive) so that it
    matches the following:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 编辑 *say_hello_controller.rb* 中的代码（或者删除它，并将源代码存档中提供的 *sayhello2.rb* 文件中的代码粘贴进来）以确保它符合以下要求：
- en: '*sayhello2.rb*'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: '*sayhello2.rb*'
- en: '[PRE38]'
  id: totrans-147
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: This version calls the `showFamily()` method in order to build up a string inside
    two HTML “unordered list” tags, `<ul>` and `</ul>`. Each time a class name is
    found, it is placed between two HTML “list item” tags, `<li>` and `</li>`. The
    complete string forms a valid HTML fragment, and the `index` method simply assigns
    this string a variable named `@class_hierarchy`.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 这个版本调用 `showFamily()` 方法，以便在两个 HTML “无序列表” 标签 `<ul>` 和 `</ul>` 内部构建一个字符串。每次找到一个类名时，它就被放置在两个
    HTML “列表项” 标签 `<li>` 和 `</li>` 之间。完整的字符串形成一个有效的 HTML 片段，而 `index` 方法只是将这个字符串分配给一个名为
    `@class_hierarchy` 的变量。
- en: HTML Tags in the Controller?
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 控制器中的 HTML 标签？
- en: Some Ruby on Rails developers object to having *any* HTML tags, no matter how
    -trivial, included in the Controller code. In my opinion, if you intend to display
    the end results in a web page, it little matters where you put the odd `<p>`,
    `<ul>`, or `<li>` tag. Although the MVC paradigm encourages strong separation
    between the program code of the Controller and the layout definition of the View,
    you will inevitably have to make some compromises—at the very least by putting
    some program code into the View. Avoiding the use of HTML tags in the Controller
    is, largely, an aesthetic rather than a pragmatic objection. I personally have
    no very strong views on the subject, though (be warned!) other people do.
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 一些 Ruby on Rails 开发者反对在控制器代码中包含任何 HTML 标签，无论它们多么 - 微不足道。在我看来，如果你打算在网页中显示最终结果，你放置的
    `<p>`、`<ul>` 或 `<li>` 标签的位置几乎无关紧要。尽管 MVC 范式鼓励控制器程序代码和视图布局定义之间有很强的分离，但你不可避免地必须做出一些妥协——至少是将一些程序代码放入视图。避免在控制器中使用
    HTML 标签在很大程度上是一种审美上的反对，而不是实际的反对。尽管如此（警告！），其他人对此有很强的看法。
- en: All you need to do now is to find some way of putting that HTML fragment into
    a fully formed HTML page. That’s where the View comes in. Open the view file you
    just created, *index.html.erb*, in the *app/views/say_hello* folder. According
    to the Rails naming convention, this is the default view (the “index” page) that
    is partnered with the *say_hello_controller.rb* file. Since Rails works out relationships
    based on file, folder, class, and method names, you don’t have to load or require
    any files by name or write any configuration details.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你需要做的就是找到一种方法将这个 HTML 片段放入一个完整的 HTML 页面中。这就是视图的作用所在。打开你刚刚创建的视图文件，*index.html.erb*，在
    *app\views\say_hello* 文件夹中。根据 Rails 的命名约定，这是与 *say_hello_controller.rb* 文件配对的默认视图（“index”页面）。由于
    Rails 根据文件、文件夹、类和方法名称来确定关系，因此你不需要按名称加载或要求任何文件，也不需要编写任何配置细节。
- en: 'In the *index.html.erb* file, add this:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *index.html.erb* 文件中，添加以下内容：
- en: '[PRE39]'
  id: totrans-153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'The first line is nothing more than plain HTML formatting that defines the
    text enclosed by the `<h1></h1>` tags as a heading. The next line is more interesting.
    It contains the variable `@class_hierarchy`. Look back at the `index` method in
    *say_hello_controller.rb*, and you’ll see that this is the variable to which you
    assigned a string. Here in the View, `@class_hierarchy` is placed between two
    odd-looking delimiters: `<%=` and `%>`. These are special Rails tags. They are
    used to embed bits of Ruby that will be executed prior to displaying a web page
    in the browser. The page that is finally displayed will be a fully formed HTML
    page that includes any HTML fragments from the view template plus the results,
    after execution, of any embedded Ruby code. Try it now, by entering the page address
    into your browser:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 第一行仅仅是普通的HTML格式化，它将 `<h1></h1>` 标签内的文本定义为标题。下一行更有趣。它包含变量 `@class_hierarchy`。回顾一下
    *say_hello_controller.rb* 中的 `index` 方法，你会看到这是你分配字符串的变量。在这里的视图中，`@class_hierarchy`
    被放置在两个看起来奇怪的定界符 `<%=` 和 `%>` 之间。这些是特殊的Rails标签。它们用于嵌入在浏览器显示网页之前将执行的Ruby代码片段。最终显示的页面将是一个完整的HTML页面，包括视图模板中的任何HTML片段以及嵌入的Ruby代码执行后的结果。现在尝试一下，通过在浏览器中输入页面地址来试试：
- en: '[PRE40]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'This should now display the heading “This is the Controller’s Class Hierarchy”
    in big, bold letters followed by a list of classes each element of which is preceded
    by a dot. In Rails 2, this is what you’ll see:'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 这应该现在以大号粗体字母显示标题“这是控制器的类层次结构”，后面跟着一个类列表，每个元素前面都有一个点。在Rails 2中，你会看到如下内容：
- en: '[PRE41]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'However, in Rails 3, you seem to have a problem. Instead of a list, the HTML
    tags are rendered literally like this:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在Rails 3中，你似乎遇到了一个问题。不是列表，HTML标签被直接渲染，如下所示：
- en: '[PRE42]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'This definitely is not what you want. The explanation for this is that the
    default treatment of HTML tags embedded in strings has changed between Rails 2
    and Rails 3\. In Rails 2, tags were passed through to the View unmodified. In
    Rails 3, substitution is done to ensure that HTML tags are displayed on the screen
    rather than rendered by the browser. For example, the `<li>` tag is changed to
    `&lt;li&gt;` where `&lt;` and `&gt;` are the HTML codes for angle brackets (`<`
    and `>`). To ensure that HTML tags are not substituted in this way, you need to
    use the `raw` method, passing to it a string argument. This is *index.html.erb*
    rewritten for Rails 3:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 这绝对不是你想要的。这种解释的原因是，Rails 2 和 Rails 3 之间字符串中嵌入的HTML标签的默认处理方式已经发生了变化。在Rails 2中，标签被未经修改地传递到视图中。在Rails
    3中，进行了替换以确保HTML标签在屏幕上显示，而不是由浏览器渲染。例如，`<li>` 标签被更改为 `&lt;li&gt;`，其中 `&lt;` 和 `&gt;`
    是HTML代码中的尖括号 (`<` 和 `>`)。为了确保HTML标签不以这种方式替换，你需要使用 `raw` 方法，并传递一个字符串参数。这是为Rails
    3重写的 *index.html.erb*：
- en: '[PRE43]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: Now when you log onto the address [http://localhost:3000/say_hello](http://localhost:3000/say_hello)
    in Rails 3, you should see class names shown as a bulleted list with no HTML tags
    displayed.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 现在当你登录到Rails 3的地址 [http://localhost:3000/say_hello](http://localhost:3000/say_hello)
    时，你应该看到以无HTML标签显示的列表形式显示的类名。
- en: 'You could, if you want, remove all the HTML from the view file by creating
    the heading in the Controller and assigning the resulting string to another variable.
    You can do this by editing the `index` method in *say_hello_controller.rb* to
    this:'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想的话，可以通过在控制器中创建标题并将结果字符串分配给另一个变量来从视图文件中移除所有HTML。你可以通过编辑 *say_hello_controller.rb*
    中的 `index` 方法来实现这一点：
- en: '[PRE44]'
  id: totrans-164
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Then edit the view file *(/app/views/say_hello/index.html.erb*) to match the
    code shown next (or cut and paste the code from the sample file into *index.html.erb*)
    for use with Rails 3:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 然后编辑视图文件 *(/app/views/say_hello/index.html.erb*) 以匹配下面的代码（或者将代码从示例文件复制粘贴到 *index.html.erb*）以用于Rails
    3：
- en: '*say_hello_rails3.html.erb*'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '*say_hello_rails3.html.erb*'
- en: '[PRE45]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'For Rails 2, use this code:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 对于Rails 2，使用此代码：
- en: '*say_hello.html.erb*'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: '*say_hello.html.erb*'
- en: '[PRE46]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: If you do this, the end result, as displayed in the web page, will remain unchanged.
    All that’s happened is that some formatting has been moved out of the view template
    and into the Controller.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你这样做，网页上显示的最终结果将保持不变。所发生的一切只是将一些格式化从视图模板移动到了控制器中。
- en: Rails Tags
  id: totrans-172
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Rails 标签
- en: 'There are two variations on the Rails tags that you can place into Rails HTML
    Embedded Ruby (ERb) template files. The ones you’ve used so far include an equal
    sign in the opening delimiter: `<%=`.'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以在Rails HTML嵌入式Ruby (ERb) 模板文件中放置两种Rails标签的变体。你迄今为止使用的那些包括在开标签中的等号：`<%=`.
- en: 'These tags cause Rails not only to evaluate Ruby expressions but also to display
    the results in a web page. If you omit the equals sign from the opening delimiter,
    then the code will be evaluated, but the result will not be displayed: `<%`.'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 这些标签不仅使Rails评估Ruby表达式，还将结果显示在网页上。如果你从开头的分隔符中省略等号，那么代码将被评估，但结果将不会显示：`<%>`。
- en: Note
  id: totrans-175
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: ERb files contain a mix of HTML markup and Ruby code between tags such as `<%=`
    and `%>`. Rails processes these files before the final pages are displayed in
    the web browser, executing the embedded Ruby and constructing the HTML page as
    a result.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: ERb文件包含HTML标记和Ruby代码的混合，这些代码位于`<%=`和`%>`等标签之间。Rails在最终页面在浏览器中显示之前处理这些文件，执行嵌入式Ruby并构建HTML页面。
- en: 'If you want, you can place quite long pieces of code—your entire Ruby program
    even!—between `<%` and `%>` tags and then use `<%=` and `%>` when you want to
    display something in the web page. In fact, you could rewrite your application
    by omitting the Controller entirely and putting everything into the View. Try
    it by editing *app/views/say_hello/index.html.erb* to match the following (or
    copy and paste the code from the file *embed_ruby_rails2.html.erb* or *embed_ruby_rails3.html.erb*
    according to the Rails version being used):'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想，你可以在`<%`和`%>`标签之间放置相当长的代码块——甚至是你整个Ruby程序！——然后当你想在网页中显示某些内容时，使用`<%=`和`%>`。实际上，你可以通过完全省略控制器并将所有内容放入视图来重写你的应用程序。尝试通过编辑`*app/views/say_hello/index.html.erb*`来匹配以下内容（或者根据所使用的Rails版本，从文件`*embed_ruby_rails2.html.erb*`或`*embed_ruby_rails3.html.erb*`中复制并粘贴代码）：
- en: '*embed_ruby_rails3.rhtml*'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '*embed_ruby_rails3.rhtml*'
- en: '[PRE47]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: In this particular case, the text displayed in the web page will be slightly
    different from before since it now shows the class hierarchy of the *view’s* class,
    rather than that of the controller’s class. As you will see, the view descends
    from the ActionView::Base class.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个特定的情况下，网页上显示的文本将与之前略有不同，因为它现在显示的是视图类的类层次结构，而不是控制器类的类层次结构。正如你将看到的，视图是从ActionView::Base类派生出来的。
- en: 'You can also divide a contiguous block of code by placing the individual lines
    between `<%` and `%>` tags instead of placing the entire block between a single
    pair. The advantage of doing this is that it lets you put standard HTML tags outside
    the individually delimited lines of Ruby code. You could, for instance, put this
    into a view:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以通过将单独的行放在`<%`和`%>`标签之间来分割连续的代码块，而不是将整个块放在单个标签对中。这样做的好处是，它允许你将标准HTML标签放在Ruby代码的单独分隔行之外。例如，你可以将其放入一个视图中：
- en: '[PRE48]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Here, I’ve assigned an array of chars to the variable, `arr`, between one set
    of tags. I’ve written a block to reverse-sort the array and assigned the result
    to another variable between a second set of tags. Then I’ve assigned 1 to the
    variable, `i`; and finally I’ve written this method:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我已经将一个字符数组分配给变量`arr`，并在一组标签之间编写了一个块来逆序排序数组，并将结果分配给另一组标签之间的另一个变量。然后我将1分配给变量`i`；最后，我编写了这个方法：
- en: '[PRE49]'
  id: totrans-184
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'But instead of enclosing the method between a single set of `<% %>` tags, I’ve
    enclosed each separate line within its own pair of tags. Why should I do this?
    Well, there are two reasons. First, I want the string in the middle of the block
    to be displayed on the web page, so I need to use the `<%=` tag there:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 但是，我并没有将方法包含在单个`<% %>`标签对中，而是将每行代码分别包含在其自己的标签对中。我为什么要这样做呢？好吧，有两个原因。首先，我想在块中间显示字符串，所以我在那里需要使用`<%=`标签：
- en: '[PRE50]'
  id: totrans-186
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'And second, I want the whole set of strings to be displayed as an HTML list.
    So, I’ve placed the `<ul>` and `</ul>` tags before and after the Ruby code block,
    and I’ve placed the line of code that displays each array item inside `<li>` and
    `</li>` tags. Notice that these tags are *inside* the Ruby code block but *outside*
    the embedded Ruby tags on this particular line:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 其次，我想将整个字符串集显示为一个HTML列表。因此，我在Ruby代码块前后放置了`<ul>`和`</ul>`标签，并将显示每个数组项的代码行放在`<li>`和`</li>`标签内。请注意，这些标签在Ruby代码块内部，但在特定行的嵌入式Ruby标签外部：
- en: '[PRE51]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: So, by dividing up a contiguous block of Ruby code into separately delimited
    lines, I am no longer forced to construct strings to contain HTML tags. Instead,
    I have been able to do the useful trick of mixing HTML into the Ruby code itself.
    To be honest, I haven’t really mixed it in at all—the Ruby code is still closed
    off inside the tags; what I’ve done is told Rails to mix in the HTML at specific
    points prior to displaying the page in a web browser.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，通过将连续的Ruby代码块分割成单独分隔的行，我就不再被迫构建包含HTML标签的字符串。相反，我能够做到将HTML混合到Ruby代码本身中的有用技巧。说实话，我并没有真正混合它们——Ruby代码仍然封闭在标签内；我所做的是告诉Rails在网页浏览器显示页面之前在特定点混合HTML。
- en: 'Incidentally, you may find it interesting to compare the version of the application
    that puts all the embedded Ruby code into the view (*index.html.erb*) with the
    previous version in which the code was all put into the Controller (the version
    of *say_hello_controller.rb* supplied in the sample file *sayhello2.rb*) and only
    tiny bits of embedded Ruby (a couple of variables) were placed into the view:'
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 顺便说一句，你可能觉得将所有嵌入的Ruby代码放入视图（*index.html.erb*）的应用程序版本与之前版本进行比较很有趣，在之前的版本中，所有的代码都放入了控制器（在示例文件*sayhello2.rb*中提供的*say_hello_controller.rb*版本）中，只有一小部分嵌入的Ruby（几个变量）被放入了视图：
- en: '[PRE52]'
  id: totrans-191
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: You will probably agree that the first version, in which the programming logic
    was put into the Controller rather than embedded into the View, is neater. On
    the whole, Ruby code belongs in Ruby code files, and HTML formatting belongs in
    HTML files. Although embedded Ruby provides an easy way of letting a View and
    a Controller communicate, it is generally better to keep embedded Ruby code short
    and simple and put more complex Ruby code into Ruby code files.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能会同意，第一个版本，其中编程逻辑被放入控制器而不是嵌入到视图中，更为整洁。总的来说，Ruby代码属于Ruby代码文件，HTML格式化属于HTML文件。尽管嵌入的Ruby提供了一种让视图和控制器通信的简单方法，但通常最好将嵌入的Ruby代码保持简短和简单，并将更复杂的Ruby代码放入Ruby代码文件中。
- en: Let’s Make a Blog!
  id: totrans-193
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 让我们创建一个博客吧！
- en: For many people, the one thing that really “turned them on” to Ruby on Rails
    was the 20-minute demo given by Rails’s creator, David Heinemeier Hansson, in
    which he showed how to create a simple weblog. That demo was originally done using
    Rails 1 and has since been updated (and changed somewhat) for Rails 2 and Rails
    3\. You can watch the latest demos online at [http://www.rubyonrails.com/screencasts/](http://www.rubyonrails.com/screencasts/).
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 对于许多人来说，真正让他们对Ruby on Rails产生兴趣的是Rails的创造者David Heinemeier Hansson提供的20分钟演示，他展示了如何创建一个简单的博客。这个演示最初是用Rails
    1完成的，后来已经更新（并且有所改变）以适应Rails 2和Rails 3。你可以在[http://www.rubyonrails.com/screencasts/](http://www.rubyonrails.com/screencasts/)上观看最新的演示。
- en: A blog is a great way to show how easy it is to create a fairly complex application
    using Rails. In the remainder of this chapter, I’ll explain how you can create
    a very simple blog application. I’ll use a feature called *migrations*, which
    will cut out a lot of the hard work of creating the database structure of the
    Model.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 博客是一个很好的方式来展示使用Rails创建一个相当复杂的应用程序是多么容易。在本章的剩余部分，我将解释如何创建一个非常简单的博客应用程序。我将使用一个名为*migrations*的功能，这将减少创建模型数据库结构的许多繁琐工作。
- en: Bear in mind that I have tried to keep the creation of this application as simple
    as possible. It is not an exact duplication of David Heinemeier Hansson’s tutorial,
    and it has only a subset of the features of a fully functional blog (there are
    no user comments and no administration interface, for example). Once you have
    completed my blog application, you may want to study the screencast tutorials
    mentioned earlier. These will show you alternative ways of producing similar results,
    and they will also take you further toward the creation of a more complex blog.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，我已经尽量使这个应用程序的创建尽可能简单。它并不是David Heinemeier Hansson的教程的精确复制，它只包含了一个功能齐全的博客的子集功能（例如，没有用户评论和没有管理界面）。一旦你完成了我的博客应用程序，你可能想研究前面提到的屏幕录像教程。这些教程将展示如何以不同的方式产生类似的结果，并且它们也会帮助你进一步学习如何创建一个更复杂的博客。
- en: Note
  id: totrans-197
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: You can compare the code of your blog application with one I created. My code
    is supplied in the *\blog* subdirectory of the code accompanying this chapter.
    This blog application is not “ready to run,” however, because it requires a database
    that you will have to create. You should create your own blog application by following
    the instructions given in the chapter. You may use the supplied code as a reference
    to check that the files you create match the ones I created.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以将您的博客应用程序的代码与我创建的代码进行比较。我的代码包含在本章代码的 *\blog* 子目录中。然而，这个博客应用程序并不是“可直接运行”的，因为它需要一个您必须创建的数据库。您应按照章节中给出的说明创建自己的博客应用程序。您可以使用提供的代码作为参考，以检查您创建的文件是否与我创建的文件匹配。
- en: 'Open a command prompt in the directory in which you keep your Rails applications
    (for example, *C:\railsapps*), and execute a command to create an application
    called Blog:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 在您保存 Rails 应用程序的目录中打开一个命令提示符（例如，*C:\railsapps*），并执行一个创建名为 Blog 的应用程序的命令：
- en: '*Rails 3*'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 3*'
- en: '[PRE53]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: '*Rails 2*'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 2*'
- en: '[PRE54]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: Create the Database
  id: totrans-204
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建数据库
- en: Now let’s create a database. Here I am assuming you are using either the SQLite3
    or MySQL database. As said earlier, SQLite3 is regarded as the standard database
    system for local development with Rails 3, and it is easier to set up and use.
    MySQL, on the other hand, is an industry-standard database that is more likely
    to be used for deployment on a website. If you are using SQLite3, you won’t need
    to take any special actions to create the database—Rails does it for you. You
    can skip straight to [Scaffolding](ch19s10.html#scaffolding "Scaffolding") in
    [Creating a MySQL Database](ch19s10.html#creating_a_mysql_database "Creating a
    MySQL Database"). If you are using MySQL, you should follow the steps outlined
    in the next sections.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们创建一个数据库。这里我假设您正在使用 SQLite3 或 MySQL 数据库。如前所述，SQLite3 被认为是 Rails 3 本地开发的标准化数据库系统，它更容易设置和使用。另一方面，MySQL
    是一个行业标准数据库，更可能用于在网站上部署。如果您使用 SQLite3，您不需要采取任何特殊行动来创建数据库——Rails 会为您完成。您可以直接跳转到
    [Scaffolding](ch19s10.html#scaffolding "Scaffolding") 在 [创建 MySQL 数据库](ch19s10.html#creating_a_mysql_database
    "创建 MySQL 数据库")。如果您使用 MySQL，您应遵循下一节中概述的步骤。
- en: Creating a MySQL Database
  id: totrans-206
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建 MySQL 数据库
- en: 'If you are using MySQL, open a MySQL prompt by running the MySQL Command Line
    Client from the MySQL program group. When prompted, enter your MySQL password.
    Now you should see this prompt:'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您正在使用 MySQL，通过从 MySQL 程序组中运行 MySQL 命令行客户端来打开一个 MySQL 提示符。当提示输入时，输入您的 MySQL
    密码。现在您应该看到以下提示：
- en: '[PRE55]'
  id: totrans-208
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Enter the following at the prompt (be sure to put the semicolon at the end):'
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 在提示符下输入以下内容（确保在末尾放置分号）：
- en: '[PRE56]'
  id: totrans-210
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: MySQL should reply “Query OK” to confirm that the database has been created.
    Now ensure that your database configuration file for your Rails application contains
    the appropriate entries for the development database. If you are using some other
    database (not MySQL), your configuration entries must refer to that database.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL 应该回复“Query OK”以确认数据库已创建。现在请确保您的 Rails 应用程序的数据库配置文件包含开发数据库的适当条目。如果您使用其他数据库（不是
    MySQL），您的配置条目必须引用该数据库。
- en: 'Go to the folder in which Rails created your new blog application, and open
    the file *database.yml* in the *\config\* subdirectory. Assuming you are using
    MySQL, enter *mysql* as the adapter, *localhost* as the host, your MySQL username
    (for example, *root*), and your password, if you have one. The database name should
    match the database you just created. Here is an example (where you would enter
    an actual password instead of *`mypassword`*):'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 前往 Rails 创建的新博客应用程序所在的文件夹，并在 *\config\* 子目录中打开 *database.yml* 文件。假设您正在使用 MySQL，将
    *mysql* 作为适配器，*localhost* 作为主机，您的 MySQL 用户名（例如，*root*），以及如果您有的话，您的密码。数据库名称应与您刚刚创建的数据库相匹配。以下是一个示例（您将输入实际的密码而不是
    *`mypassword`*）：
- en: '[PRE57]'
  id: totrans-213
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: Note
  id: totrans-214
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: If the server is running when you make changes to *database.yml*, you should
    restart the server afterward!
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在您修改 *database.yml* 时服务器正在运行，您应该在之后重新启动服务器！
- en: It is common to have multiple configurations—for example, for development, test,
    and production. For the sake of simplicity, here you will create a development
    configuration only; you may comment out any other entries in *database.yml*.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 通常会有多个配置——例如，用于开发、测试和生产。为了简单起见，这里您将只创建一个开发配置；您可以在 *database.yml* 中注释掉任何其他条目。
- en: Scaffolding
  id: totrans-217
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 框架
- en: 'You are going to use a feature called *scaffolding* to create a model, views,
    and controllers all in one go. Scaffolding is a convenient way of getting a simple
    application up and running quickly. Move into the new *\blog* directory, and enter
    the following at the system prompt:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 你将使用一个名为*脚手架*的功能来一次性创建模型、视图和控制器。脚手架是一种快速将简单应用程序搭建起来的便捷方式。进入新的*\blog*目录，并在系统提示符下输入以下内容：
- en: '*Rails 3*'
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 3*'
- en: '[PRE58]'
  id: totrans-220
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: '*Rails 2*'
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 2*'
- en: '[PRE59]'
  id: totrans-222
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: This tells the scaffold generator to create a model comprising Ruby code to
    access a database table called *post* with three columns, *title*, *body*, and
    *created_at*, each of which has the data type (*string*, *text* and *datetime*)
    specified after the colon. To create the database structure based on this model,
    you need to run a “migration” to update the database table itself.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 这告诉脚手架生成器创建一个由Ruby代码组成的模型，以访问名为*post*的数据库表，该表有三个列，*title*、*body*和*created_at*，每个列后面都指定了数据类型（*string*、*text*和*datetime*）。为了根据此模型创建数据库结构，你需要运行一个“迁移”来更新数据库表本身。
- en: Migration
  id: totrans-224
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 迁移
- en: 'The scaffold script has created a database migration file for you. Navigate
    to the *\db\migrate* directory. You will see that this contains a numbered migration
    file whose name ends with *_create_posts.rb*. If you open this file, you can see
    how the table structure is represented in Ruby code:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 脚本已经为你创建了一个数据库迁移文件。导航到*\db\migrate*目录。你会看到这个目录包含一个以*_create_posts.rb*结尾的编号迁移文件。如果你打开这个文件，你可以看到表结构是如何用Ruby代码表示的：
- en: '[PRE60]'
  id: totrans-226
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: An application may, over time, gain numerous migrations, each of which contains
    information on a specific iteration of the Model—changes and additions made to
    the table structure of the database. Experienced Rails developers can use migrations
    selectively to activate different versions of the Model. Here, however, you will
    use this migration to create the initial structure of the database.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 一个应用程序可能会随着时间的推移而获得许多迁移，每个迁移都包含有关模型特定迭代的详细信息——对数据库表结构的更改和添加。经验丰富的Rails开发者可以使用迁移来选择性地激活模型的不同的版本。然而，在这里，你将使用这个迁移来创建数据库的初始结构。
- en: 'At the system prompt in your application’s main directory (for example, */blog*),
    you can use the `rake` tool to run the migration. Enter this command:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的应用程序主目录的系统提示符下（例如，*/blog*），你可以使用`rake`工具来运行迁移。输入以下命令：
- en: '[PRE61]'
  id: totrans-229
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: After a few moments, you should see a message stating that the `rake` task has
    completed and that CreatePosts has been migrated.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 几分钟后，你应该会看到一个消息，说明`rake`任务已完成，并且CreatePosts已迁移。
- en: Partials
  id: totrans-231
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 部分内容
- en: Now let’s create a new partial view template. A *partial* is a fragment of a
    web page template that Rails may insert, at runtime, into one or more complete
    web pages. If, for example, you plan to have the same data entry form in multiple
    pages on your site, you could create that form inside a partial template. The
    names of partial templates begin with an underscore.
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们创建一个新的部分视图模板。一个*部分*是网页模板的一个片段，Rails可以在运行时将其插入一个或多个完整的网页中。例如，如果你计划在你的网站上多个页面上使用相同的数据输入表单，你可以在部分模板中创建该表单。部分模板的名称以下划线开头。
- en: MySQL Errors?
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL错误？
- en: 'If you are using MySQL and you see errors when you run `rake`, first verify
    that MySQL is installed, as explained in [Appendix B](apb.html "Appendix B. Installing
    MySQL for Ruby on Rails"). Also watch out for any error messages that begin with
    something like the following:'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用MySQL，并且在运行`rake`时看到错误，首先验证MySQL是否已安装，如附录B中所述。还要注意任何以类似以下内容开始的错误消息：
- en: '[PRE62]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'If you see this, you will need to add the specified entry to a file named *Gemfile*,
    which you will find in the top-level directory of your application (for example,
    *\blog*). For example, given the previous message, you would need to add this
    text to G*emfile*:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你看到这个，你需要将指定的条目添加到一个名为*Gemfile*的文件中，该文件位于你的应用程序顶级目录中（例如，*\blog*）。例如，根据前面的消息，你需要将以下文本添加到*G*emfile*中：
- en: '[PRE63]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'Create a new file called *_post.html.erb* in your *\app\views\posts\* directory.
    Open this file, and edit its contents to match the following (or you may copy
    the *_post.html.erb* from the sample project in the source code archive):'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的*\app\views\posts\*目录下创建一个名为*_post.html.erb*的新文件。打开这个文件，并编辑其内容以匹配以下内容（或者你也可以从源代码存档中的示例项目中复制*_post.html.erb*）：
- en: '*_post.html.erb*'
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: '*_post.html.erb*'
- en: '[PRE64]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'Save your changes. Then open the file named *show.html.erb*. This file was
    automatically created by the scaffold script. Delete the following “boilerplate”
    code from the file:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 保存你的更改。然后打开名为*show.html.erb*的文件。此文件是由scaffold脚本自动创建的。从文件中删除以下“样板”代码：
- en: '[PRE65]'
  id: totrans-242
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: 'And replace it with this:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 并将其替换为以下内容：
- en: '[PRE66]'
  id: totrans-244
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'This tells Rails to render the `_post` partial template at this point. The
    code in *show.html.erb* should now look like this:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 这告诉Rails在此处渲染`_post`部分模板。现在*show.html.erb*中的代码应该看起来像这样：
- en: '[PRE67]'
  id: totrans-246
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: Test It!
  id: totrans-247
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 测试它！
- en: 'And that’s it! Now you are ready to test your application. First, run the server.
    At the prompt in the *\blog* directory, enter this:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 就这样！现在你已经准备好测试你的应用程序了。首先，运行服务器。在*\blog*目录的提示符下，输入以下内容：
- en: '*Rails 3*'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 3*'
- en: '[PRE68]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: '*Rails 2*'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: '*Rails 2*'
- en: '[PRE69]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: Note
  id: totrans-253
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: 'Recall that if you are not using the default port, 3000, you will need to specify
    the actual port number after `-p` as explained earlier in this chapter, for example:
    `rails server -p3003`.'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 回想一下，如果你没有使用默认端口3000，你将需要在`-p`之后指定实际的端口号，如本章前面所述，例如：`rails server -p3003`。
- en: 'Go into your web browser, and enter the following address (again, use the actual
    port number if this is not 3000):'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 进入你的网络浏览器，并输入以下地址（如果这不是3000端口，请使用实际的端口号）：
- en: '[PRE70]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'You should see your page with its index page active. This is what should appear:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该看到你的页面，其索引页面处于激活状态。这应该是这样的：
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages860173.png)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages860173.png)'
- en: Now click the New Post link. In the New Post page, enter a title and some body
    text. Then click **Create**.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 现在点击“新建帖子”链接。在新帖子页面，输入标题和一些正文内容。然后点击**创建**。
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages860177.png.jpg)'
  id: totrans-260
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages860177.png.jpg)'
- en: The next page that displays is the Show page. This is defined by the combination
    of the *show.html.erb* view and the *_post.html.erb* partial. Now carry on entering
    posts and clicking the links to navigate through the various defined views.
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 下一个显示的页面是显示页面。这是由*show.html.erb*视图和*_post.html.erb*部分组合定义的。现在继续输入帖子并点击链接在定义的各个视图中导航。
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages860181.png.jpg)'
  id: totrans-262
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages860181.png.jpg)'
- en: Note
  id: totrans-263
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: As mentioned earlier, this chapter assumes you are using Rails “in the raw,”
    by entering all the necessary commands at the system prompt. Some IDEs provide
    a more integrated environment, which allows you to generate and code your application
    using built-in tools and utilities. You will find an overview of some Ruby and
    Rails IDEs in [Appendix D](apd.html "Appendix D. Ruby and Rails Development Software").
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，本章假设你正在使用Rails“原生”方式，通过在系统提示符中输入所有必要的命令。一些IDE提供了更集成的环境，允许你使用内置的工具和实用程序生成和编写应用程序。你将在[附录D](apd.html
    "附录D. Ruby和Rails开发软件")中找到一些Ruby和Rails IDE的概述。
- en: Digging Deeper
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 深入挖掘
- en: The three letters “MVC” are fundamental to understanding how Rails works. Here
    I explain the underlying concepts. You will also learn about the Rails directory
    structure and alternative Ruby frameworks.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: “MVC”这三个字母对于理解Rails的工作原理至关重要。在这里，我将解释其基本概念。你还将了解Rails的目录结构和替代的Ruby框架。
- en: MVC
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: MVC
- en: As explained earlier, Rails adopts the Model-View-Controller (MVC) paradigm.
    Put simply, these may be thought of as the database (Model), the display (View),
    and the programming logic (Controller).
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，Rails采用模型-视图-控制器（MVC）范式。简单来说，这些可以被认为是数据库（模型）、显示（视图）和编程逻辑（控制器）。
- en: Although these three component parts are, in theory, separate entities, there
    is, in practice, inevitably a degree of overlap. For instance, some calculations
    may be done in the Model with others done in the Controller; operations that affect
    the formatting of data could happen in the Controller or in the View. There are
    no hard-and-fast rules—just a general principle that, as much as possible, operations
    “close to the data” should happen in the Model, operations “close to the display”
    should happen in the View, and everything else should go into the Controller.
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然这三个组成部分在理论上可以是独立的实体，但在实践中不可避免地会有一定程度的重叠。例如，一些计算可能在模型中完成，而其他计算可能在控制器中完成；影响数据格式化的操作可能发生在控制器或视图中。没有硬性规定——只有一条基本原则，即尽可能让“接近数据”的操作发生在模型中，让“接近显示”的操作发生在视图中，其余的都放入控制器中。
- en: That’s MVC in theory. Now let’s see how it is implemented by Rails.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 这就是理论上的MVC。现在让我们看看Rails是如何实现的。
- en: '**Model**'
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: '**模型**'
- en: The Model in Ruby on Rails is a combination of tables in a database—handled
    by a database server such as MySQL—and a matching set of Ruby classes to work
    upon those tables. For example, in a blog you might have a database containing
    a table called Posts. In that case, the Rails model would also contain a Ruby
    class named Post (notice that Rails works with plurals—the Posts table can contain
    many Post objects). The Ruby Post class would typically contain methods to find,
    save, or load individual Post records from the Posts database. This combination
    of database tables and corresponding Ruby classes comprises a Rails Model.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: Ruby on Rails 中的模型是数据库中的表（由 MySQL 等数据库服务器处理）和匹配的 Ruby 类的组合，用于操作这些表。例如，在一个博客中，你可能有一个包含名为
    Posts 的表的数据库。在这种情况下，Rails 模型也会包含一个名为 Post 的 Ruby 类（注意 Rails 使用复数——Posts 表可以包含多个
    Post 对象）。Ruby Post 类通常会包含查找、保存或从 Posts 数据库加载单个 Post 记录的方法。数据库表和相应的 Ruby 类的组合构成了一个
    Rails 模型。
- en: '**View**'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: '**视图**'
- en: The View is pretty much what it sounds like—the visual representation of a Ruby
    on Rails application. It is (typically but not necessarily) created in the form
    of HTML templates with some Ruby code mixed in. In fact, other view types (for
    example, a graphical view made using Adobe’s Flex or Microsoft’s Silverlight)
    are possible, but the Rails default is HTML. These templates, which generally
    have the extension *.html.erb* (but may also use the extension *.rhtml* that was
    the Rails 1 default), are not loaded directly into a web browser—after all, web
    browsers haven’t any way of running Ruby code. Instead, they are preprocessed
    by a separate tool that executes the Ruby code in order to interact with the Model
    (finding or editing data as necessary); then, as an end result, it creates a new
    HTML page whose basic layout is defined by an ERb template but whose actual data
    (that is, the blog posts, shopping cart items, or whatever) are provided by the
    Model. This makes it possible to create highly dynamic web pages that change as
    a user interacts with them.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 视图基本上就是它的名字——Ruby on Rails 应用程序的视觉表示。它通常是（但不一定是）以 HTML 模板的形式创建的，其中混合了一些 Ruby
    代码。实际上，其他视图类型（例如，使用 Adobe 的 Flex 或 Microsoft 的 Silverlight 制作的图形视图）也是可能的，但 Rails
    的默认值是 HTML。这些模板通常具有 *.html.erb* 扩展名（但也可以使用 Rails 1 的默认扩展名 *.rhtml*），它们不是直接加载到网页浏览器中的——毕竟，网页浏览器没有运行
    Ruby 代码的方法。相反，它们由一个单独的工具预处理，该工具执行 Ruby 代码以与模型交互（根据需要查找或编辑数据）；然后，作为最终结果，它创建一个新的
    HTML 页面，其基本布局由 ERb 模板定义，但其实际数据（即博客帖子、购物车项目或 whatever）由模型提供。这使得创建高度动态的网页成为可能，这些网页会随着用户与之交互而改变。
- en: '**Controller**'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: '**控制器**'
- en: The Controller takes the form of Ruby code files that act as go-betweens that
    link the Model and the View. For example, in the web page (the View), a user might
    click a button to add a new post to a blog; using ordinary HTML, this button submits
    a value named `Create`. This causes a method named `create`, in a `post` “controller”
    (a file of Ruby code) to save the new blog entry (some text) that has been entered
    in the web page (the View) into the database (the data repository of the Model).
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 控制器以 Ruby 代码文件的形式存在，充当连接模型和视图的中介。例如，在网页（视图）中，用户可能会点击一个按钮来向博客添加一篇新帖子；使用普通的 HTML，这个按钮会提交一个名为
    `Create` 的值。这会导致一个名为 `create` 的方法在 `post` “控制器”（Ruby 代码文件）中保存已输入网页（视图）中的新博客条目（一些文本）到数据库（模型的数据库存储库）中。
- en: The Rails Folders
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: Rails 文件夹
- en: 'This is a simplified guide to the top-level folders generated by Rails, with
    a brief description of the files and folders they contain:'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 这是对 Rails 生成的顶级文件夹的简化指南，包括它们包含的文件和文件夹的简要描述：
- en: '| *app* | This contains the code specific to this application. Subfolders may
    include *app\controllers*, *app\models*, *app\views*, *app\helpers*, and *app\mailers*.
    |'
  id: totrans-279
  prefs: []
  type: TYPE_TB
  zh: '| *app* | 这包含特定于该应用程序的代码。子文件夹可能包括 *app\controllers*、*app\models*、*app\views*、*app\helpers*
    和 *app\mailers*。 |'
- en: '| *config* | This contains configuration files for the Rails environment, the
    routing map, the database, and other dependencies; database configuration is put
    into the file *database.yml*. |'
  id: totrans-280
  prefs: []
  type: TYPE_TB
  zh: '| *config* | 这包含 Rails 环境的配置文件、路由图、数据库和其他依赖项；数据库配置放入 *database.yml* 文件中。 |'
- en: '| *db* | This contains the database schema in *schema.rb* and may contain code
    that works on the data in the database. If migrations have been applied, it will
    also contain migration files in the *\migrate* subdirectory. |'
  id: totrans-281
  prefs: []
  type: TYPE_TB
  zh: '| *db* | 这包含 *schema.rb* 中的数据库模式以及可能包含在数据库中工作的代码。如果已应用迁移，它还将包含在 *\migrate*
    子目录中的迁移文件。 |'
- en: '| *doc* | This may contain RDOC documentation (see [Appendix A](apa.html "Appendix A. Documenting
    Ruby with RDoc") for more on RDOC). |'
  id: totrans-282
  prefs: []
  type: TYPE_TB
  zh: '| *doc* | 这可能包含RDOC文档（有关RDOC的更多信息，请参阅[附录A](apa.html "附录A. 使用RDoc记录Ruby")）。|'
- en: '| *lib* | This may contain code libraries (that is, code that does not logically
    belong in *\controllers, \models*, or *\helpers*) for the application. |'
  id: totrans-283
  prefs: []
  type: TYPE_TB
  zh: '| *lib* | 这可能包含应用程序的代码库（即不属于*\controllers*、*\models*或*\helpers*的逻辑代码）。|'
- en: '| *log* | This may contain error logs. |'
  id: totrans-284
  prefs: []
  type: TYPE_TB
  zh: '| *log* | 这可能包含错误日志。|'
- en: '| *public* | This directory contains “static” files that may be used by the
    web server. It has subdirectories for *images*, *stylesheets*, and *javascripts*.
    |'
  id: totrans-285
  prefs: []
  type: TYPE_TB
  zh: '| *public* | 此目录包含可能由Web服务器使用的“静态”文件。它包含用于*图像*、*样式表*和*JavaScript*的子目录。|'
- en: '| *script* | This contains scripts that Rails uses to perform various tasks
    such as generating certain file types and running the web server. |'
  id: totrans-286
  prefs: []
  type: TYPE_TB
  zh: '| *script* | 这包含Rails用于执行各种任务的脚本，例如生成特定类型的文件和运行Web服务器。|'
- en: '| *test* | This may contain tests generated by Rails or specified by the user.
    |'
  id: totrans-287
  prefs: []
  type: TYPE_TB
  zh: '| *test* | 这可能包含Rails生成的或用户指定的测试。|'
- en: '| *tmp* | This contains temporary files used by Rails. |'
  id: totrans-288
  prefs: []
  type: TYPE_TB
  zh: '| *tmp* | 这包含Rails使用的临时文件。|'
- en: '| *vendor* | This may contain third-party libraries that do not form part of
    the default Rails installation. |'
  id: totrans-289
  prefs: []
  type: TYPE_TB
  zh: '| *vendor* | 这可能包含不属于默认Rails安装的第三方库。|'
- en: Other Ruby Frameworks
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 其他Ruby框架
- en: Rails may be the most famous Ruby framework, but it certainly is not the only
    one. Others such as Ramaze and Sinatra also have a dedicated following. A framework
    called Merb was once seen as the closest competitor to Rails. However, in December
    2008, the Rails and Merb teams announced they would be collaborating on the next
    iteration of Rails, and it was that collaboration that resulted in Rails 3.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: Rails可能是最著名的Ruby框架，但绝对不是唯一的一个。其他如Ramaze和Sinatra也有专门的追随者。一个名为Merb的框架曾被看作是Rails的最接近的竞争对手。然而，在2008年12月，Rails和Merb团队宣布他们将合作开发Rails的下一个版本，正是这次合作导致了Rails
    3的诞生。
- en: 'If you are interested in exploring other Ruby frameworks, follow these links:'
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你对探索其他Ruby框架感兴趣，请遵循以下链接：
- en: 'Ramaze: [http://www.ramaze.net/](http://www.ramaze.net/)'
  id: totrans-293
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Ramaze：[http://www.ramaze.net/](http://www.ramaze.net/)
- en: 'Sinatra: [http://www.sinatrarb.com/](http://www.sinatrarb.com/)'
  id: totrans-294
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Sinatra：[http://www.sinatrarb.com/](http://www.sinatrarb.com/)
- en: 'Waves: [http://www.rocket.ly/waves](http://www.rocket.ly/waves)'
  id: totrans-295
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 波浪：[http://www.rocket.ly/waves](http://www.rocket.ly/waves)
- en: 'Bear in mind that open source Ruby frameworks have a tendency to come and go,
    waxing and waning according to the enthusiasm or other commitments of the core
    developers. The Ramaze team maintains a list of Ruby frameworks on its home wiki:
    [http://wiki.ramaze.net/Home#other-frameworks](http://wiki.ramaze.net/Home#other-frameworks).'
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，开源Ruby框架有来有去，兴衰取决于核心开发者的热情或其他承诺。Ramaze团队在其主页维基上维护了一个Ruby框架列表：[http://wiki.ramaze.net/Home#other-frameworks](http://wiki.ramaze.net/Home#other-frameworks)。
