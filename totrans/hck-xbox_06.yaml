- en: Chapter 6 -
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第六章 -
- en: 'The Best Xbox Game: Security Hacking'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 最佳Xbox游戏：安全黑客
- en: The next step beyond modifying and tweaking the Xbox hardware is taking control
    of the Xbox hardware. Unfortunately, gaining control of the hardware is not as
    easy as one might think. The designers of the Xbox put a great deal of thought
    into securing the hardware against sophisticated software attacks as well as most
    simple hardware attacks. The Xbox’s security mechanisms are an artifact of its
    digital rights management architecture.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 在修改和调整Xbox硬件之后，下一步是控制Xbox硬件。不幸的是，获取硬件控制并不像人们想象中那么容易。Xbox的设计者投入了大量精力来确保硬件免受复杂的软件攻击以及大多数简单的硬件攻击。Xbox的安全机制是其数字版权管理架构的产物。
- en: Note
  id: totrans-3
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '![](../Images/index-107_1.png)'
  id: totrans-4
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/index-107_1.png)'
- en: In principle, applying hardware to “fair-use” purposes, such as running your
    own homebrew programs, should not be illegal. However, the relationship between
    fair use, secured hardware, and the relatively new copyright control circumvention
    laws is still unclear. Chapter 12, “Caveat Hacker,” discusses the legal issues
    of hacking in more detail.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 从原则上讲，将硬件应用于“合理使用”目的，例如运行自己的自制程序，不应是非法的。然而，合理使用、受保护硬件以及相对较新的版权控制规避法律之间的关系仍然不明确。第12章“警告黑客”详细讨论了黑客攻击的法律问题。
- en: There are many ways around the Xbox’s security measures. In this chapter and
    in Chapter 8, “Reverse Engineering Xbox Security,” I tell the story of my adventures
    mapping out the Xbox security system. I write not only about the successes, but
    also about the failures I encountered, so that you can learn from my experiences.
    Chapter 9, “Sneaking in the Backdoor,” explains some approaches taken by others
    to get around the Xbox’s security measures. Chapter 7, “A Brief Primer on Security,”
    provides the background necessary to appreciate Chapters 8 and 9.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 有许多方法可以绕过Xbox的安全措施。在本章和第8章“逆向工程Xbox安全”中，我讲述了我的冒险经历，绘制了Xbox安全系统的地图。我不仅讲述了成功之处，还讲述了遇到的失败，以便你能从我的经验中学习。第9章“偷偷进入后门”解释了其他人用来绕过Xbox安全措施的一些方法。第7章“安全简明指南”提供了欣赏第8章和第9章所需的背景知识。
- en: '**First Encounters with a Paranoid Design**'
  id: totrans-7
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '**与偏执设计的初次接触**'
- en: When the Xbox was announced in the Spring of 2000, excitement rippled through
    the hardware enthusiast community. The cause for this excitement was not just
    the Xbox’s gaming potential, but its potential for use as a high performance,
    network-enabled x86-architecture PC at the affordable price of $300\. Price cuts
    a few months after its introduction have since dropped the cost of an Xbox to
    below $200\. The similarity of the Xbox to an x86 PC meant that a huge base of
    existing applications and expertise could, in theory, be easily ported to the
    console.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 当Xbox在2000年春季发布时，兴奋的波纹席卷了硬件爱好者社区。这种兴奋的原因不仅仅是Xbox的游戏潜力，还有它作为高性能、网络连接的x86架构PC在300美元的实惠价格上的潜力。几个月后价格下调，Xbox的价格已经降至200美元以下。Xbox与x86
    PC的相似性意味着理论上大量现有的应用程序和专业知识可以轻松移植到游戏机上。
- en: 'My first look inside an Xbox was in late November 2001 when my girlfriend (now
    fianceé) gave it to me as an early Christmas gift. I immediately got down to business.
    In order to take control of the Xbox hardware, the first task is to extract the
    boot ROM and analyze its contents: Recall from the discussion on Xbox architecture
    in Chapter 2 that the boot ROM of the Xbox contains all of the code for establishing
    the Xbox’s operating environment.'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 我第一次看到Xbox是在2001年11月底，当时我的女朋友（现在是未婚妻）把它作为早起的圣诞礼物给了我。我立刻开始着手。为了控制Xbox硬件，首要任务是提取引导ROM并分析其内容：回想一下第2章关于Xbox架构的讨论，Xbox的引导ROM包含了建立Xbox操作环境所需的所有代码。
- en: '**To Snarf a ROM**'
  id: totrans-10
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**窃取ROM**'
- en: The type of ROM used in the Xbox is an electrically erasable and programmable
    variety known as FLASH ROM. FLASH ROM typically comes in one of a few package
    types, and the Xbox uses one of the most popular packages, the TSOP (Thin Small
    Outline Package). It is located in sector U7 on the top side of the Xbox motherboard,
    and the reference designator for the part is U7D1\. The TSOP package is very recognizable
    because it is one of the few chip packages that is rectangular and has pins only
    on the *narrow* edges of the package. Most other packages put pins on the long
    edge or all edges to maximize connectivity, but FLASH ROM has relatively low I/O
    requirements per silicon area. A quick check on the base part number, 29F080,
    with a Web search engine verifies that this part is indeed an 8 Mbit FLASH ROM.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: Xbox使用的ROM类型是一种称为FLASH ROM的电气可擦写和可编程品种。FLASH ROM通常有几种封装类型，Xbox使用的是最受欢迎的封装之一，即TSOP（薄型小外形封装）。它位于Xbox主板顶部的U7区域，该部件的参考设计符为U7D1。TSOP封装非常容易识别，因为它是非常少数的矩形封装之一，只有封装的窄边上有引脚。大多数其他封装将引脚放在长边或所有边上以最大化连接性，但FLASH
    ROM的每平方硅的I/O要求相对较低。通过在搜索引擎上快速检查基础部件编号29F080，可以验证这个部件确实是一个8 Mbit FLASH ROM。
- en: There are a few techniques that one can use to read out ( *snarf*) the contents
    of the FLASH ROM. The no-solder approach is to buy a test clip that snaps onto
    the FLASH ROM, and read out its contents by powering up and controlling the ROM
    through the test clip, while the rest of the Xbox is powered off. A suitable test
    clip for this purpose can be purchased from Emulation Technology, www.emulationtechnology.com.
    (The test clip override approach has a few problems with it, the biggest being
    the possibility of permanently damaging chips connected to the FLASH ROM that
    are not receiving power through the test clip. However, in the case of the Xbox,
    this does not seem to be a problem and those who attempted this approach did meet
    with success.¹ I did not initially take this approach as I did not want to risk
    damaging the motherboard, and because I could not afford the $300 test clip required
    for the job.)
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种技术可以用来读取（*snarf*）FLASH ROM的内容。无焊接的方法是购买一个可以夹在FLASH ROM上的测试夹具，通过测试夹具供电并控制ROM，同时关闭Xbox的其他部分来读取其内容。为此目的，可以从Emulation
    Technology，www.emulationtechnology.com购买合适的测试夹具。（测试夹具覆盖方法有几个问题，最大的问题是可能会永久损坏通过测试夹具供电的连接到FLASH
    ROM的芯片。然而，在Xbox的情况下，这似乎不是一个问题，尝试这种方法的人也取得了成功。¹ 我最初没有采用这种方法，因为我不想冒险损坏主板，而且我负担不起完成这项工作所需的300美元的测试夹具。）
- en: 'Another ingenious approach is to solder wires to the test points around the
    FLASH ROM to eavesdrop on the Xbox as it reads the ROM’s contents. Eavesdropping
    can be accomplished by either connecting the wires to a custom board that can
    interface with the ROM, or by using a logic analyzer to capture the data as it
    is accessed by the Xbox CPU. The latter approach was used with success as well,
    and in fact some back doors in the Xbox boot sequence were discovered as a consequence
    of this methodology.² I chose not to use this approach either, as I did not have
    a logic analyzer when I got my first Xbox, and because soldering all the wires
    down can be very tedious, difficult, and error-prone. My approach was more traditional:
    just remove the FLASH ROM and drop it into a ROM reader. I also placed a socket
    on the motherboard, so that future removal and programming of the ROM would be
    very quick and reliable.'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种巧妙的方法是将电线焊接到FLASH ROM周围的测试点上，以监听Xbox读取ROM内容的过程。监听可以通过将电线连接到可以与ROM接口的定制板，或者使用逻辑分析仪捕获Xbox
    CPU访问数据时的情况来实现。后者也被成功使用，实际上，通过这种方法还发现了Xbox引导序列中的几个后门。² 我也没有选择使用这种方法，因为我第一次得到Xbox时没有逻辑分析仪，而且将所有电线焊接到位可能非常繁琐、困难且容易出错。我的方法更传统：只是移除FLASH
    ROM并将其放入ROM读取器中。我还将插座放置在主板上，这样将来移除和编程ROM将非常快速和可靠。
- en: '![](../Images/index-109_1.png)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/index-109_1.png)'
- en: '**Figure 6-1**: Removing the Xbox FLASH ROM with a tweezer-style soldering
    iron.'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: '**图6-1**：使用夹子式焊接铁移除Xbox FLASH ROM。'
- en: Removing the FLASH ROM in a manner that preserves the integrity of its fine-pitched
    pins simple if you have the right tools, and nearly impossible with the wrong
    tools. The key is to heat all of the pins of the FLASH ROM simultaneously; once
    uniform heating is achieved, the FLASH ROM will fall right off the motherboard.
    Clearly, the standard pencil-style soldering iron is not going to be able to heat
    all of the pins simultaneously. The proper tool for the job is a “tong” or “tweezer”
    style soldering iron as shown in Figure 6-1 below. These soldering irons have
    two heating elements, so they can heat both sides of the chip simultaneously.
    Furthermore, the soldering iron must have a paddle-tip that is wide enough to
    heat the length of the chip all at once.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你有合适的工具，以保持其细针完整性的方式移除FLASH ROM很简单，如果没有合适的工具，几乎是不可能的。关键是同时加热FLASH ROM的所有针；一旦达到均匀加热，FLASH
    ROM就会直接从主板上脱落。显然，标准的铅笔式烙铁无法同时加热所有针。适用于这项工作的正确工具是图6-1中所示的“钳子”或“镊子”式烙铁。这些烙铁有两个加热元件，因此可以同时加热芯片的两面。此外，烙铁必须有一个足够宽的桨形尖端，以便一次性加热芯片的整个长度。
- en: A soldering iron with these features can cost quite a bit (hundreds of dollars),
    but it is a worthwhile investment as it comes in handy in all kinds of situations.
    I use an Ersa SMT Unit 60A soldering iron that I bought for a good discount on
    the floor of a tradeshow, and it quickly paid for itself through the few board
    assembly jobs that I picked up on the side while finishing my degree. A more affordable
    iron by Xytronic can be purchased through Jameco (#168410) for about $70, but
    I have not used it so I cannot vouch for its quality. Another budget approach
    that is very simple and straightforward is to use a desoldering alloy, as described
    in Appendix B, “Soldering Techniques.” (Note that a suitable socket for the ROM³
    is relatively cheap — under $20 — although installing it does require a steady
    hand and an optical magnifying device of some kind.)
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 具有这些功能的烙铁可能相当昂贵（数百美元），但这是一个值得的投资，因为它在各种情况下都很有用。我使用的是Ersa SMT Unit 60A烙铁，我在交易会地板上以折扣价购买，通过在完成学位的同时接一些额外的电路板组装工作，它很快就赚回了成本。通过Jameco（#168410）可以购买到Xytronic生产的更经济实惠的烙铁，大约70美元，但我没有使用过它，因此无法对其质量作出保证。另一种非常简单直接的方法是使用附录B中描述的脱焊合金。（请注意，适合ROM³的合适插座相对便宜——低于20美元——尽管安装它确实需要稳定的手和某种类型的放大设备。）
- en: Once the ROM is removed and its pins cleaned and inspected, its contents can
    be read out in a ROM reader. Of course ROM readers can be purchased, but it is
    always a good learning experience to build your own. You can read up a little
    bit on ROM programmers that I’ve built at my website, http://www.xenatera.com/bunnie.
    My original Flashburner⁴ programmer is a simple device that is easier to understand
    and build than its second revision⁵, but it is less powerful.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦ROM被移除，其针被清洁和检查后，其内容就可以在ROM读卡器中读取。当然，可以购买ROM读卡器，但自己动手制作总是一次很好的学习经历。你可以在我的网站上了解一些我制作的ROM编程器，网址为http://www.xenatera.com/bunnie。我的原始Flashburner⁴编程器是一个简单易懂且易于构建的设备，比其第二次修订⁵更容易理解，但功能较弱。
- en: However, if your goal is to read out ROMs as quickly as possible, just purchase
    a ROM reader outright. A good ROM reader is an essential tool in any serious hardware
    hacker’s toolbox. Needham’s Electronics (http://www.needhams.com) makes a great
    line of ROM programmers/readers that fit a wide range of budgets.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，如果你的目标是尽可能快地读取ROM，只需直接购买ROM读卡器即可。一个好的ROM读卡器是任何严肃硬件黑客工具箱中的必备工具。Needham的电子产品（http://www.needhams.com）生产了一系列适合各种预算的优秀的ROM编程器/读卡器。
- en: '**An Encounter with Microsoft**'
  id: totrans-20
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: '**与微软的遭遇**'
- en: After extracting the ROM contents, the next step is to share its contents with
    fellow hackers for analysis. Or is it? Within twelve hours of posting the contents
    of the ROM to my website, I received a call from an engineer at Microsoft politely
    requesting that I remove their copyrighted content from my website. Of course,
    I immediately removed their content from my website; I should have known better
    before posting it in the first place.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在提取ROM内容之后，下一步是将其内容与同行黑客分享以进行分析。或者不是吗？在我将ROM内容发布到我的网站后的十二小时内，我接到一位微软工程师的电话，他礼貌地要求我将其版权内容从我的网站上删除。当然，我立即从我的网站上删除了他们的内容；我本应该在最初发布时就意识到这一点。
- en: This first brush with Microsoft was a sobering warning that reverse engineering
    the Xbox was not going to be like any other home appliance reverse engineering
    project. There are laws that protect aspects of reverse engineering, and a vast
    body of copyright law that protects the intellectual property (IP) owner. Collaborative
    reverse engineering of the Xbox while respecting Microsoft’s rights is a legal
    minefield.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 这第一次与微软的接触是一个令人清醒的警告，表明逆向工程Xbox不会像其他任何家用电器的逆向工程项目一样。有法律保护逆向工程的某些方面，还有大量版权法保护知识产权（IP）所有者。在尊重微软权利的同时合作逆向工程Xbox是一个法律雷区。
- en: On the one hand, Microsoft should be able to invest in a product and take a
    risk in hopes of a profit. However, profitability is not guaranteed by law. For
    example, selling the consoles at a huge loss, as Microsoft has done, in hopes
    of selling software to make up the difference (as a “loss leader”) is a risky
    proposition, and there is no guarantee by law that Microsoft has to come out ahead
    in the end. On the other hand, we as hackers have the right to tinker (“fair use”)
    with hardware purchased with our own hard-earned cash, and if Microsoft wants
    to basically sell PCs at a huge discount to us, that’s fine. Whether or not we
    purchase enough games (around ten or more) to compensate for Microsoft’s losses
    on the Xbox is entirely up to Microsoft’s business and marketing strategy.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 一方面，微软应该能够投资于一个产品并承担风险以期望获得利润。然而，法律并不保证盈利。例如，像微软那样以巨大亏损出售游戏机，希望通过销售软件来弥补损失（作为“亏损领导者”），这是一个风险很大的提议，法律也没有保证微软最终必须盈利。另一方面，我们作为黑客有权利使用自己辛苦赚来的钱购买的硬件（“合理使用”），如果微软想以大幅折扣向我们销售PC，那也无可厚非。我们是否购买足够多的游戏（大约十个或更多）来弥补微软在Xbox上的损失，完全取决于微软的商业和营销策略。
- en: In my view, Microsoft’s large loss-to-revenue ratio is a bit of an anomaly in
    this industry. Sony and Nintendo roughly break-even on the cost of their console
    hardware. Also, cell phone providers often sell their phones at a loss comparable
    to that of the Xbox, but require the subscriber to enter a contract to ensure
    that the cost of the phone is recouped; breaking the contract implies termination
    fees. Perhaps this is a reflection of Microsoft’s confidence in the Xbox Live
    business model.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 在我看来，微软的大额亏损与收入比是这个行业的异常现象。索尼和任天堂在游戏机硬件成本上大致收支平衡。此外，手机提供商经常以与Xbox相当的成本亏损销售手机，但要求订阅者签订合同以确保手机的成本得到补偿；违约意味着终止费用。这可能反映了微软对Xbox
    Live业务模式的信心。
- en: Somewhere in the middle of all of this is the interplay of cryptographic copyright
    protection mechanisms and the right to fair use. It turns out that the Xbox makes
    extensive use of cryptography to enforce copy protections as well as console usage
    policies, which brings us to the Digital Millennium Copyright Act of 1998 (DMCA),
    a relatively new, untested body of law. With little established court precedent
    and plenty of gray area in between the letters of the law, you as a hacker must
    assess the potential liabilities that you could face. Chapter 12, “Caveat Hacker,”
    explores in greater detail the legal issues of hacking in the new millennium.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在所有这些中间，是加密版权保护机制和公平使用权的相互作用。结果是，Xbox广泛使用加密来执行版权保护和游戏机使用政策，这把我们带到了1998年的《数字千年版权法案》（DMCA），这是一部相对较新、未经检验的法律。由于缺乏既定的法院先例和法律条款之间的许多灰色地带，作为黑客的你必须评估你可能会面临的风险。第12章“黑客警告”更详细地探讨了新世纪黑客的法律问题。
- en: '**Analyzing the ROM Contents**'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '**分析ROM内容**'
- en: Rebuffed by Microsoft, but ROM contents still in hand, I proceeded to analyze
    the ROM contents. One would expect that the boot ROM contains a hardware initialization
    procedure, followed by instructions that load up the operating system, and possibly
    the operating system code itself. But where to start?
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然被微软拒绝，但ROM内容仍在手中，我继续分析ROM内容。人们可能会预期引导ROM包含硬件初始化程序，随后是加载操作系统的指令，以及可能还有操作系统代码本身。但应该从哪里开始呢？
- en: 'The program inside the ROM can be thought of as a ball of yarn: Once you find
    the starting point of the thread, it is just a matter of time and perseverance
    until you unwind the ball of yarn to its core.'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: ROM内部的程序可以想象成一团线球：一旦找到线的起点，就只是时间和毅力的问题，直到你将线球完全解开到核心。
- en: 'Fortunately, the starting point of the Xbox’s Pentium processor is very well
    documented by Intel. On power-up, the processor starts running code at a special
    hard-wired location, called the *reset vector*. This reset vector is at address
    0xFFFF.FFF0, near the top of memory. Let’s look at the data contained at this
    location (in hexadecimal):'
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，英特尔对Xbox的Pentium处理器的起点进行了非常详细的文档记录。在开机时，处理器从特殊硬连线位置开始运行代码，这个位置被称为*复位向量*。这个复位向量位于地址0xFFFF.FFF0，接近内存的顶部。让我们看看这个位置包含的数据（以十六进制表示）：
- en: 0xFFFF.FFF0 EBC6 8BFF 1800 D8FF FFFF 80C2 04B0 02EE
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 0xFFFF.FFF0 EBC6 8BFF 1800 D8FF FFFF 80C2 04B0 02EE
- en: '[PRE0]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '**Listing 6-1**: Decompilation of the dummy cipher found in the FLASH ROM.'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '**列表6-1**：在FLASH ROM中找到的虚拟加密算法的反汇编。'
- en: The first two bytes, EBC6, are a jump instruction to location 0xFFFF.FFB8\.
    The first byte, EB, is the specific opcode for a “jump, short, relative, displacement
    relative to next instruction;” the second byte, C6, is the 8-bit signed offset
    of the jump. In other words, the first thing the processor does is jump to another
    location — something every boot program does, since you only have 16 bytes of
    runway in the reset vector before you fall off the high end of memory. Since this
    code is typical for a reset vector, it is okay to reprint the code here for educational
    purposes.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 前两个字节，EBC6，是一个跳转到位置0xFFFF.FFB8的跳转指令。第一个字节，EB，是“跳转，短，相对，相对于下一条指令的位移”的特定操作码；第二个字节，C6，是跳转的8位有符号偏移量。换句话说，处理器首先做的事情是跳转到另一个位置——这是每个引导程序都会做的事情，因为你在复位向量中只有16个字节的运行空间，一旦超出内存的高端就会崩溃。由于这段代码对于复位向量来说是典型的，因此为了教育目的，可以在这里重新打印代码。
- en: 'The next chunk of code is a piece that initializes the processor’s GDT (Global
    Descriptor Table) and IDT (Interrupt Descriptor Table) state. The GDT and IDT
    set up the processor’s memory management scheme and interrupt handling scheme.
    You do not need to understand exactly what these registers do, but if you are
    curious, Intel’s “IA-32 Intel Architecture Software Developer’s Manual, Volume
    3: System Programming Guide” explains the function of these registers in detail.
    This manual is available at Intel’s developer website, http://developer.intel.com.'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 下一段代码是一段初始化处理器GDT（全局描述符表）和IDT（中断描述符表）状态的代码。GDT和IDT设置了处理器的内存管理方案和中断处理方案。你不需要确切了解这些寄存器的作用，但如果你有兴趣，英特尔“IA-32
    Intel架构软件开发者手册，第3卷：系统编程指南”详细解释了这些寄存器的功能。这本手册可在英特尔开发者网站上找到，网址为http://developer.intel.com。
- en: After setting up these registers, the processor gets kicked into protected mode
    and jumps to 0xFFFF.FE00 — a region exactly 512 bytes below the top of memory
    — and this is where things start to get interesting. After a short snippet of
    code that sets up the segment registers, a program called a *jam table interpreter*
    (also known as the X-Code interpreter in the Xbox community) is executed. A jam
    table is industry vernacular for a table of values that contains opcodes for reads,
    writes, and simple decision operations, used in the context of hardware initializations.
    Hundreds of operations are required to initialize a typical PC, and jam tables
    help cope with this complexity without bloating the core initialization code base.
    Using jam tables also helps make initialization more flexible and capable of dealing
    with user-configurable hardware parameters, such as the type and amount of memory
    installed. In the case of the Xbox, the jam table interpreter starts fetching
    jam table opcodes from a location near the bottom of the FLASH ROM. (Keep in mind
    that the opcodes implemented by the jam table interpreter are quite powerful;
    one can write and read data from any location in the Xbox using jam table opcodes.)
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 在设置这些寄存器之后，处理器被切换到保护模式，并跳转到0xFFFF.FE00——一个位于内存顶部的512字节以下的区域——从这里开始事情变得有趣起来。在一段设置段寄存器的简短代码之后，一个名为*jam表解释器*（在Xbox社区中也称为X-Code解释器）的程序被执行。jam表是行业术语，指的是包含读取、写入和简单决策操作码的值表，用于硬件初始化的上下文中。初始化一个典型的PC需要数百个操作，而jam表有助于处理这种复杂性，而不会使核心初始化代码库膨胀。使用jam表也有助于使初始化更加灵活，能够处理用户可配置的硬件参数，例如安装的内存类型和数量。在Xbox的情况下，jam表解释器从接近FLASH
    ROM底部的位置开始获取jam表操作码。（请记住，jam表解释器实现的操作码非常强大；可以使用jam表操作码从Xbox的任何位置写入和读取数据。）
- en: Once the terminal opcode is executed by the jam table interpreter, the processor
    clears the MTRRs (Memory Type Range Registers, used to declare the cacheability
    of various regions of memory) and starts to decrypt a 16 kB region of memory starting
    at 0xFFFF.A000\. The cipher used to decrypt this region of memory looks very similar
    to RC-4, with some subtle differences. Listing 6-1 shows the cipher reverse-engineered
    into C code, with the help of a tool called IDA Pro by Data Rescue corporation
    (more about this tool in the next couple of chapters).
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦终端操作码被干扰表解释器执行，处理器清除MTRRs（内存类型范围寄存器，用于声明内存各个区域的缓存能力）并开始解密从0xFFFF.A000开始的16
    kB内存区域。用于解密这个内存区域的密码看起来非常类似于RC-4，但有细微的差异。列表6-1显示了使用Data Rescue公司的一个工具IDA Pro将密码反汇编成C代码，这个工具将在接下来的几章中详细介绍。
- en: The data decrypted by this cipher is actually a block of code that is executed
    at the end of the decryption process, but something goes very wrong here. The
    decrypted code is garbage. It doesn’t work.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 由这个密码解密的数据实际上是一块在解密过程结束时执行的代码，但这里出了很大的问题。解密后的代码是垃圾。它不起作用。
- en: '**Memory Address Decoding Tricks**'
  id: totrans-38
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '**内存地址解码技巧**'
- en: A number of tricks exist that can be used to make regions of memory appear different
    in some way than their physical representation would indicate. The two tricks
    relevant to the analysis of the Xbox boot sequence are aliasing and overlaying.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 存在许多技巧可以使内存区域在某些方面看起来与它们的物理表示不同。与Xbox引导序列分析相关的两个技巧是别名和覆盖。
- en: 'Memory locations are aliased when two addresses refer to the same memory location,
    typically accomplished by ignoring a few address bits. To illustrate aliasing,
    consider a system using a 3-bit address. There are only 23 = 8 unique locations
    addressable in a 3-bit system: 000, 001, 010, 011, 100, 101, 110, and 111\. Now
    suppose that you have a memory with four locations; it requires only two bits
    to distinguish each of the four locations: 00, 01, 10, and 11\. If you use our
    3-bit address scheme to talk to this four-location memory, one of the address
    bits must be ignored. If the highest bit is ignored, then address 000 and 100
    will both map to location 00 in memory. In other words, location 00 is aliased
    to addresses 000 and 100.'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 当两个地址指向相同的内存位置时，内存位置被别名化，通常通过忽略一些地址位来实现。为了说明别名化，考虑一个使用3位地址的系统。在3位系统中，只有8个唯一的地址是可寻址的：000、001、010、011、100、101、110和111。现在假设你有一个有四个位置的内存；它只需要两个位来区分这四个位置：00、01、10和11。如果你使用我们的3位地址方案与这个四位置内存通信，必须忽略一个地址位。如果忽略最高位，那么地址000和100都将映射到内存中的位置00。换句话说，位置00被别名化为地址000和100。
- en: Memory overlaying is a technique where out-of-band information is used to select
    between different banks of memory. Let’s suppose that we wish to have a bank of
    secret memory. To do this, we insert a selector between our public and secret
    memories, and the CPU. This selector can choose to present the CPU with data from
    either the secret memory or the public memory, as indicated in Figure 6-2\. As
    a result, the program that controls the address selector also controls who has
    access to the secret block. If the computer starts up running code located in
    the secret bank of memory, a program in the secret code region can use this mechanism
    to hide itself by setting the selector to point at public memory before running
    programs located in public memory.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 内存覆盖是一种技术，其中使用带外信息来选择不同内存银行的内存。假设我们希望有一个秘密内存银行。为此，我们在公共和秘密内存之间插入一个选择器，以及CPU。这个选择器可以选择向CPU提供来自秘密内存或公共内存的数据，如图6-2所示。因此，控制地址选择器的程序也控制着谁可以访问秘密块。如果计算机启动并运行位于秘密内存银行的代码，秘密代码区域的程序可以使用这种机制通过在运行公共内存中的程序之前将选择器设置为指向公共内存来隐藏自己。
- en: '![figure_6-2](../Images/figure_6-2.png)'
  id: totrans-42
  prefs: []
  type: TYPE_IMG
  zh: '![figure_6-2](../Images/figure_6-2.png)'
- en: '**Figure 6-2**: Memory overlaying to hide secret regions.'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: '**图6-2**：内存覆盖以隐藏秘密区域。'
- en: Furthermore, the jam table opcodes seem to be corrupted. This phenomenon was
    corroborated by other hackers working on the problem, thus ruling out a code translation
    error. Clearly, there is more to the Xbox than meets the eye.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，干扰表操作码似乎已被损坏。这一现象得到了其他正在解决这个问题黑客的证实，因此排除了代码转换错误。显然，Xbox远不止表面看起来那么简单。
- en: 'Theories and rumors started to emerge to explain this strange behavior. Some
    of the popular theories included:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 开始出现理论和谣言来解释这种奇怪的行为。一些流行的理论包括：
- en: • **Address and/or data line scrambling.** Somewhere, the address or data lines
    were being inverted or permuted with some 1:1 mapping function. The scrambling
    function could be programmed into the chipset as part of the initialization procedure,
    so that the initial boot block would read like plaintext while the rest of the
    data would be scrambled.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: • **地址和/或数据线打乱。** 在某个地方，地址或数据线被某种1:1映射函数反转或排列。打乱函数可以作为初始化过程的一部分编程到芯片组中，这样初始启动块就会像明文一样读取，而其余的数据会被打乱。
- en: • **Secondary crypto processor.** Another processor on the Xbox was actual y
    handling the Xbox’s initialization, and the boot code in the ROM is bogus.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: • **二级加密处理器。** Xbox上的另一个处理器实际上在处理Xbox的初始化，而ROM中的启动代码是无效的。
- en: • **Boot code contained in the processor.** The processor is actually initialized
    by a chunk of code sitting on the processor die, and the boot code in the ROM
    is bogus.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: • **处理器中的启动代码。** 处理器实际上是由处理器芯片上的代码块初始化的，而ROM中的启动代码是无效的。
- en: • **Boot code contained in the chipset.** The processor functions identically
    to a standard Pentium, but the chipset contains boot code that overrides the bogus
    code inside the ROM.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: • **芯片组中的启动代码。** 处理器功能与标准Pentium相同，但芯片组包含覆盖ROM中无效代码的启动代码。
- en: For almost all of these theories, the only way to prove or disprove them is
    to perform experiments on the hardware. For example, in order to ensure that the
    SMC (System Management Controller, an 8-bit self-contained processor that is always
    on when the Xbox is plugged in) played no role in the secure boot sequence of
    the machine, hackers captured traces of the waveforms on al of the SMC’s pins
    and analyzed them against the expected sequence of events if the SMC were to play
    a crucial role in machine initialization.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 对于几乎所有这些理论，唯一证明或反驳它们的方法是在硬件上执行实验。例如，为了确保系统管理控制器（SMC，一个在Xbox插入时始终开启的8位自包含处理器）在机器的安全启动序列中没有发挥作用，黑客捕捉了所有SMC引脚上的波形，并将它们与如果SMC在机器初始化中发挥关键作用时预期的事件序列进行了分析。
- en: A crucial observation from a fellow hacker was that the Xbox booted perfectly
    even when the reset vector code at 0xFFFF.FFF0 was changed. One would expect that
    if the first instruction executed by the processor at 0xFFFF.FFF0 were corrupted,
    then the machine would crash. Rather, the machine operated flawlessly. This observation
    was verified by a set of experiments where various parts of the FLASH ROM were
    intentionally corrupted. The results were that corrupting surprisingly large regions
    of the FLASH ROM had no effect on the booting of the Xbox. In particular, the
    entire boot initialization sequence from 0xFFFF.FE00 to 0xFFFF.FFFF could be nulled
    out and the Xbox would boot just fine.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 来自一位黑客的关键观察是，即使在0xFFFF.FFF0处的重置向量代码被更改后，Xbox也能完美启动。人们可能会预期，如果处理器在0xFFFF.FFF0处执行的第一条指令被破坏，那么机器会崩溃。然而，机器运行得毫无故障。这一观察通过一系列实验得到了验证，在这些实验中，有意破坏了FLASH
    ROM的各个部分。结果显示，破坏FLASH ROM中意外大的区域对Xbox的启动没有影响。特别是，从0xFFFF.FE00到0xFFFF.FFFF的整个启动初始化序列可以被清除，而Xbox仍然可以正常启动。
- en: 'This finding alone strongly supported the theory of a bogus boot block in FLASH
    ROM. The question remained, however, about where the real boot code was stored.
    There were three options: in a secondary crypto-processor, in the processor, and
    in the chipset. The secondary crypto-processor theory was discounted on the basis
    that there were no chips on the motherboard that were powerful enough or active
    enough at boot time to play the role of a crypto processor. Storing the boot block
    in the processor was also deemed a less likely option than storing the boot block
    in the chipset.'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 这个发现本身强烈支持了FLASH ROM中存在无效启动块的理论。然而，关于真正的启动代码存储在哪里的问题仍然存在。有三个选项：在二级加密处理器中、在处理器中以及在芯片组中。基于没有芯片在主板上足够强大或足够活跃，足以在启动时扮演加密处理器的角色，因此排除了二级加密处理器的理论。将启动块存储在处理器中也被认为比将启动块存储在芯片组中可能性更小。
- en: The rationale for this analysis is based on the economics of building chips.
    A Pentium III processor is very complex with many handcrafted blocks, and modifying
    the silicon to include a secure boot block would require significant engineering
    resources as well as an upfront investment of about a quarter of a million dollars
    just for the masks needed to produce the custom silicon. In addition, it was rumored
    that Microsoft had originally chosen an AMD processor for the Xbox, and switched
    to Intel at the last minute. If custom blocks were integrated into the processor
    core, Microsoft could not have switched between CPU vendors so easily. On the
    other hand, nVidia’s chipsets are designed modularly using silicon compilers,
    so it is technically easier to add warts like a secure boot block. Furthermore,
    the chipset in the Xbox is a custom build of the nForce made just for Microsoft,
    tailored specifically for an Intel front-side bus (FSB). As a result, the cost
    of adding a secure boot block could be rolled into the engineering resources and
    the mask sets already allocated to such a project.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 这种分析的理论依据是芯片制造的经济性。Pentium III处理器非常复杂，包含许多手工制作的模块，要将安全引导块集成到硅片中需要大量的工程资源，以及大约25万美元的前期投资，仅用于生产定制硅片的掩模。此外，有传言称微软最初为Xbox选择了AMD处理器，但在最后一刻改用了英特尔。如果定制模块集成到处理器核心中，微软就不可能如此轻易地在CPU供应商之间切换。另一方面，nVidia的芯片组是使用硅编译器模块化设计的，因此技术上更容易添加像安全引导块这样的瑕疵。此外，Xbox中的芯片组是专为微软定制的nForce，专门针对英特尔前端总线（FSB）。因此，添加安全引导块的成本可以并入分配给此类项目的工程资源和掩模集。
- en: 'Operating under the theory that the real boot code is located in a secret ROM
    overlay in the chipset, the challenges remaining were to determine in which chip
    (Northbridge or Southbridge) the code was stored, and how to extract this secret
    ROM. A few strategies for extracting the secret ROM presented themselves:'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在假设真实引导代码位于芯片组中一个秘密的ROM覆盖层中的理论指导下，剩余的挑战是要确定代码存储在哪个芯片（北桥或南桥）中，以及如何提取这个秘密ROM。以下是一些提取秘密ROM的策略：
- en: • **Use the JTAG “boundary scan” feature** on the Pentium to try to capture
    the initial boot code. JTAG is a diagnostic bus that allows you to read and set
    the state of every pin on a chip through a special serial port. It is a very powerful
    and versatile debugging tool.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: • **在Pentium上使用JTAG“边界扫描”功能**，试图捕获初始引导代码。JTAG是一种诊断总线，允许你通过一个特殊的串行端口读取和设置芯片上每个引脚的状态。它是一个非常强大且多功能的调试工具。
- en: • **Probe the processor FSB (Front Side Bus)** to try and capture the boot code
    as it enters the processor.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: • **探测处理器前端总线（Front Side Bus）**，试图捕获引导代码进入处理器时的状态。
- en: • **Install a memory sniffer** to try and capture the decrypted data stream
    as it is written into memory.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: • **安装内存嗅探器**，试图捕获写入内存的解密数据流。
- en: • **Use microscopy** to read out the contents of the secure boot area from the
    chip surface.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: • **使用显微镜**从芯片表面读取安全引导区域的内容。
- en: • **Probe the bus between the Southbridge and the** **Northbridge** chips to
    try and capture the boot code being sent to the processor by the chipset. This
    would only work if the boot data is stored somewhere in the Southbridge chip.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: • **探测南桥和** **北桥**芯片之间的总线，试图捕获芯片组发送给处理器的引导代码。这只有在引导数据存储在南桥芯片的某个地方时才会有效。
- en: '![](../Images/index-116_1.png)'
  id: totrans-60
  prefs: []
  type: TYPE_IMG
  zh: '![图片](../Images/index-116_1.png)'
- en: '**Figure 6-3**: Missing JTAG via. Note how the fil ed in copper region (lighter
    area) has a hole where a via used to be. This is the result of a last-minute change
    to the board layout without recalculation of the fill regions.'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '**图6-3**：缺少JTAG。注意填充的铜区域（较亮区域）中有一个孔，那里原本有一个通孔。这是由于在最后时刻对电路板布局进行了更改，而没有重新计算填充区域的结果。'
- en: None of these theories were trivial to test, so the Xbox hacking effort slowly
    ground down to a halt as frustrated hackers gave up trying to cryptanalyze the
    FLASH ROM image. I would have been one of the quitters (after all, I had a doctoral
    thesis to finish *and* write in just a few months) had it not been for the community
    of determined hackers feeding me encouragement. Over Christmas break in December
    2001, I kept in touch with my hacker friends via IRC channels and web fora. Hackers
    from all over the world and all walks of life pervaded the Xbox hacking IRC channel,
    and I enjoyed learning from them and chatting with them about their various experiences,
    both technical and personal.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 这些理论中的任何一个都不容易测试，因此随着沮丧的黑客放弃尝试破解FLASH ROM映像，Xbox破解的努力逐渐放缓。如果不是一群坚定的黑客给我鼓励，我可能也会成为那些放弃者之一（毕竟，我还有一篇博士论文要在几个月内完成）。2001年12月的圣诞节假期，我通过IRC频道和网页论坛与我的黑客朋友们保持联系。来自世界各地和各行各业的黑客充斥着Xbox破解的IRC频道，我从他们那里学到了很多，并且乐于与他们交流他们的各种经历，无论是技术上的还是个人方面的。
- en: Even though I was determined to spend all of January writing my PhD thesis⁶
    and avoiding Xbox hacking, I was still pulled in by the intriguingly complex security
    employed by the Xbox. As time went on, the need for a hardware guy to join the
    small group of hardcore hackers hanging out on the IRC channel became increasingly
    clear. By the end of January, the reports I was hearing about the Xbox security
    scheme were too interesting to ignore.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管我决心在1月份写完我的博士论文并避免Xbox破解，但我仍然被Xbox所采用的复杂安全机制所吸引。随着时间的推移，需要一位硬件专家加入在IRC频道上闲逛的小组核心黑客的需求变得越来越明显。到了1月底，我听到的关于Xbox安全方案的报告太有趣了，无法忽视。
- en: I purchased a second Xbox and I started removing all of its key parts using
    a hot air gun. Stripping down the Xbox served many purposes. First, removing the
    chips exposed all of the traces and connections on the Xbox so that I could easily
    follow the connections between chips using the continuity test mode on my multimeter.
    Second, I was able to drop all of the interesting chips into a hot acid bath and
    remove their plastic encapsulation for analysis under a microscope. Finally, buying
    an Xbox and totally ripping it apart gave me a sort of peace of mind when it comes
    to probing and modifying a working Xbox. (Reverse engineering is like gardening.
    Planting a garden is much more challenging if you’re trying to keep your hands
    and knees clean, so you might as well get over it and start rolling in the dirt.)
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 我购买了一个二手Xbox，并开始使用热风枪拆除它的所有关键部件。拆解Xbox有很多用途。首先，移除芯片暴露了Xbox上所有的痕迹和连接，这样我就可以轻松地用万用表的通断测试模式追踪芯片之间的连接。其次，我能够将所有有趣的芯片放入热酸浴中，去除它们的塑料封装，以便在显微镜下进行分析。最后，购买一个Xbox并将其完全拆解，在探测和修改一个工作Xbox时给了我一种内心的平静。（逆向工程就像园艺。如果你试图保持双手和膝盖干净，那么种植花园会更具挑战性，所以你不妨放下这些，开始与泥土为伍。）
- en: The results of the Xbox tear-down revealed some of the measures that Microsoft
    took to secure the box against hardware hackers. For example, I first checked
    the JTAG connections on the Pentium CPU. All of the JTAG signals were conveniently
    routed to a set of easy-to-tap resistors near the processor, except for one, the
    TRST# signal. TRST# plays a critical role in initializing the JTAG interface.
    Interestingly, TRST# was tied to the internal ground plane, in a difficult to
    access area, permanently deactivating the JTAG mechanism. Further inspection of
    the Xbox motherboard revealed hints that the TRST# signal was stripped out at
    the last minute. (The biggest hint of a missing via is a hole in a power trace
    perfectly sized for a via near a cluster of vias dedicated to JTAG signals, as
    shown in Figure 6-3.)
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: Xbox拆解的结果揭示了微软为防止硬件黑客攻击所采取的一些措施。例如，我首先检查了Pentium CPU上的JTAG连接。所有的JTAG信号都方便地连接到处理器附近的一组易于接触的电阻上，除了一个，那就是TRST#信号。TRST#在初始化JTAG接口中起着关键作用。有趣的是，TRST#被连接到内部接地平面，在一个难以接触的区域，永久地禁用了JTAG机制。进一步检查Xbox主板揭示了TRST#信号在最后一刻被移除的线索。（最大的线索是一个缺失的通孔，它位于一个电源迹线上的孔，大小正好适合一个通孔，该通孔位于一组专门用于JTAG信号的通孔簇附近，如图6-3所示。）
- en: Another blow to the JTAG approach for extracting the secret ROM is the fact
    that Intel’s JTAG scan codes are proprietary. Reverse engineering the codes to
    a level where I could use them for extracting the secret boot data was a major
    project on its own.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 对于提取秘密ROM的JTAG方法来说，另一个打击是英特尔JTAG扫描码是专有的。将这些代码逆向工程到我可以用来提取秘密启动数据的地步是一个重大的项目。
- en: Giving up on the JTAG approach, the next method for extracting the secret ROM
    was to strip the packaging off of the CPU, GPU, and MCPX and to inspect the bare
    die with a microscope and search for any candidate ROM structures. Package removal
    or “decapsulation” was accomplished by bathing the chips in fuming hot sulfuric
    acid. (I don’t recommend trying this approach at home; one time I spilled the
    toxic, corrosive solution all over myself and thankfully, my protective gear was
    consumed instead of my skin. Fuming sulfuric consumes organic material faster
    than a burning flame.) Fuming nitric, also very toxic and dangerous, can also
    be used. While I have not tried it myself, reports indicate that fuming nitric
    is more effective at removing the epoxy encapsulation, especially in situations
    where selective package removal is desired.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 放弃了JTAG方法后，提取秘密ROM的下一种方法是剥去CPU、GPU和MCPX的封装，用显微镜检查裸芯片并寻找任何候选的ROM结构。通过将芯片浸泡在冒烟的热硫酸中来去除封装或“去封装”。（我不建议在家尝试这种方法；有一次我不小心把有毒的腐蚀性溶液洒了一身，幸运的是，我的防护装备被消耗掉了，而不是我的皮肤。冒烟的硫酸比燃烧的火焰消耗有机材料更快。）冒烟的硝酸也非常有毒和危险，也可以使用。虽然我自己没有尝试过，但报告显示，冒烟的硝酸在去除环氧封装方面更有效，尤其是在需要选择性去除封装的情况下。
- en: 'The manual inspection approach using a traditional visible light microscope
    offered some hope; however, the technique is limited by the physics of light.
    Not even the best visible microscopy technology can resolve a 150 nm transistor,
    since the shortest wavelength of light is 450 nm (corresponding to the color blue).
    I was hoping the secret code would be stored on the chips using a traditional
    array ROM structure, with the metal lines defining a 1 or a 0 etched into the
    top metal layers which can be identified with an optical microscope. The use of
    a hard-wired ROM structure is motivated by cost: FLASH ROMs and fuse-based PROMs
    require extra processing and manufacturing steps that can add significantly to
    the cost of the system, whereas the use of top metal layers would be motivated
    by risk management on the designer’s part. Top metal layers are the coarsest layers
    (so coarse that an optical microscope may resolve them), and are thus the cheapest
    layers to change if there is a bug in the ROM code. Also, during initial bring-up,
    the top layer is the easiest to cut and jumper using a chip repair machine knows
    as a FIB (focused ion beam) machine. Unfortunately, a quick glance at the chip
    under the microscope revealed no such structures.'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 使用传统可见光显微镜进行人工检查的方法提供了一些希望；然而，该技术受限于光的物理特性。即使是最好的可见光显微镜技术也无法分辨150纳米的晶体管，因为光的最短波长是450纳米（对应蓝色）。我原本希望秘密代码会存储在芯片上，使用传统的阵列ROM结构，金属线路定义的1或0刻入顶层金属层，这些可以通过光学显微镜识别。使用硬连线ROM结构是出于成本的考虑：FLASH
    ROM和基于熔丝的PROM需要额外的加工和制造步骤，这可能会显著增加系统的成本，而使用顶层金属层则是出于设计者风险管理方面的考虑。顶层金属层是最粗糙的层（粗糙到光学显微镜可能可以分辨它们），因此如果ROM代码中存在错误，它们是最便宜的层之一。此外，在初始启动过程中，顶层是最容易使用芯片修复机（称为FIB机，即聚焦离子束机）切割和跳线的。不幸的是，在显微镜下快速查看芯片时，并没有发现这样的结构。
- en: At this point, the only remaining option for extracting the secret ROM was to
    probe the live Xbox hardware, in an effort to capture the code during loading
    into the Xbox processor. Eavesdropping for code upstream of the Southbridge chip
    and the FLASH ROM meant probing either the Front Side bus, the Northbridge-Southbridge
    bus, or the main memory bus. We’ll discuss the trade-offs of executing these probing
    approaches in Chapter 8, after a short introduction to basic security concepts
    in the next chapter.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个阶段，提取秘密ROM的唯一选择是探测活着的Xbox硬件，试图在代码加载到Xbox处理器时捕获它。在上桥芯片和FLASH ROM上游监听代码意味着探测前端总线、北桥-南桥总线或主内存总线。我们将在下一章简要介绍基本安全概念之后，在第8章讨论执行这些探测方法的权衡。
- en: '* * *'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ¹ Andy Green has an excellent page that documents his experiences with the test
    clip approach at http://www.warmcat.com/milksop/milksop.html
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: ¹ 安迪·格林有一个优秀的页面，记录了他使用测试夹具方法的经历，请访问 http://www.warmcat.com/milksop/milksop.html。
- en: ² Visor has written up his experiences with the logic analyzer snooping approach
    at http://www.xboxhacker.net/visor/aXventure1.txt
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: ² Visor 在 http://www.xboxhacker.net/visor/aXventure1.txt 上记录了他使用逻辑分析仪窃听方法的经历。
- en: ³ Emulation Technologies (http://www.emulation.com) makes a wide line of affordable
    sockets for purposes just like these. The specific model for the Xbox is the S-TS-SM-040-A.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: ³ 模拟技术公司（http://www.emulation.com）生产了一系列价格合理的插座，适用于此类用途。针对 Xbox 的具体型号是 S-TS-SM-040-A。
- en: ⁴ http://www.xenatera.com/bunnie/proj/flashburn/fb.html
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: ⁴ http://www.xenatera.com/bunnie/proj/flashburn/fb.html
- en: ⁵ http://www.xenatera.com/bunnie/proj/fb2/
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: ⁵ http://www.xenatera.com/bunnie/proj/fb2/
- en: ⁶ For those interested in supercomputer architecture, data and thread migration,
    fault tolerance, high speed low-latency networks, or massively multithreaded machines,
    check out my thesis at http://www.xenatera.com/bunnie/phdthesis.pdf.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: ⁶ 对于对超级计算机架构、数据与线程迁移、容错性、高速低延迟网络或大规模多线程机器感兴趣的人，请查看我的论文，链接为 http://www.xenatera.com/bunnie/phdthesis.pdf。
