- en: Chapter 17\. OPENSSH SERVER 4.7P1
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[HTTP://WWW.OPENSSH.COM](HTTP://WWW.OPENSSH.COM)'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 17.1\. SUMMARY
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: OpenSSH is a set of open source utilities that implement the SSH (Secure Shell)
    protocol. SSH is a secure version of telnet; it's a protocol used to access the
    console or command line of remote systems. SSH provides administrators and users
    with access to a remote system as if they were physically at the console.
  prefs: []
  type: TYPE_NORMAL
- en: SSH uses encryption to prevent eavesdropping on connections made between a client
    and server. The telnet protocol lacks encryption; this gives eavesdroppers the
    ability to capture usernames and passwords with a packet sniffer. (A packet sniffer
    is a program designed to monitor and capture network traffic.)
  prefs: []
  type: TYPE_NORMAL
- en: OpenSSH commands an overwhelming 87 percent of the SSH market, according to
    a survey conducted in November 2005.^([[]](#CHP-17-1)) It is included in virtually
    every distribution of Linux and BSD, as well as Apple's Mac OS X.
  prefs: []
  type: TYPE_NORMAL
- en: ^([]) OpenBSD, "SSH Usage Profiling," [http://www.openssh.com/usage/index.html](http://www.openssh.com/usage/index.html).
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The SSH protocol was first developed in 1995 by Tatu Ylönen, a researcher from
    Helsinki University of Technology. Ylönen founded SSH Communications Security
    in late 1995 to develop and market SSH. His company currently markets the SSH
    Tectia Server/Client.
  prefs: []
  type: TYPE_NORMAL
- en: OpenSSH was originally conceived by the OpenBSD team as part of the OpenBSD
    2.6 release in December 1999\. The team used code from Tatu Ylönen's SSH project,
    which was originally open source. Bugs were fixed and features were added to the
    OpenSSH release. Soon after the release of OpenSSH, its developers decided to
    split into two teams. One group concentrated on the development of OpenSSH for
    OpenBSD while the other group developed a portable version of OpenSSH for use
    on other platforms. The portable edition has the letter P appended to the version
    to signify this. OpenSSH is still developed by the OpenBSD team and is led by
    its founder, Theo de Raadt.
  prefs: []
  type: TYPE_NORMAL
- en: 17.2\. RESOURCES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: OpenSSH Manual Pages
  prefs: []
  type: TYPE_NORMAL
- en: '[http://www.openssh.com/manual.html](http://www.openssh.com/manual.html)'
  prefs: []
  type: TYPE_NORMAL
- en: RFC 4251 - The Secure Shell (SSH) Protocol Architecture
  prefs: []
  type: TYPE_NORMAL
- en: '[http://tools.ietf.org/html/rfc4251](http://tools.ietf.org/html/rfc4251)'
  prefs: []
  type: TYPE_NORMAL
- en: 17.3\. REQUIRED
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) FreeBSD 7.0-RELEASE
    (see "[FreeBSD 7.0](freebsd_7.0_split_000.html#freebsd_7.0)")'
  prefs: []
  type: TYPE_IMG
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Updated ports
    collection (see "[FreeBSD Ports Collection](freebsd_ports_collection.html#freebsd_ports_collection)")'
  prefs: []
  type: TYPE_IMG
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Internet
    connection'
  prefs: []
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) OpenSSL (see
    "[OpenSSL 0.9.8g](openssl_0.9.8g.html#openssl_0.9.8g)")'
  prefs: []
  type: TYPE_IMG
- en: 17.4\. PREPARATION
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Become the superuser.
  prefs: []
  type: TYPE_NORMAL
- en: 17.5\. INSTALL
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: OpenSSH 4.5.p1 is part of the standard FreeBSD 7.0 distribution. In this guide,
    we will replace the base version with an updated version of OpenSSH from the ports
    collection.
  prefs: []
  type: TYPE_NORMAL
- en: 'To begin the OpenSSH installation process, enter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: A menu with options for OpenSSH will appear. We will leave them at their defaults,
    so press [tab] to highlight OK and then press [enter] to start the installation.
  prefs: []
  type: TYPE_NORMAL
- en: 17.6\. CONFIGURE
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Once the installation process is complete, it's time to configure OpenSSH for
    use on your system.
  prefs: []
  type: TYPE_NORMAL
- en: 'The line `"NO_OPENSSH = YES"` must be added to the make.conf file in /etc.
    This tells make not to build the base version of OpenSSH if you rebuild FreeBSD
    from source (i.e., this prevents the system from downgrading OpenSSH to the older
    base version). The following commands will add this line to make.conf:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: OpenSSH's default configuration file has changed slightly from the base version
    to increase security. We'll replace the base configuration file with this newly
    installed file.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** You may need to re-modify the sshd_config file if you previously
    made any customizations.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 17.7\. TESTING
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In this section, we'll perform some basic tests to confirm that OpenSSH answers
    SSH requests properly.
  prefs: []
  type: TYPE_NORMAL
- en: 'To start OpenSSH Server automatically at boot time, open rc.conf:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'and add the following line (if it''s not already present):'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Save and exit.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'To test if OpenSSH is answering properly on port 22, connect via telnet and
    examine the response. Use the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** You may replace `localhost` with the FQDN or IP address of your
    server if you are testing from a different system.'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'The connection should yield the following banner:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: Verify that the correct version appears in the banner (SSH-2.0 and OpenSSH_4.7p1
    or later). Press [enter] to quit and return to the command prompt. You should
    now be able to connect with any SSH-capable client and any valid user account
    other than root.
  prefs: []
  type: TYPE_NORMAL
- en: 17.8\. UTILITIES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: OpenSSH includes an SSH client, SFTP (secure file transfer) client, and SCP
    (secure copy) client. Each program is designed to operate similarly to the original,
    but insecure, telnet and FTP protocols. The SSH client enables users to securely
    log in to remote systems and the SFTP and SCP clients make secure file transfers
    possible.
  prefs: []
  type: TYPE_NORMAL
- en: 17.8.1\. SSH Client
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: This program is used to securely log in to the console of a remote system (i.e.,
    start a terminal session).
  prefs: []
  type: TYPE_NORMAL
- en: Command
  prefs: []
  type: TYPE_NORMAL
- en: '`ssh`'
  prefs: []
  type: TYPE_NORMAL
- en: Syntax
  prefs: []
  type: TYPE_NORMAL
- en: '`ssh -``*options*` `*user@host*`'
  prefs: []
  type: TYPE_NORMAL
- en: Options
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: Specify a port in which to connect to the remote host (the OpenSSH server must
    be configured for the port you specify).
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: '`**localport:host:remoteport**` Forward a specified local port to a specified
    host port over the secure connection.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: Do not execute remote commands (used for port forwarding).
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: Run the SSH client as a background process.
  prefs: []
  type: TYPE_NORMAL
- en: Examples
  prefs: []
  type: TYPE_NORMAL
- en: 'To log in to a remote host named [host.example.com](http://host.example.com)
    as user johnny, enter the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'To log in to a remote host named [fluffy.net](http://fluffy.net) as user cat
    on port 23, enter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'To create an SSH tunnel from local port 1234 to remote port 110 on host [host.example.com](http://host.example.com)
    as user aeron, enter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 'To close this tunnel later, enter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: 17.8.2\. Secure Copy Client
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: This utility securely copies files and directories to or from a remote host.
  prefs: []
  type: TYPE_NORMAL
- en: Command
  prefs: []
  type: TYPE_NORMAL
- en: '`scp`'
  prefs: []
  type: TYPE_NORMAL
- en: Syntax `scp -``*options filename user@host:path*`
  prefs: []
  type: TYPE_NORMAL
- en: Options
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: Enable data compression.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: Specify a port in which to connect to the remote host (the OpenSSH server must
    be configured for the port you specify).
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: Preserve the original file's modification times, access times, and file modes.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: Recursively copy directories.
  prefs: []
  type: TYPE_NORMAL
- en: Examples
  prefs: []
  type: TYPE_NORMAL
- en: 'To copy a file named example.doc from the current working directory to the
    /usr/home directory on a remote system [example.com](http://example.com) as user
    author, enter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: 'To copy everything within the local /usr/samba directory to /usr/home on a
    remote system [example.com](http://example.com) as user author while preserving
    file modes and enabling data compression, enter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: 'To copy a file named /usr/example.doc to the /usr directory on the local system
    using port 23, using the author account on a host named [server1.example.com](http://server1.example.com),
    enter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: 17.8.3\. Secure File Transfer Client
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: This program is an interactive and secure file transfer client. It can be used
    as an alternative to FTP, which is inherently insecure.
  prefs: []
  type: TYPE_NORMAL
- en: Command
  prefs: []
  type: TYPE_NORMAL
- en: '`sftp`'
  prefs: []
  type: TYPE_NORMAL
- en: Syntax
  prefs: []
  type: TYPE_NORMAL
- en: '`sftp -``*options user@host*`'
  prefs: []
  type: TYPE_NORMAL
- en: Options
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: Specify a port in which to connect to the remote host (the OpenSSH server must
    be configured for the port you specify).
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: Enable data compression.
  prefs: []
  type: TYPE_NORMAL
- en: Examples
  prefs: []
  type: TYPE_NORMAL
- en: 'To initiate a connection to a host named [server.example.com](http://server.example.com)
    as user test, enter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: 'To connect to a host named [example.com](http://example.com) over port 23 as
    user wilson with compression enabled, enter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs: []
  type: TYPE_PRE
- en: 17.9\. CONFIG FILES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: /etc/ssh/sshd_config
  prefs: []
  type: TYPE_NORMAL
- en: Contains general settings for sshd (SSH server daemon). It is generally safe
    to leave this file at its defaults.
  prefs: []
  type: TYPE_NORMAL
- en: /etc/ssh/ssh_config
  prefs: []
  type: TYPE_NORMAL
- en: Contains general settings for ssh (SSH client program).
  prefs: []
  type: TYPE_NORMAL
- en: 17.10\. LOG FILES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: /var/log/auth.log
  prefs: []
  type: TYPE_NORMAL
- en: A general log of SSH server activity
  prefs: []
  type: TYPE_NORMAL
- en: 17.11\. NOTES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'By default, all user accounts with shell access on your server will have SSH
    access (except for root). If you want to limit SSH access to specific users, you
    will need to add a line to the sshd_config file located in /etc/ssh. Open it like
    so:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE26]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'and add the following line:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Replace `*username*` with the login name of the user you want to allow SSH access.
    Separate multiple users with spaces. Only users who appear on this line will have
    access to SSH-based services.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** Be aware that this line is case sensitive. Confirm that the usernames
    are correct, especially if you are making this change from a remote location.
    You can lock yourself out if this is misconfigured!'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Save, exit, and restart sshd:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE28]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Host keys are usually created after the initial FreeBSD installation process,
    if SSH logins were enabled. If you need to re-create them, it is easiest to remove
    the old keys and restart the SSH daemon. The SSH daemon will recreate the keys
    automatically. These commands will accomplish this:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE29]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'By default, OpenSSH Server will not allow root logins. If you need root privileges,
    you will need to log in as a normal user who is a member of the wheel group and
    then use the `su` command to become the superuser. see "[su](general.html#su)"
    for details. To add a user named lucky to the wheel group, log in as root and
    enter:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE30]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
