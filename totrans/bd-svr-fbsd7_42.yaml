- en: Chapter 17\. OPENSSH SERVER 4.7P1
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[HTTP://WWW.OPENSSH.COM](HTTP://WWW.OPENSSH.COM)'
  id: totrans-1
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 17.1\. SUMMARY
  id: totrans-2
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: OpenSSH is a set of open source utilities that implement the SSH (Secure Shell)
    protocol. SSH is a secure version of telnet; it's a protocol used to access the
    console or command line of remote systems. SSH provides administrators and users
    with access to a remote system as if they were physically at the console.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
- en: SSH uses encryption to prevent eavesdropping on connections made between a client
    and server. The telnet protocol lacks encryption; this gives eavesdroppers the
    ability to capture usernames and passwords with a packet sniffer. (A packet sniffer
    is a program designed to monitor and capture network traffic.)
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
- en: OpenSSH commands an overwhelming 87 percent of the SSH market, according to
    a survey conducted in November 2005.^([[]](#CHP-17-1)) It is included in virtually
    every distribution of Linux and BSD, as well as Apple's Mac OS X.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
- en: ^([]) OpenBSD, "SSH Usage Profiling," [http://www.openssh.com/usage/index.html](http://www.openssh.com/usage/index.html).
  id: totrans-6
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The SSH protocol was first developed in 1995 by Tatu Ylönen, a researcher from
    Helsinki University of Technology. Ylönen founded SSH Communications Security
    in late 1995 to develop and market SSH. His company currently markets the SSH
    Tectia Server/Client.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
- en: OpenSSH was originally conceived by the OpenBSD team as part of the OpenBSD
    2.6 release in December 1999\. The team used code from Tatu Ylönen's SSH project,
    which was originally open source. Bugs were fixed and features were added to the
    OpenSSH release. Soon after the release of OpenSSH, its developers decided to
    split into two teams. One group concentrated on the development of OpenSSH for
    OpenBSD while the other group developed a portable version of OpenSSH for use
    on other platforms. The portable edition has the letter P appended to the version
    to signify this. OpenSSH is still developed by the OpenBSD team and is led by
    its founder, Theo de Raadt.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: 17.2\. RESOURCES
  id: totrans-9
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: OpenSSH Manual Pages
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: '[http://www.openssh.com/manual.html](http://www.openssh.com/manual.html)'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: RFC 4251 - The Secure Shell (SSH) Protocol Architecture
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: '[http://tools.ietf.org/html/rfc4251](http://tools.ietf.org/html/rfc4251)'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
- en: 17.3\. REQUIRED
  id: totrans-14
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) FreeBSD 7.0-RELEASE
    (see "[FreeBSD 7.0](freebsd_7.0_split_000.html#freebsd_7.0)")'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Updated ports
    collection (see "[FreeBSD Ports Collection](freebsd_ports_collection.html#freebsd_ports_collection)")'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Internet
    connection'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) OpenSSL (see
    "[OpenSSL 0.9.8g](openssl_0.9.8g.html#openssl_0.9.8g)")'
  id: totrans-18
  prefs: []
  type: TYPE_IMG
- en: 17.4\. PREPARATION
  id: totrans-19
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Become the superuser.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
- en: 17.5\. INSTALL
  id: totrans-21
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: OpenSSH 4.5.p1 is part of the standard FreeBSD 7.0 distribution. In this guide,
    we will replace the base version with an updated version of OpenSSH from the ports
    collection.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
- en: 'To begin the OpenSSH installation process, enter:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: A menu with options for OpenSSH will appear. We will leave them at their defaults,
    so press [tab] to highlight OK and then press [enter] to start the installation.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
- en: 17.6\. CONFIGURE
  id: totrans-26
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Once the installation process is complete, it's time to configure OpenSSH for
    use on your system.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
- en: 'The line `"NO_OPENSSH = YES"` must be added to the make.conf file in /etc.
    This tells make not to build the base version of OpenSSH if you rebuild FreeBSD
    from source (i.e., this prevents the system from downgrading OpenSSH to the older
    base version). The following commands will add this line to make.conf:'
  id: totrans-28
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  id: totrans-29
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: OpenSSH's default configuration file has changed slightly from the base version
    to increase security. We'll replace the base configuration file with this newly
    installed file.
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  id: totrans-31
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '* * *'
  id: totrans-32
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** You may need to re-modify the sshd_config file if you previously
    made any customizations.'
  id: totrans-33
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-34
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 17.7\. TESTING
  id: totrans-35
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In this section, we'll perform some basic tests to confirm that OpenSSH answers
    SSH requests properly.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
- en: 'To start OpenSSH Server automatically at boot time, open rc.conf:'
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  id: totrans-38
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'and add the following line (if it''s not already present):'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-40
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Save and exit.
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'To test if OpenSSH is answering properly on port 22, connect via telnet and
    examine the response. Use the following command:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '* * *'
  id: totrans-44
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** You may replace `localhost` with the FQDN or IP address of your
    server if you are testing from a different system.'
  id: totrans-45
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-46
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'The connection should yield the following banner:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Verify that the correct version appears in the banner (SSH-2.0 and OpenSSH_4.7p1
    or later). Press [enter] to quit and return to the command prompt. You should
    now be able to connect with any SSH-capable client and any valid user account
    other than root.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
- en: 17.8\. UTILITIES
  id: totrans-50
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: OpenSSH includes an SSH client, SFTP (secure file transfer) client, and SCP
    (secure copy) client. Each program is designed to operate similarly to the original,
    but insecure, telnet and FTP protocols. The SSH client enables users to securely
    log in to remote systems and the SFTP and SCP clients make secure file transfers
    possible.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
- en: 17.8.1\. SSH Client
  id: totrans-52
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: This program is used to securely log in to the console of a remote system (i.e.,
    start a terminal session).
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
- en: Command
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: '`ssh`'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: Syntax
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: '`ssh -``*options*` `*user@host*`'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
- en: Options
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Specify a port in which to connect to the remote host (the OpenSSH server must
    be configured for the port you specify).
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '`**localport:host:remoteport**` Forward a specified local port to a specified
    host port over the secure connection.'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Do not execute remote commands (used for port forwarding).
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: Run the SSH client as a background process.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: Examples
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
- en: 'To log in to a remote host named [host.example.com](http://host.example.com)
    as user johnny, enter the following command:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-69
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'To log in to a remote host named [fluffy.net](http://fluffy.net) as user cat
    on port 23, enter:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'To create an SSH tunnel from local port 1234 to remote port 110 on host [host.example.com](http://host.example.com)
    as user aeron, enter:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'To close this tunnel later, enter:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 17.8.2\. Secure Copy Client
  id: totrans-76
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: This utility securely copies files and directories to or from a remote host.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
- en: Command
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
- en: '`scp`'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
- en: Syntax `scp -``*options filename user@host:path*`
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
- en: Options
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: Enable data compression.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Specify a port in which to connect to the remote host (the OpenSSH server must
    be configured for the port you specify).
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Preserve the original file's modification times, access times, and file modes.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Recursively copy directories.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
- en: Examples
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
- en: 'To copy a file named example.doc from the current working directory to the
    /usr/home directory on a remote system [example.com](http://example.com) as user
    author, enter:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'To copy everything within the local /usr/samba directory to /usr/home on a
    remote system [example.com](http://example.com) as user author while preserving
    file modes and enabling data compression, enter:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'To copy a file named /usr/example.doc to the /usr directory on the local system
    using port 23, using the author account on a host named [server1.example.com](http://server1.example.com),
    enter:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 17.8.3\. Secure File Transfer Client
  id: totrans-97
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: This program is an interactive and secure file transfer client. It can be used
    as an alternative to FTP, which is inherently insecure.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
- en: Command
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
- en: '`sftp`'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
- en: Syntax
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
- en: '`sftp -``*options user@host*`'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
- en: Options
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: Specify a port in which to connect to the remote host (the OpenSSH server must
    be configured for the port you specify).
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: Enable data compression.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
- en: Examples
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
- en: 'To initiate a connection to a host named [server.example.com](http://server.example.com)
    as user test, enter:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'To connect to a host named [example.com](http://example.com) over port 23 as
    user wilson with compression enabled, enter:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE25]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 17.9\. CONFIG FILES
  id: totrans-113
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: /etc/ssh/sshd_config
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
- en: Contains general settings for sshd (SSH server daemon). It is generally safe
    to leave this file at its defaults.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
- en: /etc/ssh/ssh_config
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
- en: Contains general settings for ssh (SSH client program).
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
- en: 17.10\. LOG FILES
  id: totrans-118
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: /var/log/auth.log
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
- en: A general log of SSH server activity
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
- en: 17.11\. NOTES
  id: totrans-121
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'By default, all user accounts with shell access on your server will have SSH
    access (except for root). If you want to limit SSH access to specific users, you
    will need to add a line to the sshd_config file located in /etc/ssh. Open it like
    so:'
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE26]'
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'and add the following line:'
  id: totrans-124
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE27]'
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Replace `*username*` with the login name of the user you want to allow SSH access.
    Separate multiple users with spaces. Only users who appear on this line will have
    access to SSH-based services.
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-127
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** Be aware that this line is case sensitive. Confirm that the usernames
    are correct, especially if you are making this change from a remote location.
    You can lock yourself out if this is misconfigured!'
  id: totrans-128
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  id: totrans-129
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Save, exit, and restart sshd:'
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE28]'
  id: totrans-131
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Host keys are usually created after the initial FreeBSD installation process,
    if SSH logins were enabled. If you need to re-create them, it is easiest to remove
    the old keys and restart the SSH daemon. The SSH daemon will recreate the keys
    automatically. These commands will accomplish this:'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主机密钥通常在初始FreeBSD安装过程之后创建，如果启用了SSH登录。如果您需要重新创建它们，最简单的方法是删除旧密钥并重新启动SSH守护进程。SSH守护进程将自动重新创建密钥。以下命令将完成此操作：
- en: '[PRE29]'
  id: totrans-133
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'By default, OpenSSH Server will not allow root logins. If you need root privileges,
    you will need to log in as a normal user who is a member of the wheel group and
    then use the `su` command to become the superuser. see "[su](general.html#su)"
    for details. To add a user named lucky to the wheel group, log in as root and
    enter:'
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 默认情况下，OpenSSH服务器不允许root登录。如果您需要root权限，您需要以wheel组成员的正常用户身份登录，然后使用`su`命令成为超级用户。有关详细信息，请参阅"[su](general.html#su)"。要将名为lucky的用户添加到wheel组，以root身份登录并输入：
- en: '[PRE30]'
  id: totrans-135
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
