- en: Chapter 9. GO SERVER-SIDE
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第九章：GO 服务器端
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages671943.png.jpg)'
  id: totrans-1
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages671943.png.jpg)'
- en: Mapping APIs are popular because they bring a lot of power to the web browser
    that used to be much more difficult for the average developer to achieve. Plenty
    of situations still exist, however, where your application will benefit from scripts
    that run *outside* of the browser. This is when you'll need to go server-side.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 地图API之所以受欢迎，是因为它们为网页浏览器带来了许多以前对普通开发者来说更难实现的功能。然而，仍然存在许多情况，你的应用程序将从运行在浏览器外的脚本中受益。这就是你需要转向服务器端的时候。
- en: 'In this chapter, we''ll look at two popular technologies that run on a server:
    PHP, a programming language used mostly to output web pages; and MySQL, a database
    for storing text, numbers, and a whole lot more. As opposed to the numerous other
    available technologies, I''ve chosen these two for their ubiquity—almost all web
    hosts support them. They are also solid platforms used by many including, most
    notably, Yahoo!.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将探讨两种在服务器上运行的技术：PHP，一种主要用于输出网页的编程语言；以及MySQL，一个用于存储文本、数字和更多内容的数据库。与众多其他可用的技术相比，我选择了这两种技术，因为它们非常普遍——几乎所有的网络主机都支持它们。它们也是由包括Yahoo!在内的许多公司使用的稳固平台。
- en: Entire books have been devoted to PHP and MySQL, together and separately. I'll
    only provide a very quick primer to get you started. Then we'll dive into how
    each can help you make better maps, including storing locations and finding the
    nearest locations from your database.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 已经有整本书专门介绍了PHP和MySQL，包括它们各自的内容。我将只提供一个非常快速的基础知识，以帮助你入门。然后我们将深入探讨每个如何帮助你制作更好的地图，包括存储位置和从数据库中查找最近的位置。
- en: '#59: Install PHP'
  id: totrans-5
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '#59：安装PHP'
- en: PHP is an extremely popular programming language for easily creating dynamic
    web pages and applications. You can install it on your computer for testing or
    on a server for sharing with the world. In fact, if you have web hosting on a
    server, PHP may already be installed.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: PHP是一种极为流行的编程语言，可以轻松创建动态网页和应用。你可以在电脑上安装它进行测试，或者在服务器上安装以供全世界共享。实际上，如果你在服务器上拥有网络托管服务，PHP可能已经安装了。
- en: You need to use PHP in conjunction with a web server, the most common of which
    is Apache. Requests come from a web browser to your web server, which then looks
    to see if the page being requested uses PHP. If it does, then the page is sent
    to PHP for processing.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 你需要将PHP与一个网络服务器一起使用，其中最常见的是Apache。请求从网页浏览器发送到你的网络服务器，然后服务器会查看请求的页面是否使用了PHP。如果是，那么页面就会被发送到PHP进行处理。
- en: Next I show several ways to install PHP—or to determine if it is already installed.
    In only one situation will you have to also worry about installing Apache. Read
    on and we'll get you up to speed with PHP.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我将展示几种安装PHP或确定其是否已安装的方法。只有在你需要安装Apache的情况下，你才需要担心安装Apache。继续阅读，我们将帮助你快速掌握PHP。
- en: Check Your Web Host for PHP
  id: totrans-9
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 检查你的网络主机是否安装了PHP
- en: If you already have web hosting, you almost certainly have PHP installed already.
    The easiest way to check is to create a simple PHP file and then try accessing
    it with a web browser.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你已经拥有网络托管服务，那么你几乎肯定已经安装了PHP。最简单的方法是创建一个简单的PHP文件，然后尝试用网页浏览器访问它。
- en: You'll want to put this new file where you already know HTML files can be accessed.
    Your site administrator (who could also confirm whether you are able to access
    PHP) can point you to your public directory where web pages are stored.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 你会希望将这个新文件放在你已知可以访问HTML文件的地方。你的网站管理员（他也可以确认你是否能够访问PHP）可以指给你你的公共目录，其中存储着网页。
- en: 'Create a new PHP file in your web directory and add these few lines:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的网络目录中创建一个新的PHP文件，并添加以下几行：
- en: '[PRE0]'
  id: totrans-13
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Easy enough. Give the file a name ending in *.php* (I creatively chose *test.php*),
    and then from your web browser, go to its public web address. For example, I might
    go to *mapscripting.com/test.php*.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 很简单。给文件起一个以*.php*结尾的名字（我创意性地选择了*test.php*），然后从你的网页浏览器中，访问其公共网络地址。例如，我可能会访问*mapscripting.com/test.php*。
- en: If you see your own code when you load that file, then you probably don't have
    PHP. You'll need to ask your administrator to install it or find another way to
    use PHP. You'll know PHP is installed, however, if you see an information page
    like the one shown in [Figure 9-1](ch09.html#the_php_info_dumped_by_my_local_machine
    "Figure 9-1. The PHP info dumped by my local machine"). Remember to delete the
    file from your server when you're done.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您在加载该文件时看到自己的代码，那么您可能没有安装 PHP。您需要要求管理员安装它或找到另一种使用 PHP 的方法。然而，如果您看到一个像 [图 9-1](ch09.html#the_php_info_dumped_by_my_local_machine
    "图 9-1. 我本地机器输出的 PHP 信息") 中所示的信息页面，那么您就会知道 PHP 已安装。完成操作后，请记住从您的服务器上删除该文件。
- en: '![The PHP info dumped by my local machine](httpatomoreillycomsourcenostarchimages672087.png.jpg)'
  id: totrans-16
  prefs: []
  type: TYPE_IMG
  zh: '![我本地机器输出的 PHP 信息](httpatomoreillycomsourcenostarchimages672087.png.jpg)'
- en: Figure 9-1. The PHP info dumped by my local machine
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9-1. 我本地机器输出的 PHP 信息
- en: 'If you''re new to PHP, you might want to skip ahead to [#60: A Quick PHP Introduction](ch09s02.html
    "#60: A Quick PHP Introduction") in [Install PHP Yourself](ch09.html#install_php_yourself
    "Install PHP Yourself"). Otherwise, you need to check whether you have MySQL installed,
    too (see [#62: Install MySQL](ch09s04.html "#62: Install MySQL") in [Include Your
    Function in Other Scripts](ch09s03.html#include_your_function_in_other_scripts
    "Include Your Function in Other Scripts")), or connect PHP to MySQL (see [#65:
    Use MySQL from PHP](ch09s07.html "#65: Use MySQL from PHP") in [#65: Use MySQL
    from PHP](ch09s07.html "#65: Use MySQL from PHP")).'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '如果您是 PHP 新手，您可能想跳到 [第 60 节：快速 PHP 介绍](ch09s02.html "#60: A Quick PHP Introduction")，在
    [自行安装 PHP](ch09.html#install_php_yourself "自行安装 PHP") 中。否则，您需要检查是否已安装 MySQL（参见
    [第 62 节：安装 MySQL](ch09s04.html "#62: Install MySQL")，在 [在其他脚本中包含您的函数](ch09s03.html#include_your_function_in_other_scripts
    "在其他脚本中包含您的函数")），或者将 PHP 连接到 MySQL（参见 [第 65 节：从 PHP 使用 MySQL](ch09s07.html "#65:
    Use MySQL from PHP")，在 [第 65 节：从 PHP 使用 MySQL](ch09s07.html "#65: Use MySQL from
    PHP")）。'
- en: Use a Packaged Installation of PHP
  id: totrans-19
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 PHP 的打包安装
- en: The easiest way to install PHP on your own computer is to download a package
    for your operating system. The upside to this method is that you'll also get Apache
    and MySQL at the same time, which is useful.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在您自己的计算机上安装 PHP 的最简单方法是下载适用于您操作系统的包。这种方法的好处是您还将同时获得 Apache 和 MySQL，这很有用。
- en: 'The names of the packages are patterned after the popular server architecture,
    *LAMP*, which stands for L*inux*, A*pache*, M*ySQL*, and P*HP*:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 这些包的名称是根据流行的服务器架构 *LAMP* 命名的，它代表 *L*inux, *A*pache, *M*ySQL, 和 *P*HP*：
- en: 'Windows (WAMP): [http://www.wampserver.com/](http://www.wampserver.com/)'
  id: totrans-22
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Windows (WAMP): [http://www.wampserver.com/](http://www.wampserver.com/)'
- en: 'Macintosh (MAMP): [http://www.mamp.info/](http://www.mamp.info/)'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Macintosh (MAMP): [http://www.mamp.info/](http://www.mamp.info/)'
- en: Either of these packages should install on your computer without needing much
    information from you (though you may have to enter an administrator password).
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 这两个包中的任何一个都应该可以在您的计算机上安装，而无需从您那里获取太多信息（尽管您可能需要输入管理员密码）。
- en: Open WAMP/MAMP once the install process has completed. The program should open
    two windows. First, it will open a small status dashboard, as shown in [Figure 9-2](ch09.html#the_mamp_console
    "Figure 9-2. The MAMP console"). Second, the application will also create a new
    web browser window pointed at *localhost*, the name of the server on your own
    computer. By default, you'll see a welcome screen.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 安装过程完成后，打开 WAMP/MAMP。程序应该打开两个窗口。首先，它将打开一个小的状态仪表板，如图 [图 9-2](ch09.html#the_mamp_console
    "图 9-2. MAMP 控制台") 所示。其次，应用程序还将创建一个新的指向 *localhost*（您计算机上的服务器名称）的网页浏览器窗口。默认情况下，您将看到一个欢迎屏幕。
- en: '![The MAMP console](httpatomoreillycomsourcenostarchimages672089.png.jpg)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![MAMP 控制台](httpatomoreillycomsourcenostarchimages672089.png.jpg)'
- en: Figure 9-2. The MAMP console
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9-2. MAMP 控制台
- en: You'll want to change the directory that WAMP/MAMP uses to look for your files.
    To do this, click the **Preferences** button, which will open a new pane with
    more options. Click the Apache (web server) tab, and then select a new document
    root, as shown in [Figure 9-3](ch09.html#change_the_mamp_document_root "Figure 9-3. Change
    the MAMP document root.").
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能希望更改 WAMP/MAMP 查找文件所使用的目录。为此，请单击 **首选项** 按钮，这将打开一个带有更多选项的新面板。单击 Apache（Web
    服务器）选项卡，然后选择一个新的文档根目录，如图 [图 9-3](ch09.html#change_the_mamp_document_root "图 9-3.
    更改 MAMP 文档根目录") 所示。
- en: '![Change the MAMP document root.](httpatomoreillycomsourcenostarchimages672091.png.jpg)'
  id: totrans-29
  prefs: []
  type: TYPE_IMG
  zh: '![更改 MAMP 文档根目录](httpatomoreillycomsourcenostarchimages672091.png.jpg)'
- en: Figure 9-3. Change the MAMP document root.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9-3. 更改 MAMP 文档根目录。
- en: Install PHP Yourself
  id: totrans-31
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 自行安装 PHP
- en: If you're using an operating system for which a package is not available, you'll
    need to install PHP yourself. Too many variations exist to describe in this chapter,
    but many tutorials are available on the Internet to help you.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用的是一个没有提供软件包的操作系统，你需要自己安装 PHP。由于存在太多的变体，本章中无法描述，但互联网上有许多教程可以帮助你。
- en: 'The PHP website is the first place to start: [http://php.org/](http://php.org/).'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: PHP 网站是开始的地方：[http://php.org/](http://php.org/)。
- en: '#60: A Quick PHP Introduction'
  id: totrans-34
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '#60: PHP 快速入门'
- en: Some very thick books—much thicker than this one—are dedicated to teaching you
    how to program with PHP. This project will provide the boost necessary to use
    PHP in some of your mapping projects. It will not, however, make you a master.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 有些非常厚的书籍——比这本书厚得多——专门用于教你如何用 PHP 编程。这个项目将提供必要的推动力，以便你在一些地图项目中使用 PHP。然而，它不会使你成为大师。
- en: In the sections that follow you'll learn the very basics about structuring PHP
    code. I'll also show you how to use conditionals, often called *if statements*.
    Next, you'll learn how to work with arrays and then use loops. Finally, I'll show
    how to create your own functions to reduce the amount of PHP you need to write.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的章节中，你将学习关于结构化 PHP 代码的非常基础的知识。我还会向你展示如何使用条件语句，通常称为 *if 语句*。接下来，你将学习如何处理数组，然后使用循环。最后，我将展示如何创建你自己的函数以减少需要编写的
    PHP 代码量。
- en: The Nitty Gritty
  id: totrans-37
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 精细之处
- en: PHP code is usually added to a file that ends with a *.php* extension. When
    the program is finished running, the output is most often HTML (though it can
    also be XML, JSON, or any text that can be transferred using HTTP). As such, PHP
    can be interspersed with plain HTML.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: PHP 代码通常被添加到以 *.php* 扩展名结尾的文件中。当程序运行完成后，输出通常是 HTML（尽管它也可以是 XML、JSON 或任何可以通过
    HTTP 传输的文本）。因此，PHP 可以与纯 HTML 混合使用。
- en: 'The PHP portions of the code are surrounded by a special *twi-character blocks*,
    `<?php` and `?>`. For example, try this small bit of code, which combines PHP
    and HTML:'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 代码中的 PHP 部分被特殊的 *双字符块* `<?php` 和 `?>` 包围。例如，尝试以下一小段代码，它结合了 PHP 和 HTML：
- en: '[PRE1]'
  id: totrans-40
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: This code is abbreviated HTML, of course. But from it, you should get an idea
    of how PHP works. And the code will load into a browser and simply display the
    text within the quotes, which is output by PHP's `print` function. Note the semicolon—most
    lines of PHP end with a semicolon. Exceptions exist, however; if you write a command
    on a single line, chances are it needs a `;` at the end.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 这段代码是缩略的 HTML。但从中，你应该能够了解 PHP 的工作原理。并且代码将加载到浏览器中，并简单地显示引号内的文本，这是由 PHP 的 `print`
    函数输出的。注意分号——大多数 PHP 行都以分号结束。然而，存在例外；如果你在一行中写一个命令，那么它很可能需要在末尾加上 `;`。
- en: Variables store values that can be changed or accessed later. They can hold
    numbers, text, and more and usually have a descriptive name, always starting with
    a dollar sign. For example, `$mynum` could be a variable for holding a single
    number.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 变量存储可以更改或稍后访问的值。它们可以存储数字、文本等，并且通常有一个描述性的名称，总是以美元符号开头。例如，`$mynum` 可以是一个用于存储单个数字的变量。
- en: 'Here is some code similar to the previous code, but containing a few variables:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 这里有一些与之前代码类似的代码，但包含了一些变量：
- en: '[PRE2]'
  id: totrans-44
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'When you run this example, it produces the following output:'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 当你运行这个示例时，它会生成以下输出：
- en: '[PRE3]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The code starts with a text variable ❶, often called a *string*. This variable
    starts the line that will eventually be the code's output. Next, you create a
    number variable ❷. I could have simply set this variable to 6, but I wanted to
    show how to add two numbers together.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 代码从一个文本变量 ❶ 开始，通常称为 *字符串*。这个变量开始了一行，最终将成为代码的输出。接下来，你创建一个数字变量 ❷。我本可以直接将这个变量设置为
    6，但我想要展示如何将两个数字相加。
- en: In the final line ❸ before outputting our message, I set the string equal to
    itself and then concatenate it with more text, before finally tacking the number
    onto the end. Note that to combine strings, you use a period, but to combine numbers,
    use a plus sign.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 在输出消息之前的最后一行 ❸ 中，我将字符串设置为等于自身，然后将其与更多文本连接起来，最后将数字附加到末尾。请注意，为了连接字符串，你使用点号，但为了连接数字，使用加号。
- en: If we replaced the plus in line ❷ with a period, the number output at the end
    of the message would be `51` (five followed by a one, instead of the number five
    added to the number one). If we replaced the first period in line ❸ with a plus
    sign, the entire message would be `06`, because the number representation of text
    is zero.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们将第 ❷ 行中的加号替换为点号，则消息末尾输出的数字将是 `51`（5 后跟 1，而不是数字 5 加上数字 1）。如果我们替换第 ❸ 行中的第一个点号为加号，整个消息将是
    `06`，因为文本的数字表示是零。
- en: Using the correct operator to combine numbers and text is important because
    the operator you use can change your output a great deal.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
- en: Taking Input
  id: totrans-51
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'You can accept input from the user in two ways: from the URL itself or through
    a form. Regardless of which possibility you choose, the method for accessing this
    data within PHP is very similar.'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
- en: 'If input is being passed in the URL, you''ll see something like this:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: To get at this info, you'll need to use a special PHP variable called `$_GET`.
    `$_GET` is an associative array, which is a collection of key-value pairs accessed
    using bracket syntax. Generally, you'll want to take the value from this array
    and put it into a new variable.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: 'For example, here is some PHP to access the two pieces of input:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Here''s the output of this PHP program:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-59
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: To grab the message ❶, I put the key used in the URL (i.e., **`msg`**`=Hello+there`)
    inside brackets after the `$_GET` variable.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
- en: Note
  id: totrans-61
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The name of the variables do not need to match the names used in the URL, though
    they can.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: Now I want to get at the number, which is the `num=42` section of the URL. I
    use the same method as in the previous code ❷, even though this is a number. Finally,
    I print out both of my new variables, along with some descriptive text ❸. Notice
    the periods used to concatenate the portions of the output.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
- en: Retrieving data from a form is very similar. Instead of `$_GET`, you use the
    variable `$_POST`. The only tricky part is that the form must have been sent to
    this page using the `action` attribute in HTML.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
- en: If This Is True, Then Do That
  id: totrans-65
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Your PHP programs need to make decisions. Because they aren't able to do this
    on their own, you need to tell them how to decide what to do. You do this using
    a *conditional*—or *if* statement.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: We'll build upon the previous example, where we received input in the URL, but
    we'll just use the number portion. We want to look at the number and provide different
    output if the number is a double digit number (10 or greater).
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
- en: 'Our URL will look something like this: *yourfile.php?num=42*.'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: 'And here is the code, including our two conditions:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: First, we grab the number that was passed in the URL ❶. This number is stored
    in a variable that can now be used in the rest of the program. We use this variable
    to create an `if` statement ❷, which checks if the number is less than 10\. If
    it is, a message to that effect is output.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
- en: Notice the curly braces, `{` and `}`, after the `if` statement. These hold all
    the code that is run when the `if` statement holds true. Otherwise, everything
    in the curly braces after the `else` ❸ is run instead. You can have an `if` without
    an `else`, but in this case, we want to do something in either of the cases, not
    just one.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
- en: Table 9-1. Comparison Operators
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
- en: '| Operator | Description | When used |'
  id: totrans-74
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- |'
  id: totrans-75
  prefs: []
  type: TYPE_TB
- en: '| == | Equal | Numbers or text |'
  id: totrans-76
  prefs: []
  type: TYPE_TB
- en: '| != | Not equal | Numbers or text |'
  id: totrans-77
  prefs: []
  type: TYPE_TB
- en: '| > | Greater than | Mostly numbers |'
  id: totrans-78
  prefs: []
  type: TYPE_TB
- en: '| < | Less than | Mostly numbers |'
  id: totrans-79
  prefs: []
  type: TYPE_TB
- en: '| >= | Greater than or equal | Mostly numbers |'
  id: totrans-80
  prefs: []
  type: TYPE_TB
- en: '| <= | Less than or equal | Mostly numbers |'
  id: totrans-81
  prefs: []
  type: TYPE_TB
  zh: '| <= | 小于等于 | 主要用于数字 |'
- en: There are six operators, shown in [Table 9-1](ch09s02.html#comparison_operators
    "Table 9-1. Comparison Operators"), to use when comparing variables. The operators
    are most useful to compare numbers, but can also be used to compare text.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 比较变量时，有六个运算符，如[表9-1](ch09s02.html#comparison_operators "表9-1. 比较运算符")所示，可以使用这些运算符。运算符主要用于比较数字，但也可以用于比较文本。
- en: Quite the Array
  id: totrans-83
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数组真多
- en: 'So far I''ve shown two types of variables: text and numbers. Two other common
    types are available, which I''ll introduce in this section.'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我已经展示了两种类型的变量：文本和数字。本节还将介绍两种其他常见类型。
- en: 'The first is an *array*. An array is a single variable that holds many other
    variables so you don''t have to name them individually. A simple array tracks
    the values it holds by index, which starts counting at zero. You can declare an
    array like so:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 第一种是*数组*。数组是一个包含许多其他变量的单个变量，因此你不必单独命名它们。简单的数组通过索引跟踪它持有的值，索引从零开始计数。你可以这样声明一个数组：
- en: '[PRE8]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: In this example, I used text. An array can also hold numbers, or a combination
    of numbers and text. It can also hold other arrays and objects, but let's keep
    it simple for now. Notice that the `array` function takes any number of values,
    separated by commas.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我使用了文本。数组也可以包含数字，或者数字和文本的组合。它还可以包含其他数组和对象，但让我们现在保持简单。注意`array`函数可以接受任意数量的值，用逗号分隔。
- en: 'Here is the line of code to print George (the third option):'
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是打印乔治（第三个选项）的代码行：
- en: '[PRE9]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: Notice the index is 2, instead of 3\. That's because the index starts at 0\.
    And the index goes inside square brackets `[` and `]` when accessing the values.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 注意索引是2，而不是3。这是因为索引从0开始。访问值时，索引位于方括号`[`和`]`内。
- en: The other kind of array I want to show you is called an *associative array*.
    Instead of using an index to track the values inside the array, it uses a textual
    key.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 我还想向你展示另一种类型的数组，称为*关联数组*。它不是使用索引来跟踪数组内的值，而是使用文本键。
- en: 'For example, you could access George using an associative array in this way:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，你可以通过以下方式使用关联数组访问George：
- en: '[PRE10]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'We still use the bracket notation, but instead of our index, we use our text
    key. And here is how that associative array may have been declared:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 我们仍然使用方括号表示法，但不是使用我们的索引，而是使用我们的文本键。以下是关联数组可能声明的示例：
- en: '[PRE11]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: As with a standard array, the items are separated by commas inside the `array`
    function. In this case, however, `key => value` pairs are used to declare how
    each item in the array will be accessed.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 与标准数组一样，项目在`array`函数内部通过逗号分隔。然而，在这种情况下，使用`key => value`对来声明如何访问数组中的每个项目。
- en: In the next section, I'll show how you could loop through array values.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我将展示如何遍历数组值。
- en: Feelin' Loopy
  id: totrans-98
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 感觉到循环了
- en: If you want to do the same thing many times, you can achieve this by using a
    loop structure. This section will include the `for` and `foreach` loops in PHP.
    We'll visit each value in an array and output its contents.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想多次执行相同的事情，你可以通过使用循环结构来实现。本节将包括PHP中的`for`和`foreach`循环。我们将遍历数组中的每个值并输出其内容。
- en: 'Consider this simple array:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑这个简单的数组：
- en: '[PRE12]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Now let''s loop through it and print out each name:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们遍历它并打印出每个名称：
- en: '[PRE13]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'When you run this code, it will print out the name of the band:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 当你运行此代码时，它将打印出乐队的名称：
- en: '[PRE14]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: We do this by creating an index variable, starting at zero. The program goes
    through the loop until that index variable is no longer less than the total number
    of items in the array ❶. The increment operator `++` is used to increase the index
    by one each time ❷.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通过创建一个索引变量，从零开始，来完成这个操作。程序会遍历循环，直到那个索引变量不再小于数组中的项目总数 ❶。递增运算符`++`用于每次将索引增加1
    ❷。
- en: To print the name simply means accessing the current index in the array variable
    ❸. Then, it also prints some text between the names, but only when the index is
    less than the total number minus one ❹. Because the total number is two, this
    will only happen during the first time through the loop, when zero is less than
    one.
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 打印名称仅意味着访问数组变量中的当前索引 ❸。然后，它还打印一些文本在名称之间，但只有当索引小于总数减一 ❹时。因为总数是2，这只会发生在第一次遍历循环时，当零小于一。
- en: If you add your last name as a third item in the `$bandmates` variable and run
    the code again, you'll see another `and` thrown in (and you'll have put yourself
    in the band).
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你将你的姓氏作为`$bandmates`变量的第三个项目并再次运行代码，你会看到另一个`and`被加入（并且你将自己在乐队中）。
- en: 'Let''s use another loop to go through an associative array. We''ll stick with
    the same band, but focus our attention on their hair instead. Is it straight or
    curly? Consider this associative array:'
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们使用另一个循环来遍历一个关联数组。我们将保持相同的乐队，但将注意力集中在他们的头发上。它是直的还是卷的？考虑这个关联数组：
- en: '[PRE15]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Now let''s loop through this array to share what we know about their hair:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们遍历这个数组，分享我们关于他们头发的知识：
- en: '[PRE16]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'Finally, here''s the output:'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，这是输出：
- en: '[PRE17]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: In this case, we're accessing both the key and the value in each element of
    the associative array. Then, at each step, we're printing them both out.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，我们正在访问关联数组中每个元素的键和值。然后，在每一步，我们都会打印出它们。
- en: Get Functional
  id: totrans-116
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 获得功能
- en: Creating your own functions in PHP can save you time typing. You'll also find
    it's good practice. The way you create PHP functions is quite similar to JavaScript,
    so you may be closer than you realize to being able to use your own functions.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 在PHP中创建自己的函数可以节省你输入的时间。你还会发现这是一种良好的实践。创建PHP函数的方式与JavaScript非常相似，所以你可能比你想象的更接近能够使用自己的函数。
- en: For this example, we'll create a function that takes a number as input and returns
    that same number quadrupled. This function may not be especially useful, but it
    is just simple enough to teach how functions work in PHP.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这个例子，我们将创建一个函数，它接受一个数字作为输入，并返回该数字的四倍。这个函数可能不是特别有用，但它足够简单，可以用来教授如何在PHP中工作函数。
- en: 'Within your PHP brackets, `<?php` and `?>`, include this code:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 在你的PHP括号`<?php`和`?>`中，包含以下代码：
- en: '[PRE18]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Like I said, a simple function: It contains a name and is passed a single variable
    ❶. This variable is local to just this function, meaning it doesn''t have to exist
    elsewhere. You can name the variable whatever you want.'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 就像我说的，一个简单的函数：它包含一个名称，并且传递一个单一变量 ❶。这个变量仅限于这个函数内部，意味着它不必在其他地方存在。你可以给变量取任何你想要的名称。
- en: Then I created another variable ❷ to hold the quadrupled value. This variable
    is also local, so we're just using it inside the function. Note that the multiplication
    operator is an asterisk. Armed with our new value, we need to pass it back out
    ❸ to whichever line of code called our new `quadruple` function.
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我创建了另一个变量 ❷ 来保存四倍后的值。这个变量也是局部的，所以我们只是在函数内部使用它。请注意，乘法运算符是星号。有了我们新的值，我们需要将其传递回
    ❸ 调用我们新`quadruple`函数的任何代码行。
- en: 'Now let''s call our function. And to show how useful this function is, we''ll
    call it on several numbers in a row using an array and a loop. Create a new PHP
    file with this code:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们调用我们的函数。为了展示这个函数有多有用，我们将使用数组和循环在连续的几个数字上调用它。创建一个新的PHP文件，并包含以下代码：
- en: '[PRE19]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: Here I've used a `foreach` loop on a regular, nonassociative array. To do this,
    I simply use one value ❶ instead of a key-value pair. Then, for every item in
    the array, I use the new function to quadruple the number ❷.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我使用了一个`foreach`循环在一个常规的非关联数组上。为了做到这一点，我简单地使用一个值 ❶ 而不是键值对。然后，对于数组中的每个项目，我使用新函数将数字乘以四
    ❷。
- en: 'When all is said and done, here is the output:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 一切结束后，这里是输出：
- en: '[PRE20]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'And with that, you know the basics of PHP. You''ve interspersed it with HTML.
    You learned several types of variables: numbers, text, arrays, and associative
    arrays. You can help your code think with conditionals, and you can use loops
    and functions to keep your code small and reusable.'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 有了这些，你就知道了PHP的基础知识。你已经将它与HTML结合使用。你学习了多种类型的变量：数字、文本、数组和关联数组。你可以使用条件语句让你的代码思考，并且可以使用循环和函数来保持你的代码小且可重用。
- en: 'To learn how to grab web pages or connect PHP to a web service, continue to
    the next section. And to connect PHP to a database, you''ll want [#65: Use MySQL
    from PHP](ch09s07.html "#65: Use MySQL from PHP") in [#65: Use MySQL from PHP](ch09s07.html
    "#65: Use MySQL from PHP").'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解如何抓取网页或将PHP连接到Web服务，请继续下一节。若要将PHP连接到数据库，你将需要查看 [#65：从PHP中使用MySQL](ch09s07.html
    "#65：从PHP中使用MySQL")。
- en: '#61: Retrieve a Web Page'
  id: totrans-130
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '#61：检索网页'
- en: One of the most common reasons to use a server-side language like PHP is to
    be able to make calls to web services. Some services provide a result that can
    be read directly into the browser with JavaScript. Taking these calls server-side
    gives you more freedom to use or store the results, however.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 使用像PHP这样的服务器端语言的最常见原因之一是能够调用Web服务。一些服务提供的结果可以直接用JavaScript读取到浏览器中。然而，将这些调用放在服务器端给你更多的自由来使用或存储结果。
- en: Calling a web service is exactly like loading a web page. You pass a URL to
    a server, and it responds with code (HTML for a web page, usually XML for a web
    service). In PHP, the code is put into a string variable, which holds a bunch
    of text. From there, you can do whatever you want with the web page—print it out,
    cut it apart, parse it into data, store it away. But first, let's just work on
    *getting* the web page.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 调用一个网络服务就像加载一个网页一样。你向服务器传递一个 URL，然后它以代码的形式响应（网页通常是 HTML，网络服务通常是 XML）。在 PHP 中，代码被放入一个字符串变量中，它包含一大堆文本。从那里，你可以对网页做任何你想做的事情——打印出来，分割它，解析成数据，存储起来。但首先，让我们先专注于*获取*网页。
- en: PHP 5 comes with a standard library called *cUrl*. The library is all about
    making network connections. In earlier versions of PHP, you might have used the
    `file` function to do this, which was kind of duct-taped on. Switch to cUrl—it's
    made for doing URL grabbing.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: PHP 5 附带一个名为 *cUrl* 的标准库。这个库全部关于建立网络连接。在 PHP 的早期版本中，你可能使用 `file` 函数来做这件事，它有点像用胶带粘上去的。切换到
    cUrl——它是为抓取 URL 而设计的。
- en: Of course, the `file` function is so easy. Just one line and you had the content
    from a web page. As you'll see, cUrl is a little bit more involved. Let's make
    our own function, however, so we can reuse it in many places (as I have done several
    times in this book). Then we'll have all the convenience of `file` with the power
    of cUrl.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，`file` 函数非常简单。只需一行代码，你就有网页的内容了。正如你将看到的，cUrl 稍微复杂一些。然而，让我们创建自己的函数，这样我们就可以在许多地方重用它（正如我在这本书中多次做的那样）。然后我们将拥有
    `file` 的便利性和 cUrl 的强大功能。
- en: 'In an empty PHP file, add the following code:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个空的 PHP 文件中，添加以下代码：
- en: '[PRE21]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: Our function, which I've named `get_url`, has one parameter, the URL ❶. This
    input is what it needs to do its job, which is to fetch a web page. Once inside
    the function, we need to initialize a cUrl object ❷, so we can begin using it.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 我命名的 `get_url` 函数有一个参数，即 URL ❶。这个输入是它完成工作所需的内容，即抓取一个网页。一旦进入函数内部，我们需要初始化一个 cUrl
    对象 ❷，这样我们就可以开始使用它了。
- en: Now let's tell cUrl what we need by setting options. First, we tell it the URL
    we want to fetch ❸. Then we explain that we want to get back the content the URL
    will send ❹. Some people use cUrl to send information only, in which case they
    don't care about the reply. We do.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们通过设置选项来告诉 cUrl 我们需要什么。首先，我们告诉它我们想要获取的 URL ❸。然后我们解释我们想要获取 URL 发送的内容 ❹。有些人使用
    cUrl 仅发送信息，在这种情况下，他们不关心回复。我们则不同。
- en: Notice that each time we set options, we passed the `$c` variable that we created
    when we initialized cUrl. That variable is important because it keeps track of
    the options we set and the status of our cUrl session.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，每次我们设置选项时，我们都传递了当初始化 cUrl 时创建的 `$c` 变量。这个变量很重要，因为它跟踪我们设置的选项和 cUrl 会话的状态。
- en: With the options set, we make the call to the URL ❺ with the content stored
    in a normal variable. First, we run it through the `trim` function to remove any
    spaces or carriage returns from the beginning and end of the file. Otherwise,
    we get the exact data that a web browser would get.
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 设置好选项后，我们通过一个普通变量存储的内容调用 URL ❺。首先，我们运行它通过 `trim` 函数，以移除文件开头和结尾的任何空格或换行符。否则，我们会得到与网络浏览器得到的确切数据相同的数据。
- en: 'Now we''ll clean up our mess, so we tell cUrl that we''re done ❻. Then the
    most important part: We return the content ❼ from this function. This is how we
    get the results of the web page out of the function and into whatever variable
    we declare.'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们将清理我们的混乱，所以告诉 cUrl 我们已经完成 ❻。然后最重要的部分：我们从这个函数返回内容 ❼。这就是我们如何将网页的结果从函数中提取出来，并放入我们声明的任何变量中。
- en: 'Let''s test our new function. Below the `Additional code may go here` line,
    let''s add this line, which will grab the home page of the book''s website:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们来测试我们的新功能。在“`Additional code may go here`”行下面，让我们添加这一行，它将抓取书籍网站的首页：
- en: '[PRE22]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: If you load your PHP file into a browser, you should get a web page. The web
    page is coming from your new function! Open [http://mapscripting.com/](http://mapscripting.com/)
    in another browser window, and you'll see almost the same thing, though styles
    and images might be missing from your copy—that's because you're only loading
    the HTML.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你将 PHP 文件加载到浏览器中，你应该会看到一个网页。这个网页来自你的新函数！在另一个浏览器窗口中打开 [http://mapscripting.com/](http://mapscripting.com/)，你会看到几乎相同的内容，尽管你的副本中可能缺少样式和图像——这是因为你只加载了
    HTML。
- en: 'What''s the big deal with using PHP to show the stripped-down version of this
    book''s website? It isn''t a big deal; this is just a proof of concept. The really
    great stuff comes when you download XML from a web service. I show more of how
    that works in [#52: Use XML](ch08.html#number_symble_52_colon_use_xml "#52: Use
    XML") in [#52: Use XML](ch08.html#number_symble_52_colon_use_xml "#52: Use XML").'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: '使用PHP显示本书网站简化版的大惊小怪吗？这并不是什么大惊小怪的事情；这只是一个概念验证。真正精彩的部分出现在您从网络服务下载XML时。我在[#52:
    使用XML](ch08.html#number_symble_52_colon_use_xml "#52: 使用XML")中展示了更多关于它是如何工作的。'
- en: Include Your Function in Other Scripts
  id: totrans-146
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在其他脚本中包含您的函数
- en: One way to make your `get_url` function accessible in other PHP scripts you
    write is to copy and paste it in every time. Of course, cutting and pasting each
    time is the hard way and difficult to keep up-to-date if you change the function;
    you would have to change it everywhere that you pasted it.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 使您的`get_url`函数在其他您编写的PHP脚本中可访问的一种方法是在每次需要时复制并粘贴它。当然，每次都剪切和粘贴是件麻烦事，如果您更改了函数，还很难保持更新；您必须更改您粘贴它的所有地方。
- en: Instead, create an include file that you can call from other scripts. Take the
    previous code, not including the two lines we used to test the function, and put
    them in a new file. I named the file *net_func.inc.php*, thinking I might add
    more network-related functions down the road. I gave a non-*.php* extension to
    the file because I didn't want it to be mistaken for something that can be shown
    directly to a web browser.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 相反，创建一个可以从其他脚本中调用的包含文件。将之前的代码（不包括我们用来测试函数的两行）放入一个新文件中。我将其命名为*net_func.inc.php*，因为我可能将来会添加更多与网络相关的函数。我给文件添加了非*.php*扩展名，因为我不想让它被误认为是可以直接显示给Web浏览器的文件。
- en: 'Now start a new PHP file, so you can test including your new function file:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 现在开始创建一个新的PHP文件，这样您就可以测试包含您的新函数文件：
- en: '[PRE23]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: The results from this test should be the same as the previous test. Only now
    the code for the `get_url` function is separate from the code that calls it, which
    will allow us to use it easily in many places.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 这个测试的结果应该与之前的测试相同。但现在`get_url`函数的代码与调用它的代码是分开的，这将使我们能够轻松地在许多地方使用它。
- en: '#62: Install MySQL'
  id: totrans-152
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '#62: 安装MySQL'
- en: MySQL is a popular database platform that is available across most operating
    systems. You can install it on your own computer, and you can also run it on a
    web server, which means using it as a data source for applications is easy.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL是一个流行的数据库平台，可在大多数操作系统上使用。您可以在自己的计算机上安装它，也可以在Web服务器上运行它，这意味着将其用作应用程序的数据源很容易。
- en: For the uninitiated, a *database* contains one or more tables that are used
    to store data. At a very crude level, you can think of a database as a spreadsheet,
    like a Microsoft Excel file, that can be accessed in part or whole and filtered
    for only the stuff you care about. Instead of worksheets, you have tables. Every
    row of a worksheet is a new *database record*. The columns across the top of most
    worksheets are the *database fields*—they describe the data that goes in that
    column. In fact, when people talk about databases, they often speak about rows
    and columns.
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 对于初学者来说，一个*数据库*包含一个或多个用于存储数据的表。在非常粗略的层面上，您可以将数据库想象成一个电子表格，就像Microsoft Excel文件一样，可以部分或全部访问，并过滤出您关心的内容。您没有工作表，而是有表格。工作表中的每一行都是一个新的*数据库记录*。大多数工作表顶部的列是*数据库字段*——它们描述了放入该列的数据。实际上，当人们谈论数据库时，他们经常谈论行和列。
- en: The SQL part of MySQL stands for *structured query language*, the syntax to
    communicate with a database server. MySQL and many other database servers use
    a standard set of statements (called SQL-92), though each also has its own dialect.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL中的SQL部分代表*结构化查询语言*，是与数据库服务器通信的语法。MySQL和许多其他数据库服务器使用一组标准的语句（称为SQL-92），尽管每个都有其自己的方言。
- en: You will find MySQL most useful when combined with some other technologies.
    The examples in this chapter use PHP for a programming language and Apache for
    a web server. Read on, however, to get the details about using MySQL by itself.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 当MySQL与其他技术结合使用时，你会发现它非常有用。本章中的示例使用PHP作为编程语言，Apache作为Web服务器。然而，继续阅读以获取关于单独使用MySQL的详细信息。
- en: Check Your Web Host for MySQL
  id: totrans-157
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 检查您的Web主机是否支持MySQL
- en: 'If you have web hosting, you may have MySQL installed already. You''ll want
    to look in your control panel or double-check with your administrator that MySQL
    is available and set up for your account. Ask about one or both of these two common
    methods for using MySQL:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您有网络托管服务，您可能已经安装了 MySQL。您需要检查您的控制面板或与您的管理员确认 MySQL 是否可用以及是否已为您设置好账户。询问以下两种常见的使用
    MySQL 的方法之一：
- en: '| **phpMyAdmin** A web dashboard for accessing MySQL. As the name implies,
    PHP must also be installed. By using this method, you can create database tables
    and look at data in a visual, point-and-click manner that beginners often prefer.
    |'
  id: totrans-159
  prefs: []
  type: TYPE_TB
  zh: '| **phpMyAdmin** 一个用于访问 MySQL 的网页仪表板。正如其名所示，PHP 也必须安装。使用此方法，您可以通过视觉的点击方式创建数据库表并查看数据，这是初学者通常更喜欢的。'
- en: '| **Command Interpreter** A command-line utility that lets you access MySQL
    from a text interface. Creating database tables and all other operations occur
    via typed commands. |'
  id: totrans-160
  prefs: []
  type: TYPE_TB
  zh: '| **命令解释器** 一个命令行实用程序，允许您从文本界面访问 MySQL。创建数据库表和其他所有操作都通过键入命令完成。'
- en: All examples in this chapter will be shown using both methods. In some cases,
    the differences are minimal because you will need to type commands into phpMyAdmin
    as well.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 本章中的所有示例都将使用这两种方法展示。在某些情况下，差异很小，因为您还需要在 phpMyAdmin 中输入命令。
- en: 'If MySQL is installed, you''re ready to move on to [#63: Store Locations to
    a Database](ch09s05.html "#63: Store Locations to a Database") in [Install MySQL
    Yourself](ch09s04.html#install_mysql_yourself "Install MySQL Yourself").'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: '如果 MySQL 已安装，您就可以继续到 [#63: 将位置存储到数据库中](ch09s05.html "#63: 将位置存储到数据库中")，在 [自行安装
    MySQL](ch09s04.html#install_mysql_yourself "自行安装 MySQL") 中。'
- en: Use a Packaged Installation of MySQL
  id: totrans-163
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 MySQL 的软件包安装
- en: To install MySQL on your own computer, the easiest method is to download a package
    for your operating system that is ready to go. When you follow this route, you'll
    also get PHP and Apache at the same time, which is useful.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 要在您的计算机上安装 MySQL，最简单的方法是下载适用于您操作系统的现成软件包。如果您选择此路径，您还将同时获得 PHP 和 Apache，这对您来说很有用。
- en: 'The names of the packages are patterned after the popular server architecture,
    LAMP, which stands for L*inux*, A*pache*, M*ySQL*, and P*HP*:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 软件包的名称是根据流行的服务器架构 LAMP 命名的，它代表 L*inux*、A*pache*、M*ySQL* 和 P*HP*：
- en: 'Windows (WAMP): [http://www.wampserver.com/](http://www.wampserver.com/)'
  id: totrans-166
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Windows (WAMP): [http://www.wampserver.com/](http://www.wampserver.com/)'
- en: 'Macintosh (MAMP): [http://www.mamp.info/](http://www.mamp.info/)'
  id: totrans-167
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'Macintosh (MAMP): [http://www.mamp.info/](http://www.mamp.info/)'
- en: Either of these packages should install on your computer without much information
    from you (though you may have to enter an administrator password).
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 这两种软件包都应该可以在您的计算机上安装，而无需您提供太多信息（尽管您可能需要输入管理员密码）。
- en: Open WAMP/MAMP once the install process has completed. The program should create
    a new web browser window pointed at *localhost*, the name of the server on your
    own computer. By default, a welcome screen will appear, as shown in [Figure 9-4](ch09s04.html#the_mamp_welcome_screen
    "Figure 9-4. The MAMP welcome screen").
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 安装过程完成后，请打开 WAMP/MAMP。程序应创建一个新的指向 *localhost* 的网页浏览器窗口，这是您计算机上服务器的名称。默认情况下，会出现一个欢迎屏幕，如图
    [图 9-4](ch09s04.html#the_mamp_welcome_screen "图 9-4. MAMP 欢迎屏幕") 所示。
- en: '![The MAMP welcome screen](httpatomoreillycomsourcenostarchimages672093.png.jpg)'
  id: totrans-170
  prefs: []
  type: TYPE_IMG
  zh: '![MAMP 欢迎屏幕](httpatomoreillycomsourcenostarchimages672093.png.jpg)'
- en: Figure 9-4. The MAMP welcome screen
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9-4. MAMP 欢迎屏幕
- en: To administer your MySQL installation, click the **phpMyAdmin** link. Now you're
    ready for the next project.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 要管理您的 MySQL 安装，请点击 **phpMyAdmin** 链接。现在您已准备好进行下一个项目。
- en: Install MySQL Yourself
  id: totrans-173
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 自行安装 MySQL
- en: If you're using an operating system that does not have a package available,
    you will need to install MySQL yourself. Too many variations exist to describe
    in this chapter, but many tutorials are available on the Internet to help you
    out.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您使用的操作系统没有可用的软件包，您将需要自行安装 MySQL。由于存在太多变体，本章无法一一描述，但互联网上有许多教程可以帮助您。
- en: 'The MySQL website is the first place to start: [http://mysql.org/](http://mysql.org/).'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: MySQL 网站是您开始的地方：[http://mysql.org/](http://mysql.org/)。
- en: When you are up and running, keep on reading for geographic-specific instructions.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 当您开始运行时，继续阅读地理特定的说明。
- en: '#63: Store Locations to a Database'
  id: totrans-177
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '#63: 将位置存储到数据库中'
- en: To build extremely powerful mapping applications, you'll want to use a database.
    By maintaining your own data, your site will be quicker and you can do more interesting
    things. First, however, you'll need to create the database and add some locations
    to it. This section will describe how to get started with a MySQL location database.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: 为了构建极其强大的映射应用程序，您将想要使用数据库。通过维护自己的数据，您的网站将更快，您可以做更多有趣的事情。首先，您需要创建数据库并向其中添加一些位置。本节将描述如何开始使用MySQL位置数据库。
- en: At this point, we need to get our jargon straight. That data, which lives in
    a database, actually resides in a database *table*. Before you can create a table,
    you need to have a database. MySQL is a database management system that can contain
    many individual databases, which themselves have many tables.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，我们需要明确我们的术语。实际上，存在于数据库中的数据实际上位于数据库的*表*中。在您创建表之前，您需要有一个数据库。MySQL是一个数据库管理系统，它可以包含许多单独的数据库，而这些数据库本身又包含许多表。
- en: Create a New Database
  id: totrans-180
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建新数据库
- en: If you're using MySQL through a hosting provider, you likely already have a
    database assigned to you. Even your database contains other tables already (say,
    for blogging software), you can still use it for this project. We will simply
    be creating an additional database table.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您通过托管提供商使用MySQL，您可能已经有一个数据库分配给您。即使您的数据库中已经包含其他表（例如，用于博客软件），您仍然可以使用它来完成这个项目。我们只是会创建一个额外的数据库表。
- en: If you don't have a database, creating one is easy in phpMyAdmin. From the main
    screen, simply type the name of your database into the form (I chose *mapscripting*)
    and click the **Create** button (see [Figure 9-5](ch09s05.html#create_a_new_database-id1
    "Figure 9-5. Create a new database.")). Or, using the MySQL Command Interpreter,
    type **`create database("mapscripting");`**.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您没有数据库，在phpMyAdmin中创建一个很简单。从主屏幕上，只需在表单中输入您数据库的名称（我选择了*mapscripting*）并点击**创建**按钮（见[图9-5](ch09s05.html#create_a_new_database-id1
    "图9-5。创建新的数据库")）。或者，使用MySQL命令解释器，输入**`create database("mapscripting");`**。
- en: '![Create a new database.](httpatomoreillycomsourcenostarchimages672095.png.jpg)'
  id: totrans-183
  prefs: []
  type: TYPE_IMG
  zh: '![创建新的数据库。](httpatomoreillycomsourcenostarchimages672095.png.jpg)'
- en: Figure 9-5. Create a new database.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 图9-5。创建新的数据库。
- en: Once completed, you need to select the database name, by clicking it or typing
    **`\u mapscripting`** in the interpreter. Now you're ready to create the database
    table.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦完成，您需要选择数据库名称，通过点击它或在解释器中输入**`\u mapscripting`**来选择。现在您已经准备好创建数据库表了。
- en: Create a Database Table
  id: totrans-186
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建数据库表
- en: Now that you have a database, you can begin adding tables. I'm keeping this
    example simple, so we're only going to have one table.
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经有了数据库，您可以开始添加表了。为了简化示例，我们只会添加一个表。
- en: To create a new table in phpMyAdmin, you fill out the form on the database's
    main page. You need to give the table a name and choose a number of fields. I'm
    calling my table *places*, and it will have four fields, which are types of values
    that every place will contain. Click the **Go** button to further define the table.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 要在phpMyAdmin中创建新表，您需要在数据库主页面上的表单中填写信息。您需要为表指定一个名称并选择字段数量。我称我的表为*places*，它将包含四个字段，这些字段是每个地点都将包含的值类型。点击**Go**按钮以进一步定义表。
- en: As you can see in [Figure 9-6](ch09s05.html#create_a_table_with_four_fields
    "Figure 9-6. Create a table with four fields."), we need to name each field and
    give it a type. The four fields I'm adding to our basic place table are *id* (unique
    identifier), *label* (a name for the place), *latitude*, and *longitude*.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 正如您在[图9-6](ch09s05.html#create_a_table_with_four_fields "图9-6。创建具有四个字段的表")中看到的，我们需要为每个字段命名并指定其类型。我要添加到我们基本地点表中的四个字段是
    *id*（唯一标识符）、*label*（地点的名称）、*latitude*和*longitude*。
- en: '![Create a table with four fields.](httpatomoreillycomsourcenostarchimages672097.png.jpg)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![创建具有四个字段的表。](httpatomoreillycomsourcenostarchimages672097.png.jpg)'
- en: Figure 9-6. Create a table with four fields.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 图9-6。创建具有四个字段的表。
- en: The identifier is a good idea for any database table because it makes distinguishing
    one piece of data from another easy. I've made the identifier a *bigint*, meaning
    it is an integer that can get very large (up to 9 quintillion—that's 18 zeros).
    We don't want to worry about counting the number ourselves, however, so we need
    to make sure MySQL does it for us.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 对于任何数据库表来说，标识符都是一个好主意，因为它使得区分一块数据与另一块数据变得容易。我已经将标识符设置为*bigint*，这意味着它是一个可以变得非常大的整数（高达9千万亿——即18个零）。然而，我们不想自己计数，因此我们需要确保MySQL为我们完成这项工作。
- en: Look on the far right in phpMyAdmin (you may need to scroll horizontally), and
    you'll find the Extra column. Select the drop-down for the `id` row and choose
    **auto_increment**. Then, also click the option directly to the right, the one
    with the icon that looks like a key. See [Figure 9-7](ch09s05.html#make_the_identifier_field_auto-increment
    "Figure 9-7. Make the identifier field auto-increment.") for an example. Selecting
    this will make the identifier the primary key. Both of these steps are necessary
    for MySQL to do the counting for you.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 在phpMyAdmin的右侧查看（可能需要水平滚动），你会找到“额外”列。选择“id”行的下拉菜单并选择**auto_increment**。然后，也点击直接位于其右侧的选项，图标看起来像一把钥匙。参见[图9-7](ch09s05.html#make_the_identifier_field_auto-increment
    "图9-7. 使标识字段自动递增。")的示例。选择此选项将使标识成为主键。这两个步骤对于MySQL为您进行计数是必要的。
- en: 'The remaining fields are fairly simple. The label is a short (100 character)
    description of the place and then the location is stored as two floating point
    (decimal) numbers: latitude and longitude, no doubt quite familiar to you by now.'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 剩余的字段相当简单。标签是对地点的简短（100个字符）描述，然后位置以两个浮点数（小数）形式存储：纬度和经度，现在无疑对你来说已经很熟悉了。
- en: 'Click the **Save** button and you''ve created a table. To do the same in the
    Command Interpreter (or using phpMyAdmin''s SQL window), type the following:'
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**保存**按钮，你就创建了一个表。要在命令解释器（或使用phpMyAdmin的SQL窗口）中做同样的事情，请输入以下内容：
- en: '[PRE24]'
  id: totrans-196
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: Now that you have a table, let's start adding data to it.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你已经有一个表了，让我们开始向其中添加数据。
- en: '![Make the identifier field auto-increment.](httpatomoreillycomsourcenostarchimages672099.png.jpg)'
  id: totrans-198
  prefs: []
  type: TYPE_IMG
  zh: '![使标识字段自动递增。](httpatomoreillycomsourcenostarchimages672099.png.jpg)'
- en: Figure 9-7. Make the identifier field auto-increment.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 图9-7. 使标识字段自动递增。
- en: Add Data to Your Places Table
  id: totrans-200
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 向你的地点表添加数据
- en: Your places table, with its four fields, is sitting happily inside your database,
    but you have a problem. The table is empty. It doesn't have any data. Let's add
    some.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 你的地点表，包含其四个字段，现在快乐地坐在你的数据库中，但你有一个问题。表是空的。它没有任何数据。让我们添加一些。
- en: Within phpMyAdmin, click the table name and then the Insert tab. You should
    see another form (as shown in [Figure 9-8](ch09s05.html#enter_values_in_your_places_table
    "Figure 9-8. Enter values in your places table.")) with four fields. This time,
    instead of names, which are already listed, you'll enter values.
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 在phpMyAdmin中，点击表名然后点击“插入”标签。你应该会看到另一个表单（如图[图9-8](ch09s05.html#enter_values_in_your_places_table
    "图9-8. 在你的地点表中输入值。")所示），包含四个字段。这次，你将输入值而不是名称，因为名称已经列出。
- en: Leaving the `id` value empty is important. MySQL will create that value because
    it's counting (auto-incrementing) for us. In the other boxes, type a descriptive
    name, followed by latitude and longitude. Then click **Go**.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 留空`id`值很重要。MySQL将创建该值，因为它在为我们计数（自动递增）。在其他框中，输入一个描述性名称，然后是纬度和经度。然后点击**Go**。
- en: 'You don''t have to add data via phpMyAdmin. You can also use plain SQL (such
    as in the Command Interpreter). To add Old Faithful to the `places` table, type
    the following:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 你不必通过phpMyAdmin添加数据。你也可以使用纯SQL（例如在命令解释器中）。要将老忠实泉添加到`places`表，请输入以下内容：
- en: '[PRE25]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Notice that I don't include the `id` here at all. I want MySQL to deal with
    it. The other three fields are first listed by name and then by the values I want
    to add to them.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，我没有在这里包含`id`。我想让MySQL处理它。其他三个字段首先按名称列出，然后按我想要添加到它们的值列出。
- en: 'After performing these tasks, you''ve added a single place to your places database
    table. Add a few more, varying the labels, latitude, and longitude. You have yourself
    an up-and-coming location database now. Within phpMyAdmin, click the Browse tab
    to see your places, or type this SQL in the Command Interpreter: **`select * from
    places;`**.'
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 执行这些任务后，你已向你的地点数据库表添加了一个位置。添加几个更多，改变标签、纬度和经度。现在你有一个正在兴起的位置数据库了。在phpMyAdmin中点击“浏览”标签查看你的地点，或者在命令解释器中输入以下SQL：**`select
    * from places;`**。
- en: '![Enter values in your places table.](httpatomoreillycomsourcenostarchimages672101.png.jpg)'
  id: totrans-208
  prefs: []
  type: TYPE_IMG
  zh: '![在你的地点表中输入值。](httpatomoreillycomsourcenostarchimages672101.png.jpg)'
- en: Figure 9-8. Enter values in your places table.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 图9-8. 在你的地点表中输入值。
- en: Now you can do something interesting with the location database, such as plot
    locations from a database or get the nearest locations from a database.
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 现在你可以对位置数据库做一些有趣的事情，比如从数据库中绘制位置或获取数据库中的最近位置。
- en: '#64: Import Data from a Spreadsheet'
  id: totrans-211
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '#64: 从电子表格导入数据'
- en: If you're sold on getting your location data into a database (and I hope you
    are), you'll want a way to make it easy. Filling out form after form or writing
    out SQL inserts by hand is tedious. In this section, I'll show how to use a spreadsheet,
    convert it to CSV, and then import it directly into MySQL.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你决定将你的位置数据导入数据库（我希望你是），你将想要一种使其变得简单的方法。填写表格或手动编写SQL插入语句是乏味的。在本节中，我将展示如何使用电子表格，将其转换为CSV格式，然后直接导入MySQL。
- en: Earlier I compared a database table to a spreadsheet. Both have columns, which
    in a database are also referred to as field names. Both have rows, which we call
    database records. The easiest way to prepare a lot of data for a database is to
    use a spreadsheet, such as Excel or OpenOffice Calc. Work on your spreadsheet
    as you normally would. [Figure 9-9](ch09s06.html#a_database_table_is_similar_to_a_spreads
    "Figure 9-9. A database table is similar to a spreadsheet.") shows an example
    of how the places database I created in the previous project might look as a spreadsheet.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 之前我把数据库表比作电子表格。两者都有列，在数据库中这些列也被称为字段名。两者都有行，我们称之为数据库记录。为数据库准备大量数据的最简单方法是使用电子表格，例如Excel或OpenOffice
    Calc。像平常一样在你的电子表格上工作。[图9-9](ch09s06.html#a_database_table_is_similar_to_a_spreads
    "图9-9. 数据库表类似于电子表格。")展示了我在上一个项目中创建的位置数据库作为电子表格可能的样子。
- en: Make sure you have a few rows filled out, and then save a copy of your spreadsheet.
    Instead of saving as the normal spreadsheet format, scroll through your list of
    file types, and choose **Comma-Separated, .csv**. This format is a simple, universal
    one for storing data.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: 确保你有几行填写完毕，然后保存电子表格的副本。不要保存为常规的电子表格格式，而是滚动到你的文件类型列表，并选择**逗号分隔的，.csv**。这种格式是存储数据的一个简单、通用的格式。
- en: 'I chose the name *places.csv* for my file, which looks like this when I open
    it in a plain-text editor:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 我给我的文件命名为*places.csv*，当我在纯文本编辑器中打开它时，它看起来是这样的：
- en: '[PRE26]'
  id: totrans-216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '![A database table is similar to a spreadsheet.](httpatomoreillycomsourcenostarchimages672103.png.jpg)'
  id: totrans-217
  prefs: []
  type: TYPE_IMG
  zh: '![数据库表类似于电子表格。](httpatomoreillycomsourcenostarchimages672103.png.jpg)'
- en: Figure 9-9. A database table is similar to a spreadsheet.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 图9-9. 数据库表类似于电子表格。
- en: Now you're ready to import this comma-separated values (CSV) version of the
    database table. Within phpMyAdmin, navigate to the places table and click the
    Import tab. First, you'll select the file to import, so click the **Browse** button
    and choose your CSV file. If your file has a header row, as mine does, be sure
    to fill out the form to skip one record because you don't want to import the field
    names as values.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，你已经准备好导入数据库表的这种逗号分隔值（CSV）版本了。在phpMyAdmin中，导航到位置表并点击导入标签。首先，你需要选择要导入的文件，所以点击**浏览**按钮并选择你的CSV文件。如果你的文件有一个标题行，就像我的那样，确保填写表格以跳过一条记录，因为你不想将字段名作为值导入。
- en: Scroll down to the File Import section. It is probably set to SQL because that's
    the main way MySQL expects to read in files. Choose **CSV** instead. Then fill
    out the options as shown in [Figure 9-10](ch09s06.html#import_a_comma-separated_file_into_mysql
    "Figure 9-10. Import a comma-separated file into MySQL."). Fields are terminated
    by a comma; fields are enclosed by a double quote character; and fields are escaped
    by backslash. You can let line terminators be determined automatically.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 滚动到文件导入部分。它可能设置为SQL，因为MySQL主要期望通过这种方式读取文件。选择**CSV**，然后填写如图[图9-10](ch09s06.html#import_a_comma-separated_file_into_mysql
    "图9-10. 将逗号分隔的文件导入MySQL.")所示选项。字段由逗号分隔；字段由双引号字符包围；字段由反斜杠转义。你可以让行终止符自动确定。
- en: '![Import a comma-separated file into MySQL.](httpatomoreillycomsourcenostarchimages672105.png.jpg)'
  id: totrans-221
  prefs: []
  type: TYPE_IMG
  zh: '![将逗号分隔的文件导入MySQL](httpatomoreillycomsourcenostarchimages672105.png.jpg)'
- en: Figure 9-10. Import a comma-separated file into MySQL.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 图9-10. 将逗号分隔的文件导入MySQL。
- en: The final option is a list of fields to import. If you are importing every field
    in the table, you may not need to enter these. We have an automatically generated
    identifier, however, so we need to specify the columns we are importing, which
    is everything except the `id` column.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 最后一个选项是导入的字段列表。如果你正在导入表中的所有字段，你可能不需要输入这些。然而，我们有一个自动生成的标识符，因此我们需要指定我们正在导入的列，除了`id`列之外的所有列。
- en: Click the **Go** button and your data should be imported. To check, click the
    Browse tab, which will show you the current contents of the places table.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 点击**Go**按钮，你的数据应该会被导入。为了检查，点击浏览标签，它将显示位置表当前的内容。
- en: 'You can also import using the Command Interpreter:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以使用命令解释器导入：
- en: '[PRE27]'
  id: totrans-226
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: The CSV file will need to be accessible to the machine running MySQL. If you're
    using the interpreter on a server, you'll need to upload the file to the server.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: CSV 文件需要可供运行 MySQL 的机器访问。如果您在服务器上使用解释器，您需要将文件上传到服务器。
- en: Using a spreadsheet to create your data is the easiest method when you have
    more than just a few records. Also, you may find plenty of other data available
    in this format, so knowing how to import from CSV can help you use other people's
    data, as well.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 当您有不止几个记录时，使用电子表格来创建数据是最简单的方法。此外，您可能会发现许多其他数据也以这种格式提供，因此了解如何从 CSV 导入可以帮助您使用他人的数据。
- en: '#65: Use MySQL from PHP'
  id: totrans-229
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '#65：从 PHP 使用 MySQL'
- en: Many programming languages have ways to connect to MySQL. PHP includes many
    functions in its default installation, making PHP and MySQL a popular pair. In
    this section, I'll introduce you to the most common functions for accessing your
    MySQL database from PHP.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 许多编程语言都有连接到 MySQL 的方法。PHP 在其默认安装中包含了多个函数，这使得 PHP 和 MySQL 成为一对流行的组合。在本节中，我将向您介绍从
    PHP 访问 MySQL 数据库的最常用函数。
- en: 'The following example assumes you have a location database table like the one
    we created in [#63: Store Locations to a Database](ch09s05.html "#63: Store Locations
    to a Database") in [Install MySQL Yourself](ch09s04.html#install_mysql_yourself
    "Install MySQL Yourself") with at least one place added to the database. Once
    you have your table ready to go, let''s write some PHP to grab all the place descriptions.'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: '以下示例假设您有一个位置数据库表，就像我们在 [第 63 节：将位置存储到数据库](ch09s05.html "#63: Store Locations
    to a Database") 中创建的那样，在 [自行安装 MySQL](ch09s04.html#install_mysql_yourself "自行安装
    MySQL") 中，并且至少已经将一个位置添加到数据库中。一旦您的表准备就绪，让我们编写一些 PHP 代码来获取所有位置描述。'
- en: 'Create a new PHP file with the following content:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个包含以下内容的新的 PHP 文件：
- en: '[PRE28]'
  id: totrans-233
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: Everything that begins with `mysql_` (shown in bold) is a function associated
    with accessing MySQL from PHP. Many more functions are listed at [http://php.net/mysql](http://php.net/mysql).
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 以 `mysql_` 开头的所有内容（粗体显示）都是与从 PHP 访问 MySQL 相关的函数。更多函数可以在 [http://php.net/mysql](http://php.net/mysql)
    找到。
- en: In this example, you first connect to MySQL using a server, username, and password
    ❶, which are likely provided by your site administrator. If you're using MAMP,
    you can find the login info on your installation's start page. These values establish
    the connection to MySQL and ensure not just anybody can access your data.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 在此示例中，您首先使用服务器、用户名和密码连接到 MySQL❶，这些信息很可能由您的网站管理员提供。如果您使用 MAMP，您可以在安装的起始页面上找到登录信息。这些值建立了与
    MySQL 的连接，并确保不是任何人都可以访问您的数据。
- en: Because MySQL can have many different databases, we need to tell it which one
    to use ❷. Here I've chosen the mapscripting database I created previously. Also,
    I pass along the database connection variable from the previous line.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 由于 MySQL 可以有多个不同的数据库，我们需要告诉它使用哪一个❷。在这里，我选择了之前创建的 mapscripting 数据库。我还传递了上一行的数据库连接变量。
- en: Now we're ready to get some data from the database. We use SQL to do this, similar
    to what happens behind the scenes on the Browse tab in phpMyAdmin. When using
    MySQL with PHP, you need to write the SQL yourself, which I've put into the variable
    `$sql`, which gets passed to a query ❸ along with the database connection variable.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经准备好从数据库中获取一些数据了。我们使用 SQL 来完成这项任务，这与在 phpMyAdmin 的浏览标签页背后发生的情况类似。当使用 PHP
    与 MySQL 结合时，您需要自己编写 SQL 语句，我已经将这些语句放入了变量 `$sql` 中，并将其与数据库连接变量一起传递给查询❸。
- en: You can fetch data from a query in many ways, all using the object that is returned
    from the previous line. In this example, we use a `while` loop to look at each
    result one at a time. Whenever the `$row` variable no longer has a value, the
    `while` loop will end.
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以通过多种方式从查询中获取数据，所有这些方式都使用上一行返回的对象。在此示例中，我们使用 `while` 循环逐个查看每个结果。每当 `$row`
    变量不再有值时，`while` 循环就会结束。
- en: The value for each result is an associative array ❹, so the results are stored
    as key-value pairs. The table's field name is the key, so we put that inside square
    brackets to get at the value ❺. To finish, we close the connection to the database
    ❻, which frees up resources.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 每个结果的价值是一个关联数组❹，因此结果以键值对的形式存储。表的字段名是键，因此我们将它放在方括号中以获取值❺。最后，我们关闭与数据库的连接❻，这样可以释放资源。
- en: When you run this PHP code, you should see the description of every place you
    added print out, one after another, in no particular format. The output may not
    be pretty, but you have now made a very simple connection to your MySQL database
    from PHP. Better yet, any data you want can now be connected to the Web. Are you
    feeling powerful yet? You should be.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 当你运行这段PHP代码时，你应该会看到你添加的每个地点的描述依次打印出来，没有特定的格式。输出可能看起来不太美观，但你现在已经从PHP中建立了一个非常简单的与MySQL数据库的连接。更好的是，现在你可以将任何数据连接到网络上。你感觉强大了吗？你应该会的。
- en: Continue reading to do something a bit more useful with the data in your location
    database.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 继续阅读，以在位置数据库中的数据上做一些更有用的操作。
- en: '#66: Plot Locations from a Database'
  id: totrans-242
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '#66：从数据库绘制位置'
- en: This project is the one you've been waiting for. You patiently put in your time
    learning the basics of MySQL and PHP. All you really wanted to do was put some
    points on a map without having to hand code it. Once you master the skills in
    this project, your mapping projects will be much more powerful because they'll
    be driven by data.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 这个项目正是你一直在等待的。你耐心地投入时间学习MySQL和PHP的基础知识。你真正想要的只是将一些点放在地图上，而不需要手动编码。一旦你掌握了这个项目中的技能，你的地图项目将会更加强大，因为它们将由数据驱动。
- en: 'Believe it or not, you already have the knowledge necessary to plot locations
    from a database. The concepts we''ll be using combine [#65: Use MySQL from PHP](ch09s07.html
    "#65: Use MySQL from PHP") in [#65: Use MySQL from PHP](ch09s07.html "#65: Use
    MySQL from PHP") and the parsing portion of a data formats project, [#53: Use
    JSON](ch08s02.html "#53: Use JSON") in [#53: Use JSON](ch08s02.html "#53: Use
    JSON"), which put the JavaScript framework jQuery to work for us.'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 信不信由你，你已经拥有了从数据库中绘制位置所需的知识。我们将使用结合了 [#65：在PHP中使用MySQL](ch09s07.html "#65：在PHP中使用MySQL")
    和数据格式项目中的解析部分，即 [#53：使用JSON](ch08s02.html "#53：使用JSON") 的概念，后者让JavaScript框架jQuery为我们工作。
- en: 'This project has two parts: creating the JSON on the server using our database
    and interpreting the JSON in the browser. Let''s go at ''em in that order.'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 这个项目分为两部分：在服务器上使用我们的数据库创建JSON，然后在浏览器中解析JSON。让我们按顺序来做。
- en: Output All Places as JSON
  id: totrans-246
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 以JSON格式输出所有地点
- en: We'll be using PHP that is only slightly more advanced than what you've written
    in other projects. Rather than printing out each result as we come across it,
    we'll store it. Once we have all the data, we'll print it out as JSON with help
    from a built-in PHP function.
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用比其他项目中写的更高级一点的PHP。而不是在遇到每个结果时打印出来，我们将存储它。一旦我们有了所有数据，我们将使用内置的PHP函数将其以JSON格式打印出来。
- en: Whenever you are getting data from your database, consider what you need. Here,
    we're going to be plotting our locations on a map, so we'll need, at the very
    least, the latitude and longitude of each place. Having a description of each,
    too, would be nice so we'll also grab our label. Depending on what you're doing,
    you might also like the unique `id`.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 每次从数据库获取数据时，考虑你需要什么。在这里，我们将要在地图上绘制我们的位置，所以至少需要每个地点的纬度和经度。如果每个地点都有描述那就更好了，因此我们也会获取标签。根据你所做的事情，你可能还希望获取唯一的`id`。
- en: How many rows do you want? For our example, let's get them all. Bear in mind
    that if your table is very large, you could be setting your users up for quite
    a long download. In that case, you might choose to only get the nearest locations
    from a database, but that's another project. Onward!
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 你想要多少行？在我们的例子中，让我们获取所有行。记住，如果你的表非常大，你可能会让用户下载一个相当长的文件。在这种情况下，你可能只想从数据库中获取最近的位置，但这又是另一个项目。继续前进！
- en: 'Create a new PHP file and add the following code:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个新的PHP文件，并添加以下代码：
- en: '[PRE29]'
  id: totrans-251
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: We begin with connection details and then go straight to the SQL ❶. I have listed
    the three field names we want to get from the database. Before looping through
    the results, I've created an empty array ❷. We'll use this to hold all the results.
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从连接细节开始，然后直接进入SQL ❶。我已经列出了我们想要从数据库中获取的三个字段名。在遍历结果之前，我创建了一个空数组 ❷。我们将使用这个数组来存储所有结果。
- en: As we loop through every row that the database returns, we use a PHP function
    to "push" the result to the end of our array ❸. You may remember that each result
    from the database is itself an associative array, with values stored with field
    names as keys. So the array containing all the rows is really an array *of arrays*.
    A bit confusing, perhaps, but perfectly suited for JSON.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们遍历数据库返回的每一行时，我们使用PHP函数将结果“推”到我们的数组末尾❸。你可能记得，数据库中的每个结果本身就是一个关联数组，值以字段名作为键存储。因此，包含所有行的数组实际上是一个数组的数组。可能有点令人困惑，但它非常适合JSON。
- en: After all of the results are stored in our massive array, we'll convert the
    variable to JSON text and print it out. We can do all of that in one single line
    ❹, assuming we have the JSON extensions (included in all recent PHP installations).
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 在所有结果都存储在我们的巨大数组中之后，我们将变量转换为JSON文本并打印出来。如果我们有JSON扩展（包含在所有最新的PHP安装中），我们可以在一行中完成所有这些操作❹。
- en: 'Here is the JSON output from my database, which has two rows:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 这是我的数据库的JSON输出，它有两行：
- en: '[PRE30]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: Very likely your results will be all squished together on one line, but I've
    split up the pieces to make more sense of them. When we parse this into JavaScript,
    we'll have an array (defined by square brackets) of objects (defined by curly
    brackets).
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 很可能你的结果都会挤在一起成为一行，但我已经将它们拆分，以便更容易理解。当我们将其解析到JavaScript中时，我们将有一个对象数组（由方括号定义），每个对象（由花括号定义）。
- en: Once the data is put into JavaScript, we'll be able to plot it on a map. Let's
    get going.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦数据被放入JavaScript中，我们就能在地图上绘制它。让我们开始吧。
- en: Plot Places from JSON
  id: totrans-259
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 从JSON中绘制地点
- en: Using PHP we have output all the places in our location database as JSON. Now
    we need to create a map that reads in the data and creates a new marker for every
    place. On the surface, this map is just like any other map we've created before.
    In this case, however, we won't even initialize the map until we hear back from
    the database.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 使用PHP，我们已经将我们的位置数据库中的所有地点输出为JSON。现在我们需要创建一个地图，该地图读取数据并为每个地点创建一个新的标记。表面上，这个地图就像我们之前创建的任何地图一样。然而，在这种情况下，我们甚至不会初始化地图，直到我们从数据库收到回复。
- en: 'Before we get to parsing the JSON results, we need to include the jQuery JavaScript
    framework. Add the following to the header code of a basic Mapstraction map:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们解析JSON结果之前，我们需要包含jQuery JavaScript框架。将以下代码添加到基本Mapstraction地图的头部代码中：
- en: '[PRE31]'
  id: totrans-262
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'Now replace any JavaScript code with the following function to initialize the
    map:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 现在用以下函数替换任何JavaScript代码以初始化地图：
- en: '[PRE32]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Unlike other times we've used a `create_map` function, we don't start by making
    a new Mapstraction map. We save this for later, once we've received data. Instead,
    the first thing we do is use jQuery to create an Ajax call to our PHP file (which
    I've called *allplaces.php*) ❶.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 与我们之前使用`create_map`函数的其他时候不同，我们不是先创建一个新的Mapstraction地图。我们将其保留到收到数据之后。相反，我们首先使用jQuery创建一个Ajax调用到我们的PHP文件（我将其命名为*allplaces.php*）❶。
- en: 'Once we have a result, *then* we create the map ❷, so we can start adding the
    data to it. Here, we''ve used a `for` loop to go through each place ❸. We can
    then save that object ❹, which has three attributes: label, latitude, and longitude.
    Those values are used to create a marker and give the marker a message box.'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦我们有了结果，*然后*我们创建地图❷，这样我们就可以开始向它添加数据。在这里，我们使用了一个`for`循环来遍历每个地点❸。然后我们可以保存这个对象❹，它有三个属性：标签、纬度和经度。这些值用于创建标记并给标记一个信息框。
- en: Finally, outside of the `for` loop (so it only happens once), we automatically
    center the map based on our markers. [Figure 9-11](ch09s08.html#database-driven_places_map
    "Figure 9-11. Database-driven places map") shows what my map, which has two landmarks
    as places, looks like.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，在`for`循环外部（所以它只发生一次），我们自动根据我们的标记来居中地图。[图9-11](ch09s08.html#database-driven_places_map
    "图9-11. 数据库驱动的地点地图")显示了具有两个地标作为地点的我的地图的样子。
- en: If I add a third place to the database and reload the page, I'll have a third
    marker. That's the beauty of a database-driven map!
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我在数据库中添加第三个地点并重新加载页面，我将有一个第三个标记。这就是数据库驱动地图的美丽之处！
- en: '![Database-driven places map](httpatomoreillycomsourcenostarchimages672107.png.jpg)'
  id: totrans-269
  prefs: []
  type: TYPE_IMG
  zh: '![数据库驱动的地点地图](httpatomoreillycomsourcenostarchimages672107.png.jpg)'
- en: Figure 9-11. Database-driven places map
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 图9-11. 数据库驱动的地点地图
- en: '#67: Get Nearest Locations from a Database'
  id: totrans-271
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '#67: 从数据库获取最近的位置'
- en: 'In [Chapter 6](ch06.html "Chapter 6. EXPLORE PROXIMITY"), we looked at several
    projects concerning what''s nearby. I showed how to calculate the distance between
    two points and how to determine the closest marker to a point. Arguably more useful
    is what we''ll be doing in this project: getting the nearest location to a point
    from a list of many possibilities stored in a database.'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第6章](ch06.html "第6章。探索邻近性")中，我们探讨了几个关于附近地点的项目。我展示了如何计算两点之间的距离以及如何确定离某一点最近的标记。更有用的是我们将在本项目中所做的工作：从一个数据库中存储的许多可能性中选择离某一点最近的位置。
- en: 'To be able to look at locations in a database, we need to have something in
    the database in the first place. For this example, we''ll be using the places
    database table from [#63: Store Locations to a Database](ch09s05.html "#63: Store
    Locations to a Database") in [Install MySQL Yourself](ch09s04.html#install_mysql_yourself
    "Install MySQL Yourself"). Although we''ve been using MySQL as an engine, most
    databases will work with the SQL statements that follow.'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: '为了能够查看数据库中的位置，我们首先需要在数据库中有所作为。在这个例子中，我们将使用[第63节：将位置存储到数据库中](ch09s05.html "#63:
    Store Locations to a Database")中的places数据库表，来自[自己安装MySQL](ch09s04.html#install_mysql_yourself
    "自己安装MySQL")。尽管我们一直在使用MySQL作为引擎，但大多数数据库都将与以下SQL语句一起工作。'
- en: Because we're looking for the nearest locations to a single point, we need to
    determine what that point is. I've chosen a point near me in Portland with a latitude
    of 45.517 and a longitude of −122.649\. Now we'll plug this into the Haversine
    formula—that's the same bit of trigonometry that we used in [Chapter 6](ch06.html
    "Chapter 6. EXPLORE PROXIMITY") to determine distance. There, we used JavaScript,
    and in this example, we'll use SQL.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 因为我们正在寻找离一个单独的点最近的位置，我们需要确定那个点是什么。我选择了一个位于波特兰附近的点，纬度为45.517，经度为−122.649。现在我们将这个值代入Haversine公式——这是我们在[第6章](ch06.html
    "第6章。探索邻近性")中用来确定距离的同一部分三角学。在那里，我们使用了JavaScript，在这个例子中，我们将使用SQL。
- en: 'From either the MySQL Command Interpreter, or in phpMyAdmin, type the following
    query:'
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: '要查看数据库中的位置，我们首先需要在数据库中有所作为。在这个例子中，我们将使用[第63节：将位置存储到数据库中](ch09s05.html "#63:
    Store Locations to a Database")中的places数据库表，来自[自己安装MySQL](ch09s04.html#install_mysql_yourself
    "自己安装MySQL")。虽然我们一直在使用MySQL作为引擎，但大多数数据库都将与以下SQL语句一起工作。'
- en: '[PRE33]'
  id: totrans-276
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: Here we're selecting all the fields from the places table, plus an additional
    field, described by the entire section in bold. That's a lot of code! This code
    calculates the distance between our point and the points in the database using
    the latitude and longitude values stored with each place.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们选择了places表中的所有字段，以及一个额外的字段，由整个加粗部分描述。这是一段相当多的代码！这段代码使用每个地点存储的纬度和经度值来计算我们的点与数据库中点之间的距离。
- en: The distance, which becomes a column named dist, is in kilometers. As with the
    previous implementation of the Haversine formula, we multiply by the earth's radius,
    which is 6,371 km. For miles, replace the number ❶ with its mile equivalent (3,958).
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 距离，成为名为dist的列，单位是千米。与之前实现的Haversine公式相同，我们乘以地球半径，即6,371千米。对于英里，将数字❶替换为其英里等价物（3,958）。
- en: When you run the SQL query, your results will be those shown in [Table 9-2](ch09s09.html#results_of_nearest_place_in_sql
    "Table 9-2. Results of Nearest Place in SQL"). Because we ordered by distance,
    the places nearest to our point come first in the table. Therefore, the nearest
    place to the point we selected is Old Faithful geyser. Of course, more useful
    examples will be from a places database with many locations all within the same
    city. Then, based on a point within that city, you can find the closest places,
    which will likely be within a few miles.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 当你运行SQL查询时，你的结果将如[表9-2](ch09s09.html#results_of_nearest_place_in_sql "表9-2。SQL中最近地点的结果")所示。因为我们按距离排序，所以离我们点最近的地点在表中排在前面。因此，离我们选定的点最近的地方是老忠实喷泉。当然，更有用的例子将来自包含许多地点且都在同一城市的地点数据库。然后，基于该城市内的一个点，你可以找到最近的地点，这些地点可能就在几英里之内。
- en: Table 9-2. Results of Nearest Place in SQL
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 表9-2。SQL中最近地点的结果
- en: '| ID | Label | Latitude | Longitude | Distance |'
  id: totrans-281
  prefs: []
  type: TYPE_TB
  zh: '| ID | 标签 | 纬度 | 经度 | 距离 |'
- en: '| --- | --- | --- | --- | --- |'
  id: totrans-282
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- | --- |'
- en: '| 1 | Old Faithful geyser | 44.46 | − 110.83 | 936.12 |'
  id: totrans-283
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 老忠实喷泉 | 44.46 | − 110.83 | 936.12 |'
- en: '| 2 | St. Louis Gateway Arch | 38.62 | − 90.19 | 2765.97 |'
  id: totrans-284
  prefs: []
  type: TYPE_TB
  zh: '| 2 | 圣路易斯 Gateway Arch | 38.62 | − 90.19 | 2765.97 |'
- en: Improve Your Query's Performance
  id: totrans-285
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 提高查询性能
- en: 'Database experts will have some big problems with the SQL we used in the previous
    section. You know all that math we used: COS this and RADIANS that? Those are
    being calculated for each row in the database, even if the value isn''t changing.
    The result is a query that will not make your server very happy once you''ve stored
    many places. In computer science terminology, the query has *poor performance*.'
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 数据库专家会对我们在上一节中使用的SQL有一些大问题。你知道我们使用了哪些数学：COS这个，RADIANS那个？这些值正在为数据库中的每一行计算，即使值没有变化。结果是，一旦你存储了许多地点，这个查询将不会让你的服务器感到高兴。在计算机科学术语中，这个查询有*较差的性能*。
- en: 'Let''s improve performance by storing some values that won''t change in SQL
    variables. The process is similar to PHP variables, but the syntax is a bit different.
    Alter the query from the previous section to look like this:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们通过在SQL变量中存储一些不会改变的价值来提高性能。这个过程与PHP变量类似，但语法略有不同。将上一节中的查询修改如下：
- en: '[PRE34]'
  id: totrans-288
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: The `SET` command is used to store a value into a variable. The variables themselves
    start with the `@` sign. The first three variables are used to hold numbers that
    were previously written directly into the query, making the distance portion of
    the query (again, in bold) easier to read.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: '`SET`命令用于将值存储到变量中。变量本身以`@`符号开头。前三个变量用于存储之前直接写入查询中的数字，这使得查询的距离部分（再次强调，加粗）更容易阅读。'
- en: The other four variables, beginning with ❶, also improve readability and make
    the query considerably shorter. Even better, performance improves as well. The
    values stored in the variables are only calculated once—when the variable is created.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 其他四个变量，从❶开始，也提高了可读性，并使查询大大缩短。更好的是，性能也得到了提升。存储在变量中的值只计算一次——当变量被创建时。
- en: A number of calculations are still happening as the query runs, which will bog
    down your server. Code like `COS(RADIANS(latitude))` can be avoided, but only
    if we change our database table. In the next section, I'll show you how you can
    further improve your query's performance.
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: 在查询运行过程中，仍然在进行许多计算，这将会拖慢你的服务器。像`COS(RADIANS(latitude))`这样的代码可以被避免，但前提是我们需要更改我们的数据库表。在下一节中，我将向你展示如何进一步优化你的查询性能。
- en: Precalculate Values in New Columns
  id: totrans-292
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 在新列中预先计算值
- en: The changes you're making to your SQL won't be noticeable until you have many
    locations stored in your database. The flip-side is that with many locations stored
    applying this query becomes more interesting, which could attract more users to
    your site. And that's definitely not the time you want your server to be slow.
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 你对SQL所做的更改在你数据库中存储了许多位置之前不会很明显。另一方面，随着存储的位置增多，应用这个查询变得更加有趣，这可能会吸引更多用户到你的网站。这绝对不是你希望服务器变慢的时候。
- en: 'Some things *have* to be calculated on-the-fly, otherwise the result would
    be the same for every location. You''ll be returning different results for every
    pair of latitude and longitude coordinates. We''ll focus on precalculating these
    three values from the previous section:'
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: 有些事情*必须*即时计算，否则每个位置的结果都会相同。你将为每一对纬度和经度坐标返回不同的结果。我们将专注于预先计算上一节中的这三个值：
- en: '`COS(RADIANS(latitude))`'
  id: totrans-295
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`COS(RADIANS(latitude))`'
- en: '`RADIANS(longitude)`'
  id: totrans-296
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`RADIANS(longitude)`'
- en: '`SIN(RADIANS(latitude))`'
  id: totrans-297
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`SIN(RADIANS(latitude))`'
- en: For every place stored in the database, these values will be different. Once
    the values are set, however, they will remain the same. That's a perfect case
    for adding three columns to your table. We'll name them `cosRadLat`, `radLon`,
    and `sinRadLat` and make them all type `FLOAT`.
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 对于数据库中存储的每个地方，这些值都会不同。然而，一旦值被设置，它们将保持不变。这正是添加三个列到你的表中的完美案例。我们将它们命名为`cosRadLat`、`radLon`和`sinRadLat`，并将它们都设置为`FLOAT`类型。
- en: 'Here''s the SQL version to add these columns through the Command Interpreter:'
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: 这是通过命令解释器添加这些列的SQL版本：
- en: '[PRE35]'
  id: totrans-300
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Once you''ve added these three columns, you need to fill in the values for
    all the places currently in your table:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你添加了这三个列，你需要为当前表中所有的地方填充值：
- en: '[PRE36]'
  id: totrans-302
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Finally, now that you''ve added values to new columns in your table, you can
    use this optimized query to get the nearest locations from your database:'
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，现在你已经为你表中的新列添加了值，你可以使用这个优化的查询从数据库中获取最近的位置：
- en: '[PRE37]'
  id: totrans-304
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: The result is an even shorter, much faster query. A few calculations still need
    to happen on the fly, but the rest has been precalculated and stored in either
    variables or columns in the places table.
  id: totrans-305
  prefs: []
  type: TYPE_NORMAL
  zh: 结果是一个更短、更快的查询。仍然需要即时进行一些计算，但其余的已经被预先计算并存储在地点表中的变量或列中。
- en: The only other change is that we are explicitly naming the fields to select,
    which is another database best practice. Plus, now that we added the three precalculated
    columns, we don't want to muddy our results with those additional values. Those
    numbers are just to improve speed and aren't particularly useful outside of that.
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: 唯一的其他变化是我们明确命名了要选择的字段，这是另一个数据库最佳实践。此外，现在我们添加了三个预先计算的字段，我们不想让结果变得混乱。这些数字只是为了提高速度，并不特别有用。
- en: '#68: Get Nearest Locations to a Postal Code'
  id: totrans-307
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '#68: 获取与邮政编码最近的地点'
- en: Big businesses often have store locators on their website. To use one, you type
    in your postal code and then you get a list of locations nearest yours. In this
    project, I'll show you how to perform the SQL database calls to reproduce this
    feature on your own site.
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 大型企业通常在其网站上设有商店定位器。要使用它，你输入你的邮政编码，然后你会得到一个离你最近的地点列表。在这个项目中，我将向你展示如何执行 SQL 数据库调用，以便在你的网站上重现此功能。
- en: On one hand, the code to find places near a postal code is the same as the previous
    project. All you need to do is determine the latitude and longitude point of a
    particular postal code, which you can get from most geocoder services, and you'll
    be able to find the closest places.
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 一方面，查找与邮政编码附近的地点的代码与上一个项目相同。你只需要确定特定邮政编码的纬度和经度点，这可以从大多数地理编码服务中获得，然后你就能找到最近的地点。
- en: 'Of course, having a postal code table in your own database is even more useful.
    This process is described in [#15: Get Postal Code Coordinates](ch03s06.html "#15:
    Get Postal Code Coordinates") in [#15: Get Postal Code Coordinates](ch03s06.html
    "#15: Get Postal Code Coordinates"), and I have links to database sources at [http://mapscripting.com/postal-code-database](http://mapscripting.com/postal-code-database).
    Installing your own database will save one step in the process, so you can find
    the ZIP Code''s coordinates and its closest places in one call to the database.'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: '当然，在你的数据库中拥有邮政编码表甚至更有用。这个过程在[第 15 节：获取邮政编码坐标](ch03s06.html "#15: Get Postal
    Code Coordinates")中描述，我在[第 15 节：获取邮政编码坐标](ch03s06.html "#15: Get Postal Code Coordinates")中提供了数据库源链接
    [http://mapscripting.com/postal-code-database](http://mapscripting.com/postal-code-database)。安装你自己的数据库将节省一个步骤，这样你就可以在数据库的一次调用中找到
    ZIP 编码的坐标及其最近的地点。'
- en: 'Create a new database table, which I''ll be calling *postals*. It will have
    three columns: *code*, *latitude*, and *longitude*. As you can see in [Figure 9-12](ch09s10.html#create_a_zip_code_table
    "Figure 9-12. Create a ZIP Code table."), the postal code itself is a five-character
    string (*varchar*) because that''s what is used in the United States, where ZIP
    Codes are five digits.'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 创建一个新的数据库表，我将称之为 *postals*。它将有三列：*code*、*latitude* 和 *longitude*。正如你在[图 9-12](ch09s10.html#create_a_zip_code_table
    "图 9-12. 创建 ZIP 编码表")中看到的，邮政编码本身是一个五字符的字符串（*varchar*），因为这是在美国使用的，ZIP 编码是五位数字。
- en: '![Create a ZIP Code table.](httpatomoreillycomsourcenostarchimages672109.png.jpg)'
  id: totrans-312
  prefs: []
  type: TYPE_IMG
  zh: '![创建 ZIP 编码表](httpatomoreillycomsourcenostarchimages672109.png.jpg)'
- en: Figure 9-12. Create a ZIP Code table.
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9-12. 创建 ZIP 编码表。
- en: The postal code is represented as text to account for the situation when the
    code starts with a zero. If you store the code as a number, which is more efficient,
    you will need to account for the starting zero with every lookup. Latitude and
    longitude are floating point numbers, just as they are in the places database.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 邮政编码以文本形式表示，以应对代码以零开头的情况。如果你将代码存储为数字，这更有效率，你需要在每次查找时考虑起始零。纬度和经度是浮点数，就像在地点数据库中一样。
- en: 'Here is the SQL version to create this table in the command interpreter:'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是使用命令解释器创建此表的 SQL 版本：
- en: '[PRE38]'
  id: totrans-316
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Now you''re ready to add some postal codes to your database. You can do a few
    by hand just for this test, using a geocoder to determine the correct latitude
    and longitude points. A better long-term solution would be to download a full
    postal code database and use [#64: Import Data from a Spreadsheet](ch09s06.html
    "#64: Import Data from a Spreadsheet") in [#64: Import Data from a Spreadsheet](ch09s06.html
    "#64: Import Data from a Spreadsheet").'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: '现在，你可以开始向数据库添加一些邮政编码了。为了这次测试，你可以手动添加几个，使用地理编码器来确定正确的纬度和经度点。更好的长期解决方案是下载完整的邮政编码数据库，并使用[第
    64 节：从电子表格导入数据](ch09s06.html "#64: Import Data from a Spreadsheet")。'
- en: 'At this point, your database should have two tables: *places* and *postals*.
    We''ll use both together in one SQL call to determine the nearest places.'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，你的数据库应该有两个表：*places* 和 *postals*。我们将在一个 SQL 调用中使用这两个表来确定最近的地点。
- en: 'From either the MySQL Command Interpreter or phpMyAdmin, type the following
    query:'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 从 MySQL 命令行解释器或 phpMyAdmin 中，输入以下查询：
- en: '[PRE39]'
  id: totrans-320
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: Most of the query is the same as the optimized version from the previous project.
    Instead of hard-coding the latitude and longitude, the first line selects it from
    our *postals* database. The portion in bold stores the coordinates in the `@lat`
    and `@lon` variables.
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 大部分查询与之前项目中优化的版本相同。而不是硬编码纬度和经度，第一行从我们的 *postals* 数据库中选择它。粗体部分将坐标存储在 `@lat` 和
    `@lon` 变量中。
- en: The results of our example query are shown in [Table 9-3](ch09s10.html#results_of_nearest_place_sql-id1
    "Table 9-3. Results of Nearest Place SQL"). Again, because I've chosen a location
    on the west coast of the United States, Old Faithful geyser is closest. As for
    finding places near a point, the really interesting stuff comes when you have
    many places all within one city.
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 我们示例查询的结果显示在 [表 9-3](ch09s10.html#results_of_nearest_place_sql-id1 "表 9-3. Nearest
    Place SQL 的结果") 中。再次强调，因为我选择的是美国西海岸的位置，所以老忠实喷泉是最接近的。至于查找靠近某个地点的地方，真正有趣的事情发生在你有一个城市内多个地点时。
- en: Table 9-3. Results of Nearest Place SQL
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 表 9-3. Nearest Place SQL 的结果
- en: '| Label | Latitude | Longitude | Distance |'
  id: totrans-324
  prefs: []
  type: TYPE_TB
  zh: '| 标签 | 纬度 | 经度 | 距离 |'
- en: '| --- | --- | --- | --- |'
  id: totrans-325
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- | --- |'
- en: '| Old Faithful geyser | 44.46 | − 110.83 | 1322.32 |'
  id: totrans-326
  prefs: []
  type: TYPE_TB
  zh: '| 老忠实喷泉 | 44.46 | − 110.83 | 1322.32 |'
- en: '| St. Louis Gateway Arch | 38.62 | − 90.19 | 2566.23 |'
  id: totrans-327
  prefs: []
  type: TYPE_TB
  zh: '| 圣路易斯 Gateway Arch | 38.62 | − 90.19 | 2566.23 |'
