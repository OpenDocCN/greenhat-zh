- en: Appendix B. Debugging
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: This appendix contains information about debuggers and the debugging process.
  prefs: []
  type: TYPE_NORMAL
- en: B.1 The Solaris Modular Debugger (mdb)
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The following tables list some useful commands of the Solaris Modular Debugger
    (mdb). For a complete list of available commands, see the *Solaris Modular Debugger
    Guide*.^([[91](apbs05.html#ftn.APP-B-FN-1)])
  prefs: []
  type: TYPE_NORMAL
- en: Starting and Stopping mdb
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `mdb` *`program`* | Starts mdb with *`program`* to debug. |'
  prefs: []
  type: TYPE_TB
- en: '| `mdb` *`unix.<n> vmcore.<n>`* | Runs mdb on a kernel crash dump (*`unix.<n>`*
    and *`vmcore.<n>`* can typically be found in the directory *`/var/crash/<hostname>`*).
    |'
  prefs: []
  type: TYPE_TB
- en: '| `$q` | Exits the debugger. |'
  prefs: []
  type: TYPE_TB
- en: General Commands
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `::run` *`arguments`* | Runs the program with the given *`arguments`*. If
    the target is currently running or it is a corefile, mdb will restart the program
    if possible. |'
  prefs: []
  type: TYPE_TB
- en: Breakpoints
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| *`address`*`::bp` | Sets a new breakpoint at the *`address`* of the breakpoint
    location that is specified in the command. |'
  prefs: []
  type: TYPE_TB
- en: '| `$b` | Lists information about existing breakpoints. |'
  prefs: []
  type: TYPE_TB
- en: '| `::delete` *`number`* | Removes previously set breakpoints specified by their
    *`number`*. |'
  prefs: []
  type: TYPE_TB
- en: Running the Debuggee
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `:s` | Executes a single instruction. Will step into subfunctions. |'
  prefs: []
  type: TYPE_TB
- en: '| `:e` | Executes a single instruction. Will not enter subfunctions. |'
  prefs: []
  type: TYPE_TB
- en: '| `:c` | Resumes execution. |'
  prefs: []
  type: TYPE_TB
- en: Examining Data
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| *`address`*,*`count format`* | Prints the specified number of objects (*`count`*)
    found at *`address`* in the specified *`format`*; example formats include B (hexadecimal,
    1-byte), X (hexadecimal, 4-byte), S (string). |'
  prefs: []
  type: TYPE_TB
- en: Information Commands
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `$r` | Lists registers and their contents. |'
  prefs: []
  type: TYPE_TB
- en: '| `$c` | Prints a backtrace of all stack frames. |'
  prefs: []
  type: TYPE_TB
- en: '| *`address`*`::dis` | Dumps a range of memory around *`address`* as machine
    instructions. |'
  prefs: []
  type: TYPE_TB
- en: Other Commands
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `::status` | Prints a summary of information related to the current target.
    |'
  prefs: []
  type: TYPE_TB
- en: '| `::msgbuf` | Displays the message buffer, including all console messages
    up to a kernel panic. |'
  prefs: []
  type: TYPE_TB
- en: B.2 The Windows Debugger (WinDbg)
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The following tables list some useful debugger commands of WinDbg. For a complete
    list of available commands, see Mario Hewardt and Daniel Pravat’s *Advanced Windows
    Debugging* (Addison-Wesley Professional, 2007) or the documentation that comes
    with WinDbg.
  prefs: []
  type: TYPE_NORMAL
- en: Starting and Stopping a Debugging Session
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `File` ▸ `Open Executable...` | Click **Open Executable** on the File menu
    to start a new user-mode process and debug it. |'
  prefs: []
  type: TYPE_TB
- en: '| `File` ▸ `Attach to a Process...` | Click **Attach to a Process** on the
    File menu to debug a user-mode application that is currently running. |'
  prefs: []
  type: TYPE_TB
- en: '| `q` | Ends the debugging session. |'
  prefs: []
  type: TYPE_TB
- en: General Commands
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `g` | Begins or resumes execution on the target. |'
  prefs: []
  type: TYPE_TB
- en: Breakpoints
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `bp` *`address`* | Sets a new breakpoint at the *`address`* of the breakpoint
    location that is specified in the command. |'
  prefs: []
  type: TYPE_TB
- en: '| `bl` | Lists information about existing breakpoints. |'
  prefs: []
  type: TYPE_TB
- en: '| `bc` *`breakpoint ID`* | Removes previously set breakpoints specified by
    their *`breakpoint ID`*. |'
  prefs: []
  type: TYPE_TB
- en: Running the Debuggee
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `t` | Executes a single instruction or source line and, optionally, displays
    the resulting values of all registers and flags. Will step into subfunctions.
    |'
  prefs: []
  type: TYPE_TB
- en: '| `p` | Executes a single instruction or source line and, optionally, displays
    the resulting values of all registers and flags. Will not enter subfunctions.
    |'
  prefs: []
  type: TYPE_TB
- en: Examining Data
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `dd` *`address`* | Displays the contents of *`address`* as double-word values
    (4 bytes). |'
  prefs: []
  type: TYPE_TB
- en: '| `du` *`address`* | Displays the contents of *`address`* as unicode characters.
    |'
  prefs: []
  type: TYPE_TB
- en: '| `dt` | Displays information about a local variable, global variable, or data
    type, including structures and unions. |'
  prefs: []
  type: TYPE_TB
- en: '| `poi(`*`address`*`)` | Returns pointer-sized data from the specified *`address`*.
    Depending on the architecture the pointer size is 32 bits or 64 bits. |'
  prefs: []
  type: TYPE_TB
- en: Information Commands
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `r` | Lists registers and their contents. |'
  prefs: []
  type: TYPE_TB
- en: '| `kb` | Prints a backtrace of all stack frames. |'
  prefs: []
  type: TYPE_TB
- en: '| `u` *`address`* | Dumps a range of memory around *`address`* as machine instructions.
    |'
  prefs: []
  type: TYPE_TB
- en: Other Commands
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `!analyze -v` | This debugger extension displays a lot of useful information
    about an exception or bug check. |'
  prefs: []
  type: TYPE_TB
- en: '| `!drvobj` *`DRIVER_OBJECT`* | This debugger extension displays detailed information
    about a *`DRIVER_OBJECT`*. |'
  prefs: []
  type: TYPE_TB
- en: '| `.sympath` | This command changes the default path of the debugger for symbol
    search. |'
  prefs: []
  type: TYPE_TB
- en: '| `.reload` | This command deletes all symbol information and reloads these
    symbols as needed. |'
  prefs: []
  type: TYPE_TB
- en: B.3 Windows Kernel Debugging
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In order to analyze the vulnerability described in [Chapter 6](ch06.html "Chapter 6. One
    Kernel to Rule Them All"), I needed a way to debug the Windows kernel. I set up
    a debugging environment with VMware^([[92](apbs05.html#ftn.APP-B-FN-2)]) and WinDbg^([[93](apbs05.html#ftn.APP-B-FN-3)])
    by following these steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '*Throughout this section, I used the following software versions: VMware Workstation
    6.5.2 and WinDbg 6.10.3.233*.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Step 1: Configure the VMware guest system for remote kernel debugging.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Step 2: Adjust the *boot.ini* of the guest system.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Step 3: Configure WinDbg on the VMware host for Windows kernel debugging.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Step 1: Configure the VMware Guest System for Remote Kernel Debugging'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: After I installed a Windows XP SP3 VMware guest system, I powered it off and
    chose **Edit Virtual Machine Settings** from the Commands section of VMware. I
    then clicked the **Add** button to add a new serial port and chose the configuration
    settings shown in [Figure B-1](apbs03.html#output_to_named_pipe "Figure B-1. Output
    to named pipe") and [Figure B-2](apbs03.html#named_pipe_configuration "Figure B-2. Named
    pipe configuration").
  prefs: []
  type: TYPE_NORMAL
- en: '![Output to named pipe](httpatomoreillycomsourcenostarchimages939345.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure B-1. Output to named pipe
  prefs: []
  type: TYPE_NORMAL
- en: '![Named pipe configuration](httpatomoreillycomsourcenostarchimages939347.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure B-2. Named pipe configuration
  prefs: []
  type: TYPE_NORMAL
- en: After the new serial port was successfully added, I selected the Yield CPU on
    poll checkbox of the “I/O mode” section, as shown in [Figure B-3](apbs03.html#configuration_settings_for_the_new_seria
    "Figure B-3. Configuration settings for the new serial port").
  prefs: []
  type: TYPE_NORMAL
- en: '![Configuration settings for the new serial port](httpatomoreillycomsourcenostarchimages939349.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure B-3. Configuration settings for the new serial port
  prefs: []
  type: TYPE_NORMAL
- en: 'Step 2: Adjust the boot.ini of the Guest System'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'I then powered up the VMware guest system and edited the *boot.ini* file of
    Windows XP to contain the following entries (the bold one enabled kernel debugging):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: I then rebooted the guest system and chose the new entry **Microsoft Windows
    XP Professional – Debug [debugger enabled]** from the boot menu to start the system,
    as shown in [Figure B-4](apbs03.html#new_boot_menu_option "Figure B-4. New boot
    menu option").
  prefs: []
  type: TYPE_NORMAL
- en: '![New boot menu option](httpatomoreillycomsourcenostarchimages939351.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure B-4. New boot menu option
  prefs: []
  type: TYPE_NORMAL
- en: 'Step 3: Configure WinDbg on the VMware Host for Windows Kernel Debugging'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The only thing left was to configure WinDbg on the VMware host so that it attached
    to the kernel of the VMware guest system using a pipe. To do this, I created a
    batch file with the content shown in [Figure B-5](apbs03.html#windbg_batch_file_for_kernel_debugging
    "Figure B-5. WinDbg batch file for kernel debugging").
  prefs: []
  type: TYPE_NORMAL
- en: '![WinDbg batch file for kernel debugging](httpatomoreillycomsourcenostarchimages939353.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure B-5. WinDbg batch file for kernel debugging
  prefs: []
  type: TYPE_NORMAL
- en: I then double-clicked the batch file to attach WinDbg on the VMware host to
    the kernel of the VMware Windows XP guest system, as shown in [Figure B-6](apbs03.html#attaching_the_kernel_debugger_open_paren
    "Figure B-6. Attaching the kernel debugger (WinDbg)").
  prefs: []
  type: TYPE_NORMAL
- en: '![Attaching the kernel debugger (WinDbg)](httpatomoreillycomsourcenostarchimages939355.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure B-6. Attaching the kernel debugger (WinDbg)
  prefs: []
  type: TYPE_NORMAL
- en: B.4 The GNU Debugger (gdb)
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The following tables list some useful commands of the GNU Debugger (gdb). For
    a complete list of available commands, see the gdb online documentation.^([[94](apbs05.html#ftn.APP-B-FN-4)])
  prefs: []
  type: TYPE_NORMAL
- en: Starting and Stopping gdb
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `gdb` *`program`* | Starts gdb with *`program`* to debug. |'
  prefs: []
  type: TYPE_TB
- en: '| `quit` | Exits the debugger. |'
  prefs: []
  type: TYPE_TB
- en: General Commands
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `run` *`arguments`* | Starts debugged program (with *`arguments`*). |'
  prefs: []
  type: TYPE_TB
- en: '| `attach` *`processID`* | Attaches the debugger to the running process with
    *`processID`*. |'
  prefs: []
  type: TYPE_TB
- en: Breakpoints
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `break <`*`file`*`:> function` | Sets a breakpoint at the beginning of the
    specified *`function`* (in *`file`*). |'
  prefs: []
  type: TYPE_TB
- en: '| `break <`*`file`*`:> line number` | Sets a breakpoint at the start of the
    code for that *`line number`* (in *`file`*). |'
  prefs: []
  type: TYPE_TB
- en: '| `break *`*`address`* | Sets a breakpoint at the specified *`address`*. |'
  prefs: []
  type: TYPE_TB
- en: '| `info breakpoints` | Lists information about existing breakpoints. |'
  prefs: []
  type: TYPE_TB
- en: '| `delete` *`number`* | Removes previously set breakpoints specified by their
    *`number`*. |'
  prefs: []
  type: TYPE_TB
- en: Running the Debuggee
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `stepi` | Executes one machine instruction. Will step into subfunctions.
    |'
  prefs: []
  type: TYPE_TB
- en: '| `nexti` | Executes one machine instruction. Will not enter subfunctions.
    |'
  prefs: []
  type: TYPE_TB
- en: '| `continue` | Resumes execution. |'
  prefs: []
  type: TYPE_TB
- en: Examining Data
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `x/`*`CountFormatSize address`* | Prints the specified number of objects
    (*`Count`*) of the specified *`Size`* according to the *`Format`* at *`address`*.Size:
    `b` (byte), `h` (halfword), `w` (word), `g` (giant, 8 bytes).Format: `o` (octal),
    `x` (hexadecimal), `d` (decimal), `u` (unsigned decimal), `t` (binary), `f` (float),
    `a` (address), `i` (instruction), `c` (char), `s` (string). |'
  prefs: []
  type: TYPE_TB
- en: Information Commands
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `info registers` | Lists registers and their contents. |'
  prefs: []
  type: TYPE_TB
- en: '| `backtrace` | Prints a backtrace of all stack frames. |'
  prefs: []
  type: TYPE_TB
- en: '| `disassemble` *`address`* | Dumps a range of memory around *`address`* as
    machine instructions. |'
  prefs: []
  type: TYPE_TB
- en: Other Commands
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '| Command | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| `set disassembly-flavor` *`intel`*`&#124;`*`att`* | Sets the disassembly
    flavor to Intel or AT&T assembly syntax. Default is AT&T syntax. |'
  prefs: []
  type: TYPE_TB
- en: '| `shell` *`command`* | Executes a shell *`command`*. |'
  prefs: []
  type: TYPE_TB
- en: '| `set variable *(`*`address`*`)=`*`value`* | Stores *`value`* at the memory
    location specified by *`address`*. |'
  prefs: []
  type: TYPE_TB
- en: '| `source` *`file`* | Reads debugger commands from a *`file`*. |'
  prefs: []
  type: TYPE_TB
- en: '| `set follow-fork-mode` *`parent`*`&#124;`*`child`* | Tells the debugger to
    follow the *`child`* or *`parent`* process. |'
  prefs: []
  type: TYPE_TB
- en: B.5 Using Linux as a Mac OS X Kernel-Debugging Host
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In this section, I will detail the steps I performed to prepare a Linux system
    as a debugging host for the Mac OS X kernel:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Step 1: Install an ancient Red Hat 7.3 Linux operating system.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Step 2: Get the necessary software packages.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Step 3: Build Apple’s debugger on the Linux host.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Step 4: Prepare the debugging environment.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Step 1: Install an Ancient Red Hat 7.3 Linux Operating System'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Because Apple’s GNU Debugger (gdb) version that I used needs a GNU C Compiler
    (gcc) less than version 3 to build correctly, I downloaded and installed an ancient
    Red Hat 7.3 Linux system.^([[95](apbs05.html#ftn.APP-B-FN-5)]) To install the
    Red Hat system, I chose the installation type Custom. When I was asked to select
    the packages to install (Package Group Selection), I chose only the packages Network
    Support and Software Development, as well as OpenSSH server from the individual
    package selection. These packages include all the necessary development tools
    and libraries to build Apple’s gdb under Linux. During the installation, I added
    an unprivileged user called `tk` with a home directory under */home/tk*.
  prefs: []
  type: TYPE_NORMAL
- en: 'Step 2: Get the Necessary Software Packages'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'After I had successfully installed the Linux host, I downloaded the following
    software packages:'
  prefs: []
  type: TYPE_NORMAL
- en: Source code of Apple’s custom gdb version.^([[96](apbs05.html#ftn.APP-B-FN-6)])
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Standard gdb source code from GNU.^([[97](apbs05.html#ftn.APP-B-FN-7)])
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A patch for Apple’s gdb to compile under Linux.^([[98](apbs05.html#ftn.APP-B-FN-8)])
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The appropriate source code version of the XNU kernel. I prepared the Linux
    debugging host to research the kernel bug described in [Chapter 7](ch07.html "Chapter 7. A
    Bug Older Than 4.4BSD"), so I downloaded the XNU version 792.13.8.^([[99](apbs05.html#ftn.APP-B-FN-9)])
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The appropriate version of Apple’s Kernel Debug Kit. I found the bug explored
    in [Chapter 7](ch07.html "Chapter 7. A Bug Older Than 4.4BSD") on Mac OS X 10.4.8,
    so I downloaded the corresponding Kernel Debug Kit version 10.4.8 (*Kernel_Debug_Kit_10.4.8_8L2127.dmg*).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Step 3: Build Apple’s Debugger on the Linux Host'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'After I downloaded the necessary software packages onto the Linux host, I unpacked
    the two versions of gdb:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'Then I replaced the *mmalloc* directory of Apple’s source tree with the one
    from GNU gdb:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'I applied the patch to Apple’s gdb version:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'I used the following commands to build the necessary libraries:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'To build the debugger itself, I needed to copy some header files from the XNU
    kernel source code to the *include* directory of the Linux host:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'I then commented some typedefs in the new *_types.h* file to avoid compile-time
    conflicts (see line 39, lines 43 to 49, and lines 78 to 81):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'I added a new `include` to the file */home/tk/gdb-292/src/gdb/macosx/i386-macosx-tdep.c*
    (see line 24):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'Finally, I compiled the debugger with the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'After the compilation completed, I ran the new debugger as root so that the
    necessary directories could be created under */usr/local/bin/*:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: After that, the debugger was ready.
  prefs: []
  type: TYPE_NORMAL
- en: 'Step 4: Prepare the Debugging Environment'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'I unpacked the downloaded Kernel Debug Kit disk image file (dmg) under Mac
    OS X, transferred the files per `scp` to the Linux host, and named the directory
    *KernelDebugKit_10.4.8*. I also copied the XNU source code into the search path
    of the debugger:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: In [Chapter 7](ch07.html "Chapter 7. A Bug Older Than 4.4BSD"), I described
    how the newly built kernel debugger can be used to connect to a Mac OS X machine.
  prefs: []
  type: TYPE_NORMAL
- en: Notes
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: ^([[91](#ftn.APP-B-FN-1)])
  prefs: []
  type: TYPE_NORMAL
- en: ^([[92](#ftn.APP-B-FN-2)])
  prefs: []
  type: TYPE_NORMAL
- en: ^([[93](#ftn.APP-B-FN-3)])
  prefs: []
  type: TYPE_NORMAL
- en: ^([[94](#ftn.APP-B-FN-4)])
  prefs: []
  type: TYPE_NORMAL
- en: ^([[95](#ftn.APP-B-FN-5)])
  prefs: []
  type: TYPE_NORMAL
- en: ^([[96](#ftn.APP-B-FN-6)])
  prefs: []
  type: TYPE_NORMAL
- en: ^([[97](#ftn.APP-B-FN-7)])
  prefs: []
  type: TYPE_NORMAL
- en: ^([[98](#ftn.APP-B-FN-8)])
  prefs: []
  type: TYPE_NORMAL
- en: ^([[99](#ftn.APP-B-FN-9)])
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[91](#APP-B-FN-1)]) See the *Solaris Modular Debugger Guide* at [http://dlc.sun.com/osol/docs/content/MODDEBUG/moddebug.html](http://dlc.sun.com/osol/docs/content/MODDEBUG/moddebug.html).
  prefs: []
  type: TYPE_NORMAL
- en: ^([[92](#APP-B-FN-2)]) See [http://www.vmware.com/](http://www.vmware.com/).
  prefs: []
  type: TYPE_NORMAL
- en: ^([[93](#APP-B-FN-3)]) See [http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx](http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx).
  prefs: []
  type: TYPE_NORMAL
- en: ^([[94](#APP-B-FN-4)]) See [http://www.gnu.org/software/gdb/documentation/](http://www.gnu.org/software/gdb/documentation/).
  prefs: []
  type: TYPE_NORMAL
- en: '^([[95](#APP-B-FN-5)]) There are still a few download mirror sites available
    where you can get the Red Hat 7.3 ISO images. Here are a few, as of this writing:
    [http://ftp-stud.hs-esslingen.de/Mirrors/archive.download.redhat.com/redhat/linux/7.3/de/iso/i386/](http://ftp-stud.hs-esslingen.de/Mirrors/archive.download.redhat.com/redhat/linux/7.3/de/iso/i386/),
    [http://mirror.fraunhofer.de/archive.download.redhat.com/redhat/linux/7.3/en/iso/i386/](http://mirror.fraunhofer.de/archive.download.redhat.com/redhat/linux/7.3/en/iso/i386/),
    and [http://mirror.cs.wisc.edu/pub/mirrors/linux/archive.download.redhat.com/redhat/linux/7.3/en/iso/i386/](http://mirror.cs.wisc.edu/pub/mirrors/linux/archive.download.redhat.com/redhat/linux/7.3/en/iso/i386/).'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[96](#APP-B-FN-6)]) Apple’s custom gdb version can be downloaded at [http://www.opensource.apple.com/tarballs/gdb/gdb-292.tar.gz](http://www.opensource.apple.com/tarballs/gdb/gdb-292.tar.gz).
  prefs: []
  type: TYPE_NORMAL
- en: ^([[97](#APP-B-FN-7)]) The standard gdb version from GNU can be downloaded at
    [http://ftp.gnu.org/pub/gnu/gdb/gdb-5.3.tar.gz](http://ftp.gnu.org/pub/gnu/gdb/gdb-5.3.tar.gz).
  prefs: []
  type: TYPE_NORMAL
- en: ^([[98](#APP-B-FN-8)]) The patch for Apple’s GNU debugger is available at [http://www.trapkit.de/books/bhd/osx_gdb.patch](http://www.trapkit.de/books/bhd/osx_gdb.patch).
  prefs: []
  type: TYPE_NORMAL
- en: ^([[99](#APP-B-FN-9)]) The XNU version 792.13.8 can be downloaded at [http://www.opensource.apple.com/tarballs/xnu/xnu-792.13.8.tar.gz](http://www.opensource.apple.com/tarballs/xnu/xnu-792.13.8.tar.gz).
  prefs: []
  type: TYPE_NORMAL
