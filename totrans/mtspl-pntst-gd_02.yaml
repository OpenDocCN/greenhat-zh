- en: Chapter 2. Metasploit Basics
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: When you encounter the Metasploit Framework (MSF) for the first time, you might
    be overwhelmed by its many interfaces, options, utilities, variables, and modules.
    In this chapter, we’ll focus on the basics that will help you make sense of the
    big picture. We’ll review some basic penetration testing terminology and then
    briefly cover the various user interfaces that Metasploit has to offer. Metasploit
    itself is free, open source software, with many contributors in the security community,
    but two commercial Metasploit versions are also available.
  prefs: []
  type: TYPE_NORMAL
- en: When first using Metasploit, it’s important not to get hung up on that newest
    exploit; instead, focus on how Metasploit functions and what commands you used
    to make the exploit possible.
  prefs: []
  type: TYPE_NORMAL
- en: Terminology
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Throughout this book, we’ll use various terms that first bear some explanation.
    The majority of the following basic terms are defined in the context of Metasploit,
    but they are generally the same throughout the security industry.
  prefs: []
  type: TYPE_NORMAL
- en: Exploit
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: An *exploit* is the means by which an attacker, or pen tester for that matter,
    takes advantage of a flaw within a system, an application, or a service. An attacker
    uses an exploit to attack a system in a way that results in a particular desired
    outcome that the developer never intended. Common exploits include buffer overflows,
    web application vulnerabilities (such as SQL injection), and configuration errors.
  prefs: []
  type: TYPE_NORMAL
- en: Payload
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: A *payload* is code that we want the system to execute and that is to be selected
    and delivered by the Framework. For example, a *reverse shell* is a payload that
    creates a connection from the target machine back to the attacker as a Windows
    command prompt (see [Chapter 5](part0009.html#the_joy_of_exploitation)), whereas
    a *bind shell* is a payload that “binds” a command prompt to a listening port
    on the target machine, which the attacker can then connect. A payload could also
    be something as simple as a few commands to be executed on the target operating
    system.
  prefs: []
  type: TYPE_NORMAL
- en: Shellcode
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '*Shellcode* is a set of instructions used as a payload when exploitation occurs.
    Shellcode is typically written in assembly language. In most cases, a command
    shell or a Meterpreter shell will be provided after the series of instructions
    have been performed by the target machine, hence the name.'
  prefs: []
  type: TYPE_NORMAL
- en: Module
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: A *module* in the context of this book is a piece of software that can be used
    by the Metasploit Framework. At times, you may require the use of an *exploit
    module*, a software component that conducts the attack. Other times, an *auxiliary
    module* may be required to perform an action such as scanning or system enumeration.
    These interchangeable modules are the core of what makes the Framework so powerful.
  prefs: []
  type: TYPE_NORMAL
- en: Listener
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: A *listener* is a component within Metasploit that waits for an incoming connection
    of some sort. For example, after the target machine has been exploited, it may
    call the attacking machine over the Internet. The listener handles that connection,
    waiting on the attacking machine to be contacted by the exploited system.
  prefs: []
  type: TYPE_NORMAL
- en: Metasploit Interfaces
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Metasploit offers more than one interface to its underlying functionality, including
    console, command line, and graphical interfaces. In addition to these interfaces,
    utilities provide direct access to functions that are normally internal to the
    Metasploit Framework. These utilities can be invaluable for exploit development
    and situations for which you do not need the flexibility of the entire Framework.
  prefs: []
  type: TYPE_NORMAL
- en: MSFconsole
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '*Msfconsole* is by far the most popular part of the Metasploit Framework, and
    for good reason. It is one of the most flexible, feature-rich, and well-supported
    tools within the Framework. *Msfconsole* provides a handy all-in-one interface
    to almost every option and setting available in the Framework; it’s like a one-stop
    shop for all of your exploitation dreams. You can use *msfconsole* to do everything,
    including launching an exploit, loading auxiliary modules, performing enumeration,
    creating listeners, or running mass exploitation against an entire network.'
  prefs: []
  type: TYPE_NORMAL
- en: Although the Metasploit Framework is constantly changing, a subset of commands
    remain relatively constant. By mastering the basics of *msfconsole*, you will
    be able to keep up with any changes. To illustrate the importance of learning
    *msfconsole*, it will be used in nearly every chapter of the book.
  prefs: []
  type: TYPE_NORMAL
- en: Starting MSFconsole
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'To launch *msfconsole*, enter **`msfconsole`** at the command line:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: To access *msfconsole*’s help files, enter **`help`** followed by the command
    which you are interested in. In the next example, we are looking for help for
    the command `connect`, which allows us to communicate with a host. The resulting
    documentation lists usage, a description of the tool, and the various option flags.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: We’ll explore MSFConsole in greater depth in the chapters that follow.
  prefs: []
  type: TYPE_NORMAL
- en: MSFcli
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '*Msfcli* and *msfconsole* take very different approaches to providing access
    to the Framework. Where *msfconsole* provides an interactive way to access all
    features in a user-friendly manner, *msfcli* puts the priority on scripting and
    interpretability with other console-based tools. Instead of providing a unique
    interpreter to the Framework, *msfcli* runs directly from the command line, which
    allows you to redirect output from other tools into *msfcli* and direct *msfcli*
    output to other command-line tools. *Msfcli* also supports the launching of exploits
    and auxiliary modules, and it can be convenient when testing modules or developing
    new exploits for the Framework. It is a fantastic tool for unique exploitation
    when you know exactly which exploit and options you need. It is less forgiving
    than *msfconsole*, but it offers some basic help (including usage and a list of
    modes) with the command `msfcli -h`, as shown here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: Sample Usage
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Let’s take a look at how you might use *msfcli*. Don’t worry about the details;
    these examples are intended to give you a sense of how you might work with this
    interface.
  prefs: []
  type: TYPE_NORMAL
- en: 'When you are first learning Metasploit or whenever you get stuck, you can see
    the options available in a module by appending the letter `O` to the end of the
    string at whichever point you are stuck. For example, in the following listing,
    we use the `O` to see the options available for the *ms08_067_netapi* module:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'You can see that the module requires three options: `RHOST`, `RPORT`, and `SMPIPE`.
    Now, by adding a `P`, we can check for available payloads:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'Having set all the required options for our exploit and selecting a payload,
    we can run our exploit by passing the letter `E` to the end of the *msfcli* argument
    string, as shown here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: We’re successful, because we have received a Windows command prompt from the
    remote system.
  prefs: []
  type: TYPE_NORMAL
- en: Armitage
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The *armitage* component of Metasploit is a fully interactive graphical user
    interface created by Raphael Mudge. This interface is highly impressive, feature
    rich, and available for free. We won’t be covering *armitage* in depth, but it
    is definitely worth mentioning as something to explore. Our goal is to teach the
    ins and outs of Metasploit, and the GUI is awesome once you understand how the
    Framework actually operates.
  prefs: []
  type: TYPE_NORMAL
- en: Running Armitage
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: To launch *armitage*, run the command `armitage`. During startup, select **Start
    MSF**, which will allow *armitage* to connect to your Metasploit instance.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: After *armitage* is running, simply click a menu to perform a particular attack
    or access other Metasploit functionality. For example, [Figure 2-1](part0006.html#the_armitageas_browser_exploit_menu)
    shows the browser (client-side) exploits.
  prefs: []
  type: TYPE_NORMAL
- en: '![The armitage’s browser exploit menu](../images/00001.jpeg)Figure 2-1. The
    *armitage*’s browser exploit menu'
  prefs: []
  type: TYPE_NORMAL
- en: Metasploit Utilities
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Having covered Metasploit’s three main interfaces, it’s time to cover a few
    utilities. Metasploit’s utilities are direct interfaces to particular features
    of the Framework that can be useful in specific situations, especially in exploit
    development. We will cover some of the more approachable utilities here and introduce
    additional ones throughout the book.
  prefs: []
  type: TYPE_NORMAL
- en: MSFpayload
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The *msfpayload* component of Metasploit allows you to generate shellcode, executables,
    and much more for use in exploits outside of the Framework.
  prefs: []
  type: TYPE_NORMAL
- en: Shellcode can be generated in many formats including C, Ruby, JavaScript, and
    even Visual Basic for Applications. Each output format will be useful in various
    situations. For example, if you are working with a Python-based proof of concept,
    C-style output might be best; if you are working on a browser exploit, a JavaScript
    output format might be best. After you have your desired output, you can easily
    insert the payload directly into an HTML file to trigger the exploit.
  prefs: []
  type: TYPE_NORMAL
- en: 'To see which options the utility takes, enter **`msfpayload -h`** at the command
    line, as shown here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'As with *msfcli*, if you find yourself stuck on the required options for a
    payload module, append the letter `O` on the command line for a list of required
    and optional variables, like so:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: We will dive much deeper into *msfpayload* as we explore exploit development
    in later chapters.
  prefs: []
  type: TYPE_NORMAL
- en: MSFencode
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The shellcode generated by *msfpayload* is fully functional, but it contains
    several null characters that, when interpreted by many programs, signify the end
    of a string, and this will cause the code to terminate before completion. In other
    words, those `x00`s and `xff`s can break your payload!
  prefs: []
  type: TYPE_NORMAL
- en: In addition, shellcode traversing a network in cleartext is likely to be picked
    up by intrusion detection systems (IDSs) and antivirus software. To address this
    problem, Metasploit’s developers offer *msfencode*, which helps you to avoid bad
    characters and evade antivirus and IDSs by encoding the original payload in a
    way that does not include “bad” characters. Enter **`msfencode -h`** to see a
    list of *msfencode* options.
  prefs: []
  type: TYPE_NORMAL
- en: Metasploit contains a number of different encoders for specific situations.
    Some will be useful when you can use only alphanumeric characters as part of a
    payload, as is the case with many file format exploits or other applications that
    accept only printable characters as input, while others are great general purpose
    encoders that do well in every situation.
  prefs: []
  type: TYPE_NORMAL
- en: When in doubt, though, you really can’t go wrong with the *x86/shikata_ ga_nai*
    encoder, the only encoder with the rank of Excellent, a measure of the reliability
    and stability of a module. In the context of an encoder, an Excellent ranking
    implies that it is one of the most versatile encoders and can accommodate a greater
    degree of fine-tuning than other encoders. To see the list of encoders available,
    append `-l` to `msfencode` as shown next. The payloads are ranked in order of
    reliability.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: Nasm Shell
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The *nasm_shell.rb* utility can be handy when you’re trying to make sense of
    assembly code, especially if, during exploit development, you need to identify
    the *opcodes* (the assembly instructions) for a given assembly command.
  prefs: []
  type: TYPE_NORMAL
- en: For example, here we run the tool and request the opcodes for the `jmp esp`
    command, which `nasm_shell` tells us is FFE4.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: Metasploit Express and Metasploit Pro
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Metasploit Express and Metasploit Pro are commercial web interfaces to the
    Metasploit Framework. These utilities provide substantial automation and make
    things easier for new users, while still providing full access to the Framework.
    Both products also provide tools that are unavailable in the community editions
    of the Framework, such as automated password brute forcing and automated website
    attacks. In addition, a nice reporting backend to Metasploit Pro can speed up
    one of the least popular aspects of penetration testing: writing the report.'
  prefs: []
  type: TYPE_NORMAL
- en: Are these tools worth purchasing? Only you can make that choice. The commercial
    editions of Metasploit are intended for professional penetration testers and can
    ease many of the more routine aspects of the job, but if the time savings from
    the automations in these commercial products are useful for you, they might justify
    the purchase price.
  prefs: []
  type: TYPE_NORMAL
- en: Remember, however, as you automate your work, that humans are better at identifying
    attack vectors than automated tools.
  prefs: []
  type: TYPE_NORMAL
- en: Wrapping Up
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In this chapter, you learned a little bit of the basics of the Metasploit Framework.
    As you progress through this book, you will begin using these tools in a much
    more advanced capacity. You’ll find a few different ways to accomplish the same
    tasks using different tools. It will ultimately be up to you to decide which tool
    best suits your needs.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now that you have the basics under control, let’s move to the next phase of
    the pen testing process: discovery.'
  prefs: []
  type: TYPE_NORMAL
