<html><head></head><body>

<div class="calibre21" id="calibre_pb_0"/><div class="calibre1" id="calibre_toc_54">
<a name="ch04" class="calibre6" id="ch04"/>
<div class="calibre1">
<h2 class="lot-title" id="calibre_pb_1"><a name="55" class="calibre16" id="55"/><a name="ch04lev1sec20" class="calibre16" id="ch04lev1sec20"/><span class="chapter-titlelabel">Program 46: </span>Nothing Goes Wrong</h2><p class="b24-bookeditorial">Why does the following program sometimes dump core?</p>
<div class="calibre1">
<pre class="literallayout-normal">
  1 /************************************************
  2  * list -- Test out the command list decoder.   *
  3  *                                              *
  4  * Read a command from the input and check to   *
  5  * see if the command decoder can find it.      *
  6  ************************************************/
  7 #include &lt;iostream&gt;
  8 #include &lt;cstring&gt;
  9
 10 static inline void do_open() {
 11    std::cout &lt;&lt; "do_open called\n";
 12 }
 13 static inline void do_close() {
 14    std::cout &lt;&lt; "do_close called\n";
 15 }
 16 static inline void do_save() {
 17    std::cout &lt;&lt; "do_save called\n";
 18 }
 19 static inline void do_quit() {
 20     exit(0);
 21 }
 22 /*
 23  * The command as a string and
 24  * as a function to execute
 25  */
 26 struct cmd_info {
 27     char *const cmd;
 28     void (*funct)();
 29 };
 30
 31 /*
 32  * List of all possible commands
 33  */
 34 static cmd_info cmd_list[] = {
 35     {"open", do_open},
 36     {"close", do_close},
 37     {"save", do_save},
 38     {"quit", do_quit},
 39     {NULL, NULL}
 40 };
 41
 42 /************************************************
 43  * do_cmd -- Decode a command an execute it.    *
 44  *    If the command is not found, output an    *
 45  *    error.                                    *
 46  ************************************************/
 47 static void do_cmd(
 48     const char *const cmd
 49 ) {
 50     struct cmd_info *cur_cmd;
 51
 52     cur_cmd = cmd_list;
 53
 54     while (
 55         (std::strcmp(cur_cmd-&gt;cmd, cmd) != 0) &amp;&amp;
 56         cur_cmd != NULL)
 57     {
 58         cur_cmd++;
 59     }
 60     if (cur_cmd == NULL) {
 61         std::cout &lt;&lt; "Command not found\n";
 62     } else {
 63         cur_cmd-&gt;funct();
 64     }
 65 }
 66
 67 /************************************************
 68  * main -- Simple test program.                 *
 69  ************************************************/
 70 int main()
 71 {
 72     char cmd[100];
 73     while (1) {
 74         std::cout &lt;&lt; "Cmd: ";
 75         std::cin.getline(cmd, sizeof(cmd));
 76
 77         do_cmd(cmd);
 78     }
 79 }
</pre>
</div>
<p class="b24-bookeditorial">(Next <a href="LiB0120.html#271" target="_parent" class="calibre2">Hint 135</a>. <a href="LiB0121.html#568" target="_parent" class="calibre2">Answer 70</a>.)</p>
</div>
</div>



</body></html>