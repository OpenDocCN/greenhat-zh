["```\nstatic int\nfoo_attach(device_t dev)\n{\n        struct foo_softc *sc = device_get_softc(dev);\n        int error;\n\n        bzero(sc, sizeof(*sc));\n\n        if (bus_dma_tag_create(bus_get_dma_tag(dev),  /* parent       */\n                               1,                       /* alignment    */\n                               0,                       /* boundary     */\n                               BUS_SPACE_MAXADDR,       /* lowaddr      */\n                               BUS_SPACE_MAXADDR,       /* highaddr     */\n                               NULL,                    /* filter       */\n                               NULL,                    /* filterarg    */\n                               BUS_SPACE_MAXSIZE_32BIT, /* maxsize      */\n                               BUS_SPACE_UNRESTRICTED,  /* nsegments    */\n                               BUS_SPACE_MAXSIZE_32BIT, /* maxsegsize   */\n                               0,                       /* flags        */\n                               NULL,                    /* lockfunc     */\n                               NULL,                    /* lockfuncarg  */\n                             &sc->foo_parent_dma_tag)) {\n                device_printf(dev, \"Cannot allocate parent DMA tag!\\n\");\n                return (ENOMEM);\n        }\n\n        if (bus_dma_tag_create(sc->foo_parent_dma_tag,/* parent       */\n                               1,                       /* alignment    */\n                               0,                       /* boundary     */\n                               BUS_SPACE_MAXADDR,       /* lowaddr      */\n                               BUS_SPACE_MAXADDR,       /* highaddr     */\n                               NULL,                    /* filter       */\n                               NULL,                    /* filterarg    */\n                               MAX_BAZ_SIZE,            /* maxsize      */\n                               MAX_BAZ_SCATTER,         /* nsegments    */\n                               BUS_SPACE_MAXSIZE_32BIT, /* maxsegsize   */\n                               0,                       /* flags        */\n                               NULL,                    /* lockfunc     */\n                               NULL,                    /* lockfuncarg  */\n                             &sc->foo_baz_dma_tag)) {\n                device_printf(dev, \"Cannot allocate baz DMA tag!\\n\");\n                return (ENOMEM);\n        }\n\n        if (bus_dmamap_create(sc->foo_baz_dma_tag,      /* DMA tag      */\n                              0,                        /* flags        */\n                              &sc->foo_baz_dma_map)) {\n                device_printf(dev, \"Cannot allocate baz DMA map!\\n\");\n                return (ENOMEM);\n        }\n\n        bzero(sc->foo_baz_buf, BAZ_BUF_SIZE);\n\n        error = bus_dmamap_load(sc->foo_baz_dma_tag,  /* DMA tag      */\n                              sc->foo_baz_dma_map,    /* DMA map      */\n                              sc->foo_baz_buf,        /* buffer       */\n                                BAZ_BUF_SIZE,           /* buffersize   */\n                              foo_callback,           /* callback     */\n                                &sc->foo_baz_busaddr,   /* callbackarg  */\n                                BUS_DMA_NOWAIT);        /* flags        */\n        if (error || sc->foo_baz_busaddr == 0) {\n                device_printf(dev, \"Cannot map baz DMA memory!\\n\");\n                return (ENOMEM);\n        }\n\n...\n}\n```", "```\nstatic void\n foo_callback(void *arg, bus_dma_segment_t *segs, int nseg, int error)\n{\n        if (error)\n               return;\n\n        *(bus_addr_t *)arg = segs[0].ds_addr;\n}\n```", "```\nbus_write_4(sc->foo_io_resource, FOO_BAZ, sc->foo_baz_busaddr);\n```", "```\nstatic int\nfoo_detach(device_t dev)\n{\n        struct foo_softc *sc = device_get_softc(dev);\n\n        if (sc->foo_baz_busaddr != 0)\n                bus_dmamap_unload(sc->foo_baz_dma_tag, sc->foo_baz_dma_map);\n\n        if (sc->foo_baz_dma_map != NULL)\n                bus_dmamap_destroy(sc->foo_baz_dma_tag, sc->foo_baz_dma_map);\n\n        if (sc->foo_baz_dma_tag != NULL)\n                bus_dma_tag_destroy(sc->foo_baz_dma_tag);\n\n        if (sc->foo_parent_dma_tag != NULL)\n                bus_dma_tag_destroy(sc->foo_parent_dma_tag);\n\n...\n}\n```", "```\n#include <machine/bus.h>\n\nint\nbus_dma_tag_create(bus_dma_tag_t parent, bus_size_t alignment,\n    bus_size_t boundary, bus_addr_t lowaddr, bus_addr_t highaddr,\n    bus_dma_filter_t *filtfunc, void *filtfuncarg, bus_size_t maxsize,\n    int nsegments, bus_size_t maxsegsz, int flags,\n    bus_dma_lock_t *lockfunc, void *lockfuncarg, bus_dma_tag_t *dmat);\n```", "```\nint filtfunc(void *filtfuncarg, bus_addr_t addr)\n```", "```\nvoid lockfunc(void *lockfuncarg, bus_dma_lock_op_t op)\n```", "```\n#include <machine/bus.h>\n\nint\nbus_dma_tag_destroy(bus_dma_tag_t dmat);\n```", "```\n#include <machine/bus.h>\n\nint\nbus_dmamap_create(bus_dma_tag_t dmat, int flags, bus_dmamap_t *mapp);\n\nint\nbus_dmamap_destroy(bus_dma_tag_t dmat, bus_dmamap_t map);\n```", "```\ntypedef struct bus_dma_segment {\n        bus_addr_t     ds_addr;\n        bus_size_t     ds_len;\n} bus_dma_segment_t;\n```", "```\n#include <machine/bus.h>\n\nint\nbus_dmamap_load(bus_dma_tag_t dmat, bus_dmamap_t map, void *buf,\n    bus_size_t buflen, bus_dmamap_callback_t *callback,\n    void *callbackarg, int flags);\n```", "```\nvoid callback(void *callbackarg, bus_dma_segment_t *segs, int\n nseg,              int error)\n```", "```\nstatic void\nfoo_callback(void *callbackarg, bus_dma_segment_t *segs, int nseg, int error)\n{\n        struct foo_softc *sc = callbackarg;\n        int i;\n\n        if (error)\n                return;\n\n        sc->sg_num = nseg;\n      for (i = 0; i < nseg; i++)\n                sc->sg_addr[i] = segs[i].ds_addr;\n}\n```", "```\n#include <machine/bus.h>\n\nint\nbus_dmamap_load_mbuf(bus_dma_tag_t dmat, bus_dmamap_t map,\n    struct mbuf *mbuf, bus_dmamap_callback2_t *callback2,\n    void *callbackarg, int flags);\n```", "```\nvoid callback2(void *callbackarg, bus_dma_segment_t *segs, int nseg,\n               bus_size_t mapsize, int error)\n```", "```\n#include <machine/bus.h>\n\nint\nbus_dmamap_load_mbuf_sg(bus_dma_tag_t dmat, bus_dmamap_t map,\n    struct mbuf *mbuf, bus_dma_segment_t *segs, int *nseg, int flags);\n```", "```\n#include <machine/bus.h>\n\nint\nbus_dmamap_load_uio(bus_dma_tag_t dmat, bus_dmamap_t map,\n    struct uio *uio, bus_dmamap_callback2_t *callback2,\n    void *callbackarg, int flags);\n```", "```\n#include <machine/bus.h>\n\nvoid\nbus_dmamap_unload(bus_dma_tag_t dmat, bus_dmamap_t map);\n```", "```\n#include <machine/bus.h>\n\nint\nbus_dmamem_alloc(bus_dma_tag_t dmat, void **vaddr, int flags,\n    bus_dmamap_t *mapp);\n\nvoid\nbus_dmamem_free(bus_dma_tag_t dmat, void *vaddr, bus_dmamap_t map);\n```", "```\nstatic int\nfoo_attach(device_t dev)\n{\n        struct foo_softc *sc = device_get_softc(dev);\n        int size = BAZ_SIZE;\n        int error;\n\n        bzero(sc, sizeof(*sc));\n\n        if (bus_dma_tag_create(bus_get_dma_tag(dev),    /* parent       */\n                               1,                       /* alignment    */\n                               0,                       /* boundary     */\n                               BUS_SPACE_MAXADDR,       /* lowaddr      */\n                               BUS_SPACE_MAXADDR,       /* highaddr     */\n                               NULL,                    /* filter       */\n                               NULL,                    /* filterarg    */\n                               BUS_SPACE_MAXSIZE_32BIT, /* maxsize      */\n                               BUS_SPACE_UNRESTRICTED,  /* nsegments    */\n                               BUS_SPACE_MAXSIZE_32BIT, /* maxsegsize   */\n                               0,                       /* flags        */\n                               NULL,                    /* lockfunc     */\n                               NULL,                    /* lockfuncarg  */\n                               &sc->foo_parent_dma_tag)) {\n                device_printf(dev, \"Cannot allocate parent DMA tag!\\n\");\n                return (ENOMEM);\n        }\n\n        if (bus_dma_tag_create(sc->foo_parent_dma_tag,  /* parent       */\n                               64,                      /* alignment    */\n                               0,                       /* boundary     */\n                               BUS_SPACE_MAXADDR_32BIT, /* lowaddr      */\n                               BUS_SPACE_MAXADDR,       /* highaddr     */\n                               NULL,                    /* filter       */\n                               NULL,                    /* filterarg    */\n                             size,                    /* maxsize      */\n                             1,                       /* nsegments    */\n                             size,                    /* maxsegsize   */\n                               0,                       /* flags        */\n                               NULL,                    /* lockfunc     */\n                               NULL,                    /* lockfuncarg  */\n                               &sc->foo_baz_dma_tag)) {\n                device_printf(dev, \"Cannot allocate baz DMA tag!\\n\");\n                return (ENOMEM);\n        }\n\n        if (bus_dmamem_alloc(sc->foo_baz_dma_tag,       /* DMA tag      */\n                           (void **)&sc->foo_baz_buf,   /* vaddr        */\n                             BUS_DMA_NOWAIT,              /* flags        */\n                           &sc->foo_baz_dma_map)) {\n                device_printf(dev, \"Cannot allocate baz DMA memory!\\n\");\n                return (ENOMEM);\n        }\n\n        bzero(sc->foo_baz_buf, size);\n\n        error = bus_dmamap_load(sc->foo_baz_dma_tag,  /* DMA tag      */\n                              sc->foo_baz_dma_map,    /* DMA map      */\n                              sc->foo_baz_buf,        /* buffer       */\n                                size,                   /* buffersize   */\n                              foo_callback,           /* callback     */\n                                &sc->foo_baz_busaddr,   /* callbackarg  */\n                                BUS_DMA_NOWAIT);        /* flags        */\n        if (error || sc->foo_baz_busaddr == 0) {\n                device_printf(dev, \"Cannot map baz DMA memory!\\n\");\n                return (ENOMEM);\n        }\n\n...\n}\n```", "```\n#include <machine/bus.h>\n\nvoid\nbus_dmamap_sync(bus_dma_tag_t dmat, bus_dmamap_t map, bus_dmasync_op_t op);\n```"]