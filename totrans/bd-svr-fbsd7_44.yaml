- en: Chapter 18\. OPENSSL 0.9.8G
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[HTTP://WWW.OPENSSL.ORG](HTTP://WWW.OPENSSL.ORG)'
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 18.1\. SUMMARY
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: OpenSSL is an open source toolkit and cryptographic library that implements
    the SSL (Secure Sockets Layer) and TLS (Transport Layer Security) protocols. OpenSSL
    is an independent project managed by various volunteers from around the world.
    In short, OpenSSL provides cryptography tools for securing network connections.
  prefs: []
  type: TYPE_NORMAL
- en: 'A common SSL implementation is to secure web pages with HTTPS (HyperText Transfer
    Protocol secured with encryption). An HTTPS handshake consists of the following
    steps:'
  prefs: []
  type: TYPE_NORMAL
- en: An HTTP client (web browser) sends a web server an HTTPS request.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The server responds by sending the client its SSL Certificate containing its
    public key, domain name, and issuing certificate authority.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The client sends a challenge message encrypted using the server's public SSL
    key.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The server decrypts this message with its private SSL key.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The server finally sends the decrypted message back to the client.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If the client receives the correct message, the two parties can begin to exchange
    information securely, assuming the issuing certificate authority is trusted by
    the client.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: OpenSSL provides the tools needed to create certificate signing requests, private
    server keys, and self-signed certificates. When coupled with a recognized certificate
    authority, trusted server certificates can be produced for use with TCP protocols
    like HTTP, SMTP, IMAP, and so on.
  prefs: []
  type: TYPE_NORMAL
- en: OpenSSL is based on the SSLeay library originally developed by Eric A. Young
    and Tim J. Hudson. SSLeay was an open source implementation of Netscape's Secure
    Socket Layer protocol, which was used in the Netscape Secure Server and Navigator
    browser in the mid-1990s.
  prefs: []
  type: TYPE_NORMAL
- en: 18.2\. RESOURCES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: OpenSSL Manual Pages
  prefs: []
  type: TYPE_NORMAL
- en: '[http://www.openssl.org/docs](http://www.openssl.org/docs)'
  prefs: []
  type: TYPE_NORMAL
- en: SSL Certificate Frequently Asked Questions
  prefs: []
  type: TYPE_NORMAL
- en: '[http://www.verisign.com/ssl/ssl-information-center/faq/ssl-basics.html](http://www.verisign.com/ssl/ssl-information-center/faq/ssl-basics.html)'
  prefs: []
  type: TYPE_NORMAL
- en: RFC 2246 - The TLS Protocol
  prefs: []
  type: TYPE_NORMAL
- en: '[http://tools.ietf.org/html/rfc2246](http://tools.ietf.org/html/rfc2246)'
  prefs: []
  type: TYPE_NORMAL
- en: 18.3\. REQUIRED
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) FreeBSD 7.0-RELEASE
    (see "[FreeBSD 7.0](freebsd_7.0_split_000.html#freebsd_7.0)")'
  prefs: []
  type: TYPE_IMG
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Updated ports
    collection (see "[FreeBSD Ports Collection](freebsd_ports_collection.html#freebsd_ports_collection)")'
  prefs: []
  type: TYPE_IMG
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Internet
    connection'
  prefs: []
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Registered
    domain name'
  prefs: []
  type: TYPE_NORMAL
- en: 18.4\. OPTIONAL
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Trusted SSL
    certificate authority (CA) such as GeoTrust, Thawte, Verisign, and so on, if you
    wish to create industry-trusted SSL Certificates'
  prefs: []
  type: TYPE_NORMAL
- en: 18.5\. PREPARATION
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Become the superuser. This guide assumes that the default search path for root
    (the superuser) has been changed as outlined in "[FreeBSD 7.0](freebsd_7.0_split_000.html#freebsd_7.0)".
    If you didn't make this modification, specify the full path when executing OpenSSL
    commands (/usr/local/bin/openssl ).
  prefs: []
  type: TYPE_NORMAL
- en: 18.6\. INSTALL
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: OpenSSL 0.9.8e is part of the standard FreeBSD 7.0 distribution. In this guide,
    we will install an updated version of OpenSSL from the ports collection.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: '***Note:*** The second and third commands above prevent the compilation of
    the license-restricted IDEA encryption algorithm. This is important for the proper
    functioning of other third-party applications.'
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: 18.7\. CONFIGURE
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Once the installation process is complete, it's time to configure OpenSSL for
    use on your system.
  prefs: []
  type: TYPE_NORMAL
- en: The line `"WITH_OPENSSL_PORT = YES"` needs to be added to the make.conf file
    in /etc. This will ensure that ports built in the future are linked to the newer
    version of OpenSSL. The following commands will add the appropriate line to make.conf.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Rename the old openssl.cnf file to make it harder to inadvertently use the
    old version of OpenSSL when creating certificates. Then copy the sample OpenSSL
    configuration file to a working copy:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'You can modify openssl.cnf to fit your needs, but the defaults are usually
    sufficient. To verify that the new version is functioning, use the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: A version later than 0.9.8e signifies that the new version is installed correctly.
    If the version information still indicates 0.9.8e, you probably haven't modified
    your default path. This is acceptable as long as you remember to specify the full
    path to the new version of OpenSSL when using the command-line tool (/usr/local/bin/openssl).
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 18.8\. SSL CERTIFICATES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: In this section, SSL Certificates will be created using the CA.pl script (a
    Perl script) installed by the OpenSSL port.
  prefs: []
  type: TYPE_NORMAL
- en: If you intend to have an official certificate authority sign your SSL Certificate,
    proceed to "Generate a Certificate Request for CA Submission." If you want to
    create a self-signed SSL Certificate, skip to "[Create a Self-Signed SSL Certificate](#create_a_self-signed_ssl_certificate)".
  prefs: []
  type: TYPE_NORMAL
- en: 18.8.1\. Generate a Certificate Request for CA Submission
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: You can have an official certificate authority sign your SSL Certificate by
    sending a request. Most certificate authorities charge a fee for this service.
    See "[Notes](notes.html#notes)" for more information about the certificate signing
    process.
  prefs: []
  type: TYPE_NORMAL
- en: 'Certificate authorities will need a certificate request file in order to produce
    a valid SSL Certificate for your server. We will use the CA.pl script included
    with OpenSSL to create a certificate request. Let''s use the /usr/local/openssl/certs
    directory as your working directory. The command below will copy the script to
    the working directory:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Run the script to create the certificate request using the following commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: You will be asked to enter a PEM passphrase. Type one of your choosing. Be sure
    to remember this passphrase because you will need it later. Fill in the rest of
    the fields as you would like them to be shown when the public views your certificate.
    Make sure you enter your hostname in the Common Name prompt or the server certificate
    will not be valid. (If you were creating an SSL Certificate for a server with
    the hostname [host.example.com](http://host.example.com), you would enter the
    Common Name [host.example.com](http://host.example.com).)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** You may specify wildcard values in the Common Name field. For example,
    you could enter [*.example.com](http://*.example.com) as the common name to create
    an SSL Certificate that would cover any subdomain of [example.com](http://example.com)
    like [www.example.com](http://www.example.com), [mail.example.com](http://mail.example.com),
    and so on. Be aware that if you do specify a wildcard like [*.example.com](http://*.example.com),
    it won''t be valid if you''re trying to create a certificate for the root domain,
    [example.com](http://example.com).'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: After entering an email address, you will be prompted for a challenge password.
    Just press [enter] twice; the challenge password and company name are optional.
    You will be returned to the command prompt.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Running the CA.pl script gives you a newly created file named newkey.pem, which
    contains your encrypted private server key. To make identification easier, we''ll
    copy this file to [host.example.com-encrypted-key.pem](http://host.example.com-encrypted-key.pem).
    Use the following commands to copy this file (replace [host.example.com](http://host.example.com)
    with your actual Common Name):'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'You will also have a newly created file named newreq.pem that contains your
    certificate request. You can submit this file to a certificate authority for signing.
    For clarity, we''ll copy this file to [host.example.com-req.pem](http://host.example.com-req.pem).
    Use the following command to copy this file (replace [host.example.com](http://host.example.com)
    with your actual Common Name):'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'The [host.example.com-encrypted-key.pem](http://host.example.com-encrypted-key.pem)
    file is encrypted with the password you entered earlier. It is important for you
    to remember this password. You will need to enter it when an SSL application uses
    it. If this file is going to be used on an unattended server, it may be a good
    idea to decrypt the file so that daemons are able to load it without user intervention.
    To remove the encryption and make the unencrypted file readable only to root,
    use the following commands (replace [host.example.com](http://host.example.com)
    with your server''s hostname):'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: It is important that the root user be the only user to have access to this file.
    Lack of strict permissions as set above can jeopardize the security of your server
    certificate.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: After the certificate authority signs your certificate request, copy it to the
    /usr/local/openssl/certs directory and name it [server.example.com-cert.pem](http://server.example.com-cert.pem)
    or whatever you see fit. Some server applications (Apache HTTP Server, Postfix,
    etc.) need your certificate authority's root certificate file as well. Most root
    certificate files are downloadable from the certificate authority's website. Save
    this file in /usr/local/openssl/certs as [example.com](http://example.com)-CAcert.pem,
    or using any name you prefer.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 18.8.2\. Create a Self-Signed SSL Certificate
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: There are times when an SSL Certificate signed by an official certificate authority
    is not practical or affordable. In these cases, you may want to create and sign
    your own SSL Certificates by creating your own certificate authority. The easiest
    way to accomplish this is by using the included certificate authority script (CA.pl
    ) to automate the process as much as possible. Be advised that creating your own
    certificates will cause an Untrusted Certificate dialog box to appear on client
    applications (web browsers, email clients, etc.). You can install your server's
    certificate file on client systems to avoid this warning.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s use the /usr/local/openssl/certs directory as your working directory.
    We''ll also extend the default certificate signing length of 365 days to 1,095
    days (3 years). The commands below will copy the script to the working directory
    and set OpenSSL to create certificates that are good for 3 years:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Run the script to create the certificate authority like this:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: The first prompt will ask you to enter a CA certificate filename. Since you
    are creating a new one, just press [enter].
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The second prompt will ask you for a PEM passphrase. Type one of your choosing.
    Be sure to remember this passphrase because you will need it later. Fill in the
    rest of the fields as you would like them to be shown when the public views your
    certificate. The Common Name field can be your company name or something descriptive;
    it is effectively the name of your certificate. After entering an email address,
    you will be prompted for a challenge password. Just press [enter] twice; the challenge
    password and company name are optional. Lastly, you will be prompted to enter
    a passphrase for ./demoCA/private/cakey.pem. Enter the PEM passphrase you chose
    at the beginning of this step.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Generate a certificate request with the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: You will be asked for a passphrase; use the same one you used earlier for simplicity.
    Enter all of the same information you supplied earlier. Make sure you enter your
    hostname in the Common Name prompt or the server certificate will not be valid.
    (If you were creating an SSL Certificate for the website [https://host.example.com](https://host.example.com),
    you would enter the Common Name host [.example.com](http://.example.com).)
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '***Note:*** You may specify wildcard values in the Common Name field as well.
    For example, you could enter [*.example.com](http://*.example.com) as the common
    name to create an SSL Certificate that would cover any subdomain of [example.com](http://example.com)
    like [www.example.com](http://www.example.com), [server.example.com](http://server.example.com),
    and so on. Be aware that if you do specify a wildcard like [*.example.com](http://*.example.com),
    it won''t be valid if you''re trying to create a certificate for the root domain
    [example.com](http://example.com).'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '* * *'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: After entering an email address, you will be prompted for a challenge password.
    Just press [enter] twice; the challenge password and company name are optional.
    You will be returned to the command prompt. Don't change the filename of the newly
    created newreq.pem file; the script will be looking for it later.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Create the signed certificate from the request and certificate authority files
    you just created. Use the following command to begin the certificate signing process:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Enter the password you chose earlier. Answer Yes at the next two prompts to
    create a signed SSL Certificate. The signed SSL Certificate is in the current
    working directory and named newcert.pem. The private key file is also in the current
    directory and named newkey.pem. The certificate authority and private key certificates
    reside in the demoCA directory and are named cacert.pem and cakey.pem respectively.
    To make all of these files easily identifiable we''ll make copies of them using
    the following convention: commonName-filetype.pem. The following commands copy
    all certificates into the /usr/local/openssl/certs directory (replace [host.example.com](http://host.example.com)
    with your server''s hostname).'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: The last two lines don't include the server name host because the certificate
    authority files are not specific to any one system; think of a certificate authority
    as a parent entity.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjRnMA--.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: 'The [host.example.com](http://host.example.com)-encrypted-key.pem file is encrypted
    with the password you entered earlier. It is important for you to remember this
    password. You will need to enter it when an SSL application uses it. If this file
    is going to be used on an unattended server, it may be a good idea to decrypt
    this file so that daemons are able to load it without user intervention. To remove
    the encryption and make the unencrypted file readable only to root, use the following
    commands, replacing [host.example.com](http://host.example.com) with your domain
    name:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: It is important that the root user be the only user to have access to this file
    (the commands above accomplish this). Lack of strict permissions as set above
    can risk the security of your server certificate.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'It is important to export the CA certificate or root certificate ([example.com](http://example.com)-CAcert.pem)
    that was created in step 2 (page 131) so it can be installed on systems that will
    utilize your SSL Certificate. This is necessary to eliminate the appearance of
    Untrusted Root SSL Certificate Warning messages. These messages appear to warn
    the end user that there is a potential problem with the SSL Certificate. It is
    more difficult to detect an actual hijacked SSL session if this unnecessary warning
    isn''t eliminated. Most client systems (Windows XP and Mac OS X) recognize SSL
    Certificate files encoded in DER (Distinguished Encoding Rules) binary format.
    To convert your PEM (Privacy Enhanced Mail) text based certificate to the DER
    format, type the following command:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'You can send your DER encoded certificate via email with this command:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Substitute your filenames appropriately (the second instance of [example.com](http://example.com)-CAcert.cer
    can be replaced with a filename you would like the recipient to see) and replace
    `*Subject*` with an appropriate email subject line. [user@example.com](mailto:user@example.com.html)
    can be any valid email address.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 18.9\. CONFIG FILES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: /usr/local/openssl/openssl.cnf
  prefs: []
  type: TYPE_NORMAL
- en: Contains defaults for the OpenSSL command-line tool
  prefs: []
  type: TYPE_NORMAL
- en: 18.10\. NOTES
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Certificate authorities that sign SSL Certificates usually charge a variable
    fee. Be advised that if you self-sign your SSL Certificate, client programs will
    display a dialog to users explaining that the certificate is not in the trusted
    root database. This can confuse users who aren't familiar with the technology.
    If a small number of known users will be accessing your server with SSL, you can
    give each user a copy of your server's root certificate to install into their
    client application to eliminate this warning message (see step 7 on page 133).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: CAcert is a certificate authority that issues free SSL Certificates. If you
    are new to SSL Certificates, the site is a good place to learn about the SSL Certificate
    signing process. You can create a certificate signing request as outlined in this
    guide and have it signed by CAcert. Certificates signed by CAcert have limited
    support; most web browsers do not include its root certificate in their database
    of trusted CAs. CAcert's root certificate is, however, included in FreeBSD and
    several Linux distributions. Visit CAcert on the Web at [http://cacert.org](http://cacert.org).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If you are creating self-signed SSL Certificates and wish to create another
    one (e.g., if you are adding an additional server to your network), start at step
    5 on page 132\. (Remember to assign a Common Name consistent with your server's
    hostname.)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
