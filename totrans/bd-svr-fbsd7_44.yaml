- en: Chapter 18\. OPENSSL 0.9.8G
  id: totrans-0
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[HTTP://WWW.OPENSSL.ORG](HTTP://WWW.OPENSSL.ORG)'
  id: totrans-1
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 18.1\. SUMMARY
  id: totrans-2
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: OpenSSL is an open source toolkit and cryptographic library that implements
    the SSL (Secure Sockets Layer) and TLS (Transport Layer Security) protocols. OpenSSL
    is an independent project managed by various volunteers from around the world.
    In short, OpenSSL provides cryptography tools for securing network connections.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
- en: 'A common SSL implementation is to secure web pages with HTTPS (HyperText Transfer
    Protocol secured with encryption). An HTTPS handshake consists of the following
    steps:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
- en: An HTTP client (web browser) sends a web server an HTTPS request.
  id: totrans-5
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The server responds by sending the client its SSL Certificate containing its
    public key, domain name, and issuing certificate authority.
  id: totrans-6
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The client sends a challenge message encrypted using the server's public SSL
    key.
  id: totrans-7
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The server decrypts this message with its private SSL key.
  id: totrans-8
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The server finally sends the decrypted message back to the client.
  id: totrans-9
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If the client receives the correct message, the two parties can begin to exchange
    information securely, assuming the issuing certificate authority is trusted by
    the client.
  id: totrans-10
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: OpenSSL provides the tools needed to create certificate signing requests, private
    server keys, and self-signed certificates. When coupled with a recognized certificate
    authority, trusted server certificates can be produced for use with TCP protocols
    like HTTP, SMTP, IMAP, and so on.
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
- en: OpenSSL is based on the SSLeay library originally developed by Eric A. Young
    and Tim J. Hudson. SSLeay was an open source implementation of Netscape's Secure
    Socket Layer protocol, which was used in the Netscape Secure Server and Navigator
    browser in the mid-1990s.
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: 18.2\. RESOURCES
  id: totrans-13
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: OpenSSL Manual Pages
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
- en: '[http://www.openssl.org/docs](http://www.openssl.org/docs)'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
- en: SSL Certificate Frequently Asked Questions
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
- en: '[http://www.verisign.com/ssl/ssl-information-center/faq/ssl-basics.html](http://www.verisign.com/ssl/ssl-information-center/faq/ssl-basics.html)'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: RFC 2246 - The TLS Protocol
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
- en: '[http://tools.ietf.org/html/rfc2246](http://tools.ietf.org/html/rfc2246)'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: 18.3\. REQUIRED
  id: totrans-20
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) FreeBSD 7.0-RELEASE
    (see "[FreeBSD 7.0](freebsd_7.0_split_000.html#freebsd_7.0)")'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Updated ports
    collection (see "[FreeBSD Ports Collection](freebsd_ports_collection.html#freebsd_ports_collection)")'
  id: totrans-22
  prefs: []
  type: TYPE_IMG
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Internet
    connection'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Registered
    domain name'
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
- en: 18.4\. OPTIONAL
  id: totrans-25
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjNnMA--.jpg) Trusted SSL
    certificate authority (CA) such as GeoTrust, Thawte, Verisign, and so on, if you
    wish to create industry-trusted SSL Certificates'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
- en: 18.5\. PREPARATION
  id: totrans-27
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Become the superuser. This guide assumes that the default search path for root
    (the superuser) has been changed as outlined in "[FreeBSD 7.0](freebsd_7.0_split_000.html#freebsd_7.0)".
    If you didn't make this modification, specify the full path when executing OpenSSL
    commands (/usr/local/bin/openssl ).
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 成为超级用户。本指南假设root（超级用户）的默认搜索路径已按“[FreeBSD 7.0](freebsd_7.0_split_000.html#freebsd_7.0)”中概述的方式更改。如果你没有进行此修改，在执行OpenSSL命令时指定完整路径（/usr/local/bin/openssl）。
- en: 18.6\. INSTALL
  id: totrans-29
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 18.6\. 安装
- en: OpenSSL 0.9.8e is part of the standard FreeBSD 7.0 distribution. In this guide,
    we will install an updated version of OpenSSL from the ports collection.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: OpenSSL 0.9.8e是FreeBSD 7.0标准发行版的一部分。在本指南中，我们将从ports集合中安装一个更新的OpenSSL版本。
- en: '[PRE0]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: '* * *'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: '***Note:*** The second and third commands above prevent the compilation of
    the license-restricted IDEA encryption algorithm. This is important for the proper
    functioning of other third-party applications.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '***注意：*** 上面的第二和第三条命令防止编译受版权限制的IDEA加密算法。这对于其他第三方应用程序的正确运行很重要。'
- en: '* * *'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: 18.7\. CONFIGURE
  id: totrans-35
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 18.7\. 配置
- en: Once the installation process is complete, it's time to configure OpenSSL for
    use on your system.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 安装过程完成后，是时候为你的系统配置OpenSSL了。
- en: The line `"WITH_OPENSSL_PORT = YES"` needs to be added to the make.conf file
    in /etc. This will ensure that ports built in the future are linked to the newer
    version of OpenSSL. The following commands will add the appropriate line to make.conf.
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 需要将“`WITH_OPENSSL_PORT = YES`”行添加到`/etc`中的`make.conf`文件。这将确保未来构建的ports链接到新的OpenSSL版本。以下命令将添加适当的行到`make.conf`。
- en: '[PRE1]'
  id: totrans-38
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Rename the old openssl.cnf file to make it harder to inadvertently use the
    old version of OpenSSL when creating certificates. Then copy the sample OpenSSL
    configuration file to a working copy:'
  id: totrans-39
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将旧的`openssl.cnf`文件重命名，使其更难意外使用旧的OpenSSL版本创建证书。然后将示例OpenSSL配置文件复制到工作副本：
- en: '[PRE2]'
  id: totrans-40
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'You can modify openssl.cnf to fit your needs, but the defaults are usually
    sufficient. To verify that the new version is functioning, use the following command:'
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你可以修改`openssl.cnf`以适应你的需求，但默认值通常足够。为了验证新版本是否正常工作，请使用以下命令：
- en: '[PRE3]'
  id: totrans-42
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: A version later than 0.9.8e signifies that the new version is installed correctly.
    If the version information still indicates 0.9.8e, you probably haven't modified
    your default path. This is acceptable as long as you remember to specify the full
    path to the new version of OpenSSL when using the command-line tool (/usr/local/bin/openssl).
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 新版本号晚于0.9.8e表示新版本已正确安装。如果版本信息仍然指示0.9.8e，你可能没有修改你的默认路径。只要记得在使用命令行工具（/usr/local/bin/openssl）时指定新版本OpenSSL的完整路径，这是可以接受的。
- en: 18.8\. SSL CERTIFICATES
  id: totrans-44
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 18.8\. SSL证书
- en: In this section, SSL Certificates will be created using the CA.pl script (a
    Perl script) installed by the OpenSSL port.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，将使用OpenSSL端口安装的CA.pl脚本（一个Perl脚本）创建SSL证书。
- en: If you intend to have an official certificate authority sign your SSL Certificate,
    proceed to "Generate a Certificate Request for CA Submission." If you want to
    create a self-signed SSL Certificate, skip to "[Create a Self-Signed SSL Certificate](#create_a_self-signed_ssl_certificate)".
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你打算让官方证书颁发机构签名你的SSL证书，请转到“为CA提交生成证书请求”。如果你想创建自签名SSL证书，请跳转到“[创建自签名SSL证书](#create_a_self-signed_ssl_certificate)”。
- en: 18.8.1\. Generate a Certificate Request for CA Submission
  id: totrans-47
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.8.1\. 为CA提交生成证书请求
- en: You can have an official certificate authority sign your SSL Certificate by
    sending a request. Most certificate authorities charge a fee for this service.
    See "[Notes](notes.html#notes)" for more information about the certificate signing
    process.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以通过发送请求让官方证书颁发机构签名你的SSL证书。大多数证书颁发机构为此服务收费。有关证书签名过程的更多信息，请参阅“[注意事项](notes.html#notes)”。
- en: 'Certificate authorities will need a certificate request file in order to produce
    a valid SSL Certificate for your server. We will use the CA.pl script included
    with OpenSSL to create a certificate request. Let''s use the /usr/local/openssl/certs
    directory as your working directory. The command below will copy the script to
    the working directory:'
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 证书颁发机构需要证书请求文件才能为你的服务器生成有效的SSL证书。我们将使用OpenSSL附带包含的CA.pl脚本创建证书请求。让我们使用`/usr/local/openssl/certs`目录作为你的工作目录。以下命令将脚本复制到工作目录：
- en: '[PRE4]'
  id: totrans-50
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Run the script to create the certificate request using the following commands:'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令运行脚本以创建证书请求：
- en: '[PRE5]'
  id: totrans-52
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: You will be asked to enter a PEM passphrase. Type one of your choosing. Be sure
    to remember this passphrase because you will need it later. Fill in the rest of
    the fields as you would like them to be shown when the public views your certificate.
    Make sure you enter your hostname in the Common Name prompt or the server certificate
    will not be valid. (If you were creating an SSL Certificate for a server with
    the hostname [host.example.com](http://host.example.com), you would enter the
    Common Name [host.example.com](http://host.example.com).)
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您将被要求输入一个PEM密码短语。输入您选择的密码。请确保记住这个密码短语，因为您稍后需要它。填写其余字段，使其在公众查看您的证书时显示您希望的方式。确保在通用名称提示中输入您的主机名，否则服务器证书将无效。（如果您正在为具有主机名[host.example.com](http://host.example.com)的服务器创建SSL证书，您将输入通用名称[host.example.com](http://host.example.com)。）
- en: '* * *'
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: '***Note:*** You may specify wildcard values in the Common Name field. For example,
    you could enter [*.example.com](http://*.example.com) as the common name to create
    an SSL Certificate that would cover any subdomain of [example.com](http://example.com)
    like [www.example.com](http://www.example.com), [mail.example.com](http://mail.example.com),
    and so on. Be aware that if you do specify a wildcard like [*.example.com](http://*.example.com),
    it won''t be valid if you''re trying to create a certificate for the root domain,
    [example.com](http://example.com).'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '***注意：*** 您可以在通用名称字段中指定通配符值。例如，您可以输入[*.example.com](http://*.example.com)作为通用名称，以创建一个覆盖[example.com](http://example.com)任何子域的SSL证书，如[www.example.com](http://www.example.com)、[mail.example.com](http://mail.example.com)等。请注意，如果您指定了像[*.example.com](http://*.example.com)这样的通配符，如果您尝试为根域名[example.com](http://example.com)创建证书，则它将无效。'
- en: '* * *'
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: After entering an email address, you will be prompted for a challenge password.
    Just press [enter] twice; the challenge password and company name are optional.
    You will be returned to the command prompt.
  id: totrans-57
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在输入电子邮件地址后，系统将提示您输入挑战密码。只需按两次[回车键]；挑战密码和公司名称是可选的。您将返回到命令提示符。
- en: 'Running the CA.pl script gives you a newly created file named newkey.pem, which
    contains your encrypted private server key. To make identification easier, we''ll
    copy this file to [host.example.com-encrypted-key.pem](http://host.example.com-encrypted-key.pem).
    Use the following commands to copy this file (replace [host.example.com](http://host.example.com)
    with your actual Common Name):'
  id: totrans-58
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行CA.pl脚本将为您创建一个名为newkey.pem的新文件，其中包含您的加密私钥。为了便于识别，我们将此文件复制到[host.example.com-encrypted-key.pem](http://host.example.com-encrypted-key.pem)。使用以下命令复制此文件（将[host.example.com](http://host.example.com)替换为您的实际通用名称）：
- en: '[PRE6]'
  id: totrans-59
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'You will also have a newly created file named newreq.pem that contains your
    certificate request. You can submit this file to a certificate authority for signing.
    For clarity, we''ll copy this file to [host.example.com-req.pem](http://host.example.com-req.pem).
    Use the following command to copy this file (replace [host.example.com](http://host.example.com)
    with your actual Common Name):'
  id: totrans-60
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 您还将有一个名为newreq.pem的新创建的文件，其中包含您的证书请求。您可以将此文件提交给证书颁发机构进行签名。为了清晰起见，我们将此文件复制到[host.example.com-req.pem](http://host.example.com-req.pem)。使用以下命令复制此文件（将[host.example.com](http://host.example.com)替换为您的实际通用名称）：
- en: '[PRE7]'
  id: totrans-61
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The [host.example.com-encrypted-key.pem](http://host.example.com-encrypted-key.pem)
    file is encrypted with the password you entered earlier. It is important for you
    to remember this password. You will need to enter it when an SSL application uses
    it. If this file is going to be used on an unattended server, it may be a good
    idea to decrypt the file so that daemons are able to load it without user intervention.
    To remove the encryption and make the unencrypted file readable only to root,
    use the following commands (replace [host.example.com](http://host.example.com)
    with your server''s hostname):'
  id: totrans-62
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '[host.example.com-encrypted-key.pem](http://host.example.com-encrypted-key.pem)文件使用您之前输入的密码加密。您记住此密码非常重要。当SSL应用程序使用它时，您需要输入它。如果此文件将用于无人值守的服务器，那么解密文件以便守护进程能够在用户干预的情况下加载它可能是一个好主意。要移除加密并使未加密的文件仅对root可读，请使用以下命令（将[host.example.com](http://host.example.com)替换为您的服务器的主机名）：'
- en: '[PRE8]'
  id: totrans-63
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: It is important that the root user be the only user to have access to this file.
    Lack of strict permissions as set above can jeopardize the security of your server
    certificate.
  id: totrans-64
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 重要的是，root用户是唯一可以访问此文件的用户。如上所述权限设置不严格可能会危及您的服务器证书的安全性。
- en: After the certificate authority signs your certificate request, copy it to the
    /usr/local/openssl/certs directory and name it [server.example.com-cert.pem](http://server.example.com-cert.pem)
    or whatever you see fit. Some server applications (Apache HTTP Server, Postfix,
    etc.) need your certificate authority's root certificate file as well. Most root
    certificate files are downloadable from the certificate authority's website. Save
    this file in /usr/local/openssl/certs as [example.com](http://example.com)-CAcert.pem,
    or using any name you prefer.
  id: totrans-65
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在证书颁发机构签署您的证书请求后，将其复制到/usr/local/openssl/certs目录，并命名为[server.example.com-cert.pem](http://server.example.com-cert.pem)或您认为合适的任何名称。一些服务器应用程序（Apache
    HTTP服务器、Postfix等）还需要您的证书颁发机构的根证书文件。大多数根证书文件都可以从证书颁发机构的网站上下载。将此文件保存到/usr/local/openssl/certs目录中，命名为[example.com](http://example.com)-CAcert.pem，或使用您喜欢的任何名称。
- en: 18.8.2\. Create a Self-Signed SSL Certificate
  id: totrans-66
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 18.8.2\. 创建自签名SSL证书
- en: There are times when an SSL Certificate signed by an official certificate authority
    is not practical or affordable. In these cases, you may want to create and sign
    your own SSL Certificates by creating your own certificate authority. The easiest
    way to accomplish this is by using the included certificate authority script (CA.pl
    ) to automate the process as much as possible. Be advised that creating your own
    certificates will cause an Untrusted Certificate dialog box to appear on client
    applications (web browsers, email clients, etc.). You can install your server's
    certificate file on client systems to avoid this warning.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 有时候，由官方证书颁发机构签发的SSL证书并不实用或负担得起。在这些情况下，您可能想通过创建自己的证书颁发机构来创建和签署自己的SSL证书。实现这一目标的最简单方法是使用包含的证书颁发机构脚本（CA.pl）尽可能自动化这个过程。请注意，创建自己的证书将在客户端应用程序（网页浏览器、电子邮件客户端等）上导致出现不受信任的证书对话框。您可以将服务器的证书文件安装到客户端系统上以避免此警告。
- en: 'Let''s use the /usr/local/openssl/certs directory as your working directory.
    We''ll also extend the default certificate signing length of 365 days to 1,095
    days (3 years). The commands below will copy the script to the working directory
    and set OpenSSL to create certificates that are good for 3 years:'
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 让我们使用/usr/local/openssl/certs目录作为您的工作目录。我们还将默认证书签发长度从365天扩展到1,095天（3年）。下面的命令将脚本复制到工作目录，并将OpenSSL设置为创建有效期为3年的证书：
- en: '[PRE9]'
  id: totrans-69
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Run the script to create the certificate authority like this:'
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 按照以下方式运行脚本以创建证书颁发机构：
- en: '[PRE10]'
  id: totrans-71
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: The first prompt will ask you to enter a CA certificate filename. Since you
    are creating a new one, just press [enter].
  id: totrans-72
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第一个提示将要求您输入CA证书文件名。由于您正在创建一个新的，只需按[enter]键。
- en: The second prompt will ask you for a PEM passphrase. Type one of your choosing.
    Be sure to remember this passphrase because you will need it later. Fill in the
    rest of the fields as you would like them to be shown when the public views your
    certificate. The Common Name field can be your company name or something descriptive;
    it is effectively the name of your certificate. After entering an email address,
    you will be prompted for a challenge password. Just press [enter] twice; the challenge
    password and company name are optional. Lastly, you will be prompted to enter
    a passphrase for ./demoCA/private/cakey.pem. Enter the PEM passphrase you chose
    at the beginning of this step.
  id: totrans-73
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 第二个提示将要求您输入PEM密码短语。输入您选择的密码。请务必记住这个密码短语，因为您稍后需要它。填写其余字段，使其在公众查看您的证书时显示您希望的方式。通用名称字段可以是您的公司名称或描述性的内容；它实际上是您的证书名称。在输入电子邮件地址后，您将被提示输入挑战密码。只需按[enter]键两次；挑战密码和公司名称是可选的。最后，您将被提示输入./demoCA/private/cakey.pem的密码短语。输入您在本步骤开始时选择的PEM密码短语。
- en: 'Generate a certificate request with the following command:'
  id: totrans-74
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用以下命令生成证书请求：
- en: '[PRE11]'
  id: totrans-75
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: You will be asked for a passphrase; use the same one you used earlier for simplicity.
    Enter all of the same information you supplied earlier. Make sure you enter your
    hostname in the Common Name prompt or the server certificate will not be valid.
    (If you were creating an SSL Certificate for the website [https://host.example.com](https://host.example.com),
    you would enter the Common Name host [.example.com](http://.example.com).)
  id: totrans-76
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您将被要求输入一个密码短语；为了简单起见，请使用您之前使用的相同密码短语。输入您之前提供的信息。确保您在“通用名称”提示中输入您的主机名，否则服务器证书将无效。（如果您正在为网站[https://host.example.com](https://host.example.com)创建SSL证书，您将输入通用名称host
    [.example.com](http://.example.com)。）
- en: '* * *'
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: '***Note:*** You may specify wildcard values in the Common Name field as well.
    For example, you could enter [*.example.com](http://*.example.com) as the common
    name to create an SSL Certificate that would cover any subdomain of [example.com](http://example.com)
    like [www.example.com](http://www.example.com), [server.example.com](http://server.example.com),
    and so on. Be aware that if you do specify a wildcard like [*.example.com](http://*.example.com),
    it won''t be valid if you''re trying to create a certificate for the root domain
    [example.com](http://example.com).'
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '***注意：*** 您也可以在通用名称字段中指定通配符值。例如，您可以将[*.example.com](http://*.example.com)作为通用名称输入，以创建一个覆盖[example.com](http://example.com)任何子域的SSL证书，如[www.example.com](http://www.example.com)、[server.example.com](http://server.example.com)等。请注意，如果您指定了像[*.example.com](http://*.example.com)这样的通配符，如果您试图为根域名[example.com](http://example.com)创建证书，它将不会有效。'
- en: '* * *'
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '* * *'
- en: After entering an email address, you will be prompted for a challenge password.
    Just press [enter] twice; the challenge password and company name are optional.
    You will be returned to the command prompt. Don't change the filename of the newly
    created newreq.pem file; the script will be looking for it later.
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在输入电子邮件地址后，系统将提示您输入挑战密码。只需按两次[回车键]；挑战密码和公司名称是可选的。您将返回到命令提示符。不要更改新创建的newreq.pem文件的文件名；脚本稍后会查找它。
- en: 'Create the signed certificate from the request and certificate authority files
    you just created. Use the following command to begin the certificate signing process:'
  id: totrans-81
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从您刚刚创建的请求和证书授权文件创建已签名的证书。使用以下命令开始证书签名过程：
- en: '[PRE12]'
  id: totrans-82
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Enter the password you chose earlier. Answer Yes at the next two prompts to
    create a signed SSL Certificate. The signed SSL Certificate is in the current
    working directory and named newcert.pem. The private key file is also in the current
    directory and named newkey.pem. The certificate authority and private key certificates
    reside in the demoCA directory and are named cacert.pem and cakey.pem respectively.
    To make all of these files easily identifiable we''ll make copies of them using
    the following convention: commonName-filetype.pem. The following commands copy
    all certificates into the /usr/local/openssl/certs directory (replace [host.example.com](http://host.example.com)
    with your server''s hostname).'
  id: totrans-83
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 输入您之前选择的密码。在接下来的两个提示中回答“是”，以创建已签名的SSL证书。已签名的SSL证书位于当前工作目录，命名为newcert.pem。私钥文件也位于当前目录，命名为newkey.pem。证书授权机构和私钥证书位于demoCA目录中，分别命名为cacert.pem和cakey.pem。为了使所有这些文件易于识别，我们将使用以下约定：commonName-filetype.pem。以下命令将所有证书复制到/usr/local/openssl/certs目录（将[host.example.com](http://host.example.com)替换为您的服务器主机名）。
- en: '[PRE13]'
  id: totrans-84
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The last two lines don't include the server name host because the certificate
    authority files are not specific to any one system; think of a certificate authority
    as a parent entity.
  id: totrans-85
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 最后两行不包括服务器名称主机，因为证书授权文件并不针对任何特定的系统；将证书授权机构视为一个父实体。
- en: '![](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjRnMA--.jpg)'
  id: totrans-86
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![图片](OWlnMmQvN2ZtYXI4dGMvaWVnL3MxOTU5MzE0NTdwc3BuVTAvLjRnMA--.jpg)'
- en: 'The [host.example.com](http://host.example.com)-encrypted-key.pem file is encrypted
    with the password you entered earlier. It is important for you to remember this
    password. You will need to enter it when an SSL application uses it. If this file
    is going to be used on an unattended server, it may be a good idea to decrypt
    this file so that daemons are able to load it without user intervention. To remove
    the encryption and make the unencrypted file readable only to root, use the following
    commands, replacing [host.example.com](http://host.example.com) with your domain
    name:'
  id: totrans-87
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '[host.example.com](http://host.example.com)-encrypted-key.pem文件使用您之前输入的密码加密。您记住这个密码很重要。当SSL应用程序使用它时，您需要输入它。如果这个文件将用于无人值守的服务器，那么解密这个文件可能是个好主意，这样守护进程可以在不进行用户干预的情况下加载它。要移除加密并使未加密的文件仅对root可读，请使用以下命令，将[host.example.com](http://host.example.com)替换为您的域名：'
- en: '[PRE14]'
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: It is important that the root user be the only user to have access to this file
    (the commands above accomplish this). Lack of strict permissions as set above
    can risk the security of your server certificate.
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 重要的是，root用户是唯一可以访问此文件的用户（上述命令实现了这一点）。缺乏上述严格权限可能危及您的服务器证书的安全性。
- en: 'It is important to export the CA certificate or root certificate ([example.com](http://example.com)-CAcert.pem)
    that was created in step 2 (page 131) so it can be installed on systems that will
    utilize your SSL Certificate. This is necessary to eliminate the appearance of
    Untrusted Root SSL Certificate Warning messages. These messages appear to warn
    the end user that there is a potential problem with the SSL Certificate. It is
    more difficult to detect an actual hijacked SSL session if this unnecessary warning
    isn''t eliminated. Most client systems (Windows XP and Mac OS X) recognize SSL
    Certificate files encoded in DER (Distinguished Encoding Rules) binary format.
    To convert your PEM (Privacy Enhanced Mail) text based certificate to the DER
    format, type the following command:'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导出在步骤 2（第 131 页）中创建的 CA 证书或根证书（[example.com](http://example.com)-CAcert.pem）非常重要，以便它可以安装到将利用您的
    SSL 证书的系统上。这是消除不受信任的根 SSL 证书警告信息出现所必需的。这些信息似乎在警告最终用户 SSL 证书可能存在潜在问题。如果消除了这个不必要的警告，检测实际被劫持的
    SSL 会话会更困难。大多数客户端系统（Windows XP 和 Mac OS X）都识别 DER（区分编码规则）二进制格式编码的 SSL 证书文件。要将您的
    PEM（增强型邮件）文本证书转换为 DER 格式，请输入以下命令：
- en: '[PRE15]'
  id: totrans-91
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'You can send your DER encoded certificate via email with this command:'
  id: totrans-92
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 您可以使用以下命令通过电子邮件发送您的 DER 编码证书：
- en: '[PRE16]'
  id: totrans-93
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: Substitute your filenames appropriately (the second instance of [example.com](http://example.com)-CAcert.cer
    can be replaced with a filename you would like the recipient to see) and replace
    `*Subject*` with an appropriate email subject line. [user@example.com](mailto:user@example.com.html)
    can be any valid email address.
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 适当地替换您的文件名（[example.com](http://example.com)-CAcert.cer 的第二个实例可以替换为您希望收件人看到的文件名）并将
    `*Subject*` 替换为适当的电子邮件主题行。[user@example.com](mailto:user@example.com.html) 可以是任何有效的电子邮件地址。
- en: 18.9\. CONFIG FILES
  id: totrans-95
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 18.9. 配置文件
- en: /usr/local/openssl/openssl.cnf
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: /usr/local/openssl/openssl.cnf
- en: Contains defaults for the OpenSSL command-line tool
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 包含 OpenSSL 命令行工具的默认设置
- en: 18.10\. NOTES
  id: totrans-98
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 18.10. 注意事项
- en: Certificate authorities that sign SSL Certificates usually charge a variable
    fee. Be advised that if you self-sign your SSL Certificate, client programs will
    display a dialog to users explaining that the certificate is not in the trusted
    root database. This can confuse users who aren't familiar with the technology.
    If a small number of known users will be accessing your server with SSL, you can
    give each user a copy of your server's root certificate to install into their
    client application to eliminate this warning message (see step 7 on page 133).
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 签署 SSL 证书的证书机构通常收取可变费用。请注意，如果您自行签署 SSL 证书，客户端程序将向用户显示一个对话框，解释该证书不在受信任的根数据库中。这可能会让不熟悉该技术的用户感到困惑。如果只有少数已知用户将通过
    SSL 访问您的服务器，您可以给每个用户一份您服务器根证书的副本，将其安装到他们的客户端应用程序中，以消除此警告信息（参见第 133 页的第 7 步）。
- en: CAcert is a certificate authority that issues free SSL Certificates. If you
    are new to SSL Certificates, the site is a good place to learn about the SSL Certificate
    signing process. You can create a certificate signing request as outlined in this
    guide and have it signed by CAcert. Certificates signed by CAcert have limited
    support; most web browsers do not include its root certificate in their database
    of trusted CAs. CAcert's root certificate is, however, included in FreeBSD and
    several Linux distributions. Visit CAcert on the Web at [http://cacert.org](http://cacert.org).
  id: totrans-100
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: CAcert 是一个提供免费 SSL 证书的证书机构。如果您对 SSL 证书不熟悉，该网站是了解 SSL 证书签名过程的好地方。您可以按照本指南创建一个证书签名请求，并由
    CAcert 签署。由 CAcert 签署的证书支持有限；大多数网络浏览器不包括其根证书在其受信任的 CA 数据库中。然而，CAcert 的根证书包含在 FreeBSD
    和几个 Linux 发行版中。请访问 [http://cacert.org](http://cacert.org) 上的 CAcert 网站。
- en: If you are creating self-signed SSL Certificates and wish to create another
    one (e.g., if you are adding an additional server to your network), start at step
    5 on page 132\. (Remember to assign a Common Name consistent with your server's
    hostname.)
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如果您正在创建自签名的 SSL 证书并且希望创建另一个（例如，如果您正在将另一个服务器添加到您的网络中），请从第 132 页的第 5 步开始。 （请记住为您的服务器分配一个与服务器主机名一致的通用名称。）
