<html><head></head><body>
  <div class="sgc-1" id="filepos484192"/>&#13;
&#13;
  <h1 class="calibre1" id="calibre_pb_299"><span class="calibre2"><a class="calibre7" shape="rect"/>Chapter 6. STRING UTILITIES</span></h1>&#13;
&#13;
  <div class="calibre3"><a class="calibre17" shape="rect"/><img alt="STRING UTILITIES" class="calibre23" src="../Images/00001.jpg"/></div>&#13;
&#13;
  <p class="calibre4"><a class="calibre17" shape="rect"/>Manipulating text with Ruby is easy; you have probably already seen Ruby's string methods like <code class="calibre19">capitalize</code>, <code class="calibre19">upcase</code>, <code class="calibre19">downcase</code>, and <code class="calibre19">swapcase</code>. In this chapter we will expand on those methods, creating an even more powerful toolset for text-processing tasks like searching, manipulating, and creating documents.</p>&#13;


  <div class="calibre3 calibre3 calibre3 calibre3">
    <h1 class="calibre1" id="calibre_pb_300"><span class="calibre2"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos485390"/>PDF Generator</span></h1>
  </div>


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_301"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos485677"/>PDF Generator</span></h2>
    </div>

    <div class="calibre3">
      <div class="calibre3 calibre3 calibre3">
        <h3 class="calibre16" id="heading_id_2"><a class="calibre7" shape="rect"/>pdfGen.rb</h3>
      </div>

      <p class="calibre4">PDFs provide an excellent way to present data. Some advantages of using PDF <span><em class="italic">(Portable Document Format)</em></span> files include platform independence, viewing consistency, and a wide selection of free reader software. PDF files have become a standard for information exchange on the Internet; I even converted my resume to a PDF so potential employers would see exactly what I wanted them to see. This script will show you how to create your own PDF files without the need for expensive software.<a class="calibre17" shape="rect"/><a class="calibre17" shape="rect"/></p>
    </div>
  </div>


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_302"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos486927"/>The Code</span></h2>&#13;
    </div><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19"><img alt="" class="calibre23" src="../Images/00002.jpg"/> require 'pdf/writer'<br class="calibre20"/>&#13;
       require '<a class="calibre17" shape="rect"/>pdf/simpletable'<br class="calibre20"/>&#13;
      <a class="calibre17" shape="rect"/><br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00003.jpg"/> pdf = PDF::Writer.new<br class="calibre20"/>&#13;
       pdf.select_font("Times-Roman")<br class="calibre20"/>&#13;
       pdf.text("Review: Wicked Cool Ruby Scripts\n\n", :font_size =&gt; 25, :justification<br class="calibre20"/>&#13;
       =&gt; :center)<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00004.jpg"/> PDF::SimpleTable.new do |table|<br class="calibre20"/>&#13;
           table.column_order = %w(question response)<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
           table.columns["question"] = PDF::SimpleTable::Column.new("question") do |col|<br class="calibre20"/>&#13;
               col.heading = "Question"<br class="calibre20"/>&#13;
               col.width = 100<br class="calibre20"/>&#13;
           end<br class="calibre20"/>&#13;
           table.columns["response"] = PDF::SimpleTable::Column.new("response") do |col|<br class="calibre20"/>&#13;
               col.heading = "Response"<br class="calibre20"/>&#13;
           end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
           table.show_lines    = :all<br class="calibre20"/>&#13;
           table.show_headings = false<br class="calibre20"/>&#13;
           table.shade_rows    = :none<br class="calibre20"/>&#13;
           table.orientation   = :center<br class="calibre20"/>&#13;
           table.position      = :center<br class="calibre20"/>&#13;
           table.width         = 400<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00005.jpg"/>     data = [<br class="calibre20"/>&#13;
               {"question" =&gt; "Reviewer:"},<br class="calibre20"/>&#13;
               {"question" =&gt; "Title:", "response" =&gt; "Wicked Cool Ruby Scripts"},<br class="calibre20"/>&#13;
               {"question" =&gt; "Author:", "response" =&gt; "Steve Pugh"},<br class="calibre20"/>&#13;
               {"question" =&gt; "Publisher &amp; Year:", "response" =&gt; "No Starch Press, 2009"},<br class="calibre20"/>&#13;
               {"question" =&gt; "ISBN:"},<br class="calibre20"/>&#13;
               {"question" =&gt; "Genre Category:", "response" =&gt; "Programming Languages:<br class="calibre20"/>&#13;
       Ruby"},<br class="calibre20"/>&#13;
               ]<br class="calibre20"/>&#13;
           table.data.replace data<br class="calibre20"/>&#13;
           table.render_on(pdf)<br class="calibre20"/>&#13;
       end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00006.jpg"/><br class="calibre20"/>&#13;
       pdf.text("\n\n1.  Did this book teach you anything about scripting in Ruby (circle<br class="calibre20"/>&#13;
       one)?" , :font_size =&gt; 14)<br class="calibre20"/>&#13;
       pdf.text("\n    Yes   No     Why or why not?____________________________")<br class="calibre20"/>&#13;
       pdf.text("\n2.  Are the example scripts appropriate and are they explained well?")<br class="calibre20"/>&#13;
       pdf.text("\n    Yes   No     Why or why not?____________________________")<br class="calibre20"/>&#13;
       pdf.text("\n3.  Would you recommend this book to another person?  Why or why not?")<br class="calibre20"/>&#13;
       pdf.text("    ________________________________________________________________")<br class="calibre20"/>&#13;
       pdf.text("    ________________________________________________________________")<br class="calibre20"/>&#13;
       pdf.text("\n4.  List three adjectives that describe this book:")<br class="calibre20"/>&#13;
       pdf.text("    a._______________  b._______________ c._______________")<br class="calibre20"/>&#13;
       pdf.text("\n5.  Write any additional information you would like to share here:")<br class="calibre20"/>&#13;
       pdf.text("    ________________________________________________________________")<br class="calibre20"/>&#13;
       pdf.text("    ________________________________________________________________")<br class="calibre20"/>&#13;
       <a class="calibre17" shape="rect"/>pdf.text("    ________________________________________________________________")<br class="calibre20"/>&#13;
       <a class="calibre17" shape="rect"/>pdf.text("    ________________________________________________________________")<br class="calibre20"/>&#13;
       pdf.text("    ________________________________________________________________")<br class="calibre20"/>&#13;
       pdf.text("\n6.  Overall rating: Check one (0=Horrible, 5=Wicked Cool):")<br class="calibre20"/>&#13;
       pdf.text("          0          1          2          3          4          5")<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00007.jpg"/> pdf.circle_at(66, pdf.y+5, 5).stroke<br class="calibre20"/>&#13;
       pdf.circle_at(121, pdf.y+5, 5).stroke<br class="calibre20"/>&#13;
       pdf.circle_at(170, pdf.y+5, 5).stroke<br class="calibre20"/>&#13;
       pdf.circle_at(219, pdf.y+5, 5).stroke<br class="calibre20"/>&#13;
       pdf.circle_at(268, pdf.y+5, 5).stroke<br class="calibre20"/>&#13;
       pdf.circle_at(316, pdf.y+5, 5).stroke<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00008.jpg"/> pdf.save_as('book_review.pdf')</tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_303"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos492036"/>Running the Code</span></h2>
    </div>

    <p class="calibre4">To run this script, type:</p><a class="calibre17" shape="rect"/>

    <div class="calibre3">
      <span class="calibre18"><tt class="calibre19"><strong class="calibre22"><code class="calibre19">ruby pdfGen.rb</code></strong></tt></span>
    </div>
  </div>


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_304"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos492622"/>The Results</span></h2>&#13;
    </div>&#13;
&#13;
    <p class="calibre4">After executing the script, look for a PDF file called <span><em class="italic">book_review.pdf</em></span>. The file's contents will look like the form shown in <a class="calibre6" href="#filepos493098" shape="rect">Figure 6-1</a>.</p>&#13;
&#13;
    <div class="calibre20">&#13;
      <span class="italic"><a class="calibre17" shape="rect"/></span>&#13;
&#13;
      <div class="calibre3 calibre3" id="filepos493098">&#13;
        <span class="italic"><a class="calibre17" shape="rect"/><img alt="The contents of book_review.pdf" class="calibre23" src="../Images/00016.jpg"/></span>&#13;
      </div>&#13;
&#13;
      <p class="calibre4">Figure 6-1. The contents of book_review.pdf</p>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_305"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos493675"/>How It Works</span></h2>
    </div>

    <p class="calibre4">For this script, we rely on the <a class="calibre17" shape="rect"/>PDF:Writer library to turn regular text into a <a class="calibre17" shape="rect"/>PDF. This is available as a gem, so you can easily install it using the command <code class="calibre19">gem install pdf-writer</code>. To begin the script, we include <code class="calibre19">pdf/writer</code>, to later create the PDF file, and <code class="calibre19">pdf/simpletable</code>, because we will be adding a table to the document <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00002.jpg"/></span>. Next, the <code class="calibre19">PDF</code> object is created and saved to a variable called <code class="calibre19">pdf</code> <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00003.jpg"/></span>.<a class="calibre17" shape="rect"/></p>

    <p class="calibre4">We are creating a form that will be used to retrieve valuable customer feedback information about this book. The default text <a class="calibre17" shape="rect"/>font for the <a class="calibre17" shape="rect"/>PDF:Writer library is Times New Roman, and I've explicitly coded the font as a reminder that the fonts can be changed. You can change this to <code class="calibre19">Courier</code>, <code class="calibre19">Helvetica</code>, or <code class="calibre19">Times-Roman</code>. We add a title to the PDF document and set the font to 25-point, so that it will be distinguishable from the rest of the text. The next area of the PDF file will be a table that contains information specific to the book.</p>

    <p class="calibre4">We create a <code class="calibre19">SimpleTable</code> object followed by a code block that will populate the table with data <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00004.jpg"/></span>. While a table can have as many columns and rows as needed, we will be using two columns, titled <span><em class="italic">Question</em></span> and <span><em class="italic">Response</em></span>. In order to make the table more aesthetically appealing and to give customers more room to respond to each question, I've set the <code class="calibre19">question</code> width (the minimum character width needed to frame each question without wasting space in the question column) to <code class="calibre19">100</code>. The rest of the table will be used for customer responses. Six table attributes are customized, and thanks to Ruby's easily unambiguous naming convention, the customizations are matched with the method names. The attributes will determine how the finalized table will look. The section of code following the table attributes is where the questions are initialized in the table <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00005.jpg"/></span>. The last step in the table creation is to render it. The table is rendered into the <code class="calibre19">pdf</code> variable using the <code class="calibre19">render_on</code> method.</p>

    <p class="calibre4">Now that the table has been created, the script begins asking several questions, all with different expected types of answers <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00006.jpg"/></span>. One noteworthy aspect of the question section is the circles that are created using the <code class="calibre19">circle_at</code> method <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00007.jpg"/></span>. The method requires three arguments. The first two are the starting coordinates in the (<span><em class="italic">x</em></span>, <span><em class="italic">y</em></span>) format. The third argument is the radius of the circle. The drawing pointer is at the end of the document when the first <code class="calibre19">circle_at</code> is called. To get the circles to move higher by one line, the y-coordinate is set to <code class="calibre19">pdf.y+5</code>. The x-coordinate is increased to match the corresponding numbers <span><em class="italic">0</em></span> through <span><em class="italic">5</em></span>. To save all the hard work we—I mean Ruby—has done, we call the <code class="calibre19">save_as</code> method, which does exactly what it claims <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00008.jpg"/></span>. The document is saved as <span><em class="italic">book_review.pdf</em></span>.<a class="calibre17" shape="rect"/><a class="calibre17" shape="rect"/><a class="calibre17" shape="rect"/></p>
  </div>

  <div class="mbppagebreak" id="calibre_pb_306"/>


  <div class="calibre3 calibre3 calibre3 calibre3" id="filepos498947">
    <h1 class="calibre1" id="calibre_pb_307"><span class="calibre2"><a class="calibre7" shape="rect"/>Word Frequency</span></h1>
  </div>


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_308"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos499436"/>Word Frequency</span></h2>
    </div>

    <div class="calibre3">
      <div class="calibre3 calibre3 calibre3">
        <h3 class="calibre16" id="heading_id_2"><a class="calibre7" shape="rect"/>wordFreq.rb</h3>
      </div>

      <p class="calibre4">This script will scan a text file and count the number of times each word appears in the document. There are several reasons to extract word counts, or word frequencies, from a document. One example is for the cryptographic analysis of a cipher text that has been encrypted with a shift cipher. I find <a class="calibre17" shape="rect"/>word frequency to be interesting in my own writing, too. Running this script shows me which words I use most often and, with a few tweaks, can show those that are not part of my daily vocabulary.<a class="calibre17" shape="rect"/></p>
    </div>
  </div>


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_309"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos500637"/>The Code</span></h2>&#13;
    </div><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19"><img alt="" class="calibre23" src="../Images/00002.jpg"/> unless ARGV[0]<br class="calibre20"/>&#13;
           puts "\nYou need to include a file to test."<br class="calibre20"/>&#13;
           puts "Usage: ruby wordFreq.rb file_to_test.txt"<br class="calibre20"/>&#13;
           exit<br class="calibre20"/>&#13;
       end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00003.jpg"/> unless File.exist?(ARGV[0])<br class="calibre20"/>&#13;
           puts "\nThe file could not be found, check the path."<br class="calibre20"/>&#13;
           puts "Usage: ruby wordFreq.rb file_to_test.txt"<br class="calibre20"/>&#13;
           exit<br class="calibre20"/>&#13;
       end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
       file = ARGV[0]<br class="calibre20"/>&#13;
       words = Hash.new(0)<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00004.jpg"/> File.open(file, "r").each_line do |line|<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00005.jpg"/>     line.scan(/\b\w+\b/) {|i| words[i] += 1}<br class="calibre20"/>&#13;
       end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00006.jpg"/> sorted = words.sort_by {|a| a[1] }<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
       temp = sorted.length<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00007.jpg"/> 10.times do<br class="calibre20"/>&#13;
           temp -= 1<br class="calibre20"/>&#13;
           puts "\"#{sorted[temp][0]}\" has #{sorted[temp][1]} occurrences"<br class="calibre20"/>&#13;
       end</tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_310"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos502226"/>Running the Code</span></h2>&#13;
    </div>&#13;
&#13;
    <p class="calibre4">Execute this script by typing:</p><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19"><strong class="calibre22"><code class="calibre19">ruby wordFreq.rb</code></strong> <strong class="calibre22"><code class="calibre19"><em class="italic"><code class="calibre19">/path/to/file/</code></em></code></strong></tt></span>&#13;
    </div>&#13;
&#13;
    <p class="calibre4">I ran this script against the first chapter of this book just to see what would happen. I thought <span><em class="italic">Ruby</em></span> might be one of the top hits, but aside from the usual suspects (e.g., <span><em class="italic">the</em></span>, <span><em class="italic">to</em></span>, and <span><em class="italic">is</em></span>), the word <span><em class="italic">script</em></span> managed to sneak onto the list of top 10 words used. Who would have known?</p>&#13;
  </div>&#13;


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_311"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos503642"/>The Results</span></h2>
    </div>

    <p class="calibre4">The results are output to $stdout, but you could just as easily have them output to a text file or a PDF:</p><a class="calibre17" shape="rect"/>

    <div class="calibre3">
      <span class="calibre18"><tt class="calibre19">"the" has 513 occurrences<br class="calibre20"/>
      "to" has 156 occurrences<br class="calibre20"/>
      "is" has 128 occurrences<br class="calibre20"/>
      "script" has 126 occurrences<br class="calibre20"/>
      "a" has 118 occurrences<br class="calibre20"/>
      "file" has 107 occurrences<br class="calibre20"/>
      "and" has 94 occurrences<br class="calibre20"/>
      "you" has 87 occurrences<br class="calibre20"/>
      "of" has 81 occurrences<br class="calibre20"/>
      "in" has 70 occurrences</tt></span>
    </div>
  </div>


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_312"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos504506"/>How It Works</span></h2>
    </div>

    <p class="calibre4">The script begins with a check to make sure the user has entered a filename for <a class="calibre17" shape="rect"/>word frequency analysis <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00002.jpg"/></span>. Next, the script checks to ensure the filename that was passed actually is a file and also that the file is reachable <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00003.jpg"/></span>. After creating a <code class="calibre19">file</code> object from the first argument and initializing a hash called <code class="calibre19">words</code>, the file is opened and each line is read into a block <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00004.jpg"/></span>. Although there is only one line in the block, there are many different actions taking place within that single line. The wicked cool part about the multiple actions taking place is that they have been condensed to one line, yet they are still easily readable by humans <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00005.jpg"/></span>. For each line in the file, the contents are <span><em class="italic">parsed</em></span>, or scanned, using the <code class="calibre19">scan</code> method. Since the script is tracking the occurrences of each word, this method allows the script to isolate individual words. This method will pass each word that matches the regular expression to another block (also located on the same line). Interestingly enough, the matches can simply be put into an array if no block was needed. But, since we needed to do some more manipulation, we tacked a block onto the end of the line.</p>

    <p class="calibre4">For each word passed to the block, the <code class="calibre19">words</code> hash is referenced, and the key is incremented by one if the word exists. If the word has not been encountered before, then the value is initialized and the key set to a count of one. Populating a hash table, in one line of code, based on the occurrences of every single word in a file is slick. Perhaps you've come across the term <span><em class="italic">histogram</em></span> in a math or statistics class? Well this script makes a simple histogram that shows the proportion of words used in a given file.</p>

    <p class="calibre4">At this point, the <code class="calibre19">words</code> hash is completely populated, and all that's left to do is output the significant information. The script orders the values in <code class="calibre19">words</code> based on the keys using a nice little method called <code class="calibre19">sort_by</code>, which is part of the <a class="calibre17" shape="rect"/>Enumerable library. The <code class="calibre19">sort_by</code> method will sort the respective hash and return a multidimensional array with arrays containing the key and value for each element in the original hash <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00006.jpg"/></span>. The final block prints the last 10 arrays of the multidimensional array; this corresponds to the 10 words that occur most often in the text file <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00007.jpg"/></span>.<a class="calibre17" shape="rect"/></p>
  </div>


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_313"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos508484"/>Hacking the Script</span></h2>
    </div>

    <p class="calibre4">The simplest hack would be to convert the script to analyze letters in the text file. Letter frequency is also used for cryptographic analysis. A simple search on Google will reveal that the most widely used letter in English is <span><em class="italic">e</em></span>.</p>

    <p class="calibre4">A slightly different approach would be the addition of <span><em class="italic">stop words</em></span>. Stop words are words that are removed prior to displaying the results. You could remove common terms like <span><em class="italic">the</em></span>, <span><em class="italic">to</em></span>, <span><em class="italic">is</em></span>, <span><em class="italic">of</em></span>, <span><em class="italic">as</em></span>, and so on. Also, this script could be the simple beginnings of a <a class="calibre17" shape="rect"/>Bayesian spam filter. Bayesian spam filters are powerful because they identify words that occur in spam and build a profile from these. I'm sure you can think of one or two words that are common in spam messages … something to do with enlarging this or free that. Profiling spam is one tool for helping users get legitimate email.<a class="calibre17" shape="rect"/><a class="calibre17" shape="rect"/></p>
  </div>

  <div class="mbppagebreak" id="calibre_pb_314"/>


  <div class="calibre3 calibre3 calibre3 calibre3" id="filepos510117">
    <h1 class="calibre1" id="calibre_pb_315"><span class="calibre2"><a class="calibre7" shape="rect"/>Comma-Separated Value Parser</span></h1>
  </div>


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_316"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos510620"/>Comma-Separated Value Parser</span></h2>
    </div>

    <div class="calibre3">
      <div class="calibre3 calibre3 calibre3">
        <h3 class="calibre16" id="heading_id_2"><a class="calibre7" shape="rect"/>csv.rb</h3>
      </div>

      <p class="calibre4">Comma-separated value (CSV) files are very prevalent in our digital world. They are used everywhere, and many programs have functions to input or output information in the CSV format. Even Microsoft supports CSV in the majority of its products!<a class="calibre17" shape="rect"/></p>

      <p class="calibre4">This script will show you how to customize data output once it has been delimited by commas in a CSV file. This will lead to more meaningful interpretation of the data. Two libraries can help you work with CSV files: The first is the old standard <a class="calibre17" shape="rect"/>Ruby CSV library, and the second is a library called <a class="calibre17" shape="rect"/>FasterCSV. I will show you how to use FasterCSV and seamlessly integrate it into your scripts. Just note that when you upgrade past 1.8, FasterCSV will be incorporated into the standard library. The usage is very similar between both libraries; if you ever find yourself needing to upgrade or read old Ruby CSV code, you shouldn't worry at all.</p>

      <p class="calibre4">We could have hacked our own CSV library using the <code class="calibre19">split</code> method; but since you've seen other scripts with <code class="calibre19">split</code>, we'll introduce something new and more efficient. To put this script in perspective, suppose you have a financial CSV file output by some hyper-state-of-the-art financial analysis software, like Excel or QuickBooks. You've got to figure out what to do with the data, so your first thought is to consult Ruby! Here's what <span><em class="italic">easy</em></span> looks like:<a class="calibre17" shape="rect"/></p>
    </div>
  </div>


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_317"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos513008"/>The Code</span></h2>&#13;
    </div><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19"> require 'faster_csv'<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00002.jpg"/> unless ARGV[0]<br class="calibre20"/>&#13;
           puts "Usage: ruby csv.rb &lt;filename.ext&gt;"<br class="calibre20"/>&#13;
           puts "Example: ruby csv.rb comma.separated"<br class="calibre20"/>&#13;
           exit<br class="calibre20"/>&#13;
       end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
       unless File.exist?(ARGV[0])<br class="calibre20"/>&#13;
           puts "\nThe file could not be found, check the path."<br class="calibre20"/>&#13;
           puts "Usage: ruby csv.rb comma.separated"<br class="calibre20"/>&#13;
           exit<br class="calibre20"/>&#13;
       end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00003.jpg"/> file = FasterCSV.open(ARGV[0], "r")<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
       print "Does the file include header information (y/n)? "<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00004.jpg"/> h = $stdin.gets.chomp<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
       if h.downcase == 'y'<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00005.jpg"/>     header = file.shift<br class="calibre20"/>&#13;
           print header.join("\t")<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00006.jpg"/>     file.each do |line|<br class="calibre20"/>&#13;
               puts<br class="calibre20"/>&#13;
               print line.join("\t")<br class="calibre20"/>&#13;
           end<br class="calibre20"/>&#13;
       else<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00007.jpg"/>     print "Enter header information (separated by commas): "<br class="calibre20"/>&#13;
           header = $stdin.gets.strip<br class="calibre20"/>&#13;
           header = header.split(",")<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00008.jpg"/>     header.each do |h|<br class="calibre20"/>&#13;
               print h + "\t"<br class="calibre20"/>&#13;
           end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
           file.each do |line|<br class="calibre20"/>&#13;
               puts<br class="calibre20"/>&#13;
               line.each do |element|<br class="calibre20"/>&#13;
                   print element + "\t"<br class="calibre20"/>&#13;
               end<br class="calibre20"/>&#13;
           end<br class="calibre20"/>&#13;
       end</tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_318"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos515331"/>Running the Code</span></h2>&#13;
    </div>&#13;
&#13;
    <p class="calibre4">Run the script by typing:</p><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19"><strong class="calibre22"><code class="calibre19">ruby <a class="calibre17" shape="rect"/>csv.rb</code></strong> <strong class="calibre22"><code class="calibre19"><em class="italic"><code class="calibre19">comma_separated.file</code></em></code></strong><br class="calibre20"/>&#13;
      Does the file include header information (y/n)? <strong class="calibre22"><code class="calibre19"><em class="italic"><code class="calibre19">y</code></em></code></strong></tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_319"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos516304"/>The Results</span></h2>&#13;
    </div>&#13;
&#13;
    <p class="calibre4">To test this script, I downloaded a <a class="calibre17" shape="rect"/>CSV file from a <a class="calibre17" shape="rect"/>financial reporting website that contained information about Google. The results display the first few days in 2004 that Google was publicly traded. The company has become immensely profitable since then, but this shows the <a class="calibre17" shape="rect"/>value of Google when it started.</p><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19">Date        Open       High       Low        Close      Volume<br class="calibre20"/>&#13;
      2004-09-01  102.70     102.97     99.67      100.25     4573700<br class="calibre20"/>&#13;
      2004-08-31  102.30     103.71     102.16     102.37     2461400<br class="calibre20"/>&#13;
      2004-08-30  105.28     105.49     102.01     102.01     2601000<br class="calibre20"/>&#13;
      2004-08-27  108.10     108.62     105.69     106.15     3109000<br class="calibre20"/>&#13;
      2004-08-26  104.95     107.95     104.66     107.91     3551000<br class="calibre20"/>&#13;
      2004-08-25  104.96     108.00     103.88     106.00     4598900<br class="calibre20"/>&#13;
      2004-08-24  111.24     111.60     103.57     104.87     7631300<br class="calibre20"/>&#13;
      2004-08-23  110.75     113.48     109.05     109.40     9137200<br class="calibre20"/>&#13;
      2004-08-20  101.01     109.08     100.50     108.31     11428600<br class="calibre20"/>&#13;
      2004-08-19  100.00     104.06     95.96      100.34     22351900</tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_320"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos518486"/>How It Works</span></h2>
    </div>

    <p class="calibre4">The script is written with two types of <a class="calibre17" shape="rect"/>CSV files in mind: a file with the <a class="calibre17" shape="rect"/>header on the first line and a file with pure data. The script takes a CSV file as the only argument, and the file's existence is first checked to ensure proper execution <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00002.jpg"/></span>. Next, the script opens the file using the faster_csv library <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00003.jpg"/></span>. After the file has been opened, the script asks the user about header info in order to determine which section of code to follow <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00004.jpg"/></span>. If the file does contain header information, the first part of the <code class="calibre19">if</code> statement is executed. Assuming the CSV file contains a header, the first task is to remove the header so that faster_csv can work its magic. The header is removed with the <code class="calibre19">shift</code> method, and the value is stored in the variable <code class="calibre19">header</code> <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00005.jpg"/></span>.<a class="calibre17" shape="rect"/></p>

    <p class="calibre4">After the header has been parsed, the script moves on to the meat of the CSV file. If you recall from before, we initialized the variable <code class="calibre19">file</code> as a FasterCSV object that reads in the CSV file to be parsed. Getting back to basics for a moment, each line contains data that may or may not have every field populated. The <a class="calibre17" shape="rect"/>FasterCSV library's syntax is great because the code is so similar to every other file manipulation script. A block of code that outputs a line break for every line within the CSV file is declared. Then, for each element in the line, the output ends with a tab for a clean display <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00006.jpg"/></span>. Not too complicated. The FasterCSV library makes handling CSV files a breeze, and that ends the first path.</p>

    <p class="calibre4">If you have a raw CSV file without any headers, perhaps you want to add your own headers for ease of use or readability. If that is the case, then you would answer <strong class="calibre22"><code class="calibre19">no</code></strong> to the question asking about headers. Then the script knows to ask for the header names rather than trying to read them off the CSV file <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00007.jpg"/></span>. The user then enters each header separated by a comma. After the headers are created, the rest of the script runs, just like the previous path <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00008.jpg"/></span>.</p>
  </div>


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_321"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos522100"/>Hacking the Script</span></h2>
    </div>

    <p class="calibre4">There aren't many hacks to this script because of its simplicity, but there are two things that would be a good exercise in Ruby coding. The first is condensing the script while still maintaining readability. The first place to look would be where the header is parsed. Another equally beneficial exercise would be to format the output to handle a variety of cases. As it stands now, with tabs, the information could be out of alignment if some of the element fields are too wide. Additionally, you could use the CSV file to output to another file for many other uses. I have the script outputting the data directly because my data sets weren't too large and were easy to read in a terminal window. Check out the next few sections, which build on this basic idea of <a class="calibre17" shape="rect"/>parsing CSV files.<a class="calibre17" shape="rect"/></p>
  </div>

  <div class="mbppagebreak" id="calibre_pb_322"/>


  <div class="calibre3 calibre3 calibre3 calibre3" id="filepos523146">
    <h1 class="calibre1" id="calibre_pb_323"><span class="calibre2"><a class="calibre7" shape="rect"/>CSV to XML</span></h1>
  </div>


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_324"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos523631"/>CSV to XML</span></h2>
    </div>

    <div class="calibre3">
      <div class="calibre3 calibre3 calibre3">
        <h3 class="calibre16" id="heading_id_2"><a class="calibre7" shape="rect"/>csvToXML.rb</h3>
      </div>

      <p class="calibre4"><a class="calibre17" shape="rect"/>If you want to populate information to the Web, <span><em class="italic">Extensible Markup Language (XML)</em></span> is a good format to use. The reason XML is so cool is because the format enables different systems to share data using a common format that the developer can design. This script will take the information <a class="calibre17" shape="rect"/>stored in a <a class="calibre17" shape="rect"/>CSV file and, instead of just outputting the comments to the user's terminal, will produce an <a class="calibre17" shape="rect"/>XML file.<a class="calibre17" shape="rect"/><a class="calibre17" shape="rect"/><a class="calibre17" shape="rect"/></p>
    </div>
  </div>


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_325"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos524985"/>The Code</span></h2>&#13;
    </div><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19"><img alt="" class="calibre23" src="../Images/00002.jpg"/> require 'faster_csv'<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00003.jpg"/> print "CSV file to read: "<br class="calibre20"/>&#13;
       infile = gets.strip<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
       print "What do you want to call each element: "<br class="calibre20"/>&#13;
       record_name = gets.strip<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
       print "What do you want to title the XML document: "<br class="calibre20"/>&#13;
       title = gets.strip<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
       print "What do you want to call the set of elements: "<br class="calibre20"/>&#13;
       set = gets.strip<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00004.jpg"/> file = FasterCSV.open(infile, "rb")<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00005.jpg"/> header = file.shift<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00006.jpg"/> File.open(File.basename(infile, ".*") + ".xml", 'wb') do |ofile|<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00007.jpg"/>     ofile.puts '&lt;?xml version="1.0"?&gt;'<br class="calibre20"/>&#13;
           ofile.puts "&lt;#{set}&gt;"<br class="calibre20"/>&#13;
           ofile.puts "\t&lt;name&gt;#{title}&lt;/name&gt;"<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00008.jpg"/>     file.each do |record|<br class="calibre20"/>&#13;
             ofile.puts "\t&lt;#{record_name}&gt;"<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00009.jpg"/>       for i in 0..(header.size - 1)<br class="calibre20"/>&#13;
               ofile.puts "\t\t&lt;#{header[i]}&gt;#{record[i]}&lt;/#{header[i]}&gt;"<br class="calibre20"/>&#13;
             end<br class="calibre20"/>&#13;
             ofile.puts "\t&lt;/#{record_name}&gt;"<br class="calibre20"/>&#13;
           end<br class="calibre20"/>&#13;
           ofile.puts "&lt;/#{set}&gt;"<br class="calibre20"/>&#13;
       end</tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_326"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos527022"/>Running the Code</span></h2>
    </div>

    <p class="calibre4">To run this script, type:</p><a class="calibre17" shape="rect"/>

    <div class="calibre3">
      <span class="calibre18"><tt class="calibre19"><strong class="calibre22"><code class="calibre19">ruby csvToXML.rb</code></strong><br class="calibre20"/>
      CSV file to read: <strong class="calibre22"><code class="calibre19"><em class="italic"><code class="calibre19">employees.csv</code></em></code></strong><br class="calibre20"/>
      What do you want to call each element: <strong class="calibre22"><code class="calibre19"><em class="italic"><code class="calibre19">names</code></em></code></strong><br class="calibre20"/>
      What do you want to title the XML document: <strong class="calibre22"><code class="calibre19"><em class="italic"><code class="calibre19">Employees at Wicked Cool Ruby</code></em></code></strong><br class="calibre20"/>
      What do you want to call the set of elements: <strong class="calibre22"><code class="calibre19"><em class="italic"><code class="calibre19">people</code></em></code></strong></tt></span>
    </div>
  </div>


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_327"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos528374"/>The Results</span></h2>&#13;
    </div>&#13;
&#13;
    <p class="calibre4">The <a class="calibre17" shape="rect"/>following is what you would find in the resulting <a class="calibre17" shape="rect"/>XML file:</p><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19">&lt;?xml version="1.0"?&gt;<br class="calibre20"/>&#13;
      &lt;people&gt;<br class="calibre20"/>&#13;
          &lt;name&gt;Employees at Wicked Cool Ruby&lt;/name&gt;<br class="calibre20"/>&#13;
          &lt;names&gt;<br class="calibre20"/>&#13;
              &lt;first&gt;Steve&lt;/first&gt;<br class="calibre20"/>&#13;
              &lt;last&gt;Pugh&lt;/last&gt;<br class="calibre20"/>&#13;
          &lt;/names&gt;<br class="calibre20"/>&#13;
          &lt;names&gt;<br class="calibre20"/>&#13;
              &lt;first&gt;John&lt;/first&gt;<br class="calibre20"/>&#13;
              &lt;last&gt;Doe&lt;/last&gt;<br class="calibre20"/>&#13;
          &lt;/names&gt;<br class="calibre20"/>&#13;
      &lt;/people&gt;</tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_328"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos529550"/>How It Works</span></h2>
    </div>

    <p class="calibre4">Changing gears a little bit on this script, we aren't going <a class="calibre17" shape="rect"/>to pass any <a class="calibre17" shape="rect"/>information into the script from the command line. Like some of the other scripts, this one will prompt the user for each piece of data needed to make a flawless conversion of the <a class="calibre17" shape="rect"/>CSV file to an XML file.</p>

    <p class="calibre4">Once again, the script is going to be utilizing the faster_csv <a class="calibre17" shape="rect"/>library <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00002.jpg"/></span>. (If you need a refresher on the operations of faster_csv, see "#38 Comma-Separated Value Parser" on <a class="calibre6" href="../Text/dummy_split_263.html#filepos510117" shape="rect">Comma-Separated Value Parser</a>.) Before the script even touches the CSV file, a few pieces of information need to be specified. To understand the reason for each variable, knowing the structure of an XML document helps. I'll direct you to research XML documents on your own (<a class="calibre6" href="http://www.w3.org/XML/Core/#Publications/" shape="rect">http://www.w3.org/XML/Core/#Publications/</a>).</p>

    <p class="calibre4">The first user prompt will get the CSV file's name and store it in <code class="calibre19">infile</code> <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00003.jpg"/></span>. Next, <code class="calibre19">record_name</code> will hold the value of the element types. The XML file will also need a title, which is stored in the variable <code class="calibre19">title</code>. Finally, each element needs a set name, which will be stored in <code class="calibre19">set</code>.</p>

    <p class="calibre4">Now, the script is ready to begin parsing the CSV file and creating the XML document from scratch. The first operation is to open the CSV file and store the <code class="calibre19">faster_csv</code> object in <code class="calibre19">file</code> <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00004.jpg"/></span>. The script assumes the header information is contained within the CSV file, so the header is popped off using the <code class="calibre19">shift</code> method and is stored in <code class="calibre19">header</code> <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00005.jpg"/></span>. Next, the XML file is created by using the base filename of the CSV file and appending the <span><em class="italic">.xml</em></span> extension. Using the typical XML version tag, the script begins creating the document <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00006.jpg"/></span>.<a class="calibre17" shape="rect"/></p>

    <p class="calibre4">Each element in the XML document will have an opening and a closing tag, so it is important for the script to close every tag that it opens. The <code class="calibre19">version</code> statement, set name, and document title are all output to the XML file, called <code class="calibre19">ofile</code> <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00007.jpg"/></span>. Next, each record is created <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00008.jpg"/></span>. Every line in the CSV file will be a record, and the header will determine how many elements are contained in each record. After the record tag is started, each element is tagged with the corresponding header name <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00009.jpg"/></span>. This process is repeated for every line in the <a class="calibre17" shape="rect"/>CSV file. Once the CSV file has been completely processed, the script begins finalizing the closing tags. When the script exits, the <a class="calibre17" shape="rect"/>XML will be fully formed and ready for incorporation <a class="calibre17" shape="rect"/>into whatever you had in mind.</p>
  </div>


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_329"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos534326"/>Hacking the Script</span></h2>
    </div>

    <p class="calibre4">The possibilities are endless when using an XML file. The first thing that comes to my mind is editing the script to deal with files that do not contain headers. See the previous CSV script for a head start. Another hack would be integration with a website using the XML file paired with a cascading style sheet (CSS) to format the output. You could set up a website to dynamically update based on the output of this little script. The result would be an XML file that, when combined with CSS and HTML, would produce a nice web page on the fly. Combine this script with "#30 Flash Cards" on <a class="calibre6" href="../Text/dummy_split_210.html#filepos423382" shape="rect">Flash Cards</a> for XML-style web-based flash cards.<a class="calibre17" shape="rect"/></p>
  </div>

  <div class="mbppagebreak" id="calibre_pb_330"/>


  <div class="calibre3 calibre3 calibre3 calibre3" id="filepos535250">
    <h1 class="calibre1" id="calibre_pb_331"><span class="calibre2"><a class="calibre7" shape="rect"/>Ruby Grep</span></h1>
  </div>


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_332"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos535734"/>Ruby Grep</span></h2>
    </div>

    <div class="calibre3">
      <div class="calibre3 calibre3 calibre3">
        <h3 class="calibre16" id="heading_id_2"><a class="calibre7" shape="rect"/>rubyGrep.rb</h3>
      </div>

      <p class="calibre4">Imagine this scenario: You have hundreds of files in multiple directories stored on your hard drive—all of which are important and contain information related to a research project. As you're consolidating your final report, you remember reading a figure from one of the papers, but you're not sure which paper, much less which folder, it is in. What to do? Read through the files again? Yeah, right! The first thing to do is not worry! The second thing to do is get a copy of this script and run it. This script will allow you to automatically open files and read the contents, pinpointing the information you need with lightning speed.<a class="calibre17" shape="rect"/><a class="calibre17" shape="rect"/></p>
    </div>
  </div>


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_333"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos537070"/>The Code</span></h2>&#13;
    </div><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19"> require 'English'<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00002.jpg"/> unless ARGV[0]<br class="calibre20"/>&#13;
           puts "\nYou need to include a value to search for."<br class="calibre20"/>&#13;
           puts "Usage: ruby rubyGrep.rb \"value_to_search\" '**/*'"<br class="calibre20"/>&#13;
           exit<br class="calibre20"/>&#13;
       end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
       pattern = ARGV[0]<br class="calibre20"/>&#13;
       glob = ARGV[1]<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00003.jpg"/> Dir[glob].each do |file|<br class="calibre20"/>&#13;
           next unless File.file?(file)<img alt="" class="calibre23" src="../Images/00004.jpg"/>         File.open(file, "rb") do |f|<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00005.jpg"/>             f.each_line do |line|<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00006.jpg"/><br class="calibre20"/>&#13;
                       puts "#{File.expand_path(file)}: #{$INPUT_LINE_NUMBER}:<br class="calibre20"/>&#13;
       #{line}" if line.include?(pattern)<br class="calibre20"/>&#13;
               end<br class="calibre20"/>&#13;
           end<br class="calibre20"/>&#13;
       end</tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_334"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos538520"/>Running the Code</span></h2>&#13;
    </div>&#13;
&#13;
    <p class="calibre4">To run this script, type:<a class="calibre17" shape="rect"/><a class="calibre17" shape="rect"/></p><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19"><strong class="calibre22"><code class="calibre19">ruby rubyGrep.rb</code></strong> <em class="italic"><code class="calibre19">value_to_search where_to_search</code></em><br class="calibre20"/>&#13;
      <strong class="calibre22"><code class="calibre19">ruby rubyGrep.rb entropy '*'</code></strong></tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_335"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos539391"/>The Results</span></h2>&#13;
    </div>&#13;
&#13;
    <p class="calibre4">For the purpose of this example, I searched a <a class="calibre17" shape="rect"/>directory of Ruby scripts to find out which ones referred to the word <span><em class="italic">entropy</em></span>, which I used in the password strength testing script. I only had one script that contained any reference to <span><em class="italic">entropy</em></span>, and the search worked perfectly. The results are shown below:</p><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19">C:/Steven.Pugh/Scripts/complete/password.rb: 22: entropy =  -1 *<br class="calibre20"/>&#13;
      letters.keys.inject(0.to_f) do |sum, k|<br class="calibre20"/>&#13;
      C:/Steven.Pugh/Scripts/complete/password.rb: 32: puts "\nThe entropy value is:<br class="calibre20"/>&#13;
      #{entropy}"</tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_336"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos540543"/>How It Works</span></h2>
    </div>

    <p class="calibre4">The elegance of this script is in its simplicity. Only one library is used, called <a class="calibre17" shape="rect"/>English, and it supports the file output of line numbers. The script will run without the library, but the line numbers won't be included. The script first checks to ensure that both a search string and a location to search have been indicated <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00002.jpg"/></span>. Of course, <a class="calibre17" shape="rect"/>if you search for nothing, you will find it every time, so ensure you include a meaningful search pattern.</p>

    <p class="calibre4">To begin <a class="calibre17" shape="rect"/>searching through the directories, the library Dir is used to iterate through each file within the directory identified at <code class="calibre19">ARGV[1]</code> and saved in the <code class="calibre19">glob</code> variable <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00003.jpg"/></span>. The notation <code class="calibre19">'**/*'</code> is used to tell the <code class="calibre19">Dir</code> method that we want to recursively search through the current directory and every sub-directory, scanning for the pattern as we go. If you only wanted to search the current directory and not the subdirectories, you could supply <code class="calibre19">'*'</code> to the <code class="calibre19">Dir</code> method. The <code class="calibre19">each</code> method is referring to each file we find in the specified directory. Of course, if you wanted to narrow your search to HTML files, you could add an extension to the glob, such as <code class="calibre19">'*.html'</code>. This simple statement allows the script to manipulate every single file matching a specific criterion. Very powerful.</p>

    <p class="calibre4">The script's next move is to decide what action to perform on each file. We already know we want to search for a specific string, so the script will need to open each file. The next block opens each file as read-only and passes the binary contents to the variable <code class="calibre19">f</code> <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00004.jpg"/></span>. The <code class="calibre19">each_line</code> method is then used to search the lines individually. The variable <code class="calibre19">line</code> holds the lines of data <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00005.jpg"/></span>. Then a lengthy line pulls all of the relevant data for display to the user <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00006.jpg"/></span>. We'll go through this line a bit more carefully. To read the line, we have to start with order of precedence, which is the last <code class="calibre19">if</code> statement in the line [<code class="calibre19">if line.include?(pattern)</code>]. One important note is that if the <code class="calibre19">if</code> statement evaluates to <code class="calibre19">false</code>, meaning the pattern was not found, then the entire line is skipped. If the line includes the specified pattern, then the rest of this line <a class="calibre17" shape="rect"/>of code is evaluated. To do so, we jump back to the beginning of the line, where the script expands the file path and displays the line number where the occurrence was found.<a class="calibre17" shape="rect"/></p>

    <p class="calibre4">Keep in mind when running this script that the search can be as creative as you want it to be. If the files you're searching for happen to be in a higher directory or part of another branch, you'll need to take this into account when launching the script.</p>
  </div>


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_337"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos544913"/>Hacking the Script</span></h2>
    </div>

    <p class="calibre4">I've already mentioned a few places where you could hack this script as far as searching other file types and the placement of the script. This script can also be easily incorporated into other scripts or simply used by itself.</p>
  </div>

  <div class="mbppagebreak" id="calibre_pb_338"/>


  <div class="calibre3 calibre3 calibre3 calibre3" id="filepos545327">
    <h1 class="calibre1" id="calibre_pb_339"><span class="calibre2"><a class="calibre7" shape="rect"/>Password Check</span></h1>
  </div>


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_340"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos545816"/>Password Check</span></h2>
    </div>

    <div class="calibre3">
      <div class="calibre3 calibre3 calibre3">
        <h3 class="calibre16" id="heading_id_2"><a class="calibre7" shape="rect"/>password.rb</h3>
      </div>

      <p class="calibre4">Do you think your password is secure? Muahahaha!!! I'm just kidding; I don't know if your password is secure or not, but this script will give you a pretty good idea. It is based on mathematical proofs—and the numbers don't lie! Give this script a shot, making sure nobody is looking over your shoulder when you run it since your password won't be masked. Note that dictionary-based attacks aren't incorporated in the output; only entropy and brute force are addressed.<a class="calibre17" shape="rect"/><a class="calibre17" shape="rect"/></p>
    </div>
  </div>


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_341"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos546989"/>The Code</span></h2>&#13;
    </div><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19"><img alt="" class="calibre23" src="../Images/00002.jpg"/> unless ARGV[0]<br class="calibre20"/>&#13;
           puts "You need to include a password to test."<br class="calibre20"/>&#13;
           puts "Usage: <a class="calibre17" shape="rect"/>ruby password.rb mySuperSecretPassword"<br class="calibre20"/>&#13;
           exit<br class="calibre20"/>&#13;
       end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00003.jpg"/> password = ARGV[0]<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00004.jpg"/> word = password.split(//)<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00005.jpg"/> letters = Hash.new(0.0)<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00006.jpg"/> set_size = 96<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00007.jpg"/> word.each do |i|<br class="calibre20"/>&#13;
           letters[i] += 1.0<br class="calibre20"/>&#13;
       end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00008.jpg"/> letters.keys.each do |j|<br class="calibre20"/>&#13;
           letters[j] /= word.length<br class="calibre20"/>&#13;
       end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00009.jpg"/> entropy =  -1 * letters.keys.inject(0.to_f) do |sum, k|<br class="calibre20"/>&#13;
           sum + (letters[k] * (Math.log(letters[k])/Math.log(2.to_f)))<br class="calibre20"/>&#13;
       end<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00011.jpg"/> combinations = 96 ** <a class="calibre17" shape="rect"/>password.length<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
       days = combinations.to_f / (10000000 * 86400)<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
       years = days / 365<br class="calibre20"/>&#13;
      <br class="calibre20"/>&#13;
       puts "\nThe entropy value is: #{entropy}"<br class="calibre20"/>&#13;
      <img alt="" class="calibre23" src="../Images/00012.jpg"/><br class="calibre20"/>&#13;
       puts "\nAnd it will take ~ #{days &lt;365 ? "#{days.to_i } days" : "#{years.to_i}<br class="calibre20"/>&#13;
       years"} to <a class="calibre17" shape="rect"/>brute force the password"</tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">&#13;
    <div class="calibre3 calibre3 calibre3">&#13;
      <h2 class="calibre8" id="calibre_pb_342"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos549071"/>Running the Code</span></h2>&#13;
    </div>&#13;
&#13;
    <p class="calibre4">To run this script, type:</p><a class="calibre17" shape="rect"/>&#13;
&#13;
    <div class="calibre3">&#13;
      <span class="calibre18"><tt class="calibre19"><strong class="calibre22"><code class="calibre19">ruby password.rb</code></strong> <strong class="calibre22"><code class="calibre19"><em class="italic"><code class="calibre19">mySuperSecretPassword</code></em></code></strong></tt></span>&#13;
    </div>&#13;
  </div>&#13;


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_343"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos549822"/>The Results</span></h2>
    </div>

    <p class="calibre4">I actually ran this script on the password <span><em class="italic">RubyScr1pt5</em></span>, and the results weren't bad:</p><a class="calibre17" shape="rect"/>

    <div class="calibre3">
      <span class="calibre18"><tt class="calibre19">The entropy value is: 3.4594316186373<br class="calibre20"/>
      And it will take ~ 20238436 years to brute force the password</tt></span>
    </div>
  </div>


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_344"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos550544"/>How It Works</span></h2>
    </div>

    <p class="calibre4">This password script is really two concepts rolled together for one wicked cool script. The first is an <a class="calibre17" shape="rect"/>entropy calculation, based on <span><em class="italic">Shannon entropy</em></span>. This script will calculate the measure <a class="calibre17" shape="rect"/>of uncertainty in your password. If you don't like Greek letters or natural logarithms, you will be pleased to know I'm not going to prove the entropy calculation. If you really want to see the equation, it's below, but we'll presume the calculation is solid.<a class="calibre17" shape="rect"/></p>

    <p class="calibre4">The second part of the script is based on how long a computer would need in order to brute force, or guess, your password. Several assumptions are made in the calculation; to ensure the script matches reality, you should review the math. I'll point out the places where you should focus your attention.</p>

    <p class="calibre4">To begin, the script is run with a password as the first argument. As long as some password is included, the script will continue to analyze the password <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00002.jpg"/></span>. The first step is to initialize some variables used later on. The variable <code class="calibre19">password</code> will, naturally, contain the user's password <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00003.jpg"/></span>. The next variable, <code class="calibre19">word</code>, will contain an array of characters that make up the user's password <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00004.jpg"/></span>. This is accomplished using the ever-so-helpful method <code class="calibre19">split</code>. Since the Shannon entropy calculation deals with probabilities of each letter occurring, a hash is created that will hold one instance of every letter as the key and the corresponding probability that the letter will be chosen next as the value. This hash is called <code class="calibre19">letters</code> <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00005.jpg"/></span>. Note that this is very similar to "#37 Word Frequency" on <a class="calibre6" href="../Text/dummy_split_256.html#filepos498947" shape="rect">Word Frequency</a>.<a class="calibre17" shape="rect"/></p>

    <p class="calibre4">The final initialized variable is <code class="calibre19">set_size</code> <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00006.jpg"/></span>. The size <a class="calibre17" shape="rect"/>of the set is important because it determines the length of time required to guess the user's <a class="calibre17" shape="rect"/>password. I have the default set size at 96, which corresponds to a set of mixed uppercase and lowercase letters, numbers, and all of the common symbols on an American keyboard. You can use a set size of 62 for alphanumeric, 26 for only lowercase or only uppercase letters, and 10 for digits. Your set size is predetermined by your password policy.</p>

    <p class="calibre4">To begin calculating the <a class="calibre17" shape="rect"/>Shannon entropy, the hash <code class="calibre19">letters</code> is populated by counting each instance of a specific character <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00007.jpg"/></span>. Next, the values in each element of the hash are divided by the password length to calculate the probability that the letter will occur next <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00008.jpg"/></span>. The script now has all the information needed to calculate the measure of <a class="calibre17" shape="rect"/>chaos in the password. Remember, the higher the chaos, the harder it is to guess the password. Also note that a password of <span><em class="italic">n</em></span> length consisting of the same symbol repeated over and over will have an entropy of 0. In plain English, the Shannon entropy calculation is (negative one) multiplied by (the summation of each hash element's probability) multiplied by (the total of the natural logarithm of the hash element's probability) divided by (the natural logarithm of two) <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00009.jpg"/></span>.</p>

    <p class="calibre4">The reason the natural logarithm of the hash element's probability is divided by the natural logarithm of two is to account for the natural unit of information entropy. This division will calculate <code class="calibre19">log2</code> from another log base. Are you still with me? The calculation should have a number approximately between two and four stored in <code class="calibre19">entropy</code>.</p>

    <p class="calibre4">Now that the Shannon entropy of the user's password has been calculated, all that's left is to determine how long it would take to guess that password. The way to calculate this is to know how many guesses you will be making per second, then calculate how many possible combinations there are in the set size. In this script, given a password of a fixed size, say eight characters, then raise that to the power of the number of characters in the set. In this example, you would raise 96 to the power of 8, and the result will be stored in <code class="calibre19">combinations</code> <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00011.jpg"/></span>. Next, you need to multiply how many guesses the computer will be making per second by the number of seconds in a day (86,400 seconds in one day).</p><a class="calibre17" shape="rect"/>

    <div class="calibre3">
      <span class="calibre18"><tt class="calibre19">combinations = 96 ** password.length<br class="calibre20"/>
      <br class="calibre20"/>
      days = combinations.to_f / (10000000 * 86400)<br class="calibre20"/>
      <br class="calibre20"/>
      years = days / 365</tt></span>
    </div>

    <p class="calibre4">I assumed 10,000,000 tries per second, which would use a high-speed dual core processor. If you use any <span><em class="italic">field-programmable gate arrays (FPGAs)</em></span> like those found at <a class="calibre6" href="http://www.picocomputing.com/" shape="rect">http://www.picocomputing.com/</a>, then the number of tries per second will be significantly increased.<a class="calibre17" shape="rect"/></p>

    <p class="calibre4">Dividing the combinations by the number of guesses per day will result in the number of days needed to guess the user's password, which is stored in the variable <code class="calibre19">days</code>. You can then take the number of days and divide it by the number of days in a year (365) to get how many years it will take to guess the user's password; the output is stored in <code class="calibre19">years</code>.</p>

    <p class="calibre4">The final output will be the entropy calculation and the length of time it would take to guess the user's password. For a more efficient output and because some passwords will be guessed in a matter of days, I used the ternary notation that says if the days are less than 365, then output the time in days; else output the time in years <span><a class="calibre17" shape="rect"/><img alt="" class="calibre23" src="../Images/00012.jpg"/></span>. It's an elegant way to conditionally display the time.</p>
  </div>


  <div class="calibre3">
    <div class="calibre3 calibre3 calibre3">
      <h2 class="calibre8" id="calibre_pb_345"><span class="calibre9"><a class="calibre7" shape="rect"/><a class="calibre7" id="filepos558894"/>Hacking the Script</span></h2>
    </div>

    <p class="calibre4">You can hack this script by obscuring the password and by incorporating the script into your password policy. An important aside is that password cracking is not limited to the techniques discussed above. Another major attack is a dictionary-based one. While the math works in our favor for strong passwords with a significant length, an attacker can use human predictability to gain some advantages when cracking passwords—choosing <span><em class="italic">password</em></span> as a password would be extremely easy for a dictionary attack to crack. Passwords are a big deal for security, so knowing how to measure the strength has many applications.<a class="calibre17" shape="rect"/></p>
  </div>

  <div class="mbppagebreak" id="calibre_pb_346"/>
</body></html>