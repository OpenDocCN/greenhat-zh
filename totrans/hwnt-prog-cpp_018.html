<html><head></head><body>

<div class="calibre21" id="calibre_pb_0"/><div class="calibre1" id="calibre_toc_22">
<a name="ch02" class="calibre6" id="ch02"/>
<div class="calibre1">
<h2 class="lot-title" id="calibre_pb_1"><a name="23" class="calibre16" id="23"/><a name="ch02lev1sec13" class="calibre16" id="ch02lev1sec13"/><span class="chapter-titlelabel">Program 16: </span>Slow but Sure</h2><p class="b24-bookeditorial">Why is this program so slow? It takes a minute, 34 seconds on my system to copy the file, while the Linux <span>cp</span> command does the same thing in less than half a second. What can be done to make the program faster?</p>
<div class="calibre1">
<pre class="literallayout-normal">
  1 /************************************************
  2  * copy input file to output file.              *
  3  ************************************************/
  4 #include &lt;iostream&gt;
  5 #include &lt;unistd.h&gt;
  6 #include &lt;fcntl.h&gt;
  7
  8 int main() {
  9     // The fd of the input file
 10     int in_fd = open("file.in", O_RDONLY);
 11
 12     // The fd of the output file
 13     int out_fd = open("file.out",
 14             O_WRONLY|O_CREAT, 0666);
 15
 16     char ch;     // Character to copy
 17
 18     if (in_fd &lt; 0) {
 19         std::cout &lt;&lt;
 20             "Error could not open input file\n";
 21         exit (8);
 22     }
 23
 24     if (out_fd &lt; 0) {
 25         std::cout &lt;&lt;
 26             "Error could not open output file\n";
 27         exit (8);
 28     }
 29     while (1) {
 30         if (read(in_fd, &amp;ch, 1) != 1)
 31             break;
 32
 33         write(out_fd, &amp;ch, 1);
 34     }
 35     close(in_fd);
 36     close(out_fd);
 37     return (0);
 38 }
</pre>
</div>
<p class="b24-bookeditorial">(Next <a href="LiB0120.html#142" target="_parent" class="calibre2">Hint 6</a>. <a href="LiB0121.html#594" target="_parent" class="calibre2">Answer 96</a>.)</p>
</div>
</div>



</body></html>