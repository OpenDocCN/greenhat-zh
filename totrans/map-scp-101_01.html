<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;MAPPING BASICS"><div class="titlepage"><div><div><h1 class="title"><a id="mapping_basics"/>Chapter 1. MAPPING BASICS</h1></div></div></div><div class="informalfigure"><div class="mediaobject"><a id="I_mediaobject1_d1e277"/><img src="httpatomoreillycomsourcenostarchimages671943.png.jpg" alt="image with no caption"/></div></div><p><span class="emphasis"><em>X</em></span> marks the spot, right? That's the old pirate saying. Have you ever wondered who made maps for the pirates? The pirates had to do it themselves. No wonder they were so cranky! If they'd only had today's technology, the pirates could have used someone else's map and only had to mark the <span class="emphasis"><em>X</em></span> themselves, leaving the intricate coastline detail to the cartographer.</p><p>Luckily, you live in the present day and have all sorts of mapping options. You can use Google Maps, Yahoo! Maps, and many others. And these maps make mapping easy; all you need are just a few lines of code to include a map on your web page. <a class="xref" href="ch01.html#local_search_site_yelp_uses_google_maps" title="Figure 1-1. Local search site Yelp uses Google Maps.">Figure 1-1</a> shows a page from Yelp, a restaurant review site and one of thousands of sites that use maps to mark locations.</p><div class="figure"><a id="local_search_site_yelp_uses_google_maps"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject1_d1e296"/><img src="httpatomoreillycomsourcenostarchimages671947.png.jpg" alt="Local search site Yelp uses Google Maps."/></div></div><p class="title">Figure 1-1. Local search site Yelp uses Google Maps.</p></div><p>To embed a map, you need to use an API. An AP . . . what? API stands for <span class="emphasis"><em>Application Programming Interface</em></span>, and it consists of a collection of functions that make creating maps easier. You'll still have to do some programming, but writing your code will be trivial compared to what you'd have to do if you had to do everything yourself. Sound familiar, matey?<a id="IDX-CHP-1-0001" class="indexterm"/><a id="IDX-CHP-1-0002" class="indexterm"/></p><div class="sect1" title="The Mapping APIs: Google, Yahoo!, and Mapstraction"><div class="titlepage"><div><div><h1 class="title"><a id="the_mapping_apis_colon_google_comma_yaho"/>The Mapping APIs: Google, Yahoo!, and Mapstraction</h1></div></div></div><p>As I mentioned, you can choose from a number of mapping API providers. The features and the style of the maps vary, though the APIs share a number of elements. This book will cover mapping tools from Google and Yahoo!, but most of the code examples will use a JavaScript library called Mapstraction, which is also an API, but different from the others. Mapstraction is not a mapping service itself; instead, it is a wrapper for other APIs. You write the code once, and it will work on Google Maps, Yahoo! Maps, and ten other providers.<sup>[<a id="CHP-1-FN-1" href="#ftn.CHP-1-FN-1" class="footnote">1</a>]</sup><a id="IDX-CHP-1-0003" class="indexterm"/></p><p>Mapstraction doesn't always support every provider's features, but it covers those features the services share and more. For the majority of mapping projects, using Mapstraction makes sense. Every now and then, you'll come across an example that only works with one provider. In those cases, I will clearly indicate where the Mapstraction code ends and the proprietary code begins.</p><p>Using Mapstraction is about foresight. How much code will you need to rewrite if, for example, Google shuts down its Maps API? If that sounds far-fetched, then consider instead what might happen if your mapping provider starts showing annoying ads or another comes along that has maps with colors more suitable to your design. Mapstraction allows you to switch seamlessly between providers. So you write the code once, and it works everywhere.<a id="IDX-CHP-1-0004" class="indexterm"/><a id="IDX-CHP-1-0005" class="indexterm"/><a id="IDX-CHP-1-0006" class="indexterm"/><a id="IDX-CHP-1-0007" class="indexterm"/><a id="IDX-CHP-1-0008" class="indexterm"/><a id="IDX-CHP-1-0009" class="indexterm"/><a id="IDX-CHP-1-0010" class="indexterm"/><a id="IDX-CHP-1-0011" class="indexterm"/></p><p>Before you can begin plotting locations on a map, however, you need to understand mapping basics. One of the most important concepts is the coordinate system used to describe a point on the earth. Let's look at how that is done.</p></div><div class="footnotes"><br/><hr/><div class="footnote"><p><sup>[<a id="ftn.CHP-1-FN-1" href="#CHP-1-FN-1" class="para">1</a>] </sup>CloudMade, FreeEarth, Map24, MapQuest, Microsoft, MultiMap, OpenLayers, OpenSpace, OpenStreetMap, and ViaMichelin</p></div></div></div>
<div class="sect1" title="Describe a Point on the Earth"><div class="titlepage"><div><div><h1 class="title"><a id="describe_a_point_on_the_earth"/>Describe a Point on the Earth</h1></div></div></div><p>Geographers have a difficult job, taking a round earth and giving it meaning on a flat map. For those with the skills, the job is an exercise in accepting imprecision. Because, despite what Columbus said, the earth is not round; it's not even a sphere. The earth is an ellipsoid, slightly wider than it is tall. We owe the astronomers and mathematicians who have worked hard over the past few hundred years to help us pinpoint a location as accurately as we can a great many "thank yous."</p><p>The most common way to describe a point on the earth is to use latitude and longitude coordinates. This system is used by GPS devices, every web mapping API provider, and this book. With it, we can convert a complicated ellipsoid into a standard coordinate frame like we used in algebra class to create graphs. A world map is shown in <a class="xref" href="ch01s02.html#world_map_with_grid_overlay" title="Figure 1-2. World map with grid overlay">Figure 1-2</a> with the axes overlaid.<a id="IDX-CHP-1-0012" class="indexterm"/></p><p>The points we plot indicate locations on earth, with an error of only two centimeters (0.8 of an inch). Rather than calling the axes <span class="emphasis"><em>x</em></span> and <span class="emphasis"><em>y</em></span>, as we did in school, we call them latitude and longitude. We can express coordinate pairs in several ways:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><span class="strong"><strong>45° 33′ 25″ N, 122° 31′ 55″ W</strong></span></td></tr><tr><td><span class="strong"><strong>45° 33.4′, −122° 31.9′ or 45d33.4m, −122d31.9m</strong></span></td></tr><tr><td><span class="strong"><strong>45.55713, −122.53194</strong></span></td></tr></table><p>As you might have guessed, these coordinate pairs are all roughly equal ways of expressing the same point. The units are degrees (°), minutes (′), and seconds (″). Each degree is split into 60 minutes, and each minute is then further diced into 60 seconds. The decimal representation, in the third example, is used by mapping providers and is the style you will see most in this book.<a id="IDX-CHP-1-0013" class="indexterm"/><a id="IDX-CHP-1-0014" class="indexterm"/><a id="IDX-CHP-1-0015" class="indexterm"/><a id="IDX-CHP-1-0016" class="indexterm"/></p><p>Like the coordinate frame we're all familiar with, each axis has a zero point, with values increasing in one direction and decreasing in the other direction. Therefore, latitudes and longitudes can have both positive and negative numbers.</p><p><span class="emphasis"><em>Latitude</em></span> measures the vertical axis, which describes how far north or south a location is. The zero point for latitude is the equator. To the north, the values increase until reaching 90 degrees at the pole. South of the equator, latitude decreases, with −90 degrees being the other pole.<a id="IDX-CHP-1-0017" class="indexterm"/></p><div class="figure"><a id="world_map_with_grid_overlay"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject1_d1e415"/><img src="httpatomoreillycomsourcenostarchimages671949.png.jpg" alt="World map with grid overlay"/></div></div><p class="title">Figure 1-2. World map with grid overlay</p></div><p>The horizontal axis measurement is called <span class="emphasis"><em>longitude</em></span>. Longitude describes how far west or east a location is. The earth does not have a natural vertical equator, so scientists and politicians had to decide on a zero point. They chose the location of astronomer George Biddell Airy's telescope in Greenwich, London (the Royal Observatory), to be the <span class="emphasis"><em>Prime Meridian</em></span>. To the east of this spot, longitudes increase to 180 degrees on the other side of the earth. Similarly, longitude decreases to −180 degrees to the west, meeting positive longitudes opposite the Prime Meridian (called the <span class="emphasis"><em>antipodal</em></span> meridian).<a id="IDX-CHP-1-0018" class="indexterm"/><a id="IDX-CHP-1-0019" class="indexterm"/><a id="IDX-CHP-1-0020" class="indexterm"/><a id="IDX-CHP-1-0021" class="indexterm"/><a id="IDX-CHP-1-0022" class="indexterm"/><a id="IDX-CHP-1-0023" class="indexterm"/></p><p>Why does latitude stop at 90 degrees and longitude continue to 180 degrees? The horizontal axis does not have any poles, so picking a place to stop would be as arbitrary as the meridians. Also, latitude degrees are parallel to one another, whereas longitudinal lines become closer to each other at the poles. Points along a specific latitude are symmetrical. If you traced the hypothetical 100 degrees latitude halfway around the earth, you would arrive at 80 degrees latitude, so you might as well just call it that.</p><p>Now that you have a feel for how coordinates are used, let's look at the different ways they are expressed and how you can switch between them.</p><div class="sect2" title="Convert Between Decimal and Degree Formats"><div class="titlepage"><div><div><h2 class="title"><a id="convert_between_decimal_and_degree_forma"/>Convert Between Decimal and Degree Formats</h2></div></div></div><p>When I first introduced latitude and longitude points, I showed several examples. If you work with enough geographic data, you'll likely end up seeing each of those ways of expressing the same point. In this section, I'll show you how to convert between the two most common formats.<a id="IDX-CHP-1-0024" class="indexterm"/><a id="IDX-CHP-1-0025" class="indexterm"/><a id="IDX-CHP-1-0026" class="indexterm"/></p><p>Mapping APIs accept latitude and longitude values as a pair of decimal numbers. For example, the No Starch Press office in San Francisco is situated at 37.7740486, −122.4101883. What does that mean? First, finding the major degrees is easy—these are the numbers before the decimal, so 37 and −122 in this case.</p><p>The remaining decimals describe how close this value is to the next degree. A latitude of 37.7740486 is more than halfway between the 37th and 38th degree. A portion of a degree is expressed as minutes and seconds.</p><p>Multiply the decimal portion of the coordinates by 60 to get the number of minutes:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><span class="strong"><strong>0.7740486 × 60 = 46.442916 minutes</strong></span></td></tr><tr><td><span class="strong"><strong>0.4101883 × 60 = 24.611298 minutes</strong></span></td></tr></table><p>Now we're getting somewhere. The latitude is 37 degrees, 46 minutes. The longitude is −122 degrees, 24 minutes. However, the answer has a decimal portion. We need to repeat the previous step, multiplying these new decimals by 60 to determine the number of seconds:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><span class="strong"><strong>0.442916 × 60 = 26.57496 seconds</strong></span></td></tr><tr><td><span class="strong"><strong>0.611298 × 60 = 36.67788 seconds</strong></span></td></tr></table><p>Again, we're left with a decimal portion. Unless we want to be extremely precise, we can just take the whole number at this point. The difference between 26.57496 seconds and 26 seconds is one hundredth of a mile. Some people choose to leave a single digit after the decimal point. Then our measurement is precise within about five feet, which is almost certainly less than a pixel on a web map.</p><p>The final answer after converting from point 37.7740486, −122.4101883 to degree, minute, second format is 37° 46′ 26″ N, 122° 24′ 36″ W.<a id="IDX-CHP-1-0027" class="indexterm"/></p><p>Note the directions, which show this location is in the northern and western hemispheres. Also, the longitude is no longer expressed as a negative because the location is west of the Prime Meridian.</p><p>Converting from degree, minute, second to decimal format is even easier. As before, converting the degree is easy, as it becomes the whole number portion to the left of the decimal. Now we just have to remember to use a negative number to indicate the southern and western hemispheres.</p><p>Next, we convert the minutes portion into seconds (multiply by 60) and add that result to the existing seconds:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><span class="strong"><strong>46 × 60 + 26 = 2,786 seconds latitude</strong></span></td></tr><tr><td><span class="strong"><strong>24 × 60 + 36 = 1,476 seconds longitude</strong></span></td></tr></table><p>Finally, divide each of those results by the number of seconds in one degree, which is 3,600 (60 × 60):<a id="IDX-CHP-1-0028" class="indexterm"/><a id="IDX-CHP-1-0029" class="indexterm"/><a id="IDX-CHP-1-0030" class="indexterm"/></p><table border="0" summary="Simple list" class="simplelist"><tr><td><span class="strong"><strong>2,786 / 3600 = 0.77389</strong></span></td></tr><tr><td><span class="strong"><strong>1,476 / 3600 = 0.41000</strong></span></td></tr></table><p>The answer after converting point 37° 46′ 26″ N, 122° 24′ 36″ W to decimal format is 37.77389, −122.41000. The answer is roughly the same as the decimal version the section started with. The difference is the rounding error, which isn't very significant for this purpose. You will discover more about precision in the next project.</p></div><div class="sect2" title="Determine Precision of Decimal Coordinates"><div class="titlepage"><div><div><h2 class="title"><a id="determine_precision_of_decimal_coordinat"/>Determine Precision of Decimal Coordinates</h2></div></div></div><p>The latitude and longitude format most commonly used expresses degrees as decimals. Mapping providers, and also most services, convert from degrees to decimals to provide location data.</p><p>You might remember a tricky little thing about decimals from learning real numbers in math class: they can go on forever. You have to decide how many digits to use, much like calculators only have room for a certain amount of numbers. At some point, decimals need to be chopped off.</p><p>The number of decimals in latitude and longitude points varies by service. However, most services provide at least five digits after the decimal. As you can see in <a class="xref" href="ch01s02.html#latitude_precision_by_number_of_decimals" title="Table 1-1. Latitude Precision by Number of Decimals">Table 1-1</a>, five digits is enough to get within four feet of the location. In other words, for plotting points on a web map, five digits is plenty.</p><div class="table"><a id="latitude_precision_by_number_of_decimals"/><p class="title">Table 1-1. Latitude Precision by Number of Decimals</p><div class="table-contents"><table summary="Latitude Precision by Number of Decimals" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Digits after decimal</p></th><th style="text-align: left" valign="bottom"><p>Possible error</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p>1</p></td><td style="text-align: left" valign="top"><p>7 miles (11 km)</p></td></tr><tr><td style="text-align: left" valign="top"><p>2</p></td><td style="text-align: left" valign="top"><p>¾ mile (1 km)</p></td></tr><tr><td style="text-align: left" valign="top"><p>3</p></td><td style="text-align: left" valign="top"><p>370 feet (110 meters)</p></td></tr><tr><td style="text-align: left" valign="top"><p>4</p></td><td style="text-align: left" valign="top"><p>37 feet (11 meters)</p></td></tr><tr><td style="text-align: left" valign="top"><p>5</p></td><td style="text-align: left" valign="top"><p>4 feet (1 meter)</p></td></tr></tbody></table></div></div><p>City-level coordinates often have as few as one digit after the decimal. Only using one digit gives a possible error of 7 miles, but the coordinates will still be within the bounds of most cities. For example, Yahoo!'s weather API (used in <a class="xref" href="ch10s02.html" title="#69: Create a Weather Map">#69: Create a Weather Map</a> in <a class="xref" href="ch10s02.html" title="#69: Create a Weather Map">#69: Create a Weather Map</a>) gives city coordinates to only two digits of precision, which reduces the error to less than one mile.</p><p>Longitude precision is not as easy to calculate as latitude, because degrees of longitude are not parallel. At the equator, the latitude and longitude charts would be the same. As longitude lines near the poles, however, they come closer together. The good news is that the latitude error is the maximum that can exist for longitude, so, in most cases, the error is smaller for longitudes.<a id="IDX-CHP-1-0031" class="indexterm"/><a id="IDX-CHP-1-0032" class="indexterm"/></p><div class="note" title="Note"><h3 class="title">Note</h3><p>The latitude error also varies by about 1 km between the equator and the poles, but this error is a much smaller variation than with longitude.</p></div><p>You'll learn more about the strange quirks of longitude in <a class="xref" href="ch06.html#number_symble_36_colon_calculate_distanc" title="#36: Calculate Distance Between Two Points">#36: Calculate Distance Between Two Points</a> in <a class="xref" href="ch06.html#number_symble_36_colon_calculate_distanc" title="#36: Calculate Distance Between Two Points">#36: Calculate Distance Between Two Points</a>, where I'll show how to adjust for the different distances between degrees based on latitude.</p></div></div>
<div class="sect1" title="Create Your First Map"><div class="titlepage"><div><div><h1 class="title"><a id="create_your_first_map"/>Create Your First Map</h1></div></div></div><p>You are about to embark upon an education in neocartography, taking yourself from plain ol' web developer to a Geolocative Web Developer. We'll create a basic map in this section, and it will serve as a building block for future projects.</p><p>First, we'll use the Google Maps API to create a map centered on the No Starch Press offices in San Francisco. Then, I'll show you the changes necessary to create the same map using Yahoo!'s service. Finally, I'll show how nearly identical Mapstraction code can create both of those maps.<a id="IDX-CHP-1-0033" class="indexterm"/></p><div class="sect2" title="Create a Google Map"><div class="titlepage"><div><div><h2 class="title"><a id="create_a_google_map"/>Create a Google Map</h2></div></div></div><p>Google is the 500 pound gorilla in many areas of the Web, and mapping is no exception. Most map developers choose the Google Maps API, if only because of its ubiquity. In addition to being everywhere, Google Maps is fast and stable.</p><p>Google Maps has been around since 2005. That's not to say the Maps team isn't innovating. On the contrary, Google Maps is often the first to add new features to its API, such as driving directions and a 360-degree view of any address in many cities in the United States and select places across the globe.</p><p>Let's create a basic map using Google. Open a new HTML file and type the following:</p><a id="I_programlisting1_d1e645"/><pre class="programlisting">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;
  &lt;html &gt;
    &lt;head&gt;
      &lt;title&gt;Basic Google Map&lt;/title&gt;
      &lt;script
          src="<em class="replaceable"><code>http://maps.google.com/maps/api/js?sensor=false</code></em>"
          type="text/javascript"&gt;&lt;/script&gt;
      &lt;style type="text/css"&gt;
      div#mymap {
          width: 400px;
          height: 350px;
      }
      &lt;/style&gt;
      &lt;script type="text/javascript"&gt;
      function create_map() {
❶        var opt = {center: new google.maps.LatLng(37.7740486,-122.4101883),
                   zoom: 15, mapTypeId: google.maps.MapTypeId.ROADMAP};
❷        var map = new google.maps.Map(document.getElementById("mapdiv"), opt);
      }
      &lt;/script&gt;
    &lt;/head&gt;
    &lt;body onload="create_map()"&gt;
❸    &lt;div id="mymap"&gt;&lt;/div&gt;
    &lt;/body&gt;
  &lt;/html&gt;</pre><p>Save your file and load it in a browser. The result should look something like <a class="xref" href="ch01s03.html#a_basic_google_map" title="Figure 1-3. A basic Google Map">Figure 1-3</a>, with your Google Map centered on No Starch Press's neighborhood in San Francisco.<a id="IDX-CHP-1-0034" class="indexterm"/><a id="IDX-CHP-1-0035" class="indexterm"/><a id="IDX-CHP-1-0036" class="indexterm"/><a id="IDX-CHP-1-0037" class="indexterm"/><a id="IDX-CHP-1-0038" class="indexterm"/></p><div class="figure"><a id="a_basic_google_map"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject1_d1e672"/><img src="httpatomoreillycomsourcenostarchimages671951.png.jpg" alt="A basic Google Map"/></div></div><p class="title">Figure 1-3. A basic Google Map</p></div><p>As you can see, the HTML hooks are minimal. An empty <code class="literal">div</code> tag ❸ with an <code class="literal">id</code> attribute is all that's required. The JavaScript function <code class="literal">create_map()</code> takes over and makes calls to the API. This function can have any name you want. In many examples in this book, I'll use this same name.<a id="IDX-CHP-1-0039" class="indexterm"/><a id="IDX-CHP-1-0040" class="indexterm"/><a id="IDX-CHP-1-0041" class="indexterm"/></p><p>Before creating the map, we'll need to set some options ❶. The minimum amount of information needed is a center (using a latitude/longitude pair), a zoom level and a map type. Then, we pass those options and reference the <code class="literal">div</code> tag's <code class="literal">id</code> to create a map ❷.</p><p>And just like that you've created your first Google Map. Read on to see how this map is different from Yahoo! and how you can use Mapstraction to write code once that will work with any mapping provider.</p></div><div class="sect2" title="Create a Yahoo! Map"><div class="titlepage"><div><div><h2 class="title"><a id="create_a_yahoo_exclamation_map"/>Create a Yahoo! Map</h2></div></div></div><p>Yahoo! released its mapping API around the same time as Google. Unfortunately, the first version was Flash-based and difficult to use. Google grabbed an early lead and Yahoo! has been playing catch-up ever since. Now Yahoo! has a JavaScript API with features similar to Google's.</p><p>You'll need an API key from Yahoo! and a Yahoo! account to use its maps. To register an application, which gives you a key, visit this web page: <a class="ulink" href="https://developer.yahoo.com/wsregapp/">https://developer.yahoo.com/wsregapp/</a>.<a id="IDX-CHP-1-0042" class="indexterm"/><a id="IDX-CHP-1-0043" class="indexterm"/></p><p>Select the option with no authentication because you will not be accessing Yahoo! user data. Fill out the rest of the form with information about your application, click the button, and you're set.</p><p>Once you get your API key, you're ready to create a Yahoo! Map. To do that, start with the Google example in the previous section. Replace the call to Google's JavaScript to instead include Yahoo!'s code (be sure to use your API key):</p><a id="I_programlisting1_d1e728"/><pre class="programlisting">&lt;script type="text/javascript"
 src="http://api.maps.yahoo.com/ajaxymap?v=3.8&amp;appid=<em class="replaceable"><code>yourkeyhere</code></em>"&gt;&lt;/script&gt;</pre><p>Next, alter the contents of the <code class="literal">create_map</code> function like so:</p><a id="I_programlisting1_d1e738"/><pre class="programlisting">function create_map() {
❶    var map = new Ymap(document.getElementById('mymap'));
❷    map.drawZoomAndCenter(new YGeoPoint(37.7740486,-122.4101883), 3);
    }</pre><p>Save your file and load it in a browser. The result should look something like <a class="xref" href="ch01s03.html#a_basic_yahoo_exclamation_map" title="Figure 1-4. A basic Yahoo! Map">Figure 1-4</a>, with your Yahoo! Map centered on No Starch Press's neighborhood in San Francisco.</p><div class="figure"><a id="a_basic_yahoo_exclamation_map"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject1_d1e747"/><img src="httpatomoreillycomsourcenostarchimages671953.png.jpg" alt="A basic Yahoo! Map"/></div></div><p class="title">Figure 1-4. A basic Yahoo! Map</p></div><p>The code is not that different from Google Maps. You create a new map by referencing the <code class="literal">div</code> tag's <code class="literal">id</code> ❶. And you give the map a center by using a latitude/longitude pair ❷. The biggest differences are in terms of syntax and order. With Yahoo, you create a map, then add options, such as the zoom level and center.<a id="IDX-CHP-1-0044" class="indexterm"/></p><p>The concept behind the two maps is very similar. But these minor differences compound to become a big pain, however, if you need to switch from one to the other. That's why Mapstraction is so powerful, as you will see in the next section.</p></div><div class="sect2" title="Create a Mapstraction Map"><div class="titlepage"><div><div><h2 class="title"><a id="create_a_mapstraction_map"/>Create a Mapstraction Map</h2></div></div></div><p>Mapstraction is a little different from Google Maps and Yahoo! Maps. Mapstraction is an open source JavaScript library that ties into other mapping APIs. If you use Mapstraction, you can switch from one type of map to another with very little work, as opposed to rewriting your code completely.</p><p>Using Mapstraction limits your risk to changes being made to an API. For example, if your site's traffic takes you beyond the limit for your chosen provider, or the provider begins placing ads on the map, Mapstraction lets you switch providers quickly and inexpensively.<a id="IDX-CHP-1-0045" class="indexterm"/><a id="IDX-CHP-1-0046" class="indexterm"/><a id="IDX-CHP-1-0047" class="indexterm"/></p><p>To use Mapstraction, you must first choose a provider. In this example, I'm using Mapstraction to create a Google Map.<a id="IDX-CHP-1-0048" class="indexterm"/></p><p>Open a new HTML file and type the following:</p><a id="I_programlisting1_d1e793"/><pre class="programlisting">&lt;html&gt;
    &lt;head&gt;
      &lt;title&gt;Basic Mapstraction Map&lt;/title&gt;
      &lt;script
❶   src="<em class="replaceable"><code>http://maps.google.com/maps/api/js?sensor=false</code></em>"
       type="text/javascript"&gt;&lt;/script&gt;
  &lt;script type="text/javascript" src="mxn.js?(❷googlev3)"&gt;&lt;/script&gt;
     &lt;style type="text/css"&gt;
       div#mymap {
         width: 400px;
         height: 350px;
       }
      &lt;/style&gt;
      &lt;script type="text/javascript"&gt;
        function create_map() {
          var mapstraction = new mxn.Mapstraction('mymap', '❸googlev3');
          mapstraction.setCenterAndZoom(
            new mxn.LatLonPoint(37.7740486,-122.4101883), 15);
        }
      &lt;/script&gt;
    &lt;/head&gt;
    &lt;body onload="create_map()"&gt;
      &lt;div id="mymap"&gt;&lt;/div&gt;
    &lt;/body&gt;
  &lt;/html&gt;</pre><p>Just like you would for a normal Google Map, we include Google's JavaScript ❶. For this code to work, you also need to download the Mapstraction files. Go to <a class="ulink" href="http://mapstraction.com/">http://mapstraction.com/</a>, and follow the instructions to save the files in the same directory as your HTML file. Best practices would dictate that you keep JavaScript files in their own directory, separate from your HTML, but I'm simplifying things for this example.<a id="IDX-CHP-1-0049" class="indexterm"/></p><p>The Mapstraction files you should have, at minimum, are <span class="emphasis"><em>mxn.js</em></span>, <span class="emphasis"><em>mxn.core.js</em></span> and <span class="emphasis"><em>googlev3.core.js</em></span>. You may also have files for other providers, such as <span class="emphasis"><em>yahoo.core.js</em></span>. The only one we need to reference in our HTML code is <span class="emphasis"><em>mxn.js</em></span>, which loads the other files that it needs, including those that we pass it in the filename ❷. Then, in the <code class="literal">create_map</code> function, we let it know which type of map ❸ we are creating.</p><p>Once you have your Mapstraction map, save your HTML file and load it in a browser. The result should look exactly like the Google Map in <a class="xref" href="ch01s03.html#a_basic_yahoo_exclamation_map" title="Figure 1-4. A basic Yahoo! Map">Figure 1-4</a>. This Google Map, created via Mapstraction, should be centered on No Starch Press's neighborhood in San Francisco.<a id="IDX-CHP-1-0050" class="indexterm"/><a id="IDX-CHP-1-0051" class="indexterm"/><a id="IDX-CHP-1-0052" class="indexterm"/></p></div><div class="sect2" title="Use Yahoo! Maps with Mapstraction"><div class="titlepage"><div><div><h2 class="title"><a id="use_yahoo_exclamation_maps_with_mapstrac"/>Use Yahoo! Maps with Mapstraction</h2></div></div></div><p>To get an idea of how powerful the Mapstraction library is, let's try using Yahoo! Maps instead of Google Maps. You only have to change a few bits in the code. And the best part is even if you have a lot of Mapstraction code, you will still only need to change this one line.</p><p>As when switching from a standard Google Map to a Yahoo! Map, you need to include Yahoo!'s JavaScript. Before moving on, ensure the following lines are in your file:</p><a id="I_programlisting1_d1e852"/><pre class="programlisting">&lt;script
     src="http://api.maps.yahoo.com/ajaxymap?v=3.8&amp;appid=<em class="replaceable"><code>yourkeyhere</code></em>"
     type="text/javascript"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="mxn.js?(❶yahoo)"&gt;&lt;/script&gt;</pre><p>Note that rather than loading the Mapstraction JavaScript with Google support, we specified the Yahoo! version of Mapstraction ❶. Although the core of Mapstraction is provider agnostic, you need to tell it which of the providers you want to use. You also need to make sure you have <span class="emphasis"><em>yahoo.core.js</em></span> in the same directory as <span class="emphasis"><em>mxn.js</em></span>.</p><p>Now let's look at the Mapstraction code itself inside the <code class="literal">create_map</code> function:</p><a id="I_programlisting1_d1e870"/><pre class="programlisting">function create_map() {
     var mapstraction = new mxn.Mapstraction('mymap', ❷'yahoo');
     mapstraction.setCenterAndZoom(
          new mxn.LatLonPoint(37.7740486,-122.4101883), 15);
}</pre><p>Here, the only difference between the Mapstraction map made with Google and this map is we've noted we're making a Yahoo! map ❷. That's it. No need to change the <code class="literal">setCenterAndZoom</code> or <code class="literal">LatLonPoint</code> functions. The syntax is the same because Mapstraction is wrapped around the providers.</p><p>Save and reload your file and what was once a Google Map should be replaced with a Yahoo! Map instead, exactly like <a class="xref" href="ch01s04.html#basic_map_shown_with_surrounding_tiles" title="Figure 1-5. Basic map shown with surrounding tiles">Figure 1-5</a>. It is the same Yahoo! Map, only this one was created through Mapstraction.</p><p>Mapstraction is like magic, only better. In fact, you don't even have to choose Google <span class="emphasis"><em>or</em></span> Yahoo!. You could have both within the same map or one of each on a page.</p></div></div>
<div class="sect1" title="Find the Underlying Map Tiles"><div class="titlepage"><div><div><h1 class="title"><a id="find_the_underlying_map_tiles"/>Find the Underlying Map Tiles</h1></div></div></div><p>A web map's draggability might be its best attribute. I often find myself dragging a map just because I can. The feature also turns out to be a really good illusion.<a id="IDX-CHP-1-0053" class="indexterm"/><a id="IDX-CHP-1-0054" class="indexterm"/><a id="IDX-CHP-1-0055" class="indexterm"/><a id="IDX-CHP-1-0056" class="indexterm"/><a id="IDX-CHP-1-0057" class="indexterm"/><a id="IDX-CHP-1-0058" class="indexterm"/><a id="IDX-CHP-1-0059" class="indexterm"/></p><p>What looks like one seamless map is actually many small tiles, placed next to each other. You might have noticed this in a moment of network lag, when a section of your map failed to load. Network lag is most likely to happen after you've changed the zoom level or if you quickly drag the map far from its original location.</p><p>Providers often attempt to avoid disrupting the illusion of seamlessness by preloading all the tiles that touch the tiles in your current area.</p><p>Each tile has a standard size of 256 pixels square. In the basic map example, six tiles are at least partially visible. If Google is the provider, it also loads additional surrounding tiles. <a class="xref" href="ch01s04.html#basic_map_shown_with_surrounding_tiles" title="Figure 1-5. Basic map shown with surrounding tiles">Figure 1-5</a> shows how the visible portion of the map corresponds to its tiles. In the original view, we only see slivers of the top two tiles.</p><div class="figure"><a id="basic_map_shown_with_surrounding_tiles"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject1_d1e932"/><img src="httpatomoreillycomsourcenostarchimages671955.png.jpg" alt="Basic map shown with surrounding tiles"/></div></div><p class="title">Figure 1-5. Basic map shown with surrounding tiles</p></div><p>What happens when we change zoom levels? We need to download a completely new set of tiles. The details shown are different for each zoom level, and each tile now represents a different amount of the earth.</p><p>Due to copyright concerns, providers tend to make it difficult to access their tiles directly. You can, however, look at the tiles that are downloaded to your browser when you access a provider's maps. Doing this will give you a better idea of how the tile system works.<a id="IDX-CHP-1-0060" class="indexterm"/><a id="IDX-CHP-1-0061" class="indexterm"/><a id="IDX-CHP-1-0062" class="indexterm"/><a id="IDX-CHP-1-0063" class="indexterm"/><a id="IDX-CHP-1-0064" class="indexterm"/></p><p>Though you can get at the files in a number of ways, I'll show you a very easy method using the Firefox browser and the Firebug developer add-on. You can find them at <a class="ulink" href="http://www.getfirefox.com/">http://www.getfirefox.com/</a> and <a class="ulink" href="http://www.getfirebug.com/">http://www.getfirebug.com/</a>, respectively.<a id="IDX-CHP-1-0065" class="indexterm"/><a id="IDX-CHP-1-0066" class="indexterm"/></p><p>In Firefox, load an embedded map, such as the one in the basic map example. Click the Firebug icon in the lower-right corner, or choose <span class="strong"><strong>Firebug ▸ Open Firebug</strong></span> from the Tools menu. In the Firebug panel, click the <span class="strong"><strong>Inspect</strong></span> button, which allows you to see highlighted page elements. Hover your mouse over the center of the map, and a blue border should appear around a portion of the map. You have found a tile!<a id="IDX-CHP-1-0067" class="indexterm"/></p><p>With a tile highlighted, click the mouse, and you will be taken to HTML code with an image tag, as shown in <a class="xref" href="ch01s04.html#use_firebug_to_find_tiles" title="Figure 1-6. Use Firebug to find tiles.">Figure 1-6</a>. At first, this tag may seem confusing because you didn't add this image to your code. Unlike simply viewing source code in a browser, Firebug shows the page with the elements added by JavaScript. To create a map, your provider had to inject images as child elements of the map <code class="literal">div</code> tag.<a id="IDX-CHP-1-0068" class="indexterm"/><a id="IDX-CHP-1-0069" class="indexterm"/></p><p>In the <code class="literal">src</code> attribute of the image, you'll see the URL to the single tile that you highlighted with Firebug. You can copy that URL into a new window or tab to see only that tile, without including the context of its surrounding brethren. Also, you can doctor the parameters in the URL to view other tiles.</p><p>The earth is made up of thousands or millions of tiles, depending on the zoom level. Mapping providers refer to tiles based on a simple grid system. You can think of this as similar to a paper map, which helps you identify areas by referencing them based on a letter-number combination. For example, you might look in (K, 18) to find Maple Street.</p><p>Tiles are called by their grid reference, too; only these are usually numbered in the thousands. For example, my San Francisco example might contain a tile that is at (5241, 3718). The grid is different for each zoom level, so that reference is an important third piece of information needed to call a particular tile. To call the tile to the right of the example tile, I would look for (5242, 3718) at the same zoom level. Only the first number changes because it represents the horizontal portion of the grid. Vertically, both tiles are in row 3718.</p><p>To recap, you'll usually find three numbers in the tile URLs: the horizontal grid reference (often called <span class="emphasis"><em>X</em></span>), the vertical grid reference (<span class="emphasis"><em>Y</em></span>), and the zoom level.<a id="IDX-CHP-1-0070" class="indexterm"/></p><p>Mapstraction provides a way to use whatever tiles you would like, regardless of the provider. Again, most providers don't support direct access to the tiles. Many times you might find they use methods to prevent you from calling them. You could always create your own tiles. I show you how to do that and how to connect them to Mapstraction in <a class="xref" href="ch04s11.html" title="#26: Use Custom Tiles">#26: Use Custom Tiles</a> in <a class="xref" href="ch04s11.html" title="#26: Use Custom Tiles">#26: Use Custom Tiles</a>.</p><div class="figure"><a id="use_firebug_to_find_tiles"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject1_d1e1030"/><img src="httpatomoreillycomsourcenostarchimages671957.png.jpg" alt="Use Firebug to find tiles."/></div></div><p class="title">Figure 1-6. Use Firebug to find tiles.</p></div></div>
<div class="sect1" title="Change the Map Size"><div class="titlepage"><div><div><h1 class="title"><a id="change_the_map_size"/>Change the Map Size</h1></div></div></div><p>The initial map size is determined by CSS styles for the <code class="literal">div</code> tag. You can change the size of the map programmatically with Mapstraction, however.<a id="IDX-CHP-1-0071" class="indexterm"/><a id="IDX-CHP-1-0072" class="indexterm"/><a id="IDX-CHP-1-0073" class="indexterm"/><a id="IDX-CHP-1-0074" class="indexterm"/><a id="IDX-CHP-1-0075" class="indexterm"/></p><p>Add the following line to the <code class="literal">create_map</code> function, or include it as a click event in a link (see <a class="xref" href="apa.html" title="Appendix A. JAVASCRIPT QUICK START">Appendix A</a>):</p><a id="I_programlisting1_d1e1069"/><pre class="programlisting">mapstraction.resizeTo(200, 300);</pre><p>When the <code class="literal">resizeTo</code> function is called, you pass a width and height. Mapstraction then immediately sets the size of the map to the desired pixels. Note the center of the map is not reset. If you shrink the map, you may need to recenter the map to keep your same center-point in view.</p><p>Also, a word of caution about shrinking your map: Depending on the provider you use, interface elements may begin to collide. Be sure to test to see how small a map you can get away with.</p></div>
<div class="sect1" title="Add Zoom and Other Controls"><div class="titlepage"><div><div><h1 class="title"><a id="add_zoom_and_other_controls"/>Add Zoom and Other Controls</h1></div></div></div><p>One of the best things about using maps on your website is that users can explore with them. They want to see what's nearby, look more closely at a particular location, or figure out where a spot is in relation to the city or country. The basic maps I've shown so far do not give users very much control.<a id="IDX-CHP-1-0076" class="indexterm"/><a id="IDX-CHP-1-0077" class="indexterm"/><a id="IDX-CHP-1-0078" class="indexterm"/><a id="IDX-CHP-1-0079" class="indexterm"/><a id="IDX-CHP-1-0080" class="indexterm"/><a id="IDX-CHP-1-0081" class="indexterm"/></p><p>Let's give the users an interface to click, so they can zoom and pan around the map. Mapstraction offers several ways to do this.</p><div class="sect2" title="Small Controls"><div class="titlepage"><div><div><h2 class="title"><a id="small_controls"/>Small Controls</h2></div></div></div><p>Small controls are useful when your map isn't very big, such as when you stick it in a sidebar. Also, if you don't expect users to perform many zooms, you might prefer to keep the interface clean.</p><p>To add small controls to your map, add this line in your <code class="literal">create_map</code> function after you have set the <code class="literal">mapstraction</code> variable:</p><a id="I_programlisting1_d1e1121"/><pre class="programlisting">mapstraction.addSmallControls();</pre><p>Save and reload your file, and you should see a small set of buttons in the upper-left corner of your map. Exactly how the controls look will depend on which mapping provider you instruct Mapstraction to use. The map will likely contain plus and minus buttons for zooming and a collection of arrow buttons for panning.</p></div><div class="sect2" title="Large Controls"><div class="titlepage"><div><div><h2 class="title"><a id="large_controls"/>Large Controls</h2></div></div></div><p>If your map is the focal point of your website or page, you probably want large controls. While small controls only let users zoom in or out one level at a time, with large controls you can skip to any zoom level.</p><p>Add this line to your <code class="literal">create_map</code> function:</p><a id="I_programlisting1_d1e1135"/><pre class="programlisting">mapstraction.addLargeControls();</pre><p>Save and reload your file. When using Google Maps, Mapstraction adds several other controls in addition to the larger zoom/pan tools. To see how small and large zoom/pan tools look, see <a class="xref" href="ch01s06.html#small_and_large_zoom_controls_in_google" title="Figure 1-7. Small and large zoom controls in Google Maps (top) and Yahoo! Maps (bottom)">Figure 1-7</a>.</p><p>To only add the large versions of zoom/pan, try this function:</p><a id="I_programlisting1_d1e1143"/><pre class="programlisting">mapstraction.addControls({zoom:'large'});</pre><p>Here, you pass an object (declared with curly braces) with a single option for large zoom controls.<a id="IDX-CHP-1-0082" class="indexterm"/></p><div class="figure"><a id="small_and_large_zoom_controls_in_google"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject1_d1e1153"/><img src="httpatomoreillycomsourcenostarchimages671959.png.jpg" alt="Small and large zoom controls in Google Maps (top) and Yahoo! Maps (bottom)"/></div><div class="mediaobject"><a id="I_mediaobject1_d1e1158"/><img src="httpatomoreillycomsourcenostarchimages671961.png.jpg" alt="Small and large zoom controls in Google Maps (top) and Yahoo! Maps (bottom)"/></div></div><p class="title">Figure 1-7. Small and large zoom controls in Google Maps (top) and Yahoo! Maps (bottom)</p></div></div><div class="sect2" title="Map-Type Controls"><div class="titlepage"><div><div><h2 class="title"><a id="map-type_controls"/>Map-Type Controls</h2></div></div></div><p>Mapping providers often let users choose which type of map to view. In addition to a normal map, a satellite view and a hybrid of normal and satellite view are common. Not every map provider has all of these views. For example, some use aerial photography instead of satellite or don't have photographic imagery at all.<a id="IDX-CHP-1-0083" class="indexterm"/><a id="IDX-CHP-1-0084" class="indexterm"/></p><p>Use this command to add a map-type control to your map, like the one in <a class="xref" href="ch01s06.html#map_type_controls_in_google_maps" title="Figure 1-8. Map type controls in Google Maps">Figure 1-8</a>, so users can choose how they want to see your map:</p><a id="I_programlisting1_d1e1180"/><pre class="programlisting">mapstraction.addMapTypeControls();</pre><p>Save and reload your file to see the buttons in the upper-right corner of your map (with most providers).</p><div class="figure"><a id="map_type_controls_in_google_maps"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject1_d1e1187"/><img src="httpatomoreillycomsourcenostarchimages671963.png.jpg" alt="Map type controls in Google Maps"/></div></div><p class="title">Figure 1-8. Map type controls in Google Maps</p></div></div></div>
<div class="sect1" title="Set Zoom Level"><div class="titlepage"><div><div><h1 class="title"><a id="set_zoom_level"/>Set Zoom Level</h1></div></div></div><p>Now you've added some controls to your map, and users can change the zoom level. In most projects, you'll want to give users this power. Regardless, you need to set an initial zoom level, so the mapping provider knows what to show.<a id="IDX-CHP-1-0085" class="indexterm"/><a id="IDX-CHP-1-0086" class="indexterm"/><a id="IDX-CHP-1-0087" class="indexterm"/><a id="IDX-CHP-1-0088" class="indexterm"/><a id="IDX-CHP-1-0089" class="indexterm"/><a id="IDX-CHP-1-0090" class="indexterm"/><a id="IDX-CHP-1-0091" class="indexterm"/></p><p>Zoom levels determine how much detail is shown. A map of the entire world cannot contain streets or parks. Showing country borders is about as complex as that map can get—even most cities are smaller than a pixel. When zoomed in to a city-level map, you'll see major streets, but perhaps not neighborhood features.</p><p>In the basic map, you set the center and the zoom at the same time. Mapstraction also has a function that only sets the zoom level, while keeping the center the same:</p><a id="I_programlisting1_d1e1228"/><pre class="programlisting">mapstraction.setZoom(10);</pre><p>As with the <code class="literal">setCenterAndZoom</code> function, the zoom level is communicated as an integer. In this example, I set a zoom level of 10, whereas I used 15 in the basic map. What do these numbers mean? Which one is zoomed in closer?</p><p>Mapstraction uses zoom levels 0–16, with the larger numbers corresponding to being more zoomed in—a greater level of detail. With satellite view, you may be able to zoom in even further. <a class="xref" href="ch01s07.html#mapstraction_zoom_levels" title="Table 1-2. Mapstraction Zoom Levels">Table 1-2</a> shows an approximate correspondence between zoom levels and the area usually shown. Naturally, the exact level is determined by the size of a country, state, or city.</p><div class="table"><a id="mapstraction_zoom_levels"/><p class="title">Table 1-2. Mapstraction Zoom Levels</p><div class="table-contents"><table summary="Mapstraction Zoom Levels" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Geography description</p></th><th style="text-align: left" valign="bottom"><p>Zoom level</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p>World</p></td><td style="text-align: left" valign="top"><p>0</p></td></tr><tr><td style="text-align: left" valign="top"><p>Country</p></td><td style="text-align: left" valign="top"><p>4</p></td></tr><tr><td style="text-align: left" valign="top"><p>State</p></td><td style="text-align: left" valign="top"><p>7</p></td></tr><tr><td style="text-align: left" valign="top"><p>City</p></td><td style="text-align: left" valign="top"><p>13</p></td></tr><tr><td style="text-align: left" valign="top"><p>Street</p></td><td style="text-align: left" valign="top"><p>16</p></td></tr></tbody></table></div></div><p>Another reason to appreciate Mapstraction is it accommodates the different ways mapping providers handle zoom levels. Yahoo!, for example, uses a reverse numbering system, where larger numbers mean the map is more zoomed out. MapQuest, on the other hand, counts the same as Mapstraction, but has fewer levels with minimal detail. Through its single interface, Mapstraction takes care of these discrepancies.</p><p>Just as you can set the zoom level, Mapstraction has a very similar command to retrieve the current zoom level:</p><a id="I_programlisting1_d1e1293"/><pre class="programlisting">var currentzoom = mapstraction.getZoom();</pre><p>The integer returned is within the 0–16 Mapstraction range, converting from the provider's zoom system, if necessary. You can use a combination of <code class="literal">setZoom</code> and <code class="literal">getZoom</code> to create your own controls, rather than sticking with the mapping provider's defaults. <a class="xref" href="ch04s08.html" title="#23: Create Your Own Zoom Interface">#23: Create Your Own Zoom Interface</a> in <a class="xref" href="ch04s08.html" title="#23: Create Your Own Zoom Interface">#23: Create Your Own Zoom Interface</a> shows how to do this with step-by-step instructions.<a id="IDX-CHP-1-0092" class="indexterm"/><a id="IDX-CHP-1-0093" class="indexterm"/><a id="IDX-CHP-1-0094" class="indexterm"/><a id="IDX-CHP-1-0095" class="indexterm"/><a id="IDX-CHP-1-0096" class="indexterm"/><a id="IDX-CHP-1-0097" class="indexterm"/><a id="IDX-CHP-1-0098" class="indexterm"/><a id="IDX-CHP-1-0099" class="indexterm"/></p></div>
<div class="sect1" title="Set Map Type"><div class="titlepage"><div><div><h1 class="title"><a id="set_map_type"/>Set Map Type</h1></div></div></div><p>Most mapping providers offer three options for determining the look of maps. You can choose a simple map, which is the default, a satellite view, or a combination of the two. As I showed previously, you can let the user decide which map type to view by adding a control, usually to the upper-right corner of the map. The map type can also be set programmatically, which is what we'll do in this section.</p><p>You can set the map type at any time, though the most common situation is declaring something other than the default type when the map is loaded. For example, add this line to the <code class="literal">create_map</code> function of your basic map to show the satellite view layered with street information:</p><a id="I_programlisting1_d1e1349"/><pre class="programlisting">mapstraction.setMapType(Mapstraction.HYBRID);</pre><p>The argument that the <code class="literal">setMapType</code> function accepts is just a simple integer, but as you can see, we passed it some other type of variable. Mapstraction has <span class="emphasis"><em>constants</em></span>—special variables that are created to give more meaning than simple numbers—that make choosing a map type easy. Setting the map type to <code class="literal">HYBRID</code> makes more sense than remembering that you need to pass along the number 3 when you want both street and satellite views. <a class="xref" href="ch01s08.html#mapstraction_map_types" title="Table 1-3. Mapstraction Map Types">Table 1-3</a> shows all the map-type options and their corresponding numeric values.</p><div class="table"><a id="mapstraction_map_types"/><p class="title">Table 1-3. Mapstraction Map Types</p><div class="table-contents"><table summary="Mapstraction Map Types" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="text-align: left" valign="bottom"><p>Name</p></th><th style="text-align: left" valign="bottom"><p>Value</p></th></tr></thead><tbody><tr><td style="text-align: left" valign="top"><p><code class="literal">Mapstraction.ROAD</code></p></td><td style="text-align: left" valign="top"><p>1</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">Mapstraction.SATELLITE</code></p></td><td style="text-align: left" valign="top"><p>2</p></td></tr><tr><td style="text-align: left" valign="top"><p><code class="literal">Mapstraction.HYBRID</code></p></td><td style="text-align: left" valign="top"><p>3</p></td></tr></tbody></table></div></div><p>Map-type constants are also useful when retrieving the current map type from Mapstraction. Just as you can both <span class="emphasis"><em>set</em></span> and <span class="emphasis"><em>get</em></span> the zoom level, you can access the map type. Add this line sometime after you've created your map:</p><a id="I_programlisting1_d1e1411"/><pre class="programlisting">var maptype = mapstraction.getMapType();</pre><p>Remember, the <code class="literal">setMapType</code> function accepts an integer value as an argument. The value returned from <code class="literal">getMapType</code> is 1, 2, or 3. Again, referring to map types by the Mapstraction constants is much easier. For example, you can use a <code class="literal">switch... case</code> statement to perform different actions based on the map type:<a id="IDX-CHP-1-0100" class="indexterm"/><a id="IDX-CHP-1-0101" class="indexterm"/><a id="IDX-CHP-1-0102" class="indexterm"/><a id="IDX-CHP-1-0103" class="indexterm"/><a id="IDX-CHP-1-0104" class="indexterm"/></p><a id="I_programlisting1_d1e1446"/><pre class="programlisting">switch (maptype) {
  case Mapstraction.ROAD:
    // Run this code only when it is a road map type
  break;
  case Mapstraction.SATELLITE:
    // Run this code only when it is a satellite map type
  break;
  case Mapstraction.HYBRID:
    // Run this code only when it is a hybrid map type
  break;
}</pre><p>Replace the comments (the lines that start with two slashes) with the code you would want to use in the circumstances described. For example, you might want to remove driving directions from a map if only the satellite map is showing, because showing driving directions when no streets are visible makes less sense.<a id="IDX-CHP-1-0105" class="indexterm"/></p></div>
<div class="sect1" title="Recenter the Map"><div class="titlepage"><div><div><h1 class="title"><a id="recenter_the_map"/>Recenter the Map</h1></div></div></div><p>If you're already displaying a map, then you gave it a center with the <code class="literal">setCenterAndZoom</code> function. You never know when users will drag the map away from your center. Knowing how to reset the center—and just the center—can be useful.</p><p>Add the following line to the <code class="literal">create_map</code> function, or include it as a click event in a link:</p><a id="I_programlisting1_d1e1466"/><pre class="programlisting">mapstraction.setCenter(new mxn.LatLonPoint(37.7740486,-122.4101883));</pre><p>Of course, snapping a map directly to a point can be jarring. Luckily, the user can pan to the new center point, as if he or she dragged the map there:</p><a id="I_programlisting1_d1e1470"/><pre class="programlisting">mapstraction.setCenter(new mxn.LatLonPoint(37.7740486,-122.4101883), {pan:true});</pre><p>Here we're passing an options object to the <code class="literal">setCenter</code> function. The curly braces declare an object in JavaScript with values set by <code class="literal">key:value</code> pairs. Mapstraction will look for whether <code class="literal">pan</code> exists. If <code class="literal">pan</code> is set to <code class="literal">true</code>, then the map will pan smoothly to the new point.</p></div>
<div class="sect1" title="Retrieve the Center of the Map"><div class="titlepage"><div><div><h1 class="title"><a id="retrieve_the_center_of_the_map"/>Retrieve the Center of the Map</h1></div></div></div><p>When you load a new map, you need to give it a center. Then you give up control, as your users drag and pan that map to their heart's content. That's good, because maps are interactive. On the other hand, you may want to know the map's current center.</p><p>Mapstraction has a simple command to retrieve the map's center:<a id="IDX-CHP-1-0106" class="indexterm"/><a id="IDX-CHP-1-0107" class="indexterm"/><a id="IDX-CHP-1-0108" class="indexterm"/></p><a id="I_programlisting1_d1e1509"/><pre class="programlisting">var centerpoint = mapstraction.getCenter();</pre><p>The variable created, <code class="literal">centerpoint</code>, holds the result from the call to <code class="literal">getCenter()</code> as a <code class="literal">LatLonPoint</code>, which is the way Mapstraction stores coordinates. Keeping coordinates in a variable is handy because you can turn around and pass that to other functions. Or you can access the latitude and longitude directly:</p><a id="I_programlisting1_d1e1522"/><pre class="programlisting">centerpoint.lat
centerpoint.lon</pre><p>Now, you can use those values to add a marker to your map, plot local results on a map, or for some other purpose.</p></div>
<div class="sect1" title="Find Point Where User Clicked"><div class="titlepage"><div><div><h1 class="title"><a id="find_point_where_user_clicked"/>Find Point Where User Clicked</h1></div></div></div><p>Out-of-the-box interactivity makes mapping APIs pretty special. Using built-in controls, users can drag and pan the map, zoom in, and change map types. Users can also click, but nothing will happen unless you help them out.</p><p>To find the point where a user clicks, you need to "listen" for the click event:</p><a id="I_programlisting1_d1e1533"/><pre class="programlisting">mapstraction.addEventListener('click', function(clickpoint) {
    alert('latitude: ' + clickpoint.lat + '\nlongitude: ' + clickpoint.lon);
});</pre><p>When the user clicks anywhere within the map, an anonymous function is called with <code class="literal">clickpoint</code> as an argument. Similar to when you retrieve the center of a map, the variable is a <code class="literal">LatLonPoint</code>. This example uses a JavaScript alert to display the latitude and longitude of the point where the user clicked, as shown in <a class="xref" href="ch01s11.html#javascript_alert_showing_latitude_and_lo" title="Figure 1-9. JavaScript alert showing latitude and longitude of click point">Figure 1-9</a>.</p><div class="figure"><a id="javascript_alert_showing_latitude_and_lo"/><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject1_d1e1548"/><img src="httpatomoreillycomsourcenostarchimages671965.png.jpg" alt="JavaScript alert showing latitude and longitude of click point"/></div></div><p class="title">Figure 1-9. JavaScript alert showing latitude and longitude of click point</p></div><p>Of course, you'll want to do something more useful than a JavaScript alert. For example, you could add a marker to your map at that point. As it happens, the next chapter shows you how to do that and more.</p></div></body></html>