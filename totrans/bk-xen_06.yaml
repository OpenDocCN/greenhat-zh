- en: 'Chapter 6. DOMU MANAGEMENT: TOOLS AND FRONTENDS'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第6章。DOMU管理：工具和前端
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages333191.png.jpg)'
  id: totrans-1
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages333191.png.jpg)'
- en: 'Most of the material in this book focuses on fairly low-level administrative
    tasks. We''ve got a couple of reasons for this focus: first, because we feel that
    it''s better to understand what the GUI tools are doing before trusting them with
    your data,^([[34](#ftn.CHP-6-FNOTE-1)]) and second, because the add-on tools are
    not fully developed.'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本书的大部分内容都集中在相对低级的行政任务上。我们关注这个方向有几个原因：首先，因为我们觉得在信任GUI工具处理数据之前，先了解它们在做什么会更好，^([[34](#ftn.CHP-6-FNOTE-1)])
    其次，因为附加工具尚未完全开发。
- en: However, the true benefit of Xen is that it allows you to do things with a virtual
    machine that you can't do—or can't do easily—with a simple collection of physical
    machines. The main advantage of the more advanced management tools is that they
    exploit Xen virtualization to improve flexibility.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，Xen的真正好处是它允许你做一些事情，这些事情你用简单的物理机集合是无法做到的，或者很难做到。更先进的管理工具的主要优势是它们利用Xen虚拟化来提高灵活性。
- en: Besides, it gets kind of tedious to do everything from base principles all the
    time. In this chapter, we'll take an excursion from our usual fixation on doing
    things in the most laborious way possible and look at some of the labor-saving
    innovations available for Xen.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，总是从基础原理开始做所有事情会变得有点单调乏味。在本章中，我们将从我们通常对尽可能繁琐的方式做事的执着中抽身出来，看看Xen可用的节省劳动的创新。
- en: Broadly, we can categorize the various frontend packages by their intended audience;
    some tools are for the dom0 administrator and some are for the domU administrator
    (that is, the *customer* in Xen's computing-service model). The first group tends
    to focus on provisioning and destroying VMs, and the second group allows users
    who most likely don't have access to the dom0 to control their own VM at a higher
    level so they can, for example, give the domain a hard reboot or recover when
    the domU won't boot at all.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 广义上，我们可以根据目标受众对各种前端软件包进行分类；一些工具是为dom0管理员设计的，而另一些是为domU管理员设计的（即在Xen的计算服务模型中的*客户*）。第一组通常专注于提供和销毁虚拟机，而第二组允许用户在没有访问dom0的情况下以更高的级别控制自己的虚拟机，例如，给域进行硬重启或在domU完全无法启动时恢复。
- en: 'Despite this neat and theoretically useful division of labor, we''re going
    to ignore the second category almost completely. There are two reasons for this:
    First, most end users won''t want to do anything especially complex to their Xen
    instance. In our opinion, most of the Xen control panels are solutions in search
    of a problem. Second, almost none of the tools that we''ve tried in this category
    seem to have stabilized as of this writing.^([[35](#ftn.CHP-6-FNOTE-2)]) Instead,
    we''ll focus on the first category: software to simplify your life as a service
    provider, ranging from the simple to the elaborate. We''ll end by briefly discussing
    the Xen-shell, which is a useful minimal customer-facing tool.'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管这种 neat 和理论上有用的劳动分工，我们几乎会完全忽略第二类。有两个原因：首先，大多数最终用户不会想要对他们的Xen实例进行任何特别复杂的操作。在我们看来，大多数Xen控制面板都是寻找问题的解决方案。其次，截至本文撰写时，我们尝试过的这个类别的几乎所有工具似乎都没有稳定下来.^([[35](#ftn.CHP-6-FNOTE-2)])
    相反，我们将专注于第一类：简化服务提供商生活的软件，从简单到复杂不等。我们将以简要讨论Xen-shell结束，这是一个有用的最小客户界面工具。
- en: Tools for the VM Provider
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 虚拟机提供商的工具
- en: When looking for a management tool, as with any piece of software, the first
    question to ask yourself is, What features do I need? Xen management tools run
    the gamut from simple provisioning scripts, like Xen-tools, to elaborate data-center-oriented
    packages, like OpenQRM.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 当寻找管理工具时，就像任何软件一样，首先要问自己的问题是，我需要哪些功能？Xen管理工具的范围从简单的配置脚本，如Xen-tools，到面向数据中心的数据包，如OpenQRM。
- en: The biggest factor influencing your choice of frontend, assuming that multiple
    ones provide the necessary functionality, is probably the dom0 operating system.
    Some frontends, such as Xen-tools, are designed and built with Debian in mind.
    Some work best with Red Hat. Slackware users, you're still on your own. Although
    you can install, say, `virt-manager` on Debian, it would be a difficult process,
    contrary to the dictates of nature.^([[36](#ftn.CHP-6-FNOTE-3)]) In this chapter,
    we're going to focus on each tool in its native environment, beginning with Xen-tools
    for Debian.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 假设多个前端都提供了必要的功能，影响您选择前端的最大因素可能是dom0操作系统。一些前端，如Xen-tools，是针对Debian设计和构建的。一些与Red
    Hat配合得最好。Slackware用户，您仍然需要自己动手。尽管您可以在Debian上安装`virt-manager`，但这将是一个困难的过程，与自然法则相悖.^([[36](#ftn.CHP-6-FNOTE-3)])
    在本章中，我们将重点关注每个工具在其原生环境中，从Debian的Xen-tools开始。
- en: Xen-tools
  id: totrans-10
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Xen-tools
- en: Xen-tools, at heart, consists of a cross-platform set of Perl scripts for automated
    installs, so it's fairly distro agnostic. Even though the authors develop on Debian,
    distribute *.deb* packages, and have an Apt repository, Xen-tools is relatively
    easy to install on other systems, so we encourage you to try it regardless of
    which distro you're running. Download a tarball at [http://xen-tools.org/](http://xen-tools.org/).
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: Xen-tools在本质上是一个跨平台的Perl脚本集合，用于自动化安装，因此它对发行版的选择并不敏感。尽管作者在Debian上开发，分发*.deb包，并有一个Apt仓库，但Xen-tools在其他系统上安装相对容易，所以我们鼓励您尝试它，无论您运行的是哪个发行版。请从[http://xen-tools.org/](http://xen-tools.org/)下载tar包。
- en: Installing Xen-tools
  id: totrans-12
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 安装Xen-tools
- en: In the interest of keeping everything flowing smoothly, we installed Xen-tools
    on a Debian machine using Debian's Apt system. Because, like everything Xen-related,
    Xen-tools is under heavy development, we opted to get the package from the author's
    own repository to avoid getting an old version.
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 为了保持一切顺利进行，我们在Debian机器上使用Debian的Apt系统安装了Xen-tools。因为，就像所有与Xen相关的东西一样，Xen-tools正在经历快速的开发，我们选择从作者的仓库中获取包，以避免得到一个旧版本。
- en: 'To do this, add his repo to your */etc/apt/sources.list*. For Etch, we appended:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 要做到这一点，请将他的仓库添加到您的*/etc/apt/sources.list*中。对于Etch，我们附加了：
- en: '[PRE0]'
  id: totrans-15
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Note
  id: totrans-16
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*Sometimes even the version in Apt is not as current as the one on the website.
    If all else fails, download the tar package, unpack it, and run make install to
    install it*.'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: '*有时Apt中的版本也不如网站上的版本新。如果所有其他方法都失败了，请下载tar包，解压它，然后运行make install来安装它*。'
- en: 'Then run, as usual:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 然后像往常一样运行：
- en: '[PRE1]'
  id: totrans-19
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: Apt will then work its customary magic, installing the Xen-tools scripts and
    creating a configuration directory, */etc/xen-tools*.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，Apt将执行其习惯性的魔法，安装Xen-tools脚本并创建一个配置目录，*/etc/xen-tools*。
- en: 'For usage information, if you have `perldoc`, you can access any of the programs''
    embedded manual pages by running them with the `--manual` option. For example:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 对于使用信息，如果您有`perldoc`，您可以通过运行带有`--manual`选项的程序来访问任何程序的嵌入式手册页面。例如：
- en: '[PRE2]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: will print out a long and intimidating man page. Don't be discouraged; it's
    just exposing the bewildering array of options Xen itself makes available. You
    can simplify things by specifying most of these options ahead of time in the Xen-tools
    config file rather than by command-line options.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 将会打印出一个长而令人畏惧的man页面。不要气馁；这只是暴露了Xen本身提供的令人眼花缭乱的选项集。您可以通过在Xen-tools配置文件中提前指定这些选项中的大多数，而不是通过命令行选项来简化事情。
- en: Configuring Xen-tools
  id: totrans-24
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置Xen-tools
- en: 'So let''s make a config file. Trust us, it''s much more pleasant to spend a
    bit of time setting some defaults rather than specifying global options every
    time you use the command.^([[37](#ftn.CHP-6-FNOTE-4)]) Put your preferred options
    in */etc/xen-tools/xen-tools.conf*. We would use something like this:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，让我们创建一个配置文件。请相信我们，花点时间设置一些默认值比每次使用命令时指定全局选项要愉快得多.^([[37](#ftn.CHP-6-FNOTE-4)])
    将您首选的选项放入*/etc/xen-tools/xen-tools.conf*。我们会使用类似以下的内容：
- en: '[PRE3]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Fill in appropriate values, as always, and feel free to add from the liberally
    commented sample config anything that strikes your fancy. Some of these options,
    like `initrd` and `kernel`, specify literal directives that'll wind up in the
    final domU config file. Of the remaining options, most are self-explanatory; `size`
    specifies the filesystem size, `swap` is the amount of swap the domain will have,
    and so forth.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 填写适当的值，就像往常一样，并随意从注释丰富的示例配置中添加任何您喜欢的选项。其中一些选项，如`initrd`和`kernel`，指定了最终domU配置文件中的直接指令。其余的选项大多数都是不言自明的；`size`指定了文件系统大小，`swap`是域将拥有的交换空间量，等等。
- en: Because we've specified an LVM group, domains will be created with LVM volumes
    as backing store. You can also use filesystem images by specifying `dir = /path/`
    rather than an LVM group. If you do that, make sure that the directory exists,
    otherwise the image creation step will fail silently and `xen-create-image` will
    populate the directory where the filesystem would have been mounted. This is almost
    certainly not what you want.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们指定了LVM组，域将使用LVM卷作为后端存储。您也可以通过指定`dir = /path/`而不是LVM组来使用文件系统镜像。如果您这样做，请确保该目录存在，否则镜像创建步骤将静默失败，`xen-create-image`将填充文件系统应该挂载的目录。这几乎肯定不是您想要的。
- en: Also note the `dist=` line; this specifies which set of postinstall *hook* scripts
    `xen-create-image` will run to configure the new domain. If there isn't a directory
    under */usr/lib/xen-tools* corresponding to the `dist` value, `xen-create-image`
    will exit with an instructive error message. If you don't want to configure the
    domain at creation time, you can create an empty directory—say, */usr/lib/xen-tools/plan9*—and
    pass the name of the distribution (*plan9* in this case) as the dist value.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 还请注意`dist=`行；这指定了`xen-create-image`将运行哪个集合的后安装*钩子*脚本以配置新域。如果没有在`/usr/lib/xen-tools`下对应于`dist`值的目录，`xen-create-image`将带有一个指导性的错误信息退出。如果您不想在创建时配置域，您可以创建一个空目录——比如`/usr/lib/xen-tools/plan9`——并将发行版的名称（在这种情况下为`plan9`）作为dist值传递。
- en: 'When you have the config file populated, actually creating domains is so easy
    as to be almost anticlimactic. Just specify a hostname, preferably fully qualified
    so that the postinstall scripts can configure the image correctly, on the command
    line, and the tool will do the rest. For example:'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 当您已经填充了配置文件后，实际上创建域变得非常简单，几乎可以说是平淡无奇的。只需在命令行上指定一个主机名，最好是完全限定名称，以便安装后脚本可以正确配置镜像，然后工具会完成剩余的工作。例如：
- en: '[PRE4]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Note
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*Although setting a fully qualified domain name allows the postinstall scripts
    to handle domain configuration, it can cause trouble with the xendomains script
    on certain Red Hat derivatives, which assumes a domU name no longer than 18 characters*.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '*尽管设置完全限定域名允许安装后脚本处理域名配置，但在某些Red Hat衍生版本上，它可能会与xendomains脚本发生冲突，因为该脚本假设domU名称不超过18个字符*。'
- en: With the config file previously shown, this creates two logical volumes,*/dev/verona/mercutio.prgmr.com-disk*
    and */dev/verona/mercutio.prgmr.com-swap*. It then mounts the disk volume and
    uses `debootstrap` to install sarge (Debian 3.1).
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 使用之前显示的配置文件，这将创建两个逻辑卷，`/dev/verona/mercutio.prgmr.com-disk`和`/dev/verona/mercutio.prgmr.com-swap`。然后挂载磁盘卷，并使用`debootstrap`安装sarge（Debian
    3.1）。
- en: Easy.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 容易。
- en: Xen-tools and RPM-based DomU Images
  id: totrans-36
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Xen-tools和基于RPM的DomU镜像
- en: The first versions of Xen-tools were developed with `debootstrap` installs of
    Debian in mind. However, the package has come a long way, and it's been generalized
    to support virtually every system out there. RPM-based distros are covered via
    a `debootstrap`-like tool. Other systems—even non-Linux systems—can be installed
    by copying a pristine filesystem image or extracting tarballs.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: Xen-tools的第一版是为考虑使用`debootstrap`安装Debian而开发的。然而，这个包已经走了很长的路，并且它已经被推广到支持几乎所有的系统。基于RPM的发行版通过类似`debootstrap`的工具得到支持。其他系统——甚至是非Linux系统——可以通过复制原始文件系统镜像或提取tar包来安装。
- en: Although older versions of Xen-tools used RPMstrap, which we've used with some
    success in the past, the author of RPMstrap has ceased to develop it. Accordingly,
    the Xen-tools author has been working on a replacement called `rinse`. It's the
    recommended way of installing CentOS and Fedora with Xen-tools, and it's a fairly
    neat package by itself.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管Xen-tools的旧版本使用了RPMstrap，我们过去曾成功使用过它，但RPMstrap的作者已经停止了开发。因此，Xen-tools的作者一直在开发一个名为`rinse`的替代品。这是使用Xen-tools安装CentOS和Fedora的推荐方式，并且它本身也是一个相当整洁的包。
- en: '`rinse`''s home page is at [http://xen-tools.org/software/rinse/](http://xen-tools.org/software/rinse/).
    Download it either from the download page at that site or by adding his `apt`
    repository and downloading via your package manager.'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: '`rinse`的首页位于[http://xen-tools.org/software/rinse/](http://xen-tools.org/software/rinse/)。您可以从该网站的下载页面下载，或者通过添加他的`apt`仓库并通过您的包管理器下载。'
- en: 'A full discussion of `rinse`''s configuration options is probably out of place
    here. We enjoin you to read the fine manual. However, it works out of the box
    with an install method for `xen-create-image`, with a simple command line like
    the following:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 对`rinse`配置选项的全面讨论可能在这里不合适。我们敦促您阅读精美的手册。然而，它默认情况下与`xen-create-image`的安装方法配合使用，使用以下简单的命令行：
- en: '[PRE5]'
  id: totrans-41
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: No problem.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 没问题。
- en: Xen-tools Postinstall
  id: totrans-43
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: After the image is installed, but before it's started for the first time, `xen-create-image`
    does some postinstall work. First it runs some scripts in the mounted domU filesystem
    to perform setup tasks, like setting the hostname and disabling unneeded gettys.
    Finally it creates a config file so that you can start the domain.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
- en: At this stage you can also have the machine configure itself with a role—specify
    the `--role <script>` command-line option to run the corresponding script located
    in */etc/xen-tools/role.d* at the end of the install, taking the mount point of
    the domU root filesystem as an argument. The roles that you'll want will depend
    on your needs. For example, you may want roles that differentiate between web,
    mail, and dns servers. The Xen-tools distribution comes with some samples that
    you can build upon.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
- en: After populating the domU image, the `xen-create-image` script will create a
    configuration file based on a template at */etc/xen-tools/xm.tmpl*. You can also
    specify a template on the command line using the `--template` option.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
- en: Extending the Config File Template
  id: totrans-47
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You can, as you might suppose, edit the template freely. Xen-tools passes options
    to the setup scripts by reading environment variables, which makes it easy to
    extend the template by passing in new variables and adding code to interpret them.
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
- en: 'For example, because we like to use PyGRUB, we might edit the template by adding
    a `bootloader` option right beneath the `kernel` and `initrd` sections:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Now we can create the image with the additional value specified as an environment
    variable:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: and, as if by magic, the config file will have a `bootloader` entry.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
- en: We could also update the script that parses the config file and have it pass
    through the value as an environment variable, just as with the other options.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
- en: xen-list-images
  id: totrans-55
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Having created some domains, whether with `xen-create-image` or otherwise,
    it stands to reason that you might want to view a summary of domains that exist
    on the machine. The Xen-tools suite therefore also includes a tool to list existing
    domains, `xen-list-images`. Running it on our test system shows:'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-57
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The tool parses Xen config files—both those created by Xen-tools and otherwise—and
    prints some information.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: xen-delete-image
  id: totrans-59
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Finally we have `xen-delete-image`, which does exactly what the name suggests.
    It'll only work on images that follow the naming conventions used by `xen-create-image`,
    that is, it doesn't have the intelligence necessary to parse arbitrary domain
    definitions. Nonetheless, if you've standardized on Xen-tools or name disks in
    the format used by Xen-tools, it can be handy.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
- en: Warning
  id: totrans-61
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '*When run as root, this command will destroy data with no confirmation, even
    if you''ve specified the* *`--test`* *option*.'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
- en: 'Run `xen-delete-image` like this, but very carefully:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: This will delete *mercutio.prgmr.com-disk* and *mercutio.prgmr.com-swap* from
    the *verona* VG and delete the config file. If the data source option isn't specified,
    it defaults to the value in */etc/xen-tools/xen-tools.conf*.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 这将删除 *mercutio.prgmr.com-disk* 和 *mercutio.prgmr.com-swap* 从 *verona* VG，并删除配置文件。如果未指定数据源选项，则默认为
    */etc/xen-tools/xen-tools.conf* 中的值。
- en: libvirt, virsh, and virt-manager
  id: totrans-66
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: libvirt、virsh 和 virt-manager
- en: On the RPM side, including SUSE, CentOS, and Fedora, we have a suite of tools
    based on libvirt. Although packages are available for Debian-based distros and
    Solaris, libvirt is primarily developed on, for, and largely by Red Hat, and it
    shows in the project's focus.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 在 RPM 方面，包括 SUSE、CentOS 和 Fedora，我们有一套基于 libvirt 的工具。尽管 Debian 基础发行版和 Solaris
    也提供了相应的包，但 libvirt 主要是在 Red Hat 上、为 Red Hat 开发并由 Red Hat 大量贡献的，这在项目焦点上有所体现。
- en: libvirt isn't a management tool per se, but it's worth mentioning here as a
    Xen frontend, part of a framework that sits in front of Xen and makes management
    tools easier to develop. The stated goal of the libvirt project (at [http://libvirt.org/](http://libvirt.org/))
    is to "provide a long-term stable C API for virtualization." In other words, libvirt
    aims to allow a single tool to control any type of virtualization that libvirt
    supports, including Xen. This is wonderful, as far as it goes. However, the libvirt-based
    tools still aren't complete. In particular, their focus on Red Hat is sometimes
    inconvenient.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: libvirt 本身不是一个管理工具，但在这里提一下作为 Xen 前端，它是位于 Xen 前面的框架的一部分，使得管理工具的开发更加容易。libvirt
    项目（在 [http://libvirt.org/](http://libvirt.org/)）的既定目标是“提供一个长期稳定的 C API 用于虚拟化。”换句话说，libvirt
    的目标是允许单个工具控制 libvirt 支持的任何类型的虚拟化，包括 Xen。这听起来很棒。然而，基于 libvirt 的工具仍然不完整。特别是，它们对
    Red Hat 的关注有时会带来不便。
- en: libvirt's main advantages are that it integrates very closely with Red Hat's
    tools and that the management tool, `virt-manager`, is excellent for interacting
    with live virtual machines.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: libvirt 的主要优势是它与 Red Hat 的工具集成非常紧密，并且管理工具 `virt-manager` 对于与实时虚拟机交互来说非常出色。
- en: The basic libvirt-based tool—or at least the first-generation, proof-of-concept
    version of this tool—is `virsh`, or *virtualization shell*. Right now it can perform
    most of the same operations as `xm` on Xen, QEMU, KVM, or OpenVZ domains.
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 基本的基于 libvirt 的工具——或者至少是这个工具的第一代、概念验证版本——是 `virsh`，或称为 *虚拟化外壳*。目前它可以在 Xen、QEMU、KVM
    或 OpenVZ 域上执行与 `xm` 相同的大多数操作。
- en: This isn't the place to give a complete how-to on `virsh`; we're writing about
    Xen, and we've therefore focused on `xm`. However, `virsh` is the frontend of
    choice for Red Hat, so we'll provide some discussion and examples, but we're going
    to stick to Xen and `virsh`'s capabilities as an `xm` replacement rather than
    emphasizing the new features `virsh` introduces.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 这里不是提供 `virsh` 的完整指南的地方；我们正在撰写关于 Xen 的文章，因此我们专注于 `xm`。然而，`virsh` 是 Red Hat 的首选前端，因此我们将提供一些讨论和示例，但我们将坚持使用
    Xen 和 `virsh` 作为 `xm` 替代品的特性，而不是强调 `virsh` 引入的新功能。
- en: The first thing to mention about `virsh` is that it uses a flagrantly different
    syntax from `xm` for domain definitions. `virsh` has a `create` command, just
    as `xm` does, but it expects an XML file as an argument.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 关于 `virsh` 的第一点要提到的是，它在域定义方面使用与 `xm` 完全不同的语法。`virsh` 有一个 `create` 命令，就像 `xm`
    一样，但它期望一个 XML 文件作为参数。
- en: 'Fortunately, `virsh` allows you to create the XML definition from a Xen domain.
    For example, to get an XML definition for the running domain *ophelia*:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 幸运的是，`virsh` 允许您从 Xen 域创建 XML 定义。例如，要获取正在运行的域 *ophelia* 的 XML 定义：
- en: '[PRE10]'
  id: totrans-74
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'You can see the correspondences between this XML definition and the domain
    config file; it defines the same basic resources in a different but still recognizable
    format. We can redirect this to a file, say *ophelia.xml*, shut down the original
    *ophelia*, and create a domain:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以看到这个 XML 定义与域配置文件之间的对应关系；它以不同但仍然可识别的格式定义了相同的基本资源。我们可以将其重定向到文件，例如 *ophelia.xml*，关闭原始的
    *ophelia*，并创建一个域：
- en: '[PRE11]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '`virsh` can also list domains, just like `xm`:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: '`virsh` 也可以列出域，就像 `xm` 一样：'
- en: '[PRE12]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: Finally, just as with `xm`, `virsh` can `shutdown`, `restart`, or `destroy`
    a domain, using the obvious command for each.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，就像 `xm` 一样，`virsh` 可以使用明显的命令来 `shutdown`、`restart` 或 `destroy` 一个域。
- en: virt-manager
  id: totrans-80
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: virt-manager
- en: 'Apart from `virt-install`, which we discussed in [Chapter 3](ch03.html "Chapter 3. PROVISIONING
    DOMUS"), the most useful tool in the suite is probably `virt-manager`. It''s pretty
    slick, and it''s great in an area that''s not covered by the Xen-tools scripts:
    interacting with live virtual machines. As [Figure 6-1](ch06.html#here_you_can_see_the_virt-manager_ui_it_
    "Figure 6-1. Here you can see the virt-manager UI. It has a main screen that lists
    virtual machines; a detail view that shows VM resources, performance, and statistics;
    and a framebuffer console as well as a text console interface.") shows, `virt-manager`
    provides a centralized location from which to view performance data, virtual framebuffers,
    and consoles. It also provides a quick overview of resource allocation. Like most
    GUI tools, `virt-manager` probably requires a bit more manual effort and clicking
    through dialog boxes than you''d like to use for everyday domU creation. Nonetheless,
    it''s got support for Xen''s basic life cycle: create and destroy. It also integrates
    with Red Hat''s Kickstart deployment method for convenient semiautomated installs;
    you can just specify a *.ks* file when asked during the install dialog.'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: Getting Started with virt-manager
  id: totrans-82
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Because `virt-manager` comes with the operating system on Red Hat-based distros,
    assuming you selected the *virtualization* target during the install, you can
    invoke it without setting a finger to the keyboard. From the default GNOME desktop,
    click the **Applications** menu at the upper left, then **System Tools ► Virtual
    Machine Manager**. Enter your root password when prompted, and select **Local
    Hypervisor** to connect to the local instance of `xend`.^([[38](#ftn.CHP-6-FNOTE-5)])
    You'll be presented with something that looks vaguely like [Figure 6-1](ch06.html#here_you_can_see_the_virt-manager_ui_it_
    "Figure 6-1. Here you can see the virt-manager UI. It has a main screen that lists
    virtual machines; a detail view that shows VM resources, performance, and statistics;
    and a framebuffer console as well as a text console interface.").
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
- en: '![Here you can see the virt-manager UI. It has a main screen that lists virtual
    machines; a detail view that shows VM resources, performance, and statistics;
    and a framebuffer console as well as a text console interface.](httpatomoreillycomsourcenostarchimages333221.png.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
- en: Figure 6-1. Here you can see the virt-manager UI. It has a main screen that
    lists virtual machines; a detail view that shows VM resources, performance, and
    statistics; and a framebuffer console as well as a text console interface.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
- en: To create an image using `virt-manager`, click the **File** menu, and select
    **New Machine**. `virt-manager` will then escort you through a set of friendly
    dialog boxes.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
- en: The first prompt asks for the name of the machine. Enter something appropriate,
    but make sure that it includes only letters, numerals, and underscores—fully qualified
    domain names won't work.
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
- en: Choose whether the new domain should be paravirtualized or fully virtualized.
    If you don't have HVM, the dialog will chide you for your inadequate hardware
    and gray out the Fully Virtualized option. For the purposes of this example, we're
    picking paravirtualization.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 选择新域应该是半虚拟化还是完全虚拟化。如果你没有 HVM，对话框会责备你硬件不足，并将完全虚拟化选项变灰。在这个示例中，我们选择半虚拟化。
- en: Then `virt-manager` asks for install media. Because it's calling `virt-install`
    behind the scenes, the same constraints apply; enter a network-accessible Red
    Hat–style directory tree. For example, [http://archive.fedoraproject.org/pub/archive/fedora/linux/releases/7/Fedora/i386/os/](http://archive.fedoraproject.org/pub/archive/fedora/linux/releases/7/Fedora/i386/os/)
    will install Fedora 7 from an HTTP Fedora mirror.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 然后 `virt-manager` 会要求安装媒体。因为它在后台调用 `virt-install`，所以适用相同的约束；输入一个可网络访问的 Red Hat
    风格目录树。例如，[http://archive.fedoraproject.org/pub/archive/fedora/linux/releases/7/Fedora/i386/os/](http://archive.fedoraproject.org/pub/archive/fedora/linux/releases/7/Fedora/i386/os/)
    将从 HTTP Fedora 镜像安装 Fedora 7。
- en: At this stage you can also specify a Kickstart file using the same syntax. This
    is a handy way to automate the install process. For example, to duplicate your
    dom0's install configuration, upload your */root/anaconda-ks.cfg* file somewhere
    convenient and specify it.
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个阶段，你也可以使用相同的语法指定一个 Kickstart 文件。这是一种方便的自动化安装过程的方法。例如，为了复制 dom0 的安装配置，你可以将你的
    */root/anaconda-ks.cfg* 文件上传到某个方便的地方，并指定它。
- en: Select a backing store for the new virtual machine. The two choices map to `phy:`
    and `tap:aio:` devices. The GUI also gives you the option of creating a sparse
    file, but we don't recommend that for the reasons we described in some detail
    in [Chapter 3](ch03.html "Chapter 3. PROVISIONING DOMUS").
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 选择为新虚拟机选择存储后端。这两个选项映射到 `phy:` 和 `tap:aio:` 设备。GUI 还提供了创建稀疏文件选项，但我们不建议这样做，原因我们在
    [第 3 章](ch03.html "第 3 章。DOMUS 配置") 中详细描述过。
- en: Select a networking option. The two choices correspond to a `network-nat` work-alike
    and the standard `network-bridge`.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 选择一个网络选项。这两个选项对应于 `network-nat` 工作类似和标准的 `network-bridge`。
- en: Finally, select memory and CPU allocation.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，选择内存和 CPU 分配。
- en: At the end, `virt-manager` will list your configuration and give you a chance
    to back out. Make sure everything looks right and click **Finish**. It'll validate
    your selections and then start creating the domain using `virt-install`.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，`virt-manager` 将列出你的配置，并给你一个退出的机会。确保一切看起来正确，然后点击 **完成**。它将验证你的选择，然后使用 `virt-install`
    开始创建域。
- en: The domain creation itself is probably the coolest feature of the libvirt suite.
    Rather than populating a filesystem from the dom0 and then booting a Xen instance,
    it downloads a Xen-aware net install image, immediately boots the domain from
    the installation kernel, and then uses that kernel to download the packages and
    populate the system. The install looks just like a normal install, using the framebuffer
    console to provide a completely ordinary Red Hat install experience. Because `virt-manager`
    integrates a VNC viewer, you can watch the install as it progresses from within
    the management application.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 域的创建本身可能是 libvirt 套件中最酷的功能。它不是从 dom0 中填充文件系统然后启动一个 Xen 实例，而是下载一个 Xen 兼容的 net
    安装镜像，立即从安装内核启动域，然后使用该内核下载软件包并填充系统。安装看起来就像一个正常的安装，使用帧缓冲控制台提供完全普通的 Red Hat 安装体验。因为
    `virt-manager` 集成了 VNC 查看器，你可以在管理应用程序内观看安装过程。
- en: When the domain is running, you can pause it, shut it down, or examine its configuration
    from the main `virt-manager` window. Right-click the domain name to get a context
    menu with a list of operations, or select the domain by clicking it and use the
    button bar at the top.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 当域正在运行时，你可以暂停它，关闭它，或从主 `virt-manager` 窗口中检查其配置。右键单击域名以获取一个包含操作列表的上下文菜单，或者通过单击它来选择域，并使用顶部按钮栏。
- en: Note
  id: totrans-97
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*Early versions of* *`virt-manager`*, *including the version shipped with Red
    Hat Enterprise Linux 5.0, suffered from the oversight that when a domain had stopped,
    it vanished from the GUI''s list and thus couldn''t be restarted without dropping
    to a command prompt. If you have an afflicted version, you can easily restart
    a domain configured with* *`virt-manager`* *using* *`xm`* *in the normal way*.'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: '*早期版本的* *`virt-manager`*，包括与 Red Hat Enterprise Linux 5.0 一起发布的版本，存在一个疏忽，即当域停止时，它将从
    GUI 列表中消失，因此无法在没有降级到命令提示符的情况下重新启动。如果你有一个受影响的版本，你可以很容易地使用 *`xm`* 以正常方式重新启动由 *`virt-manager`*
    配置的域。'
- en: Still, though, `virt-manager` is too interactive and too limited to use for
    large installations. To address this, Red Hat's Emerging Technologies group ([http://et.redhat.com/](http://et.redhat.com/))
    is also working on a tool called oVirt, which aims to scale libvirt-based management
    across the entire data center. Another tool, the Puppet Recipe Manager, emphasizes
    the *software appliance* aspect of virtualization. It enables an administrator
    to build software recipes and automatically install them on virtual machines.
    We also mentioned Cobbler, an automated tool that can provision virtual machines,
    in [Chapter 3](ch03.html "Chapter 3. PROVISIONING DOMUS").
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，`virt-manager`对于大型安装来说交互性太强且限制太多，不适合使用。为了解决这个问题，红帽的先进技术组([http://et.redhat.com/](http://et.redhat.com/))也在开发一个名为oVirt的工具，该工具旨在在整个数据中心内扩展基于libvirt的管理。另一个工具，Puppet
    Recipe Manager，强调虚拟化的*软件设备*方面。它允许管理员构建软件配方并在虚拟机上自动安装它们。我们还在[第3章](ch03.html "第3章。DOMU的配置")中提到了Cobbler，这是一个可以自动配置虚拟机的自动化工具。
- en: One last libvirt-based tool that you might want to look at is `virt-clone`,
    which is capable of duplicating a domU image and its config file while altering
    any items that must be unique, such as the MAC address—a nice balance between
    convenience and control.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能还想看看的一个基于libvirt的工具是`virt-clone`，它能够在改变必须唯一的任何项目（如MAC地址）的同时，复制一个domU镜像及其配置文件——在便利性和控制之间取得了很好的平衡。
- en: 'It''s simple to run, taking most of its input from command-line options. For
    example, to clone the machine `sebastian` as `viola`:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 它运行起来很简单，大部分输入都来自命令行选项。例如，要将机器`sebastian`克隆为`viola`：
- en: '[PRE13]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '* * *'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[34](#CHP-6-FNOTE-1)]) A position unlikely to occasion much disagreement
    among sysadmins.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[34](#CHP-6-FNOTE-1)]) 一个不太可能引起系统管理员太多争议的位置。
- en: ^([[35](#CHP-6-FNOTE-2)]) We blame Python's scorched-earth policy toward compatibility.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[35](#CHP-6-FNOTE-2)]) 我们责备Python对兼容性的焦土政策。
- en: ^([[36](#CHP-6-FNOTE-3)]) Of course there are packages, but they're less closely
    integrated.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[36](#CHP-6-FNOTE-3)]) 当然有软件包，但它们的集成程度较低。
- en: ^([[37](#CHP-6-FNOTE-4)]) Cdrecord, anyone?
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[37](#CHP-6-FNOTE-4)]) 有没有人知道Cdrecord？
- en: ^([[38](#CHP-6-FNOTE-5)]) Well, if you'd been logged in as root, you wouldn't
    have had to type anything. Not that we recommend that, of course.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[38](#CHP-6-FNOTE-5)]) 嗯，如果你是以root身份登录的，你就不需要输入任何内容了。当然，我们并不推荐这样做。
- en: Administering the Virtualized Data Center
  id: totrans-109
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 虚拟化数据中心的管理
- en: The chief benefit of frontends like these is in doing things that are too large
    or complex for simpler tools, though some would hold that no problem is too large
    for a well-written shell script. The largest and best of these tools allow Xen
    to truly flex its capabilities, leading to giant automated systems such as we
    see in Amazon's EC2\. In this category are several packages, including OpenQRM,
    ConVirt, and Enomalism. All three of these have their adherents. However, we've
    chosen to focus on lower-level, more commonly available tools while the more advanced
    management frontends stabilize.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 这些前端的主要好处在于执行那些对于简单工具来说太大或太复杂的任务，尽管有些人认为没有问题对于编写良好的shell脚本来说太大。这些工具中最大和最好的能够让Xen真正发挥其能力，从而产生像我们在亚马逊的EC2中看到的那样的大型自动化系统。在这个类别中包括几个软件包，如OpenQRM、ConVirt和Enomalism。这三个都有其支持者。然而，我们选择在更高级的管理前端稳定下来之前，专注于更低级别、更常见可用的工具。
- en: Administration for the VM Customer
  id: totrans-111
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 虚拟机客户管理
- en: Although there are a number of packages aimed at allowing customers to manage
    their virtual machine, it's not clear to us that control-plane operations are
    really necessary in this context. Furthermore, most of the customer-facing tools
    are still in flux. It's difficult for us to recommend them at this point.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管有许多软件包旨在允许客户管理他们的虚拟机，但我们认为在这个上下文中控制平面操作并不是真正必要的。此外，大多数面向客户的工具仍在变化之中。在这个阶段，我们很难推荐它们。
- en: The best available solution, at least for now, seems to be to provide a reasonably
    simple menu through which customers can attach to the console, reboot their machines,
    shut down their machines, and re-create their domU image. There are many ways
    to do this. Our favorite is to allow customers to SSH to a console server, with
    sharply limited accounts.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 至少目前，最好的解决方案似乎是通过一个合理简单的菜单，让客户可以连接到控制台、重启他们的机器、关闭他们的机器以及重新创建他们的domU镜像。有很多种方法可以做到这一点。我们最喜欢的方法是允许客户SSH到一个控制服务器，并拥有严格限制的账户。
- en: Xen-shell
  id: totrans-114
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Xen-shell
- en: 'Although we like our home brew approach to management as described in [Chapter 7](ch07.html
    "Chapter 7. HOSTING UNTRUSTED USERS UNDER XEN: LESSONS FROM THE TRENCHES"), there
    are other options for those who believe that software can be perfectly adequate
    even if they didn''t personally write it. Of these, our favorite is the Xen-shell.
    It''s by the author of Xen-tools and is another example of his no-frills approach.
    We recommend it, not merely because we like Xen-tools or even because it''s got
    a good feature set, because it doesn''t have a giant list of dependencies. It''s
    a simple product that does its job well.'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: '虽然我们喜欢在第 7 章（[第 7 章. 在 XEN 下托管不受信任的用户：来自战壕的经验教训](ch07.html "Chapter 7. HOSTING
    UNTRUSTED USERS UNDER XEN: LESSONS FROM THE TRENCHES")）中描述的管理方法，但对于那些认为即使他们没有亲自编写软件，软件也可以完全足够的人来说，还有其他选择。在这些选择中，我们最喜欢的是
    Xen-shell。它是 Xen-tools 的作者编写的，也是他无装饰风格的另一个例子。我们推荐它，不仅仅是因为我们喜欢 Xen-tools 或因为它有一个好的功能集，而是因为它没有庞大的依赖列表。这是一个简单但能很好地完成工作的产品。'
- en: It's available at [http://xen-tools.org/software/xen-shell/](http://xen-tools.org/software/xen-shell/).
    After you've downloaded it, use the standard unpack && make install process to
    install it.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 它可以在 [http://xen-tools.org/software/xen-shell/](http://xen-tools.org/software/xen-shell/)
    找到。下载后，使用标准的 unpack && make install 过程进行安装。
- en: 'At this point there''s some configuration that needs to be done. Xen-shell
    works by taking user commands and running `sudo xm` in response to their input.
    You''ll need to put `xm` into their path or, conversely, alter their path to include
    `xm`. We took the former approach:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，还有一些配置需要完成。Xen-shell 通过接收用户命令并对其输入做出 `sudo xm` 的响应来工作。您需要将 `xm` 添加到它们的路径中，或者相反，修改它们的路径以包含
    `xm`。我们采取了前者方法：
- en: '[PRE14]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'We also need to configure */etc/sudoers* to make sure that the users are allowed
    to use `sudo` to run `xm` on their domain (and only their domain). This entails
    quite a number of additions to the file, one for each command we want to allow:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还需要配置 */etc/sudoers*，以确保用户可以使用 `sudo` 在他们的域名上运行 `xm`（并且仅限于他们的域名）。这涉及到对文件的大量添加，每个命令一个：
- en: '[PRE15]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Then change the shell of the appropriate users to the Xen-shell. For example:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 然后将适当用户的 shell 更改为 Xen-shell。例如：
- en: '[PRE16]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'To mark that a user is allowed to administer a domain, simply add the user
    to a line in the domain config file—an elegant and ingenious solution. We''ll
    use the domain *goneril* as an example:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 要标记一个用户有权管理一个域名，只需将该用户添加到域名配置文件中的一行——这是一个优雅且巧妙的解决方案。我们将以域名 *goneril* 为例：
- en: '[PRE17]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Now, when marlowe logs in, he'll be presented with the Xen-shell interface from
    which he can execute various commands (get a list by typing **`Help`**).
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，当 marlowe 登录时，他将看到 Xen-shell 接口，他可以从该接口执行各种命令（通过输入 **`Help`** 获取列表）。
- en: Note
  id: totrans-126
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*Although Xen-shell reads domain config files to find which domains can be
    administered by a user, it doesn''t actually keep track of the config file''s
    name, as of this writing. Domain configuration filenames, to work with Xen-shell''s*
    *`boot`* *command, must be of the form* *`<domU name>.cfg`*. *Thus, goneril''s
    config file must be* /etc/xen/goneril.cfg.'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: '*尽管 Xen-shell 读取域名配置文件以查找用户可以管理的域名，但它实际上并没有跟踪配置文件的名称，截至本文写作时。为了与 Xen-shell
    的 *`boot`* 命令一起工作，域名配置文件名必须采用以下形式* *`<domU name>.cfg`*。*因此，goneril 的配置文件必须是* /etc/xen/goneril.cfg。'
- en: To extend the example, let's say that marlowe can administer multiple domains.
    Simply add the username to both domains, and use the `control` command in Xen-shell
    to switch between them. One of the niceties of Xen-shell is that the command only
    shows up if it's necessary.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 为了扩展这个例子，假设 marlowe 可以管理多个域名。只需将用户名添加到这两个域名中，并使用 Xen-shell 中的 `control` 命令在它们之间切换。Xen-shell
    的一个优点是，只有当命令必要时才会显示。
- en: '[PRE18]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: Convenient, isn't it?
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 方便，不是吗？
- en: Really, though, this is just the beginning. The client software for Xen is still
    in turmoil, with constant development by multiple factions.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，这仅仅是开始。Xen 的客户端软件仍然处于混乱之中，由多个派系不断开发。
- en: 'You may have noticed that we''ve left out a couple of prominent frontends.
    For one, we haven''t even mentioned Citrix''s offering because we cover it in
    [Chapter 11](ch11.html "Chapter 11. CITRIX XENSERVER: XEN FOR THE ENTERPRISE").
    We also haven''t addressed Amazon''s EC2, which is probably the nearest thing
    to *utility computing* at present. As always, there''s a big field of tools out
    there, and we''re just aiming to make them seem manageable and talk about what
    works for us.'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 你可能已经注意到我们遗漏了一些突出的前端。一方面，我们甚至没有提到思杰的产品，因为我们已经在[第11章](ch11.html "第11章。思杰XENSERVER：企业级XEN")中对其进行了介绍。同样，我们也没有涉及亚马逊的EC2，这可能是目前最接近*实用计算*的服务。一如既往，工具领域广阔无垠，我们的目标只是让它们看起来易于管理，并讨论对我们有效的方法。
