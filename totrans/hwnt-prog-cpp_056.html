<html><head></head><body>

<div class="calibre21" id="calibre_pb_0"/><div class="calibre1" id="calibre_toc_62">
<a name="ch04" class="calibre6" id="ch04"/>
<div class="calibre1">
<h2 class="lot-title" id="calibre_pb_1"><a name="64" class="calibre16" id="64"/><a name="ch04lev1sec28" class="calibre16" id="ch04lev1sec28"/><span class="chapter-titlelabel">Program 54: </span>Jumping off the Deep End</h2><p class="b24-bookeditorial">Why does this program leak memory?</p>
<div class="calibre1">
<pre class="literallayout-normal">
  1 /************************************************
  2  * Combine strings with a variable length       *
  3  *      string class.                           *
  4  ************************************************/
  5 #include &lt;setjmp.h&gt;
  6 #include &lt;iostream&gt;
  7 #include &lt;cstring&gt;
  8
  9 // Place to store jump information
 10 static jmp_buf top_level;
 11
 12 // Longest string combination allowed.
 13 static const unsigned int MAX_LENGTH = 30;
 14
 15 /************************************************
 16  * combine -- Combine two strings with          *
 17  *      limit checking                          *
 18  ************************************************/
 19 static std::string combine(
 20     const std::string &amp;first,   // First string
 21     const std::string &amp;second   // Second string
 22 )
 23 {
 24     // Strings put together
 25     std::string together = first + second;
 26
 27     if (together.length() &gt; MAX_LENGTH) {
 28         longjmp(top_level, 5);
 29     }
 30     return (together);
 31 }
 32
 33 int main()
 34 {
 35     std::string first("First ");
 36     int i;
 37
 38     for (i = 0; i &lt; 10; i++) {
 39
 40         // Save our place
 41         if (setjmp(top_level) == 0)
 42         {
 43             first = combine(first,
 44                     std::string("second "));
 45         } else {
 46             std::cout &lt;&lt;
 47                 "Length limit exceeded\n";
 48             break;
 49         }
 50     }
 51     return (0);
 52 }
</pre>
</div>
<p class="b24-bookeditorial">(Next <a href="LiB0120.html#282" target="_parent" class="calibre2">Hint 146</a>. <a href="LiB0121.html#564" target="_parent" class="calibre2">Answer 66</a>.)</p>
</div>
</div>



</body></html>