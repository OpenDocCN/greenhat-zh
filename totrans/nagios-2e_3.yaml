- en: Part III. The Web Interface and Other Ways to Visualize Nagios Data
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第三部分. Web界面和其他可视化Nagios数据的方法
- en: Chapter 16. The Classical Web Interface
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第16章. 经典Web界面
- en: On the right is the navigation area with the unmistakable black background,
    and the remaining area is for displaying the CGI scripts called ([Figure 16-1](../Text/ch16.html#the_subitem_unhandled_under_both_the_se
    "Figure 16-1. The subitem Unhandled under both the Service Problems and Host Problems
    menu items has only been on the start page of the Nagios Web interface since Nagios
    3.0."))-the Nagios Web interface is that simple. The start screen provides access
    to the program documentation—extremely useful if you just want to look up something
    quickly.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 右侧是带有醒目黑色背景的导航区域，其余区域用于显示被调用的CGI脚本（[图16-1](../Text/ch16.html#the_subitem_unhandled_under_both_the_se
    "图16-1. 在“服务问题”和“主机问题”菜单项下未处理的子项自Nagios 3.0以来一直位于Nagios Web界面的起始页。")）- Nagios
    Web界面就这么简单。起始屏幕提供了访问程序文档的入口——如果你只是想快速查找某些信息，这非常实用。
- en: 'Provided you have the correct access rights, the Web interface allows much
    more than just looking up information. You can run a series of commands and control
    Nagios actively: from setting a single command, to switching messages on and off,
    to restarting the server.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 只要你有正确的访问权限，Web界面允许你做的不仅仅是查找信息。你可以运行一系列命令并主动控制Nagios：从设置单个命令，到开关消息，到重启服务器。
- en: A separate book would be needed to describe all the features completely. This
    is why we will just describe the concept here on which the CGI programs are based,^([[147](#ftn.CHP-16-FN-1)])
    in this way giving you a picture of the extensive range of options available.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 要完全描述所有功能，需要单独一本书。这就是为什么我们在这里只描述CGI程序所基于的概念，^([[147](#ftn.CHP-16-FN-1)]) 以此方式向您展示可用的广泛选项。
- en: Many functions use the very same CGI program. If you move the mouse up and down
    in the navigation area shown in [Figure 16-1](../Text/ch16.html#the_subitem_unhandled_under_both_the_se
    "Figure 16-1. The subitem Unhandled under both the Service Problems and Host Problems
    menu items has only been on the start page of the Nagios Web interface since Nagios
    3.0.") and observe the status display of the browser when doing this, which reveals
    the URLs to be called, you will see that in the **Monitoring** section up to the
    **Show Hosts:** entry field, the CGI program **`status.cgi`** is always called,
    with just four exceptions. Only the parameters are different. Things are similar
    for the CGI program **`cmd.cgi`**, with which general commands can be run. The
    parameters passed specify whether a comment is to be read, or a message enabled
    or disabled, or if Nagios is to be restarted.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 许多功能使用相同的CGI程序。如果你在[图16-1](../Text/ch16.html#the_subitem_unhandled_under_both_the_se
    "图16-1. 在“服务问题”和“主机问题”菜单项下未处理的子项自Nagios 3.0以来一直位于Nagios Web界面的起始页。")所示的导航区域上下移动鼠标，并观察浏览器在此操作时的状态显示，这会揭示要调用的URL，你将看到在**监控**部分直到**显示主机**：输入字段，始终调用CGI程序**`status.cgi`**，只有四个例外。参数不同。对于CGI程序**`cmd.cgi`**，情况类似，它可以运行一般命令。传递的参数指定是否读取注释，或启用或禁用消息，或重启Nagios。
- en: '![The subitem Unhandled under both the Service Problems and Host Problems menu
    items has only been on the start page of the Nagios Web interface since Nagios
    3.0.](../Images/tagoreillycom20081104nostarchimages223844.png.jpg)'
  id: totrans-6
  prefs: []
  type: TYPE_IMG
  zh: '![The subitem Unhandled under both the Service Problems and Host Problems menu
    items has only been on the start page of the Nagios Web interface since Nagios
    3.0.](../Images/tagoreillycom20081104nostarchimages223844.png.jpg)'
- en: Figure 16-1. The subitem Unhandled under both the Service Problems and Host
    Problems menu items has only been on the start page of the Nagios Web interface
    since Nagios 3.0.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-1. 在“服务问题”和“主机问题”菜单项下未处理的子项自Nagios 3.0以来一直位于Nagios Web界面的起始页。
- en: Table 16-1. overview of CGI programs
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 表16-1. CGI程序概述
- en: '| CGI program | Description |'
  id: totrans-9
  prefs: []
  type: TYPE_TB
  zh: '| CGI程序 | 描述 |'
- en: '| --- | --- |'
  id: totrans-10
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| **`status.cgi`** | Status display in various forms; by far the most important
    CGI program ([Figure 16-10](../Text/ch16s02.html#the_overview_output_style "Figure 16-10. The
    overview output style") to [Figure 16-15](../Text/ch16s02.html#the_hostdetail_output_style
    "Figure 16-15. The hostdetail output style"), page 334.) |'
  id: totrans-11
  prefs: []
  type: TYPE_TB
  zh: '| **`status.cgi`** | 以各种形式显示状态；迄今为止最重要的CGI程序（[图16-10](../Text/ch16s02.html#the_overview_output_style
    "图16-10. 概述输出样式") 到 [图16-15](../Text/ch16s02.html#the_hostdetail_output_style
    "图16-15. 主机详细输出样式"), 第334页）。|'
- en: '| **`statusmap.cgi`** | Topological representation of the monitored host (see
    [Figure 16-27](../Text/ch16s02.html#dependencies_of_monitored_hosts_shown_g "Figure 16-27. Dependencies
    of monitored hosts shown graphically"), page 347) |'
  id: totrans-12
  prefs: []
  type: TYPE_TB
  zh: '| **`statusmap.cgi`** | 监控主机的拓扑表示（参见 [图 16-27](../Text/ch16s02.html#dependencies_of_monitored_hosts_shown_g
    "图 16-27. 以图形方式显示监控主机的依赖关系"), 第 347 页）|'
- en: '| **`statuswrl.cgi`** | Topological representation in 3D format; requires a
    VRML-capable browser and allows interactive navigation in a virtual space ([Figure 16-29](../Text/ch16s02.html#this_picture_marks_the_beginning_of_the
    "Figure 16-29. This picture marks the beginning of the tour through your own network"),
    page 349) |'
  id: totrans-13
  prefs: []
  type: TYPE_TB
  zh: '| **`statuswrl.cgi`** | 以 3D 格式表示拓扑结构；需要 VRML 兼容的浏览器，并允许在虚拟空间中进行交互式导航（[图 16-29](../Text/ch16s02.html#this_picture_marks_the_beginning_of_the
    "图 16-29. 这张图片标志着通过您的网络进行游览的开始"), 第 349 页）|'
- en: '| **`statuswml.cgi`** | Simple status page for WAP devices (cellphone) |'
  id: totrans-14
  prefs: []
  type: TYPE_TB
  zh: '| **`statuswml.cgi`** | WAP 设备（手机）的简单状态页面 |'
- en: '| extinfo.cgi | Additional information on a host or service, with the possibility
    of running commands ([Figure 16-4](../Text/ch16.html#extinfo.cgi_provides_additional_informa
    "Figure 16-4. extinfo.cgi provides additional information on the selected host"),
    page 331) |'
  id: totrans-15
  prefs: []
  type: TYPE_TB
  zh: '| extinfo.cgi | 关于主机或服务的附加信息，以及运行命令的可能性（[图 16-4](../Text/ch16.html#extinfo.cgi_provides_additional_informa
    "图 16-4. extinfo.cgi 提供关于所选主机的附加信息"), 第 331 页）|'
- en: '| cmd.cgi | Running commands ([Figure 16-23](../Text/ch16s02.html#disabling_a_service_check_with_cmd.c
    "Figure 16-23. Disabling a service check with cmd.cgi?cmd_typ=6"), page 343) |'
  id: totrans-16
  prefs: []
  type: TYPE_TB
  zh: '| cmd.cgi | 运行命令（[图 16-23](../Text/ch16s02.html#disabling_a_service_check_with_cmd.c
    "图 16-23. 使用 cmd.cgi?cmd_typ=6 禁用服务检查"), 第 343 页）|'
- en: '| tac.cgi | Overview of all services and hosts to be monitored, the **Tactical
    Overview** (see [Figure 16-26](../Text/ch16s02.html#tactical_overview_with_tac.cgi
    "Figure 16-26. Tactical overview with tac.cgi") in page 346) |'
  id: totrans-17
  prefs: []
  type: TYPE_TB
  zh: '| tac.cgi | 所有要监控的服务和主机的概述，**战术概述**（参见 [图 16-26](../Text/ch16s02.html#tactical_overview_with_tac.cgi
    "图 16-26. 使用 tac.cgi 的战术概述"), 第 346 页）|'
- en: '| outages.cgi | Network nodes that cause the failure of partial networks ([Figure 16-30](../Text/ch16s02.html#as_long_as_sis-proxy_fails_comma_nagios
    "Figure 16-30. As long as sis-proxy fails, Nagios cannot reach any hosts lying
    behind it"), page 350) |'
  id: totrans-18
  prefs: []
  type: TYPE_TB
  zh: '| outages.cgi | 导致部分网络故障的网络节点（[图 16-30](../Text/ch16s02.html#as_long_as_sis-proxy_fails_comma_nagios
    "图 16-30. 只要 sis-proxy 失败，Nagios 就无法到达其后的任何主机"), 第 350 页）|'
- en: '| config.cgi | Display of Nagios object definitions ([Figure 16-31](../Text/ch16s02.html#config.cgi_displays_the
    "Figure 16-31. config.cgi displays the current configuration of the selected object
    class—here hosts—(extract)"), page 351) |'
  id: totrans-19
  prefs: []
  type: TYPE_TB
  zh: '| config.cgi | 显示 Nagios 对象定义（[图 16-31](../Text/ch16s02.html#config.cgi_displays_the
    "图 16-31. config.cgi 显示所选对象类（此处为 hosts）的当前配置（摘录）"，第 351 页））|'
- en: '| avail.cgi | Availability report (e.g., "98 percent of all systems OK, 2 percent
    WARNING", see [Figure 16-32](../Text/ch16s02.html#an_availability_report_using_the_exampl
    "Figure 16-32. An availability report using the example of the SAP-Services service
    group"), page 352) |'
  id: totrans-20
  prefs: []
  type: TYPE_TB
  zh: '| avail.cgi | 可用性报告（例如，“所有系统中有 98% 正常，2% 警告”，参见 [图 16-32](../Text/ch16s02.html#an_availability_report_using_the_exampl
    "图 16-32. 使用 SAP-Services 服务组的示例的可用性报告"), 第 352 页）|'
- en: '| histogram.cgi | Histogram of the number of events occurring ([Figure 16-34](../Text/ch16s02.html#how_many_events_of_what_type_were_there
    "Figure 16-34. How many events of what type were there on which day?"), page 353)
    |'
  id: totrans-21
  prefs: []
  type: TYPE_TB
  zh: '| histogram.cgi | 发生事件的数量的直方图（[图 16-34](../Text/ch16s02.html#how_many_events_of_what_type_were_there
    "图 16-34. 在哪一天发生了多少种类型的事件？"), 第 353 页）|'
- en: '| History.cgi | Display of all events that have ever occurred ([Figure 16-35](../Text/ch16s02.html#history.cgi_filters_the
    "Figure 16-35. history.cgi filters the information from the log file"), page 355)
    |'
  id: totrans-22
  prefs: []
  type: TYPE_TB
  zh: '| History.cgi | 显示所有曾经发生的事件（[图 16-35](../Text/ch16s02.html#history.cgi_filters_the
    "图 16-35. history.cgi 过滤日志文件中的信息"), 第 355 页）|'
- en: '| notifications.cgi | Overview of all sent notifications ([Figure 16-36](../Text/ch16s02.html#notifications.cgi_answer
    "Figure 16-36. notifications.cgi answers the question of who gets messages when,
    about what"), page 355) |'
  id: totrans-23
  prefs: []
  type: TYPE_TB
  zh: '| notifications.cgi | 所有已发送通知的概述（[图 16-36](../Text/ch16s02.html#notifications.cgi_answer
    "图 16-36. notifications.cgi 回答了谁在何时收到关于什么的消息"), 第 355 页）|'
- en: '| showlog.cgi | Display of all log file entries ([Figure 16-37](../Text/ch16s02.html#a_blue_button_marks_information_entries
    "Figure 16-37. A blue button marks information entries, the graph changing from
    red to green stands for Nagios restarts, and the icon marked GO with a green checked
    background represents restarts of the monitoring system"), page 356) |'
  id: totrans-24
  prefs: []
  type: TYPE_TB
  zh: '| showlog.cgi | 显示所有日志文件条目 ([图16-37](../Text/ch16s02.html#a_blue_button_marks_information_entries
    "图16-37. 一个蓝色按钮标记信息条目，图表从红色变为绿色表示Nagios重启，带有绿色勾选背景的图标表示监控系统的重启"), 第356页) |'
- en: '| summary.cgi | Report of events, which can be compiled by host, service, error
    category and time period ([Figure 16-39](../Text/ch16s02.html#an_individual_report_comma_as_generated
    "Figure 16-39. An individual report, as generated by summary.cgi"), page 358)
    |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
  zh: '| summary.cgi | 事件报告，可以按主机、服务、错误类别和时间段进行编译 ([图16-39](../Text/ch16s02.html#an_individual_report_comma_as_generated
    "图16-39. 由summary.cgi生成的单个报告"), 第358页) |'
- en: '| trends.cgi | Time axis recording the states that have occurred ([Figure 16-40](../Text/ch16s02.html#trends.cgi_represents_th
    "Figure 16-40. trends.cgi represents the chronological sequence of states—here
    using the example of a service"), page 359) |'
  id: totrans-26
  prefs: []
  type: TYPE_TB
  zh: '| trends.cgi | 记录已发生状态的时序轴 ([图16-40](../Text/ch16s02.html#trends.cgi_represents_th
    "图16-40. trends.cgi表示状态的时序顺序——这里以服务为例"), 第359页) |'
- en: '[Table 16-1](../Text/ch16.html#overview_of_cgi_programs "Table 16-1. overview
    of CGI programs") shows an overview of all the CGI programs included in the package.
    They all check to see whether the person running the requested action is allowed
    to do so. Normally a user can only access the hosts and services for which he
    is entered as the contact. In addition there is the possibility of assigning specific
    users more comprehensive rights, so that they are basically allowed to display
    all hosts and services, for example, or to request system information. Settings
    for other users are made in the **`cgi.cfg`** configuration file, and the authentication
    parameters are described in [A.2 CGI Configuration in cgi.cfg](../Text/apas02.html
    "A.2 CGI Configuration in cgi.cfg"), page 606.'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '[表16-1](../Text/ch16.html#overview_of_cgi_programs "表16-1. 包含在包中的所有CGI程序概述")显示了包含在包中的所有CGI程序的概述。它们都会检查运行请求操作的人是否有权这样做。通常，用户只能访问他作为联系人登记的主机和服务的相关信息。此外，还有可能为特定用户分配更全面的权限，使他们基本上可以显示所有主机和服务，例如，或请求系统信息。其他用户的设置在**`cgi.cfg`**配置文件中完成，认证参数在[A.2
    cgi.cfg中的CGI配置](../Text/apas02.html "A.2 cgi.cfg中的CGI配置"), 第606页中描述。'
- en: 16.1 Recognizing and Acting On Problems
  id: totrans-28
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 16.1 识别和应对问题
- en: A suitable starting point for the administrator is the **Service Problems**
    page, which can be reached through the menu item, shown in [Figure 16-2](../Text/ch16.html#the_menu_item_service_problems_brings_c
    "Figure 16-2. The menu item Service Problems brings current problems to attention").
    You can see all problems at a glance. If there is just a service-related problem,
    but not a host-related one, the host name in the **Host** column has a gray background,
    but a red background means the host itself is the source of the trouble.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 对于管理员来说，一个合适的起点是**服务问题**页面，可以通过菜单项访问，如图[图16-2](../Text/ch16.html#the_menu_item_service_problems_brings_c
    "图16-2. 服务问题菜单项将当前问题提请注意")所示。您可以一目了然地看到所有问题。如果只有与服务相关的问题，但没有与主机相关的问题，**主机**列中的主机名背景为灰色，但红色背景表示主机本身是问题的来源。
- en: '![The menu item Service Problems brings current problems to attention](../Images/tagoreillycom20081104nostarchimages223846.png.jpg)'
  id: totrans-30
  prefs: []
  type: TYPE_IMG
  zh: '![服务问题菜单项将当前问题提请注意](../Images/tagoreillycom20081104nostarchimages223846.png.jpg)'
- en: Figure 16-2. The menu item Service Problems brings current problems to attention
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-2. 服务问题菜单项将当前问题提请注意
- en: 'The hosts **`sis-mail`** and **`sis-proxy`**, which have failed in [Figure 16-2](../Text/ch16.html#the_menu_item_service_problems_brings_c
    "Figure 16-2. The menu item Service Problems brings current problems to attention"),
    can be seen again in the **Host Problems** menu item ([Figure 16-3](../Text/ch16.html#the_host_problems_menu_item_reveals_thi
    "Figure 16-3. The Host Problems menu item reveals this display")): **`sis-mail`**
    cannot be reached (UNREACHABLE), so the real problem therefore exists in the failure
    of the host **`sls-proxy`**. This dependency is illustrated in the **Outages**
    menu item ([Figure 16-30](../Text/ch16s02.html#as_long_as_sis-proxy_fails_comma_nagios
    "Figure 16-30. As long as sis-proxy fails, Nagios cannot reach any hosts lying
    behind it"), page 350) or the **Status Map** ([Figure 16-27](../Text/ch16s02.html#dependencies_of_monitored_hosts_shown_g
    "Figure 16-27. Dependencies of monitored hosts shown graphically"), page 347).
    In [Figure 16-27](../Text/ch16s02.html#dependencies_of_monitored_hosts_shown_g
    "Figure 16-27. Dependencies of monitored hosts shown graphically") the two failed
    hosts are shown with a red background, and you can also clearly see which host
    is dependent on the other (always from the point of view of the central Nagios
    host).'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 主机 **`sis-mail`** 和 **`sis-proxy`**，在[图16-2](../Text/ch16.html#the_menu_item_service_problems_brings_c
    "图16-2. 菜单项“服务问题”将当前问题提请注意")中失败，现在可以在**主机问题**菜单项中再次看到它们（[图16-3](../Text/ch16.html#the_host_problems_menu_item_reveals_thi
    "图16-3. 主机问题菜单项揭示了此显示"))：**`sis-mail`**无法访问（不可达），因此真正的故障因此存在于主机 **`sls-proxy`**
    的失败中。这种依赖关系在**故障**菜单项中得到了说明（[图16-30](../Text/ch16s02.html#as_long_as_sis-proxy_fails_comma_nagios
    "图16-30. 只要 sis-proxy 失败，Nagios 就无法访问其后的任何主机"), 第350页）或**状态图**（[图16-27](../Text/ch16s02.html#dependencies_of_monitored_hosts_shown_g
    "图16-27. 以图形方式显示受监控主机的依赖关系"), 第347页）。在[图16-27](../Text/ch16s02.html#dependencies_of_monitored_hosts_shown_g
    "图16-27. 以图形方式显示受监控主机的依赖关系")中，两个失败的主机以红色背景显示，并且你可以清楚地看到哪个主机依赖于另一个主机（始终从中央Nagios主机的角度）。
- en: '![The Host Problems menu item reveals this display](../Images/tagoreillycom20081104nostarchimages223848.png.jpg)'
  id: totrans-33
  prefs: []
  type: TYPE_IMG
  zh: '![主机问题菜单项揭示了此显示](../Images/tagoreillycom20081104nostarchimages223848.png.jpg)'
- en: Figure 16-3. The Host Problems menu item reveals this display
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-3. 主机问题菜单项揭示了此显示
- en: 16.1.1 Comments on problematic hosts
  id: totrans-35
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.1.1 对有问题的主机的注释
- en: 'The administrator clarifies the problem with the external office by telephone:
    the DSL connection has failed. He announces this failure to the provider responsible.
    To stop his colleagues from going to the same trouble again, the admin enters
    a corresponding comment on the failed host. To do this he clicks in the status
    display on the host name, which takes him to an information page for this specific
    host ([Figure 16-4](../Text/ch16.html#extinfo.cgi_provides_additional_informa
    "Figure 16-4. extinfo.cgi provides additional information on the selected host")),
    the options of which are described in more detail in [16.2.2 Additional information
    and control center: extinfo.cgi](../Text/ch16s02.html#additional_information_and_control_cent
    "16.2.2 Additional information and control center: extinfo.cgi"), page 339.'
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 管理员通过电话与外部办公室澄清了问题：DSL连接已失败。他向负责的提供商宣布了这一故障。为了防止他的同事再次遇到同样的麻烦，管理员在失败的主机上输入了相应的注释。为此，他点击状态显示中的主机名，这会带他到一个特定主机的信息页面（[图16-4](../Text/ch16.html#extinfo.cgi_provides_additional_informa
    "图16-4. extinfo.cgi 提供所选主机的附加信息"))，这些选项在[16.2.2 附加信息和控制中心：extinfo.cgi](../Text/ch16s02.html#additional_information_and_control_cent
    "16.2.2 附加信息和控制中心：extinfo.cgi")中有更详细的描述，第339页。
- en: '![extinfo.cgi provides additional information on the selected host](../Images/tagoreillycom20081104nostarchimages223850.png.jpg)'
  id: totrans-37
  prefs: []
  type: TYPE_IMG
  zh: '![extinfo.cgi 提供所选主机的附加信息](../Images/tagoreillycom20081104nostarchimages223850.png.jpg)'
- en: Figure 16-4. `extinfo.cgi` provides additional information on the selected host
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-4. `extinfo.cgi` 提供所选主机的附加信息
- en: 'Using the **Add a new comment** link at the bottom of the page, the CGI program
    **`cmd.cgi`** ([16.2.3 Interface for external commands: cmd.cgi](../Text/ch16s02.html#interface_for_external_commands_colon_c
    "16.2.3 Interface for external commands: cmd.cgi"), page 343), which by passing
    on a corresponding parameter is already prepared for this task,^([[148](#ftn.CHP-16-FN-2)])
    allows a comment to be recorded ([Figure 16-5](../Text/ch16.html#entering_a_comment_for_a_host
    "Figure 16-5. Entering a comment for a host")). The host name is already shown,
    the check mark in the **Persistent** box ensures that the comments will also "survive"
    a Nagios restart. The user name filled out in the **Author (Your Name):** field
    can be edited, as can the actual comment in the **Comment** field.^([[149](#ftn.CHP-16-FN-3)])'
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 使用页面底部的**添加新注释**链接，CGI程序**`cmd.cgi`**（[16.2.3 外部命令接口：cmd.cgi](../Text/ch16s02.html#interface_for_external_commands_colon_c
    "16.2.3 外部命令接口：cmd.cgi"), 第343页），通过传递相应的参数已经为此任务做好了准备，^([[148](#ftn.CHP-16-FN-2)])
    允许记录注释（[图16-5](../Text/ch16.html#entering_a_comment_for_a_host "图16-5. 为主机添加注释")).
    主机名已经显示，**持久**框中的勾选确保注释也将“存活”在Nagios重启之后。在**作者（您的姓名）：**字段中填写的用户名可以编辑，同样，**注释**字段中的实际注释也可以编辑.^([[149](#ftn.CHP-16-FN-3)])
- en: '![Entering a comment for a host](../Images/tagoreillycom20081104nostarchimages223852.png.jpg)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![为主机添加注释](../Images/tagoreillycom20081104nostarchimages223852.png.jpg)'
- en: Figure 16-5. Entering a comment for a host
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-5. 为主机添加注释
- en: The administrator confirms the entry with the **Commit** button. Returning to
    the status overview, for example with the **Service Problems** menu item, the
    administrator will see a speech bubble next to the host name, indicating that
    a comment exists for this host ([Figure 16-6](../Text/ch16.html#a_speech_bubble_displays_the_existence
    "Figure 16-6. A speech bubble displays the existence of comments")). Clicking
    on the icon opens the corresponding information page and takes the admin directly
    to the comment entries ([Figure 16-7](../Text/ch16.html#a_click_on_delete_all_comments_deletes
    "Figure 16-7. A click on Delete all comments deletes all comments at once")).
    Clicking on the icon of the trash can in the **Actions** column deletes these
    individually, if required.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 管理员通过**提交**按钮确认输入。返回到状态概览，例如使用**服务问题**菜单项，管理员将在主机名旁边看到一个气泡，表示此主机存在注释（[图16-6](../Text/ch16.html#a_speech_bubble_displays_the_existence
    "图16-6. 一个气泡显示注释的存在")). 点击图标将打开对应的信息页面，并将管理员直接带到注释输入页面（[图16-7](../Text/ch16.html#a_click_on_delete_all_comments_deletes
    "图16-7. 点击删除所有注释将一次性删除所有注释")). 点击**操作**列中的垃圾桶图标可以单独删除这些注释，如果需要的话。
- en: '![A speech bubble displays the existence of comments](../Images/tagoreillycom20081104nostarchimages223854.png.jpg)'
  id: totrans-43
  prefs: []
  type: TYPE_IMG
  zh: '![一个气泡显示注释的存在](../Images/tagoreillycom20081104nostarchimages223854.png.jpg)'
- en: Figure 16-6. A speech bubble displays the existence of comments
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-6. 一个气泡显示注释的存在
- en: '![A click on Delete all comments deletes all comments at once](../Images/tagoreillycom20081104nostarchimages223856.png.jpg)'
  id: totrans-45
  prefs: []
  type: TYPE_IMG
  zh: '![点击删除所有注释将一次性删除所有注释](../Images/tagoreillycom20081104nostarchimages223856.png.jpg)'
- en: Figure 16-7. A click on Delete all comments deletes all comments at once
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-7. 点击删除所有注释将一次性删除所有注释
- en: 16.1.2 Taking responsibility for problems
  id: totrans-47
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.1.2 对问题承担责任
- en: '*Acknowledgements* (so spelled on the Web interface) are oriented more closely
    to the workflow than simple comments. An acknowledgement signals to other administrators
    that somebody is already working on a problem, so nobody else needs to get involved
    with it for the time being. In the status overview, a small laborer icon symbolizes
    this form of taking responsibility ([Figure 16-8](../Text/ch16.html#a_laborer_icon_shows_that_an_admin_has
    "Figure 16-8. A laborer icon shows that an admin has already taken on responsibility
    for the problem (acknowledgement)")), and Nagios additionally notifies the relevant
    contacts.'
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: '*致谢*（在Web界面上如此拼写）比简单的注释更接近工作流程。致谢信号向其他管理员表明有人已经在处理问题，因此暂时不需要其他人介入。在状态概览中，一个小工图标象征着这种承担责任的形式（[图16-8](../Text/ch16.html#a_laborer_icon_shows_that_an_admin_has
    "图16-8. 一个小工图标显示管理员已经承担了问题的责任（致谢)")), Nagios还会通知相关联系人。'
- en: To issue such a statement, the link **Acknowledge this Host Problem** is used
    on the extended info page for the host in question. As well as the fields used
    for entering a normal comment, there are two checkboxes in this case, **Sticky
    Acknowledgement** ([Figure 16-9](../Text/ch16.html#entry_dialog_for_a_host_acknowlegement
    "Figure 16-9. Entry dialog for a host acknowlegement"))—if checked, this option
    prevents period notification if the error status persists—and **Send Notification**.
    If the latter is also checked, Nagios notifies the other administrators.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 要发出此类声明，需要在相关主机的扩展信息页面上使用**“确认此主机问题”**链接。除了用于输入正常评论的字段外，此情况下还有两个复选框，**“粘性确认”**
    ([图16-9](../Text/ch16.html#entry_dialog_for_a_host_acknowlegement "图16-9. 主机确认输入对话框"))——如果选中，此选项将防止在错误状态持续时进行周期性通知——以及**“发送通知”**。如果后者也被选中，Nagios将通知其他管理员。
- en: '![A laborer icon shows that an admin has already taken on responsibility for
    the problem (acknowledgement)](../Images/tagoreillycom20081104nostarchimages223858.png.jpg)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![一个工人图标表示管理员已经承担了问题的责任（确认）](../Images/tagoreillycom20081104nostarchimages223858.png.jpg)'
- en: Figure 16-8. A laborer icon shows that an admin has already taken on responsibility
    for the problem (acknowledgement)
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-8. 一个工人图标表示管理员已经承担了问题的责任（确认）
- en: '![Entry dialog for a host acknowlegement](../Images/tagoreillycom20081104nostarchimages223860.png.jpg)'
  id: totrans-52
  prefs: []
  type: TYPE_IMG
  zh: '![主机确认输入对话框](../Images/tagoreillycom20081104nostarchimages223860.png.jpg)'
- en: Figure 16-9. Entry dialog for a host acknowlegement
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-9. 主机确认输入对话框
- en: 'The effect of **Persistent Comment** is different in Nagios 2.x and Nagios
    3.0: In Nagios 2.x the comment is only preserved on a reboot if the checkbox has
    been marked. Unfortunately, using this to save comments in case of a reboot has
    the disadvantage that the comment does not disappear automatically when the problem
    has been solved. On the other hand, Nagios 3.0 normally retains all comments after
    a reboot. If the check mark for **Persistent Comment** is deleted, Nagios will
    remove the comment automatically as soon as the problem has been rectified. If
    the check mark is set, the comment must be removed manually if it is no longer
    needed, as in Nagios 2.x.'
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '**持久性注释**在Nagios 2.x和Nagios 3.0中的效果不同：在Nagios 2.x中，只有当复选框被标记时，注释才会被保留。不幸的是，使用这种方法在重启时保存注释的缺点是，当问题解决后，注释不会自动消失。另一方面，Nagios
    3.0通常在重启后保留所有注释。如果删除**“持久性注释”**的勾选标记，Nagios将在问题得到纠正后立即自动删除注释。如果勾选标记被设置，当不再需要时，必须手动删除注释，就像在Nagios
    2.x中一样。'
- en: What we are demonstrating here, using a faulty host state, can also be applied
    to faulty services. The CGI programs are the same, and through the passing of
    parameters they receive information on whether a host or service is involved,
    and react accordingly; only the host field receives company in the form of a **Service**
    entry.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在这里使用故障主机状态进行演示的内容，也可以应用于故障服务。CGI程序是相同的，并且通过传递参数，它们会接收到有关是否涉及主机或服务的相关信息，并相应地做出反应；只有主机字段会以**服务**条目的形式获得支持。
- en: '* * *'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: '^([[147](#CHP-16-FN-1)]) There is a good reason that we refer here to CGI programs
    and not to CGI scripts: all CGI programs for Nagios 2.x and 3.0 are C programs.'
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[147](#CHP-16-FN-1)]) 我们在这里提到CGI程序而不是CGI脚本的合理原因是：Nagios 2.x和3.0的所有CGI程序都是C程序。
- en: '^([[148](#CHP-16-FN-2)]) **`cmd_type=1&host=sls-proxy`**. More on the parameters
    in [16.2.3 Interface for external commands: cmd.cgi](../Text/ch16s02.html#interface_for_external_commands_colon_c
    "16.2.3 Interface for external commands: cmd.cgi") following, page 343.'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[148](#CHP-16-FN-2)]) **`cmd_type=1&host=sls-proxy`**. 关于参数的更多内容请参阅[16.2.3
    外部命令接口：cmd.cgi](../Text/ch16s02.html#interface_for_external_commands_colon_c "16.2.3
    外部命令接口：cmd.cgi")，见第343页。
- en: ^([[149](#CHP-16-FN-3)]) Starting with Nagios 3.0, amending the author name
    can be prevented by using the parameter **`lock_author_name`** (see [A.2.2 Other
    Parameters](../Text/apas02.html#other_parameters "A.2.2 Other Parameters")).
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[149](#CHP-16-FN-3)]) 从Nagios 3.0开始，可以通过使用参数**`lock_author_name`**（参见[A.2.2
    其他参数](../Text/apas02.html#other_parameters "A.2.2 其他参数")）来防止修改作者名称。
- en: 16.2 An Overview of the Individual CGI Programs
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 16.2 各个CGI程序概述
- en: At the time of going to press, this chapter was the most extensive documentation
    on the Nagios Web interface, especially for the individual CGI scripts. But for
    reasons of space, we shall not go into every detail. If you want to know more,
    you must take a look at the source code of the scripts or look at the **`nagios-users`**^([[150](#ftn.CHP-16-FN-4)])
    mailing list. Some of these are also read by the Nagios developers, and many a
    question is answered there for which there is currently no documentation.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书付印时，这一章是关于Nagios Web界面的最全面文档，特别是针对单个CGI脚本。但由于篇幅限制，我们不会深入每个细节。如果你想要了解更多，你必须查看脚本的源代码或查看**`nagios-users`**^([[150](#ftn.CHP-16-FN-4)])邮件列表。其中一些也被Nagios开发者阅读，许多问题在那里得到了解答，而这些问题的文档目前尚不存在。
- en: '16.2.1 Variations in status display: **`status.cgi`**'
  id: totrans-62
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.2.1 状态显示的变体：**`status.cgi`**
- en: 'By far the most important CGI program, **`status.cgi`** is responsible for
    the status display. What it shows is determined by three parameter groups. The
    first one defines whether the Web page generated displays all hosts, a specific
    host, or a service group:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，最重要的CGI程序是**`status.cgi`**，它负责状态显示。显示的内容由三个参数组决定。第一个参数组定义生成的网页是否显示所有主机、特定主机或服务组：
- en: '[PRE0]'
  id: totrans-64
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: With **`host`** you can select individual hosts, and **`all`** in this case
    stands for *all hosts*. **`hostgroup`** enables a specific host group to be displayed,
    and again you can use all to stand for *all host groups*. Finally, **`servicegroup`**
    tells the CGI program to display either the individual service group given as
    a value, or **`all service groups`**, given with **`all`**.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**`host`**可以选定单个主机，而在此情况下**`all`**代表所有主机。**`hostgroup`**允许显示特定的主机组，同样你也可以使用**`all`**来代表所有主机组。最后，**`servicegroup`**指示CGI程序显示给定值的单个服务组或**`all
    service groups`**，使用**`all`**。
- en: '![The overview output style](../Images/tagoreillycom20081104nostarchimages223862.png.jpg)'
  id: totrans-66
  prefs: []
  type: TYPE_IMG
  zh: '![The overview output style](../Images/tagoreillycom20081104nostarchimages223862.png.jpg)'
- en: Figure 16-10. The `overview` output style
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-10. 概览输出样式
- en: The outputs of **`host=all`** and **`hostgroup=all`** are only different in
    their style, which is defined by the second parameter group. For **`host=all`**,
    **`style=detail`** is the default setting, and for **`hostgroup=all`**, it is
    **`style=overview.status.cgi?host=all&style=overview`** therefore delivers the
    same result as **`status.cgi?hostgroup=all`**.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host=all`**和**`hostgroup=all`**的输出在样式上有所不同，这种样式由第二个参数组定义。对于**`host=all`**，**`style=detail`**是默认设置，而对于**`hostgroup=all`**，它是**`style=overview.status.cgi?host=all&style=overview`**，因此它产生的结果与**`status.cgi?hostgroup=all`**相同。'
- en: 'Hosts that do not belong to a host group only appear in the detail view **`host=all&style=detail`**
    or **`hostgroup=all&style=hostdetail`**. All other display styles always show
    entire host groups from which individual hosts may be missing. **`status.cgi`**
    provides five possible output styles: **`overview`** represents the hosts in a
    table, but summarizes the services according to states ([Figure 16-10](../Text/ch16s02.html#the_overview_output_style
    "Figure 16-10. The overview output style")). For the host group **`SAP`**, you
    would call the corresponding display with the URL'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 不属于任何主机组的主机仅在**`host=all&style=detail`**或**`hostgroup=all&style=hostdetail`**的详细视图中出现。所有其他显示样式总是显示整个主机组，其中可能缺少单个主机。**`status.cgi`**提供了五种可能的输出样式：**`overview`**以表格形式表示主机，但根据状态总结服务（[图16-10](../Text/ch16s02.html#the_overview_output_style
    "图16-10. 概览输出样式")展示了这种情况）。对于**`SAP`**主机组，你可以通过以下URL调用相应的显示
- en: '[PRE1]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The **`style`** value **`summary`** compresses the output of **`overview: status.cgi`**
    only displays one host group for each line ([Figure 16-11](../Text/ch16s02.html#the_summary_output_style_of_nagios_2.x
    "Figure 16-11. The summary output style of Nagios 2.x") shows this for Nagios
    2.x, [Figure 16-12](../Text/ch16s02.html#the_summary_output_style_of_nagios_3.0
    "Figure 16-12. The summary output style of Nagios 3.0") for Nagios 3.0). For Nagios
    3.0, error states are distinguished as **unhandled** (no acknowledgement set)
    or **acknowledged**.'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: '**`style`**值**`summary`**压缩了**`overview: status.cgi`**的输出，仅显示每行一个主机组（[图16-11](../Text/ch16s02.html#the_summary_output_style_of_nagios_2.x
    "图16-11. Nagios 2.x的摘要输出样式")展示了Nagios 2.x的情况，[图16-12](../Text/ch16s02.html#the_summary_output_style_of_nagios_3.0
    "图16-12. Nagios 3.0的摘要输出样式")展示了Nagios 3.0的情况）。对于Nagios 3.0，错误状态被区分成**未处理**（未设置确认）或**已确认**。'
- en: '![The summary output style of Nagios 2.x](../Images/tagoreillycom20081104nostarchimages223864.png.jpg)'
  id: totrans-72
  prefs: []
  type: TYPE_IMG
  zh: '![Nagios 2.x的摘要输出样式](../Images/tagoreillycom20081104nostarchimages223864.png.jpg)'
- en: Figure 16-11. The ``*`summary`*`` output style of Nagios 2.x
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-11. Nagios 2.x的**`summary`**输出样式
- en: '![The summary output style of Nagios 3.0](../Images/tagoreillycom20081104nostarchimages223866.png.jpg)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![The summary output style of Nagios 3.0](../Images/tagoreillycom20081104nostarchimages223866.png.jpg)'
- en: Figure 16-12. The ``*`summary`*`` output style of Nagios 3.0
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 图 16-12. Nagios 3.0 的 ``*`summary`*`` 输出样式
- en: The **`grid`** style provides an extremely attractive summary in which you can
    see the status of each individual service by means of the color with which it
    is highlighted ([Figure 16-13](../Text/ch16s02.html#the_gridoutput_style "Figure 16-13. The
    grid output style")). **`detail`** shows each service in detail on a separate
    line. The **`hostdetail`** output style is limited just to host information, providing
    detailed information with one line for each host ([Figure 16-15](../Text/ch16s02.html#the_hostdetail_output_style
    "Figure 16-15. The hostdetail output style")).
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '**`grid`** 样式提供了一个非常吸引人的总结，您可以通过它所突出显示的颜色看到每个单独服务的状态（[图 16-13](../Text/ch16s02.html#the_gridoutput_style
    "图 16-13. grid 输出样式")）。**`detail`** 在单独的一行中详细显示每个服务。**`hostdetail`** 输出样式仅限于主机信息，为每个主机提供一行详细信息的详细信息（[图
    16-15](../Text/ch16s02.html#the_hostdetail_output_style "图 16-15. hostdetail 输出样式")）。'
- en: '![The grid output style](../Images/tagoreillycom20081104nostarchimages223868.png.jpg)'
  id: totrans-77
  prefs: []
  type: TYPE_IMG
  zh: '![The grid output style](../Images/tagoreillycom20081104nostarchimages223868.png.jpg)'
- en: Figure 16-13. The `grid` output style
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 图 16-13. `grid` 输出样式
- en: '![The detail output style](../Images/tagoreillycom20081104nostarchimages223870.png.jpg)'
  id: totrans-79
  prefs: []
  type: TYPE_IMG
  zh: '![The detail output style](../Images/tagoreillycom20081104nostarchimages223870.png.jpg)'
- en: Figure 16-14. The `detail` output style
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 图 16-14. `detail` 输出样式
- en: '![The hostdetail output style](../Images/tagoreillycom20081104nostarchimages223872.png.jpg)'
  id: totrans-81
  prefs: []
  type: TYPE_IMG
  zh: '![The hostdetail output style](../Images/tagoreillycom20081104nostarchimages223872.png.jpg)'
- en: Figure 16-15. The `hostdetail` output style
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 图 16-15. `hostdetail` 输出样式
- en: The third and final parameter group allows you to influence, through *selectors*,
    what states and what properties are shown by **`status.cgi`**, such as all services
    in an error state for which no acknowledgement has yet been set by an administrator
    (see [16.1.2 Taking responsibility for problems](../Text/ch16.html#taking_responsibility_for_problems
    "16.1.2 Taking responsibility for problems"), page 332). States are passed on
    with the **`hoststatustypes`** or **`servicestatustypes`** parameter, properties
    with **`hostprops`** and **`serviceprops`**. All four parameters demand numerical
    values after the equals sign, and these are summarized in [Table 16-2](../Text/ch16s02.html#possible_values_for_hoststatustypes
    "Table 16-2. Possible values for Hoststatustypes"), [Table 16-3](../Text/ch16s02.html#possible_values_for_servicestatus_type
    "Table 16-3. Possible values for Servicestatus types"), and [Table 16-4](../Text/ch16s02.html#possible_values_for_host_a
    "Table 16-4. Possible values for host and serviceprops").
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 第三个也是最后一个参数组允许您通过 *选择器* 影响由 **`status.cgi`** 显示的状态和属性，例如尚未由管理员设置确认的所有处于错误状态的服务（参见
    [16.1.2 负责问题](../Text/ch16.html#taking_responsibility_for_problems "16.1.2 负责问题")，第
    332 页）。状态通过 **`hoststatustypes`** 或 **`servicestatustypes`** 参数传递，属性通过 **`hostprops`**
    和 **`serviceprops`**。所有四个参数在等号后都需要数值，这些数值总结在 [表 16-2](../Text/ch16s02.html#possible_values_for_hoststatustypes
    "表 16-2. Hoststatustypes 的可能值")、[表 16-3](../Text/ch16s02.html#possible_values_for_servicestatus_type
    "表 16-3. Servicestatus types 的可能值") 和 [表 16-4](../Text/ch16s02.html#possible_values_for_host_a
    "表 16-4. host 和 serviceprops 的可能值") 中。
- en: Table 16-2. Possible values for `Hoststatustypes`
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 表 16-2. `Hoststatustypes` 的可能值
- en: '| Value | Description |'
  id: totrans-85
  prefs: []
  type: TYPE_TB
  zh: '| 值 | 描述 |'
- en: '| --- | --- |'
  id: totrans-86
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| 1 | PENDING (a result of the very first test planned for this host is not
    yet available) |'
  id: totrans-87
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 待定（由于为该主机计划进行的第一次测试的结果尚未可用） |'
- en: '| 2 | UP |'
  id: totrans-88
  prefs: []
  type: TYPE_TB
  zh: '| 2 | UP |'
- en: '| 4 | DOWN |'
  id: totrans-89
  prefs: []
  type: TYPE_TB
  zh: '| 4 | DOWN |'
- en: '| 8 | UNREACHABLE |'
  id: totrans-90
  prefs: []
  type: TYPE_TB
  zh: '| 8 | 不可达 |'
- en: The third and final parameter group allows *selectors* to be used to influence
    what states and properties are displayed by **`status.cgi`**, fofr instance all
    services in an error state for which no administrator has yet set an acknowledgement
    (see [16.1.2 Taking responsibility for problems](../Text/ch16.html#taking_responsibility_for_problems
    "16.1.2 Taking responsibility for problems"), page 332). Conditions are passed
    with the parameter **`hoststatustypes`** or **`servicestatustypes`**, and properties
    with the **`hostprops`** and **`serviceprops`** parameters. All four parameters
    require numerical values after the equals sign, and these are summarized in [Table 16-2](../Text/ch16s02.html#possible_values_for_hoststatustypes
    "Table 16-2. Possible values for Hoststatustypes"), [Table 16-3](../Text/ch16s02.html#possible_values_for_servicestatus_type
    "Table 16-3. Possible values for Servicestatus types"), and [Table 16-4](../Text/ch16s02.html#possible_values_for_host_a
    "Table 16-4. Possible values for host and serviceprops").
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 第三个也是最后一个参数组允许使用**选择器**来影响**`status.cgi`**显示哪些状态和属性，例如，所有尚未设置确认的故障状态的服务（参见[16.1.2
    负责问题](../Text/ch16.html#taking_responsibility_for_problems "16.1.2 负责问题"，第332页)）。条件通过参数**`hoststatustypes`**或**`servicestatustypes`**传递，属性通过**`hostprops`**和**`serviceprops`**参数传递。所有四个参数都需要等于号后的数值，这些数值总结在[表16-2](../Text/ch16s02.html#possible_values_for_hoststatustypes
    "表16-2. Hoststatustypes的可能值")、[表16-3](../Text/ch16s02.html#possible_values_for_servicestatus_type
    "表16-3. Servicestatus types的可能值")和[表16-4](../Text/ch16s02.html#possible_values_for_host_a
    "表16-4. host和serviceprops的可能值")中。
- en: Table 16-3. Possible values for `Servicestatus types`
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 表16-3. `Servicestatus types` 的可能值
- en: '| Value | Description |'
  id: totrans-93
  prefs: []
  type: TYPE_TB
  zh: '| 值 | 描述 |'
- en: '| --- | --- |'
  id: totrans-94
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| 1 | PENDING (Service was originally planned for a check, but so far no result
    is available) |'
  id: totrans-95
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 待定（服务最初计划进行检查，但迄今为止没有结果可用） |'
- en: '| 2 | OK |'
  id: totrans-96
  prefs: []
  type: TYPE_TB
  zh: '| 2 | 正常 |'
- en: '| 4 | WARNING |'
  id: totrans-97
  prefs: []
  type: TYPE_TB
  zh: '| 4 | 警告 |'
- en: '| 8 | UNKNOWN |'
  id: totrans-98
  prefs: []
  type: TYPE_TB
  zh: '| 8 | 未知 |'
- en: '| 16 | CRITICAL |'
  id: totrans-99
  prefs: []
  type: TYPE_TB
  zh: '| 16 | 严重 |'
- en: Table 16-4. Possible values for `host` and `serviceprops`
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 表16-4. `host` 和 `serviceprops` 的可能值
- en: '| Value | Description |'
  id: totrans-101
  prefs: []
  type: TYPE_TB
  zh: '| 值 | 描述 |'
- en: '| --- | --- |'
  id: totrans-102
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- |'
- en: '| 1 | Scheduled downtime (downtime planned) |'
  id: totrans-103
  prefs: []
  type: TYPE_TB
  zh: '| 1 | 计划的下线时间（计划下线） |'
- en: '| 2 | No Scheduled downtime (no downtime planned) |'
  id: totrans-104
  prefs: []
  type: TYPE_TB
  zh: '| 2 | 没有计划的下线时间（没有计划下线） |'
- en: '| 4 | Acknowledgement (status confirmed by the admin) |'
  id: totrans-105
  prefs: []
  type: TYPE_TB
  zh: '| 4 | 确认（状态已由管理员确认） |'
- en: '| 8 | No acknowledgement |'
  id: totrans-106
  prefs: []
  type: TYPE_TB
  zh: '| 8 | 没有确认 |'
- en: '| 16 | Host/Service check disabled |'
  id: totrans-107
  prefs: []
  type: TYPE_TB
  zh: '| 16 | 主机/服务检查已禁用 |'
- en: '| 32 | Host/Service check enabled |'
  id: totrans-108
  prefs: []
  type: TYPE_TB
  zh: '| 32 | 主机/服务检查已启用 |'
- en: '| 64 | Event Handler disabled |'
  id: totrans-109
  prefs: []
  type: TYPE_TB
  zh: '| 64 | 事件处理器已禁用 |'
- en: '| 128 | Event Handler enabled |'
  id: totrans-110
  prefs: []
  type: TYPE_TB
  zh: '| 128 | 事件处理器已启用 |'
- en: '| 256 | Flap Detection disabled |'
  id: totrans-111
  prefs: []
  type: TYPE_TB
  zh: '| 256 | 振荡检测已禁用 |'
- en: '| 512 | Flap Detection enabled |'
  id: totrans-112
  prefs: []
  type: TYPE_TB
  zh: '| 512 | 振荡检测已启用 |'
- en: '| 1024 | Host/Service oscillates (flapping) |'
  id: totrans-113
  prefs: []
  type: TYPE_TB
  zh: '| 1024 | 主机/服务振荡（波动） |'
- en: '| 2048 | Host/Service does not oscillate |'
  id: totrans-114
  prefs: []
  type: TYPE_TB
  zh: '| 2048 | 主机/服务不振荡 |'
- en: '| 4096 | Hosts or services currently excluded from a notification |'
  id: totrans-115
  prefs: []
  type: TYPE_TB
  zh: '| 4096 | 当前排除在通知之外的主机或服务 |'
- en: '| 8192 | Notification enabled |'
  id: totrans-116
  prefs: []
  type: TYPE_TB
  zh: '| 8192 | 通知已启用 |'
- en: '| 16384 | Passive host/service checks disabled ([Chapter 13](../Text/ch13.html
    "Chapter 13. Passive Tests with the External Command File"), page 291) |'
  id: totrans-117
  prefs: []
  type: TYPE_TB
  zh: '| 16384 | 被动主机/服务检查已禁用（[第13章](../Text/ch13.html "第13章. 使用外部命令文件进行被动测试"，第291页)）
    |'
- en: '| 32768 | Passive host/service checks enabled |'
  id: totrans-118
  prefs: []
  type: TYPE_TB
  zh: '| 32768 | 被动主机/服务检查已启用 |'
- en: '| 65536 | Hosts/services for which there is at least one result determined
    for each passive test |'
  id: totrans-119
  prefs: []
  type: TYPE_TB
  zh: '| 65536 | 至少有一个被动测试结果的主机/服务 |'
- en: '| 131072 | Hosts/services for which there is at least one active check result
    |'
  id: totrans-120
  prefs: []
  type: TYPE_TB
  zh: '| 131072 | 至少有一个活动检查结果的主机/服务 |'
- en: '| 262144 | Hosts/services in the hard state (from Nagios 3.0) |'
  id: totrans-121
  prefs: []
  type: TYPE_TB
  zh: '| 262144 | 硬状态下的主机/服务（从Nagios 3.0开始） |'
- en: '| 524288 | Hosts/services in the soft state (from Nagios 3.0) |'
  id: totrans-122
  prefs: []
  type: TYPE_TB
  zh: '| 524288 | 软状态下的主机/服务（从Nagios 3.0开始） |'
- en: 'If you want to query several states or properties simultaneously, you just
    add the specified values together: **`status.cgi?host=all&servicestatustypes=28`**
    shows all services with an error status: WARNING, UNKNOWN, and CRITICAL, that
    is, 4+8+16 = 28\. This query is identical to the **Service Problems** menu item
    in the navigation area.'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想同时查询多个状态或属性，只需将指定的值相加：**`status.cgi?host=all&servicestatustypes=28`** 显示所有具有错误状态的服务：警告、未知和严重，即
    4+8+16 = 28。此查询与导航区域中的**服务问题**菜单项相同。
- en: '**`status.cgi?hostgroup=all&hoststatustypes=12&style=hostdetail`** corresponds
    to the **Host Problems** menu item in the navigation area. It queries all hosts
    which are either DOWN or UNREACHABLE (here 4+8 = 12). Since only host information
    should be shown, but no service information, the output style is in the form of
    **`hostdetail`**.'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: '**`status.cgi?hostgroup=all&hoststatustypes=12&style=hostdetail`** 对应导航区域中的
    **主机问题** 菜单项。它查询所有处于 DOWN 或 UNREACHABLE 状态的主机（这里 4+8 = 12）。由于只应显示主机信息，而不显示服务信息，因此输出样式为
    **`hostdetail`**。'
- en: '**`status.cgi?host=all&servicestatustypes=24&serviceprops=10`** is the variation
    of the first example: only the states UNKNOWN and CRITICAL (8 + 16 = 24) are shown,
    and only those that neither show a planned downtime, nor have already been confirmed
    (2 + 8 = 10).'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: '**`status.cgi?host=all&servicestatustypes=24&serviceprops=10`** 是第一个示例的变体：仅显示状态为
    UNKNOWN 和 CRITICAL（8 + 16 = 24），并且既不显示计划停机时间，也没有已经被确认（2 + 8 = 10）。'
- en: The CGI program specifies the filter parameter each time in a separate checkbox.
    [Figure 16-16](../Text/ch16s02.html#this_information_box_shows_what_states "Figure 16-16. This
    information box shows what states and properties status.cgi should display") shows
    this for the third example.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: CGI 程序每次在单独的复选框中指定过滤器参数。[图 16-16](../Text/ch16s02.html#this_information_box_shows_what_states
    "图 16-16. 此信息框显示了 status.cgi 应显示的状态和属性")展示了第三个示例。
- en: '![This information box shows what states and properties status.cgi should display](../Images/tagoreillycom20081104nostarchimages223874.png.jpg)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![此信息框显示了 status.cgi 应显示的状态和属性](../Images/tagoreillycom20081104nostarchimages223874.png.jpg)'
- en: Figure 16-16. This information box shows what states and properties `status.cgi`
    should display
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 图 16-16. 此信息框显示了 status.cgi 应显示的状态和属性
- en: 'If you want, you can define your own navigation area to your own requirements
    or just use the existing one. The main page consists of one frame, and the navigation
    area itself is defined by a normal HTML file: **`/usr/local/nagios/share/side.html`**.^([[151](#ftn.CHP-16-FN-5)])'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您愿意，可以根据自己的需求定义自己的导航区域，或者直接使用现有的导航区域。主页由一个框架组成，导航区域本身由一个普通的 HTML 文件定义：**`/usr/local/nagios/share/side.html`**.^([[151](#ftn.CHP-16-FN-5)])
- en: One example of a changed **`side.html`** is provided on the Nagios Demo page^([[152](#ftn.CHP-16-FN-6)])
    at Netways;^([[153](#ftn.CHP-16-FN-7)]) another is the Nuvola style, shown in
    the figure in [16.6 Modern Layout with the Nuvola Style](../Text/ch16s06.html
    "16.6 Modern Layout with the Nuvola Style").
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Netways 的 Nagios 示例页面上提供了一个更改后的 **`side.html`** 示例^([[152](#ftn.CHP-16-FN-6)]);^([[153](#ftn.CHP-16-FN-7)]);
    另一个示例是图 [16.6 使用 Nuvola 风格的现代布局](../Text/ch16s06.html "16.6 使用 Nuvola 风格的现代布局")中展示的
    Nuvola 风格。
- en: '16.2.2 Additional information and control center: **`extinfo.cgi`**'
  id: totrans-131
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.2.2 额外信息和控制中心：**`extinfo.cgi`**
- en: If called with the **`host`** or **`service`** parameter, **`extinfo.cgi`**
    not only provides detailed information on a specific host ([Figure 16-4](../Text/ch16.html#extinfo.cgi_provides_additional_informa
    "Figure 16-4. extinfo.cgi provides additional information on the selected host"),
    page 331) or service, it also serves as a control center for hosts and services
    (parameter **`hostgroup`**) and for service groups (**`servicegroup`**). Depending
    on the object class for which it is called, you can run various commands from
    here.
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 如果使用 **`host`** 或 **`service`** 参数调用，**`extinfo.cgi`** 不仅提供特定主机或服务的详细信息（[图 16-4](../Text/ch16.html#extinfo.cgi_provides_additional_informa
    "图 16-4. extinfo.cgi 提供了所选主机的额外信息"), 第 331 页），还充当主机和服务（参数 **`hostgroup`**）以及服务组（**`servicegroup`**）的控制中心。根据被调用的对象类，您可以从这里运行各种命令。
- en: 'In the area on the left, the status of the host is extensively documented and
    in the box on the right—overwritten with **Host Commands**—there is a selection
    of commands that can be run. The latter commands call **`cmd.cgi`** ([16.2.3 Interface
    for external commands: cmd.cgi](../Text/ch16s02.html#interface_for_external_commands_colon_c
    "16.2.3 Interface for external commands: cmd.cgi"), page 343) and only function
    if the interface for external commands ([13.1 The Interface for External Commands](../Text/ch13.html#the_interface_for_external_commands
    "13.1 The Interface for External Commands"), page 292) is active. The lower area
    of the page allows you to enter object-specific comments, read them, and delete
    them again. The Web page that **`extinfo.cgi`** generates for services also follows
    this pattern.'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 在左侧区域，详细记录了主机的状态，而在右侧的框中——被**主机命令**覆盖——提供了可以运行的命令选择。这些命令调用**`cmd.cgi`**（[16.2.3
    外部命令接口：cmd.cgi](../Text/ch16s02.html#interface_for_external_commands_colon_c "16.2.3
    外部命令接口：cmd.cgi")，第343页）并且仅在外部命令接口（[13.1 外部命令接口](../Text/ch13.html#the_interface_for_external_commands
    "13.1 外部命令接口")，第292页）激活时才有效。页面底部允许您输入特定对象的注释、读取它们，并再次删除。**`extinfo.cgi`**为服务生成的网页也遵循此模式。
- en: 'Corresponding pages for service and host groups ([Figure 16-17](../Text/ch16s02.html#command_center_for_the_sap_host_group_c
    "Figure 16-17. Command center for the SAP host group: extinfo.cgi?type=5&hostgroup=SAP")),
    on the other hand, allow only group-specific commands to be run and do not show
    any additional information. Each command applies to the entire group, sparing
    you from a lot of mouse clicking. **Disabling notifications for all hosts in this
    hostgroup**, for example, ensures that Nagios does not send any more messages
    for hosts in this host group.'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 服务和主机组的对应页面（[图16-17](../Text/ch16s02.html#command_center_for_the_sap_host_group_c
    "图16-17. SAP主机组的命令中心：extinfo.cgi?type=5&hostgroup=SAP")），另一方面，仅允许运行特定组的命令，并且不显示任何其他信息。每个命令适用于整个组，从而节省了大量的鼠标点击。例如，**禁用此主机组中所有主机的通知**，确保Nagios不再向此主机组中的主机发送任何消息。
- en: '![Command center for the SAP host group: extinfo.cgi?type=5&hostgroup=SAP](../Images/tagoreillycom20081104nostarchimages223876.png.jpg)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![SAP主机组的命令中心：extinfo.cgi?type=5&hostgroup=SAP](../Images/tagoreillycom20081104nostarchimages223876.png.jpg)'
- en: 'Figure 16-17. Command center for the `SAP` host group: `extinfo.cgi?type=5&hostgroup=SAP`'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-17. SAP主机组的命令中心：`extinfo.cgi?type=5&hostgroup=SAP`
- en: Apart from hosts, services, and corresponding groups, the CGI program has other
    display functions, enabled by the CGI parameter **`type:`**
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 除了主机、服务和相应的组之外，CGI程序还有其他显示功能，这些功能由CGI参数**`type:`**启用
- en: '[PRE2]'
  id: totrans-138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Depending on the value specified, further parameters are required, so to display
    the service you also have to include the host name and service designation:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 根据指定的值，可能需要进一步参数，因此要显示服务，还必须包括主机名和服务标识：
- en: '**`extinfo.cgi?type=0`**'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: '**`extinfo.cgi?type=0`**'
- en: 'Shows information (such as starting time and process ID) for the Nagios process
    itself and all global parameters (normally notifications are sent, performance
    data processed, etc.; see [Figure 16-18](../Text/ch16s02.html#information_on_the_nagios_process_and_g
    "Figure 16-18. Information on the Nagios process and global settings: extinfo.cgi?type=0")).
    In the **Process Commands** box the global parameters can be changed, and Nagios
    can also be stopped and restarted.'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 显示Nagios进程本身及其所有全局参数的信息（例如启动时间和进程ID；通常包括发送通知、处理性能数据等；参见[图16-18](../Text/ch16s02.html#information_on_the_nagios_process_and_g
    "图16-18. Nagios进程和全局设置信息：extinfo.cgi?type=0"))。在**进程命令**框中可以更改全局参数，并且Nagios也可以停止和重新启动。
- en: '![Information on the Nagios process and global settings: extinfo.cgi?type=0](../Images/tagoreillycom20081104nostarchimages223878.png.jpg)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![Nagios进程和全局设置信息：extinfo.cgi?type=0](../Images/tagoreillycom20081104nostarchimages223878.png.jpg)'
- en: 'Figure 16-18. Information on the Nagios process and global settings: `extinfo.cgi?type=0`'
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-18. Nagios进程和全局设置信息：`extinfo.cgi?type=0`
- en: '**`extinfo.cgi?type=l&host=`****``*`host`*``**'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: '**`extinfo.cgi?type=l&host=`****``*`host`*``**'
- en: Shows commands and information on the **``*`host`*``** (see [Figure 16-4](../Text/ch16.html#extinfo.cgi_provides_additional_informa
    "Figure 16-4. extinfo.cgi provides additional information on the selected host"),
    page 331).
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 显示**``*`主机`*``**（参见[图16-4](../Text/ch16.html#extinfo.cgi_provides_additional_informa
    "图16-4. extinfo.cgi提供所选主机的额外信息")，第331页）的命令和信息。
- en: '**`extinfo.cgi?type=2&service=`****``*`service`*``**'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: '**`extinfo.cgi?type=2&service=`****``*`service`*``**'
- en: The same for the **``*`service`*``**.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 对于**``*`服务`*``**也是如此。
- en: '**`extinfo.cgi?type=3`**'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '**`extinfo.cgi?type=3`**'
- en: 'Shows all available host and service comments on a single page ([Figure 16-19](../Text/ch16s02.html#overview_of_all_existing_comments_colon
    "Figure 16-19. Overview of all existing comments: extinfo.cgi?type=3")).'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 在单页上显示所有可用的主机和服务评论([图16-19](../Text/ch16s02.html#overview_of_all_existing_comments_colon
    "图16-19. 所有现有评论的概述：extinfo.cgi?type=3"))。
- en: '![Overview of all existing comments: extinfo.cgi?type=3](../Images/tagoreillycom20081104nostarchimages223880.png.jpg)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
  zh: '![所有现有评论的概述：extinfo.cgi?type=3](../Images/tagoreillycom20081104nostarchimages223880.png.jpg)'
- en: 'Figure 16-19. Overview of all existing comments: `extinfo.cgi?type=3`'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-19. 所有现有评论的概述：`extinfo.cgi?type=3`
- en: '**`extinfo.cgi?type=4`**'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '**`extinfo.cgi?type=4`**'
- en: 'Provides information on the performance of Nagios, separated according to host
    and service, as well as active and passive checks ([Figure 16-20](../Text/ch16s02.html#information_on_the_performance_colon_ex
    "Figure 16-20. Information on the performance: extinfo.cgi?type= 4")).'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 提供了按主机和服务以及主动和被动检查分开的Nagios性能信息([图16-20](../Text/ch16s02.html#information_on_the_performance_colon_ex
    "图16-20. 性能信息：extinfo.cgi?type= 4"))。
- en: '![Information on the performance: extinfo.cgi?type= 4](../Images/tagoreillycom20081104nostarchimages223882.png.jpg)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![性能信息：extinfo.cgi?type= 4](../Images/tagoreillycom20081104nostarchimages223882.png.jpg)'
- en: 'Figure 16-20. Information on the performance: `extinfo.cgi?type= 4`'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-20. 性能信息：`extinfo.cgi?type= 4`
- en: The middle column reveals how many of the planned tests Nagios has already performed
    in the last 1, 5, 15, and 60 minutes. As long as there are checks for which **`normal_check_irLterval`**
    is more than five minutes, the first two values can never reach 100 percent.
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: 中间列显示了Nagios在过去1、5、15和60分钟内已经执行了多少个计划测试。只要存在**`normal_check_interval`**超过五分钟的检查，前两个值永远无法达到100%。
- en: 'The right-hand columns define the actual value for this page: **Check Execution
    Time** specifies the minimum, maximum, and average time which Nagios requires
    to perform active host and service checks. **Check Latency** measures the distance
    between the planned start and the actual running time of a test. If this delay
    is considerably larger than one or two seconds, Nagios probably has a performance
    problem. One possible cause is that the system is processing performance data
    too slowly, but low-performance hardware may also play a role here. Searching
    for the cause can sometimes turn out to be very difficult, and the original documentation^([[154](#ftn.CHP-16-FN-8)])
    provides a number of tips on the subject.'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 右侧列定义了此页的实际值：**检查执行时间**指定了Nagios执行主动主机和服务检查所需的最小、最大和平均时间。**检查延迟**衡量了测试计划开始时间和实际运行时间之间的距离。如果这种延迟明显大于一或两秒，Nagios可能存在性能问题。一个可能的原因是系统处理性能数据太慢，但低性能硬件也可能在这里发挥作用。寻找原因有时可能非常困难，原始文档^([[154](#ftn.CHP-16-FN-8)])提供了关于此主题的一些提示。
- en: '**`extinfo.cgi?type=5&hostgroup=`****``*`hostgroup`*``**'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: '**`extinfo.cgi?type=5&hostgroup=`****``*`hostgroup`*``**'
- en: 'Shows command center for a host group ([Figure 16-17](../Text/ch16s02.html#command_center_for_the_sap_host_group_c
    "Figure 16-17. Command center for the SAP host group: extinfo.cgi?type=5&hostgroup=SAP")
    in page 339).'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 显示主机组的命令中心([图16-17](../Text/ch16s02.html#command_center_for_the_sap_host_group_c
    "图16-17. SAP主机组的命令中心：extinfo.cgi?type=5&hostgroup=SAP")在第339页)。
- en: '**`extinfo.cgi?type=6`**'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: '**`extinfo.cgi?type=6`**'
- en: 'Shows all planned maintenance periods for hosts and services ([Figure 16-21](../Text/ch16s02.html#overview_of_all_planned_maintenance_per
    "Figure 16-21. Overview of all planned maintenance periods: extinfo.cgi?type=6")).'
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 显示主机和服务的所有计划维护期([图16-21](../Text/ch16s02.html#overview_of_all_planned_maintenance_per
    "图16-21. 所有计划维护期的概述：extinfo.cgi?type=6"))。
- en: '![Overview of all planned maintenance periods: extinfo.cgi?type=6](../Images/tagoreillycom20081104nostarchimages223884.png.jpg)'
  id: totrans-162
  prefs: []
  type: TYPE_IMG
  zh: '![所有计划维护期的概述：extinfo.cgi?type=6](../Images/tagoreillycom20081104nostarchimages223884.png.jpg)'
- en: 'Figure 16-21. Overview of all planned maintenance periods: `extinfo.cgi?type=6`'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-21. 所有计划维护期的概述：`extinfo.cgi?type=6`
- en: '**`extinfo.cgi?type=7`**'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: '**`extinfo.cgi?type=7`**'
- en: 'Shows an overview of all planned tests, sorted by the next implementation time
    (see [Figure 16-22](../Text/ch16s02.html#all_planned_tests_comma_sorted_by_their
    "Figure 16-22. All planned tests, sorted by their planned implementation time:
    extinfo.cgi?type=7")). Next to this, **`extinfo.cgi`** also lists the time of
    the last check.'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 显示所有计划测试的概述，按下一个实施时间排序（见[图16-22](../Text/ch16s02.html#all_planned_tests_comma_sorted_by_their
    "图16-22. 所有计划测试，按其计划实施时间排序：extinfo.cgi?type=7")）。在此旁边，**`extinfo.cgi`**还列出了上次检查的时间。
- en: The **Active Checks** column shows if the respective tests are active or not,
    and in the **`Actions`** column the planned check can be deleted or moved to a
    different time.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: '**“活动检查”**列显示相应的测试是否处于活动状态，而在**“操作”**列中可以删除计划中的检查或将检查移动到不同的时间。'
- en: '**`extinfo.cgi?type=8&servicegroup`****``*`servicegroup`*``**'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: '**`extinfo.cgi?type=8&servicegroup`****``*`servicegroup`*``**'
- en: Shows the command centre for a service group, identical in structure to the
    command center of a host group.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 显示服务组的命令中心，其结构与主机组的命令中心相同。
- en: '![All planned tests, sorted by their planned implementation time: extinfo.cgi?type=7](../Images/tagoreillycom20081104nostarchimages223886.png.jpg)'
  id: totrans-169
  prefs: []
  type: TYPE_IMG
  zh: '![所有计划中的测试，按计划实施时间排序：extinfo.cgi?type=7](../Images/tagoreillycom20081104nostarchimages223886.png.jpg)'
- en: 'Figure 16-22. All planned tests, sorted by their planned implementation time:
    `extinfo.cgi?type=7`'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-22. 所有计划中的测试，按计划实施时间排序：`extinfo.cgi?type=7`
- en: '16.2.3 Interface for external commands: **`cmd.cgi`**'
  id: totrans-171
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.2.3 外部命令接口：**`cmd.cgi`**
- en: As a real all-rounder, **`cgi.cmd`**, with some 100 functions, covers nearly
    all the possibilities that the interface provides for external commands. The **`cmd_typ`**
    parameter defines which of these the CGI program should run. The command
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 作为一名真正的全能选手，**`cgi.cmd`**，拥有大约100个功能，涵盖了接口为外部命令提供的几乎所有可能性。**`cmd_typ`**参数定义了CGI程序应该运行这些功能中的哪一个。以下命令
- en: '[PRE3]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: switches off active service checks for a specific service ([Figure 16-23](../Text/ch16s02.html#disabling_a_service_check_with_cmd.c
    "Figure 16-23. Disabling a service check with cmd.cgi?cmd_typ=6")). In order to
    describe the desired service uniquely, you must specify the host and service description.
    If you run the CGI program manually, the Web form shown queries these values,
    and if **`cmd.cgi`** is started by another CGI program, the required data is passed
    through CGI parameters. Possible parameters here are **`host`**, **`service`**,
    **`hostgroup`**, and **`servicegroup`**, which are followed by an equals (=) sign
    and then the appropriate Nagios object.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 关闭特定服务的活动服务检查（[图16-23](../Text/ch16s02.html#disabling_a_service_check_with_cmd.c
    "图16-23. 使用cmd.cgi?cmd_typ=6禁用服务检查")）。为了唯一描述所需的服务，必须指定主机和服务描述。如果手动运行CGI程序，显示的Web表单将查询这些值；如果**`cmd.cgi`**由另一个CGI程序启动，所需数据将通过CGI参数传递。此处可能的参数是**`host`**、**`service`**、**`hostgroup`**和**`servicegroup`**，后面跟着一个等号（=）和相应的Nagios对象。
- en: '![Disabling a service check with cmd.cgi?cmd_typ=6](../Images/tagoreillycom20081104nostarchimages223888.png.jpg)'
  id: totrans-175
  prefs: []
  type: TYPE_IMG
  zh: '![使用cmd.cgi?cmd_typ=6禁用服务检查](../Images/tagoreillycom20081104nostarchimages223888.png.jpg)'
- en: Figure 16-23. Disabling a service check with `cmd.cgi?cmd_typ=6`
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-23. 使用`cmd.cgi?cmd_typ=6`禁用服务检查
- en: '[Figure 16-24](../Text/ch16s02.html#the_most_important_host_and_service_rel
    "Figure 16-24. The most important host and service related codes for cmd.cgi?cmd_typ=")
    lists the most important commands which refer to a host or service, and [Figure 16-25](../Text/ch16s02.html#cmd.cgi_command_codes_fo
    "Figure 16-25. cmd.cgi command codes for global parameters") shows those that
    refer to the control of global parameters (corresponding to the values in the
    main configuration file **`nagios.cfg`**). The source code file **`include/common.h`**
    contains a complete list of all possible values, including ones that are planned
    but not yet implemented.'
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: '[图16-24](../Text/ch16s02.html#the_most_important_host_and_service_rel "图16-24.
    与cmd.cgi?cmd_typ=相关的最重要的主机和服务相关代码")列出了指向主机或服务的最重要命令，而[图16-25](../Text/ch16s02.html#cmd.cgi_command_codes_fo
    "图16-25. cmd.cgi的全局参数命令代码")显示了那些指向全局参数控制（对应于主配置文件**`nagios.cfg`**中的值）。源代码文件**`include/common.h`**包含所有可能值的完整列表，包括计划中但尚未实现的值。'
- en: 'The first column in [Figure 16-24](../Text/ch16s02.html#the_most_important_host_and_service_rel
    "Figure 16-24. The most important host and service related codes for cmd.cgi?cmd_typ=")
    and [Figure 16-25](../Text/ch16s02.html#cmd.cgi_command_codes_fo "Figure 16-25. cmd.cgi
    command codes for global parameters") describes the function of the command: **`ADD_HOST_COMMENT`**
    adds a comment to a host, and **`DISABLE_ ACTIVE_SVC_CHECK`** switches off active
    checks for a service (in abbreviated form: **`SVC`**).'
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: '[图16-24](../Text/ch16s02.html#the_most_important_host_and_service_rel "图16-24.
    与cmd.cgi?cmd_typ=相关的最重要的主机和服务相关代码")和[图16-25](../Text/ch16s02.html#cmd.cgi_command_codes_fo
    "图16-25. cmd.cgi的全局参数命令代码")的第一列描述了命令的功能：**`ADD_HOST_COMMENT`**为主机添加注释，**`DISABLE_ACTIVE_SVC_CHECK`**关闭服务的活动检查（简称为**`SVC`**）。'
- en: The columns after this specify the object type to which the respective function
    refers. To add a comment with **`ADD_HOST_COMMENT`**, you must specify the host
    in question. For this reason the function code **`1`** is shown in the Host column.
    A specific active service check can only be switched off if the matching service
    is named, so the function code **`6`** is to be found in the **Service** column.
    With **`16`** you switch off all active service checks on a host to be specified;
    there are also corresponding codes for all active service checks for a host or
    service group.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 此后的列指定了相应函数所引用的对象类型。要添加带有**`ADD_HOST_COMMENT`** 的注释，你必须指定相关的主机。因此，在主机列中显示的函数代码**`1`**。只有当匹配的服务被命名时，才能关闭特定的活动服务检查，所以函数代码**`6`**
    应该在**服务**列中找到。使用**`16`**，你可以关闭指定主机上的所有活动服务检查；也有针对主机或服务组所有活动服务检查的相应代码。
- en: With **`ACKNOWLEDGE_PROBLEM`**, an administrator confirms that he is taking
    care of a specific problem. **`33`** (Host column) refers to a host problem, and
    **`34`** (**Service** column) to a service problem. The gray fields mean that
    there is no corresponding function for host and service groups. The Web form that
    opens with **`cmd_typ=33`** ([Figure 16-9](../Text/ch16.html#entry_dialog_for_a_host_acknowlegement
    "Figure 16-9. Entry dialog for a host acknowlegement"), page 333) then allows
    a comment to be entered.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**`ACKNOWLEDGE_PROBLEM`**，管理员确认他正在处理特定问题。**`33`**（主机列）指的是主机问题，而**`34`**（**服务**列）指的是服务问题。灰色字段表示没有对应于主机和服务组的函数。当使用**`cmd_typ=33`**
    打开的网页表单时（[图16-9](../Text/ch16.html#entry_dialog_for_a_host_acknowlegement "图16-9.
    主机确认输入对话框"），第333页）允许输入注释。
- en: '![The most important host and service related codes for cmd.cgi?cmd_typ=](../Images/tagoreillycom20081104nostarchimages223890.png)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
  zh: '![cmd.cgi 最重要主机和服务相关代码？cmd_typ=](../Images/tagoreillycom20081104nostarchimages223890.png)'
- en: Figure 16-24. The most important host and service related codes for `cmd.cgi?cmd_typ=`
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-24. `cmd.cgi?cmd_typ=` 最重要主机和服务相关代码
- en: Functions that refer to global parameters ([Figure 16-25](../Text/ch16s02.html#cmd.cgi_command_codes_fo
    "Figure 16-25. cmd.cgi command codes for global parameters")) can normally only
    be switched on or off. So the value **`11`** in the **Start** column for **`NOTIFICATIONS`**
    means that this command code switches on all notifications globally, while **`12`**
    switches them off globally.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 指向全局参数的函数（[图16-25](../Text/ch16s02.html#cmd.cgi_command_codes_fo "图16-25. `cmd.cgi`
    命令代码用于全局参数"））通常只能开启或关闭。因此，**`NOTIFICATIONS`** 列中的**`11`** 表示此命令代码在全球范围内开启所有通知，而**`12`**
    则在全球范围内关闭所有通知。
- en: 'If you are not quite certain whether the determined function does what you
    really wanted, it is best to run **`cmd.cgi`** manually with the corresponding
    function code, such as shown here:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你不确定确定的函数是否真的符合你的需求，最好手动运行带有相应函数代码的**`cmd.cgi`**，例如这里所示：
- en: '[PRE4]'
  id: totrans-185
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The Web page generated in this way always has a small gray box available next
    to the required entry fields that explains the corresponding command ([Figure 16-23](../Text/ch16s02.html#disabling_a_service_check_with_cmd.c
    "Figure 16-23. Disabling a service check with cmd.cgi?cmd_typ=6"), on the right
    side of the page).
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 以这种方式生成的网页总是在所需输入字段旁边有一个小灰色框，解释相应的命令（[图16-23](../Text/ch16s02.html#disabling_a_service_check_with_cmd.c
    "图16-23. 使用 `cmd.cgi` 禁用服务检查"），在页面右侧）。
- en: '![cmd.cgi command codes for global parameters](../Images/tagoreillycom20081104nostarchimages223892.png)'
  id: totrans-187
  prefs: []
  type: TYPE_IMG
  zh: '![全局参数的 `cmd.cgi` 命令代码](../Images/tagoreillycom20081104nostarchimages223892.png)'
- en: Figure 16-25. `cmd.cgi` command codes for global parameters
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-25. `cmd.cgi` 命令代码用于全局参数
- en: '16.2.4 The most important things at a glance: **`tac.cgi`**'
  id: totrans-189
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.2.4 一目了然的最重要事项：**`tac.cgi`**
- en: As a "tactical overview," **`tac.cgi`** provides a wealth of information on
    a single Web page, displayed in a summary ([Figure 16-26](../Text/ch16s02.html#tactical_overview_with_tac.cgi
    "Figure 16-26. Tactical overview with tac.cgi")). On the left-hand side of the
    page you can see, in order of priority, first the failure of entire network ranges
    (**Network Outages**), followed by the status of hosts and services, and at the
    bottom **`tac.cgi`** lists whether individual monitoring features such as notifications
    and event handlers are active.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 作为“战术概览”，**`tac.cgi`** 在一个网页上提供了大量信息，以摘要形式显示（[图16-26](../Text/ch16s02.html#tactical_overview_with_tac.cgi
    "图16-26. 使用 `tac.cgi` 的战术概览"））。在页面的左侧，你可以按优先级顺序看到，首先是整个网络范围的故障（**网络中断**），然后是主机和服务的状态，底部**`tac.cgi`**
    列出是否启用了单个监控功能，如通知和事件处理器。
- en: Up to this final section, everything is concentrated on displaying problems.
    Provided everything is OK, the CGI merely shows the number of unproblematic services
    or hosts, highlighted in light gray (and announces **`47 Up`**, for example, in
    the **`Hosts`** box). In problem cases it distinguishes between open problems,
    which nobody has looked at yet (highlighted in red, e.g., **`2 Unhandled Problems`**
    for **`Services | Critical`**), and those for which an adminstrator has already
    taken responsibility through an acknowledgement (pink background, like **`1 Acknowledged`**
    for **Services | Unknown**). If host or service checks are disabled, these are
    also shown with a pink background, since they are problems that do not require
    the immediate attention of the admin (e.g., **`2 Disabled`** for **Services |
    Ok**).
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 到这个最后的部分，所有内容都集中在显示问题上。如果一切正常，CGI仅显示无问题的服务或主机的数量，以浅灰色突出显示（例如，在**主机**框中宣布**`47
    Up`**）。在有问题的情况下，它区分了尚未有人查看的开放问题（以红色突出显示，例如，**`2 未处理问题`**针对**服务 | 严重**），以及管理员已经通过确认承担责任的问题（粉色背景，例如，**服务
    | 未知**的**`1 已确认`**）。如果禁用了主机或服务检查，这些也会以粉色背景显示，因为它们是不需要管理员立即关注的问题（例如，**服务 | 正常**的**`2
    已禁用`**）。
- en: Enabled features in the lower parts are marked by **`tac.cgi`** in green, and
    disabled ones, in red. The vertically written green **Enabled** in **Notifications**
    means that notifications are enabled globally, whereas the red background on the
    other hand, **`2 Services Disabled`**, means that they were explicitly switched
    off for two individual services.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 在页面下方启用的功能由**`tac.cgi`**用绿色标记，禁用的功能用红色标记。在**通知**中垂直书写的绿色**启用**表示通知已全局启用，而另一方面，红色的背景**`2
    服务已禁用`**表示它们已被明确关闭了两个单独的服务。
- en: For all the problems displayed you are taken to a single overview specifically
    showing the hosts and services in question.
  id: totrans-193
  prefs: []
  type: TYPE_NORMAL
  zh: 对于显示的所有问题，你将被带到单个概览中，专门显示相关的主机和服务。
- en: '![Tactical overview with tac.cgi](../Images/tagoreillycom20081104nostarchimages223894.png.jpg)'
  id: totrans-194
  prefs: []
  type: TYPE_IMG
  zh: '![使用 tac.cgi 的战术概览](../Images/tagoreillycom20081104nostarchimages223894.png.jpg)'
- en: Figure 16-26. Tactical overview with `tac.cgi`
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-26. 使用 `tac.cgi` 的战术概览
- en: 'On the right-hand side of the page the upper box summarizes the **`extinfo.cgi?type=4`**
    (see [16.2.2 Additional information and control center: extinfo.cgi](../Text/ch16s02.html#additional_information_and_control_cent
    "16.2.2 Additional information and control center: extinfo.cgi")) Nagios performance
    data, which can be shown in detail. The bar graph beneath it shows the health
    of the entire network monitored as a percentage. If you move the mouse over one
    of the bars, you will also see the percentage as a number.'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 在页面右侧的上框总结了**`extinfo.cgi?type=4`**（参见[16.2.2 额外信息和控制中心：extinfo.cgi](../Text/ch16s02.html#additional_information_and_control_cent
    "16.2.2 额外信息和控制中心：extinfo.cgi")）Nagios性能数据，这些数据可以详细显示。下面的条形图显示了整个监控网络的健康状况，以百分比表示。如果你将鼠标悬停在任何一个条形上，你也会看到百分比数值。
- en: '16.2.5 The topological map of the network: **`statusmap.cgi`**'
  id: totrans-197
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.2.5 网络拓扑图：**`statusmap.cgi`**
- en: '**`statusmap.cgi`** ([Figure 16-27](../Text/ch16s02.html#dependencies_of_monitored_hosts_shown_g
    "Figure 16-27. Dependencies of monitored hosts shown graphically")) provides a
    view of the dependencies between the monitored hosts. Starting from the central
    Nagios server in the middle, lines connect all hosts that the server reaches directly—and
    whose host definitions do not need the **`parents`** parameter to be specified
    (see [2.3 Defining the Machines to Be Monitored, with host](../Text/ch02s03.html
    "2.3 Defining the Machines to Be Monitored, with host"), page 62.).'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: '**`statusmap.cgi`** ([图16-27](../Text/ch16s02.html#dependencies_of_monitored_hosts_shown_g
    "图16-27. 监控主机的依赖关系以图形方式显示")) 提供了监控主机之间依赖关系的视图。从中间的中央Nagios服务器开始，线条连接了服务器直接到达的所有主机——这些主机的定义不需要指定**`parents`**参数（参见[2.3
    定义要监控的机器，包括主机](../Text/ch02s03.html "2.3 定义要监控的机器，包括主机")，第62页）。'
- en: The graphics also reveal the hosts to which Nagios has only indirect access
    through other hosts. So between **`sis-mail`** and the Nagios server in [Figure 16-27](../Text/ch16s02.html#dependencies_of_monitored_hosts_shown_g
    "Figure 16-27. Dependencies of monitored hosts shown graphically") lie the hosts
    **`sis-proxy`**, **`hspvip`**, and **`pfint. sis-proxy`**, as the comment **Down**
    and the red (instead of green) background suggest, has failed. Since **`sis-mail`**
    depends on this, it is in an UNREACHABLE state, which **`statusmap.cgi`** also
    marks with a red background.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 图形还揭示了Nagios只能通过其他主机间接访问的主机。因此，在**`sis-mail`**和[图16-27](../Text/ch16s02.html#dependencies_of_monitored_hosts_shown_g
    "图16-27. 以图形方式显示的监控主机依赖关系")中的Nagios服务器之间，有主机**`sis-proxy`**、**`hspvip`**和**`pfint.
    sis-proxy`**，正如注释**Down**和红色（而不是绿色）的背景所暗示的，已经失败。由于**`sis-mail`**依赖于它，因此它处于UNREACHABLE状态，**`statusmap.cgi`**也用红色背景标记。
- en: '![Dependencies of monitored hosts shown graphically](../Images/tagoreillycom20081104nostarchimages223896.png.jpg)'
  id: totrans-200
  prefs: []
  type: TYPE_IMG
  zh: '![以图形方式显示的监控主机依赖关系](../Images/tagoreillycom20081104nostarchimages223896.png.jpg)'
- en: Figure 16-27. Dependencies of monitored hosts shown graphically
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-27. 以图形方式显示的监控主机依赖关系
- en: How Nagios arranges the hosts in the graphics is defined by the parameter **`default_statusmap_layout`**
    ([A.2.1 Authentication parameters](../Text/apas02.html#authentication_parameters
    "A.2.1 Authentication parameters")) in the configuration file **`cgi.cfg`**. The
    layout can also be changed with a selection window in the Web interface (at the
    top right in [Figure 16-28](../Text/ch16s02.html#statusmap_with_self-defined_coordinates
    "Figure 16-28. Statusmap with self-defined coordinates and icons")). The figure
    shows the demo system of Netways,^([[155](#ftn.CHP-16-FN-9)]) whose appearance
    depends on user-specific coordinates, which in this case you have to specify individually
    for each host (see [16.4.1 Extended host information](../Text/ch16s04.html#extended_host_information
    "16.4.1 Extended host information")). The question mark icon supplied by Nagios
    has been replaced with nicer pictures by the operator of the site. Coordinates
    and icons are defined with the **`hostextinfo`** object, described in more detail
    in [16.4.1 Extended host information](../Text/ch16s04.html#extended_host_information
    "16.4.1 Extended host information")).
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios如何在图形中排列主机由配置文件**`cgi.cfg`**中的参数**`default_statusmap_layout`**([A.2.1
    认证参数](../Text/apas02.html#authentication_parameters "A.2.1 认证参数"))定义。布局也可以通过Web界面中的选择窗口进行更改（在[图16-28](../Text/ch16s02.html#statusmap_with_self-defined_coordinates
    "图16-28. 带有自定义坐标和图标的状况图")的右上角）。该图显示了Netways的演示系统，其外观取决于用户特定的坐标，在这种情况下，你必须为每个主机单独指定（参见[16.4.1
    扩展主机信息](../Text/ch16s04.html#extended_host_information "16.4.1 扩展主机信息")）。Nagios提供的问号图标已被网站管理员更换为更漂亮的图片。坐标和图标由**`hostextinfo`**对象定义，在[16.4.1
    扩展主机信息](../Text/ch16s04.html#extended_host_information "16.4.1 扩展主机信息")中更详细地描述。
- en: '![Statusmap with self-defined coordinates and icons](../Images/tagoreillycom20081104nostarchimages223898.png.jpg)'
  id: totrans-203
  prefs: []
  type: TYPE_IMG
  zh: '![带有自定义坐标和图标的状况图](../Images/tagoreillycom20081104nostarchimages223898.png.jpg)'
- en: Figure 16-28. Statusmap with self-defined coordinates and icons
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-28. 带有自定义坐标和图标的状况图
- en: If you move the mouse onto a particular host, Nagios opens a yellow window at
    the top left with status information, which includes the IP address, current status
    information, and the time of the last check. At the bottom of this box, **`statusmap.cgi`**
    summarizes the states of the services running on this host.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: 如果将鼠标移至特定的主机上，Nagios将在左上角打开一个黄色窗口，显示状态信息，包括IP地址、当前状态信息和最后检查的时间。在这个框的底部，**`statusmap.cgi`**总结了在此主机上运行的服务状态。
- en: If you double-click on a particular host, Nagios branches off to the usual status
    overview, which apart from data on the host selected, also displays all the services
    belonging to this host ([Figure 16-14](../Text/ch16s02.html#the_detail_output_style
    "Figure 16-14. The detail output style") in page 336 gives an example).
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你双击特定的主机，Nagios将分支到通常的状态概述，除了所选主机的数据外，还显示属于此主机的所有服务（第336页的[图16-14](../Text/ch16s02.html#the_detail_output_style
    "图16-14. 详细输出样式")提供了一个示例）。
- en: '16.2.6 Navigation in 3D: **`statuswrl.cgi`**'
  id: totrans-207
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.2.6 3D导航：**`statuswrl.cgi`**
- en: '**`statuswrl.cgi`** allows Nagios to move through a 3D representation of the
    network plan ([Figure 16-29](../Text/ch16s02.html#this_picture_marks_the_beginning_of_the
    "Figure 16-29. This picture marks the beginning of the tour through your own network")).
    In this you can zoom on to hosts, move the overall view, rotate it, etc.'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: '**`statuswrl.cgi`** 允许Nagios在网络计划的3D表示中移动 ([图16-29](../Text/ch16s02.html#this_picture_marks_the_beginning_of_the
    "图16-29. 这张图片标志着您自己的网络之旅的开始")). 在这里，您可以放大到主机，移动整体视图，旋转等。'
- en: A VRML-capable browser is necessary for the display.^([[156](#ftn.CHP-16-FN-10)])
    Although the original documentation^([[157](#ftn.CHP-16-FN-11)]) provides links
    to the corresponding plugins, two of them are out of date, and only *Cortona*^([[158](#ftn.CHP-16-FN-12)])
    could be reached at the time of going to press. This plugin does not work under
    Linux, however; in Windows it works with Internet Explorer, and also with Netscape,
    Mozilla, and Firefox.^([[159](#ftn.CHP-16-FN-13)]) A good overview of VRML software,
    organized according to operating system and browser, is provided by the National
    Institute of Standards and Technology (NIST) on its Web site.^([[160](#ftn.CHP-16-FN-14)])
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 显示需要VRML功能的浏览器.^([[156](#ftn.CHP-16-FN-10)]) 尽管原始文档^([[157](#ftn.CHP-16-FN-11)])
    提供了对应插件的链接，但其中两个已经过时，只有 *Cortona*^([[158](#ftn.CHP-16-FN-12)]) 在印刷时可以访问。然而，这个插件在Linux下不工作；在Windows下，它与Internet
    Explorer一起工作，也可以与Netscape、Mozilla和Firefox一起工作.^([[159](#ftn.CHP-16-FN-13)]) 美国国家标准与技术研究院（NIST）在其网站上提供了一个按操作系统和浏览器组织的VRML软件的良好概述.^([[160](#ftn.CHP-16-FN-14)])
- en: 'Of the VRML plugins for Linux, *OpenVRML*,^([[161](#ftn.CHP-16-FN-15)]) and
    *free WRL*^([[162](#ftn.CHP-16-FN-16)]) are the most likely to be used. The standard
    Linux distributions usually do not include a finished package. OpenVRML is included
    in Fedora in Extras; on the homepage of freeWRL there are binary packages for
    Fedora and Ubuntu. You should not try compiling the software yourself unless you
    are an experienced system administrator or software developer: there are a large
    number of pitfalls. If you have never worked with the Java compiler before and
    have not compiled complex software packages such as Mozilla or Firefox yourself,
    then you should leave it alone.'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 在Linux的VRML插件中，*OpenVRML*、^([[161](#ftn.CHP-16-FN-15)]) 和 *free WRL*^([[162](#ftn.CHP-16-FN-16)])
    最有可能被使用。标准的Linux发行版通常不包括完整的软件包。OpenVRML包含在Fedora的Extras中；在freeWRL的主页上有Fedora和Ubuntu的二进制软件包。除非您是经验丰富的系统管理员或软件开发者，否则您不应该尝试自己编译软件：这里有很多陷阱。如果您以前从未使用过Java编译器，也没有自己编译过像Mozilla或Firefox这样的复杂软件包，那么您应该放弃。
- en: '![This picture marks the beginning of the tour through your own network](../Images/tagoreillycom20081104nostarchimages223900.png.jpg)'
  id: totrans-211
  prefs: []
  type: TYPE_IMG
  zh: '![这张图片标志着您自己的网络之旅的开始](../Images/tagoreillycom20081104nostarchimages223900.png.jpg)'
- en: Figure 16-29. This picture marks the beginning of the tour through your own
    network
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-29. 这张图片标志着您自己的网络之旅的开始
- en: But all of this is no reason to despair, since the use of 3D navigation is questionable
    anyway, especially as the 2D view of the normal status map displays all the information
    required, and displaying simple flat graphics in the browser takes up considerably
    less time than CPU-intensive 3D rendering. Before you rush into the adventure
    of compiling software yourself, we recommend that you decide for yourself, using
    the Cortona plugin, whether it is worth the effort of compiling a project like
    OpenVRML.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 但这一切都不是绝望的理由，因为3D导航的使用本身就值得怀疑，尤其是当正常状态图的2D视图已经显示了所需的所有信息，并且在浏览器中显示简单的平面图形比CPU密集型的3D渲染要快得多。在您匆忙开始自己编译软件的冒险之前，我们建议您自己决定，使用Cortona插件，编译像OpenVRML这样的项目是否值得努力。
- en: '16.2.7 Querying the status with a cell phone: **`statuswml.cgi`**'
  id: totrans-214
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.2.7 使用手机查询状态：**`statuswml.cgi`**
- en: In order to make the information provided by Nagios accessible for WAP^([[163](#ftn.CHP-16-FN-17)])-capable
    devices without a fully functional browser, **`statuswml.cgi`** generates a Web
    page in the WML format,^([[164](#ftn.CHP-16-FN-18)]) which can be displayed with
    a cellphone—provided that the Nagios server is reachable in the Internet. Apart
    from the status query for hosts and services, it also allows the CGI program to
    switch off tests and notifications and to confirm existing problems with acknowledgements.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使Nagios提供的信息对没有完全功能浏览器的WAP^([[163](#ftn.CHP-16-FN-17)])设备可访问，**`statuswml.cgi`**
    生成WML格式的网页，^([[164](#ftn.CHP-16-FN-18)]) 可以用手机显示——前提是Nagios服务器在互联网上是可访问的。除了对主机和服务的状态查询外，它还允许CGI程序关闭测试和通知，并通过对现有问题的确认来确认问题。
- en: 'You should think carefully before you make Nagios accessible over the Internet:
    Nagios makes available much sensitive data that can be misused by hackers. In
    case of doubt, you''re better off doing without it. Without direct Internet access,
    **`statuswml.cgi`** is useless, since a cellphone cannot use protected access
    methods such as a VPN tunnel. This is why we shall not introduce **`statuswml.cgi`**
    in great detail at this point.'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 在您将Nagios通过互联网访问之前，您应该仔细思考：Nagios提供了许多敏感数据，这些数据可能会被黑客滥用。如果有疑问，您最好不使用它。没有直接互联网访问，**`statuswml.cgi`**
    是无用的，因为手机无法使用如VPN隧道之类的受保护访问方法。这就是为什么我们在此处不会详细介绍**`statuswml.cgi`**。
- en: '16.2.8 Analyzing disrupted partial networks: **`outages.cgi`**'
  id: totrans-217
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.2.8 分析中断的局部网络：**`outages.cgi`**
- en: 'The CGI program **`outages.cgi`** only shows those network nodes in a host
    overview that are responsible for the failure of a partial network: In contrast
    to a status overview, as in [Figure 16-15](../Text/ch16s02.html#the_hostdetail_output_style
    "Figure 16-15. The hostdetail output style"), page 336, **`outages.cgi`** specifies
    in the **# Hosts Affected** column how many services and hosts this affects in
    each case ([Figure 16-30](../Text/ch16s02.html#as_long_as_sis-proxy_fails_comma_nagios
    "Figure 16-30. As long as sis-proxy fails, Nagios cannot reach any hosts lying
    behind it")).'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: CGI程序 **`outages.cgi`** 只显示那些导致局部网络故障的主机概览中的网络节点：与状态概览不同，如[图16-15](../Text/ch16s02.html#the_hostdetail_output_style
    "图16-15. 主机详细输出样式")，第336页，**`outages.cgi`** 在**#受影响的主机**列中指定了每种情况下影响的多少服务和主机（[图16-30](../Text/ch16s02.html#as_long_as_sis-proxy_fails_comma_nagios
    "图16-30. 只要 sis-proxy 失败，Nagios 就无法访问其后面的任何主机")）。
- en: '![As long as sis-proxy fails, Nagios cannot reach any hosts lying behind it](../Images/tagoreillycom20081104nostarchimages223902.png.jpg)'
  id: totrans-219
  prefs: []
  type: TYPE_IMG
  zh: '![只要 sis-proxy 失败，Nagios 就无法访问其后面的任何主机](../Images/tagoreillycom20081104nostarchimages223902.png.jpg)'
- en: Figure 16-30. As long as `sis-proxy` fails, Nagios cannot reach any hosts lying
    behind it
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-30. 只要 `sis-proxy` 失败，Nagios 就无法访问其后面的任何主机
- en: With the icons in the **Actions** column you call other CGI programs that selectively
    filter out information on the host shown here. From left to right, they show the
    status display in the detail view (traffic light), the topological network view
    (network tree), the 3D view (**3-D**), the trend display (graph), the log file
    entries for the host (spreadsheet), and the display of notifications which have
    been made (megaphone).
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**操作**列中的图标，您可以调用其他CGI程序，这些程序将选择性地过滤掉此处显示的主机上的信息。从左到右，它们显示了详细视图中的状态显示（交通灯）、拓扑网络视图（网络树）、3D视图（**3-D**）、趋势显示（图表）、主机日志文件条目（电子表格），以及已发出的通知的显示（扩音器）。
- en: 16.2.9 Querying the object definition with **`config.cgi`**
  id: totrans-222
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.2.9 使用 **`config.cgi`** 查询对象定义
- en: '**`config.cgi`** shows a tabular overview of the definition of all objects
    for a type that can be specified ([Figure 16-31](../Text/ch16s02.html#config.cgi_displays_the
    "Figure 16-31. config.cgi displays the current configuration of the selected object
    class—here hosts—(extract)"))—the type of object involved can be defined in the
    selection field in the top right corner. Where the consideration itself contains
    Nagios objects (in the host view **Host Check Command, Default Contact Group**,
    and—not visible in the picture—**Notification Period**), a link takes you directly
    to the configuration view of this object type.'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: '**`config.cgi`** 展示了指定类型（[图16-31](../Text/ch16s02.html#config.cgi_displays_the
    "图16-31. config.cgi显示所选对象类的当前配置——此处为hosts（提取）")）的所有对象的定义表格概览——涉及的对象类型可以在右上角的选项字段中定义。如果考虑本身包含Nagios对象（在主机视图中为**主机检查命令，默认联系人组**，以及——在图片中不可见——**通知周期**），则链接会直接带您到该对象类型的配置视图。'
- en: '![config.cgi displays the current configuration of the selected object class—here
    hosts—(extract)](../Images/tagoreillycom20081104nostarchimages223904.png.jpg)'
  id: totrans-224
  prefs: []
  type: TYPE_IMG
  zh: '![config.cgi显示所选对象类（此处为主机）的当前配置（提取）](../Images/tagoreillycom20081104nostarchimages223904.png.jpg)'
- en: Figure 16-31. `config.cgi` displays the current configuration of the selected
    object class—here hosts—(extract)
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-31. `config.cgi`显示所选对象类（此处为主机）的当前配置（提取）
- en: The CGI program does not provide any way of changing anything in the settings.
    In addition, only users who are entered in the parameter **`authorized _for_configuration_information`**
    (configuration file **`cgi.cfg`**, p. 607) have access to this view.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: CGI程序不提供任何更改设置的方法。此外，只有被列入参数**`authorized _for_configuration_information`**（配置文件**`cgi.cfg`**，第607页）的用户才有权访问此视图。
- en: '16.2.10 Availability statistics: **`avail.cgi`**'
  id: totrans-227
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.2.10 可用性统计：**`avail.cgi`**
- en: If you are monitoring systems, then you also take an interest in their availability.
    **`avail.cgi`** first asks if you are interested in **Hosts, Services, Host-groups**,
    and **Servicegroups**. After you have selected a time period, you will see an
    overview, as in [Figure 16-32](../Text/ch16s02.html#an_availability_report_using_the_exampl
    "Figure 16-32. An availability report using the example of the SAP-Services service
    group"). For **Services** and **Hosts** you can also have the availability data
    presented through **All Hosts** or **All Services** as a CSV file.
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你正在监控系统，那么你也会对其可用性感兴趣。**`avail.cgi`**首先询问你是否对**主机、服务、主机组**和**服务组**感兴趣。选择时间范围后，你将看到概述，如[图16-32](../Text/ch16s02.html#an_availability_report_using_the_exampl
    "图16-32. 使用SAP-Services服务组示例的可用性报告")所示。对于**服务**和**主机**，你还可以通过**所有主机**或**所有服务**以CSV文件的形式展示可用性数据。
- en: '**`avail.cgi`** shows the hosts involved separately from the services. How
    long a service or host remained in a particular state can be seen from the corresponding
    colored column—green for OK, yellow for WARNING, red for CRITICAL (service), DOWN
    and UNREACHABLE (host)—in percent. The column that shows how much time the status
    of a service was UNKNOWN is shown in orange. Incomplete log files are shown in
    the**Undetermined** column. If there is a value larger than zero, then there are
    periods for which Nagios cannot make a statement concerning the state.'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: '**`avail.cgi`**将主机和服务分别显示。服务或主机在特定状态下保持的时间可以通过相应的颜色列查看——绿色表示OK，黄色表示WARNING，红色表示CRITICAL（服务），DOWN和UNREACHABLE（主机）——以百分比表示。显示服务状态为UNKNOWN的时间的列以橙色显示。不完整的日志文件显示在**未确定**列中。如果存在大于零的值，则表示Nagios无法就状态发表意见的时段。'
- en: Below each table, the **Average** line specifies the average of the individual
    values. In [Figure 16-32](../Text/ch16s02.html#an_availability_report_using_the_exampl
    "Figure 16-32. An availability report using the example of the SAP-Services service
    group") the hosts involved were available 99.965 percent of the time.
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 在每个表格下方，**平均**行指定了各个值的平均值。在[图16-32](../Text/ch16s02.html#an_availability_report_using_the_exampl
    "图16-32. 使用SAP-Services服务组示例的可用性报告")中，涉及的主机有99.965%的时间是可用的。
- en: '**`avail.cgi`** shows the availability twice in each case: first as an absolute
    value for the evaluation period, and then (in brackets) with respect to the time
    during which data actually was available. As long as the **Time Undetermined**
    column displays **`0.000%`**, the two availability values match.'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: '**`avail.cgi`**在每种情况下都显示了两次可用性：首先作为评估期间的绝对值，然后（在括号中）与数据实际可用的时间相关。只要**时间未确定**列显示**`0.000%`**，两个可用性值就匹配。'
- en: '![An availability report using the example of the SAP-Services service group](../Images/tagoreillycom20081104nostarchimages223906.png.jpg)'
  id: totrans-232
  prefs: []
  type: TYPE_IMG
  zh: '![使用SAP-Services服务组示例的可用性报告](../Images/tagoreillycom20081104nostarchimages223906.png.jpg)'
- en: Figure 16-32. An availability report using the example of the `SAP-Services`
    service group
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-32. 使用`SAP-Services`服务组示例的可用性报告
- en: If you click on one of the hosts or services displayed, a detailed view will
    appear. [Figure 16-33](../Text/ch16s02.html#the_availability_of_the_host "Figure 16-33. The
    availability of the host sap-12 explained in detail") shows such a view for the
    host **`sap-12`**.
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你点击显示的某个主机或服务，将出现详细视图。[图16-33](../Text/ch16s02.html#the_availability_of_the_host
    "图16-33. 主机`sap-12`的可用性详细说明")展示了主机**`sap-12`**的此类视图。
- en: '![The availability of the host sap-12 explained in detail](../Images/tagoreillycom20081104nostarchimages223908.png.jpg)'
  id: totrans-235
  prefs: []
  type: TYPE_IMG
  zh: '![主机`sap-12`的可用性详细说明](../Images/tagoreillycom20081104nostarchimages223908.png.jpg)'
- en: Figure 16-33. The availability of the host `sap-12` explained in detail
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-33. 详细解释了主机`sap-12`的可用性
- en: On a bar diagram that shows the states over the selected period in color, there
    is detailed information on the host itself, followed by statistics on the availability
    of the service that is monitored on this host. This includes an extract from the
    log file, which only shows the relevant entries for the availability of the host;
    that is, **`HOST UP`**, **`HOST DOWN`**, or **`HOST UNREACHABLE`**. The log file
    entries are cut off by **`avail.cgi`** to save space.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 在一个显示所选期间状态的彩色条形图中，有关于主机本身的详细信息，然后是监控在此主机上运行的服务可用性的统计信息。这包括日志文件的摘录，只显示与主机可用性相关的条目；即**`HOST
    UP`**、**`HOST DOWN`**或**`HOST UNREACHABLE`**。日志文件条目由**`avail.cgi`**截断以节省空间。
- en: 16.2.11 What events occur, how often?—**`histogram.Cgi`**
  id: totrans-238
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.2.11 发生了哪些事件，频率如何？—**`histogram.Cgi`**
- en: If the state of a host or service changes, this is called an *event*. The CGI
    program **`histogram.cgi`** shows the frequency of this in different views. If
    you select **Day of the Month** as the **Breakdown type**, it illustrates what
    event took place on which day of the month, and how often ([Figure 16-34](../Text/ch16s02.html#how_many_events_of_what_type_were_there
    "Figure 16-34. How many events of what type were there on which day?")). The red
    graph in services stands for CRITICAL, the orange one for UNKNOWN, yellow for
    WARNING, and green for OK. The curve for hosts in the DOWN state is marked by
    **`histogram.cgi`** in red, that for UNREACHABLE hosts in wine-red, and the green
    line stands, as usual, for OK.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 如果主机或服务的状态发生变化，这被称为**事件**。CGI程序**`histogram.cgi`**以不同的视图显示了这种变化的频率。如果你选择**月日**作为**细分类型**，它说明了哪一天发生了什么事件，以及发生的频率（[图16-34](../Text/ch16s02.html#how_many_events_of_what_type_were_there
    "图16-34. 在哪些天发生了多少种类型的事件？")). 服务中的红色图表代表CRITICAL，橙色代表UNKNOWN，黄色代表WARNING，绿色代表OK。处于DOWN状态的主机的曲线由**`histogram.cgi`**用红色标记，不可达主机的曲线用酒红色标记，绿色线条通常代表OK。
- en: '![How many events of what type were there on which day?](../Images/tagoreillycom20081104nostarchimages223910.png.jpg)'
  id: totrans-240
  prefs: []
  type: TYPE_IMG
  zh: '![在哪些天发生了多少种类型的事件？](../Images/tagoreillycom20081104nostarchimages223910.png.jpg)'
- en: Figure 16-34. How many events of what type were there on which day?
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-34. 在哪些天发生了多少种类型的事件？
- en: If you choose the variation **Day of Week**, the Web page shows on which day
    of the week most events occur, so you can find out whether Monday really is always
    the worst day. In addition to this you can have the frequency presented by day
    (**Hour of Day**) or by the month of a year (**Month**). With **Report Period**
    you can adjust the report period. With **Assume state retention** you can adjust
    whether the previously existing states are retained and included in the evaluation
    (**`yes`**) or not (**`no`**).
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你选择“星期几”这个变化，网页将显示一周中哪一天发生的事件最多，这样你可以找出周一是否真的是最糟糕的一天。此外，你还可以按天（**小时**）或按年月（**月份**）显示频率。通过**报告周期**你可以调整报告周期。通过**假设状态保留**你可以调整是否保留并包含在评估中的先前存在的状态（**`yes`**）或不是（**`no`**）。
- en: If you have configured Nagios so that it explicitly logs the states of the monitored
    hosts and services for a restart or when the log file is changed,^([[165](#ftn.CHP-16-FN-19)])
    and if you set **`Initial states logged`** to **`yes`**, the script includes this
    explicitly in the evaluation. A **`no`** ignores the entry; **`histogram.cgi`**
    then assumes that the state after a system start is identical to that which existed
    directly before the restart.^([[166](#ftn.CHP-16-FN-20)])
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你已经配置了Nagios，以便它明确记录监控主机和服务的状态以重启或当日志文件更改时，^([[165](#ftn.CHP-16-FN-19)])并且如果你将**`Initial
    states logged`**设置为**`yes`**，脚本将明确将其包含在评估中。一个**`no`**将忽略条目；**`histogram.cgi`**随后假定系统启动后的状态与重启前直接存在的状态相同.^([[166](#ftn.CHP-16-FN-20)])
- en: '**Ignore repeated states** makes allowances if a state persists for a long
    time and therefore delivers the same result again and again. If you set yes here,
    the script evaluates it once instead of many times.'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: '**忽略重复状态**在状态长时间持续并因此反复产生相同结果时，会做出让步。如果你在这里设置为“是”，脚本将只评估一次而不是多次。'
- en: If you select the item **Hard and soft states** in **State types to graph:**,
    **`histogram.cgi`** also counts soft states. If a service changes from OK to CRITICAL,
    for example, while **`retry_check_interval`** is set to **4**,^([[167](#ftn.CHP-16-FN-21)])
    then **`histogram.cgi`** counts a total of four results, three soft and one hard.
    If you only evaluate hard states, the statistics evaluate the value 1\. If an
    error is rectified, there are no soft states; therefore the value for CRITICAL
    is usually larger that that for RECOVERY if you include soft states in the evaluation.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你选择 **`State types to graph:**** 中的 **`Hard and soft states`** 项，**`histogram.cgi`**
    也会计算软状态。例如，如果一个服务在 **`retry_check_interval`** 设置为 **4** 时从OK变为CRITICAL，那么 **`histogram.cgi`**
    会计算总共四个结果，三个软状态和一个硬状态。如果你只评估硬状态，统计值评估为1。如果错误被纠正，则没有软状态；因此，如果包含软状态在评估中，CRITICAL的值通常大于RECOVERY的值。
- en: '16.2.12 Filtering log entries after specific states: **`history.cgi`**'
  id: totrans-246
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.2.12 在特定状态后过滤日志条目：**`history.cgi`**
- en: The **`history.cgi`** script allows the states of a type (soft or hard) to be
    extracted selectively from the log file using the selection field **State type
    options** (at the top right in [Figure 16-35](../Text/ch16s02.html#history.cgi_filters_the
    "Figure 16-35. history.cgi filters the information from the log file")), and specific
    events to be extracted (all, all related to hosts, all service events, only host-recovery,
    only host-down, etc.) using **History detail level for all hosts**. The entries
    to be shown can be restricted through parameters to individual hosts, services,
    or host or service groups when the CGI program is called. So the command
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: '**`history.cgi`** 脚本允许通过选择字段 **`State type options`**（如图16-35中的顶部右侧所示[图16-35](../Text/ch16s02.html#history.cgi_filters_the
    "图16-35. history.cgi filters the information from the log file")) 选择性地从日志文件中提取某种类型（软或硬）的状态，并使用
    **`History detail level for all hosts`** 提取特定事件（所有、所有与主机相关的、所有服务事件、仅主机恢复、仅主机下线等）。当调用CGI程序时，可以通过参数限制要显示的条目到个别主机、服务或主机或服务组。因此，命令'
- en: '[PRE5]'
  id: totrans-248
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'only displays log file entries for the host **`sap-12`**. If the output should
    be restricted to a specific host, then the service description needs to be specified
    as well:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: 仅显示主机 **`sap-12`** 的日志文件条目。如果输出应限制到特定主机，则还需要指定服务描述：
- en: '[PRE6]'
  id: totrans-250
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Selecting a host and service group is done in the same way:'
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 选择主机和服务组的方式相同：
- en: '[PRE7]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: The period that **`history.cgi`** views depends on the archiving interval of
    the log file. The script always refers to the contents of an archive file. If
    you set the parameter **`log_rotation_method`** ([A.1 The Main Configuration File
    nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1 The
    Main Configuration File nagios.cfg")) in the configuration file **`nagios.cfg`**
    to **`d`** for daily archiving, the Web page presents the entries for one day.
    Using the arrows (at the top in [Figure 16-35](../Text/ch16s02.html#history.cgi_filters_the
    "Figure 16-35. history.cgi filters the information from the log file")) you can
    then scroll up and down through the days.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: '**`history.cgi`** 视图所显示的周期取决于日志文件的存档间隔。脚本始终引用存档文件的内容。如果你在配置文件 **`nagios.cfg`**
    中将参数 **`log_rotation_method`** ([A.1 主配置文件 nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件 nagios.cfg")) 设置为 **`d`** 以进行每日存档，网页将显示一天的条目。使用箭头（如图16-35中的顶部所示[图16-35](../Text/ch16s02.html#history.cgi_filters_the
    "图16-35. history.cgi filters the information from the log file"))，你可以上下滚动查看不同日期。'
- en: '![history.cgi filters the information from the log file](../Images/tagoreillycom20081104nostarchimages223912.png.jpg)'
  id: totrans-254
  prefs: []
  type: TYPE_IMG
  zh: '![history.cgi filters the information from the log file](../Images/tagoreillycom20081104nostarchimages223912.png.jpg)'
- en: Figure 16-35. `history.cgi` filters the information from the log file
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-35. `history.cgi` 过滤日志文件中的信息
- en: 16.2.13 Who was told what, when?— **`notifications.Cgi`**
  id: totrans-256
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.2.13 谁被告知了什么，何时？— **`notifications.Cgi`**
- en: 'Another filtered view of the log file is offered by **`notifications.cgi:`**
    It shows all sent messages. Here the view can aso be restricted to a specific
    message group, through the selection field at the top right in [Figure 16-36](../Text/ch16s02.html#notifications.cgi_answer
    "Figure 16-36. notifications.cgi answers the question of who gets messages when,
    about what"): to all notifications involving hosts, to all which are about services
    in a critical state, and so on.'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 日志文件还提供了一个过滤视图：**`notifications.cgi:`** 它显示了所有已发送的消息。在这里，视图也可以通过右上角的选项字段限制到特定的消息组，如[图16-36](../Text/ch16s02.html#notifications.cgi_answer
    "图16-36. notifications.cgi answers the question of who gets messages when, about
    what")：涉及所有主机的通知，关于处于关键状态的服务等。
- en: '![notifications.cgi answers the question of who gets messages when, about what](../Images/tagoreillycom20081104nostarchimages223914.png.jpg)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![`notifications.cgi` 回答了谁在何时收到关于什么的消息的问题](../Images/tagoreillycom20081104nostarchimages223914.png.jpg)'
- en: Figure 16-36. `notifications.cgi` answers the question of who gets messages
    when, about what
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-36. `notifications.cgi` 回答了谁在何时收到关于什么的消息的问题
- en: 'If you just want to see messages here concerning particular hosts and services,
    you must again specify this with parameters when running the CGI program:'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你只想看到有关特定主机和服务的消息，你必须再次在运行CGI程序时使用参数来指定：
- en: '[PRE8]'
  id: totrans-261
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: Apart from **`host`** and **`service`**, you can also select a particular contact,
    but selecting host or service groups is not possible.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 除了 **`host`** 和 **`service`**，你还可以选择特定的联系人，但选择主机或服务组是不可能的。
- en: '16.2.14 Showing all log file entries: **`showlog.cgi`**'
  id: totrans-263
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.2.14 显示所有日志文件条目：**`showlog.cgi`**
- en: 'The CGI program **`showlog.cgi`** shows the log file as it is, with the few
    colored icons added to help you find your way: a red button marks critical service
    states or DOWN/UNREACHABLE hosts, a yellow button marks WARNINGs, and a green
    one, OK. Other buttons refer to information entries or Nagios restarts ([Figure 16-37](../Text/ch16s02.html#a_blue_button_marks_information_entries
    "Figure 16-37. A blue button marks information entries, the graph changing from
    red to green stands for Nagios restarts, and the icon marked GO with a green checked
    background represents restarts of the monitoring system")).'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: CGI程序 **`showlog.cgi`** 以原始形式显示日志文件，并添加了一些彩色图标以帮助你找到方向：一个红色按钮标记关键服务状态或DOWN/UNREACHABLE主机，一个黄色按钮标记WARNING，一个绿色按钮标记OK。其他按钮指的是信息条目或Nagios重启([图16-37](../Text/ch16s02.html#a_blue_button_marks_information_entries
    "图16-37. 一个蓝色按钮标记信息条目，图表从红色变为绿色表示Nagios重启，带有绿色勾选背景的GO图标表示监控系统的重启")).
- en: 'You only have a single option here: the chronological order. Normally **`showlog.cgi`**
    shows the newest entries first. If you enable the check mark in **Older Entries
    First:** (top right), the oldest entries will be shown first.'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 你在这里只有一个选项：按时间顺序。通常 **`showlog.cgi`** 首先显示最新的条目。如果你启用“旧条目优先：”（右上角）的复选框，则首先显示最旧的条目。
- en: 'The period represented here also depends on the archiving method: if you archive
    once a day, you will obtain just one day for each Web page. To reach the entries
    for other days you must make your way through the individual archive files of
    the log file using the arrows at the top of the picture.'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 这里表示的周期也取决于归档方法：如果你每天归档一次，每个网页将只获得一天的数据。要访问其他日期的条目，你必须使用图片顶部的箭头浏览日志文件的各个归档文件。
- en: '![A blue button marks information entries, the graph changing from red to green
    stands for Nagios restarts, and the icon marked GO with a green checked background
    represents restarts of the monitoring system](../Images/tagoreillycom20081104nostarchimages223916.png.jpg)'
  id: totrans-267
  prefs: []
  type: TYPE_IMG
  zh: '![一个蓝色按钮标记信息条目，图表从红色变为绿色表示Nagios重启，带有绿色勾选背景的GO图标表示监控系统的重启](../Images/tagoreillycom20081104nostarchimages223916.png.jpg)'
- en: Figure 16-37. A blue button marks information entries, the graph changing from
    red to green stands for Nagios restarts, and the icon marked GO with a green checked
    background represents restarts of the monitoring system
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-37. 一个蓝色按钮标记信息条目，图表从红色变为绿色表示Nagios重启，带有绿色勾选背景的GO图标表示监控系统的重启
- en: '16.2.15 Evaluating whatever you want: **`summary.cgi`**'
  id: totrans-269
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.2.15 评估你想要的任何内容：**`summary.cgi`**
- en: If the display and selection options are introduced so far are not sufficient
    for you, you can create your own report with **`summary.cgi`**, which generates
    the selection dialog shown in [Figure 16-38](../Text/ch16s02.html#selection_template_for_parameters_in
    "Figure 16-38. Selection template for parameters in summary.cgi"). The upper section,
    **Standard Reports:**, provides a quick summary in which just one fixed report
    type can be selected. Clicking on the button directly below this generates the
    report.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 如果迄今为止引入的显示和选择选项不足以满足你的需求，你可以使用 **`summary.cgi`** 创建自己的报告，该报告生成[图16-38](../Text/ch16s02.html#selection_template_for_parameters_in
    "图16-38. summary.cgi中参数的选择模板")中显示的选择对话框。**标准报告：**部分提供了一个快速总结，其中只能选择一种固定的报告类型。点击此按钮下方直接生成的报告。
- en: The second section is more sophisticated. The field **Report Type:** with the
    report type **Most Recent Alerts** provides an individual listing of the last
    **`n`** of individual events. The number **`n`** is defined further down in the
    selection dialog in **Max List Items:**.^([[168](#ftn.CHP-16-FN-22)]) **Report
    Type:** can also be used to show all events individually on a separate line, with
    **Most Recent Alerts**, or you can have statistics displayed, for the number of
    events that have occurred overall, for each host group, etc., with **Alert Totals,
    Alert Totals by Hostgroups**, etc.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 第二部分更为复杂。**报告类型:** 字段，与 **最近警报** 报告类型一起，提供了最后 **`n`** 个单独事件的个别列表。数字 **`n`**
    在选择对话框的 **最大列表项数:** 下进一步定义。**报告类型:** 也可以用来在单独的一行上显示所有事件，使用 **最近警报**，或者您可以选择显示统计信息，例如总体发生的事件数量、每个主机组的数量等，使用
    **警报总数、按主机组划分的警报总数** 等。
- en: 'One particularly interesting report type is **Top Alert Producer**: such reports
    show in a hit list of who has caused most trouble during the report period.'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 一个特别有趣的报告类型是 **顶级警报生成者**：此类报告显示在报告期间造成最多麻烦的人的点击列表。
- en: In **Report Period:** you can either choose the desired report period from predefined
    intervals (this week, the past seven days, this month, last week, last month,
    etc.), or you can specify **`CUSTOM REPORT PERIOD`** and define any period you
    choose. If you forget to specify **`CUSTOM REPORT PERIOD`** explicitly, the CGI
    program ignores the dates you have set and selects what is currently entered in
    **Report Period**.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 在 **报告期间:** 您可以从预定义的间隔中选择所需的报告期间（本周、过去七天、本月、上周、上个月等），或者您可以选择 **`自定义报告期间`** 并定义您选择的任何时间段。如果您忘记明确指定
    **`自定义报告期间`**，CGI程序将忽略您设置的日期，并选择当前在 **报告期间** 中输入的内容。
- en: '![Selection template for parameters in summary.cgi](../Images/tagoreillycom20081104nostarchimages223918.png.jpg)'
  id: totrans-274
  prefs: []
  type: TYPE_IMG
  zh: '![summary.cgi 中参数的选择模板](../Images/tagoreillycom20081104nostarchimages223918.png.jpg)'
- en: Figure 16-38. Selection template for parameters in `summary.cgi`
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-38. `summary.cgi` 中参数的选择模板
- en: 'The details that follow the report period filter according to host, services
    or their groups, state types, and/or individual states (e.g., only services in
    a CRITICAL state). It is important to specify **Max List Items** at the end: **`summary.cgi`**
    always shows only as many entries as are specified here. The default is a little
    small; if you want all the entries in the selected period to be shown, you should
    enter **`0`** as the value. The largest value that can be given explicitly here
    is 999\. The **Create Summary Report!** button then generates the requested report
    ([Figure 16-39](../Text/ch16s02.html#an_individual_report_comma_as_generated "Figure 16-39. An
    individual report, as generated by summary.cgi")).'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 随后的报告期间细节根据主机、服务或其组、状态类型和/或单个状态（例如，仅处于CRITICAL状态的服务）进行筛选。在最后指定 **最大列表项数** 很重要：**`summary.cgi`**
    总是只显示在此处指定的条目数。默认值有点小；如果您想显示所选期间的所有条目，您应将值输入为 **`0`**。此处可以明确给出的最大值是 999。然后，**创建摘要报告!**
    按钮生成所需的报告（[图16-39](../Text/ch16s02.html#an_individual_report_comma_as_generated
    "图16-39. 由 summary.cgi 生成的个人报告")）。
- en: 'The header of the report contains details of the report period and the selection
    made. The detail directly above the table is interesting: **Displaying most recent
    25 of 3721 total matching alerts** shows that the selection criteria matched a
    total of 3721 entries, but that the CGI script restricted the output to the 25
    most current entries, thanks to **Max List Items:**.'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 报告的标题包含报告期间和所做选择的详细信息。表格直接上方的细节很有趣：**显示最近的25条，共3721条匹配警报**表明选择标准匹配了总共3721条条目，但由于
    **最大列表项数** 的限制，CGI脚本只输出了最近的25条条目。
- en: '![An individual report, as generated by summary.cgi](../Images/tagoreillycom20081104nostarchimages223920.png.jpg)'
  id: totrans-278
  prefs: []
  type: TYPE_IMG
  zh: '![由 summary.cgi 生成的个人报告](../Images/tagoreillycom20081104nostarchimages223920.png.jpg)'
- en: Figure 16-39. An individual report, as generated by `summary.cgi`
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-39. 由 `summary.cgi` 生成的个人报告
- en: '16.2.16 Following states graphically over time: **`trends.Cgi`**'
  id: totrans-280
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.2.16 随时间图形化跟踪：**`trends.Cgi`**
- en: A rapid overview of what state occurred when for a particular host or service
    is provided by the graphic output of **`trends.cgi`** ([Figure 16-40](../Text/ch16s02.html#trends.cgi_represents_th
    "Figure 16-40. trends.cgi represents the chronological sequence of states—here
    using the example of a service")). After selecting a specific host or service,
    you can define a period, as with **`summary.cgi`**. The states are color-coded
    by **`trends.cgi`**, which makes the overview easier to follow.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 图形输出 **`trends.cgi`** ([图16-40](../Text/ch16s02.html#trends.cgi_represents_th
    "图16-40. `trends.cgi` 表示状态的时序序列——这里以服务为例")) 提供了特定主机或服务何时发生状态的快速概述。选择特定的主机或服务后，可以定义一个周期，就像在
    **`summary.cgi`** 中一样。状态由 **`trends.cgi`** 进行颜色编码，这使得概述更容易跟随。
- en: The zoom function of the CGI program is an interesting detail. If you click
    in the colored area on a particular section, the selected area is enlarged or
    reduced in size by the zoom factor specified at the top right. Negative entries
    (**`−1, −2, −3`**, and **−4** are possible) expand the report period instead of
    reducing it.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: CGI程序的缩放功能是一个有趣的细节。如果你在特定部分的彩色区域点击，所选区域会根据右上角指定的缩放因子放大或缩小。负数输入（**`−1, −2, −3`**
    和 **`−4`**）会扩展报告期而不是减少它。
- en: '![trends.cgi represents the chronological sequence of states—here using the
    example of a service](../Images/tagoreillycom20081104nostarchimages223922.png.jpg)'
  id: totrans-283
  prefs: []
  type: TYPE_IMG
  zh: '![`trends.cgi` 表示状态的时序序列——这里以服务为例](../Images/tagoreillycom20081104nostarchimages223922.png.jpg)'
- en: Figure 16-40. `trends.cgi` represents the chronological sequence of states—here
    using the example of a service
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-40. `trends.cgi` 表示状态的时序序列——这里以服务为例
- en: '* * *'
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[150](#CHP-16-FN-4)]) [http://lists.sourceforge.net/mailman/listinfo/nagios-users](http://lists.sourceforge.net/mailman/listinfo/nagios-users)
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[150](#CHP-16-FN-4)]) [http://lists.sourceforge.net/mailman/listinfo/nagios-users](http://lists.sourceforge.net/mailman/listinfo/nagios-users)
- en: ^([[151](#CHP-16-FN-5)]) If you have kept to the installation in this book.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[151](#CHP-16-FN-5)]) 如果您一直按照本书中的安装说明进行。
- en: ^([[152](#CHP-16-FN-6)]) [http://nagios-demo.netways.de/](http://nagios-demo.netways.de/)
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[152](#CHP-16-FN-6)]) [http://nagios-demo.netways.de/](http://nagios-demo.netways.de/)
- en: ^([[153](#CHP-16-FN-7)]) [http://www.netways.de/](http://www.netways.de/)
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[153](#CHP-16-FN-7)]) [http://www.netways.de/](http://www.netways.de/)
- en: ^([[154](#CHP-16-FN-8)]) **`/usr/local/nagios/share/docs/tuning.html`**
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[154](#CHP-16-FN-8)]) **`/usr/local/nagios/share/docs/tuning.html`**
- en: ^([[155](#CHP-16-FN-9)]) [http://netways.de/Demosystem.1621.0.html](http://netways.de/Demosystem.1621.0.html)
  id: totrans-291
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[155](#CHP-16-FN-9)]) [http://netways.de/Demosystem.1621.0.html](http://netways.de/Demosystem.1621.0.html)
- en: ^([[156](#CHP-16-FN-10)]) The *Virtual Reality Markup Language* (VRML), version
    2.0/1997, is used to describe the virtual "space."
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[156](#CHP-16-FN-10)]) 虚拟现实标记语言（VRML），版本2.0/1997，用于描述虚拟“空间”。
- en: ^([[157](#CHP-16-FN-11)]) **`/usr/local/nagios/share/docs/cgis.html#statuswrl_cgi`**
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[157](#CHP-16-FN-11)]) **`/usr/local/nagios/share/docs/cgis.html#statuswrl_cgi`**
- en: ^([[158](#CHP-16-FN-12)]) [http://www.parallelgrafics.com/products/cortona](http://www.parallelgrafics.com/products/cortona)
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[158](#CHP-16-FN-12)]) [http://www.parallelgrafics.com/products/cortona](http://www.parallelgrafics.com/products/cortona)
- en: ^([[159](#CHP-16-FN-13)]) For Firefox you have to install it manually, select
    **Custom** instead of **Typical** in the installation routine, and in **not supported
    browsers** specify the plugin directory of the browser.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[159](#CHP-16-FN-13)]) 对于Firefox，您需要手动安装，在安装过程中选择 **自定义** 而不是 **典型**，并在 **不支持的浏览器**
    中指定浏览器的插件目录。
- en: ^([[160](#CHP-16-FN-14)]) [http://cic.nist.gov/vrml/vbdetect.html](http://cic.nist.gov/vrml/vbdetect.html)
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[160](#CHP-16-FN-14)]) [http://cic.nist.gov/vrml/vbdetect.html](http://cic.nist.gov/vrml/vbdetect.html)
- en: ^([[161](#CHP-16-FN-15)]) [http://www.openvrml.org/](http://www.openvrml.org/)
  id: totrans-297
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[161](#CHP-16-FN-15)]) [http://www.openvrml.org/](http://www.openvrml.org/)
- en: ^([[162](#CHP-16-FN-16)]) [http://freewrl. sourcef orge. net/](http://freewrl.%20sourcef%20orge.%20net/)
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[162](#CHP-16-FN-16)]) [http://freewrl.sourcef orge. net/](http://freewrl.%20sourcef%20orge.%20net/)
- en: ^([[163](#CHP-16-FN-17)]) *Wireless Access Protocol*.
  id: totrans-299
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[163](#CHP-16-FN-17)]) 无线接入协议。
- en: ^([[164](#CHP-16-FN-18)]) The *Wireless Markup Language* contains a part of
    HTML, heavily reduced in its functionality.
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[164](#CHP-16-FN-18)]) 无线标记语言包含HTML的一部分，其功能大大减少。
- en: ^([[165](#CHP-16-FN-19)]) Parameter **`log_initial_state`** in **`nagios.cfg;`**
    see page 597.
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[165](#CHP-16-FN-19)]) 在 **`nagios.cfg;`** 中的参数 **`log_initial_state`**，见第597页。
- en: ^([[166](#CHP-16-FN-20)]) The subtle difference here lies in **`retain_state_information`**
    (see [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")). If this parameter is set to 0,
    Nagios forgets the previous state. Without **`log_initial_state = yes`**, Nagios
    accepts an OK after the restart.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[166](#CHP-16-FN-20)]) 这里的细微差别在于**`retain_state_information`**（参见[A.1 主要配置文件nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主要配置文件nagios.cfg")）。如果此参数设置为0，Nagios会忘记之前的状态。如果没有**`log_initial_state = yes`**，Nagios在重启后会接受OK状态。
- en: ^([[167](#CHP-16-FN-21)]) Nagios thus repeats the test four times before it
    categorizes the state as "hard."
  id: totrans-303
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[167](#CHP-16-FN-21)]) 因此，Nagios在将状态分类为“硬”之前会重复测试四次。
- en: ^([[168](#CHP-16-FN-22)]) If the number of events in the report period is less
    than specified in **Max List Items:**, the report covers all the events that have
    happened during this period.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[168](#CHP-16-FN-22)]) 如果报告期间的事件数量小于**最大列表项数**中指定的数量，则报告将涵盖此期间发生的所有事件。
- en: 16.3 Planning Downtimes
  id: totrans-305
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 16.3 计划停机时间
- en: 'In every system environment maintenance work accumulates from time to time
    that the administrator can normally plan, so that users can be informed accordingly
    beforehand. Nagios refers to such maintenance windows as *Scheduled Downtime*;
    the administrator enters these either in the information page for the host or
    service generated by **`extinfo.cgi`** ([Figure 16-4](../Text/ch16.html#extinfo.cgi_provides_additional_informa
    "Figure 16-4. extinfo.cgi provides additional information on the selected host"),
    page 331) or for the corresponding host or service group ([Figure 16-17](../Text/ch16s02.html#command_center_for_the_sap_host_group_c
    "Figure 16-17. Command center for the SAP host group: extinfo.cgi?type=5&hostgroup=SAP"),
    page 339). In doing this, **`extinfo.cgi`** makes use of **`cmd.cgi`** ([16.2.3
    Interface for external commands: cmd.cgi](../Text/ch16s02.html#interface_for_external_commands_colon_c
    "16.2.3 Interface for external commands: cmd.cgi"), page 343), which can also
    be called selectively:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
  zh: '在每个系统环境维护工作中，管理员会时不时地积累一些可以正常计划的任务，以便提前通知用户。Nagios将这些维护窗口称为*计划停机时间*；管理员可以在由**`extinfo.cgi`**([图16-4](../Text/ch16.html#extinfo.cgi_provides_additional_informa
    "图16-4. extinfo.cgi提供了所选主机的额外信息"), 第331页)或对应的主机或服务组([图16-17](../Text/ch16s02.html#command_center_for_the_sap_host_group_c
    "图16-17. SAP主机组的指挥中心: extinfo.cgi?type=5&hostgroup=SAP"), 第339页)生成的信息页面上输入这些信息。在此过程中，**`extinfo.cgi`**利用了**`cmd.cgi`**([16.2.3
    外部命令接口：cmd.cgi](../Text/ch16s02.html#interface_for_external_commands_colon_c "16.2.3
    外部命令接口：cmd.cgi"), 第343页)，该接口也可以选择性地调用：'
- en: '[PRE9]'
  id: totrans-307
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: opens the import template for maintenance times for a single host. The values
    for **`cmd_typ`** are summarized by [Figure 16-24](../Text/ch16s02.html#the_most_important_host_and_service_rel
    "Figure 16-24. The most important host and service related codes for cmd.cgi?cmd_typ=")
    in page 344.
  id: totrans-308
  prefs: []
  type: TYPE_NORMAL
  zh: 打开单个主机的维护时间导入模板。**`cmd_typ`**的值在[图16-24](../Text/ch16s02.html#the_most_important_host_and_service_rel
    "图16-24. cmd.cgi?cmd_typ=相关的最重要的主机和服务代码")中总结，第344页。
- en: A further method of recording maintenance periods is provided by addons, which,
    like the CGI programs, use the external command interface, but which can be automated,
    in contrast to the interactive Web interface. Such addons can also be found on
    the Nagios Exchange.^([[169](#ftn.CHP-16-FN-23)])
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 提供了另一种记录维护时间段的方法的插件，这些插件与CGI程序类似，使用外部命令接口，但可以自动化，与交互式Web界面相比。这样的插件也可以在Nagios
    Exchange上找到.^([[169](#ftn.CHP-16-FN-23)])
- en: 'For scheduled downtimes, Nagios prevents notifications from being sent. This
    ensures that the administrator is not flooded with false alarms. When checks are
    made to see whether messages should be sent, a downtime is the third item in the
    list ([Figure 16-2](../Text/ch16.html#the_menu_item_service_problems_brings_c
    "Figure 16-2. The menu item Service Problems brings current problems to attention"),
    page 268). In addition, **`avail.cgi`** ([16.2.10 Availability statistics: avail.cgi](../Text/ch16s02.html#availability_statistics_colon_avail.cgi
    "16.2.10 Availability statistics: avail.cgi"), page 351.) takes account of the
    downtime when evaluating the availability of individual hosts and services, and
    assigns error states that occur during these times not as error states, but as
    OK.'
  id: totrans-310
  prefs: []
  type: TYPE_NORMAL
  zh: 对于计划中的停机时间，Nagios 阻止发送通知。这确保管理员不会被虚假警报淹没。当检查是否应该发送消息时，停机时间是列表中的第三项（[图 16-2](../Text/ch16.html#the_menu_item_service_problems_brings_c
    "图 16-2. 菜单项服务问题将当前问题提请注意"，第 268 页））。此外，**`avail.cgi`**（[16.2.10 可用性统计：avail.cgi](../Text/ch16s02.html#availability_statistics_colon_avail.cgi
    "16.2.10 可用性统计：avail.cgi"，第 351 页））在评估单个主机和服务的可用性时考虑停机时间，并将这些时间发生的错误状态不作为错误状态，而是作为正常状态。
- en: Maintenance periods can overlap. If one maintenance window lasts from 8:00 A.M.
    till 12:00 P.M., and a second one involving the same host or service, from 10:00
    A.M. to 2:00 P.M., then Nagios does not send any error messages between 8:00 A.M.
    and 2:00 P.M., and the whole period is also ignored in the availability statistics.
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 维护时间段可以重叠。如果一个维护窗口从上午 8:00 持续到中午 12:00，而另一个涉及相同的主机或服务，从上午 10:00 到下午 2:00，那么
    Nagios 在上午 8:00 到下午 2:00 之间不会发送任何错误消息，整个时间段也会在可用性统计中忽略。
- en: 16.3.1 Maintenance periods for hosts
  id: totrans-312
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.3.1 主机的维护时间段
- en: What data is required to record the maintenance window can be explained quite
    clearly using the Web interface. [Figure 16-41](../Text/ch16s03.html#the_downtime_for_a_host_in_the_web_inte
    "Figure 16-41. The downtime for a host in the Web interface is recorded using
    this dialog") shows the input template for the downtime of a host (**`cmd.cgi?cmd_typ=55`**).
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Web 界面可以清楚地解释记录维护窗口所需的数据。[图 16-41](../Text/ch16s03.html#the_downtime_for_a_host_in_the_web_inte
    "图 16-41. 在 Web 界面中，使用此对话框记录主机的停机时间") 显示了主机停机时间的输入模板（**`cmd.cgi?cmd_typ=55`**）。
- en: '![The downtime for a host in the Web interface is recorded using this dialog](../Images/tagoreillycom20081104nostarchimages223924.png.jpg)'
  id: totrans-314
  prefs: []
  type: TYPE_IMG
  zh: '![在 Web 界面中，使用此对话框记录主机的停机时间](../Images/tagoreillycom20081104nostarchimages223924.png.jpg)'
- en: Figure 16-41. The downtime for a host in the Web interface is recorded using
    this dialog
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 图 16-41. 在 Web 界面中，使用此对话框记录主机的停机时间
- en: The first line defines the host, and in the second line Nagios automatically
    enters the login with which you have logged in to the Web interface. In the input
    field after the **Comment:** keyword, you can describe the reason for the planned
    downtime. Specifying the trigger shows whether it was generated indirectly through
    another entry. When recording a new downtime, you should leave the value **N/A**
    (*not available*, that is, no trigger) as it is.
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 第一行定义了主机，而在第二行 Nagios 会自动输入您用于登录 Web 界面的登录信息。在 **注释** 关键字之后的输入字段中，您可以描述计划停机的原因。指定触发器可以显示它是否是通过其他条目间接生成的。在记录新的停机时间时，应将值保留为
    **N/A**（即不可用，没有触发器）。
- en: 'In the next four lines you have the option of entering two different downtime
    types: fixed ones (**Type: Fixed**) or variable periods (**Flexible**). The first
    has a fixed start and a fixed end. In this case Nagios ignores the period entry
    in hours and minutes in the **Flexible Duration:** fields completely.'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的四行中，您可以选择输入两种不同的停机类型：固定的（**类型：固定**）或可变的时间段（**灵活**）。第一种类型有一个固定的开始时间和结束时间。在这种情况下，Nagios
    完全忽略 **灵活持续时间** 字段中的小时和分钟输入。
- en: A flexible downtime starts when the first-ever event occurs in the period specified.
    From this point in time Nagios plans the downtime for the length of time that
    was specified here in hours and minutes. This may certainly exceed the end point
    specified in **End Time:**.
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 灵活的停机时间从指定时间段内首次事件发生时开始。从这一刻起，Nagios 根据此处指定的小时和分钟来规划停机时间。这可能会超过 **结束时间** 中指定的终点。
- en: If further hosts are dependent on the computer specified in **Host Name:** (perhaps
    because a router is involved, which other host objects have entered as **parents**),
    you have the possibility of extending the downtime to all dependent hosts with
    the last item, **Child Hosts:. Schedule triggered downtime for all child hosts**
    passes on flexible downtimes to all "child hosts," **Schedule non-triggered downtime
    for all child hosts** does the same for fixed downtimes, and **Do nothing with
    child hosts** ignores dependencies, so that Nagios does not plan for any downtime
    for any hosts other than the one specified here.
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
  zh: 如果还有其他主机依赖于在 **主机名**：中指定的计算机（可能是因为涉及了路由器，其他主机对象已将其作为 **父对象** 进入），您可以使用最后一条项目，**子主机**：为所有子主机安排触发下线，将灵活的下线传递给所有“子主机”，**为所有子主机安排非触发下线**
    对固定下线做同样处理，而 **对子主机不采取任何操作** 忽略依赖关系，这样Nagios就不会为除此处指定的主机以外的任何主机计划下线。
- en: 'How this hereditary behavior takes effect in [Figure 16-41](../Text/ch16s03.html#the_downtime_for_a_host_in_the_web_inte
    "Figure 16-41. The downtime for a host in the Web interface is recorded using
    this dialog") is shown by the overview of all scheduled downtimes in [Figure 16-21](../Text/ch16s02.html#overview_of_all_planned_maintenance_per
    "Figure 16-21. Overview of all planned maintenance periods: extinfo.cgi?type=6")
    in page 342\. The first line contains the downtime just described for the host
    **eli-saprouter** with the **Downtime ID** number **1**. Entries that are caused
    by inheriting this timeout contain the **Downtime ID** of the downtime causing
    them in the **Trigger ID** column: for **`sap-12`** this is **1**, since the maintenance
    of **`eli-saprouter`** also affects this host.'
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 这种遗传行为如何在[图16-41](../Text/ch16s03.html#the_downtime_for_a_host_in_the_web_inte
    "图16-41. Web界面中使用此对话框记录主机的下线")中生效，可以通过第342页上[图16-21](../Text/ch16s02.html#overview_of_all_planned_maintenance_per
    "图16-21. 所有计划维护期的概述：extinfo.cgi?type=6")中所有计划下线的概述来展示。第一行包含刚刚描述的主机 **eli-saprouter**
    的下线，其 **下线ID** 为 **1**。由继承此超时引起的条目在 **触发ID** 列中包含导致下线的 **下线ID**：对于 **`sap-12`**，这是
    **1**，因为 **`eli-saprouter`** 的维护也影响了此主机。
- en: Nagios simultaneously generates a comment entry when planning a downtime, which
    is automatically removed when this period has passed. This is why a speech bubble
    appears in the status display. During the downtime Nagios supplements this with
    a "snoring sign," which is meant to represent a sleep state ([Figure 16-42](../Text/ch16s03.html#the_snoring_sign_zzzzz_shows_that_the_d
    "Figure 16-42. The snoring sign zzzzz shows that the downtime for the host has
    begun")).
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 当计划下线时，Nagios会同时生成一个注释条目，当这个时间段过去后，这个注释条目会自动被移除。这就是为什么在状态显示中会出现一个话泡。在下线期间，Nagios会补充一个“呼噜声标志”，其目的是表示睡眠状态（[图16-42](../Text/ch16s03.html#the_snoring_sign_zzzzz_shows_that_the_d
    "图16-42. 呼噜声标志 zzzzz 显示主机的下线开始")）。
- en: '![The snoring sign zzzzz shows that the downtime for the host has begun](../Images/tagoreillycom20081104nostarchimages223926.png.jpg)'
  id: totrans-322
  prefs: []
  type: TYPE_IMG
  zh: '![呼噜声标志 zzzzz 显示主机的下线开始](../Images/tagoreillycom20081104nostarchimages223926.png.jpg)'
- en: Figure 16-42. The snoring sign zzzzz shows that the downtime for the host has
    begun
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-42. 呼噜声标志 zzzzz 显示主机下线开始
- en: 16.3.2 Downtime for services
  id: totrans-324
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.3.2 服务下线
- en: Downtimes for services differ from those for hosts in two small details. Apart
    from host name, the service description must be included, and the possibility
    of inheritance is excluded, since there are no corresponding dependencies for
    services.
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 服务的下线与主机的下线在两个小细节上有所不同。除了主机名外，还必须包含服务描述，并且排除继承的可能性，因为服务没有相应的依赖关系。
- en: 'A downtime for a host does not automatically apply to the services running
    on it. But since they are also not available if the host is down, it is recommended
    that you plan the same downtime for all dependent services. It can be quite strenuous
    to enter all the services individually. It is much easier to do this using a host
    group (**`cmd_typ=85`**), as shown in [Figure 16-43](../Text/ch16s03.html#one_downtime_for_all_services_of_a_host
    "Figure 16-43. One downtime for all services of a host group"). With this you
    can define the downtime for services in a specific host group with a single command,
    and much more as well: a check mark in **Schedule Downtime For Hosts Too** at
    the same time defines the same downtime for all hosts belonging to this group.^([[170](#ftn.CHP-16-FN-24)])'
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 主机宕机并不会自动影响到其上运行的服务。但既然主机宕机时这些服务也无法使用，建议您为所有依赖的服务规划相同的宕机时间。逐个服务地输入宕机时间可能会相当繁琐。使用主机组（**`cmd_typ=85`**）来做这件事会容易得多，如图16-43所示。使用这种方法，您可以仅用一个命令就为特定主机组中的服务定义宕机时间，以及更多：同时勾选**“也为主机安排宕机时间”**选项，将为该组中的所有主机定义相同的宕机时间.^([[170](#ftn.CHP-16-FN-24)])
- en: '![One downtime for all services of a host group](../Images/tagoreillycom20081104nostarchimages223928.png.jpg)'
  id: totrans-327
  prefs: []
  type: TYPE_IMG
  zh: '![主机组中所有服务的单个宕机时间](../Images/tagoreillycom20081104nostarchimages223928.png.jpg)'
- en: Figure 16-43. One downtime for all services of a host group
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: Figure 16-43. 主机组中所有服务的单个宕机时间
- en: '* * *'
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[169](#CHP-16-FN-23)]) [http://www.nagiosexchange.org/Downtimes.38.0.html](http://www.nagiosexchange.org/Downtimes.38.0.html).
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[169](#CHP-16-FN-23)]) [http://www.nagiosexchange.org/Downtimes.38.0.html](http://www.nagiosexchange.org/Downtimes.38.0.html).
- en: ^([[170](#CHP-16-FN-24)]) Up until (at least) Nagios version 3.0rc1, the check
    mark has no effect, however; there you have to enter the downtime of the hosts
    separately by running **`cmd.cgi?cmd_typ=84`** again.
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[170](#CHP-16-FN-24)]) 至少在Nagios版本3.0rc1之前，复选框没有任何效果；在那里，您必须再次运行**`cmd.cgi?cmd_typ=84`**来分别输入主机的宕机时间。
- en: 16.4 Additional Information on Hosts and Services
  id: totrans-332
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 16.4 主机和服务的附加信息
- en: 'With the extended information for hosts and services, you can incorporate additional
    information in the Web interface and also brighten up its appearance somewhat,
    using suitable icons. Two separate objects hold this information in Nagios 2.x:
    **`hostextinfo`** and **`serviceextinfo`**. Starting with Nagios 3.0, the additional
    information is defined directly in the host and service objects. Although Nagios
    3.0 still evaluates the **`hostextinfo`** and **`serviceextinfo`** objects, it
    issues a warning message when checking the configuration and considers these objects
    to be obsolete.'
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 通过为主机和服务的扩展信息，您可以在Web界面中包含额外的信息，并使用合适的图标来改善其外观。在Nagios 2.x中，有两个单独的对象来存储这些信息：**`hostextinfo`**和**`serviceextinfo`**。从Nagios
    3.0开始，附加信息直接定义在主机和服务对象中。尽管Nagios 3.0仍然评估**`hostextinfo`**和**`serviceextinfo`**对象，但在检查配置时会发出警告信息，并将这些对象视为过时。
- en: It is planned to leave these out of Nagios entirely, by version 4 at the latest.
    Those using Nagios 3.0 for the first time should specify the information introduced
    below directly in the host and service definitions and leave out **`hostextinfo`**
    and **`serviceextinfo`** right from the start. If you are changing from Nagios
    2.x to Nagios 3.0, you don't need to worry about this, and you can continue using
    existing instances of these objects.
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: 计划在版本4之前完全从Nagios中移除这些信息。首次使用Nagios 3.0的用户应直接在主机和服务定义中指定以下介绍的信息，并从一开始就省略**`hostextinfo`**和**`serviceextinfo`**。如果您正在从Nagios
    2.x迁移到Nagios 3.0，您无需担心这一点，并且可以继续使用这些对象的现有实例。
- en: To make this clearer, below we will use the terms **`hostextinfo`** and **`serviceextinfo`**
    object *information*. For Nagios 2.x, the term refers to the *object* of the same
    name, whereas for Nagios 3.0 it refers to the corresponding *details* given in
    the **`host`** and **`service`** objects. The parameters themselves are identical
    for Nagios 2.x and 3.0\. The object information only influences the Web interface
    and has no effect on the capabilities of Nagios.
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使这一点更清晰，以下我们将使用术语**`hostextinfo`**和**`serviceextinfo`**对象*信息*。对于Nagios 2.x，该术语指的是相同名称的*对象*，而对于Nagios
    3.0，它指的是**`host`**和**`service`**对象中给出的相应*细节*。参数本身在Nagios 2.x和3.0中是相同的。对象信息仅影响Web界面，对Nagios的功能没有影响。
- en: 16.4.1 Extended host information
  id: totrans-336
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.4.1 扩展主机信息
- en: 'Object information for hosts allow you to enhance the display of hosts in the
    Web interface through additional functions in the form of links and enhancement
    features in the form of icons and coordinates:'
  id: totrans-337
  prefs: []
  type: TYPE_NORMAL
  zh: 主机对象信息允许您通过链接和图标以及坐标形式的增强功能，在Web界面中通过附加功能来增强主机的显示：
- en: '[PRE10]'
  id: totrans-338
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'The only obligatory parameter when these are defined is the specification of
    the host, with **`host_name`**; everything else is optional:'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
  zh: 当这些参数被定义时，唯一必需的参数是主机的指定，即**`host_name`**；其余的都是可选的：
- en: '**`host_name`**'
  id: totrans-340
  prefs: []
  type: TYPE_NORMAL
  zh: '**`host_name`**'
- en: This is the name of the host object whose Web pages are to be expanded by the
    following properties.
  id: totrans-341
  prefs: []
  type: TYPE_NORMAL
  zh: 这是将要通过以下属性扩展其Web页面的主机对象的名称。
- en: '**`notes`**'
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: '**`notes`**'
- en: Use this for additional information that **`extinfo.cgi`** takes into account
    in its information pages. (The entry specified in the above example, **Samba Primary
    Domaincontroller**, can be found in [Figure 16-44](../Text/ch16s04.html#extinfo.cgi_also_shows_a
    "Figure 16-44. extinfo.cgi also shows an alternative text here for the Linux icon
    (beneath the Tux in brackets) and the additional information from the parameter
    notes (beneath the alternative text)") below the Linux icon.)
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此功能以获取**`extinfo.cgi`**在信息页面中考虑的附加信息。（上述示例中指定的条目，**Samba Primary Domaincontroller**，可以在Linux图标下方找到，[图16-44](../Text/ch16s04.html#extinfo.cgi_also_shows_a
    "图16-44. extinfo.cgi同样在此处显示了Linux图标（括号中的Tux）的替代文本以及参数notes的附加信息（在替代文本下方)"))）
- en: '![extinfo.cgi also shows an alternative text here for the Linux icon (beneath
    the Tux in brackets) and the additional information from the parameter notes (beneath
    the alternative text)](../Images/tagoreillycom20081104nostarchimages223930.png.jpg)'
  id: totrans-344
  prefs: []
  type: TYPE_IMG
  zh: '![extinfo.cgi同样在此处显示了Linux图标（括号中的Tux）的替代文本以及参数notes的附加信息（在替代文本下方)](../Images/tagoreillycom20081104nostarchimages223930.png.jpg)'
- en: Figure 16-44. `extinfo.cgi` also shows an alternative text here for the Linux
    icon (beneath the Tux in brackets) and the additional information from the parameter
    `notes` (beneath the alternative text)
  id: totrans-345
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-44. `extinfo.cgi`同样在此处显示了Linux图标（括号中的Tux）的替代文本以及参数`notes`的附加信息（在替代文本下方）
- en: '**`notes_url`**'
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: '**`notes_url`**'
- en: This is the URL of a (HTML) file with additional information on the host in
    question, to which you are linked by an icon in the form of a red, slightly opened
    manual, both in the status overview ([Figure 16-45](../Text/ch16s04.html#this_detail_view_shows_an_icon_each_for
    "Figure 16-45. This detail view shows an icon each for notes_url (open, read booklet)
    action_url (pink star), and icon_ image (here, Linux penguin)")) and in the info
    page generated by **`extinfo.cgi`** ([Figure 16-44](../Text/ch16s04.html#extinfo.cgi_also_shows_a
    "Figure 16-44. extinfo.cgi also shows an alternative text here for the Linux icon
    (beneath the Tux in brackets) and the additional information from the parameter
    notes (beneath the alternative text)")). If the documentation on the host involved
    is stored in the Intranet, then maintenance contracts, hotline numbers, system
    configuration, etc. are then just a mouse click away.
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 这是包含有关所讨论主机额外信息的（HTML）文件的URL，您可以通过图标链接到该文件，该图标以红色略为打开的手册形式呈现，既在状态概述中（[图16-45](../Text/ch16s04.html#this_detail_view_shows_an_icon_each_for
    "图16-45. 此细节视图显示了notes_url（打开，阅读手册）action_url（粉红色星星）和icon_image（此处，Linux企鹅）的图标"）），也在由**`extinfo.cgi`**生成的信息页面中（[图16-44](../Text/ch16s04.html#extinfo.cgi_also_shows_a
    "图16-44. extinfo.cgi同样在此处显示了Linux图标（括号中的Tux）的替代文本以及参数notes的附加信息（在替代文本下方)"))。如果涉及的主机文档存储在内联网中，那么维护合同、热线电话号码、系统配置等只需鼠标点击即可获得。
- en: The parameter may contain an absolute path (from the view of the Web server)
    or a complete URL (**`http://.`**..).
  id: totrans-348
  prefs: []
  type: TYPE_NORMAL
  zh: 参数可能包含一个绝对路径（从Web服务器的视角来看）或一个完整的URL（**`http://.`**..）。
- en: '![This detail view shows an icon each for notes_url (open, read booklet) action_url
    (pink star), and icon_ image (here, Linux penguin)](../Images/tagoreillycom20081104nostarchimages223932.png.jpg)'
  id: totrans-349
  prefs: []
  type: TYPE_IMG
  zh: '![此细节视图显示了notes_url（打开，阅读手册）action_url（粉红色星星）和icon_image（此处，Linux企鹅）的图标](../Images/tagoreillycom20081104nostarchimages223932.png.jpg)'
- en: Figure 16-45. This detail view shows an icon each for `notes_url` (open, read
    booklet) `action_url` (pink star), and `icon_ image` (here, Linux penguin)
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 图16-45. 此细节视图显示了`notes_url`（打开，阅读手册）`action_url`（粉红色星星）和`icon_image`（此处，Linux企鹅）的图标
- en: '**`action_url`**'
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: '**`action_url`**'
- en: This is a link pointing to an action to be run for the host, which executes
    a CGI program such as **`cmd.cgi`**, for example, with just a mouse click. Since
    a link in the browser is always just a link, this does not have to be a command,
    and you can just as easily link another Web page. Both in the status overview
    ([Figure 16-45](../Text/ch16s04.html#this_detail_view_shows_an_icon_each_for "Figure 16-45. This
    detail view shows an icon each for notes_url (open, read booklet) action_url (pink
    star), and icon_ image (here, Linux penguin)")), and on the **`extinfo.cgi`**
    info page ([Figure 16-44](../Text/ch16s04.html#extinfo.cgi_also_shows_a "Figure 16-44. extinfo.cgi
    also shows an alternative text here for the Linux icon (beneath the Tux in brackets)
    and the additional information from the parameter notes (beneath the alternative
    text)")) it is hidden behind the pink star.
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个指向为主机运行操作的链接，例如，通过仅点击鼠标即可执行CGI程序，如**`cmd.cgi`**。由于浏览器中的链接始终只是一个链接，因此这不必是一个命令，你也可以轻松地链接到另一个网页。在状态概览（[图16-45](../Text/ch16s04.html#this_detail_view_shows_an_icon_each_for
    "图16-45. 此详细视图显示了notes_url（打开、阅读手册）action_url（粉红色星星）和icon_image（此处，Linux企鹅）的图标"））和**`extinfo.cgi`**信息页（[图16-44](../Text/ch16s04.html#extinfo.cgi_also_shows_a
    "图16-44. extinfo.cgi也在此处显示了Linux图标的替代文本（括号中的Tux下方）和参数notes的附加信息（替代文本下方）"））上，它都隐藏在粉红色星星后面。
- en: As a value, absolute paths from the view of the Web server or complete URLs
    can be used.
  id: totrans-353
  prefs: []
  type: TYPE_NORMAL
  zh: 作为值，可以使用来自Web服务器视图的绝对路径或完整的URL。
- en: '**`icon_image`**'
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: '**`icon_image`**'
- en: 'This is an icon to enhance the Web interface, but also to provide help: if
    you systematically use pictures here that represent the operating system (e.g.,
    the Tux for Linux, the Windows window for Microsoft operating systems, the Sun
    logo for Solaris computers, etc.), this helps you to keep an overview of the operating
    systems in the status view—especially if you have a large number of hosts ([Figure 16-45](../Text/ch16s04.html#this_detail_view_shows_an_icon_each_for
    "Figure 16-45. This detail view shows an icon each for notes_url (open, read booklet)
    action_url (pink star), and icon_ image (here, Linux penguin)")). **`extinfo.cgi`**
    also uses this icon ([Figure 16-44](../Text/ch16s04.html#extinfo.cgi_also_shows_a
    "Figure 16-44. extinfo.cgi also shows an alternative text here for the Linux icon
    (beneath the Tux in brackets) and the additional information from the parameter
    notes (beneath the alternative text)")).'
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个增强Web界面的图标，同时也提供帮助：如果你在这里系统地使用代表操作系统的图片（例如，Linux的Tux，微软操作系统的Windows窗口，Solaris计算机的Sun标志等），这有助于你在状态视图中保持对操作系统的概览——特别是如果你有大量主机（[图16-45](../Text/ch16s04.html#this_detail_view_shows_an_icon_each_for
    "图16-45. 此详细视图显示了notes_url（打开、阅读手册）action_url（粉红色星星）和icon_image（此处，Linux企鹅）的图标"））。**`extinfo.cgi`**也使用此图标（[图16-44](../Text/ch16s04.html#extinfo.cgi_also_shows_a
    "图16-44. extinfo.cgi也在此处显示了Linux图标的替代文本（括号中的Tux下方）和参数notes的附加信息（替代文本下方）"））。
- en: Icons should be approximately 40×40 pixels large and be available as a GIF,
    JPEG, or PNG file. If you specify a relative path (or none at all), then this
    begins with the directory **`/usr/local/nagios/share/images/logos/`**.^([[171](#ftn.CHP-16-FN-25)])
  id: totrans-356
  prefs: []
  type: TYPE_NORMAL
  zh: 图标的大小应约为40×40像素，并且应以GIF、JPEG或PNG文件的形式提供。如果你指定了相对路径（或根本不指定），则它从目录**`/usr/local/nagios/share/images/logos/`**开始。[^[[171](#ftn.CHP-16-FN-25)]]
- en: '**`icon_image_alt`**'
  id: totrans-357
  prefs: []
  type: TYPE_NORMAL
  zh: '**`icon_image_alt`**'
- en: 'This alternative text for the icon appears if the browser does not show a picture
    (for example for reading devices or output devices for Braille). From the icon
    and the icon text details, Nagios generates the following HTML code:'
  id: totrans-358
  prefs: []
  type: TYPE_NORMAL
  zh: 如果浏览器没有显示图片（例如，对于阅读设备或点字输出设备），则会出现此图标的替代文本。从图标和图标文本细节中，Nagios生成以下HTML代码：
- en: '[PRE11]'
  id: totrans-359
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '**`vrml_image`**'
  id: totrans-360
  prefs: []
  type: TYPE_NORMAL
  zh: '**`vrml_image`**'
- en: This is an image symbolizing the host in the 3D representation of **`statuswrl.cgi`**.
    Permissible formats are again GIF, JPEG, or PNG. You should avoid slides, since
    the image is placed on a cube, and the transparent parts in the 3D interface may
    lead to unexpected results.
  id: totrans-361
  prefs: []
  type: TYPE_NORMAL
  zh: 这是在3D表示中象征主机图像的符号。允许的格式再次是GIF、JPEG或PNG。你应该避免使用幻灯片，因为图像放置在一个立方体上，3D界面中的透明部分可能会导致意外结果。
- en: '**`statusmap_image`**'
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
  zh: '**`statusmap_image`**'
- en: 'This is the image with which **`statusmap.cgi`** (see [16.2.5 The topological
    map of the network: statusmap.cgi](../Text/ch16s02.html#the_topological_map_of_the_network_colo
    "16.2.5 The topological map of the network: statusmap.cgi"), page 346) symbolizes
    the host in its topological map. The Nagios demo page of Netways,^([[172](#ftn.CHP-16-FN-26)])
    ([Figure 16-28](../Text/ch16s02.html#statusmap_with_self-defined_coordinates "Figure 16-28. Statusmap
    with self-defined coordinates and icons") in page 348) shows a nice example.'
  id: totrans-363
  prefs: []
  type: TYPE_NORMAL
  zh: 这是**`statusmap.cgi`**（见[16.2.5 网络拓扑图：statusmap.cgi](../Text/ch16s02.html#the_topological_map_of_the_network_colo
    "16.2.5 网络拓扑图：statusmap.cgi")，第346页）在其拓扑图中表示主机的图像。Netways的Nagios演示页面（^[[172](#ftn.CHP-16-FN-26)]），([图16-28](../Text/ch16s02.html#statusmap_with_self-defined_coordinates
    "图16-28. 使用用户定义坐标和图标的状态图")在第348页）展示了很好的例子。
- en: Although GIFs, JPEGs, and PNGs are allowed, it is better to use the GD2 format,
    because then Nagios requires less computer time to generate the status map. Using
    the program **`pngtogd2`**, which ought to be available as a component of the
    utilities for Thomas Boutells GD library in most Linux distributions, PNG files
    can be easily converted. Again the image size of 40×40 pixels is recommended.
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然允许使用GIF、JPEG和PNG，但最好使用GD2格式，因为这样Nagios生成状态图所需的计算机时间更少。使用程序**`pngtogd2`**，该程序应作为大多数Linux发行版中Thomas
    Boutell GD库实用程序组件的一部分提供，可以轻松地将PNG文件转换。再次推荐40×40像素的图像大小。
- en: '**`2d_coords`**'
  id: totrans-365
  prefs: []
  type: TYPE_NORMAL
  zh: '**`2d_coords`**'
- en: This parameter specifies coordinates for a user-defined layout of the topological
    map. Details are given in pixels, with the origin, **`(0, 0), at the top left,
    and values must be positive:`** a positive x value counts the number of pixels
    from the origin to the right, a positive y value from the origin downwards.
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数指定了拓扑图的用户定义布局的坐标。细节以像素为单位给出，原点**`(0, 0)`**位于左上角，并且值必须是正数：正x值表示从原点到右边的像素数，正y值表示从原点向下。
- en: '[Figure 16-28](../Text/ch16s02.html#statusmap_with_self-defined_coordinates
    "Figure 16-28. Statusmap with self-defined coordinates and icons") works with
    fixed coordinates for individual hosts. Nagios ignores **`2d_coords`** details
    if the status maps a different layout to the user-defined one.'
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: '[图16-28](../Text/ch16s02.html#statusmap_with_self-defined_coordinates "图16-28.
    使用用户定义坐标和图标的状态图")使用单个主机的固定坐标。如果状态图映射的布局与用户定义的不同，Nagios会忽略**`2d_coords`**细节。'
- en: '**`3d_coords`**'
  id: totrans-368
  prefs: []
  type: TYPE_NORMAL
  zh: '**`3d_coords`**'
- en: These are the coordinates for the 3D representation. Positive and negative floating-point
    numbers are allowed. **`(0.0,0.0,0.0)`** is used as the origin. In the start view,
    **`statuswrl.cgi`** scales the 3D image so that all existing hosts appear on the
    screen. Where the starting point lies on the screen can therefore not be predicted.
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: 这些是3D表示的坐标。允许使用正负浮点数。**`(0.0,0.0,0.0)`**用作原点。在起始视图中，**`statuswrl.cgi`**调整3D图像的大小，以便所有现有主机都显示在屏幕上。因此，起始点在屏幕上的位置无法预测。
- en: 'On The Nagios Exchange there is a wide range of finished icons in the category
    **Logos and Images**.^([[173](#ftn.CHP-16-FN-27)]) It is best to unpack these
    into separate subdirectories, and then the individual packages will not get in
    each other''s way:'
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 在Nagios Exchange中，**Logos and Images**类别中有大量成品图标。最好将它们解压缩到单独的子目录中，这样各个包就不会相互干扰：
- en: '[PRE12]'
  id: totrans-371
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '**`imagepak-base.tar.gz`** contains a basic selection of icons, which can be
    supplemented as you please with other packages. The **`base`** subdirectory created,
    as with the object definition at the beginning of this chapter, must also be included.'
  id: totrans-372
  prefs: []
  type: TYPE_NORMAL
  zh: '**`imagepak-base.tar.gz`**包含一组基本的图标选择，你可以根据需要用其他包进行补充。与本章开头对象定义一样创建的**`base`**子目录也必须包含在内。'
- en: 16.4.2 Extended service information
  id: totrans-373
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 16.4.2 扩展服务信息
- en: 'Extended service object information is more or less identical to the host equivalents,
    so that we will only mention the differences. In addition to the host name, the
    service description in **`service_description`** is obligatory, but the details
    on the 2D (status map) and 3D views are omitted:'
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: 扩展服务对象信息与主机等效对象信息大致相同，所以我们只提一下差异。除了主机名外，**`service_description`**中的服务描述是必需的，但2D（状态图）和3D视图的详细信息被省略：
- en: '[PRE13]'
  id: totrans-375
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: In contrast to extended host information, the status overview for this example
    only shows the printer icon specified in **`icon_image`**, but not the two icons
    defined in **`notes_url`** and **`action_url`** for the two links **`notes_url`**
    and **`action_url`**. They only appear in the page generated by **`extinfo.cgi`**
    with the same icons as for the extended host information ([Figure 16-44](../Text/ch16s04.html#extinfo.cgi_also_shows_a
    "Figure 16-44. extinfo.cgi also shows an alternative text here for the Linux icon
    (beneath the Tux in brackets) and the additional information from the parameter
    notes (beneath the alternative text)"), page 363).
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: 与扩展主机信息相比，本例中的状态概述只显示在**`icon_image`**中指定的打印机图标，而不显示在**`notes_url`**和**`action_url`**中定义的两个图标。它们只会在**`extinfo.cgi`**生成的页面中显示，与扩展主机信息中的图标相同
    ([图16-44](../Text/ch16s04.html#extinfo.cgi_also_shows_a "图16-44. extinfo.cgi也在这里显示了Linux图标（括号中的Tux）和参数notes的附加信息（在替代文本下方)"),
    第363页)。
- en: '* * *'
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[171](#CHP-16-FN-25)]) If you have kept to the paths suggested in this book.
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[171](#CHP-16-FN-25)]) 如果你一直遵循本书中建议的路径。
- en: ^([[172](#CHP-16-FN-26)]) [http://nagios-demo.netways.de/](http://nagios-demo.netways.de/)
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[172](#CHP-16-FN-26)]) [http://nagios-demo.netways.de/](http://nagios-demo.netways.de/)
- en: ^([[173](#CHP-16-FN-27)]) [http://www.nagiosexchange.org/Image_Packs.75.0.html](http://www.nagiosexchange.org/Image_Packs.75.0.html)
  id: totrans-380
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[173](#CHP-16-FN-27)]) [http://www.nagiosexchange.org/Image_Packs.75.0.html](http://www.nagiosexchange.org/Image_Packs.75.0.html)
- en: '16.5 Configuration Changes through the Web Interfaces: the Restart Problem'
  id: totrans-381
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 16.5 通过Web界面进行配置更改：重启问题
- en: 'The CGI program **`cmd.cgi`** ([16.2.3 Interface for external commands: cmd.cgi](../Text/ch16s02.html#interface_for_external_commands_colon_c
    "16.2.3 Interface for external commands: cmd.cgi"), page 343) enables a series
    of changes to be made to the current configuration through the Web interface.^([[174](#ftn.CHP-16-FN-28)])
    In this way notifications or active checks can be switched on and off, for example.'
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
  zh: CGI程序**`cmd.cgi`** ([16.2.3 外部命令接口：cmd.cgi](../Text/ch16s02.html#interface_for_external_commands_colon_c
    "16.2.3 外部命令接口：cmd.cgi"), 第343页)通过Web界面允许进行一系列当前配置的更改。^([[174](#ftn.CHP-16-FN-28)])
    以这种方式可以切换通知或主动检查等。
- en: Nagios does not save such changes in the accompanying configuration file, but
    notes the the current status in a separately defined file, with the parameter
    **`state_retention_file in nagios.cfg`** (see [A.1 The Main Configuration File
    nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1 The
    Main Configuration File nagios.cfg")). But what happens if you restart Nagios
    after many changes using the Web interface?
  id: totrans-383
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios不会将这些更改保存到相关的配置文件中，而是在单独定义的文件中记录当前状态，该文件使用**`nagios.cfg`**中的参数**`state_retention_file
    in nagios.cfg`** (参见[A.1 主配置文件nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件nagios.cfg")). 但如果你在Web界面进行了许多更改后重启Nagios会发生什么？
- en: Whether Nagios retains the interactive changes made after a restart or forgets
    them is dependent on the parameter **`retain_state_informationin`** the configuration
    file **`nagios.cfg`** ([A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")). The default **`0`** tells the
    system to forget interactive changes. For Nagios to remember this, you have to
    set
  id: totrans-384
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios是否保留重启后所做的交互式更改，或者忘记它们，取决于配置文件**`nagios.cfg`**中的参数**`retain_state_informationin`**
    ([A.1 主配置文件nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件nagios.cfg")). 默认值**`0`**告诉系统忘记交互式更改。为了让Nagios记住这些更改，你必须设置
- en: '[PRE14]'
  id: totrans-385
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'But this causes a new problem: settings made in the Web interface do not have
    priority over the details in the configuration files. If you change the **`active_checks_enabled`**
    parameter there for a service, a direction of the parameter in the configuration
    file is ignored, since the current, temporarily stored setting in the file defined
    with **`state_retention_file`** will always "win out." This behavior affects all
    parameters for external commands that can be changed in the interface, and therefore
    also via the CGI program **`cmd.cgi`**. The original documentation of Nagios^([[175](#ftn.CHP-16-FN-29)])
    labels these with a red star.'
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: 但这又带来了一个新的问题：在Web界面中设置的配置项不会优先于配置文件中的详细信息。如果你为某个服务更改了那里的**`active_checks_enabled`**参数，配置文件中参数的方向就会被忽略，因为当前文件中用**`state_retention_file`**定义的临时存储设置将始终“胜出”。这种行为会影响所有可以通过界面更改的外部命令参数，因此也可以通过CGI程序**`cmd.cgi`**进行更改。Nagios的原版文档^([[175](#ftn.CHP-16-FN-29)])用红色星号标记了这些参数。
- en: 'Two approaches provide a remedy in this case: on the one hand you can set the
    parameter **`retain_state_information`** to **`0`** shortly before a restart.
    Then Nagios forgets all the changes when it restarts and reads the configuration
    files in from scratch. This procedure is recommended only in exceptional cases,
    as in large environments it will hardly be possible to go through all the interactive
    changes in the configuration files. Alternatively you can get into the habit,
    whenever you make changes in the configuration file, of making them a second time
    in the Web interface. Although this means slightly more work, there is never a
    danger that current, and perhaps very important settings, will be lost.'
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: 在此情况下，有两种方法可以提供解决方案：一方面，你可以在重启前短暂地将参数**`retain_state_information`** 设置为**`0`**。然后，Nagios在重启时会忘记所有更改，并从头开始读取配置文件。这种方法仅在特殊情况下推荐，因为在大型环境中几乎不可能完成配置文件中的所有交互式更改。另一方面，你可以养成习惯，每次在配置文件中做出更改时，都在Web界面中再次进行更改。虽然这会稍微增加一些工作量，但永远不会存在丢失当前设置，甚至可能是非常重要的设置的风险。
- en: 'Two additional parameters in the host and service definitions provide opportunities
    for fine-tuning:'
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: 主机和服务的定义中还有两个额外的参数提供了微调的机会：
- en: '[PRE15]'
  id: totrans-389
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '**`retain_status_information`** specifies whether the current state of ahost
    or service should survive the Nagios restart: **`1`** means that the system temporarily
    stores the state, and **`0`**, that it forgets it. **`1`** is certainly the more
    sensible value for states, and you should depart from this only in cases that
    can be justified.'
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: '**`retain_status_information`** 指定主机或服务的当前状态是否应该在Nagios重启后继续存在：**`1`** 表示系统会临时存储状态，而**`0`**
    表示它会忘记状态。对于状态来说，**`1`** 是一个更合理的值，你应该只在有正当理由的情况下偏离这个值。'
- en: '**`retain_nonstatus_information`**, on the other hand, refers to all information
    that describes *no* status. This includes, for example, whether active checks
    are switched on or off, whether passive checks are allowed or not, or whether
    admins are to be informed of status changes for this object. With a value of **`1`**,
    the system stores this information temporarily and uses it again after a restart,
    whereas with a value of **`0`**, Nagios forgets the current settings and reads
    the settings from the configuration file when it restarts.'
  id: totrans-391
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，**`retain_nonstatus_information`** 指的是描述**无**状态的全部信息。例如，这包括是否启用了活动检查，是否允许被动检查，或者是否需要通知管理员此对象的状态变化。当值为**`1`**时，系统会临时存储这些信息，并在重启后再次使用；而当值为**`0`**时，Nagios在重启时会忘记当前设置，并从配置文件中读取设置。
- en: '* * *'
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[174](#CHP-16-FN-28)]) The CGI program makes use of the External Command
    File interface when doing this.
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[174](#CHP-16-FN-28)]) 当进行此操作时，CGI程序会使用外部命令文件接口。
- en: '^([[175](#CHP-16-FN-29)]) Nagios 2.x: **`/usr/local/nagios/share/docs/xodtemplate.html`**,
    Nagios 3.0: **`/usr/local/nagios/docs/objectdefinitions.html`**'
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: '^([[175](#CHP-16-FN-29)]) Nagios 2.x: **`/usr/local/nagios/share/docs/xodtemplate.html`**，Nagios
    3.0: **`/usr/local/nagios/docs/objectdefinitions.html`**'
- en: 16.6 Modern Layout with the Nuvola Style
  id: totrans-395
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 16.6 使用Nuvola风格的现代布局
- en: 'The classical view of the Nagios Web interface described so far uses only a
    few of the CGI configuration options. However, it is hardly possible to pack any
    more items into the navigation bar on the left, which has become somewhat amateurish
    in appearance. One solution to this is the Nuvola style, shown in [Figure 16-46](../Text/ch16s06.html#nagios_in_the_nuvola_style_colon_shown
    "Figure 16-46. Nagios in the Nuvola style: shown here are the Service Problems").'
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止所描述的Nagios Web界面的经典视图仅使用了少数CGI配置选项。然而，几乎不可能将更多项目放入左侧的导航栏中，该导航栏的外观已经变得有些业余。一个解决方案是使用Nuvola风格，如图[图16-46](../Text/ch16s06.html#nagios_in_the_nuvola_style_colon_shown
    "图16-46. Nagios在Nuvola风格中：此处显示的是服务问题")所示。
- en: 'The layout for the actual CGI program—this example shows a view of the service
    problems with u**`status.cgi`** on the right of the picture—is not only in color,
    but there are also new icons. On the left of the picture you can see the rather
    elegant navigation, spiced up with corresponding icons. The real highlight, though,
    is the use of a Javascript-based menu tree: The individual entries (such as the
    sections **Home, Monitoring, Reporting**, and **Configuration**) can be opened
    and closed via mouse click.'
  id: totrans-397
  prefs: []
  type: TYPE_NORMAL
  zh: 实际CGI程序的布局——此示例显示了右侧图片中带有**`status.cgi`**的服务问题视图——不仅色彩丰富，还有新的图标。在图片的左侧，你可以看到相当优雅的导航，并配以相应的图标。然而，真正的亮点是使用基于JavaScript的菜单树：可以通过鼠标点击打开和关闭各个条目（例如，**首页**、**监控**、**报告**和**配置**等部分）。
- en: '![Nagios in the Nuvola style: shown here are the Service Problems](../Images/tagoreillycom20081104nostarchimages223934.png.jpg)'
  id: totrans-398
  prefs: []
  type: TYPE_IMG
  zh: '![Nagios 以 Nuvola 风格显示：此处显示的是服务问题](../Images/tagoreillycom20081104nostarchimages223934.png.jpg)'
- en: 'Figure 16-46. Nagios in the Nuvola style: shown here are the Service Problems'
  id: totrans-399
  prefs: []
  type: TYPE_NORMAL
  zh: 图 16-46. 以 Nuvola 风格显示的 Nagios：此处显示的是服务问题
- en: Before installing the Nuvola style it is essential that you back up the directory
    **`/usr/local/nagios/share`** so that you can restore the old setup if you don't
    like the new one.
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装 Nuvola 风格之前，必须备份 **`/usr/local/nagios/share`** 目录，以便如果你不喜欢新的设置，可以恢复旧设置。
- en: 'The current version 1.0.3 of Nuvola from NagiosExchange^([[176](#ftn.CHP-16-FN-30)])
    at the time of going to press is from September 2005, but it does work very well
    with Nagios 3.0 as well. The contents are unpacked into a suitable empty directory:'
  id: totrans-401
  prefs: []
  type: TYPE_NORMAL
  zh: NagiosExchange^([[176](#ftn.CHP-16-FN-30)]) 在印刷时的当前版本 1.0.3 是 2005 年 9 月的，但它与
    Nagios 3.0 一起工作得非常好。内容被解压到一个合适的空目录中：
- en: '[PRE16]'
  id: totrans-402
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'The sources contain files (**`index.html, main.html`**) and directories (**`stylesheets,
    images`**) that already exist in Nagios, and they overwrite the originals during
    installation. In addition, the Nuvola style includes a new subdirectory, **`side`**,
    which contains the actual Javascript code for the tree navigation:'
  id: totrans-403
  prefs: []
  type: TYPE_NORMAL
  zh: 源文件包含在 Nagios 中已存在的文件（**`index.html, main.html`**）和目录（**`stylesheets, images`**），它们在安装过程中会覆盖原始文件。此外，Nuvola
    风格包括一个新的子目录，**`side`**，其中包含树导航的实际 JavaScript 代码：
- en: '[PRE17]'
  id: totrans-404
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: The contents of the directory **`html`** are simply copied to **`/usr/local/share`**,
    for example, with **`rsync:`**
  id: totrans-405
  prefs: []
  type: TYPE_NORMAL
  zh: '**`html`** 目录的内容简单地复制到 **`/usr/local/share`**，例如，使用 **`rsync:****'
- en: '[PRE18]'
  id: totrans-406
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'For the new navigation to appear, the file **`sidel.html`** must be installed.
    If you just rename it to **`side.html`**, though, the **`make install`** of a
    new Nagios version will just overwrite it again. So it is better to use a separate
    index file instead, such as **`index1.html`**, and run the Nagios Web interface
    from this:'
  id: totrans-407
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使新的导航出现，必须安装 **`sidel.html`** 文件。如果你只是将其重命名为 **`side.html`**，那么新版本的 Nagios
    的 **`make install`** 将会再次覆盖它。因此，最好使用一个单独的索引文件，例如 **`index1.html`**，并从这个文件运行 Nagios
    Web 界面：
- en: '[PRE19]'
  id: totrans-408
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: To do this, you copy the **`index.html`** file included in Nuvola to the Nagios
    **`share`** directory with the name **`index1.html:`**
  id: totrans-409
  prefs: []
  type: TYPE_NORMAL
  zh: 要完成这个任务，你需要将包含在 Nuvola 中的 **`index.html`** 文件复制到 Nagios 的 **`share`** 目录下，并命名为
    **`index1.html:****
- en: '[PRE20]'
  id: totrans-410
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'In the file **`index1.html`** you replace **`side.html`** with **`side1.html`**
    so that the Javascript navigation is called:'
  id: totrans-411
  prefs: []
  type: TYPE_NORMAL
  zh: 在 **`index1.html`** 文件中，你将 **`side.html`** 替换为 **`side1.html`**，以便调用 JavaScript
    导航：
- en: '[PRE21]'
  id: totrans-412
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'If, like the author of this book, you consider it to be going over the top
    to change the styles of all the CGI programs, you can just pick out the improved
    navigation and supplement and redesign this as you think fit. Instead of making
    a complete copy of the directory **`html`**, you just select the files you require:'
  id: totrans-413
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你认为像本书的作者一样，改变所有 CGI 程序的样式过于夸张，你可以只挑选改进的导航，并根据你的想法进行补充和重新设计。你不需要复制整个 **`html`**
    目录，只需选择所需的文件即可：
- en: '[PRE22]'
  id: totrans-414
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: You change the file **`index1.html`** as we have just shown and check the **`cgipath`**
    variable in **`config.js:`**
  id: totrans-415
  prefs: []
  type: TYPE_NORMAL
  zh: 你像我们刚才展示的那样更改 **`index1.html`** 文件，并检查 **`config.js:**** 中的 **`cgipath`** 变量
- en: '[PRE23]'
  id: totrans-416
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Nuvola uses a ready-made menu tree library, which is available in a commercial
    version called **`apytmenu`**,^([[177](#ftn.CHP-16-FN-31)]) which will not be
    discussed here, or in a free variation, dTree.^([[178](#ftn.CHP-16-FN-32)]) dTree
    is the default setting in **`config.js (treeType = ''dtree''`**) and is included
    in full. Configuration of the menu and trees is done in the file **`dtree_data.js`**
    in the directory **`side`**. The basic principle can be briefly explained using
    the **Home** menu as an example:'
  id: totrans-417
  prefs: []
  type: TYPE_NORMAL
  zh: Nuvola 使用现成的菜单树库，商业版本称为 **`apytmenu`**，^([[177](#ftn.CHP-16-FN-31)]) 这里将不讨论，或者免费版本
    dTree.^([[178](#ftn.CHP-16-FN-32)）。dTree 是 **`config.js (treeType = 'dtree'`**)
    中的默认设置，并且完全包含在内。菜单和树的配置在 **`side`** 目录下的 **`dtree_data.js`** 文件中完成。可以用 **Home**
    菜单作为例子简要解释其基本原理：
- en: '[PRE24]'
  id: totrans-418
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: The **`dTree`** function generates a new menu tree. Its parameter is a freely
    selectable identifier (in this case, **`general`**), which is used to reference
    the tree. **`general.header`** sets the title of the menu to **`Home`**. The function
    requires other parameters as well, including an icon (as shown).
  id: totrans-419
  prefs: []
  type: TYPE_NORMAL
  zh: '**`dTree`** 函数生成一个新的菜单树。它的参数是一个可自由选择的标识符（在这种情况下，**`general`**），用于引用树。**`general.header`**
    设置菜单的标题为 **`Home`**。该函数还需要其他参数，包括一个图标（如图所示）。'
- en: 'The first **`general.add`** call anchors the tree still to be created. The
    first two parameters of the **`add`** function refer to the number of the node
    to be added, followed by its parent node. The topmost node is called **`0`**,
    and beneath this is the entry **`Documentation`**, to which the number **`1`**
    is assigned. If **`Documentation`** itself is to have subnodes, the invocations
    would be written as follows:'
  id: totrans-420
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个 **`general.add`** 调用将树仍锚定到待创建的状态。**`add`** 函数的前两个参数指的是要添加的节点编号，然后是其父节点编号。最顶层的节点称为
    **`0`**，其下是 **`Documentation`** 条目，分配编号 **`1`**。如果 **`Documentation`** 本身要具有子节点，调用方式如下：
- en: '[PRE25]'
  id: totrans-421
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Finally **`document.write`** builds the entire menu tree. The **`header`**
    function has the following parameters:'
  id: totrans-422
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，**`document.write`** 构建整个菜单树。**`header`** 函数有以下参数：
- en: '[PRE26]'
  id: totrans-423
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '**``*`title`*``**'
  id: totrans-424
  prefs: []
  type: TYPE_NORMAL
  zh: '**``*`title`*``**'
- en: contains the heading and can also be set up as a URL. A mouse click on the heading
    opens the hyperlink specified.
  id: totrans-425
  prefs: []
  type: TYPE_NORMAL
  zh: 包含标题，也可以设置为 URL。点击标题会打开指定的超链接。
- en: '**``*`icon`*``**'
  id: totrans-426
  prefs: []
  type: TYPE_NORMAL
  zh: '**``*`icon`*``**'
- en: specifies the path to a small graphic that is displayed in front of the heading.
  id: totrans-427
  prefs: []
  type: TYPE_NORMAL
  zh: 指定显示在标题前面的图形的路径。
- en: '**``*`height`*``**'
  id: totrans-428
  prefs: []
  type: TYPE_NORMAL
  zh: '**``*`height`*``**'
- en: specifies the height of the background beneath the heading. Following this,
    the property of this background can be specified either as a background image,
    with **``*`backgroundimage`*``**, or as a color (**``*`background colorw`*``**).
  id: totrans-429
  prefs: []
  type: TYPE_NORMAL
  zh: 指定标题下方背景的高度。随后，可以指定此背景的属性，要么作为背景图像，使用 **``*`backgroundimage`*``**，要么作为颜色（**``*`background
    colorw`*``**）。
- en: Finally **``*`open`*``** specifies whether the menu tree should be open (**`1`**)
    or closed (**`0`**) at the start. Arguments specifying textual values are enclosed
    in single quotes, and numerical arguments are written directly, as shown in the
    examples.
  id: totrans-430
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，**``*`open`*``** 指定菜单树在开始时应该是打开（**`1`**）还是关闭（**`0`**）。指定文本值的参数用单引号括起来，数值参数直接书写，如示例所示。
- en: 'The **`add`** function is invoked in a similar way:'
  id: totrans-431
  prefs: []
  type: TYPE_NORMAL
  zh: '**`add`** 函数以类似的方式调用：'
- en: '[PRE27]'
  id: totrans-432
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: '**``*`id`*``** is the node number, and **``*`pid`*``** is the number of the
    node beneath which the entry should be integrated. **``*`name`*``** defines the
    name of the node in the menu, and **``*`url`*``** defines the hyperlink to be
    called. **``*`title`*``** and **``*`target`*``** optionally specify a page title
    and the target frame for displaying the page called via *url*. Both parameters
    normally remain empty here; the default for the target—correctly for Nagios—is
    the frame **`main`**.'
  id: totrans-433
  prefs: []
  type: TYPE_NORMAL
  zh: '**``*`id`*``** 是节点编号，**``*`pid`*``** 是要整合的条目所在的节点编号。**``*`name`*``** 定义菜单中节点的名称，**``*`url`*``**
    定义要调用的超链接。**``*`title`*``** 和 **``*`target`*``** 可选地指定通过 *url* 调用的页面标题和显示页面的目标框架。这两个参数通常在这里保持为空；目标框架的默认值——对于
    Nagios 来说是正确的——是框架 **`main`**。'
- en: '**``*`icon`*``** defines the mini-graphic that is placed in front of the menu
    entry, and **``*`iconOpen`*``** optionally contains another icon that is used
    in its place when the menu entry is open. **``*`open`*``** again defines whether
    the entry should be opened (value **`1`**) or closed (value **`0`**) on starting,
    and **``*`css`*``** optionally allows an alternative CSS definition. For all optional
    parameters, the following applies: If they are at the end, they can be omitted,
    but if they are followed by other details, their omission must be marked by a
    pair of single quotation marks (**``*`''''`*``**).'
  id: totrans-434
  prefs: []
  type: TYPE_NORMAL
  zh: '**``*`icon`*``** 定义放置在菜单条目前面的迷你图形，**``*`iconOpen`*``** 可选地包含在条目打开时替代它的另一个图标。**``*`open`*``**
    再次定义在启动时条目应该是打开（值 **`1`**）还是关闭（值 **`0`**），**``*`css`*``** 可选地允许替代 CSS 定义。对于所有可选参数，以下适用：如果它们在末尾，可以省略，但如果它们后面跟有其他详细信息，省略必须用一对单引号（**``*`''''`*``**）标记。'
- en: The included file **``*`dtree_data.js`*``** contains four extensive menus. If
    you have little experience with handling Javascript, it is best to save this template
    and adjust it in small steps. In case of error, information is very sparse and
    usually misleading, so it is particularly important that you note exactly what
    has been changed from one step to the next in order to be able to quickly isolate
    the error.
  id: totrans-435
  prefs: []
  type: TYPE_NORMAL
  zh: 包含的文件 **``*`dtree_data.js`*``** 包含四个广泛的菜单。如果你处理 JavaScript 的经验不多，最好保存此模板并逐步调整。如果出现错误，信息非常稀少且通常具有误导性，因此特别重要的是要准确记录从一步到下一步所更改的内容，以便能够快速隔离错误。
- en: At this point we would like to mention the dTree homepage^([[179](#ftn.CHP-16-FN-33)])
    once again, which provides examples with extracts of code, along with a description
    of the programming interface.
  id: totrans-436
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，我们再次提到dTree主页^([[179](#ftn.CHP-16-FN-33)))，它提供了带有代码摘录的示例，以及编程接口的描述。
- en: Those who are not satisfied with the possibilities of the Nagios Web interface
    described in this chapter should take a look at NagVis ([Chapter 18](../Text/ch18.html
    "Chapter 18. NagVis") from page 389). The addon enables a freely definable interface
    and supplements the standard CGIs in an impressive manner. However, a prerequisite
    for NagVis is the installation of the database interface NDOUtils ([Chapter 17](../Text/ch17.html
    "Chapter 17. Flexible Web Interface with the NDOUtils") from page 375), which
    sets the installation hurdle slightly higher.
  id: totrans-437
  prefs: []
  type: TYPE_NORMAL
  zh: 对于本章中描述的Nagios Web界面的可能性不满意的人应该看看NagVis ([第18章](../Text/ch18.html "第18章。NagVis")，第389页)。这个插件允许自由定义的界面，并以令人印象深刻的方式补充了标准CGI。然而，NagVis的前提是安装数据库接口NDOUtils
    ([第17章](../Text/ch17.html "第17章。使用NDOUtils的灵活Web界面")，第375页)，这稍微提高了安装门槛。
- en: '* * *'
  id: totrans-438
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[176](#CHP-16-FN-30)]) [http://www.nagiosexchange.org/75;252](http://www.nagiosexchange.org/75;252)
  id: totrans-439
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[176](#CHP-16-FN-30)]) [http://www.nagiosexchange.org/75;252](http://www.nagiosexchange.org/75;252)
- en: ^([[177](#CHP-16-FN-31)]) [http://dhtml-menu.com/](http://dhtml-menu.com/)
  id: totrans-440
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[177](#CHP-16-FN-31)]) [http://dhtml-menu.com/](http://dhtml-menu.com/)
- en: ^([[178](#CHP-16-FN-32)]) [http://www.destroydrop.com/javascripts/tree/](http://www.destroydrop.com/javascripts/tree/)
  id: totrans-441
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[178](#CHP-16-FN-32)]) [http://www.destroydrop.com/javascripts/tree/](http://www.destroydrop.com/javascripts/tree/)
- en: ^([[179](#CHP-16-FN-33)]) [http://www.destroydrop.com/javascripts/tree/](http://www.destroydrop.com/javascripts/tree/)
  id: totrans-442
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[179](#CHP-16-FN-33)]) [http://www.destroydrop.com/javascripts/tree/](http://www.destroydrop.com/javascripts/tree/)
- en: Chapter 17. Flexible Web Interface with the NDOUtils
  id: totrans-443
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第17章。使用NDOUtils的灵活Web界面
- en: 'The Web interface of Nagios 2.x ansd 3.0, introduced in [Chapter 16](../Text/ch16.html
    "Chapter 16. The Classical Web Interface") from page 327, has a crucial disadvantage
    for large environments with hundreds of hosts: It cannot be scaled up. As long
    as you only observe error states and work intensively with acknowledges, you will
    manage fine with the CGI-based Web interface. But if you try to display several
    thousand services, you will have to be prepared to wait—it does not matter what
    their states are. Setting up the page can take a long time, and then practical
    work is hardly possible.'
  id: totrans-444
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 2.x和3.0的Web界面，如第16章第327页[第16章](../Text/ch16.html "第16章。经典Web界面")中所述，对于拥有数百台主机的环境来说有一个关键缺点：它无法扩展。只要您只观察错误状态并密集地使用确认，您就可以使用基于CGI的Web界面管理得很好。但如果你试图显示数千个服务，你必须准备好等待——无论它们的状态如何。设置页面可能需要很长时间，然后实际工作几乎是不可能的。
- en: Nagios extensions struggle with the CGI Web interface because this directly
    evaluates Nagios internals, such as object configuration, status data, and log
    files. This means that every extension that is used to supplement or replace the
    Web interface must follow this logic.
  id: totrans-445
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios扩展与CGI Web界面有冲突，因为这直接评估Nagios内部，如对象配置、状态数据和日志文件。这意味着每个用于补充或替换Web界面的扩展都必须遵循这个逻辑。
- en: The solution to this is called NDOUtils (*Nagios Data Objects Utilities*). These
    consist of a handful of tools that write all data—from configuration through events
    and check results to historical records—to a database and make them available
    via a uniform database model.
  id: totrans-446
  prefs: []
  type: TYPE_NORMAL
  zh: 解决这个问题的方案被称为NDOUtils（*Nagios数据对象工具*）。这些工具包括一些工具，它们将所有数据——从配置到事件和检查结果，再到历史记录——写入数据库，并通过统一的数据库模型提供。
- en: The mechanism that connects the NDOUtils to Nagios is called *Nagios Event Broker*
    (NEB). This adds a modular interface to Nagios. The NEB loads the extensions as
    modules when Nagios starts so that the modules can be used without having to recompile
    Nagios. This approach is similar to that of the Apache modules, which are loaded
    when required and add new functions to the Web server.
  id: totrans-447
  prefs: []
  type: TYPE_NORMAL
  zh: 将NDOUtils连接到Nagios的机制被称为*Nagios事件代理*（NEB）。这为Nagios添加了一个模块化接口。NEB在Nagios启动时加载扩展作为模块，这样模块就可以在不重新编译Nagios的情况下使用。这种方法类似于Apache模块，它们在需要时加载，并为Web服务器添加新功能。
- en: The NDOUtils form the basis for the future Web interface of Nagios, implemented
    with PHP, which should see the light of day starting with Nagios 4.x. With NagVis
    (see [Chapter 18](../Text/ch18.html "Chapter 18. NagVis") from page 389), however,
    there is already an alternative Web interface that is based on the NDOUtils.
  id: totrans-448
  prefs: []
  type: TYPE_NORMAL
  zh: NDOUtils是Nagios未来基于PHP实现的Web界面的基础，预计从Nagios 4.x版本开始投入使用。然而，NagVis（见第18章，第389页）已经提供了一个基于NDOUtils的替代Web界面。
- en: 17.1 The Event Broker
  id: totrans-449
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 17.1 事件代理
- en: 'The NEB provides an interface between Nagios and external modules based on
    shared libraries. An external, application-dependent module makes *callback functions*
    available. The Nagios kernel itself calls the accompanying callback function from
    the loaded module for every event: If there is no matching function, nothing happens.
    What actions the callback function executes is left to the imagination of the
    developer: Either it does something itself or it passes on configuration, status,
    and event data to an external application, as outlined in [Figure 17-1](../Text/ch17.html#an_external_application_communicates_wit
    "Figure 17-1. An external application communicates with a loaded NEB module").'
  id: totrans-450
  prefs: []
  type: TYPE_NORMAL
  zh: NEB提供了一个基于共享库的Nagios与外部模块之间的接口。一个外部、应用程序依赖的模块提供了*回调函数*。Nagios内核本身会为每个事件从加载的模块中调用相应的回调函数：如果没有匹配的函数，则不会发生任何操作。回调函数执行什么动作留给开发者想象：要么它自己执行某些操作，要么它将配置、状态和事件数据传递给外部应用程序，如[图17-1](../Text/ch17.html#an_external_application_communicates_wit
    "图17-1. 外部应用程序与加载的NEB模块通信")所示。
- en: For the transfer of data to external tools, Unix sockets or network sockets
    can be used, although it is also possible to use the file system. The application
    further processes information (saves it in a database, for example, or sends it
    as messages via SNMP traps, writes it to the syslog, etc.).
  id: totrans-451
  prefs: []
  type: TYPE_NORMAL
  zh: 对于数据传输到外部工具，可以使用Unix套接字或网络套接字，尽管也可以使用文件系统。应用程序进一步处理信息（例如，将其保存到数据库中，或通过SNMP陷阱发送消息，写入syslog等）。
- en: '![An external application communicates with a loaded NEB module](../Images/tagoreillycom20081104nostarchimages223936.png.jpg)'
  id: totrans-452
  prefs: []
  type: TYPE_IMG
  zh: '![外部应用程序与加载的NEB模块通信](../Images/tagoreillycom20081104nostarchimages223936.png.jpg)'
- en: Figure 17-1. An external application communicates with a loaded NEB module
  id: totrans-453
  prefs: []
  type: TYPE_NORMAL
  zh: 图17-1. 外部应用程序与加载的NEB模块通信
- en: When a callback function is called, Nagios waits for it to finish. This means
    that long execution times hinder the system. For this reason callback functions
    should always leave time-consuming processing steps to an external application
    and be restricted to sending on the necessary information as quickly as possible.
  id: totrans-454
  prefs: []
  type: TYPE_NORMAL
  zh: 当回调函数被调用时，Nagios会等待其完成。这意味着长时间的执行时间会阻碍系统。因此，回调函数应该始终将耗时的处理步骤留给外部应用程序，并限制于尽可能快地发送必要的信息。
- en: Building event broker modules is something that should be left to experienced
    programmers; mere mortals must be content with using ready-made modules. An NEB
    module can be integrated via the instruction **`broker_module`** in the main configuration
    file **`nagios.cfg:`**
  id: totrans-455
  prefs: []
  type: TYPE_NORMAL
  zh: 构建事件代理模块应该留给经验丰富的程序员来做；普通人必须满足于使用现成的模块。NEB模块可以通过主配置文件**`nagios.cfg:`**中的指令**`broker_module`**进行集成。
- en: '[PRE28]'
  id: totrans-456
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Whether you pass on arguments to the module or not depends on its concrete
    implementation. The parameter **`event_broker_options`** controls what information
    Nagios passes on to event broker modules. With the option **`−1`** it is all of
    them, while the value 0 prevents any information from being passed on. An alternate
    approach, of selectively passing on specific information, is provided by the file
    **`broker.h`** from the Nagios sources:'
  id: totrans-457
  prefs: []
  type: TYPE_NORMAL
  zh: 你是否将参数传递给模块取决于其具体实现。参数**`event_broker_options`**控制Nagios传递给事件代理模块的信息。使用选项**`−1`**表示所有信息，而值0则防止任何信息传递。通过Nagios源代码中的文件**`broker.h`**提供了一种选择性传递特定信息的替代方法：
- en: '[PRE29]'
  id: totrans-458
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: Table 17-1. Data to be transferred to NagVis
  id: totrans-459
  prefs: []
  type: TYPE_NORMAL
  zh: 表17-1. 要传输到NagVis的数据
- en: '| Broker Option | Value | Explanation |'
  id: totrans-460
  prefs: []
  type: TYPE_TB
  zh: '| 代理选项 | 值 | 说明 |'
- en: '| --- | --- | --- |'
  id: totrans-461
  prefs: []
  type: TYPE_TB
  zh: '| --- | --- | --- |'
- en: '| **`BROKER_PROGRAM_STATE`** | 1 | Is the program Nagios running |'
  id: totrans-462
  prefs: []
  type: TYPE_TB
  zh: '| **`BROKER_PROGRAM_STATE`** | 1 | 程序是否是运行的Nagios |'
- en: '| **`BROKER_DOWNTIME_DATA`** | 512 | Details of planned maintenance periods
    |'
  id: totrans-463
  prefs: []
  type: TYPE_TB
  zh: '| **`BROKER_DOWNTIME_DATA`** | 512 | 计划维护期的详细信息 |'
- en: '| **`BROKER_STATUS_DATA`** | 4096 | Current status information of all checks
    |'
  id: totrans-464
  prefs: []
  type: TYPE_TB
  zh: '| **`BROKER_STATUS_DATA`** | 4096 | 所有检查的当前状态信息 |'
- en: '| **`BROKER_RETENTION_DATA`** | 32768 | Data which is buffered for a restart
    of Nagios |'
  id: totrans-465
  prefs: []
  type: TYPE_TB
  zh: '| **`BROKER_RETENTION_DATA`** | 32768 | 为Nagios重启缓冲的数据 |'
- en: '| **`BROKER_ACKNOWLEDGEMENT_DATA`** | 65536 | Confirmations that have been
    made on error states of host and service checks |'
  id: totrans-466
  prefs: []
  type: TYPE_TB
  zh: '| **`BROKER_ACKNOWLEDGEMENT_DATA`** | 65536 | 确认已对主机和服务检查的错误状态进行的确认 |'
- en: 'NagVis 1.1, introduced in [Chapter 18](../Text/ch18.html "Chapter 18. NagVis"),
    requires the information listed in [Table 17-1](../Text/ch17.html#data_to_be_transferred_to_nagvis
    "Table 17-1. Data to be transferred to NagVis"). The corresponding numerical values
    add up to **`102913`**, so that **`event_broker_options`** can be modified as
    follows so that is tailor-made for NagVis:'
  id: totrans-467
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第18章](../Text/ch18.html "第18章。NagVis")中介绍的NagVis 1.1需要[表17-1](../Text/ch17.html#data_to_be_transferred_to_nagvis
    "表17-1。需要传输到NagVis的数据")中列出的信息。相应的数值总和为**`102913`**，因此可以修改**`event_broker_options`**如下，使其适合NagVis：
- en: '[PRE30]'
  id: totrans-468
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: Information on the event broker is currently very sparse. The only descriptions
    of the interface are a quite old documentation from Nagios 2.0 and the *Nagios
    Event Broker API*^([[180](#ftn.CHP-17-FN-1)]).
  id: totrans-469
  prefs: []
  type: TYPE_NORMAL
  zh: 关于事件代理的信息目前非常稀少。唯一描述接口的是来自Nagios 2.0的相当旧的文档和《Nagios事件代理API》^([[180](#ftn.CHP-17-FN-1)]）。
- en: '* * *'
  id: totrans-470
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[180](#CHP-17-FN-1)]) [http://www.nagios.org/developerinfo](http://www.nagios.org/developerinfo)
  id: totrans-471
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[180](#CHP-17-FN-1)]) [http://www.nagios.org/developerinfo](http://www.nagios.org/developerinfo)
- en: 17.2 The Database Interface
  id: totrans-472
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 17.2 数据库接口
- en: As a concrete and practically-oriented application of the event broker concept,
    the Nagios data object utilities, or NDOUtils, save all configuration and event
    data to a database. In order to be able to make use of the database, further applications
    are required. For Nagios 4.x, this will in all probability be a newly designed,
    PHP-based Web interface. Whether this Nagios version will immediately manage all
    the configuration data in the database was still a matter of speculation at press
    time (when Nagios 3.0 was not quite finished).
  id: totrans-473
  prefs: []
  type: TYPE_NORMAL
  zh: 作为事件代理概念的具体和实用应用，Nagios数据对象工具，或称NDOUtils，将所有配置和事件数据保存到数据库中。为了能够使用数据库，还需要进一步的应用程序。对于Nagios
    4.x版本，这很可能是基于PHP的新设计的Web界面。在新闻发布时（当时Nagios 3.0尚未完成），这个Nagios版本是否会立即管理数据库中的所有配置数据仍然是一个猜测。
- en: For the database, the NDOUtils currently support only MySQL; the use of PostgreSQL
    is planned, but is not yet implemented in version 1.4, introduced here.
  id: totrans-474
  prefs: []
  type: TYPE_NORMAL
  zh: 对于数据库，NDOUtils目前仅支持MySQL；计划使用PostgreSQL，但在本章节中引入的1.4版本中尚未实现。
- en: 'Since the NDOUtils addons provide a database interface that is relatively simple
    to use, it is expected that their use with Nagios 3.x will increase. NagVis (discussed
    in the next chapter from page 389) already provides a powerful NDO-based front
    end that in many cases can replace the status map, which remains relatively simple
    and is discussed in [16.2.5 The topological map of the network: statusmap.cgi](../Text/ch16s02.html#the_topological_map_of_the_network_colo
    "16.2.5 The topological map of the network: statusmap.cgi") from page 346.'
  id: totrans-475
  prefs: []
  type: TYPE_NORMAL
  zh: 由于NDOUtils插件提供了一个相对简单易用的数据库接口，预计它们与Nagios 3.x的使用将会增加。NagVis（下一章从第389页讨论）已经提供了一个强大的基于NDO的前端，在许多情况下可以替代状态图，该图相对简单，在[16.2.5
    网络拓扑图：statusmap.cgi](../Text/ch16s02.html#the_topological_map_of_the_network_colo
    "16.2.5 网络拓扑图：statusmap.cgi")中从第346页进行了讨论。
- en: '[Figure 17-2](../Text/ch17s02.html#how_can_you_integrate_nagios_data_into "Figure 17-2. How
    can you integrate Nagios data into the NDOUtils database?") shows the various
    paths by which Nagios data can be imported into the NDOUtils database. Export
    of data from Nagios is handled by the event broker module ndomod. It can either
    operate a TCP or Unix socket, or write the data to a file. If Nagios is installed
    on the same computer as the NDOUtils database, the Unix socket interface will
    provide the best performance and the greatest security (Unix sockets cannot be
    addressed from a network, in contrast to TCP sockets). The socket of the ndo2db
    daemon that ultimately writes the data to a database is queried.'
  id: totrans-476
  prefs: []
  type: TYPE_NORMAL
  zh: '[图17-2](../Text/ch17s02.html#how_can_you_integrate_nagios_data_into "图17-2.
    如何将Nagios数据集成到NDOUtils数据库中？")展示了Nagios数据可以导入到NDOUtils数据库的各种路径。Nagios的数据导出由事件代理模块ndomod处理。它可以选择操作TCP或Unix套接字，或将数据写入文件。如果Nagios安装在与NDOUtils数据库相同的计算机上，Unix套接字接口将提供最佳性能和最高安全性（与TCP套接字不同，Unix套接字不能从网络上访问）。查询最终将数据写入数据库的ndo2db守护进程的套接字。'
- en: The method using a file involves the utility FILE2SOCK, which reads in the file
    and also delivers data to the nd02db daemon via a TCP or Unix socket. FILE2SOCK
    can also read data from the standard input.
  id: totrans-477
  prefs: []
  type: TYPE_NORMAL
  zh: 使用文件的方法涉及实用程序FILE2SOCK，它读取文件并通过TCP或Unix套接字将数据传递给nd02db守护进程。FILE2SOCK还可以从标准输入读取数据。
- en: '![How can you integrate Nagios data into the NDOUtils database?](../Images/tagoreillycom20081104nostarchimages223938.png.jpg)'
  id: totrans-478
  prefs: []
  type: TYPE_IMG
  zh: '![如何将Nagios数据集成到NDOUtils数据库中？](../Images/tagoreillycom20081104nostarchimages223938.png.jpg)'
- en: Figure 17-2. How can you integrate Nagios data into the NDOUtils database?
  id: totrans-479
  prefs: []
  type: TYPE_NORMAL
  zh: 图17-2. 如何将Nagios数据集成到NDOUtils数据库中？
- en: For each database you need exactly one ndo2db daemon. If several different clients
    have access to the socket interface, it will start several processes to handle
    these.
  id: totrans-480
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每个数据库，您需要恰好一个ndo2db守护进程。如果有多个不同的客户端可以访问套接字接口，它将启动多个进程来处理这些。
- en: The program LOG2NDO is one of the NDOUtils. It reads log files from Nagios 2.x
    and 3.0 and passes this data to the ndo2db daemon—either directly via the socket
    interface or via a file that has to be separately imported with FILE2SOCK. If
    you want to integrate such historical data into the database, you will have to
    make plenty of storage space available, because the log files are compressed when
    they are archived but are saved in the database in uncompressed form. Thus the
    log files occupy more space when they are managed using the database.
  id: totrans-481
  prefs: []
  type: TYPE_NORMAL
  zh: 程序LOG2NDO是NDOUtils之一。它从Nagios 2.x和3.0读取日志文件，并将这些数据传递给ndo2db守护进程——要么直接通过套接字接口，要么通过必须单独用FILE2SOCK导入的文件。如果您想将此类历史数据集成到数据库中，您将需要提供大量的存储空间，因为日志文件在存档时被压缩，但在数据库中以未压缩的形式保存。因此，当使用数据库管理时，日志文件会占用更多空间。
- en: FILE2SOCK and LOG2NDO are primarily used to import historical data. The data
    later required by NagVis is updated by Nagios at very short intervals. Since historical
    data is not required here, we shall not describe these two programs in any more
    detail.
  id: totrans-482
  prefs: []
  type: TYPE_NORMAL
  zh: FILE2SOCK和LOG2NDO主要用于导入历史数据。NagVis稍后需要的数据由Nagios在非常短的时间间隔内更新。由于这里不需要历史数据，我们将不再详细描述这两个程序。
- en: 17.3 The Installation
  id: totrans-483
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 17.3 安装
- en: Since there are problems with **`INSERT`** statements in some tables of the
    NDOUtils database when MySQL in version 4.0 is used, it is better to use MySQL
    5 right from the start.^([[181](#ftn.CHP-17-FN-2)]) In addition to the MySQL server
    package (in Debian, "Etch" **`mysql-server-5.0`**) and the libraries that are
    usually selected automatically during the installation of the server package,
    you also require the accompanying development package (in Debian, "Etch" **`libmysqlclient15-dev`**)
    in order to be able to compile the NDOUtils.
  id: totrans-484
  prefs: []
  type: TYPE_NORMAL
  zh: 由于在使用MySQL 4.0版本时，NDOUtils数据库的一些表中的**`INSERT`**语句存在问题，因此最好从一开始就使用MySQL 5。^([[181](#ftn.CHP-17-FN-2)])
    除了MySQL服务器包（在Debian中为“Etch” **`mysql-server-5.0`**) 和在服务器包安装过程中通常自动选择的库之外，您还需要相应的开发包（在Debian中为“Etch”
    **`libmysqlclient15-dev`**)，以便能够编译NDOUtils。
- en: 'One consequence of the far-reaching integration of the NDOUtils into Nagios
    is that the version must exactly match that of the Nagios version used. Both Nagios
    and the NDOUtils define their version status in the source code with the macro
    **`CURRENT_OBJECT_STRUCTURE_VERSION`**. The macro can be found in the file **`./include/objects.h`**
    in the Nagios source code (for Nagios 3.0, in this example):'
  id: totrans-485
  prefs: []
  type: TYPE_NORMAL
  zh: NDOUtils与Nagios广泛集成的一个后果是版本必须与所使用的Nagios版本完全匹配。Nagios和NDOUtils都在源代码中用宏**`CURRENT_OBJECT_STRUCTURE_VERSION`**定义它们的版本状态。该宏可以在Nagios源代码的文件**`./include/objects.h`**中找到（对于Nagios
    3.0，在本例中）：
- en: '[PRE31]'
  id: totrans-486
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'The NDOUtils package contains two include files, one for Nagios 2.x and one
    for Nagios 3.x:'
  id: totrans-487
  prefs: []
  type: TYPE_NORMAL
  zh: NDOUtils包包含两个包含文件，一个用于Nagios 2.x，一个用于Nagios 3.x：
- en: '[PRE32]'
  id: totrans-488
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'If the **`CURRENT_OBJECT_STRUCTURE_VERSION`** value of Nagios does not match
    one of the two values in the NDOUtils source code, the NDOUtils module will unload
    itself and refuse to perform. The procedure is documented in the log file **`nagios.log`**
    with an entry like the following (the two different versions are marked in bold
    type):'
  id: totrans-489
  prefs: []
  type: TYPE_NORMAL
  zh: 如果Nagios的**`CURRENT_OBJECT_STRUCTURE_VERSION`**值与NDOUtils源代码中的两个值之一不匹配，NDOUtils模块将卸载自己并拒绝执行。该过程在日志文件**`nagios.log`**中有记录，如下所示（两个不同的版本用粗体表示）：
- en: '[PRE33]'
  id: totrans-490
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 17.3.1 Compiling the source code
  id: totrans-491
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 17.3.1 编译源代码
- en: 'The up-to-date NDOUtils code can be downloaded from the Nagios Web page^([[182](#ftn.CHP-17-FN-3)])
    and then unpacked to a suitable directory:'
  id: totrans-492
  prefs: []
  type: TYPE_NORMAL
  zh: 最新版本的NDOUtils代码可以从Nagios网页^([[182](#ftn.CHP-17-FN-3)])下载，然后解压到合适的目录：
- en: '[PRE34]'
  id: totrans-493
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'We start the **`configure`** run with the switch **`--sysconfdir=/etc`** in
    order to install the configuration files for the module and daemon to match the
    convention in this book, that is, to the directory **`/etc/nagios`**. The **`make`**
    call compiles the program code, and the installation is then done manually:'
  id: totrans-494
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用开关 **`--sysconfdir=/etc`** 启动 **`configure`** 运行，以便安装模块和守护进程的配置文件，以符合本书中的约定，即到目录
    **`/etc/nagios`**。**`make`** 调用编译程序代码，然后手动完成安装：
- en: '[PRE35]'
  id: totrans-495
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: For Nagios 2.x the daemon **`ndo2db-2x`** and the module **`ndomod-2x.o`** are
    copied to **`/usr/local/nagios/bin`** instead of the 3.x versions.
  id: totrans-496
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 Nagios 2.x，守护进程 **`ndo2db-2x`** 和模块 **`ndomod-2x.o`** 被复制到 **`/usr/local/nagios/bin`**
    而不是 3.x 版本。
- en: 17.3.2 Preparing the MySQL database
  id: totrans-497
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 17.3.2 准备 MySQL 数据库
- en: In the MySQL database system, we require a database storing appropriate access
    options for the user **`nagios`**. In order to set this up, we first log in to
    MySQL as the user **`root:`**
  id: totrans-498
  prefs: []
  type: TYPE_NORMAL
  zh: 在 MySQL 数据库系统中，我们需要一个存储用户 **`nagios`** 适当访问选项的数据库。为了设置这个数据库，我们首先以用户 **`root:`**
    登录 MySQL。
- en: '[PRE36]'
  id: totrans-499
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'The switch **`-p`** ensures that the password is requested. The following command
    tests whether a password is set or not:'
  id: totrans-500
  prefs: []
  type: TYPE_NORMAL
  zh: 开关 **`-p`** 确保请求密码。以下命令测试是否设置了密码：
- en: '[PRE37]'
  id: totrans-501
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: If the login triggered by this works without an error message, then the **`root`**
    password is missing. This should be specified with the command
  id: totrans-502
  prefs: []
  type: TYPE_NORMAL
  zh: 如果由该登录触发的操作没有错误消息，则 **`root`** 密码缺失。这应该使用以下命令指定：
- en: '[PRE38]'
  id: totrans-503
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: You should replace **``*`secret`*``** with your own secure password.^([[183](#ftn.CHP-17-FN-4)])
  id: totrans-504
  prefs: []
  type: TYPE_NORMAL
  zh: 您应该用您自己的安全密码替换 **``*`secret`*``**。[^([183](#ftn.CHP-17-FN-4))]
- en: The database (it is given the name **`nagios`**) is created with the SQL command
    **`CREATE DATABASE`**, and it is then given the required permissions with **`GRANT:`**
  id: totrans-505
  prefs: []
  type: TYPE_NORMAL
  zh: 数据库（被命名为 **`nagios`**）使用 SQL 命令 **`CREATE DATABASE`** 创建，然后使用 **`GRANT:`** 给予所需的权限。
- en: '[PRE39]'
  id: totrans-506
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: The **`GRANT USAGE`** command defines the user, along with his password, and
    specifies that for him there are no restrictions in the number of queries, database
    connections, or database updates per hour. For the password, something slighty
    more secure than **``*`secret`*``** is chosen, but it must be written here in
    plain text. **`GRANT USAGE`** does not yet give any access permissions to the
    tables of the **`nagios`** database. This is handled by the second **`GRANT`**
    command. The changes to the permissions of the **`nagios`** user are activated
    with **`FLUSH PRIVILEGES`**.
  id: totrans-507
  prefs: []
  type: TYPE_NORMAL
  zh: '**`GRANT USAGE`** 命令定义了用户及其密码，并指定对他来说，在每小时查询次数、数据库连接次数或数据库更新次数上没有限制。对于密码，选择比
    **``*`secret`*``** 稍微安全一些的密码，但必须以纯文本形式写在这里。**`GRANT USAGE`** 还没有给 **`nagios`**
    数据库的表提供任何访问权限。这由第二个 **`GRANT`** 命令处理。通过 **`FLUSH PRIVILEGES`** 激活对 **`nagios`**
    用户权限的更改。'
- en: The NDOUtils require **`SELECT`**, **`INSERT`**, **`UPDATE`**, and **`DELETE`**
    permissions. For NagVis and other applications, which only read data from the
    database, the **`SELECT`** permission is sufficient.
  id: totrans-508
  prefs: []
  type: TYPE_NORMAL
  zh: NDOUtils 需要 **`SELECT`**、**`INSERT`**、**`UPDATE`** 和 **`DELETE`** 权限。对于仅从数据库中读取数据的
    NagVis 和其他应用程序，**`SELECT`** 权限就足够了。
- en: 'In the next step the tables are generated in which the NDOUtils will later
    save data. A finished SQL script in the **`db`** subdirectory of the NDOUtils
    sources is provided for this purpose, and needs only to be executed:'
  id: totrans-509
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一步中，将生成表格，NDOUtils 将在此之后保存数据。在 NDOUtils 源代码的 **`db`** 子目录中提供了一个用于此目的的完成 SQL
    脚本，并且只需要执行：
- en: '[PRE40]'
  id: totrans-510
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: The script should run without error in all cases (meaning without any messages).
    The tables created can be shown with the SQL command **`show tables`**.
  id: totrans-511
  prefs: []
  type: TYPE_NORMAL
  zh: 脚本应在所有情况下（即没有任何消息）正常运行。创建的表格可以使用 SQL 命令 **`show tables`** 显示。
- en: Various distributions install MySQL by default with logging switched on. With
    the (usually binary) log files, the current status of the database can be replicated
    or restored. In combination with the NDOUtils, however, these log files grow very
    quickly. If you are using the database only for the NDOUtils, you will need such
    tools only in rare cases, and you can therefore comment out all the **`*log*`**
    parameters in the **`my.cnf`** configuration file and restart MySQL—this time
    without logging.
  id: totrans-512
  prefs: []
  type: TYPE_NORMAL
  zh: 各种发行版默认安装 MySQL 时会开启日志记录。与（通常是二进制）日志文件一起，可以复制或恢复数据库的当前状态。然而，与 NDOUtils 结合使用时，这些日志文件会迅速增长。如果您仅使用数据库进行
    NDOUtils，您将只在罕见情况下需要此类工具，因此可以在 **`my.cnf`** 配置文件中注释掉所有 **`*log*`** 参数，并重新启动 MySQL——这次不进行日志记录。
- en: 17.3.3 Upgrading the database design
  id: totrans-513
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 17.3.3 升级数据库设计
- en: 'Since the NDOUtils are actively undergoing development, larger changes to the
    database structure cannot be ruled out. For an upgrade, it is possible that the
    database design must also be changed. The NDOUtils provide a script for this purpose,
    **`upgradedb`** in the subdirectory **`db`**, which automatically adjusts the
    tables:'
  id: totrans-514
  prefs: []
  type: TYPE_NORMAL
  zh: 由于 NDOUtils 正在积极开发中，因此不能排除对数据库结构的较大更改。对于升级，数据库设计可能也需要更改。NDOUtils 提供了一个脚本用于此目的，位于子目录
    **`db`** 中的 **`upgradedb`**，它将自动调整表格：
- en: '[PRE41]'
  id: totrans-515
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: The script detects the existing NDOUtils version and adjusts the tables accordingly.
    Among other things, it uses the SQL command **`ALTER TABLE`**, for which the MySQL
    user **`nagios`**, created in the last section, does not have sufficient permissions.
    The script therefore needs to be run as the MySQL user **`root`**.
  id: totrans-516
  prefs: []
  type: TYPE_NORMAL
  zh: 该脚本检测现有的 NDOUtils 版本，并相应地调整表格。其中之一是，它使用 SQL 命令 **`ALTER TABLE`**，对于在上一节中创建的
    MySQL 用户 **`nagios`** 来说，权限不足。因此，脚本需要以 MySQL 用户 **`root`** 的身份运行。
- en: '* * *'
  id: totrans-517
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[181](#CHP-17-FN-2)]) The author has tested version 5.0.23, but there are
    also reports of NDOUtils working successfully with MySQL 4.1.x.
  id: totrans-518
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[181](#CHP-17-FN-2)]) 作者已测试版本 5.0.23，但也有报告称 NDOUtils 与 MySQL 4.1.x 版本成功兼容。
- en: ^([[182](#CHP-17-FN-3)]) [http://www.nagios.org/download/](http://www.nagios.org/download/)
  id: totrans-519
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[182](#CHP-17-FN-3)]) [http://www.nagios.org/download/](http://www.nagios.org/download/)
- en: ^([[183](#CHP-17-FN-4)]) Further notes on the secure adminstration of MySQL
    can be found in the online documentation at [http://www.mysql.org/doc/refman/5.0/en/security-guidelines.html](http://www.mysql.org/doc/refman/5.0/en/security-guidelines.html)
    and possibly in the documentation delivered with the distribution under **`/usr/share/doc/`**.
  id: totrans-520
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[183](#CHP-17-FN-4)]) 关于 MySQL 安全管理的更多说明，可以在在线文档 [http://www.mysql.org/doc/refman/5.0/en/security-guidelines.html](http://www.mysql.org/doc/refman/5.0/en/security-guidelines.html)
    中找到，也可能在随分发版提供的文档中找到，位于 **`/usr/share/doc/`**。
- en: 17.4 Configuration
  id: totrans-521
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 17.4 配置
- en: The NDOUtils are configured at three different locations. The file **`ndomod.cfg`**
    specifies the settings for the Event Broker module. **`ndo2db.cfg`** controls
    the daemon **`ndo2db`**, which accepts data from the Broker and writes to the
    database. An entry in **`/etc/nagios/nagios.cfg`** finally ensures that Nagios
    loads the Event Broker module **`ndomod`** when it starts.
  id: totrans-522
  prefs: []
  type: TYPE_NORMAL
  zh: NDOUtils 在三个不同的位置进行配置。文件 **`ndomod.cfg`** 指定了事件代理模块的设置。**`ndo2db.cfg`** 控制守护进程
    **`ndo2db`**，它从代理接收数据并将其写入数据库。**`/etc/nagios/nagios.cfg`** 中的条目最终确保 Nagios 启动时加载事件代理模块
    **`ndomod`**。
- en: The NDOUtils source code in the subdirectory **`./config`** provides a template
    for each of the two configuration files. The command
  id: totrans-523
  prefs: []
  type: TYPE_NORMAL
  zh: 子目录 **`./config`** 中的 NDOUtils 源代码为两个配置文件中的每一个提供了一个模板。该命令
- en: '[PRE42]'
  id: totrans-524
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: copies these, in accordance with the convention used in this book, to the directory
    **`/etc/nagios`**.
  id: totrans-525
  prefs: []
  type: TYPE_NORMAL
  zh: 根据本书中使用的惯例，将这些复制到目录 **`/etc/nagios`**。
- en: 17.4.1 Adjusting the Event Broker configuration
  id: totrans-526
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 17.4.1 调整事件代理配置
- en: 'The template for **`ndomod.cfg`** can almost be used unchanged; you need to
    adjust only the path to the **`var`** directory:'
  id: totrans-527
  prefs: []
  type: TYPE_NORMAL
  zh: '**`ndomod.cfg`** 的模板几乎可以不变地使用；您只需调整到 **`var`** 目录的路径：'
- en: '[PRE43]'
  id: totrans-528
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: '**`instance_name`** refers to the instance in the database to be used. Provided
    that you map only one Nagios instance in the database, it is no problem to keep
    to the **`default`** settings. Assuming that Nagios and the **`ndo2db`** daemon
    are running on the same host, a Unix socket can be used as the **`output_type`**,
    the name of which is defined by the **`output`** parameter. **`tcp_port`** is
    used only for **`output_type=tcpsocket`** and is therefore commented out.'
  id: totrans-529
  prefs: []
  type: TYPE_NORMAL
  zh: '**`instance_name`** 指的是数据库中要使用的实例。如果您在数据库中只映射一个 Nagios 实例，则可以保持 **`default`**
    设置。假设 Nagios 和 **`ndo2db`** 守护进程运行在同一个主机上，可以使用 Unix 套接字作为 **`output_type`**，其名称由
    **`output`** 参数定义。**`tcp_port`** 仅用于 **`output_type=tcpsocket`**，因此被注释掉。'
- en: 'In case the **`ndomod`** module cannot release data via the socket interface
    (because the daemon has just restarted, for instance), these are saved temporarily
    in the file **`buffer_file`**. The number of entries to be saved in this in the
    **`output_buffer_items`** parameter should not be set too low. A tried-and-tested
    rule of thumb here is to take the number of all defined host and service objects
    and multiply this by five. This is an empirical value: When reloaded, or when
    Nagios is restarted, the NDOUtils write the start state for each host and each
    service to the database, along with all planned and started checks. These might
    be supplemented by the results of new or still running checks.'
  id: totrans-530
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 **`ndomod`** 模块无法通过套接字接口释放数据（例如，守护进程刚刚重启），这些数据将暂时保存在文件 **`buffer_file`**
    中。在 **`output_buffer_items`** 参数中要保存的条目数不应设置得太低。这里的一个经验法则是将所有定义的主机和服务的数量乘以五。这是一个经验值：当重新加载或
    Nagios 重新启动时，NDOUtils 将每个主机和每个服务的起始状态写入数据库，以及所有计划的和已开始的检查。这些可能还会补充新的或仍在进行的检查的结果。
- en: The **`file_rotation_*`** parameters are required only for **`output_type=file`**,
    which requires the use of the additional daemon **`FILE2SOCK`**. For reasons of
    performance it is recommended, however, that you use the socket interface instead
    of the file-based one. The file interface also makes the configuration more complex,
    due to additional daemons.
  id: totrans-531
  prefs: []
  type: TYPE_NORMAL
  zh: '**`file_rotation_*`** 参数仅在 **`output_type=file`** 时需要，这需要使用额外的守护进程 **`FILE2SOCK`**。然而，出于性能考虑，建议您使用套接字接口而不是基于文件的接口。由于额外的守护进程，文件接口也使得配置更加复杂。'
- en: The parameters **`reconnect_interval`** and **`reconnect_warning_interval`**
    are also intended for cases where a connection using the **`ndo2db`** daemon could
    not be established. They specify in seconds how often Nagios should try to make
    contact with them and how often a warning should appear in the log file if a connection
    is not established. These two parameters should be left as they are in the default.
  id: totrans-532
  prefs: []
  type: TYPE_NORMAL
  zh: 参数 **`reconnect_interval`** 和 **`reconnect_warning_interval`** 也适用于无法建立使用 **`ndo2db`**
    守护进程的连接的情况。它们指定了 Nagios 多久尝试与他们建立联系，以及如果无法建立连接，日志文件中多久出现一次警告。这两个参数应保留为默认值。
- en: 17.4.2 Configuring database access
  id: totrans-533
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 17.4.2 配置数据库访问
- en: 'There is also little to adjust in the template for the configuration file of
    the **`ndo2db`** daemon. Apart from the path to the socket interface, the relevant
    password for write access to the database must be specified here:'
  id: totrans-534
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 **`ndo2db`** 守护进程的配置文件模板，几乎没有需要调整的地方。除了套接字接口的路径外，还必须指定对数据库进行写访问的相关密码：
- en: '[PRE44]'
  id: totrans-535
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: The two **`ndo2db_*`** parameters specify the user and group with whose permissions
    the daemon runs after the start. **`socket_type`** and **`socket_name`** must
    be set to the configuration in **`ndomod.cfg`**.
  id: totrans-536
  prefs: []
  type: TYPE_NORMAL
  zh: '两个 **`ndo2db_*`** 参数指定了守护进程启动后运行的用户和组权限。**`socket_type`** 和 **`socket_name`**
    必须设置为 **`ndomod.cfg`** 中的配置。 '
- en: The only database type that can currently be specified **`db_servertype`** is
    **`mysql`**; for **`db_port`** the standard port of MySQL (**`3306`**) is normally
    entered. The database name in **`db_name`** must match the name selected in the
    **`CREATE DATABASE`** command (in this case, **`nagios`**), and the database user
    and password must also be given in the same way as described when setting up the
    database. The value of the parameter **`db_prefix`** should not be changed under
    any circumstances, otherwise the name of the tables to be created in the **`mysql.sql`**
    script must also be adjusted.
  id: totrans-537
  prefs: []
  type: TYPE_NORMAL
  zh: 当前可以指定的唯一数据库类型是 **`db_servertype`** 的 **`mysql`**；对于 **`db_port`**，通常输入 MySQL
    的标准端口（**`3306`**）。在 **`db_name`** 中的数据库名称必须与在 **`CREATE DATABASE`** 命令中选择的名称匹配（在这种情况下，**`nagios`**），并且数据库用户和密码也必须以与设置数据库时相同的方式给出。在任何情况下都不应更改
    **`db_prefix`** 参数的值，否则在 **`mysql.sql`** 脚本中创建的表的名称也必须进行调整。
- en: The parameters beginning with **`max_*`** define in minutes how long the NDOUtils
    data on system commands, planned events, service and host checks, and event handlers^([[184](#ftn.CHP-17-FN-5)])
    should be kept in the database. The value 1440 corresponds to one day. If you
    are using the NDOUtils only with NagVis, you won't need longer times. Short intervals
    go easy on the database, as well as the hard disk.
  id: totrans-538
  prefs: []
  type: TYPE_NORMAL
  zh: 以 **`max_*`** 开头的参数定义了 NDOUtils 数据在系统命令、计划事件、服务和主机检查以及事件处理程序中应在数据库中保留多长时间（以分钟为单位）。值
    1440 对应于一天。如果您仅使用 NagVis 与 NDOUtils，则不需要更长时间。短间隔对数据库和硬盘都较为友好。
- en: 17.4.3 Starting the **`ndo2db`** daemon
  id: totrans-539
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 17.4.3 启动 **`ndo2db`** 守护进程
- en: 'When everything is configured, the **`ndo2db`** daemon is first called manually:'
  id: totrans-540
  prefs: []
  type: TYPE_NORMAL
  zh: 当一切配置完成后，首先手动调用**`ndo2db`**守护进程：
- en: '[PRE45]'
  id: totrans-541
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'Later on it is recommended that you create an init script by copying and modifying
    the script **`/etc/init.d/skeleton`**, provided in the distribution. The daemon
    must match the Nagios version: **`ndo2db-3x`** works together with Nagios version
    3.x, **`ndo2db-2x`** with version 2.x. After it has started you should look to
    see whether the socket specified in the configuration exists:'
  id: totrans-542
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，建议您通过复制和修改分发中提供的脚本**`/etc/init.d/skeleton`**来创建一个init脚本。守护进程必须与Nagios版本匹配：**`ndo2db-3x`**与Nagios版本3.x一起工作，**`ndo2db-2x`**与版本2.x一起工作。启动后，您应该检查配置中指定的套接字是否存在：
- en: '[PRE46]'
  id: totrans-543
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: If the message **`Socket already in use`** appears when the daemon is run, then
    either the daemon is already running or the socket **`ndo.sock`** was not removed
    when the daemon was stopped. In this case you should delete it manually before
    restarting it.
  id: totrans-544
  prefs: []
  type: TYPE_NORMAL
  zh: 如果在运行守护进程时出现**`Socket already in use`**消息，那么要么守护进程已经在运行，要么在守护进程停止时没有移除套接字**`ndo.sock`**。在这种情况下，您应该在重新启动之前手动删除它。
- en: 17.4.4 Loading the Event Broker module in Nagios
  id: totrans-545
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 17.4.4 在Nagios中加载事件代理模块
- en: In order for Nagios to load the Event Broker module of the NDOUtils when it
    is started, the following entry is added to the configuration file **`/etc/nagios/nagios.cfg:`**
  id: totrans-546
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使Nagios在启动时加载NDOUtils的事件代理模块，以下条目被添加到配置文件**`/etc/nagios/nagios.cfg:`**
- en: '[PRE47]'
  id: totrans-547
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'In this example the module for Nagios version 3.x is used; if you are using
    Nagios 2.x, you enter **`ndomod-2x.o`** instead. A reload activates the module:'
  id: totrans-548
  prefs: []
  type: TYPE_NORMAL
  zh: 在此示例中使用了Nagios版本3.x的模块；如果您使用的是Nagios 2.x，则输入**`ndomod-2x.o`**。重新加载激活模块：
- en: '[PRE48]'
  id: totrans-549
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Shortly after the reload, all host and service objects should be recorded in
    the database:'
  id: totrans-550
  prefs: []
  type: TYPE_NORMAL
  zh: 在重新加载后不久，所有主机和服务对象都应该记录在数据库中：
- en: '[PRE49]'
  id: totrans-551
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: The table **`nagios_objects`** contains all the objects, and **`objecttype_id=2`**
    shows all the services. Alternatively the object type **`1`** refers to hosts,
    **`3`** to host groups, and **`4`** to service groups. A complete description
    of the tables is provided in the file **`NDOUTILS DB Model.pdf`**, included in
    the NDOUtils in the subdirectory **`./docs`**.
  id: totrans-552
  prefs: []
  type: TYPE_NORMAL
  zh: 表**`nagios_objects`**包含所有对象，**`objecttype_id=2`**显示所有服务。或者对象类型**`1`**指代主机，**`3`**指代主机组，**`4`**指代服务组。关于表的完整描述可以在NDOUtils中包含的文件**`NDOUTILS
    DB Model.pdf`**中找到，该文件位于子目录**`./docs`**中。
- en: '* * *'
  id: totrans-553
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[184](#CHP-17-FN-5)]) For event handlers, see [Appendix C](../Text/apc.html
    "Appendix C. Event Handlers") in page 619
  id: totrans-554
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[184](#CHP-17-FN-5)]) 关于事件处理器，请参阅第619页的附录C（[附录C. 事件处理器](../Text/apc.html
    "附录C. 事件处理器")）
- en: Chapter 18. NagVis
  id: totrans-555
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第18章. NagVis
- en: NagVis^([[185](#ftn.CHP-18-FN-1)]) is an addon for Nagios that displays host
    and service states against a background image selected by the user. This must
    be available in the PNG format; the choice is yours whether you use a map, a diagram
    of your own system documentation, a photo of the server room, or a schematic diagram
    of the system environment as a background, as shown in [Figure 18-1](../Text/ch18.html#schematic_diagram_of_a_system_environmen
    "Figure 18-1. Schematic diagram of a system environment as a template for NagVis").
  id: totrans-556
  prefs: []
  type: TYPE_NORMAL
  zh: NagVis^([[185](#ftn.CHP-18-FN-1)]) 是Nagios的一个插件，它将用户选择背景图像显示主机和服务状态。这必须是PNG格式；您可以选择使用地图、您自己的系统文档图、服务器室的照片或系统环境的示意图作为背景，如图[图18-1](../Text/ch18.html#schematic_diagram_of_a_system_environmen
    "图18-1. 系统环境的示意图作为NagVis的模板")所示。
- en: 'Via the Web interface, you can place objects wherever you want on the background.
    NagVis displays different icons, depending on the state of the object: red for
    the CRITICAL state, yellow for WARNING, green for OK, and a question mark on a
    gray background for UNKNOWN. If an acknowledgment was set, this is indicated by
    a green button with a picture of a worker on it.'
  id: totrans-557
  prefs: []
  type: TYPE_NORMAL
  zh: 通过Web界面，您可以在背景上放置任何您想要的对象。NagVis根据对象的状态显示不同的图标：红色表示CRITICAL状态，黄色表示WARNING，绿色表示OK，灰色背景上的问号表示UNKNOWN。如果设置了确认，则通过带有工人图片的绿色按钮表示。
- en: There are different icons for hosts and services; in the default template, host
    icons are rectangular, and service icons are round. A finished NagVis display—NagVis
    refers to this as a *map*—is shown in [Figure 18-2](../Text/ch18.html#displaying_the_system_environment
    "Figure 18-2. Displaying the system environment"). Further examples—such as using
    a geographical map, or a photo of the server room, as a background—are provided
    on the NagVis homepage.^([[186](#ftn.CHP-18-FN-2)])
  id: totrans-558
  prefs: []
  type: TYPE_NORMAL
  zh: 主机和服务的图标不同；在默认模板中，主机图标是矩形的，而服务图标是圆形的。完成的 NagVis 显示——NagVis 将其称为 *地图*——在 [图 18-2](../Text/ch18.html#displaying_the_system_environment
    "图 18-2. 显示系统环境") 中显示。NagVis 主页上提供了更多示例——例如使用地理地图或服务器室的照片作为背景。[^([186](#ftn.CHP-18-FN-2))]
- en: '![Schematic diagram of a system environment as a template for NagVis](../Images/tagoreillycom20081104nostarchimages223940.png.jpg)'
  id: totrans-559
  prefs: []
  type: TYPE_IMG
  zh: '![作为 NagVis 模板的系统环境示意图](../Images/tagoreillycom20081104nostarchimages223940.png.jpg)'
- en: Figure 18-1. Schematic diagram of a system environment as a template for NagVis
  id: totrans-560
  prefs: []
  type: TYPE_NORMAL
  zh: 图 18-1. 作为 NagVis 模板的系统环境示意图
- en: In addition to hosts and services, host and service groups can also be integrated
    into a NagVis display, as well as additional maps. Thus a geographical overview
    map could be used for the start page, which has an icon for each location monitored
    that links to a detailed NagVis map specifically for that location.
  id: totrans-561
  prefs: []
  type: TYPE_NORMAL
  zh: 除了主机和服务外，主机和服务组还可以集成到 NagVis 显示中，以及额外的地图。因此，可以使用地理概览图作为起始页面，每个监控位置的图标都链接到针对该位置的详细
    NagVis 地图。
- en: If an icon contains several states, as is the case for host and service groups,
    for instance, NagVis displays the state with the highest priority CRITICAL has
    a higher priority than WARNING, WARNING trumps UNKNOWN, UNKNOWN gets more attention
    than an acknowledgment, and OK has the lowest priority of all. If any host in
    a host group assumes the CRITICAL state, this is shown accordingly for the entire
    host group.
  id: totrans-562
  prefs: []
  type: TYPE_NORMAL
  zh: 如果一个图标包含多个状态，例如主机和服务组，NagVis 会显示具有最高优先级的状态，其中 CRITICAL 的优先级高于 WARNING，WARNING
    胜过 UNKNOWN，UNKNOWN 比确认得到更多关注，而 OK 是所有状态中优先级最低的。如果主机组中的任何主机处于 CRITICAL 状态，整个主机组都会相应地显示。
- en: For hosts and host groups, NagVis offers you the choice of having only host
    states considered in determining the state that is displayed, or having the services
    dependent on these hosts are included as well (see [18.1.2 Initial configuration](../Text/ch18.html#initial_configuration
    "18.1.2 Initial configuration")). In the latter case, a red stop light is displayed
    if even a single service of a host is in the critical state.
  id: totrans-563
  prefs: []
  type: TYPE_NORMAL
  zh: 对于主机和主机组，NagVis 提供了选择仅考虑主机状态以确定显示状态，或者包括依赖于这些主机的服务（参见 [18.1.2 初始配置](../Text/ch18.html#initial_configuration
    "18.1.2 初始配置")）。在后一种情况下，如果主机的任何一个服务处于关键状态，则会显示一个红色的停止灯。
- en: Of particular interest is NagVis's ability to evaluate only hard states ([18.1.2
    Initial configuration](../Text/ch18.html#initial_configuration "18.1.2 Initial
    configuration")). For routine work with the Web interface, it turns out to be
    quite useful if not every temporary soft CRITICAL state immediately generates
    a red light.
  id: totrans-564
  prefs: []
  type: TYPE_NORMAL
  zh: 特别值得注意的是 NagVis 只评估硬状态的能力（参见 [18.1.2 初始配置](../Text/ch18.html#initial_configuration
    "18.1.2 初始配置")）。对于使用 Web 界面的常规工作，如果并非每个临时的软 CRITICAL 状态都立即生成红灯，这会非常有用。
- en: '![Displaying the system environment](../Images/tagoreillycom20081104nostarchimages223942.png.jpg)'
  id: totrans-565
  prefs: []
  type: TYPE_IMG
  zh: '![显示系统环境](../Images/tagoreillycom20081104nostarchimages223942.png.jpg)'
- en: Figure 18-2. Displaying the system environment
  id: totrans-566
  prefs: []
  type: TYPE_NORMAL
  zh: 图 18-2. 显示系统环境
- en: It will especially please fans of object-oriented programming that NagVis makes
    full use of object-oriented concepts. For example, the system inherits defaults
    from the global configuration for individual maps and settings on the map level
    and passes these on to individual objects, with the option of overwriting settings
    locally always available. This simplifies the configuration to a considerable
    extent, and NagVis also indicates in the graphical editor (also called the *Web
    user interface* or WUI) which settings are object-specific and which have been
    inherited ([Figure 18-8](../Text/ch18s02.html#if_you_move_the_mouse_over_the_inserted
    "Figure 18-8. If you move the mouse over the inserted object, a hover menu opens")
    in page 399).
  id: totrans-567
  prefs: []
  type: TYPE_NORMAL
  zh: 特别会让面向对象编程的粉丝感到高兴的是，NagVis 充分利用了面向对象的概念。例如，系统从全局配置继承默认值，用于单个地图和地图级别的设置，并将这些值传递给单个对象，同时始终可以选择在本地覆盖设置。这在很大程度上简化了配置，NagVis
    还在图形编辑器（也称为 *Web 用户界面* 或 WUI）中指出了哪些设置是针对对象的，哪些是继承的（[图 18-8](../Text/ch18s02.html#if_you_move_the_mouse_over_the_inserted
    "图 18-8. 如果将鼠标移至插入的对象上，将打开一个悬停菜单"）在第 399 页）。
- en: NagVis is published under the GNU Public License Version 2 (GPLv2); the description
    below refers to version 1.3.
  id: totrans-568
  prefs: []
  type: TYPE_NORMAL
  zh: NagVis 在 GNU 公共许可证版本 2 (GPLv2) 下发布；下面的描述指的是版本 1.3。
- en: 18.1 Installation
  id: totrans-569
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 18.1 安装
- en: NagVis makes use of NDOUtils and is implemented in PHP. Therefore, besides an
    NDO database in running order, as described in [Chapter 17](../Text/ch17.html
    "Chapter 17. Flexible Web Interface with the NDOUtils") from page 375, you need
    a Web server with PHP 4.2 or higher, as well as the packages **`php-mysql`** for
    access to the NDO database and **`php-gd`** to be able to draw lines.^([[187](#ftn.CHP-18-FN-3)])
    Depending on the distribution and the PHP version used, the package names may
    vary slightly. For Debian "Etch" and PHP5 you need the packages **`libapache2-mod-php5,
    php5, php5-common, php5-gd`**, and **`php5-mysql`**.
  id: totrans-570
  prefs: []
  type: TYPE_NORMAL
  zh: NagVis 使用 NDOUtils 并用 PHP 实现。因此，除了 [第 17 章](../Text/ch17.html "第 17 章. 使用 NDOUtils
    的灵活 Web 界面"）中描述的运行中的 NDO 数据库之外，您还需要一个具有 PHP 4.2 或更高版本的 Web 服务器，以及用于访问 NDO 数据库的
    **`php-mysql`** 包和用于绘制线条的 **`php-gd`** 包。[^[[187](#ftn.CHP-18-FN-3)]) 根据发行版和使用的
    PHP 版本，包名可能会有所不同。对于 Debian "Etch" 和 PHP5，您需要 **`libapache2-mod-php5, php5, php5-common,
    php5-gd`** 和 **`php5-mysql`** 包。
- en: NagVis does not necessarily have to be installed on the same computer as Nagios
    and the NDOUtils, although in many cases they are packed onto one host. The configuration
    of the NDO database—NagVis documentation refers to this as the *backend*—can refer
    (as described in [18.1.2 Initial configuration](../Text/ch18.html#initial_configuration
    "18.1.2 Initial configuration")) to any system you please. NagVis even allows
    the backend to be selected separately for each individual object so that maps
    can be generated that combine several Nagios installations in a single graphic.
  id: totrans-571
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然在许多情况下它们被打包在同一台主机上，但 NagVis 不一定必须安装在 Nagios 和 NDOUtils 相同的计算机上。NDO 数据库的配置——NagVis
    文档将其称为 *后端*——可以引用（如 [18.1.2 初始配置](../Text/ch18.html#initial_configuration "18.1.2
    初始配置"）中所述）任何您喜欢的系统。NagVis 甚至允许为每个单独的对象单独选择后端，以便可以生成结合单个图形中多个 Nagios 安装的地图。
- en: 18.1.1 Installing the source code
  id: totrans-572
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 18.1.1 安装源代码
- en: 'The NagVis source code, from [http://www.nagvis.org/downloads](http://www.nagvis.org/downloads),
    is unpacked in a directory of your choice:'
  id: totrans-573
  prefs: []
  type: TYPE_NORMAL
  zh: NagVis 源代码，从 [http://www.nagvis.org/downloads](http://www.nagvis.org/downloads)，解压到您选择的目录中：
- en: '[PRE50]'
  id: totrans-574
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: If a previous installation exists, you should back this up first. Then you copy
    the directory that has been created (in our case, **`nagvis-1.3`**) with the name
    **`nagvis`** to **`/usr/local/nagios/share:`**
  id: totrans-575
  prefs: []
  type: TYPE_NORMAL
  zh: 如果存在先前的安装，您应该首先备份它。然后，您将创建的目录（在我们的例子中，**`nagvis-1.3`**）以名称 **`nagvis`** 复制到
    **`/usr/local/nagios/share:`**
- en: '[PRE51]'
  id: totrans-576
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'The duplicated directory name **`nagvis`** can sometimes lead to confusion,
    but it is correct:'
  id: totrans-577
  prefs: []
  type: TYPE_NORMAL
  zh: 重复的目录名称 **`nagvis`** 有时会导致混淆，但这是正确的：
- en: '[PRE52]'
  id: totrans-578
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: '**`/usr/local/nagios/share/nagvis`** represents the main directory of the NagVis
    installation, while the subdirectory **`nagvis`** contains the NagVis application,
    together with its configuration. Finally the subdirectory **`wui`** contains the
    graphic editor that enables NagVis maps to be edited via the browser.'
  id: totrans-579
  prefs: []
  type: TYPE_NORMAL
  zh: '**`/usr/local/nagios/share/nagvis`** 代表 NagVis 安装的根目录，而子目录 **`nagvis`** 包含
    NagVis 应用程序及其配置。最后，子目录 **`wui`** 包含图形编辑器，它允许通过浏览器编辑 NagVis 地图。'
- en: 'At present, the correct access permissions for directories and files must be
    set manually. To do this, you first need to determine the user with whose permissions
    the Web server is running (see also [1.2 Compiling Source Code](../Text/ch01s02.html
    "1.2 Compiling Source Code"), page 39):'
  id: totrans-580
  prefs: []
  type: TYPE_NORMAL
  zh: 目前，必须手动设置目录和文件的正确访问权限。为此，您首先需要确定 Web 服务器运行的用户的权限（也参见 [1.2 编译源代码](../Text/ch01s02.html
    "1.2 编译源代码")，第 39 页）：
- en: '[PRE53]'
  id: totrans-581
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'The first **`grep`** command looks for the corresponding user in the configuration
    file for the Web server—in this case, Apache2—and then the **`id`** command searches
    for the primary group of this user. This can be found after the **`gid=`** specification.
    The access permissions are now set accordingly:'
  id: totrans-582
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个 **`grep`** 命令在 Web 服务器（在此情况下，Apache2）的配置文件中查找相应的用户，然后 **`id`** 命令搜索此用户的初始组。这可以在
    **`gid=`** 指定之后找到。现在将根据这些权限设置访问权限：
- en: '[PRE54]'
  id: totrans-583
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: Before the Web user interface can be used, you must create the central configuration
    file and ensure that access to NagVis is only possible after successful authentication.
  id: totrans-584
  prefs: []
  type: TYPE_NORMAL
  zh: 在可以使用 Web 用户界面之前，您必须创建中央配置文件并确保只有经过成功认证后才能访问 NagVis。
- en: 18.1.2 Initial configuration
  id: totrans-585
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 18.1.2 初始配置
- en: 'A template for the central NagVis configuration file **`config.ini.php`** can
    be found in the directory **`/usr/local/nagios/share/nagvis/etc`**, which only
    needs to be renamed and modified:'
  id: totrans-586
  prefs: []
  type: TYPE_NORMAL
  zh: 中央 NagVis 配置文件 **`config.ini.php`** 的模板可以在目录 **`/usr/local/nagios/share/nagvis/etc`**
    中找到，只需重命名和修改即可：
- en: '[PRE55]'
  id: totrans-587
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: The commands **`chown`** and **`chmod`** ensure that the correct access permissions
    are set for the Web user (here, **`www-data`**) and his group.
  id: totrans-588
  prefs: []
  type: TYPE_NORMAL
  zh: 命令 **`chown`** 和 **`chmod`** 确保为 Web 用户（在此处，**`www-data`**）及其组设置了正确的访问权限。
- en: Apart from the configuration of the backend (that is, the NDO database), the
    included **`config.ini.php`** already has usable defaults. The following description
    is therefore limited to introducing the most important parameters:^([[188](#ftn.CHP-18-FN-4)])
  id: totrans-589
  prefs: []
  type: TYPE_NORMAL
  zh: 除了后端（即 NDO 数据库）的配置之外，包含的 **`config.ini.php`** 已经有可用的默认值。因此，以下描述仅限于介绍最重要的参数:^([[188](#ftn.CHP-18-FN-4)])
- en: '[PRE56]'
  id: totrans-590
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: In the **`[global]`** section you can set the language with **`language`**;
    the default is **`english. refreshtime`** defines every how many seconds the display
    in the brower is refreshed.
  id: totrans-591
  prefs: []
  type: TYPE_NORMAL
  zh: 在 **`[global]`** 部分中，您可以使用 **`language`** 设置语言；默认为 **`english`**。`refreshtime`
    定义浏览器中显示刷新的秒数。
- en: 'The section **`[defaults]`** specifies defaults that are inherited by the defined
    objects from the map configuration. The values can be overwritten via the map,
    if required. It is best to define settings here that are identical for the majority
    of objects, in order to avoid the repeated work of defining them explicitly in
    the object definitions:'
  id: totrans-592
  prefs: []
  type: TYPE_NORMAL
  zh: 部分 **`[defaults]`** 指定了从映射配置继承的默认值。如果需要，可以通过映射覆盖这些值。最好在这里定义大多数对象都相同的设置，以避免在对象定义中重复明确地定义它们：
- en: '[PRE57]'
  id: totrans-593
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: '**`backend`** specifies which NDO database is used as the default backend.
    The name for this can be anything you like, but the backend itself must still
    be defined in a separate section (see [18.1.2 Initial configuration](../Text/ch18.html#initial_configuration
    "18.1.2 Initial configuration")). If you are just getting started, it is best
    to keep the name supplied, **`ndomy_1`**.'
  id: totrans-594
  prefs: []
  type: TYPE_NORMAL
  zh: '**`backend`** 指定用作默认后端的 NDO 数据库。此名称可以是任何您喜欢的，但后端本身必须在单独的部分中定义（参见 [18.1.2 初始配置](../Text/ch18.html#initial_configuration
    "18.1.2 初始配置")）。如果您刚开始，最好保留提供的名称，**`ndomy_1`**。'
- en: 'The parameter **`icons`** defines the icon set from the directory **`./nagvis/nagvis/images/iconsets`**
    that is to be used. Four sets are included: **`std_small, std_medium, std_big`**,
    and **`folder`**. Other icons can be downloaded from the NagVis homepage,^([[189](#ftn.CHP-18-FN-5)])
    or you can create them yourself.^([[190](#ftn.CHP-18-FN-6)])'
  id: totrans-595
  prefs: []
  type: TYPE_NORMAL
  zh: 参数 **`icons`** 定义了要使用的图标集，该图标集位于目录 **`./nagvis/nagvis/images/iconsets`** 中。包含四个集合：**`std_small,
    std_medium, std_big`** 和 **`folder`**。其他图标可以从 NagVis 主页下载，^([[189](#ftn.CHP-18-FN-5)])
    或者您可以自己创建它们.^([[190](#ftn.CHP-18-FN-6)])
- en: The setting **`recognizeserivces=1`** ensures for hosts and host groups that
    the current states of the accompanying services are included when the overall
    state is being determined. The value 0 switches off this behavior.
  id: totrans-596
  prefs: []
  type: TYPE_NORMAL
  zh: 设置 **`recognizeserivces=1`** 确保在确定整体状态时，包括伴随服务的当前状态。值 0 关闭此行为。
- en: '**`onlyhardstates=1`** on the other hand instructs NagVis to take only hard
    states into account. The default **`0`** also includes soft states.'
  id: totrans-597
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，**`onlyhardstates=1`**指示NagVis只考虑硬状态。默认值**`0`**也包括软状态。
- en: 'The **`[wui]`** section allows settings to be made for the NagVis editor:'
  id: totrans-598
  prefs: []
  type: TYPE_NORMAL
  zh: '**`[wui]`**部分允许为NagVis编辑器设置参数：'
- en: '[PRE58]'
  id: totrans-599
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: '**`autoupdatefreq`** determines how often (in number of seconds) the Web user
    interface automatically saves changes, while **`maplocktime`** specifies the number
    of minutes after which any further changes to a map that is currently being edited
    should be blocked, from the time of the last change. This is intended to prevent
    several users from simultaneously editing the same map.'
  id: totrans-600
  prefs: []
  type: TYPE_NORMAL
  zh: '**`autoupdatefreq`**确定Web用户界面自动保存更改的频率（以秒为单位），而**`maplocktime`**指定在当前正在编辑的地图上进一步更改应被阻止的分钟数，从上次更改的时间起。这是为了防止多个用户同时编辑同一地图。'
- en: 'The paths to the NagVis installation from the perspective of the file system
    (**`base`**) and—separately for NagVis data and NagVis CGIs—from the perspective
    of the browser, are specified in Section **`[paths]`**:'
  id: totrans-601
  prefs: []
  type: TYPE_NORMAL
  zh: 从文件系统（**`base`**）的角度以及从浏览器角度分别针对NagVis数据和NagVis CGIs，NagVis安装的路径在**`[paths]`**部分指定：
- en: '[PRE59]'
  id: totrans-602
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: The defaults listed here match the standard installation described above.
  id: totrans-603
  prefs: []
  type: TYPE_NORMAL
  zh: 此处列出的默认值与上述标准安装相匹配。
- en: 'The configuration for the backend, that is, for accessing the NDO database,
    follows at the bottom of the file:'
  id: totrans-604
  prefs: []
  type: TYPE_NORMAL
  zh: 后端配置，即访问NDO数据库的配置，位于文件底部：
- en: '[PRE60]'
  id: totrans-605
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: This name of this section must contain the name specified with the **`backend`**
    parameter under **`[defaults]`**, according to the pattern **`[backend_`****``*`value_of_backend]`*``**.
    The default here is **`ndomy_1`**. If the **`backend`** parameter value does not
    match any of the defined backend sections, NagVis will refuse to work.
  id: totrans-606
  prefs: []
  type: TYPE_NORMAL
  zh: 本节名称必须包含在`[defaults]`下通过**`backend`**参数指定的名称，根据模式**`[backend_`****``*`value_of_backend]`*``**。默认值此处为**`ndomy_1`**。如果**`backend`**参数值与定义的任何后端部分不匹配，NagVis将拒绝工作。
- en: '**`backendtype`** defines the type of backend, and for now **`ndomy`**—an NDO
    database based on MySQL—is the only possible value.'
  id: totrans-607
  prefs: []
  type: TYPE_NORMAL
  zh: '**`backendtype`**定义后端类型，目前**`ndomy`**——基于MySQL的NDO数据库——是唯一可能的值。'
- en: '**`dbhost`** and **`dbport`** specify the host name or IP address and the accompanying
    TCP port for access to the database. **`dbname`** contains the name of the NDO
    database, and **`dbuser`** and **`dbpass`** give the user and the password for
    access.'
  id: totrans-608
  prefs: []
  type: TYPE_NORMAL
  zh: '**`dbhost`**和**`dbport`**指定数据库访问的主机名或IP地址以及相应的TCP端口。**`dbname`**包含NDO数据库的名称，而**`dbuser`**和**`dbpass`**提供了访问的用户名和密码。'
- en: The values defined by default for **`dbprefix`** and **`dbinstancename`** are
    set for a NDOUtils standard installation. Provided that you have not changed the
    parameter **`instance_name`** in the file **`ndomod.cfg`** (see [17.4.1 Adjusting
    the Event Broker configuration](../Text/ch17s04.html#adjusting_the_event_broker_configuration
    "17.4.1 Adjusting the Event Broker configuration") from page 384) and **`db_prefix`**
    in the file **`ndo2db.cfg`** (see [17.4.2 Configuring database access](../Text/ch17s04.html#configuring_database_access
    "17.4.2 Configuring database access") from page 385), you can use the values given
    here.
  id: totrans-609
  prefs: []
  type: TYPE_NORMAL
  zh: 默认定义的**`dbprefix`**和**`dbinstancename`**值适用于NDOUtils标准安装。假设你没有在文件**`ndomod.cfg`**（见[17.4.1
    调整事件代理配置](../Text/ch17s04.html#adjusting_the_event_broker_configuration "17.4.1
    调整事件代理配置")第384页）中更改参数**`instance_name`**，以及在文件**`ndo2db.cfg`**（见[17.4.2 配置数据库访问](../Text/ch17s04.html#configuring_database_access
    "17.4.2 配置数据库访问")第385页）中更改**`db_prefix`**，你可以使用此处给出的值。
- en: One parameter to which you should pay particular attention is **`maxtime-withoutupdate:`**
    This defines how much time in seconds is allowed for the status update of Nagios
    to appear. If the time specified here is exceeded, NagVis assumes that the data
    is obsolete and displays this as an error. If NagVis accesses NDO databases that
    are distributed across several servers, it is essential that the clock times of
    the servers be synchronized with one another, otherwise NagVis will refuse to
    work if it comes across a time difference greater than **`maxtimewithoutupdate`**
    seconds.
  id: totrans-610
  prefs: []
  type: TYPE_NORMAL
  zh: 你应该特别注意的一个参数是**`maxtime-withoutupdate:`**。这定义了允许Nagios状态更新的秒数。如果此处指定的超时时间被超过，NagVis假定数据已过时，并将其显示为错误。如果NagVis访问分布在多个服务器上的NDO数据库，服务器之间的时钟时间必须相互同步，否则如果NagVis遇到大于**`maxtimewithoutupdate`**秒的时间差，它将拒绝工作。
- en: 'At this point we shall mention another problem involving data exchange between
    the NDO database and NagVis: NagVis evaluates the current program status. Nagios
    versions prior to 3.0b1, however, only write this to the NDO database *after*
    the nightly change of the log files. Starting with version 3.0b1, Nagios updates
    the status every five seconds, so that NagVis always has up-to-date information.'
  id: totrans-611
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，我们将提到另一个涉及NDO数据库与NagVis之间数据交换的问题：NagVis评估当前程序状态。然而，在3.0b1之前的Nagios版本中，它仅在夜间日志文件更改后将其写入NDO数据库。从3.0b1版本开始，Nagios每五秒更新一次状态，这样NagVis总是有最新的信息。
- en: 18.1.3 User authentication
  id: totrans-612
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 18.1.3 用户身份验证
- en: NagVis demands authentication from the user. Without user authentication, it
    will just issue an error message.^([[191](#ftn.CHP-18-FN-7)])
  id: totrans-613
  prefs: []
  type: TYPE_NORMAL
  zh: NagVis要求用户进行身份验证。如果没有用户身份验证，它将只显示错误消息.^([[191](#ftn.CHP-18-FN-7)])
- en: If the **`share`** directory of Nagios is not accessible for authentication,
    as in the Apache configuration in [1.5.1 Setting up Apache](../Text/ch01s05.html#setting_up_apache
    "1.5.1 Setting up Apache"), you should change this in the Apache configuration
    file **`/etc/apache2/conf.d/nagios`**. The authentication data are best taken
    from the CGI directory (see [1.5 Configuration of the Web Interface](../Text/ch01s05.html
    "1.5 Configuration of the Web Interface") from page 47).
  id: totrans-614
  prefs: []
  type: TYPE_NORMAL
  zh: 如果Nagios的**`share`**目录不可用于身份验证，例如在[1.5.1 设置Apache](../Text/ch01s05.html#setting_up_apache
    "1.5.1 设置Apache")中的Apache配置中，您应该在Apache配置文件**`/etc/apache2/conf.d/nagios`**中进行更改。认证数据最好从CGI目录中获取（参见第47页的[1.5
    配置Web界面](../Text/ch01s05.html "1.5 配置Web界面")）。
- en: '![After a right mouse click on the graphic displayed, the menu will appear](../Images/tagoreillycom20081104nostarchimages223944.png.jpg)'
  id: totrans-615
  prefs: []
  type: TYPE_IMG
  zh: '![在点击显示的图形后，将出现菜单](../Images/tagoreillycom20081104nostarchimages223944.png.jpg)'
- en: Figure 18-3. After a right mouse click on the graphic displayed, the menu will
    appear
  id: totrans-616
  prefs: []
  type: TYPE_NORMAL
  zh: 图18-3。在点击显示的图形后，将出现菜单
- en: '* * *'
  id: totrans-617
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[185](#CHP-18-FN-1)]) [http://www.nagvis.org/](http://www.nagvis.org/)
  id: totrans-618
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[185](#CHP-18-FN-1)]) [http://www.nagvis.org/](http://www.nagvis.org/)
- en: ^([[186](#CHP-18-FN-2)]) [http://www.nagvis.org/screenshots](http://www.nagvis.org/screenshots)
  id: totrans-619
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[186](#CHP-18-FN-2)]) [http://www.nagvis.org/screenshots](http://www.nagvis.org/screenshots)
- en: ^([[187](#CHP-18-FN-3)]) You can manage without using the GD libraries if the
    parameter **`usedgdlibs`** in the NagVis configuration file **`config.ini.php`**
    (see [18.1.1 Installing the source code](../Text/ch18.html#installing_the_source_code
    "18.1.1 Installing the source code")) is set to **`0`**.
  id: totrans-620
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[187](#CHP-18-FN-3)]) 如果在NagVis配置文件**`config.ini.php`**（参见[18.1.1 安装源代码](../Text/ch18.html#installing_the_source_code
    "18.1.1 安装源代码")）中将参数**`usedgdlibs`**设置为**`0`**，则可以不使用GD库来管理。
- en: ^([[188](#CHP-18-FN-4)]) The complete documentation can be found at [http://www.nagvis.org/docs/1.3/nagvis_config_format_description](http://www.nagvis.org/docs/1.3/nagvis_config_format_description).
  id: totrans-621
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[188](#CHP-18-FN-4)]) 完整的文档可以在[http://www.nagvis.org/docs/1.3/nagvis_config_format_description](http://www.nagvis.org/docs/1.3/nagvis_config_format_description)找到。
- en: ^([[189](#CHP-18-FN-5)]) [http://www.nagvis.org/downloads](http://www.nagvis.org/downloads)
  id: totrans-622
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[189](#CHP-18-FN-5)]) [http://www.nagvis.org/downloads](http://www.nagvis.org/downloads)
- en: ^([[190](#CHP-18-FN-6)]) A corresponding guide can be found at [http://www.nagvis.org/docs/extending/iconsets](http://www.nagvis.org/docs/extending/iconsets).
  id: totrans-623
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[190](#CHP-18-FN-6)]) 相应的指南可以在[http://www.nagvis.org/docs/extending/iconsets](http://www.nagvis.org/docs/extending/iconsets)找到。
- en: ^([[191](#CHP-18-FN-7)]) The FAQ entry [http://www.nagvis.org/docs/general/faq#how/to/run/nagvis/without/authentication/](http://www.nagvis.org/docs/general/faq#how/to/run/nagvis/without/authentication/)
    describes away of using NagVis without authentication, but you should avoid this,
    for reasons of security.
  id: totrans-624
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[191](#CHP-18-FN-7)]) FAQ条目[http://www.nagvis.org/docs/general/faq#how/to/run/nagvis/without/authentication/](http://www.nagvis.org/docs/general/faq#how/to/run/nagvis/without/authentication/)描述了在不进行身份验证的情况下使用NagVis的方法，但出于安全考虑，您应该避免这样做。
- en: 18.2 Creating NagVis Maps
  id: totrans-625
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 18.2 创建NagVis地图
- en: The NagVis configuration interface is accessed through the URL [http://nagiosserver/nagios/wui/index.php](http://nagiosserver/nagios/wui/index.php).
    Here you replace **``*`nagiosserver`*``** with your own Nagios host name ([Figure 18-3](../Text/ch18.html#after_a_right_mouse_click
    "Figure 18-3. After a right mouse click on the graphic displayed, the menu will
    appear") shows the start page).
  id: totrans-626
  prefs: []
  type: TYPE_NORMAL
  zh: 通过URL [http://nagiosserver/nagios/wui/index.php](http://nagiosserver/nagios/wui/index.php)
    访问NagVis配置界面。在这里，您将**``*`nagiosserver`*``**替换为您自己的Nagios主机名（[图18-3](../Text/ch18.html#after_a_right_mouse_click
    "图18-3. 在点击显示的图形后，将出现菜单")显示了起始页面）。
- en: It is operated through a menu that opens when you click the right mouse button.
    For browsers that overlay the NagVis menu with their own menu, a second click
    with the right mouse button will cause the browser menu to disappear.
  id: totrans-627
  prefs: []
  type: TYPE_NORMAL
  zh: 它通过在您点击右键鼠标按钮时打开的菜单来操作。对于将NagVis菜单与其自己的菜单叠加的浏览器，第二次右键单击鼠标按钮将导致浏览器菜单消失。
- en: If you don't have a suitable background graphic available in PNG format, you
    can create a new, empty background image via the menu item **Manage | Backgrounds**,
    as shown in [Figure 18-4](../Text/ch18s02.html#creating_a_new_comma_empty_background
    "Figure 18-4. Creating a new, empty background"). In this example, a gray image
    of size 800x600 pixels is created.
  id: totrans-628
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您没有可用的PNG格式的合适背景图形，您可以通过菜单项**管理 | 背景**（如图[图18-4](../Text/ch18s02.html#creating_a_new_comma_empty_background
    "图18-4。创建一个新的空背景"）所示）创建一个新的空背景图像。在此示例中，创建了一个800x600像素的灰色图像。
- en: '![Creating a new, empty background](../Images/tagoreillycom20081104nostarchimages223946.png.jpg)'
  id: totrans-629
  prefs: []
  type: TYPE_IMG
  zh: '![创建一个新的空背景](../Images/tagoreillycom20081104nostarchimages223946.png.jpg)'
- en: Figure 18-4. Creating a new, empty background
  id: totrans-630
  prefs: []
  type: TYPE_NORMAL
  zh: 图18-4。创建一个新的空背景
- en: This image is displayed on screen in its original size, that is, not scaled.
    To avoid scrolling, it should not be too large, with the proper size depending
    on the screen resolution and taking into account possible window frames.
  id: totrans-631
  prefs: []
  type: TYPE_NORMAL
  zh: 此图像以原始大小显示在屏幕上，即未缩放。为了避免滚动，它不应太大，适当的大小取决于屏幕分辨率，并考虑可能的窗口边框。
- en: 'Later on the image size can only be altered to a limited extent: although you
    can upload or create a background image at any time, objects that have already
    been placed are not affected by any changes in the size or other characteristics
    of the background, and so they may not fit properly into a new background image.
    The only option then is to reposition all the objects. The best approach is to
    experiment at first with just a few objects in the definitive environment before
    you set up an extensive map.'
  id: totrans-632
  prefs: []
  type: TYPE_NORMAL
  zh: 之后，图像大小只能有限度地更改：尽管您可以随时上传或创建背景图像，但已经放置的对象不会受到背景大小或其他特性的任何更改的影响，因此它们可能无法正确地适应新的背景图像。此时唯一的选择是重新定位所有对象。最佳方法是首先在最终环境中仅使用少数几个对象进行实验，然后再设置广泛的地图。
- en: '![If the entry for Map Iconset remains empty, NagVis uses the defaults from
    the central configuration.](../Images/tagoreillycom20081104nostarchimages223948.png.jpg)'
  id: totrans-633
  prefs: []
  type: TYPE_IMG
  zh: '![如果地图图标集的条目为空，NagVis将使用中央配置的默认值。](../Images/tagoreillycom20081104nostarchimages223948.png.jpg)'
- en: Figure 18-5. If the entry for Map Iconset remains empty, NagVis uses the defaults
    from the central configuration.
  id: totrans-634
  prefs: []
  type: TYPE_NORMAL
  zh: 图18-5。如果地图图标集的条目为空，NagVis将使用中央配置的默认值。
- en: You now create a new map for the generated or uploaded image. Via the menu entry
    **Manage | Maps** ([Figure 18-3](../Text/ch18.html#after_a_right_mouse_click "Figure 18-3. After
    a right mouse click on the graphic displayed, the menu will appear")) you navigate
    to the dialog shown in [Figure 18-5](../Text/ch18s02.html#if_the_entry_for_map_iconset_remains_emp
    "Figure 18-5. If the entry for Map Iconset remains empty, NagVis uses the defaults
    from the central configuration."). There you define the name of the map and select
    the background image. If every authenticated user should see the map, you enter
    **`EVERYONE`** as **User with read permissions**. For the **`User with write permissions`**,
    on the other hand, you would probably enter a specific user, or several user names,
    separated by commas. Defining the icon sets is optional at this point, although
    the example shown specifies them.
  id: totrans-635
  prefs: []
  type: TYPE_NORMAL
  zh: 您现在为生成的或上传的图像创建一个新的地图。通过菜单项**管理 | 地图**（[图18-3](../Text/ch18.html#after_a_right_mouse_click
    "图18-3。在显示的图形上右键单击后，将出现菜单"）），您导航到[图18-5](../Text/ch18s02.html#if_the_entry_for_map_iconset_remains_emp
    "图18-5。如果地图图标集的条目为空，NagVis将使用中央配置的默认值"）中显示的对话框。在那里，您定义地图的名称并选择背景图像。如果每个经过身份验证的用户都应该看到地图，您将**`EVERYONE`**作为**具有读取权限的用户**输入。对于**`具有写入权限的用户`**，另一方面，您可能输入一个特定的用户，或输入几个用户名，用逗号分隔。在此阶段定义图标集是可选的，尽管示例中指定了它们。
- en: Newly created maps are automatically opened by NagVis in editing mode. You can
    reach this later on via the menu item **Open Map** in the context menu of the
    opening dialog or by calling it directly with the URL [http://nagios/nagvis/wui/index.php?map=mapname](http://nagios/nagvis/wui/index.php?map=mapname).
  id: totrans-636
  prefs: []
  type: TYPE_NORMAL
  zh: 新创建的地图将自动由NagVis以编辑模式打开。您可以通过打开对话框的上下文菜单中的**打开地图**菜单项或直接通过URL [http://nagios/nagvis/wui/index.php?map=mapname](http://nagios/nagvis/wui/index.php?map=mapname)直接调用它。
- en: '![Inserting objects via the graphical interface](../Images/tagoreillycom20081104nostarchimages223950.png.jpg)'
  id: totrans-637
  prefs: []
  type: TYPE_IMG
  zh: '![通过图形界面插入对象](../Images/tagoreillycom20081104nostarchimages223950.png.jpg)'
- en: Figure 18-6. Inserting objects via the graphical interface
  id: totrans-638
  prefs: []
  type: TYPE_NORMAL
  zh: 图 18-6. 通过图形界面插入对象
- en: The **``*`mapname`*``** for the map created in [Figure 18-5](../Text/ch18s02.html#if_the_entry_for_map_iconset_remains_emp
    "Figure 18-5. If the entry for Map Iconset remains empty, NagVis uses the defaults
    from the central configuration.") is **`Test`**. In the map itself you now insert
    objects using the right mouse button (see [Figure 18-6](../Text/ch18s02.html#inserting_objects_via_the_graphical_inte
    "Figure 18-6. Inserting objects via the graphical interface")). An object can
    be an icon, a line, or a special object. Icons and lines represent the current
    state of a host or service and can also stand for entire host or service groups.
    Icons can only reflect the overall state of a map. Special objects are graphics
    representing stateless objects (which might be icons as well, for example) or
    text boxes, which can also be provided with a hyperlink.
  id: totrans-639
  prefs: []
  type: TYPE_NORMAL
  zh: 在 [图 18-5](../Text/ch18s02.html#if_the_entry_for_map_iconset_remains_emp "图
    18-5. 如果地图图标集的条目为空，NagVis 将使用中央配置中的默认值。") 中创建的地图的 **``*`mapname`*``** 为 **`Test`**。在地图本身中，你现在可以使用鼠标右键插入对象（见
    [图 18-6](../Text/ch18s02.html#inserting_objects_via_the_graphical_inte "图 18-6.
    通过图形界面插入对象")). 对象可以是图标、线条或特殊对象。图标和线条代表主机或服务的当前状态，也可以代表整个主机或服务组。图标只能反映地图的整体状态。特殊对象是表示无状态对象（例如，也可能是图标）或文本框的图形，这些文本框也可以提供超链接。
- en: To insert a host group you select **Add Object |Icon| Hostgroup** in the menu.
    Then you place the mouse over the desired position and define the destination
    of the icon with a left mouse click (the position can be changed later on).
  id: totrans-640
  prefs: []
  type: TYPE_NORMAL
  zh: 要插入主机组，请在菜单中选择 **添加对象 | 图标 | 主机组**。然后，将鼠标放在所需位置，并用鼠标左键定义图标的目的地（位置可以在以后更改）。
- en: When this is done a dialog opens, as shown in [Figure 18-7](../Text/ch18s02.html#defining_a_host_group_in_the_graphical
    "Figure 18-7. Defining a host group in the graphical interface"). The entry **backend_id**
    can remain empty, and NagVis will then use the value of the **`backend`** parameter
    from the central configuration file **`config.php.ini`**. In the **hostgroup_name**
    pulldown menu, NagVis allows you to select from all defined host groups.
  id: totrans-641
  prefs: []
  type: TYPE_NORMAL
  zh: 完成此操作后，将打开一个对话框，如图 18-7 所示。条目 **backend_id** 可以保持为空，此时 NagVis 将使用中央配置文件 **`config.php.ini`**
    中的 **`backend`** 参数的值。在 **hostgroup_name** 下拉菜单中，NagVis 允许您从所有定义的主机组中选择。
- en: Icons can be positioned according to the **x** and **y** coordinates by either
    entering numerical values or using the mouse. For simple icons, the point (x,
    y) corresponds to the center, and for lines to the start or end points. The z
    coordinate is only used when icons overlap. The value **`0`** describes the underlying
    image at the rear and is reserved for the background, and the object with the
    highest **z** value is right at the front. If the **z** coordinate is explicitly
    left empty when the object is inserted, it automatically receives the value **`1`**.
  id: totrans-642
  prefs: []
  type: TYPE_NORMAL
  zh: 可以通过输入数值或使用鼠标来根据 **x** 和 **y** 坐标定位图标。对于简单的图标，点 (x, y) 对应于中心，对于线条对应于起点或终点。z
    坐标仅在图标重叠时使用。值 **`0`** 描述的是后面的底层图像，并保留用于背景，而具有最高 **z** 值的对象就在最前面。如果插入对象时显式地留空 **z**
    坐标，它将自动接收值 **`1`**。
- en: '![Defining a host group in the graphical interface](../Images/tagoreillycom20081104nostarchimages223952.png.jpg)'
  id: totrans-643
  prefs: []
  type: TYPE_IMG
  zh: '![在图形界面中定义主机组](../Images/tagoreillycom20081104nostarchimages223952.png.jpg)'
- en: Figure 18-7. Defining a host group in the graphical interface
  id: totrans-644
  prefs: []
  type: TYPE_NORMAL
  zh: 图 18-7. 在图形界面中定义主机组
- en: The parameter **`recognize_services`** allows the **`recognizeservices`** setting
    from the **`config.ini.php`** (see [18.1.2 Initial configuration](../Text/ch18.html#initial_configuration
    "18.1.2 Initial configuration")) to be overridden, and **`only_hard_states`**
    does the same for the parameter **`onlyhardstates`** ([18.1.2 Initial configuration](../Text/ch18.html#initial_configuration
    "18.1.2 Initial configuration")).
  id: totrans-645
  prefs: []
  type: TYPE_NORMAL
  zh: 参数 **`recognize_services`** 允许覆盖 **`config.ini.php`** 中的 **`recognizeservices`**
    设置（见 [18.1.2 初始配置](../Text/ch18.html#initial_configuration "18.1.2 初始配置"))，而 **`only_hard_states`**
    对参数 **`onlyhardstates`** 执行相同的操作（[18.1.2 初始配置](../Text/ch18.html#initial_configuration
    "18.1.2 初始配置")）。
- en: The object inserted in this way always appears in the graphical editor in the
    form of the OK icon from the icon set chosen; the Web interface takes no account
    of its actual state.
  id: totrans-646
  prefs: []
  type: TYPE_NORMAL
  zh: 以这种方式插入的对象始终以所选图标集中的OK图标的形式出现在图形编辑器中；Web界面不考虑其实际状态。
- en: If you move the mouse over the icon, a hover menu opens, as shown in [Figure 18-8](../Text/ch18s02.html#if_you_move_the_mouse_over_the_inserted
    "Figure 18-8. If you move the mouse over the inserted object, a hover menu opens").
    It clearly distinguishes which settings are inherited and which ones have been
    specified directly in the object. If you follow the **Change** link there, the
    settings can be changed again.
  id: totrans-647
  prefs: []
  type: TYPE_NORMAL
  zh: 如果将鼠标移至图标上，将打开一个悬停菜单，如图[图18-8](../Text/ch18s02.html#if_you_move_the_mouse_over_the_inserted
    "图18-8. 如果将鼠标移至插入的对象上，将打开一个悬停菜单")所示。它清楚地区分了哪些设置是继承的，哪些是在对象中直接指定的。如果您点击那里的**更改**链接，可以再次更改设置。
- en: '![If you move the mouse over the inserted object, a hover menu opens](../Images/tagoreillycom20081104nostarchimages223954.png.jpg)'
  id: totrans-648
  prefs: []
  type: TYPE_IMG
  zh: '![如果将鼠标移至插入的对象上，将打开一个悬停菜单](../Images/tagoreillycom20081104nostarchimages223954.png.jpg)'
- en: Figure 18-8. If you move the mouse over the inserted object, a hover menu opens
  id: totrans-649
  prefs: []
  type: TYPE_NORMAL
  zh: 图18-8. 如果将鼠标移至插入的对象上，将打开一个悬停菜单
- en: When your work is finished, don't forget to save your changes via the context
    menu entry **Save** (see [Figure 18-3](../Text/ch18.html#after_a_right_mouse_click
    "Figure 18-3. After a right mouse click on the graphic displayed, the menu will
    appear") in page 396). The menu item **Open Map in NagVis** will then take you
    to the finished view, which now does display the actual states.
  id: totrans-650
  prefs: []
  type: TYPE_NORMAL
  zh: 当您的工作完成时，不要忘记通过上下文菜单中的**保存**（见第396页的[图18-3](../Text/ch18.html#after_a_right_mouse_click
    "图18-3. 在显示的图形上右键单击后，将出现菜单")）保存您的更改）。然后，**在NagVis中打开地图**菜单项将带您进入完成后的视图，现在它确实显示了实际状态。
- en: In [Figure 18-9](../Text/ch18s02.html#object_in_the_final_view_with_text_box
    "Figure 18-9. Object in the final view with text box and hover menu") a text box
    has been added to the host group icon. The field displayed beneath this is a hover
    menu, which shows information on the object and its state if you move the mouse
    over the object. This example shows that two hosts of the host group display a
    Not OK state and that this has already been confirmed with an acknowledgment.
  id: totrans-651
  prefs: []
  type: TYPE_NORMAL
  zh: 在[图18-9](../Text/ch18s02.html#object_in_the_final_view_with_text_box "图18-9. 最终视图中带有文本框和悬停菜单的对象")中，已为主机组图标添加了一个文本框。在此文本框下方显示的字段是一个悬停菜单，当鼠标移至对象上时，它会显示关于对象及其状态的信息。本例显示，主机组中的两个主机显示为“不正常”状态，并且这已经通过确认得到了证实。
- en: '![Object in the final view with text box and hover menu](../Images/tagoreillycom20081104nostarchimages223956.png.jpg)'
  id: totrans-652
  prefs: []
  type: TYPE_IMG
  zh: '![最终视图中带有文本框和悬停菜单的对象](../Images/tagoreillycom20081104nostarchimages223956.png.jpg)'
- en: Figure 18-9. Object in the final view with text box and hover menu
  id: totrans-653
  prefs: []
  type: TYPE_NORMAL
  zh: 图18-9. 最终视图中带有文本框和悬停菜单的对象
- en: The finished map can be called directly via the URL [http://nagiosserver/nagios/nagvis/nagvis/index.php?map=mapname](http://nagiosserver/nagios/nagvis/nagvis/index.php?map=mapname).
  id: totrans-654
  prefs: []
  type: TYPE_NORMAL
  zh: 完成的地图可以通过URL直接调用[http://nagiosserver/nagios/nagvis/nagvis/index.php?map=mapname](http://nagiosserver/nagios/nagvis/nagvis/index.php?map=mapname)。
- en: 18.2.1 Editing the configuration in text form
  id: totrans-655
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 18.2.1 以文本形式编辑配置
- en: NagVis stores the entire configuration of a map in text files, which can also
    be edited with a text editor. The files are located in the directory **`/usr/local/nagios/share/nagvis/etc/maps/`**.
    If you are using a background image with a known raster, you can insert several
    objects in the WUI and continue editing the map in the editor using the coordinates
    just determined. This is how the map shown in [Figure 18-2](../Text/ch18.html#displaying_the_system_environment
    "Figure 18-2. Displaying the system environment") was created. The background
    image ([Figure 18-1](../Text/ch18.html#schematic_diagram_of_a_system_environmen
    "Figure 18-1. Schematic diagram of a system environment as a template for NagVis"))
    was created with OpenOffice in order to obtain a reproducible raster; the OpenOffice
    drawing is subsequently exported as a PNG file.
  id: totrans-656
  prefs: []
  type: TYPE_NORMAL
  zh: NagVis将地图的整个配置存储在文本文件中，这些文件也可以使用文本编辑器进行编辑。这些文件位于目录**`/usr/local/nagios/share/nagvis/etc/maps/`**中。如果您使用的是已知栅格的背景图像，您可以在WUI中插入多个对象，并使用刚刚确定的坐标在编辑器中继续编辑地图。这就是[图18-2](../Text/ch18.html#displaying_the_system_environment
    "图18-2. 显示系统环境")中显示的地图是如何创建的。背景图像（[图18-1](../Text/ch18.html#schematic_diagram_of_a_system_environmen
    "图18-1. 系统环境的示意图作为NagVis的模板")）是用OpenOffice创建的，以便获得可重复的栅格；OpenOffice绘图随后导出为PNG文件。
- en: The configuration options for the text files, which altogether are very extensive,
    are described in the online documentation.^([[192](#ftn.CHP-18-FN-8)])
  id: totrans-657
  prefs: []
  type: TYPE_NORMAL
  zh: 文本文件的配置选项，总体来说非常广泛，已在在线文档中描述.^([[192](#ftn.CHP-18-FN-8)])
- en: 18.2.2 Adding NagVis maps to the Nagios Web interface
  id: totrans-658
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 18.2.2 将NagVis地图添加到Nagios Web界面
- en: NagVis maps can also be integrated into the Nagios Web interface. [Figure 18-10](../Text/ch18s02.html#nagvis_map_as_a_footnote_in_the_nagios
    "Figure 18-10. NagVis map as a "footnote" in the Nagios Web interface") shows
    these after a third frame has been added to the **`index.html`** page, which binds
    a 32-pixel-high map beneath the main window. No matter what the administrator
    is currently working on, the most important states (here these are the host groups)
    are always displayed directly and can be reached with a single mouse click. There
    are no limits to your user interface dreams when using NagVis!
  id: totrans-659
  prefs: []
  type: TYPE_NORMAL
  zh: NagVis地图也可以集成到Nagios Web界面中。[图18-10](../Text/ch18s02.html#nagvis_map_as_a_footnote_in_the_nagios
    "图18-10. NagVis地图作为Nagios Web界面中的“脚注”")显示了在**`index.html`**页面添加了第三个框架之后的情况，该框架将一个32像素高的地图绑定在主窗口下方。无论管理员当前在做什么，最重要的状态（在这里是主机组）总是直接显示，并且可以通过单次鼠标点击访问。使用NagVis时，你的用户界面梦想没有限制！
- en: '![NagVis map as a "footnote" in the Nagios Web interface](../Images/tagoreillycom20081104nostarchimages223958.png.jpg)'
  id: totrans-660
  prefs: []
  type: TYPE_IMG
  zh: '![NagVis地图作为Nagios Web界面中的“脚注”](../Images/tagoreillycom20081104nostarchimages223958.png.jpg)'
- en: Figure 18-10. NagVis map as a "footnote" in the Nagios Web interface
  id: totrans-661
  prefs: []
  type: TYPE_NORMAL
  zh: 图18-10. NagVis地图作为Nagios Web界面中的“脚注”
- en: '* * *'
  id: totrans-662
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[192](#CHP-18-FN-8)]) [http://www.nagvis.org/docs](http://www.nagvis.org/docs)
  id: totrans-663
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[192](#CHP-18-FN-8)]) [http://www.nagvis.org/docs](http://www.nagvis.org/docs)
- en: Chapter 19. Graphic Display of Performance Data
  id: totrans-664
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第19章. 性能数据的图形显示
- en: When Nagios reports to the administrator quickly and selectively on problems
    that have occurred, it can basically only distinguish between OK states and error
    states, sparing the admin a flood of information on problematic services and hosts.
    The graphic display of measured values over a time period cannot be integrated
    into this "traffic light approach," but it is available through third-party software.
    Nagios supports external processing of values with an interface created specifically
    for this. The data processed through it is referred to in Nagios jargon as *performance
    data*.
  id: totrans-665
  prefs: []
  type: TYPE_NORMAL
  zh: 当Nagios快速且选择性地向管理员报告发生的问题时，它基本上只能区分OK状态和错误状态，从而避免了管理员收到有关有问题的服务和主机的信息洪水。在一段时间内测量值的图形显示不能集成到这种“交通灯方法”中，但可以通过第三方软件实现。Nagios支持通过为此创建的接口进行外部处理值。通过它处理的数据在Nagios术语中被称为*性能数据*。
- en: 'Nagios has two different classes of performance data. The first is Nagiosinternal
    performance data, statistics on the performance times of tests and on the difference
    between the actual test time and the planned time (the *latency*). The second
    class includes performance data that the plugin passes on with the test result.
    This involves everything that the plugin can measure: response times, hard drive
    usage, system load, and so on. These are the very things that are of interest
    to an administrator, which is why the book concentrates on how they are processed.'
  id: totrans-666
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios有两种不同类的性能数据。第一类是Nagios内部性能数据，包括测试性能时间统计以及实际测试时间与计划时间之间的差异（*延迟*）。第二类包括插件与测试结果一起传递的性能数据。这包括插件可以测量的所有内容：响应时间、硬盘使用情况、系统负载等。这些都是管理员感兴趣的事情，这也是为什么本书专注于如何处理它们。
- en: Nagios extracts this data and either writes it to a file where it can be processed
    by other programs, or passes it on directly to the external software that is run
    after every service or host check.
  id: totrans-667
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios提取这些数据，要么将其写入文件以便其他程序处理，要么直接传递给在每次服务或主机检查之后运行的第三方软件。
- en: 19.1 Processing Plugin Performance Data with Nagios
  id: totrans-668
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 19.1 使用Nagios处理插件性能数据
- en: 'Performance data provided by service and host checks can be processed only
    if the corresponding plugin delivers it in a predefined format. As shown here
    using the **`check_icmp`** plugin ([6.2 Reachability Test with Ping](../Text/ch06s02.html
    "6.2 Reachability Test with Ping"), page 108), it is preceded by a **`|`** sign
    and is not shown in the Web interface:'
  id: totrans-669
  prefs: []
  type: TYPE_NORMAL
  zh: 只有当相应的插件以预定义的格式提供时，服务检查和主机检查提供的性能数据才能被处理。如图所示，使用**`check_icmp`**插件([6.2 使用Ping进行可达性测试](../Text/ch06s02.html
    "6.2 使用Ping进行可达性测试"), 第108页)，它以**`|`**符号开头，并且在Web界面中不显示：
- en: '[PRE61]'
  id: totrans-670
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'This standardized form is provided by most plugins only after version 1.4.^([[193](#ftn.CHP-19-FN-1)])
    The performance data itself consists of one or more variables in the following
    form:'
  id: totrans-671
  prefs: []
  type: TYPE_NORMAL
  zh: 这种标准化形式在大多数插件中仅在版本1.4之后提供.^([[193](#ftn.CHP-19-FN-1)]) 性能数据本身由以下形式的一个或多个变量组成：
- en: '[PRE62]'
  id: totrans-672
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: The variable **``*`name`*``** may contain spaces, but then it must be surrounded
    by single quotation marks. After the equals sign comes first the measured value
    as an integer or floating-point decimal, with or without a unit. Possible units
    are **`%`** (percentage), **`s`** (time in seconds), **`B`** (data size in bytes),
    or **`c`** (counter, an incremental counter).
  id: totrans-673
  prefs: []
  type: TYPE_NORMAL
  zh: 变量 **``*`name`*``** 可以包含空格，但此时它必须被单引号包围。等号之后首先是作为整数或浮点小数的测量值，可以带或不带单位。可能的单位有
    **`%`**（百分比）、**`s`**（秒）、**`B`**（字节大小）或 **`c`**（计数器，一个增量计数器）。
- en: This is followed, separated by a semicolon, by the warning and critical limits,
    and then the minimum and maximum value. Percentage values can be left out by the
    plugin. You can also specify **`0`** for minimum/maximum, as well as for the warning
    or critical limit, if there is no such threshold value. If there are several variables,
    these are separated with spaces, as in the **`check_icmp`** example. However,
    in contrast to this, the final specification should *not* end with a semicolon,
    according to the Developer Guidelines.
  id: totrans-674
  prefs: []
  type: TYPE_NORMAL
  zh: 此后，由分号分隔，接着是警告和临界限制，然后是最小和最大值。插件可以省略百分比值。您也可以为最小/最大值、警告或临界限制指定 **`0`**，如果不存在此类阈值值。如果有多个变量，它们可以用空格分隔，如
    **`check_icmp`** 示例所示。然而，与此相反，最后的指定不应以分号结束，根据开发者指南。
- en: 19.1.1 The template mechanism
  id: totrans-675
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.1.1 模板机制
- en: 'Nagios has two methods of processing performance data: either the system saves
    the data to a file using a *template*, or it executes an external command. If
    you just want to write data consistently to a log file, the template procedure
    is somewhat easier to configure.'
  id: totrans-676
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios有两种处理性能数据的方法：要么系统使用一个 *模板* 将数据保存到文件中，要么执行一个外部命令。如果您只想将数据持续写入日志文件，模板过程配置起来相对容易一些。
- en: In order that Nagios can process performance data at all, the parameter
  id: totrans-677
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使Nagios能够处理所有性能数据，该参数
- en: '[PRE63]'
  id: totrans-678
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: must be set to **`1`**. The file to which Nagios writes the host or service
    performance data is specified by the parameters **`host_perfdata_file`** and **`service_perfdata_file:`**
  id: totrans-679
  prefs: []
  type: TYPE_NORMAL
  zh: 必须设置为 **`1`**。Nagios将主机或服务性能数据写入的文件由参数 **`host_perfdata_file`** 和 **`service_perfdata_file:`**
- en: '[PRE64]'
  id: totrans-680
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: If **`host_perf data_file`** is commented out, as in this example, Nagios does
    not save any performance data of host checks. But since they are only used if
    all service checks fail, it lies in the nature of host checks that they only provide
    data sporadically and at irregular intervals. This is why it is not worth evaluating
    them in most cases.
  id: totrans-681
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 **`host_perf data_file`** 被注释掉，如本例所示，Nagios不会保存任何主机检查的性能数据。但鉴于它们仅在所有服务检查失败时才使用，主机检查的本质在于它们只提供零星且不规律的数据。这就是为什么在大多数情况下不值得评估它们的原因。
- en: 'The **`*_perf data_file_template`** parameters define the output format. The
    definition shown above, **`service_perfdata_file_template`**, delivers (one-line)
    log file entries in the following pattern:'
  id: totrans-682
  prefs: []
  type: TYPE_NORMAL
  zh: '**`*_perf data_file_template`** 参数定义了输出格式。上面显示的定义，**`service_perfdata_file_template`**，以以下模式提供（单行）日志文件条目：'
- en: '[PRE65]'
  id: totrans-683
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: Each line begins with a **`[SERVICEPERFDATA]`** "stamp," followed by the test
    time in epoch seconds **`($TIMET$)`**, the host name and service description (**`$HOSTNAME$`**
    and **`$SERVICEDESC$`**), the time Nagios requires for the test (**`$SERVICEEXECUTIONTIME$`**),
    and the latency between the planned and actual time of performance (**`$SERVICELATENCY$`**),
    each separated by a tab.
  id: totrans-684
  prefs: []
  type: TYPE_NORMAL
  zh: 每一行以一个 **`[SERVICEPERFDATA]`** “戳记”开始，后面跟着测试时间（以纪元秒 **`($TIMET$)`** 表示），主机名和服务描述（**`$HOSTNAME$`**
    和 **`$SERVICEDESC$`**），Nagios进行测试所需的时间（**`$SERVICEEXECUTIONTIME$`**），以及性能计划时间和实际时间之间的延迟（**`$SERVICELATENCY$`**），每个值之间用制表符分隔。
- en: 'Then Nagios writes the output for the Web interface to the log file (**`$SER-VICEOUTPUT$`**)
    and finally the actual performance data (**`$SERVICEPERF-DATA$`**). **`\t`** in
    the parameter definition ensures that a tab separates the individual details from
    each other in the log. With the **`*_perfdata_file_mode`** parameters you can
    define whether Nagios appends the data to an existing file (**`a`**) or overwrites
    the existing file (**`w`**):'
  id: totrans-685
  prefs: []
  type: TYPE_NORMAL
  zh: 然后Nagios将Web界面的输出写入日志文件（**`$SER-VICEOUTPUT$`**），最后写入实际性能数据（**`$SERVICEPERF-DATA$`**）。参数定义中的**`\t`**确保日志中的各个细节通过制表符分隔。使用**`*_perfdata_file_mode`**参数，您可以定义Nagios是将数据追加到现有文件（**`a`**）还是覆盖现有文件（**`w`**）：
- en: '[PRE66]'
  id: totrans-686
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'This is suitable for external programs that can read the data from a (previously
    set up) named pipe. This method provides better performance and does not require
    any space on the hard drive. If the processing software is not running, however,
    the data may be lost: Nagios does try for a time to continue writing to the pipe,
    but aborts this process after a timeout if the data cannot be read out.'
  id: totrans-687
  prefs: []
  type: TYPE_NORMAL
  zh: 这适用于可以读取（之前已设置）命名管道数据的程序。这种方法提供了更好的性能，并且不需要硬盘上的任何空间。然而，如果处理软件没有运行，数据可能会丢失：Nagios会尝试一段时间继续写入管道，但如果数据无法读出，则会超时并终止此过程。
- en: Programs that read from a log file generally delete it afterwards, to prevent
    the file system from overflowing. If the program does not retrieve any data, the
    file will grow quickly, but nothing will be lost as long as there is still space
    on the file system.
  id: totrans-688
  prefs: []
  type: TYPE_NORMAL
  zh: 从日志文件读取的程序通常会在之后删除它，以防止文件系统溢出。如果程序没有检索任何数据，文件会迅速增长，但只要文件系统还有空间，就不会丢失任何数据。
- en: 'It is best to run external evaluation software as a permanent service. But
    you can also configure Nagios so that it regularly triggers a program for further
    processing:'
  id: totrans-689
  prefs: []
  type: TYPE_NORMAL
  zh: 最好将外部评估软件作为永久服务运行。但您也可以配置Nagios，使其定期触发程序进行进一步处理：
- en: '[PRE67]'
  id: totrans-690
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'With the **`*_perfdata_file_processing_interval`** parameters you set an interval
    in seconds after which Nagios will carry on running the corresponding **`*_perf
    data_file_processirLg_command`** at specific intervals. This command is defined
    as a normal Nagios command object:'
  id: totrans-691
  prefs: []
  type: TYPE_NORMAL
  zh: 使用**`*_perfdata_file_processing_interval`**参数，您设置一个秒数间隔，在此之后Nagios将定期运行相应的**`*_perf
    data_file_processirLg_command`**。此命令被定义为正常的Nagios命令对象：
- en: '[PRE68]'
  id: totrans-692
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: As long as the external software itself looks after the further processing of
    the file with the performance data, you do need to use the **`*_perf data_file_processing_*`**
    parameters.
  id: totrans-693
  prefs: []
  type: TYPE_NORMAL
  zh: 只要外部软件本身负责处理性能数据文件，您就无需使用**`*_perf data_file_processing_*`**参数。
- en: 19.1.2 Using external commands to process performance data
  id: totrans-694
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.1.2 使用外部命令处理性能数据
- en: As an alternative to the template method, Nagios can also directly call a command
    that takes over further processing of data. This is done directly after each test
    result; so after each individual check, an external program is started. If you
    have a large number of services to be checked, this can, depending on the software,
    considerably degrade performance.
  id: totrans-695
  prefs: []
  type: TYPE_NORMAL
  zh: 作为模板方法的替代方案，Nagios还可以直接调用一个命令，该命令接管数据的进一步处理。这是在每个测试结果之后直接进行的；因此，在每个单独的检查之后，都会启动一个外部程序。如果您有大量需要检查的服务，这可能会根据软件的不同而显著降低性能。
- en: 'The command itself is defined with the **`process_perfdata_command`** parameter
    instead of the **`perfdata_file`** parameter:'
  id: totrans-696
  prefs: []
  type: TYPE_NORMAL
  zh: 命令本身是通过**`process_perfdata_command`**参数定义的，而不是通过**`perfdata_file`**参数：
- en: '[PRE69]'
  id: totrans-697
  prefs: []
  type: TYPE_PRE
  zh: '[PRE69]'
- en: 'In the same way as with service performance data, you can also process the
    results of host checks, using the **`host_perfdata_command`** parameter. **`process-service-perfdata`**
    itself again refers to a normal Nagios command object:'
  id: totrans-698
  prefs: []
  type: TYPE_NORMAL
  zh: 与服务性能数据相同，您还可以使用**`host_perfdata_command`**参数处理主机检查的结果。**`process-service-perfdata`**本身再次指的是一个正常的Nagios命令对象：
- en: '[PRE70]'
  id: totrans-699
  prefs: []
  type: TYPE_PRE
  zh: '[PRE70]'
- en: 'This opens the external program, which is given the necessary information as
    arguments. This should include at least the timestamp of the last service check
    (**`$LASTSERVICECHECK$`**), the host name (**`$HOSTNAME$`**), and the service
    description (**`$SERVICEDESC$`**), as well as the actual service performance data
    (**`$SERVICEPERFDATA$`**). The delimiter depends on the program used: this example
    uses **`||`**, as is used by the Nagiosgraph program.'
  id: totrans-700
  prefs: []
  type: TYPE_NORMAL
  zh: 这将打开外部程序，并将必要的信息作为参数传递给它。这应包括至少最后一次服务检查的时间戳（**`$LASTSERVICECHECK$`**）、主机名（**`$HOSTNAME$`**）、服务描述（**`$SERVICEDESC$`**），以及实际的服务性能数据（**`$SERVICEPERFDATA$`**）。分隔符取决于使用的程序：此示例使用**`||`**，这是Nagiosgraph程序使用的分隔符。
- en: '* * *'
  id: totrans-701
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[193](#CHP-19-FN-1)]) Some tools such as Nagiosgraph and NagiosGrapher make
    use of the fact that the remaining text normally contains performance data as
    well. If they are correspondingly configured, they are able to extract the performance
    data contained there. In this way they can further process data that does not
    conform to the standard format.
  id: totrans-702
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[193](#CHP-19-FN-1)]) 一些工具，如 Nagiosgraph 和 NagiosGrapher，利用了剩余文本通常也包含性能数据的事实。如果它们相应地配置，它们能够提取其中包含的性能数据。这样，它们可以进一步处理不符合标准格式的数据。
- en: 19.2 Graphs for the Web with Nagiosgraph
  id: totrans-703
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 19.2 使用 Nagiosgraph 在 Web 上创建图表
- en: With the program Nagiosgraph from [http://nagiosgraph.sf.net/](http://nagiosgraph.sf.net/),
    performance data supplied by plugins can be displayed graphically in a Web interface
    in chronological form. The software consists of two Perl scripts. The script **`insert.pl`**
    writes the Nagios performance data to a round-robin database, a ring buffer in
    which the newest data overwrites the oldest.^([[194](#ftn.CHP-19-FN-2)]) The advantage
    of this is the small amount of space required, which can be defined beforehand.
  id: totrans-704
  prefs: []
  type: TYPE_NORMAL
  zh: 使用来自 [http://nagiosgraph.sf.net/](http://nagiosgraph.sf.net/) 的程序 Nagiosgraph，插件提供的性能数据可以在
    Web 界面中以时间顺序的形式以图形方式显示。该软件由两个 Perl 脚本组成。脚本 **`insert.pl`** 将 Nagios 性能数据写入循环冗余数据库，这是一个环形缓冲区，其中最新数据会覆盖最旧数据^([[194](#ftn.CHP-19-FN-2)])。这种方法的优点是所需空间小，这可以在事先定义。
- en: 'The trick consists of saving data in various resolutions, depending on its
    age: older data with a lower resolution (e.g., one measurement value per day),
    current data with a high resolution (e.g., one measurement every five minutes).
    When setting up the database, you also define how long the data is retained. This
    defines space requirements right from the beginning.'
  id: totrans-705
  prefs: []
  type: TYPE_NORMAL
  zh: 这个技巧包括根据数据的不同年龄以不同的分辨率保存数据：较旧的数据以较低的分辨率（例如，每天一个测量值），当前数据以较高的分辨率（例如，每五分钟一个测量值）。在设置数据库时，您还定义了数据保留的时间长度。这从一开始就定义了空间需求。
- en: Provided that Nagiosgraph detects the performance data, the program creates
    a separate round-robin database for each new service, when it appears for the
    first time. The **`map`** configuration file included describes just a few services,
    so that usually some manual work—and a basic knowledge of Perl—is required.
  id: totrans-706
  prefs: []
  type: TYPE_NORMAL
  zh: 假设 Nagiosgraph 检测到性能数据，当它首次出现时，程序将为每个新服务创建一个单独的循环冗余数据库。包含的 **`map`** 配置文件仅描述了一些服务，因此通常需要一些手动工作——以及基本的
    Perl 知识。
- en: The second Nagiosgraph script **`show.cgi`**, a CGI script, represents the information
    from the database in a dynamic HTML page. To do this, it is run (after configuration
    is completed) in the form
  id: totrans-707
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个 Nagiosgraph 脚本 **`show.cgi`**，一个 CGI 脚本，以动态 HTML 页面的形式表示数据库中的信息。为此，它（在配置完成后）以以下形式运行
- en: '[PRE71]'
  id: totrans-708
  prefs: []
  type: TYPE_PRE
  zh: '[PRE71]'
- en: Nagiosgraph then displays four graphs (a daily, a weekly, a monthly, and a yearly
    summary) for the desired service.
  id: totrans-709
  prefs: []
  type: TYPE_NORMAL
  zh: Nagiosgraph 然后为所需服务显示四个图表（每日、每周、每月和年度摘要）。
- en: 19.2.1 Basic installation
  id: totrans-710
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.2.1 基本安装
- en: An installed RRDtool package, which is contained in most Linux distributions,
    is a prerequisite for Nagiosgraph. Alternatively you can obtain the current source
    code from [http://www.rrdtool.org/](http://www.rrdtool.org/).^([[195](#ftn.CHP-19-FN-3)])
    For reasons of performance, it is recommended here that you also install the included
    Perl module **`RRDs`**.
  id: totrans-711
  prefs: []
  type: TYPE_NORMAL
  zh: 安装在 Linux 发行版中的 RRDtool 软件包是 Nagiosgraph 的先决条件。或者，您可以从 [http://www.rrdtool.org/](http://www.rrdtool.org/)
    获取当前源代码。出于性能考虑，建议您还安装包含的 Perl 模块 **`RRDs`**。
- en: 'The Nagiosgraph tar file itself is preferably unpacked in the directory **`/usr/local/nagios`**:'
  id: totrans-712
  prefs: []
  type: TYPE_NORMAL
  zh: 建议将 Nagiosgraph 的 tar 文件解压缩到目录 **`/usr/local/nagios`**：
- en: '[PRE72]'
  id: totrans-713
  prefs: []
  type: TYPE_PRE
  zh: '[PRE72]'
- en: '**`insert.pl`** extracts the data transferred by Nagios and inserts this into
    the RRD database. If this does not exist, however, the script will create it.
    Alternatively **`insert_fast.pl`** can take on this task. This script uses the
    Perl module **`RRDs`**, which is considerably more efficient than calling up **`rrdtool`**
    as an external program each time, which is what **`insert.pl`** does.'
  id: totrans-714
  prefs: []
  type: TYPE_NORMAL
  zh: '**`insert.pl`** 提取 Nagios 传输的数据并将其插入到 RRD 数据库中。如果该数据库不存在，则脚本将创建它。或者，**`insert_fast.pl`**
    可以承担这项任务。此脚本使用 Perl 模块 **`RRDs`**，这比每次调用外部程序 **`rrdtool`**（这是 **`insert.pl`**
    所做的）要高效得多。'
- en: Another Perl script called **`testentry.pl`** helps if you are testing your
    own **`map`** entries. But since you have to write these directly into this file,
    you can also change the **`map`** file itself (as shown below)—provided you have
    made a backup copy first. The CGI script **`testcolor.cgi`** looks more like a
    developer's utility left over in the package, rather than a tool that is of any
    use for users.
  id: totrans-715
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个名为 **`testentry.pl`** 的 Perl 脚本可以帮助您测试自己的 **`map`** 条目。但既然您必须直接将它们写入此文件，您也可以更改
    **`map`** 文件本身（如下所示）——前提是您已经创建了备份副本。CGI 脚本 **`testcolor.cgi`** 更像是一个开发者遗留在包中的工具，而不是对用户有任何帮助的工具。
- en: 'Apart from the already mentioned **`map`** configuration file, there is a second
    one, **`nagiosgraph.conf`**, and its path must be defined correctly in both **`insert.pl`**
    (or **`insert_fast.pl`**) and **`show.cgi`**, so it is recommended that you check
    this:'
  id: totrans-716
  prefs: []
  type: TYPE_NORMAL
  zh: 除了已经提到的 **`map`** 配置文件外，还有一个名为 **`nagiosgraph.conf`** 的第二个配置文件，并且其路径必须在 **`insert.pl`**（或
    **`insert_fast.pl`**）和 **`show.cgi`** 中正确定义，因此建议您检查这一点：
- en: '[PRE73]'
  id: totrans-717
  prefs: []
  type: TYPE_PRE
  zh: '[PRE73]'
- en: 19.2.2 Configuration
  id: totrans-718
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.2.2 配置
- en: The configuration file **`nagiosgraph.conf`**
  id: totrans-719
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置文件 **`nagiosgraph.conf`**
- en: 'All other relevant paths—such as those to the **`map`** file and to the **`rrdtool`**—are
    adjusted in **`nagiosgraph.conf`**:'
  id: totrans-720
  prefs: []
  type: TYPE_NORMAL
  zh: 所有其他相关路径——例如到 **`map`** 文件和到 **`rrdtool`** 的路径——都在 **`nagiosgraph.conf`** 中调整：
- en: '[PRE74]'
  id: totrans-721
  prefs: []
  type: TYPE_PRE
  zh: '[PRE74]'
- en: 'Nagiosgraph creates the RRD databases in the **`rrddir`** directory. Here the
    user **`nagios`** must have write access and the user with whose rights the Web
    server is running must have read access:'
  id: totrans-722
  prefs: []
  type: TYPE_NORMAL
  zh: Nagiosgraph 在 **`rrddir`** 目录中创建 RRD 数据库。在这里，用户 **`nagios`** 必须有写权限，而以该用户的权限运行的
    Web 服务器用户必须有读权限：
- en: '[PRE75]'
  id: totrans-723
  prefs: []
  type: TYPE_PRE
  zh: '[PRE75]'
- en: 'The log file, for which both users need write access (the Web user because
    the CGI script also records information to the log file), is also critical:'
  id: totrans-724
  prefs: []
  type: TYPE_NORMAL
  zh: 对于这两个用户都需要写访问权限的日志文件（Web 用户因为 CGI 脚本也会将信息记录到日志文件中），也是至关重要的：
- en: '[PRE76]'
  id: totrans-725
  prefs: []
  type: TYPE_PRE
  zh: '[PRE76]'
- en: 'How verbose Nagiosgraph is can be adjusted with **`debug`**. The possible debug
    levels are documented in the configuration file included: **`2`** means "errors,"
    **`4`** "information"—here Nagiosgraph is already so verbose that you must watch
    out that the file system does not overflow. Except for debugging purposes (such
    as when setting up the system), it is better to choose **`2`**.'
  id: totrans-726
  prefs: []
  type: TYPE_NORMAL
  zh: Nagiosgraph 的详细程度可以通过 **`debug`** 调整。可能的调试级别在包含的配置文件中有文档说明：**`2`** 表示“错误”，“**4**”表示“信息”——在这里
    Nagiosgraph 已经非常详细，你必须注意文件系统不要溢出。除了调试目的（例如设置系统时）外，最好选择 **`2`**。
- en: With **`colorscheme`**, which can accept values from 1 to 8, you can influence
    the amount of color in the graphs—it is best to try out the options to see which
    color scheme matches your personal taste best.
  id: totrans-727
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 **`colorscheme`**，它可以接受从 1 到 8 的值，你可以影响图表中的颜色数量——最好是尝试不同的选项，看看哪个配色方案最适合你的个人品味。
- en: Nagios configuration
  id: totrans-728
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Nagios 配置
- en: Nagiosgraph grabs the performance data directly from Nagios. For this reason
    **`nagios.cfg`** does not require any **`*_perfdata_file_*`** parameters.
  id: totrans-729
  prefs: []
  type: TYPE_NORMAL
  zh: Nagiosgraph 直接从 Nagios 抓取性能数据。因此，**`nagios.cfg`** 不需要任何 **`*_perfdata_file_*`**
    参数。
- en: '[PRE77]'
  id: totrans-730
  prefs: []
  type: TYPE_PRE
  zh: '[PRE77]'
- en: '**`process_performance_data`** switches on processing of performance data in
    general; **`service_perfdata_command`** refers to the Nagios command object that
    contains the external command:'
  id: totrans-731
  prefs: []
  type: TYPE_NORMAL
  zh: '**`process_performance_data`** 开启了性能数据的处理；**`service_perfdata_command`** 指向包含外部命令的
    Nagios 命令对象：'
- en: '[PRE78]'
  id: totrans-732
  prefs: []
  type: TYPE_PRE
  zh: '[PRE78]'
- en: The definition of the parameter **`command_line`** must be written on one line
    (without the backslashes **`\`**), as usual.
  id: totrans-733
  prefs: []
  type: TYPE_NORMAL
  zh: 参数 **`command_line`** 的定义必须写在一行中（不使用反斜杠 **`\`**），就像通常一样。
- en: 'So that the CGI script can run directly from the Nagios Web interface, a **`serviceextinfo`**
    object is defined:'
  id: totrans-734
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使 CGI 脚本可以直接从 Nagios Web 界面运行，定义了一个 **`serviceextinfo`** 对象：
- en: '[PRE79]'
  id: totrans-735
  prefs: []
  type: TYPE_PRE
  zh: '[PRE79]'
- en: 'If the graphic defined in **`icon_image`** is in the directory **`/usr/local/nagios/share/images/logos`**,
    the Web interface marks the **`PING`** services for all hosts in the status display
    with this.^([[196](#ftn.CHP-19-FN-4)]) Here the strength of show.cgi can be seen:
    only because this script is called explicitly with host and service names is a
    definition like the one above possible. Instead of an individual host name, you
    can also specify a host group, or, as in this example, a **`*`**. A requirement
    for this is that PING really is defined as a service for every host.'
  id: totrans-736
  prefs: []
  type: TYPE_NORMAL
  zh: '如果在 **`icon_image`** 中定义的图形位于目录 **`/usr/local/nagios/share/images/logos`**
    中，Web 界面将所有主机的 **`PING`** 服务在状态显示中标记为这个。在这里可以看到 show.cgi 的强大之处：正是因为这个脚本明确地用主机和服务名称调用，才可能定义像上面的定义。除了单个主机名称外，您也可以指定一个主机组，或者，就像这个例子中一样，一个
    **`*`**。这个要求是 PING 确实被定义为每个主机的服务。 '
- en: The **`$HOSTNAME$`** macro then automatically inserts the appropriate host.
    The additional information for a specific service type (which must have the same
    service description in all hosts) can therefore be catered for with just one single
    definition.
  id: totrans-737
  prefs: []
  type: TYPE_NORMAL
  zh: '**`$HOSTNAME$`** 宏随后自动插入适当的主机。因此，对于特定服务类型（必须在所有主机中具有相同的服务描述）的附加信息，只需一个单一的定义即可满足。'
- en: Apache configuration
  id: totrans-738
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Apache 配置
- en: 'So that the Apache Web server can accept the CGI script as it is, a **`Script-Alias`**
    is created, for example:'
  id: totrans-739
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使 Apache 网络服务器能够接受 CGI 脚本，创建了一个 **`Script-Alias`**，例如：
- en: '[PRE80]'
  id: totrans-740
  prefs: []
  type: TYPE_PRE
  zh: '[PRE80]'
- en: This entry is best placed in the configuration file discussed in [1.5 Configuration
    of the Web Interface](../Text/ch01s05.html "1.5 Configuration of the Web Interface")
    (page 47), **`nagios.conf`**. Only after Apache is reloaded can the CGI script
    be run from the URL specified in [19.2 Graphs for the Web with Nagiosgraph](../Text/ch19s02.html
    "19.2 Graphs for the Web with Nagiosgraph").
  id: totrans-741
  prefs: []
  type: TYPE_NORMAL
  zh: 此条目最好放在 [1.5 网络界面的配置](../Text/ch01s05.html "1.5 网络界面的配置")（第 47 页）中讨论的配置文件 **`nagios.conf`**。只有在重新加载
    Apache 之后，才能从 [19.2 使用 Nagiosgraph 的网络图表](../Text/ch19s02.html "19.2 使用 Nagiosgraph
    的网络图表") 中指定的 URL 运行 CGI 脚本。
- en: Adjustments to the map
  id: totrans-742
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 对 map 的调整
- en: 'Depending on the service, the round-robin database may also save several series
    of measurements, which can be requested individually through the CGI script:'
  id: totrans-743
  prefs: []
  type: TYPE_NORMAL
  zh: 根据服务类型，循环冗余数据库也可能保存多个测量系列，这些系列可以通过 CGI 脚本单独请求：
- en: '[PRE81]'
  id: totrans-744
  prefs: []
  type: TYPE_PRE
  zh: '[PRE81]'
- en: The database used here contains at least three different series of measurements,
    the first two of which are shown together in one graphic, while the third is shown
    in a separate graphic. What is shown together and what is separate depends on
    the standardization. It makes little sense to display the percentage load of a
    hard drive and the absolute value in bytes in the same graphic, since the Y axis
    can only have one scale. It is better here to display percentage values in one
    graphic and absolute byte values in a second one. On the other hand you can display
    the various average values of the system load (for one, five, and 15 minutes)
    in a single graphic. If you leave out all **`db`**= specifications, Nagiosgraph
    always displays all measured values for a service in a single graphic.
  id: totrans-745
  prefs: []
  type: TYPE_NORMAL
  zh: 这里使用的数据库包含至少三个不同的测量系列，前两个系列在一张图中一起显示，而第三个系列则在单独的图中显示。显示在一起和显示分开的内容取决于标准化。在同一个图中显示硬盘的百分比负载和绝对字节数没有太大意义，因为
    Y 轴只能有一个刻度。在这里，最好在一张图中显示百分比值，在另一张图中显示绝对字节数。另一方面，可以在一张图中显示系统负载的各种平均值（一分钟、五分钟和十五分钟）。如果您省略所有
    **`db`**= 规范，Nagiosgraph 总是会在一张图中显示一个服务的所有测量值。
- en: What individual databases and measured values display is defined by the **`map`**
    file. To understand how the instructions contained there influence the extraction
    of data, you just need to switch the debugging level to **`4`** and take a look
    at the output in the log file **`nagiosgraph.log`**. Each time the insert function
    is run, Nagiosgraph rereads the configuration files, so that this does not cause
    any kind of reset.
  id: totrans-746
  prefs: []
  type: TYPE_NORMAL
  zh: 个体数据库和测量值显示的内容由 **`map`** 文件定义。要了解其中包含的指令如何影响数据的提取，只需将调试级别切换到 **`4`** 并查看日志文件
    **`nagiosgraph.log`** 中的输出。每次插入函数运行时，Nagiosgraph 会重新读取配置文件，因此这不会引起任何类型的重置。
- en: 'In the following extract from the log file the three dots mark sections which
    we will not print, for the sake of clarity:'
  id: totrans-747
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下日志文件摘录中，三个点标记了我们为了清晰起见不会打印的部分：
- en: '[PRE82]'
  id: totrans-748
  prefs: []
  type: TYPE_PRE
  zh: '[PRE82]'
- en: The output is from the **`check_icmp`** plugin. The host name, service description,
    performance data, (**`perfdata:`**) and the standard output line (**`output:`**)
    each have their own line. In the performance data the plugin announces the *round
    trip average* with the variable **`rta`**, and the number of packets that have
    gone missing with **`pl`** (*packet loss*).
  id: totrans-749
  prefs: []
  type: TYPE_NORMAL
  zh: 输出来自 **`check_icmp`** 插件。主机名、服务描述、性能数据（**`perfdata:`**）和标准输出行（**`output:`**）各自占一行。在性能数据中，插件使用变量
    **`rta`** 宣布 *往返平均*，并使用 **`pl`**（*数据包丢失*）表示丢失的数据包数量。
- en: 'The **`map`** file contains Perl instructions that filter these outputs and
    extracts the corresponding data if there are hits. Each of them starts with a
    search instruction:'
  id: totrans-750
  prefs: []
  type: TYPE_NORMAL
  zh: '**`map`** 文件包含 Perl 指令，用于过滤这些输出并提取相应的数据（如果有匹配项）。每个指令都以一个搜索指令开始：'
- en: '[PRE83]'
  id: totrans-751
  prefs: []
  type: TYPE_PRE
  zh: '[PRE83]'
- en: The classic Perl search function consists of the two forward slashes **`/`**
    with a search pattern in the form of a regular expression in between. Round pairs
    of brackets enclose partial patterns with which the text found in this way can
    later be accessed using the variables **`$1`**, **`$2`**, etc.
  id: totrans-752
  prefs: []
  type: TYPE_NORMAL
  zh: 经典的 Perl 搜索函数由两个连续的斜杠 **`/`** 组成，其中包含一个正则表达式形式的搜索模式。圆括号对包围的部分模式，通过这种方式找到的文本可以通过变量
    **`$1`**、**`$2`** 等访问。
- en: The pattern in the first bracket thus matches a single digit (**`\d`**) or a
    dot,^([[197](#ftn.CHP-19-FN-5)]) and the next + states that there can be several
    of them (or none at all). In the second round brackets, though, one or more digits
    are allowed, but no period. In concrete terms **`$1`** delivers the numerical
    value of the response time, **`$2`** provides the packet loss in percent.
  id: totrans-753
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，第一个括号中的模式匹配单个数字（**`\d`**）或点，^([[197](#ftn.CHP-19-FN-5)]) 并且下一个 + 状态表示可以有多个（或一个也没有）。然而，在第二个圆括号中，允许一个或多个数字，但不能有点。具体来说，**`$1`**
    提供响应时间的数值，**`$2`** 提供百分比中的数据包丢失。
- en: 'The full instruction in the **`map`** file links two Perl statements with the
    **`and`** operator:'
  id: totrans-754
  prefs: []
  type: TYPE_NORMAL
  zh: '**`map`** 文件中的完整指令使用 **`and`** 操作符链接两个 Perl 语句：'
- en: '[PRE84]'
  id: totrans-755
  prefs: []
  type: TYPE_PRE
  zh: '[PRE84]'
- en: 'If the first one—the search function—is successful, then it is the turn of
    the **`push`** statement. It adds the expression in square brackets following
    to the array **`@s`**. The instruction ends with a semicolon. If the search function
    provides no result, the **`map`** instruction will not save any entry in the **`@s`**
    array. The expression to be included in the array has the following format:'
  id: totrans-756
  prefs: []
  type: TYPE_NORMAL
  zh: 如果第一个——搜索函数——成功，那么轮到 **`push`** 语句。它将方括号中跟随的表达式添加到数组 **`@s`** 中。指令以分号结束。如果搜索函数没有提供结果，则
    **`map`** 指令不会在 **`@s`** 数组中保存任何条目。要包含在数组中的表达式具有以下格式：
- en: '[PRE85]'
  id: totrans-757
  prefs: []
  type: TYPE_PRE
  zh: '[PRE85]'
- en: The file name for a Nagiosgraph database file consists of the host name, service
    description, and the database name together, for example, **`linux01_PING_ping.rrd`**.
    The desired string for the database name is entered instead of the placeholder
    *db-name* into the **`map`** file (in this case, **`ping`**).
  id: totrans-758
  prefs: []
  type: TYPE_NORMAL
  zh: Nagiosgraph 数据库文件的文件名由主机名、服务描述和数据库名组合而成，例如，**`linux01_PING_ping.rrd`**。数据库名称的期望字符串应输入到
    **`map`** 文件中（在这种情况下，**`ping`**）代替占位符 *db-name*。
- en: The name of the data source can be chosen freely, but should contain an indication
    of the data that is stored here, such as **`rta`** for the response time or **`losspct`**
    for percentage of packets that have been lost.
  id: totrans-759
  prefs: []
  type: TYPE_NORMAL
  zh: 数据源名称可以自由选择，但应包含存储在此处的数据的指示，例如，**`rta`** 表示响应时间或 **`losspct`** 表示丢失的包的百分比。
- en: What *type* you specify is determined by the RRD tools. **`GAUGE`** stands for
    simple measured values that are displayed simply as they are. **`DERIVE`** is
    recommended by Nagiosgraph author Soren Dossing for processing counters, such
    as in querying a packet counter on the network interface. Counters grow incrementally
    and, when they run over, start again at zero. What is of interest here is the
    difference between two points in time. The RRD database determines these automatically
    if the data source type **`DERIVE`** is specified.
  id: totrans-760
  prefs: []
  type: TYPE_NORMAL
  zh: 您指定的 *类型* 由 RRD 工具确定。**`GAUGE`** 表示简单测量值，它们以原样显示。Nagiosgraph 作者 Soren Dossing
    推荐使用 **`DERIVE`** 处理计数器，例如在查询网络接口上的数据包计数器。计数器增量增长，当它们溢出时，从零开始。这里感兴趣的是两个时间点之间的差异。如果指定数据源类型
    **`DERIVE`**，RRD 数据库将自动确定这些值。
- en: The database name, data source, and type should always be placed in single quotation
    marks in the **`map`** file, so that no name conflicts can occur with keywords
    reserved in Perl.
  id: totrans-761
  prefs: []
  type: TYPE_NORMAL
  zh: 数据库名称、数据源和类型应始终在 **`map`** 文件中以单引号放置，以防止与 Perl 中保留的关键字发生名称冲突。
- en: 'The measured value itself is determined using Perl methods, and the placeholder
    *value* is substituted with the corresponding instructions. In the simplest case,
    you take over the values found with the search pattern in the performance data
    with **`$1`**, **`$2`**, etc. (see example above), or calculate new values from
    these by multiplying^([[198](#ftn.CHP-19-FN-6)]) by 1024 or by calculating the
    percentage:'
  id: totrans-762
  prefs: []
  type: TYPE_NORMAL
  zh: 测量值本身是通过 Perl 方法确定的，占位符 *value* 被相应的指令替换。在最简单的情况下，您可以使用 **`$1`**、**`$2`** 等等（见上面的示例）来接管性能数据中找到的值，或者通过乘以
    1024 或计算百分比来计算新值：
- en: '[PRE86]'
  id: totrans-763
  prefs: []
  type: TYPE_PRE
  zh: '[PRE86]'
- en: The first entry evaluates the query of hard drive space on a Windows server
    with **`check_nt`** (see [20.2.1 NSClient](../Text/ch20s02.html#nsclient "20.2.1
    NSClient"), page 476). The performance data also contains, apart from the occupied
    space in **`$1`**, the size of the data carrier in **`$5`**. This can be used
    to calculate the percentage that is available (**`freepct`**) and the percentage
    used (**`usepct`**).
  id: totrans-764
  prefs: []
  type: TYPE_NORMAL
  zh: 第一条记录评估了Windows服务器上**`check_nt`**（见[20.2.1 NSClient](../Text/ch20s02.html#nsclient
    "20.2.1 NSClient")，第476页）对硬盘空间的查询。性能数据还包含除**`$1`**中的占用空间外，还有**`$5`**中的数据载体大小。这可以用来计算可用百分比（**`freepct`**）和已用百分比（**`usepct`**）。
- en: 'The second example evaluates data obtained on a Unix host, with **`check_ disk`**,
    by multiplying the free hard drive space specified in MB by 1024² to convert it
    to bytes. The critical and warning limits always remain constant, which leads
    to horizontal lines, as seen in [Figure 19-1](../Text/ch19s02.html#used_space_and_limit_values_for_the_fil
    "Figure 19-1. Used space and limit values for the file system /net/linux01/a on
    the host linux0l, as Nagiosgraph represents them"): the lower line at 12.1 GB
    represents the warning limit, the middle line the current load, and the top line
    at 18.1 GB, the critical limit. The keys for the individual graphs each list minimum,
    maximum, and average as a numerical value. This differentiation for the two limit
    values is not of any use, but it cannot be avoided, since Nagiosgraph does not
    know that these are constant values: it treats warning and critical limits just
    like any other measured values.'
  id: totrans-765
  prefs: []
  type: TYPE_NORMAL
  zh: 第二个示例通过将指定的MB数空闲硬盘空间乘以1024²来转换成字节，评估Unix主机上通过**`check_ disk`**获得的数据。关键和警告限制始终保持不变，这导致出现水平线，如[图19-1](../Text/ch19s02.html#used_space_and_limit_values_for_the_fil
    "图19-1. 主机`linux0l`上文件系统`/net/linux01/a`的使用空间和限制值，如Nagiosgraph所示")所示：下方的线在12.1
    GB处代表警告限制，中间的线代表当前负载，上方的线在18.1 GB处，代表关键限制。每个单独的图表的键列出了最小值、最大值和平均值作为数值。这种对两个限制值的区分没有任何用处，但无法避免，因为Nagiosgraph不知道这些是常数：它将警告和关键限制值视为任何其他测量值。
- en: If a plugin does not provide any performance data, but values that are used
    in normal output, the search function can be applied to the output (**`/output:.../`**)
    instead of to the performance data. Help is provided, for example, by the Nagiosgraph
    Forum at [http://sourceforge.net/forum/forum.php?forum_id=394748](http://sourceforge.net/forum/forum.php?forum_id=394748).
  id: totrans-766
  prefs: []
  type: TYPE_NORMAL
  zh: 如果插件不提供任何性能数据，但提供在正常输出中使用的值，则可以将搜索功能应用于输出（**`/output:.../`**）而不是性能数据。例如，Nagiosgraph论坛在[http://sourceforge.net/forum/forum.php?forum_id=394748](http://sourceforge.net/forum/forum.php?forum_id=394748)提供帮助。
- en: '![Used space and limit values for the file system /net/linux01/a on the host
    linux0l, as Nagiosgraph represents them](../Images/tagoreillycom20081104nostarchimages223960.png.jpg)'
  id: totrans-767
  prefs: []
  type: TYPE_IMG
  zh: '![主机`linux0l`上文件系统`/net/linux01/a`的使用空间和限制值，如Nagiosgraph所示](../Images/tagoreillycom20081104nostarchimages223960.png.jpg)'
- en: Figure 19-1. Used space and limit values for the file system `/net/linux01/a`
    on the host `linux0l`, as Nagiosgraph represents them
  id: totrans-768
  prefs: []
  type: TYPE_NORMAL
  zh: 图19-1. Nagiosgraph表示的主机`linux0l`上文件系统`/net/linux01/a`的使用空间和限制值
- en: 'Changes to the **`map`** are critical. It is therefore recommended that you
    copy the file first and edit the copy and then perform a syntax check, using **`perl
    -c`**:'
  id: totrans-769
  prefs: []
  type: TYPE_NORMAL
  zh: 对**`map`**的更改至关重要。因此，建议您首先复制文件，然后编辑副本，并使用**`perl -c`**进行语法检查：
- en: '[PRE87]'
  id: totrans-770
  prefs: []
  type: TYPE_PRE
  zh: '[PRE87]'
- en: If the syntax check is in order, you can install the new file as **`map`**.
  id: totrans-771
  prefs: []
  type: TYPE_NORMAL
  zh: 如果语法检查无误，您可以安装新的文件作为**`map`**。
- en: '* * *'
  id: totrans-772
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[194](#CHP-19-FN-2)]) Further information on this topic can be found at [http://www.rrdtool.org/](http://www.rrdtool.org/).
  id: totrans-773
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[194](#CHP-19-FN-2)]) 关于此主题的更多信息可以在[http://www.rrdtool.org/](http://www.rrdtool.org/)找到。
- en: ^([[195](#CHP-19-FN-3)]) To install, see [19.4.1 Installation](../Text/ch19s04.html#installation-id6
    "19.4.1 Installation").
  id: totrans-774
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[195](#CHP-19-FN-3)]) 要安装，请参阅[19.4.1 安装](../Text/ch19s04.html#installation-id6
    "19.4.1 安装")。
- en: ^([[196](#CHP-19-FN-4)]) A more detailed description of the **`serviceextinfo`**
    object is contained in [16.4.2 Extended service information](../Text/ch16s04.html#extended_service_information
    "16.4.2 Extended service information"), page 366.
  id: totrans-775
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[196](#CHP-19-FN-4)]) 关于**`serviceextinfo`**对象的更详细描述包含在[16.4.2 扩展服务信息](../Text/ch16s04.html#extended_service_information
    "16.4.2 扩展服务信息")，第366页。
- en: ^([[197](#CHP-19-FN-5)]) A pair of square brackets contains alternatives.
  id: totrans-776
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[197](#CHP-19-FN-5)]) 一对方括号包含备选方案。
- en: ^([[198](#CHP-19-FN-6)]) This turns kilobytes into bytes.
  id: totrans-777
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[198](#CHP-19-FN-6)]) 这将千字节转换为字节。
- en: 19.3 Preparing Performance Data for Evaluation with Perf2rrd
  id: totrans-778
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 19.3 使用Perf2rrd准备性能数据以进行评估
- en: Another tool which transfers Nagios performance data to an RRD database is the
    Java application Perf2rrd. This requires an installed Java Runtime Environment
    ([1.4.2 Plugin test](../Text/ch01s04.html#plugin_test "1.4.2 Plugin test"), or
    preferably [1.5 Configuration of the Web Interface](../Text/ch01s05.html "1.5
    Configuration of the Web Interface")). Since the virtual machine generates a noticeable
    load on less powerful computers, and also requires a large amount of memory, the
    requirements made of the Nagios server by Perf2rrd are significantly higher than
    those made by Nagiosgraph.
  id: totrans-779
  prefs: []
  type: TYPE_NORMAL
  zh: 另一个将Nagios性能数据传输到RRD数据库的工具是Java应用程序Perf2rrd。这需要一个已安装的Java运行时环境（[1.4.2 插件测试](../Text/ch01s04.html#plugin_test
    "1.4.2 插件测试")，或者最好是[1.5 配置Web界面](../Text/ch01s05.html "1.5 配置Web界面")）。由于虚拟机在较不强大的计算机上会产生明显的负载，并且还需要大量的内存，因此Perf2rrd对Nagios服务器的要求比Nagiosgraph的要求要高得多。
- en: 'On the other hand there is no more work after the installation as far as generating
    the RRD databases is concerned, because Perf2rrd uses the template mechanism of
    Nagios (see [19.1 Processing Plugin Performance Data with Nagios](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 Processing Plugin Performance Data with Nagios"), page 404). For each service
    and each variable contained in the template, the tool creates a separate RRD database
    using the following naming pattern:'
  id: totrans-780
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，在安装方面，在生成RRD数据库方面就没有更多的工作要做，因为Perf2rrd使用了Nagios的模板机制（见[19.1 使用Nagios处理插件性能数据](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 使用Nagios处理插件性能数据")，第404页）。对于模板中包含的每个服务和每个变量，该工具都会使用以下命名模式创建一个单独的RRD数据库：
- en: '[PRE88]'
  id: totrans-781
  prefs: []
  type: TYPE_PRE
  zh: '[PRE88]'
- en: So to evaluate the **`check_icmp`** variables **`rta`** (*round trip average*)
    and **`pl`** (*packet loss*), the file names are **`linux01+PING+pl.rrd`** and
    **`linux01+PING+rta.rrd`**.
  id: totrans-782
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，为了评估**`check_icmp`**变量**`rta`**（往返平均）和**`pl`**（丢包率），文件名分别是**`linux01+PING+pl.rrd`**和**`linux01+PING+rta.rrd`**。
- en: Perf2rrd only looks after the storage of data in an RRD database and does not
    provide any tools to graphically display the data saved there. The Perf2rrd author
    Marc DeTrano refers here to the **`drraw`** tool (see [19.4 The Graphics Specialist
    drraw](../Text/ch19s04.html "19.4 The Graphics Specialist drraw"), page 420).
    It can be advantageous to use this, because on the one hand **`drraw`** allows
    far more than just the one display provided by Nagiosgraph, and on the other hand
    you do not have to struggle with regular expressions in Perl.
  id: totrans-783
  prefs: []
  type: TYPE_NORMAL
  zh: Perf2rrd只负责在RRD数据库中存储数据，并不提供任何图形显示已保存数据的工具。Perf2rrd的作者Marc DeTrano在这里提到了**`drraw`**工具（见[19.4
    图形专家drraw](../Text/ch19s04.html "19.4 图形专家drraw")，第420页）。使用它可能是有益的，因为一方面**`drraw`**提供了比Nagiosgraph提供的单一显示更多的功能，另一方面你不必在Perl中与正则表达式抗争。
- en: 19.3.1 Installation
  id: totrans-784
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.3.1 安装
- en: 'For the installation you should get hold of the archive in tar format from
    [http://perf2rrd.sf.net/](http://perf2rrd.sf.net/), and copy it, preferably to
    the **`/usr/local hierarchy`**:'
  id: totrans-785
  prefs: []
  type: TYPE_NORMAL
  zh: 对于安装，你应该从[http://perf2rrd.sf.net/](http://perf2rrd.sf.net/)获取tar格式的存档，并将其复制，最好复制到**`/usr/local`**层次结构中：
- en: '[PRE89]'
  id: totrans-786
  prefs: []
  type: TYPE_PRE
  zh: '[PRE89]'
- en: The executable program that is later run is a script called **`run`**, which
    in turn calls the Java bytecode interpreter, **`java`**. Besides this the directory
    contains the Java class files and other utilities, with which you can recompile
    the included shared library **`librrdj.so`**, if required. This is normally not
    necessary for the newer distributions.
  id: totrans-787
  prefs: []
  type: TYPE_NORMAL
  zh: 之后运行的可执行程序是一个名为**`run`**的脚本，该脚本会调用Java字节码解释器，**`java`**。除此之外，该目录还包含Java类文件和其他实用工具，如果需要，可以使用这些工具重新编译包含的共享库**`librrdj.so`**。对于较新的发行版，这通常是不必要的。
- en: 'In order for **`run`** to be able to find the **`java`** program, it must be
    located in **`/usr/bin`**. If this is not the case (because you have installed
    the Java archive from [http://www.sun.com/](http://www.sun.com/), for example),
    then you should set a link:'
  id: totrans-788
  prefs: []
  type: TYPE_NORMAL
  zh: 为了让**`run`**能够找到**`java`**程序，它必须位于**`/usr/bin`**。如果不是这样（例如，因为你已经从[http://www.sun.com/](http://www.sun.com/)安装了Java存档），那么你应该设置一个链接：
- en: '[PRE90]'
  id: totrans-789
  prefs: []
  type: TYPE_PRE
  zh: '[PRE90]'
- en: 'A short test shows whether or not Perf2rrd starts correctly:'
  id: totrans-790
  prefs: []
  type: TYPE_NORMAL
  zh: 简短的测试可以显示Perf2rrd是否正确启动：
- en: '[PRE91]'
  id: totrans-791
  prefs: []
  type: TYPE_PRE
  zh: '[PRE91]'
- en: The error message issued in the last line is not a problem at the moment, since
    we have saved the RRD databases in a different directory anyway ([Perf2rrd in
    permanent operation](../Text/ch19s03.html#perf2rrd_in_permanent_operation "Perf2rrd
    in permanent operation")).
  id: totrans-792
  prefs: []
  type: TYPE_NORMAL
  zh: 最后行显示的错误信息目前不是问题，因为我们已经将RRD数据库保存在了不同的目录中（[Perf2rrd 永久运行](../Text/ch19s03.html#perf2rrd_in_permanent_operation
    "Perf2rrd 永久运行")）。
- en: 19.3.2 Nagios configuration
  id: totrans-793
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.3.2 Nagios配置
- en: 'Perf2rrd searches in the Nagios configuration for all the data it requires:
    to what file Nagios should write the performance data, the write mode used for
    this,^([[199](#ftn.CHP-19-FN-7)]) and the format of the template:'
  id: totrans-794
  prefs: []
  type: TYPE_NORMAL
  zh: Perf2rrd在Nagios配置中搜索它所需的所有数据：Nagios应将性能数据写入哪个文件，用于此的写入模式，以及模板的格式：
- en: '[PRE92]'
  id: totrans-795
  prefs: []
  type: TYPE_PRE
  zh: '[PRE92]'
- en: 'The named pipe used here, thanks to **`service_perfdata_file_mode=w`**, must
    be created manually—Perf2rrd 1.0 in Nagios 2.0 has problems with the normal file
    interface (**`service_perfdata_file_mode=a`**):'
  id: totrans-796
  prefs: []
  type: TYPE_NORMAL
  zh: 由于**`service_perfdata_file_mode=w`**，这里使用的命名管道必须手动创建——Perf2rrd 1.0在Nagios 2.0中与正常文件接口（**`service_perfdata_file_mode=a`**）存在问题：
- en: '[PRE93]'
  id: totrans-797
  prefs: []
  type: TYPE_PRE
  zh: '[PRE93]'
- en: 'In the template the introductory [**`SERVICEPERFDATA`**] stamp is missing (see
    [19.1 Processing Plugin Performance Data with Nagios](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 Processing Plugin Performance Data with Nagios")), since Perf2rrd 1.0 does
    not parse this correctly. Changes to the Nagios configuration require a reload:'
  id: totrans-798
  prefs: []
  type: TYPE_NORMAL
  zh: 在模板中缺少了介绍性的[**`SERVICEPERFDATA`**]戳记（参见[19.1 使用Nagios处理插件性能数据](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 使用Nagios处理插件性能数据")），因为Perf2rrd 1.0无法正确解析此戳记。更改Nagios配置需要重新加载：
- en: '[PRE94]'
  id: totrans-799
  prefs: []
  type: TYPE_PRE
  zh: '[PRE94]'
- en: 'Finally you create the directory for the RRD databases:'
  id: totrans-800
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，你为RRD数据库创建目录：
- en: '[PRE95]'
  id: totrans-801
  prefs: []
  type: TYPE_PRE
  zh: '[PRE95]'
- en: 19.3.3 Perf2rrd in practice
  id: totrans-802
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.3.3 实际应用中的Perf2rrd
- en: Loading the Java Virtual Machine each time Perf2rrd is started requires considerable
    resources. For this reason you should not use the method of startingPerf2rrdwiththeparameter
    **`service_perfdata_file_processing_command`** at specific intervals of Nagios,
    and also should not use the *one-shot mode*, with **`./run -o`**, in which the
    software processes one file at a time. In theory this would make it possible to
    run Perf2rrd regularly with a cron job. Instead, it is recommended that you keep
    the program running permanently.
  id: totrans-803
  prefs: []
  type: TYPE_NORMAL
  zh: 每次启动Perf2rrd时都加载Java虚拟机需要相当多的资源。因此，你不应该使用**`service_perfdata_file_processing_command`**参数在Nagios的特定间隔启动Perf2rrd，也不应该使用**`one-shot
    mode`**，即通过**`./run -o`**，其中软件一次处理一个文件。理论上，这可以通过cron作业定期运行Perf2rrd。相反，建议你让程序永久运行。
- en: 'When using this for the first time, we recommend that you switch on the debugging
    mode, which will show any problems that occur. The option **`-d`** specifies the
    directory in which the tools should create and update the RRD databases:'
  id: totrans-804
  prefs: []
  type: TYPE_NORMAL
  zh: 当首次使用时，我们建议你开启调试模式，这将显示发生的任何问题。选项**`-d`**指定工具应创建和更新RRD数据库的目录：
- en: '[PRE96]'
  id: totrans-805
  prefs: []
  type: TYPE_PRE
  zh: '[PRE96]'
- en: The output of the Nagios configuration file, the RRD repository, and the data
    transfer mode (**`named pipe`**) is followed by the time unit used by Nagios (and
    set with the **`interval_length`** parameter). Normally this is 60 seconds, that
    is, a check interval of **`5`** is five minutes long. It is extremely important
    that this parameter is correctly recognized, since Perf2rrd determines the *step
    interval* of the RRD database by multiplying the **`normal_check_interval`** and
    **`interval_length`** parameters together.
  id: totrans-806
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios配置文件、RRD存储库和数据传输模式（**`named pipe`**）的输出紧随Nagios使用的（并通过**`interval_length`**参数设置的）时间单位。通常这是60秒，即**`5`**分钟的检查间隔为五分钟。确保此参数被正确识别非常重要，因为Perf2rrd通过将**`normal_check_interval`**和**`interval_length`**参数相乘来确定RRD数据库的*步长间隔*。
- en: All measured values that occur during a step interval are averaged by the database.
    If this time period is too small, it is possible that the database will never
    issue any values, since it expects considerably more data than it obtains for
    saving.
  id: totrans-807
  prefs: []
  type: TYPE_NORMAL
  zh: 在步长间隔内发生的所有测量值都由数据库进行平均。如果这个时间段太小，数据库可能永远不会发布任何值，因为它期望保存的数据比实际获得的多得多。
- en: While Nagiosgraph works with a fixed five-minute interval, Perf2rrd adjusts
    itself to the Nagios configuration. The software only takes into account the interval
    when creating the RRD database, however; changing the Nagios configuration later
    on has no further consequences. The only thing you can do here to alter this is
    delete the RRD database and set it up again.
  id: totrans-808
  prefs: []
  type: TYPE_NORMAL
  zh: 当Nagiosgraph使用固定的五分钟间隔时，Perf2rrd会调整自身以适应Nagios配置。然而，软件仅在创建RRD数据库时考虑间隔；稍后更改Nagios配置不会产生进一步的影响。你可以做的唯一改变是删除RRD数据库并重新设置它。
- en: Perf2rrd in permanent operation
  id: totrans-809
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 永久运行的Perf2rrd
- en: 'Operating Perf2rrd on a named pipe has one disadvantage: if Nagios restarts,
    it closes the pipe before opening it again. Unfortunately when the pipe closes,
    Perf2rrd closes as well.'
  id: totrans-810
  prefs: []
  type: TYPE_NORMAL
  zh: 在命名管道上运行 Perf2rrd 有一个缺点：如果 Nagios 重新启动，它会先关闭管道然后再重新打开。不幸的是，当管道关闭时，Perf2rrd 也会随之关闭。
- en: 'This can be prevented by the use of the Daemon Tools by Daniel J. Bernstein.
    They monitor programs and restart them, if these programs should ever stop. They
    are themselves started through an **`/etc/inittab`** entry by the init process,
    and are restarted if they were to shut themselves down at some point. The Daemon
    Tools tar file can be obtained from [http://cr.yp.to/daemorLtools/install.html](http://cr.yp.to/daemorLtools/install.html)
    and it is unpacked in the directory **`/usr/local/src`**:'
  id: totrans-811
  prefs: []
  type: TYPE_NORMAL
  zh: 这可以通过 Daniel J. Bernstein 的 Daemon Tools 来防止。它们监控程序并在这些程序停止时重新启动它们。它们自己通过 init
    进程的 **`/etc/inittab`** 条目启动，并在它们在某个时刻自行关闭时重新启动。可以从 [http://cr.yp.to/daemorLtools/install.html](http://cr.yp.to/daemorLtools/install.html)
    获取 Daemon Tools 的 tar 文件，并将其解压到 **`/usr/local/src`** 目录中：
- en: '[PRE97]'
  id: totrans-812
  prefs: []
  type: TYPE_PRE
  zh: '[PRE97]'
- en: 'This creates the directory **`admin/daemontools-0.76`**, with the subdirectories
    **`package`** and **`src`**. From there you should run the **`install`** script,
    which compiles and installs the program:'
  id: totrans-813
  prefs: []
  type: TYPE_NORMAL
  zh: 这将创建 **`admin/daemontools-0.76`** 目录，其中包含子目录 **`package`** 和 **`src`**。从那里你应该运行
    **`install`** 脚本，它会编译并安装程序：
- en: '[PRE98]'
  id: totrans-814
  prefs: []
  type: TYPE_PRE
  zh: '[PRE98]'
- en: The binaries land in the newly created directory **`daemontools-0.76/com-mand`**
    and remain there. The installation routine also sets up symbolic links pointing
    to them from the—also newly created—folder**`/command`**.
  id: totrans-815
  prefs: []
  type: TYPE_NORMAL
  zh: 二进制文件会落在新创建的目录 **`daemontools-0.76/com-mand`** 中，并保留在那里。安装程序还会设置指向它们的符号链接，这些链接指向新创建的文件夹
    **`/command`**。
- en: 'The **`install`** script also includes the following line in the file **`/etc/init-tab`**,
    which ensures that the Daemon Tools run permanently:'
  id: totrans-816
  prefs: []
  type: TYPE_NORMAL
  zh: '**`install`** 脚本还在 **`/etc/init-tab`** 文件中包含以下行，以确保 Daemon Tools 永久运行：'
- en: '[PRE99]'
  id: totrans-817
  prefs: []
  type: TYPE_PRE
  zh: '[PRE99]'
- en: 'The program **`svscanboot`** searches regularly for new or crashed daemons.
    For this purpose it scans the **`/service`** directory, which is also created
    during the installation. Just one symbolic link is required to have Perf2rrd monitored:'
  id: totrans-818
  prefs: []
  type: TYPE_NORMAL
  zh: 程序 **`svscanboot`** 会定期搜索新的或崩溃的守护进程。为此，它会扫描 **`/service`** 目录，该目录也是在安装过程中创建的。只需一个符号链接就可以让
    Perf2rrd 被监控：
- en: '[PRE100]'
  id: totrans-819
  prefs: []
  type: TYPE_PRE
  zh: '[PRE100]'
- en: 'The Daemon Tools search in this directory for a script called **`run`** and
    start it. In order for **`run`** to be able to find the path to the RRD repository,
    an actual command-line option is entered in the script file instead of **`$*`**:'
  id: totrans-820
  prefs: []
  type: TYPE_NORMAL
  zh: Daemon Tools 在此目录中搜索名为 **`run`** 的脚本并启动它。为了使 **`run`** 能够找到 RRD 存储库的路径，在脚本文件中输入了实际的命令行选项而不是
    **`$*`**：
- en: '[PRE101]'
  id: totrans-821
  prefs: []
  type: TYPE_PRE
  zh: '[PRE101]'
- en: 'Starting and ending Perf2rrd is now taken over by the program **`svc`**:'
  id: totrans-822
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，启动和结束 Perf2rrd 由程序 **`svc`** 负责：
- en: '[PRE102]'
  id: totrans-823
  prefs: []
  type: TYPE_PRE
  zh: '[PRE102]'
- en: The **`-d`** option (for *down*) stops the service specified, and **`-u`** (*up*)
    starts it again. It is not necessary to run it at the beginning, since the Daemon
    Tools regularly scan the **`/service`** directory for new services and automatically
    start them. This is important insofar as the Nagios-2.0 beta versions, on which
    this book is based, had problems if the configured named pipe was not read. Then
    it might not deliver any more data at all until a reload or restart. Whether this
    problem has been fixed in the final version 2.0 of Nagios could not be clarified
    at the time of going to press.
  id: totrans-824
  prefs: []
  type: TYPE_NORMAL
  zh: '**`-d`** 选项（表示 *down*）会停止指定的服务，而 **`-u`** (*up*) 选项会再次启动它。在开始时运行它并不是必需的，因为
    Daemon Tools 会定期扫描 **`/service`** 目录以查找新的服务并自动启动它们。这一点很重要，因为本书基于的 Nagios-2.0 测试版在配置的命名管道无法读取时存在问题。那时，它可能根本不会再提供任何数据，直到重新加载或重启。在印刷时，无法确定
    Nagios 2.0 最终版本是否修复了这个问题。'
- en: '* * *'
  id: totrans-825
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[199](#CHP-19-FN-7)]) With **`a`**, Nagios appends the data to a normal log
    file; with **`w`** it makes it accessible through a named pipe. See [19.1 Processing
    Plugin Performance Data with Nagios](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 Processing Plugin Performance Data with Nagios"), page 404.
  id: totrans-826
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[199](#CHP-19-FN-7)]) 使用 **`a`**，Nagios 将数据追加到正常日志文件中；使用 **`w`**，它通过命名管道使其可访问。参见
    [19.1 使用 Nagios 处理插件性能数据](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 使用 Nagios 处理插件性能数据")，第 404 页。
- en: 19.4 The Graphics Specialist **`drraw`**
  id: totrans-827
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 19.4 图形专家 **`drraw`**
- en: From the RRD databases, generated for example by Perf2rrd or Nagios-graph, the
    CGI script **`drraw`** creates interactive graphics—simple ones relatively quicky,
    whereas for more complex ones you need to know a bit more about the RRDtools.^([[200](#ftn.CHP-19-FN-8)])
  id: totrans-828
  prefs: []
  type: TYPE_NORMAL
  zh: 从由Perf2rrd或Nagios-graph生成的RRD数据库中，CGI脚本**`drraw`**创建交互式图形——简单的相对快速，而对于更复杂的图形，则需要了解一些RRDtools的知识^([[200](#ftn.CHP-19-FN-8)))。
- en: 19.4.1 Installation
  id: totrans-829
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.4.1 安装
- en: 'For the **`drraw`** installation, you need to obtain the current tar file from
    [http://www.taranis.org/drraw/](http://www.taranis.org/drraw/) and unpack it to
    its own subdirectory in the CGI hierarchy^([[201](#ftn.CHP-19-FN-9)]) on the Web
    server:'
  id: totrans-830
  prefs: []
  type: TYPE_NORMAL
  zh: '对于**`drraw`**的安装，您需要从[http://www.taranis.org/drraw/](http://www.taranis.org/drraw/)获取当前的tar文件，并将其解压到Web服务器CGI层次结构中的自己的子目录中^([[201](#ftn.CHP-19-FN-9))]:'
- en: '[PRE103]'
  id: totrans-831
  prefs: []
  type: TYPE_PRE
  zh: '[PRE103]'
- en: The directory created by this is then renamed to **`drraw`**:^([[202](#ftn.CHP-19-FN-10)])
  id: totrans-832
  prefs: []
  type: TYPE_NORMAL
  zh: 然后将此目录重命名为**`drraw`**^([[202](#ftn.CHP-19-FN-10))）
- en: '[PRE104]'
  id: totrans-833
  prefs: []
  type: TYPE_PRE
  zh: '[PRE104]'
- en: '**`drraw.cgi`** itself requires, apart from Perl, the Perl CGI module (**`CGI.pm`**),
    and the RRDtools, from at least version 1.0.47; nothing will work below version
    1.0.36\. If your distribution does not include a current version, you should obtain
    the sources from [http://www.rrdtool.org/](http://www.rrdtool.org/) and compile
    them yourself:'
  id: totrans-834
  prefs: []
  type: TYPE_NORMAL
  zh: '**`drraw.cgi`**本身除了Perl外，还需要Perl CGI模块（**`CGI.pm`**）和至少版本1.0.47的RRDtools；低于1.0.36的版本将无法工作。如果您的发行版不包含当前版本，您应从[http://www.rrdtool.org/](http://www.rrdtool.org/)获取源代码并自行编译：'
- en: '[PRE105]'
  id: totrans-835
  prefs: []
  type: TYPE_PRE
  zh: '[PRE105]'
- en: The CGI script **`drraw.cgi`** uses the Perl module **`RRDs`**, which after
    the installation with **`make site-perl-install`**, is found automatically.
  id: totrans-836
  prefs: []
  type: TYPE_NORMAL
  zh: CGI脚本**`drraw.cgi`**使用Perl模块**`RRDs`**，在执行**`make site-perl-install`**安装后，会自动找到。
- en: 19.4.2 Configuration
  id: totrans-837
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.4.2 配置
- en: 'The **`drraw`** configuration is contained in the file **`drraw.conf`**:'
  id: totrans-838
  prefs: []
  type: TYPE_NORMAL
  zh: '**`drraw`**的配置包含在文件**`drraw.conf`**中：'
- en: '[PRE106]'
  id: totrans-839
  prefs: []
  type: TYPE_PRE
  zh: '[PRE106]'
- en: 'The extract shown specifies the RRD repository (here: **`/var/lib/rrd`**) as
    the most important detail, but several directories can also be specified:'
  id: totrans-840
  prefs: []
  type: TYPE_NORMAL
  zh: 显示的提取指定了RRD存储库（此处：**`/var/lib/rrd`**）作为最重要的细节，但也可以指定多个目录：
- en: '[PRE107]'
  id: totrans-841
  prefs: []
  type: TYPE_PRE
  zh: '[PRE107]'
- en: The text in square brackets (e.g., [**`RRDbase`**]) appears later on the Web
    interface, which allows a distinction to be made between various different repositories.
    The variables **`@dv_def`**, **`@dv_name`**, and **`@dv_secs`** influence the
    layout and number of graphics.
  id: totrans-842
  prefs: []
  type: TYPE_NORMAL
  zh: 方括号中的文本（例如，[**`RRDbase`**]）将在Web界面上稍后出现，这允许区分不同的不同存储库。变量**`@dv_def`**、**`@dv_name`**和**`@dv_secs`**影响布局和图形数量。
- en: 'The configuration shown above generates one graphic more than the standard
    configuration. This represents the past six hours: the extended statement **`''end--6
    hours''`** in **`@dv_def`** describes the time period for **`rrdtool`** (see **`man
    rrdgraph`**), in **`@dv_name`** the representation is given a suitable title with
    **`''Past 6 Hours''`**, and **`@dv_secs`** contains the six hours, converted into
    (**`21600`**) seconds, displayed by **`drraw`** as a time period in a separate
    graphic.'
  id: totrans-843
  prefs: []
  type: TYPE_NORMAL
  zh: 上面的配置比标准配置多生成一个图形。这代表过去六小时：**`@dv_def`**中的扩展语句**`'end--6 hours'**描述了**`rrdtool`**（见**`man
    rrdgraph`**）的时间段，在**`@dv_name`**中给出了合适的标题**`'Past 6 Hours'****，而**`@dv_secs`**包含六小时，转换为（**`21600`**）秒，由**`drraw`**作为单独的图形显示的时间段。
- en: 'The repository must be readable for the user with whose rights the Web server
    is running, and the directories specified in **`$saved_dir`** and **`$tmp_dir`**
    must also be readable. If a user other than **`www-data`** runs this, the following
    command must be adapted accordingly:'
  id: totrans-844
  prefs: []
  type: TYPE_NORMAL
  zh: 存储库必须可读，由运行Web服务器的用户权限读取，并且在**`$saved_dir`**和**`$tmp_dir`**中指定的目录也必须可读。如果除**`www-data`**之外的用户运行此程序，则必须相应地调整以下命令：
- en: '[PRE108]'
  id: totrans-845
  prefs: []
  type: TYPE_PRE
  zh: '[PRE108]'
- en: Data arrives in the temporary directory **`$temp_dir`**, whose contents can
    be deleted at any time, whereas in **`$saved_dir drraw`** stores configuration
    data which the program needs in order to access already created graphics later
    on. This data must not be lost.
  id: totrans-846
  prefs: []
  type: TYPE_NORMAL
  zh: 数据到达临时目录**`$temp_dir`**，其内容可以随时删除，而在**`$saved_dir drraw`**中存储程序需要访问已创建图形的配置数据。这些数据不得丢失。
- en: '**`drraw`** implements asimple access protection in three stages: read-only
    (**`0`**), restricted editing (**`1`**), and full access (**`2`**). Users logged
    in to the Web server automatically obtain level 2\. Nonauthorized users are treated
    as **`guests`** and assigned level **`0`**. To avoid the hassle with authentication
    at the beginning, you can grant the user **`guest`** full access via the following
    directive in the configuration file:'
  id: totrans-847
  prefs: []
  type: TYPE_NORMAL
  zh: '**`drraw`**在三个阶段实现简单的访问保护：只读（**`0`**）、受限编辑（**`1`**）和完全访问（**`2`**）。登录到Web服务器的用户自动获得级别2。未经授权的用户被视为**`guest`**并分配级别**`0`**。为了避免在开始时进行身份验证的麻烦，您可以在配置文件中的以下指令中授予用户**`guest`**完全访问权限：'
- en: '[PRE109]'
  id: totrans-848
  prefs: []
  type: TYPE_PRE
  zh: '[PRE109]'
- en: 19.4.3 Practical application
  id: totrans-849
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.4.3 实际应用
- en: The CGI script in the CGI directory of the Web server can be addressed through
    the URL [http://nagiosserver/cgi-bin/drraw/drraw.cgi](http://nagiosserver/cgi-bin/drraw/drraw.cgi).
  id: totrans-850
  prefs: []
  type: TYPE_NORMAL
  zh: Web服务器CGI目录中的CGI脚本可以通过URL [http://nagiosserver/cgi-bin/drraw/drraw.cgi](http://nagiosserver/cgi-bin/drraw/drraw.cgi)访问。
- en: '![The ddraw start menu](../Images/tagoreillycom20081104nostarchimages223962.png.jpg)'
  id: totrans-851
  prefs: []
  type: TYPE_IMG
  zh: '![ddraw启动菜单](../Images/tagoreillycom20081104nostarchimages223962.png.jpg)'
- en: Figure 19-2. The `ddraw` start menu
  id: totrans-852
  prefs: []
  type: TYPE_NORMAL
  zh: 图19-2. `ddraw`启动菜单
- en: New graphics are generated in the menu item **Create a new graph** in the start
    picture, which is shown in [Figure 19-2](../Text/ch19s04.html#the_ddraw_start_menu
    "Figure 19-2. The ddraw start menu"). The dialog shown in [Figure 19-3](../Text/ch19s04.html#selecting_the_data_source
    "Figure 19-3. Selecting the data source") allows the appropriate RRD database
    to be selected. Using a regular expression^([[203](#ftn.CHP-19-FN-11)]) in the
    **Data Source filter regexp** field, the data sources available can be further
    restricted; this expression can also be a simple literal text, such as **`sap-12`**.
  id: totrans-853
  prefs: []
  type: TYPE_NORMAL
  zh: 新图形在启动图片中的**创建新图形**菜单项中生成，启动图片如[图19-2](../Text/ch19s04.html#the_ddraw_start_menu
    "图19-2. ddraw启动菜单"）所示。图[图19-3](../Text/ch19s04.html#selecting_the_data_source
    "图19-3. 选择数据源"）所示的对话框允许选择适当的RRD数据库。在**数据源过滤器正则表达式**字段中使用正则表达式^([[203](#ftn.CHP-19-FN-11)]），可以进一步限制可用的数据源；此表达式也可以是简单的文本，例如**`sap-12`**。
- en: '![Selecting the data source](../Images/tagoreillycom20081104nostarchimages223964.png.jpg)'
  id: totrans-854
  prefs: []
  type: TYPE_IMG
  zh: '![选择数据源](../Images/tagoreillycom20081104nostarchimages223964.png.jpg)'
- en: Figure 19-3. Selecting the data source
  id: totrans-855
  prefs: []
  type: TYPE_NORMAL
  zh: 图19-3. 选择数据源
- en: 'Once you have chosen an RRD database, you just need to specify the *round-robin
    archive* (RRA) to be used. Each of these archives saves data in a particular form,
    processed with a consolidation function: the **`AVERAGE`** function averages all
    measurement data that accumulates in a measurement period, **`MIN`** saves only
    the minimum value of the data in an interval, and **`MAX`** saves only the maximum.
    Since the original data is lost, the archives must be specified when the round-robin
    database is created; maximum values can only be recalled later if this was taken
    into account at the time.'
  id: totrans-856
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您选择了RRD数据库，您只需指定要使用的*循环冗余存档*（RRA）。这些存档中的每一个都以特定的形式保存数据，通过合并函数处理：**`AVERAGE`**函数平均测量周期内累积的所有测量数据，**`MIN`**只保存区间内数据的最低值，而**`MAX`**只保存最高值。由于原始数据已丢失，创建循环冗余数据库时必须指定存档；如果当时考虑到这一点，则只能稍后回忆最大值。
- en: If you cannot remember what archives exist, you can display them using the button
    **`RRD Info for selected DB`**. Clicking on the **`Add DB(s) to Data Sources`**
    button takes you to a dialog where you first have to scroll down a bit to reach
    the item **`Data Source Configuration`** ([Figure 19-4](../Text/ch19s04.html#fine-tuning_the_graphic_configuration
    "Figure 19-4. Fine-tuning the graphic configuration")). There you can fine-tune
    the desired graph—now or later. You can define your own colors, and whether a
    line or a surface will be shown. You should only make use of the other possibilities
    if you are familiar with the concepts of the RRDtools and the way they work^([[204](#ftn.CHP-19-FN-12)])
  id: totrans-857
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您无法记住存在哪些存档，您可以使用按钮**`RRD Info for selected DB`**来显示它们。点击**`Add DB(s) to Data
    Sources`**按钮将带您进入一个对话框，您首先需要向下滚动一点才能到达项目**`Data Source Configuration`**（[图19-4](../Text/ch19s04.html#fine-tuning_the_graphic_configuration
    "图19-4. 调整图形配置"））。在那里您可以调整所需的图形——现在或以后。您可以定义自己的颜色，并决定是否显示线条或表面。只有当您熟悉RRDtools的概念及其工作方式时，才应使用其他功能^([[204](#ftn.CHP-19-FN-12)]）
- en: The **Update** button provides a preview of the finished graphic, which at the
    same time reveals the **`rrdtool`** options used ([Figure 19-5](../Text/ch19s04.html#preview_and_specifying_the_rrdtool
    "Figure 19-5. Preview and specifying the rrdtool options")). When you save, with
    **Save Graph**, you obtain a link in the form
  id: totrans-858
  prefs: []
  type: TYPE_NORMAL
  zh: '**更新** 按钮提供了完成图形的预览，同时揭示了使用的 **`rrdtool`** 选项 ([图 19-5](../Text/ch19s04.html#preview_and_specifying_the_rrdtool
    "图 19-5. 预览并指定 rrdtool 选项")). 当你保存时，使用 **保存图形**，你将获得一个如下形式的链接'
- en: '[PRE110]'
  id: totrans-859
  prefs: []
  type: TYPE_PRE
  zh: '[PRE110]'
- en: with which the graphic can be accessed at any time. Alternatively you can now
    find the graphic in the **`drraw`** starting menu under **All Graphs**.
  id: totrans-860
  prefs: []
  type: TYPE_NORMAL
  zh: 通过这些教程，你可以随时访问图形。或者你现在可以在 **`drraw`** 的 **所有图形** 下找到该图形。
- en: '![Fine-tuning the graphic configuration](../Images/tagoreillycom20081104nostarchimages223966.png.jpg)'
  id: totrans-861
  prefs: []
  type: TYPE_IMG
  zh: '![精细调整图形配置](../Images/tagoreillycom20081104nostarchimages223966.png.jpg)'
- en: Figure 19-4. Fine-tuning the graphic configuration
  id: totrans-862
  prefs: []
  type: TYPE_NORMAL
  zh: 图 19-4. 精细调整图形配置
- en: '![Preview and specifying the rrdtool options](../Images/tagoreillycom20081104nostarchimages223968.png.jpg)'
  id: totrans-863
  prefs: []
  type: TYPE_IMG
  zh: '![预览并指定 rrdtool 选项](../Images/tagoreillycom20081104nostarchimages223968.png.jpg)'
- en: Figure 19-5. Preview and specifying the `rrdtool` options
  id: totrans-864
  prefs: []
  type: TYPE_NORMAL
  zh: 图 19-5. 预览并指定 `rrdtool` 选项
- en: '![The finished graphic represents different time periods](../Images/tagoreillycom20081104nostarchimages223970.png.jpg)'
  id: totrans-865
  prefs: []
  type: TYPE_IMG
  zh: '![完成的图形表示不同的时间段](../Images/tagoreillycom20081104nostarchimages223970.png.jpg)'
- en: Figure 19-6. The finished graphic represents different time periods
  id: totrans-866
  prefs: []
  type: TYPE_NORMAL
  zh: 图 19-6. 完成的图形表示不同的时间段
- en: 'The link mentioned when you save a graphic can be recorded in a **`service-extinfo`**
    object, making it directly accessible through the Nagios interface:'
  id: totrans-867
  prefs: []
  type: TYPE_NORMAL
  zh: 当你保存图形时提到的链接可以记录在 **`service-extinfo`** 对象中，使其可以通过 Nagios 接口直接访问：
- en: '[PRE111]'
  id: totrans-868
  prefs: []
  type: TYPE_PRE
  zh: '[PRE111]'
- en: With templates and dashboards, **`drraw`** includes other features, which cannot
    be discussed in detail here, for reasons of space. Templates allow several sources
    of the same type to be shown in the same graphic. What these are can be specified
    in **Create a new Graph** (see [Figure 19-3](../Text/ch19s04.html#selecting_the_data_source
    "Figure 19-3. Selecting the data source")). Since you can only add one source
    at a time there, you must click the **Add** button for each separate source, before
    moving on to the next one.
  id: totrans-869
  prefs: []
  type: TYPE_NORMAL
  zh: 使用模板和仪表板，**`drraw`** 包含其他一些功能，由于篇幅原因，这里不能详细讨论。模板允许在同一个图形中显示相同类型的多个来源。这些来源可以在
    **创建新图形** 中指定 (参见 [图 19-3](../Text/ch19s04.html#selecting_the_data_source "图 19-3.
    选择数据源")). 由于你只能一次添加一个来源，因此你必须为每个单独的来源点击 **添加** 按钮，然后再继续下一个。
- en: A dashboard presents a display containing several preview graphics. If you click
    on one of the graphics, you are shown the detailed representation. The interactive
    menu **Create a Dashboard** contains brief instructions where you can obtain help
    on the two features.
  id: totrans-870
  prefs: []
  type: TYPE_NORMAL
  zh: 仪表板展示了一个包含多个预览图形的显示。如果你点击其中一个图形，你会看到详细的表示。交互式菜单 **创建仪表板** 包含简要说明，你可以在这里获得关于两个功能的帮助。
- en: '* * *'
  id: totrans-871
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[200](#CHP-19-FN-8)]) Apart from the documentation on the homepage [http://www.rrdtool.org/](http://www.rrdtool.org/),
    the tutorial included (**`man rrdtutorial`**) is a useful starting point, as well
    as the man page **`man rrdgraph`**.
  id: totrans-872
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[200](#CHP-19-FN-8)]) 除了主页上的文档 [http://www.rrdtool.org/](http://www.rrdtool.org/)
    之外，包含的教程 (`man rrdtutorial`) 是一个有用的起点，同样还有手册页 **`man rrdgraph`**。
- en: ^([[201](#CHP-19-FN-9)]) Which directory this is depends on the distribution
    or Apache configuration you are using.
  id: totrans-873
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[201](#CHP-19-FN-9)]) 这个目录取决于你使用的发行版或 Apache 配置。
- en: ^([[202](#CHP-19-FN-10)]) A symbolic link would also be possible, but then Apache
    must be configured so that it follows symbolic links, which is normally not automatically
    the case.
  id: totrans-874
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[202](#CHP-19-FN-10)]) 也可以使用符号链接，但那时 Apache 必须配置为遵循符号链接，这通常不是自动完成的。
- en: ^([[203](#CHP-19-FN-11)]) POSIX regular expression; see **`man 7 regex`**.
  id: totrans-875
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[203](#CHP-19-FN-11)]) POSIX 正则表达式；参见 **`man 7 regex`**。
- en: ^([[204](#CHP-19-FN-12)]) There are a number of tutorials on the homepage of
    the RRDtools author, Tobias Oetiker, at [http://people.ee.ethz.ch/~oetiker/webtools/rrdtool/tut/index.en.html](http://people.ee.ethz.ch/~oetiker/webtools/rrdtool/tut/index.en.html).
  id: totrans-876
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[204](#CHP-19-FN-12)]) 在 RRDtools 作者 Tobias Oetiker 的主页 [http://people.ee.ethz.ch/~oetiker/webtools/rrdtool/tut/index.en.html](http://people.ee.ethz.ch/~oetiker/webtools/rrdtool/tut/index.en.html)
    上有许多教程。
- en: '19.5 Automated to a Large Extent: NagiosGrapher'
  id: totrans-877
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 19.5 大部分自动化：NagiosGrapher
- en: NagiosGrapher from Netways, the host of The Nagios Exchange Platform [http://www.nagiosexchange.org/](http://www.nagiosexchange.org/),
    is a powerful representation tool for performance data, but already a very powerful
    one. This also saves data in round-robin databases and uses the RRDtools for processing
    and representation. It claims to be easy to install and to work automatically
    to a large extent in contrast to the "competition." The latter promise has so
    far not been kept; as in Nagiosgraph, you have to configure search patterns in
    order to interpret the plugin output or performance data correspondingly. The
    RRD databases are generated by NagiosGrapher automatically; in addition to this,
    the tool **`serviceextinfo`** also generates entries.
  id: totrans-878
  prefs: []
  type: TYPE_NORMAL
  zh: Netways提供的NagiosGrapher，The Nagios Exchange Platform的托管者[http://www.nagiosexchange.org/](http://www.nagiosexchange.org/)，是一个强大的性能数据表示工具，但已经非常强大。它还保存数据在轮询数据库中，并使用RRDtools进行处理和表示。它声称易于安装，并且与“竞争者”相比，在很大程度上是自动工作的。然而，后者承诺至今尚未实现；就像Nagiosgraph一样，你必须配置搜索模式以解释插件输出或性能数据。RRD数据库由NagiosGrapher自动生成；此外，工具**`serviceextinfo`**也会生成条目。
- en: As soon as it once recognizes the performance data, you don't have to worry
    any more about integrating it into Nagios. A reload is sufficient to make the
    **`serviceextinfo`** entries generated in the meantime usable in Nagios. The entries
    are created "intelligently," so that if you click on the corresponding icon in
    the service summary (see [Figure 19-7](../Text/ch19s05.html#the_nagiosgrapher_icon_open_parenthesis
    "Figure 19-7. The NagiosGrapher icon (arrow) in the Nagios Web interface indicates
    a time-related evaluation for this service") in page 434), you are taken directly
    to the graphic display of the performance data.
  id: totrans-879
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦它识别出性能数据，你就不必再担心将其集成到Nagios中。只需重新加载即可使在此期间生成的**`serviceextinfo`**条目在Nagios中可用。这些条目是“智能”创建的，所以如果你在服务摘要中点击相应的图标（见[图19-7](../Text/ch19s05.html#the_nagiosgrapher_icon_open_parenthesis
    "图19-7. NagiosGrapher图标（箭头）在Nagios Web界面中表示对该服务的相关评估")，在434页），你将直接进入性能数据的图形显示。
- en: 'As far as functionality and installation efforts are concerned, NagiosGrapher
    lies somewhere between Nagiosgraph and Perf2rrd: the initial configuration needed
    is somewhat more than for Nagiosgraph, but the possibilities of variations in
    the graphic output are considerably larger, and you do not have to generate each
    graphic individually, as is the case with Perf2rrd/**`drraw`**.'
  id: totrans-880
  prefs: []
  type: TYPE_NORMAL
  zh: 在功能性和安装努力方面，NagiosGrapher位于Nagiosgraph和Perf2rrd之间：所需的初始配置比Nagiosgraph要多一些，但图形输出的变化可能性要大得多，而且你不必像Perf2rrd/**`drraw`**那样逐个生成每个图形。
- en: 19.5.1 Installation
  id: totrans-881
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.5.1 安装
- en: 'In addition to the RRDtools (in version 1.2, at least) and the program **`auto-conf`**,
    NagiosGrapher requires a series of Perl modules: **`CGI`**, **`CGI::Carp`**, **`Calendar::
    Simple`**,**`Carp`**,**`Data:: Dumper`**, **`File::Basename`**,**`File::Copy`**,
    **`GD`**, **`IO::Handle`**, **`Image::Magick`**, **`POSIX`**, **`RRDs`**, **`Storable`**,
    **`Time::HiRes`**, **`Time :: Local`**, and **`URI::Escape`**.'
  id: totrans-882
  prefs: []
  type: TYPE_NORMAL
  zh: '除了RRDtools（至少在版本1.2中）和程序**`auto-conf`**之外，NagiosGrapher还需要一系列Perl模块：**`CGI`**，**`CGI::Carp`**，**`Calendar::
    Simple`**，**`Carp`**，**`Data:: Dumper`**，**`File::Basename`**，**`File::Copy`**，**`GD`**，**`IO::Handle`**，**`Image::Magick`**，**`POSIX`**，**`RRDs`**，**`Storable`**，**`Time::HiRes`**，**`Time
    :: Local`**，和**`URI::Escape`**。'
- en: There are two alternatives for installing them, namely from the packages included
    in the distribution or from CPAN. On Debian "Etch" and comparable Debian-based
    systems, you have all the modules if you select the packages **`autoconf`**,**`rrdtool`**,**`perl-modules`**,**`libcalendar-simple-perl`**,**`libgd-gd2-perl`**,**`perlmagick`**,**`librrds-perl`**,
    and **`liburi-perl`** for installation. In other distributions you must search
    for the above-mentioned modules, preferably using the graphic package installer
    in the distribution. You can see whether you have installed all the required modules
    by running **`make testdeps`** after the **`configure`** command. Installing each
    of the most current module versions from the CPAN is done with the command **`make
    fixdeps`**.
  id: totrans-883
  prefs: []
  type: TYPE_NORMAL
  zh: 安装它们有两种选择，即从发行版中包含的软件包或从CPAN安装。在Debian "Etch"和类似的基于Debian的系统上，如果你选择安装**`autoconf`**，**`rrdtool`**，**`perl-modules`**，**`libcalendar-simple-perl`**，**`libgd-gd2-perl`**，**`perlmagick`**，**`librrds-perl`**，和**`liburi-perl`**这些软件包，你将拥有所有模块。在其他发行版中，你必须搜索上述模块，最好使用发行版中的图形软件包安装器。你可以在执行**`configure`**命令后运行**`make
    testdeps`**来查看你是否已安装所有所需的模块。使用**`make fixdeps`**命令从CPAN安装每个最新模块版本。
- en: 'The NagiosGrapher sources can be obtained from NagiosExchange,^([[205](#ftn.CHP-19-FN-13)])
    and they are unpacked into the directory **`/usr/local/src`**:'
  id: totrans-884
  prefs: []
  type: TYPE_NORMAL
  zh: NagiosGrapher 的源代码可以从 NagiosExchange 获得，[205](#ftn.CHP-19-FN-13) 并解压到目录 **`/usr/local/src`**：
- en: '[PRE112]'
  id: totrans-885
  prefs: []
  type: TYPE_PRE
  zh: '[PRE112]'
- en: The command **`autoconf`** generates a **`configure`** script. Before you run
    this, edit the file **`config.layout`**, which provides various *layouts*. In
    the NagiosGrapher documentation, this term means the definition of all installation
    paths that are required.
  id: totrans-886
  prefs: []
  type: TYPE_NORMAL
  zh: 命令 **`autoconf`** 生成一个 **`configure`** 脚本。在运行此脚本之前，编辑文件 **`config.layout`**，它提供了各种
    *布局*。在 NagiosGrapher 文档中，这个术语意味着所有必需的安装路径的定义。
- en: '**`config.layout`** contains a series of distribution-dependent suggestions
    that need to be changed in certain aspects in order to comply with the conventions
    in this book. For this purpose it is best if you copy the section that matches
    your distribution and rename it to **`<Layout nagiosbook>`** and modify a number
    of entries.^([[206](#ftn.CHP-19-FN-14)]) For Debian "Etch," the following entries
    apply (the changed values are shown in bold print):'
  id: totrans-887
  prefs: []
  type: TYPE_NORMAL
  zh: '**`config.layout`** 包含一系列与发行版相关的建议，需要根据本书中的约定在某个方面进行更改。为此，最好复制与您的发行版匹配的部分，并将其重命名为
    **`<Layout nagiosbook>`**，并修改多个条目。[206](#ftn.CHP-19-FN-14) 对于 Debian "Etch"，以下条目适用（更改的值以粗体显示）：'
- en: '[PRE113]'
  id: totrans-888
  prefs: []
  type: TYPE_PRE
  zh: '[PRE113]'
- en: The path for the Perl modules defined in the parameter **`perl_inc`** corresponds
    in this case to the directory suggested by Ton Voon for the Perl module **`Nagios::Plugin`**
    (see [The method using the CPAN](../Text/ch24s02.html#the_method_using_the_cpan
    "The method using the CPAN")).
  id: totrans-889
  prefs: []
  type: TYPE_NORMAL
  zh: 在此情况下，参数 **`perl_inc`** 中定义的 Perl 模块路径对应于 Ton Voon 为 Perl 模块 **`Nagios::Plugin`**
    建议的目录（参见 [使用 CPAN 的方法](../Text/ch24s02.html#the_method_using_the_cpan "使用 CPAN
    的方法")）。
- en: 'The new layout is included in the **`configure`** script:'
  id: totrans-890
  prefs: []
  type: TYPE_NORMAL
  zh: 新布局包含在 **`configure`** 脚本中：
- en: '[PRE114]'
  id: totrans-891
  prefs: []
  type: TYPE_PRE
  zh: '[PRE114]'
- en: 'You can run **`make`** **`testdeps`** to check whether all dependencies, especially
    the ones for the Perl modules, have been met:'
  id: totrans-892
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以运行 **`make testdeps`** 来检查是否已满足所有依赖项，特别是 Perl 模块的依赖项：
- en: '[PRE115]'
  id: totrans-893
  prefs: []
  type: TYPE_PRE
  zh: '[PRE115]'
- en: If an error occurs, as in this example, you must install the appropriate module
    (here **`Calendar::Simple`**). This can be done from the CPAN with the command
  id: totrans-894
  prefs: []
  type: TYPE_NORMAL
  zh: 如果发生错误，例如在这个例子中，您必须安装适当的模块（这里 **`Calendar::Simple`**）。这可以通过 CPAN 使用以下命令完成：
- en: '[PRE116]'
  id: totrans-895
  prefs: []
  type: TYPE_PRE
  zh: '[PRE116]'
- en: 'For Debian-based distributions, the package naming scheme is quite simple:
    The Perl module **`Calendar:: Simple`** is turned into the package **`lib-calendar-simple-perl`**,
    which is installed with **`apt-get`** or **`aptitude`**:'
  id: totrans-896
  prefs: []
  type: TYPE_NORMAL
  zh: '对于基于 Debian 的发行版，包命名方案相当简单：Perl 模块 **`Calendar:: Simple`** 被转换为包 **`lib-calendar-simple-perl`**，可以通过
    **`apt-get`** 或 **`aptitude`** 安装：'
- en: '[PRE117]'
  id: totrans-897
  prefs: []
  type: TYPE_PRE
  zh: '[PRE117]'
- en: Running **`make testdeps`** again shows whether all requirements have now been
    met.
  id: totrans-898
  prefs: []
  type: TYPE_NORMAL
  zh: 再次运行 **`make testdeps`** 可以显示是否现在已满足所有要求。
- en: 'An already installed NagiosGrapher is updated with **`make update`**, since
    the **`make install`**, intended for a new installation, does not take account
    of already existing configuration files and simply overwrites them.^([[207](#ftn.CHP-19-FN-15)])
    **`make install`** creates all the necessary directories, ensures that the correct
    access permissions are set, and copies all the files to where they should go:'
  id: totrans-899
  prefs: []
  type: TYPE_NORMAL
  zh: 已经安装的 NagiosGrapher 通过 **`make update`** 进行更新，因为 **`make install`**（用于新安装）不考虑已存在的配置文件，并简单地覆盖它们。[207](#ftn.CHP-19-FN-15)
    **`make install`** 创建所有必要的目录，确保设置了正确的访问权限，并将所有文件复制到它们应该去的地方：
- en: '[PRE118]'
  id: totrans-900
  prefs: []
  type: TYPE_PRE
  zh: '[PRE118]'
- en: The output of **`make`** ends with some instructions on the configuration of
    NagiosGrapher and of Nagios, which we will examine in more detail in [19.5.1 Installation](../Text/ch19s05.html#installation-id7
    "19.5.1 Installation") and [Advanced options of graphic reprocessing](../Text/ch19s05.html#advanced_options_of_graphic_reproces
    "Advanced options of graphic reprocessing").
  id: totrans-901
  prefs: []
  type: TYPE_NORMAL
  zh: '**`make`** 的输出以关于 NagiosGrapher 和 Nagios 配置的一些说明结束，我们将在 [19.5.1 安装](../Text/ch19s05.html#installation-id7
    "19.5.1 安装") 和 [图形重处理的选项](../Text/ch19s05.html#advanced_options_of_graphic_reproces
    "图形重处理的选项") 中更详细地探讨。'
- en: 'A core component of NagiosGrapher is the daemon **`collect2.pl`**, which is
    started via the startup script **`nagios_grapher`** in **`/etc/init.d`**:'
  id: totrans-902
  prefs: []
  type: TYPE_NORMAL
  zh: NagiosGrapher 的一个核心组件是守护进程 **`collect2.pl`**，它通过位于 **`/etc/init.d`** 的启动脚本 **`nagios_grapher`**
    启动：
- en: '[PRE119]'
  id: totrans-903
  prefs: []
  type: TYPE_PRE
  zh: '[PRE119]'
- en: 'So that the daemon starts automatically on system start, corresponding symlinks
    are set in distributions that use the system V init. On Debian/Ubuntu this is
    done by the system script **`update-rc.d`**:'
  id: totrans-904
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使守护进程在系统启动时自动启动，在使用系统 V init 的发行版中设置了相应的符号链接。在 Debian/Ubuntu 中，这是通过系统脚本 **`update-rc.d`**
    完成的：
- en: '[PRE120]'
  id: totrans-905
  prefs: []
  type: TYPE_PRE
  zh: '[PRE120]'
- en: 'OpenSUSE includes the script **`insserv`** for this purpose:'
  id: totrans-906
  prefs: []
  type: TYPE_NORMAL
  zh: OpenSUSE 包含用于此目的的脚本 **`insserv`**：
- en: '[PRE121]'
  id: totrans-907
  prefs: []
  type: TYPE_PRE
  zh: '[PRE121]'
- en: 'In Fedora this task is performed by **`chkconfig`**:'
  id: totrans-908
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Fedora 中，此任务由 **`chkconfig`** 执行：
- en: '[PRE122]'
  id: totrans-909
  prefs: []
  type: TYPE_PRE
  zh: '[PRE122]'
- en: 19.5.2 Configuration
  id: totrans-910
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.5.2 配置
- en: The configuration file **`ngraph.ncfg`**
  id: totrans-911
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置文件 **`ngraph.ncfg`**
- en: The configuration file **`ngraph.ncfg`** contains a global **`config`** section
    with paths and general settings. This is followed by an include instruction with
    the parameter **`cfg_dir`**, which, as in Nagios, integrates all the configuration
    files located in the directory specified. In contrast to Nagios, the configuration
    files for NagiosGrapher all end in **`.ncfg`**.
  id: totrans-912
  prefs: []
  type: TYPE_NORMAL
  zh: 配置文件 **`ngraph.ncfg`** 包含一个全局 **`config`** 部分，其中包含路径和一般设置。之后是一个包含指令，带有参数 **`cfg_dir`**，它在
    Nagios 中，将指定目录中所有配置文件集成在一起。与 Nagios 不同，NagiosGrapher 的配置文件都以 **`.ncfg`** 结尾。
- en: 'It can be seen even from a quick glance that the syntax complies with the convention
    used by Nagios:'
  id: totrans-913
  prefs: []
  type: TYPE_NORMAL
  zh: 即使是快速浏览也能看出，语法符合 Nagios 使用的约定：
- en: '[PRE123]'
  id: totrans-914
  prefs: []
  type: TYPE_PRE
  zh: '[PRE123]'
- en: 'The **`config`** section contains the following parameters:'
  id: totrans-915
  prefs: []
  type: TYPE_NORMAL
  zh: '**`config`** 部分包含以下参数：'
- en: '**`interface`**'
  id: totrans-916
  prefs: []
  type: TYPE_NORMAL
  zh: '**`interface`**'
- en: This defines the type of connection to Nagios. Possible connections are **`pipe`**,
    **`network`**, and **`file`**. For the **`pipe`** type, Nagios and the **`collect2.pl`**
    daemon communicate via a named pipe (see the **`pipe`** parameter); for the **`network`**
    type, Nagios sends the performance data via the UDP transport protocol over a
    network socket (see parameter **`port`**).
  id: totrans-917
  prefs: []
  type: TYPE_NORMAL
  zh: 这定义了连接到 Nagios 的类型。可能的连接类型有 **`pipe`**、**`network`** 和 **`file`**。对于 **`pipe`**
    类型，Nagios 和 **`collect2.pl`** 守护进程通过命名管道（参见 **`pipe`** 参数）进行通信；对于 **`network`**
    类型，Nagios 通过 UDP 传输协议通过网络套接字发送性能数据（参见参数 **`port`**）。
- en: In contrast to the interface types just described, the **`file`** type (available
    from version 1.7) makes use of the template mechanism,^([[208](#ftn.CHP-19-FN-16)])
    which means that Nagios writes the performance data to a file which is periodically
    evaluated by the daemon **`collect2.pl`**. This makes possible, for the first
    time, bulk processing of performance data, thus saving resources. The default
    interface type is **`pipe`** up to version 1.6, and **`file`** from version 1.7.
  id: totrans-918
  prefs: []
  type: TYPE_NORMAL
  zh: 与前面描述的接口类型不同，**`file`** 类型（从版本 1.7 开始可用）使用模板机制，这意味着 Nagios 将性能数据写入一个文件，该文件由守护进程
    **`collect2.pl`** 定期评估。这使得首次可能进行大量处理性能数据，从而节省资源。默认接口类型在版本 1.6 之前是 **`pipe`**，从版本
    1.7 开始是 **`file`**。
- en: '**`perffile_path`**'
  id: totrans-919
  prefs: []
  type: TYPE_NORMAL
  zh: '**`perffile_path`**'
- en: This defines the directory for the file to which Nagios writes all performance
    data via the template mechanism.
  id: totrans-920
  prefs: []
  type: TYPE_NORMAL
  zh: 这定义了 Nagios 通过模板机制写入所有性能数据的文件目录。
- en: '**`pipe`**'
  id: totrans-921
  prefs: []
  type: TYPE_NORMAL
  zh: '**`pipe`**'
- en: This defines a named pipe to which Nagios writes data with the program **`fifo_write`**
    and from which the collector script **`collect2.pl`** reads them out again. The
    named pipe is created automatically by **`make install`** from version 1.6.1.
  id: totrans-922
  prefs: []
  type: TYPE_NORMAL
  zh: 这定义了一个命名管道，Nagios 通过程序 **`fifo_write`** 向其写入数据，并且收集脚本 **`collect2.pl`** 从中再次读取它们。从版本
    1.6.1 开始，命名管道由 **`make install`** 自动创建。
- en: '**`port`**'
  id: totrans-923
  prefs: []
  type: TYPE_NORMAL
  zh: '**`port`**'
- en: This specifies the UDP port for the **`network`** communication type. The default
    is **`5667`**.
  id: totrans-924
  prefs: []
  type: TYPE_NORMAL
  zh: 这指定了 **`network`** 通信类型的 UDP 端口。默认值为 **`5667`**。
- en: '**`buffer`**'
  id: totrans-925
  prefs: []
  type: TYPE_NORMAL
  zh: '**`buffer`**'
- en: This determines the size of the buffer for sending performance data via UDP
    in bytes. The default is 1024 bytes.
  id: totrans-926
  prefs: []
  type: TYPE_NORMAL
  zh: 这确定通过 UDP 发送性能数据缓冲区的大小（以字节为单位）。默认值为 1024 字节。
- en: '**`pidfile`**'
  id: totrans-927
  prefs: []
  type: TYPE_NORMAL
  zh: '**`pidfile`**'
- en: This defines the file to which NagiosGrapher writes its own process ID on starting.
  id: totrans-928
  prefs: []
  type: TYPE_NORMAL
  zh: 这定义了 NagiosGrapher 在启动时写入其自身进程 ID 的文件。
- en: '**`user, group`**'
  id: totrans-929
  prefs: []
  type: TYPE_NORMAL
  zh: '**`user, group`**'
- en: These define the user and group with whose permissions the daemon **`collect2.pl`**
    runs. Here it makes sense to specify the user and group with whose permissions
    Nagios is working.
  id: totrans-930
  prefs: []
  type: TYPE_NORMAL
  zh: 这些定义了以哪个用户和组权限运行的守护进程 **`collect2.pl`** 的权限。在这里，指定 Nagios 工作时使用的用户和组权限是有意义的。
- en: '**`step`**'
  id: totrans-931
  prefs: []
  type: TYPE_NORMAL
  zh: '**`step`**'
- en: This defines the step size in seconds for the RRD database. All values recorded
    during this period are summarized by the RRDtools in a single value. **`step`**
    therefore also describes the smallest time resolution of data in the RRD database.
    The value only has an effect on newly created RRD databases, and a modification
    made later on has no effect on existing databases.
  id: totrans-932
  prefs: []
  type: TYPE_NORMAL
  zh: 这定义了 RRD 数据库的秒级步长。在此期间记录的所有值都由 RRDtools 汇总成一个值。因此，**`step`** 也描述了 RRD 数据库中数据的最低时间分辨率。该值仅对新建的
    RRD 数据库有效，对现有数据库的后续修改没有影响。
- en: '**`heartbeat`**'
  id: totrans-933
  prefs: []
  type: TYPE_NORMAL
  zh: '**`heartbeat`**'
- en: The heartbeat defines a time period in seconds, during which the RRD database
    always expects data. If no measured value at all arrives during this period, NagiosGrapher
    generates an invalid entry (**`nan`**, *not a number*).
  id: totrans-934
  prefs: []
  type: TYPE_NORMAL
  zh: 心跳定义了一个以秒为单位的时间段，在此期间，RRD数据库始终期望接收数据。如果在此期间没有任何测量值到达，NagiosGrapher将生成一个无效条目（**`nan`**，即非数字）。
- en: In order for valid entries to materialize in the above example, at least one
    measured value must arrive every **`600`** seconds. Since the resolution is **`60`**
    seconds, the database contains ten entries for the period of the "heartbeat."
    If one of these values is missing, NagiosGrapher simply replaces it with the last
    valid one. If just one measured value arrives in ten minutes, it will be recorded
    ten times in the database.
  id: totrans-935
  prefs: []
  type: TYPE_NORMAL
  zh: 为了在上述示例中生成有效的条目，每**`600`**秒至少必须有一个测量值到达。由于分辨率为**`60`**秒，数据库包含“心跳”期间十个条目。如果这些值中有一个缺失，NagiosGrapher将简单地用最后一个有效值替换它。如果十分钟内只有一个测量值到达，它将在数据库中记录十次。
- en: '**`rrdpath`**'
  id: totrans-936
  prefs: []
  type: TYPE_NORMAL
  zh: '**`rrdpath`**'
- en: This specifies the directory for the RRD databases. It must be writable for
    the user **`nagios`** and (along with the database files) readable for the Web
    server user. The directory is created automatically during the installation of
    NagiosGrapher.
  id: totrans-937
  prefs: []
  type: TYPE_NORMAL
  zh: 这指定了RRD数据库的目录。它必须对用户**`nagios`**可写，并且（连同数据库文件）对Web服务器用户可读。该目录在安装NagiosGrapher时自动创建。
- en: '**`tmppath`**'
  id: totrans-938
  prefs: []
  type: TYPE_NORMAL
  zh: '**`tmppath`**'
- en: This defines where NagiosGrapher temporarily saves internal XML files.
  id: totrans-939
  prefs: []
  type: TYPE_NORMAL
  zh: 这定义了NagiosGrapher临时保存内部XML文件的位置。
- en: '**`fontfile`**'
  id: totrans-940
  prefs: []
  type: TYPE_NORMAL
  zh: '**`fontfile`**'
- en: This specifies the font file for the font used by the RRDtools for labeling
    the graphics.
  id: totrans-941
  prefs: []
  type: TYPE_NORMAL
  zh: 这指定了RRDtools用于标注图形所使用的字体文件。
- en: '**`serviceext_type`**'
  id: totrans-942
  prefs: []
  type: TYPE_NORMAL
  zh: '**`serviceext_type`**'
- en: This describes how the **`serviceextinfo`** objects are created. With the **`SINGLE`**
    type, NagiosGrapher writes everything to the file specified in **`serviceextinfo`**.
  id: totrans-943
  prefs: []
  type: TYPE_NORMAL
  zh: 这描述了如何创建**`serviceextinfo`**对象。使用**`SINGLE`**类型，NagiosGrapher将所有内容写入**`serviceextinfo`**中指定的文件。
- en: Nagios 2.0 can also read directories recursively, and in this case it is better
    to use the **`MULTIPLE`** type. Then NagiosGrapher creates a separate file for
    each host with the corresponding **`serviceextinfo`** object. The directory is
    specified with the **`serviceext_path`** parameter. This must be made known to
    Nagios through the **`cfg_dir`** directive.
  id: totrans-944
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 2.0也可以递归地读取目录，在这种情况下，最好使用**`MULTIPLE`**类型。然后NagiosGrapher为每个主机创建一个包含相应**`serviceextinfo`**对象的单独文件。目录由**`serviceext_path`**参数指定。这必须通过**`cfg_dir`**指令通知Nagios。
- en: '**`url`**'
  id: totrans-945
  prefs: []
  type: TYPE_NORMAL
  zh: '**`url`**'
- en: This contains the path to the CGI script **`graphs.cgi`** from the point of
    view of the Web server (a path starting from the server root) or of the browser
    (that is, the complete URL).
  id: totrans-946
  prefs: []
  type: TYPE_NORMAL
  zh: 这包含从Web服务器的角度（即从服务器根目录开始的路径）或从浏览器的角度（即完整的URL）到CGI脚本**`graphs.cgi`**的路径。
- en: '**`notes_url`**'
  id: totrans-947
  prefs: []
  type: TYPE_NORMAL
  zh: '**`notes_url`**'
- en: NagiosGrapher automatically generates **`serviceextinfo`** objects; it is useful
    to also be able to set the parameter **`notes_url`** ([16.4.2 Extended service
    information](../Text/ch16s04.html#extended_service_information "16.4.2 Extended
    service information") from page 366), for example, to generate a service-related
    link to a Wiki entry.
  id: totrans-948
  prefs: []
  type: TYPE_NORMAL
  zh: NagiosGrapher自动生成**`serviceextinfo`**对象；能够设置参数**`notes_url`**（来自[16.4.2 扩展服务信息](../Text/ch16s04.html#extended_service_information
    "16.4.2 扩展服务信息"，第366页)）也很有用，例如，生成一个指向Wiki条目的服务相关链接。
- en: '**`nagios_config`**'
  id: totrans-949
  prefs: []
  type: TYPE_NORMAL
  zh: '**`nagios_config`**'
- en: This reveals to NagiosGrapher where the standard configuration file of Nagios
    is located.
  id: totrans-950
  prefs: []
  type: TYPE_NORMAL
  zh: 这揭示了NagiosGrapher标准配置文件的位置。
- en: '**`cgi_config`**'
  id: totrans-951
  prefs: []
  type: TYPE_NORMAL
  zh: '**`cgi_config`**'
- en: This specifies the Nagios CGI configuration file. NagiosGrapher uses this to
    find out who, apart from the contact groups, has the right to query information
    on all hosts.
  id: totrans-952
  prefs: []
  type: TYPE_NORMAL
  zh: 这指定了Nagios CGI配置文件。NagiosGrapher使用此文件来找出除了联系组之外，谁有权查询所有主机的信息。
- en: '**`icon_image_tag`**'
  id: totrans-953
  prefs: []
  type: TYPE_NORMAL
  zh: '**`icon_image_tag`**'
- en: This parameter corresponds to the entry that is later to be found in the **`serviceextinfo`**
    object as the **`icon_image`** parameter. In the **`serviceextinfo`** object,
    NagiosGrapher replaces the text **`###URL###`** with the host and service names.
    The entry **`###IMAGESRC###`**, on the other hand, is replaced by NagiosGrapher
    with the contents of the parameter **`icon_image_src`**.
  id: totrans-954
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数对应于稍后在**`serviceextinfo`**对象中作为**`icon_image`**参数找到的条目。在**`serviceextinfo`**对象中，NagiosGrapher将文本**`###URL###`**替换为主机和服务名称。另一方面，条目**`###IMAGESRC###`**则由NagiosGrapher替换为参数**`icon_image_src`**的内容。
- en: 'Here the program outwits Nagios with a trick: **`dot.png`** is a graphic that
    is one pixel in size, which is invisible on the screen. To create a second, visible
    icon, **`graph.png`**, around it, a hyperlink is set to the CGI script **`graphs.cgi`**.'
  id: totrans-955
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，程序通过一个技巧欺骗了 Nagios：**`dot.png`** 是一个一像素大小的图形，它在屏幕上是不可见的。为了创建一个围绕它、可见的第二个图标
    **`graph.png`**，设置了一个超链接到 CGI 脚本 **`graphs.cgi`**。
- en: 'Normally if you click on an image specified in **`icon_image`**, Nagios will
    take you to the **`Extended info`** page, and the graphic can be reached at **`url`**
    (Nagios: **`notes_url`**) only with another mouse click. With the trick used here,
    you can do this directly.'
  id: totrans-956
  prefs: []
  type: TYPE_NORMAL
  zh: 通常情况下，如果你点击 **`icon_image`** 中指定的图像，Nagios 会带你到 **`扩展信息`** 页面，并且图形可以通过 **`url`**（Nagios：**`notes_url`**）仅通过另一个鼠标点击来访问。使用这里使用的技巧，你可以直接这样做。
- en: The specification following **`icon_image_tag`** must be written on a single
    line. [Figure 19-7](../Text/ch19s05.html#the_nagiosgrapher_icon_open_parenthesis
    "Figure 19-7. The NagiosGrapher icon (arrow) in the Nagios Web interface indicates
    a time-related evaluation for this service") shows the icon **`graph.png`**, which
    is visible on the Nagios interface, thanks to the automatically generated **`serviceextinfo`**
    objects.
  id: totrans-957
  prefs: []
  type: TYPE_NORMAL
  zh: 在 **`icon_image_tag`** 后面的规范必须写在单行上。[图19-7](../Text/ch19s05.html#the_nagiosgrapher_icon_open_parenthesis
    "图19-7. NagiosGrapher 图标（箭头）在 Nagios 网络界面中表示对该服务的相关评估") 显示了图标 **`graph.png`**，它在
    Nagios 界面中可见，多亏了自动生成的 **`serviceextinfo`** 对象。
- en: '![The NagiosGrapher icon (arrow) in the Nagios Web interface indicates a time-related
    evaluation for this service](../Images/tagoreillycom20081104nostarchimages223972.png.jpg)'
  id: totrans-958
  prefs: []
  type: TYPE_IMG
  zh: '![NagiosGrapher 图标（箭头）在 Nagios 网络界面中表示对该服务的相关评估](../Images/tagoreillycom20081104nostarchimages223972.png.jpg)'
- en: Figure 19-7. The NagiosGrapher icon (arrow) in the Nagios Web interface indicates
    a time-related evaluation for this service
  id: totrans-959
  prefs: []
  type: TYPE_NORMAL
  zh: 图19-7. NagiosGrapher 图标（箭头）在 Nagios 网络界面中表示对该服务的相关评估
- en: '**`icon_image_static`**'
  id: totrans-960
  prefs: []
  type: TYPE_NORMAL
  zh: '**`icon_image_static`**'
- en: This specifies whether the icon integrated in [Figure 19-7](../Text/ch19s05.html#the_nagiosgrapher_icon_open_parenthesis
    "Figure 19-7. The NagiosGrapher icon (arrow) in the Nagios Web interface indicates
    a time-related evaluation for this service") is generated statically or dynamically.
    Possible values are **`true`** (static icon) or **`false`** (dynamically generated
    icon).
  id: totrans-961
  prefs: []
  type: TYPE_NORMAL
  zh: 这指定了 [图19-7](../Text/ch19s05.html#the_nagiosgrapher_icon_open_parenthesis "图19-7.
    NagiosGrapher 图标（箭头）在 Nagios 网络界面中表示对该服务的相关评估") 中集成的图标是静态生成还是动态生成。可能的值是 **`true`**（静态图标）或
    **`false`**（动态生成图标）。
- en: '**`icon_image_src`**'
  id: totrans-962
  prefs: []
  type: TYPE_NORMAL
  zh: '**`icon_image_src`**'
- en: This specifies astatic icon, which NagiosGrapher integrates into **`icon_image_tag`**.
  id: totrans-963
  prefs: []
  type: TYPE_NORMAL
  zh: 这指定了一个静态图标，NagiosGrapher 将其集成到 **`icon_image_tag`** 中。
- en: '**`icon_image_script`**'
  id: totrans-964
  prefs: []
  type: TYPE_NORMAL
  zh: '**`icon_image_script`**'
- en: This defines a script that generates a mini-view of a graph rather than a dynamic
    icon.
  id: totrans-965
  prefs: []
  type: TYPE_NORMAL
  zh: 这定义了一个脚本，它生成的是图形的迷你视图而不是动态图标。
- en: '**`log_file`**'
  id: totrans-966
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_file`**'
- en: 'This defines the log file to which the NagiosGrapher writes information. If
    you want log rotation, you have to set it up yourself, as NagiosGrapher does not
    clean up automatically. Because Nagios requries write permissions for the file,
    it is better stored in the Nagios **`var`** directory (in this case: **`/var/nagios`**).'
  id: totrans-967
  prefs: []
  type: TYPE_NORMAL
  zh: 这定义了 NagiosGrapher 写入信息的日志文件。如果你想要日志轮转，你必须自己设置，因为 NagiosGrapher 不会自动清理。由于 Nagios
    需要对该文件的写入权限，因此最好将其存储在 Nagios 的 **`var`** 目录中（在这种情况下：**`/var/nagios`**）。
- en: '**`log_level`**'
  id: totrans-968
  prefs: []
  type: TYPE_NORMAL
  zh: '**`log_level`**'
- en: This parameter specifies what information the log file should contain. Possible
    values are **`1`** (detected services and values), **`2`** (performance data delivered
    by Nagios which has not been recognized by NagiosGrapher), **`4`** (program states),
    **`8`** (information on the **`serviceextinfo`** object), **`16`** (RRD actions),
    and **`32`** (input which is read from the pipe). For more extensive debugging,
    there are the values **`64`** (details of how regular expressions are parsed)
    and **`128`** (advanced information on how the configuration files are parsed).
  id: totrans-969
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数指定日志文件应包含什么信息。可能的值有 **`1`**（检测到的服务和值）、**`2`**（Nagios 提供的、NagiosGrapher 未识别的性能数据）、**`4`**（程序状态）、**`8`**（关于
    **`serviceextinfo`** 对象的信息）、**`16`**（RRD 操作）和 **`32`**（从管道中读取的输入）。对于更广泛的调试，还有值
    **`64`**（正则表达式解析的详细信息）和 **`128`**（关于配置文件解析的高级信息）。
- en: If you want to log several of these information types, you just add the relevant
    values together, so the most extensive output is obtained with **`255`**; page
    445 shows an example of this. It is recommended that you only use these log levels
    for debugging purposes, and you should normally use **`0`** or **`4`**.
  id: totrans-970
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想记录这些信息类型中的几个，只需将相关值相加即可，因此使用**`255`**可以获得最全面的结果；第445页展示了此例。建议您仅将这些日志级别用于调试目的，并且通常应使用**`0`**或**`4`**。
- en: '**`rrd_color_*`**'
  id: totrans-971
  prefs: []
  type: TYPE_NORMAL
  zh: '**`rrd_color_*`**'
- en: 'The **`rrd_color`** options bring color to the Web interface ([Figure 19-8](../Text/ch19s05.html#the_influence_of_the_rrd_underscore
    "Figure 19-8. The influence of the rrd_color_* color options")): **`rrd_color_background`**
    defines the background color for the entire image, **`rrd_color_font`** the font
    color, **`rrd_color_arrow`** the color of the arrow tips, **`rrd_color_frame`**
    the frame color for the keys, **`rrd_color_grid`** the grid color, and **`rrd_color_canvas`**
    the background of the diagram itself. **`rrd_color_shadea`** defines the colors
    for the top and left of the frame, and **`rrd_color_shadeb`** does so for the
    right and bottom of the frame. Colors are specified as RGB values in hexadecimal
    notation, with a preceding **`#`**, as is the norm for Web pages. Changes to these
    options take effect immediately the next time the Web page is reloaded.'
  id: totrans-972
  prefs: []
  type: TYPE_NORMAL
  zh: '**`rrd_color`**选项为Web界面增添了颜色（[图19-8](../Text/ch19s05.html#the_influence_of_the_rrd_underscore
    "图19-8. rrd_color_*颜色选项的影响"))：**`rrd_color_background`**定义整个图像的背景颜色，**`rrd_color_font`**定义字体颜色，**`rrd_color_arrow`**定义箭头尖的颜色，**`rrd_color_frame`**定义键的框架颜色，**`rrd_color_grid`**定义网格颜色，**`rrd_color_canvas`**定义图表本身的背景。**`rrd_color_shadea`**定义框架顶部和左边的颜色，**`rrd_color_shadeb`**则定义框架右边和底部的颜色。颜色以十六进制表示的RGB值指定，前面有一个**`#`**，这是网页的标准做法。更改这些选项将在下次重新加载网页时立即生效。'
- en: '![The influence of the rrd_color_* color options](../Images/tagoreillycom20081104nostarchimages223974.png)'
  id: totrans-973
  prefs: []
  type: TYPE_IMG
  zh: '![rrd_color_*颜色选项的影响](../Images/tagoreillycom20081104nostarchimages223974.png)'
- en: Figure 19-8. The influence of the `rrd_color_*` color options
  id: totrans-974
  prefs: []
  type: TYPE_NORMAL
  zh: 图19-8. `rrd_color_*`颜色选项的影响
- en: '**`fe_use_browser_all`**'
  id: totrans-975
  prefs: []
  type: TYPE_NORMAL
  zh: '**`fe_use_browser_all`**'
- en: From version 1.2, NagiosGrapher provides a method of switching from the display
    of a specific service to that of other services for any host at all. To do this
    it integrates a selection window into the **`graphs.cgi`** display (see [Figure 19-9](../Text/ch19s05.html#whether_nagiosgrapher_shows_the_host
    "Figure 19-9. Whether NagiosGrapher shows the host and services fields is determined
    by the fe_use_browser parameters")).
  id: totrans-976
  prefs: []
  type: TYPE_NORMAL
  zh: 从版本1.2开始，NagiosGrapher提供了一种方法，可以从任何主机的特定服务显示切换到其他服务的显示。为此，它将一个选择窗口集成到**`graphs.cgi`**显示中（参见[图19-9](../Text/ch19s05.html#whether_nagiosgrapher_shows_the_host
    "图19-9. NagiosGrapher是否显示host和services字段由fe_use_browser参数决定")）。
- en: The value **`1`** activates the pulldown menus **`host`** and **`service`**,
    **`0`** hides them.
  id: totrans-977
  prefs: []
  type: TYPE_NORMAL
  zh: 值**`1`**激活下拉菜单**`host`**和**`service`**，**`0`**则隐藏它们。
- en: '![Whether NagiosGrapher shows the host and services fields is determined by
    the fe_use_browser parameters](../Images/tagoreillycom20081104nostarchimages223976.png.jpg)'
  id: totrans-978
  prefs: []
  type: TYPE_IMG
  zh: '![NagiosGrapher是否显示host和services字段由fe_use_browser参数决定](../Images/tagoreillycom20081104nostarchimages223976.png.jpg)'
- en: Figure 19-9. Whether NagiosGrapher shows the `host` and `services` fields is
    determined by the `fe_use_browser` parameters
  id: totrans-979
  prefs: []
  type: TYPE_NORMAL
  zh: 图19-9. NagiosGrapher是否显示`host`和`services`字段由`fe_use_browser`参数决定
- en: '**`fe_use_browser_for`**'
  id: totrans-980
  prefs: []
  type: TYPE_NORMAL
  zh: '**`fe_use_browser_for`**'
- en: This option allows particular users to use the host/service selection. Several
    users can be specified, separated by commas. So that only the users specified
    here can see the selection fields for **`host`** and **`service`**, **`fe_use_browser_all`**
    must also be set to **`0`** at the same time.
  id: totrans-981
  prefs: []
  type: TYPE_NORMAL
  zh: 此选项允许特定用户使用主机/服务选择。可以指定多个用户，用逗号分隔。为了确保只有此处指定的用户可以看到**`host`**和**`service`**的选择字段，**`fe_use_browser_all`**也必须同时设置为**`0`**。
- en: '**`fe_use_browser_url`**'
  id: totrans-982
  prefs: []
  type: TYPE_NORMAL
  zh: '**`fe_use_browser_url`**'
- en: This option allows the selection fields for **`host`** and **`service`** to
    be inserted through the URL **`graphs.cgi?browser=l`**, provided the value is
    **`1`**. This is not possible if the value is **`0`**.
  id: totrans-983
  prefs: []
  type: TYPE_NORMAL
  zh: 此选项允许通过URL**`graphs.cgi?browser=l`**插入**`host`**和**`service`**的选择字段，前提是值为**`1`**。如果值为**`0`**，则无法实现。
- en: '**`fe_use_timefilter`**'
  id: totrans-984
  prefs: []
  type: TYPE_NORMAL
  zh: '**`fe_use_timefilter`**'
- en: This controls whether the time selection via **Start** and **End** appears in
    the browser menu (see [Figure 19-9](../Text/ch19s05.html#whether_nagiosgrapher_shows_the_host
    "Figure 19-9. Whether NagiosGrapher shows the host and services fields is determined
    by the fe_use_browser parameters") in page 436). The value **`true`** displays
    the selection, **`false`** hides it.
  id: totrans-985
  prefs: []
  type: TYPE_NORMAL
  zh: 这控制了通过**开始**和**结束**选择的时间是否出现在浏览器菜单中（参见第436页的[图19-9](../Text/ch19s05.html#whether_nagiosgrapher_shows_the_host
    "图19-9. NagiosGrapher是否显示主机和服务字段由fe_use_browser参数确定")）。值**`true`**显示选择，**`false`**隐藏它。
- en: '**`use_authentication`**'
  id: totrans-986
  prefs: []
  type: TYPE_NORMAL
  zh: '**`use_authentication`**'
- en: This defines whether NagiosGrapher should take the result of authentication
    by Nagios into account or not. The value **`true`** allows the observer only to
    access hosts and services for which he is responsible as the contact. The value
    **`false`** switches off authentication entirely, so that everyone has access
    to everything.
  id: totrans-987
  prefs: []
  type: TYPE_NORMAL
  zh: 这定义了NagiosGrapher是否应该考虑Nagios的认证结果。值**`true`**允许观察者仅访问他作为联系人负责的主机和服务的资源。值**`false`**完全关闭认证，这样每个人都可以访问一切。
- en: 'The **`cfg_dir`** configuration parameter already mentioned in [19.5.1 Installation](../Text/ch19s05.html#installation-id7
    "19.5.1 Installation") defines a directory containing additional configuration
    files, in particular the definition of the various graphs:'
  id: totrans-988
  prefs: []
  type: TYPE_NORMAL
  zh: 在[19.5.1 安装](../Text/ch19s05.html#installation-id7 "19.5.1 安装")中提到的**`cfg_dir`**配置参数定义了一个包含附加配置文件的目录，特别是各种图表的定义：
- en: '[PRE124]'
  id: totrans-989
  prefs: []
  type: TYPE_PRE
  zh: '[PRE124]'
- en: NagiosGrapher examines it recursively for configuration files of any name; they
    just need to end in **`.ncfg`**. The parameter must stand outside the **`config{}`**
    block; there has to be an = sign between the parameter and the value.
  id: totrans-990
  prefs: []
  type: TYPE_NORMAL
  zh: NagiosGrapher递归地检查任何名称的配置文件；它们只需要以**`.ncfg`**结尾。参数必须位于**`config{}`**块之外；参数和值之间必须有一个等号。
- en: Configuring the graphics—the basic principle
  id: totrans-991
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 配置图形——基本原理
- en: '**`ngraph`** objects are used to define what data is to be extracted and written
    to an RRD database, but the objects also contain information on the display form.
    Like Nagios, NagiosGrapher saves the information temporarily in a cache file,
    which is why the data collection script **`collect2.pl`** must be restarted after
    every change to a configuration file with **`/etc/init.d/ nagios_grapher restart`**.
    **`collect2.pl`** also updates the object cache when this is done.'
  id: totrans-992
  prefs: []
  type: TYPE_NORMAL
  zh: '**`ngraph`**对象用于定义要提取并写入RRD数据库的数据，但对象还包含有关显示形式的信息。像Nagios一样，NagiosGrapher将信息临时保存在缓存文件中，因此每次更改配置文件后都必须重新启动数据收集脚本**`collect2.pl`**，使用**`/etc/init.d/nagios_grapher
    restart`**。**`collect2.pl`**在完成此操作时还会更新对象缓存。'
- en: 'During its installation, NagiosGrapher provides a number of templates for **`ngraph`**
    objects; these can be found in the subdirectories **`standard`** and **`extra`**
    below **`/etc/nagios/ngraph.d/templates`**. These templates all end in **`.ncfg_disabled`**
    so that they are not considered by NagiosGrapher. In order to use them, the file
    extension is renamed:'
  id: totrans-993
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装过程中，NagiosGrapher为**`ngraph`**对象提供了一些模板；这些模板可以在**`/etc/nagios/ngraph.d/templates`**下的**`standard`**和**`extra`**子目录中找到。这些模板都以**`.ncfg_disabled`**结尾，这样它们就不会被NagiosGrapher考虑。为了使用它们，需要重命名文件扩展名：
- en: '[PRE125]'
  id: totrans-994
  prefs: []
  type: TYPE_PRE
  zh: '[PRE125]'
- en: The example in **`check_ping.ncfg_disabled`**, however, only works with **`check_ping`**
    and not with **`check_icmp`** (see [6.2 Reachability Test with Ping](../Text/ch06s02.html
    "6.2 Reachability Test with Ping")). So that NagiosGrapher can graphically display
    the average response time **`rta`** (*round trip average*) and the **`pl`** (*packet
    loss*) from the performance data of the **`check_icmp`** plugin,
  id: totrans-995
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，**`check_ping.ncfg_disabled`**中的示例仅适用于**`check_ping`**，而不是**`check_icmp`**（参见[6.2
    使用Ping进行可达性测试](../Text/ch06s02.html "6.2 使用Ping进行可达性测试")）。为了使NagiosGrapher能够图形化显示**`check_icmp`**插件性能数据中的平均响应时间**`rta`**（往返平均）和**`pl`**（数据包丢失），
- en: '[PRE126]'
  id: totrans-996
  prefs: []
  type: TYPE_PRE
  zh: '[PRE126]'
- en: 'the following **`ngraph`** objects are used:'
  id: totrans-997
  prefs: []
  type: TYPE_NORMAL
  zh: 以下**`ngraph`**对象被使用：
- en: '[PRE127]'
  id: totrans-998
  prefs: []
  type: TYPE_PRE
  zh: '[PRE127]'
- en: '**`service_name`**'
  id: totrans-999
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_name`**'
- en: 'This consists of a regular expression,^([[209](#ftn.CHP-19-FN-17)]) with which
    the NagiosGrapher identifies the service to be displayed in the data passed on.
    If the service description in service objects that use the same plugin is provided
    with the same prefix, one **`ngraph`** definition is enough for all: **`Disk`**_
    matches both **`Disk_usr`**, as well as **`Disk_var`** or **`Disk_tmp`**. In order
    for this to work, the performance data must be structured identically, which is
    always the case if the same plugin is used.'
  id: totrans-1000
  prefs: []
  type: TYPE_NORMAL
  zh: 这由一个正则表达式组成，即`^([[209](#ftn.CHP-19-FN-17)])`，NagiosGrapher通过它来识别在传递的数据中要显示的服务。如果使用相同插件的服务对象中提供的服务描述具有相同的前缀，则一个**`ngraph`**定义就足够了：**`Disk`**_
    匹配 **`Disk_usr`**，以及 **`Disk_var`** 或 **`Disk_tmp`**。为了使这生效，性能数据必须结构相同，如果使用相同的插件，这总是成立的。
- en: '**`graph_perf_regex`**'
  id: totrans-1001
  prefs: []
  type: TYPE_NORMAL
  zh: '**`graph_perf_regex`**'
- en: With this regular expression, NagiosGrapher finds the value being searched for
    in the performance data. The pattern in the round brackets must match the value
    itself.
  id: totrans-1002
  prefs: []
  type: TYPE_NORMAL
  zh: 使用这个正则表达式，NagiosGrapher可以在性能数据中找到要搜索的值。圆括号中的模式必须与值本身匹配。
- en: If a plugin does not provide any performance data, you can use **`graph_log_regex`**
    instead. The search pattern specified there is applied by NagiosGrapher to the
    normal text output of the plugin.
  id: totrans-1003
  prefs: []
  type: TYPE_NORMAL
  zh: 如果插件没有提供任何性能数据，可以使用**`graph_log_regex`**代替。那里指定的搜索模式由NagiosGrapher应用于插件的正常文本输出。
- en: '**`graph_value`**'
  id: totrans-1004
  prefs: []
  type: TYPE_NORMAL
  zh: '**`graph_value`**'
- en: 'The name of the variable in the RRD database must be unique for each service
    and may not contain empty spaces or special characters (exception: _ is allowed).'
  id: totrans-1005
  prefs: []
  type: TYPE_NORMAL
  zh: RRD数据库中变量的名称对于每个服务必须是唯一的，并且不得包含空格或特殊字符（例外：下划线是允许的）。
- en: '**`graph_units`**'
  id: totrans-1006
  prefs: []
  type: TYPE_NORMAL
  zh: '**`graph_units`**'
- en: This parameter defines the unit of the y axis.
  id: totrans-1007
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数定义y轴的单位。
- en: '**`graph_legend`**'
  id: totrans-1008
  prefs: []
  type: TYPE_NORMAL
  zh: '**`graph_legend`**'
- en: This contains the key for the variables.
  id: totrans-1009
  prefs: []
  type: TYPE_NORMAL
  zh: 这包含变量的键。
- en: '**`graph_legend_eol`**'
  id: totrans-1010
  prefs: []
  type: TYPE_NORMAL
  zh: '**`graph_legend_eol`**'
- en: 'This determines whether and how a line break should be inserted into the legend
    after the entry for these graphs. Possible values: **`left`** (line break, line
    is left-aligned), **`right`** (line break, line is right-aligned), **`center`**
    (line break, line is centrally aligned), **`justify`** (line break, fully aligned),
    and **`none`** (no line break, left-aligned). You can append to all values the
    number of empty spaces to be added, separated from it by a colon: **`none: 20`**
    does not create a line break, but the entry is followed by 20 empty spaces.'
  id: totrans-1011
  prefs: []
  type: TYPE_NORMAL
  zh: '这确定是否以及如何在这些图例的条目之后插入换行符。可能的值：**`left`**（换行，行左对齐），**`right`**（换行，行右对齐），**`center`**（换行，行居中对齐），**`justify`**（换行，完全对齐），和**`none`**（无换行，左对齐）。您可以将空格数附加到所有值上，用冒号与它分隔：**`none:
    20`**不会创建换行符，但条目后面跟着20个空格。'
- en: '**`graph_legend_max`**'
  id: totrans-1012
  prefs: []
  type: TYPE_NORMAL
  zh: '**`graph_legend_max`**'
- en: This defines a column width for the legend. Instead of formatting this manually
    with empty spaces, using **`graph_legend_eol`**, this parameter specifies how
    wide the column for a legend entry should be. Entries that are longer are truncated.
  id: totrans-1013
  prefs: []
  type: TYPE_NORMAL
  zh: 这定义了图例的列宽。而不是手动使用空格格式化，使用**`graph_legend_eol`**，此参数指定图例条目的列应该有多宽。较长的条目将被截断。
- en: '**`page`**'
  id: totrans-1014
  prefs: []
  type: TYPE_NORMAL
  zh: '**`page`**'
- en: This optional parameter ensures that NagiosGrapher displays the variables in
    different diagrams if the standardization does not match. All values which are
    to be used in a single graphic are given the same **`page`** entry. For the selection
    of the "page" to be displayed, the CGI script contains its own **`page`** entry
    field (see [Figure 19-10](../Text/ch19s05.html#the_average_response_time_to_pings_comm
    "Figure 19-10. The average response time to pings, represented by NagiosGrapher")).
  id: totrans-1015
  prefs: []
  type: TYPE_NORMAL
  zh: 这个可选参数确保NagiosGrapher在标准化不匹配的情况下以不同的图表显示变量。所有要在单个图形中使用的值都赋予相同的**`page`**条目。对于选择要显示的“页面”，CGI脚本包含其自己的**`page`**条目字段（参见[图19-10](../Text/ch19s05.html#the_average_response_time_to_pings_comm
    "图19-10. ping的平均响应时间，由NagiosGrapher表示")）。
- en: '![The average response time to pings, represented by NagiosGrapher](../Images/tagoreillycom20081104nostarchimages223978.png.jpg)'
  id: totrans-1016
  prefs: []
  type: TYPE_IMG
  zh: '![ping的平均响应时间，由NagiosGrapher表示](../Images/tagoreillycom20081104nostarchimages223978.png.jpg)'
- en: Figure 19-10. The average response time to pings, represented by NagiosGrapher
  id: totrans-1017
  prefs: []
  type: TYPE_NORMAL
  zh: 图19-10. ping的平均响应时间，由NagiosGrapher表示
- en: For the two **`check_icmp`** outputs, it is recommended that the percentage
    of **`Loss`**, which is in the value range from 0 to 100, be separated from **`RTA`**,
    which can be several thousand milliseconds.
  id: totrans-1018
  prefs: []
  type: TYPE_NORMAL
  zh: 对于两个**`check_icmp`**输出，建议将**`Loss`**的百分比（值范围从0到100）与**`RTA`**（可以是几千毫秒）分开。
- en: If you leave out the **`page`** parameter, both graphs—the one for **`Packet`**
    Loss and that for **`RTA`**—are displayed in one graphic.
  id: totrans-1019
  prefs: []
  type: TYPE_NORMAL
  zh: 如果省略 **`page`** 参数，则两个图形——一个用于 **`Packet`** 丢失，另一个用于 **`RTA`**——将显示在一个图形中。
- en: '**`rrd_plottype`**'
  id: totrans-1020
  prefs: []
  type: TYPE_NORMAL
  zh: '**`rrd_plottype`**'
- en: 'This parameter defines which drawing function the RRDtools should use:'
  id: totrans-1021
  prefs: []
  type: TYPE_NORMAL
  zh: 此参数定义 RRDtools 应该使用哪种绘图函数：
- en: '**`LINE1`**: simple line,'
  id: totrans-1022
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**`LINE1`**：简单线条，'
- en: '**`LINE2`**: double line,'
  id: totrans-1023
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**`LINE2`**：双线，'
- en: '**`LINE3`**: extra-fat line,'
  id: totrans-1024
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**`LINE3`**：额外的粗线，'
- en: '**`AREA`**: filled out surface,'
  id: totrans-1025
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**`AREA`**：填充的表面，'
- en: '**`STACK`**: adds the current value to the previous one. In this case the display
    (line or surface) depends on the previous value.'
  id: totrans-1026
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**`STACK`**：将当前值添加到前一个值上。在这种情况下，显示（线条或表面）取决于前一个值。'
- en: '**`rrd_color`**'
  id: totrans-1027
  prefs: []
  type: TYPE_NORMAL
  zh: '**`rrd_color`**'
- en: This is the color of the graph in RGB hexadecimal notation (**``*`rrggbb`*``**).
  id: totrans-1028
  prefs: []
  type: TYPE_NORMAL
  zh: 这是图形的 RGB 十六进制颜色表示（**``*`rrggbb`*``**）。
- en: '[Figure 19-10](../Text/ch19s05.html#the_average_response_time_to_pings_comm
    "Figure 19-10. The average response time to pings, represented by NagiosGrapher")
    shows how NagiosGrapher displays the average response time **`RTA`** for the **`PING`**
    service on the host **`sap-13`**. The respective output **`page`** can be selected
    at the top of the Web form. In addition you can adjust the **`width`**: and **`height`**:
    of an individual graphic, as well as the **`Refresh`** rate.'
  id: totrans-1029
  prefs: []
  type: TYPE_NORMAL
  zh: '[图 19-10](../Text/ch19s05.html#the_average_response_time_to_pings_comm "图 19-10.
    NagiosGrapher 显示的 PING 服务平均响应时间 RTA") 展示了 NagiosGrapher 如何显示主机 **`sap-13`** 上
    PING 服务的平均响应时间 **`RTA`**。可以在 Web 表单的顶部选择相应的 **`页面`** 输出。此外，您还可以调整单个图形的 **`宽度`**
    和 **`高度`**，以及 **`刷新`** 速率。'
- en: 'Starting with version 1.7, NagiosGrapher also has a zoom function: If you click
    on one of the graphics in [Figure 19-10](../Text/ch19s05.html#the_average_response_time_to_pings_comm
    "Figure 19-10. The average response time to pings, represented by NagiosGrapher"),
    you can see it in greater detail. You can select a time period in the diagram
    with the mouse, and NagiosGrapher will display the diagram for this period after
    the mouse button has been released.'
  id: totrans-1030
  prefs: []
  type: TYPE_NORMAL
  zh: 从版本 1.7 开始，NagiosGrapher 也具有缩放功能：如果您点击 [图 19-10](../Text/ch19s05.html#the_average_response_time_to_pings_comm
    "图 19-10. NagiosGrapher 显示的 PING 服务平均响应时间 RTA") 中的任何一个图形，您可以看到更详细的视图。您可以使用鼠标在图表中选择一个时间段，NagiosGrapher
    将在鼠标按钮释放后显示该时间段的数据图。
- en: Advanced options of graphic reprocessing
  id: totrans-1031
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 图形重新处理的高级选项
- en: You may not always want the measured values to be displayed directly. With the
    *CDEF* feature of the RRDtools you can add new values that are calculated from
    the ones recorded.
  id: totrans-1032
  prefs: []
  type: TYPE_NORMAL
  zh: 您可能并不总是希望直接显示测量值。使用 RRDtools 的 *CDEF* 功能，您可以添加从记录的值计算出的新值。
- en: 'As an example, we will use the output of the **`check_disk`** plugin ([7.1
    Free Hard Drive Capacity](../Text/ch07.html#free_hard_drive_capacity "7.1 Free
    Hard Drive Capacity"), page 158), which determines amount of a file system occupied:'
  id: totrans-1033
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，我们将使用 **`check_disk`** 插件的输出（[7.1 硬盘空闲容量](../Text/ch07.html#free_hard_drive_capacity
    "7.1 硬盘空闲容量"), 第 158 页），该插件确定文件系统占用的量：
- en: '[PRE128]'
  id: totrans-1034
  prefs: []
  type: TYPE_PRE
  zh: '[PRE128]'
- en: 'The used space is shown as an dark grey area, the free capacity as a light
    grey one. The performance data provides the current used space (**`1225MB`**)
    and uncritical warning limits, as well as the minimum and maximum (the size of
    the file system). The capacity that is still free is determined as the difference
    between the maximum and the current occupied space. In addition, the unit of MB
    is somewhat unfortunate: the graphic would show 10 GB as **`10k`** MB. For this
    reason you first determine the value that the plugin returns, so that you can
    then scale it as you wish:'
  id: totrans-1035
  prefs: []
  type: TYPE_NORMAL
  zh: 使用的空间以深灰色区域显示，空闲容量以浅灰色显示。性能数据提供了当前使用的空间（**`1225MB`**）和不可疑的警告限制，以及最小和最大值（文件系统的尺寸）。剩余的空闲容量是最大值和当前占用空间之间的差值。此外，MB
    的单位有些不幸：图形将显示 10 GB 为 **`10k`** MB。因此，您首先确定插件返回的值，然后您可以按需对其进行缩放：
- en: '[PRE129]'
  id: totrans-1036
  prefs: []
  type: TYPE_PRE
  zh: '[PRE129]'
- en: The regular expression specified after **`service_name`** matches all service
    descriptions that start with **`fs_`** (short for *file system*), that is, **`fs_root`**,
    **`fs_usr`**, **`fs_var`**, **`fs_tmp`**, etc. The parameter **`hide`** ensures
    that the CGI script does not show the graphs. Instead, NagiosGrapher just stores
    the data in a database.
  id: totrans-1037
  prefs: []
  type: TYPE_NORMAL
  zh: 在 **`service_name`** 后指定的正则表达式匹配所有以 **`fs_`**（代表 *文件系统*）开头的服务描述，即 **`fs_root`**、**`fs_usr`**、**`fs_var`**、**`fs_tmp`**
    等。参数 **`hide`** 确保 CGI 脚本不显示图形。相反，NagiosGrapher 只将数据存储在数据库中。
- en: 'In the second step, the values determined are standardized with the RRD feature
    **`CDEF`**:'
  id: totrans-1038
  prefs: []
  type: TYPE_NORMAL
  zh: 在第二步中，使用 RRD 功能 **`CDEF`** 对确定的值进行标准化：
- en: '[PRE130]'
  id: totrans-1039
  prefs: []
  type: TYPE_PRE
  zh: '[PRE130]'
- en: '**`type`** identifies the entry as a **`CDEF`** definition, which calculates
    new values from already existing ones. **`graph_value`** must be unique, which
    is why the entry here is given its own name.'
  id: totrans-1040
  prefs: []
  type: TYPE_NORMAL
  zh: '**`type`**将条目标识为**`CDEF`**定义，它从已存在的值中计算新值。**`graph_value`**必须是唯一的，这就是为什么此处为条目提供了自己的名称。'
- en: '**`graph_calc`** finally processes the data. This parameter expects the instructions
    in reverse Polish notation (RPN).^([[210](#ftn.CHP-19-FN-18)]) In this, the values
    to be processed are pushed, in turn, onto a stack, to be removed and operated
    on later.'
  id: totrans-1041
  prefs: []
  type: TYPE_NORMAL
  zh: '**`graph_calc`**最终处理数据。此参数期望以逆波兰表示法（RPN）的指令。在此，要处理的价值依次推入堆栈，稍后将其移除并操作。'
- en: Adding 2 + 3 is noted in RPN accordingly as **`2`**, **`3`**, +. In the example
    we multiply the variable defined in [Advanced options of graphic reprocessing](../Text/ch19s05.html#advanced_options_of_graphic_reproces
    "Advanced options of graphic reprocessing"), **`disk_used`**, by 1024² so that
    the result is in bytes. **`hide no`** now ensures that this value is displayed.
  id: totrans-1042
  prefs: []
  type: TYPE_NORMAL
  zh: 在RPN中，将2 + 3相加表示为**`2`**，**`3`**，+。在示例中，我们将[图形重新处理的高级选项](../Text/ch19s05.html#advanced_options_of_graphic_reproces
    "图形重新处理的高级选项")中定义的变量**`disk_used`**乘以1024²，以便结果以字节为单位。**`hide no`**现在确保此值被显示。
- en: 'To display available space according to the same pattern, we first determine
    the entire space available (**`disk_max`**), which NagiosGrapher should not display,
    calculate the difference between **`disk_max`** and the above **`disk_ used`**
    value, and convert the result to bytes:'
  id: totrans-1043
  prefs: []
  type: TYPE_NORMAL
  zh: 要根据相同的模式显示可用空间，我们首先确定整个可用空间（**`disk_max`**），NagiosGrapher不应显示，计算**`disk_max`**与上述**`disk_used`**值之间的差异，并将结果转换为字节：
- en: '[PRE131]'
  id: totrans-1044
  prefs: []
  type: TYPE_PRE
  zh: '[PRE131]'
- en: 'The corresponding formula is (**`disk_max-disk_used`**)x1024² The plot type
    **`STACK`** ensures that the value determined from the previous **`disk_used`**
    value is placed on top of this. [Figure 19-11](../Text/ch19s05.html#displaying_the_calculated_load_data
    "Figure 19-11. Displaying the calculated load data") shows a corresponding output:
    The lower part of the screen represents the current used space on the file system
    for the past six hours and the past day and week, and the top part shows the remaining
    free hard drive space. The graph also contains a monthly and a yearly view, not
    shown here.'
  id: totrans-1045
  prefs: []
  type: TYPE_NORMAL
  zh: 相应的公式是（**`disk_max-disk_used`**）x1024²。绘图类型**`STACK`**确保从上一个**`disk_used`**值确定的价值位于其顶部。[图19-11](../Text/ch19s05.html#displaying_the_calculated_load_data
    "图19-11. 显示计算后的负载数据")显示了相应的输出：屏幕的下半部分表示过去六小时、过去一天和一周内文件系统上的当前使用空间，上半部分显示剩余的空闲硬盘空间。图表还包含月度和年视图，此处未显示。
- en: At this point it should again be emphasized that with this definition, NagiosGrapher
    automatically records all services that begin with **`fs_`** and are matched by
    the search pattern, writes the data to an RRD database, and generates a corresponding
    **`serviceextinfo`** entry, which appears automatically in the Web interface after
    a Nagios reload (see [Figure 19-7](../Text/ch19s05.html#the_nagiosgrapher_icon_open_parenthesis
    "Figure 19-7. The NagiosGrapher icon (arrow) in the Nagios Web interface indicates
    a time-related evaluation for this service") in page 434).
  id: totrans-1046
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，应再次强调，根据此定义，NagiosGrapher自动记录所有以**`fs_`**开头并与搜索模式匹配的服务，将数据写入RRD数据库，并生成相应的**`serviceextinfo`**条目，在Nagios重新加载后自动出现在Web界面中（见第434页的[图19-7](../Text/ch19s05.html#the_nagiosgrapher_icon_open_parenthesis
    "图19-7. Nagios Web界面中的NagiosGrapher图标（箭头）表示对此服务的相关评估")）。
- en: 'After changes have been made to the configuration file **`ngraph.ncfg`**, the
    file collector **`collect2.pl`** must also be restarted:'
  id: totrans-1047
  prefs: []
  type: TYPE_NORMAL
  zh: 在对配置文件**`ngraph.ncfg`**进行更改后，文件收集器**`collect2.pl`**也必须重新启动：
- en: '[PRE132]'
  id: totrans-1048
  prefs: []
  type: TYPE_PRE
  zh: '[PRE132]'
- en: '![Displaying the calculated load data](../Images/tagoreillycom20081104nostarchimages223980.png.jpg)'
  id: totrans-1049
  prefs: []
  type: TYPE_IMG
  zh: '![显示计算后的负载数据](../Images/tagoreillycom20081104nostarchimages223980.png.jpg)'
- en: Figure 19-11. Displaying the calculated load data
  id: totrans-1050
  prefs: []
  type: TYPE_NORMAL
  zh: 图19-11. 显示计算后的负载数据
- en: Nagios configuration
  id: totrans-1051
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Nagios配置
- en: 'Nagios passes on data for NagiosGrapher through the command interface, that
    is, each individual result leads to an external command being started. Correspondingly,
    the Nagios main configuration file contains the following parameter:'
  id: totrans-1052
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios通过命令界面传递数据给NagiosGrapher，即每个单独的结果都会启动一个外部命令。相应地，Nagios主配置文件包含以下参数：
- en: '[PRE133]'
  id: totrans-1053
  prefs: []
  type: TYPE_PRE
  zh: '[PRE133]'
- en: The definition of the command object **`process-service-perfdata`**— which is
    best achieved by creating a separate file with the name **`process_service_perfdata_n.graph.cfg`**—depends
    on the interface type used.
  id: totrans-1054
  prefs: []
  type: TYPE_NORMAL
  zh: 命令对象 **`process-service-perfdata`** 的定义——最好通过创建一个名为 **`process_service_perfdata_n.graph.cfg`**
    的单独文件来实现——取决于所使用的接口类型。
- en: For **`interface pipe`**, the program **`fifo_write`** is used, whereas for
    **`interface network`**, NagiosGrapher requires the program **`udpecho`**.
  id: totrans-1055
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 **`interface pipe`**，使用程序 **`fifo_write`**，而对于 **`interface network`**，NagiosGrapher需要程序
    **`udpecho`**。
- en: 'The definition of the command with **`fifo_write`** is as follows:'
  id: totrans-1056
  prefs: []
  type: TYPE_NORMAL
  zh: 命令 **`fifo_write`** 的定义如下：
- en: '[PRE134]'
  id: totrans-1057
  prefs: []
  type: TYPE_PRE
  zh: '[PRE134]'
- en: '**`process-service-perfdata`** calls the script **`fifo_write.pl`**, which
    is given three arguments as parameters: the named pipe, a string with the performance
    details, and a timeout in seconds. The latter ensures that the script aborts the
    action if the data cannot be written within three seconds. The **`command_line`**
    must, as usual, be writen on one line.'
  id: totrans-1058
  prefs: []
  type: TYPE_NORMAL
  zh: '**`process-service-perfdata`** 调用脚本 **`fifo_write.pl`**，该脚本作为参数提供了三个参数：命名管道、包含性能细节的字符串以及以秒为单位的超时时间。后者确保如果数据在三秒内无法写入，则脚本将终止操作。**`command_line`**
    必须像往常一样，写在一行上。'
- en: 'For the program **`udpecho`**, the definition of the command is somewhat simpler:'
  id: totrans-1059
  prefs: []
  type: TYPE_NORMAL
  zh: 对于程序 **`udpecho`**，命令的定义相对简单：
- en: '[PRE135]'
  id: totrans-1060
  prefs: []
  type: TYPE_PRE
  zh: '[PRE135]'
- en: '**`udpecho`** does not need any parameters: It retrieves the required information
    from the environment variables **`NAGIOS_HOSTNAME, NAGIOS_SERVICE-DESC`**, **`NAGIOS_SERVICEOUTPUT`**,
    and **`NAGIOS_SERVICEPERFDATA`**. Nagios has to make these available with **`enable_environment_macros=1`**
    (see [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")) so that **`udpecho`** can provide
    NagiosGrapher with usable data.^([[211](#ftn.CHP-19-FN-19)])'
  id: totrans-1061
  prefs: []
  type: TYPE_NORMAL
  zh: '**`udpecho`** 不需要任何参数：它从环境变量 **`NAGIOS_HOSTNAME, NAGIOS_SERVICE-DESC`**、**`NAGIOS_SERVICEOUTPUT`**
    和 **`NAGIOS_SERVICEPERFDATA`** 中检索所需信息。Nagios必须通过 **`enable_environment_macros=1`**（见[A.1
    主配置文件 nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    主配置文件 nagios.cfg")）提供这些信息，以便 **`udpecho`** 可以向NagiosGrapher提供可用的数据。'
- en: 'For the **`file`** interface type, the command **`process-service-perfdata`**
    has another meaning: It is not called for every check result, but rather shifts
    the file into which Nagios writes all performance data via the template mechanism:'
  id: totrans-1062
  prefs: []
  type: TYPE_NORMAL
  zh: 对于 **`file`** 接口类型，命令 **`process-service-perfdata`** 有另一个含义：它不是对每个检查结果都调用，而是通过模板机制将文件移入Nagios写入所有性能数据的文件中：
- en: '[PRE136]'
  id: totrans-1063
  prefs: []
  type: TYPE_PRE
  zh: '[PRE136]'
- en: The current timestamp is simply appended to the file name **`service-perf-data`**.
    The daemon **`collect2.pl`** searches for all files called **`service-perfdata.`****``*`time_stamp`*``**
    from the specified directory and processes these.
  id: totrans-1064
  prefs: []
  type: TYPE_NORMAL
  zh: 当前的时间戳简单地附加到文件名 **`service-perf-data`**。守护进程 **`collect2.pl`** 在指定目录中搜索所有名为
    **`service-perfdata.`****``*`time_stamp`*``** 的文件，并处理这些文件。
- en: 'What data is written to the file by Nagios is specified by **`service_perf
    data_file_template`** in **`nagios.cfg`**:'
  id: totrans-1065
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios写入文件的数据由 **`nagios.cfg`** 中的 **`service_perf data_file_template`** 指定：
- en: '[PRE137]'
  id: totrans-1066
  prefs: []
  type: TYPE_PRE
  zh: '[PRE137]'
- en: Compared to the variation with **`fifo_write.pl`**, Nagios now also passes on
    a timestamp for each check. This is necessary because the data are not processed
    immediately, but periodically at intervals of **`service_perfdata_ file_processing_interval`**—this
    is 60 seconds in our example.
  id: totrans-1067
  prefs: []
  type: TYPE_NORMAL
  zh: 与 **`fifo_write.pl`** 的变体相比，Nagios现在还传递每个检查的时间戳。这是必要的，因为数据不是立即处理，而是在 **`service_perfdata_
    file_processing_interval`** 间隔内定期处理——在我们的例子中是60秒。
- en: If you want to squeeze a little more performance out of this, you can select
    a temporary file system such as **`/dev/shm`** for the **`service-perfdata*`**
    files. The file then is not written to the hard drive, but remains in the main
    memory of the Nagios server.
  id: totrans-1068
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你想从这个中挤出更多性能，你可以为 **`service-perfdata*`** 文件选择一个临时文件系统，例如 **`/dev/shm`**。然后文件不会写入硬盘，而保持在Nagios服务器的内存中。
- en: 'As usual, changes to the Nagios configuration require a reload:'
  id: totrans-1069
  prefs: []
  type: TYPE_NORMAL
  zh: 如往常一样，对Nagios配置的更改需要重新加载：
- en: '[PRE138]'
  id: totrans-1070
  prefs: []
  type: TYPE_PRE
  zh: '[PRE138]'
- en: 'The success of this can be clearly observed in the log file if you set the
    loglevel to 255 (see [The configuration file ngraph.ncfg](../Text/ch19s05.html#the_configuration_file_ngraph.ncfg
    "The configuration file ngraph.ncfg")).^([[212](#ftn.CHP-19-FN-20)]) For the sake
    of clarity we will omit the timestamp at the beginning of the line:'
  id: totrans-1071
  prefs: []
  type: TYPE_NORMAL
  zh: 如果将日志级别设置为255（见[配置文件 ngraph.ncfg](../Text/ch19s05.html#the_configuration_file_ngraph.ncfg
    "配置文件 ngraph.ncfg")），则可以在日志文件中清楚地观察到这种成功的迹象。为了清晰起见，我们将省略行首的时间戳：
- en: '[PRE139]'
  id: totrans-1072
  prefs: []
  type: TYPE_PRE
  zh: '[PRE139]'
- en: The label **`PRG`** identifies program states, such as the restart here. **`PIPE`**
    reproduces in full all the data taken from the named pipe (host name, service
    description, plugin output, and performance data, each separated by a tab). **`REGEX`**
    shows how the search for matching entries takes place and how the values are extracted
    from them. **`RRD`** reveals the commands performed with **`rrdtool`** and **`VALUES`**
    shows the recognized values(**`PING`**).
  id: totrans-1073
  prefs: []
  type: TYPE_NORMAL
  zh: 标签**`PRG`**标识程序状态，例如这里的重启。**`PIPE`**完整地重现从命名管道（主机名、服务描述、插件输出和性能数据，每个用制表符分隔）中获取的所有数据。**`REGEX`**显示了如何搜索匹配条目以及如何从中提取值。**`RRD`**揭示了使用**`rrdtool`**执行的命令，而**`VALUES`**显示了识别的值（**`PING`**）。
- en: '* * *'
  id: totrans-1074
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[205](#CHP-19-FN-13)]) [http://www.nagiosexchange.org/42;195](http://www.nagiosexchange.org/42;195)
  id: totrans-1075
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[205](#CHP-19-FN-13)]) [http://www.nagiosexchange.org/42;195](http://www.nagiosexchange.org/42;195)
- en: ^([[206](#CHP-19-FN-14)]) Starting from NagiosGrapher 1.7, the file **`config.layout`**
    already contains the entry **`<Layout nagiosbook>`**.
  id: totrans-1076
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[206](#CHP-19-FN-14)]) 从NagiosGrapher 1.7版本开始，文件**`config.layout`**已经包含了条目**`<Layout
    nagiosbook>`**。
- en: ^([[207](#CHP-19-FN-15)]) Even when running **`make update`**, it doesn't hurt
    for you to back up the configuration files beforehand.
  id: totrans-1077
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[207](#CHP-19-FN-15)]) 即使在运行**`make update`**时，事先备份配置文件也不会有害。
- en: ^([[208](#CHP-19-FN-16)]) See [19.1.1 The template mechanism](../Text/ch19.html#the_template_mechanism
    "19.1.1 The template mechanism") in page 405
  id: totrans-1078
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[208](#CHP-19-FN-16)]) 请参阅第405页的[19.1.1 模板机制](../Text/ch19.html#the_template_mechanism
    "19.1.1 The template mechanism")。
- en: ^([[209](#CHP-19-FN-17)]) Since we have a Perl script on our hands, this is,
    of course, a Perl regexp.
  id: totrans-1079
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[209](#CHP-19-FN-17)]) 由于我们手头有Perl脚本，这当然是一个Perl正则表达式。
- en: ^([[210](#CHP-19-FN-18)]) An introduction to RPN can be found at [http://people.ee.ethz.ch/˜oetiker/webtools/rrdtool/tut/rpntutorial.en.html](http://people.ee.ethz.ch/%CB%9Coetiker/webtools/rrdtool/tut/rpntutorial.en.html).
  id: totrans-1080
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[210](#CHP-19-FN-18)]) RPN的介绍可以在[http://people.ee.ethz.ch/˜oetiker/webtools/rrdtool/tut/rpntutorial.en.html](http://people.ee.ethz.ch/%CB%9Coetiker/webtools/rrdtool/tut/rpntutorial.en.html)找到。
- en: ^([[211](#CHP-19-FN-19)]) Environment macros are described in [D.1.8 Using standard
    macros about the environment](../Text/apd.html#using_standard_macros_about_the_environm
    "D.1.8 Using standard macros about the environment") from page 631.
  id: totrans-1081
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[211](#CHP-19-FN-19)]) 环境宏的描述可以在[第D.1.8节 使用关于环境的标准宏](../Text/apd.html#using_standard_macros_about_the_environm
    "第D.1.8节 使用关于环境的标准宏")中找到，从第631页开始。
- en: '^([[212](#CHP-19-FN-20)]) In general: 2^n - 1 with *n*≥8'
  id: totrans-1082
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[212](#CHP-19-FN-20)]) 通常：2^n - 1，其中*n*≥8。
- en: 19.6 Smooth Plotting with PNP
  id: totrans-1083
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 19.6 使用PNP进行平滑绘图
- en: '*PNP is not PerfParse*—with this recursive acronym, which is an allusion to
    the PerfParse tool (not described in this book)—the authors of PNP, Jörg Linge
    and Hendrik B$aUcker, are clearly heralding the virtues of their own tool for
    processing performance data: It is allegedly very easy to install (in contrast
    to PerfParse) and can be used (almost) without configuration, yet provides extensive
    configuration options for advanced usage.'
  id: totrans-1084
  prefs: []
  type: TYPE_NORMAL
  zh: '*PNP不是PerfParse*——这个递归缩写是对PerfParse工具的暗指（本书中未描述），PNP的作者Jörg Linge和Hendrik B$aUcker显然在宣扬他们自己的工具处理性能数据的优点：据说它安装起来非常容易（与PerfParse相比），并且几乎无需配置即可使用，但提供了广泛的配置选项以供高级使用。'
- en: Besides providing the usual graphs for a specific check, PNP also creates an
    overview of all graphs belonging to one host. An AJAX-based input field allows
    host names to be typed in. The names are auto-completed during input, and a match
    list of alternative completions is displayed. The graphics have a sophisticated
    appearance and can be exported to PDF format.
  id: totrans-1085
  prefs: []
  type: TYPE_NORMAL
  zh: 除了提供特定检查的常规图表外，PNP还创建了一个属于一个主机的所有图表的概述。一个基于AJAX的输入字段允许输入主机名。在输入过程中，名称会自动完成，并显示一个匹配列表的替代完成。图形具有复杂的外观，并且可以导出为PDF格式。
- en: PNP takes the performance data directly from the area reserved for the plugin
    output, that is, only plugins that display performance data in the standard format
    can be used. In contrast to NagiosGrapher, no data can be extracted from the normal
    text output. To compensate for this slight limitation, PNP outputs the performance
    data for all plugins automatically. If PNP does not recognize the plugin, it uses
    a generic template.
  id: totrans-1086
  prefs: []
  type: TYPE_NORMAL
  zh: PNP直接从插件输出保留区域获取性能数据，也就是说，只有显示性能数据的标准格式的插件才能使用。与NagiosGrapher不同，无法从正常文本输出中提取数据。为了弥补这一轻微的限制，PNP自动输出所有插件的性能数据。如果PNP无法识别插件，它将使用通用模板。
- en: On the PNP homepage^([[213](#ftn.CHP-19-FN-21)]) you can find addresses of English
    mailing lists^([[214](#ftn.CHP-19-FN-22)]) and a German-language forum, where
    you can, however, ask questions in English.^([[215](#ftn.CHP-19-FN-23)]) The English
    homepage is [http://www.pnp4nagios.org/pnp/](http://www.pnp4nagios.org/pnp/).
  id: totrans-1087
  prefs: []
  type: TYPE_NORMAL
  zh: 在PNP主页^([[213](#ftn.CHP-19-FN-21)])上，您可以找到英文邮件列表^([[214](#ftn.CHP-19-FN-22)])和德语论坛的地址，尽管如此，您可以用英语提问.^([[215](#ftn.CHP-19-FN-23)])
    英文主页是[http://www.pnp4nagios.org/pnp/](http://www.pnp4nagios.org/pnp/)。
- en: The following description refers to PNP version 0.4; older versions do not have
    all the features described here.
  id: totrans-1088
  prefs: []
  type: TYPE_NORMAL
  zh: 以下描述适用于PNP版本0.4；较旧版本可能不具备此处描述的所有功能。
- en: 19.6.1 Installation
  id: totrans-1089
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.6.1 安装
- en: 'The requirements for installation are quite minimal: Apache, Perl (without
    any special modules), PHP4 from version 4.3.0 or PHP5, and all the RRDtools.^([[216](#ftn.CHP-19-FN-24)])
    If possible you should install the Perl module RRDs from the Perl package included
    with your distribution (e.g., **`librrds-perl`** in Debian). The Perl script **`process_perfdata.pl`**,
    which forwards Nagios performance data to PNP, then accesses the RRD databases
    directly, without running an external program.'
  id: totrans-1090
  prefs: []
  type: TYPE_NORMAL
  zh: 安装要求相当简单：Apache、Perl（无需任何特殊模块）、PHP4版本4.3.0或PHP5，以及所有RRDtools.^([[216](#ftn.CHP-19-FN-24)])
    如果可能，您应该从您的发行版中包含的Perl包中安装Perl模块RRDs（例如，Debian中的**`librrds-perl`**）。Perl脚本**`process_perfdata.pl`**将Nagios性能数据转发到PNP，然后直接访问RRD数据库，而不运行外部程序。
- en: 'The PNP source code is downloaded from the homepage^([[217](#ftn.CHP-19-FN-25)])
    and is unpacked appropriately in the directory **`/usr/local/src`**:'
  id: totrans-1091
  prefs: []
  type: TYPE_NORMAL
  zh: PNP源代码从主页^([[217](#ftn.CHP-19-FN-25)]) 下载，并在**`/usr/local/src`**目录中适当解包：
- en: '[PRE140]'
  id: totrans-1092
  prefs: []
  type: TYPE_PRE
  zh: '[PRE140]'
- en: Finally, **`make all`** compiles the necessary C programs, and **`make install`**
    installs PNP in full. In the **`configure`** command, **`--sysconfdir=/etc/pnp`**
    allows for the later installation of the configuration examples in **`/etc/pnp`**,
    in accordance with the conventions used in this book. Other **`configure`** options
    are shown with **`./configure --help`**.
  id: totrans-1093
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，**`make all`**编译必要的C程序，**`make install`**完全安装PNP。在**`configure`**命令中，**`--sysconfdir=/etc/pnp`**允许在**`/etc/pnp`**中安装配置示例，这符合本书中使用的约定。其他**`configure`**选项可以通过**`./configure
    --help`**查看。
- en: 19.6.2 The standard configuration
  id: totrans-1094
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.6.2 标准配置
- en: 'During the installation of PNP a variety of data is placed in the configuration
    directory (in this case **`/etc/pnp`**), including **`config.php`**, the configuration
    file for the Web interface. There you must first check to see if the paths to
    **`rrdtool`** and to the performance data directory are correctly set:'
  id: totrans-1095
  prefs: []
  type: TYPE_NORMAL
  zh: 在安装PNP期间，各种数据被放置在配置目录中（在这种情况下为**`/etc/pnp`**），包括**`config.php`**，这是Web界面的配置文件。在那里，您必须首先检查**`rrdtool`**和性能数据目录的路径是否设置正确：
- en: '[PRE141]'
  id: totrans-1096
  prefs: []
  type: TYPE_PRE
  zh: '[PRE141]'
- en: '**`/etc/pnp`** also contains example configurations for the data collector
    **`pro-cess_perfdata.pl`**, in the files **`process_perfdata.cfg-sample`** and
    **`rra.cfg-sample`**. Neither of these are absolutely essential: PNP also functions
    correctly without any adjustments. But in order to use the data collector you
    need to rename the files **`process_perfdata.cfg`** and **`rra.cfg`** and modify
    them accordingly. If the Perl module RRDs is installed, then it is activated in
    the file **`process_perfdata.cfg`** with **`USE_RRDS=1`**:'
  id: totrans-1097
  prefs: []
  type: TYPE_NORMAL
  zh: '**`/etc/pnp`** 还包含数据收集器**`process_perfdata.pl`**的示例配置，在文件**`process_perfdata.cfg-sample`**和**`rra.cfg-sample`**中。这两者都不是绝对必要的：PNP在没有调整的情况下也能正常工作。但为了使用数据收集器，您需要重命名文件**`process_perfdata.cfg`**和**`rra.cfg`**，并相应地修改它们。如果已安装Perl模块RRDs，则它在**`process_perfdata.cfg`**文件中通过**`USE_RRDS=1`**被激活：'
- en: '[PRE142]'
  id: totrans-1098
  prefs: []
  type: TYPE_PRE
  zh: '[PRE142]'
- en: The second change (here in bold type) to the sample file refers to the Nagios
    directory for log files, which in this book is named **`/var/nagios`**.
  id: totrans-1099
  prefs: []
  type: TYPE_NORMAL
  zh: 样本文件中的第二次更改（此处为粗体）指的是Nagios日志文件的目录，在本书中命名为**`/var/nagios`**。
- en: '**`rra.cfg`** is used as a template for the RRD databases to be newly created.
    If an existing database is to be modified, it must be deleted; but then all existing
    data will be lost. The template is a good compromise between length of storage
    and time resolution: This causes data with a time resolution of one hour to be
    stored for up to four years, such an RRD database that is about 400 KB in size.
    Information on settings for RRD databases is provided by the command **`man rrdcreate`**.'
  id: totrans-1100
  prefs: []
  type: TYPE_NORMAL
  zh: '**`rra.cfg`**用作新创建的RRD数据库的模板。如果需要修改现有数据库，则必须将其删除；但这样会丢失所有现有数据。该模板在存储长度和时间分辨率之间是一个很好的折衷方案：这会导致具有每小时时间分辨率的数存储长达四年，这样一个大约400
    KB大小的RRD数据库。有关RRD数据库设置的说明，请参阅命令**`man rrdcreate`**。'
- en: In the directory **`/etc/pnp`** there is also the configuration file **`npcd.cfg`**
    for the *Nagios Performance Data C Daemon* **`npcd`** and a subdirectory **`check_
    commands`** for so-called *custom templates*. Both will be discussed in [19.6.4
    Bulk processing of performance data](../Text/ch19s06.html#bulk_processing_of_performance_data
    "19.6.4 Bulk processing of performance data").
  id: totrans-1101
  prefs: []
  type: TYPE_NORMAL
  zh: 在目录 **`/etc/pnp`** 中，还有 *Nagios 性能数据 C 守护进程* **`npcd`** 的配置文件 **`npcd.cfg`**
    和一个名为 *自定义模板* 的子目录 **`check_ commands`**。这两者将在 [19.6.4 大量处理性能数据](../Text/ch19s06.html#bulk_processing_of_performance_data
    "19.6.4 大量处理性能数据") 中讨论。
- en: Adjusting the Nagios configuration
  id: totrans-1102
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 调整 Nagios 配置
- en: 'There are a number of ways in which Nagios can pass on performance data to
    the PNP data collector **`process_perfdata.pl`**. The simplest way is for the
    system to run a separate program for each event, called **`service-perf-data-pnp`**.
    To do this, performance data processing is switched on in the file **`/etc/nagios/nagios.cfg`**
    with the parameter **`process_performance_data`**, and the command to be executed
    is defined with **`service_perfdata_command`**:'
  id: totrans-1103
  prefs: []
  type: TYPE_NORMAL
  zh: Nagios 有多种方式可以将性能数据传递给 PNP 数据收集器 **`process_perfdata.pl`**。最简单的方式是系统为每个事件运行一个单独的程序，称为
    **`service-perf-data-pnp`**。为此，在文件 **`/etc/nagios/nagios.cfg`** 中通过参数 **`process_performance_data`**
    启用性能数据处理，并通过 **`service_perfdata_command`** 定义要执行的命令：
- en: '[PRE143]'
  id: totrans-1104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE143]'
- en: The performance data of various plugins contains names that are set in single
    quotes. So that these do not get lost in the plugin output, a single quote may
    *not* be used in the parameter **`illegal_macro_output_chars`**.^([[218](#ftn.CHP-19-FN-26)])
  id: totrans-1105
  prefs: []
  type: TYPE_NORMAL
  zh: 不同的插件性能数据包含设置在单引号中的名称。为了防止这些名称在插件输出中丢失，参数 **`illegal_macro_output_chars`** 中
    *不得* 使用单引号.^([[218](#ftn.CHP-19-FN-26)])
- en: 'The command **`service-perfdata-pnp`** runs **`process_perfdata.pl`**:'
  id: totrans-1106
  prefs: []
  type: TYPE_NORMAL
  zh: '命令 **`service-perfdata-pnp`** 运行 **`process_perfdata.pl`**:'
- en: '[PRE144]'
  id: totrans-1107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE144]'
- en: The embedded Perl interpreter ePN (see [Appendix G](../Text/apg.html "Appendix G. The
    Embedded Perl Interpreter") in page 669) cannot execute this Perl script, which
    is why it is called explictly with **`/usr/bin/perl`**. If ePN is not compiled
    into Nagios, you can leave out the **`/usr/bin/perl`** path.
  id: totrans-1108
  prefs: []
  type: TYPE_NORMAL
  zh: 内嵌的 Perl 解释器 ePN（见第 669 页的 [附录 G](../Text/apg.html "附录 G. 内嵌 Perl 解释器")）不能执行此
    Perl 脚本，因此必须显式使用 **`/usr/bin/perl`**。如果 ePN 没有编译到 Nagios 中，可以省略 **`/usr/bin/perl`**
    路径。
- en: The performance data is taken here by **`process_perfdata.pl`** via the environment
    variable **`NAGIOS_SERVICEPERFDATA`**, so that environment variables in general
    must not be switched off.^([[219](#ftn.CHP-19-FN-27)])
  id: totrans-1109
  prefs: []
  type: TYPE_NORMAL
  zh: 性能数据是通过环境变量 **`NAGIOS_SERVICEPERFDATA`** 由 **`process_perfdata.pl`** 采集的，因此通常必须不关闭环境变量.^([[219](#ftn.CHP-19-FN-27)])
- en: 19.6.3 The PNP Web interface
  id: totrans-1110
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.6.3 PNP 网页界面
- en: If you run [http://nagios_server/nagios/pnp/index.php](http://nagios_server/nagios/pnp/index.php)
    you will be taken to the PNP overview page (see [Figure 19-12](../Text/ch19s06.html#all_services_of_elix01_on_one_page
    "Figure 19-12. All services of elix01 on one page")). This displays the data of
    the first host, in alphabetical order, that is found by PNP. The input field at
    the top right is implemented with AJAX and shows a hit list, matching the text
    entered so far, from which the desired host is selected. The accompanying overview
    page presents all services in a 24-hour view.
  id: totrans-1111
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你运行 [http://nagios_server/nagios/pnp/index.php](http://nagios_server/nagios/pnp/index.php)，你将被带到
    PNP 概览页面（见 [图 19-12](../Text/ch19s06.html#all_services_of_elix01_on_one_page "图
    19-12. `elix01` 在一页上的所有服务")). 这显示了 PNP 找到的第一个主机的数据，按字母顺序排列。右上角的输入字段使用 AJAX 实现，并显示一个匹配已输入文本的命中列表，从中选择所需的主机。相关的概览页面以
    24 小时视图展示所有服务。
- en: This can also be accessed directly via [http://nagiosserver/nagios/ pnp/index.php?host=hostname](http://nagiosserver/nagios/%20pnp/index.php?host=hostname).
    If you replace **``*`hostname`*``** with **`elix01`**, you will arrive at the
    overview page for the host of that name ([Figure 19-12](../Text/ch19s06.html#all_services_of_elix01_on_one_page
    "Figure 19-12. All services of elix01 on one page")).
  id: totrans-1112
  prefs: []
  type: TYPE_NORMAL
  zh: 这也可以直接通过 [http://nagiosserver/nagios/ pnp/index.php?host=hostname](http://nagiosserver/nagios/%20pnp/index.php?host=hostname)
    访问。如果你将 **``*`hostname`*``** 替换为 **`elix01`**，你将到达该名称的主机概览页面（[图 19-12](../Text/ch19s06.html#all_services_of_elix01_on_one_page
    "图 19-12. `elix01` 在一页上的所有服务")）。
- en: '![All services of elix01 on one page](../Images/tagoreillycom20081104nostarchimages223982.png.jpg)'
  id: totrans-1113
  prefs: []
  type: TYPE_IMG
  zh: '![`elix01` 在一页上的所有服务](../Images/tagoreillycom20081104nostarchimages223982.png.jpg)'
- en: Figure 19-12. All services of `elix01` on one page
  id: totrans-1114
  prefs: []
  type: TYPE_NORMAL
  zh: 图 19-12. `elix01` 在一页上的所有服务
- en: 'A mouse click on a service graph or on the accompanying link on the right in
    the overview causes the selected display to be shown in a different time resolution
    ([Figure 19-13](../Text/ch19s06.html#system_load_in_pnp_colon_host "Figure 19-13. System
    load in PNP: host elix01, service lx-load")): four hours, one day and (not shown)
    one week, one month, and one year. The periods presented here by PNP are defined
    in the configuration file **`config.php`**:'
  id: totrans-1115
  prefs: []
  type: TYPE_NORMAL
  zh: 在服务图形或概述中右侧的辅助链接上单击鼠标，会导致所选显示以不同的时间分辨率显示（[图19-13](../Text/ch19s06.html#system_load_in_pnp_colon_host
    "图19-13. PNP中的系统负载：主机elix01，服务lx-load"))：四小时、一天和（未显示）一周、一个月和一年。PNP在此处显示的周期在配置文件**`config.php`**中定义：
- en: '[PRE145]'
  id: totrans-1116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE145]'
- en: The specific **`title`** labels can be chosen freely, so you could also use
    text in other languages. The images themselves cannot be localized, however.
  id: totrans-1117
  prefs: []
  type: TYPE_NORMAL
  zh: 具体的**`title`**标签可以自由选择，因此您也可以使用其他语言中的文本。然而，图像本身无法本地化。
- en: '![System load in PNP: host elix01, service lx-load](../Images/tagoreillycom20081104nostarchimages223984.png.jpg)'
  id: totrans-1118
  prefs: []
  type: TYPE_IMG
  zh: '![PNP中的系统负载：主机elix01，服务lx-load](../Images/tagoreillycom20081104nostarchimages223984.png.jpg)'
- en: 'Figure 19-13. System load in PNP: host `elix01`, service `lx-load`'
  id: totrans-1119
  prefs: []
  type: TYPE_NORMAL
  zh: 图19-13. PNP中的系统负载：主机`elix01`，服务`lx-load`
- en: 'The **`start`** details specify for how many seconds *before* a defined reference
    point the graphic will begin. Normally the current time is used as a reference
    point, but this can also be selected using the calendar included. To do this,
    you click the calendar icon (see [Figure 19-14](../Text/ch19s06.html#pnp_apostrophy_s_calendar_function
    "Figure 19-14. PNP''s calendar function")), select the end time after **Time**
    with a mouse click, and then select the day. Selecting the time takes some getting
    used to: One click increases the value displayed by one, and holding down the
    ![System load in PNP: host elix01, service lx-load](../Images/tagoreillycom20081104nostarchimages223986.png)
    key at the same time reduces the time value displayed. You can also hold down
    the left mouse button and drag the mouse to the left to increase the value, or
    drag to the right to decrease it.'
  id: totrans-1120
  prefs: []
  type: TYPE_NORMAL
  zh: '**`start`**细节指定了图形在定义的参考点之前多少秒开始。通常使用当前时间作为参考点，但也可以使用包含的日历来选择。为此，您点击日历图标（见[图19-14](../Text/ch19s06.html#pnp_apostrophy_s_calendar_function
    "图19-14. PNP的日历功能"))，用鼠标点击选择**时间**后的结束时间，然后选择日期。选择时间需要一些习惯：单击会增加显示的值，同时按住![PNP中的系统负载：主机elix01，服务lx-load](../Images/tagoreillycom20081104nostarchimages223986.png)键会减少显示的时间值。您也可以按住左鼠标按钮并拖动鼠标向左增加值，或向右拖动以减少值。'
- en: '![PNP''s calendar function](../Images/tagoreillycom20081104nostarchimages223988.png.jpg)'
  id: totrans-1121
  prefs: []
  type: TYPE_IMG
  zh: '![PNP的日历功能](../Images/tagoreillycom20081104nostarchimages223988.png.jpg)'
- en: Figure 19-14. PNP's calendar function
  id: totrans-1122
  prefs: []
  type: TYPE_NORMAL
  zh: 图19-14. PNP的日历功能
- en: In order to display a specific service directly, just add the detail **`svc=`****``*`servicename`*``**
    to the URL, so that you have [http://nagiosserver/nagios/pnp/index.php?host=hostname&svc=servicename](http://nagiosserver/nagios/pnp/index.php?host=hostname&svc=servicename).
  id: totrans-1123
  prefs: []
  type: TYPE_NORMAL
  zh: 为了直接显示特定的服务，只需将详细资料**`svc=`****``*`servicename`*``**添加到URL中，这样您就有[http://nagiosserver/nagios/pnp/index.php?host=hostname&svc=servicename](http://nagiosserver/nagios/pnp/index.php?host=hostname&svc=servicename)。
- en: 'A particular feature of PNP is that each graphic can be addressed directly,
    without using HTML or PHP pages. You require the two optional parameters **`display`**
    and **`view`**: [http://nagiosserver/nagios/pnp/index.php?host=host&svc=servicename&display=image&view=0](http://nagiosserver/nagios/pnp/index.php?host=host&svc=servicename&display=image&view=0).
    **`display`** can currently handle only the value **`image`**, and for **`view`**
    you enter the index defined in **`config.php`**: **`view=0`** refers to the time
    period that was defined there with **`$views [0] ["start"]`** (so this is the
    default, with a four-hour overview).'
  id: totrans-1124
  prefs: []
  type: TYPE_NORMAL
  zh: PNP的一个特定功能是每个图形都可以直接访问，而无需使用HTML或PHP页面。您需要两个可选参数**`display`**和**`view`**：[http://nagiosserver/nagios/pnp/index.php?host=host&svc=servicename&display=image&view=0](http://nagiosserver/nagios/pnp/index.php?host=host&svc=servicename&display=image&view=0)。**`display`**目前只能处理值**`image`**，而对于**`view`**，您输入在**`config.php`**中定义的索引：**`view=0`**指的是在那里用**`$views
    [0] ["start"]`**定义的时间周期（因此这是默认值，具有四小时概述）。
- en: Integrating PNP into the Nagios Web interface
  id: totrans-1125
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 将PNP集成到Nagios Web界面
- en: 'To display a single service directly from the Nagios Web interface, in Nagios
    3 you need to integrate the following URL as **`action_url`** in the service definition:'
  id: totrans-1126
  prefs: []
  type: TYPE_NORMAL
  zh: 要在Nagios 3中直接从Nagios Web界面显示单个服务，您需要在服务定义中集成以下URL作为**`action_url`**：
- en: '[PRE146]'
  id: totrans-1127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE146]'
- en: 'In Nagios 2.x you require the object **`serviceextinfo`** to achieve the same
    purpose:'
  id: totrans-1128
  prefs: []
  type: TYPE_NORMAL
  zh: 在Nagios 2.x中，你需要对象**`serviceextinfo`**来实现相同的目的：
- en: '[PRE147]'
  id: totrans-1129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE147]'
- en: 19.6.4 Bulk processing of performance data
  id: totrans-1130
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.6.4 批量处理性能数据
- en: The standard configuration discussed calls the command defined in **`service_perfdata_command`**
    for each check. Since the embedded Perl interpreter ePN (see [Appendix G](../Text/apg.html
    "Appendix G. The Embedded Perl Interpreter") in page 669) cannot execute **`process_perf-data.pl`**,
    Nagios has to restart the Perl interpreter for every service whose performance
    data is to be processed. This takes a toll on resources and, depending on the
    capabilities of the host and the number of services to be processed, has a negative
    influence on the performance of Nagios (to measure Nagios performance, see [Appendix F](../Text/apf.html
    "Appendix F. Tips on Optimizing Performance") from page 653). Nagios then really
    is brought to its knees, which means that the latency time that passes between
    the planned starting point and the actual start of a check increases considerably,
    and Nagios's timetable (the *scheduling*) gets out of control.
  id: totrans-1131
  prefs: []
  type: TYPE_NORMAL
  zh: 讨论的常规配置调用每个检查中定义的**`service_perfdata_command`**命令。由于嵌入的Perl解释器ePN（见第669页的[附录G](../Text/apg.html
    "附录G. 嵌入式Perl解释器")）无法执行**`process_perf-data.pl`**，Nagios必须为每个需要处理性能数据的服务的Perl解释器重新启动。这消耗了资源，并且根据主机的能力和要处理的服务数量，对Nagios的性能产生负面影响（要测量Nagios性能，请参阅第653页的[附录F](../Text/apf.html
    "附录F. 优化性能的技巧")）。因此，Nagios实际上是被逼到了绝境，这意味着从计划开始点到实际开始检查之间的延迟时间大大增加，Nagios的时间表（即*调度*）失控。
- en: One solution to this is offered by PNP's bulk mode in combination with the *Nagios
    Performance Data C Daemon* (NPCD).^([[220](#ftn.CHP-19-FN-28)]) When this is used,
    Nagios writes the performance data—formatted by templates (defined in **`service_perfdata_file_template`**)—to
    a file that is regularly renamed by a command in **`service_perfdata_file_processing_command`**.
    NPCD now runs the Perl script **`process_perfdata.pl`** only once for each file.
  id: totrans-1132
  prefs: []
  type: TYPE_NORMAL
  zh: 由PNP的批量模式与*Nagios性能数据C守护进程*（NPCD）的组合提供了一种解决方案。^([[220](#ftn.CHP-19-FN-28)）当使用它时，Nagios将性能数据——由模板（在**`service_perfdata_file_template`**中定义）格式化——写入一个文件，该文件由**`service_perfdata_file_processing_command`**中的命令定期重命名。NPCD现在只为每个文件运行一次Perl脚本**`process_perfdata.pl`**。
- en: '**`service_perfdata_file_template`** defines the format in which the data is
    written to the file specified in **`service_perfdata_file`**:^([[221](#ftn.CHP-19-FN-29)])'
  id: totrans-1133
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_perfdata_file_template`**定义了将数据写入**`service_perfdata_file`**中指定的文件时的格式：^([[221](#ftn.CHP-19-FN-29)])'
- en: '[PRE148]'
  id: totrans-1134
  prefs: []
  type: TYPE_PRE
  zh: '[PRE148]'
- en: '**`service_perfdata_file_mode`** specifies how Nagios handles the file: The
    value **`a`** stands for *append*. Thus Nagios appends new results to an already
    existing file. Every 30 seconds (as specified in **`service_perfdata_file_processing_interval`**)
    the *File Processing Command* **`service-perfdata-npcd`** starts. It shifts the
    file, renames it, and adds the current times-tamp, using the Nagios macro **`$TIMET$`**:'
  id: totrans-1135
  prefs: []
  type: TYPE_NORMAL
  zh: '**`service_perfdata_file_mode`**指定Nagios如何处理文件：值**`a`**代表*追加*。因此，Nagios将新结果追加到已存在的文件中。每30秒（如**`service_perfdata_file_processing_interval`**中指定）启动*文件处理命令*
    **`service-perfdata-npcd`**。它移动文件，重命名它，并添加当前的时戳，使用Nagios宏**`$TIMET$`**：'
- en: '[PRE149]'
  id: totrans-1136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE149]'
- en: 'Renaming and shifting doesn''t use up any time. So Nagios can immediately resume
    its normal tasks and leave further processing of performance data to the external
    NPCD daemon. NPCD has its own configuration file, in **`npcd.cfg`**, which is
    copied during installation to the directory **`/etc/pnp`**:'
  id: totrans-1137
  prefs: []
  type: TYPE_NORMAL
  zh: 重命名和移动不会消耗任何时间。因此，Nagios可以立即恢复其正常任务，并将性能数据的进一步处理留给外部NPCD守护进程。NPCD有自己的配置文件，在**`npcd.cfg`**中，安装期间被复制到目录**`/etc/pnp`**：
- en: '[PRE150]'
  id: totrans-1138
  prefs: []
  type: TYPE_PRE
  zh: '[PRE150]'
- en: The first two entries specify with which user and which group membership NPCD
    is to be started. The daemon can currently only log its work in the syslog. Future
    versions should also allow this to be written to a separate file. **`log_level=0`**
    ensures that NPCD itself behaves quietly and passes on all errors only to the
    syslog daemon.
  id: totrans-1139
  prefs: []
  type: TYPE_NORMAL
  zh: 前两个条目指定NPCD应以哪个用户和哪个组成员身份启动。守护进程目前只能将其工作记录在syslog中。未来的版本也应该允许将其写入单独的文件。**`log_level=0`**确保NPCD本身保持安静，并将所有错误仅传递给syslog守护进程。
- en: The parameter **`perfdata_spool_dir`** renames the directory to be monitored.
    It must already exist; the NPCD does not create it automatically. Thanks to the
    argument **`-b`** given in **`perfdata_file_run_cmd_args, process_perfdata.pl`**
    starts in bulk mode.
  id: totrans-1140
  prefs: []
  type: TYPE_NORMAL
  zh: 参数**`perfdata_spool_dir`**将监控的目录重命名。它必须已经存在；NPCD不会自动创建它。由于在**`perfdata_file_run_cmd_args,
    process_perfdata.pl`**中给出了参数**`-b`**，因此以批量模式启动。
- en: 'The NPCD installs itself during the **`"make install"`** command for PNP to
    the directory **`/usr/local/nagios/bin`**. Running **`make install-init`** causes
    an additional startup script to be placed in **`/etc/init.d`**, in which you have
    to check the path to the configuration file:'
  id: totrans-1141
  prefs: []
  type: TYPE_NORMAL
  zh: NPCD在PNP的**`"make install"`**命令期间将自己安装到目录**`/usr/local/nagios/bin`**。运行**`make
    install-init`**会在**`/etc/init.d`**中放置一个额外的启动脚本，您需要检查配置文件的路径：
- en: '[PRE151]'
  id: totrans-1142
  prefs: []
  type: TYPE_PRE
  zh: '[PRE151]'
- en: 'With the help of this, the daemon is started with the following command:'
  id: totrans-1143
  prefs: []
  type: TYPE_NORMAL
  zh: 通过以下命令启动守护进程：
- en: '[PRE152]'
  id: totrans-1144
  prefs: []
  type: TYPE_PRE
  zh: '[PRE152]'
- en: 'Depending on your distribution, the init script in the **`rc`** directories
    is linked to the relevant runlevel:'
  id: totrans-1145
  prefs: []
  type: TYPE_NORMAL
  zh: 根据您的发行版，**`rc`**目录中的初始化脚本链接到相关的运行级别：
- en: '[PRE153]'
  id: totrans-1146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE153]'
- en: 19.6.5 How should the graphic appear?
  id: totrans-1147
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 19.6.5 图形应该如何显示？
- en: The appearance of PNP graphics is determined by templates. The examples included
    are located in the directory **`/usr/local/nagios/share/pnp/templates.dist`**.
    You should not touch these, as they will be overwritten at the next update. The
    directory **`templates`** is intended for some templates. PNP takes the name of
    the check that was defined in the **`command_name`** and searches here for a matching
    template called **``*`command_name.php`*``**.
  id: totrans-1148
  prefs: []
  type: TYPE_NORMAL
  zh: PNP图形的外观由模板决定。包含的示例位于目录**`/usr/local/nagios/share/pnp/templates.dist`**中。您不应该修改这些文件，因为它们将在下一次更新时被覆盖。目录**`templates`**用于一些模板。PNP会取**`command_name`**中定义的检查名称，并在这里搜索一个名为**`*command_name.php`*``**的匹配模板。
- en: If PNP cannot find this either in **`./templates`** or in **`./templates.dist`**,
    it uses the default template **`default.php`**.
  id: totrans-1149
  prefs: []
  type: TYPE_NORMAL
  zh: 如果PNP既找不到**`./templates`**或**`./templates.dist`**中的这个文件，它将使用默认模板**`default.php`**。
- en: 'Sometimes there is already a suitable template in **`templates.dist`** (for
    example, **`check_ping.php`** for the plugin **`check_icmp`**), the name of which
    does not match the command name (in the case of **`check_icmp`**, we have defined
    this as **`command_name check_icmp`**). Then you must create a symlink in **`./templates`**
    to the desired file:'
  id: totrans-1150
  prefs: []
  type: TYPE_NORMAL
  zh: 有时在**`templates.dist`**中已经存在一个合适的模板（例如，**`check_ping.php`**用于插件**`check_icmp`**），其名称与命令名称不匹配（在**`check_icmp`**的情况下，我们将其定义为**`command_name
    check_icmp`**）。然后您必须在**`./templates`**中创建一个指向所需文件的符号链接：
- en: '[PRE154]'
  id: totrans-1151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE154]'
- en: 'A simple template which can be used for all plugins that transmit a simple
    response time is **`response.php`**:'
  id: totrans-1152
  prefs: []
  type: TYPE_NORMAL
  zh: 一个简单的模板，可以用于所有传输简单响应时间的插件是**`response.php`**：
- en: '[PRE155]'
  id: totrans-1153
  prefs: []
  type: TYPE_PRE
  zh: '[PRE155]'
- en: The variable **`$opt[1]`** defines the options for **`rrdtool`**, and the variable
    **`$def[1]`** defines the RRD graph. If you want to create your own templates,
    you will need to get involved with **`rrdtool`** in more detail. The definition
    of a graphic is explained in detail by **`man rrdgraph`**, and further information
    can be found on the homepage.^([[222](#ftn.CHP-19-FN-30)])
  id: totrans-1154
  prefs: []
  type: TYPE_NORMAL
  zh: 变量**`$opt[1]`**定义了**`rrdtool`**的选项，变量**`$def[1]`**定义了RRD图形。如果您想创建自己的模板，您需要更详细地了解**`rrdtool`**。图形的定义在**`man
    rrdgraph`**中有详细解释，更多信息可以在主页上找到.^([[222](#ftn.CHP-19-FN-30)])
- en: Custom Templates
  id: totrans-1155
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 自定义模板
- en: 'PNP is based on the name of the defined command object. If this is not informative
    enough, as in the case of **`command_name check_nrpe`**, then so-called *custom
    templates* in the directory **`/etc/pnp/check_commands`** are used. These must
    contain the name of the original command, however, which in our example is **`check_nt.cfg`**:'
  id: totrans-1156
  prefs: []
  type: TYPE_NORMAL
  zh: PNP基于定义的命令对象的名称。如果这不足以提供信息，例如在**`command_name check_nrpe`**的情况下，那么将使用目录**`/etc/pnp/check_commands`**中的所谓**自定义模板**。然而，这些模板必须包含原始命令的名称，在我们的例子中是**`check_nt.cfg`**：
- en: '[PRE156]'
  id: totrans-1157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE156]'
- en: 'If **`check_nt`** is not given **`MEMUSE`** as the first parameter, the actual
    command for the plugin **`check_nt`**, only this parameter will differentiate
    whether memory usage or CPU load, for instance, is measured. The parameter **`CUSTOM_TEMPLATE`**
    puts together the command that PNP uses when searching for templates: The example
    below puts together **`check_nt`** (entry number 0) and **`MEMUSE`** (entry number
    1). This means that PNP will search for a template with the name **`check_nt_MEMUSE.php`**.
    With **`CUSTOM_TEMPLATE = 1`**, PNP would search for **`MEMUSE.php`**. A suitable
    symlink is now set in the directory **`./templates`**:'
  id: totrans-1158
  prefs: []
  type: TYPE_NORMAL
  zh: 如果 **`check_nt`** 没有将 **`MEMUSE`** 作为第一个参数给出，那么插件 **`check_nt`** 的实际命令，只有这个参数才能区分是测量内存使用还是
    CPU 负载，例如。参数 **`CUSTOM_TEMPLATE`** 组合了 PNP 在搜索模板时使用的命令：下面的例子组合了 **`check_nt`**（条目编号
    0）和 **`MEMUSE`**（条目编号 1）。这意味着 PNP 将搜索名为 **`check_nt_MEMUSE.php`** 的模板。如果 **`CUSTOM_TEMPLATE
    = 1`**，PNP 将搜索 **`MEMUSE.php`**。现在在目录 **`./templates`** 中设置了一个合适的符号链接：
- en: '[PRE157]'
  id: totrans-1159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE157]'
- en: '* * *'
  id: totrans-1160
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[213](#CHP-19-FN-21)]) [http://www.pnp4nagios.org/pnp/](http://www.pnp4nagios.org/pnp/)
  id: totrans-1161
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[213](#CHP-19-FN-21)]) [http://www.pnp4nagios.org/pnp/](http://www.pnp4nagios.org/pnp/)
- en: ^([[214](#CHP-19-FN-22)]) [https://lists.sourceforge.net/mailman/listinfo/pnp4nagios-users](https://lists.sourceforge.net/mailman/listinfo/pnp4nagios-users)
    (generally on PNP usage) and [https://lists.sourceiorge.net/mailman/listinio/
    pnp4nagios-devel](https://lists.sourceiorge.net/mailman/listinio/%20pnp4nagios-devel)
    (feature requests, bugs, patches, and the like)
  id: totrans-1162
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[214](#CHP-19-FN-22)]) [https://lists.sourceforge.net/mailman/listinfo/pnp4nagios-users](https://lists.sourceforge.net/mailman/listinfo/pnp4nagios-users)（通常关于
    PNP 使用）和 [https://lists.sourceiorge.net/mailman/listinio/ pnp4nagios-devel](https://lists.sourceiorge.net/mailman/listinio/%20pnp4nagios-devel)（功能请求、错误、补丁等）
- en: ^([[215](#CHP-19-FN-23)]) [http://nagios-portal.de/forum/board.php?boardid=58](http://nagios-portal.de/forum/board.php?boardid=58)
  id: totrans-1163
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[215](#CHP-19-FN-23)]) [http://nagios-portal.de/forum/board.php?boardid=58](http://nagios-portal.de/forum/board.php?boardid=58)
- en: ^([[216](#CHP-19-FN-24)]) [http://www.rrdtool.org/](http://www.rrdtool.org/),
    see also [19.4.1 Installation](../Text/ch19s04.html#installation-id6 "19.4.1 Installation").
  id: totrans-1164
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[216](#CHP-19-FN-24)]) [http://www.rrdtool.org/](http://www.rrdtool.org/)，也参见
    [19.4.1 安装](../Text/ch19s04.html#installation-id6 "19.4.1 安装")。
- en: ^([[217](#CHP-19-FN-25)]) [http://www.pnp4nagios.org/pnp/](http://www.pnp4nagios.org/pnp/)
  id: totrans-1165
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[217](#CHP-19-FN-25)]) [http://www.pnp4nagios.org/pnp/](http://www.pnp4nagios.org/pnp/)
- en: ^([[218](#CHP-19-FN-26)]) Performance data is provided by the macro **`$SERVICEPERFDATA$`**;
    see [D.1.1 Host macros](../Text/apd.html#host_macros "D.1.1 Host macros").
  id: totrans-1166
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[218](#CHP-19-FN-26)]) 性能数据由宏 **`$SERVICEPERFDATA$`** 提供；参见 [D.1.1 主机宏](../Text/apd.html#host_macros
    "D.1.1 主机宏")。
- en: ^([[219](#CHP-19-FN-27)]) This has only been possible since Nagios 3.0, with
    the **`enable_environment_macros`** parameter (see [A.1 The Main Configuration
    File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    The Main Configuration File nagios.cfg")). More on environment variables in [D.1.8
    Using standard macros about the environment](../Text/apd.html#using_standard_macros_about_the_environm
    "D.1.8 Using standard macros about the environment") from page 631.
  id: totrans-1167
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[219](#CHP-19-FN-27)]) 这只有在 Nagios 3.0 之后才成为可能，因为有了 **`enable_environment_macros`**
    参数（参见 [A.1 主配置文件 nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 主配置文件 nagios.cfg")）。关于环境变量的更多信息，请参见第 631 页的 [D.1.8 关于环境的标准宏的使用](../Text/apd.html#using_standard_macros_about_the_environm
    "D.1.8 关于环境的标准宏的使用")。
- en: ^([[220](#CHP-19-FN-28)]) The C in the name alludes to the considerably faster
    performance speed of a C program compared to a Perl script, for which Nagios has
    to restart the Perl interpreter each time.
  id: totrans-1168
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[220](#CHP-19-FN-28)]) 名称中的 C 指的是与 Perl 脚本相比，C 程序的执行速度要快得多，因为 Nagios 每次都需要重新启动
    Perl 解释器。
- en: ^([[221](#CHP-19-FN-29)]) This is just a single line, which has been line-wrapped
    here for display purposes.
  id: totrans-1169
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[221](#CHP-19-FN-29)]) 这只是一行，这里为了显示目的进行了换行。
- en: ^([[222](#CHP-19-FN-30)]) [http://www.rrdtool.org/](http://www.rrdtool.org/)
  id: totrans-1170
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[222](#CHP-19-FN-30)]) [http://www.rrdtool.org/](http://www.rrdtool.org/)
- en: 19.7 Other Tools and the Limits of Graphic Evaluation
  id: totrans-1171
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 19.7 其他工具和图形评估的限制
- en: Apart from the tools introduced here, [http://www.nagiosexchange.org/](http://www.nagiosexchange.org/)
    provides further tools for the graphic evaluation of performance data. Many of
    these are also based on the RRDtools and round-robin databases, the consequence
    of which is that they are not much use for exact evaluations over several years,
    just like the ones described here.
  id: totrans-1172
  prefs: []
  type: TYPE_NORMAL
  zh: 除了这里介绍的工具之外，[http://www.nagiosexchange.org/](http://www.nagiosexchange.org/)
    还提供了用于性能数据图形评估的更多工具。其中许多也是基于 RRDtools 和循环冗余数据库，其结果是它们对于多年精确评估并不太有用，就像这里描述的那样。
- en: Several tools, such as the current APAN^([[223](#ftn.CHP-19-FN-31)]) version,
    save their data in an SQL database, thus enabling long-term statistics without
    data loss.
  id: totrans-1173
  prefs: []
  type: TYPE_NORMAL
  zh: 几个工具，如当前的APAN^([[223](#ftn.CHP-19-FN-31)]) 版本，将它们的数据保存在SQL数据库中，从而实现长期统计而不会丢失数据。
- en: PerfParse^([[224](#ftn.CHP-19-FN-32)]) is very extensive, and it stores data
    in a MySQL or PostgreSQL database and also includes its own wide range of evaluation
    tools. Because it uses various current libraries which are not included in every
    distribution, the installation hurdles are quite high. Nevertheless, those for
    whom the RRD-based tools do not offer enough should look to see if the PerfParse
    tools can provide the missing functionality that is required.
  id: totrans-1174
  prefs: []
  type: TYPE_NORMAL
  zh: PerfParse^([[224](#ftn.CHP-19-FN-32)]) 非常广泛，它将数据存储在MySQL或PostgreSQL数据库中，并包括其自己的广泛评估工具。因为它使用了各种当前库，而这些库并不包含在每个发行版中，所以安装障碍相当高。然而，对于那些RRD工具提供不足的人来说，应该看看PerfParse工具是否可以提供所需的功能。
- en: For all the options it offers, the graphical display of Nagios performance data
    also has its limits. If you check WAN connections with a ping to a remote host
    and measure the average response time, all the pretty graphics don't mean much
    if the check interval is only every five minutes. You will receive only a momentary
    snapshot every five minutes, which does not provide any serious clues to the traffic
    load of the connection over a period of time.
  id: totrans-1175
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管提供了所有这些选项，Nagios性能数据的图形显示也有其局限性。如果你通过ping远程主机来检查WAN连接并测量平均响应时间，如果检查间隔只有每五分钟一次，那么所有漂亮的图形都没有什么意义。你每五分钟只能收到一个瞬间的快照，这并不能提供任何关于连接在一段时间内流量负载的严重线索。
- en: To be able to sensibly assess the load of a Unix computer reported by a plugin
    every one, five, and 15 minutes, the check interval should be one minute. Less
    critical data are such things as used hard drive space or temperature. Equally
    noncritical is the display of network traffic, for which the plugin displays the
    values as a counter. RRD-based tools can automatically detect the difference between
    two measurements and display them; it makes no difference here whether the check
    interval is one, two, or five minutes; no data is lost.
  id: totrans-1176
  prefs: []
  type: TYPE_NORMAL
  zh: 要能够合理评估插件每分钟、五分钟和十五分钟报告的Unix计算机负载，检查间隔应该是一分钟。不那么关键的数据包括已使用的硬盘空间或温度。同样非关键的是网络流量的显示，插件以计数器的形式显示这些值。基于RRD的工具可以自动检测两次测量之间的差异并显示它们；检查间隔是一分钟、两分钟还是五分钟，这里都没有关系；没有数据丢失。
- en: If the measuring precision of Nagios leaves something to be desired, you can
    deploy other tools in parallel, such as Cricket^([[225](#ftn.CHP-19-FN-33)]) or
    Cacti.^([[226](#ftn.CHP-19-FN-34)]) If the external tool—like Munin^([[227](#ftn.CHP-19-FN-35)])
    —works with RRD databases, you can check these for critical values, so that they
    are included in the sophisticated Nagios notification system. Alternatively the
    external tool can provide an interface with which recorded data can be further
    processed. These can be passed on as a passive test result to Nagios, for example
    using NSCA (see [Chapter 14](../Text/ch14.html "Chapter 14. The Nagios Service
    Check Acceptor (NSCA)")).
  id: totrans-1177
  prefs: []
  type: TYPE_NORMAL
  zh: 如果Nagios的测量精度不尽如人意，你可以并行部署其他工具，例如Cricket^([[225](#ftn.CHP-19-FN-33)]) 或Cacti.^([[226](#ftn.CHP-19-FN-34)])。如果外部工具（如Munin^([[227](#ftn.CHP-19-FN-35)])）与RRD数据库一起工作，你可以检查这些关键值，以便它们包含在复杂的Nagios通知系统中。或者，外部工具可以提供一个接口，用于进一步处理记录的数据。这些可以作为被动测试结果传递给Nagios，例如使用NSCA（见[第14章](../Text/ch14.html
    "第14章。Nagios服务检查接受者（NSCA）")）。
- en: But an additional tool always has the disadvantage of adding to the configuration
    effort. Whether this is justified, or whether Nagios performance monitoring is
    sufficient, depends on the information required in a particular situation.
  id: totrans-1178
  prefs: []
  type: TYPE_NORMAL
  zh: 但额外的工具总是有增加配置努力的缺点。这是否合理，或者Nagios性能监控是否足够，取决于特定情况下所需的信息。
- en: '* * *'
  id: totrans-1179
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[223](#CHP-19-FN-31)]) [http://apan.sf.net/](http://apan.sf.net/).
  id: totrans-1180
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[223](#CHP-19-FN-31)]) [http://apan.sf.net/](http://apan.sf.net/)
- en: ^([[224](#CHP-19-FN-32)]) [http://perfparse.sf.net/](http://perfparse.sf.net/)
  id: totrans-1181
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[224](#CHP-19-FN-32)]) [http://perfparse.sf.net/](http://perfparse.sf.net/)
- en: ^([[225](#CHP-19-FN-33)]) [http://cricket.sourceforge.net/](http://cricket.sourceforge.net/)
  id: totrans-1182
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[225](#CHP-19-FN-33)]) [http://cricket.sourceforge.net/](http://cricket.sourceforge.net/)
- en: ^([[226](#CHP-19-FN-34)]) [http://www.cacti.net/](http://www.cacti.net/)
  id: totrans-1183
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[226](#CHP-19-FN-34)]) [http://www.cacti.net/](http://www.cacti.net/)
- en: ^([[227](#CHP-19-FN-35)]) [http://munin.projects.linpro.no/](http://munin.projects.linpro.no/)
  id: totrans-1184
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[227](#CHP-19-FN-35)]) [http://munin.projects.linpro.no/](http://munin.projects.linpro.no/)
