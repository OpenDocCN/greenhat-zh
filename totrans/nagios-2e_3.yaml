- en: Part III. The Web Interface and Other Ways to Visualize Nagios Data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Chapter 16. The Classical Web Interface
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: On the right is the navigation area with the unmistakable black background,
    and the remaining area is for displaying the CGI scripts called ([Figure 16-1](../Text/ch16.html#the_subitem_unhandled_under_both_the_se
    "Figure 16-1. The subitem Unhandled under both the Service Problems and Host Problems
    menu items has only been on the start page of the Nagios Web interface since Nagios
    3.0."))-the Nagios Web interface is that simple. The start screen provides access
    to the program documentation—extremely useful if you just want to look up something
    quickly.
  prefs: []
  type: TYPE_NORMAL
- en: 'Provided you have the correct access rights, the Web interface allows much
    more than just looking up information. You can run a series of commands and control
    Nagios actively: from setting a single command, to switching messages on and off,
    to restarting the server.'
  prefs: []
  type: TYPE_NORMAL
- en: A separate book would be needed to describe all the features completely. This
    is why we will just describe the concept here on which the CGI programs are based,^([[147](#ftn.CHP-16-FN-1)])
    in this way giving you a picture of the extensive range of options available.
  prefs: []
  type: TYPE_NORMAL
- en: Many functions use the very same CGI program. If you move the mouse up and down
    in the navigation area shown in [Figure 16-1](../Text/ch16.html#the_subitem_unhandled_under_both_the_se
    "Figure 16-1. The subitem Unhandled under both the Service Problems and Host Problems
    menu items has only been on the start page of the Nagios Web interface since Nagios
    3.0.") and observe the status display of the browser when doing this, which reveals
    the URLs to be called, you will see that in the **Monitoring** section up to the
    **Show Hosts:** entry field, the CGI program **`status.cgi`** is always called,
    with just four exceptions. Only the parameters are different. Things are similar
    for the CGI program **`cmd.cgi`**, with which general commands can be run. The
    parameters passed specify whether a comment is to be read, or a message enabled
    or disabled, or if Nagios is to be restarted.
  prefs: []
  type: TYPE_NORMAL
- en: '![The subitem Unhandled under both the Service Problems and Host Problems menu
    items has only been on the start page of the Nagios Web interface since Nagios
    3.0.](../Images/tagoreillycom20081104nostarchimages223844.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-1. The subitem Unhandled under both the Service Problems and Host
    Problems menu items has only been on the start page of the Nagios Web interface
    since Nagios 3.0.
  prefs: []
  type: TYPE_NORMAL
- en: Table 16-1. overview of CGI programs
  prefs: []
  type: TYPE_NORMAL
- en: '| CGI program | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| **`status.cgi`** | Status display in various forms; by far the most important
    CGI program ([Figure 16-10](../Text/ch16s02.html#the_overview_output_style "Figure 16-10. The
    overview output style") to [Figure 16-15](../Text/ch16s02.html#the_hostdetail_output_style
    "Figure 16-15. The hostdetail output style"), page 334.) |'
  prefs: []
  type: TYPE_TB
- en: '| **`statusmap.cgi`** | Topological representation of the monitored host (see
    [Figure 16-27](../Text/ch16s02.html#dependencies_of_monitored_hosts_shown_g "Figure 16-27. Dependencies
    of monitored hosts shown graphically"), page 347) |'
  prefs: []
  type: TYPE_TB
- en: '| **`statuswrl.cgi`** | Topological representation in 3D format; requires a
    VRML-capable browser and allows interactive navigation in a virtual space ([Figure 16-29](../Text/ch16s02.html#this_picture_marks_the_beginning_of_the
    "Figure 16-29. This picture marks the beginning of the tour through your own network"),
    page 349) |'
  prefs: []
  type: TYPE_TB
- en: '| **`statuswml.cgi`** | Simple status page for WAP devices (cellphone) |'
  prefs: []
  type: TYPE_TB
- en: '| extinfo.cgi | Additional information on a host or service, with the possibility
    of running commands ([Figure 16-4](../Text/ch16.html#extinfo.cgi_provides_additional_informa
    "Figure 16-4. extinfo.cgi provides additional information on the selected host"),
    page 331) |'
  prefs: []
  type: TYPE_TB
- en: '| cmd.cgi | Running commands ([Figure 16-23](../Text/ch16s02.html#disabling_a_service_check_with_cmd.c
    "Figure 16-23. Disabling a service check with cmd.cgi?cmd_typ=6"), page 343) |'
  prefs: []
  type: TYPE_TB
- en: '| tac.cgi | Overview of all services and hosts to be monitored, the **Tactical
    Overview** (see [Figure 16-26](../Text/ch16s02.html#tactical_overview_with_tac.cgi
    "Figure 16-26. Tactical overview with tac.cgi") in page 346) |'
  prefs: []
  type: TYPE_TB
- en: '| outages.cgi | Network nodes that cause the failure of partial networks ([Figure 16-30](../Text/ch16s02.html#as_long_as_sis-proxy_fails_comma_nagios
    "Figure 16-30. As long as sis-proxy fails, Nagios cannot reach any hosts lying
    behind it"), page 350) |'
  prefs: []
  type: TYPE_TB
- en: '| config.cgi | Display of Nagios object definitions ([Figure 16-31](../Text/ch16s02.html#config.cgi_displays_the
    "Figure 16-31. config.cgi displays the current configuration of the selected object
    class—here hosts—(extract)"), page 351) |'
  prefs: []
  type: TYPE_TB
- en: '| avail.cgi | Availability report (e.g., "98 percent of all systems OK, 2 percent
    WARNING", see [Figure 16-32](../Text/ch16s02.html#an_availability_report_using_the_exampl
    "Figure 16-32. An availability report using the example of the SAP-Services service
    group"), page 352) |'
  prefs: []
  type: TYPE_TB
- en: '| histogram.cgi | Histogram of the number of events occurring ([Figure 16-34](../Text/ch16s02.html#how_many_events_of_what_type_were_there
    "Figure 16-34. How many events of what type were there on which day?"), page 353)
    |'
  prefs: []
  type: TYPE_TB
- en: '| History.cgi | Display of all events that have ever occurred ([Figure 16-35](../Text/ch16s02.html#history.cgi_filters_the
    "Figure 16-35. history.cgi filters the information from the log file"), page 355)
    |'
  prefs: []
  type: TYPE_TB
- en: '| notifications.cgi | Overview of all sent notifications ([Figure 16-36](../Text/ch16s02.html#notifications.cgi_answer
    "Figure 16-36. notifications.cgi answers the question of who gets messages when,
    about what"), page 355) |'
  prefs: []
  type: TYPE_TB
- en: '| showlog.cgi | Display of all log file entries ([Figure 16-37](../Text/ch16s02.html#a_blue_button_marks_information_entries
    "Figure 16-37. A blue button marks information entries, the graph changing from
    red to green stands for Nagios restarts, and the icon marked GO with a green checked
    background represents restarts of the monitoring system"), page 356) |'
  prefs: []
  type: TYPE_TB
- en: '| summary.cgi | Report of events, which can be compiled by host, service, error
    category and time period ([Figure 16-39](../Text/ch16s02.html#an_individual_report_comma_as_generated
    "Figure 16-39. An individual report, as generated by summary.cgi"), page 358)
    |'
  prefs: []
  type: TYPE_TB
- en: '| trends.cgi | Time axis recording the states that have occurred ([Figure 16-40](../Text/ch16s02.html#trends.cgi_represents_th
    "Figure 16-40. trends.cgi represents the chronological sequence of states—here
    using the example of a service"), page 359) |'
  prefs: []
  type: TYPE_TB
- en: '[Table 16-1](../Text/ch16.html#overview_of_cgi_programs "Table 16-1. overview
    of CGI programs") shows an overview of all the CGI programs included in the package.
    They all check to see whether the person running the requested action is allowed
    to do so. Normally a user can only access the hosts and services for which he
    is entered as the contact. In addition there is the possibility of assigning specific
    users more comprehensive rights, so that they are basically allowed to display
    all hosts and services, for example, or to request system information. Settings
    for other users are made in the **`cgi.cfg`** configuration file, and the authentication
    parameters are described in [A.2 CGI Configuration in cgi.cfg](../Text/apas02.html
    "A.2 CGI Configuration in cgi.cfg"), page 606.'
  prefs: []
  type: TYPE_NORMAL
- en: 16.1 Recognizing and Acting On Problems
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A suitable starting point for the administrator is the **Service Problems**
    page, which can be reached through the menu item, shown in [Figure 16-2](../Text/ch16.html#the_menu_item_service_problems_brings_c
    "Figure 16-2. The menu item Service Problems brings current problems to attention").
    You can see all problems at a glance. If there is just a service-related problem,
    but not a host-related one, the host name in the **Host** column has a gray background,
    but a red background means the host itself is the source of the trouble.
  prefs: []
  type: TYPE_NORMAL
- en: '![The menu item Service Problems brings current problems to attention](../Images/tagoreillycom20081104nostarchimages223846.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-2. The menu item Service Problems brings current problems to attention
  prefs: []
  type: TYPE_NORMAL
- en: 'The hosts **`sis-mail`** and **`sis-proxy`**, which have failed in [Figure 16-2](../Text/ch16.html#the_menu_item_service_problems_brings_c
    "Figure 16-2. The menu item Service Problems brings current problems to attention"),
    can be seen again in the **Host Problems** menu item ([Figure 16-3](../Text/ch16.html#the_host_problems_menu_item_reveals_thi
    "Figure 16-3. The Host Problems menu item reveals this display")): **`sis-mail`**
    cannot be reached (UNREACHABLE), so the real problem therefore exists in the failure
    of the host **`sls-proxy`**. This dependency is illustrated in the **Outages**
    menu item ([Figure 16-30](../Text/ch16s02.html#as_long_as_sis-proxy_fails_comma_nagios
    "Figure 16-30. As long as sis-proxy fails, Nagios cannot reach any hosts lying
    behind it"), page 350) or the **Status Map** ([Figure 16-27](../Text/ch16s02.html#dependencies_of_monitored_hosts_shown_g
    "Figure 16-27. Dependencies of monitored hosts shown graphically"), page 347).
    In [Figure 16-27](../Text/ch16s02.html#dependencies_of_monitored_hosts_shown_g
    "Figure 16-27. Dependencies of monitored hosts shown graphically") the two failed
    hosts are shown with a red background, and you can also clearly see which host
    is dependent on the other (always from the point of view of the central Nagios
    host).'
  prefs: []
  type: TYPE_NORMAL
- en: '![The Host Problems menu item reveals this display](../Images/tagoreillycom20081104nostarchimages223848.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-3. The Host Problems menu item reveals this display
  prefs: []
  type: TYPE_NORMAL
- en: 16.1.1 Comments on problematic hosts
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The administrator clarifies the problem with the external office by telephone:
    the DSL connection has failed. He announces this failure to the provider responsible.
    To stop his colleagues from going to the same trouble again, the admin enters
    a corresponding comment on the failed host. To do this he clicks in the status
    display on the host name, which takes him to an information page for this specific
    host ([Figure 16-4](../Text/ch16.html#extinfo.cgi_provides_additional_informa
    "Figure 16-4. extinfo.cgi provides additional information on the selected host")),
    the options of which are described in more detail in [16.2.2 Additional information
    and control center: extinfo.cgi](../Text/ch16s02.html#additional_information_and_control_cent
    "16.2.2 Additional information and control center: extinfo.cgi"), page 339.'
  prefs: []
  type: TYPE_NORMAL
- en: '![extinfo.cgi provides additional information on the selected host](../Images/tagoreillycom20081104nostarchimages223850.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-4. `extinfo.cgi` provides additional information on the selected host
  prefs: []
  type: TYPE_NORMAL
- en: 'Using the **Add a new comment** link at the bottom of the page, the CGI program
    **`cmd.cgi`** ([16.2.3 Interface for external commands: cmd.cgi](../Text/ch16s02.html#interface_for_external_commands_colon_c
    "16.2.3 Interface for external commands: cmd.cgi"), page 343), which by passing
    on a corresponding parameter is already prepared for this task,^([[148](#ftn.CHP-16-FN-2)])
    allows a comment to be recorded ([Figure 16-5](../Text/ch16.html#entering_a_comment_for_a_host
    "Figure 16-5. Entering a comment for a host")). The host name is already shown,
    the check mark in the **Persistent** box ensures that the comments will also "survive"
    a Nagios restart. The user name filled out in the **Author (Your Name):** field
    can be edited, as can the actual comment in the **Comment** field.^([[149](#ftn.CHP-16-FN-3)])'
  prefs: []
  type: TYPE_NORMAL
- en: '![Entering a comment for a host](../Images/tagoreillycom20081104nostarchimages223852.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-5. Entering a comment for a host
  prefs: []
  type: TYPE_NORMAL
- en: The administrator confirms the entry with the **Commit** button. Returning to
    the status overview, for example with the **Service Problems** menu item, the
    administrator will see a speech bubble next to the host name, indicating that
    a comment exists for this host ([Figure 16-6](../Text/ch16.html#a_speech_bubble_displays_the_existence
    "Figure 16-6. A speech bubble displays the existence of comments")). Clicking
    on the icon opens the corresponding information page and takes the admin directly
    to the comment entries ([Figure 16-7](../Text/ch16.html#a_click_on_delete_all_comments_deletes
    "Figure 16-7. A click on Delete all comments deletes all comments at once")).
    Clicking on the icon of the trash can in the **Actions** column deletes these
    individually, if required.
  prefs: []
  type: TYPE_NORMAL
- en: '![A speech bubble displays the existence of comments](../Images/tagoreillycom20081104nostarchimages223854.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-6. A speech bubble displays the existence of comments
  prefs: []
  type: TYPE_NORMAL
- en: '![A click on Delete all comments deletes all comments at once](../Images/tagoreillycom20081104nostarchimages223856.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-7. A click on Delete all comments deletes all comments at once
  prefs: []
  type: TYPE_NORMAL
- en: 16.1.2 Taking responsibility for problems
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '*Acknowledgements* (so spelled on the Web interface) are oriented more closely
    to the workflow than simple comments. An acknowledgement signals to other administrators
    that somebody is already working on a problem, so nobody else needs to get involved
    with it for the time being. In the status overview, a small laborer icon symbolizes
    this form of taking responsibility ([Figure 16-8](../Text/ch16.html#a_laborer_icon_shows_that_an_admin_has
    "Figure 16-8. A laborer icon shows that an admin has already taken on responsibility
    for the problem (acknowledgement)")), and Nagios additionally notifies the relevant
    contacts.'
  prefs: []
  type: TYPE_NORMAL
- en: To issue such a statement, the link **Acknowledge this Host Problem** is used
    on the extended info page for the host in question. As well as the fields used
    for entering a normal comment, there are two checkboxes in this case, **Sticky
    Acknowledgement** ([Figure 16-9](../Text/ch16.html#entry_dialog_for_a_host_acknowlegement
    "Figure 16-9. Entry dialog for a host acknowlegement"))—if checked, this option
    prevents period notification if the error status persists—and **Send Notification**.
    If the latter is also checked, Nagios notifies the other administrators.
  prefs: []
  type: TYPE_NORMAL
- en: '![A laborer icon shows that an admin has already taken on responsibility for
    the problem (acknowledgement)](../Images/tagoreillycom20081104nostarchimages223858.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-8. A laborer icon shows that an admin has already taken on responsibility
    for the problem (acknowledgement)
  prefs: []
  type: TYPE_NORMAL
- en: '![Entry dialog for a host acknowlegement](../Images/tagoreillycom20081104nostarchimages223860.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-9. Entry dialog for a host acknowlegement
  prefs: []
  type: TYPE_NORMAL
- en: 'The effect of **Persistent Comment** is different in Nagios 2.x and Nagios
    3.0: In Nagios 2.x the comment is only preserved on a reboot if the checkbox has
    been marked. Unfortunately, using this to save comments in case of a reboot has
    the disadvantage that the comment does not disappear automatically when the problem
    has been solved. On the other hand, Nagios 3.0 normally retains all comments after
    a reboot. If the check mark for **Persistent Comment** is deleted, Nagios will
    remove the comment automatically as soon as the problem has been rectified. If
    the check mark is set, the comment must be removed manually if it is no longer
    needed, as in Nagios 2.x.'
  prefs: []
  type: TYPE_NORMAL
- en: What we are demonstrating here, using a faulty host state, can also be applied
    to faulty services. The CGI programs are the same, and through the passing of
    parameters they receive information on whether a host or service is involved,
    and react accordingly; only the host field receives company in the form of a **Service**
    entry.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: '^([[147](#CHP-16-FN-1)]) There is a good reason that we refer here to CGI programs
    and not to CGI scripts: all CGI programs for Nagios 2.x and 3.0 are C programs.'
  prefs: []
  type: TYPE_NORMAL
- en: '^([[148](#CHP-16-FN-2)]) **`cmd_type=1&host=sls-proxy`**. More on the parameters
    in [16.2.3 Interface for external commands: cmd.cgi](../Text/ch16s02.html#interface_for_external_commands_colon_c
    "16.2.3 Interface for external commands: cmd.cgi") following, page 343.'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[149](#CHP-16-FN-3)]) Starting with Nagios 3.0, amending the author name
    can be prevented by using the parameter **`lock_author_name`** (see [A.2.2 Other
    Parameters](../Text/apas02.html#other_parameters "A.2.2 Other Parameters")).
  prefs: []
  type: TYPE_NORMAL
- en: 16.2 An Overview of the Individual CGI Programs
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: At the time of going to press, this chapter was the most extensive documentation
    on the Nagios Web interface, especially for the individual CGI scripts. But for
    reasons of space, we shall not go into every detail. If you want to know more,
    you must take a look at the source code of the scripts or look at the **`nagios-users`**^([[150](#ftn.CHP-16-FN-4)])
    mailing list. Some of these are also read by the Nagios developers, and many a
    question is answered there for which there is currently no documentation.
  prefs: []
  type: TYPE_NORMAL
- en: '16.2.1 Variations in status display: **`status.cgi`**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'By far the most important CGI program, **`status.cgi`** is responsible for
    the status display. What it shows is determined by three parameter groups. The
    first one defines whether the Web page generated displays all hosts, a specific
    host, or a service group:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: With **`host`** you can select individual hosts, and **`all`** in this case
    stands for *all hosts*. **`hostgroup`** enables a specific host group to be displayed,
    and again you can use all to stand for *all host groups*. Finally, **`servicegroup`**
    tells the CGI program to display either the individual service group given as
    a value, or **`all service groups`**, given with **`all`**.
  prefs: []
  type: TYPE_NORMAL
- en: '![The overview output style](../Images/tagoreillycom20081104nostarchimages223862.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-10. The `overview` output style
  prefs: []
  type: TYPE_NORMAL
- en: The outputs of **`host=all`** and **`hostgroup=all`** are only different in
    their style, which is defined by the second parameter group. For **`host=all`**,
    **`style=detail`** is the default setting, and for **`hostgroup=all`**, it is
    **`style=overview.status.cgi?host=all&style=overview`** therefore delivers the
    same result as **`status.cgi?hostgroup=all`**.
  prefs: []
  type: TYPE_NORMAL
- en: 'Hosts that do not belong to a host group only appear in the detail view **`host=all&style=detail`**
    or **`hostgroup=all&style=hostdetail`**. All other display styles always show
    entire host groups from which individual hosts may be missing. **`status.cgi`**
    provides five possible output styles: **`overview`** represents the hosts in a
    table, but summarizes the services according to states ([Figure 16-10](../Text/ch16s02.html#the_overview_output_style
    "Figure 16-10. The overview output style")). For the host group **`SAP`**, you
    would call the corresponding display with the URL'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'The **`style`** value **`summary`** compresses the output of **`overview: status.cgi`**
    only displays one host group for each line ([Figure 16-11](../Text/ch16s02.html#the_summary_output_style_of_nagios_2.x
    "Figure 16-11. The summary output style of Nagios 2.x") shows this for Nagios
    2.x, [Figure 16-12](../Text/ch16s02.html#the_summary_output_style_of_nagios_3.0
    "Figure 16-12. The summary output style of Nagios 3.0") for Nagios 3.0). For Nagios
    3.0, error states are distinguished as **unhandled** (no acknowledgement set)
    or **acknowledged**.'
  prefs: []
  type: TYPE_NORMAL
- en: '![The summary output style of Nagios 2.x](../Images/tagoreillycom20081104nostarchimages223864.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-11. The ``*`summary`*`` output style of Nagios 2.x
  prefs: []
  type: TYPE_NORMAL
- en: '![The summary output style of Nagios 3.0](../Images/tagoreillycom20081104nostarchimages223866.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-12. The ``*`summary`*`` output style of Nagios 3.0
  prefs: []
  type: TYPE_NORMAL
- en: The **`grid`** style provides an extremely attractive summary in which you can
    see the status of each individual service by means of the color with which it
    is highlighted ([Figure 16-13](../Text/ch16s02.html#the_gridoutput_style "Figure 16-13. The
    grid output style")). **`detail`** shows each service in detail on a separate
    line. The **`hostdetail`** output style is limited just to host information, providing
    detailed information with one line for each host ([Figure 16-15](../Text/ch16s02.html#the_hostdetail_output_style
    "Figure 16-15. The hostdetail output style")).
  prefs: []
  type: TYPE_NORMAL
- en: '![The grid output style](../Images/tagoreillycom20081104nostarchimages223868.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-13. The `grid` output style
  prefs: []
  type: TYPE_NORMAL
- en: '![The detail output style](../Images/tagoreillycom20081104nostarchimages223870.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-14. The `detail` output style
  prefs: []
  type: TYPE_NORMAL
- en: '![The hostdetail output style](../Images/tagoreillycom20081104nostarchimages223872.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-15. The `hostdetail` output style
  prefs: []
  type: TYPE_NORMAL
- en: The third and final parameter group allows you to influence, through *selectors*,
    what states and what properties are shown by **`status.cgi`**, such as all services
    in an error state for which no acknowledgement has yet been set by an administrator
    (see [16.1.2 Taking responsibility for problems](../Text/ch16.html#taking_responsibility_for_problems
    "16.1.2 Taking responsibility for problems"), page 332). States are passed on
    with the **`hoststatustypes`** or **`servicestatustypes`** parameter, properties
    with **`hostprops`** and **`serviceprops`**. All four parameters demand numerical
    values after the equals sign, and these are summarized in [Table 16-2](../Text/ch16s02.html#possible_values_for_hoststatustypes
    "Table 16-2. Possible values for Hoststatustypes"), [Table 16-3](../Text/ch16s02.html#possible_values_for_servicestatus_type
    "Table 16-3. Possible values for Servicestatus types"), and [Table 16-4](../Text/ch16s02.html#possible_values_for_host_a
    "Table 16-4. Possible values for host and serviceprops").
  prefs: []
  type: TYPE_NORMAL
- en: Table 16-2. Possible values for `Hoststatustypes`
  prefs: []
  type: TYPE_NORMAL
- en: '| Value | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| 1 | PENDING (a result of the very first test planned for this host is not
    yet available) |'
  prefs: []
  type: TYPE_TB
- en: '| 2 | UP |'
  prefs: []
  type: TYPE_TB
- en: '| 4 | DOWN |'
  prefs: []
  type: TYPE_TB
- en: '| 8 | UNREACHABLE |'
  prefs: []
  type: TYPE_TB
- en: The third and final parameter group allows *selectors* to be used to influence
    what states and properties are displayed by **`status.cgi`**, fofr instance all
    services in an error state for which no administrator has yet set an acknowledgement
    (see [16.1.2 Taking responsibility for problems](../Text/ch16.html#taking_responsibility_for_problems
    "16.1.2 Taking responsibility for problems"), page 332). Conditions are passed
    with the parameter **`hoststatustypes`** or **`servicestatustypes`**, and properties
    with the **`hostprops`** and **`serviceprops`** parameters. All four parameters
    require numerical values after the equals sign, and these are summarized in [Table 16-2](../Text/ch16s02.html#possible_values_for_hoststatustypes
    "Table 16-2. Possible values for Hoststatustypes"), [Table 16-3](../Text/ch16s02.html#possible_values_for_servicestatus_type
    "Table 16-3. Possible values for Servicestatus types"), and [Table 16-4](../Text/ch16s02.html#possible_values_for_host_a
    "Table 16-4. Possible values for host and serviceprops").
  prefs: []
  type: TYPE_NORMAL
- en: Table 16-3. Possible values for `Servicestatus types`
  prefs: []
  type: TYPE_NORMAL
- en: '| Value | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| 1 | PENDING (Service was originally planned for a check, but so far no result
    is available) |'
  prefs: []
  type: TYPE_TB
- en: '| 2 | OK |'
  prefs: []
  type: TYPE_TB
- en: '| 4 | WARNING |'
  prefs: []
  type: TYPE_TB
- en: '| 8 | UNKNOWN |'
  prefs: []
  type: TYPE_TB
- en: '| 16 | CRITICAL |'
  prefs: []
  type: TYPE_TB
- en: Table 16-4. Possible values for `host` and `serviceprops`
  prefs: []
  type: TYPE_NORMAL
- en: '| Value | Description |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| 1 | Scheduled downtime (downtime planned) |'
  prefs: []
  type: TYPE_TB
- en: '| 2 | No Scheduled downtime (no downtime planned) |'
  prefs: []
  type: TYPE_TB
- en: '| 4 | Acknowledgement (status confirmed by the admin) |'
  prefs: []
  type: TYPE_TB
- en: '| 8 | No acknowledgement |'
  prefs: []
  type: TYPE_TB
- en: '| 16 | Host/Service check disabled |'
  prefs: []
  type: TYPE_TB
- en: '| 32 | Host/Service check enabled |'
  prefs: []
  type: TYPE_TB
- en: '| 64 | Event Handler disabled |'
  prefs: []
  type: TYPE_TB
- en: '| 128 | Event Handler enabled |'
  prefs: []
  type: TYPE_TB
- en: '| 256 | Flap Detection disabled |'
  prefs: []
  type: TYPE_TB
- en: '| 512 | Flap Detection enabled |'
  prefs: []
  type: TYPE_TB
- en: '| 1024 | Host/Service oscillates (flapping) |'
  prefs: []
  type: TYPE_TB
- en: '| 2048 | Host/Service does not oscillate |'
  prefs: []
  type: TYPE_TB
- en: '| 4096 | Hosts or services currently excluded from a notification |'
  prefs: []
  type: TYPE_TB
- en: '| 8192 | Notification enabled |'
  prefs: []
  type: TYPE_TB
- en: '| 16384 | Passive host/service checks disabled ([Chapter 13](../Text/ch13.html
    "Chapter 13. Passive Tests with the External Command File"), page 291) |'
  prefs: []
  type: TYPE_TB
- en: '| 32768 | Passive host/service checks enabled |'
  prefs: []
  type: TYPE_TB
- en: '| 65536 | Hosts/services for which there is at least one result determined
    for each passive test |'
  prefs: []
  type: TYPE_TB
- en: '| 131072 | Hosts/services for which there is at least one active check result
    |'
  prefs: []
  type: TYPE_TB
- en: '| 262144 | Hosts/services in the hard state (from Nagios 3.0) |'
  prefs: []
  type: TYPE_TB
- en: '| 524288 | Hosts/services in the soft state (from Nagios 3.0) |'
  prefs: []
  type: TYPE_TB
- en: 'If you want to query several states or properties simultaneously, you just
    add the specified values together: **`status.cgi?host=all&servicestatustypes=28`**
    shows all services with an error status: WARNING, UNKNOWN, and CRITICAL, that
    is, 4+8+16 = 28\. This query is identical to the **Service Problems** menu item
    in the navigation area.'
  prefs: []
  type: TYPE_NORMAL
- en: '**`status.cgi?hostgroup=all&hoststatustypes=12&style=hostdetail`** corresponds
    to the **Host Problems** menu item in the navigation area. It queries all hosts
    which are either DOWN or UNREACHABLE (here 4+8 = 12). Since only host information
    should be shown, but no service information, the output style is in the form of
    **`hostdetail`**.'
  prefs: []
  type: TYPE_NORMAL
- en: '**`status.cgi?host=all&servicestatustypes=24&serviceprops=10`** is the variation
    of the first example: only the states UNKNOWN and CRITICAL (8 + 16 = 24) are shown,
    and only those that neither show a planned downtime, nor have already been confirmed
    (2 + 8 = 10).'
  prefs: []
  type: TYPE_NORMAL
- en: The CGI program specifies the filter parameter each time in a separate checkbox.
    [Figure 16-16](../Text/ch16s02.html#this_information_box_shows_what_states "Figure 16-16. This
    information box shows what states and properties status.cgi should display") shows
    this for the third example.
  prefs: []
  type: TYPE_NORMAL
- en: '![This information box shows what states and properties status.cgi should display](../Images/tagoreillycom20081104nostarchimages223874.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-16. This information box shows what states and properties `status.cgi`
    should display
  prefs: []
  type: TYPE_NORMAL
- en: 'If you want, you can define your own navigation area to your own requirements
    or just use the existing one. The main page consists of one frame, and the navigation
    area itself is defined by a normal HTML file: **`/usr/local/nagios/share/side.html`**.^([[151](#ftn.CHP-16-FN-5)])'
  prefs: []
  type: TYPE_NORMAL
- en: One example of a changed **`side.html`** is provided on the Nagios Demo page^([[152](#ftn.CHP-16-FN-6)])
    at Netways;^([[153](#ftn.CHP-16-FN-7)]) another is the Nuvola style, shown in
    the figure in [16.6 Modern Layout with the Nuvola Style](../Text/ch16s06.html
    "16.6 Modern Layout with the Nuvola Style").
  prefs: []
  type: TYPE_NORMAL
- en: '16.2.2 Additional information and control center: **`extinfo.cgi`**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If called with the **`host`** or **`service`** parameter, **`extinfo.cgi`**
    not only provides detailed information on a specific host ([Figure 16-4](../Text/ch16.html#extinfo.cgi_provides_additional_informa
    "Figure 16-4. extinfo.cgi provides additional information on the selected host"),
    page 331) or service, it also serves as a control center for hosts and services
    (parameter **`hostgroup`**) and for service groups (**`servicegroup`**). Depending
    on the object class for which it is called, you can run various commands from
    here.
  prefs: []
  type: TYPE_NORMAL
- en: 'In the area on the left, the status of the host is extensively documented and
    in the box on the right—overwritten with **Host Commands**—there is a selection
    of commands that can be run. The latter commands call **`cmd.cgi`** ([16.2.3 Interface
    for external commands: cmd.cgi](../Text/ch16s02.html#interface_for_external_commands_colon_c
    "16.2.3 Interface for external commands: cmd.cgi"), page 343) and only function
    if the interface for external commands ([13.1 The Interface for External Commands](../Text/ch13.html#the_interface_for_external_commands
    "13.1 The Interface for External Commands"), page 292) is active. The lower area
    of the page allows you to enter object-specific comments, read them, and delete
    them again. The Web page that **`extinfo.cgi`** generates for services also follows
    this pattern.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Corresponding pages for service and host groups ([Figure 16-17](../Text/ch16s02.html#command_center_for_the_sap_host_group_c
    "Figure 16-17. Command center for the SAP host group: extinfo.cgi?type=5&hostgroup=SAP")),
    on the other hand, allow only group-specific commands to be run and do not show
    any additional information. Each command applies to the entire group, sparing
    you from a lot of mouse clicking. **Disabling notifications for all hosts in this
    hostgroup**, for example, ensures that Nagios does not send any more messages
    for hosts in this host group.'
  prefs: []
  type: TYPE_NORMAL
- en: '![Command center for the SAP host group: extinfo.cgi?type=5&hostgroup=SAP](../Images/tagoreillycom20081104nostarchimages223876.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 16-17. Command center for the `SAP` host group: `extinfo.cgi?type=5&hostgroup=SAP`'
  prefs: []
  type: TYPE_NORMAL
- en: Apart from hosts, services, and corresponding groups, the CGI program has other
    display functions, enabled by the CGI parameter **`type:`**
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'Depending on the value specified, further parameters are required, so to display
    the service you also have to include the host name and service designation:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`extinfo.cgi?type=0`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Shows information (such as starting time and process ID) for the Nagios process
    itself and all global parameters (normally notifications are sent, performance
    data processed, etc.; see [Figure 16-18](../Text/ch16s02.html#information_on_the_nagios_process_and_g
    "Figure 16-18. Information on the Nagios process and global settings: extinfo.cgi?type=0")).
    In the **Process Commands** box the global parameters can be changed, and Nagios
    can also be stopped and restarted.'
  prefs: []
  type: TYPE_NORMAL
- en: '![Information on the Nagios process and global settings: extinfo.cgi?type=0](../Images/tagoreillycom20081104nostarchimages223878.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 16-18. Information on the Nagios process and global settings: `extinfo.cgi?type=0`'
  prefs: []
  type: TYPE_NORMAL
- en: '**`extinfo.cgi?type=l&host=`****``*`host`*``**'
  prefs: []
  type: TYPE_NORMAL
- en: Shows commands and information on the **``*`host`*``** (see [Figure 16-4](../Text/ch16.html#extinfo.cgi_provides_additional_informa
    "Figure 16-4. extinfo.cgi provides additional information on the selected host"),
    page 331).
  prefs: []
  type: TYPE_NORMAL
- en: '**`extinfo.cgi?type=2&service=`****``*`service`*``**'
  prefs: []
  type: TYPE_NORMAL
- en: The same for the **``*`service`*``**.
  prefs: []
  type: TYPE_NORMAL
- en: '**`extinfo.cgi?type=3`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Shows all available host and service comments on a single page ([Figure 16-19](../Text/ch16s02.html#overview_of_all_existing_comments_colon
    "Figure 16-19. Overview of all existing comments: extinfo.cgi?type=3")).'
  prefs: []
  type: TYPE_NORMAL
- en: '![Overview of all existing comments: extinfo.cgi?type=3](../Images/tagoreillycom20081104nostarchimages223880.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 16-19. Overview of all existing comments: `extinfo.cgi?type=3`'
  prefs: []
  type: TYPE_NORMAL
- en: '**`extinfo.cgi?type=4`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Provides information on the performance of Nagios, separated according to host
    and service, as well as active and passive checks ([Figure 16-20](../Text/ch16s02.html#information_on_the_performance_colon_ex
    "Figure 16-20. Information on the performance: extinfo.cgi?type= 4")).'
  prefs: []
  type: TYPE_NORMAL
- en: '![Information on the performance: extinfo.cgi?type= 4](../Images/tagoreillycom20081104nostarchimages223882.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 16-20. Information on the performance: `extinfo.cgi?type= 4`'
  prefs: []
  type: TYPE_NORMAL
- en: The middle column reveals how many of the planned tests Nagios has already performed
    in the last 1, 5, 15, and 60 minutes. As long as there are checks for which **`normal_check_irLterval`**
    is more than five minutes, the first two values can never reach 100 percent.
  prefs: []
  type: TYPE_NORMAL
- en: 'The right-hand columns define the actual value for this page: **Check Execution
    Time** specifies the minimum, maximum, and average time which Nagios requires
    to perform active host and service checks. **Check Latency** measures the distance
    between the planned start and the actual running time of a test. If this delay
    is considerably larger than one or two seconds, Nagios probably has a performance
    problem. One possible cause is that the system is processing performance data
    too slowly, but low-performance hardware may also play a role here. Searching
    for the cause can sometimes turn out to be very difficult, and the original documentation^([[154](#ftn.CHP-16-FN-8)])
    provides a number of tips on the subject.'
  prefs: []
  type: TYPE_NORMAL
- en: '**`extinfo.cgi?type=5&hostgroup=`****``*`hostgroup`*``**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Shows command center for a host group ([Figure 16-17](../Text/ch16s02.html#command_center_for_the_sap_host_group_c
    "Figure 16-17. Command center for the SAP host group: extinfo.cgi?type=5&hostgroup=SAP")
    in page 339).'
  prefs: []
  type: TYPE_NORMAL
- en: '**`extinfo.cgi?type=6`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Shows all planned maintenance periods for hosts and services ([Figure 16-21](../Text/ch16s02.html#overview_of_all_planned_maintenance_per
    "Figure 16-21. Overview of all planned maintenance periods: extinfo.cgi?type=6")).'
  prefs: []
  type: TYPE_NORMAL
- en: '![Overview of all planned maintenance periods: extinfo.cgi?type=6](../Images/tagoreillycom20081104nostarchimages223884.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 16-21. Overview of all planned maintenance periods: `extinfo.cgi?type=6`'
  prefs: []
  type: TYPE_NORMAL
- en: '**`extinfo.cgi?type=7`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'Shows an overview of all planned tests, sorted by the next implementation time
    (see [Figure 16-22](../Text/ch16s02.html#all_planned_tests_comma_sorted_by_their
    "Figure 16-22. All planned tests, sorted by their planned implementation time:
    extinfo.cgi?type=7")). Next to this, **`extinfo.cgi`** also lists the time of
    the last check.'
  prefs: []
  type: TYPE_NORMAL
- en: The **Active Checks** column shows if the respective tests are active or not,
    and in the **`Actions`** column the planned check can be deleted or moved to a
    different time.
  prefs: []
  type: TYPE_NORMAL
- en: '**`extinfo.cgi?type=8&servicegroup`****``*`servicegroup`*``**'
  prefs: []
  type: TYPE_NORMAL
- en: Shows the command centre for a service group, identical in structure to the
    command center of a host group.
  prefs: []
  type: TYPE_NORMAL
- en: '![All planned tests, sorted by their planned implementation time: extinfo.cgi?type=7](../Images/tagoreillycom20081104nostarchimages223886.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 16-22. All planned tests, sorted by their planned implementation time:
    `extinfo.cgi?type=7`'
  prefs: []
  type: TYPE_NORMAL
- en: '16.2.3 Interface for external commands: **`cmd.cgi`**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As a real all-rounder, **`cgi.cmd`**, with some 100 functions, covers nearly
    all the possibilities that the interface provides for external commands. The **`cmd_typ`**
    parameter defines which of these the CGI program should run. The command
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: switches off active service checks for a specific service ([Figure 16-23](../Text/ch16s02.html#disabling_a_service_check_with_cmd.c
    "Figure 16-23. Disabling a service check with cmd.cgi?cmd_typ=6")). In order to
    describe the desired service uniquely, you must specify the host and service description.
    If you run the CGI program manually, the Web form shown queries these values,
    and if **`cmd.cgi`** is started by another CGI program, the required data is passed
    through CGI parameters. Possible parameters here are **`host`**, **`service`**,
    **`hostgroup`**, and **`servicegroup`**, which are followed by an equals (=) sign
    and then the appropriate Nagios object.
  prefs: []
  type: TYPE_NORMAL
- en: '![Disabling a service check with cmd.cgi?cmd_typ=6](../Images/tagoreillycom20081104nostarchimages223888.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-23. Disabling a service check with `cmd.cgi?cmd_typ=6`
  prefs: []
  type: TYPE_NORMAL
- en: '[Figure 16-24](../Text/ch16s02.html#the_most_important_host_and_service_rel
    "Figure 16-24. The most important host and service related codes for cmd.cgi?cmd_typ=")
    lists the most important commands which refer to a host or service, and [Figure 16-25](../Text/ch16s02.html#cmd.cgi_command_codes_fo
    "Figure 16-25. cmd.cgi command codes for global parameters") shows those that
    refer to the control of global parameters (corresponding to the values in the
    main configuration file **`nagios.cfg`**). The source code file **`include/common.h`**
    contains a complete list of all possible values, including ones that are planned
    but not yet implemented.'
  prefs: []
  type: TYPE_NORMAL
- en: 'The first column in [Figure 16-24](../Text/ch16s02.html#the_most_important_host_and_service_rel
    "Figure 16-24. The most important host and service related codes for cmd.cgi?cmd_typ=")
    and [Figure 16-25](../Text/ch16s02.html#cmd.cgi_command_codes_fo "Figure 16-25. cmd.cgi
    command codes for global parameters") describes the function of the command: **`ADD_HOST_COMMENT`**
    adds a comment to a host, and **`DISABLE_ ACTIVE_SVC_CHECK`** switches off active
    checks for a service (in abbreviated form: **`SVC`**).'
  prefs: []
  type: TYPE_NORMAL
- en: The columns after this specify the object type to which the respective function
    refers. To add a comment with **`ADD_HOST_COMMENT`**, you must specify the host
    in question. For this reason the function code **`1`** is shown in the Host column.
    A specific active service check can only be switched off if the matching service
    is named, so the function code **`6`** is to be found in the **Service** column.
    With **`16`** you switch off all active service checks on a host to be specified;
    there are also corresponding codes for all active service checks for a host or
    service group.
  prefs: []
  type: TYPE_NORMAL
- en: With **`ACKNOWLEDGE_PROBLEM`**, an administrator confirms that he is taking
    care of a specific problem. **`33`** (Host column) refers to a host problem, and
    **`34`** (**Service** column) to a service problem. The gray fields mean that
    there is no corresponding function for host and service groups. The Web form that
    opens with **`cmd_typ=33`** ([Figure 16-9](../Text/ch16.html#entry_dialog_for_a_host_acknowlegement
    "Figure 16-9. Entry dialog for a host acknowlegement"), page 333) then allows
    a comment to be entered.
  prefs: []
  type: TYPE_NORMAL
- en: '![The most important host and service related codes for cmd.cgi?cmd_typ=](../Images/tagoreillycom20081104nostarchimages223890.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-24. The most important host and service related codes for `cmd.cgi?cmd_typ=`
  prefs: []
  type: TYPE_NORMAL
- en: Functions that refer to global parameters ([Figure 16-25](../Text/ch16s02.html#cmd.cgi_command_codes_fo
    "Figure 16-25. cmd.cgi command codes for global parameters")) can normally only
    be switched on or off. So the value **`11`** in the **Start** column for **`NOTIFICATIONS`**
    means that this command code switches on all notifications globally, while **`12`**
    switches them off globally.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you are not quite certain whether the determined function does what you
    really wanted, it is best to run **`cmd.cgi`** manually with the corresponding
    function code, such as shown here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: The Web page generated in this way always has a small gray box available next
    to the required entry fields that explains the corresponding command ([Figure 16-23](../Text/ch16s02.html#disabling_a_service_check_with_cmd.c
    "Figure 16-23. Disabling a service check with cmd.cgi?cmd_typ=6"), on the right
    side of the page).
  prefs: []
  type: TYPE_NORMAL
- en: '![cmd.cgi command codes for global parameters](../Images/tagoreillycom20081104nostarchimages223892.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-25. `cmd.cgi` command codes for global parameters
  prefs: []
  type: TYPE_NORMAL
- en: '16.2.4 The most important things at a glance: **`tac.cgi`**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As a "tactical overview," **`tac.cgi`** provides a wealth of information on
    a single Web page, displayed in a summary ([Figure 16-26](../Text/ch16s02.html#tactical_overview_with_tac.cgi
    "Figure 16-26. Tactical overview with tac.cgi")). On the left-hand side of the
    page you can see, in order of priority, first the failure of entire network ranges
    (**Network Outages**), followed by the status of hosts and services, and at the
    bottom **`tac.cgi`** lists whether individual monitoring features such as notifications
    and event handlers are active.
  prefs: []
  type: TYPE_NORMAL
- en: Up to this final section, everything is concentrated on displaying problems.
    Provided everything is OK, the CGI merely shows the number of unproblematic services
    or hosts, highlighted in light gray (and announces **`47 Up`**, for example, in
    the **`Hosts`** box). In problem cases it distinguishes between open problems,
    which nobody has looked at yet (highlighted in red, e.g., **`2 Unhandled Problems`**
    for **`Services | Critical`**), and those for which an adminstrator has already
    taken responsibility through an acknowledgement (pink background, like **`1 Acknowledged`**
    for **Services | Unknown**). If host or service checks are disabled, these are
    also shown with a pink background, since they are problems that do not require
    the immediate attention of the admin (e.g., **`2 Disabled`** for **Services |
    Ok**).
  prefs: []
  type: TYPE_NORMAL
- en: Enabled features in the lower parts are marked by **`tac.cgi`** in green, and
    disabled ones, in red. The vertically written green **Enabled** in **Notifications**
    means that notifications are enabled globally, whereas the red background on the
    other hand, **`2 Services Disabled`**, means that they were explicitly switched
    off for two individual services.
  prefs: []
  type: TYPE_NORMAL
- en: For all the problems displayed you are taken to a single overview specifically
    showing the hosts and services in question.
  prefs: []
  type: TYPE_NORMAL
- en: '![Tactical overview with tac.cgi](../Images/tagoreillycom20081104nostarchimages223894.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-26. Tactical overview with `tac.cgi`
  prefs: []
  type: TYPE_NORMAL
- en: 'On the right-hand side of the page the upper box summarizes the **`extinfo.cgi?type=4`**
    (see [16.2.2 Additional information and control center: extinfo.cgi](../Text/ch16s02.html#additional_information_and_control_cent
    "16.2.2 Additional information and control center: extinfo.cgi")) Nagios performance
    data, which can be shown in detail. The bar graph beneath it shows the health
    of the entire network monitored as a percentage. If you move the mouse over one
    of the bars, you will also see the percentage as a number.'
  prefs: []
  type: TYPE_NORMAL
- en: '16.2.5 The topological map of the network: **`statusmap.cgi`**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**`statusmap.cgi`** ([Figure 16-27](../Text/ch16s02.html#dependencies_of_monitored_hosts_shown_g
    "Figure 16-27. Dependencies of monitored hosts shown graphically")) provides a
    view of the dependencies between the monitored hosts. Starting from the central
    Nagios server in the middle, lines connect all hosts that the server reaches directly—and
    whose host definitions do not need the **`parents`** parameter to be specified
    (see [2.3 Defining the Machines to Be Monitored, with host](../Text/ch02s03.html
    "2.3 Defining the Machines to Be Monitored, with host"), page 62.).'
  prefs: []
  type: TYPE_NORMAL
- en: The graphics also reveal the hosts to which Nagios has only indirect access
    through other hosts. So between **`sis-mail`** and the Nagios server in [Figure 16-27](../Text/ch16s02.html#dependencies_of_monitored_hosts_shown_g
    "Figure 16-27. Dependencies of monitored hosts shown graphically") lie the hosts
    **`sis-proxy`**, **`hspvip`**, and **`pfint. sis-proxy`**, as the comment **Down**
    and the red (instead of green) background suggest, has failed. Since **`sis-mail`**
    depends on this, it is in an UNREACHABLE state, which **`statusmap.cgi`** also
    marks with a red background.
  prefs: []
  type: TYPE_NORMAL
- en: '![Dependencies of monitored hosts shown graphically](../Images/tagoreillycom20081104nostarchimages223896.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-27. Dependencies of monitored hosts shown graphically
  prefs: []
  type: TYPE_NORMAL
- en: How Nagios arranges the hosts in the graphics is defined by the parameter **`default_statusmap_layout`**
    ([A.2.1 Authentication parameters](../Text/apas02.html#authentication_parameters
    "A.2.1 Authentication parameters")) in the configuration file **`cgi.cfg`**. The
    layout can also be changed with a selection window in the Web interface (at the
    top right in [Figure 16-28](../Text/ch16s02.html#statusmap_with_self-defined_coordinates
    "Figure 16-28. Statusmap with self-defined coordinates and icons")). The figure
    shows the demo system of Netways,^([[155](#ftn.CHP-16-FN-9)]) whose appearance
    depends on user-specific coordinates, which in this case you have to specify individually
    for each host (see [16.4.1 Extended host information](../Text/ch16s04.html#extended_host_information
    "16.4.1 Extended host information")). The question mark icon supplied by Nagios
    has been replaced with nicer pictures by the operator of the site. Coordinates
    and icons are defined with the **`hostextinfo`** object, described in more detail
    in [16.4.1 Extended host information](../Text/ch16s04.html#extended_host_information
    "16.4.1 Extended host information")).
  prefs: []
  type: TYPE_NORMAL
- en: '![Statusmap with self-defined coordinates and icons](../Images/tagoreillycom20081104nostarchimages223898.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-28. Statusmap with self-defined coordinates and icons
  prefs: []
  type: TYPE_NORMAL
- en: If you move the mouse onto a particular host, Nagios opens a yellow window at
    the top left with status information, which includes the IP address, current status
    information, and the time of the last check. At the bottom of this box, **`statusmap.cgi`**
    summarizes the states of the services running on this host.
  prefs: []
  type: TYPE_NORMAL
- en: If you double-click on a particular host, Nagios branches off to the usual status
    overview, which apart from data on the host selected, also displays all the services
    belonging to this host ([Figure 16-14](../Text/ch16s02.html#the_detail_output_style
    "Figure 16-14. The detail output style") in page 336 gives an example).
  prefs: []
  type: TYPE_NORMAL
- en: '16.2.6 Navigation in 3D: **`statuswrl.cgi`**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**`statuswrl.cgi`** allows Nagios to move through a 3D representation of the
    network plan ([Figure 16-29](../Text/ch16s02.html#this_picture_marks_the_beginning_of_the
    "Figure 16-29. This picture marks the beginning of the tour through your own network")).
    In this you can zoom on to hosts, move the overall view, rotate it, etc.'
  prefs: []
  type: TYPE_NORMAL
- en: A VRML-capable browser is necessary for the display.^([[156](#ftn.CHP-16-FN-10)])
    Although the original documentation^([[157](#ftn.CHP-16-FN-11)]) provides links
    to the corresponding plugins, two of them are out of date, and only *Cortona*^([[158](#ftn.CHP-16-FN-12)])
    could be reached at the time of going to press. This plugin does not work under
    Linux, however; in Windows it works with Internet Explorer, and also with Netscape,
    Mozilla, and Firefox.^([[159](#ftn.CHP-16-FN-13)]) A good overview of VRML software,
    organized according to operating system and browser, is provided by the National
    Institute of Standards and Technology (NIST) on its Web site.^([[160](#ftn.CHP-16-FN-14)])
  prefs: []
  type: TYPE_NORMAL
- en: 'Of the VRML plugins for Linux, *OpenVRML*,^([[161](#ftn.CHP-16-FN-15)]) and
    *free WRL*^([[162](#ftn.CHP-16-FN-16)]) are the most likely to be used. The standard
    Linux distributions usually do not include a finished package. OpenVRML is included
    in Fedora in Extras; on the homepage of freeWRL there are binary packages for
    Fedora and Ubuntu. You should not try compiling the software yourself unless you
    are an experienced system administrator or software developer: there are a large
    number of pitfalls. If you have never worked with the Java compiler before and
    have not compiled complex software packages such as Mozilla or Firefox yourself,
    then you should leave it alone.'
  prefs: []
  type: TYPE_NORMAL
- en: '![This picture marks the beginning of the tour through your own network](../Images/tagoreillycom20081104nostarchimages223900.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-29. This picture marks the beginning of the tour through your own
    network
  prefs: []
  type: TYPE_NORMAL
- en: But all of this is no reason to despair, since the use of 3D navigation is questionable
    anyway, especially as the 2D view of the normal status map displays all the information
    required, and displaying simple flat graphics in the browser takes up considerably
    less time than CPU-intensive 3D rendering. Before you rush into the adventure
    of compiling software yourself, we recommend that you decide for yourself, using
    the Cortona plugin, whether it is worth the effort of compiling a project like
    OpenVRML.
  prefs: []
  type: TYPE_NORMAL
- en: '16.2.7 Querying the status with a cell phone: **`statuswml.cgi`**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In order to make the information provided by Nagios accessible for WAP^([[163](#ftn.CHP-16-FN-17)])-capable
    devices without a fully functional browser, **`statuswml.cgi`** generates a Web
    page in the WML format,^([[164](#ftn.CHP-16-FN-18)]) which can be displayed with
    a cellphone—provided that the Nagios server is reachable in the Internet. Apart
    from the status query for hosts and services, it also allows the CGI program to
    switch off tests and notifications and to confirm existing problems with acknowledgements.
  prefs: []
  type: TYPE_NORMAL
- en: 'You should think carefully before you make Nagios accessible over the Internet:
    Nagios makes available much sensitive data that can be misused by hackers. In
    case of doubt, you''re better off doing without it. Without direct Internet access,
    **`statuswml.cgi`** is useless, since a cellphone cannot use protected access
    methods such as a VPN tunnel. This is why we shall not introduce **`statuswml.cgi`**
    in great detail at this point.'
  prefs: []
  type: TYPE_NORMAL
- en: '16.2.8 Analyzing disrupted partial networks: **`outages.cgi`**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The CGI program **`outages.cgi`** only shows those network nodes in a host
    overview that are responsible for the failure of a partial network: In contrast
    to a status overview, as in [Figure 16-15](../Text/ch16s02.html#the_hostdetail_output_style
    "Figure 16-15. The hostdetail output style"), page 336, **`outages.cgi`** specifies
    in the **# Hosts Affected** column how many services and hosts this affects in
    each case ([Figure 16-30](../Text/ch16s02.html#as_long_as_sis-proxy_fails_comma_nagios
    "Figure 16-30. As long as sis-proxy fails, Nagios cannot reach any hosts lying
    behind it")).'
  prefs: []
  type: TYPE_NORMAL
- en: '![As long as sis-proxy fails, Nagios cannot reach any hosts lying behind it](../Images/tagoreillycom20081104nostarchimages223902.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-30. As long as `sis-proxy` fails, Nagios cannot reach any hosts lying
    behind it
  prefs: []
  type: TYPE_NORMAL
- en: With the icons in the **Actions** column you call other CGI programs that selectively
    filter out information on the host shown here. From left to right, they show the
    status display in the detail view (traffic light), the topological network view
    (network tree), the 3D view (**3-D**), the trend display (graph), the log file
    entries for the host (spreadsheet), and the display of notifications which have
    been made (megaphone).
  prefs: []
  type: TYPE_NORMAL
- en: 16.2.9 Querying the object definition with **`config.cgi`**
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '**`config.cgi`** shows a tabular overview of the definition of all objects
    for a type that can be specified ([Figure 16-31](../Text/ch16s02.html#config.cgi_displays_the
    "Figure 16-31. config.cgi displays the current configuration of the selected object
    class—here hosts—(extract)"))—the type of object involved can be defined in the
    selection field in the top right corner. Where the consideration itself contains
    Nagios objects (in the host view **Host Check Command, Default Contact Group**,
    and—not visible in the picture—**Notification Period**), a link takes you directly
    to the configuration view of this object type.'
  prefs: []
  type: TYPE_NORMAL
- en: '![config.cgi displays the current configuration of the selected object class—here
    hosts—(extract)](../Images/tagoreillycom20081104nostarchimages223904.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-31. `config.cgi` displays the current configuration of the selected
    object class—here hosts—(extract)
  prefs: []
  type: TYPE_NORMAL
- en: The CGI program does not provide any way of changing anything in the settings.
    In addition, only users who are entered in the parameter **`authorized _for_configuration_information`**
    (configuration file **`cgi.cfg`**, p. 607) have access to this view.
  prefs: []
  type: TYPE_NORMAL
- en: '16.2.10 Availability statistics: **`avail.cgi`**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If you are monitoring systems, then you also take an interest in their availability.
    **`avail.cgi`** first asks if you are interested in **Hosts, Services, Host-groups**,
    and **Servicegroups**. After you have selected a time period, you will see an
    overview, as in [Figure 16-32](../Text/ch16s02.html#an_availability_report_using_the_exampl
    "Figure 16-32. An availability report using the example of the SAP-Services service
    group"). For **Services** and **Hosts** you can also have the availability data
    presented through **All Hosts** or **All Services** as a CSV file.
  prefs: []
  type: TYPE_NORMAL
- en: '**`avail.cgi`** shows the hosts involved separately from the services. How
    long a service or host remained in a particular state can be seen from the corresponding
    colored column—green for OK, yellow for WARNING, red for CRITICAL (service), DOWN
    and UNREACHABLE (host)—in percent. The column that shows how much time the status
    of a service was UNKNOWN is shown in orange. Incomplete log files are shown in
    the**Undetermined** column. If there is a value larger than zero, then there are
    periods for which Nagios cannot make a statement concerning the state.'
  prefs: []
  type: TYPE_NORMAL
- en: Below each table, the **Average** line specifies the average of the individual
    values. In [Figure 16-32](../Text/ch16s02.html#an_availability_report_using_the_exampl
    "Figure 16-32. An availability report using the example of the SAP-Services service
    group") the hosts involved were available 99.965 percent of the time.
  prefs: []
  type: TYPE_NORMAL
- en: '**`avail.cgi`** shows the availability twice in each case: first as an absolute
    value for the evaluation period, and then (in brackets) with respect to the time
    during which data actually was available. As long as the **Time Undetermined**
    column displays **`0.000%`**, the two availability values match.'
  prefs: []
  type: TYPE_NORMAL
- en: '![An availability report using the example of the SAP-Services service group](../Images/tagoreillycom20081104nostarchimages223906.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-32. An availability report using the example of the `SAP-Services`
    service group
  prefs: []
  type: TYPE_NORMAL
- en: If you click on one of the hosts or services displayed, a detailed view will
    appear. [Figure 16-33](../Text/ch16s02.html#the_availability_of_the_host "Figure 16-33. The
    availability of the host sap-12 explained in detail") shows such a view for the
    host **`sap-12`**.
  prefs: []
  type: TYPE_NORMAL
- en: '![The availability of the host sap-12 explained in detail](../Images/tagoreillycom20081104nostarchimages223908.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-33. The availability of the host `sap-12` explained in detail
  prefs: []
  type: TYPE_NORMAL
- en: On a bar diagram that shows the states over the selected period in color, there
    is detailed information on the host itself, followed by statistics on the availability
    of the service that is monitored on this host. This includes an extract from the
    log file, which only shows the relevant entries for the availability of the host;
    that is, **`HOST UP`**, **`HOST DOWN`**, or **`HOST UNREACHABLE`**. The log file
    entries are cut off by **`avail.cgi`** to save space.
  prefs: []
  type: TYPE_NORMAL
- en: 16.2.11 What events occur, how often?—**`histogram.Cgi`**
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If the state of a host or service changes, this is called an *event*. The CGI
    program **`histogram.cgi`** shows the frequency of this in different views. If
    you select **Day of the Month** as the **Breakdown type**, it illustrates what
    event took place on which day of the month, and how often ([Figure 16-34](../Text/ch16s02.html#how_many_events_of_what_type_were_there
    "Figure 16-34. How many events of what type were there on which day?")). The red
    graph in services stands for CRITICAL, the orange one for UNKNOWN, yellow for
    WARNING, and green for OK. The curve for hosts in the DOWN state is marked by
    **`histogram.cgi`** in red, that for UNREACHABLE hosts in wine-red, and the green
    line stands, as usual, for OK.
  prefs: []
  type: TYPE_NORMAL
- en: '![How many events of what type were there on which day?](../Images/tagoreillycom20081104nostarchimages223910.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-34. How many events of what type were there on which day?
  prefs: []
  type: TYPE_NORMAL
- en: If you choose the variation **Day of Week**, the Web page shows on which day
    of the week most events occur, so you can find out whether Monday really is always
    the worst day. In addition to this you can have the frequency presented by day
    (**Hour of Day**) or by the month of a year (**Month**). With **Report Period**
    you can adjust the report period. With **Assume state retention** you can adjust
    whether the previously existing states are retained and included in the evaluation
    (**`yes`**) or not (**`no`**).
  prefs: []
  type: TYPE_NORMAL
- en: If you have configured Nagios so that it explicitly logs the states of the monitored
    hosts and services for a restart or when the log file is changed,^([[165](#ftn.CHP-16-FN-19)])
    and if you set **`Initial states logged`** to **`yes`**, the script includes this
    explicitly in the evaluation. A **`no`** ignores the entry; **`histogram.cgi`**
    then assumes that the state after a system start is identical to that which existed
    directly before the restart.^([[166](#ftn.CHP-16-FN-20)])
  prefs: []
  type: TYPE_NORMAL
- en: '**Ignore repeated states** makes allowances if a state persists for a long
    time and therefore delivers the same result again and again. If you set yes here,
    the script evaluates it once instead of many times.'
  prefs: []
  type: TYPE_NORMAL
- en: If you select the item **Hard and soft states** in **State types to graph:**,
    **`histogram.cgi`** also counts soft states. If a service changes from OK to CRITICAL,
    for example, while **`retry_check_interval`** is set to **4**,^([[167](#ftn.CHP-16-FN-21)])
    then **`histogram.cgi`** counts a total of four results, three soft and one hard.
    If you only evaluate hard states, the statistics evaluate the value 1\. If an
    error is rectified, there are no soft states; therefore the value for CRITICAL
    is usually larger that that for RECOVERY if you include soft states in the evaluation.
  prefs: []
  type: TYPE_NORMAL
- en: '16.2.12 Filtering log entries after specific states: **`history.cgi`**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The **`history.cgi`** script allows the states of a type (soft or hard) to be
    extracted selectively from the log file using the selection field **State type
    options** (at the top right in [Figure 16-35](../Text/ch16s02.html#history.cgi_filters_the
    "Figure 16-35. history.cgi filters the information from the log file")), and specific
    events to be extracted (all, all related to hosts, all service events, only host-recovery,
    only host-down, etc.) using **History detail level for all hosts**. The entries
    to be shown can be restricted through parameters to individual hosts, services,
    or host or service groups when the CGI program is called. So the command
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'only displays log file entries for the host **`sap-12`**. If the output should
    be restricted to a specific host, then the service description needs to be specified
    as well:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'Selecting a host and service group is done in the same way:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: The period that **`history.cgi`** views depends on the archiving interval of
    the log file. The script always refers to the contents of an archive file. If
    you set the parameter **`log_rotation_method`** ([A.1 The Main Configuration File
    nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1 The
    Main Configuration File nagios.cfg")) in the configuration file **`nagios.cfg`**
    to **`d`** for daily archiving, the Web page presents the entries for one day.
    Using the arrows (at the top in [Figure 16-35](../Text/ch16s02.html#history.cgi_filters_the
    "Figure 16-35. history.cgi filters the information from the log file")) you can
    then scroll up and down through the days.
  prefs: []
  type: TYPE_NORMAL
- en: '![history.cgi filters the information from the log file](../Images/tagoreillycom20081104nostarchimages223912.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-35. `history.cgi` filters the information from the log file
  prefs: []
  type: TYPE_NORMAL
- en: 16.2.13 Who was told what, when?— **`notifications.Cgi`**
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Another filtered view of the log file is offered by **`notifications.cgi:`**
    It shows all sent messages. Here the view can aso be restricted to a specific
    message group, through the selection field at the top right in [Figure 16-36](../Text/ch16s02.html#notifications.cgi_answer
    "Figure 16-36. notifications.cgi answers the question of who gets messages when,
    about what"): to all notifications involving hosts, to all which are about services
    in a critical state, and so on.'
  prefs: []
  type: TYPE_NORMAL
- en: '![notifications.cgi answers the question of who gets messages when, about what](../Images/tagoreillycom20081104nostarchimages223914.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-36. `notifications.cgi` answers the question of who gets messages
    when, about what
  prefs: []
  type: TYPE_NORMAL
- en: 'If you just want to see messages here concerning particular hosts and services,
    you must again specify this with parameters when running the CGI program:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: Apart from **`host`** and **`service`**, you can also select a particular contact,
    but selecting host or service groups is not possible.
  prefs: []
  type: TYPE_NORMAL
- en: '16.2.14 Showing all log file entries: **`showlog.cgi`**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The CGI program **`showlog.cgi`** shows the log file as it is, with the few
    colored icons added to help you find your way: a red button marks critical service
    states or DOWN/UNREACHABLE hosts, a yellow button marks WARNINGs, and a green
    one, OK. Other buttons refer to information entries or Nagios restarts ([Figure 16-37](../Text/ch16s02.html#a_blue_button_marks_information_entries
    "Figure 16-37. A blue button marks information entries, the graph changing from
    red to green stands for Nagios restarts, and the icon marked GO with a green checked
    background represents restarts of the monitoring system")).'
  prefs: []
  type: TYPE_NORMAL
- en: 'You only have a single option here: the chronological order. Normally **`showlog.cgi`**
    shows the newest entries first. If you enable the check mark in **Older Entries
    First:** (top right), the oldest entries will be shown first.'
  prefs: []
  type: TYPE_NORMAL
- en: 'The period represented here also depends on the archiving method: if you archive
    once a day, you will obtain just one day for each Web page. To reach the entries
    for other days you must make your way through the individual archive files of
    the log file using the arrows at the top of the picture.'
  prefs: []
  type: TYPE_NORMAL
- en: '![A blue button marks information entries, the graph changing from red to green
    stands for Nagios restarts, and the icon marked GO with a green checked background
    represents restarts of the monitoring system](../Images/tagoreillycom20081104nostarchimages223916.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-37. A blue button marks information entries, the graph changing from
    red to green stands for Nagios restarts, and the icon marked GO with a green checked
    background represents restarts of the monitoring system
  prefs: []
  type: TYPE_NORMAL
- en: '16.2.15 Evaluating whatever you want: **`summary.cgi`**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If the display and selection options are introduced so far are not sufficient
    for you, you can create your own report with **`summary.cgi`**, which generates
    the selection dialog shown in [Figure 16-38](../Text/ch16s02.html#selection_template_for_parameters_in
    "Figure 16-38. Selection template for parameters in summary.cgi"). The upper section,
    **Standard Reports:**, provides a quick summary in which just one fixed report
    type can be selected. Clicking on the button directly below this generates the
    report.
  prefs: []
  type: TYPE_NORMAL
- en: The second section is more sophisticated. The field **Report Type:** with the
    report type **Most Recent Alerts** provides an individual listing of the last
    **`n`** of individual events. The number **`n`** is defined further down in the
    selection dialog in **Max List Items:**.^([[168](#ftn.CHP-16-FN-22)]) **Report
    Type:** can also be used to show all events individually on a separate line, with
    **Most Recent Alerts**, or you can have statistics displayed, for the number of
    events that have occurred overall, for each host group, etc., with **Alert Totals,
    Alert Totals by Hostgroups**, etc.
  prefs: []
  type: TYPE_NORMAL
- en: 'One particularly interesting report type is **Top Alert Producer**: such reports
    show in a hit list of who has caused most trouble during the report period.'
  prefs: []
  type: TYPE_NORMAL
- en: In **Report Period:** you can either choose the desired report period from predefined
    intervals (this week, the past seven days, this month, last week, last month,
    etc.), or you can specify **`CUSTOM REPORT PERIOD`** and define any period you
    choose. If you forget to specify **`CUSTOM REPORT PERIOD`** explicitly, the CGI
    program ignores the dates you have set and selects what is currently entered in
    **Report Period**.
  prefs: []
  type: TYPE_NORMAL
- en: '![Selection template for parameters in summary.cgi](../Images/tagoreillycom20081104nostarchimages223918.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-38. Selection template for parameters in `summary.cgi`
  prefs: []
  type: TYPE_NORMAL
- en: 'The details that follow the report period filter according to host, services
    or their groups, state types, and/or individual states (e.g., only services in
    a CRITICAL state). It is important to specify **Max List Items** at the end: **`summary.cgi`**
    always shows only as many entries as are specified here. The default is a little
    small; if you want all the entries in the selected period to be shown, you should
    enter **`0`** as the value. The largest value that can be given explicitly here
    is 999\. The **Create Summary Report!** button then generates the requested report
    ([Figure 16-39](../Text/ch16s02.html#an_individual_report_comma_as_generated "Figure 16-39. An
    individual report, as generated by summary.cgi")).'
  prefs: []
  type: TYPE_NORMAL
- en: 'The header of the report contains details of the report period and the selection
    made. The detail directly above the table is interesting: **Displaying most recent
    25 of 3721 total matching alerts** shows that the selection criteria matched a
    total of 3721 entries, but that the CGI script restricted the output to the 25
    most current entries, thanks to **Max List Items:**.'
  prefs: []
  type: TYPE_NORMAL
- en: '![An individual report, as generated by summary.cgi](../Images/tagoreillycom20081104nostarchimages223920.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-39. An individual report, as generated by `summary.cgi`
  prefs: []
  type: TYPE_NORMAL
- en: '16.2.16 Following states graphically over time: **`trends.Cgi`**'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: A rapid overview of what state occurred when for a particular host or service
    is provided by the graphic output of **`trends.cgi`** ([Figure 16-40](../Text/ch16s02.html#trends.cgi_represents_th
    "Figure 16-40. trends.cgi represents the chronological sequence of states—here
    using the example of a service")). After selecting a specific host or service,
    you can define a period, as with **`summary.cgi`**. The states are color-coded
    by **`trends.cgi`**, which makes the overview easier to follow.
  prefs: []
  type: TYPE_NORMAL
- en: The zoom function of the CGI program is an interesting detail. If you click
    in the colored area on a particular section, the selected area is enlarged or
    reduced in size by the zoom factor specified at the top right. Negative entries
    (**`−1, −2, −3`**, and **−4** are possible) expand the report period instead of
    reducing it.
  prefs: []
  type: TYPE_NORMAL
- en: '![trends.cgi represents the chronological sequence of states—here using the
    example of a service](../Images/tagoreillycom20081104nostarchimages223922.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-40. `trends.cgi` represents the chronological sequence of states—here
    using the example of a service
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[150](#CHP-16-FN-4)]) [http://lists.sourceforge.net/mailman/listinfo/nagios-users](http://lists.sourceforge.net/mailman/listinfo/nagios-users)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[151](#CHP-16-FN-5)]) If you have kept to the installation in this book.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[152](#CHP-16-FN-6)]) [http://nagios-demo.netways.de/](http://nagios-demo.netways.de/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[153](#CHP-16-FN-7)]) [http://www.netways.de/](http://www.netways.de/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[154](#CHP-16-FN-8)]) **`/usr/local/nagios/share/docs/tuning.html`**
  prefs: []
  type: TYPE_NORMAL
- en: ^([[155](#CHP-16-FN-9)]) [http://netways.de/Demosystem.1621.0.html](http://netways.de/Demosystem.1621.0.html)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[156](#CHP-16-FN-10)]) The *Virtual Reality Markup Language* (VRML), version
    2.0/1997, is used to describe the virtual "space."
  prefs: []
  type: TYPE_NORMAL
- en: ^([[157](#CHP-16-FN-11)]) **`/usr/local/nagios/share/docs/cgis.html#statuswrl_cgi`**
  prefs: []
  type: TYPE_NORMAL
- en: ^([[158](#CHP-16-FN-12)]) [http://www.parallelgrafics.com/products/cortona](http://www.parallelgrafics.com/products/cortona)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[159](#CHP-16-FN-13)]) For Firefox you have to install it manually, select
    **Custom** instead of **Typical** in the installation routine, and in **not supported
    browsers** specify the plugin directory of the browser.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[160](#CHP-16-FN-14)]) [http://cic.nist.gov/vrml/vbdetect.html](http://cic.nist.gov/vrml/vbdetect.html)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[161](#CHP-16-FN-15)]) [http://www.openvrml.org/](http://www.openvrml.org/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[162](#CHP-16-FN-16)]) [http://freewrl. sourcef orge. net/](http://freewrl.%20sourcef%20orge.%20net/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[163](#CHP-16-FN-17)]) *Wireless Access Protocol*.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[164](#CHP-16-FN-18)]) The *Wireless Markup Language* contains a part of
    HTML, heavily reduced in its functionality.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[165](#CHP-16-FN-19)]) Parameter **`log_initial_state`** in **`nagios.cfg;`**
    see page 597.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[166](#CHP-16-FN-20)]) The subtle difference here lies in **`retain_state_information`**
    (see [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")). If this parameter is set to 0,
    Nagios forgets the previous state. Without **`log_initial_state = yes`**, Nagios
    accepts an OK after the restart.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[167](#CHP-16-FN-21)]) Nagios thus repeats the test four times before it
    categorizes the state as "hard."
  prefs: []
  type: TYPE_NORMAL
- en: ^([[168](#CHP-16-FN-22)]) If the number of events in the report period is less
    than specified in **Max List Items:**, the report covers all the events that have
    happened during this period.
  prefs: []
  type: TYPE_NORMAL
- en: 16.3 Planning Downtimes
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'In every system environment maintenance work accumulates from time to time
    that the administrator can normally plan, so that users can be informed accordingly
    beforehand. Nagios refers to such maintenance windows as *Scheduled Downtime*;
    the administrator enters these either in the information page for the host or
    service generated by **`extinfo.cgi`** ([Figure 16-4](../Text/ch16.html#extinfo.cgi_provides_additional_informa
    "Figure 16-4. extinfo.cgi provides additional information on the selected host"),
    page 331) or for the corresponding host or service group ([Figure 16-17](../Text/ch16s02.html#command_center_for_the_sap_host_group_c
    "Figure 16-17. Command center for the SAP host group: extinfo.cgi?type=5&hostgroup=SAP"),
    page 339). In doing this, **`extinfo.cgi`** makes use of **`cmd.cgi`** ([16.2.3
    Interface for external commands: cmd.cgi](../Text/ch16s02.html#interface_for_external_commands_colon_c
    "16.2.3 Interface for external commands: cmd.cgi"), page 343), which can also
    be called selectively:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: opens the import template for maintenance times for a single host. The values
    for **`cmd_typ`** are summarized by [Figure 16-24](../Text/ch16s02.html#the_most_important_host_and_service_rel
    "Figure 16-24. The most important host and service related codes for cmd.cgi?cmd_typ=")
    in page 344.
  prefs: []
  type: TYPE_NORMAL
- en: A further method of recording maintenance periods is provided by addons, which,
    like the CGI programs, use the external command interface, but which can be automated,
    in contrast to the interactive Web interface. Such addons can also be found on
    the Nagios Exchange.^([[169](#ftn.CHP-16-FN-23)])
  prefs: []
  type: TYPE_NORMAL
- en: 'For scheduled downtimes, Nagios prevents notifications from being sent. This
    ensures that the administrator is not flooded with false alarms. When checks are
    made to see whether messages should be sent, a downtime is the third item in the
    list ([Figure 16-2](../Text/ch16.html#the_menu_item_service_problems_brings_c
    "Figure 16-2. The menu item Service Problems brings current problems to attention"),
    page 268). In addition, **`avail.cgi`** ([16.2.10 Availability statistics: avail.cgi](../Text/ch16s02.html#availability_statistics_colon_avail.cgi
    "16.2.10 Availability statistics: avail.cgi"), page 351.) takes account of the
    downtime when evaluating the availability of individual hosts and services, and
    assigns error states that occur during these times not as error states, but as
    OK.'
  prefs: []
  type: TYPE_NORMAL
- en: Maintenance periods can overlap. If one maintenance window lasts from 8:00 A.M.
    till 12:00 P.M., and a second one involving the same host or service, from 10:00
    A.M. to 2:00 P.M., then Nagios does not send any error messages between 8:00 A.M.
    and 2:00 P.M., and the whole period is also ignored in the availability statistics.
  prefs: []
  type: TYPE_NORMAL
- en: 16.3.1 Maintenance periods for hosts
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: What data is required to record the maintenance window can be explained quite
    clearly using the Web interface. [Figure 16-41](../Text/ch16s03.html#the_downtime_for_a_host_in_the_web_inte
    "Figure 16-41. The downtime for a host in the Web interface is recorded using
    this dialog") shows the input template for the downtime of a host (**`cmd.cgi?cmd_typ=55`**).
  prefs: []
  type: TYPE_NORMAL
- en: '![The downtime for a host in the Web interface is recorded using this dialog](../Images/tagoreillycom20081104nostarchimages223924.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-41. The downtime for a host in the Web interface is recorded using
    this dialog
  prefs: []
  type: TYPE_NORMAL
- en: The first line defines the host, and in the second line Nagios automatically
    enters the login with which you have logged in to the Web interface. In the input
    field after the **Comment:** keyword, you can describe the reason for the planned
    downtime. Specifying the trigger shows whether it was generated indirectly through
    another entry. When recording a new downtime, you should leave the value **N/A**
    (*not available*, that is, no trigger) as it is.
  prefs: []
  type: TYPE_NORMAL
- en: 'In the next four lines you have the option of entering two different downtime
    types: fixed ones (**Type: Fixed**) or variable periods (**Flexible**). The first
    has a fixed start and a fixed end. In this case Nagios ignores the period entry
    in hours and minutes in the **Flexible Duration:** fields completely.'
  prefs: []
  type: TYPE_NORMAL
- en: A flexible downtime starts when the first-ever event occurs in the period specified.
    From this point in time Nagios plans the downtime for the length of time that
    was specified here in hours and minutes. This may certainly exceed the end point
    specified in **End Time:**.
  prefs: []
  type: TYPE_NORMAL
- en: If further hosts are dependent on the computer specified in **Host Name:** (perhaps
    because a router is involved, which other host objects have entered as **parents**),
    you have the possibility of extending the downtime to all dependent hosts with
    the last item, **Child Hosts:. Schedule triggered downtime for all child hosts**
    passes on flexible downtimes to all "child hosts," **Schedule non-triggered downtime
    for all child hosts** does the same for fixed downtimes, and **Do nothing with
    child hosts** ignores dependencies, so that Nagios does not plan for any downtime
    for any hosts other than the one specified here.
  prefs: []
  type: TYPE_NORMAL
- en: 'How this hereditary behavior takes effect in [Figure 16-41](../Text/ch16s03.html#the_downtime_for_a_host_in_the_web_inte
    "Figure 16-41. The downtime for a host in the Web interface is recorded using
    this dialog") is shown by the overview of all scheduled downtimes in [Figure 16-21](../Text/ch16s02.html#overview_of_all_planned_maintenance_per
    "Figure 16-21. Overview of all planned maintenance periods: extinfo.cgi?type=6")
    in page 342\. The first line contains the downtime just described for the host
    **eli-saprouter** with the **Downtime ID** number **1**. Entries that are caused
    by inheriting this timeout contain the **Downtime ID** of the downtime causing
    them in the **Trigger ID** column: for **`sap-12`** this is **1**, since the maintenance
    of **`eli-saprouter`** also affects this host.'
  prefs: []
  type: TYPE_NORMAL
- en: Nagios simultaneously generates a comment entry when planning a downtime, which
    is automatically removed when this period has passed. This is why a speech bubble
    appears in the status display. During the downtime Nagios supplements this with
    a "snoring sign," which is meant to represent a sleep state ([Figure 16-42](../Text/ch16s03.html#the_snoring_sign_zzzzz_shows_that_the_d
    "Figure 16-42. The snoring sign zzzzz shows that the downtime for the host has
    begun")).
  prefs: []
  type: TYPE_NORMAL
- en: '![The snoring sign zzzzz shows that the downtime for the host has begun](../Images/tagoreillycom20081104nostarchimages223926.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-42. The snoring sign zzzzz shows that the downtime for the host has
    begun
  prefs: []
  type: TYPE_NORMAL
- en: 16.3.2 Downtime for services
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Downtimes for services differ from those for hosts in two small details. Apart
    from host name, the service description must be included, and the possibility
    of inheritance is excluded, since there are no corresponding dependencies for
    services.
  prefs: []
  type: TYPE_NORMAL
- en: 'A downtime for a host does not automatically apply to the services running
    on it. But since they are also not available if the host is down, it is recommended
    that you plan the same downtime for all dependent services. It can be quite strenuous
    to enter all the services individually. It is much easier to do this using a host
    group (**`cmd_typ=85`**), as shown in [Figure 16-43](../Text/ch16s03.html#one_downtime_for_all_services_of_a_host
    "Figure 16-43. One downtime for all services of a host group"). With this you
    can define the downtime for services in a specific host group with a single command,
    and much more as well: a check mark in **Schedule Downtime For Hosts Too** at
    the same time defines the same downtime for all hosts belonging to this group.^([[170](#ftn.CHP-16-FN-24)])'
  prefs: []
  type: TYPE_NORMAL
- en: '![One downtime for all services of a host group](../Images/tagoreillycom20081104nostarchimages223928.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-43. One downtime for all services of a host group
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[169](#CHP-16-FN-23)]) [http://www.nagiosexchange.org/Downtimes.38.0.html](http://www.nagiosexchange.org/Downtimes.38.0.html).
  prefs: []
  type: TYPE_NORMAL
- en: ^([[170](#CHP-16-FN-24)]) Up until (at least) Nagios version 3.0rc1, the check
    mark has no effect, however; there you have to enter the downtime of the hosts
    separately by running **`cmd.cgi?cmd_typ=84`** again.
  prefs: []
  type: TYPE_NORMAL
- en: 16.4 Additional Information on Hosts and Services
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'With the extended information for hosts and services, you can incorporate additional
    information in the Web interface and also brighten up its appearance somewhat,
    using suitable icons. Two separate objects hold this information in Nagios 2.x:
    **`hostextinfo`** and **`serviceextinfo`**. Starting with Nagios 3.0, the additional
    information is defined directly in the host and service objects. Although Nagios
    3.0 still evaluates the **`hostextinfo`** and **`serviceextinfo`** objects, it
    issues a warning message when checking the configuration and considers these objects
    to be obsolete.'
  prefs: []
  type: TYPE_NORMAL
- en: It is planned to leave these out of Nagios entirely, by version 4 at the latest.
    Those using Nagios 3.0 for the first time should specify the information introduced
    below directly in the host and service definitions and leave out **`hostextinfo`**
    and **`serviceextinfo`** right from the start. If you are changing from Nagios
    2.x to Nagios 3.0, you don't need to worry about this, and you can continue using
    existing instances of these objects.
  prefs: []
  type: TYPE_NORMAL
- en: To make this clearer, below we will use the terms **`hostextinfo`** and **`serviceextinfo`**
    object *information*. For Nagios 2.x, the term refers to the *object* of the same
    name, whereas for Nagios 3.0 it refers to the corresponding *details* given in
    the **`host`** and **`service`** objects. The parameters themselves are identical
    for Nagios 2.x and 3.0\. The object information only influences the Web interface
    and has no effect on the capabilities of Nagios.
  prefs: []
  type: TYPE_NORMAL
- en: 16.4.1 Extended host information
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Object information for hosts allow you to enhance the display of hosts in the
    Web interface through additional functions in the form of links and enhancement
    features in the form of icons and coordinates:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'The only obligatory parameter when these are defined is the specification of
    the host, with **`host_name`**; everything else is optional:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`host_name`**'
  prefs: []
  type: TYPE_NORMAL
- en: This is the name of the host object whose Web pages are to be expanded by the
    following properties.
  prefs: []
  type: TYPE_NORMAL
- en: '**`notes`**'
  prefs: []
  type: TYPE_NORMAL
- en: Use this for additional information that **`extinfo.cgi`** takes into account
    in its information pages. (The entry specified in the above example, **Samba Primary
    Domaincontroller**, can be found in [Figure 16-44](../Text/ch16s04.html#extinfo.cgi_also_shows_a
    "Figure 16-44. extinfo.cgi also shows an alternative text here for the Linux icon
    (beneath the Tux in brackets) and the additional information from the parameter
    notes (beneath the alternative text)") below the Linux icon.)
  prefs: []
  type: TYPE_NORMAL
- en: '![extinfo.cgi also shows an alternative text here for the Linux icon (beneath
    the Tux in brackets) and the additional information from the parameter notes (beneath
    the alternative text)](../Images/tagoreillycom20081104nostarchimages223930.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-44. `extinfo.cgi` also shows an alternative text here for the Linux
    icon (beneath the Tux in brackets) and the additional information from the parameter
    `notes` (beneath the alternative text)
  prefs: []
  type: TYPE_NORMAL
- en: '**`notes_url`**'
  prefs: []
  type: TYPE_NORMAL
- en: This is the URL of a (HTML) file with additional information on the host in
    question, to which you are linked by an icon in the form of a red, slightly opened
    manual, both in the status overview ([Figure 16-45](../Text/ch16s04.html#this_detail_view_shows_an_icon_each_for
    "Figure 16-45. This detail view shows an icon each for notes_url (open, read booklet)
    action_url (pink star), and icon_ image (here, Linux penguin)")) and in the info
    page generated by **`extinfo.cgi`** ([Figure 16-44](../Text/ch16s04.html#extinfo.cgi_also_shows_a
    "Figure 16-44. extinfo.cgi also shows an alternative text here for the Linux icon
    (beneath the Tux in brackets) and the additional information from the parameter
    notes (beneath the alternative text)")). If the documentation on the host involved
    is stored in the Intranet, then maintenance contracts, hotline numbers, system
    configuration, etc. are then just a mouse click away.
  prefs: []
  type: TYPE_NORMAL
- en: The parameter may contain an absolute path (from the view of the Web server)
    or a complete URL (**`http://.`**..).
  prefs: []
  type: TYPE_NORMAL
- en: '![This detail view shows an icon each for notes_url (open, read booklet) action_url
    (pink star), and icon_ image (here, Linux penguin)](../Images/tagoreillycom20081104nostarchimages223932.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 16-45. This detail view shows an icon each for `notes_url` (open, read
    booklet) `action_url` (pink star), and `icon_ image` (here, Linux penguin)
  prefs: []
  type: TYPE_NORMAL
- en: '**`action_url`**'
  prefs: []
  type: TYPE_NORMAL
- en: This is a link pointing to an action to be run for the host, which executes
    a CGI program such as **`cmd.cgi`**, for example, with just a mouse click. Since
    a link in the browser is always just a link, this does not have to be a command,
    and you can just as easily link another Web page. Both in the status overview
    ([Figure 16-45](../Text/ch16s04.html#this_detail_view_shows_an_icon_each_for "Figure 16-45. This
    detail view shows an icon each for notes_url (open, read booklet) action_url (pink
    star), and icon_ image (here, Linux penguin)")), and on the **`extinfo.cgi`**
    info page ([Figure 16-44](../Text/ch16s04.html#extinfo.cgi_also_shows_a "Figure 16-44. extinfo.cgi
    also shows an alternative text here for the Linux icon (beneath the Tux in brackets)
    and the additional information from the parameter notes (beneath the alternative
    text)")) it is hidden behind the pink star.
  prefs: []
  type: TYPE_NORMAL
- en: As a value, absolute paths from the view of the Web server or complete URLs
    can be used.
  prefs: []
  type: TYPE_NORMAL
- en: '**`icon_image`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'This is an icon to enhance the Web interface, but also to provide help: if
    you systematically use pictures here that represent the operating system (e.g.,
    the Tux for Linux, the Windows window for Microsoft operating systems, the Sun
    logo for Solaris computers, etc.), this helps you to keep an overview of the operating
    systems in the status view—especially if you have a large number of hosts ([Figure 16-45](../Text/ch16s04.html#this_detail_view_shows_an_icon_each_for
    "Figure 16-45. This detail view shows an icon each for notes_url (open, read booklet)
    action_url (pink star), and icon_ image (here, Linux penguin)")). **`extinfo.cgi`**
    also uses this icon ([Figure 16-44](../Text/ch16s04.html#extinfo.cgi_also_shows_a
    "Figure 16-44. extinfo.cgi also shows an alternative text here for the Linux icon
    (beneath the Tux in brackets) and the additional information from the parameter
    notes (beneath the alternative text)")).'
  prefs: []
  type: TYPE_NORMAL
- en: Icons should be approximately 40×40 pixels large and be available as a GIF,
    JPEG, or PNG file. If you specify a relative path (or none at all), then this
    begins with the directory **`/usr/local/nagios/share/images/logos/`**.^([[171](#ftn.CHP-16-FN-25)])
  prefs: []
  type: TYPE_NORMAL
- en: '**`icon_image_alt`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'This alternative text for the icon appears if the browser does not show a picture
    (for example for reading devices or output devices for Braille). From the icon
    and the icon text details, Nagios generates the following HTML code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: '**`vrml_image`**'
  prefs: []
  type: TYPE_NORMAL
- en: This is an image symbolizing the host in the 3D representation of **`statuswrl.cgi`**.
    Permissible formats are again GIF, JPEG, or PNG. You should avoid slides, since
    the image is placed on a cube, and the transparent parts in the 3D interface may
    lead to unexpected results.
  prefs: []
  type: TYPE_NORMAL
- en: '**`statusmap_image`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'This is the image with which **`statusmap.cgi`** (see [16.2.5 The topological
    map of the network: statusmap.cgi](../Text/ch16s02.html#the_topological_map_of_the_network_colo
    "16.2.5 The topological map of the network: statusmap.cgi"), page 346) symbolizes
    the host in its topological map. The Nagios demo page of Netways,^([[172](#ftn.CHP-16-FN-26)])
    ([Figure 16-28](../Text/ch16s02.html#statusmap_with_self-defined_coordinates "Figure 16-28. Statusmap
    with self-defined coordinates and icons") in page 348) shows a nice example.'
  prefs: []
  type: TYPE_NORMAL
- en: Although GIFs, JPEGs, and PNGs are allowed, it is better to use the GD2 format,
    because then Nagios requires less computer time to generate the status map. Using
    the program **`pngtogd2`**, which ought to be available as a component of the
    utilities for Thomas Boutells GD library in most Linux distributions, PNG files
    can be easily converted. Again the image size of 40×40 pixels is recommended.
  prefs: []
  type: TYPE_NORMAL
- en: '**`2d_coords`**'
  prefs: []
  type: TYPE_NORMAL
- en: This parameter specifies coordinates for a user-defined layout of the topological
    map. Details are given in pixels, with the origin, **`(0, 0), at the top left,
    and values must be positive:`** a positive x value counts the number of pixels
    from the origin to the right, a positive y value from the origin downwards.
  prefs: []
  type: TYPE_NORMAL
- en: '[Figure 16-28](../Text/ch16s02.html#statusmap_with_self-defined_coordinates
    "Figure 16-28. Statusmap with self-defined coordinates and icons") works with
    fixed coordinates for individual hosts. Nagios ignores **`2d_coords`** details
    if the status maps a different layout to the user-defined one.'
  prefs: []
  type: TYPE_NORMAL
- en: '**`3d_coords`**'
  prefs: []
  type: TYPE_NORMAL
- en: These are the coordinates for the 3D representation. Positive and negative floating-point
    numbers are allowed. **`(0.0,0.0,0.0)`** is used as the origin. In the start view,
    **`statuswrl.cgi`** scales the 3D image so that all existing hosts appear on the
    screen. Where the starting point lies on the screen can therefore not be predicted.
  prefs: []
  type: TYPE_NORMAL
- en: 'On The Nagios Exchange there is a wide range of finished icons in the category
    **Logos and Images**.^([[173](#ftn.CHP-16-FN-27)]) It is best to unpack these
    into separate subdirectories, and then the individual packages will not get in
    each other''s way:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: '**`imagepak-base.tar.gz`** contains a basic selection of icons, which can be
    supplemented as you please with other packages. The **`base`** subdirectory created,
    as with the object definition at the beginning of this chapter, must also be included.'
  prefs: []
  type: TYPE_NORMAL
- en: 16.4.2 Extended service information
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Extended service object information is more or less identical to the host equivalents,
    so that we will only mention the differences. In addition to the host name, the
    service description in **`service_description`** is obligatory, but the details
    on the 2D (status map) and 3D views are omitted:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: In contrast to extended host information, the status overview for this example
    only shows the printer icon specified in **`icon_image`**, but not the two icons
    defined in **`notes_url`** and **`action_url`** for the two links **`notes_url`**
    and **`action_url`**. They only appear in the page generated by **`extinfo.cgi`**
    with the same icons as for the extended host information ([Figure 16-44](../Text/ch16s04.html#extinfo.cgi_also_shows_a
    "Figure 16-44. extinfo.cgi also shows an alternative text here for the Linux icon
    (beneath the Tux in brackets) and the additional information from the parameter
    notes (beneath the alternative text)"), page 363).
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[171](#CHP-16-FN-25)]) If you have kept to the paths suggested in this book.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[172](#CHP-16-FN-26)]) [http://nagios-demo.netways.de/](http://nagios-demo.netways.de/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[173](#CHP-16-FN-27)]) [http://www.nagiosexchange.org/Image_Packs.75.0.html](http://www.nagiosexchange.org/Image_Packs.75.0.html)
  prefs: []
  type: TYPE_NORMAL
- en: '16.5 Configuration Changes through the Web Interfaces: the Restart Problem'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The CGI program **`cmd.cgi`** ([16.2.3 Interface for external commands: cmd.cgi](../Text/ch16s02.html#interface_for_external_commands_colon_c
    "16.2.3 Interface for external commands: cmd.cgi"), page 343) enables a series
    of changes to be made to the current configuration through the Web interface.^([[174](#ftn.CHP-16-FN-28)])
    In this way notifications or active checks can be switched on and off, for example.'
  prefs: []
  type: TYPE_NORMAL
- en: Nagios does not save such changes in the accompanying configuration file, but
    notes the the current status in a separately defined file, with the parameter
    **`state_retention_file in nagios.cfg`** (see [A.1 The Main Configuration File
    nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1 The
    Main Configuration File nagios.cfg")). But what happens if you restart Nagios
    after many changes using the Web interface?
  prefs: []
  type: TYPE_NORMAL
- en: Whether Nagios retains the interactive changes made after a restart or forgets
    them is dependent on the parameter **`retain_state_informationin`** the configuration
    file **`nagios.cfg`** ([A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")). The default **`0`** tells the
    system to forget interactive changes. For Nagios to remember this, you have to
    set
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: 'But this causes a new problem: settings made in the Web interface do not have
    priority over the details in the configuration files. If you change the **`active_checks_enabled`**
    parameter there for a service, a direction of the parameter in the configuration
    file is ignored, since the current, temporarily stored setting in the file defined
    with **`state_retention_file`** will always "win out." This behavior affects all
    parameters for external commands that can be changed in the interface, and therefore
    also via the CGI program **`cmd.cgi`**. The original documentation of Nagios^([[175](#ftn.CHP-16-FN-29)])
    labels these with a red star.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Two approaches provide a remedy in this case: on the one hand you can set the
    parameter **`retain_state_information`** to **`0`** shortly before a restart.
    Then Nagios forgets all the changes when it restarts and reads the configuration
    files in from scratch. This procedure is recommended only in exceptional cases,
    as in large environments it will hardly be possible to go through all the interactive
    changes in the configuration files. Alternatively you can get into the habit,
    whenever you make changes in the configuration file, of making them a second time
    in the Web interface. Although this means slightly more work, there is never a
    danger that current, and perhaps very important settings, will be lost.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Two additional parameters in the host and service definitions provide opportunities
    for fine-tuning:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: '**`retain_status_information`** specifies whether the current state of ahost
    or service should survive the Nagios restart: **`1`** means that the system temporarily
    stores the state, and **`0`**, that it forgets it. **`1`** is certainly the more
    sensible value for states, and you should depart from this only in cases that
    can be justified.'
  prefs: []
  type: TYPE_NORMAL
- en: '**`retain_nonstatus_information`**, on the other hand, refers to all information
    that describes *no* status. This includes, for example, whether active checks
    are switched on or off, whether passive checks are allowed or not, or whether
    admins are to be informed of status changes for this object. With a value of **`1`**,
    the system stores this information temporarily and uses it again after a restart,
    whereas with a value of **`0`**, Nagios forgets the current settings and reads
    the settings from the configuration file when it restarts.'
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[174](#CHP-16-FN-28)]) The CGI program makes use of the External Command
    File interface when doing this.
  prefs: []
  type: TYPE_NORMAL
- en: '^([[175](#CHP-16-FN-29)]) Nagios 2.x: **`/usr/local/nagios/share/docs/xodtemplate.html`**,
    Nagios 3.0: **`/usr/local/nagios/docs/objectdefinitions.html`**'
  prefs: []
  type: TYPE_NORMAL
- en: 16.6 Modern Layout with the Nuvola Style
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The classical view of the Nagios Web interface described so far uses only a
    few of the CGI configuration options. However, it is hardly possible to pack any
    more items into the navigation bar on the left, which has become somewhat amateurish
    in appearance. One solution to this is the Nuvola style, shown in [Figure 16-46](../Text/ch16s06.html#nagios_in_the_nuvola_style_colon_shown
    "Figure 16-46. Nagios in the Nuvola style: shown here are the Service Problems").'
  prefs: []
  type: TYPE_NORMAL
- en: 'The layout for the actual CGI program—this example shows a view of the service
    problems with u**`status.cgi`** on the right of the picture—is not only in color,
    but there are also new icons. On the left of the picture you can see the rather
    elegant navigation, spiced up with corresponding icons. The real highlight, though,
    is the use of a Javascript-based menu tree: The individual entries (such as the
    sections **Home, Monitoring, Reporting**, and **Configuration**) can be opened
    and closed via mouse click.'
  prefs: []
  type: TYPE_NORMAL
- en: '![Nagios in the Nuvola style: shown here are the Service Problems](../Images/tagoreillycom20081104nostarchimages223934.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 16-46. Nagios in the Nuvola style: shown here are the Service Problems'
  prefs: []
  type: TYPE_NORMAL
- en: Before installing the Nuvola style it is essential that you back up the directory
    **`/usr/local/nagios/share`** so that you can restore the old setup if you don't
    like the new one.
  prefs: []
  type: TYPE_NORMAL
- en: 'The current version 1.0.3 of Nuvola from NagiosExchange^([[176](#ftn.CHP-16-FN-30)])
    at the time of going to press is from September 2005, but it does work very well
    with Nagios 3.0 as well. The contents are unpacked into a suitable empty directory:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: 'The sources contain files (**`index.html, main.html`**) and directories (**`stylesheets,
    images`**) that already exist in Nagios, and they overwrite the originals during
    installation. In addition, the Nuvola style includes a new subdirectory, **`side`**,
    which contains the actual Javascript code for the tree navigation:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: The contents of the directory **`html`** are simply copied to **`/usr/local/share`**,
    for example, with **`rsync:`**
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: 'For the new navigation to appear, the file **`sidel.html`** must be installed.
    If you just rename it to **`side.html`**, though, the **`make install`** of a
    new Nagios version will just overwrite it again. So it is better to use a separate
    index file instead, such as **`index1.html`**, and run the Nagios Web interface
    from this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: To do this, you copy the **`index.html`** file included in Nuvola to the Nagios
    **`share`** directory with the name **`index1.html:`**
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: 'In the file **`index1.html`** you replace **`side.html`** with **`side1.html`**
    so that the Javascript navigation is called:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: 'If, like the author of this book, you consider it to be going over the top
    to change the styles of all the CGI programs, you can just pick out the improved
    navigation and supplement and redesign this as you think fit. Instead of making
    a complete copy of the directory **`html`**, you just select the files you require:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: You change the file **`index1.html`** as we have just shown and check the **`cgipath`**
    variable in **`config.js:`**
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: 'Nuvola uses a ready-made menu tree library, which is available in a commercial
    version called **`apytmenu`**,^([[177](#ftn.CHP-16-FN-31)]) which will not be
    discussed here, or in a free variation, dTree.^([[178](#ftn.CHP-16-FN-32)]) dTree
    is the default setting in **`config.js (treeType = ''dtree''`**) and is included
    in full. Configuration of the menu and trees is done in the file **`dtree_data.js`**
    in the directory **`side`**. The basic principle can be briefly explained using
    the **Home** menu as an example:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: The **`dTree`** function generates a new menu tree. Its parameter is a freely
    selectable identifier (in this case, **`general`**), which is used to reference
    the tree. **`general.header`** sets the title of the menu to **`Home`**. The function
    requires other parameters as well, including an icon (as shown).
  prefs: []
  type: TYPE_NORMAL
- en: 'The first **`general.add`** call anchors the tree still to be created. The
    first two parameters of the **`add`** function refer to the number of the node
    to be added, followed by its parent node. The topmost node is called **`0`**,
    and beneath this is the entry **`Documentation`**, to which the number **`1`**
    is assigned. If **`Documentation`** itself is to have subnodes, the invocations
    would be written as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs: []
  type: TYPE_PRE
- en: 'Finally **`document.write`** builds the entire menu tree. The **`header`**
    function has the following parameters:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE26]'
  prefs: []
  type: TYPE_PRE
- en: '**``*`title`*``**'
  prefs: []
  type: TYPE_NORMAL
- en: contains the heading and can also be set up as a URL. A mouse click on the heading
    opens the hyperlink specified.
  prefs: []
  type: TYPE_NORMAL
- en: '**``*`icon`*``**'
  prefs: []
  type: TYPE_NORMAL
- en: specifies the path to a small graphic that is displayed in front of the heading.
  prefs: []
  type: TYPE_NORMAL
- en: '**``*`height`*``**'
  prefs: []
  type: TYPE_NORMAL
- en: specifies the height of the background beneath the heading. Following this,
    the property of this background can be specified either as a background image,
    with **``*`backgroundimage`*``**, or as a color (**``*`background colorw`*``**).
  prefs: []
  type: TYPE_NORMAL
- en: Finally **``*`open`*``** specifies whether the menu tree should be open (**`1`**)
    or closed (**`0`**) at the start. Arguments specifying textual values are enclosed
    in single quotes, and numerical arguments are written directly, as shown in the
    examples.
  prefs: []
  type: TYPE_NORMAL
- en: 'The **`add`** function is invoked in a similar way:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs: []
  type: TYPE_PRE
- en: '**``*`id`*``** is the node number, and **``*`pid`*``** is the number of the
    node beneath which the entry should be integrated. **``*`name`*``** defines the
    name of the node in the menu, and **``*`url`*``** defines the hyperlink to be
    called. **``*`title`*``** and **``*`target`*``** optionally specify a page title
    and the target frame for displaying the page called via *url*. Both parameters
    normally remain empty here; the default for the target—correctly for Nagios—is
    the frame **`main`**.'
  prefs: []
  type: TYPE_NORMAL
- en: '**``*`icon`*``** defines the mini-graphic that is placed in front of the menu
    entry, and **``*`iconOpen`*``** optionally contains another icon that is used
    in its place when the menu entry is open. **``*`open`*``** again defines whether
    the entry should be opened (value **`1`**) or closed (value **`0`**) on starting,
    and **``*`css`*``** optionally allows an alternative CSS definition. For all optional
    parameters, the following applies: If they are at the end, they can be omitted,
    but if they are followed by other details, their omission must be marked by a
    pair of single quotation marks (**``*`''''`*``**).'
  prefs: []
  type: TYPE_NORMAL
- en: The included file **``*`dtree_data.js`*``** contains four extensive menus. If
    you have little experience with handling Javascript, it is best to save this template
    and adjust it in small steps. In case of error, information is very sparse and
    usually misleading, so it is particularly important that you note exactly what
    has been changed from one step to the next in order to be able to quickly isolate
    the error.
  prefs: []
  type: TYPE_NORMAL
- en: At this point we would like to mention the dTree homepage^([[179](#ftn.CHP-16-FN-33)])
    once again, which provides examples with extracts of code, along with a description
    of the programming interface.
  prefs: []
  type: TYPE_NORMAL
- en: Those who are not satisfied with the possibilities of the Nagios Web interface
    described in this chapter should take a look at NagVis ([Chapter 18](../Text/ch18.html
    "Chapter 18. NagVis") from page 389). The addon enables a freely definable interface
    and supplements the standard CGIs in an impressive manner. However, a prerequisite
    for NagVis is the installation of the database interface NDOUtils ([Chapter 17](../Text/ch17.html
    "Chapter 17. Flexible Web Interface with the NDOUtils") from page 375), which
    sets the installation hurdle slightly higher.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[176](#CHP-16-FN-30)]) [http://www.nagiosexchange.org/75;252](http://www.nagiosexchange.org/75;252)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[177](#CHP-16-FN-31)]) [http://dhtml-menu.com/](http://dhtml-menu.com/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[178](#CHP-16-FN-32)]) [http://www.destroydrop.com/javascripts/tree/](http://www.destroydrop.com/javascripts/tree/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[179](#CHP-16-FN-33)]) [http://www.destroydrop.com/javascripts/tree/](http://www.destroydrop.com/javascripts/tree/)
  prefs: []
  type: TYPE_NORMAL
- en: Chapter 17. Flexible Web Interface with the NDOUtils
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The Web interface of Nagios 2.x ansd 3.0, introduced in [Chapter 16](../Text/ch16.html
    "Chapter 16. The Classical Web Interface") from page 327, has a crucial disadvantage
    for large environments with hundreds of hosts: It cannot be scaled up. As long
    as you only observe error states and work intensively with acknowledges, you will
    manage fine with the CGI-based Web interface. But if you try to display several
    thousand services, you will have to be prepared to wait—it does not matter what
    their states are. Setting up the page can take a long time, and then practical
    work is hardly possible.'
  prefs: []
  type: TYPE_NORMAL
- en: Nagios extensions struggle with the CGI Web interface because this directly
    evaluates Nagios internals, such as object configuration, status data, and log
    files. This means that every extension that is used to supplement or replace the
    Web interface must follow this logic.
  prefs: []
  type: TYPE_NORMAL
- en: The solution to this is called NDOUtils (*Nagios Data Objects Utilities*). These
    consist of a handful of tools that write all data—from configuration through events
    and check results to historical records—to a database and make them available
    via a uniform database model.
  prefs: []
  type: TYPE_NORMAL
- en: The mechanism that connects the NDOUtils to Nagios is called *Nagios Event Broker*
    (NEB). This adds a modular interface to Nagios. The NEB loads the extensions as
    modules when Nagios starts so that the modules can be used without having to recompile
    Nagios. This approach is similar to that of the Apache modules, which are loaded
    when required and add new functions to the Web server.
  prefs: []
  type: TYPE_NORMAL
- en: The NDOUtils form the basis for the future Web interface of Nagios, implemented
    with PHP, which should see the light of day starting with Nagios 4.x. With NagVis
    (see [Chapter 18](../Text/ch18.html "Chapter 18. NagVis") from page 389), however,
    there is already an alternative Web interface that is based on the NDOUtils.
  prefs: []
  type: TYPE_NORMAL
- en: 17.1 The Event Broker
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The NEB provides an interface between Nagios and external modules based on
    shared libraries. An external, application-dependent module makes *callback functions*
    available. The Nagios kernel itself calls the accompanying callback function from
    the loaded module for every event: If there is no matching function, nothing happens.
    What actions the callback function executes is left to the imagination of the
    developer: Either it does something itself or it passes on configuration, status,
    and event data to an external application, as outlined in [Figure 17-1](../Text/ch17.html#an_external_application_communicates_wit
    "Figure 17-1. An external application communicates with a loaded NEB module").'
  prefs: []
  type: TYPE_NORMAL
- en: For the transfer of data to external tools, Unix sockets or network sockets
    can be used, although it is also possible to use the file system. The application
    further processes information (saves it in a database, for example, or sends it
    as messages via SNMP traps, writes it to the syslog, etc.).
  prefs: []
  type: TYPE_NORMAL
- en: '![An external application communicates with a loaded NEB module](../Images/tagoreillycom20081104nostarchimages223936.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 17-1. An external application communicates with a loaded NEB module
  prefs: []
  type: TYPE_NORMAL
- en: When a callback function is called, Nagios waits for it to finish. This means
    that long execution times hinder the system. For this reason callback functions
    should always leave time-consuming processing steps to an external application
    and be restricted to sending on the necessary information as quickly as possible.
  prefs: []
  type: TYPE_NORMAL
- en: Building event broker modules is something that should be left to experienced
    programmers; mere mortals must be content with using ready-made modules. An NEB
    module can be integrated via the instruction **`broker_module`** in the main configuration
    file **`nagios.cfg:`**
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE28]'
  prefs: []
  type: TYPE_PRE
- en: 'Whether you pass on arguments to the module or not depends on its concrete
    implementation. The parameter **`event_broker_options`** controls what information
    Nagios passes on to event broker modules. With the option **`−1`** it is all of
    them, while the value 0 prevents any information from being passed on. An alternate
    approach, of selectively passing on specific information, is provided by the file
    **`broker.h`** from the Nagios sources:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE29]'
  prefs: []
  type: TYPE_PRE
- en: Table 17-1. Data to be transferred to NagVis
  prefs: []
  type: TYPE_NORMAL
- en: '| Broker Option | Value | Explanation |'
  prefs: []
  type: TYPE_TB
- en: '| --- | --- | --- |'
  prefs: []
  type: TYPE_TB
- en: '| **`BROKER_PROGRAM_STATE`** | 1 | Is the program Nagios running |'
  prefs: []
  type: TYPE_TB
- en: '| **`BROKER_DOWNTIME_DATA`** | 512 | Details of planned maintenance periods
    |'
  prefs: []
  type: TYPE_TB
- en: '| **`BROKER_STATUS_DATA`** | 4096 | Current status information of all checks
    |'
  prefs: []
  type: TYPE_TB
- en: '| **`BROKER_RETENTION_DATA`** | 32768 | Data which is buffered for a restart
    of Nagios |'
  prefs: []
  type: TYPE_TB
- en: '| **`BROKER_ACKNOWLEDGEMENT_DATA`** | 65536 | Confirmations that have been
    made on error states of host and service checks |'
  prefs: []
  type: TYPE_TB
- en: 'NagVis 1.1, introduced in [Chapter 18](../Text/ch18.html "Chapter 18. NagVis"),
    requires the information listed in [Table 17-1](../Text/ch17.html#data_to_be_transferred_to_nagvis
    "Table 17-1. Data to be transferred to NagVis"). The corresponding numerical values
    add up to **`102913`**, so that **`event_broker_options`** can be modified as
    follows so that is tailor-made for NagVis:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE30]'
  prefs: []
  type: TYPE_PRE
- en: Information on the event broker is currently very sparse. The only descriptions
    of the interface are a quite old documentation from Nagios 2.0 and the *Nagios
    Event Broker API*^([[180](#ftn.CHP-17-FN-1)]).
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[180](#CHP-17-FN-1)]) [http://www.nagios.org/developerinfo](http://www.nagios.org/developerinfo)
  prefs: []
  type: TYPE_NORMAL
- en: 17.2 The Database Interface
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: As a concrete and practically-oriented application of the event broker concept,
    the Nagios data object utilities, or NDOUtils, save all configuration and event
    data to a database. In order to be able to make use of the database, further applications
    are required. For Nagios 4.x, this will in all probability be a newly designed,
    PHP-based Web interface. Whether this Nagios version will immediately manage all
    the configuration data in the database was still a matter of speculation at press
    time (when Nagios 3.0 was not quite finished).
  prefs: []
  type: TYPE_NORMAL
- en: For the database, the NDOUtils currently support only MySQL; the use of PostgreSQL
    is planned, but is not yet implemented in version 1.4, introduced here.
  prefs: []
  type: TYPE_NORMAL
- en: 'Since the NDOUtils addons provide a database interface that is relatively simple
    to use, it is expected that their use with Nagios 3.x will increase. NagVis (discussed
    in the next chapter from page 389) already provides a powerful NDO-based front
    end that in many cases can replace the status map, which remains relatively simple
    and is discussed in [16.2.5 The topological map of the network: statusmap.cgi](../Text/ch16s02.html#the_topological_map_of_the_network_colo
    "16.2.5 The topological map of the network: statusmap.cgi") from page 346.'
  prefs: []
  type: TYPE_NORMAL
- en: '[Figure 17-2](../Text/ch17s02.html#how_can_you_integrate_nagios_data_into "Figure 17-2. How
    can you integrate Nagios data into the NDOUtils database?") shows the various
    paths by which Nagios data can be imported into the NDOUtils database. Export
    of data from Nagios is handled by the event broker module ndomod. It can either
    operate a TCP or Unix socket, or write the data to a file. If Nagios is installed
    on the same computer as the NDOUtils database, the Unix socket interface will
    provide the best performance and the greatest security (Unix sockets cannot be
    addressed from a network, in contrast to TCP sockets). The socket of the ndo2db
    daemon that ultimately writes the data to a database is queried.'
  prefs: []
  type: TYPE_NORMAL
- en: The method using a file involves the utility FILE2SOCK, which reads in the file
    and also delivers data to the nd02db daemon via a TCP or Unix socket. FILE2SOCK
    can also read data from the standard input.
  prefs: []
  type: TYPE_NORMAL
- en: '![How can you integrate Nagios data into the NDOUtils database?](../Images/tagoreillycom20081104nostarchimages223938.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 17-2. How can you integrate Nagios data into the NDOUtils database?
  prefs: []
  type: TYPE_NORMAL
- en: For each database you need exactly one ndo2db daemon. If several different clients
    have access to the socket interface, it will start several processes to handle
    these.
  prefs: []
  type: TYPE_NORMAL
- en: The program LOG2NDO is one of the NDOUtils. It reads log files from Nagios 2.x
    and 3.0 and passes this data to the ndo2db daemon—either directly via the socket
    interface or via a file that has to be separately imported with FILE2SOCK. If
    you want to integrate such historical data into the database, you will have to
    make plenty of storage space available, because the log files are compressed when
    they are archived but are saved in the database in uncompressed form. Thus the
    log files occupy more space when they are managed using the database.
  prefs: []
  type: TYPE_NORMAL
- en: FILE2SOCK and LOG2NDO are primarily used to import historical data. The data
    later required by NagVis is updated by Nagios at very short intervals. Since historical
    data is not required here, we shall not describe these two programs in any more
    detail.
  prefs: []
  type: TYPE_NORMAL
- en: 17.3 The Installation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Since there are problems with **`INSERT`** statements in some tables of the
    NDOUtils database when MySQL in version 4.0 is used, it is better to use MySQL
    5 right from the start.^([[181](#ftn.CHP-17-FN-2)]) In addition to the MySQL server
    package (in Debian, "Etch" **`mysql-server-5.0`**) and the libraries that are
    usually selected automatically during the installation of the server package,
    you also require the accompanying development package (in Debian, "Etch" **`libmysqlclient15-dev`**)
    in order to be able to compile the NDOUtils.
  prefs: []
  type: TYPE_NORMAL
- en: 'One consequence of the far-reaching integration of the NDOUtils into Nagios
    is that the version must exactly match that of the Nagios version used. Both Nagios
    and the NDOUtils define their version status in the source code with the macro
    **`CURRENT_OBJECT_STRUCTURE_VERSION`**. The macro can be found in the file **`./include/objects.h`**
    in the Nagios source code (for Nagios 3.0, in this example):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE31]'
  prefs: []
  type: TYPE_PRE
- en: 'The NDOUtils package contains two include files, one for Nagios 2.x and one
    for Nagios 3.x:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE32]'
  prefs: []
  type: TYPE_PRE
- en: 'If the **`CURRENT_OBJECT_STRUCTURE_VERSION`** value of Nagios does not match
    one of the two values in the NDOUtils source code, the NDOUtils module will unload
    itself and refuse to perform. The procedure is documented in the log file **`nagios.log`**
    with an entry like the following (the two different versions are marked in bold
    type):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE33]'
  prefs: []
  type: TYPE_PRE
- en: 17.3.1 Compiling the source code
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The up-to-date NDOUtils code can be downloaded from the Nagios Web page^([[182](#ftn.CHP-17-FN-3)])
    and then unpacked to a suitable directory:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE34]'
  prefs: []
  type: TYPE_PRE
- en: 'We start the **`configure`** run with the switch **`--sysconfdir=/etc`** in
    order to install the configuration files for the module and daemon to match the
    convention in this book, that is, to the directory **`/etc/nagios`**. The **`make`**
    call compiles the program code, and the installation is then done manually:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE35]'
  prefs: []
  type: TYPE_PRE
- en: For Nagios 2.x the daemon **`ndo2db-2x`** and the module **`ndomod-2x.o`** are
    copied to **`/usr/local/nagios/bin`** instead of the 3.x versions.
  prefs: []
  type: TYPE_NORMAL
- en: 17.3.2 Preparing the MySQL database
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In the MySQL database system, we require a database storing appropriate access
    options for the user **`nagios`**. In order to set this up, we first log in to
    MySQL as the user **`root:`**
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE36]'
  prefs: []
  type: TYPE_PRE
- en: 'The switch **`-p`** ensures that the password is requested. The following command
    tests whether a password is set or not:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE37]'
  prefs: []
  type: TYPE_PRE
- en: If the login triggered by this works without an error message, then the **`root`**
    password is missing. This should be specified with the command
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE38]'
  prefs: []
  type: TYPE_PRE
- en: You should replace **``*`secret`*``** with your own secure password.^([[183](#ftn.CHP-17-FN-4)])
  prefs: []
  type: TYPE_NORMAL
- en: The database (it is given the name **`nagios`**) is created with the SQL command
    **`CREATE DATABASE`**, and it is then given the required permissions with **`GRANT:`**
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE39]'
  prefs: []
  type: TYPE_PRE
- en: The **`GRANT USAGE`** command defines the user, along with his password, and
    specifies that for him there are no restrictions in the number of queries, database
    connections, or database updates per hour. For the password, something slighty
    more secure than **``*`secret`*``** is chosen, but it must be written here in
    plain text. **`GRANT USAGE`** does not yet give any access permissions to the
    tables of the **`nagios`** database. This is handled by the second **`GRANT`**
    command. The changes to the permissions of the **`nagios`** user are activated
    with **`FLUSH PRIVILEGES`**.
  prefs: []
  type: TYPE_NORMAL
- en: The NDOUtils require **`SELECT`**, **`INSERT`**, **`UPDATE`**, and **`DELETE`**
    permissions. For NagVis and other applications, which only read data from the
    database, the **`SELECT`** permission is sufficient.
  prefs: []
  type: TYPE_NORMAL
- en: 'In the next step the tables are generated in which the NDOUtils will later
    save data. A finished SQL script in the **`db`** subdirectory of the NDOUtils
    sources is provided for this purpose, and needs only to be executed:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE40]'
  prefs: []
  type: TYPE_PRE
- en: The script should run without error in all cases (meaning without any messages).
    The tables created can be shown with the SQL command **`show tables`**.
  prefs: []
  type: TYPE_NORMAL
- en: Various distributions install MySQL by default with logging switched on. With
    the (usually binary) log files, the current status of the database can be replicated
    or restored. In combination with the NDOUtils, however, these log files grow very
    quickly. If you are using the database only for the NDOUtils, you will need such
    tools only in rare cases, and you can therefore comment out all the **`*log*`**
    parameters in the **`my.cnf`** configuration file and restart MySQL—this time
    without logging.
  prefs: []
  type: TYPE_NORMAL
- en: 17.3.3 Upgrading the database design
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Since the NDOUtils are actively undergoing development, larger changes to the
    database structure cannot be ruled out. For an upgrade, it is possible that the
    database design must also be changed. The NDOUtils provide a script for this purpose,
    **`upgradedb`** in the subdirectory **`db`**, which automatically adjusts the
    tables:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE41]'
  prefs: []
  type: TYPE_PRE
- en: The script detects the existing NDOUtils version and adjusts the tables accordingly.
    Among other things, it uses the SQL command **`ALTER TABLE`**, for which the MySQL
    user **`nagios`**, created in the last section, does not have sufficient permissions.
    The script therefore needs to be run as the MySQL user **`root`**.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[181](#CHP-17-FN-2)]) The author has tested version 5.0.23, but there are
    also reports of NDOUtils working successfully with MySQL 4.1.x.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[182](#CHP-17-FN-3)]) [http://www.nagios.org/download/](http://www.nagios.org/download/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[183](#CHP-17-FN-4)]) Further notes on the secure adminstration of MySQL
    can be found in the online documentation at [http://www.mysql.org/doc/refman/5.0/en/security-guidelines.html](http://www.mysql.org/doc/refman/5.0/en/security-guidelines.html)
    and possibly in the documentation delivered with the distribution under **`/usr/share/doc/`**.
  prefs: []
  type: TYPE_NORMAL
- en: 17.4 Configuration
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The NDOUtils are configured at three different locations. The file **`ndomod.cfg`**
    specifies the settings for the Event Broker module. **`ndo2db.cfg`** controls
    the daemon **`ndo2db`**, which accepts data from the Broker and writes to the
    database. An entry in **`/etc/nagios/nagios.cfg`** finally ensures that Nagios
    loads the Event Broker module **`ndomod`** when it starts.
  prefs: []
  type: TYPE_NORMAL
- en: The NDOUtils source code in the subdirectory **`./config`** provides a template
    for each of the two configuration files. The command
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE42]'
  prefs: []
  type: TYPE_PRE
- en: copies these, in accordance with the convention used in this book, to the directory
    **`/etc/nagios`**.
  prefs: []
  type: TYPE_NORMAL
- en: 17.4.1 Adjusting the Event Broker configuration
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The template for **`ndomod.cfg`** can almost be used unchanged; you need to
    adjust only the path to the **`var`** directory:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE43]'
  prefs: []
  type: TYPE_PRE
- en: '**`instance_name`** refers to the instance in the database to be used. Provided
    that you map only one Nagios instance in the database, it is no problem to keep
    to the **`default`** settings. Assuming that Nagios and the **`ndo2db`** daemon
    are running on the same host, a Unix socket can be used as the **`output_type`**,
    the name of which is defined by the **`output`** parameter. **`tcp_port`** is
    used only for **`output_type=tcpsocket`** and is therefore commented out.'
  prefs: []
  type: TYPE_NORMAL
- en: 'In case the **`ndomod`** module cannot release data via the socket interface
    (because the daemon has just restarted, for instance), these are saved temporarily
    in the file **`buffer_file`**. The number of entries to be saved in this in the
    **`output_buffer_items`** parameter should not be set too low. A tried-and-tested
    rule of thumb here is to take the number of all defined host and service objects
    and multiply this by five. This is an empirical value: When reloaded, or when
    Nagios is restarted, the NDOUtils write the start state for each host and each
    service to the database, along with all planned and started checks. These might
    be supplemented by the results of new or still running checks.'
  prefs: []
  type: TYPE_NORMAL
- en: The **`file_rotation_*`** parameters are required only for **`output_type=file`**,
    which requires the use of the additional daemon **`FILE2SOCK`**. For reasons of
    performance it is recommended, however, that you use the socket interface instead
    of the file-based one. The file interface also makes the configuration more complex,
    due to additional daemons.
  prefs: []
  type: TYPE_NORMAL
- en: The parameters **`reconnect_interval`** and **`reconnect_warning_interval`**
    are also intended for cases where a connection using the **`ndo2db`** daemon could
    not be established. They specify in seconds how often Nagios should try to make
    contact with them and how often a warning should appear in the log file if a connection
    is not established. These two parameters should be left as they are in the default.
  prefs: []
  type: TYPE_NORMAL
- en: 17.4.2 Configuring database access
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'There is also little to adjust in the template for the configuration file of
    the **`ndo2db`** daemon. Apart from the path to the socket interface, the relevant
    password for write access to the database must be specified here:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE44]'
  prefs: []
  type: TYPE_PRE
- en: The two **`ndo2db_*`** parameters specify the user and group with whose permissions
    the daemon runs after the start. **`socket_type`** and **`socket_name`** must
    be set to the configuration in **`ndomod.cfg`**.
  prefs: []
  type: TYPE_NORMAL
- en: The only database type that can currently be specified **`db_servertype`** is
    **`mysql`**; for **`db_port`** the standard port of MySQL (**`3306`**) is normally
    entered. The database name in **`db_name`** must match the name selected in the
    **`CREATE DATABASE`** command (in this case, **`nagios`**), and the database user
    and password must also be given in the same way as described when setting up the
    database. The value of the parameter **`db_prefix`** should not be changed under
    any circumstances, otherwise the name of the tables to be created in the **`mysql.sql`**
    script must also be adjusted.
  prefs: []
  type: TYPE_NORMAL
- en: The parameters beginning with **`max_*`** define in minutes how long the NDOUtils
    data on system commands, planned events, service and host checks, and event handlers^([[184](#ftn.CHP-17-FN-5)])
    should be kept in the database. The value 1440 corresponds to one day. If you
    are using the NDOUtils only with NagVis, you won't need longer times. Short intervals
    go easy on the database, as well as the hard disk.
  prefs: []
  type: TYPE_NORMAL
- en: 17.4.3 Starting the **`ndo2db`** daemon
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'When everything is configured, the **`ndo2db`** daemon is first called manually:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE45]'
  prefs: []
  type: TYPE_PRE
- en: 'Later on it is recommended that you create an init script by copying and modifying
    the script **`/etc/init.d/skeleton`**, provided in the distribution. The daemon
    must match the Nagios version: **`ndo2db-3x`** works together with Nagios version
    3.x, **`ndo2db-2x`** with version 2.x. After it has started you should look to
    see whether the socket specified in the configuration exists:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE46]'
  prefs: []
  type: TYPE_PRE
- en: If the message **`Socket already in use`** appears when the daemon is run, then
    either the daemon is already running or the socket **`ndo.sock`** was not removed
    when the daemon was stopped. In this case you should delete it manually before
    restarting it.
  prefs: []
  type: TYPE_NORMAL
- en: 17.4.4 Loading the Event Broker module in Nagios
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In order for Nagios to load the Event Broker module of the NDOUtils when it
    is started, the following entry is added to the configuration file **`/etc/nagios/nagios.cfg:`**
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE47]'
  prefs: []
  type: TYPE_PRE
- en: 'In this example the module for Nagios version 3.x is used; if you are using
    Nagios 2.x, you enter **`ndomod-2x.o`** instead. A reload activates the module:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE48]'
  prefs: []
  type: TYPE_PRE
- en: 'Shortly after the reload, all host and service objects should be recorded in
    the database:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE49]'
  prefs: []
  type: TYPE_PRE
- en: The table **`nagios_objects`** contains all the objects, and **`objecttype_id=2`**
    shows all the services. Alternatively the object type **`1`** refers to hosts,
    **`3`** to host groups, and **`4`** to service groups. A complete description
    of the tables is provided in the file **`NDOUTILS DB Model.pdf`**, included in
    the NDOUtils in the subdirectory **`./docs`**.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[184](#CHP-17-FN-5)]) For event handlers, see [Appendix C](../Text/apc.html
    "Appendix C. Event Handlers") in page 619
  prefs: []
  type: TYPE_NORMAL
- en: Chapter 18. NagVis
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: NagVis^([[185](#ftn.CHP-18-FN-1)]) is an addon for Nagios that displays host
    and service states against a background image selected by the user. This must
    be available in the PNG format; the choice is yours whether you use a map, a diagram
    of your own system documentation, a photo of the server room, or a schematic diagram
    of the system environment as a background, as shown in [Figure 18-1](../Text/ch18.html#schematic_diagram_of_a_system_environmen
    "Figure 18-1. Schematic diagram of a system environment as a template for NagVis").
  prefs: []
  type: TYPE_NORMAL
- en: 'Via the Web interface, you can place objects wherever you want on the background.
    NagVis displays different icons, depending on the state of the object: red for
    the CRITICAL state, yellow for WARNING, green for OK, and a question mark on a
    gray background for UNKNOWN. If an acknowledgment was set, this is indicated by
    a green button with a picture of a worker on it.'
  prefs: []
  type: TYPE_NORMAL
- en: There are different icons for hosts and services; in the default template, host
    icons are rectangular, and service icons are round. A finished NagVis display—NagVis
    refers to this as a *map*—is shown in [Figure 18-2](../Text/ch18.html#displaying_the_system_environment
    "Figure 18-2. Displaying the system environment"). Further examples—such as using
    a geographical map, or a photo of the server room, as a background—are provided
    on the NagVis homepage.^([[186](#ftn.CHP-18-FN-2)])
  prefs: []
  type: TYPE_NORMAL
- en: '![Schematic diagram of a system environment as a template for NagVis](../Images/tagoreillycom20081104nostarchimages223940.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-1. Schematic diagram of a system environment as a template for NagVis
  prefs: []
  type: TYPE_NORMAL
- en: In addition to hosts and services, host and service groups can also be integrated
    into a NagVis display, as well as additional maps. Thus a geographical overview
    map could be used for the start page, which has an icon for each location monitored
    that links to a detailed NagVis map specifically for that location.
  prefs: []
  type: TYPE_NORMAL
- en: If an icon contains several states, as is the case for host and service groups,
    for instance, NagVis displays the state with the highest priority CRITICAL has
    a higher priority than WARNING, WARNING trumps UNKNOWN, UNKNOWN gets more attention
    than an acknowledgment, and OK has the lowest priority of all. If any host in
    a host group assumes the CRITICAL state, this is shown accordingly for the entire
    host group.
  prefs: []
  type: TYPE_NORMAL
- en: For hosts and host groups, NagVis offers you the choice of having only host
    states considered in determining the state that is displayed, or having the services
    dependent on these hosts are included as well (see [18.1.2 Initial configuration](../Text/ch18.html#initial_configuration
    "18.1.2 Initial configuration")). In the latter case, a red stop light is displayed
    if even a single service of a host is in the critical state.
  prefs: []
  type: TYPE_NORMAL
- en: Of particular interest is NagVis's ability to evaluate only hard states ([18.1.2
    Initial configuration](../Text/ch18.html#initial_configuration "18.1.2 Initial
    configuration")). For routine work with the Web interface, it turns out to be
    quite useful if not every temporary soft CRITICAL state immediately generates
    a red light.
  prefs: []
  type: TYPE_NORMAL
- en: '![Displaying the system environment](../Images/tagoreillycom20081104nostarchimages223942.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-2. Displaying the system environment
  prefs: []
  type: TYPE_NORMAL
- en: It will especially please fans of object-oriented programming that NagVis makes
    full use of object-oriented concepts. For example, the system inherits defaults
    from the global configuration for individual maps and settings on the map level
    and passes these on to individual objects, with the option of overwriting settings
    locally always available. This simplifies the configuration to a considerable
    extent, and NagVis also indicates in the graphical editor (also called the *Web
    user interface* or WUI) which settings are object-specific and which have been
    inherited ([Figure 18-8](../Text/ch18s02.html#if_you_move_the_mouse_over_the_inserted
    "Figure 18-8. If you move the mouse over the inserted object, a hover menu opens")
    in page 399).
  prefs: []
  type: TYPE_NORMAL
- en: NagVis is published under the GNU Public License Version 2 (GPLv2); the description
    below refers to version 1.3.
  prefs: []
  type: TYPE_NORMAL
- en: 18.1 Installation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: NagVis makes use of NDOUtils and is implemented in PHP. Therefore, besides an
    NDO database in running order, as described in [Chapter 17](../Text/ch17.html
    "Chapter 17. Flexible Web Interface with the NDOUtils") from page 375, you need
    a Web server with PHP 4.2 or higher, as well as the packages **`php-mysql`** for
    access to the NDO database and **`php-gd`** to be able to draw lines.^([[187](#ftn.CHP-18-FN-3)])
    Depending on the distribution and the PHP version used, the package names may
    vary slightly. For Debian "Etch" and PHP5 you need the packages **`libapache2-mod-php5,
    php5, php5-common, php5-gd`**, and **`php5-mysql`**.
  prefs: []
  type: TYPE_NORMAL
- en: NagVis does not necessarily have to be installed on the same computer as Nagios
    and the NDOUtils, although in many cases they are packed onto one host. The configuration
    of the NDO database—NagVis documentation refers to this as the *backend*—can refer
    (as described in [18.1.2 Initial configuration](../Text/ch18.html#initial_configuration
    "18.1.2 Initial configuration")) to any system you please. NagVis even allows
    the backend to be selected separately for each individual object so that maps
    can be generated that combine several Nagios installations in a single graphic.
  prefs: []
  type: TYPE_NORMAL
- en: 18.1.1 Installing the source code
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The NagVis source code, from [http://www.nagvis.org/downloads](http://www.nagvis.org/downloads),
    is unpacked in a directory of your choice:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE50]'
  prefs: []
  type: TYPE_PRE
- en: If a previous installation exists, you should back this up first. Then you copy
    the directory that has been created (in our case, **`nagvis-1.3`**) with the name
    **`nagvis`** to **`/usr/local/nagios/share:`**
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE51]'
  prefs: []
  type: TYPE_PRE
- en: 'The duplicated directory name **`nagvis`** can sometimes lead to confusion,
    but it is correct:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE52]'
  prefs: []
  type: TYPE_PRE
- en: '**`/usr/local/nagios/share/nagvis`** represents the main directory of the NagVis
    installation, while the subdirectory **`nagvis`** contains the NagVis application,
    together with its configuration. Finally the subdirectory **`wui`** contains the
    graphic editor that enables NagVis maps to be edited via the browser.'
  prefs: []
  type: TYPE_NORMAL
- en: 'At present, the correct access permissions for directories and files must be
    set manually. To do this, you first need to determine the user with whose permissions
    the Web server is running (see also [1.2 Compiling Source Code](../Text/ch01s02.html
    "1.2 Compiling Source Code"), page 39):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE53]'
  prefs: []
  type: TYPE_PRE
- en: 'The first **`grep`** command looks for the corresponding user in the configuration
    file for the Web server—in this case, Apache2—and then the **`id`** command searches
    for the primary group of this user. This can be found after the **`gid=`** specification.
    The access permissions are now set accordingly:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE54]'
  prefs: []
  type: TYPE_PRE
- en: Before the Web user interface can be used, you must create the central configuration
    file and ensure that access to NagVis is only possible after successful authentication.
  prefs: []
  type: TYPE_NORMAL
- en: 18.1.2 Initial configuration
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'A template for the central NagVis configuration file **`config.ini.php`** can
    be found in the directory **`/usr/local/nagios/share/nagvis/etc`**, which only
    needs to be renamed and modified:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE55]'
  prefs: []
  type: TYPE_PRE
- en: The commands **`chown`** and **`chmod`** ensure that the correct access permissions
    are set for the Web user (here, **`www-data`**) and his group.
  prefs: []
  type: TYPE_NORMAL
- en: Apart from the configuration of the backend (that is, the NDO database), the
    included **`config.ini.php`** already has usable defaults. The following description
    is therefore limited to introducing the most important parameters:^([[188](#ftn.CHP-18-FN-4)])
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE56]'
  prefs: []
  type: TYPE_PRE
- en: In the **`[global]`** section you can set the language with **`language`**;
    the default is **`english. refreshtime`** defines every how many seconds the display
    in the brower is refreshed.
  prefs: []
  type: TYPE_NORMAL
- en: 'The section **`[defaults]`** specifies defaults that are inherited by the defined
    objects from the map configuration. The values can be overwritten via the map,
    if required. It is best to define settings here that are identical for the majority
    of objects, in order to avoid the repeated work of defining them explicitly in
    the object definitions:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE57]'
  prefs: []
  type: TYPE_PRE
- en: '**`backend`** specifies which NDO database is used as the default backend.
    The name for this can be anything you like, but the backend itself must still
    be defined in a separate section (see [18.1.2 Initial configuration](../Text/ch18.html#initial_configuration
    "18.1.2 Initial configuration")). If you are just getting started, it is best
    to keep the name supplied, **`ndomy_1`**.'
  prefs: []
  type: TYPE_NORMAL
- en: 'The parameter **`icons`** defines the icon set from the directory **`./nagvis/nagvis/images/iconsets`**
    that is to be used. Four sets are included: **`std_small, std_medium, std_big`**,
    and **`folder`**. Other icons can be downloaded from the NagVis homepage,^([[189](#ftn.CHP-18-FN-5)])
    or you can create them yourself.^([[190](#ftn.CHP-18-FN-6)])'
  prefs: []
  type: TYPE_NORMAL
- en: The setting **`recognizeserivces=1`** ensures for hosts and host groups that
    the current states of the accompanying services are included when the overall
    state is being determined. The value 0 switches off this behavior.
  prefs: []
  type: TYPE_NORMAL
- en: '**`onlyhardstates=1`** on the other hand instructs NagVis to take only hard
    states into account. The default **`0`** also includes soft states.'
  prefs: []
  type: TYPE_NORMAL
- en: 'The **`[wui]`** section allows settings to be made for the NagVis editor:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE58]'
  prefs: []
  type: TYPE_PRE
- en: '**`autoupdatefreq`** determines how often (in number of seconds) the Web user
    interface automatically saves changes, while **`maplocktime`** specifies the number
    of minutes after which any further changes to a map that is currently being edited
    should be blocked, from the time of the last change. This is intended to prevent
    several users from simultaneously editing the same map.'
  prefs: []
  type: TYPE_NORMAL
- en: 'The paths to the NagVis installation from the perspective of the file system
    (**`base`**) and—separately for NagVis data and NagVis CGIs—from the perspective
    of the browser, are specified in Section **`[paths]`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE59]'
  prefs: []
  type: TYPE_PRE
- en: The defaults listed here match the standard installation described above.
  prefs: []
  type: TYPE_NORMAL
- en: 'The configuration for the backend, that is, for accessing the NDO database,
    follows at the bottom of the file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE60]'
  prefs: []
  type: TYPE_PRE
- en: This name of this section must contain the name specified with the **`backend`**
    parameter under **`[defaults]`**, according to the pattern **`[backend_`****``*`value_of_backend]`*``**.
    The default here is **`ndomy_1`**. If the **`backend`** parameter value does not
    match any of the defined backend sections, NagVis will refuse to work.
  prefs: []
  type: TYPE_NORMAL
- en: '**`backendtype`** defines the type of backend, and for now **`ndomy`**—an NDO
    database based on MySQL—is the only possible value.'
  prefs: []
  type: TYPE_NORMAL
- en: '**`dbhost`** and **`dbport`** specify the host name or IP address and the accompanying
    TCP port for access to the database. **`dbname`** contains the name of the NDO
    database, and **`dbuser`** and **`dbpass`** give the user and the password for
    access.'
  prefs: []
  type: TYPE_NORMAL
- en: The values defined by default for **`dbprefix`** and **`dbinstancename`** are
    set for a NDOUtils standard installation. Provided that you have not changed the
    parameter **`instance_name`** in the file **`ndomod.cfg`** (see [17.4.1 Adjusting
    the Event Broker configuration](../Text/ch17s04.html#adjusting_the_event_broker_configuration
    "17.4.1 Adjusting the Event Broker configuration") from page 384) and **`db_prefix`**
    in the file **`ndo2db.cfg`** (see [17.4.2 Configuring database access](../Text/ch17s04.html#configuring_database_access
    "17.4.2 Configuring database access") from page 385), you can use the values given
    here.
  prefs: []
  type: TYPE_NORMAL
- en: One parameter to which you should pay particular attention is **`maxtime-withoutupdate:`**
    This defines how much time in seconds is allowed for the status update of Nagios
    to appear. If the time specified here is exceeded, NagVis assumes that the data
    is obsolete and displays this as an error. If NagVis accesses NDO databases that
    are distributed across several servers, it is essential that the clock times of
    the servers be synchronized with one another, otherwise NagVis will refuse to
    work if it comes across a time difference greater than **`maxtimewithoutupdate`**
    seconds.
  prefs: []
  type: TYPE_NORMAL
- en: 'At this point we shall mention another problem involving data exchange between
    the NDO database and NagVis: NagVis evaluates the current program status. Nagios
    versions prior to 3.0b1, however, only write this to the NDO database *after*
    the nightly change of the log files. Starting with version 3.0b1, Nagios updates
    the status every five seconds, so that NagVis always has up-to-date information.'
  prefs: []
  type: TYPE_NORMAL
- en: 18.1.3 User authentication
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: NagVis demands authentication from the user. Without user authentication, it
    will just issue an error message.^([[191](#ftn.CHP-18-FN-7)])
  prefs: []
  type: TYPE_NORMAL
- en: If the **`share`** directory of Nagios is not accessible for authentication,
    as in the Apache configuration in [1.5.1 Setting up Apache](../Text/ch01s05.html#setting_up_apache
    "1.5.1 Setting up Apache"), you should change this in the Apache configuration
    file **`/etc/apache2/conf.d/nagios`**. The authentication data are best taken
    from the CGI directory (see [1.5 Configuration of the Web Interface](../Text/ch01s05.html
    "1.5 Configuration of the Web Interface") from page 47).
  prefs: []
  type: TYPE_NORMAL
- en: '![After a right mouse click on the graphic displayed, the menu will appear](../Images/tagoreillycom20081104nostarchimages223944.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-3. After a right mouse click on the graphic displayed, the menu will
    appear
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[185](#CHP-18-FN-1)]) [http://www.nagvis.org/](http://www.nagvis.org/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[186](#CHP-18-FN-2)]) [http://www.nagvis.org/screenshots](http://www.nagvis.org/screenshots)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[187](#CHP-18-FN-3)]) You can manage without using the GD libraries if the
    parameter **`usedgdlibs`** in the NagVis configuration file **`config.ini.php`**
    (see [18.1.1 Installing the source code](../Text/ch18.html#installing_the_source_code
    "18.1.1 Installing the source code")) is set to **`0`**.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[188](#CHP-18-FN-4)]) The complete documentation can be found at [http://www.nagvis.org/docs/1.3/nagvis_config_format_description](http://www.nagvis.org/docs/1.3/nagvis_config_format_description).
  prefs: []
  type: TYPE_NORMAL
- en: ^([[189](#CHP-18-FN-5)]) [http://www.nagvis.org/downloads](http://www.nagvis.org/downloads)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[190](#CHP-18-FN-6)]) A corresponding guide can be found at [http://www.nagvis.org/docs/extending/iconsets](http://www.nagvis.org/docs/extending/iconsets).
  prefs: []
  type: TYPE_NORMAL
- en: ^([[191](#CHP-18-FN-7)]) The FAQ entry [http://www.nagvis.org/docs/general/faq#how/to/run/nagvis/without/authentication/](http://www.nagvis.org/docs/general/faq#how/to/run/nagvis/without/authentication/)
    describes away of using NagVis without authentication, but you should avoid this,
    for reasons of security.
  prefs: []
  type: TYPE_NORMAL
- en: 18.2 Creating NagVis Maps
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The NagVis configuration interface is accessed through the URL [http://nagiosserver/nagios/wui/index.php](http://nagiosserver/nagios/wui/index.php).
    Here you replace **``*`nagiosserver`*``** with your own Nagios host name ([Figure 18-3](../Text/ch18.html#after_a_right_mouse_click
    "Figure 18-3. After a right mouse click on the graphic displayed, the menu will
    appear") shows the start page).
  prefs: []
  type: TYPE_NORMAL
- en: It is operated through a menu that opens when you click the right mouse button.
    For browsers that overlay the NagVis menu with their own menu, a second click
    with the right mouse button will cause the browser menu to disappear.
  prefs: []
  type: TYPE_NORMAL
- en: If you don't have a suitable background graphic available in PNG format, you
    can create a new, empty background image via the menu item **Manage | Backgrounds**,
    as shown in [Figure 18-4](../Text/ch18s02.html#creating_a_new_comma_empty_background
    "Figure 18-4. Creating a new, empty background"). In this example, a gray image
    of size 800x600 pixels is created.
  prefs: []
  type: TYPE_NORMAL
- en: '![Creating a new, empty background](../Images/tagoreillycom20081104nostarchimages223946.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-4. Creating a new, empty background
  prefs: []
  type: TYPE_NORMAL
- en: This image is displayed on screen in its original size, that is, not scaled.
    To avoid scrolling, it should not be too large, with the proper size depending
    on the screen resolution and taking into account possible window frames.
  prefs: []
  type: TYPE_NORMAL
- en: 'Later on the image size can only be altered to a limited extent: although you
    can upload or create a background image at any time, objects that have already
    been placed are not affected by any changes in the size or other characteristics
    of the background, and so they may not fit properly into a new background image.
    The only option then is to reposition all the objects. The best approach is to
    experiment at first with just a few objects in the definitive environment before
    you set up an extensive map.'
  prefs: []
  type: TYPE_NORMAL
- en: '![If the entry for Map Iconset remains empty, NagVis uses the defaults from
    the central configuration.](../Images/tagoreillycom20081104nostarchimages223948.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-5. If the entry for Map Iconset remains empty, NagVis uses the defaults
    from the central configuration.
  prefs: []
  type: TYPE_NORMAL
- en: You now create a new map for the generated or uploaded image. Via the menu entry
    **Manage | Maps** ([Figure 18-3](../Text/ch18.html#after_a_right_mouse_click "Figure 18-3. After
    a right mouse click on the graphic displayed, the menu will appear")) you navigate
    to the dialog shown in [Figure 18-5](../Text/ch18s02.html#if_the_entry_for_map_iconset_remains_emp
    "Figure 18-5. If the entry for Map Iconset remains empty, NagVis uses the defaults
    from the central configuration."). There you define the name of the map and select
    the background image. If every authenticated user should see the map, you enter
    **`EVERYONE`** as **User with read permissions**. For the **`User with write permissions`**,
    on the other hand, you would probably enter a specific user, or several user names,
    separated by commas. Defining the icon sets is optional at this point, although
    the example shown specifies them.
  prefs: []
  type: TYPE_NORMAL
- en: Newly created maps are automatically opened by NagVis in editing mode. You can
    reach this later on via the menu item **Open Map** in the context menu of the
    opening dialog or by calling it directly with the URL [http://nagios/nagvis/wui/index.php?map=mapname](http://nagios/nagvis/wui/index.php?map=mapname).
  prefs: []
  type: TYPE_NORMAL
- en: '![Inserting objects via the graphical interface](../Images/tagoreillycom20081104nostarchimages223950.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-6. Inserting objects via the graphical interface
  prefs: []
  type: TYPE_NORMAL
- en: The **``*`mapname`*``** for the map created in [Figure 18-5](../Text/ch18s02.html#if_the_entry_for_map_iconset_remains_emp
    "Figure 18-5. If the entry for Map Iconset remains empty, NagVis uses the defaults
    from the central configuration.") is **`Test`**. In the map itself you now insert
    objects using the right mouse button (see [Figure 18-6](../Text/ch18s02.html#inserting_objects_via_the_graphical_inte
    "Figure 18-6. Inserting objects via the graphical interface")). An object can
    be an icon, a line, or a special object. Icons and lines represent the current
    state of a host or service and can also stand for entire host or service groups.
    Icons can only reflect the overall state of a map. Special objects are graphics
    representing stateless objects (which might be icons as well, for example) or
    text boxes, which can also be provided with a hyperlink.
  prefs: []
  type: TYPE_NORMAL
- en: To insert a host group you select **Add Object |Icon| Hostgroup** in the menu.
    Then you place the mouse over the desired position and define the destination
    of the icon with a left mouse click (the position can be changed later on).
  prefs: []
  type: TYPE_NORMAL
- en: When this is done a dialog opens, as shown in [Figure 18-7](../Text/ch18s02.html#defining_a_host_group_in_the_graphical
    "Figure 18-7. Defining a host group in the graphical interface"). The entry **backend_id**
    can remain empty, and NagVis will then use the value of the **`backend`** parameter
    from the central configuration file **`config.php.ini`**. In the **hostgroup_name**
    pulldown menu, NagVis allows you to select from all defined host groups.
  prefs: []
  type: TYPE_NORMAL
- en: Icons can be positioned according to the **x** and **y** coordinates by either
    entering numerical values or using the mouse. For simple icons, the point (x,
    y) corresponds to the center, and for lines to the start or end points. The z
    coordinate is only used when icons overlap. The value **`0`** describes the underlying
    image at the rear and is reserved for the background, and the object with the
    highest **z** value is right at the front. If the **z** coordinate is explicitly
    left empty when the object is inserted, it automatically receives the value **`1`**.
  prefs: []
  type: TYPE_NORMAL
- en: '![Defining a host group in the graphical interface](../Images/tagoreillycom20081104nostarchimages223952.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-7. Defining a host group in the graphical interface
  prefs: []
  type: TYPE_NORMAL
- en: The parameter **`recognize_services`** allows the **`recognizeservices`** setting
    from the **`config.ini.php`** (see [18.1.2 Initial configuration](../Text/ch18.html#initial_configuration
    "18.1.2 Initial configuration")) to be overridden, and **`only_hard_states`**
    does the same for the parameter **`onlyhardstates`** ([18.1.2 Initial configuration](../Text/ch18.html#initial_configuration
    "18.1.2 Initial configuration")).
  prefs: []
  type: TYPE_NORMAL
- en: The object inserted in this way always appears in the graphical editor in the
    form of the OK icon from the icon set chosen; the Web interface takes no account
    of its actual state.
  prefs: []
  type: TYPE_NORMAL
- en: If you move the mouse over the icon, a hover menu opens, as shown in [Figure 18-8](../Text/ch18s02.html#if_you_move_the_mouse_over_the_inserted
    "Figure 18-8. If you move the mouse over the inserted object, a hover menu opens").
    It clearly distinguishes which settings are inherited and which ones have been
    specified directly in the object. If you follow the **Change** link there, the
    settings can be changed again.
  prefs: []
  type: TYPE_NORMAL
- en: '![If you move the mouse over the inserted object, a hover menu opens](../Images/tagoreillycom20081104nostarchimages223954.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-8. If you move the mouse over the inserted object, a hover menu opens
  prefs: []
  type: TYPE_NORMAL
- en: When your work is finished, don't forget to save your changes via the context
    menu entry **Save** (see [Figure 18-3](../Text/ch18.html#after_a_right_mouse_click
    "Figure 18-3. After a right mouse click on the graphic displayed, the menu will
    appear") in page 396). The menu item **Open Map in NagVis** will then take you
    to the finished view, which now does display the actual states.
  prefs: []
  type: TYPE_NORMAL
- en: In [Figure 18-9](../Text/ch18s02.html#object_in_the_final_view_with_text_box
    "Figure 18-9. Object in the final view with text box and hover menu") a text box
    has been added to the host group icon. The field displayed beneath this is a hover
    menu, which shows information on the object and its state if you move the mouse
    over the object. This example shows that two hosts of the host group display a
    Not OK state and that this has already been confirmed with an acknowledgment.
  prefs: []
  type: TYPE_NORMAL
- en: '![Object in the final view with text box and hover menu](../Images/tagoreillycom20081104nostarchimages223956.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-9. Object in the final view with text box and hover menu
  prefs: []
  type: TYPE_NORMAL
- en: The finished map can be called directly via the URL [http://nagiosserver/nagios/nagvis/nagvis/index.php?map=mapname](http://nagiosserver/nagios/nagvis/nagvis/index.php?map=mapname).
  prefs: []
  type: TYPE_NORMAL
- en: 18.2.1 Editing the configuration in text form
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: NagVis stores the entire configuration of a map in text files, which can also
    be edited with a text editor. The files are located in the directory **`/usr/local/nagios/share/nagvis/etc/maps/`**.
    If you are using a background image with a known raster, you can insert several
    objects in the WUI and continue editing the map in the editor using the coordinates
    just determined. This is how the map shown in [Figure 18-2](../Text/ch18.html#displaying_the_system_environment
    "Figure 18-2. Displaying the system environment") was created. The background
    image ([Figure 18-1](../Text/ch18.html#schematic_diagram_of_a_system_environmen
    "Figure 18-1. Schematic diagram of a system environment as a template for NagVis"))
    was created with OpenOffice in order to obtain a reproducible raster; the OpenOffice
    drawing is subsequently exported as a PNG file.
  prefs: []
  type: TYPE_NORMAL
- en: The configuration options for the text files, which altogether are very extensive,
    are described in the online documentation.^([[192](#ftn.CHP-18-FN-8)])
  prefs: []
  type: TYPE_NORMAL
- en: 18.2.2 Adding NagVis maps to the Nagios Web interface
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: NagVis maps can also be integrated into the Nagios Web interface. [Figure 18-10](../Text/ch18s02.html#nagvis_map_as_a_footnote_in_the_nagios
    "Figure 18-10. NagVis map as a "footnote" in the Nagios Web interface") shows
    these after a third frame has been added to the **`index.html`** page, which binds
    a 32-pixel-high map beneath the main window. No matter what the administrator
    is currently working on, the most important states (here these are the host groups)
    are always displayed directly and can be reached with a single mouse click. There
    are no limits to your user interface dreams when using NagVis!
  prefs: []
  type: TYPE_NORMAL
- en: '![NagVis map as a "footnote" in the Nagios Web interface](../Images/tagoreillycom20081104nostarchimages223958.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 18-10. NagVis map as a "footnote" in the Nagios Web interface
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[192](#CHP-18-FN-8)]) [http://www.nagvis.org/docs](http://www.nagvis.org/docs)
  prefs: []
  type: TYPE_NORMAL
- en: Chapter 19. Graphic Display of Performance Data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: When Nagios reports to the administrator quickly and selectively on problems
    that have occurred, it can basically only distinguish between OK states and error
    states, sparing the admin a flood of information on problematic services and hosts.
    The graphic display of measured values over a time period cannot be integrated
    into this "traffic light approach," but it is available through third-party software.
    Nagios supports external processing of values with an interface created specifically
    for this. The data processed through it is referred to in Nagios jargon as *performance
    data*.
  prefs: []
  type: TYPE_NORMAL
- en: 'Nagios has two different classes of performance data. The first is Nagiosinternal
    performance data, statistics on the performance times of tests and on the difference
    between the actual test time and the planned time (the *latency*). The second
    class includes performance data that the plugin passes on with the test result.
    This involves everything that the plugin can measure: response times, hard drive
    usage, system load, and so on. These are the very things that are of interest
    to an administrator, which is why the book concentrates on how they are processed.'
  prefs: []
  type: TYPE_NORMAL
- en: Nagios extracts this data and either writes it to a file where it can be processed
    by other programs, or passes it on directly to the external software that is run
    after every service or host check.
  prefs: []
  type: TYPE_NORMAL
- en: 19.1 Processing Plugin Performance Data with Nagios
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Performance data provided by service and host checks can be processed only
    if the corresponding plugin delivers it in a predefined format. As shown here
    using the **`check_icmp`** plugin ([6.2 Reachability Test with Ping](../Text/ch06s02.html
    "6.2 Reachability Test with Ping"), page 108), it is preceded by a **`|`** sign
    and is not shown in the Web interface:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE61]'
  prefs: []
  type: TYPE_PRE
- en: 'This standardized form is provided by most plugins only after version 1.4.^([[193](#ftn.CHP-19-FN-1)])
    The performance data itself consists of one or more variables in the following
    form:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE62]'
  prefs: []
  type: TYPE_PRE
- en: The variable **``*`name`*``** may contain spaces, but then it must be surrounded
    by single quotation marks. After the equals sign comes first the measured value
    as an integer or floating-point decimal, with or without a unit. Possible units
    are **`%`** (percentage), **`s`** (time in seconds), **`B`** (data size in bytes),
    or **`c`** (counter, an incremental counter).
  prefs: []
  type: TYPE_NORMAL
- en: This is followed, separated by a semicolon, by the warning and critical limits,
    and then the minimum and maximum value. Percentage values can be left out by the
    plugin. You can also specify **`0`** for minimum/maximum, as well as for the warning
    or critical limit, if there is no such threshold value. If there are several variables,
    these are separated with spaces, as in the **`check_icmp`** example. However,
    in contrast to this, the final specification should *not* end with a semicolon,
    according to the Developer Guidelines.
  prefs: []
  type: TYPE_NORMAL
- en: 19.1.1 The template mechanism
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Nagios has two methods of processing performance data: either the system saves
    the data to a file using a *template*, or it executes an external command. If
    you just want to write data consistently to a log file, the template procedure
    is somewhat easier to configure.'
  prefs: []
  type: TYPE_NORMAL
- en: In order that Nagios can process performance data at all, the parameter
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE63]'
  prefs: []
  type: TYPE_PRE
- en: must be set to **`1`**. The file to which Nagios writes the host or service
    performance data is specified by the parameters **`host_perfdata_file`** and **`service_perfdata_file:`**
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE64]'
  prefs: []
  type: TYPE_PRE
- en: If **`host_perf data_file`** is commented out, as in this example, Nagios does
    not save any performance data of host checks. But since they are only used if
    all service checks fail, it lies in the nature of host checks that they only provide
    data sporadically and at irregular intervals. This is why it is not worth evaluating
    them in most cases.
  prefs: []
  type: TYPE_NORMAL
- en: 'The **`*_perf data_file_template`** parameters define the output format. The
    definition shown above, **`service_perfdata_file_template`**, delivers (one-line)
    log file entries in the following pattern:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE65]'
  prefs: []
  type: TYPE_PRE
- en: Each line begins with a **`[SERVICEPERFDATA]`** "stamp," followed by the test
    time in epoch seconds **`($TIMET$)`**, the host name and service description (**`$HOSTNAME$`**
    and **`$SERVICEDESC$`**), the time Nagios requires for the test (**`$SERVICEEXECUTIONTIME$`**),
    and the latency between the planned and actual time of performance (**`$SERVICELATENCY$`**),
    each separated by a tab.
  prefs: []
  type: TYPE_NORMAL
- en: 'Then Nagios writes the output for the Web interface to the log file (**`$SER-VICEOUTPUT$`**)
    and finally the actual performance data (**`$SERVICEPERF-DATA$`**). **`\t`** in
    the parameter definition ensures that a tab separates the individual details from
    each other in the log. With the **`*_perfdata_file_mode`** parameters you can
    define whether Nagios appends the data to an existing file (**`a`**) or overwrites
    the existing file (**`w`**):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE66]'
  prefs: []
  type: TYPE_PRE
- en: 'This is suitable for external programs that can read the data from a (previously
    set up) named pipe. This method provides better performance and does not require
    any space on the hard drive. If the processing software is not running, however,
    the data may be lost: Nagios does try for a time to continue writing to the pipe,
    but aborts this process after a timeout if the data cannot be read out.'
  prefs: []
  type: TYPE_NORMAL
- en: Programs that read from a log file generally delete it afterwards, to prevent
    the file system from overflowing. If the program does not retrieve any data, the
    file will grow quickly, but nothing will be lost as long as there is still space
    on the file system.
  prefs: []
  type: TYPE_NORMAL
- en: 'It is best to run external evaluation software as a permanent service. But
    you can also configure Nagios so that it regularly triggers a program for further
    processing:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE67]'
  prefs: []
  type: TYPE_PRE
- en: 'With the **`*_perfdata_file_processing_interval`** parameters you set an interval
    in seconds after which Nagios will carry on running the corresponding **`*_perf
    data_file_processirLg_command`** at specific intervals. This command is defined
    as a normal Nagios command object:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE68]'
  prefs: []
  type: TYPE_PRE
- en: As long as the external software itself looks after the further processing of
    the file with the performance data, you do need to use the **`*_perf data_file_processing_*`**
    parameters.
  prefs: []
  type: TYPE_NORMAL
- en: 19.1.2 Using external commands to process performance data
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As an alternative to the template method, Nagios can also directly call a command
    that takes over further processing of data. This is done directly after each test
    result; so after each individual check, an external program is started. If you
    have a large number of services to be checked, this can, depending on the software,
    considerably degrade performance.
  prefs: []
  type: TYPE_NORMAL
- en: 'The command itself is defined with the **`process_perfdata_command`** parameter
    instead of the **`perfdata_file`** parameter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE69]'
  prefs: []
  type: TYPE_PRE
- en: 'In the same way as with service performance data, you can also process the
    results of host checks, using the **`host_perfdata_command`** parameter. **`process-service-perfdata`**
    itself again refers to a normal Nagios command object:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE70]'
  prefs: []
  type: TYPE_PRE
- en: 'This opens the external program, which is given the necessary information as
    arguments. This should include at least the timestamp of the last service check
    (**`$LASTSERVICECHECK$`**), the host name (**`$HOSTNAME$`**), and the service
    description (**`$SERVICEDESC$`**), as well as the actual service performance data
    (**`$SERVICEPERFDATA$`**). The delimiter depends on the program used: this example
    uses **`||`**, as is used by the Nagiosgraph program.'
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[193](#CHP-19-FN-1)]) Some tools such as Nagiosgraph and NagiosGrapher make
    use of the fact that the remaining text normally contains performance data as
    well. If they are correspondingly configured, they are able to extract the performance
    data contained there. In this way they can further process data that does not
    conform to the standard format.
  prefs: []
  type: TYPE_NORMAL
- en: 19.2 Graphs for the Web with Nagiosgraph
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: With the program Nagiosgraph from [http://nagiosgraph.sf.net/](http://nagiosgraph.sf.net/),
    performance data supplied by plugins can be displayed graphically in a Web interface
    in chronological form. The software consists of two Perl scripts. The script **`insert.pl`**
    writes the Nagios performance data to a round-robin database, a ring buffer in
    which the newest data overwrites the oldest.^([[194](#ftn.CHP-19-FN-2)]) The advantage
    of this is the small amount of space required, which can be defined beforehand.
  prefs: []
  type: TYPE_NORMAL
- en: 'The trick consists of saving data in various resolutions, depending on its
    age: older data with a lower resolution (e.g., one measurement value per day),
    current data with a high resolution (e.g., one measurement every five minutes).
    When setting up the database, you also define how long the data is retained. This
    defines space requirements right from the beginning.'
  prefs: []
  type: TYPE_NORMAL
- en: Provided that Nagiosgraph detects the performance data, the program creates
    a separate round-robin database for each new service, when it appears for the
    first time. The **`map`** configuration file included describes just a few services,
    so that usually some manual work—and a basic knowledge of Perl—is required.
  prefs: []
  type: TYPE_NORMAL
- en: The second Nagiosgraph script **`show.cgi`**, a CGI script, represents the information
    from the database in a dynamic HTML page. To do this, it is run (after configuration
    is completed) in the form
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE71]'
  prefs: []
  type: TYPE_PRE
- en: Nagiosgraph then displays four graphs (a daily, a weekly, a monthly, and a yearly
    summary) for the desired service.
  prefs: []
  type: TYPE_NORMAL
- en: 19.2.1 Basic installation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: An installed RRDtool package, which is contained in most Linux distributions,
    is a prerequisite for Nagiosgraph. Alternatively you can obtain the current source
    code from [http://www.rrdtool.org/](http://www.rrdtool.org/).^([[195](#ftn.CHP-19-FN-3)])
    For reasons of performance, it is recommended here that you also install the included
    Perl module **`RRDs`**.
  prefs: []
  type: TYPE_NORMAL
- en: 'The Nagiosgraph tar file itself is preferably unpacked in the directory **`/usr/local/nagios`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE72]'
  prefs: []
  type: TYPE_PRE
- en: '**`insert.pl`** extracts the data transferred by Nagios and inserts this into
    the RRD database. If this does not exist, however, the script will create it.
    Alternatively **`insert_fast.pl`** can take on this task. This script uses the
    Perl module **`RRDs`**, which is considerably more efficient than calling up **`rrdtool`**
    as an external program each time, which is what **`insert.pl`** does.'
  prefs: []
  type: TYPE_NORMAL
- en: Another Perl script called **`testentry.pl`** helps if you are testing your
    own **`map`** entries. But since you have to write these directly into this file,
    you can also change the **`map`** file itself (as shown below)—provided you have
    made a backup copy first. The CGI script **`testcolor.cgi`** looks more like a
    developer's utility left over in the package, rather than a tool that is of any
    use for users.
  prefs: []
  type: TYPE_NORMAL
- en: 'Apart from the already mentioned **`map`** configuration file, there is a second
    one, **`nagiosgraph.conf`**, and its path must be defined correctly in both **`insert.pl`**
    (or **`insert_fast.pl`**) and **`show.cgi`**, so it is recommended that you check
    this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE73]'
  prefs: []
  type: TYPE_PRE
- en: 19.2.2 Configuration
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The configuration file **`nagiosgraph.conf`**
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'All other relevant paths—such as those to the **`map`** file and to the **`rrdtool`**—are
    adjusted in **`nagiosgraph.conf`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE74]'
  prefs: []
  type: TYPE_PRE
- en: 'Nagiosgraph creates the RRD databases in the **`rrddir`** directory. Here the
    user **`nagios`** must have write access and the user with whose rights the Web
    server is running must have read access:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE75]'
  prefs: []
  type: TYPE_PRE
- en: 'The log file, for which both users need write access (the Web user because
    the CGI script also records information to the log file), is also critical:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE76]'
  prefs: []
  type: TYPE_PRE
- en: 'How verbose Nagiosgraph is can be adjusted with **`debug`**. The possible debug
    levels are documented in the configuration file included: **`2`** means "errors,"
    **`4`** "information"—here Nagiosgraph is already so verbose that you must watch
    out that the file system does not overflow. Except for debugging purposes (such
    as when setting up the system), it is better to choose **`2`**.'
  prefs: []
  type: TYPE_NORMAL
- en: With **`colorscheme`**, which can accept values from 1 to 8, you can influence
    the amount of color in the graphs—it is best to try out the options to see which
    color scheme matches your personal taste best.
  prefs: []
  type: TYPE_NORMAL
- en: Nagios configuration
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Nagiosgraph grabs the performance data directly from Nagios. For this reason
    **`nagios.cfg`** does not require any **`*_perfdata_file_*`** parameters.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE77]'
  prefs: []
  type: TYPE_PRE
- en: '**`process_performance_data`** switches on processing of performance data in
    general; **`service_perfdata_command`** refers to the Nagios command object that
    contains the external command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE78]'
  prefs: []
  type: TYPE_PRE
- en: The definition of the parameter **`command_line`** must be written on one line
    (without the backslashes **`\`**), as usual.
  prefs: []
  type: TYPE_NORMAL
- en: 'So that the CGI script can run directly from the Nagios Web interface, a **`serviceextinfo`**
    object is defined:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE79]'
  prefs: []
  type: TYPE_PRE
- en: 'If the graphic defined in **`icon_image`** is in the directory **`/usr/local/nagios/share/images/logos`**,
    the Web interface marks the **`PING`** services for all hosts in the status display
    with this.^([[196](#ftn.CHP-19-FN-4)]) Here the strength of show.cgi can be seen:
    only because this script is called explicitly with host and service names is a
    definition like the one above possible. Instead of an individual host name, you
    can also specify a host group, or, as in this example, a **`*`**. A requirement
    for this is that PING really is defined as a service for every host.'
  prefs: []
  type: TYPE_NORMAL
- en: The **`$HOSTNAME$`** macro then automatically inserts the appropriate host.
    The additional information for a specific service type (which must have the same
    service description in all hosts) can therefore be catered for with just one single
    definition.
  prefs: []
  type: TYPE_NORMAL
- en: Apache configuration
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'So that the Apache Web server can accept the CGI script as it is, a **`Script-Alias`**
    is created, for example:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE80]'
  prefs: []
  type: TYPE_PRE
- en: This entry is best placed in the configuration file discussed in [1.5 Configuration
    of the Web Interface](../Text/ch01s05.html "1.5 Configuration of the Web Interface")
    (page 47), **`nagios.conf`**. Only after Apache is reloaded can the CGI script
    be run from the URL specified in [19.2 Graphs for the Web with Nagiosgraph](../Text/ch19s02.html
    "19.2 Graphs for the Web with Nagiosgraph").
  prefs: []
  type: TYPE_NORMAL
- en: Adjustments to the map
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Depending on the service, the round-robin database may also save several series
    of measurements, which can be requested individually through the CGI script:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE81]'
  prefs: []
  type: TYPE_PRE
- en: The database used here contains at least three different series of measurements,
    the first two of which are shown together in one graphic, while the third is shown
    in a separate graphic. What is shown together and what is separate depends on
    the standardization. It makes little sense to display the percentage load of a
    hard drive and the absolute value in bytes in the same graphic, since the Y axis
    can only have one scale. It is better here to display percentage values in one
    graphic and absolute byte values in a second one. On the other hand you can display
    the various average values of the system load (for one, five, and 15 minutes)
    in a single graphic. If you leave out all **`db`**= specifications, Nagiosgraph
    always displays all measured values for a service in a single graphic.
  prefs: []
  type: TYPE_NORMAL
- en: What individual databases and measured values display is defined by the **`map`**
    file. To understand how the instructions contained there influence the extraction
    of data, you just need to switch the debugging level to **`4`** and take a look
    at the output in the log file **`nagiosgraph.log`**. Each time the insert function
    is run, Nagiosgraph rereads the configuration files, so that this does not cause
    any kind of reset.
  prefs: []
  type: TYPE_NORMAL
- en: 'In the following extract from the log file the three dots mark sections which
    we will not print, for the sake of clarity:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE82]'
  prefs: []
  type: TYPE_PRE
- en: The output is from the **`check_icmp`** plugin. The host name, service description,
    performance data, (**`perfdata:`**) and the standard output line (**`output:`**)
    each have their own line. In the performance data the plugin announces the *round
    trip average* with the variable **`rta`**, and the number of packets that have
    gone missing with **`pl`** (*packet loss*).
  prefs: []
  type: TYPE_NORMAL
- en: 'The **`map`** file contains Perl instructions that filter these outputs and
    extracts the corresponding data if there are hits. Each of them starts with a
    search instruction:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE83]'
  prefs: []
  type: TYPE_PRE
- en: The classic Perl search function consists of the two forward slashes **`/`**
    with a search pattern in the form of a regular expression in between. Round pairs
    of brackets enclose partial patterns with which the text found in this way can
    later be accessed using the variables **`$1`**, **`$2`**, etc.
  prefs: []
  type: TYPE_NORMAL
- en: The pattern in the first bracket thus matches a single digit (**`\d`**) or a
    dot,^([[197](#ftn.CHP-19-FN-5)]) and the next + states that there can be several
    of them (or none at all). In the second round brackets, though, one or more digits
    are allowed, but no period. In concrete terms **`$1`** delivers the numerical
    value of the response time, **`$2`** provides the packet loss in percent.
  prefs: []
  type: TYPE_NORMAL
- en: 'The full instruction in the **`map`** file links two Perl statements with the
    **`and`** operator:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE84]'
  prefs: []
  type: TYPE_PRE
- en: 'If the first one—the search function—is successful, then it is the turn of
    the **`push`** statement. It adds the expression in square brackets following
    to the array **`@s`**. The instruction ends with a semicolon. If the search function
    provides no result, the **`map`** instruction will not save any entry in the **`@s`**
    array. The expression to be included in the array has the following format:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE85]'
  prefs: []
  type: TYPE_PRE
- en: The file name for a Nagiosgraph database file consists of the host name, service
    description, and the database name together, for example, **`linux01_PING_ping.rrd`**.
    The desired string for the database name is entered instead of the placeholder
    *db-name* into the **`map`** file (in this case, **`ping`**).
  prefs: []
  type: TYPE_NORMAL
- en: The name of the data source can be chosen freely, but should contain an indication
    of the data that is stored here, such as **`rta`** for the response time or **`losspct`**
    for percentage of packets that have been lost.
  prefs: []
  type: TYPE_NORMAL
- en: What *type* you specify is determined by the RRD tools. **`GAUGE`** stands for
    simple measured values that are displayed simply as they are. **`DERIVE`** is
    recommended by Nagiosgraph author Soren Dossing for processing counters, such
    as in querying a packet counter on the network interface. Counters grow incrementally
    and, when they run over, start again at zero. What is of interest here is the
    difference between two points in time. The RRD database determines these automatically
    if the data source type **`DERIVE`** is specified.
  prefs: []
  type: TYPE_NORMAL
- en: The database name, data source, and type should always be placed in single quotation
    marks in the **`map`** file, so that no name conflicts can occur with keywords
    reserved in Perl.
  prefs: []
  type: TYPE_NORMAL
- en: 'The measured value itself is determined using Perl methods, and the placeholder
    *value* is substituted with the corresponding instructions. In the simplest case,
    you take over the values found with the search pattern in the performance data
    with **`$1`**, **`$2`**, etc. (see example above), or calculate new values from
    these by multiplying^([[198](#ftn.CHP-19-FN-6)]) by 1024 or by calculating the
    percentage:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE86]'
  prefs: []
  type: TYPE_PRE
- en: The first entry evaluates the query of hard drive space on a Windows server
    with **`check_nt`** (see [20.2.1 NSClient](../Text/ch20s02.html#nsclient "20.2.1
    NSClient"), page 476). The performance data also contains, apart from the occupied
    space in **`$1`**, the size of the data carrier in **`$5`**. This can be used
    to calculate the percentage that is available (**`freepct`**) and the percentage
    used (**`usepct`**).
  prefs: []
  type: TYPE_NORMAL
- en: 'The second example evaluates data obtained on a Unix host, with **`check_ disk`**,
    by multiplying the free hard drive space specified in MB by 1024² to convert it
    to bytes. The critical and warning limits always remain constant, which leads
    to horizontal lines, as seen in [Figure 19-1](../Text/ch19s02.html#used_space_and_limit_values_for_the_fil
    "Figure 19-1. Used space and limit values for the file system /net/linux01/a on
    the host linux0l, as Nagiosgraph represents them"): the lower line at 12.1 GB
    represents the warning limit, the middle line the current load, and the top line
    at 18.1 GB, the critical limit. The keys for the individual graphs each list minimum,
    maximum, and average as a numerical value. This differentiation for the two limit
    values is not of any use, but it cannot be avoided, since Nagiosgraph does not
    know that these are constant values: it treats warning and critical limits just
    like any other measured values.'
  prefs: []
  type: TYPE_NORMAL
- en: If a plugin does not provide any performance data, but values that are used
    in normal output, the search function can be applied to the output (**`/output:.../`**)
    instead of to the performance data. Help is provided, for example, by the Nagiosgraph
    Forum at [http://sourceforge.net/forum/forum.php?forum_id=394748](http://sourceforge.net/forum/forum.php?forum_id=394748).
  prefs: []
  type: TYPE_NORMAL
- en: '![Used space and limit values for the file system /net/linux01/a on the host
    linux0l, as Nagiosgraph represents them](../Images/tagoreillycom20081104nostarchimages223960.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 19-1. Used space and limit values for the file system `/net/linux01/a`
    on the host `linux0l`, as Nagiosgraph represents them
  prefs: []
  type: TYPE_NORMAL
- en: 'Changes to the **`map`** are critical. It is therefore recommended that you
    copy the file first and edit the copy and then perform a syntax check, using **`perl
    -c`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE87]'
  prefs: []
  type: TYPE_PRE
- en: If the syntax check is in order, you can install the new file as **`map`**.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[194](#CHP-19-FN-2)]) Further information on this topic can be found at [http://www.rrdtool.org/](http://www.rrdtool.org/).
  prefs: []
  type: TYPE_NORMAL
- en: ^([[195](#CHP-19-FN-3)]) To install, see [19.4.1 Installation](../Text/ch19s04.html#installation-id6
    "19.4.1 Installation").
  prefs: []
  type: TYPE_NORMAL
- en: ^([[196](#CHP-19-FN-4)]) A more detailed description of the **`serviceextinfo`**
    object is contained in [16.4.2 Extended service information](../Text/ch16s04.html#extended_service_information
    "16.4.2 Extended service information"), page 366.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[197](#CHP-19-FN-5)]) A pair of square brackets contains alternatives.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[198](#CHP-19-FN-6)]) This turns kilobytes into bytes.
  prefs: []
  type: TYPE_NORMAL
- en: 19.3 Preparing Performance Data for Evaluation with Perf2rrd
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Another tool which transfers Nagios performance data to an RRD database is the
    Java application Perf2rrd. This requires an installed Java Runtime Environment
    ([1.4.2 Plugin test](../Text/ch01s04.html#plugin_test "1.4.2 Plugin test"), or
    preferably [1.5 Configuration of the Web Interface](../Text/ch01s05.html "1.5
    Configuration of the Web Interface")). Since the virtual machine generates a noticeable
    load on less powerful computers, and also requires a large amount of memory, the
    requirements made of the Nagios server by Perf2rrd are significantly higher than
    those made by Nagiosgraph.
  prefs: []
  type: TYPE_NORMAL
- en: 'On the other hand there is no more work after the installation as far as generating
    the RRD databases is concerned, because Perf2rrd uses the template mechanism of
    Nagios (see [19.1 Processing Plugin Performance Data with Nagios](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 Processing Plugin Performance Data with Nagios"), page 404). For each service
    and each variable contained in the template, the tool creates a separate RRD database
    using the following naming pattern:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE88]'
  prefs: []
  type: TYPE_PRE
- en: So to evaluate the **`check_icmp`** variables **`rta`** (*round trip average*)
    and **`pl`** (*packet loss*), the file names are **`linux01+PING+pl.rrd`** and
    **`linux01+PING+rta.rrd`**.
  prefs: []
  type: TYPE_NORMAL
- en: Perf2rrd only looks after the storage of data in an RRD database and does not
    provide any tools to graphically display the data saved there. The Perf2rrd author
    Marc DeTrano refers here to the **`drraw`** tool (see [19.4 The Graphics Specialist
    drraw](../Text/ch19s04.html "19.4 The Graphics Specialist drraw"), page 420).
    It can be advantageous to use this, because on the one hand **`drraw`** allows
    far more than just the one display provided by Nagiosgraph, and on the other hand
    you do not have to struggle with regular expressions in Perl.
  prefs: []
  type: TYPE_NORMAL
- en: 19.3.1 Installation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'For the installation you should get hold of the archive in tar format from
    [http://perf2rrd.sf.net/](http://perf2rrd.sf.net/), and copy it, preferably to
    the **`/usr/local hierarchy`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE89]'
  prefs: []
  type: TYPE_PRE
- en: The executable program that is later run is a script called **`run`**, which
    in turn calls the Java bytecode interpreter, **`java`**. Besides this the directory
    contains the Java class files and other utilities, with which you can recompile
    the included shared library **`librrdj.so`**, if required. This is normally not
    necessary for the newer distributions.
  prefs: []
  type: TYPE_NORMAL
- en: 'In order for **`run`** to be able to find the **`java`** program, it must be
    located in **`/usr/bin`**. If this is not the case (because you have installed
    the Java archive from [http://www.sun.com/](http://www.sun.com/), for example),
    then you should set a link:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE90]'
  prefs: []
  type: TYPE_PRE
- en: 'A short test shows whether or not Perf2rrd starts correctly:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE91]'
  prefs: []
  type: TYPE_PRE
- en: The error message issued in the last line is not a problem at the moment, since
    we have saved the RRD databases in a different directory anyway ([Perf2rrd in
    permanent operation](../Text/ch19s03.html#perf2rrd_in_permanent_operation "Perf2rrd
    in permanent operation")).
  prefs: []
  type: TYPE_NORMAL
- en: 19.3.2 Nagios configuration
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Perf2rrd searches in the Nagios configuration for all the data it requires:
    to what file Nagios should write the performance data, the write mode used for
    this,^([[199](#ftn.CHP-19-FN-7)]) and the format of the template:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE92]'
  prefs: []
  type: TYPE_PRE
- en: 'The named pipe used here, thanks to **`service_perfdata_file_mode=w`**, must
    be created manually—Perf2rrd 1.0 in Nagios 2.0 has problems with the normal file
    interface (**`service_perfdata_file_mode=a`**):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE93]'
  prefs: []
  type: TYPE_PRE
- en: 'In the template the introductory [**`SERVICEPERFDATA`**] stamp is missing (see
    [19.1 Processing Plugin Performance Data with Nagios](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 Processing Plugin Performance Data with Nagios")), since Perf2rrd 1.0 does
    not parse this correctly. Changes to the Nagios configuration require a reload:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE94]'
  prefs: []
  type: TYPE_PRE
- en: 'Finally you create the directory for the RRD databases:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE95]'
  prefs: []
  type: TYPE_PRE
- en: 19.3.3 Perf2rrd in practice
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Loading the Java Virtual Machine each time Perf2rrd is started requires considerable
    resources. For this reason you should not use the method of startingPerf2rrdwiththeparameter
    **`service_perfdata_file_processing_command`** at specific intervals of Nagios,
    and also should not use the *one-shot mode*, with **`./run -o`**, in which the
    software processes one file at a time. In theory this would make it possible to
    run Perf2rrd regularly with a cron job. Instead, it is recommended that you keep
    the program running permanently.
  prefs: []
  type: TYPE_NORMAL
- en: 'When using this for the first time, we recommend that you switch on the debugging
    mode, which will show any problems that occur. The option **`-d`** specifies the
    directory in which the tools should create and update the RRD databases:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE96]'
  prefs: []
  type: TYPE_PRE
- en: The output of the Nagios configuration file, the RRD repository, and the data
    transfer mode (**`named pipe`**) is followed by the time unit used by Nagios (and
    set with the **`interval_length`** parameter). Normally this is 60 seconds, that
    is, a check interval of **`5`** is five minutes long. It is extremely important
    that this parameter is correctly recognized, since Perf2rrd determines the *step
    interval* of the RRD database by multiplying the **`normal_check_interval`** and
    **`interval_length`** parameters together.
  prefs: []
  type: TYPE_NORMAL
- en: All measured values that occur during a step interval are averaged by the database.
    If this time period is too small, it is possible that the database will never
    issue any values, since it expects considerably more data than it obtains for
    saving.
  prefs: []
  type: TYPE_NORMAL
- en: While Nagiosgraph works with a fixed five-minute interval, Perf2rrd adjusts
    itself to the Nagios configuration. The software only takes into account the interval
    when creating the RRD database, however; changing the Nagios configuration later
    on has no further consequences. The only thing you can do here to alter this is
    delete the RRD database and set it up again.
  prefs: []
  type: TYPE_NORMAL
- en: Perf2rrd in permanent operation
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Operating Perf2rrd on a named pipe has one disadvantage: if Nagios restarts,
    it closes the pipe before opening it again. Unfortunately when the pipe closes,
    Perf2rrd closes as well.'
  prefs: []
  type: TYPE_NORMAL
- en: 'This can be prevented by the use of the Daemon Tools by Daniel J. Bernstein.
    They monitor programs and restart them, if these programs should ever stop. They
    are themselves started through an **`/etc/inittab`** entry by the init process,
    and are restarted if they were to shut themselves down at some point. The Daemon
    Tools tar file can be obtained from [http://cr.yp.to/daemorLtools/install.html](http://cr.yp.to/daemorLtools/install.html)
    and it is unpacked in the directory **`/usr/local/src`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE97]'
  prefs: []
  type: TYPE_PRE
- en: 'This creates the directory **`admin/daemontools-0.76`**, with the subdirectories
    **`package`** and **`src`**. From there you should run the **`install`** script,
    which compiles and installs the program:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE98]'
  prefs: []
  type: TYPE_PRE
- en: The binaries land in the newly created directory **`daemontools-0.76/com-mand`**
    and remain there. The installation routine also sets up symbolic links pointing
    to them from the—also newly created—folder**`/command`**.
  prefs: []
  type: TYPE_NORMAL
- en: 'The **`install`** script also includes the following line in the file **`/etc/init-tab`**,
    which ensures that the Daemon Tools run permanently:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE99]'
  prefs: []
  type: TYPE_PRE
- en: 'The program **`svscanboot`** searches regularly for new or crashed daemons.
    For this purpose it scans the **`/service`** directory, which is also created
    during the installation. Just one symbolic link is required to have Perf2rrd monitored:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE100]'
  prefs: []
  type: TYPE_PRE
- en: 'The Daemon Tools search in this directory for a script called **`run`** and
    start it. In order for **`run`** to be able to find the path to the RRD repository,
    an actual command-line option is entered in the script file instead of **`$*`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE101]'
  prefs: []
  type: TYPE_PRE
- en: 'Starting and ending Perf2rrd is now taken over by the program **`svc`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE102]'
  prefs: []
  type: TYPE_PRE
- en: The **`-d`** option (for *down*) stops the service specified, and **`-u`** (*up*)
    starts it again. It is not necessary to run it at the beginning, since the Daemon
    Tools regularly scan the **`/service`** directory for new services and automatically
    start them. This is important insofar as the Nagios-2.0 beta versions, on which
    this book is based, had problems if the configured named pipe was not read. Then
    it might not deliver any more data at all until a reload or restart. Whether this
    problem has been fixed in the final version 2.0 of Nagios could not be clarified
    at the time of going to press.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[199](#CHP-19-FN-7)]) With **`a`**, Nagios appends the data to a normal log
    file; with **`w`** it makes it accessible through a named pipe. See [19.1 Processing
    Plugin Performance Data with Nagios](../Text/ch19.html#processing_plugin_performance_data_with
    "19.1 Processing Plugin Performance Data with Nagios"), page 404.
  prefs: []
  type: TYPE_NORMAL
- en: 19.4 The Graphics Specialist **`drraw`**
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: From the RRD databases, generated for example by Perf2rrd or Nagios-graph, the
    CGI script **`drraw`** creates interactive graphics—simple ones relatively quicky,
    whereas for more complex ones you need to know a bit more about the RRDtools.^([[200](#ftn.CHP-19-FN-8)])
  prefs: []
  type: TYPE_NORMAL
- en: 19.4.1 Installation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'For the **`drraw`** installation, you need to obtain the current tar file from
    [http://www.taranis.org/drraw/](http://www.taranis.org/drraw/) and unpack it to
    its own subdirectory in the CGI hierarchy^([[201](#ftn.CHP-19-FN-9)]) on the Web
    server:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE103]'
  prefs: []
  type: TYPE_PRE
- en: The directory created by this is then renamed to **`drraw`**:^([[202](#ftn.CHP-19-FN-10)])
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE104]'
  prefs: []
  type: TYPE_PRE
- en: '**`drraw.cgi`** itself requires, apart from Perl, the Perl CGI module (**`CGI.pm`**),
    and the RRDtools, from at least version 1.0.47; nothing will work below version
    1.0.36\. If your distribution does not include a current version, you should obtain
    the sources from [http://www.rrdtool.org/](http://www.rrdtool.org/) and compile
    them yourself:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE105]'
  prefs: []
  type: TYPE_PRE
- en: The CGI script **`drraw.cgi`** uses the Perl module **`RRDs`**, which after
    the installation with **`make site-perl-install`**, is found automatically.
  prefs: []
  type: TYPE_NORMAL
- en: 19.4.2 Configuration
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The **`drraw`** configuration is contained in the file **`drraw.conf`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE106]'
  prefs: []
  type: TYPE_PRE
- en: 'The extract shown specifies the RRD repository (here: **`/var/lib/rrd`**) as
    the most important detail, but several directories can also be specified:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE107]'
  prefs: []
  type: TYPE_PRE
- en: The text in square brackets (e.g., [**`RRDbase`**]) appears later on the Web
    interface, which allows a distinction to be made between various different repositories.
    The variables **`@dv_def`**, **`@dv_name`**, and **`@dv_secs`** influence the
    layout and number of graphics.
  prefs: []
  type: TYPE_NORMAL
- en: 'The configuration shown above generates one graphic more than the standard
    configuration. This represents the past six hours: the extended statement **`''end--6
    hours''`** in **`@dv_def`** describes the time period for **`rrdtool`** (see **`man
    rrdgraph`**), in **`@dv_name`** the representation is given a suitable title with
    **`''Past 6 Hours''`**, and **`@dv_secs`** contains the six hours, converted into
    (**`21600`**) seconds, displayed by **`drraw`** as a time period in a separate
    graphic.'
  prefs: []
  type: TYPE_NORMAL
- en: 'The repository must be readable for the user with whose rights the Web server
    is running, and the directories specified in **`$saved_dir`** and **`$tmp_dir`**
    must also be readable. If a user other than **`www-data`** runs this, the following
    command must be adapted accordingly:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE108]'
  prefs: []
  type: TYPE_PRE
- en: Data arrives in the temporary directory **`$temp_dir`**, whose contents can
    be deleted at any time, whereas in **`$saved_dir drraw`** stores configuration
    data which the program needs in order to access already created graphics later
    on. This data must not be lost.
  prefs: []
  type: TYPE_NORMAL
- en: '**`drraw`** implements asimple access protection in three stages: read-only
    (**`0`**), restricted editing (**`1`**), and full access (**`2`**). Users logged
    in to the Web server automatically obtain level 2\. Nonauthorized users are treated
    as **`guests`** and assigned level **`0`**. To avoid the hassle with authentication
    at the beginning, you can grant the user **`guest`** full access via the following
    directive in the configuration file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE109]'
  prefs: []
  type: TYPE_PRE
- en: 19.4.3 Practical application
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The CGI script in the CGI directory of the Web server can be addressed through
    the URL [http://nagiosserver/cgi-bin/drraw/drraw.cgi](http://nagiosserver/cgi-bin/drraw/drraw.cgi).
  prefs: []
  type: TYPE_NORMAL
- en: '![The ddraw start menu](../Images/tagoreillycom20081104nostarchimages223962.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 19-2. The `ddraw` start menu
  prefs: []
  type: TYPE_NORMAL
- en: New graphics are generated in the menu item **Create a new graph** in the start
    picture, which is shown in [Figure 19-2](../Text/ch19s04.html#the_ddraw_start_menu
    "Figure 19-2. The ddraw start menu"). The dialog shown in [Figure 19-3](../Text/ch19s04.html#selecting_the_data_source
    "Figure 19-3. Selecting the data source") allows the appropriate RRD database
    to be selected. Using a regular expression^([[203](#ftn.CHP-19-FN-11)]) in the
    **Data Source filter regexp** field, the data sources available can be further
    restricted; this expression can also be a simple literal text, such as **`sap-12`**.
  prefs: []
  type: TYPE_NORMAL
- en: '![Selecting the data source](../Images/tagoreillycom20081104nostarchimages223964.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 19-3. Selecting the data source
  prefs: []
  type: TYPE_NORMAL
- en: 'Once you have chosen an RRD database, you just need to specify the *round-robin
    archive* (RRA) to be used. Each of these archives saves data in a particular form,
    processed with a consolidation function: the **`AVERAGE`** function averages all
    measurement data that accumulates in a measurement period, **`MIN`** saves only
    the minimum value of the data in an interval, and **`MAX`** saves only the maximum.
    Since the original data is lost, the archives must be specified when the round-robin
    database is created; maximum values can only be recalled later if this was taken
    into account at the time.'
  prefs: []
  type: TYPE_NORMAL
- en: If you cannot remember what archives exist, you can display them using the button
    **`RRD Info for selected DB`**. Clicking on the **`Add DB(s) to Data Sources`**
    button takes you to a dialog where you first have to scroll down a bit to reach
    the item **`Data Source Configuration`** ([Figure 19-4](../Text/ch19s04.html#fine-tuning_the_graphic_configuration
    "Figure 19-4. Fine-tuning the graphic configuration")). There you can fine-tune
    the desired graph—now or later. You can define your own colors, and whether a
    line or a surface will be shown. You should only make use of the other possibilities
    if you are familiar with the concepts of the RRDtools and the way they work^([[204](#ftn.CHP-19-FN-12)])
  prefs: []
  type: TYPE_NORMAL
- en: The **Update** button provides a preview of the finished graphic, which at the
    same time reveals the **`rrdtool`** options used ([Figure 19-5](../Text/ch19s04.html#preview_and_specifying_the_rrdtool
    "Figure 19-5. Preview and specifying the rrdtool options")). When you save, with
    **Save Graph**, you obtain a link in the form
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE110]'
  prefs: []
  type: TYPE_PRE
- en: with which the graphic can be accessed at any time. Alternatively you can now
    find the graphic in the **`drraw`** starting menu under **All Graphs**.
  prefs: []
  type: TYPE_NORMAL
- en: '![Fine-tuning the graphic configuration](../Images/tagoreillycom20081104nostarchimages223966.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 19-4. Fine-tuning the graphic configuration
  prefs: []
  type: TYPE_NORMAL
- en: '![Preview and specifying the rrdtool options](../Images/tagoreillycom20081104nostarchimages223968.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 19-5. Preview and specifying the `rrdtool` options
  prefs: []
  type: TYPE_NORMAL
- en: '![The finished graphic represents different time periods](../Images/tagoreillycom20081104nostarchimages223970.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 19-6. The finished graphic represents different time periods
  prefs: []
  type: TYPE_NORMAL
- en: 'The link mentioned when you save a graphic can be recorded in a **`service-extinfo`**
    object, making it directly accessible through the Nagios interface:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE111]'
  prefs: []
  type: TYPE_PRE
- en: With templates and dashboards, **`drraw`** includes other features, which cannot
    be discussed in detail here, for reasons of space. Templates allow several sources
    of the same type to be shown in the same graphic. What these are can be specified
    in **Create a new Graph** (see [Figure 19-3](../Text/ch19s04.html#selecting_the_data_source
    "Figure 19-3. Selecting the data source")). Since you can only add one source
    at a time there, you must click the **Add** button for each separate source, before
    moving on to the next one.
  prefs: []
  type: TYPE_NORMAL
- en: A dashboard presents a display containing several preview graphics. If you click
    on one of the graphics, you are shown the detailed representation. The interactive
    menu **Create a Dashboard** contains brief instructions where you can obtain help
    on the two features.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[200](#CHP-19-FN-8)]) Apart from the documentation on the homepage [http://www.rrdtool.org/](http://www.rrdtool.org/),
    the tutorial included (**`man rrdtutorial`**) is a useful starting point, as well
    as the man page **`man rrdgraph`**.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[201](#CHP-19-FN-9)]) Which directory this is depends on the distribution
    or Apache configuration you are using.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[202](#CHP-19-FN-10)]) A symbolic link would also be possible, but then Apache
    must be configured so that it follows symbolic links, which is normally not automatically
    the case.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[203](#CHP-19-FN-11)]) POSIX regular expression; see **`man 7 regex`**.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[204](#CHP-19-FN-12)]) There are a number of tutorials on the homepage of
    the RRDtools author, Tobias Oetiker, at [http://people.ee.ethz.ch/~oetiker/webtools/rrdtool/tut/index.en.html](http://people.ee.ethz.ch/~oetiker/webtools/rrdtool/tut/index.en.html).
  prefs: []
  type: TYPE_NORMAL
- en: '19.5 Automated to a Large Extent: NagiosGrapher'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: NagiosGrapher from Netways, the host of The Nagios Exchange Platform [http://www.nagiosexchange.org/](http://www.nagiosexchange.org/),
    is a powerful representation tool for performance data, but already a very powerful
    one. This also saves data in round-robin databases and uses the RRDtools for processing
    and representation. It claims to be easy to install and to work automatically
    to a large extent in contrast to the "competition." The latter promise has so
    far not been kept; as in Nagiosgraph, you have to configure search patterns in
    order to interpret the plugin output or performance data correspondingly. The
    RRD databases are generated by NagiosGrapher automatically; in addition to this,
    the tool **`serviceextinfo`** also generates entries.
  prefs: []
  type: TYPE_NORMAL
- en: As soon as it once recognizes the performance data, you don't have to worry
    any more about integrating it into Nagios. A reload is sufficient to make the
    **`serviceextinfo`** entries generated in the meantime usable in Nagios. The entries
    are created "intelligently," so that if you click on the corresponding icon in
    the service summary (see [Figure 19-7](../Text/ch19s05.html#the_nagiosgrapher_icon_open_parenthesis
    "Figure 19-7. The NagiosGrapher icon (arrow) in the Nagios Web interface indicates
    a time-related evaluation for this service") in page 434), you are taken directly
    to the graphic display of the performance data.
  prefs: []
  type: TYPE_NORMAL
- en: 'As far as functionality and installation efforts are concerned, NagiosGrapher
    lies somewhere between Nagiosgraph and Perf2rrd: the initial configuration needed
    is somewhat more than for Nagiosgraph, but the possibilities of variations in
    the graphic output are considerably larger, and you do not have to generate each
    graphic individually, as is the case with Perf2rrd/**`drraw`**.'
  prefs: []
  type: TYPE_NORMAL
- en: 19.5.1 Installation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In addition to the RRDtools (in version 1.2, at least) and the program **`auto-conf`**,
    NagiosGrapher requires a series of Perl modules: **`CGI`**, **`CGI::Carp`**, **`Calendar::
    Simple`**,**`Carp`**,**`Data:: Dumper`**, **`File::Basename`**,**`File::Copy`**,
    **`GD`**, **`IO::Handle`**, **`Image::Magick`**, **`POSIX`**, **`RRDs`**, **`Storable`**,
    **`Time::HiRes`**, **`Time :: Local`**, and **`URI::Escape`**.'
  prefs: []
  type: TYPE_NORMAL
- en: There are two alternatives for installing them, namely from the packages included
    in the distribution or from CPAN. On Debian "Etch" and comparable Debian-based
    systems, you have all the modules if you select the packages **`autoconf`**,**`rrdtool`**,**`perl-modules`**,**`libcalendar-simple-perl`**,**`libgd-gd2-perl`**,**`perlmagick`**,**`librrds-perl`**,
    and **`liburi-perl`** for installation. In other distributions you must search
    for the above-mentioned modules, preferably using the graphic package installer
    in the distribution. You can see whether you have installed all the required modules
    by running **`make testdeps`** after the **`configure`** command. Installing each
    of the most current module versions from the CPAN is done with the command **`make
    fixdeps`**.
  prefs: []
  type: TYPE_NORMAL
- en: 'The NagiosGrapher sources can be obtained from NagiosExchange,^([[205](#ftn.CHP-19-FN-13)])
    and they are unpacked into the directory **`/usr/local/src`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE112]'
  prefs: []
  type: TYPE_PRE
- en: The command **`autoconf`** generates a **`configure`** script. Before you run
    this, edit the file **`config.layout`**, which provides various *layouts*. In
    the NagiosGrapher documentation, this term means the definition of all installation
    paths that are required.
  prefs: []
  type: TYPE_NORMAL
- en: '**`config.layout`** contains a series of distribution-dependent suggestions
    that need to be changed in certain aspects in order to comply with the conventions
    in this book. For this purpose it is best if you copy the section that matches
    your distribution and rename it to **`<Layout nagiosbook>`** and modify a number
    of entries.^([[206](#ftn.CHP-19-FN-14)]) For Debian "Etch," the following entries
    apply (the changed values are shown in bold print):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE113]'
  prefs: []
  type: TYPE_PRE
- en: The path for the Perl modules defined in the parameter **`perl_inc`** corresponds
    in this case to the directory suggested by Ton Voon for the Perl module **`Nagios::Plugin`**
    (see [The method using the CPAN](../Text/ch24s02.html#the_method_using_the_cpan
    "The method using the CPAN")).
  prefs: []
  type: TYPE_NORMAL
- en: 'The new layout is included in the **`configure`** script:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE114]'
  prefs: []
  type: TYPE_PRE
- en: 'You can run **`make`** **`testdeps`** to check whether all dependencies, especially
    the ones for the Perl modules, have been met:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE115]'
  prefs: []
  type: TYPE_PRE
- en: If an error occurs, as in this example, you must install the appropriate module
    (here **`Calendar::Simple`**). This can be done from the CPAN with the command
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE116]'
  prefs: []
  type: TYPE_PRE
- en: 'For Debian-based distributions, the package naming scheme is quite simple:
    The Perl module **`Calendar:: Simple`** is turned into the package **`lib-calendar-simple-perl`**,
    which is installed with **`apt-get`** or **`aptitude`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE117]'
  prefs: []
  type: TYPE_PRE
- en: Running **`make testdeps`** again shows whether all requirements have now been
    met.
  prefs: []
  type: TYPE_NORMAL
- en: 'An already installed NagiosGrapher is updated with **`make update`**, since
    the **`make install`**, intended for a new installation, does not take account
    of already existing configuration files and simply overwrites them.^([[207](#ftn.CHP-19-FN-15)])
    **`make install`** creates all the necessary directories, ensures that the correct
    access permissions are set, and copies all the files to where they should go:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE118]'
  prefs: []
  type: TYPE_PRE
- en: The output of **`make`** ends with some instructions on the configuration of
    NagiosGrapher and of Nagios, which we will examine in more detail in [19.5.1 Installation](../Text/ch19s05.html#installation-id7
    "19.5.1 Installation") and [Advanced options of graphic reprocessing](../Text/ch19s05.html#advanced_options_of_graphic_reproces
    "Advanced options of graphic reprocessing").
  prefs: []
  type: TYPE_NORMAL
- en: 'A core component of NagiosGrapher is the daemon **`collect2.pl`**, which is
    started via the startup script **`nagios_grapher`** in **`/etc/init.d`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE119]'
  prefs: []
  type: TYPE_PRE
- en: 'So that the daemon starts automatically on system start, corresponding symlinks
    are set in distributions that use the system V init. On Debian/Ubuntu this is
    done by the system script **`update-rc.d`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE120]'
  prefs: []
  type: TYPE_PRE
- en: 'OpenSUSE includes the script **`insserv`** for this purpose:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE121]'
  prefs: []
  type: TYPE_PRE
- en: 'In Fedora this task is performed by **`chkconfig`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE122]'
  prefs: []
  type: TYPE_PRE
- en: 19.5.2 Configuration
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The configuration file **`ngraph.ncfg`**
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: The configuration file **`ngraph.ncfg`** contains a global **`config`** section
    with paths and general settings. This is followed by an include instruction with
    the parameter **`cfg_dir`**, which, as in Nagios, integrates all the configuration
    files located in the directory specified. In contrast to Nagios, the configuration
    files for NagiosGrapher all end in **`.ncfg`**.
  prefs: []
  type: TYPE_NORMAL
- en: 'It can be seen even from a quick glance that the syntax complies with the convention
    used by Nagios:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE123]'
  prefs: []
  type: TYPE_PRE
- en: 'The **`config`** section contains the following parameters:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`interface`**'
  prefs: []
  type: TYPE_NORMAL
- en: This defines the type of connection to Nagios. Possible connections are **`pipe`**,
    **`network`**, and **`file`**. For the **`pipe`** type, Nagios and the **`collect2.pl`**
    daemon communicate via a named pipe (see the **`pipe`** parameter); for the **`network`**
    type, Nagios sends the performance data via the UDP transport protocol over a
    network socket (see parameter **`port`**).
  prefs: []
  type: TYPE_NORMAL
- en: In contrast to the interface types just described, the **`file`** type (available
    from version 1.7) makes use of the template mechanism,^([[208](#ftn.CHP-19-FN-16)])
    which means that Nagios writes the performance data to a file which is periodically
    evaluated by the daemon **`collect2.pl`**. This makes possible, for the first
    time, bulk processing of performance data, thus saving resources. The default
    interface type is **`pipe`** up to version 1.6, and **`file`** from version 1.7.
  prefs: []
  type: TYPE_NORMAL
- en: '**`perffile_path`**'
  prefs: []
  type: TYPE_NORMAL
- en: This defines the directory for the file to which Nagios writes all performance
    data via the template mechanism.
  prefs: []
  type: TYPE_NORMAL
- en: '**`pipe`**'
  prefs: []
  type: TYPE_NORMAL
- en: This defines a named pipe to which Nagios writes data with the program **`fifo_write`**
    and from which the collector script **`collect2.pl`** reads them out again. The
    named pipe is created automatically by **`make install`** from version 1.6.1.
  prefs: []
  type: TYPE_NORMAL
- en: '**`port`**'
  prefs: []
  type: TYPE_NORMAL
- en: This specifies the UDP port for the **`network`** communication type. The default
    is **`5667`**.
  prefs: []
  type: TYPE_NORMAL
- en: '**`buffer`**'
  prefs: []
  type: TYPE_NORMAL
- en: This determines the size of the buffer for sending performance data via UDP
    in bytes. The default is 1024 bytes.
  prefs: []
  type: TYPE_NORMAL
- en: '**`pidfile`**'
  prefs: []
  type: TYPE_NORMAL
- en: This defines the file to which NagiosGrapher writes its own process ID on starting.
  prefs: []
  type: TYPE_NORMAL
- en: '**`user, group`**'
  prefs: []
  type: TYPE_NORMAL
- en: These define the user and group with whose permissions the daemon **`collect2.pl`**
    runs. Here it makes sense to specify the user and group with whose permissions
    Nagios is working.
  prefs: []
  type: TYPE_NORMAL
- en: '**`step`**'
  prefs: []
  type: TYPE_NORMAL
- en: This defines the step size in seconds for the RRD database. All values recorded
    during this period are summarized by the RRDtools in a single value. **`step`**
    therefore also describes the smallest time resolution of data in the RRD database.
    The value only has an effect on newly created RRD databases, and a modification
    made later on has no effect on existing databases.
  prefs: []
  type: TYPE_NORMAL
- en: '**`heartbeat`**'
  prefs: []
  type: TYPE_NORMAL
- en: The heartbeat defines a time period in seconds, during which the RRD database
    always expects data. If no measured value at all arrives during this period, NagiosGrapher
    generates an invalid entry (**`nan`**, *not a number*).
  prefs: []
  type: TYPE_NORMAL
- en: In order for valid entries to materialize in the above example, at least one
    measured value must arrive every **`600`** seconds. Since the resolution is **`60`**
    seconds, the database contains ten entries for the period of the "heartbeat."
    If one of these values is missing, NagiosGrapher simply replaces it with the last
    valid one. If just one measured value arrives in ten minutes, it will be recorded
    ten times in the database.
  prefs: []
  type: TYPE_NORMAL
- en: '**`rrdpath`**'
  prefs: []
  type: TYPE_NORMAL
- en: This specifies the directory for the RRD databases. It must be writable for
    the user **`nagios`** and (along with the database files) readable for the Web
    server user. The directory is created automatically during the installation of
    NagiosGrapher.
  prefs: []
  type: TYPE_NORMAL
- en: '**`tmppath`**'
  prefs: []
  type: TYPE_NORMAL
- en: This defines where NagiosGrapher temporarily saves internal XML files.
  prefs: []
  type: TYPE_NORMAL
- en: '**`fontfile`**'
  prefs: []
  type: TYPE_NORMAL
- en: This specifies the font file for the font used by the RRDtools for labeling
    the graphics.
  prefs: []
  type: TYPE_NORMAL
- en: '**`serviceext_type`**'
  prefs: []
  type: TYPE_NORMAL
- en: This describes how the **`serviceextinfo`** objects are created. With the **`SINGLE`**
    type, NagiosGrapher writes everything to the file specified in **`serviceextinfo`**.
  prefs: []
  type: TYPE_NORMAL
- en: Nagios 2.0 can also read directories recursively, and in this case it is better
    to use the **`MULTIPLE`** type. Then NagiosGrapher creates a separate file for
    each host with the corresponding **`serviceextinfo`** object. The directory is
    specified with the **`serviceext_path`** parameter. This must be made known to
    Nagios through the **`cfg_dir`** directive.
  prefs: []
  type: TYPE_NORMAL
- en: '**`url`**'
  prefs: []
  type: TYPE_NORMAL
- en: This contains the path to the CGI script **`graphs.cgi`** from the point of
    view of the Web server (a path starting from the server root) or of the browser
    (that is, the complete URL).
  prefs: []
  type: TYPE_NORMAL
- en: '**`notes_url`**'
  prefs: []
  type: TYPE_NORMAL
- en: NagiosGrapher automatically generates **`serviceextinfo`** objects; it is useful
    to also be able to set the parameter **`notes_url`** ([16.4.2 Extended service
    information](../Text/ch16s04.html#extended_service_information "16.4.2 Extended
    service information") from page 366), for example, to generate a service-related
    link to a Wiki entry.
  prefs: []
  type: TYPE_NORMAL
- en: '**`nagios_config`**'
  prefs: []
  type: TYPE_NORMAL
- en: This reveals to NagiosGrapher where the standard configuration file of Nagios
    is located.
  prefs: []
  type: TYPE_NORMAL
- en: '**`cgi_config`**'
  prefs: []
  type: TYPE_NORMAL
- en: This specifies the Nagios CGI configuration file. NagiosGrapher uses this to
    find out who, apart from the contact groups, has the right to query information
    on all hosts.
  prefs: []
  type: TYPE_NORMAL
- en: '**`icon_image_tag`**'
  prefs: []
  type: TYPE_NORMAL
- en: This parameter corresponds to the entry that is later to be found in the **`serviceextinfo`**
    object as the **`icon_image`** parameter. In the **`serviceextinfo`** object,
    NagiosGrapher replaces the text **`###URL###`** with the host and service names.
    The entry **`###IMAGESRC###`**, on the other hand, is replaced by NagiosGrapher
    with the contents of the parameter **`icon_image_src`**.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here the program outwits Nagios with a trick: **`dot.png`** is a graphic that
    is one pixel in size, which is invisible on the screen. To create a second, visible
    icon, **`graph.png`**, around it, a hyperlink is set to the CGI script **`graphs.cgi`**.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Normally if you click on an image specified in **`icon_image`**, Nagios will
    take you to the **`Extended info`** page, and the graphic can be reached at **`url`**
    (Nagios: **`notes_url`**) only with another mouse click. With the trick used here,
    you can do this directly.'
  prefs: []
  type: TYPE_NORMAL
- en: The specification following **`icon_image_tag`** must be written on a single
    line. [Figure 19-7](../Text/ch19s05.html#the_nagiosgrapher_icon_open_parenthesis
    "Figure 19-7. The NagiosGrapher icon (arrow) in the Nagios Web interface indicates
    a time-related evaluation for this service") shows the icon **`graph.png`**, which
    is visible on the Nagios interface, thanks to the automatically generated **`serviceextinfo`**
    objects.
  prefs: []
  type: TYPE_NORMAL
- en: '![The NagiosGrapher icon (arrow) in the Nagios Web interface indicates a time-related
    evaluation for this service](../Images/tagoreillycom20081104nostarchimages223972.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 19-7. The NagiosGrapher icon (arrow) in the Nagios Web interface indicates
    a time-related evaluation for this service
  prefs: []
  type: TYPE_NORMAL
- en: '**`icon_image_static`**'
  prefs: []
  type: TYPE_NORMAL
- en: This specifies whether the icon integrated in [Figure 19-7](../Text/ch19s05.html#the_nagiosgrapher_icon_open_parenthesis
    "Figure 19-7. The NagiosGrapher icon (arrow) in the Nagios Web interface indicates
    a time-related evaluation for this service") is generated statically or dynamically.
    Possible values are **`true`** (static icon) or **`false`** (dynamically generated
    icon).
  prefs: []
  type: TYPE_NORMAL
- en: '**`icon_image_src`**'
  prefs: []
  type: TYPE_NORMAL
- en: This specifies astatic icon, which NagiosGrapher integrates into **`icon_image_tag`**.
  prefs: []
  type: TYPE_NORMAL
- en: '**`icon_image_script`**'
  prefs: []
  type: TYPE_NORMAL
- en: This defines a script that generates a mini-view of a graph rather than a dynamic
    icon.
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_file`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'This defines the log file to which the NagiosGrapher writes information. If
    you want log rotation, you have to set it up yourself, as NagiosGrapher does not
    clean up automatically. Because Nagios requries write permissions for the file,
    it is better stored in the Nagios **`var`** directory (in this case: **`/var/nagios`**).'
  prefs: []
  type: TYPE_NORMAL
- en: '**`log_level`**'
  prefs: []
  type: TYPE_NORMAL
- en: This parameter specifies what information the log file should contain. Possible
    values are **`1`** (detected services and values), **`2`** (performance data delivered
    by Nagios which has not been recognized by NagiosGrapher), **`4`** (program states),
    **`8`** (information on the **`serviceextinfo`** object), **`16`** (RRD actions),
    and **`32`** (input which is read from the pipe). For more extensive debugging,
    there are the values **`64`** (details of how regular expressions are parsed)
    and **`128`** (advanced information on how the configuration files are parsed).
  prefs: []
  type: TYPE_NORMAL
- en: If you want to log several of these information types, you just add the relevant
    values together, so the most extensive output is obtained with **`255`**; page
    445 shows an example of this. It is recommended that you only use these log levels
    for debugging purposes, and you should normally use **`0`** or **`4`**.
  prefs: []
  type: TYPE_NORMAL
- en: '**`rrd_color_*`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The **`rrd_color`** options bring color to the Web interface ([Figure 19-8](../Text/ch19s05.html#the_influence_of_the_rrd_underscore
    "Figure 19-8. The influence of the rrd_color_* color options")): **`rrd_color_background`**
    defines the background color for the entire image, **`rrd_color_font`** the font
    color, **`rrd_color_arrow`** the color of the arrow tips, **`rrd_color_frame`**
    the frame color for the keys, **`rrd_color_grid`** the grid color, and **`rrd_color_canvas`**
    the background of the diagram itself. **`rrd_color_shadea`** defines the colors
    for the top and left of the frame, and **`rrd_color_shadeb`** does so for the
    right and bottom of the frame. Colors are specified as RGB values in hexadecimal
    notation, with a preceding **`#`**, as is the norm for Web pages. Changes to these
    options take effect immediately the next time the Web page is reloaded.'
  prefs: []
  type: TYPE_NORMAL
- en: '![The influence of the rrd_color_* color options](../Images/tagoreillycom20081104nostarchimages223974.png)'
  prefs: []
  type: TYPE_IMG
- en: Figure 19-8. The influence of the `rrd_color_*` color options
  prefs: []
  type: TYPE_NORMAL
- en: '**`fe_use_browser_all`**'
  prefs: []
  type: TYPE_NORMAL
- en: From version 1.2, NagiosGrapher provides a method of switching from the display
    of a specific service to that of other services for any host at all. To do this
    it integrates a selection window into the **`graphs.cgi`** display (see [Figure 19-9](../Text/ch19s05.html#whether_nagiosgrapher_shows_the_host
    "Figure 19-9. Whether NagiosGrapher shows the host and services fields is determined
    by the fe_use_browser parameters")).
  prefs: []
  type: TYPE_NORMAL
- en: The value **`1`** activates the pulldown menus **`host`** and **`service`**,
    **`0`** hides them.
  prefs: []
  type: TYPE_NORMAL
- en: '![Whether NagiosGrapher shows the host and services fields is determined by
    the fe_use_browser parameters](../Images/tagoreillycom20081104nostarchimages223976.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 19-9. Whether NagiosGrapher shows the `host` and `services` fields is
    determined by the `fe_use_browser` parameters
  prefs: []
  type: TYPE_NORMAL
- en: '**`fe_use_browser_for`**'
  prefs: []
  type: TYPE_NORMAL
- en: This option allows particular users to use the host/service selection. Several
    users can be specified, separated by commas. So that only the users specified
    here can see the selection fields for **`host`** and **`service`**, **`fe_use_browser_all`**
    must also be set to **`0`** at the same time.
  prefs: []
  type: TYPE_NORMAL
- en: '**`fe_use_browser_url`**'
  prefs: []
  type: TYPE_NORMAL
- en: This option allows the selection fields for **`host`** and **`service`** to
    be inserted through the URL **`graphs.cgi?browser=l`**, provided the value is
    **`1`**. This is not possible if the value is **`0`**.
  prefs: []
  type: TYPE_NORMAL
- en: '**`fe_use_timefilter`**'
  prefs: []
  type: TYPE_NORMAL
- en: This controls whether the time selection via **Start** and **End** appears in
    the browser menu (see [Figure 19-9](../Text/ch19s05.html#whether_nagiosgrapher_shows_the_host
    "Figure 19-9. Whether NagiosGrapher shows the host and services fields is determined
    by the fe_use_browser parameters") in page 436). The value **`true`** displays
    the selection, **`false`** hides it.
  prefs: []
  type: TYPE_NORMAL
- en: '**`use_authentication`**'
  prefs: []
  type: TYPE_NORMAL
- en: This defines whether NagiosGrapher should take the result of authentication
    by Nagios into account or not. The value **`true`** allows the observer only to
    access hosts and services for which he is responsible as the contact. The value
    **`false`** switches off authentication entirely, so that everyone has access
    to everything.
  prefs: []
  type: TYPE_NORMAL
- en: 'The **`cfg_dir`** configuration parameter already mentioned in [19.5.1 Installation](../Text/ch19s05.html#installation-id7
    "19.5.1 Installation") defines a directory containing additional configuration
    files, in particular the definition of the various graphs:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE124]'
  prefs: []
  type: TYPE_PRE
- en: NagiosGrapher examines it recursively for configuration files of any name; they
    just need to end in **`.ncfg`**. The parameter must stand outside the **`config{}`**
    block; there has to be an = sign between the parameter and the value.
  prefs: []
  type: TYPE_NORMAL
- en: Configuring the graphics—the basic principle
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**`ngraph`** objects are used to define what data is to be extracted and written
    to an RRD database, but the objects also contain information on the display form.
    Like Nagios, NagiosGrapher saves the information temporarily in a cache file,
    which is why the data collection script **`collect2.pl`** must be restarted after
    every change to a configuration file with **`/etc/init.d/ nagios_grapher restart`**.
    **`collect2.pl`** also updates the object cache when this is done.'
  prefs: []
  type: TYPE_NORMAL
- en: 'During its installation, NagiosGrapher provides a number of templates for **`ngraph`**
    objects; these can be found in the subdirectories **`standard`** and **`extra`**
    below **`/etc/nagios/ngraph.d/templates`**. These templates all end in **`.ncfg_disabled`**
    so that they are not considered by NagiosGrapher. In order to use them, the file
    extension is renamed:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE125]'
  prefs: []
  type: TYPE_PRE
- en: The example in **`check_ping.ncfg_disabled`**, however, only works with **`check_ping`**
    and not with **`check_icmp`** (see [6.2 Reachability Test with Ping](../Text/ch06s02.html
    "6.2 Reachability Test with Ping")). So that NagiosGrapher can graphically display
    the average response time **`rta`** (*round trip average*) and the **`pl`** (*packet
    loss*) from the performance data of the **`check_icmp`** plugin,
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE126]'
  prefs: []
  type: TYPE_PRE
- en: 'the following **`ngraph`** objects are used:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE127]'
  prefs: []
  type: TYPE_PRE
- en: '**`service_name`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'This consists of a regular expression,^([[209](#ftn.CHP-19-FN-17)]) with which
    the NagiosGrapher identifies the service to be displayed in the data passed on.
    If the service description in service objects that use the same plugin is provided
    with the same prefix, one **`ngraph`** definition is enough for all: **`Disk`**_
    matches both **`Disk_usr`**, as well as **`Disk_var`** or **`Disk_tmp`**. In order
    for this to work, the performance data must be structured identically, which is
    always the case if the same plugin is used.'
  prefs: []
  type: TYPE_NORMAL
- en: '**`graph_perf_regex`**'
  prefs: []
  type: TYPE_NORMAL
- en: With this regular expression, NagiosGrapher finds the value being searched for
    in the performance data. The pattern in the round brackets must match the value
    itself.
  prefs: []
  type: TYPE_NORMAL
- en: If a plugin does not provide any performance data, you can use **`graph_log_regex`**
    instead. The search pattern specified there is applied by NagiosGrapher to the
    normal text output of the plugin.
  prefs: []
  type: TYPE_NORMAL
- en: '**`graph_value`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'The name of the variable in the RRD database must be unique for each service
    and may not contain empty spaces or special characters (exception: _ is allowed).'
  prefs: []
  type: TYPE_NORMAL
- en: '**`graph_units`**'
  prefs: []
  type: TYPE_NORMAL
- en: This parameter defines the unit of the y axis.
  prefs: []
  type: TYPE_NORMAL
- en: '**`graph_legend`**'
  prefs: []
  type: TYPE_NORMAL
- en: This contains the key for the variables.
  prefs: []
  type: TYPE_NORMAL
- en: '**`graph_legend_eol`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'This determines whether and how a line break should be inserted into the legend
    after the entry for these graphs. Possible values: **`left`** (line break, line
    is left-aligned), **`right`** (line break, line is right-aligned), **`center`**
    (line break, line is centrally aligned), **`justify`** (line break, fully aligned),
    and **`none`** (no line break, left-aligned). You can append to all values the
    number of empty spaces to be added, separated from it by a colon: **`none: 20`**
    does not create a line break, but the entry is followed by 20 empty spaces.'
  prefs: []
  type: TYPE_NORMAL
- en: '**`graph_legend_max`**'
  prefs: []
  type: TYPE_NORMAL
- en: This defines a column width for the legend. Instead of formatting this manually
    with empty spaces, using **`graph_legend_eol`**, this parameter specifies how
    wide the column for a legend entry should be. Entries that are longer are truncated.
  prefs: []
  type: TYPE_NORMAL
- en: '**`page`**'
  prefs: []
  type: TYPE_NORMAL
- en: This optional parameter ensures that NagiosGrapher displays the variables in
    different diagrams if the standardization does not match. All values which are
    to be used in a single graphic are given the same **`page`** entry. For the selection
    of the "page" to be displayed, the CGI script contains its own **`page`** entry
    field (see [Figure 19-10](../Text/ch19s05.html#the_average_response_time_to_pings_comm
    "Figure 19-10. The average response time to pings, represented by NagiosGrapher")).
  prefs: []
  type: TYPE_NORMAL
- en: '![The average response time to pings, represented by NagiosGrapher](../Images/tagoreillycom20081104nostarchimages223978.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 19-10. The average response time to pings, represented by NagiosGrapher
  prefs: []
  type: TYPE_NORMAL
- en: For the two **`check_icmp`** outputs, it is recommended that the percentage
    of **`Loss`**, which is in the value range from 0 to 100, be separated from **`RTA`**,
    which can be several thousand milliseconds.
  prefs: []
  type: TYPE_NORMAL
- en: If you leave out the **`page`** parameter, both graphs—the one for **`Packet`**
    Loss and that for **`RTA`**—are displayed in one graphic.
  prefs: []
  type: TYPE_NORMAL
- en: '**`rrd_plottype`**'
  prefs: []
  type: TYPE_NORMAL
- en: 'This parameter defines which drawing function the RRDtools should use:'
  prefs: []
  type: TYPE_NORMAL
- en: '**`LINE1`**: simple line,'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**`LINE2`**: double line,'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**`LINE3`**: extra-fat line,'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**`AREA`**: filled out surface,'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**`STACK`**: adds the current value to the previous one. In this case the display
    (line or surface) depends on the previous value.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**`rrd_color`**'
  prefs: []
  type: TYPE_NORMAL
- en: This is the color of the graph in RGB hexadecimal notation (**``*`rrggbb`*``**).
  prefs: []
  type: TYPE_NORMAL
- en: '[Figure 19-10](../Text/ch19s05.html#the_average_response_time_to_pings_comm
    "Figure 19-10. The average response time to pings, represented by NagiosGrapher")
    shows how NagiosGrapher displays the average response time **`RTA`** for the **`PING`**
    service on the host **`sap-13`**. The respective output **`page`** can be selected
    at the top of the Web form. In addition you can adjust the **`width`**: and **`height`**:
    of an individual graphic, as well as the **`Refresh`** rate.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Starting with version 1.7, NagiosGrapher also has a zoom function: If you click
    on one of the graphics in [Figure 19-10](../Text/ch19s05.html#the_average_response_time_to_pings_comm
    "Figure 19-10. The average response time to pings, represented by NagiosGrapher"),
    you can see it in greater detail. You can select a time period in the diagram
    with the mouse, and NagiosGrapher will display the diagram for this period after
    the mouse button has been released.'
  prefs: []
  type: TYPE_NORMAL
- en: Advanced options of graphic reprocessing
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: You may not always want the measured values to be displayed directly. With the
    *CDEF* feature of the RRDtools you can add new values that are calculated from
    the ones recorded.
  prefs: []
  type: TYPE_NORMAL
- en: 'As an example, we will use the output of the **`check_disk`** plugin ([7.1
    Free Hard Drive Capacity](../Text/ch07.html#free_hard_drive_capacity "7.1 Free
    Hard Drive Capacity"), page 158), which determines amount of a file system occupied:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE128]'
  prefs: []
  type: TYPE_PRE
- en: 'The used space is shown as an dark grey area, the free capacity as a light
    grey one. The performance data provides the current used space (**`1225MB`**)
    and uncritical warning limits, as well as the minimum and maximum (the size of
    the file system). The capacity that is still free is determined as the difference
    between the maximum and the current occupied space. In addition, the unit of MB
    is somewhat unfortunate: the graphic would show 10 GB as **`10k`** MB. For this
    reason you first determine the value that the plugin returns, so that you can
    then scale it as you wish:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE129]'
  prefs: []
  type: TYPE_PRE
- en: The regular expression specified after **`service_name`** matches all service
    descriptions that start with **`fs_`** (short for *file system*), that is, **`fs_root`**,
    **`fs_usr`**, **`fs_var`**, **`fs_tmp`**, etc. The parameter **`hide`** ensures
    that the CGI script does not show the graphs. Instead, NagiosGrapher just stores
    the data in a database.
  prefs: []
  type: TYPE_NORMAL
- en: 'In the second step, the values determined are standardized with the RRD feature
    **`CDEF`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE130]'
  prefs: []
  type: TYPE_PRE
- en: '**`type`** identifies the entry as a **`CDEF`** definition, which calculates
    new values from already existing ones. **`graph_value`** must be unique, which
    is why the entry here is given its own name.'
  prefs: []
  type: TYPE_NORMAL
- en: '**`graph_calc`** finally processes the data. This parameter expects the instructions
    in reverse Polish notation (RPN).^([[210](#ftn.CHP-19-FN-18)]) In this, the values
    to be processed are pushed, in turn, onto a stack, to be removed and operated
    on later.'
  prefs: []
  type: TYPE_NORMAL
- en: Adding 2 + 3 is noted in RPN accordingly as **`2`**, **`3`**, +. In the example
    we multiply the variable defined in [Advanced options of graphic reprocessing](../Text/ch19s05.html#advanced_options_of_graphic_reproces
    "Advanced options of graphic reprocessing"), **`disk_used`**, by 1024² so that
    the result is in bytes. **`hide no`** now ensures that this value is displayed.
  prefs: []
  type: TYPE_NORMAL
- en: 'To display available space according to the same pattern, we first determine
    the entire space available (**`disk_max`**), which NagiosGrapher should not display,
    calculate the difference between **`disk_max`** and the above **`disk_ used`**
    value, and convert the result to bytes:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE131]'
  prefs: []
  type: TYPE_PRE
- en: 'The corresponding formula is (**`disk_max-disk_used`**)x1024² The plot type
    **`STACK`** ensures that the value determined from the previous **`disk_used`**
    value is placed on top of this. [Figure 19-11](../Text/ch19s05.html#displaying_the_calculated_load_data
    "Figure 19-11. Displaying the calculated load data") shows a corresponding output:
    The lower part of the screen represents the current used space on the file system
    for the past six hours and the past day and week, and the top part shows the remaining
    free hard drive space. The graph also contains a monthly and a yearly view, not
    shown here.'
  prefs: []
  type: TYPE_NORMAL
- en: At this point it should again be emphasized that with this definition, NagiosGrapher
    automatically records all services that begin with **`fs_`** and are matched by
    the search pattern, writes the data to an RRD database, and generates a corresponding
    **`serviceextinfo`** entry, which appears automatically in the Web interface after
    a Nagios reload (see [Figure 19-7](../Text/ch19s05.html#the_nagiosgrapher_icon_open_parenthesis
    "Figure 19-7. The NagiosGrapher icon (arrow) in the Nagios Web interface indicates
    a time-related evaluation for this service") in page 434).
  prefs: []
  type: TYPE_NORMAL
- en: 'After changes have been made to the configuration file **`ngraph.ncfg`**, the
    file collector **`collect2.pl`** must also be restarted:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE132]'
  prefs: []
  type: TYPE_PRE
- en: '![Displaying the calculated load data](../Images/tagoreillycom20081104nostarchimages223980.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 19-11. Displaying the calculated load data
  prefs: []
  type: TYPE_NORMAL
- en: Nagios configuration
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Nagios passes on data for NagiosGrapher through the command interface, that
    is, each individual result leads to an external command being started. Correspondingly,
    the Nagios main configuration file contains the following parameter:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE133]'
  prefs: []
  type: TYPE_PRE
- en: The definition of the command object **`process-service-perfdata`**— which is
    best achieved by creating a separate file with the name **`process_service_perfdata_n.graph.cfg`**—depends
    on the interface type used.
  prefs: []
  type: TYPE_NORMAL
- en: For **`interface pipe`**, the program **`fifo_write`** is used, whereas for
    **`interface network`**, NagiosGrapher requires the program **`udpecho`**.
  prefs: []
  type: TYPE_NORMAL
- en: 'The definition of the command with **`fifo_write`** is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE134]'
  prefs: []
  type: TYPE_PRE
- en: '**`process-service-perfdata`** calls the script **`fifo_write.pl`**, which
    is given three arguments as parameters: the named pipe, a string with the performance
    details, and a timeout in seconds. The latter ensures that the script aborts the
    action if the data cannot be written within three seconds. The **`command_line`**
    must, as usual, be writen on one line.'
  prefs: []
  type: TYPE_NORMAL
- en: 'For the program **`udpecho`**, the definition of the command is somewhat simpler:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE135]'
  prefs: []
  type: TYPE_PRE
- en: '**`udpecho`** does not need any parameters: It retrieves the required information
    from the environment variables **`NAGIOS_HOSTNAME, NAGIOS_SERVICE-DESC`**, **`NAGIOS_SERVICEOUTPUT`**,
    and **`NAGIOS_SERVICEPERFDATA`**. Nagios has to make these available with **`enable_environment_macros=1`**
    (see [A.1 The Main Configuration File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration
    "A.1 The Main Configuration File nagios.cfg")) so that **`udpecho`** can provide
    NagiosGrapher with usable data.^([[211](#ftn.CHP-19-FN-19)])'
  prefs: []
  type: TYPE_NORMAL
- en: 'For the **`file`** interface type, the command **`process-service-perfdata`**
    has another meaning: It is not called for every check result, but rather shifts
    the file into which Nagios writes all performance data via the template mechanism:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE136]'
  prefs: []
  type: TYPE_PRE
- en: The current timestamp is simply appended to the file name **`service-perf-data`**.
    The daemon **`collect2.pl`** searches for all files called **`service-perfdata.`****``*`time_stamp`*``**
    from the specified directory and processes these.
  prefs: []
  type: TYPE_NORMAL
- en: 'What data is written to the file by Nagios is specified by **`service_perf
    data_file_template`** in **`nagios.cfg`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE137]'
  prefs: []
  type: TYPE_PRE
- en: Compared to the variation with **`fifo_write.pl`**, Nagios now also passes on
    a timestamp for each check. This is necessary because the data are not processed
    immediately, but periodically at intervals of **`service_perfdata_ file_processing_interval`**—this
    is 60 seconds in our example.
  prefs: []
  type: TYPE_NORMAL
- en: If you want to squeeze a little more performance out of this, you can select
    a temporary file system such as **`/dev/shm`** for the **`service-perfdata*`**
    files. The file then is not written to the hard drive, but remains in the main
    memory of the Nagios server.
  prefs: []
  type: TYPE_NORMAL
- en: 'As usual, changes to the Nagios configuration require a reload:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE138]'
  prefs: []
  type: TYPE_PRE
- en: 'The success of this can be clearly observed in the log file if you set the
    loglevel to 255 (see [The configuration file ngraph.ncfg](../Text/ch19s05.html#the_configuration_file_ngraph.ncfg
    "The configuration file ngraph.ncfg")).^([[212](#ftn.CHP-19-FN-20)]) For the sake
    of clarity we will omit the timestamp at the beginning of the line:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE139]'
  prefs: []
  type: TYPE_PRE
- en: The label **`PRG`** identifies program states, such as the restart here. **`PIPE`**
    reproduces in full all the data taken from the named pipe (host name, service
    description, plugin output, and performance data, each separated by a tab). **`REGEX`**
    shows how the search for matching entries takes place and how the values are extracted
    from them. **`RRD`** reveals the commands performed with **`rrdtool`** and **`VALUES`**
    shows the recognized values(**`PING`**).
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[205](#CHP-19-FN-13)]) [http://www.nagiosexchange.org/42;195](http://www.nagiosexchange.org/42;195)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[206](#CHP-19-FN-14)]) Starting from NagiosGrapher 1.7, the file **`config.layout`**
    already contains the entry **`<Layout nagiosbook>`**.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[207](#CHP-19-FN-15)]) Even when running **`make update`**, it doesn't hurt
    for you to back up the configuration files beforehand.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[208](#CHP-19-FN-16)]) See [19.1.1 The template mechanism](../Text/ch19.html#the_template_mechanism
    "19.1.1 The template mechanism") in page 405
  prefs: []
  type: TYPE_NORMAL
- en: ^([[209](#CHP-19-FN-17)]) Since we have a Perl script on our hands, this is,
    of course, a Perl regexp.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[210](#CHP-19-FN-18)]) An introduction to RPN can be found at [http://people.ee.ethz.ch/˜oetiker/webtools/rrdtool/tut/rpntutorial.en.html](http://people.ee.ethz.ch/%CB%9Coetiker/webtools/rrdtool/tut/rpntutorial.en.html).
  prefs: []
  type: TYPE_NORMAL
- en: ^([[211](#CHP-19-FN-19)]) Environment macros are described in [D.1.8 Using standard
    macros about the environment](../Text/apd.html#using_standard_macros_about_the_environm
    "D.1.8 Using standard macros about the environment") from page 631.
  prefs: []
  type: TYPE_NORMAL
- en: '^([[212](#CHP-19-FN-20)]) In general: 2^n - 1 with *n*≥8'
  prefs: []
  type: TYPE_NORMAL
- en: 19.6 Smooth Plotting with PNP
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '*PNP is not PerfParse*—with this recursive acronym, which is an allusion to
    the PerfParse tool (not described in this book)—the authors of PNP, Jörg Linge
    and Hendrik B$aUcker, are clearly heralding the virtues of their own tool for
    processing performance data: It is allegedly very easy to install (in contrast
    to PerfParse) and can be used (almost) without configuration, yet provides extensive
    configuration options for advanced usage.'
  prefs: []
  type: TYPE_NORMAL
- en: Besides providing the usual graphs for a specific check, PNP also creates an
    overview of all graphs belonging to one host. An AJAX-based input field allows
    host names to be typed in. The names are auto-completed during input, and a match
    list of alternative completions is displayed. The graphics have a sophisticated
    appearance and can be exported to PDF format.
  prefs: []
  type: TYPE_NORMAL
- en: PNP takes the performance data directly from the area reserved for the plugin
    output, that is, only plugins that display performance data in the standard format
    can be used. In contrast to NagiosGrapher, no data can be extracted from the normal
    text output. To compensate for this slight limitation, PNP outputs the performance
    data for all plugins automatically. If PNP does not recognize the plugin, it uses
    a generic template.
  prefs: []
  type: TYPE_NORMAL
- en: On the PNP homepage^([[213](#ftn.CHP-19-FN-21)]) you can find addresses of English
    mailing lists^([[214](#ftn.CHP-19-FN-22)]) and a German-language forum, where
    you can, however, ask questions in English.^([[215](#ftn.CHP-19-FN-23)]) The English
    homepage is [http://www.pnp4nagios.org/pnp/](http://www.pnp4nagios.org/pnp/).
  prefs: []
  type: TYPE_NORMAL
- en: The following description refers to PNP version 0.4; older versions do not have
    all the features described here.
  prefs: []
  type: TYPE_NORMAL
- en: 19.6.1 Installation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The requirements for installation are quite minimal: Apache, Perl (without
    any special modules), PHP4 from version 4.3.0 or PHP5, and all the RRDtools.^([[216](#ftn.CHP-19-FN-24)])
    If possible you should install the Perl module RRDs from the Perl package included
    with your distribution (e.g., **`librrds-perl`** in Debian). The Perl script **`process_perfdata.pl`**,
    which forwards Nagios performance data to PNP, then accesses the RRD databases
    directly, without running an external program.'
  prefs: []
  type: TYPE_NORMAL
- en: 'The PNP source code is downloaded from the homepage^([[217](#ftn.CHP-19-FN-25)])
    and is unpacked appropriately in the directory **`/usr/local/src`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE140]'
  prefs: []
  type: TYPE_PRE
- en: Finally, **`make all`** compiles the necessary C programs, and **`make install`**
    installs PNP in full. In the **`configure`** command, **`--sysconfdir=/etc/pnp`**
    allows for the later installation of the configuration examples in **`/etc/pnp`**,
    in accordance with the conventions used in this book. Other **`configure`** options
    are shown with **`./configure --help`**.
  prefs: []
  type: TYPE_NORMAL
- en: 19.6.2 The standard configuration
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'During the installation of PNP a variety of data is placed in the configuration
    directory (in this case **`/etc/pnp`**), including **`config.php`**, the configuration
    file for the Web interface. There you must first check to see if the paths to
    **`rrdtool`** and to the performance data directory are correctly set:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE141]'
  prefs: []
  type: TYPE_PRE
- en: '**`/etc/pnp`** also contains example configurations for the data collector
    **`pro-cess_perfdata.pl`**, in the files **`process_perfdata.cfg-sample`** and
    **`rra.cfg-sample`**. Neither of these are absolutely essential: PNP also functions
    correctly without any adjustments. But in order to use the data collector you
    need to rename the files **`process_perfdata.cfg`** and **`rra.cfg`** and modify
    them accordingly. If the Perl module RRDs is installed, then it is activated in
    the file **`process_perfdata.cfg`** with **`USE_RRDS=1`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE142]'
  prefs: []
  type: TYPE_PRE
- en: The second change (here in bold type) to the sample file refers to the Nagios
    directory for log files, which in this book is named **`/var/nagios`**.
  prefs: []
  type: TYPE_NORMAL
- en: '**`rra.cfg`** is used as a template for the RRD databases to be newly created.
    If an existing database is to be modified, it must be deleted; but then all existing
    data will be lost. The template is a good compromise between length of storage
    and time resolution: This causes data with a time resolution of one hour to be
    stored for up to four years, such an RRD database that is about 400 KB in size.
    Information on settings for RRD databases is provided by the command **`man rrdcreate`**.'
  prefs: []
  type: TYPE_NORMAL
- en: In the directory **`/etc/pnp`** there is also the configuration file **`npcd.cfg`**
    for the *Nagios Performance Data C Daemon* **`npcd`** and a subdirectory **`check_
    commands`** for so-called *custom templates*. Both will be discussed in [19.6.4
    Bulk processing of performance data](../Text/ch19s06.html#bulk_processing_of_performance_data
    "19.6.4 Bulk processing of performance data").
  prefs: []
  type: TYPE_NORMAL
- en: Adjusting the Nagios configuration
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'There are a number of ways in which Nagios can pass on performance data to
    the PNP data collector **`process_perfdata.pl`**. The simplest way is for the
    system to run a separate program for each event, called **`service-perf-data-pnp`**.
    To do this, performance data processing is switched on in the file **`/etc/nagios/nagios.cfg`**
    with the parameter **`process_performance_data`**, and the command to be executed
    is defined with **`service_perfdata_command`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE143]'
  prefs: []
  type: TYPE_PRE
- en: The performance data of various plugins contains names that are set in single
    quotes. So that these do not get lost in the plugin output, a single quote may
    *not* be used in the parameter **`illegal_macro_output_chars`**.^([[218](#ftn.CHP-19-FN-26)])
  prefs: []
  type: TYPE_NORMAL
- en: 'The command **`service-perfdata-pnp`** runs **`process_perfdata.pl`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE144]'
  prefs: []
  type: TYPE_PRE
- en: The embedded Perl interpreter ePN (see [Appendix G](../Text/apg.html "Appendix G. The
    Embedded Perl Interpreter") in page 669) cannot execute this Perl script, which
    is why it is called explictly with **`/usr/bin/perl`**. If ePN is not compiled
    into Nagios, you can leave out the **`/usr/bin/perl`** path.
  prefs: []
  type: TYPE_NORMAL
- en: The performance data is taken here by **`process_perfdata.pl`** via the environment
    variable **`NAGIOS_SERVICEPERFDATA`**, so that environment variables in general
    must not be switched off.^([[219](#ftn.CHP-19-FN-27)])
  prefs: []
  type: TYPE_NORMAL
- en: 19.6.3 The PNP Web interface
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: If you run [http://nagios_server/nagios/pnp/index.php](http://nagios_server/nagios/pnp/index.php)
    you will be taken to the PNP overview page (see [Figure 19-12](../Text/ch19s06.html#all_services_of_elix01_on_one_page
    "Figure 19-12. All services of elix01 on one page")). This displays the data of
    the first host, in alphabetical order, that is found by PNP. The input field at
    the top right is implemented with AJAX and shows a hit list, matching the text
    entered so far, from which the desired host is selected. The accompanying overview
    page presents all services in a 24-hour view.
  prefs: []
  type: TYPE_NORMAL
- en: This can also be accessed directly via [http://nagiosserver/nagios/ pnp/index.php?host=hostname](http://nagiosserver/nagios/%20pnp/index.php?host=hostname).
    If you replace **``*`hostname`*``** with **`elix01`**, you will arrive at the
    overview page for the host of that name ([Figure 19-12](../Text/ch19s06.html#all_services_of_elix01_on_one_page
    "Figure 19-12. All services of elix01 on one page")).
  prefs: []
  type: TYPE_NORMAL
- en: '![All services of elix01 on one page](../Images/tagoreillycom20081104nostarchimages223982.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 19-12. All services of `elix01` on one page
  prefs: []
  type: TYPE_NORMAL
- en: 'A mouse click on a service graph or on the accompanying link on the right in
    the overview causes the selected display to be shown in a different time resolution
    ([Figure 19-13](../Text/ch19s06.html#system_load_in_pnp_colon_host "Figure 19-13. System
    load in PNP: host elix01, service lx-load")): four hours, one day and (not shown)
    one week, one month, and one year. The periods presented here by PNP are defined
    in the configuration file **`config.php`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE145]'
  prefs: []
  type: TYPE_PRE
- en: The specific **`title`** labels can be chosen freely, so you could also use
    text in other languages. The images themselves cannot be localized, however.
  prefs: []
  type: TYPE_NORMAL
- en: '![System load in PNP: host elix01, service lx-load](../Images/tagoreillycom20081104nostarchimages223984.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 19-13. System load in PNP: host `elix01`, service `lx-load`'
  prefs: []
  type: TYPE_NORMAL
- en: 'The **`start`** details specify for how many seconds *before* a defined reference
    point the graphic will begin. Normally the current time is used as a reference
    point, but this can also be selected using the calendar included. To do this,
    you click the calendar icon (see [Figure 19-14](../Text/ch19s06.html#pnp_apostrophy_s_calendar_function
    "Figure 19-14. PNP''s calendar function")), select the end time after **Time**
    with a mouse click, and then select the day. Selecting the time takes some getting
    used to: One click increases the value displayed by one, and holding down the
    ![System load in PNP: host elix01, service lx-load](../Images/tagoreillycom20081104nostarchimages223986.png)
    key at the same time reduces the time value displayed. You can also hold down
    the left mouse button and drag the mouse to the left to increase the value, or
    drag to the right to decrease it.'
  prefs: []
  type: TYPE_NORMAL
- en: '![PNP''s calendar function](../Images/tagoreillycom20081104nostarchimages223988.png.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Figure 19-14. PNP's calendar function
  prefs: []
  type: TYPE_NORMAL
- en: In order to display a specific service directly, just add the detail **`svc=`****``*`servicename`*``**
    to the URL, so that you have [http://nagiosserver/nagios/pnp/index.php?host=hostname&svc=servicename](http://nagiosserver/nagios/pnp/index.php?host=hostname&svc=servicename).
  prefs: []
  type: TYPE_NORMAL
- en: 'A particular feature of PNP is that each graphic can be addressed directly,
    without using HTML or PHP pages. You require the two optional parameters **`display`**
    and **`view`**: [http://nagiosserver/nagios/pnp/index.php?host=host&svc=servicename&display=image&view=0](http://nagiosserver/nagios/pnp/index.php?host=host&svc=servicename&display=image&view=0).
    **`display`** can currently handle only the value **`image`**, and for **`view`**
    you enter the index defined in **`config.php`**: **`view=0`** refers to the time
    period that was defined there with **`$views [0] ["start"]`** (so this is the
    default, with a four-hour overview).'
  prefs: []
  type: TYPE_NORMAL
- en: Integrating PNP into the Nagios Web interface
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'To display a single service directly from the Nagios Web interface, in Nagios
    3 you need to integrate the following URL as **`action_url`** in the service definition:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE146]'
  prefs: []
  type: TYPE_PRE
- en: 'In Nagios 2.x you require the object **`serviceextinfo`** to achieve the same
    purpose:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE147]'
  prefs: []
  type: TYPE_PRE
- en: 19.6.4 Bulk processing of performance data
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The standard configuration discussed calls the command defined in **`service_perfdata_command`**
    for each check. Since the embedded Perl interpreter ePN (see [Appendix G](../Text/apg.html
    "Appendix G. The Embedded Perl Interpreter") in page 669) cannot execute **`process_perf-data.pl`**,
    Nagios has to restart the Perl interpreter for every service whose performance
    data is to be processed. This takes a toll on resources and, depending on the
    capabilities of the host and the number of services to be processed, has a negative
    influence on the performance of Nagios (to measure Nagios performance, see [Appendix F](../Text/apf.html
    "Appendix F. Tips on Optimizing Performance") from page 653). Nagios then really
    is brought to its knees, which means that the latency time that passes between
    the planned starting point and the actual start of a check increases considerably,
    and Nagios's timetable (the *scheduling*) gets out of control.
  prefs: []
  type: TYPE_NORMAL
- en: One solution to this is offered by PNP's bulk mode in combination with the *Nagios
    Performance Data C Daemon* (NPCD).^([[220](#ftn.CHP-19-FN-28)]) When this is used,
    Nagios writes the performance data—formatted by templates (defined in **`service_perfdata_file_template`**)—to
    a file that is regularly renamed by a command in **`service_perfdata_file_processing_command`**.
    NPCD now runs the Perl script **`process_perfdata.pl`** only once for each file.
  prefs: []
  type: TYPE_NORMAL
- en: '**`service_perfdata_file_template`** defines the format in which the data is
    written to the file specified in **`service_perfdata_file`**:^([[221](#ftn.CHP-19-FN-29)])'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE148]'
  prefs: []
  type: TYPE_PRE
- en: '**`service_perfdata_file_mode`** specifies how Nagios handles the file: The
    value **`a`** stands for *append*. Thus Nagios appends new results to an already
    existing file. Every 30 seconds (as specified in **`service_perfdata_file_processing_interval`**)
    the *File Processing Command* **`service-perfdata-npcd`** starts. It shifts the
    file, renames it, and adds the current times-tamp, using the Nagios macro **`$TIMET$`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE149]'
  prefs: []
  type: TYPE_PRE
- en: 'Renaming and shifting doesn''t use up any time. So Nagios can immediately resume
    its normal tasks and leave further processing of performance data to the external
    NPCD daemon. NPCD has its own configuration file, in **`npcd.cfg`**, which is
    copied during installation to the directory **`/etc/pnp`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE150]'
  prefs: []
  type: TYPE_PRE
- en: The first two entries specify with which user and which group membership NPCD
    is to be started. The daemon can currently only log its work in the syslog. Future
    versions should also allow this to be written to a separate file. **`log_level=0`**
    ensures that NPCD itself behaves quietly and passes on all errors only to the
    syslog daemon.
  prefs: []
  type: TYPE_NORMAL
- en: The parameter **`perfdata_spool_dir`** renames the directory to be monitored.
    It must already exist; the NPCD does not create it automatically. Thanks to the
    argument **`-b`** given in **`perfdata_file_run_cmd_args, process_perfdata.pl`**
    starts in bulk mode.
  prefs: []
  type: TYPE_NORMAL
- en: 'The NPCD installs itself during the **`"make install"`** command for PNP to
    the directory **`/usr/local/nagios/bin`**. Running **`make install-init`** causes
    an additional startup script to be placed in **`/etc/init.d`**, in which you have
    to check the path to the configuration file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE151]'
  prefs: []
  type: TYPE_PRE
- en: 'With the help of this, the daemon is started with the following command:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE152]'
  prefs: []
  type: TYPE_PRE
- en: 'Depending on your distribution, the init script in the **`rc`** directories
    is linked to the relevant runlevel:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE153]'
  prefs: []
  type: TYPE_PRE
- en: 19.6.5 How should the graphic appear?
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The appearance of PNP graphics is determined by templates. The examples included
    are located in the directory **`/usr/local/nagios/share/pnp/templates.dist`**.
    You should not touch these, as they will be overwritten at the next update. The
    directory **`templates`** is intended for some templates. PNP takes the name of
    the check that was defined in the **`command_name`** and searches here for a matching
    template called **``*`command_name.php`*``**.
  prefs: []
  type: TYPE_NORMAL
- en: If PNP cannot find this either in **`./templates`** or in **`./templates.dist`**,
    it uses the default template **`default.php`**.
  prefs: []
  type: TYPE_NORMAL
- en: 'Sometimes there is already a suitable template in **`templates.dist`** (for
    example, **`check_ping.php`** for the plugin **`check_icmp`**), the name of which
    does not match the command name (in the case of **`check_icmp`**, we have defined
    this as **`command_name check_icmp`**). Then you must create a symlink in **`./templates`**
    to the desired file:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE154]'
  prefs: []
  type: TYPE_PRE
- en: 'A simple template which can be used for all plugins that transmit a simple
    response time is **`response.php`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE155]'
  prefs: []
  type: TYPE_PRE
- en: The variable **`$opt[1]`** defines the options for **`rrdtool`**, and the variable
    **`$def[1]`** defines the RRD graph. If you want to create your own templates,
    you will need to get involved with **`rrdtool`** in more detail. The definition
    of a graphic is explained in detail by **`man rrdgraph`**, and further information
    can be found on the homepage.^([[222](#ftn.CHP-19-FN-30)])
  prefs: []
  type: TYPE_NORMAL
- en: Custom Templates
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'PNP is based on the name of the defined command object. If this is not informative
    enough, as in the case of **`command_name check_nrpe`**, then so-called *custom
    templates* in the directory **`/etc/pnp/check_commands`** are used. These must
    contain the name of the original command, however, which in our example is **`check_nt.cfg`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE156]'
  prefs: []
  type: TYPE_PRE
- en: 'If **`check_nt`** is not given **`MEMUSE`** as the first parameter, the actual
    command for the plugin **`check_nt`**, only this parameter will differentiate
    whether memory usage or CPU load, for instance, is measured. The parameter **`CUSTOM_TEMPLATE`**
    puts together the command that PNP uses when searching for templates: The example
    below puts together **`check_nt`** (entry number 0) and **`MEMUSE`** (entry number
    1). This means that PNP will search for a template with the name **`check_nt_MEMUSE.php`**.
    With **`CUSTOM_TEMPLATE = 1`**, PNP would search for **`MEMUSE.php`**. A suitable
    symlink is now set in the directory **`./templates`**:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE157]'
  prefs: []
  type: TYPE_PRE
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[213](#CHP-19-FN-21)]) [http://www.pnp4nagios.org/pnp/](http://www.pnp4nagios.org/pnp/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[214](#CHP-19-FN-22)]) [https://lists.sourceforge.net/mailman/listinfo/pnp4nagios-users](https://lists.sourceforge.net/mailman/listinfo/pnp4nagios-users)
    (generally on PNP usage) and [https://lists.sourceiorge.net/mailman/listinio/
    pnp4nagios-devel](https://lists.sourceiorge.net/mailman/listinio/%20pnp4nagios-devel)
    (feature requests, bugs, patches, and the like)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[215](#CHP-19-FN-23)]) [http://nagios-portal.de/forum/board.php?boardid=58](http://nagios-portal.de/forum/board.php?boardid=58)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[216](#CHP-19-FN-24)]) [http://www.rrdtool.org/](http://www.rrdtool.org/),
    see also [19.4.1 Installation](../Text/ch19s04.html#installation-id6 "19.4.1 Installation").
  prefs: []
  type: TYPE_NORMAL
- en: ^([[217](#CHP-19-FN-25)]) [http://www.pnp4nagios.org/pnp/](http://www.pnp4nagios.org/pnp/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[218](#CHP-19-FN-26)]) Performance data is provided by the macro **`$SERVICEPERFDATA$`**;
    see [D.1.1 Host macros](../Text/apd.html#host_macros "D.1.1 Host macros").
  prefs: []
  type: TYPE_NORMAL
- en: ^([[219](#CHP-19-FN-27)]) This has only been possible since Nagios 3.0, with
    the **`enable_environment_macros`** parameter (see [A.1 The Main Configuration
    File nagios.cfg](../Text/apa.html#an_overview_of_the_nagios_configuration "A.1
    The Main Configuration File nagios.cfg")). More on environment variables in [D.1.8
    Using standard macros about the environment](../Text/apd.html#using_standard_macros_about_the_environm
    "D.1.8 Using standard macros about the environment") from page 631.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[220](#CHP-19-FN-28)]) The C in the name alludes to the considerably faster
    performance speed of a C program compared to a Perl script, for which Nagios has
    to restart the Perl interpreter each time.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[221](#CHP-19-FN-29)]) This is just a single line, which has been line-wrapped
    here for display purposes.
  prefs: []
  type: TYPE_NORMAL
- en: ^([[222](#CHP-19-FN-30)]) [http://www.rrdtool.org/](http://www.rrdtool.org/)
  prefs: []
  type: TYPE_NORMAL
- en: 19.7 Other Tools and the Limits of Graphic Evaluation
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Apart from the tools introduced here, [http://www.nagiosexchange.org/](http://www.nagiosexchange.org/)
    provides further tools for the graphic evaluation of performance data. Many of
    these are also based on the RRDtools and round-robin databases, the consequence
    of which is that they are not much use for exact evaluations over several years,
    just like the ones described here.
  prefs: []
  type: TYPE_NORMAL
- en: Several tools, such as the current APAN^([[223](#ftn.CHP-19-FN-31)]) version,
    save their data in an SQL database, thus enabling long-term statistics without
    data loss.
  prefs: []
  type: TYPE_NORMAL
- en: PerfParse^([[224](#ftn.CHP-19-FN-32)]) is very extensive, and it stores data
    in a MySQL or PostgreSQL database and also includes its own wide range of evaluation
    tools. Because it uses various current libraries which are not included in every
    distribution, the installation hurdles are quite high. Nevertheless, those for
    whom the RRD-based tools do not offer enough should look to see if the PerfParse
    tools can provide the missing functionality that is required.
  prefs: []
  type: TYPE_NORMAL
- en: For all the options it offers, the graphical display of Nagios performance data
    also has its limits. If you check WAN connections with a ping to a remote host
    and measure the average response time, all the pretty graphics don't mean much
    if the check interval is only every five minutes. You will receive only a momentary
    snapshot every five minutes, which does not provide any serious clues to the traffic
    load of the connection over a period of time.
  prefs: []
  type: TYPE_NORMAL
- en: To be able to sensibly assess the load of a Unix computer reported by a plugin
    every one, five, and 15 minutes, the check interval should be one minute. Less
    critical data are such things as used hard drive space or temperature. Equally
    noncritical is the display of network traffic, for which the plugin displays the
    values as a counter. RRD-based tools can automatically detect the difference between
    two measurements and display them; it makes no difference here whether the check
    interval is one, two, or five minutes; no data is lost.
  prefs: []
  type: TYPE_NORMAL
- en: If the measuring precision of Nagios leaves something to be desired, you can
    deploy other tools in parallel, such as Cricket^([[225](#ftn.CHP-19-FN-33)]) or
    Cacti.^([[226](#ftn.CHP-19-FN-34)]) If the external tool—like Munin^([[227](#ftn.CHP-19-FN-35)])
    —works with RRD databases, you can check these for critical values, so that they
    are included in the sophisticated Nagios notification system. Alternatively the
    external tool can provide an interface with which recorded data can be further
    processed. These can be passed on as a passive test result to Nagios, for example
    using NSCA (see [Chapter 14](../Text/ch14.html "Chapter 14. The Nagios Service
    Check Acceptor (NSCA)")).
  prefs: []
  type: TYPE_NORMAL
- en: But an additional tool always has the disadvantage of adding to the configuration
    effort. Whether this is justified, or whether Nagios performance monitoring is
    sufficient, depends on the information required in a particular situation.
  prefs: []
  type: TYPE_NORMAL
- en: '* * *'
  prefs: []
  type: TYPE_NORMAL
- en: ^([[223](#CHP-19-FN-31)]) [http://apan.sf.net/](http://apan.sf.net/).
  prefs: []
  type: TYPE_NORMAL
- en: ^([[224](#CHP-19-FN-32)]) [http://perfparse.sf.net/](http://perfparse.sf.net/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[225](#CHP-19-FN-33)]) [http://cricket.sourceforge.net/](http://cricket.sourceforge.net/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[226](#CHP-19-FN-34)]) [http://www.cacti.net/](http://www.cacti.net/)
  prefs: []
  type: TYPE_NORMAL
- en: ^([[227](#CHP-19-FN-35)]) [http://munin.projects.linpro.no/](http://munin.projects.linpro.no/)
  prefs: []
  type: TYPE_NORMAL
