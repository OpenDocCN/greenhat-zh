<html><head></head><body>

<div class="calibre1"><div class="calibre1"><a name="isc_bind_dns_server_9.4.2" class="calibre8" id="isc_bind_dns_server_9.4.2"/>
<div class="calibre24" id="calibre_pb_0"/><h2 id="title-ID0EUAPM" class="docPrefaceTitle">Chapter 10. ISC BIND DNS SERVER 9.4.2</h2>
<h4 class="calibre32"><a class="calibre2" target="_blank" href="HTTP://WWW.ISC.ORG/SW/BIND">HTTP://WWW.ISC.ORG/SW/BIND</a></h4>
<a name="summary-id9" class="calibre8" id="summary-id9"/>
<h3 class="docSection1Title" id="-100000">10.1. SUMMARY</h3>
<p class="docText1"><a name="BIND " class="calibre8" id="BIND "/>BIND (Berkeley Internet Name Domain) is the most widely used DNS server application on the Internet. Slightly over 79 percent of DNS servers use BIND DNS, according to a survey conducted by the Internet Systems Consortium (ISC) in July 2007. Microsoft came in second at 16 percent.<sup class="docFootnote"><a class="calibre2" href="#CHP-10-1">[]</a></sup><a name="name system" class="calibre8" id="name system"/> The domain name system is responsible for the conversion of domain names, such as <a class="calibre2" target="_blank" href="http://unorthodocs.net">http://unorthodocs.net</a><a name="like " class="calibre8" id="like "/>, into routable IP addresses like 69.226.238.99. It is considered one of the most critical components of the Internet.</p><blockquote class="calibre31"><p class="docFootnote1"><sup class="calibre37"><a name="CHP-10-1" class="calibre8" id="CHP-10-1">[]</a></sup><a name="of the" class="calibre8" id="of the"/> See the results of the Internet Systems Consortium's ongoing survey at <a class="calibre2" target="_blank" href="http://www.isc.org/ds">http://www.isc.org/ds</a>.<a name="IDX-CHP-10-0162" class="calibre8" id="IDX-CHP-10-0162"/><a name="IDX-CHP-10-0163" class="calibre8" id="IDX-CHP-10-0163"/><a name="IDX-CHP-10-0164" class="calibre8" id="IDX-CHP-10-0164"/><a name="IDX-CHP-10-0165" class="calibre8" id="IDX-CHP-10-0165"/><a name="IDX-CHP-10-0166" class="calibre8" id="IDX-CHP-10-0166"/><a name="IDX-CHP-10-0167" class="calibre8" id="IDX-CHP-10-0167"/><a name="IDX-CHP-10-0168" class="calibre8" id="IDX-CHP-10-0168"/><a name="IDX-CHP-10-0169" class="calibre8" id="IDX-CHP-10-0169"/></p></blockquote>
<p class="docText1"><a name="that addressed" class="calibre8" id="that addressed"/>BIND version 9 was a total rewrite of the BIND package that addressed architectural issues and known security problems in previous versions. New features in BIND 9 include DNS Security (DNSSEC), multiprocessor support, support for IPv6, protocol enhancements, and better portability.</p>
<p class="docText1"><a name="DNS updates" class="calibre8" id="DNS updates"/>BIND also supports dynamic DNS updates (as per RFC 2136). When coupled with the Internet Systems Consortium's DHCP server, dynamic DNS allows real-time updates to the DNS server's zone files as DHCP clients join the network. This gives DHCP clients the luxury of having a locally or publicly resolvable hostname.<a name="IDX-CHP-10-0170" class="calibre8" id="IDX-CHP-10-0170"/></p>
<p class="docText1"><a name="student project" class="calibre8" id="student project"/>BIND was originally conceived as a graduate student project at the University of California, Berkeley in the early '80s. UC Berkeley worked on BIND in cooperation with Digital Equipment Corporation for a few years. Paul Vixie, of Digital Equipment Corporation, later became principal programmer of the BIND project. BIND was passed on to the Internet Systems Consortium (ISC), a nonprofit corporation led by Vixie, who now continues to develop the BIND system independently.<a name="IDX-CHP-10-0171" class="calibre8" id="IDX-CHP-10-0171"/></p>
<p class="docText1"><a name="authoritative name" class="calibre8" id="authoritative name"/>We'll be building a local master authoritative name server for your domain name. This will also provide the benefits of a caching name server. A <span class="docEmphasis1">caching name server</span><a name="files of" class="calibre8" id="files of"/> is basically a DNS relay: It has no zone files of its own and must get DNS information from other DNS servers (also called <span class="docEmphasis1">forwarders</span><a name="DNS queries" class="calibre8" id="DNS queries"/>). Both authoritative and caching name servers store DNS queries in a cache to make subsequent requests faster.</p>
<p class="docText1"><a name="A master" class="calibre8" id="A master"/>A master authoritative name server also has a zone file (a list of known IP addresses) for your domain. When a DNS query is received for your domain, BIND looks at your zone file and returns the requested information. If the query is for a domain other than yours, the query is forwarded to other DNS servers specified in your forwarder's configuration.</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="resources-id9" class="calibre8" id="resources-id9"/>
<h3 class="docSection1Title" id="-100000">10.2. RESOURCES</h3>
<p class="docText1"><span class="b"><a name="BIND " class="calibre8" id="BIND "/>BIND 9 Administrator Reference Manual</span></p>
<p class="docText1"><a class="calibre2" target="_blank" href="http://www.isc.org/sw/bind/arm94">http://www.isc.org/sw/bind/arm94</a></p>
<p class="docText1"><span class="b"><a name="Concepts and" class="calibre8" id="Concepts and"/>RFC 1034 - Domain Names: Concepts and Facilities</span></p>
<p class="docText1"><a class="calibre2" target="_blank" href="http://tools.ietf.org/html/rfc1034">http://tools.ietf.org/html/rfc1034</a></p>
<p class="docText1"><span class="b">RFC 1035 - Domain Names: Implementation and Specification</span></p>
<p class="docText1"><a class="calibre2" target="_blank" href="http://tools.ietf.org/html/rfc1035">http://tools.ietf.org/html/rfc1035</a></p>
<p class="docText1"><span class="b">The FreeBSD Handbook</span></p>
<p class="docText1"><a class="calibre2" target="_blank" href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/network-dns.html">http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/network-dns.html</a></p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="required-id9" class="calibre8" id="required-id9"/>
<h3 class="docSection1Title" id="-100000">10.3. REQUIRED</h3>
<p class="docText1"><img border="0" id="" src="bTM3ZzJkLzhzNHRnOS9lL3BjMWk1OTU3MWk5ZmFycHMwZzMvMC5uVQ--.jpg" alt="" class="calibre33"/><a name="FreeBSD " class="calibre8" id="FreeBSD "/> FreeBSD 7.0-RELEASE (see "<a class="calibre2" href="freebsd_7.0_split_000.html#freebsd_7.0">FreeBSD 7.0</a>")<a name="IDX-CHP-10-0172" class="calibre8" id="IDX-CHP-10-0172"/><a name="IDX-CHP-10-0173" class="calibre8" id="IDX-CHP-10-0173"/></p>
<p class="docText1"><img border="0" id="" src="bTM3ZzJkLzhzNHRnOS9lL3BjMWk1OTU3MWk5ZmFycHMwZzMvMC5uVQ--.jpg" alt="" class="calibre33"/><a name="collection " class="calibre8" id="collection "/> Updated ports collection (see "<a class="calibre2" href="freebsd_ports_collection.html#freebsd_ports_collection">FreeBSD Ports Collection</a>")</p>
<p class="docText1"><img border="0" id="" src="bTM3ZzJkLzhzNHRnOS9lL3BjMWk1OTU3MWk5ZmFycHMwZzMvMC5uVQ--.jpg" alt="" class="calibre33"/> Internet connection</p>
<p class="docText1"><img border="0" id="" src="bTM3ZzJkLzhzNHRnOS9lL3BjMWk1OTU3MWk5ZmFycHMwZzMvMC5uVQ--.jpg" alt="" class="calibre33"/> Registered domain name</p>
<p class="docText1"><img border="0" id="" src="bTM3ZzJkLzhzNHRnOS9lL3BjMWk1OTU3MWk5ZmFycHMwZzMvMC5uVQ--.jpg" alt="" class="calibre33"/><a name="IP address" class="calibre8" id="IP address"/> Public or private static IP address</p>
<p class="docText1"><img border="0" id="" src="bTM3ZzJkLzhzNHRnOS9lL3BjMWk1OTU3MWk5ZmFycHMwZzMvMC5uVQ--.jpg" alt="" class="calibre33"/> Your ISP's DNS server addresses</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="optional-id4" class="calibre8" id="optional-id4"/>
<h3 class="docSection1Title" id="-100000">10.4. OPTIONAL</h3>
<p class="docText1"><img border="0" id="" src="bTM3ZzJkLzhzNHRnOS9lL3BjMWk1OTU3MWk5ZmFycHMwZzMvMC5uVQ--.jpg" alt="" class="calibre33"/><a name="DHCP server" class="calibre8" id="DHCP server"/> DHCP server (see "<a class="calibre2" href="isc_dhcp_server_3.0.5.html#isc_dhcp_server_3.0.5">ISC DHCP Server 3.0.5</a>")</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="preparation-id9" class="calibre8" id="preparation-id9"/>
<h3 class="docSection1Title" id="-100000">10.5. PREPARATION</h3>
<div class="calibre34"><ol class="docList" type="1"><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="Become the" class="calibre8" id="Become the"/>Become the superuser.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="part of" class="calibre8" id="part of"/>BIND 9.4.2 is part of the standard FreeBSD 7.0 distribution. Check the current version of BIND available in the ports collection with the command:</p><pre class="calibre30"># <b class="calibre28">cat /usr/ports/dns/bind94/Makefile | grep PORTVERSION</b></pre>
</div></li></ol></div>
<p class="docText1"><a name="proceed to" class="calibre8" id="proceed to"/>If this version supersedes 9.4.2, proceed to the "<a class="calibre2" href="install.html#install">Install</a><a name="is equal" class="calibre8" id="is equal"/>" section below. If it is equal to 9.4.2, skip to "Configure."</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="install-id9" class="calibre8" id="install-id9"/>
<h3 class="docSection1Title" id="-100000">10.6. INSTALL</h3>
<p class="docText1"><a name="To overwrite" class="calibre8" id="To overwrite"/>To overwrite the base installation of BIND with the version available in the ports collection, use the following commands:</p>
<pre class="calibre30"># <b class="calibre28">cd /usr/ports/dns/bind94</b>
# <b class="calibre28">make config ; make install clean</b></pre>
<p class="docText1"><a name="should appear" class="calibre8" id="should appear"/>A menu should appear displaying options for bind94. Press [spacebar] to select the <span class="b">REPLACE_BASE</span><a name="their default" class="calibre8" id="their default"/> option; leave other options at their default. Press [tab] to select <span class="b">OK</span><a name="to continue" class="calibre8" id="to continue"/> and then press [enter] to continue the installation process.</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="configure-id9" class="calibre8" id="configure-id9"/>
<h3 class="docSection1Title" id="-100000">10.7. CONFIGURE</h3>
<p class="docText1"><a name="Once the" class="calibre8" id="Once the"/>Once the installation process is complete, it's time to configure BIND for use on your system.<a name="IDX-CHP-10-0174" class="calibre8" id="IDX-CHP-10-0174"/><a name="IDX-CHP-10-0175" class="calibre8" id="IDX-CHP-10-0175"/><a name="IDX-CHP-10-0176" class="calibre8" id="IDX-CHP-10-0176"/></p>
<div class="calibre34"><ol class="docList" type="1"><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="statement" class="calibre8" id="statement"/>Add the statement <tt class="calibre20">"NO_BIND = YES"</tt> to the <span class="docEmphasis1">make.conf</span> file located in <span class="docEmphasis1">/etc</span><a name="append this" class="calibre8" id="append this"/>. The following commands will append this statement to <span class="docEmphasis1">make.conf</span><a name="file if" class="calibre8" id="file if"/> or create the file if it does not exist:</p><pre class="calibre30"># <b class="calibre28">cp /etc/make.conf /etc/make.conf.old</b>
# <b class="calibre28">echo "NO_BIND = YES" &gt;&gt; /etc/make.conf</b></pre>
<p class="docText1">This tells the <tt class="calibre20">make</tt><a name="you rebuild" class="calibre8" id="you rebuild"/> command not to build the base version of BIND if you rebuild FreeBSD from source, preventing the system from downgrading BIND to that older version.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="the" class="calibre8" id="the"/>We need to edit the <span class="docEmphasis1">named.conf</span> file in <span class="docEmphasis1">/var/named/etc/namedb</span>. Open the file:</p><pre class="calibre30"># <b class="calibre28">ee /var/named/etc/namedb/named.conf</b></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Scroll down and comment the <tt class="calibre20">listen-on</tt> declaration with two forward slashes (<tt class="calibre20">//</tt><a name="external and" class="calibre8" id="external and"/>). This allows BIND's named daemon to answer both external and local DNS queries; the default behavior is to answer only local queries. This line (~21) should appear as follows:</p><pre class="calibre30">//      listen-on       { 127.0.0.1; };</pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="forward slash" class="calibre8" id="forward slash"/>Scroll down and remove the forward slash and asterisk (<tt class="calibre20">/*</tt>) on the line above the <tt class="calibre20">forwarders</tt> declaration. Replace <tt class="calibre20"><i class="docEmphasis1">127.0.0.1</i></tt> with your ISP's nameservers. Separate nameserver entries with a semicolon (<tt class="calibre20">;</tt>). Also remove the asterisk and forward slash (<tt class="calibre20">*/</tt>) following the <tt class="calibre20">forwarders</tt> declaration. The <tt class="calibre20">forwarders</tt><a name="will be" class="calibre8" id="will be"/> declaration (~43-47) should look like this (of course, your IP addresses will be different):</p><pre class="calibre30">forwarders {
        202.13.68.62;68.103.31.52;
};</pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Scroll down to the bottom of <span class="docEmphasis1">named.conf</span><a name="your forward" class="calibre8" id="your forward"/> and add the following lines to add your forward lookup zone (substitute your domain name for <a class="calibre2" target="_blank" href="http://example.com">example.com</a>):</p><pre class="calibre30">zone "<tt class="calibre20"><i class="docEmphasis1">example.com</i></tt>" {
    type master;
    file "<tt class="calibre20"><i class="docEmphasis1">master</i></tt>/example.com";
    allow-transfer { localhost; };
    allow-update { key rndc-key; };
};</pre><br class="calibre1"/>
<hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> A feature of BIND called <span class="docEmphasis1">dynamic DNS updates</span> allows BIND and the ISC DHCP server to work together and add/remove entries to your zone files automatically as clients join and leave your local network. If you want to enable dynamic DNS updates with ISC DHCP, then change the italicized <tt class="calibre20">master</tt> (in the <tt class="calibre20"><i class="docEmphasis1">file</i></tt> line of the preceding code) to <tt class="calibre20">dynamic</tt>. Refer to "<a class="calibre2" href="isc_dhcp_server_3.0.5.html#isc_dhcp_server_3.0.5">ISC DHCP Server 3.0.5</a>" for details on the ISC DHCP server.</span><hr size="1" noshade="noshade" class="calibre27"/></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="If you" class="calibre8" id="If you"/>If you are connected directly to the Internet (no NAT router) and have a dynamic public IP address, then skip to step 8. If you are connected directly to the Internet with a static IP address or have a static local IP address behind a NAT router, add the following lines below the forward lookup zone you specified in step 5. This will define your reverse lookup zone.</p><pre class="calibre30">zone "1.168.192.in-addr.arpa" {
    type master;
    file "<tt class="calibre20"><i class="docEmphasis1">master</i></tt>/example.com.rev";
    allow-transfer { localhost; };
    allow-update { key rndc-key; };
};</pre><br class="calibre1"/>
<p class="docText1"><a name="first three" class="calibre8" id="first three"/>Substitute the first three octets of your server's static IP address in reverse order for <tt class="calibre20"><i class="docEmphasis1">1.168.192</i></tt><a name="correct if" class="calibre8" id="correct if"/>. The above example is correct if your local network uses the IP subnet 192.168.1.<span class="docEmphasis1">XXX</span><a name="name for" class="calibre8" id="name for"/>. Substitute your domain name for <a class="calibre2" target="_blank" href="http://example.com">example.com</a>.</p><hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> If you plan to enable dynamic DNS updates (ISC DHCP required), change the italicized <tt class="calibre20">master</tt> (in the <tt class="calibre20"><i class="docEmphasis1">file</i></tt> line of the above code) to <tt class="calibre20">dynamic</tt>.</span><hr size="1" noshade="noshade" class="calibre27"/></div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Write down the reverse zone's name (<tt class="calibre20">1.168.192.in-addr.arpa</tt><a name="the reverse" class="calibre8" id="the reverse"/>, in this example). You will need it later when you create the reverse zone file. Save and exit.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Create the <span class="docEmphasis1">rndc.key</span><a name="contents to" class="calibre8" id="contents to"/> file and append its contents to the bottom of the <span class="docEmphasis1">named.conf</span> file. The <span class="docEmphasis1">rndc.key</span><a name="rndc utility" class="calibre8" id="rndc utility"/> file is an encryption key that the rndc utility needs in order to function; it is also used to authenticate the DHCP server to BIND when communicating dynamic DNS updates. The following commands will create the key and append it to <span class="docEmphasis1">named.conf</span>:</p><pre class="calibre30"># <b class="calibre28">rndc-confgen -a</b>
# <b class="calibre28">cd /var/named/etc/namedb</b>
# <b class="calibre28">cp named.conf named.conf.old</b>
# <b class="calibre28">cat rndc.key &gt;&gt; named.conf</b></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="zone file" class="calibre8" id="zone file"/>Create the master forward lookup zone file. Replace <a class="calibre2" target="_blank" href="http://example.com">example.com</a><a name="name you" class="calibre8" id="name you"/> with your domain name; it must match the domain name you specified in step 5.</p><pre class="calibre30"># <b class="calibre28">cd /var/named/etc/namedb/master</b>
# <b class="calibre28">ee</b> <span class="docEmphBoldItalic">example.com</span></pre><br class="calibre1"/>
<p class="docText1">This is the <a class="calibre2" target="_blank" href="http://example.com">example.com</a><a name="each line" class="calibre8" id="each line"/> forward lookup zone file, followed by explanations of each line:</p><pre class="calibre30">$TTL    3600

<tt class="calibre20"><i class="docEmphasis1">example.com</i></tt>.   IN    SOA   <tt class="calibre20"><i class="docEmphasis1">host.example.com</i></tt>.    <tt class="calibre20"><i class="docEmphasis1">root</i></tt>.<tt class="calibre20"><i class="docEmphasis1">example.com</i></tt>. (

                                1       ;       Serial
                                10800   ;       Refresh
                                3600    ;       Retry
                                604800  ;       Expire
                                86400 ) ;       Minimum TTL
;DNS Servers
<tt class="calibre20"><i class="docEmphasis1">example.com</i></tt>.         IN      NS              <tt class="calibre20"><i class="docEmphasis1">host.example.com</i></tt>.

;Machine Names
<tt class="calibre20"><i class="docEmphasis1">host.example.com</i></tt>.    IN      A               <tt class="calibre20"><i class="docEmphasis1">192.168.1.11</i></tt>

;Aliases
www                  IN      CNAME           <tt class="calibre20"><i class="docEmphasis1">host.example.com</i></tt>.

;MX Record
<tt class="calibre20"><i class="docEmphasis1">example.com</i></tt>.         IN      MX      10      <tt class="calibre20"><i class="docEmphasis1">host.example.com</i></tt>.</pre><br class="calibre1"/>
<hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> Any line preceded by a semicolon ( <tt class="calibre20"><i class="docEmphasis1">;</i></tt>) is ignored by BIND.</span><hr size="1" noshade="noshade" class="calibre27"/><pre class="calibre30">$TTL    3600</pre><br class="calibre1"/>
<p class="docText1"><a name="TTL " class="calibre8" id="TTL "/>TTL (or Time To Live) is 3,600 seconds. This is the amount of time for which other DNS servers should cache information from this zone.</p><pre class="calibre30"><tt class="calibre20"><i class="docEmphasis1">example.com.</i></tt>   IN    SOA     <tt class="calibre20"><i class="docEmphasis1">host.example.com.</i></tt> <tt class="calibre20"><i class="docEmphasis1">root.example.com.</i></tt> (</pre><br class="calibre1"/>
<p class="docText1"><a class="calibre2" target="_blank" href="http://example.com">example.com</a><a name="forward zone" class="calibre8" id="forward zone"/>. is the forward zone name.</p><p class="docText1"><tt class="calibre20">IN</tt><a name="that means" class="calibre8" id="that means"/> is a data type that means <span class="docEmphasis1">Internet data</span>.</p><p class="docText1"><tt class="calibre20">SOA</tt> stands for <span class="docEmphasis1">start of authority</span>.</p><p class="docText1"><a class="calibre2" target="_blank" href="http://host.example.com">host.example.com</a><a name="of computer" class="calibre8" id="of computer"/>. is the hostname of computer that holds this zone file.</p><p class="docText1"><a class="calibre2" target="_blank" href="http://root.example.com">root.example.com</a><a name="zone " class="calibre8" id="zone "/>. is the email address of the person responsible for the zone (in zone files, the <tt class="calibre20">@</tt><a name="represent the" class="calibre8" id="represent the"/> symbol is used to represent the zone name, so the period is used to separate the username from the domain name in the email address).</p><p class="docText1"><tt class="calibre20">(</tt><a name="the SOA" class="calibre8" id="the SOA"/> The left parenthesis indicates the start of the SOA record.</p><pre class="calibre30">1       ;       Serial</pre><br class="calibre1"/>
<p class="docText1"><a name="number you" class="calibre8" id="number you"/>The serial number is a number you can choose; it is usually increased by one every time you make a change to the zone file. You may use a date (in the format <tt class="calibre20">YYYYMMDD</tt>) instead.</p><pre class="calibre30">
10800   ;       Refresh</pre><br class="calibre1"/>
<p class="docText1"><a name="the number" class="calibre8" id="the number"/>If there is a slave server configured, this is the number of seconds it waits before contacting this master server for an update.</p><pre class="calibre30">3600    ;       Retry</pre><br class="calibre1"/>
<p class="docText1"><a name="slave server" class="calibre8" id="slave server"/>This is the number of seconds a slave server would wait before retrying a connection to the master server if it ever loses contact.</p><pre class="calibre30">604800  ;       Expire</pre><br class="calibre1"/>
<p class="docText1"><a name="If the" class="calibre8" id="If the"/>If the slave server cannot contact the master server within this time, in seconds, it will stop answering DNS queries.</p><pre class="calibre30">86400 ) ;       Minimum TTL</pre><br class="calibre1"/>
<p class="docText1"><a name="the amount" class="calibre8" id="the amount"/>This is the amount of time in seconds that a negative answer is cached. If a client tries to resolve a host that does not exist, the server will answer negatively until this time runs out before actually trying to resolve the address again.</p><pre class="calibre30">;DNS Servers
<tt class="calibre20"><i class="docEmphasis1">example.com.</i></tt>    IN      NS              <tt class="calibre20"><i class="docEmphasis1">host.example.com.</i></tt></pre><br class="calibre1"/>
<p class="docText1"><a class="calibre2" target="_blank" href="http://example.com">example.com</a><a name="or domain" class="calibre8" id="or domain"/>. is the forward zone's name or domain name.</p><p class="docText1"><tt class="calibre20">NS</tt><a name="type meaning" class="calibre8" id="type meaning"/> is a record type meaning <span class="docEmphasis1">nameserver</span>.</p><p class="docText1"><a class="calibre2" target="_blank" href="http://host.example.com">host.example.com</a><a name="the end" class="calibre8" id="the end"/>. is the fully qualified domain name of the nameserver. (The period at the end means the FQDN is absolute; without it, named would automatically append <a class="calibre2" target="_blank" href="http://example.com">example.com</a> to itâ€”so don't forget the period.)</p><pre class="calibre30">;Machine Names
<tt class="calibre20"><i class="docEmphasis1">host.example.com.</i></tt>    IN      A               <tt class="calibre20"><i class="docEmphasis1">192.168.1.11</i></tt></pre><br class="calibre1"/>
<p class="docText1"><a class="calibre2" target="_blank" href="http://host.example.com">host.example.com</a><a name="a host" class="calibre8" id="a host"/>. is the FQDN of a host on the domain.</p><p class="docText1"><tt class="calibre20">A</tt> is a record type meaning a <span class="docEmphasis1">host address</span>.</p><p class="docText1"><tt class="calibre20"><i class="docEmphasis1">192.168.1.11</i></tt><a name="addresses don" class="calibre8" id="addresses don"/> is the IP address of the host (IP addresses don't need terminating periods; they are considered absolute).</p><pre class="calibre30">;Aliases
www                  IN      CNAME           <tt class="calibre20"><i class="docEmphasis1">host.example.com.</i></tt></pre><br class="calibre1"/>
<p class="docText1"><tt class="calibre20">www</tt><a name="aliased host" class="calibre8" id="aliased host"/> is the FQDN of the aliased host on the domain. (Notice that there is no period after <tt class="calibre20">www</tt>; named will automatically append the domain <a class="calibre2" target="_blank" href="http://example.com">example.com</a>. If this is confusing, you may simply type <a class="calibre2" target="_blank" href="http://www.example.com">www.example.com</a><tt class="calibre20">.</tt> here instead.)</p><p class="docText1"><tt class="calibre20">CNAME</tt> is a record type meaning <span class="docEmphasis1">canonical name</span> for an alias.</p><p class="docText1"><a class="calibre2" target="_blank" href="http://host.example.com">host.example.com</a>. is the actual hostname of the alias.</p><pre class="calibre30">;MX Record
<tt class="calibre20"><i class="docEmphasis1">example.com.</i></tt>         IN      MX      10      <tt class="calibre20"><i class="docEmphasis1">host.example.com.</i></tt></pre><br class="calibre1"/>
<p class="docText1"><a class="calibre2" target="_blank" href="http://example.com">example.com</a>. is the MX's domain name.</p><p class="docText1"><tt class="calibre20">MX</tt> is a record type meaning <span class="docEmphasis1">mail exchanger</span>.</p><p class="docText1"><tt class="calibre20"><i class="docEmphasis1">10</i></tt><a name="for your" class="calibre8" id="for your"/> is the priority of the specified mail server. (Email destined for your domain will be directed to the highest priority mail server, then lower priority mail servers; the lower number is the higher priority.)</p><p class="docText1"><a class="calibre2" target="_blank" href="http://host.example.com">host.example.com</a>. is the FQDN of mail server (no IP addresses).</p><hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> Be sure to double-check the spelling, punctuation marks, and syntax of your forward lookup zone file. BIND will not function correctly if the zone file contains errors.</span><hr size="1" noshade="noshade" class="calibre27"/></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="zone file" class="calibre8" id="zone file"/>When you finish creating your forward lookup zone file, save and exit.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="We will" class="calibre8" id="We will"/>We will construct the reverse lookup zone file called <a class="calibre2" target="_blank" href="http://example.com.rev">example.com.rev</a><a name="did not" class="calibre8" id="did not"/>. If you did not specify one in <span class="docEmphasis1">named.conf</span> (step 6), skip to "<a class="calibre2" href="testing.html#testing">Testing</a><a name="same basic" class="calibre8" id="same basic"/>". This file contains the same basic information as the forward lookup zone file. All <tt class="calibre20">A</tt> and <tt class="calibre20">CNAME</tt><a name="become" class="calibre8" id="become"/> record types now become <tt class="calibre20">PTR</tt> records. Replace <a class="calibre2" target="_blank" href="http://example.com">example.com</a><a name="specified in" class="calibre8" id="specified in"/> with your domain name; it must match the domain name you specified in step 5.</p><pre class="calibre30"># <b class="calibre28">ee</b> <span class="docEmphBoldItalic">example.com</span><b class="calibre28">.rev</b></pre><br class="calibre1"/>
<p class="docText1">This is the <a class="calibre2" target="_blank" href="http://example.com.rev">example.com.rev</a><a name="in the" class="calibre8" id="in the"/> reverse lookup zone file in the <span class="docEmphasis1">/var/named/etc/namedb/master</span> directory, followed by explanations of items not previously covered:</p><pre class="calibre30">$TTL    3600

<tt class="calibre20"><i class="docEmphasis1">1.168.192.in-addr.arpa</i></tt>. IN  SOA <tt class="calibre20"><i class="docEmphasis1">host.example.com</i></tt>.  <tt class="calibre20"><i class="docEmphasis1">root.example.com</i></tt>.   (

                                1       ;       Serial
                                10800   ;       Refresh
                                3600    ;       Retry
                                604800  ;       Expire
                                86400 ) ;       Minimum TTL
;DNS Servers
<tt class="calibre20"><i class="docEmphasis1">1.168.192.in-addr.arpa</i></tt>.   IN      NS              <tt class="calibre20"><i class="docEmphasis1">host.example.com</i></tt>.

;Machine IPs
<tt class="calibre20"><i class="docEmphasis1">11</i></tt>                        IN      PTR             <tt class="calibre20"><i class="docEmphasis1">host.example.com</i></tt>.
<tt class="calibre20"><i class="docEmphasis1">11</i></tt>                        IN      PTR             www.<tt class="calibre20"><i class="docEmphasis1">example.com</i></tt>.</pre><br class="calibre1"/>
<p class="docText1"><a name="in detail" class="calibre8" id="in detail"/>The elements in this file are explained in detail below.</p><pre class="calibre30"><tt class="calibre20"><i class="docEmphasis1">1.168.192.in-addr.arpa</i></tt>. IN  SOA <tt class="calibre20"><i class="docEmphasis1">host.example.com</i></tt>.  <tt class="calibre20"><i class="docEmphasis1">root.example.com</i></tt>.</pre><br class="calibre1"/>
<p class="docText1"><tt class="calibre20"><i class="docEmphasis1">1.168.192.in-addr.arpa</i></tt><tt class="calibre20">.</tt><a name="match what" class="calibre8" id="match what"/> is the reverse zone's name. It should match what you entered in the <span class="docEmphasis1">named.conf</span> file (refer to step 7 on page 76).</p><pre class="calibre30">;DNS Servers
<tt class="calibre20"><i class="docEmphasis1">1.168.192.in-addr.arpa</i></tt>.   IN      NS              <tt class="calibre20"><i class="docEmphasis1">host.example.com</i></tt>.</pre><br class="calibre1"/>
<p class="docText1"><a name="the reverse" class="calibre8" id="the reverse"/>The DNS server NS record should point to the reverse zone's name. An <tt class="calibre20">@</tt><a name="of DNS" class="calibre8" id="of DNS"/> symbol here would work too. In the context of DNS zone files, the <tt class="calibre20">@</tt><a name="symbol represents" class="calibre8" id="symbol represents"/> symbol represents the zone's name.</p><pre class="calibre30">;Machine IPs
<tt class="calibre20"><i class="docEmphasis1">11</i></tt>              IN      PTR             <tt class="calibre20"><i class="docEmphasis1">host.example.com</i></tt>.</pre><br class="calibre1"/>
<p class="docText1"><tt class="calibre20">11</tt><a name="last octet" class="calibre8" id="last octet"/> is the last octet of <a class="calibre2" target="_blank" href="http://host.example.com's">host.example.com's</a> IP address.</p><p class="docText1"><tt class="calibre20">PTR</tt><a name="meaning" class="calibre8" id="meaning"/> is a record type meaning <span class="docEmphasis1">pointer</span>.</p><p class="docText1">Notice the <tt class="calibre20"><i class="docEmphasis1">11</i></tt><a name="end with" class="calibre8" id="end with"/> above does not end with a period. It will be automatically prefixed to this file's zone name (<tt class="calibre20">1.168.192.in-addr.arpa.</tt>). The result will point <a class="calibre2" target="_blank" href="http://host.example.com">host.example.com</a> to a reverse IP of <tt class="calibre20"><i class="docEmphasis1">11</i></tt><tt class="calibre20">.1.168.192.in-addr.arpa.</tt>. When your reverse zone file is complete, save and exit.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="BIND will" class="calibre8" id="BIND will"/>If you will not be enabling dynamic DNS updates, skip to "Testing." BIND will expect the forward and reverse zone files to be stored in the <span class="docEmphasis1">/var/named/etc/namedb/dynamic</span><a name="files to" class="calibre8" id="files to"/> directory. Copy these two zone files to the <span class="docEmphasis1">/var/named/etc/namedb/dynamic</span> directory like this:</p><pre class="calibre30"># <b class="calibre28">cd /var/named/etc/namedb/master</b>
# <b class="calibre28">cp</b> <span class="docEmphBoldItalic">example.com</span> <b class="calibre28">../dynamic</b>
# <b class="calibre28">cp</b> <span class="docEmphBoldItalic">example.com</span><b class="calibre28">.rev ../dynamic</b>
# <b class="calibre28">chown -R bind /var/named/etc/namedb/dynamic</b></pre><br class="calibre1"/>
<p class="docText1"><a name="for" class="calibre8" id="for"/>Be sure to substitute your domain name for <a class="calibre2" target="_blank" href="http://example.com">example.com</a>.</p></div></li></ol></div>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="testing-id6" class="calibre8" id="testing-id6"/>
<h3 class="docSection1Title" id="-100000">10.8. TESTING</h3>
<p class="docText1"><a name="In this" class="calibre8" id="In this"/>In this section, we'll perform some basic tests to confirm that BIND answers DNS requests properly.<a name="IDX-CHP-10-0177" class="calibre8" id="IDX-CHP-10-0177"/></p>
<div class="calibre34"><ol class="docList" type="1"><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="first nameserver" class="calibre8" id="first nameserver"/>Modify the first nameserver entry in the <span class="docEmphasis1">resolv.conf</span><a name="the loopback" class="calibre8" id="the loopback"/> file to point to the loopback or localhost address (127.0.0.1). This will force the system to query the local DNS server before attempting to query other DNS servers.</p><pre class="calibre30"># <b class="calibre28">ee /etc/resolv.conf</b>

domain example.com<b class="calibre28">nameserver 127.0.0.1</b>
nameserver 61.32.24.84
nameserver 206.13.22.96</pre>
<hr size="1" noshade="noshade" class="calibre27"/><span><i class="docEmphasis1"><b class="calibre28">Note:</b></i> You may specify a maximum of three nameservers.</span><hr size="1" noshade="noshade" class="calibre27"/><p class="docText1">Save and exit.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="start automatically" class="calibre8" id="start automatically"/>Configure named to start automatically at boot time. To start named automatically at boot time, open the <span class="docEmphasis1">rc.conf</span> file in <span class="docEmphasis1">/etc</span>:</p><pre class="calibre30"># <b class="calibre28">ee /etc/rc.conf</b></pre><br class="calibre1"/>
<p class="docText1">and add the following line:</p><pre class="calibre30">named_enable="YES"</pre><br class="calibre1"/>
<p class="docText1">Save and exit.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Start the named daemon and conduct DNS query tests.</p><pre class="calibre30"># <b class="calibre28">/etc/rc.d/named start</b></pre><br class="calibre1"/>
</div></li><li class="calibre16"><div class="calibre35"><p class="docText1">Perform a basic DNS query for <a class="calibre2" target="_blank" href="http://google.com">google.com</a>:</p><div class="calibre1">
              Code View:</div><pre class="calibre30"># <b class="calibre28">dig google.com</b>

; &lt;&lt;&gt;&gt; DiG 9.4.1 &lt;&lt;&gt;&gt; google.com.
;; global options:  printcmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 31313
;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 4, ADDITIONAL: 4

;; QUESTION SECTION:
;google.com.                    IN      A

;; ANSWER SECTION:
google.com.             246     IN      A       72.14.207.99
google.com.             246     IN      A       64.233.167.99
google.com.             246     IN      A       64.233.187.99

;; AUTHORITY SECTION:
google.com.             339294  IN      NS      ns2.google.com.
google.com.             339294  IN      NS      ns3.google.com.
google.com.             339294  IN      NS      ns1.google.com.
google.com.             339294  IN      NS      ns4.google.com.

;; ADDITIONAL SECTION:
ns4.google.com.         87732   IN      A       216.239.38.10
ns1.google.com.         86787   IN      A       216.239.32.10
ns2.google.com.         88494   IN      A       216.239.34.10
ns3.google.com.         344254  IN      A       216.239.36.10

;; Query time: 1 msec
<b class="calibre28">;; SERVER: 127.0.0.1#53(127.0.0.1)</b>
;; WHEN: Sat Jun  7 01:43:03 2008
;; MSG SIZE  rcvd: 212

					  </pre><br class="calibre1"/>
<p class="docText1"><a name="confirms that" class="calibre8" id="confirms that"/>The line in bold toward the end of the output confirms that this DNS query was answered by the local DNS server.</p></div></li><li class="calibre16"><div class="calibre35"><p class="docText1"><a name="a DNS" class="calibre8" id="a DNS"/>The next command initiates a DNS query known as a zone transfer; this will test the forward lookup zone file (substitute your domain name):</p><pre class="calibre30"># <b class="calibre28">dig</b> <span class="docEmphBoldItalic">example.com</span> <b class="calibre28">axfr</b>

; &lt;&lt;&gt;&gt; DiG 9.4.1 &lt;&lt;&gt;&gt; example.com axfr
;; global options:  printcmd
example.com.          3600    IN      SOA     host.example.com.
example.com.          3600    IN      MX      10 host.example.com.
example.com.          3600    IN      NS      host.example.com.
host.example.com.     3600    IN      A       192.168.1.11
www.example.com.      3600    IN      CNAME   host.example.com.
example.com.          3600    IN      SOA     host.example.com.
;; Query time: 1 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)
;; WHEN: Sat Jun  7 09:58:01 2008
;; XFR size: 6 records (messages 1, bytes 189)</pre><br class="calibre1"/>
<p class="docText1"><a name="output to" class="calibre8" id="output to"/>Although your results will be different, examine this output to verify whether your DNS server returns the correct information. If you run into trouble, check <span class="docEmphasis1">/var/log/messages</span><a name="messages and" class="calibre8" id="messages and"/> with a text editor for named-related messages and/or errors. Most problems are zone file syntax errors.</p></div></li></ol></div>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="utilities-id3" class="calibre8" id="utilities-id3"/>
<h3 class="docSection1Title" id="-100000">10.9. UTILITIES</h3>
<p class="docText1"><a name="Following is" class="calibre8" id="Following is"/>Following is brief information on the rndc program, which is used to control the named daemon.</p>
<a name="rndc" class="calibre8" id="rndc"/>
<h4 id="title-ID0E6DPM" class="docSection1Title">10.9.1. rndc</h4>
<p class="docText1"><a name="controls the" class="calibre8" id="controls the"/>This utility controls the operation of the nameserver (named).</p>
<a name="IDX-CHP-10-0178" class="calibre8" id="IDX-CHP-10-0178"/><dl class="docList1">
<dt class="calibre1"><p class="calibre23"><span class="docPubcolor"><span class="b">Command</span></span></p></dt>
<dd class="calibre36"><p class="docText1"><tt class="calibre20">rndc</tt><a name="IDX-CHP-10-0178" class="calibre8" id="IDX-CHP-10-0178"/></p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"><span class="b">Syntax</span></span></p></dt>
<dd class="calibre36"><p class="docText1"><tt class="calibre20">rndc</tt> <tt class="calibre20"><i class="docEmphasis1">option</i></tt></p></dd>
</dl>
<p class="docText1"><span class="b">Options</span></p>
<dl class="docList1">
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">flush</pre></p></dt>
<dd class="calibre36"><p class="docText1">Flushes the DNS server's cache</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">reload</pre></p></dt>
<dd class="calibre36"><p class="docText1"><a name="and zones" class="calibre8" id="and zones"/>Reloads the configuration file and zones</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">stop</pre></p></dt>
<dd class="calibre36"><p class="docText1"><a name="zone files" class="calibre8" id="zone files"/>Saves updates to zone files and stops the server</p></dd>
<dt class="calibre1"><br class="calibre1"/><p class="calibre23"><span class="docPubcolor"/><pre class="calibre30">status</pre></p></dt>
<dd class="calibre36"><p class="docText1">Displays the status of the server</p></dd>
</dl>
<p class="docText1"><span class="b">Example</span></p>
<p class="docText1">To flush the DNS server's cache:</p>
<pre class="calibre30"># <b class="calibre28">rndc flush</b></pre><br class="calibre1"/>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="config_files-id9" class="calibre8" id="config_files-id9"/>
<h3 class="docSection1Title" id="-100000">10.10. CONFIG FILES</h3>
<p class="docText1"><span class="b">/var/named/etc/namedb/named.conf</span></p>
<p class="docText1"><a name="The main" class="calibre8" id="The main"/>The main configuration file for named</p>
<p class="docText1"><span class="b">/var/named/etc/namedb/rndc.key</span></p>
<p class="docText1"><a name="encryption key" class="calibre8" id="encryption key"/>Contains the encryption key used by the rndc utility to issue commands to named; also used for authenticating ISC's DHCP server when applying dynamic DNS updates</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="log_files-id5" class="calibre8" id="log_files-id5"/>
<h3 class="docSection1Title" id="-100000">10.11. LOG FILES</h3>
<p class="docText1"><span class="b">/var/log/messages</span><a name="IDX-CHP-10-0179" class="calibre8" id="IDX-CHP-10-0179"/><a name="IDX-CHP-10-0180" class="calibre8" id="IDX-CHP-10-0180"/><a name="IDX-CHP-10-0181" class="calibre8" id="IDX-CHP-10-0181"/></p>
<p class="docText1"><a name="Contains error" class="calibre8" id="Contains error"/>Contains error and status messages produced by the named daemon</p>
</div></div>




<div class="calibre1"><div class="calibre1"><a name="notes-id7" class="calibre8" id="notes-id7"/>
<h3 class="docSection1Title" id="-100000">10.12. NOTES</h3>
<ul class="calibre15"><li class="calibre16"><p class="docText1"><a name="If you" class="calibre8" id="If you"/>If you intend to run your own public authoritative Internet DNS server, you will need a public static IP address from your Internet provider (which costs more). Your domain registrar will need this static IP address to forward your zone's DNS queries to your DNS server. If you can't or choose not to get a public static IP address, you will need to use the services of your domain name registrar or a third party to host a zone file for your domain name. You may still run your DNS server to be authoritative locally (within your private network) without a public static IP address.</p></li><li class="calibre16"><p class="docText1"><a name="are going" class="calibre8" id="are going"/>If you are going to be running a locally authoritative DNS server and you utilize DHCP to configure your network clients, be sure to modify your DHCP server's configuration to point clients to your server's IP for DNS resolution. This will ensure that clients on your local domain benefit from your DNS server's cache and zone information. If you are behind a NAT router and don't intend to use your DNS server authoritatively on the Internet, keep port 53 closed in your router's configuration (this should already be the default).</p></li></ul>
</div></div>

</body></html>