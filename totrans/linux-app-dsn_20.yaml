- en: '![](../images/361-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '[**THE LADDIE APPLIANCE BOOTABLE CD**](toc.html#app5)'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/as.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The CD accompanying this book serves two purposes. First, it allows you to demonstrate
    the techniques described in this book by turning your x86 PC into a working appliance.
    Second, it allows you to study, in as much detail as you care to, the source code
    that implements this appliance. In this appendix, we show you how to boot and
    run the Laddie appliance CD, and we provide a tour of the CD’s contents. We also
    provide a simple example of how the CD supports modifying, rebuilding, and reinstalling
    the appliance.
  prefs: []
  type: TYPE_NORMAL
- en: '[**Running the Laddie Appliance**](toc.html#app5.1)'
  prefs: []
  type: TYPE_NORMAL
- en: The Laddie CD doesn’t require that your machine be running a specific operating
    system, you don’t need to install anything, and the CD won’t place anything on
    your hard drive. In fact, you don’t even need a hard drive. The CD creates a ramdisk
    for the root filesystem with links back to the CD, and in this context it runs
    the Laddie appliance. When you’re finished using the CD, simply remove it and
    reboot your original operating system. You’ll find that nothing has changed.
  prefs: []
  type: TYPE_NORMAL
- en: What you do need in order to run the Laddie appliance is an x86-based PC with
    at least 64 megabytes of system memory, a VESA-compliant video card (if you wish
    to run the framebuffer user interface), and a BIOS that is configured to boot
    from a CD-ROM.
  prefs: []
  type: TYPE_NORMAL
- en: In this section we’ll explain how to boot the CD, show you how to verify that
    the framebuffer and web interfaces are working, and then explain how to access
    the other user interfaces. We’ll also explain how to shut down the appliance.
  prefs: []
  type: TYPE_NORMAL
- en: '[***Booting the CD***](toc.html#app5.2)'
  prefs: []
  type: TYPE_NORMAL
- en: 'With the Laddie CD in the drive, reboot your computer. If the CD boots successfully,
    you’ll be greeted with a message like the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/362-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: At this point, you should press ENTER or wait six seconds to continue the boot
    sequence.
  prefs: []
  type: TYPE_NORMAL
- en: A commercial appliance would typically hide boot messages from the user. Since
    this is an educational system, we want you to see them. A commercial appliance
    designed for a specific hardware configuration would also boot up more quickly.
    But this CD is designed to work with a broad range of hardware configurations
    and provide a flexible environment for users to experiment with and build from,
    so the process takes a little longer. In particular, the startup scripts load
    drivers for any hardware the system recognizes, even hardware that isn’t required
    for the Laddie appliance.
  prefs: []
  type: TYPE_NORMAL
- en: '[***Navigating the Framebuffer User Interface***](toc.html#app5.3)'
  prefs: []
  type: TYPE_NORMAL
- en: Once the CD boots successfully, the system will present you with the main screen
    for the Laddie framebuffer user interface (see Figure E-1). If you see this screen,
    you’ve succeeded in running the appliance and you should now be able to use your
    keyboard’s arrow keys and enter key to navigate the Laddie framebuffer user interface.
    (If your keyboard doesn’t have arrow keys, use **i** for up, **j** for left, **k**
    for down, and **l** for right.)
  prefs: []
  type: TYPE_NORMAL
- en: '**NOTE**'
  prefs: []
  type: TYPE_NORMAL
- en: '*If the boot up process completes and a login prompt appears instead of the
    screen shown in Figure E-1, your video card is probably not VESA-compliant. In
    that case, the Laddie appliance will still run, but you won’t be able to experiment
    with the framebuffer interface.*'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/363-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure E-1: The Laddie framebuffer user interface*'
  prefs: []
  type: TYPE_NORMAL
- en: '[***Accessing the Web Interface***](toc.html#app5.4)'
  prefs: []
  type: TYPE_NORMAL
- en: The Laddie appliance boots up with the static IP address 192.168.1.11\. If your
    PC is connected to a local area network with an Ethernet card recognized by Laddie’s
    operating system, the appliance will serve web pages that allow you to monitor
    and control the appliance (see Figure E-2). You can access this web interface
    with a browser on the local network by using the URL [http://192.168.1.11](http://192.168.1.11/).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/363-2.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure E-2: The Laddie web interface*'
  prefs: []
  type: TYPE_NORMAL
- en: '**NOTE**'
  prefs: []
  type: TYPE_NORMAL
- en: '*You can also use the text-based web browser Lynx to access the Laddie web
    pages. Type **lynx** at a command prompt, and then navigate by following the instructions
    at the bottom of the display.*'
  prefs: []
  type: TYPE_NORMAL
- en: '[***Experimenting with the Linux Shell and Other User Interfaces***](toc.html#app5.5)'
  prefs: []
  type: TYPE_NORMAL
- en: In addition to the framebuffer and web interfaces, the Laddie appliance supports
    a command line interface, a front panel interface, and an SNMP interface. When
    experimenting with these other interfaces, you will find it useful to have a Linux
    shell so that you can interact directly with the operating system. If the Laddie
    appliance is on a network, you can access a login shell using telnet (i.e., telnet
    192.168.1.11). To log in, enter the username root and an empty password. You can
    also switch from the framebuffer user interface to a login prompt by pressing
    ctrl-alt-F1\. (If you want to return to the framebuffer interface later, press
    ctrl-alt-F7.)
  prefs: []
  type: TYPE_NORMAL
- en: Please see the appropriate chapters for instructions on accessing the CLI, front
    panel, and SNMP interfaces.
  prefs: []
  type: TYPE_NORMAL
- en: '[***Shutting Down the Laddie Appliance***](toc.html#app5.6)'
  prefs: []
  type: TYPE_NORMAL
- en: The Laddie operating system will not eject the CD while the system is running
    because it relies on the CD for necessary system files. To eject the CD and return
    to your original operating system, reboot your computer by typing reboot in a
    Linux shell. When you see the Laddie boot prompt (as shown in “Booting the CD”
    on page 338), press the spacebar to interrupt the automatic boot, eject the CD,
    then press CTRL-ALT-DEL to reboot your computer with your original operating system.
  prefs: []
  type: TYPE_NORMAL
- en: '[**Exploring the CD Contents**](toc.html#app5.7)'
  prefs: []
  type: TYPE_NORMAL
- en: If you boot the Laddie appliance and then explore the root filesystem from a
    Linux shell, you’ll find that most of the top-level directories exist in the ramdisk,
    and only the /bin, /lib, /sbin, and /usr directories are linked back to the CD.
    In particular, all the directories related to the Laddie appliance are read-write,
    so you can use the CD to experiment with, rebuild, and reinstall the appliance.
  prefs: []
  type: TYPE_NORMAL
- en: '[***Laddie Appliance Source Code***](toc.html#app5.8)'
  prefs: []
  type: TYPE_NORMAL
- en: The Laddie Appliance software is provided in /Code/src and is partitioned into
    packages corresponding to the various user interfaces and services. The binaries
    and related files are installed in /opt/laddie. Table E-1 identifies the source
    and install directories for each of the Laddie appliance components.
  prefs: []
  type: TYPE_NORMAL
- en: '**Table E-1:** Source and Install Directories for Laddie Appliance Components'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/364-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: In addition to these components, the /Code/src directory contains the buildapp
    subdirectory, which contains scripts and files that support building the appliance.
    This subdirectory also contains an examples subdirectory that includes the example
    programs we discuss in the text.
  prefs: []
  type: TYPE_NORMAL
- en: 'Where appropriate, component subdirectories include Makefiles. There is also
    a top-level Makefile in /Code/src that allows you to build and re-install the
    entire appliance with these commands:'
  prefs: []
  type: TYPE_NORMAL
- en: laddie:~# make
  prefs: []
  type: TYPE_NORMAL
- en: laddie:~# rm -rf /opt/laddie
  prefs: []
  type: TYPE_NORMAL
- en: laddie:~# make install
  prefs: []
  type: TYPE_NORMAL
- en: If you’d like to study the source code, a good place to start is the alarm code
    in the /Code/src/ladd subdirectory. This is a simple application, but it demonstrates
    both the empty daemon and the RTA library. The entry point for this service is
    in /Code/src/empd/main.c. The function main calls appInit in ladd.c, which uses
    RTA to publish a table of alarm zones.
  prefs: []
  type: TYPE_NORMAL
- en: '[***Laddie Appliance Libraries***](toc.html#app5.9)'
  prefs: []
  type: TYPE_NORMAL
- en: The Laddie appliance uses several libraries. The RTA library source is provided
    in the /usr/src/packages/rta-0.7.5.tgz tarball, and it is installed in /usr/local/lib
    and /usr/local/include.
  prefs: []
  type: TYPE_NORMAL
- en: 'The PostgreSQL client, the lighttpd daemon, and the SNMP utilities are well-documented
    open-source projects that we have compiled and installed without patches. The
    source code for the versions we use is provided in /usr/src/packages:'
  prefs: []
  type: TYPE_NORMAL
- en: postgresql-base-8.0.1.tar.bz2
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: lighttpd-1.4.10.tar.gz
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: net-snmp-5.1.3.1.tar.gz
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The RTA library and PostgreSQL client do not have configuration files. The lighttpd
    daemon uses the configuration file /etc/lighttpd.conf. PHP’s configuration file
    is in /etc/php.ini.
  prefs: []
  type: TYPE_NORMAL
- en: '[***Startup Scripts***](toc.html#app5.10)'
  prefs: []
  type: TYPE_NORMAL
- en: In order to launch the appliance at system startup, we add scripts to the /etc/rc.d/init.d
    directory. We also provide links from /etc/rc.d/rc3.d so that these scripts will
    be invoked in runlevel 3\. The Laddie startup scripts include ladd, logmuxd, networkd,
    snmpd, and tbl2filed. Each of these scripts also provides for the graceful termination
    of the appliance when the operating system shuts down. The framebuffer user interface
    is launched at startup using the fbmenuctl script, but because the console must
    be launched first, we invoke it from the /etc/inittab file.
  prefs: []
  type: TYPE_NORMAL
- en: For convenience when testing, we provide the laddie script in /opt/ laddie/bin.
    This script invokes all of the startup scripts specific to the appliance.
  prefs: []
  type: TYPE_NORMAL
- en: '[***The Linux From-Scratch Distribution and Additional Packages***](toc.html#app5.11)'
  prefs: []
  type: TYPE_NORMAL
- en: Had this been a real Linux appliance, we might have opted for a simpler Linux
    environment. We might have used a smaller kernel, BusyBox utilities, and uclibc
    libraries, for example. But our emphasis is not embedded Linux, and we feel a
    more generic Linux environment keeps the focus on the appliance architecture.
  prefs: []
  type: TYPE_NORMAL
- en: 'As a starting point, we used Linux From Scratch ([http://www.linuxfromscratch.org](http://www.linuxfromscratch.org)),
    a distribution that includes most of the tools we needed to build our appliance,
    and does not include the X Window System (which we didn’t need). All the packages
    required to rebuild the Laddie appliance are included in the /usr/src/packages
    directory. Most of these packages were installed according to instructions from
    the Linux From Scratch documentation, which is also included in the usr/src/packages
    directory as LFS-BOOK-6.0.pdf. Additional packages include the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/366-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: See the file /usr/src/packages/HISTORY for detailed installation notes for these
    additional packages.
  prefs: []
  type: TYPE_NORMAL
- en: '[**Rebuilding the Laddie Appliance**](toc.html#app5.12)'
  prefs: []
  type: TYPE_NORMAL
- en: As a quick illustration of the CD’s filesystem structure, let’s modify and reinstall
    a portion of the Laddie appliance. This won’t be permanent; we won’t create a
    new CD. We’ll just add a line to a .c file in the alarm daemon, recompile it at
    the Linux shell prompt, reinstall it, and run it.
  prefs: []
  type: TYPE_NORMAL
- en: If you’d like to follow along, boot up an x86 PC using the Laddie CD and bring
    up a shell console. See “Booting the CD” on page 338 for instructions.
  prefs: []
  type: TYPE_NORMAL
- en: '**NOTE**'
  prefs: []
  type: TYPE_NORMAL
- en: '*This exercise assumes you can use the vi editor. If you’re not familiar with
    vi, you can get up to speed quickly with vimtutor, which is also provided on the
    CD.*'
  prefs: []
  type: TYPE_NORMAL
- en: '1\. Since the alarm daemon will already be running, kill it with this command:'
  prefs: []
  type: TYPE_NORMAL
- en: laddie:~# laddie stop
  prefs: []
  type: TYPE_NORMAL
- en: '2\. Then use the following commands to enter the alarm daemon source directory
    and open the ladd.c file for editing:'
  prefs: []
  type: TYPE_NORMAL
- en: laddie:~# cd /Code/src/ladd
  prefs: []
  type: TYPE_NORMAL
- en: laddie:~# vi ladd.c
  prefs: []
  type: TYPE_NORMAL
- en: '3\. In the function user_update() at the end of the file, find the following
    lines:'
  prefs: []
  type: TYPE_NORMAL
- en: syslog(LOG_ALERT, "User set alarm on zone %d, %s",
  prefs: []
  type: TYPE_NORMAL
- en: Zone[rowid].id, Zone[rowid].name);
  prefs: []
  type: TYPE_NORMAL
- en: '4\. Immediately after these lines, insert the following:'
  prefs: []
  type: TYPE_NORMAL
- en: syslog(LOG_ALERT, "Hello, world! I've modified the alarm daemon!");
  prefs: []
  type: TYPE_NORMAL
- en: '5\. Save the file and then quit vi. Build and reinstall ladd with the commands:'
  prefs: []
  type: TYPE_NORMAL
- en: laddie:~# export DEF_APPDIR=/opt/laddie
  prefs: []
  type: TYPE_NORMAL
- en: laddie:~# make -e
  prefs: []
  type: TYPE_NORMAL
- en: laddie:~# make -e install
  prefs: []
  type: TYPE_NORMAL
- en: '**NOTE**'
  prefs: []
  type: TYPE_NORMAL
- en: '*The Laddie appliance components use the environment variable DEF_APPDIR to
    specify the install location. The default is the more conventional location /usr/local,
    but we use /opt/laddie instead to make it easier for you to identify the components
    that are specific to the appliance. The -e option tells the make utility to let
    environment variables override variables that occur in the Makefiles.*'
  prefs: []
  type: TYPE_NORMAL
- en: 'This will create a new executable and install it in /opt/laddie/bin. Then start
    the alarm daemon by entering this command:'
  prefs: []
  type: TYPE_NORMAL
- en: laddie:~# laddie start
  prefs: []
  type: TYPE_NORMAL
- en: '6\. Press ESC to exit the framebuffer user interface. Then monitor the system
    logs with this command:'
  prefs: []
  type: TYPE_NORMAL
- en: laddie:~# cat /var/log/messages
  prefs: []
  type: TYPE_NORMAL
- en: Log messages are routed to the pipe /var/log/messages by the logmuxd event handler.
    Using cat, we can display these messages at the console. The command will do nothing
    until an event occurs.
  prefs: []
  type: TYPE_NORMAL
- en: '7\. To create a user update event, use ctrl-alt-F2 to switch to console 2,
    and then run the command line interface:'
  prefs: []
  type: TYPE_NORMAL
- en: laddie:~# cli
  prefs: []
  type: TYPE_NORMAL
- en: '8\. Create an update event with the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: clear all
  prefs: []
  type: TYPE_NORMAL
- en: test 1
  prefs: []
  type: TYPE_NORMAL
- en: quit
  prefs: []
  type: TYPE_NORMAL
- en: 9\. Now use ctrl-alt-F1 to switch back to the original console. If your reinstall
    worked, the displayed log messages will contain a time-stamped entry with your
    new “Hello, world!” message.
  prefs: []
  type: TYPE_NORMAL
- en: 10\. Use ctrl-C to terminate the logging display.
  prefs: []
  type: TYPE_NORMAL
