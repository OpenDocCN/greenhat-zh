- en: '![](../images/247-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '[**HANDS-ON INTRODUCTION TO SNMP**](toc.html#chapter13)'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/as.jpg)'
  prefs: []
  type: TYPE_IMG
- en: We like to say that the difference between a hobby and a commercial network
    appliance is SNMP. Any corporation with a large network will use Simple Network
    Management Protocol (SNMP) as part of its network- and system-management solution.
    You simply cannot sell into the large enterprise and telecommunications carrier
    markets without SNMP support on your appliance.
  prefs: []
  type: TYPE_NORMAL
- en: If your target market includes companies with large networks and you are not
    confident in your knowledge of SNMP, this chapter is for you. If, however, you
    will be targeting the home or small business market (or your appliance will not
    be networked at all), you can safely skip this and the SNMP chapters that follow.
  prefs: []
  type: TYPE_NORMAL
- en: 'This chapter will introduce SNMP and provide you with an appreciation of some
    of the things SNMP can do. The topics covered in this chapter are:'
  prefs: []
  type: TYPE_NORMAL
- en: A brief introduction to SNMP terminology
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Finding the software
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing the software
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Starting the agent
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Exploring with SNMP
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Writing values with SNMP
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: SNMP traps
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[**A Quick Note on Terminology**](toc.html#chapter13.1)'
  prefs: []
  type: TYPE_NORMAL
- en: Here is a quick tour of the most basic concepts and terms you will need in order
    to understand the material in this chapter. For a complete introduction to SNMP
    concepts and terminology, see Appendix B.
  prefs: []
  type: TYPE_NORMAL
- en: '*SNMP is* a protocol designed to facilitate the reading and writing of small
    amounts of information over a network, like single numbers and character strings.
    You would not use SNMP for large volumes of data, like file transfer.'
  prefs: []
  type: TYPE_NORMAL
- en: A read operation in SNMP is called a GET, while a write is called a SET. The
    target of a SET or GET operation is called an object. An *object* is like a field
    in a database record.
  prefs: []
  type: TYPE_NORMAL
- en: SNMP treats objects as if they were organized into a single large database called
    the *Management Information Base (MIB).* It may be helpful to think of SNMP as
    an API to the information on a device. It hides the details of object retrieval
    beneath an organized hierarchical namespace. An SNMP agent on each system provides
    this API. The *agent is* a background (daemon) process listening for SNMP requests
    on UDP port 161\. Beneath the API, the agent may interact with the kernel or some
    application process running on the system; it may also read several pieces of
    information from different sources and apply a mathematical formula to furnish
    the value defined in a MIB. An object in the MIB may also represent functionality
    rather than data; for example, setting a MIB object to a particular value might
    trigger a reboot or the restarting of a service.
  prefs: []
  type: TYPE_NORMAL
- en: 'The MIB hierarchical namespace is much like the Unix filesystem, but it uses
    numbers instead of directory and filenames, and it uses the . character instead
    of the / directory separator. So, whereas a file path may look like this:'
  prefs: []
  type: TYPE_NORMAL
- en: /usr/sbin/ifconfig
  prefs: []
  type: TYPE_NORMAL
- en: 'the name (called an *Object Identifier,* or *OID)* for an object in the MIB
    might look like this:'
  prefs: []
  type: TYPE_NORMAL
- en: .1.3.6.1.2.1.1.1
  prefs: []
  type: TYPE_NORMAL
- en: MIB files describe portions of the complete MIB database. Typically, each MIB
    file describes a *MIB module,* which is a subtree of the overall database. MIB
    files are both human readable and program readable. They document the MIB for
    humans, and they provide a means for programs to translate between these number
    strings and their human-readable names. Although we have talked about *the MIB*
    as the SNMP-addressable universe, the more common use of the term *MIB* is for
    one of these named subtrees. For example, you will hear talk of the *Host Resources
    MIB,* or the *HP Printer MIB,* or *MIB-2.* These are all subtrees, but they are
    also all addressable within the overall namespace.
  prefs: []
  type: TYPE_NORMAL
- en: First and foremost among MIBs is the cryptically named *MIB-II.* When SNMP was
    first created, the SNMP working group of the IETF defined a core set of information.
    This was the first MIB, or *MIB-I.* A few years later, the SNMP WG revised this
    core set and it became *MIB-II.* We use *MIB-2,* rather than MIB-II, in this chapter
    to match the name used in the MIB file that defines this MIB.
  prefs: []
  type: TYPE_NORMAL
- en: 'Once you have the right MIB files installed (you’ll see how to do this later),
    you can use the snmptranslate command to give you the human-readable names for
    a numeric ID (more on this later, too). For example:'
  prefs: []
  type: TYPE_NORMAL
- en: $snmptranslate -Of .1.3.6.1.2.1.1.1
  prefs: []
  type: TYPE_NORMAL
- en: .iso.org.dod.internet.mgmt.mib-2.system.sysDescr
  prefs: []
  type: TYPE_NORMAL
- en: $
  prefs: []
  type: TYPE_NORMAL
- en: This should be enough terminology to get started.
  prefs: []
  type: TYPE_NORMAL
- en: '[**The Software**](toc.html#chapter13.2)'
  prefs: []
  type: TYPE_NORMAL
- en: The Net-SNMP is an excellent free package containing all you’ll need to follow
    along in this chapter. Net-SNMP will provide you with commands (snmpget, snmpset,
    snmpwalk, snmptrap), an SNMP agent, and the standard MIB files. Normally, the
    commands and agent would be running on different systems, but for simplicity you’ll
    be running both on the same system. If you have two systems available, you can
    perform the full installation on both systems; then you can run snmpget, for example,
    on one system, and talk to the agent on the other. If you use two systems, remember
    to change all instances of localhost or 127.0.0.1 in this chapter’s code to the
    name or address of the system running the SNMP agent.
  prefs: []
  type: TYPE_NORMAL
- en: '[**Installing SNMP**](toc.html#chapter13.3)'
  prefs: []
  type: TYPE_NORMAL
- en: Before installing, check to see if Net-SNMP is already installed on your system—many
    common Linux distributions provide some version of it. If you have a very old
    Linux distribution (like Red Hat 7.*x*) you may find UCD-SNMP instead; this is
    an older version—or parent—of Net-SNMP. Although its behavior is very similar
    to that of Net-SNMP, there are enough differences to confuse someone trying to
    follow this tutorial; you should remove it, and follow the instructions here to
    install Net-SNMP. If you find some other package installed, definitely remove
    it before continuing.
  prefs: []
  type: TYPE_NORMAL
- en: Even if Net-SNMP is not currently installed on your system, it may be packaged
    with your Linux distribution, so check your CDs. Be aware, though, that various
    Linux distributions may have modified Net-SNMP to comply with their own ideas
    of default file locations and it may include different patches. Naturally, the
    closer your version of Net-SNMP is to the one used in this chapter (version 5.2.1),
    the closer your results will be to the ones shown here.
  prefs: []
  type: TYPE_NORMAL
- en: '[***Download and Install***](toc.html#chapter13.4)'
  prefs: []
  type: TYPE_NORMAL
- en: If Net-SNMP is not included with your Linux distribution, you can download it
    from [http://net-snmp.sourceforge.net](http://net-snmp.sourceforge.net/). You
    can install either from RPM (assuming you are running an RPM-based distribution
    like Fedora) or source, but for now let’s install the binary RPM. (By the way,
    if rpm complains about missing dependencies, you may have to take care of them
    first and then retry this command.)
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/250-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '[***Check the Installation***](toc.html#chapter13.5)'
  prefs: []
  type: TYPE_NORMAL
- en: Now test that it worked. First, test the agent.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/250-2.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Now check the tools. Use which to find out where they were installed, then list
    all the commands in that directory that start with *snmp*.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/250-3.jpg)'
  prefs: []
  type: TYPE_IMG
- en: We’ll only use a handful of these commands, but feel free to explore others
    once you’ve mastered the basics.
  prefs: []
  type: TYPE_NORMAL
- en: Now let’s check the version to make sure it is what we just installed and not
    some older version that’s lurking on your path.
  prefs: []
  type: TYPE_NORMAL
- en: $ snmpwalk --version
  prefs: []
  type: TYPE_NORMAL
- en: 'NET-SNMP version: 5.2.1'
  prefs: []
  type: TYPE_NORMAL
- en: $
  prefs: []
  type: TYPE_NORMAL
- en: '[***Configure the Agent***](toc.html#chapter13.6)'
  prefs: []
  type: TYPE_NORMAL
- en: So far, so good—you have the client-side programs. Now you need to get the agent
    running so these programs have something to query.
  prefs: []
  type: TYPE_NORMAL
- en: The agent runs as a daemon and listens for incoming SNMP requests on UDP port
    161, by default. It requires some configuration information that it normally picks
    up from the file snmpd.conf in the directory /etc/snmp. (Note the *d* in snmpd.conf;
    it indicates *daemon*—our agent. Do not confuse this with snmp.conf, which we
    will introduce later on.) Snmpd.conf tells the agent how to authenticate incoming
    requests, where to send traps (which are SNMP alarm notifications), and so forth.
  prefs: []
  type: TYPE_NORMAL
- en: 'Net-SNMP provides a program called snmpconf that generates the snmpd.conf file
    from the answers to a series of questions, but because your needs here are pretty
    simple, you can generate the configuration by hand. Your snmpd.conf file should
    contain:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/251-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The rocommunity macro sets your read-only community string, which for now you
    can think of as something like a password. Net-SNMP gives you much more precise
    access control than this, but that’s beyond our needs right now.
  prefs: []
  type: TYPE_NORMAL
- en: The syslocation and syscontact lines set the values for the sysLocation and
    sysContact objects in the MIB-2 system group. When you are managing only a small
    set of systems all in one location, this information may not be very interesting,
    but in a large corporate network with multiple sites, it may be invaluable to
    know how to locate a system and find out who is in charge of it. (A little later
    in this chapter, you’ll see how to access this information across the network
    with SNMP queries.)
  prefs: []
  type: TYPE_NORMAL
- en: Place this snmpd.conf file into the /etc/snmp directory. The three lines above
    are all you’ll need to get started.
  prefs: []
  type: TYPE_NORMAL
- en: '[***Start the Agent***](toc.html#chapter13.7)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Start the agent, and put it into the background. The agent listens on port
    161, so you’ll need to be logged in as root to issue this command:'
  prefs: []
  type: TYPE_NORMAL
- en: /usr/sbin/snmpd -c /etc/snmp/snmpd.conf -C &
  prefs: []
  type: TYPE_NORMAL
- en: The -c /etc/snmp/snmpd.conf tells the agent to use the given configuration file,
    and -C tells the agent to use only this configuration file.
  prefs: []
  type: TYPE_NORMAL
- en: For now, you can just type the above command (as root), but on your appliance
    you’ll want the SNMP agent to start up with the system.
  prefs: []
  type: TYPE_NORMAL
- en: '[**Exploring with SNMP**](toc.html#chapter13.8)'
  prefs: []
  type: TYPE_NORMAL
- en: Now let’s turn our attention to the client side. The commands snmpget, snmpwalk,
    and snmpset are all SNMP client commands, or *SNMP management applications,* in
    SNMP-speak. SNMP uses the term *manager* or *management application* for the client
    side and *agent* for the server side. The agent serves up the data on the appliance,
    and the SNMP manager is the client requesting the appliance’s information. You
    won’t need to be logged in as root to use these client commands.
  prefs: []
  type: TYPE_NORMAL
- en: Let’s use snmpget to test our agent install.
  prefs: []
  type: TYPE_NORMAL
- en: $ snmpget -v2c -c public localhost sysLocation.0
  prefs: []
  type: TYPE_NORMAL
- en: 'SNMPv2-MIB::sysLocation.0 = STRING: "my den"³'
  prefs: []
  type: TYPE_NORMAL
- en: $
  prefs: []
  type: TYPE_NORMAL
- en: You’ve told snmpget to use SNMPv2c (community-based SNMP version 2) and the
    community string public to send a query to the local machine asking for the value
    of the sysLocation variable, which you configured in your snmpd.conf file. The
    .0 appended to the sysLocation name is SNMP’s way of indicating that you want
    the *instance* of this variable. In object-oriented language, think of sysLocation
    as a class that has one instance. If this were an array (table) of locations,
    the .0 would be replaced by the row number of the variable (.1, .2, .3, and so
    on). Row numbers always start with 1, so there is no confusion between a row index
    and a scalar indicator.
  prefs: []
  type: TYPE_NORMAL
- en: You need to tell the snmpget command to use SNMPv2c, because it defaults to
    SNMPv3; you can change that by generating an snmp.conf file with a different default.
    You could use snmpconf to generate the file, this time selecting snmp.conf (no
    *d)*, but you can also just create the snmp.conf file by hand with this single
    command (run as root).
  prefs: []
  type: TYPE_NORMAL
- en: echo "defversion 2c" > /etc/snmp/snmp.conf
  prefs: []
  type: TYPE_NORMAL
- en: Now you can stop typing the -v2c with each command.
  prefs: []
  type: TYPE_NORMAL
- en: 'If you have access to any other networked devices, you might try querying them.
    For example, here’s the snmpwalk command run against an Apple AirPort Base Station:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/253-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Clearly, the device’s sysDescr.0 (system description) identifies this as an
    Apple Base Station. You’ll also recognize the sysLocation and sysContact information
    for this device. This device doesn’t offer up a lot of information, but there
    is enough to identify what it is, where it is, and who to contact about any issues
    you have with this box, should you discover that it’s misbehaving. Of course,
    the availability of the system contact and location both rely on the administrator
    of that system, who is configuring these values on the target device. An inattentive
    system administrator may leave you little to work with.
  prefs: []
  type: TYPE_NORMAL
- en: Notice that for this query we used snmpwalk instead of snmpget because we wanted
    to see what other information might be furnished by this device. The snmpget command
    retrieves a single object instance using an SNMP GET protocol data unit, while
    snmpwalk uses multiple SNMP GETNEXT PDUs to “walk” an entire MIB. You pick a starting
    point, and snmpwalk asks for the lexically next object instance; the agent returns
    that object and its OID, and snmpwalk asks for the next object instance after
    the new OID. Eventually, the agent responds that there is nothing more to return,
    and the walk terminates.
  prefs: []
  type: TYPE_NORMAL
- en: '[***MIB Files for Readable Names***](toc.html#chapter13.9)'
  prefs: []
  type: TYPE_NORMAL
- en: 'The display of nice, readable names for OIDs—like *sysDescr* and *sysLocation*—depends
    on having the right MIB files registered on your client system. In the case of
    Net-SNMP, *registration* simply means putting these files in the right directory
    and telling the SNMP commands (like snmpget and snmpwalk) to use them. You can
    set a few environment variables to do this job for you. Just put these lines in
    your shell startup file (e.g., .bashrc):'
  prefs: []
  type: TYPE_NORMAL
- en: export MIBS=ALL
  prefs: []
  type: TYPE_NORMAL
- en: export MIBDIRS=/usr/share/snmp/mibs
  prefs: []
  type: TYPE_NORMAL
- en: When you installed Net-SNMP, it placed a set of standard MIB files in /usr/share/snmp/mibs,
    as you can see in the list below. These are all plaintext files written using
    a human-readable and machine-parseable syntax.
  prefs: []
  type: TYPE_NORMAL
- en: Some of these actually describe MIBs. Others are support files that define information
    needed by the files that describe the MIBs, just as header files are used in the
    C language.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/254-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Without these MIB files, the display of the Apple Base Station system group
    would have looked like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/254-2.jpg)'
  prefs: []
  type: TYPE_IMG
- en: You can still tell a lot about the device just from examining the responses,
    but it’s nice to know what the OIDs mean.
  prefs: []
  type: TYPE_NORMAL
- en: '[***A Networked Printer***](toc.html#chapter13.10)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s try another query against a different kind of device:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/255-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'This time, the administrator has not set sysContact and sysLocation. However,
    we can at least determine the type of device being used. One clue is in the sysDescr
    field: *HP ETHERNET . . . JETDIRECT. . . .* This is a networked HPJetdirect printer.'
  prefs: []
  type: TYPE_NORMAL
- en: Another clue, though one much harder for a novice to read, is in the *sysObjectID*—the
    OID in this field indicates the type of device. This OID starts with enterprises,
    indicating that the next number (11) is the enterprise number of the manufacturer;
    you can find a list of manufacturers’ enterprise numbers at [http://www.iana.org/assignments/enterprise-numbers](http://www.iana.org/assignments/enterprise-numbers).
    Here you will find that 11 is registered to Hewlett Packard. The rest of the OID
    (.2.3.9.1) would identify the type of device, if you had the right MIB file on
    your system.
  prefs: []
  type: TYPE_NORMAL
- en: '[***The snmptable Command***](toc.html#chapter13.11)'
  prefs: []
  type: TYPE_NORMAL
- en: This printer’s SNMP agent offers much more information than just the system
    group, giving us a chance to illustrate another command, snmptable. This command
    behaves much like snmpwalk, but it formats the output differently. We use it here
    to look at the TCP Connection Table on the same HP Jetdirect printer.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/255-2.jpg)'
  prefs: []
  type: TYPE_IMG
- en: From this table you can see the TCP ports on which the printer is listening.
    You can also see that two connections are in *timeWait* state, one between the
    printer (10.0.0.183, port 80) and a remote system (10.0.1.3, port 19333), and
    another between two TCP ports on the local system itself.
  prefs: []
  type: TYPE_NORMAL
- en: '[***MIB-2: The TCP Connection Table***](toc.html#chapter13.12)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Now we’ll take a look at our own system. Here is the TCP Connection Table from
    our local system:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/256-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'Compare this to the information about our TCP listening habits from the output
    of netstat:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/256-2.jpg)'
  prefs: []
  type: TYPE_IMG
- en: It is clearly the same information, right? SNMP lets you access this information
    not only on your local system, but on other systems across the network, as well.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now open Firefox, point your browser to [http://www.cnn.com](http://www.cnn.com/),
    and then look at the TCP Connection Table again:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/256-3.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '![](../images/257-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Several connections have been added to the table, all from ephemeral ports on
    your local system to port 80 on several remote systems. These are the connections
    used by the browser to fetch the various parts of the CNN main page.
  prefs: []
  type: TYPE_NORMAL
- en: '[***MIB-2: The UDP Table***](toc.html#chapter13.13)'
  prefs: []
  type: TYPE_NORMAL
- en: Another table from MIB-2 that might be of interest is the UDP table.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/257-2.jpg)'
  prefs: []
  type: TYPE_IMG
- en: This table shows the open UDP ports on your system, that is, the ports where
    some application on your system is listening. (The SNMP agent itself is listening
    on port 161.) For reference, the address of *this* system is 10.0.1.5.
  prefs: []
  type: TYPE_NORMAL
- en: Compare this with the netstat output. You’ll have to run netstat as root to
    get the program names.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/257-3.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '[***MIB-2 Contents***](toc.html#chapter13.14)'
  prefs: []
  type: TYPE_NORMAL
- en: In SNMP, the term *group* refers to a subdivision of a MIB consisting of a collection
    of objects or tables that are related in some way. For example, MIB-2’s UPD and
    TCP groups are all about UDP and TCP traffic, respectively. The Net-SNMP agent
    can be built to support a variety of MIBs, but you can always expect to find the
    MIB-2 groups system, interfaces, ip, icmp, tcp, udp, and snmp. These are not all
    of the groups defined in MIB-2, but they are the ones most likely to be supported
    by any SNMP agent. Figure 13-1 shows the location of MIB-2 in the overall MIB
    address space and breaks out some of the groups that comprise MIB-2\. Also notice
    the location of the private.enterprises branch. That’s where you can find the
    HP Printer MIB objects you saw earlier.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/258-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*Figure 13-1: MIB-2*'
  prefs: []
  type: TYPE_NORMAL
- en: 'Try walking these groups:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/258-2.jpg)'
  prefs: []
  type: TYPE_IMG
- en: If you feel up to a challenge, try comparing the output of the above commands
    with the contents of the MIB files.⁶ The output of the snmpwalk commands listed
    here will indicate, at the beginning of each output line, the MIB file where you
    can find the definition of the object displayed.
  prefs: []
  type: TYPE_NORMAL
- en: 'SNMPv2-MIB::snmpInPkts.0 = Counter32: 5998'
  prefs: []
  type: TYPE_NORMAL
- en: 'SNMPv2-MIB::snmpOutPkts.0 = Counter32: 5998'
  prefs: []
  type: TYPE_NORMAL
- en: 'SNMPv2-MIB::snmpInBadVersions.0 = Counter32: 0'
  prefs: []
  type: TYPE_NORMAL
- en: These lines indicate that you can find these definitions in the MIB file SNMPv2-MIB.txt.
    For help interpreting what you find in the MIB file, you can read Appendix B.
  prefs: []
  type: TYPE_NORMAL
- en: 'You are also likely to find that your SNMP agent has been built to include
    the Host Resources MIB, the UCDavis MIB, and the newer Net-SNMP MIB. Try walking
    these with the following commands:'
  prefs: []
  type: TYPE_NORMAL
- en: snmpwalk -c public localhost enterprises ucdavis
  prefs: []
  type: TYPE_NORMAL
- en: snmpwalk -c public localhost enterprises netSnmp
  prefs: []
  type: TYPE_NORMAL
- en: One of the objects that might interest you is the version of your own agent.
  prefs: []
  type: TYPE_NORMAL
- en: $snmpget -c public localhost versionTag.0
  prefs: []
  type: TYPE_NORMAL
- en: 'UCD-SNMP-MIB::versionTag.0 = STRING: 5.2.1'
  prefs: []
  type: TYPE_NORMAL
- en: '[**Writing Values with SNMP**](toc.html#chapter13.15)'
  prefs: []
  type: TYPE_NORMAL
- en: As well as reading information from an agent, SNMP can be used to set the values
    of objects on a remote system. Let’s pick an object that is defined to have read-write
    access and experiment with it a little.
  prefs: []
  type: TYPE_NORMAL
- en: '[***Setting sysContact***](toc.html#chapter13.16)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Look through the MIB defining the system group in MIB-2\. Remember that when
    we accessed the system group, the resulting display contained lines that looked
    like this:'
  prefs: []
  type: TYPE_NORMAL
- en: 'SNMPv2-MIB::sysContact.0 = STRING: [me@myaddr.com](mailto:me@myaddr.com)'
  prefs: []
  type: TYPE_NORMAL
- en: 'SNMPv2-MIB::sysName.0 = STRING: localhost.localdomain'
  prefs: []
  type: TYPE_NORMAL
- en: 'SNMPv2-MIB::sysLocation.0 = STRING: "the den"'
  prefs: []
  type: TYPE_NORMAL
- en: 'See the SNMPV2-MIB at the start of each line? That indicates that these objects
    are defined in the file SNMPv2-MIB.txt. If you look at the definitions of these
    objects in that file, you’ll see this snippet:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/259-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '![](../images/260-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'You can see from this snippet that the MIB file defines the three objects we
    read the values of above: sysContact, sysName, and sysLocation. Each of these
    is described as an OBJECT-TYPE with a syntax of DisplayString, read-write access,
    and a status of current. Each object has a description and a line starting with
    :: =, meaning *is defined as. System* is a group in MIB-2 that has an OID of {
    .1.3.6.1.2.1.1 }. These lines in the MIB file indicate that these three object
    types are defined as objects 4, 5, and 6 following system (.1.3.6.1.2.1.1), so
    their OIDs are:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/260-2.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Notice that these are OIDs of the OBJECT-TYPE definitions, not their instances.
    Remember, if you want to use snmpget to read the value of the instance, you need
    to add a .0 to the end of the type OID.
  prefs: []
  type: TYPE_NORMAL
- en: Enough of reading MIBs—we just want to find a read-write type so we can try
    a SET. Let’s try setting sysContact.
  prefs: []
  type: TYPE_NORMAL
- en: $ snmpset -c public localhost sysContact.0 s "[me@myself.com](mailto:me@myself.com)"
  prefs: []
  type: TYPE_NORMAL
- en: 'snmpset: Unknown host (Permission denied)⁸'
  prefs: []
  type: TYPE_NORMAL
- en: $
  prefs: []
  type: TYPE_NORMAL
- en: The agent refused the request. Why? Remember your configuration file?
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/261-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'You set a read-only community string, but not a read-write one, so you don’t
    have permission to set any values. You’ll have to configure a read-write community
    name. Add the following line to your snmpd.conf file to configure a read-write
    community string writer:'
  prefs: []
  type: TYPE_NORMAL
- en: rwcommunity writer
  prefs: []
  type: TYPE_NORMAL
- en: 'Now you’ll need to bring this change to the attention of the SNMP agent. Send
    the agent a SIGHUP signal to make it re-read its configuration. You will have
    to do this as root:'
  prefs: []
  type: TYPE_NORMAL
- en: killall -s HUP snmpd
  prefs: []
  type: TYPE_NORMAL
- en: Now try snmpset again.
  prefs: []
  type: TYPE_NORMAL
- en: $ snmpset -c writer localhost sysContact.0 s "[me@myself.com](mailto:me@myself.com)"
  prefs: []
  type: TYPE_NORMAL
- en: Error in packet.
  prefs: []
  type: TYPE_NORMAL
- en: 'Reason: notWritable (that object does not support modification)'
  prefs: []
  type: TYPE_NORMAL
- en: 'Failed object: SNMPv2-MB::sysContact.0'
  prefs: []
  type: TYPE_NORMAL
- en: The agent refused again! This time, the reason is a little less obvious. The
    Net-SNMP agent will refuse requests to set new values if the object’s value has
    been configured in the snmpd.conf file. This is not part of the SNMP standard,
    it’s just how Net-SNMP works. It presumes that since you configured these values
    through the snmpd.conf file, you probably don’t want someone else changing them
    remotely. If you want these values to be writable, you need to set their values
    using local snmpset commands, rather than by using the configuration file.
  prefs: []
  type: TYPE_NORMAL
- en: '**NOTE**'
  prefs: []
  type: TYPE_NORMAL
- en: '*Apologies for leading you astray here. Our intent was to highlight this non-obvious
    behavior of Net-SNMP and possibly save you some time later.*'
  prefs: []
  type: TYPE_NORMAL
- en: '[***Setting sysName***](toc.html#chapter13.17)'
  prefs: []
  type: TYPE_NORMAL
- en: Now that you know sysContact and sysLocation are not writable for you because
    of their definitions in the configuration file, try sysName. You haven’t configured
    a value for that.
  prefs: []
  type: TYPE_NORMAL
- en: $ snmpset -c writer localhost sysName.0 s "NewName"
  prefs: []
  type: TYPE_NORMAL
- en: 'SNMPv2-MIB::sysName.0 = STRING: NewName'
  prefs: []
  type: TYPE_NORMAL
- en: The snmpset command requires that you use the read-write community string and
    that you specify the name of the object instance, the type, and the new value.
    The s indicates that you are writing a string value. This tells the snmpset command
    how to format the SET packet. Had you written an integer variable, the type would
    have been i. For a full list of types, read the man page for snmpset. The type
    of the value you set, of course, must match the type of the object you are setting.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here’s what sysContact, sysName, and sysLocation look like now:'
  prefs: []
  type: TYPE_NORMAL
- en: $ snmpget -c public localhost sysContact.0 sysName.0 sysLocation.0
  prefs: []
  type: TYPE_NORMAL
- en: 'SNMPv2-MIB::sysContact.0 = STRING: [me@myaddr.com](mailto:me@myaddr.com)'
  prefs: []
  type: TYPE_NORMAL
- en: 'SNMPv2-MIB::sysName.0 = STRING: NewName'
  prefs: []
  type: TYPE_NORMAL
- en: 'SNMPv2-MIB::sysLocation.0 = STRING: "the den"'
  prefs: []
  type: TYPE_NORMAL
- en: $
  prefs: []
  type: TYPE_NORMAL
- en: '[**SNMP Traps**](toc.html#chapter13.18)'
  prefs: []
  type: TYPE_NORMAL
- en: As well as responding to SNMP requests like SET and GET, SNMP-enabled devices
    in the network can send out spontaneous notifications of local events. These notifications
    are sent either as SNMP traps or informs. *Traps* are datagrams sent without the
    expectation of a response. *Informs* are an improvement over traps because they
    expect a confirmation response and are re-sent when the trap receiver does not
    confirm them in a timely fashion. The time-out and the number of retries can be
    set by the trap sender as parameters to the snmptrap command.
  prefs: []
  type: TYPE_NORMAL
- en: '[***Receiving Traps with snmptrapd***](toc.html#chapter13.19)'
  prefs: []
  type: TYPE_NORMAL
- en: 'You can use snmptrapd to receive traps. In the 5.2.1 release of Net-SNMP, which
    we have been using in this chapter, all you have to do is open a separate terminal
    window and execute the following command as root:'
  prefs: []
  type: TYPE_NORMAL
- en: snmptrapd -Os -Le -f
  prefs: []
  type: TYPE_NORMAL
- en: 'As of the 5.3 release, however, the security of snmptrapd was tightened so
    that it no longer defaults to accepting traps with any community name. In later
    versions, you need to create an snmptrapd.conf file in the /etc/snmp directory
    and include a line telling it which communities to accept. We will be using *public,*
    so our snmptrapd.conf file would contain the following:'
  prefs: []
  type: TYPE_NORMAL
- en: authCommunity log public
  prefs: []
  type: TYPE_NORMAL
- en: Now you can issue the snmptrapd command described above to view the traps you
    receive.
  prefs: []
  type: TYPE_NORMAL
- en: This command normally runs in the background where it can receive traps, format
    them, and write them to a log file. However, you are using the -f parameter here
    to tell snmptrapd to stay in the foreground and the -Le parameter to send its
    output to stderr. You can also use the -Os parameter to tell snmptrapd to print
    only the last symbolic part of the OID, which will save space and make the output
    more readable.
  prefs: []
  type: TYPE_NORMAL
- en: 'Use a separate command window for sending traps using the snmptrap command.
    You’ll need to run snmptrapd as root, because it wants to listen on UDP port 162\.
    To give it a quick try, run either of the following as root:'
  prefs: []
  type: TYPE_NORMAL
- en: snmptrap -c public localhost "" coldStart
  prefs: []
  type: TYPE_NORMAL
- en: or
  prefs: []
  type: TYPE_NORMAL
- en: snmptrap -c public localhost "" .1.3.6.1.6.3.1.1.5.1
  prefs: []
  type: TYPE_NORMAL
- en: 'You can change the format of the output to be much more readable than we show
    below, but that would require formatting instructions that are beyond what you
    need here. The default format for output from snmptrapd looks like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '2007-02-14 20:43:26 localhost.localdomain [127.0.0.1]:'
  prefs: []
  type: TYPE_NORMAL
- en: 'sysUpTimeInstance = Timeticks: (4694125) 13:02:21.25'
  prefs: []
  type: TYPE_NORMAL
- en: 'snmpTrapOID.0 = OID: cold Start'
  prefs: []
  type: TYPE_NORMAL
- en: Keep in mind that you are using SNMPv2\. The format for sending an SNMPv1 trap
    is different and a bit more complicated.
  prefs: []
  type: TYPE_NORMAL
- en: 'A coldStart trap technically means the network management software has restarted
    with no change in configuration. Typically, this only happens when the system
    running the agent has rebooted, so many users think of coldStart as a reboot indicator;
    however, it will also be sent any time the agent restarts. If you configure a
    trap target in the snmpd.conf file and restart the agent, your snmptrapd will
    receive a trap from it. Give it a try—add the following line to your snmpd.conf
    file:'
  prefs: []
  type: TYPE_NORMAL
- en: trap2sink localhost public
  prefs: []
  type: TYPE_NORMAL
- en: 'Now kill the agent and restart it, or send it another SIGHUP; snmptrapd will
    indicate that it has received a coldStart trap. Now that the agent has the trap
    target configured, restart it again. Here’s what snmptrapd will display this time:'
  prefs: []
  type: TYPE_NORMAL
- en: '2007-02-14 12:06:17 localhost.localdomain [127.0.0.1]:'
  prefs: []
  type: TYPE_NORMAL
- en: 'sysUpTimeInstance = Timeticks: (33324) 0:05:33.24 snmpTrapOID.0 = OID:'
  prefs: []
  type: TYPE_NORMAL
- en: nsNotifyShutdown
  prefs: []
  type: TYPE_NORMAL
- en: '2007-02-14 12:06:37 localhost.localdomain [127.0.0.1]:'
  prefs: []
  type: TYPE_NORMAL
- en: 'sysUpTimeInstance = Timeticks: (36) 0:00:00.36 snmpTrapOID.0 = OID: coldStart'
  prefs: []
  type: TYPE_NORMAL
- en: 'snmpTrapEnterprise.0 = OID: netSnmpAgentOIDs.10'
  prefs: []
  type: TYPE_NORMAL
- en: 'This is a bit of a jumble, but you can find the beginning of each trap by looking
    for the time stamp. You will have received two traps: nsNotifyShutdown and coldStart.
    The agent had the trap target configured at the time it was shut down, so it sent
    out a trap indicating it was going away. When we started it again (20 seconds
    later, by the time stamp in this example) it sent a coldStart.'
  prefs: []
  type: TYPE_NORMAL
- en: Unlike the coldStart, nsNotifyShutdown is not a trap defined in the SNMP specification,
    but rather in the NET-SNMP-AGENT-MIB.txt file. It is one of the Net-SNMP enterprise
    traps, meaning it has OIDs under the private.enterprises section of the MIB tree.
    This is where you will define your traps when you develop your own MIB in the
    next chapter.
  prefs: []
  type: TYPE_NORMAL
- en: '[***Traps That Carry Data: linkUp and linkDown***](toc.html#chapter13.20)'
  prefs: []
  type: TYPE_NORMAL
- en: 'The traps you’ve seen here, coldStart and nsNotifyShutdown, do not carry any
    extra data. They only tell you that a shutdown or startup happened. The generic
    traps linkDown and linkUp are different; they contain extra information as specified
    in the OBJECTS line of their definitions:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/264-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The OBJECTS line in each trap definition is the list of parameters that will
    be sent in the trap. The first is ifIndex, which is the index into the interface
    table in the interfaces section under MIB-2\. The others define the administrative
    and operational status of the interface. Try viewing this table on your own system.
    It is a little wide to display with the snmptable command, so here’s an snmpwalk
    of ifTable.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/264-2.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '![](../images/265-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: This trap shows that interface 2 (which you can see is eth0, from the walk of
    ifTable above) is administratively up but operationally down. Since this machine
    only has a single Ethernet interface, you’re unlikely to see any traps of this
    kind (you can’t send a trap from an interface that’s offline), but you would see
    the linkUp trap when the interface comes back up.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../images/266-1.jpg)'
  prefs: []
  type: TYPE_IMG
- en: By this time, you should be able to figure out how to send the trap that generated
    this output. Give it a try.
  prefs: []
  type: TYPE_NORMAL
- en: '[**Summary**](toc.html#chapter13.21)'
  prefs: []
  type: TYPE_NORMAL
- en: This chapter has given you a taste of what SNMP can do. You have installed,
    configured, and started the Net-SNMP agent on your own computer. You have explored
    what SNMP can tell you about a networked machine using the snmpget, snmpwalk,
    and snmptable commands provided by Net-SNMP. You have modified one of the settings
    on your system (sysName) with SNMP. You have also sent and received some traps.
    Except for the brief probes of a wireless access point and networked printer,
    we have limited ourselves to the local machine so that even readers not currently
    on a network can still have some fun exploring.
  prefs: []
  type: TYPE_NORMAL
- en: We have also limited our tools to those which come with the Net-SNMP package.
    The nice thing about standard protocols is that software from multiple sources
    can interoperate. You might try taking a look at a MIB browser from another source.
    MIB browsers walk a MIB for you and give you a graphical view of the MIB tree
    offered by the target system. You can find one such browser at [http://www.mibble.org](http://www.mibble.org/).
  prefs: []
  type: TYPE_NORMAL
- en: We hope this chapter has given you a taste for how useful SNMP can be to a network
    manager or IT professional. SNMP can be used to discover devices on a network,
    identify the type of device based on its IP address, or even reconfigure options
    on a device. This perspective will be helpful when it comes to designing your
    own MIB in the next chapter.
  prefs: []
  type: TYPE_NORMAL
- en: __________________
  prefs: []
  type: TYPE_NORMAL
- en: ¹ The Internet Engineering Task Force (IETF), started in 1986, is the principle
    standards organization for the Internet. Participation is voluntary and open to
    anyone. Most of its work is performed in *working groups (WGs),* which are ad
    hoc groups composed of parties interested in some specific topic.
  prefs: []
  type: TYPE_NORMAL
- en: ² In the parlance of the CLI chapter, snmpconf would be called a *wizard.*
  prefs: []
  type: TYPE_NORMAL
- en: '³ If you get the message Timeout: No Response from localhost instead, you may
    have something blocking UDP requests to port 161\. Check your firewall settings
    and your /etc/hosts.deny file. If you find ALL:ALL in your hosts.deny file, comment
    it out and try the snmpget again.'
  prefs: []
  type: TYPE_NORMAL
- en: ⁴ SNMPv2c is called “community-based” because it retains the use of SNMPv1 community
    strings (think of these as passwords) for authentication. There was disagreement
    about the new security framework that was intended for SNMPv2, so SNMPv2c was
    released without it. When it was ready, the new security framework was released
    in SNMPv3.
  prefs: []
  type: TYPE_NORMAL
- en: ⁵ Notice that the MIB object is sysLocation, but the command in the snmpd.conf
    file is syslocation. There is no significance to this; it was just the implementer’s
    design choice to use all lowercase letters for the key words in the configuration
    file.
  prefs: []
  type: TYPE_NORMAL
- en: ⁶ In case you’ve forgotten, the MIB files are in the directory /usr/share/snmp/mibs.
  prefs: []
  type: TYPE_NORMAL
- en: ⁷ The term *current* means that it’s an active type in the MIB, and you can
    expect to get a value back for it.
  prefs: []
  type: TYPE_NORMAL
- en: ⁸ Your error message may be different depending on your version of Net-SNMP
    and whether you are using SNMPv1 or SNMPv2, but you will get an error in any case.
  prefs: []
  type: TYPE_NORMAL
- en: ⁹ You need to be logged in as root because the command will want to write to
    /var/net-snmp/ snmpapp.conf, which is the persistent data storage. As of Net-SNMP
    5.3, it appears to want to write an SNMPv3 engine ID there, even though we are
    not using SNMPv3 here. (SNMPv3 is not covered in this book.)
  prefs: []
  type: TYPE_NORMAL
