- en: Chapter 2. GETTING STARTED
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第 2 章。开始使用
- en: '![image with no caption](httpatomoreillycomsourcenostarchimages333191.png.jpg)'
  id: totrans-1
  prefs: []
  type: TYPE_IMG
  zh: '![无标题图片](httpatomoreillycomsourcenostarchimages333191.png.jpg)'
- en: Fascinating though the theoretical underpinnings and implementation details
    of Xen are, we should probably move on to working directly with Xen for a bit
    of practice. There is, after all, no substitute for experience.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管 Xen 的理论基础和实现细节非常吸引人，但我们可能应该转向直接使用 Xen 进行一些实践。毕竟，经验是无法替代的。
- en: So! Welcome to Xen. This chapter is an easy quick start aimed at gently introducing
    Xen to one of your machines. We will hold your hand and not let it go.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 所以！欢迎来到 Xen。本章是一个简单的快速入门指南，旨在温和地将 Xen 介绍到你的机器之一。我们将牵着你的手，不会让你放手。
- en: Because this is a detailed walk-through, we're going to give focused, specific
    instructions, deviating from our normal policy of being vague and distro-agnostic.
    For the purposes of this chapter, we'll assume you're installing CentOS 5.x with
    the *server* defaults and using its built-in Xen support.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 因为这是一个详细的操作指南，我们将给出专注、具体的指令，偏离我们通常的模糊和发行版无关的政策。为了本章的目的，我们假设你正在安装带有 *服务器* 默认设置和内置
    Xen 支持的 CentOS 5.x。
- en: If you're using something else, this chapter will probably still be useful,
    but you might have to improvise a bit—the goals will be the same but the steps
    will probably be different.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用的是其他东西，本章可能仍然有用，但你可能需要即兴发挥——目标将是相同的，但步骤可能不同。
- en: RED HAT VS. CENTOS VS. FEDORA
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 红帽 VS. CentOS VS. Fedora
- en: So what is this CentOS, and why are we using it? The short answer is that CentOS,
    the *Community ENTerprise OS*, is an RPM-based distro derived from Red Hat Enterprise
    Linux with all of Red Hat's trademarks stripped out. We're focusing on it here
    because it's well supported by Xen, reasonably generic in structure, and fairly
    popular. Additionally, it's more stable than Fedora and a lot cheaper than Red
    Hat's official product, Red Hat Enterprise Linux (*RHEL* for short).
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，什么是 CentOS，我们为什么要使用它？简短的答案是，CentOS，即 *Community ENTerprise OS*，是一个基于 RPM
    的发行版，源自 Red Hat Enterprise Linux，去除了所有红帽的商标。我们在这里关注它，因为它得到了 Xen 的良好支持，结构上相当通用，并且相当受欢迎。此外，它比
    Fedora 更稳定，比红帽的官方产品 Red Hat Enterprise Linux（简称 *RHEL*）便宜得多。
- en: We have difficulty recommending Fedora for production use simply because the
    release cycle is unrealistically fast. While Red Hat handpicks updates for stability,
    Fedora operates as Red Hat's pressure cooker. Fedora applies the same sort of
    philosophy as Red Hat to picking kernel patches and such, but they release far
    more often. (If you've ever run a stock 2.6 kernel, you know that *someone* needs
    to handpick updates, be it you or your distro overlords, to get anything like
    enterprise performance.^([[14](#ftn.CHP-2-FNOTE-1)])) Fedora releases could be
    considered alpha versions of the next RHEL, and therefore, like any alpha software,
    we hesitate to rely on it.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 我们很难推荐 Fedora 用于生产使用，仅仅是因为其发布周期过于快速。虽然红帽精选更新以保证稳定性，但 Fedora 作为红帽的压力锅，更新频率更高。Fedora
    在选择内核补丁等方面采用与红帽相同的哲学，但它们发布得更为频繁。（如果你曾经运行过标准的 2.6 内核，你就知道*有人*需要精选更新，无论是你自己还是你的发行版管理者，才能获得类似企业级的表现。[14](#ftn.CHP-2-FNOTE-1)）Fedora
    的发布可以被视为下一个 RHEL 的 alpha 版本，因此，像任何 alpha 软件，我们犹豫是否依赖它。
- en: The reason we suggest CentOS rather than Red Hat Enterprise Linux is simply
    that RHEL is quite expensive. (Especially by Linux standards.) It may well be
    worth it if you want support—but we'll stick to CentOS. It's a good product, benefiting
    from Red Hat's years of work with Linux, and it's stable and easy to manage.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 我们建议使用 CentOS 而不是 Red Hat Enterprise Linux 的原因很简单，那就是 RHEL 非常昂贵。（特别是在 Linux
    标准）如果你需要支持，它可能确实值得——但我们坚持使用 CentOS。这是一个好产品，受益于红帽多年来在 Linux 方面的工作，它稳定且易于管理。
- en: Red Hat's effort shows to particular advantage in the work they've done integrating
    Xen. Red Hat has taken Xen and done a fair amount of work to make it a product.
    Thankfully, because Xen is open source, everyone benefits.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 红帽公司在整合 Xen 方面的努力显示出特别的优势。红帽已经将 Xen 纳入产品，并做了大量工作。幸运的是，由于 Xen 是开源的，每个人都能从中受益。
- en: 'In general, the goals for this walk-through are as follows:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，本指南的目标如下：
- en: Make sure your hardware can run Xen.
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 确保你的硬件能够运行 Xen。
- en: Install a basic OS.
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装一个基本的操作系统。
- en: Install Xen.
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装 Xen。
- en: Familiarize yourself with the Xen environment.
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 熟悉 Xen 环境。
- en: Install a domU.
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 安装一个 domU。
- en: Log in to your domU and configure it to make sure everything works.
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 登录到你的 domU 并配置它以确保一切正常工作。
- en: Rest.
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 休息。
- en: Hardware Compatibility
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 硬件兼容性
- en: First, make sure that your hardware's up to the task of running Xen. (It almost
    certainly is.)
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，确保您的硬件能够运行 Xen。 (几乎肯定可以。)
- en: All you need is a Pentium Pro or better, 512MiB of memory,^([[15](#ftn.CHP-2-FNOTE-2)])
    and a few hundred MiB of hard drive space. If you can't manage that, dig some
    change out of your couch cushions and buy a machine. The PPro came out in, what,
    1996? Haven't you heard? This Is The Future.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 您只需要一个奔腾 Pro 或更好的处理器，512MiB 的内存，^([[15](#ftn.CHP-2-FNOTE-2)]) 以及几百 MiB 的硬盘空间。如果您做不到这一点，就从沙发垫子里掏出一些零钱，买一台机器。PPro
    是在 1996 年推出的，对吧？你没听说吗？这是未来。
- en: At present, Xen runs only on x86 (that is, Intel and AMD) processors and IBM's
    PowerPC. X86_64—the 64-bit extension to the x86 instruction set—is supported on
    both AMD and Intel processors. Xen also supports Intel's Itanium. For the sake
    of this walk-through, we'll assume that you're using an x86 or x86_64 machine.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 目前，Xen 只能在 x86（即英特尔和 AMD）处理器以及 IBM 的 PowerPC 上运行。X86_64 是 x86 指令集的 64 位扩展，在
    AMD 和英特尔处理器上得到支持。Xen 还支持英特尔 Itanium。为了这次演练，我们假设您正在使用 x86 或 x86_64 机器。
- en: Our test box, for example—chosen to be as common as possible—was a three-year-old
    Dell, with a Pentium 4, 1GB of RAM, and a quantity of hard drive space beyond
    my wildest imaginings. Personally, I think it's all so fast it makes me sick.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 例如，我们的测试机——选择尽可能普通——是一台三年前的戴尔电脑，配备奔腾 4 处理器、1GB 内存和超出我最大想象的硬盘空间。我个人认为，这一切都太快了，让我感到恶心。
- en: Anyway, so you've got a machine capable of running Xen. Congratulations. First,
    it needs a basic operating system that Xen can run on top of.
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 无论如何，你已经拥有了一台能够运行 Xen 的机器。恭喜你。首先，它需要一个基本的操作系统，这样 Xen 才能在其之上运行。
- en: Note
  id: totrans-25
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: Run on top of *is probably not the best way of characterizing Xen's interaction
    with the dom0 OS, in view of the fact that the dom0 kernel runs on the hypervisor,
    but it is a convenient and frequently used phrase. We beg your patience, Constant
    Reader*.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *之上运行可能不是描述 Xen 与 dom0 操作系统交互的最佳方式，考虑到 dom0 内核是在虚拟机管理程序上运行的，但这是一个方便且常用的短语。我们请求您耐心等待，忠实读者*。
- en: '* * *'
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[14](#CHP-2-FNOTE-1)]) We recognize that some people may disagree with this
    opinion.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[14](#CHP-2-FNOTE-1)]) 我们认识到有些人可能不同意这种观点。
- en: ^([[15](#CHP-2-FNOTE-2)]) The absolute minimum would probably be 128MiB, but
    CentOS itself requires 256, and each domU will also require a significant amount
    of memory.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[15](#CHP-2-FNOTE-2)]) 最基本的可能需要 128MiB，但 CentOS 本身需要 256MiB，每个 domU 也需要相当数量的内存。
- en: Installing CentOS
  id: totrans-30
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装 CentOS
- en: First, we'll install CentOS in a completely ordinary way. Put the install medium
    in the drive, boot from it, and install it according to your preference. We opted
    to accept the default partitioning, which creates a small */boot* partition and
    devotes the rest of the drive to an LVM group, with a logical volume for swap
    and a volume for root. We also accepted the default configuration for the GRUB
    boot loader and the default network config.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们将以完全普通的方式安装 CentOS。将安装介质放入驱动器中，从它启动，并根据您的偏好进行安装。我们选择了接受默认分区，这会创建一个小的 */boot*
    分区，并将驱动器的其余部分分配给 LVM 组，包括用于交换的逻辑卷和根卷。我们还接受了 GRUB 引导加载程序和默认网络配置的默认配置。
- en: Note
  id: totrans-32
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*Now would also be a good time to make sure you have some sort of Internet
    access*.'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '*现在也是确保您有某种互联网接入的好时机*。'
- en: Set your time zone and enter a root password. We're just running through the
    standard CentOS install process at this point—it's probably familiar territory.
    Follow the prompts as usual.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 设置您的时区并输入 root 密码。目前我们只是在进行标准的 CentOS 安装过程——这可能是您熟悉的领域。按照提示操作。
- en: Next comes package selection. We chose the **virtualization server** package
    group, since that's the one that includes the Xen hypervisor and supporting tools,
    and left the rest blank. If you'd like to, you can also choose other package groups
    to install, like the GNOME desktop or server-gui set of packages, without modifying
    any of the steps in this section.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来是包选择。我们选择了 **虚拟化服务器** 包组，因为它包括了 Xen 虚拟机管理程序和支持工具，其余的保持空白。如果您愿意，您也可以选择安装其他包组，如
    GNOME 桌面或服务器-gui 包组，而无需修改本节中的任何步骤。
- en: Select **Next**. Now the machine will install the packages you've selected.
    This may take a while, varying with package selection and install medium. It took
    us about 15 minutes to install from a DVD. When that's done, the machine will
    reboot and give you the chance to do postinstall configuration—firewall, services,
    SELinux, and so on.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 选择**下一步**。现在机器将安装您选择的软件包。这可能需要一段时间，具体取决于软件包的选择和安装介质。我们使用DVD安装大约花了15分钟。安装完成后，机器将重新启动，并给您进行安装后配置的机会——防火墙、服务、SELinux等等。
- en: At this point you may wish to do other system configuration related stuff, not
    directly related to Xen. Feel free.
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一点上，您可能希望进行其他与系统配置相关的事情，但不直接与Xen相关。请随意。
- en: Now, we're ready to create a virtual machine. But first let's look at Xen's
    boot messages and get familiar with the Xen environment.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们已经准备好创建一个虚拟机。但在开始之前，让我们先看看Xen的启动信息，并熟悉Xen环境。
- en: THE LIVECD
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: THE LIVECD
- en: So, you downloaded the LiveCD? May as well try it. It's pretty slick, but when
    it's booted, it's just another operating system. This captures what makes Xen
    so fascinating—its sheer banality. After all this work, you wind up sitting in
    front of a Linux box. Yes, it will pretend to be multiple Linux boxes on demand,
    but there's not really much "there" there, to borrow a well-turned phrase from
    Gertrude Stein.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，您下载了LiveCD？不妨试试。它相当不错，但启动后，它只是另一个操作系统。这捕捉到了Xen如此迷人的地方——它的纯粹平凡。毕竟，经过所有这些工作，你最终会坐在一个Linux机器前。是的，它会根据需求假装成多个Linux机器，但事实上并没有多少“内容”，借用Gertrude
    Stein的一句名言。
- en: The LiveCD does showcase some useful features, though. For example, it uses
    a copy-on-write filesystem to give each Xen domain persistent writable storage
    across VM reboots. The LiveCD also has some neat scripts that use the XenBus to
    pop up a VNC console automatically on domU startup. (See [Chapter 14](ch14.html
    "Chapter 14. TIPS") for more information on that.)
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管LiveCD展示了某些有用的功能。例如，它使用写时复制文件系统，以便在虚拟机重启后为每个Xen域提供持久的可写存储。LiveCD还有一些巧妙的脚本，它们使用XenBus在domU启动时自动弹出VNC控制台。（有关更多信息，请参阅[第14章](ch14.html
    "第14章。技巧"））
- en: It's a nice demo, but it's not really useful for production, and it doesn't
    give you the sort of hands-on experience that comes with setting up a machine.
    The other problem is that the LiveCD hasn't been updated in a while. The last
    version (as of this writing) is two years old and is based on Xen 3.0.3\. There
    have since been some changes to Xen.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个很好的演示，但它在生产环境中并不真正有用，并且它不会给您带来设置机器时的那种动手经验。另一个问题是LiveCD已经有一段时间没有更新了。截至本文写作时，最后一个版本（版本号）是两年前的，基于Xen
    3.0.3。自那时以来，Xen已经发生了一些变化。
- en: Booting with Xen features extra Xen-specific boot output, as shown in [Figure 2-1](ch02s02.html#success_the_xen_kernel_wants_to_have_a_c
    "Figure 2-1. Success! The Xen kernel wants to have a conversation with us.").
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 使用Xen启动会显示额外的Xen特定启动输出，如图[图2-1](ch02s02.html#success_the_xen_kernel_wants_to_have_a_c
    "图2-1. 成功！Xen内核想要与我们交谈。"）所示。
- en: '![Success! The Xen kernel wants to have a conversation with us.](httpatomoreillycomsourcenostarchimages333205.png.jpg)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![成功！Xen内核想要与我们交谈。](httpatomoreillycomsourcenostarchimages333205.png.jpg)'
- en: Figure 2-1. Success! The Xen kernel wants to have a conversation with us.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 图2-1. 成功！Xen内核想要与我们交谈。
- en: After GRUB loads, it loads the Xen hypervisor, which then takes control of the
    hardware and outputs its initialization lines (starting with `(XEN)`). Then it
    loads the dom0 kernel, which takes over and spews the familiar Linux boot messages
    that we know and tolerate. (Note that you may not see these messages if you're
    using the VGA console, since they go by rather quickly. You can type `xm dmesg`
    to see them at any time.)
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 在GRUB加载后，它会加载Xen虚拟机管理程序，然后接管硬件并输出其初始化行（以`(XEN)`开头）。然后它加载dom0内核，接管并输出我们熟悉且可以容忍的Linux启动信息。（请注意，如果您使用的是VGA控制台，您可能看不到这些信息，因为它们很快就会过去。您可以通过输入`xm
    dmesg`在任何时候查看它们。）
- en: After the system boots, you should be looking at the normal login prompt, with
    nary a sign that you're running in a Xen virtual machine. (Albeit a specially
    privileged virtual machine.) Now would be a great time to log in, if you haven't
    already.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 系统启动后，您应该看到正常的登录提示符，几乎没有迹象表明您正在Xen虚拟机中运行。（尽管是一个特别授权的虚拟机。）如果您还没有登录，现在是个好时机。
- en: Getting Familiar with Your Xen System
  id: totrans-48
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 熟悉您的Xen系统
- en: Before we start creating virtual machines, let's take a brief look at the Xen
    configuration files in the dom0\. We'll be referring to these a lot in future
    chapters, so now might be a good time to take a quick tour.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们开始创建虚拟机之前，让我们简要地看一下 dom0 中的 Xen 配置文件。我们将在未来的章节中经常引用这些文件，所以现在可能是快速浏览的好时机。
- en: First, there's the Xen configuration directory, */etc/xen*. Most, though not
    all, of the Xen configuration happens via files here or in the *scripts* subdirectory.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，是 Xen 配置目录，*/etc/xen*。大多数（尽管不是全部）的 Xen 配置都是通过文件在这里或 *scripts* 子目录中完成的。
- en: The main Xen config file is *xend-config.sxp*. This where you'd perform tasks
    like enabling migration or specifying the network backend. For now, we'll be content
    with the defaults.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 主要的 Xen 配置文件是 *xend-config.sxp*。在这里，你会执行诸如启用迁移或指定网络后端等任务。现在，我们将满足于默认设置。
- en: Note
  id: totrans-52
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*If you''re planning on using this Xen installation for anything besides this
    walk-through, now is a good time to set the* *`(dom-min-mem)`* *option in* xend-config.sxp
    *to something sensible. We use* *`(dom-min-mem 1024)`*. *See [Chapter 14](ch14.html
    "Chapter 14. TIPS") for more details*.'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: '*如果你打算将此 Xen 安装用于除了本指南以外的任何目的，现在是一个好时机来设置 xend-config.sxp 中的* *`(dom-min-mem)`*
    *选项为一个合理的值。我们使用* *`(dom-min-mem 1024)`*。* 更多详情请见 [第 14 章](ch14.html "第 14 章。技巧")。'
- en: The */etc/xen/scripts* directory contains scripts to handle tasks like setting
    up virtual devices.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: '*/etc/xen/scripts* 目录包含处理设置虚拟设备等任务的脚本。'
- en: Finally, domain configuration files live in */etc/xen*. For example, you can
    take a look at *xmexample1* to see a liberally commented sample config.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，域配置文件位于 */etc/xen* 中。例如，你可以查看 *xmexample1* 来查看一个注释丰富的示例配置。
- en: The */etc/init.d* directory contains scripts to start and stop Xen-related services.
    The Xen control daemon, `xend`, runs as a standard service from the */etc/init.d/xend*
    script. Although you probably won't need to modify it, this can be a handy place
    to change `xend` 's parameters. It's also the easiest way to restart `xend`, by
    running `/etc/init.d/xend restart`. The *xendomains* script may also be of interest—it
    automatically saves domains when the system shuts down and restores them when
    it boots up.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: '*/etc/init.d* 目录包含启动和停止 Xen 相关服务的脚本。Xen 控制守护进程 `xend` 通过 */etc/init.d/xend*
    脚本作为标准服务运行。虽然你可能不需要修改它，但这可以是一个方便的地方来更改 `xend` 的参数。这也是重启 `xend` 的最简单方法，通过运行 `/etc/init.d/xend
    restart`。*xendomains* 脚本也可能引起你的兴趣——它在系统关闭时自动保存域，并在启动时恢复它们。'
- en: There's also */boot/grub/menu.lst*. This file tells the bootloader, GRUB, to
    boot the Xen kernel, relegating the dom0 Linux kernel to a "module" line. Here
    you'd change the boot parameters for both Xen and Linux. For example, you might
    want to specify a fixed memory allocation for dom0 using the `dom0_mem` hypervisor
    option, or increase the number of network loopback devices via the Linux `nloopbacks`
    option.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，还有 */boot/grub/menu.lst* 文件。这个文件告诉引导加载程序 GRUB 引导 Xen 内核，将 dom0 Linux 内核降级为“模块”行。在这里，你可以更改
    Xen 和 Linux 的引导参数。例如，你可能想使用 `dom0_mem` 虚拟机选项指定 dom0 的固定内存分配，或者通过 Linux 的 `nloopbacks`
    选项增加网络环回设备的数量。
- en: domU data itself, if you're using file-backed virtual disks under CentOS and
    following the default prompts for `virt-install`, resides in */var/lib/xen/images*.
    Other distros and frontends are likely to have different defaults.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你在 CentOS 下使用基于文件的虚拟磁盘，并遵循 `virt-install` 的默认提示，domU 数据本身位于 */var/lib/xen/images*。其他发行版和前端可能有不同的默认设置。
- en: Management with xm
  id: totrans-59
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 xm 进行管理
- en: 'The main command that you''ll use to interact with Xen is `xm`. This tool has
    a wide variety of subcommands. First, since we''re still looking around the environment,
    try `xm list`:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 你将与 Xen 交互的主要命令是 `xm`。这个工具有许多子命令。首先，因为我们还在环境中四处查看，所以尝试 `xm list`：
- en: '[PRE0]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: The output of `xm list` shows the running domains and their attributes. Here
    we see that only one domain is running, Domain-0 (abbreviated *dom0* throughout
    the book) with ID 0, 934MiB of memory, and two VCPUS. It's in the "running" state
    and has used 37.6 seconds of CPU time since boot.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: '`xm list` 的输出显示了正在运行的域及其属性。在这里，我们看到只有一个域正在运行，即 Domain-0（本书中缩写为 *dom0*），ID 为
    0，内存为 934MiB，两个 VCPUS。它处于“运行”状态，自引导以来已使用了 37.6 秒的 CPU 时间。'
- en: Note
  id: totrans-63
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 注意
- en: '*Red Hat doesn''t officially support* `xm`, *although they unofficially expect
    it to continue working through RHEL 5*.x. *For this reason*, `xm` ''*s documentation
    may advertise capabilities that don''t work on RHEL or CentOS. The supported management
    tool on RHEL and friends is* *`virsh`*, *for* virtualization shell.'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: '*Red Hat官方不支持* `xm`，*尽管他们非官方地期望它将继续在RHEL 5.x上工作*。因此，`xm` 的文档可能会宣传一些在RHEL或CentOS上不工作的功能。RHEL及其朋友支持的管理工具是*
    `virsh`*，*用于*虚拟化shell。'
- en: You might also try `xm info` for more information on the hypervisor. We'll introduce
    more `xm` subcommands in later chapters, and there's a complete list in [Appendix A](apa.html
    "Appendix A. XM REFERENCE").
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 你也可以尝试 `xm info` 来获取更多关于虚拟机管理程序的信息。我们将在后面的章节中介绍更多的 `xm` 子命令，并在[附录A](apa.html
    "附录A。XM参考")中提供完整的列表。
- en: Making a DomU
  id: totrans-66
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建DomU
- en: For the moment, since we want to create a domU, the `xm` subcommand we're most
    interested in is `create`. However, before we can create a domain, we need to
    create an OS image for it to boot from and use as storage.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 目前，由于我们想要创建一个domU，我们最感兴趣的 `xm` 子命令是 `create`。然而，在我们能够创建一个域之前，我们需要为它创建一个可以从中引导并用作存储的操作系统镜像。
- en: Because this is an initial walk-through, we're going to install our Xen image
    using Red Hat's `virt-install` tool. For information on building your own domU
    images, take a look at [Chapter 3](ch03.html "Chapter 3. PROVISIONING DOMUS").
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 因为这是一个初步的演练，我们将使用Red Hat的 `virt-install` 工具安装我们的Xen镜像。有关构建自己的domU镜像的信息，请参阅[第3章](ch03.html
    "第3章。DOMUS的配置")。
- en: Begin by starting `virt-install`. It'll start in interactive mode, and have
    a bit of a conversation with you, as shown. Our inputs are shown in bold. (If
    you decided to install the GUI, you can also use the graphical `virt-manager`
    tool. The prompts will look very similar.)
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，启动 `virt-install`。它将以交互模式启动，并会与你进行一些对话，如下所示。我们的输入以粗体显示。（如果你决定安装GUI，也可以使用图形化的
    `virt-manager` 工具。提示信息看起来非常相似。）
- en: '[PRE1]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The machine then begins an interactive network install of CentOS. We won''t
    go into the details of its operation for now—suffice it to say that great pains
    have been taken to preserve the appearance of installing an OS on a physical machine.
    As such, the install process should eerily resemble the one we performed at the
    start of this chapter. Follow its prompts. (For the curious, we discuss `virt-install`
    and its accompanying tools more thoroughly in Chapters [Chapter 3](ch03.html "Chapter 3. PROVISIONING
    DOMUS") and [Chapter 6](ch06.html "Chapter 6. DOMU MANAGEMENT: TOOLS AND FRONTENDS").)'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，机器开始交互式地安装CentOS网络。现在我们不会深入其操作细节——只需说，已经付出了巨大的努力来保留在物理机上安装操作系统的外观。因此，安装过程应该会令人毛骨悚然地类似于我们在本章开头执行的过程。遵循其提示。（对于好奇者，我们将在第[第3章](ch03.html
    "第3章。DOMUS的配置")和第[第6章](ch06.html "第6章。DOMU管理：工具和前端")中更详细地讨论 `virt-install` 及其相关工具。）
- en: Once you've made your selections and gone through the install, the machine will
    reboot. Log in, and then shut the machine down via `shutdown -h now` (remember,
    it's an ordinary Linux box) so that we can look a bit more at things from the
    dom0 end.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你完成了选择并完成了安装，机器将重新启动。登录后，通过 `shutdown -h now` 关闭机器（记住，它是一个普通的Linux盒子），这样我们就可以从dom0端更详细地查看一些内容。
- en: Anatomy of a Domain Configuration File
  id: totrans-73
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 域配置文件的结构
- en: Let's take a moment to examine the config file that `virt-install` generated
    for us. As we've mentioned already, the config file is */etc/xen/<domain name>*
    by convention.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们花一点时间来检查 `virt-install` 为我们生成的配置文件。正如我们之前提到的，按照惯例，配置文件是 */etc/xen/<domain
    name>*。
- en: '[PRE2]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: As you see, the file consists of simple name=value pairs, with Python-style
    lists in square brackets. Note the values that we specified in the `virt-install`
    session, plugged into appropriate places—the name, the memory amount, and the
    disk image. `virt-install` also fills in some network configuration, specifying
    a MAC address and dom0-level bridge device.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 如你所见，该文件由简单的 name=value 对组成，其中包含Python风格的方括号列表。注意我们在 `virt-install` 会话中指定的值，插入到适当的位置——名称、内存量和磁盘镜像。`virt-install`
    还填写了一些网络配置，指定了MAC地址和dom0级别的桥接设备。
- en: We'll examine many of the config file parameters more deeply in subsequent chapters.
    For now, let's just move on to seeing the effects of these values on our domain.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在后续章节中更深入地检查许多配置文件参数。现在，让我们继续看看这些值对我们域的影响。
- en: Configuring the DomU
  id: totrans-78
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 配置DomU
- en: Finally, start the image! We'll run `xm` with the `create` subcommand, which
    expects a config file name as an argument. We can omit the path, since it defaults
    to looking in */etc/xen*.
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，启动镜像！我们将使用 `xm` 和 `create` 子命令，它期望一个配置文件名作为参数。我们可以省略路径，因为它默认在 */etc/xen*
    中查找。
- en: '[PRE3]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Since we passed the `-c` option to `xm create`, it'll immediately connect us
    to the domain's console, so that we can interact with the bootloader. Hit ENTER
    to boot with default options, and watch it go.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们向 `xm create` 传递了 `-c` 选项，它将立即将我们连接到域的控制台，这样我们就可以与引导加载程序交互。按回车键使用默认选项启动，并观察其运行情况。
- en: Once it boots, you should be looking at the console of a shiny new Xen domU,
    as illustrated in [Figure 2-2](ch02s05.html#we_assure_you_that_this_is_the_domu_cons
    "Figure 2-2. We assure you that this is the domU console."). Log in as root and
    frolic.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 启动后，您应该会看到一个新的Xen domU的控制台，如图2-2所示。[Figure 2-2](ch02s05.html#we_assure_you_that_this_is_the_domu_cons
    "Figure 2-2. 我们向您保证这是domU控制台。")所示。以root身份登录并尽情享受。
- en: Start by looking at the output of the `dmesg` command within the domU. Note
    that the disk and network devices are Xen's special paravirtualized devices.
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，查看domU内部的 `dmesg` 命令的输出。请注意，磁盘和网络设备是Xen的特殊半虚拟化设备。
- en: '![We assure you that this is the domU console.](httpatomoreillycomsourcenostarchimages333207.png.jpg)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![我们向您保证这是domU控制台。](httpatomoreillycomsourcenostarchimages333207.png.jpg)'
- en: Figure 2-2. We assure you that this is the domU console.
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 图2-2. 我们向您保证这是domU控制台。
- en: 'You can also take a look at the domU''s networking, which is essentially indistinguishable
    from that of a normal Linux system:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以查看domU的网络设置，它与普通Linux系统的网络设置基本无法区分：
- en: '[PRE4]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Note that we're using standard commands—one of the major features of Xen is
    that most of the management takes place via familiar Linux commands. This makes
    it easy to customize your Xen environment, usually by making changes to the support
    scripts. Furthermore, standard commands will generally behave in expected ways—for
    example, you can give yourself a new IP address via `ifconfig`, and it'll work
    just as it would on a physical machine.^([[16](#ftn.CHP-2-FNOTE-3)])
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 注意，我们正在使用标准命令——Xen的一个主要特性是大多数管理操作都通过熟悉的Linux命令进行。这使得自定义Xen环境变得容易，通常是通过修改支持脚本来实现。此外，标准命令通常以预期的方式运行——例如，您可以通过
    `ifconfig` 给自己分配一个新的IP地址，它将像在物理机上一样工作.^([[16](#ftn.CHP-2-FNOTE-3)])
- en: Let's return to the dom0 for a moment, just to take a look at the running domain
    from outside. To break out of the domU's console, type CTRL-]. You can reconnect
    at any time by running `xm console <domU name or id>` from the dom0.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们暂时回到dom0，从外部看一下正在运行的域。要退出domU的控制台，请输入CTRL-]。您可以在任何时候通过在dom0中运行 `xm console
    <domU名称或ID>` 来重新连接。
- en: 'Now that we''re back in the dom0, we can note that our new domain shows up
    in `xm list`, consuming memory and CPU time:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们回到了dom0，我们可以注意到我们的新域在 `xm list` 中显示，消耗内存和CPU时间：
- en: '[PRE5]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'And that it''s got a visible network device:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: 并且它有一个可见的网络设备：
- en: '[PRE6]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Some points to mention about the network device: First, it''s got a dummy MAC
    address. You can see the actual MAC address of the virtual Ethernet device from
    within the domU. Second, the counters are reversed—the domain''s actually downloaded
    100MiB, and transmitted 2.7\. Third, both IPv4 and IPv6 "just work" with the default
    setup. We go into further detail in [Chapter 5](ch05.html "Chapter 5. NETWORKING").'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 关于网络设备的一些要点：首先，它有一个虚拟的MAC地址。您可以在domU内部看到虚拟以太网设备的实际MAC地址。其次，计数器是相反的——域实际上下载了100MiB，并传输了2.7。第三，IPv4和IPv6在默认设置下“正常工作”。我们将在[第5章](ch05.html
    "第5章。网络")中进一步详细介绍。
- en: From here you can treat the domain just like any other Linux box. You can set
    up users on it, SSH into it, or access its console via `xm console`. You can reboot
    it via the `xm reboot` command, and shut it down using `xm shutdown`.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 从这里您可以将域当作任何其他Linux服务器来处理。您可以在其上设置用户，通过SSH连接到它，或通过 `xm console` 访问其控制台。您可以通过
    `xm reboot` 命令重新启动它，并使用 `xm shutdown` 命令关闭它。
- en: '* * *'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: '* * *'
- en: ^([[16](#CHP-2-FNOTE-3)]) The administrator can disable this, however. You'll
    still be able to change the IP from the domU, but the dom0 will block traffic
    from the new IP. See [Chapter 5](ch05.html "Chapter 5. NETWORKING") for details.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: ^([[16](#CHP-2-FNOTE-3)]) 管理员可以禁用此功能。您仍然可以从domU更改IP地址，但dom0将阻止来自新IP的流量。有关详细信息，请参阅[第5章](ch05.html
    "第5章。网络")。
- en: You're Finished. Have a Cookie.
  id: totrans-98
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 您已完成。请享用饼干。
- en: Now that you've got a domain, read the next chapter.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 现在您已经有一个域了，请阅读下一章。
- en: If it didn't work … what a fabulous opportunity to examine [Chapter 15](ch15.html
    "Chapter 15. TROUBLESHOOTING"). We are sorry. Please email us and mention that
    our directions need work.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 如果它不起作用……那将是一个检查[第15章](ch15.html "第15章. 故障排除")的绝佳机会。我们很抱歉。请给我们发邮件并说明我们的指示需要改进。
